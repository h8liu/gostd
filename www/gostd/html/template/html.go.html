<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5226191">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5226246">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5226300">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5226351">package</span>&nbsp;<span class="ident" id="5226359">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5226369">import</span>&nbsp;<span class="op" id="5226376">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5226379">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5226388">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5226395">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5226406">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5226421">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5226424">//&nbsp;htmlNospaceEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;unquoted&nbsp;attribute&nbsp;values.</span><br>
<span class="lineno">15</span><span class="keyword" id="5226498">func</span>&nbsp;<span class="ident" id="5226503">htmlNospaceEscaper</span><span class="op" id="5226521">(</span><span class="ident" id="5226522">args</span>&nbsp;<span class="op" id="5226527">...</span><span class="keyword" id="5226530">interface</span><span class="op" id="5226539">{</span><span class="op" id="5226540">}</span><span class="op" id="5226541">)</span>&nbsp;<span class="builtintype" id="5226543">string</span>&nbsp;<span class="op" id="5226550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226553">s</span><span class="op" id="5226554">,</span>&nbsp;<span class="ident" id="5226556">t</span>&nbsp;<span class="op" id="5226558">:=</span>&nbsp;<span class="ident" id="5226561">stringify</span><span class="op" id="5226570">(</span><span class="ident" id="5226571">args</span><span class="op" id="5226575">...</span><span class="op" id="5226578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226581">if</span>&nbsp;<span class="ident" id="5226584">t</span>&nbsp;<span class="op" id="5226586">==</span>&nbsp;<span class="ident" id="5226589">contentTypeHTML</span>&nbsp;<span class="op" id="5226605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226609">return</span>&nbsp;<span class="ident" id="5226616">htmlReplacer</span><span class="op" id="5226628">(</span><span class="ident" id="5226629">stripTags</span><span class="op" id="5226638">(</span><span class="ident" id="5226639">s</span><span class="op" id="5226640">)</span><span class="op" id="5226641">,</span>&nbsp;<span class="ident" id="5226643">htmlNospaceNormReplacementTable</span><span class="op" id="5226674">,</span>&nbsp;<span class="builtintype" id="5226676">false</span><span class="op" id="5226681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5226684">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226687">return</span>&nbsp;<span class="ident" id="5226694">htmlReplacer</span><span class="op" id="5226706">(</span><span class="ident" id="5226707">s</span><span class="op" id="5226708">,</span>&nbsp;<span class="ident" id="5226710">htmlNospaceReplacementTable</span><span class="op" id="5226737">,</span>&nbsp;<span class="builtintype" id="5226739">false</span><span class="op" id="5226744">)</span><br>
<span class="lineno"></span><span class="op" id="5226746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5226749">//&nbsp;attrEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;quoted&nbsp;attribute&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5226814">func</span>&nbsp;<span class="ident" id="5226819">attrEscaper</span><span class="op" id="5226830">(</span><span class="ident" id="5226831">args</span>&nbsp;<span class="op" id="5226836">...</span><span class="keyword" id="5226839">interface</span><span class="op" id="5226848">{</span><span class="op" id="5226849">}</span><span class="op" id="5226850">)</span>&nbsp;<span class="builtintype" id="5226852">string</span>&nbsp;<span class="op" id="5226859">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226862">s</span><span class="op" id="5226863">,</span>&nbsp;<span class="ident" id="5226865">t</span>&nbsp;<span class="op" id="5226867">:=</span>&nbsp;<span class="ident" id="5226870">stringify</span><span class="op" id="5226879">(</span><span class="ident" id="5226880">args</span><span class="op" id="5226884">...</span><span class="op" id="5226887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226890">if</span>&nbsp;<span class="ident" id="5226893">t</span>&nbsp;<span class="op" id="5226895">==</span>&nbsp;<span class="ident" id="5226898">contentTypeHTML</span>&nbsp;<span class="op" id="5226914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226918">return</span>&nbsp;<span class="ident" id="5226925">htmlReplacer</span><span class="op" id="5226937">(</span><span class="ident" id="5226938">stripTags</span><span class="op" id="5226947">(</span><span class="ident" id="5226948">s</span><span class="op" id="5226949">)</span><span class="op" id="5226950">,</span>&nbsp;<span class="ident" id="5226952">htmlNormReplacementTable</span><span class="op" id="5226976">,</span>&nbsp;<span class="builtintype" id="5226978">true</span><span class="op" id="5226982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5226985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226988">return</span>&nbsp;<span class="ident" id="5226995">htmlReplacer</span><span class="op" id="5227007">(</span><span class="ident" id="5227008">s</span><span class="op" id="5227009">,</span>&nbsp;<span class="ident" id="5227011">htmlReplacementTable</span><span class="op" id="5227031">,</span>&nbsp;<span class="builtintype" id="5227033">true</span><span class="op" id="5227037">)</span><br>
<span class="lineno">30</span><span class="op" id="5227039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5227042">//&nbsp;rcdataEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;an&nbsp;RCDATA&nbsp;element&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="5227108">func</span>&nbsp;<span class="ident" id="5227113">rcdataEscaper</span><span class="op" id="5227126">(</span><span class="ident" id="5227127">args</span>&nbsp;<span class="op" id="5227132">...</span><span class="keyword" id="5227135">interface</span><span class="op" id="5227144">{</span><span class="op" id="5227145">}</span><span class="op" id="5227146">)</span>&nbsp;<span class="builtintype" id="5227148">string</span>&nbsp;<span class="op" id="5227155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227158">s</span><span class="op" id="5227159">,</span>&nbsp;<span class="ident" id="5227161">t</span>&nbsp;<span class="op" id="5227163">:=</span>&nbsp;<span class="ident" id="5227166">stringify</span><span class="op" id="5227175">(</span><span class="ident" id="5227176">args</span><span class="op" id="5227180">...</span><span class="op" id="5227183">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227186">if</span>&nbsp;<span class="ident" id="5227189">t</span>&nbsp;<span class="op" id="5227191">==</span>&nbsp;<span class="ident" id="5227194">contentTypeHTML</span>&nbsp;<span class="op" id="5227210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227214">return</span>&nbsp;<span class="ident" id="5227221">htmlReplacer</span><span class="op" id="5227233">(</span><span class="ident" id="5227234">s</span><span class="op" id="5227235">,</span>&nbsp;<span class="ident" id="5227237">htmlNormReplacementTable</span><span class="op" id="5227261">,</span>&nbsp;<span class="builtintype" id="5227263">true</span><span class="op" id="5227267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5227270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227273">return</span>&nbsp;<span class="ident" id="5227280">htmlReplacer</span><span class="op" id="5227292">(</span><span class="ident" id="5227293">s</span><span class="op" id="5227294">,</span>&nbsp;<span class="ident" id="5227296">htmlReplacementTable</span><span class="op" id="5227316">,</span>&nbsp;<span class="builtintype" id="5227318">true</span><span class="op" id="5227322">)</span><br>
<span class="lineno"></span><span class="op" id="5227324">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="5227327">//&nbsp;htmlEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;HTML&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="5227378">func</span>&nbsp;<span class="ident" id="5227383">htmlEscaper</span><span class="op" id="5227394">(</span><span class="ident" id="5227395">args</span>&nbsp;<span class="op" id="5227400">...</span><span class="keyword" id="5227403">interface</span><span class="op" id="5227412">{</span><span class="op" id="5227413">}</span><span class="op" id="5227414">)</span>&nbsp;<span class="builtintype" id="5227416">string</span>&nbsp;<span class="op" id="5227423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227426">s</span><span class="op" id="5227427">,</span>&nbsp;<span class="ident" id="5227429">t</span>&nbsp;<span class="op" id="5227431">:=</span>&nbsp;<span class="ident" id="5227434">stringify</span><span class="op" id="5227443">(</span><span class="ident" id="5227444">args</span><span class="op" id="5227448">...</span><span class="op" id="5227451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227454">if</span>&nbsp;<span class="ident" id="5227457">t</span>&nbsp;<span class="op" id="5227459">==</span>&nbsp;<span class="ident" id="5227462">contentTypeHTML</span>&nbsp;<span class="op" id="5227478">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227482">return</span>&nbsp;<span class="ident" id="5227489">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5227492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227495">return</span>&nbsp;<span class="ident" id="5227502">htmlReplacer</span><span class="op" id="5227514">(</span><span class="ident" id="5227515">s</span><span class="op" id="5227516">,</span>&nbsp;<span class="ident" id="5227518">htmlReplacementTable</span><span class="op" id="5227538">,</span>&nbsp;<span class="builtintype" id="5227540">true</span><span class="op" id="5227544">)</span><br>
<span class="lineno"></span><span class="op" id="5227546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="5227549">//&nbsp;htmlReplacementTable&nbsp;contains&nbsp;the&nbsp;runes&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;escaped</span><br>
<span class="lineno"></span><span class="comment" id="5227616">//&nbsp;inside&nbsp;a&nbsp;quoted&nbsp;attribute&nbsp;value&nbsp;or&nbsp;in&nbsp;a&nbsp;text&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="5227670">var</span>&nbsp;<span class="ident" id="5227674">htmlReplacementTable</span>&nbsp;<span class="op" id="5227695">=</span>&nbsp;<span class="op" id="5227697">[</span><span class="op" id="5227698">]</span><span class="builtintype" id="5227699">string</span><span class="op" id="5227705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5227708">//&nbsp;http://www.w3.org/TR/html5/syntax.html#attribute-value-(unquoted)-state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5227784">//&nbsp;U+0000&nbsp;NULL&nbsp;Parse&nbsp;error.&nbsp;Append&nbsp;a&nbsp;U+FFFD&nbsp;REPLACEMENT</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5227841">//&nbsp;CHARACTER&nbsp;character&nbsp;to&nbsp;the&nbsp;current&nbsp;attribute&#39;s&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5227899">//&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5227905">//&nbsp;and&nbsp;similarly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5227923">//&nbsp;http://www.w3.org/TR/html5/syntax.html#before-attribute-value-state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5227995">0</span><span class="op" id="5227996">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5228001">&#34;\uFFFD&#34;</span><span class="op" id="5228009">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5228012">&#39;&#34;&#39;</span><span class="op" id="5228015">:</span>&nbsp;&nbsp;<span class="string" id="5228018">&#34;&amp;#34;&#34;</span><span class="op" id="5228025">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5228028">&#39;&amp;&#39;</span><span class="op" id="5228031">:</span>&nbsp;&nbsp;<span class="string" id="5228034">&#34;&amp;amp;&#34;</span><span class="op" id="5228041">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5228044">&#39;\&#39;&#39;</span><span class="op" id="5228048">:</span>&nbsp;<span class="string" id="5228050">&#34;&amp;#39;&#34;</span><span class="op" id="5228057">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5228060">&#39;+&#39;</span><span class="op" id="5228063">:</span>&nbsp;&nbsp;<span class="string" id="5228066">&#34;&amp;#43;&#34;</span><span class="op" id="5228073">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5228076">&#39;&lt;&#39;</span><span class="op" id="5228079">:</span>&nbsp;&nbsp;<span class="string" id="5228082">&#34;&amp;lt;&#34;</span><span class="op" id="5228088">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5228091">&#39;&gt;&#39;</span><span class="op" id="5228094">:</span>&nbsp;&nbsp;<span class="string" id="5228097">&#34;&amp;gt;&#34;</span><span class="op" id="5228103">,</span><br>
<span class="lineno"></span><span class="op" id="5228105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5228108">//&nbsp;htmlNormReplacementTable&nbsp;is&nbsp;like&nbsp;htmlReplacementTable&nbsp;but&nbsp;without&nbsp;&#39;&amp;&#39;&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5228184">//&nbsp;avoid&nbsp;over-encoding&nbsp;existing&nbsp;entities.</span><br>
<span class="lineno">70</span><span class="keyword" id="5228226">var</span>&nbsp;<span class="ident" id="5228230">htmlNormReplacementTable</span>&nbsp;<span class="op" id="5228255">=</span>&nbsp;<span class="op" id="5228257">[</span><span class="op" id="5228258">]</span><span class="builtintype" id="5228259">string</span><span class="op" id="5228265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5228268">0</span><span class="op" id="5228269">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5228274">&#34;\uFFFD&#34;</span><span class="op" id="5228282">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5228285">&#39;&#34;&#39;</span><span class="op" id="5228288">:</span>&nbsp;&nbsp;<span class="string" id="5228291">&#34;&amp;#34;&#34;</span><span class="op" id="5228298">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5228301">&#39;\&#39;&#39;</span><span class="op" id="5228305">:</span>&nbsp;<span class="string" id="5228307">&#34;&amp;#39;&#34;</span><span class="op" id="5228314">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5228317">&#39;+&#39;</span><span class="op" id="5228320">:</span>&nbsp;&nbsp;<span class="string" id="5228323">&#34;&amp;#43;&#34;</span><span class="op" id="5228330">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5228333">&#39;&lt;&#39;</span><span class="op" id="5228336">:</span>&nbsp;&nbsp;<span class="string" id="5228339">&#34;&amp;lt;&#34;</span><span class="op" id="5228345">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5228348">&#39;&gt;&#39;</span><span class="op" id="5228351">:</span>&nbsp;&nbsp;<span class="string" id="5228354">&#34;&amp;gt;&#34;</span><span class="op" id="5228360">,</span><br>
<span class="lineno"></span><span class="op" id="5228362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5228365">//&nbsp;htmlNospaceReplacementTable&nbsp;contains&nbsp;the&nbsp;runes&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;escaped</span><br>
<span class="lineno">80</span><span class="comment" id="5228439">//&nbsp;inside&nbsp;an&nbsp;unquoted&nbsp;attribute&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5228478">//&nbsp;The&nbsp;set&nbsp;of&nbsp;runes&nbsp;escaped&nbsp;is&nbsp;the&nbsp;union&nbsp;of&nbsp;the&nbsp;HTML&nbsp;specials&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5228544">//&nbsp;those&nbsp;determined&nbsp;by&nbsp;running&nbsp;the&nbsp;JS&nbsp;below&nbsp;in&nbsp;browsers:</span><br>
<span class="lineno"></span><span class="comment" id="5228601">//&nbsp;&lt;div&nbsp;id=d&gt;&lt;/div&gt;</span><br>
<span class="lineno"></span><span class="comment" id="5228621">//&nbsp;&lt;script&gt;(function&nbsp;()&nbsp;{</span><br>
<span class="lineno">85</span><span class="comment" id="5228647">//&nbsp;var&nbsp;a&nbsp;=&nbsp;[],&nbsp;d&nbsp;=&nbsp;document.getElementById(&#34;d&#34;),&nbsp;i,&nbsp;c,&nbsp;s;</span><br>
<span class="lineno"></span><span class="comment" id="5228705">//&nbsp;for&nbsp;(i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;0x10000;&nbsp;++i)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5228740">//&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;String.fromCharCode(i);</span><br>
<span class="lineno"></span><span class="comment" id="5228773">//&nbsp;&nbsp;&nbsp;d.innerHTML&nbsp;=&nbsp;&#34;&lt;span&nbsp;title=&#34;&nbsp;+&nbsp;c&nbsp;+&nbsp;&#34;lt&#34;&nbsp;+&nbsp;c&nbsp;+&nbsp;&#34;&gt;&lt;/span&gt;&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5228835">//&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;d.getElementsByTagName(&#34;SPAN&#34;)[0];</span><br>
<span class="lineno">90</span><span class="comment" id="5228879">//&nbsp;&nbsp;&nbsp;if&nbsp;(!s&nbsp;||&nbsp;s.title&nbsp;!==&nbsp;c&nbsp;+&nbsp;&#34;lt&#34;&nbsp;+&nbsp;c)&nbsp;{&nbsp;a.push(i.toString(16));&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5228948">//&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5228953">//&nbsp;document.write(a.join(&#34;,&nbsp;&#34;));</span><br>
<span class="lineno"></span><span class="comment" id="5228986">//&nbsp;})()&lt;/script&gt;</span><br>
<span class="lineno"></span><span class="keyword" id="5229003">var</span>&nbsp;<span class="ident" id="5229007">htmlNospaceReplacementTable</span>&nbsp;<span class="op" id="5229035">=</span>&nbsp;<span class="op" id="5229037">[</span><span class="op" id="5229038">]</span><span class="builtintype" id="5229039">string</span><span class="op" id="5229045">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5229048">0</span><span class="op" id="5229049">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5229054">&#34;&amp;#xfffd;&#34;</span><span class="op" id="5229064">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5229067">&#39;\t&#39;</span><span class="op" id="5229071">:</span>&nbsp;<span class="string" id="5229073">&#34;&amp;#9;&#34;</span><span class="op" id="5229079">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5229082">&#39;\n&#39;</span><span class="op" id="5229086">:</span>&nbsp;<span class="string" id="5229088">&#34;&amp;#10;&#34;</span><span class="op" id="5229095">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5229098">&#39;\v&#39;</span><span class="op" id="5229102">:</span>&nbsp;<span class="string" id="5229104">&#34;&amp;#11;&#34;</span><span class="op" id="5229111">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5229114">&#39;\f&#39;</span><span class="op" id="5229118">:</span>&nbsp;<span class="string" id="5229120">&#34;&amp;#12;&#34;</span><span class="op" id="5229127">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5229130">&#39;\r&#39;</span><span class="op" id="5229134">:</span>&nbsp;<span class="string" id="5229136">&#34;&amp;#13;&#34;</span><span class="op" id="5229143">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5229146">&#39;&nbsp;&#39;</span><span class="op" id="5229149">:</span>&nbsp;&nbsp;<span class="string" id="5229152">&#34;&amp;#32;&#34;</span><span class="op" id="5229159">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5229162">&#39;&#34;&#39;</span><span class="op" id="5229165">:</span>&nbsp;&nbsp;<span class="string" id="5229168">&#34;&amp;#34;&#34;</span><span class="op" id="5229175">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5229178">&#39;&amp;&#39;</span><span class="op" id="5229181">:</span>&nbsp;&nbsp;<span class="string" id="5229184">&#34;&amp;amp;&#34;</span><span class="op" id="5229191">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5229194">&#39;\&#39;&#39;</span><span class="op" id="5229198">:</span>&nbsp;<span class="string" id="5229200">&#34;&amp;#39;&#34;</span><span class="op" id="5229207">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5229210">&#39;+&#39;</span><span class="op" id="5229213">:</span>&nbsp;&nbsp;<span class="string" id="5229216">&#34;&amp;#43;&#34;</span><span class="op" id="5229223">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5229226">&#39;&lt;&#39;</span><span class="op" id="5229229">:</span>&nbsp;&nbsp;<span class="string" id="5229232">&#34;&amp;lt;&#34;</span><span class="op" id="5229238">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5229241">&#39;=&#39;</span><span class="op" id="5229244">:</span>&nbsp;&nbsp;<span class="string" id="5229247">&#34;&amp;#61;&#34;</span><span class="op" id="5229254">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5229257">&#39;&gt;&#39;</span><span class="op" id="5229260">:</span>&nbsp;&nbsp;<span class="string" id="5229263">&#34;&amp;gt;&#34;</span><span class="op" id="5229269">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5229272">//&nbsp;A&nbsp;parse&nbsp;error&nbsp;in&nbsp;the&nbsp;attribute&nbsp;value&nbsp;(unquoted)&nbsp;and</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5229328">//&nbsp;before&nbsp;attribute&nbsp;value&nbsp;states.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5229363">//&nbsp;Treated&nbsp;as&nbsp;a&nbsp;quoting&nbsp;character&nbsp;by&nbsp;IE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5229405">&#39;`&#39;</span><span class="op" id="5229408">:</span>&nbsp;<span class="string" id="5229410">&#34;&amp;#96;&#34;</span><span class="op" id="5229417">,</span><br>
<span class="lineno"></span><span class="op" id="5229419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="5229422">//&nbsp;htmlNospaceNormReplacementTable&nbsp;is&nbsp;like&nbsp;htmlNospaceReplacementTable&nbsp;but</span><br>
<span class="lineno"></span><span class="comment" id="5229497">//&nbsp;without&nbsp;&#39;&amp;&#39;&nbsp;to&nbsp;avoid&nbsp;over-encoding&nbsp;existing&nbsp;entities.</span><br>
<span class="lineno"></span><span class="keyword" id="5229554">var</span>&nbsp;<span class="ident" id="5229558">htmlNospaceNormReplacementTable</span>&nbsp;<span class="op" id="5229590">=</span>&nbsp;<span class="op" id="5229592">[</span><span class="op" id="5229593">]</span><span class="builtintype" id="5229594">string</span><span class="op" id="5229600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5229603">0</span><span class="op" id="5229604">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5229609">&#34;&amp;#xfffd;&#34;</span><span class="op" id="5229619">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5229622">&#39;\t&#39;</span><span class="op" id="5229626">:</span>&nbsp;<span class="string" id="5229628">&#34;&amp;#9;&#34;</span><span class="op" id="5229634">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5229637">&#39;\n&#39;</span><span class="op" id="5229641">:</span>&nbsp;<span class="string" id="5229643">&#34;&amp;#10;&#34;</span><span class="op" id="5229650">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5229653">&#39;\v&#39;</span><span class="op" id="5229657">:</span>&nbsp;<span class="string" id="5229659">&#34;&amp;#11;&#34;</span><span class="op" id="5229666">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5229669">&#39;\f&#39;</span><span class="op" id="5229673">:</span>&nbsp;<span class="string" id="5229675">&#34;&amp;#12;&#34;</span><span class="op" id="5229682">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5229685">&#39;\r&#39;</span><span class="op" id="5229689">:</span>&nbsp;<span class="string" id="5229691">&#34;&amp;#13;&#34;</span><span class="op" id="5229698">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5229701">&#39;&nbsp;&#39;</span><span class="op" id="5229704">:</span>&nbsp;&nbsp;<span class="string" id="5229707">&#34;&amp;#32;&#34;</span><span class="op" id="5229714">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5229717">&#39;&#34;&#39;</span><span class="op" id="5229720">:</span>&nbsp;&nbsp;<span class="string" id="5229723">&#34;&amp;#34;&#34;</span><span class="op" id="5229730">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5229733">&#39;\&#39;&#39;</span><span class="op" id="5229737">:</span>&nbsp;<span class="string" id="5229739">&#34;&amp;#39;&#34;</span><span class="op" id="5229746">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5229749">&#39;+&#39;</span><span class="op" id="5229752">:</span>&nbsp;&nbsp;<span class="string" id="5229755">&#34;&amp;#43;&#34;</span><span class="op" id="5229762">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5229765">&#39;&lt;&#39;</span><span class="op" id="5229768">:</span>&nbsp;&nbsp;<span class="string" id="5229771">&#34;&amp;lt;&#34;</span><span class="op" id="5229777">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5229780">&#39;=&#39;</span><span class="op" id="5229783">:</span>&nbsp;&nbsp;<span class="string" id="5229786">&#34;&amp;#61;&#34;</span><span class="op" id="5229793">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5229796">&#39;&gt;&#39;</span><span class="op" id="5229799">:</span>&nbsp;&nbsp;<span class="string" id="5229802">&#34;&amp;gt;&#34;</span><span class="op" id="5229808">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5229811">//&nbsp;A&nbsp;parse&nbsp;error&nbsp;in&nbsp;the&nbsp;attribute&nbsp;value&nbsp;(unquoted)&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5229867">//&nbsp;before&nbsp;attribute&nbsp;value&nbsp;states.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5229902">//&nbsp;Treated&nbsp;as&nbsp;a&nbsp;quoting&nbsp;character&nbsp;by&nbsp;IE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5229944">&#39;`&#39;</span><span class="op" id="5229947">:</span>&nbsp;<span class="string" id="5229949">&#34;&amp;#96;&#34;</span><span class="op" id="5229956">,</span><br>
<span class="lineno">135</span><span class="op" id="5229958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5229961">//&nbsp;htmlReplacer&nbsp;returns&nbsp;s&nbsp;with&nbsp;runes&nbsp;replaced&nbsp;according&nbsp;to&nbsp;replacementTable</span><br>
<span class="lineno"></span><span class="comment" id="5230037">//&nbsp;and&nbsp;when&nbsp;badRunes&nbsp;is&nbsp;true,&nbsp;certain&nbsp;bad&nbsp;runes&nbsp;are&nbsp;allowed&nbsp;through&nbsp;unescaped.</span><br>
<span class="lineno"></span><span class="keyword" id="5230116">func</span>&nbsp;<span class="ident" id="5230121">htmlReplacer</span><span class="op" id="5230133">(</span><span class="ident" id="5230134">s</span>&nbsp;<span class="builtintype" id="5230136">string</span><span class="op" id="5230142">,</span>&nbsp;<span class="ident" id="5230144">replacementTable</span>&nbsp;<span class="op" id="5230161">[</span><span class="op" id="5230162">]</span><span class="builtintype" id="5230163">string</span><span class="op" id="5230169">,</span>&nbsp;<span class="ident" id="5230171">badRunes</span>&nbsp;<span class="builtintype" id="5230180">bool</span><span class="op" id="5230184">)</span>&nbsp;<span class="builtintype" id="5230186">string</span>&nbsp;<span class="op" id="5230193">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230196">written</span><span class="op" id="5230203">,</span>&nbsp;<span class="ident" id="5230205">b</span>&nbsp;<span class="op" id="5230207">:=</span>&nbsp;<span class="num" id="5230210">0</span><span class="op" id="5230211">,</span>&nbsp;<span class="builtinfunc" id="5230213">new</span><span class="op" id="5230216">(</span><span class="ident" id="5230217">bytes</span><span class="op" id="5230222">.</span><span class="ident" id="5230223">Buffer</span><span class="op" id="5230229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5230232">for</span>&nbsp;<span class="ident" id="5230236">i</span><span class="op" id="5230237">,</span>&nbsp;<span class="ident" id="5230239">r</span>&nbsp;<span class="op" id="5230241">:=</span>&nbsp;<span class="keyword" id="5230244">range</span>&nbsp;<span class="ident" id="5230250">s</span>&nbsp;<span class="op" id="5230252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5230256">if</span>&nbsp;<span class="builtintype" id="5230259">int</span><span class="op" id="5230262">(</span><span class="ident" id="5230263">r</span><span class="op" id="5230264">)</span>&nbsp;<span class="op" id="5230266">&lt;</span>&nbsp;<span class="builtinfunc" id="5230268">len</span><span class="op" id="5230271">(</span><span class="ident" id="5230272">replacementTable</span><span class="op" id="5230288">)</span>&nbsp;<span class="op" id="5230290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5230295">if</span>&nbsp;<span class="ident" id="5230298">repl</span>&nbsp;<span class="op" id="5230303">:=</span>&nbsp;<span class="ident" id="5230306">replacementTable</span><span class="op" id="5230322">[</span><span class="ident" id="5230323">r</span><span class="op" id="5230324">]</span><span class="op" id="5230325">;</span>&nbsp;<span class="builtinfunc" id="5230327">len</span><span class="op" id="5230330">(</span><span class="ident" id="5230331">repl</span><span class="op" id="5230335">)</span>&nbsp;<span class="op" id="5230337">!=</span>&nbsp;<span class="num" id="5230340">0</span>&nbsp;<span class="op" id="5230342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230348">b</span><span class="op" id="5230349">.</span><span class="ident" id="5230350">WriteString</span><span class="op" id="5230361">(</span><span class="ident" id="5230362">s</span><span class="op" id="5230363">[</span><span class="ident" id="5230364">written</span><span class="op" id="5230371">:</span><span class="ident" id="5230372">i</span><span class="op" id="5230373">]</span><span class="op" id="5230374">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230380">b</span><span class="op" id="5230381">.</span><span class="ident" id="5230382">WriteString</span><span class="op" id="5230393">(</span><span class="ident" id="5230394">repl</span><span class="op" id="5230398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5230404">//&nbsp;Valid&nbsp;as&nbsp;long&nbsp;as&nbsp;replacementTable&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5230453">//&nbsp;include&nbsp;anything&nbsp;above&nbsp;0x7f.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230489">written</span>&nbsp;<span class="op" id="5230497">=</span>&nbsp;<span class="ident" id="5230499">i</span>&nbsp;<span class="op" id="5230501">+</span>&nbsp;<span class="ident" id="5230503">utf8</span><span class="op" id="5230507">.</span><span class="ident" id="5230508">RuneLen</span><span class="op" id="5230515">(</span><span class="ident" id="5230516">r</span><span class="op" id="5230517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5230522">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5230526">}</span>&nbsp;<span class="keyword" id="5230528">else</span>&nbsp;<span class="keyword" id="5230533">if</span>&nbsp;<span class="ident" id="5230536">badRunes</span>&nbsp;<span class="op" id="5230545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5230550">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5230563">//&nbsp;IE&nbsp;does&nbsp;not&nbsp;allow&nbsp;these&nbsp;ranges&nbsp;in&nbsp;unquoted&nbsp;attrs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5230618">}</span>&nbsp;<span class="keyword" id="5230620">else</span>&nbsp;<span class="keyword" id="5230625">if</span>&nbsp;<span class="num" id="5230628">0xfdd0</span>&nbsp;<span class="op" id="5230635">&lt;=</span>&nbsp;<span class="ident" id="5230638">r</span>&nbsp;<span class="op" id="5230640">&amp;&amp;</span>&nbsp;<span class="ident" id="5230643">r</span>&nbsp;<span class="op" id="5230645">&lt;=</span>&nbsp;<span class="num" id="5230648">0xfdef</span>&nbsp;<span class="op" id="5230655">||</span>&nbsp;<span class="num" id="5230658">0xfff0</span>&nbsp;<span class="op" id="5230665">&lt;=</span>&nbsp;<span class="ident" id="5230668">r</span>&nbsp;<span class="op" id="5230670">&amp;&amp;</span>&nbsp;<span class="ident" id="5230673">r</span>&nbsp;<span class="op" id="5230675">&lt;=</span>&nbsp;<span class="num" id="5230678">0xffff</span>&nbsp;<span class="op" id="5230685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230690">fmt</span><span class="op" id="5230693">.</span><span class="ident" id="5230694">Fprintf</span><span class="op" id="5230701">(</span><span class="ident" id="5230702">b</span><span class="op" id="5230703">,</span>&nbsp;<span class="string" id="5230705">&#34;%s&amp;#x%x;&#34;</span><span class="op" id="5230715">,</span>&nbsp;<span class="ident" id="5230717">s</span><span class="op" id="5230718">[</span><span class="ident" id="5230719">written</span><span class="op" id="5230726">:</span><span class="ident" id="5230727">i</span><span class="op" id="5230728">]</span><span class="op" id="5230729">,</span>&nbsp;<span class="ident" id="5230731">r</span><span class="op" id="5230732">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230737">written</span>&nbsp;<span class="op" id="5230745">=</span>&nbsp;<span class="ident" id="5230747">i</span>&nbsp;<span class="op" id="5230749">+</span>&nbsp;<span class="ident" id="5230751">utf8</span><span class="op" id="5230755">.</span><span class="ident" id="5230756">RuneLen</span><span class="op" id="5230763">(</span><span class="ident" id="5230764">r</span><span class="op" id="5230765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5230769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5230772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5230775">if</span>&nbsp;<span class="ident" id="5230778">written</span>&nbsp;<span class="op" id="5230786">==</span>&nbsp;<span class="num" id="5230789">0</span>&nbsp;<span class="op" id="5230791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5230795">return</span>&nbsp;<span class="ident" id="5230802">s</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5230805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230808">b</span><span class="op" id="5230809">.</span><span class="ident" id="5230810">WriteString</span><span class="op" id="5230821">(</span><span class="ident" id="5230822">s</span><span class="op" id="5230823">[</span><span class="ident" id="5230824">written</span><span class="op" id="5230831">:</span><span class="op" id="5230832">]</span><span class="op" id="5230833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5230836">return</span>&nbsp;<span class="ident" id="5230843">b</span><span class="op" id="5230844">.</span><span class="ident" id="5230845">String</span><span class="op" id="5230851">(</span><span class="op" id="5230852">)</span><br>
<span class="lineno"></span><span class="op" id="5230854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="5230857">//&nbsp;stripTags&nbsp;takes&nbsp;a&nbsp;snippet&nbsp;of&nbsp;HTML&nbsp;and&nbsp;returns&nbsp;only&nbsp;the&nbsp;text&nbsp;content.</span><br>
<span class="lineno"></span><span class="comment" id="5230929">//&nbsp;For&nbsp;example,&nbsp;`&lt;b&gt;&amp;iexcl;Hi!&lt;/b&gt;&nbsp;&lt;script&gt;...&lt;/script&gt;`&nbsp;-&gt;&nbsp;`&amp;iexcl;Hi!&nbsp;`.</span><br>
<span class="lineno"></span><span class="keyword" id="5231004">func</span>&nbsp;<span class="ident" id="5231009">stripTags</span><span class="op" id="5231018">(</span><span class="ident" id="5231019">html</span>&nbsp;<span class="builtintype" id="5231024">string</span><span class="op" id="5231030">)</span>&nbsp;<span class="builtintype" id="5231032">string</span>&nbsp;<span class="op" id="5231039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231042">var</span>&nbsp;<span class="ident" id="5231046">b</span>&nbsp;<span class="ident" id="5231048">bytes</span><span class="op" id="5231053">.</span><span class="ident" id="5231054">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231062">s</span><span class="op" id="5231063">,</span>&nbsp;<span class="ident" id="5231065">c</span><span class="op" id="5231066">,</span>&nbsp;<span class="ident" id="5231068">i</span><span class="op" id="5231069">,</span>&nbsp;<span class="ident" id="5231071">allText</span>&nbsp;<span class="op" id="5231079">:=</span>&nbsp;<span class="op" id="5231082">[</span><span class="op" id="5231083">]</span><span class="builtintype" id="5231084">byte</span><span class="op" id="5231088">(</span><span class="ident" id="5231089">html</span><span class="op" id="5231093">)</span><span class="op" id="5231094">,</span>&nbsp;<span class="ident" id="5231096">context</span><span class="op" id="5231103">{</span><span class="op" id="5231104">}</span><span class="op" id="5231105">,</span>&nbsp;<span class="num" id="5231107">0</span><span class="op" id="5231108">,</span>&nbsp;<span class="builtintype" id="5231110">true</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5231116">//&nbsp;Using&nbsp;the&nbsp;transition&nbsp;funcs&nbsp;helps&nbsp;us&nbsp;avoid&nbsp;mangling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5231171">//&nbsp;`&lt;div&nbsp;title=&#34;1&gt;2&#34;&gt;`&nbsp;or&nbsp;`I&nbsp;&lt;3&nbsp;Ponies!`.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231214">for</span>&nbsp;<span class="ident" id="5231218">i</span>&nbsp;<span class="op" id="5231220">!=</span>&nbsp;<span class="builtinfunc" id="5231223">len</span><span class="op" id="5231226">(</span><span class="ident" id="5231227">s</span><span class="op" id="5231228">)</span>&nbsp;<span class="op" id="5231230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231234">if</span>&nbsp;<span class="ident" id="5231237">c</span><span class="op" id="5231238">.</span><span class="ident" id="5231239">delim</span>&nbsp;<span class="op" id="5231245">==</span>&nbsp;<span class="ident" id="5231248">delimNone</span>&nbsp;<span class="op" id="5231258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231263">st</span>&nbsp;<span class="op" id="5231266">:=</span>&nbsp;<span class="ident" id="5231269">c</span><span class="op" id="5231270">.</span><span class="ident" id="5231271">state</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5231280">//&nbsp;Use&nbsp;RCDATA&nbsp;instead&nbsp;of&nbsp;parsing&nbsp;into&nbsp;JS&nbsp;or&nbsp;CSS&nbsp;styles.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231339">if</span>&nbsp;<span class="ident" id="5231342">c</span><span class="op" id="5231343">.</span><span class="ident" id="5231344">element</span>&nbsp;<span class="op" id="5231352">!=</span>&nbsp;<span class="ident" id="5231355">elementNone</span>&nbsp;<span class="op" id="5231367">&amp;&amp;</span>&nbsp;<span class="op" id="5231370">!</span><span class="ident" id="5231371">isInTag</span><span class="op" id="5231378">(</span><span class="ident" id="5231379">st</span><span class="op" id="5231381">)</span>&nbsp;<span class="op" id="5231383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231389">st</span>&nbsp;<span class="op" id="5231392">=</span>&nbsp;<span class="ident" id="5231394">stateRCDATA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5231409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231414">d</span><span class="op" id="5231415">,</span>&nbsp;<span class="ident" id="5231417">nread</span>&nbsp;<span class="op" id="5231423">:=</span>&nbsp;<span class="ident" id="5231426">transitionFunc</span><span class="op" id="5231440">[</span><span class="ident" id="5231441">st</span><span class="op" id="5231443">]</span><span class="op" id="5231444">(</span><span class="ident" id="5231445">c</span><span class="op" id="5231446">,</span>&nbsp;<span class="ident" id="5231448">s</span><span class="op" id="5231449">[</span><span class="ident" id="5231450">i</span><span class="op" id="5231451">:</span><span class="op" id="5231452">]</span><span class="op" id="5231453">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231458">i1</span>&nbsp;<span class="op" id="5231461">:=</span>&nbsp;<span class="ident" id="5231464">i</span>&nbsp;<span class="op" id="5231466">+</span>&nbsp;<span class="ident" id="5231468">nread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231477">if</span>&nbsp;<span class="ident" id="5231480">c</span><span class="op" id="5231481">.</span><span class="ident" id="5231482">state</span>&nbsp;<span class="op" id="5231488">==</span>&nbsp;<span class="ident" id="5231491">stateText</span>&nbsp;<span class="op" id="5231501">||</span>&nbsp;<span class="ident" id="5231504">c</span><span class="op" id="5231505">.</span><span class="ident" id="5231506">state</span>&nbsp;<span class="op" id="5231512">==</span>&nbsp;<span class="ident" id="5231515">stateRCDATA</span>&nbsp;<span class="op" id="5231527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5231533">//&nbsp;Emit&nbsp;text&nbsp;up&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;tag&nbsp;or&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231589">j</span>&nbsp;<span class="op" id="5231591">:=</span>&nbsp;<span class="ident" id="5231594">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231601">if</span>&nbsp;<span class="ident" id="5231604">d</span><span class="op" id="5231605">.</span><span class="ident" id="5231606">state</span>&nbsp;<span class="op" id="5231612">!=</span>&nbsp;<span class="ident" id="5231615">c</span><span class="op" id="5231616">.</span><span class="ident" id="5231617">state</span>&nbsp;<span class="op" id="5231623">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231630">for</span>&nbsp;<span class="ident" id="5231634">j1</span>&nbsp;<span class="op" id="5231637">:=</span>&nbsp;<span class="ident" id="5231640">j</span>&nbsp;<span class="op" id="5231642">-</span>&nbsp;<span class="num" id="5231644">1</span><span class="op" id="5231645">;</span>&nbsp;<span class="ident" id="5231647">j1</span>&nbsp;<span class="op" id="5231650">&gt;=</span>&nbsp;<span class="ident" id="5231653">i</span><span class="op" id="5231654">;</span>&nbsp;<span class="ident" id="5231656">j1</span><span class="op" id="5231658">--</span>&nbsp;<span class="op" id="5231661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231669">if</span>&nbsp;<span class="ident" id="5231672">s</span><span class="op" id="5231673">[</span><span class="ident" id="5231674">j1</span><span class="op" id="5231676">]</span>&nbsp;<span class="op" id="5231678">==</span>&nbsp;<span class="string" id="5231681">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="5231685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231694">j</span>&nbsp;<span class="op" id="5231696">=</span>&nbsp;<span class="ident" id="5231698">j1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231708">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5231720">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5231727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5231733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231739">b</span><span class="op" id="5231740">.</span><span class="ident" id="5231741">Write</span><span class="op" id="5231746">(</span><span class="ident" id="5231747">s</span><span class="op" id="5231748">[</span><span class="ident" id="5231749">i</span><span class="op" id="5231750">:</span><span class="ident" id="5231751">j</span><span class="op" id="5231752">]</span><span class="op" id="5231753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5231758">}</span>&nbsp;<span class="keyword" id="5231760">else</span>&nbsp;<span class="op" id="5231765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231771">allText</span>&nbsp;<span class="op" id="5231779">=</span>&nbsp;<span class="builtintype" id="5231781">false</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5231790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231795">c</span><span class="op" id="5231796">,</span>&nbsp;<span class="ident" id="5231798">i</span>&nbsp;<span class="op" id="5231800">=</span>&nbsp;<span class="ident" id="5231802">d</span><span class="op" id="5231803">,</span>&nbsp;<span class="ident" id="5231805">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231811">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5231822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231826">i1</span>&nbsp;<span class="op" id="5231829">:=</span>&nbsp;<span class="ident" id="5231832">i</span>&nbsp;<span class="op" id="5231834">+</span>&nbsp;<span class="ident" id="5231836">bytes</span><span class="op" id="5231841">.</span><span class="ident" id="5231842">IndexAny</span><span class="op" id="5231850">(</span><span class="ident" id="5231851">s</span><span class="op" id="5231852">[</span><span class="ident" id="5231853">i</span><span class="op" id="5231854">:</span><span class="op" id="5231855">]</span><span class="op" id="5231856">,</span>&nbsp;<span class="ident" id="5231858">delimEnds</span><span class="op" id="5231867">[</span><span class="ident" id="5231868">c</span><span class="op" id="5231869">.</span><span class="ident" id="5231870">delim</span><span class="op" id="5231875">]</span><span class="op" id="5231876">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231880">if</span>&nbsp;<span class="ident" id="5231883">i1</span>&nbsp;<span class="op" id="5231886">&lt;</span>&nbsp;<span class="ident" id="5231888">i</span>&nbsp;<span class="op" id="5231890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231895">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5231903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231907">if</span>&nbsp;<span class="ident" id="5231910">c</span><span class="op" id="5231911">.</span><span class="ident" id="5231912">delim</span>&nbsp;<span class="op" id="5231918">!=</span>&nbsp;<span class="ident" id="5231921">delimSpaceOrTagEnd</span>&nbsp;<span class="op" id="5231940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5231945">//&nbsp;Consume&nbsp;any&nbsp;quote.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231970">i1</span><span class="op" id="5231972">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5231977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231981">c</span><span class="op" id="5231982">,</span>&nbsp;<span class="ident" id="5231984">i</span>&nbsp;<span class="op" id="5231986">=</span>&nbsp;<span class="ident" id="5231988">context</span><span class="op" id="5231995">{</span><span class="ident" id="5231996">state</span><span class="op" id="5232001">:</span>&nbsp;<span class="ident" id="5232003">stateTag</span><span class="op" id="5232011">,</span>&nbsp;<span class="ident" id="5232013">element</span><span class="op" id="5232020">:</span>&nbsp;<span class="ident" id="5232022">c</span><span class="op" id="5232023">.</span><span class="ident" id="5232024">element</span><span class="op" id="5232031">}</span><span class="op" id="5232032">,</span>&nbsp;<span class="ident" id="5232034">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5232038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232041">if</span>&nbsp;<span class="ident" id="5232044">allText</span>&nbsp;<span class="op" id="5232052">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232056">return</span>&nbsp;<span class="ident" id="5232063">html</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5232069">}</span>&nbsp;<span class="keyword" id="5232071">else</span>&nbsp;<span class="keyword" id="5232076">if</span>&nbsp;<span class="ident" id="5232079">c</span><span class="op" id="5232080">.</span><span class="ident" id="5232081">state</span>&nbsp;<span class="op" id="5232087">==</span>&nbsp;<span class="ident" id="5232090">stateText</span>&nbsp;<span class="op" id="5232100">||</span>&nbsp;<span class="ident" id="5232103">c</span><span class="op" id="5232104">.</span><span class="ident" id="5232105">state</span>&nbsp;<span class="op" id="5232111">==</span>&nbsp;<span class="ident" id="5232114">stateRCDATA</span>&nbsp;<span class="op" id="5232126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5232130">b</span><span class="op" id="5232131">.</span><span class="ident" id="5232132">Write</span><span class="op" id="5232137">(</span><span class="ident" id="5232138">s</span><span class="op" id="5232139">[</span><span class="ident" id="5232140">i</span><span class="op" id="5232141">:</span><span class="op" id="5232142">]</span><span class="op" id="5232143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5232146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232149">return</span>&nbsp;<span class="ident" id="5232156">b</span><span class="op" id="5232157">.</span><span class="ident" id="5232158">String</span><span class="op" id="5232164">(</span><span class="op" id="5232165">)</span><br>
<span class="lineno">215</span><span class="op" id="5232167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5232170">//&nbsp;htmlNameFilter&nbsp;accepts&nbsp;valid&nbsp;parts&nbsp;of&nbsp;an&nbsp;HTML&nbsp;attribute&nbsp;or&nbsp;tag&nbsp;name&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="5232244">//&nbsp;a&nbsp;known-safe&nbsp;HTML&nbsp;attribute.</span><br>
<span class="lineno"></span><span class="keyword" id="5232276">func</span>&nbsp;<span class="ident" id="5232281">htmlNameFilter</span><span class="op" id="5232295">(</span><span class="ident" id="5232296">args</span>&nbsp;<span class="op" id="5232301">...</span><span class="keyword" id="5232304">interface</span><span class="op" id="5232313">{</span><span class="op" id="5232314">}</span><span class="op" id="5232315">)</span>&nbsp;<span class="builtintype" id="5232317">string</span>&nbsp;<span class="op" id="5232324">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5232327">s</span><span class="op" id="5232328">,</span>&nbsp;<span class="ident" id="5232330">t</span>&nbsp;<span class="op" id="5232332">:=</span>&nbsp;<span class="ident" id="5232335">stringify</span><span class="op" id="5232344">(</span><span class="ident" id="5232345">args</span><span class="op" id="5232349">...</span><span class="op" id="5232352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232355">if</span>&nbsp;<span class="ident" id="5232358">t</span>&nbsp;<span class="op" id="5232360">==</span>&nbsp;<span class="ident" id="5232363">contentTypeHTMLAttr</span>&nbsp;<span class="op" id="5232383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232387">return</span>&nbsp;<span class="ident" id="5232394">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5232397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232400">if</span>&nbsp;<span class="builtinfunc" id="5232403">len</span><span class="op" id="5232406">(</span><span class="ident" id="5232407">s</span><span class="op" id="5232408">)</span>&nbsp;<span class="op" id="5232410">==</span>&nbsp;<span class="num" id="5232413">0</span>&nbsp;<span class="op" id="5232415">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5232419">//&nbsp;Avoid&nbsp;violation&nbsp;of&nbsp;structure&nbsp;preservation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5232467">//&nbsp;&lt;input&nbsp;checked&nbsp;{{.K}}={{.V}}&gt;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5232503">//&nbsp;Without&nbsp;this,&nbsp;if&nbsp;.K&nbsp;is&nbsp;empty&nbsp;then&nbsp;.V&nbsp;is&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5232561">//&nbsp;checked,&nbsp;but&nbsp;otherwise&nbsp;.V&nbsp;is&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;attribute</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5232622">//&nbsp;named&nbsp;.K.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232637">return</span>&nbsp;<span class="ident" id="5232644">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5232660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5232663">s</span>&nbsp;<span class="op" id="5232665">=</span>&nbsp;<span class="ident" id="5232667">strings</span><span class="op" id="5232674">.</span><span class="ident" id="5232675">ToLower</span><span class="op" id="5232682">(</span><span class="ident" id="5232683">s</span><span class="op" id="5232684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232687">if</span>&nbsp;<span class="ident" id="5232690">t</span>&nbsp;<span class="op" id="5232692">:=</span>&nbsp;<span class="ident" id="5232695">attrType</span><span class="op" id="5232703">(</span><span class="ident" id="5232704">s</span><span class="op" id="5232705">)</span><span class="op" id="5232706">;</span>&nbsp;<span class="ident" id="5232708">t</span>&nbsp;<span class="op" id="5232710">!=</span>&nbsp;<span class="ident" id="5232713">contentTypePlain</span>&nbsp;<span class="op" id="5232730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5232734">//&nbsp;TODO:&nbsp;Split&nbsp;attr&nbsp;and&nbsp;element&nbsp;name&nbsp;part&nbsp;filters&nbsp;so&nbsp;we&nbsp;can&nbsp;whitelist</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5232806">//&nbsp;attributes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232823">return</span>&nbsp;<span class="ident" id="5232830">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5232846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232849">for</span>&nbsp;<span class="ident" id="5232853">_</span><span class="op" id="5232854">,</span>&nbsp;<span class="ident" id="5232856">r</span>&nbsp;<span class="op" id="5232858">:=</span>&nbsp;<span class="keyword" id="5232861">range</span>&nbsp;<span class="ident" id="5232867">s</span>&nbsp;<span class="op" id="5232869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232873">switch</span>&nbsp;<span class="op" id="5232880">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232884">case</span>&nbsp;<span class="string" id="5232889">&#39;0&#39;</span>&nbsp;<span class="op" id="5232893">&lt;=</span>&nbsp;<span class="ident" id="5232896">r</span>&nbsp;<span class="op" id="5232898">&amp;&amp;</span>&nbsp;<span class="ident" id="5232901">r</span>&nbsp;<span class="op" id="5232903">&lt;=</span>&nbsp;<span class="string" id="5232906">&#39;9&#39;</span><span class="op" id="5232909">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232913">case</span>&nbsp;<span class="string" id="5232918">&#39;a&#39;</span>&nbsp;<span class="op" id="5232922">&lt;=</span>&nbsp;<span class="ident" id="5232925">r</span>&nbsp;<span class="op" id="5232927">&amp;&amp;</span>&nbsp;<span class="ident" id="5232930">r</span>&nbsp;<span class="op" id="5232932">&lt;=</span>&nbsp;<span class="string" id="5232935">&#39;z&#39;</span><span class="op" id="5232938">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232942">default</span><span class="op" id="5232949">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232954">return</span>&nbsp;<span class="ident" id="5232961">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5232978">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5232981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232984">return</span>&nbsp;<span class="ident" id="5232991">s</span><br>
<span class="lineno"></span><span class="op" id="5232993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5232996">//&nbsp;commentEscaper&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string&nbsp;regardless&nbsp;of&nbsp;input.</span><br>
<span class="lineno">250</span><span class="comment" id="5233060">//&nbsp;Comment&nbsp;content&nbsp;does&nbsp;not&nbsp;correspond&nbsp;to&nbsp;any&nbsp;parsed&nbsp;structure&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="5233126">//&nbsp;human-readable&nbsp;content,&nbsp;so&nbsp;the&nbsp;simplest&nbsp;and&nbsp;most&nbsp;secure&nbsp;policy&nbsp;is&nbsp;to&nbsp;drop</span><br>
<span class="lineno"></span><span class="comment" id="5233203">//&nbsp;content&nbsp;interpolated&nbsp;into&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="5233242">//&nbsp;This&nbsp;approach&nbsp;is&nbsp;equally&nbsp;valid&nbsp;whether&nbsp;or&nbsp;not&nbsp;static&nbsp;comment&nbsp;content&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5233317">//&nbsp;removed&nbsp;from&nbsp;the&nbsp;template.</span><br>
<span class="lineno">255</span><span class="keyword" id="5233347">func</span>&nbsp;<span class="ident" id="5233352">commentEscaper</span><span class="op" id="5233366">(</span><span class="ident" id="5233367">args</span>&nbsp;<span class="op" id="5233372">...</span><span class="keyword" id="5233375">interface</span><span class="op" id="5233384">{</span><span class="op" id="5233385">}</span><span class="op" id="5233386">)</span>&nbsp;<span class="builtintype" id="5233388">string</span>&nbsp;<span class="op" id="5233395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5233398">return</span>&nbsp;<span class="string" id="5233405">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="5233408">}</span>
</div>
</body>
</html>
