<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5044098">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5044153">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5044207">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5044258">package</span>&nbsp;<span class="ident" id="5044266">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5044273">import</span>&nbsp;<span class="op" id="5044280">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5044283">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5044290">&#34;sort&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5044298">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5044305">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5044308">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5044389">//&nbsp;Positions</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="5044403">//&nbsp;Position&nbsp;describes&nbsp;an&nbsp;arbitrary&nbsp;source&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="5044454">//&nbsp;including&nbsp;the&nbsp;file,&nbsp;line,&nbsp;and&nbsp;column&nbsp;location.</span><br>
<span class="lineno"></span><span class="comment" id="5044504">//&nbsp;A&nbsp;Position&nbsp;is&nbsp;valid&nbsp;if&nbsp;the&nbsp;line&nbsp;number&nbsp;is&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="5044554">//</span><br>
<span class="lineno">20</span><span class="keyword" id="5044557">type</span>&nbsp;<span class="ident" id="5044562">Position</span>&nbsp;<span class="keyword" id="5044571">struct</span>&nbsp;<span class="op" id="5044578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5044581">Filename</span>&nbsp;<span class="builtintype" id="5044590">string</span>&nbsp;<span class="comment" id="5044597">//&nbsp;filename,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5044618">Offset</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5044627">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5044634">//&nbsp;offset,&nbsp;starting&nbsp;at&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5044660">Line</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5044669">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5044676">//&nbsp;line&nbsp;number,&nbsp;starting&nbsp;at&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5044707">Column</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5044716">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5044723">//&nbsp;column&nbsp;number,&nbsp;starting&nbsp;at&nbsp;1&nbsp;(character&nbsp;count)</span><br>
<span class="lineno">25</span><span class="op" id="5044773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5044776">//&nbsp;IsValid&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;position&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="5044826">func</span>&nbsp;<span class="op" id="5044831">(</span><span class="ident" id="5044832">pos</span>&nbsp;<span class="op" id="5044836">*</span><span class="ident" id="5044837">Position</span><span class="op" id="5044845">)</span>&nbsp;<span class="ident" id="5044847">IsValid</span><span class="op" id="5044854">(</span><span class="op" id="5044855">)</span>&nbsp;<span class="builtintype" id="5044857">bool</span>&nbsp;<span class="op" id="5044862">{</span>&nbsp;<span class="keyword" id="5044864">return</span>&nbsp;<span class="ident" id="5044871">pos</span><span class="op" id="5044874">.</span><span class="ident" id="5044875">Line</span>&nbsp;<span class="op" id="5044880">&gt;</span>&nbsp;<span class="num" id="5044882">0</span>&nbsp;<span class="op" id="5044884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="5044887">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;string&nbsp;in&nbsp;one&nbsp;of&nbsp;several&nbsp;forms:</span><br>
<span class="lineno"></span><span class="comment" id="5044939">//</span><br>
<span class="lineno"></span><span class="comment" id="5044942">//&nbsp;&nbsp;&nbsp;&nbspfile:line:column&nbsp;&nbsp;&nbsp;&nbsp;valid&nbsp;position&nbsp;with&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="5044995">//&nbsp;&nbsp;&nbsp;&nbspline:column&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;valid&nbsp;position&nbsp;without&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="5045051">//&nbsp;&nbsp;&nbsp;&nbspfile&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid&nbsp;position&nbsp;with&nbsp;file&nbsp;name</span><br>
<span class="lineno">35</span><span class="comment" id="5045106">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid&nbsp;position&nbsp;without&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="5045164">//</span><br>
<span class="lineno"></span><span class="keyword" id="5045167">func</span>&nbsp;<span class="op" id="5045172">(</span><span class="ident" id="5045173">pos</span>&nbsp;<span class="ident" id="5045177">Position</span><span class="op" id="5045185">)</span>&nbsp;<span class="ident" id="5045187">String</span><span class="op" id="5045193">(</span><span class="op" id="5045194">)</span>&nbsp;<span class="builtintype" id="5045196">string</span>&nbsp;<span class="op" id="5045203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045206">s</span>&nbsp;<span class="op" id="5045208">:=</span>&nbsp;<span class="ident" id="5045211">pos</span><span class="op" id="5045214">.</span><span class="ident" id="5045215">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5045225">if</span>&nbsp;<span class="ident" id="5045228">pos</span><span class="op" id="5045231">.</span><span class="ident" id="5045232">IsValid</span><span class="op" id="5045239">(</span><span class="op" id="5045240">)</span>&nbsp;<span class="op" id="5045242">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5045246">if</span>&nbsp;<span class="ident" id="5045249">s</span>&nbsp;<span class="op" id="5045251">!=</span>&nbsp;<span class="string" id="5045254">&#34;&#34;</span>&nbsp;<span class="op" id="5045257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045262">s</span>&nbsp;<span class="op" id="5045264">+=</span>&nbsp;<span class="string" id="5045267">&#34;:&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5045273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045277">s</span>&nbsp;<span class="op" id="5045279">+=</span>&nbsp;<span class="ident" id="5045282">fmt</span><span class="op" id="5045285">.</span><span class="ident" id="5045286">Sprintf</span><span class="op" id="5045293">(</span><span class="string" id="5045294">&#34;%d:%d&#34;</span><span class="op" id="5045301">,</span>&nbsp;<span class="ident" id="5045303">pos</span><span class="op" id="5045306">.</span><span class="ident" id="5045307">Line</span><span class="op" id="5045311">,</span>&nbsp;<span class="ident" id="5045313">pos</span><span class="op" id="5045316">.</span><span class="ident" id="5045317">Column</span><span class="op" id="5045323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5045326">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5045329">if</span>&nbsp;<span class="ident" id="5045332">s</span>&nbsp;<span class="op" id="5045334">==</span>&nbsp;<span class="string" id="5045337">&#34;&#34;</span>&nbsp;<span class="op" id="5045340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045344">s</span>&nbsp;<span class="op" id="5045346">=</span>&nbsp;<span class="string" id="5045348">&#34;-&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5045353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5045356">return</span>&nbsp;<span class="ident" id="5045363">s</span><br>
<span class="lineno"></span><span class="op" id="5045365">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="5045368">//&nbsp;Pos&nbsp;is&nbsp;a&nbsp;compact&nbsp;encoding&nbsp;of&nbsp;a&nbsp;source&nbsp;position&nbsp;within&nbsp;a&nbsp;file&nbsp;set.</span><br>
<span class="lineno"></span><span class="comment" id="5045437">//&nbsp;It&nbsp;can&nbsp;be&nbsp;converted&nbsp;into&nbsp;a&nbsp;Position&nbsp;for&nbsp;a&nbsp;more&nbsp;convenient,&nbsp;but&nbsp;much</span><br>
<span class="lineno"></span><span class="comment" id="5045508">//&nbsp;larger,&nbsp;representation.</span><br>
<span class="lineno"></span><span class="comment" id="5045535">//</span><br>
<span class="lineno">55</span><span class="comment" id="5045538">//&nbsp;The&nbsp;Pos&nbsp;value&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;is&nbsp;a&nbsp;number&nbsp;in&nbsp;the&nbsp;range&nbsp;[base,&nbsp;base+size],</span><br>
<span class="lineno"></span><span class="comment" id="5045616">//&nbsp;where&nbsp;base&nbsp;and&nbsp;size&nbsp;are&nbsp;specified&nbsp;when&nbsp;adding&nbsp;the&nbsp;file&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;via</span><br>
<span class="lineno"></span><span class="comment" id="5045694">//&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="comment" id="5045706">//</span><br>
<span class="lineno"></span><span class="comment" id="5045709">//&nbsp;To&nbsp;create&nbsp;the&nbsp;Pos&nbsp;value&nbsp;for&nbsp;a&nbsp;specific&nbsp;source&nbsp;offset,&nbsp;first&nbsp;add</span><br>
<span class="lineno">60</span><span class="comment" id="5045776">//&nbsp;the&nbsp;respective&nbsp;file&nbsp;to&nbsp;the&nbsp;current&nbsp;file&nbsp;set&nbsp;(via&nbsp;FileSet.AddFile)</span><br>
<span class="lineno"></span><span class="comment" id="5045845">//&nbsp;and&nbsp;then&nbsp;call&nbsp;File.Pos(offset)&nbsp;for&nbsp;that&nbsp;file.&nbsp;Given&nbsp;a&nbsp;Pos&nbsp;value&nbsp;p</span><br>
<span class="lineno"></span><span class="comment" id="5045914">//&nbsp;for&nbsp;a&nbsp;specific&nbsp;file&nbsp;set&nbsp;fset,&nbsp;the&nbsp;corresponding&nbsp;Position&nbsp;value&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5045983">//&nbsp;obtained&nbsp;by&nbsp;calling&nbsp;fset.Position(p).</span><br>
<span class="lineno"></span><span class="comment" id="5046024">//</span><br>
<span class="lineno">65</span><span class="comment" id="5046027">//&nbsp;Pos&nbsp;values&nbsp;can&nbsp;be&nbsp;compared&nbsp;directly&nbsp;with&nbsp;the&nbsp;usual&nbsp;comparison&nbsp;operators:</span><br>
<span class="lineno"></span><span class="comment" id="5046103">//&nbsp;If&nbsp;two&nbsp;Pos&nbsp;values&nbsp;p&nbsp;and&nbsp;q&nbsp;are&nbsp;in&nbsp;the&nbsp;same&nbsp;file,&nbsp;comparing&nbsp;p&nbsp;and&nbsp;q&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5046175">//&nbsp;equivalent&nbsp;to&nbsp;comparing&nbsp;the&nbsp;respective&nbsp;source&nbsp;file&nbsp;offsets.&nbsp;If&nbsp;p&nbsp;and&nbsp;q</span><br>
<span class="lineno"></span><span class="comment" id="5046249">//&nbsp;are&nbsp;in&nbsp;different&nbsp;files,&nbsp;p&nbsp;&lt;&nbsp;q&nbsp;is&nbsp;true&nbsp;if&nbsp;the&nbsp;file&nbsp;implied&nbsp;by&nbsp;p&nbsp;was&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="5046325">//&nbsp;to&nbsp;the&nbsp;respective&nbsp;file&nbsp;set&nbsp;before&nbsp;the&nbsp;file&nbsp;implied&nbsp;by&nbsp;q.</span><br>
<span class="lineno">70</span><span class="comment" id="5046385">//</span><br>
<span class="lineno"></span><span class="keyword" id="5046388">type</span>&nbsp;<span class="ident" id="5046393">Pos</span>&nbsp;<span class="builtintype" id="5046397">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5046402">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;Pos&nbsp;is&nbsp;NoPos;&nbsp;there&nbsp;is&nbsp;no&nbsp;file&nbsp;and&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="5046476">//&nbsp;associated&nbsp;with&nbsp;it,&nbsp;and&nbsp;NoPos().IsValid()&nbsp;is&nbsp;false.&nbsp;NoPos&nbsp;is&nbsp;always</span><br>
<span class="lineno">75</span><span class="comment" id="5046547">//&nbsp;smaller&nbsp;than&nbsp;any&nbsp;other&nbsp;Pos&nbsp;value.&nbsp;The&nbsp;corresponding&nbsp;Position&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="5046617">//&nbsp;for&nbsp;NoPos&nbsp;is&nbsp;the&nbsp;zero&nbsp;value&nbsp;for&nbsp;Position.</span><br>
<span class="lineno"></span><span class="comment" id="5046662">//</span><br>
<span class="lineno"></span><span class="keyword" id="5046665">const</span>&nbsp;<span class="ident" id="5046671">NoPos</span>&nbsp;<span class="ident" id="5046677">Pos</span>&nbsp;<span class="op" id="5046681">=</span>&nbsp;<span class="num" id="5046683">0</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="5046686">//&nbsp;IsValid&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;position&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="5046736">func</span>&nbsp;<span class="op" id="5046741">(</span><span class="ident" id="5046742">p</span>&nbsp;<span class="ident" id="5046744">Pos</span><span class="op" id="5046747">)</span>&nbsp;<span class="ident" id="5046749">IsValid</span><span class="op" id="5046756">(</span><span class="op" id="5046757">)</span>&nbsp;<span class="builtintype" id="5046759">bool</span>&nbsp;<span class="op" id="5046764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5046767">return</span>&nbsp;<span class="ident" id="5046774">p</span>&nbsp;<span class="op" id="5046776">!=</span>&nbsp;<span class="ident" id="5046779">NoPos</span><br>
<span class="lineno"></span><span class="op" id="5046785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="5046788">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5046869">//&nbsp;File</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5046878">//&nbsp;A&nbsp;File&nbsp;is&nbsp;a&nbsp;handle&nbsp;for&nbsp;a&nbsp;file&nbsp;belonging&nbsp;to&nbsp;a&nbsp;FileSet.</span><br>
<span class="lineno"></span><span class="comment" id="5046935">//&nbsp;A&nbsp;File&nbsp;has&nbsp;a&nbsp;name,&nbsp;size,&nbsp;and&nbsp;line&nbsp;offset&nbsp;table.</span><br>
<span class="lineno">90</span><span class="comment" id="5046986">//</span><br>
<span class="lineno"></span><span class="keyword" id="5046989">type</span>&nbsp;<span class="ident" id="5046994">File</span>&nbsp;<span class="keyword" id="5046999">struct</span>&nbsp;<span class="op" id="5047006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047009">set</span>&nbsp;&nbsp;<span class="op" id="5047014">*</span><span class="ident" id="5047015">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047024">name</span>&nbsp;<span class="builtintype" id="5047029">string</span>&nbsp;<span class="comment" id="5047036">//&nbsp;file&nbsp;name&nbsp;as&nbsp;provided&nbsp;to&nbsp;AddFile</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047073">base</span>&nbsp;<span class="builtintype" id="5047078">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5047085">//&nbsp;Pos&nbsp;value&nbsp;range&nbsp;for&nbsp;this&nbsp;file&nbsp;is&nbsp;[base...base+size]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047141">size</span>&nbsp;<span class="builtintype" id="5047146">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5047153">//&nbsp;file&nbsp;size&nbsp;as&nbsp;provided&nbsp;to&nbsp;AddFile</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5047191">//&nbsp;lines&nbsp;and&nbsp;infos&nbsp;are&nbsp;protected&nbsp;by&nbsp;set.mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047238">lines</span>&nbsp;<span class="op" id="5047244">[</span><span class="op" id="5047245">]</span><span class="builtintype" id="5047246">int</span>&nbsp;<span class="comment" id="5047250">//&nbsp;lines&nbsp;contains&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;first&nbsp;character&nbsp;for&nbsp;each&nbsp;line&nbsp;(the&nbsp;first&nbsp;entry&nbsp;is&nbsp;always&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047347">infos</span>&nbsp;<span class="op" id="5047353">[</span><span class="op" id="5047354">]</span><span class="ident" id="5047355">lineInfo</span><br>
<span class="lineno">100</span><span class="op" id="5047364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5047367">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;file&nbsp;name&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="5047435">func</span>&nbsp;<span class="op" id="5047440">(</span><span class="ident" id="5047441">f</span>&nbsp;<span class="op" id="5047443">*</span><span class="ident" id="5047444">File</span><span class="op" id="5047448">)</span>&nbsp;<span class="ident" id="5047450">Name</span><span class="op" id="5047454">(</span><span class="op" id="5047455">)</span>&nbsp;<span class="builtintype" id="5047457">string</span>&nbsp;<span class="op" id="5047464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5047467">return</span>&nbsp;<span class="ident" id="5047474">f</span><span class="op" id="5047475">.</span><span class="ident" id="5047476">name</span><br>
<span class="lineno">105</span><span class="op" id="5047481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5047484">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;base&nbsp;offset&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="5047554">func</span>&nbsp;<span class="op" id="5047559">(</span><span class="ident" id="5047560">f</span>&nbsp;<span class="op" id="5047562">*</span><span class="ident" id="5047563">File</span><span class="op" id="5047567">)</span>&nbsp;<span class="ident" id="5047569">Base</span><span class="op" id="5047573">(</span><span class="op" id="5047574">)</span>&nbsp;<span class="builtintype" id="5047576">int</span>&nbsp;<span class="op" id="5047580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5047583">return</span>&nbsp;<span class="ident" id="5047590">f</span><span class="op" id="5047591">.</span><span class="ident" id="5047592">base</span><br>
<span class="lineno">110</span><span class="op" id="5047597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5047600">//&nbsp;Size&nbsp;returns&nbsp;the&nbsp;size&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="5047663">func</span>&nbsp;<span class="op" id="5047668">(</span><span class="ident" id="5047669">f</span>&nbsp;<span class="op" id="5047671">*</span><span class="ident" id="5047672">File</span><span class="op" id="5047676">)</span>&nbsp;<span class="ident" id="5047678">Size</span><span class="op" id="5047682">(</span><span class="op" id="5047683">)</span>&nbsp;<span class="builtintype" id="5047685">int</span>&nbsp;<span class="op" id="5047689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5047692">return</span>&nbsp;<span class="ident" id="5047699">f</span><span class="op" id="5047700">.</span><span class="ident" id="5047701">size</span><br>
<span class="lineno">115</span><span class="op" id="5047706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5047709">//&nbsp;LineCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;lines&nbsp;in&nbsp;file&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="5047761">func</span>&nbsp;<span class="op" id="5047766">(</span><span class="ident" id="5047767">f</span>&nbsp;<span class="op" id="5047769">*</span><span class="ident" id="5047770">File</span><span class="op" id="5047774">)</span>&nbsp;<span class="ident" id="5047776">LineCount</span><span class="op" id="5047785">(</span><span class="op" id="5047786">)</span>&nbsp;<span class="builtintype" id="5047788">int</span>&nbsp;<span class="op" id="5047792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047795">f</span><span class="op" id="5047796">.</span><span class="ident" id="5047797">set</span><span class="op" id="5047800">.</span><span class="ident" id="5047801">mutex</span><span class="op" id="5047806">.</span><span class="ident" id="5047807">RLock</span><span class="op" id="5047812">(</span><span class="op" id="5047813">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047816">n</span>&nbsp;<span class="op" id="5047818">:=</span>&nbsp;<span class="builtinfunc" id="5047821">len</span><span class="op" id="5047824">(</span><span class="ident" id="5047825">f</span><span class="op" id="5047826">.</span><span class="ident" id="5047827">lines</span><span class="op" id="5047832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047835">f</span><span class="op" id="5047836">.</span><span class="ident" id="5047837">set</span><span class="op" id="5047840">.</span><span class="ident" id="5047841">mutex</span><span class="op" id="5047846">.</span><span class="ident" id="5047847">RUnlock</span><span class="op" id="5047854">(</span><span class="op" id="5047855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5047858">return</span>&nbsp;<span class="ident" id="5047865">n</span><br>
<span class="lineno"></span><span class="op" id="5047867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="5047870">//&nbsp;AddLine&nbsp;adds&nbsp;the&nbsp;line&nbsp;offset&nbsp;for&nbsp;a&nbsp;new&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="5047918">//&nbsp;The&nbsp;line&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="5047990">//&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;the&nbsp;line&nbsp;offset&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="5048063">//</span><br>
<span class="lineno"></span><span class="keyword" id="5048066">func</span>&nbsp;<span class="op" id="5048071">(</span><span class="ident" id="5048072">f</span>&nbsp;<span class="op" id="5048074">*</span><span class="ident" id="5048075">File</span><span class="op" id="5048079">)</span>&nbsp;<span class="ident" id="5048081">AddLine</span><span class="op" id="5048088">(</span><span class="ident" id="5048089">offset</span>&nbsp;<span class="builtintype" id="5048096">int</span><span class="op" id="5048099">)</span>&nbsp;<span class="op" id="5048101">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048104">f</span><span class="op" id="5048105">.</span><span class="ident" id="5048106">set</span><span class="op" id="5048109">.</span><span class="ident" id="5048110">mutex</span><span class="op" id="5048115">.</span><span class="ident" id="5048116">Lock</span><span class="op" id="5048120">(</span><span class="op" id="5048121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5048124">if</span>&nbsp;<span class="ident" id="5048127">i</span>&nbsp;<span class="op" id="5048129">:=</span>&nbsp;<span class="builtinfunc" id="5048132">len</span><span class="op" id="5048135">(</span><span class="ident" id="5048136">f</span><span class="op" id="5048137">.</span><span class="ident" id="5048138">lines</span><span class="op" id="5048143">)</span><span class="op" id="5048144">;</span>&nbsp;<span class="op" id="5048146">(</span><span class="ident" id="5048147">i</span>&nbsp;<span class="op" id="5048149">==</span>&nbsp;<span class="num" id="5048152">0</span>&nbsp;<span class="op" id="5048154">||</span>&nbsp;<span class="ident" id="5048157">f</span><span class="op" id="5048158">.</span><span class="ident" id="5048159">lines</span><span class="op" id="5048164">[</span><span class="ident" id="5048165">i</span><span class="op" id="5048166">-</span><span class="num" id="5048167">1</span><span class="op" id="5048168">]</span>&nbsp;<span class="op" id="5048170">&lt;</span>&nbsp;<span class="ident" id="5048172">offset</span><span class="op" id="5048178">)</span>&nbsp;<span class="op" id="5048180">&amp;&amp;</span>&nbsp;<span class="ident" id="5048183">offset</span>&nbsp;<span class="op" id="5048190">&lt;</span>&nbsp;<span class="ident" id="5048192">f</span><span class="op" id="5048193">.</span><span class="ident" id="5048194">size</span>&nbsp;<span class="op" id="5048199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048203">f</span><span class="op" id="5048204">.</span><span class="ident" id="5048205">lines</span>&nbsp;<span class="op" id="5048211">=</span>&nbsp;<span class="builtinfunc" id="5048213">append</span><span class="op" id="5048219">(</span><span class="ident" id="5048220">f</span><span class="op" id="5048221">.</span><span class="ident" id="5048222">lines</span><span class="op" id="5048227">,</span>&nbsp;<span class="ident" id="5048229">offset</span><span class="op" id="5048235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5048238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048241">f</span><span class="op" id="5048242">.</span><span class="ident" id="5048243">set</span><span class="op" id="5048246">.</span><span class="ident" id="5048247">mutex</span><span class="op" id="5048252">.</span><span class="ident" id="5048253">Unlock</span><span class="op" id="5048259">(</span><span class="op" id="5048260">)</span><br>
<span class="lineno">135</span><span class="op" id="5048262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5048265">//&nbsp;MergeLine&nbsp;merges&nbsp;a&nbsp;line&nbsp;with&nbsp;the&nbsp;following&nbsp;line.&nbsp;It&nbsp;is&nbsp;akin&nbsp;to&nbsp;replacing</span><br>
<span class="lineno"></span><span class="comment" id="5048341">//&nbsp;the&nbsp;newline&nbsp;character&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;line&nbsp;with&nbsp;a&nbsp;space&nbsp;(to&nbsp;not&nbsp;change&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5048421">//&nbsp;remaining&nbsp;offsets).&nbsp;To&nbsp;obtain&nbsp;the&nbsp;line&nbsp;number,&nbsp;consult&nbsp;e.g.&nbsp;Position.Line.</span><br>
<span class="lineno">140</span><span class="comment" id="5048499">//&nbsp;MergeLine&nbsp;will&nbsp;panic&nbsp;if&nbsp;given&nbsp;an&nbsp;invalid&nbsp;line&nbsp;number.</span><br>
<span class="lineno"></span><span class="comment" id="5048556">//</span><br>
<span class="lineno"></span><span class="keyword" id="5048559">func</span>&nbsp;<span class="op" id="5048564">(</span><span class="ident" id="5048565">f</span>&nbsp;<span class="op" id="5048567">*</span><span class="ident" id="5048568">File</span><span class="op" id="5048572">)</span>&nbsp;<span class="ident" id="5048574">MergeLine</span><span class="op" id="5048583">(</span><span class="ident" id="5048584">line</span>&nbsp;<span class="builtintype" id="5048589">int</span><span class="op" id="5048592">)</span>&nbsp;<span class="op" id="5048594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5048597">if</span>&nbsp;<span class="ident" id="5048600">line</span>&nbsp;<span class="op" id="5048605">&lt;=</span>&nbsp;<span class="num" id="5048608">0</span>&nbsp;<span class="op" id="5048610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5048614">panic</span><span class="op" id="5048619">(</span><span class="string" id="5048620">&#34;illegal&nbsp;line&nbsp;number&nbsp;(line&nbsp;numbering&nbsp;starts&nbsp;at&nbsp;1)&#34;</span><span class="op" id="5048670">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5048673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048676">f</span><span class="op" id="5048677">.</span><span class="ident" id="5048678">set</span><span class="op" id="5048681">.</span><span class="ident" id="5048682">mutex</span><span class="op" id="5048687">.</span><span class="ident" id="5048688">Lock</span><span class="op" id="5048692">(</span><span class="op" id="5048693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5048696">defer</span>&nbsp;<span class="ident" id="5048702">f</span><span class="op" id="5048703">.</span><span class="ident" id="5048704">set</span><span class="op" id="5048707">.</span><span class="ident" id="5048708">mutex</span><span class="op" id="5048713">.</span><span class="ident" id="5048714">Unlock</span><span class="op" id="5048720">(</span><span class="op" id="5048721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5048724">if</span>&nbsp;<span class="ident" id="5048727">line</span>&nbsp;<span class="op" id="5048732">&gt;=</span>&nbsp;<span class="builtinfunc" id="5048735">len</span><span class="op" id="5048738">(</span><span class="ident" id="5048739">f</span><span class="op" id="5048740">.</span><span class="ident" id="5048741">lines</span><span class="op" id="5048746">)</span>&nbsp;<span class="op" id="5048748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5048752">panic</span><span class="op" id="5048757">(</span><span class="string" id="5048758">&#34;illegal&nbsp;line&nbsp;number&#34;</span><span class="op" id="5048779">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5048782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5048785">//&nbsp;To&nbsp;merge&nbsp;the&nbsp;line&nbsp;numbered&nbsp;&lt;line&gt;&nbsp;with&nbsp;the&nbsp;line&nbsp;numbered&nbsp;&lt;line+1&gt;,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5048856">//&nbsp;we&nbsp;need&nbsp;to&nbsp;remove&nbsp;the&nbsp;entry&nbsp;in&nbsp;lines&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5048923">//&nbsp;numbered&nbsp;&lt;line+1&gt;.&nbsp;The&nbsp;entry&nbsp;in&nbsp;lines&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5048991">//&nbsp;numbered&nbsp;&lt;line+1&gt;&nbsp;is&nbsp;located&nbsp;at&nbsp;index&nbsp;&lt;line&gt;,&nbsp;since&nbsp;indices&nbsp;in&nbsp;lines</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5049064">//&nbsp;are&nbsp;0-based&nbsp;and&nbsp;line&nbsp;numbers&nbsp;are&nbsp;1-based.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5049110">copy</span><span class="op" id="5049114">(</span><span class="ident" id="5049115">f</span><span class="op" id="5049116">.</span><span class="ident" id="5049117">lines</span><span class="op" id="5049122">[</span><span class="ident" id="5049123">line</span><span class="op" id="5049127">:</span><span class="op" id="5049128">]</span><span class="op" id="5049129">,</span>&nbsp;<span class="ident" id="5049131">f</span><span class="op" id="5049132">.</span><span class="ident" id="5049133">lines</span><span class="op" id="5049138">[</span><span class="ident" id="5049139">line</span><span class="op" id="5049143">+</span><span class="num" id="5049144">1</span><span class="op" id="5049145">:</span><span class="op" id="5049146">]</span><span class="op" id="5049147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5049150">f</span><span class="op" id="5049151">.</span><span class="ident" id="5049152">lines</span>&nbsp;<span class="op" id="5049158">=</span>&nbsp;<span class="ident" id="5049160">f</span><span class="op" id="5049161">.</span><span class="ident" id="5049162">lines</span><span class="op" id="5049167">[</span><span class="op" id="5049168">:</span><span class="builtinfunc" id="5049169">len</span><span class="op" id="5049172">(</span><span class="ident" id="5049173">f</span><span class="op" id="5049174">.</span><span class="ident" id="5049175">lines</span><span class="op" id="5049180">)</span><span class="op" id="5049181">-</span><span class="num" id="5049182">1</span><span class="op" id="5049183">]</span><br>
<span class="lineno"></span><span class="op" id="5049185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="5049188">//&nbsp;SetLines&nbsp;sets&nbsp;the&nbsp;line&nbsp;offsets&nbsp;for&nbsp;a&nbsp;file&nbsp;and&nbsp;returns&nbsp;true&nbsp;if&nbsp;successful.</span><br>
<span class="lineno"></span><span class="comment" id="5049265">//&nbsp;The&nbsp;line&nbsp;offsets&nbsp;are&nbsp;the&nbsp;offsets&nbsp;of&nbsp;the&nbsp;first&nbsp;character&nbsp;of&nbsp;each&nbsp;line;</span><br>
<span class="lineno"></span><span class="comment" id="5049338">//&nbsp;for&nbsp;instance&nbsp;for&nbsp;the&nbsp;content&nbsp;&#34;ab\nc\n&#34;&nbsp;the&nbsp;line&nbsp;offsets&nbsp;are&nbsp;{0,&nbsp;3}.</span><br>
<span class="lineno"></span><span class="comment" id="5049409">//&nbsp;An&nbsp;empty&nbsp;file&nbsp;has&nbsp;an&nbsp;empty&nbsp;line&nbsp;offset&nbsp;table.</span><br>
<span class="lineno"></span><span class="comment" id="5049458">//&nbsp;Each&nbsp;line&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno">165</span><span class="comment" id="5049531">//&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;SetLines&nbsp;fails&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="5049603">//&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="5049613">//</span><br>
<span class="lineno"></span><span class="keyword" id="5049616">func</span>&nbsp;<span class="op" id="5049621">(</span><span class="ident" id="5049622">f</span>&nbsp;<span class="op" id="5049624">*</span><span class="ident" id="5049625">File</span><span class="op" id="5049629">)</span>&nbsp;<span class="ident" id="5049631">SetLines</span><span class="op" id="5049639">(</span><span class="ident" id="5049640">lines</span>&nbsp;<span class="op" id="5049646">[</span><span class="op" id="5049647">]</span><span class="builtintype" id="5049648">int</span><span class="op" id="5049651">)</span>&nbsp;<span class="builtintype" id="5049653">bool</span>&nbsp;<span class="op" id="5049658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5049661">//&nbsp;verify&nbsp;validity&nbsp;of&nbsp;lines&nbsp;table</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5049696">size</span>&nbsp;<span class="op" id="5049701">:=</span>&nbsp;<span class="ident" id="5049704">f</span><span class="op" id="5049705">.</span><span class="ident" id="5049706">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5049712">for</span>&nbsp;<span class="ident" id="5049716">i</span><span class="op" id="5049717">,</span>&nbsp;<span class="ident" id="5049719">offset</span>&nbsp;<span class="op" id="5049726">:=</span>&nbsp;<span class="keyword" id="5049729">range</span>&nbsp;<span class="ident" id="5049735">lines</span>&nbsp;<span class="op" id="5049741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5049745">if</span>&nbsp;<span class="ident" id="5049748">i</span>&nbsp;<span class="op" id="5049750">&gt;</span>&nbsp;<span class="num" id="5049752">0</span>&nbsp;<span class="op" id="5049754">&amp;&amp;</span>&nbsp;<span class="ident" id="5049757">offset</span>&nbsp;<span class="op" id="5049764">&lt;=</span>&nbsp;<span class="ident" id="5049767">lines</span><span class="op" id="5049772">[</span><span class="ident" id="5049773">i</span><span class="op" id="5049774">-</span><span class="num" id="5049775">1</span><span class="op" id="5049776">]</span>&nbsp;<span class="op" id="5049778">||</span>&nbsp;<span class="ident" id="5049781">size</span>&nbsp;<span class="op" id="5049786">&lt;=</span>&nbsp;<span class="ident" id="5049789">offset</span>&nbsp;<span class="op" id="5049796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5049801">return</span>&nbsp;<span class="ident" id="5049808">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5049816">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5049819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5049823">//&nbsp;set&nbsp;lines&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5049843">f</span><span class="op" id="5049844">.</span><span class="ident" id="5049845">set</span><span class="op" id="5049848">.</span><span class="ident" id="5049849">mutex</span><span class="op" id="5049854">.</span><span class="ident" id="5049855">Lock</span><span class="op" id="5049859">(</span><span class="op" id="5049860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5049863">f</span><span class="op" id="5049864">.</span><span class="ident" id="5049865">lines</span>&nbsp;<span class="op" id="5049871">=</span>&nbsp;<span class="ident" id="5049873">lines</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5049880">f</span><span class="op" id="5049881">.</span><span class="ident" id="5049882">set</span><span class="op" id="5049885">.</span><span class="ident" id="5049886">mutex</span><span class="op" id="5049891">.</span><span class="ident" id="5049892">Unlock</span><span class="op" id="5049898">(</span><span class="op" id="5049899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5049902">return</span>&nbsp;<span class="ident" id="5049909">true</span><br>
<span class="lineno"></span><span class="op" id="5049914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5049917">//&nbsp;SetLinesForContent&nbsp;sets&nbsp;the&nbsp;line&nbsp;offsets&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;content.</span><br>
<span class="lineno">185</span><span class="comment" id="5049989">//&nbsp;It&nbsp;ignores&nbsp;position-altering&nbsp;//line&nbsp;comments.</span><br>
<span class="lineno"></span><span class="keyword" id="5050038">func</span>&nbsp;<span class="op" id="5050043">(</span><span class="ident" id="5050044">f</span>&nbsp;<span class="op" id="5050046">*</span><span class="ident" id="5050047">File</span><span class="op" id="5050051">)</span>&nbsp;<span class="ident" id="5050053">SetLinesForContent</span><span class="op" id="5050071">(</span><span class="ident" id="5050072">content</span>&nbsp;<span class="op" id="5050080">[</span><span class="op" id="5050081">]</span><span class="builtintype" id="5050082">byte</span><span class="op" id="5050086">)</span>&nbsp;<span class="op" id="5050088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5050091">var</span>&nbsp;<span class="ident" id="5050095">lines</span>&nbsp;<span class="op" id="5050101">[</span><span class="op" id="5050102">]</span><span class="builtintype" id="5050103">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050108">line</span>&nbsp;<span class="op" id="5050113">:=</span>&nbsp;<span class="num" id="5050116">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5050119">for</span>&nbsp;<span class="ident" id="5050123">offset</span><span class="op" id="5050129">,</span>&nbsp;<span class="ident" id="5050131">b</span>&nbsp;<span class="op" id="5050133">:=</span>&nbsp;<span class="keyword" id="5050136">range</span>&nbsp;<span class="ident" id="5050142">content</span>&nbsp;<span class="op" id="5050150">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5050154">if</span>&nbsp;<span class="ident" id="5050157">line</span>&nbsp;<span class="op" id="5050162">&gt;=</span>&nbsp;<span class="num" id="5050165">0</span>&nbsp;<span class="op" id="5050167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050172">lines</span>&nbsp;<span class="op" id="5050178">=</span>&nbsp;<span class="builtinfunc" id="5050180">append</span><span class="op" id="5050186">(</span><span class="ident" id="5050187">lines</span><span class="op" id="5050192">,</span>&nbsp;<span class="ident" id="5050194">line</span><span class="op" id="5050198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5050202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050206">line</span>&nbsp;<span class="op" id="5050211">=</span>&nbsp;<span class="op" id="5050213">-</span><span class="num" id="5050214">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5050218">if</span>&nbsp;<span class="ident" id="5050221">b</span>&nbsp;<span class="op" id="5050223">==</span>&nbsp;<span class="string" id="5050226">&#39;\n&#39;</span>&nbsp;<span class="op" id="5050231">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050236">line</span>&nbsp;<span class="op" id="5050241">=</span>&nbsp;<span class="ident" id="5050243">offset</span>&nbsp;<span class="op" id="5050250">+</span>&nbsp;<span class="num" id="5050252">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5050256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5050259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5050263">//&nbsp;set&nbsp;lines&nbsp;table</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050283">f</span><span class="op" id="5050284">.</span><span class="ident" id="5050285">set</span><span class="op" id="5050288">.</span><span class="ident" id="5050289">mutex</span><span class="op" id="5050294">.</span><span class="ident" id="5050295">Lock</span><span class="op" id="5050299">(</span><span class="op" id="5050300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050303">f</span><span class="op" id="5050304">.</span><span class="ident" id="5050305">lines</span>&nbsp;<span class="op" id="5050311">=</span>&nbsp;<span class="ident" id="5050313">lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050320">f</span><span class="op" id="5050321">.</span><span class="ident" id="5050322">set</span><span class="op" id="5050325">.</span><span class="ident" id="5050326">mutex</span><span class="op" id="5050331">.</span><span class="ident" id="5050332">Unlock</span><span class="op" id="5050338">(</span><span class="op" id="5050339">)</span><br>
<span class="lineno"></span><span class="op" id="5050341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="5050344">//&nbsp;A&nbsp;lineInfo&nbsp;object&nbsp;describes&nbsp;alternative&nbsp;file&nbsp;and&nbsp;line&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="5050408">//&nbsp;information&nbsp;(such&nbsp;as&nbsp;provided&nbsp;via&nbsp;a&nbsp;//line&nbsp;comment&nbsp;in&nbsp;a&nbsp;.go</span><br>
<span class="lineno"></span><span class="comment" id="5050471">//&nbsp;file)&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="5050505">type</span>&nbsp;<span class="ident" id="5050510">lineInfo</span>&nbsp;<span class="keyword" id="5050519">struct</span>&nbsp;<span class="op" id="5050526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5050529">//&nbsp;fields&nbsp;are&nbsp;exported&nbsp;to&nbsp;make&nbsp;them&nbsp;accessible&nbsp;to&nbsp;gob</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050584">Offset</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5050593">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050598">Filename</span>&nbsp;<span class="builtintype" id="5050607">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050615">Line</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5050624">int</span><br>
<span class="lineno"></span><span class="op" id="5050628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="5050631">//&nbsp;AddLineInfo&nbsp;adds&nbsp;alternative&nbsp;file&nbsp;and&nbsp;line&nbsp;number&nbsp;information&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5050700">//&nbsp;a&nbsp;given&nbsp;file&nbsp;offset.&nbsp;The&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5050770">//&nbsp;the&nbsp;previously&nbsp;added&nbsp;alternative&nbsp;line&nbsp;info&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5050837">//&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;the&nbsp;information&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="5050889">//</span><br>
<span class="lineno">220</span><span class="comment" id="5050892">//&nbsp;AddLineInfo&nbsp;is&nbsp;typically&nbsp;used&nbsp;to&nbsp;register&nbsp;alternative&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="5050958">//&nbsp;information&nbsp;for&nbsp;//line&nbsp;filename:line&nbsp;comments&nbsp;in&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="5051024">//</span><br>
<span class="lineno"></span><span class="keyword" id="5051027">func</span>&nbsp;<span class="op" id="5051032">(</span><span class="ident" id="5051033">f</span>&nbsp;<span class="op" id="5051035">*</span><span class="ident" id="5051036">File</span><span class="op" id="5051040">)</span>&nbsp;<span class="ident" id="5051042">AddLineInfo</span><span class="op" id="5051053">(</span><span class="ident" id="5051054">offset</span>&nbsp;<span class="builtintype" id="5051061">int</span><span class="op" id="5051064">,</span>&nbsp;<span class="ident" id="5051066">filename</span>&nbsp;<span class="builtintype" id="5051075">string</span><span class="op" id="5051081">,</span>&nbsp;<span class="ident" id="5051083">line</span>&nbsp;<span class="builtintype" id="5051088">int</span><span class="op" id="5051091">)</span>&nbsp;<span class="op" id="5051093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5051096">f</span><span class="op" id="5051097">.</span><span class="ident" id="5051098">set</span><span class="op" id="5051101">.</span><span class="ident" id="5051102">mutex</span><span class="op" id="5051107">.</span><span class="ident" id="5051108">Lock</span><span class="op" id="5051112">(</span><span class="op" id="5051113">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5051116">if</span>&nbsp;<span class="ident" id="5051119">i</span>&nbsp;<span class="op" id="5051121">:=</span>&nbsp;<span class="builtinfunc" id="5051124">len</span><span class="op" id="5051127">(</span><span class="ident" id="5051128">f</span><span class="op" id="5051129">.</span><span class="ident" id="5051130">infos</span><span class="op" id="5051135">)</span><span class="op" id="5051136">;</span>&nbsp;<span class="ident" id="5051138">i</span>&nbsp;<span class="op" id="5051140">==</span>&nbsp;<span class="num" id="5051143">0</span>&nbsp;<span class="op" id="5051145">||</span>&nbsp;<span class="ident" id="5051148">f</span><span class="op" id="5051149">.</span><span class="ident" id="5051150">infos</span><span class="op" id="5051155">[</span><span class="ident" id="5051156">i</span><span class="op" id="5051157">-</span><span class="num" id="5051158">1</span><span class="op" id="5051159">]</span><span class="op" id="5051160">.</span><span class="ident" id="5051161">Offset</span>&nbsp;<span class="op" id="5051168">&lt;</span>&nbsp;<span class="ident" id="5051170">offset</span>&nbsp;<span class="op" id="5051177">&amp;&amp;</span>&nbsp;<span class="ident" id="5051180">offset</span>&nbsp;<span class="op" id="5051187">&lt;</span>&nbsp;<span class="ident" id="5051189">f</span><span class="op" id="5051190">.</span><span class="ident" id="5051191">size</span>&nbsp;<span class="op" id="5051196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5051200">f</span><span class="op" id="5051201">.</span><span class="ident" id="5051202">infos</span>&nbsp;<span class="op" id="5051208">=</span>&nbsp;<span class="builtinfunc" id="5051210">append</span><span class="op" id="5051216">(</span><span class="ident" id="5051217">f</span><span class="op" id="5051218">.</span><span class="ident" id="5051219">infos</span><span class="op" id="5051224">,</span>&nbsp;<span class="ident" id="5051226">lineInfo</span><span class="op" id="5051234">{</span><span class="ident" id="5051235">offset</span><span class="op" id="5051241">,</span>&nbsp;<span class="ident" id="5051243">filename</span><span class="op" id="5051251">,</span>&nbsp;<span class="ident" id="5051253">line</span><span class="op" id="5051257">}</span><span class="op" id="5051258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5051261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5051264">f</span><span class="op" id="5051265">.</span><span class="ident" id="5051266">set</span><span class="op" id="5051269">.</span><span class="ident" id="5051270">mutex</span><span class="op" id="5051275">.</span><span class="ident" id="5051276">Unlock</span><span class="op" id="5051282">(</span><span class="op" id="5051283">)</span><br>
<span class="lineno"></span><span class="op" id="5051285">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="5051288">//&nbsp;Pos&nbsp;returns&nbsp;the&nbsp;Pos&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;offset;</span><br>
<span class="lineno"></span><span class="comment" id="5051344">//&nbsp;the&nbsp;offset&nbsp;must&nbsp;be&nbsp;&lt;=&nbsp;f.Size().</span><br>
<span class="lineno"></span><span class="comment" id="5051379">//&nbsp;f.Pos(f.Offset(p))&nbsp;==&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="5051407">//</span><br>
<span class="lineno">235</span><span class="keyword" id="5051410">func</span>&nbsp;<span class="op" id="5051415">(</span><span class="ident" id="5051416">f</span>&nbsp;<span class="op" id="5051418">*</span><span class="ident" id="5051419">File</span><span class="op" id="5051423">)</span>&nbsp;<span class="ident" id="5051425">Pos</span><span class="op" id="5051428">(</span><span class="ident" id="5051429">offset</span>&nbsp;<span class="builtintype" id="5051436">int</span><span class="op" id="5051439">)</span>&nbsp;<span class="ident" id="5051441">Pos</span>&nbsp;<span class="op" id="5051445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5051448">if</span>&nbsp;<span class="ident" id="5051451">offset</span>&nbsp;<span class="op" id="5051458">&gt;</span>&nbsp;<span class="ident" id="5051460">f</span><span class="op" id="5051461">.</span><span class="ident" id="5051462">size</span>&nbsp;<span class="op" id="5051467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5051471">panic</span><span class="op" id="5051476">(</span><span class="string" id="5051477">&#34;illegal&nbsp;file&nbsp;offset&#34;</span><span class="op" id="5051498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5051501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5051504">return</span>&nbsp;<span class="ident" id="5051511">Pos</span><span class="op" id="5051514">(</span><span class="ident" id="5051515">f</span><span class="op" id="5051516">.</span><span class="ident" id="5051517">base</span>&nbsp;<span class="op" id="5051522">+</span>&nbsp;<span class="ident" id="5051524">offset</span><span class="op" id="5051530">)</span><br>
<span class="lineno">240</span><span class="op" id="5051532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5051535">//&nbsp;Offset&nbsp;returns&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p;</span><br>
<span class="lineno"></span><span class="comment" id="5051595">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;valid&nbsp;Pos&nbsp;value&nbsp;in&nbsp;that&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="5051640">//&nbsp;f.Offset(f.Pos(offset))&nbsp;==&nbsp;offset.</span><br>
<span class="lineno">245</span><span class="comment" id="5051678">//</span><br>
<span class="lineno"></span><span class="keyword" id="5051681">func</span>&nbsp;<span class="op" id="5051686">(</span><span class="ident" id="5051687">f</span>&nbsp;<span class="op" id="5051689">*</span><span class="ident" id="5051690">File</span><span class="op" id="5051694">)</span>&nbsp;<span class="ident" id="5051696">Offset</span><span class="op" id="5051702">(</span><span class="ident" id="5051703">p</span>&nbsp;<span class="ident" id="5051705">Pos</span><span class="op" id="5051708">)</span>&nbsp;<span class="builtintype" id="5051710">int</span>&nbsp;<span class="op" id="5051714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5051717">if</span>&nbsp;<span class="builtintype" id="5051720">int</span><span class="op" id="5051723">(</span><span class="ident" id="5051724">p</span><span class="op" id="5051725">)</span>&nbsp;<span class="op" id="5051727">&lt;</span>&nbsp;<span class="ident" id="5051729">f</span><span class="op" id="5051730">.</span><span class="ident" id="5051731">base</span>&nbsp;<span class="op" id="5051736">||</span>&nbsp;<span class="builtintype" id="5051739">int</span><span class="op" id="5051742">(</span><span class="ident" id="5051743">p</span><span class="op" id="5051744">)</span>&nbsp;<span class="op" id="5051746">&gt;</span>&nbsp;<span class="ident" id="5051748">f</span><span class="op" id="5051749">.</span><span class="ident" id="5051750">base</span><span class="op" id="5051754">+</span><span class="ident" id="5051755">f</span><span class="op" id="5051756">.</span><span class="ident" id="5051757">size</span>&nbsp;<span class="op" id="5051762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5051766">panic</span><span class="op" id="5051771">(</span><span class="string" id="5051772">&#34;illegal&nbsp;Pos&nbsp;value&#34;</span><span class="op" id="5051791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5051794">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5051797">return</span>&nbsp;<span class="builtintype" id="5051804">int</span><span class="op" id="5051807">(</span><span class="ident" id="5051808">p</span><span class="op" id="5051809">)</span>&nbsp;<span class="op" id="5051811">-</span>&nbsp;<span class="ident" id="5051813">f</span><span class="op" id="5051814">.</span><span class="ident" id="5051815">base</span><br>
<span class="lineno"></span><span class="op" id="5051820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5051823">//&nbsp;Line&nbsp;returns&nbsp;the&nbsp;line&nbsp;number&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p;</span><br>
<span class="lineno"></span><span class="comment" id="5051886">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;that&nbsp;file&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno">255</span><span class="comment" id="5051934">//</span><br>
<span class="lineno"></span><span class="keyword" id="5051937">func</span>&nbsp;<span class="op" id="5051942">(</span><span class="ident" id="5051943">f</span>&nbsp;<span class="op" id="5051945">*</span><span class="ident" id="5051946">File</span><span class="op" id="5051950">)</span>&nbsp;<span class="ident" id="5051952">Line</span><span class="op" id="5051956">(</span><span class="ident" id="5051957">p</span>&nbsp;<span class="ident" id="5051959">Pos</span><span class="op" id="5051962">)</span>&nbsp;<span class="builtintype" id="5051964">int</span>&nbsp;<span class="op" id="5051968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5051971">return</span>&nbsp;<span class="ident" id="5051978">f</span><span class="op" id="5051979">.</span><span class="ident" id="5051980">Position</span><span class="op" id="5051988">(</span><span class="ident" id="5051989">p</span><span class="op" id="5051990">)</span><span class="op" id="5051991">.</span><span class="ident" id="5051992">Line</span><br>
<span class="lineno"></span><span class="op" id="5051997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="5052000">func</span>&nbsp;<span class="ident" id="5052005">searchLineInfos</span><span class="op" id="5052020">(</span><span class="ident" id="5052021">a</span>&nbsp;<span class="op" id="5052023">[</span><span class="op" id="5052024">]</span><span class="ident" id="5052025">lineInfo</span><span class="op" id="5052033">,</span>&nbsp;<span class="ident" id="5052035">x</span>&nbsp;<span class="builtintype" id="5052037">int</span><span class="op" id="5052040">)</span>&nbsp;<span class="builtintype" id="5052042">int</span>&nbsp;<span class="op" id="5052046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5052049">return</span>&nbsp;<span class="ident" id="5052056">sort</span><span class="op" id="5052060">.</span><span class="ident" id="5052061">Search</span><span class="op" id="5052067">(</span><span class="builtinfunc" id="5052068">len</span><span class="op" id="5052071">(</span><span class="ident" id="5052072">a</span><span class="op" id="5052073">)</span><span class="op" id="5052074">,</span>&nbsp;<span class="keyword" id="5052076">func</span><span class="op" id="5052080">(</span><span class="ident" id="5052081">i</span>&nbsp;<span class="builtintype" id="5052083">int</span><span class="op" id="5052086">)</span>&nbsp;<span class="builtintype" id="5052088">bool</span>&nbsp;<span class="op" id="5052093">{</span>&nbsp;<span class="keyword" id="5052095">return</span>&nbsp;<span class="ident" id="5052102">a</span><span class="op" id="5052103">[</span><span class="ident" id="5052104">i</span><span class="op" id="5052105">]</span><span class="op" id="5052106">.</span><span class="ident" id="5052107">Offset</span>&nbsp;<span class="op" id="5052114">&gt;</span>&nbsp;<span class="ident" id="5052116">x</span>&nbsp;<span class="op" id="5052118">}</span><span class="op" id="5052119">)</span>&nbsp;<span class="op" id="5052121">-</span>&nbsp;<span class="num" id="5052123">1</span><br>
<span class="lineno"></span><span class="op" id="5052125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5052128">//&nbsp;unpack&nbsp;returns&nbsp;the&nbsp;filename&nbsp;and&nbsp;line&nbsp;and&nbsp;column&nbsp;number&nbsp;for&nbsp;a&nbsp;file&nbsp;offset.</span><br>
<span class="lineno">265</span><span class="comment" id="5052205">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;unpack&nbsp;will&nbsp;return&nbsp;the&nbsp;filename&nbsp;and&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="5052281">//&nbsp;possibly&nbsp;adjusted&nbsp;by&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="5052360">//</span><br>
<span class="lineno"></span><span class="keyword" id="5052363">func</span>&nbsp;<span class="op" id="5052368">(</span><span class="ident" id="5052369">f</span>&nbsp;<span class="op" id="5052371">*</span><span class="ident" id="5052372">File</span><span class="op" id="5052376">)</span>&nbsp;<span class="ident" id="5052378">unpack</span><span class="op" id="5052384">(</span><span class="ident" id="5052385">offset</span>&nbsp;<span class="builtintype" id="5052392">int</span><span class="op" id="5052395">,</span>&nbsp;<span class="ident" id="5052397">adjusted</span>&nbsp;<span class="builtintype" id="5052406">bool</span><span class="op" id="5052410">)</span>&nbsp;<span class="op" id="5052412">(</span><span class="ident" id="5052413">filename</span>&nbsp;<span class="builtintype" id="5052422">string</span><span class="op" id="5052428">,</span>&nbsp;<span class="ident" id="5052430">line</span><span class="op" id="5052434">,</span>&nbsp;<span class="ident" id="5052436">column</span>&nbsp;<span class="builtintype" id="5052443">int</span><span class="op" id="5052446">)</span>&nbsp;<span class="op" id="5052448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5052451">filename</span>&nbsp;<span class="op" id="5052460">=</span>&nbsp;<span class="ident" id="5052462">f</span><span class="op" id="5052463">.</span><span class="ident" id="5052464">name</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5052470">if</span>&nbsp;<span class="ident" id="5052473">i</span>&nbsp;<span class="op" id="5052475">:=</span>&nbsp;<span class="ident" id="5052478">searchInts</span><span class="op" id="5052488">(</span><span class="ident" id="5052489">f</span><span class="op" id="5052490">.</span><span class="ident" id="5052491">lines</span><span class="op" id="5052496">,</span>&nbsp;<span class="ident" id="5052498">offset</span><span class="op" id="5052504">)</span><span class="op" id="5052505">;</span>&nbsp;<span class="ident" id="5052507">i</span>&nbsp;<span class="op" id="5052509">&gt;=</span>&nbsp;<span class="num" id="5052512">0</span>&nbsp;<span class="op" id="5052514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5052518">line</span><span class="op" id="5052522">,</span>&nbsp;<span class="ident" id="5052524">column</span>&nbsp;<span class="op" id="5052531">=</span>&nbsp;<span class="ident" id="5052533">i</span><span class="op" id="5052534">+</span><span class="num" id="5052535">1</span><span class="op" id="5052536">,</span>&nbsp;<span class="ident" id="5052538">offset</span><span class="op" id="5052544">-</span><span class="ident" id="5052545">f</span><span class="op" id="5052546">.</span><span class="ident" id="5052547">lines</span><span class="op" id="5052552">[</span><span class="ident" id="5052553">i</span><span class="op" id="5052554">]</span><span class="op" id="5052555">+</span><span class="num" id="5052556">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5052559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5052562">if</span>&nbsp;<span class="ident" id="5052565">adjusted</span>&nbsp;<span class="op" id="5052574">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5052577">len</span><span class="op" id="5052580">(</span><span class="ident" id="5052581">f</span><span class="op" id="5052582">.</span><span class="ident" id="5052583">infos</span><span class="op" id="5052588">)</span>&nbsp;<span class="op" id="5052590">&gt;</span>&nbsp;<span class="num" id="5052592">0</span>&nbsp;<span class="op" id="5052594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5052598">//&nbsp;almost&nbsp;no&nbsp;files&nbsp;have&nbsp;extra&nbsp;line&nbsp;infos</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5052641">if</span>&nbsp;<span class="ident" id="5052644">i</span>&nbsp;<span class="op" id="5052646">:=</span>&nbsp;<span class="ident" id="5052649">searchLineInfos</span><span class="op" id="5052664">(</span><span class="ident" id="5052665">f</span><span class="op" id="5052666">.</span><span class="ident" id="5052667">infos</span><span class="op" id="5052672">,</span>&nbsp;<span class="ident" id="5052674">offset</span><span class="op" id="5052680">)</span><span class="op" id="5052681">;</span>&nbsp;<span class="ident" id="5052683">i</span>&nbsp;<span class="op" id="5052685">&gt;=</span>&nbsp;<span class="num" id="5052688">0</span>&nbsp;<span class="op" id="5052690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5052695">alt</span>&nbsp;<span class="op" id="5052699">:=</span>&nbsp;<span class="op" id="5052702">&amp;</span><span class="ident" id="5052703">f</span><span class="op" id="5052704">.</span><span class="ident" id="5052705">infos</span><span class="op" id="5052710">[</span><span class="ident" id="5052711">i</span><span class="op" id="5052712">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5052717">filename</span>&nbsp;<span class="op" id="5052726">=</span>&nbsp;<span class="ident" id="5052728">alt</span><span class="op" id="5052731">.</span><span class="ident" id="5052732">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5052744">if</span>&nbsp;<span class="ident" id="5052747">i</span>&nbsp;<span class="op" id="5052749">:=</span>&nbsp;<span class="ident" id="5052752">searchInts</span><span class="op" id="5052762">(</span><span class="ident" id="5052763">f</span><span class="op" id="5052764">.</span><span class="ident" id="5052765">lines</span><span class="op" id="5052770">,</span>&nbsp;<span class="ident" id="5052772">alt</span><span class="op" id="5052775">.</span><span class="ident" id="5052776">Offset</span><span class="op" id="5052782">)</span><span class="op" id="5052783">;</span>&nbsp;<span class="ident" id="5052785">i</span>&nbsp;<span class="op" id="5052787">&gt;=</span>&nbsp;<span class="num" id="5052790">0</span>&nbsp;<span class="op" id="5052792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5052798">line</span>&nbsp;<span class="op" id="5052803">+=</span>&nbsp;<span class="ident" id="5052806">alt</span><span class="op" id="5052809">.</span><span class="ident" id="5052810">Line</span>&nbsp;<span class="op" id="5052815">-</span>&nbsp;<span class="ident" id="5052817">i</span>&nbsp;<span class="op" id="5052819">-</span>&nbsp;<span class="num" id="5052821">1</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5052826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5052830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5052833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5052836">return</span><br>
<span class="lineno"></span><span class="op" id="5052843">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="5052846">func</span>&nbsp;<span class="op" id="5052851">(</span><span class="ident" id="5052852">f</span>&nbsp;<span class="op" id="5052854">*</span><span class="ident" id="5052855">File</span><span class="op" id="5052859">)</span>&nbsp;<span class="ident" id="5052861">position</span><span class="op" id="5052869">(</span><span class="ident" id="5052870">p</span>&nbsp;<span class="ident" id="5052872">Pos</span><span class="op" id="5052875">,</span>&nbsp;<span class="ident" id="5052877">adjusted</span>&nbsp;<span class="builtintype" id="5052886">bool</span><span class="op" id="5052890">)</span>&nbsp;<span class="op" id="5052892">(</span><span class="ident" id="5052893">pos</span>&nbsp;<span class="ident" id="5052897">Position</span><span class="op" id="5052905">)</span>&nbsp;<span class="op" id="5052907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5052910">offset</span>&nbsp;<span class="op" id="5052917">:=</span>&nbsp;<span class="builtintype" id="5052920">int</span><span class="op" id="5052923">(</span><span class="ident" id="5052924">p</span><span class="op" id="5052925">)</span>&nbsp;<span class="op" id="5052927">-</span>&nbsp;<span class="ident" id="5052929">f</span><span class="op" id="5052930">.</span><span class="ident" id="5052931">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5052937">pos</span><span class="op" id="5052940">.</span><span class="ident" id="5052941">Offset</span>&nbsp;<span class="op" id="5052948">=</span>&nbsp;<span class="ident" id="5052950">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5052958">pos</span><span class="op" id="5052961">.</span><span class="ident" id="5052962">Filename</span><span class="op" id="5052970">,</span>&nbsp;<span class="ident" id="5052972">pos</span><span class="op" id="5052975">.</span><span class="ident" id="5052976">Line</span><span class="op" id="5052980">,</span>&nbsp;<span class="ident" id="5052982">pos</span><span class="op" id="5052985">.</span><span class="ident" id="5052986">Column</span>&nbsp;<span class="op" id="5052993">=</span>&nbsp;<span class="ident" id="5052995">f</span><span class="op" id="5052996">.</span><span class="ident" id="5052997">unpack</span><span class="op" id="5053003">(</span><span class="ident" id="5053004">offset</span><span class="op" id="5053010">,</span>&nbsp;<span class="ident" id="5053012">adjusted</span><span class="op" id="5053020">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053023">return</span><br>
<span class="lineno"></span><span class="op" id="5053030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5053033">//&nbsp;PositionFor&nbsp;returns&nbsp;the&nbsp;Position&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="5053106">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;the&nbsp;position&nbsp;may&nbsp;be&nbsp;adjusted&nbsp;by&nbsp;position-altering</span><br>
<span class="lineno">295</span><span class="comment" id="5053179">//&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="5053237">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;f&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno"></span><span class="comment" id="5053277">//</span><br>
<span class="lineno"></span><span class="keyword" id="5053280">func</span>&nbsp;<span class="op" id="5053285">(</span><span class="ident" id="5053286">f</span>&nbsp;<span class="op" id="5053288">*</span><span class="ident" id="5053289">File</span><span class="op" id="5053293">)</span>&nbsp;<span class="ident" id="5053295">PositionFor</span><span class="op" id="5053306">(</span><span class="ident" id="5053307">p</span>&nbsp;<span class="ident" id="5053309">Pos</span><span class="op" id="5053312">,</span>&nbsp;<span class="ident" id="5053314">adjusted</span>&nbsp;<span class="builtintype" id="5053323">bool</span><span class="op" id="5053327">)</span>&nbsp;<span class="op" id="5053329">(</span><span class="ident" id="5053330">pos</span>&nbsp;<span class="ident" id="5053334">Position</span><span class="op" id="5053342">)</span>&nbsp;<span class="op" id="5053344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053347">if</span>&nbsp;<span class="ident" id="5053350">p</span>&nbsp;<span class="op" id="5053352">!=</span>&nbsp;<span class="ident" id="5053355">NoPos</span>&nbsp;<span class="op" id="5053361">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053365">if</span>&nbsp;<span class="builtintype" id="5053368">int</span><span class="op" id="5053371">(</span><span class="ident" id="5053372">p</span><span class="op" id="5053373">)</span>&nbsp;<span class="op" id="5053375">&lt;</span>&nbsp;<span class="ident" id="5053377">f</span><span class="op" id="5053378">.</span><span class="ident" id="5053379">base</span>&nbsp;<span class="op" id="5053384">||</span>&nbsp;<span class="builtintype" id="5053387">int</span><span class="op" id="5053390">(</span><span class="ident" id="5053391">p</span><span class="op" id="5053392">)</span>&nbsp;<span class="op" id="5053394">&gt;</span>&nbsp;<span class="ident" id="5053396">f</span><span class="op" id="5053397">.</span><span class="ident" id="5053398">base</span><span class="op" id="5053402">+</span><span class="ident" id="5053403">f</span><span class="op" id="5053404">.</span><span class="ident" id="5053405">size</span>&nbsp;<span class="op" id="5053410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5053415">panic</span><span class="op" id="5053420">(</span><span class="string" id="5053421">&#34;illegal&nbsp;Pos&nbsp;value&#34;</span><span class="op" id="5053440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5053444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5053448">pos</span>&nbsp;<span class="op" id="5053452">=</span>&nbsp;<span class="ident" id="5053454">f</span><span class="op" id="5053455">.</span><span class="ident" id="5053456">position</span><span class="op" id="5053464">(</span><span class="ident" id="5053465">p</span><span class="op" id="5053466">,</span>&nbsp;<span class="ident" id="5053468">adjusted</span><span class="op" id="5053476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5053479">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053482">return</span><br>
<span class="lineno"></span><span class="op" id="5053489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5053492">//&nbsp;Position&nbsp;returns&nbsp;the&nbsp;Position&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="5053562">//&nbsp;Calling&nbsp;f.Position(p)&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;calling&nbsp;f.PositionFor(p,&nbsp;true).</span><br>
<span class="lineno">310</span><span class="comment" id="5053636">//</span><br>
<span class="lineno"></span><span class="keyword" id="5053639">func</span>&nbsp;<span class="op" id="5053644">(</span><span class="ident" id="5053645">f</span>&nbsp;<span class="op" id="5053647">*</span><span class="ident" id="5053648">File</span><span class="op" id="5053652">)</span>&nbsp;<span class="ident" id="5053654">Position</span><span class="op" id="5053662">(</span><span class="ident" id="5053663">p</span>&nbsp;<span class="ident" id="5053665">Pos</span><span class="op" id="5053668">)</span>&nbsp;<span class="op" id="5053670">(</span><span class="ident" id="5053671">pos</span>&nbsp;<span class="ident" id="5053675">Position</span><span class="op" id="5053683">)</span>&nbsp;<span class="op" id="5053685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053688">return</span>&nbsp;<span class="ident" id="5053695">f</span><span class="op" id="5053696">.</span><span class="ident" id="5053697">PositionFor</span><span class="op" id="5053708">(</span><span class="ident" id="5053709">p</span><span class="op" id="5053710">,</span>&nbsp;<span class="ident" id="5053712">true</span><span class="op" id="5053716">)</span><br>
<span class="lineno"></span><span class="op" id="5053718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="comment" id="5053721">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5053802">//&nbsp;FileSet</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5053814">//&nbsp;A&nbsp;FileSet&nbsp;represents&nbsp;a&nbsp;set&nbsp;of&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="5053861">//&nbsp;Methods&nbsp;of&nbsp;file&nbsp;sets&nbsp;are&nbsp;synchronized;&nbsp;multiple&nbsp;goroutines</span><br>
<span class="lineno">320</span><span class="comment" id="5053923">//&nbsp;may&nbsp;invoke&nbsp;them&nbsp;concurrently.</span><br>
<span class="lineno"></span><span class="comment" id="5053956">//</span><br>
<span class="lineno"></span><span class="keyword" id="5053959">type</span>&nbsp;<span class="ident" id="5053964">FileSet</span>&nbsp;<span class="keyword" id="5053972">struct</span>&nbsp;<span class="op" id="5053979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5053982">mutex</span>&nbsp;<span class="ident" id="5053988">sync</span><span class="op" id="5053992">.</span><span class="ident" id="5053993">RWMutex</span>&nbsp;<span class="comment" id="5054001">//&nbsp;protects&nbsp;the&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054027">base</span>&nbsp;&nbsp;<span class="builtintype" id="5054033">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5054046">//&nbsp;base&nbsp;offset&nbsp;for&nbsp;the&nbsp;next&nbsp;file</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054080">files</span>&nbsp;<span class="op" id="5054086">[</span><span class="op" id="5054087">]</span><span class="op" id="5054088">*</span><span class="ident" id="5054089">File</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5054099">//&nbsp;list&nbsp;of&nbsp;files&nbsp;in&nbsp;the&nbsp;order&nbsp;added&nbsp;to&nbsp;the&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054147">last</span>&nbsp;&nbsp;<span class="op" id="5054153">*</span><span class="ident" id="5054154">File</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5054166">//&nbsp;cache&nbsp;of&nbsp;last&nbsp;file&nbsp;looked&nbsp;up</span><br>
<span class="lineno"></span><span class="op" id="5054198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5054201">//&nbsp;NewFileSet&nbsp;creates&nbsp;a&nbsp;new&nbsp;file&nbsp;set.</span><br>
<span class="lineno">330</span><span class="keyword" id="5054239">func</span>&nbsp;<span class="ident" id="5054244">NewFileSet</span><span class="op" id="5054254">(</span><span class="op" id="5054255">)</span>&nbsp;<span class="op" id="5054257">*</span><span class="ident" id="5054258">FileSet</span>&nbsp;<span class="op" id="5054266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054269">return</span>&nbsp;<span class="op" id="5054276">&amp;</span><span class="ident" id="5054277">FileSet</span><span class="op" id="5054284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054288">base</span><span class="op" id="5054292">:</span>&nbsp;<span class="num" id="5054294">1</span><span class="op" id="5054295">,</span>&nbsp;<span class="comment" id="5054297">//&nbsp;0&nbsp;==&nbsp;NoPos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5054312">}</span><br>
<span class="lineno"></span><span class="op" id="5054314">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span><span class="comment" id="5054317">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;base&nbsp;offset&nbsp;that&nbsp;must&nbsp;be&nbsp;provided&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5054382">//&nbsp;AddFile&nbsp;when&nbsp;adding&nbsp;the&nbsp;next&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="5054420">//</span><br>
<span class="lineno"></span><span class="keyword" id="5054423">func</span>&nbsp;<span class="op" id="5054428">(</span><span class="ident" id="5054429">s</span>&nbsp;<span class="op" id="5054431">*</span><span class="ident" id="5054432">FileSet</span><span class="op" id="5054439">)</span>&nbsp;<span class="ident" id="5054441">Base</span><span class="op" id="5054445">(</span><span class="op" id="5054446">)</span>&nbsp;<span class="builtintype" id="5054448">int</span>&nbsp;<span class="op" id="5054452">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054455">s</span><span class="op" id="5054456">.</span><span class="ident" id="5054457">mutex</span><span class="op" id="5054462">.</span><span class="ident" id="5054463">RLock</span><span class="op" id="5054468">(</span><span class="op" id="5054469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054472">b</span>&nbsp;<span class="op" id="5054474">:=</span>&nbsp;<span class="ident" id="5054477">s</span><span class="op" id="5054478">.</span><span class="ident" id="5054479">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054485">s</span><span class="op" id="5054486">.</span><span class="ident" id="5054487">mutex</span><span class="op" id="5054492">.</span><span class="ident" id="5054493">RUnlock</span><span class="op" id="5054500">(</span><span class="op" id="5054501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054504">return</span>&nbsp;<span class="ident" id="5054511">b</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="op" id="5054514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5054517">//&nbsp;AddFile&nbsp;adds&nbsp;a&nbsp;new&nbsp;file&nbsp;with&nbsp;a&nbsp;given&nbsp;filename,&nbsp;base&nbsp;offset,&nbsp;and&nbsp;file&nbsp;size</span><br>
<span class="lineno"></span><span class="comment" id="5054594">//&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;s&nbsp;and&nbsp;returns&nbsp;the&nbsp;file.&nbsp;Multiple&nbsp;files&nbsp;may&nbsp;have&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="5054670">//&nbsp;name.&nbsp;The&nbsp;base&nbsp;offset&nbsp;must&nbsp;not&nbsp;be&nbsp;smaller&nbsp;than&nbsp;the&nbsp;FileSet&#39;s&nbsp;Base(),&nbsp;and</span><br>
<span class="lineno">350</span><span class="comment" id="5054746">//&nbsp;size&nbsp;must&nbsp;not&nbsp;be&nbsp;negative.&nbsp;As&nbsp;a&nbsp;special&nbsp;case,&nbsp;if&nbsp;a&nbsp;negative&nbsp;base&nbsp;is&nbsp;provided,</span><br>
<span class="lineno"></span><span class="comment" id="5054827">//&nbsp;the&nbsp;current&nbsp;value&nbsp;of&nbsp;the&nbsp;FileSet&#39;s&nbsp;Base()&nbsp;is&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="5054889">//</span><br>
<span class="lineno"></span><span class="comment" id="5054892">//&nbsp;Adding&nbsp;the&nbsp;file&nbsp;will&nbsp;set&nbsp;the&nbsp;file&nbsp;set&#39;s&nbsp;Base()&nbsp;value&nbsp;to&nbsp;base&nbsp;+&nbsp;size&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="5054967">//&nbsp;as&nbsp;the&nbsp;minimum&nbsp;base&nbsp;value&nbsp;for&nbsp;the&nbsp;next&nbsp;file.&nbsp;The&nbsp;following&nbsp;relationship</span><br>
<span class="lineno">355</span><span class="comment" id="5055042">//&nbsp;exists&nbsp;between&nbsp;a&nbsp;Pos&nbsp;value&nbsp;p&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;offset&nbsp;offs:</span><br>
<span class="lineno"></span><span class="comment" id="5055104">//</span><br>
<span class="lineno"></span><span class="comment" id="5055107">//&nbsp;&nbsp;&nbsp;&nbspint(p)&nbsp;=&nbsp;base&nbsp;+&nbsp;offs</span><br>
<span class="lineno"></span><span class="comment" id="5055131">//</span><br>
<span class="lineno"></span><span class="comment" id="5055134">//&nbsp;with&nbsp;offs&nbsp;in&nbsp;the&nbsp;range&nbsp;[0,&nbsp;size]&nbsp;and&nbsp;thus&nbsp;p&nbsp;in&nbsp;the&nbsp;range&nbsp;[base,&nbsp;base+size].</span><br>
<span class="lineno">360</span><span class="comment" id="5055213">//&nbsp;For&nbsp;convenience,&nbsp;File.Pos&nbsp;may&nbsp;be&nbsp;used&nbsp;to&nbsp;create&nbsp;file-specific&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="5055287">//&nbsp;values&nbsp;from&nbsp;a&nbsp;file&nbsp;offset.</span><br>
<span class="lineno"></span><span class="comment" id="5055317">//</span><br>
<span class="lineno"></span><span class="keyword" id="5055320">func</span>&nbsp;<span class="op" id="5055325">(</span><span class="ident" id="5055326">s</span>&nbsp;<span class="op" id="5055328">*</span><span class="ident" id="5055329">FileSet</span><span class="op" id="5055336">)</span>&nbsp;<span class="ident" id="5055338">AddFile</span><span class="op" id="5055345">(</span><span class="ident" id="5055346">filename</span>&nbsp;<span class="builtintype" id="5055355">string</span><span class="op" id="5055361">,</span>&nbsp;<span class="ident" id="5055363">base</span><span class="op" id="5055367">,</span>&nbsp;<span class="ident" id="5055369">size</span>&nbsp;<span class="builtintype" id="5055374">int</span><span class="op" id="5055377">)</span>&nbsp;<span class="op" id="5055379">*</span><span class="ident" id="5055380">File</span>&nbsp;<span class="op" id="5055385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5055388">s</span><span class="op" id="5055389">.</span><span class="ident" id="5055390">mutex</span><span class="op" id="5055395">.</span><span class="ident" id="5055396">Lock</span><span class="op" id="5055400">(</span><span class="op" id="5055401">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055404">defer</span>&nbsp;<span class="ident" id="5055410">s</span><span class="op" id="5055411">.</span><span class="ident" id="5055412">mutex</span><span class="op" id="5055417">.</span><span class="ident" id="5055418">Unlock</span><span class="op" id="5055424">(</span><span class="op" id="5055425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055428">if</span>&nbsp;<span class="ident" id="5055431">base</span>&nbsp;<span class="op" id="5055436">&lt;</span>&nbsp;<span class="num" id="5055438">0</span>&nbsp;<span class="op" id="5055440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5055444">base</span>&nbsp;<span class="op" id="5055449">=</span>&nbsp;<span class="ident" id="5055451">s</span><span class="op" id="5055452">.</span><span class="ident" id="5055453">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5055459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055462">if</span>&nbsp;<span class="ident" id="5055465">base</span>&nbsp;<span class="op" id="5055470">&lt;</span>&nbsp;<span class="ident" id="5055472">s</span><span class="op" id="5055473">.</span><span class="ident" id="5055474">base</span>&nbsp;<span class="op" id="5055479">||</span>&nbsp;<span class="ident" id="5055482">size</span>&nbsp;<span class="op" id="5055487">&lt;</span>&nbsp;<span class="num" id="5055489">0</span>&nbsp;<span class="op" id="5055491">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5055495">panic</span><span class="op" id="5055500">(</span><span class="string" id="5055501">&#34;illegal&nbsp;base&nbsp;or&nbsp;size&#34;</span><span class="op" id="5055523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5055526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5055529">//&nbsp;base&nbsp;&gt;=&nbsp;s.base&nbsp;&amp;&amp;&nbsp;size&nbsp;&gt;=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5055561">f</span>&nbsp;<span class="op" id="5055563">:=</span>&nbsp;<span class="op" id="5055566">&amp;</span><span class="ident" id="5055567">File</span><span class="op" id="5055571">{</span><span class="ident" id="5055572">s</span><span class="op" id="5055573">,</span>&nbsp;<span class="ident" id="5055575">filename</span><span class="op" id="5055583">,</span>&nbsp;<span class="ident" id="5055585">base</span><span class="op" id="5055589">,</span>&nbsp;<span class="ident" id="5055591">size</span><span class="op" id="5055595">,</span>&nbsp;<span class="op" id="5055597">[</span><span class="op" id="5055598">]</span><span class="builtintype" id="5055599">int</span><span class="op" id="5055602">{</span><span class="num" id="5055603">0</span><span class="op" id="5055604">}</span><span class="op" id="5055605">,</span>&nbsp;<span class="ident" id="5055607">nil</span><span class="op" id="5055610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5055613">base</span>&nbsp;<span class="op" id="5055618">+=</span>&nbsp;<span class="ident" id="5055621">size</span>&nbsp;<span class="op" id="5055626">+</span>&nbsp;<span class="num" id="5055628">1</span>&nbsp;<span class="comment" id="5055630">//&nbsp;+1&nbsp;because&nbsp;EOF&nbsp;also&nbsp;has&nbsp;a&nbsp;position</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055669">if</span>&nbsp;<span class="ident" id="5055672">base</span>&nbsp;<span class="op" id="5055677">&lt;</span>&nbsp;<span class="num" id="5055679">0</span>&nbsp;<span class="op" id="5055681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5055685">panic</span><span class="op" id="5055690">(</span><span class="string" id="5055691">&#34;token.Pos&nbsp;offset&nbsp;overflow&nbsp;(&gt;&nbsp;2G&nbsp;of&nbsp;source&nbsp;code&nbsp;in&nbsp;file&nbsp;set)&#34;</span><span class="op" id="5055752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5055755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5055758">//&nbsp;add&nbsp;the&nbsp;file&nbsp;to&nbsp;the&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5055791">s</span><span class="op" id="5055792">.</span><span class="ident" id="5055793">base</span>&nbsp;<span class="op" id="5055798">=</span>&nbsp;<span class="ident" id="5055800">base</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5055806">s</span><span class="op" id="5055807">.</span><span class="ident" id="5055808">files</span>&nbsp;<span class="op" id="5055814">=</span>&nbsp;<span class="builtinfunc" id="5055816">append</span><span class="op" id="5055822">(</span><span class="ident" id="5055823">s</span><span class="op" id="5055824">.</span><span class="ident" id="5055825">files</span><span class="op" id="5055830">,</span>&nbsp;<span class="ident" id="5055832">f</span><span class="op" id="5055833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5055836">s</span><span class="op" id="5055837">.</span><span class="ident" id="5055838">last</span>&nbsp;<span class="op" id="5055843">=</span>&nbsp;<span class="ident" id="5055845">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5055848">return</span>&nbsp;<span class="ident" id="5055855">f</span><br>
<span class="lineno"></span><span class="op" id="5055857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="5055860">//&nbsp;Iterate&nbsp;calls&nbsp;f&nbsp;for&nbsp;the&nbsp;files&nbsp;in&nbsp;the&nbsp;file&nbsp;set&nbsp;in&nbsp;the&nbsp;order&nbsp;they&nbsp;were&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="5055938">//&nbsp;until&nbsp;f&nbsp;returns&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="5055964">//</span><br>
<span class="lineno"></span><span class="keyword" id="5055967">func</span>&nbsp;<span class="op" id="5055972">(</span><span class="ident" id="5055973">s</span>&nbsp;<span class="op" id="5055975">*</span><span class="ident" id="5055976">FileSet</span><span class="op" id="5055983">)</span>&nbsp;<span class="ident" id="5055985">Iterate</span><span class="op" id="5055992">(</span><span class="ident" id="5055993">f</span>&nbsp;<span class="keyword" id="5055995">func</span><span class="op" id="5055999">(</span><span class="op" id="5056000">*</span><span class="ident" id="5056001">File</span><span class="op" id="5056005">)</span>&nbsp;<span class="builtintype" id="5056007">bool</span><span class="op" id="5056011">)</span>&nbsp;<span class="op" id="5056013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5056016">for</span>&nbsp;<span class="ident" id="5056020">i</span>&nbsp;<span class="op" id="5056022">:=</span>&nbsp;<span class="num" id="5056025">0</span><span class="op" id="5056026">;</span>&nbsp;<span class="op" id="5056028">;</span>&nbsp;<span class="ident" id="5056030">i</span><span class="op" id="5056031">++</span>&nbsp;<span class="op" id="5056034">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5056038">var</span>&nbsp;<span class="ident" id="5056042">file</span>&nbsp;<span class="op" id="5056047">*</span><span class="ident" id="5056048">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5056055">s</span><span class="op" id="5056056">.</span><span class="ident" id="5056057">mutex</span><span class="op" id="5056062">.</span><span class="ident" id="5056063">RLock</span><span class="op" id="5056068">(</span><span class="op" id="5056069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5056073">if</span>&nbsp;<span class="ident" id="5056076">i</span>&nbsp;<span class="op" id="5056078">&lt;</span>&nbsp;<span class="builtinfunc" id="5056080">len</span><span class="op" id="5056083">(</span><span class="ident" id="5056084">s</span><span class="op" id="5056085">.</span><span class="ident" id="5056086">files</span><span class="op" id="5056091">)</span>&nbsp;<span class="op" id="5056093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5056098">file</span>&nbsp;<span class="op" id="5056103">=</span>&nbsp;<span class="ident" id="5056105">s</span><span class="op" id="5056106">.</span><span class="ident" id="5056107">files</span><span class="op" id="5056112">[</span><span class="ident" id="5056113">i</span><span class="op" id="5056114">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5056118">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5056122">s</span><span class="op" id="5056123">.</span><span class="ident" id="5056124">mutex</span><span class="op" id="5056129">.</span><span class="ident" id="5056130">RUnlock</span><span class="op" id="5056137">(</span><span class="op" id="5056138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5056142">if</span>&nbsp;<span class="ident" id="5056145">file</span>&nbsp;<span class="op" id="5056150">==</span>&nbsp;<span class="ident" id="5056153">nil</span>&nbsp;<span class="op" id="5056157">||</span>&nbsp;<span class="op" id="5056160">!</span><span class="ident" id="5056161">f</span><span class="op" id="5056162">(</span><span class="ident" id="5056163">file</span><span class="op" id="5056167">)</span>&nbsp;<span class="op" id="5056169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5056174">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5056182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5056185">}</span><br>
<span class="lineno">400</span><span class="op" id="5056187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5056190">func</span>&nbsp;<span class="ident" id="5056195">searchFiles</span><span class="op" id="5056206">(</span><span class="ident" id="5056207">a</span>&nbsp;<span class="op" id="5056209">[</span><span class="op" id="5056210">]</span><span class="op" id="5056211">*</span><span class="ident" id="5056212">File</span><span class="op" id="5056216">,</span>&nbsp;<span class="ident" id="5056218">x</span>&nbsp;<span class="builtintype" id="5056220">int</span><span class="op" id="5056223">)</span>&nbsp;<span class="builtintype" id="5056225">int</span>&nbsp;<span class="op" id="5056229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5056232">return</span>&nbsp;<span class="ident" id="5056239">sort</span><span class="op" id="5056243">.</span><span class="ident" id="5056244">Search</span><span class="op" id="5056250">(</span><span class="builtinfunc" id="5056251">len</span><span class="op" id="5056254">(</span><span class="ident" id="5056255">a</span><span class="op" id="5056256">)</span><span class="op" id="5056257">,</span>&nbsp;<span class="keyword" id="5056259">func</span><span class="op" id="5056263">(</span><span class="ident" id="5056264">i</span>&nbsp;<span class="builtintype" id="5056266">int</span><span class="op" id="5056269">)</span>&nbsp;<span class="builtintype" id="5056271">bool</span>&nbsp;<span class="op" id="5056276">{</span>&nbsp;<span class="keyword" id="5056278">return</span>&nbsp;<span class="ident" id="5056285">a</span><span class="op" id="5056286">[</span><span class="ident" id="5056287">i</span><span class="op" id="5056288">]</span><span class="op" id="5056289">.</span><span class="ident" id="5056290">base</span>&nbsp;<span class="op" id="5056295">&gt;</span>&nbsp;<span class="ident" id="5056297">x</span>&nbsp;<span class="op" id="5056299">}</span><span class="op" id="5056300">)</span>&nbsp;<span class="op" id="5056302">-</span>&nbsp;<span class="num" id="5056304">1</span><br>
<span class="lineno"></span><span class="op" id="5056306">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="5056309">func</span>&nbsp;<span class="op" id="5056314">(</span><span class="ident" id="5056315">s</span>&nbsp;<span class="op" id="5056317">*</span><span class="ident" id="5056318">FileSet</span><span class="op" id="5056325">)</span>&nbsp;<span class="ident" id="5056327">file</span><span class="op" id="5056331">(</span><span class="ident" id="5056332">p</span>&nbsp;<span class="ident" id="5056334">Pos</span><span class="op" id="5056337">)</span>&nbsp;<span class="op" id="5056339">*</span><span class="ident" id="5056340">File</span>&nbsp;<span class="op" id="5056345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5056348">s</span><span class="op" id="5056349">.</span><span class="ident" id="5056350">mutex</span><span class="op" id="5056355">.</span><span class="ident" id="5056356">RLock</span><span class="op" id="5056361">(</span><span class="op" id="5056362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5056365">//&nbsp;common&nbsp;case:&nbsp;p&nbsp;is&nbsp;in&nbsp;last&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5056400">if</span>&nbsp;<span class="ident" id="5056403">f</span>&nbsp;<span class="op" id="5056405">:=</span>&nbsp;<span class="ident" id="5056408">s</span><span class="op" id="5056409">.</span><span class="ident" id="5056410">last</span><span class="op" id="5056414">;</span>&nbsp;<span class="ident" id="5056416">f</span>&nbsp;<span class="op" id="5056418">!=</span>&nbsp;<span class="ident" id="5056421">nil</span>&nbsp;<span class="op" id="5056425">&amp;&amp;</span>&nbsp;<span class="ident" id="5056428">f</span><span class="op" id="5056429">.</span><span class="ident" id="5056430">base</span>&nbsp;<span class="op" id="5056435">&lt;=</span>&nbsp;<span class="builtintype" id="5056438">int</span><span class="op" id="5056441">(</span><span class="ident" id="5056442">p</span><span class="op" id="5056443">)</span>&nbsp;<span class="op" id="5056445">&amp;&amp;</span>&nbsp;<span class="builtintype" id="5056448">int</span><span class="op" id="5056451">(</span><span class="ident" id="5056452">p</span><span class="op" id="5056453">)</span>&nbsp;<span class="op" id="5056455">&lt;=</span>&nbsp;<span class="ident" id="5056458">f</span><span class="op" id="5056459">.</span><span class="ident" id="5056460">base</span><span class="op" id="5056464">+</span><span class="ident" id="5056465">f</span><span class="op" id="5056466">.</span><span class="ident" id="5056467">size</span>&nbsp;<span class="op" id="5056472">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5056476">s</span><span class="op" id="5056477">.</span><span class="ident" id="5056478">mutex</span><span class="op" id="5056483">.</span><span class="ident" id="5056484">RUnlock</span><span class="op" id="5056491">(</span><span class="op" id="5056492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5056496">return</span>&nbsp;<span class="ident" id="5056503">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5056506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5056509">//&nbsp;p&nbsp;is&nbsp;not&nbsp;in&nbsp;last&nbsp;file&nbsp;-&nbsp;search&nbsp;all&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5056554">if</span>&nbsp;<span class="ident" id="5056557">i</span>&nbsp;<span class="op" id="5056559">:=</span>&nbsp;<span class="ident" id="5056562">searchFiles</span><span class="op" id="5056573">(</span><span class="ident" id="5056574">s</span><span class="op" id="5056575">.</span><span class="ident" id="5056576">files</span><span class="op" id="5056581">,</span>&nbsp;<span class="builtintype" id="5056583">int</span><span class="op" id="5056586">(</span><span class="ident" id="5056587">p</span><span class="op" id="5056588">)</span><span class="op" id="5056589">)</span><span class="op" id="5056590">;</span>&nbsp;<span class="ident" id="5056592">i</span>&nbsp;<span class="op" id="5056594">&gt;=</span>&nbsp;<span class="num" id="5056597">0</span>&nbsp;<span class="op" id="5056599">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5056603">f</span>&nbsp;<span class="op" id="5056605">:=</span>&nbsp;<span class="ident" id="5056608">s</span><span class="op" id="5056609">.</span><span class="ident" id="5056610">files</span><span class="op" id="5056615">[</span><span class="ident" id="5056616">i</span><span class="op" id="5056617">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5056621">//&nbsp;f.base&nbsp;&lt;=&nbsp;int(p)&nbsp;by&nbsp;definition&nbsp;of&nbsp;searchFiles</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5056672">if</span>&nbsp;<span class="builtintype" id="5056675">int</span><span class="op" id="5056678">(</span><span class="ident" id="5056679">p</span><span class="op" id="5056680">)</span>&nbsp;<span class="op" id="5056682">&lt;=</span>&nbsp;<span class="ident" id="5056685">f</span><span class="op" id="5056686">.</span><span class="ident" id="5056687">base</span><span class="op" id="5056691">+</span><span class="ident" id="5056692">f</span><span class="op" id="5056693">.</span><span class="ident" id="5056694">size</span>&nbsp;<span class="op" id="5056699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5056704">s</span><span class="op" id="5056705">.</span><span class="ident" id="5056706">mutex</span><span class="op" id="5056711">.</span><span class="ident" id="5056712">RUnlock</span><span class="op" id="5056719">(</span><span class="op" id="5056720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5056725">s</span><span class="op" id="5056726">.</span><span class="ident" id="5056727">mutex</span><span class="op" id="5056732">.</span><span class="ident" id="5056733">Lock</span><span class="op" id="5056737">(</span><span class="op" id="5056738">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5056743">s</span><span class="op" id="5056744">.</span><span class="ident" id="5056745">last</span>&nbsp;<span class="op" id="5056750">=</span>&nbsp;<span class="ident" id="5056752">f</span>&nbsp;<span class="comment" id="5056754">//&nbsp;race&nbsp;is&nbsp;ok&nbsp;-&nbsp;s.last&nbsp;is&nbsp;only&nbsp;a&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5056796">s</span><span class="op" id="5056797">.</span><span class="ident" id="5056798">mutex</span><span class="op" id="5056803">.</span><span class="ident" id="5056804">Unlock</span><span class="op" id="5056810">(</span><span class="op" id="5056811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5056816">return</span>&nbsp;<span class="ident" id="5056823">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5056827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5056830">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5056833">s</span><span class="op" id="5056834">.</span><span class="ident" id="5056835">mutex</span><span class="op" id="5056840">.</span><span class="ident" id="5056841">RUnlock</span><span class="op" id="5056848">(</span><span class="op" id="5056849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5056852">return</span>&nbsp;<span class="ident" id="5056859">nil</span><br>
<span class="lineno"></span><span class="op" id="5056863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5056866">//&nbsp;File&nbsp;returns&nbsp;the&nbsp;file&nbsp;that&nbsp;contains&nbsp;the&nbsp;position&nbsp;p.</span><br>
<span class="lineno">430</span><span class="comment" id="5056921">//&nbsp;If&nbsp;no&nbsp;such&nbsp;file&nbsp;is&nbsp;found&nbsp;(for&nbsp;instance&nbsp;for&nbsp;p&nbsp;==&nbsp;NoPos),</span><br>
<span class="lineno"></span><span class="comment" id="5056980">//&nbsp;the&nbsp;result&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="5057002">//</span><br>
<span class="lineno"></span><span class="keyword" id="5057005">func</span>&nbsp;<span class="op" id="5057010">(</span><span class="ident" id="5057011">s</span>&nbsp;<span class="op" id="5057013">*</span><span class="ident" id="5057014">FileSet</span><span class="op" id="5057021">)</span>&nbsp;<span class="ident" id="5057023">File</span><span class="op" id="5057027">(</span><span class="ident" id="5057028">p</span>&nbsp;<span class="ident" id="5057030">Pos</span><span class="op" id="5057033">)</span>&nbsp;<span class="op" id="5057035">(</span><span class="ident" id="5057036">f</span>&nbsp;<span class="op" id="5057038">*</span><span class="ident" id="5057039">File</span><span class="op" id="5057043">)</span>&nbsp;<span class="op" id="5057045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5057048">if</span>&nbsp;<span class="ident" id="5057051">p</span>&nbsp;<span class="op" id="5057053">!=</span>&nbsp;<span class="ident" id="5057056">NoPos</span>&nbsp;<span class="op" id="5057062">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5057066">f</span>&nbsp;<span class="op" id="5057068">=</span>&nbsp;<span class="ident" id="5057070">s</span><span class="op" id="5057071">.</span><span class="ident" id="5057072">file</span><span class="op" id="5057076">(</span><span class="ident" id="5057077">p</span><span class="op" id="5057078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5057081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5057084">return</span><br>
<span class="lineno"></span><span class="op" id="5057091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span><span class="comment" id="5057094">//&nbsp;PositionFor&nbsp;converts&nbsp;a&nbsp;Pos&nbsp;p&nbsp;in&nbsp;the&nbsp;fileset&nbsp;into&nbsp;a&nbsp;Position&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5057164">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;the&nbsp;position&nbsp;may&nbsp;be&nbsp;adjusted&nbsp;by&nbsp;position-altering</span><br>
<span class="lineno"></span><span class="comment" id="5057237">//&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="5057295">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;s&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno"></span><span class="comment" id="5057335">//</span><br>
<span class="lineno">445</span><span class="keyword" id="5057338">func</span>&nbsp;<span class="op" id="5057343">(</span><span class="ident" id="5057344">s</span>&nbsp;<span class="op" id="5057346">*</span><span class="ident" id="5057347">FileSet</span><span class="op" id="5057354">)</span>&nbsp;<span class="ident" id="5057356">PositionFor</span><span class="op" id="5057367">(</span><span class="ident" id="5057368">p</span>&nbsp;<span class="ident" id="5057370">Pos</span><span class="op" id="5057373">,</span>&nbsp;<span class="ident" id="5057375">adjusted</span>&nbsp;<span class="builtintype" id="5057384">bool</span><span class="op" id="5057388">)</span>&nbsp;<span class="op" id="5057390">(</span><span class="ident" id="5057391">pos</span>&nbsp;<span class="ident" id="5057395">Position</span><span class="op" id="5057403">)</span>&nbsp;<span class="op" id="5057405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5057408">if</span>&nbsp;<span class="ident" id="5057411">p</span>&nbsp;<span class="op" id="5057413">!=</span>&nbsp;<span class="ident" id="5057416">NoPos</span>&nbsp;<span class="op" id="5057422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5057426">if</span>&nbsp;<span class="ident" id="5057429">f</span>&nbsp;<span class="op" id="5057431">:=</span>&nbsp;<span class="ident" id="5057434">s</span><span class="op" id="5057435">.</span><span class="ident" id="5057436">file</span><span class="op" id="5057440">(</span><span class="ident" id="5057441">p</span><span class="op" id="5057442">)</span><span class="op" id="5057443">;</span>&nbsp;<span class="ident" id="5057445">f</span>&nbsp;<span class="op" id="5057447">!=</span>&nbsp;<span class="ident" id="5057450">nil</span>&nbsp;<span class="op" id="5057454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5057459">pos</span>&nbsp;<span class="op" id="5057463">=</span>&nbsp;<span class="ident" id="5057465">f</span><span class="op" id="5057466">.</span><span class="ident" id="5057467">position</span><span class="op" id="5057475">(</span><span class="ident" id="5057476">p</span><span class="op" id="5057477">,</span>&nbsp;<span class="ident" id="5057479">adjusted</span><span class="op" id="5057487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5057491">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5057494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5057497">return</span><br>
<span class="lineno"></span><span class="op" id="5057504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5057507">//&nbsp;Position&nbsp;converts&nbsp;a&nbsp;Pos&nbsp;p&nbsp;in&nbsp;the&nbsp;fileset&nbsp;into&nbsp;a&nbsp;Position&nbsp;value.</span><br>
<span class="lineno">455</span><span class="comment" id="5057574">//&nbsp;Calling&nbsp;s.Position(p)&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;calling&nbsp;s.PositionFor(p,&nbsp;true).</span><br>
<span class="lineno"></span><span class="comment" id="5057648">//</span><br>
<span class="lineno"></span><span class="keyword" id="5057651">func</span>&nbsp;<span class="op" id="5057656">(</span><span class="ident" id="5057657">s</span>&nbsp;<span class="op" id="5057659">*</span><span class="ident" id="5057660">FileSet</span><span class="op" id="5057667">)</span>&nbsp;<span class="ident" id="5057669">Position</span><span class="op" id="5057677">(</span><span class="ident" id="5057678">p</span>&nbsp;<span class="ident" id="5057680">Pos</span><span class="op" id="5057683">)</span>&nbsp;<span class="op" id="5057685">(</span><span class="ident" id="5057686">pos</span>&nbsp;<span class="ident" id="5057690">Position</span><span class="op" id="5057698">)</span>&nbsp;<span class="op" id="5057700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5057703">return</span>&nbsp;<span class="ident" id="5057710">s</span><span class="op" id="5057711">.</span><span class="ident" id="5057712">PositionFor</span><span class="op" id="5057723">(</span><span class="ident" id="5057724">p</span><span class="op" id="5057725">,</span>&nbsp;<span class="ident" id="5057727">true</span><span class="op" id="5057731">)</span><br>
<span class="lineno"></span><span class="op" id="5057733">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span><span class="comment" id="5057736">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5057817">//&nbsp;Helper&nbsp;functions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5057838">func</span>&nbsp;<span class="ident" id="5057843">searchInts</span><span class="op" id="5057853">(</span><span class="ident" id="5057854">a</span>&nbsp;<span class="op" id="5057856">[</span><span class="op" id="5057857">]</span><span class="builtintype" id="5057858">int</span><span class="op" id="5057861">,</span>&nbsp;<span class="ident" id="5057863">x</span>&nbsp;<span class="builtintype" id="5057865">int</span><span class="op" id="5057868">)</span>&nbsp;<span class="builtintype" id="5057870">int</span>&nbsp;<span class="op" id="5057874">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5057877">//&nbsp;This&nbsp;function&nbsp;body&nbsp;is&nbsp;a&nbsp;manually&nbsp;inlined&nbsp;version&nbsp;of:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5057934">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5057938">//&nbsp;&nbsp;&nbsp;return&nbsp;sort.Search(len(a),&nbsp;func(i&nbsp;int)&nbsp;bool&nbsp;{&nbsp;return&nbsp;a[i]&nbsp;&gt;&nbsp;x&nbsp;})&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5058013">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5058017">//&nbsp;With&nbsp;better&nbsp;compiler&nbsp;optimizations,&nbsp;this&nbsp;may&nbsp;not&nbsp;be&nbsp;needed&nbsp;in&nbsp;the</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5058087">//&nbsp;future,&nbsp;but&nbsp;at&nbsp;the&nbsp;moment&nbsp;this&nbsp;change&nbsp;improves&nbsp;the&nbsp;go/printer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5058153">//&nbsp;benchmark&nbsp;performance&nbsp;by&nbsp;~30%.&nbsp;This&nbsp;has&nbsp;a&nbsp;direct&nbsp;impact&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5058220">//&nbsp;speed&nbsp;of&nbsp;gofmt&nbsp;and&nbsp;thus&nbsp;seems&nbsp;worthwhile&nbsp;(2011-04-29).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5058279">//&nbsp;TODO(gri):&nbsp;Remove&nbsp;this&nbsp;when&nbsp;compilers&nbsp;have&nbsp;caught&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5058337">i</span><span class="op" id="5058338">,</span>&nbsp;<span class="ident" id="5058340">j</span>&nbsp;<span class="op" id="5058342">:=</span>&nbsp;<span class="num" id="5058345">0</span><span class="op" id="5058346">,</span>&nbsp;<span class="builtinfunc" id="5058348">len</span><span class="op" id="5058351">(</span><span class="ident" id="5058352">a</span><span class="op" id="5058353">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5058356">for</span>&nbsp;<span class="ident" id="5058360">i</span>&nbsp;<span class="op" id="5058362">&lt;</span>&nbsp;<span class="ident" id="5058364">j</span>&nbsp;<span class="op" id="5058366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5058370">h</span>&nbsp;<span class="op" id="5058372">:=</span>&nbsp;<span class="ident" id="5058375">i</span>&nbsp;<span class="op" id="5058377">+</span>&nbsp;<span class="op" id="5058379">(</span><span class="ident" id="5058380">j</span><span class="op" id="5058381">-</span><span class="ident" id="5058382">i</span><span class="op" id="5058383">)</span><span class="op" id="5058384">/</span><span class="num" id="5058385">2</span>&nbsp;<span class="comment" id="5058387">//&nbsp;avoid&nbsp;overflow&nbsp;when&nbsp;computing&nbsp;h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5058424">//&nbsp;i&nbsp;&nbsp;h&nbsp;&lt;&nbsp;j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5058441">if</span>&nbsp;<span class="ident" id="5058444">a</span><span class="op" id="5058445">[</span><span class="ident" id="5058446">h</span><span class="op" id="5058447">]</span>&nbsp;<span class="op" id="5058449">&lt;=</span>&nbsp;<span class="ident" id="5058452">x</span>&nbsp;<span class="op" id="5058454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5058459">i</span>&nbsp;<span class="op" id="5058461">=</span>&nbsp;<span class="ident" id="5058463">h</span>&nbsp;<span class="op" id="5058465">+</span>&nbsp;<span class="num" id="5058467">1</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5058471">}</span>&nbsp;<span class="keyword" id="5058473">else</span>&nbsp;<span class="op" id="5058478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5058483">j</span>&nbsp;<span class="op" id="5058485">=</span>&nbsp;<span class="ident" id="5058487">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5058491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5058494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5058497">return</span>&nbsp;<span class="ident" id="5058504">i</span>&nbsp;<span class="op" id="5058506">-</span>&nbsp;<span class="num" id="5058508">1</span><br>
<span class="lineno">485</span><span class="op" id="5058510">}</span>
</div>
</body>
</html>
