<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>sync/atomic</h2>
<ul>
<li><a href="/gostd/sync/atomic/atomic_test.go.html">atomic_test.go</a></li>
<li><a href="/gostd/sync/atomic/doc.go.html" class="current">doc.go</a></li>
<li><a href="/gostd/sync/atomic/value.go.html">value.go</a></li>
<li><a href="/gostd/sync/atomic/value_test.go.html">value_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1422754">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1422810">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1422864">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1422915">//&nbsp;Package&nbsp;atomic&nbsp;provides&nbsp;low-level&nbsp;atomic&nbsp;memory&nbsp;primitives</span><br>
<span class="lineno"></span><span class="comment" id="1422977">//&nbsp;useful&nbsp;for&nbsp;implementing&nbsp;synchronization&nbsp;algorithms.</span><br>
<span class="lineno"></span><span class="comment" id="1423032">//</span><br>
<span class="lineno"></span><span class="comment" id="1423035">//&nbsp;These&nbsp;functions&nbsp;require&nbsp;great&nbsp;care&nbsp;to&nbsp;be&nbsp;used&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="comment" id="1423095">//&nbsp;Except&nbsp;for&nbsp;special,&nbsp;low-level&nbsp;applications,&nbsp;synchronization&nbsp;is&nbsp;better</span><br>
<span class="lineno">10</span><span class="comment" id="1423168">//&nbsp;done&nbsp;with&nbsp;channels&nbsp;or&nbsp;the&nbsp;facilities&nbsp;of&nbsp;the&nbsp;sync&nbsp;package.</span><br>
<span class="lineno"></span><span class="comment" id="1423229">//&nbsp;Share&nbsp;memory&nbsp;by&nbsp;communicating;</span><br>
<span class="lineno"></span><span class="comment" id="1423263">//&nbsp;don&#39;t&nbsp;communicate&nbsp;by&nbsp;sharing&nbsp;memory.</span><br>
<span class="lineno"></span><span class="comment" id="1423303">//</span><br>
<span class="lineno"></span><span class="comment" id="1423306">//&nbsp;The&nbsp;swap&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;SwapT&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic</span><br>
<span class="lineno">15</span><span class="comment" id="1423379">//&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1423397">//</span><br>
<span class="lineno"></span><span class="comment" id="1423400">//&nbsp;&nbsp;&nbsp;&nbsp;old&nbsp;=&nbsp;*addr</span><br>
<span class="lineno"></span><span class="comment" id="1423415">//&nbsp;&nbsp;&nbsp;&nbsp;*addr&nbsp;=&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="1423430">//&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;old</span><br>
<span class="lineno">20</span><span class="comment" id="1423444">//</span><br>
<span class="lineno"></span><span class="comment" id="1423447">//&nbsp;The&nbsp;compare-and-swap&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;CompareAndSwapT</span><br>
<span class="lineno"></span><span class="comment" id="1423517">//&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1423560">//</span><br>
<span class="lineno"></span><span class="comment" id="1423563">//&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;*addr&nbsp;==&nbsp;old&nbsp;{</span><br>
<span class="lineno">25</span><span class="comment" id="1423584">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*addr&nbsp;=&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="1423600">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true</span><br>
<span class="lineno"></span><span class="comment" id="1423616">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="1423621">//&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false</span><br>
<span class="lineno"></span><span class="comment" id="1423637">//</span><br>
<span class="lineno">30</span><span class="comment" id="1423640">//&nbsp;The&nbsp;add&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;AddT&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic</span><br>
<span class="lineno"></span><span class="comment" id="1423711">//&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1423729">//</span><br>
<span class="lineno"></span><span class="comment" id="1423732">//&nbsp;&nbsp;&nbsp;&nbsp;*addr&nbsp;+=&nbsp;delta</span><br>
<span class="lineno"></span><span class="comment" id="1423750">//&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;*addr</span><br>
<span class="lineno">35</span><span class="comment" id="1423766">//</span><br>
<span class="lineno"></span><span class="comment" id="1423769">//&nbsp;The&nbsp;load&nbsp;and&nbsp;store&nbsp;operations,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;LoadT&nbsp;and&nbsp;StoreT</span><br>
<span class="lineno"></span><span class="comment" id="1423839">//&nbsp;functions,&nbsp;are&nbsp;the&nbsp;atomic&nbsp;equivalents&nbsp;of&nbsp;&#34;return&nbsp;*addr&#34;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1423902">//&nbsp;&#34;*addr&nbsp;=&nbsp;val&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="1423920">//</span><br>
<span class="lineno">40</span><span class="keyword" id="1423923">package</span>&nbsp;<span class="ident" id="1423931">atomic</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1423939">import</span>&nbsp;<span class="op" id="1423946">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1423949">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1423958">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="1423961">//&nbsp;BUG(rsc):&nbsp;On&nbsp;x86-32,&nbsp;the&nbsp;64-bit&nbsp;functions&nbsp;use&nbsp;instructions&nbsp;unavailable&nbsp;before&nbsp;the&nbsp;Pentium&nbsp;MMX.</span><br>
<span class="lineno"></span><span class="comment" id="1424059">//</span><br>
<span class="lineno"></span><span class="comment" id="1424062">//&nbsp;On&nbsp;non-Linux&nbsp;ARM,&nbsp;the&nbsp;64-bit&nbsp;functions&nbsp;use&nbsp;instructions&nbsp;unavailable&nbsp;before&nbsp;the&nbsp;ARMv6k&nbsp;core.</span><br>
<span class="lineno"></span><span class="comment" id="1424157">//</span><br>
<span class="lineno">50</span><span class="comment" id="1424160">//&nbsp;On&nbsp;both&nbsp;ARM&nbsp;and&nbsp;x86-32,&nbsp;it&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;arrange&nbsp;for&nbsp;64-bit</span><br>
<span class="lineno"></span><span class="comment" id="1424243">//&nbsp;alignment&nbsp;of&nbsp;64-bit&nbsp;words&nbsp;accessed&nbsp;atomically.&nbsp;The&nbsp;first&nbsp;word&nbsp;in&nbsp;a&nbsp;global</span><br>
<span class="lineno"></span><span class="comment" id="1424320">//&nbsp;variable&nbsp;or&nbsp;in&nbsp;an&nbsp;allocated&nbsp;struct&nbsp;or&nbsp;slice&nbsp;can&nbsp;be&nbsp;relied&nbsp;upon&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="1424392">//&nbsp;64-bit&nbsp;aligned.</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="1424412">//&nbsp;SwapInt32&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1424496">func</span>&nbsp;<span class="ident" id="1424501">SwapInt32</span><span class="op" id="1424510">(</span><span class="ident" id="1424511">addr</span>&nbsp;<span class="op" id="1424516">*</span><span class="builtintype" id="1424517">int32</span><span class="op" id="1424522">,</span>&nbsp;<span class="builtinfunc" id="1424524">new</span>&nbsp;<span class="builtintype" id="1424528">int32</span><span class="op" id="1424533">)</span>&nbsp;<span class="op" id="1424535">(</span><span class="ident" id="1424536">old</span>&nbsp;<span class="builtintype" id="1424540">int32</span><span class="op" id="1424545">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1424548">//&nbsp;SwapInt64&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1424632">func</span>&nbsp;<span class="ident" id="1424637">SwapInt64</span><span class="op" id="1424646">(</span><span class="ident" id="1424647">addr</span>&nbsp;<span class="op" id="1424652">*</span><span class="ident" id="1424653">int64</span><span class="op" id="1424658">,</span>&nbsp;<span class="builtinfunc" id="1424660">new</span>&nbsp;<span class="ident" id="1424664">int64</span><span class="op" id="1424669">)</span>&nbsp;<span class="op" id="1424671">(</span><span class="ident" id="1424672">old</span>&nbsp;<span class="ident" id="1424676">int64</span><span class="op" id="1424681">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="1424684">//&nbsp;SwapUint32&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1424769">func</span>&nbsp;<span class="ident" id="1424774">SwapUint32</span><span class="op" id="1424784">(</span><span class="ident" id="1424785">addr</span>&nbsp;<span class="op" id="1424790">*</span><span class="builtintype" id="1424791">uint32</span><span class="op" id="1424797">,</span>&nbsp;<span class="builtinfunc" id="1424799">new</span>&nbsp;<span class="builtintype" id="1424803">uint32</span><span class="op" id="1424809">)</span>&nbsp;<span class="op" id="1424811">(</span><span class="ident" id="1424812">old</span>&nbsp;<span class="builtintype" id="1424816">uint32</span><span class="op" id="1424822">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1424825">//&nbsp;SwapUint64&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno">65</span><span class="keyword" id="1424910">func</span>&nbsp;<span class="ident" id="1424915">SwapUint64</span><span class="op" id="1424925">(</span><span class="ident" id="1424926">addr</span>&nbsp;<span class="op" id="1424931">*</span><span class="ident" id="1424932">uint64</span><span class="op" id="1424938">,</span>&nbsp;<span class="builtinfunc" id="1424940">new</span>&nbsp;<span class="ident" id="1424944">uint64</span><span class="op" id="1424950">)</span>&nbsp;<span class="op" id="1424952">(</span><span class="ident" id="1424953">old</span>&nbsp;<span class="ident" id="1424957">uint64</span><span class="op" id="1424963">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1424966">//&nbsp;SwapUintptr&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1425052">func</span>&nbsp;<span class="ident" id="1425057">SwapUintptr</span><span class="op" id="1425068">(</span><span class="ident" id="1425069">addr</span>&nbsp;<span class="op" id="1425074">*</span><span class="builtintype" id="1425075">uintptr</span><span class="op" id="1425082">,</span>&nbsp;<span class="builtinfunc" id="1425084">new</span>&nbsp;<span class="builtintype" id="1425088">uintptr</span><span class="op" id="1425095">)</span>&nbsp;<span class="op" id="1425097">(</span><span class="ident" id="1425098">old</span>&nbsp;<span class="builtintype" id="1425102">uintptr</span><span class="op" id="1425109">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="1425112">//&nbsp;SwapPointer&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1425198">func</span>&nbsp;<span class="ident" id="1425203">SwapPointer</span><span class="op" id="1425214">(</span><span class="ident" id="1425215">addr</span>&nbsp;<span class="op" id="1425220">*</span><span class="ident" id="1425221">unsafe</span><span class="op" id="1425227">.</span><span class="ident" id="1425228">Pointer</span><span class="op" id="1425235">,</span>&nbsp;<span class="builtinfunc" id="1425237">new</span>&nbsp;<span class="ident" id="1425241">unsafe</span><span class="op" id="1425247">.</span><span class="ident" id="1425248">Pointer</span><span class="op" id="1425255">)</span>&nbsp;<span class="op" id="1425257">(</span><span class="ident" id="1425258">old</span>&nbsp;<span class="ident" id="1425262">unsafe</span><span class="op" id="1425268">.</span><span class="ident" id="1425269">Pointer</span><span class="op" id="1425276">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1425279">//&nbsp;CompareAndSwapInt32&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;an&nbsp;int32&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1425362">func</span>&nbsp;<span class="ident" id="1425367">CompareAndSwapInt32</span><span class="op" id="1425386">(</span><span class="ident" id="1425387">addr</span>&nbsp;<span class="op" id="1425392">*</span><span class="builtintype" id="1425393">int32</span><span class="op" id="1425398">,</span>&nbsp;<span class="ident" id="1425400">old</span><span class="op" id="1425403">,</span>&nbsp;<span class="builtinfunc" id="1425405">new</span>&nbsp;<span class="builtintype" id="1425409">int32</span><span class="op" id="1425414">)</span>&nbsp;<span class="op" id="1425416">(</span><span class="ident" id="1425417">swapped</span>&nbsp;<span class="builtintype" id="1425425">bool</span><span class="op" id="1425429">)</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="1425432">//&nbsp;CompareAndSwapInt64&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;an&nbsp;int64&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1425515">func</span>&nbsp;<span class="ident" id="1425520">CompareAndSwapInt64</span><span class="op" id="1425539">(</span><span class="ident" id="1425540">addr</span>&nbsp;<span class="op" id="1425545">*</span><span class="ident" id="1425546">int64</span><span class="op" id="1425551">,</span>&nbsp;<span class="ident" id="1425553">old</span><span class="op" id="1425556">,</span>&nbsp;<span class="builtinfunc" id="1425558">new</span>&nbsp;<span class="ident" id="1425562">int64</span><span class="op" id="1425567">)</span>&nbsp;<span class="op" id="1425569">(</span><span class="ident" id="1425570">swapped</span>&nbsp;<span class="builtintype" id="1425578">bool</span><span class="op" id="1425582">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1425585">//&nbsp;CompareAndSwapUint32&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uint32&nbsp;value.</span><br>
<span class="lineno">80</span><span class="keyword" id="1425669">func</span>&nbsp;<span class="ident" id="1425674">CompareAndSwapUint32</span><span class="op" id="1425694">(</span><span class="ident" id="1425695">addr</span>&nbsp;<span class="op" id="1425700">*</span><span class="builtintype" id="1425701">uint32</span><span class="op" id="1425707">,</span>&nbsp;<span class="ident" id="1425709">old</span><span class="op" id="1425712">,</span>&nbsp;<span class="builtinfunc" id="1425714">new</span>&nbsp;<span class="builtintype" id="1425718">uint32</span><span class="op" id="1425724">)</span>&nbsp;<span class="op" id="1425726">(</span><span class="ident" id="1425727">swapped</span>&nbsp;<span class="builtintype" id="1425735">bool</span><span class="op" id="1425739">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1425742">//&nbsp;CompareAndSwapUint64&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uint64&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1425826">func</span>&nbsp;<span class="ident" id="1425831">CompareAndSwapUint64</span><span class="op" id="1425851">(</span><span class="ident" id="1425852">addr</span>&nbsp;<span class="op" id="1425857">*</span><span class="ident" id="1425858">uint64</span><span class="op" id="1425864">,</span>&nbsp;<span class="ident" id="1425866">old</span><span class="op" id="1425869">,</span>&nbsp;<span class="builtinfunc" id="1425871">new</span>&nbsp;<span class="ident" id="1425875">uint64</span><span class="op" id="1425881">)</span>&nbsp;<span class="op" id="1425883">(</span><span class="ident" id="1425884">swapped</span>&nbsp;<span class="builtintype" id="1425892">bool</span><span class="op" id="1425896">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="1425899">//&nbsp;CompareAndSwapUintptr&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uintptr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1425985">func</span>&nbsp;<span class="ident" id="1425990">CompareAndSwapUintptr</span><span class="op" id="1426011">(</span><span class="ident" id="1426012">addr</span>&nbsp;<span class="op" id="1426017">*</span><span class="builtintype" id="1426018">uintptr</span><span class="op" id="1426025">,</span>&nbsp;<span class="ident" id="1426027">old</span><span class="op" id="1426030">,</span>&nbsp;<span class="builtinfunc" id="1426032">new</span>&nbsp;<span class="builtintype" id="1426036">uintptr</span><span class="op" id="1426043">)</span>&nbsp;<span class="op" id="1426045">(</span><span class="ident" id="1426046">swapped</span>&nbsp;<span class="builtintype" id="1426054">bool</span><span class="op" id="1426058">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1426061">//&nbsp;CompareAndSwapPointer&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;unsafe.Pointer&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1426154">func</span>&nbsp;<span class="ident" id="1426159">CompareAndSwapPointer</span><span class="op" id="1426180">(</span><span class="ident" id="1426181">addr</span>&nbsp;<span class="op" id="1426186">*</span><span class="ident" id="1426187">unsafe</span><span class="op" id="1426193">.</span><span class="ident" id="1426194">Pointer</span><span class="op" id="1426201">,</span>&nbsp;<span class="ident" id="1426203">old</span><span class="op" id="1426206">,</span>&nbsp;<span class="builtinfunc" id="1426208">new</span>&nbsp;<span class="ident" id="1426212">unsafe</span><span class="op" id="1426218">.</span><span class="ident" id="1426219">Pointer</span><span class="op" id="1426226">)</span>&nbsp;<span class="op" id="1426228">(</span><span class="ident" id="1426229">swapped</span>&nbsp;<span class="builtintype" id="1426237">bool</span><span class="op" id="1426241">)</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="1426244">//&nbsp;AddInt32&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1426314">func</span>&nbsp;<span class="ident" id="1426319">AddInt32</span><span class="op" id="1426327">(</span><span class="ident" id="1426328">addr</span>&nbsp;<span class="op" id="1426333">*</span><span class="builtintype" id="1426334">int32</span><span class="op" id="1426339">,</span>&nbsp;<span class="ident" id="1426341">delta</span>&nbsp;<span class="builtintype" id="1426347">int32</span><span class="op" id="1426352">)</span>&nbsp;<span class="op" id="1426354">(</span><span class="builtinfunc" id="1426355">new</span>&nbsp;<span class="builtintype" id="1426359">int32</span><span class="op" id="1426364">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1426367">//&nbsp;AddUint32&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno">95</span><span class="comment" id="1426438">//&nbsp;To&nbsp;subtract&nbsp;a&nbsp;signed&nbsp;positive&nbsp;constant&nbsp;value&nbsp;c&nbsp;from&nbsp;x,&nbsp;do&nbsp;AddUint32(&amp;x,&nbsp;^uint32(c-1)).</span><br>
<span class="lineno"></span><span class="comment" id="1426528">//&nbsp;In&nbsp;particular,&nbsp;to&nbsp;decrement&nbsp;x,&nbsp;do&nbsp;AddUint32(&amp;x,&nbsp;^uint32(0)).</span><br>
<span class="lineno"></span><span class="keyword" id="1426592">func</span>&nbsp;<span class="ident" id="1426597">AddUint32</span><span class="op" id="1426606">(</span><span class="ident" id="1426607">addr</span>&nbsp;<span class="op" id="1426612">*</span><span class="builtintype" id="1426613">uint32</span><span class="op" id="1426619">,</span>&nbsp;<span class="ident" id="1426621">delta</span>&nbsp;<span class="builtintype" id="1426627">uint32</span><span class="op" id="1426633">)</span>&nbsp;<span class="op" id="1426635">(</span><span class="builtinfunc" id="1426636">new</span>&nbsp;<span class="builtintype" id="1426640">uint32</span><span class="op" id="1426646">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1426649">//&nbsp;AddInt64&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno">100</span><span class="keyword" id="1426719">func</span>&nbsp;<span class="ident" id="1426724">AddInt64</span><span class="op" id="1426732">(</span><span class="ident" id="1426733">addr</span>&nbsp;<span class="op" id="1426738">*</span><span class="ident" id="1426739">int64</span><span class="op" id="1426744">,</span>&nbsp;<span class="ident" id="1426746">delta</span>&nbsp;<span class="ident" id="1426752">int64</span><span class="op" id="1426757">)</span>&nbsp;<span class="op" id="1426759">(</span><span class="builtinfunc" id="1426760">new</span>&nbsp;<span class="ident" id="1426764">int64</span><span class="op" id="1426769">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1426772">//&nbsp;AddUint64&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="1426843">//&nbsp;To&nbsp;subtract&nbsp;a&nbsp;signed&nbsp;positive&nbsp;constant&nbsp;value&nbsp;c&nbsp;from&nbsp;x,&nbsp;do&nbsp;AddUint64(&amp;x,&nbsp;^uint64(c-1)).</span><br>
<span class="lineno"></span><span class="comment" id="1426933">//&nbsp;In&nbsp;particular,&nbsp;to&nbsp;decrement&nbsp;x,&nbsp;do&nbsp;AddUint64(&amp;x,&nbsp;^uint64(0)).</span><br>
<span class="lineno">105</span><span class="keyword" id="1426997">func</span>&nbsp;<span class="ident" id="1427002">AddUint64</span><span class="op" id="1427011">(</span><span class="ident" id="1427012">addr</span>&nbsp;<span class="op" id="1427017">*</span><span class="ident" id="1427018">uint64</span><span class="op" id="1427024">,</span>&nbsp;<span class="ident" id="1427026">delta</span>&nbsp;<span class="ident" id="1427032">uint64</span><span class="op" id="1427038">)</span>&nbsp;<span class="op" id="1427040">(</span><span class="builtinfunc" id="1427041">new</span>&nbsp;<span class="ident" id="1427045">uint64</span><span class="op" id="1427051">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1427054">//&nbsp;AddUintptr&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1427126">func</span>&nbsp;<span class="ident" id="1427131">AddUintptr</span><span class="op" id="1427141">(</span><span class="ident" id="1427142">addr</span>&nbsp;<span class="op" id="1427147">*</span><span class="builtintype" id="1427148">uintptr</span><span class="op" id="1427155">,</span>&nbsp;<span class="ident" id="1427157">delta</span>&nbsp;<span class="builtintype" id="1427163">uintptr</span><span class="op" id="1427170">)</span>&nbsp;<span class="op" id="1427172">(</span><span class="builtinfunc" id="1427173">new</span>&nbsp;<span class="builtintype" id="1427177">uintptr</span><span class="op" id="1427184">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="1427187">//&nbsp;LoadInt32&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1427224">func</span>&nbsp;<span class="ident" id="1427229">LoadInt32</span><span class="op" id="1427238">(</span><span class="ident" id="1427239">addr</span>&nbsp;<span class="op" id="1427244">*</span><span class="builtintype" id="1427245">int32</span><span class="op" id="1427250">)</span>&nbsp;<span class="op" id="1427252">(</span><span class="ident" id="1427253">val</span>&nbsp;<span class="builtintype" id="1427257">int32</span><span class="op" id="1427262">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1427265">//&nbsp;LoadInt64&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1427302">func</span>&nbsp;<span class="ident" id="1427307">LoadInt64</span><span class="op" id="1427316">(</span><span class="ident" id="1427317">addr</span>&nbsp;<span class="op" id="1427322">*</span><span class="ident" id="1427323">int64</span><span class="op" id="1427328">)</span>&nbsp;<span class="op" id="1427330">(</span><span class="ident" id="1427331">val</span>&nbsp;<span class="ident" id="1427335">int64</span><span class="op" id="1427340">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="1427343">//&nbsp;LoadUint32&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1427381">func</span>&nbsp;<span class="ident" id="1427386">LoadUint32</span><span class="op" id="1427396">(</span><span class="ident" id="1427397">addr</span>&nbsp;<span class="op" id="1427402">*</span><span class="builtintype" id="1427403">uint32</span><span class="op" id="1427409">)</span>&nbsp;<span class="op" id="1427411">(</span><span class="ident" id="1427412">val</span>&nbsp;<span class="builtintype" id="1427416">uint32</span><span class="op" id="1427422">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1427425">//&nbsp;LoadUint64&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno">120</span><span class="keyword" id="1427463">func</span>&nbsp;<span class="ident" id="1427468">LoadUint64</span><span class="op" id="1427478">(</span><span class="ident" id="1427479">addr</span>&nbsp;<span class="op" id="1427484">*</span><span class="ident" id="1427485">uint64</span><span class="op" id="1427491">)</span>&nbsp;<span class="op" id="1427493">(</span><span class="ident" id="1427494">val</span>&nbsp;<span class="ident" id="1427498">uint64</span><span class="op" id="1427504">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1427507">//&nbsp;LoadUintptr&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1427546">func</span>&nbsp;<span class="ident" id="1427551">LoadUintptr</span><span class="op" id="1427562">(</span><span class="ident" id="1427563">addr</span>&nbsp;<span class="op" id="1427568">*</span><span class="builtintype" id="1427569">uintptr</span><span class="op" id="1427576">)</span>&nbsp;<span class="op" id="1427578">(</span><span class="ident" id="1427579">val</span>&nbsp;<span class="builtintype" id="1427583">uintptr</span><span class="op" id="1427590">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="1427593">//&nbsp;LoadPointer&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1427632">func</span>&nbsp;<span class="ident" id="1427637">LoadPointer</span><span class="op" id="1427648">(</span><span class="ident" id="1427649">addr</span>&nbsp;<span class="op" id="1427654">*</span><span class="ident" id="1427655">unsafe</span><span class="op" id="1427661">.</span><span class="ident" id="1427662">Pointer</span><span class="op" id="1427669">)</span>&nbsp;<span class="op" id="1427671">(</span><span class="ident" id="1427672">val</span>&nbsp;<span class="ident" id="1427676">unsafe</span><span class="op" id="1427682">.</span><span class="ident" id="1427683">Pointer</span><span class="op" id="1427690">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1427693">//&nbsp;StoreInt32&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1427741">func</span>&nbsp;<span class="ident" id="1427746">StoreInt32</span><span class="op" id="1427756">(</span><span class="ident" id="1427757">addr</span>&nbsp;<span class="op" id="1427762">*</span><span class="builtintype" id="1427763">int32</span><span class="op" id="1427768">,</span>&nbsp;<span class="ident" id="1427770">val</span>&nbsp;<span class="builtintype" id="1427774">int32</span><span class="op" id="1427779">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="1427782">//&nbsp;StoreInt64&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1427830">func</span>&nbsp;<span class="ident" id="1427835">StoreInt64</span><span class="op" id="1427845">(</span><span class="ident" id="1427846">addr</span>&nbsp;<span class="op" id="1427851">*</span><span class="ident" id="1427852">int64</span><span class="op" id="1427857">,</span>&nbsp;<span class="ident" id="1427859">val</span>&nbsp;<span class="ident" id="1427863">int64</span><span class="op" id="1427868">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1427871">//&nbsp;StoreUint32&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno">135</span><span class="keyword" id="1427920">func</span>&nbsp;<span class="ident" id="1427925">StoreUint32</span><span class="op" id="1427936">(</span><span class="ident" id="1427937">addr</span>&nbsp;<span class="op" id="1427942">*</span><span class="builtintype" id="1427943">uint32</span><span class="op" id="1427949">,</span>&nbsp;<span class="ident" id="1427951">val</span>&nbsp;<span class="builtintype" id="1427955">uint32</span><span class="op" id="1427961">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1427964">//&nbsp;StoreUint64&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1428013">func</span>&nbsp;<span class="ident" id="1428018">StoreUint64</span><span class="op" id="1428029">(</span><span class="ident" id="1428030">addr</span>&nbsp;<span class="op" id="1428035">*</span><span class="ident" id="1428036">uint64</span><span class="op" id="1428042">,</span>&nbsp;<span class="ident" id="1428044">val</span>&nbsp;<span class="ident" id="1428048">uint64</span><span class="op" id="1428054">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="1428057">//&nbsp;StoreUintptr&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1428107">func</span>&nbsp;<span class="ident" id="1428112">StoreUintptr</span><span class="op" id="1428124">(</span><span class="ident" id="1428125">addr</span>&nbsp;<span class="op" id="1428130">*</span><span class="builtintype" id="1428131">uintptr</span><span class="op" id="1428138">,</span>&nbsp;<span class="ident" id="1428140">val</span>&nbsp;<span class="builtintype" id="1428144">uintptr</span><span class="op" id="1428151">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1428154">//&nbsp;StorePointer&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1428204">func</span>&nbsp;<span class="ident" id="1428209">StorePointer</span><span class="op" id="1428221">(</span><span class="ident" id="1428222">addr</span>&nbsp;<span class="op" id="1428227">*</span><span class="ident" id="1428228">unsafe</span><span class="op" id="1428234">.</span><span class="ident" id="1428235">Pointer</span><span class="op" id="1428242">,</span>&nbsp;<span class="ident" id="1428244">val</span>&nbsp;<span class="ident" id="1428248">unsafe</span><span class="op" id="1428254">.</span><span class="ident" id="1428255">Pointer</span><span class="op" id="1428262">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="1428265">//&nbsp;Helper&nbsp;for&nbsp;ARM.&nbsp;&nbsp;Linker&nbsp;will&nbsp;discard&nbsp;on&nbsp;other&nbsp;systems</span><br>
<span class="lineno"></span><span class="keyword" id="1428322">func</span>&nbsp;<span class="ident" id="1428327">panic64</span><span class="op" id="1428334">(</span><span class="op" id="1428335">)</span>&nbsp;<span class="op" id="1428337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1428340">panic</span><span class="op" id="1428345">(</span><span class="string" id="1428346">&#34;sync/atomic:&nbsp;broken&nbsp;64-bit&nbsp;atomic&nbsp;operations&nbsp;(buggy&nbsp;QEMU)&#34;</span><span class="op" id="1428405">)</span><br>
<span class="lineno"></span><span class="op" id="1428407">}</span>
</div>
</body>
</html>
