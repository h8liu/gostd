<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html" class="current">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4122845">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4122900">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4122954">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4123005">//&nbsp;HTTP&nbsp;Response&nbsp;reading&nbsp;and&nbsp;parsing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4123044">package</span>&nbsp;<span class="ident" id="4123052">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4123058">import</span>&nbsp;<span class="op" id="4123065">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4123068">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4123077">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4123086">&#34;crypto/tls&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4123100">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4123110">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4123116">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4123133">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4123144">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4123155">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="4123165">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="4123168">var</span>&nbsp;<span class="ident" id="4123172">respExcludeHeader</span>&nbsp;<span class="op" id="4123190">=</span>&nbsp;<span class="keyword" id="4123192">map</span><span class="op" id="4123195">[</span><span class="builtintype" id="4123196">string</span><span class="op" id="4123202">]</span><span class="builtintype" id="4123203">bool</span><span class="op" id="4123207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4123210">&#34;Content-Length&#34;</span><span class="op" id="4123226">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4123231">true</span><span class="op" id="4123235">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4123238">&#34;Transfer-Encoding&#34;</span><span class="op" id="4123257">:</span>&nbsp;<span class="builtintype" id="4123259">true</span><span class="op" id="4123263">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4123266">&#34;Trailer&#34;</span><span class="op" id="4123275">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4123287">true</span><span class="op" id="4123291">,</span><br>
<span class="lineno">25</span><span class="op" id="4123293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4123296">//&nbsp;Response&nbsp;represents&nbsp;the&nbsp;response&nbsp;from&nbsp;an&nbsp;HTTP&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="4123354">//</span><br>
<span class="lineno"></span><span class="keyword" id="4123357">type</span>&nbsp;<span class="ident" id="4123362">Response</span>&nbsp;<span class="keyword" id="4123371">struct</span>&nbsp;<span class="op" id="4123378">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4123381">Status</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4123392">string</span>&nbsp;<span class="comment" id="4123399">//&nbsp;e.g.&nbsp;&#34;200&nbsp;OK&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4123417">StatusCode</span>&nbsp;<span class="builtintype" id="4123428">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4123435">//&nbsp;e.g.&nbsp;200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4123448">Proto</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4123459">string</span>&nbsp;<span class="comment" id="4123466">//&nbsp;e.g.&nbsp;&#34;HTTP/1.0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4123486">ProtoMajor</span>&nbsp;<span class="builtintype" id="4123497">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4123504">//&nbsp;e.g.&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4123515">ProtoMinor</span>&nbsp;<span class="builtintype" id="4123526">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4123533">//&nbsp;e.g.&nbsp;0</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4123545">//&nbsp;Header&nbsp;maps&nbsp;header&nbsp;keys&nbsp;to&nbsp;values.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;had&nbsp;multiple</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4123614">//&nbsp;headers&nbsp;with&nbsp;the&nbsp;same&nbsp;key,&nbsp;they&nbsp;may&nbsp;be&nbsp;concatenated,&nbsp;with&nbsp;comma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4123682">//&nbsp;delimiters.&nbsp;&nbsp;(Section&nbsp;4.2&nbsp;of&nbsp;RFC&nbsp;2616&nbsp;requires&nbsp;that&nbsp;multiple&nbsp;headers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4123755">//&nbsp;be&nbsp;semantically&nbsp;equivalent&nbsp;to&nbsp;a&nbsp;comma-delimited&nbsp;sequence.)&nbsp;Values</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4123825">//&nbsp;duplicated&nbsp;by&nbsp;other&nbsp;fields&nbsp;in&nbsp;this&nbsp;struct&nbsp;(e.g.,&nbsp;ContentLength)&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4123897">//&nbsp;omitted&nbsp;from&nbsp;Header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4123922">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4123926">//&nbsp;Keys&nbsp;in&nbsp;the&nbsp;map&nbsp;are&nbsp;canonicalized&nbsp;(see&nbsp;CanonicalHeaderKey).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4123990">Header</span>&nbsp;<span class="ident" id="4123997">Header</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4124006">//&nbsp;Body&nbsp;represents&nbsp;the&nbsp;response&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4124045">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4124049">//&nbsp;The&nbsp;http&nbsp;Client&nbsp;and&nbsp;Transport&nbsp;guarantee&nbsp;that&nbsp;Body&nbsp;is&nbsp;always</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4124113">//&nbsp;non-nil,&nbsp;even&nbsp;on&nbsp;responses&nbsp;without&nbsp;a&nbsp;body&nbsp;or&nbsp;responses&nbsp;with</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4124177">//&nbsp;a&nbsp;zero-length&nbsp;body.&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4124238">//&nbsp;close&nbsp;Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4124254">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4124258">//&nbsp;The&nbsp;Body&nbsp;is&nbsp;automatically&nbsp;dechunked&nbsp;if&nbsp;the&nbsp;server&nbsp;replied</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4124320">//&nbsp;with&nbsp;a&nbsp;&#34;chunked&#34;&nbsp;Transfer-Encoding.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4124360">Body</span>&nbsp;<span class="ident" id="4124365">io</span><span class="op" id="4124367">.</span><span class="ident" id="4124368">ReadCloser</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4124381">//&nbsp;ContentLength&nbsp;records&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;associated&nbsp;content.&nbsp;&nbsp;The</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4124450">//&nbsp;value&nbsp;-1&nbsp;indicates&nbsp;that&nbsp;the&nbsp;length&nbsp;is&nbsp;unknown.&nbsp;&nbsp;Unless&nbsp;Request.Method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4124524">//&nbsp;is&nbsp;&#34;HEAD&#34;,&nbsp;values&nbsp;&gt;=&nbsp;0&nbsp;indicate&nbsp;that&nbsp;the&nbsp;given&nbsp;number&nbsp;of&nbsp;bytes&nbsp;may</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4124595">//&nbsp;be&nbsp;read&nbsp;from&nbsp;Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4124618">ContentLength</span>&nbsp;<span class="ident" id="4124632">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4124640">//&nbsp;Contains&nbsp;transfer&nbsp;encodings&nbsp;from&nbsp;outer-most&nbsp;to&nbsp;inner-most.&nbsp;Value&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4124712">//&nbsp;nil,&nbsp;means&nbsp;that&nbsp;&#34;identity&#34;&nbsp;encoding&nbsp;is&nbsp;used.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4124761">TransferEncoding</span>&nbsp;<span class="op" id="4124778">[</span><span class="op" id="4124779">]</span><span class="builtintype" id="4124780">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4124789">//&nbsp;Close&nbsp;records&nbsp;whether&nbsp;the&nbsp;header&nbsp;directed&nbsp;that&nbsp;the&nbsp;connection&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4124858">//&nbsp;closed&nbsp;after&nbsp;reading&nbsp;Body.&nbsp;&nbsp;The&nbsp;value&nbsp;is&nbsp;advice&nbsp;for&nbsp;clients:&nbsp;neither</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4124931">//&nbsp;ReadResponse&nbsp;nor&nbsp;Response.Write&nbsp;ever&nbsp;closes&nbsp;a&nbsp;connection.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4124993">Close</span>&nbsp;<span class="builtintype" id="4124999">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4125006">//&nbsp;Trailer&nbsp;maps&nbsp;trailer&nbsp;keys&nbsp;to&nbsp;values,&nbsp;in&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4125059">//&nbsp;format&nbsp;as&nbsp;the&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4125085">Trailer</span>&nbsp;<span class="ident" id="4125093">Header</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4125102">//&nbsp;The&nbsp;Request&nbsp;that&nbsp;was&nbsp;sent&nbsp;to&nbsp;obtain&nbsp;this&nbsp;Response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4125157">//&nbsp;Request&#39;s&nbsp;Body&nbsp;is&nbsp;nil&nbsp;(having&nbsp;already&nbsp;been&nbsp;consumed).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4125215">//&nbsp;This&nbsp;is&nbsp;only&nbsp;populated&nbsp;for&nbsp;Client&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4125263">Request</span>&nbsp;<span class="op" id="4125271">*</span><span class="ident" id="4125272">Request</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4125282">//&nbsp;TLS&nbsp;contains&nbsp;information&nbsp;about&nbsp;the&nbsp;TLS&nbsp;connection&nbsp;on&nbsp;which&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4125349">//&nbsp;response&nbsp;was&nbsp;received.&nbsp;It&nbsp;is&nbsp;nil&nbsp;for&nbsp;unencrypted&nbsp;responses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4125413">//&nbsp;The&nbsp;pointer&nbsp;is&nbsp;shared&nbsp;between&nbsp;responses&nbsp;and&nbsp;should&nbsp;not&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4125475">//&nbsp;modified.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4125489">TLS</span>&nbsp;<span class="op" id="4125493">*</span><span class="ident" id="4125494">tls</span><span class="op" id="4125497">.</span><span class="ident" id="4125498">ConnectionState</span><br>
<span class="lineno"></span><span class="op" id="4125514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4125517">//&nbsp;Cookies&nbsp;parses&nbsp;and&nbsp;returns&nbsp;the&nbsp;cookies&nbsp;set&nbsp;in&nbsp;the&nbsp;Set-Cookie&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="4125590">func</span>&nbsp;<span class="op" id="4125595">(</span><span class="ident" id="4125596">r</span>&nbsp;<span class="op" id="4125598">*</span><span class="ident" id="4125599">Response</span><span class="op" id="4125607">)</span>&nbsp;<span class="ident" id="4125609">Cookies</span><span class="op" id="4125616">(</span><span class="op" id="4125617">)</span>&nbsp;<span class="op" id="4125619">[</span><span class="op" id="4125620">]</span><span class="op" id="4125621">*</span><span class="ident" id="4125622">Cookie</span>&nbsp;<span class="op" id="4125629">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4125632">return</span>&nbsp;<span class="ident" id="4125639">readSetCookies</span><span class="op" id="4125653">(</span><span class="ident" id="4125654">r</span><span class="op" id="4125655">.</span><span class="ident" id="4125656">Header</span><span class="op" id="4125662">)</span><br>
<span class="lineno"></span><span class="op" id="4125664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4125667">var</span>&nbsp;<span class="ident" id="4125671">ErrNoLocation</span>&nbsp;<span class="op" id="4125685">=</span>&nbsp;<span class="ident" id="4125687">errors</span><span class="op" id="4125693">.</span><span class="ident" id="4125694">New</span><span class="op" id="4125697">(</span><span class="string" id="4125698">&#34;http:&nbsp;no&nbsp;Location&nbsp;header&nbsp;in&nbsp;response&#34;</span><span class="op" id="4125736">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="4125739">//&nbsp;Location&nbsp;returns&nbsp;the&nbsp;URL&nbsp;of&nbsp;the&nbsp;response&#39;s&nbsp;&#34;Location&#34;&nbsp;header,</span><br>
<span class="lineno"></span><span class="comment" id="4125804">//&nbsp;if&nbsp;present.&nbsp;&nbsp;Relative&nbsp;redirects&nbsp;are&nbsp;resolved&nbsp;relative&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4125864">//&nbsp;the&nbsp;Response&#39;s&nbsp;Request.&nbsp;&nbsp;ErrNoLocation&nbsp;is&nbsp;returned&nbsp;if&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="4125924">//&nbsp;Location&nbsp;header&nbsp;is&nbsp;present.</span><br>
<span class="lineno"></span><span class="keyword" id="4125955">func</span>&nbsp;<span class="op" id="4125960">(</span><span class="ident" id="4125961">r</span>&nbsp;<span class="op" id="4125963">*</span><span class="ident" id="4125964">Response</span><span class="op" id="4125972">)</span>&nbsp;<span class="ident" id="4125974">Location</span><span class="op" id="4125982">(</span><span class="op" id="4125983">)</span>&nbsp;<span class="op" id="4125985">(</span><span class="op" id="4125986">*</span><span class="ident" id="4125987">url</span><span class="op" id="4125990">.</span><span class="ident" id="4125991">URL</span><span class="op" id="4125994">,</span>&nbsp;<span class="builtintype" id="4125996">error</span><span class="op" id="4126001">)</span>&nbsp;<span class="op" id="4126003">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4126006">lv</span>&nbsp;<span class="op" id="4126009">:=</span>&nbsp;<span class="ident" id="4126012">r</span><span class="op" id="4126013">.</span><span class="ident" id="4126014">Header</span><span class="op" id="4126020">.</span><span class="ident" id="4126021">Get</span><span class="op" id="4126024">(</span><span class="string" id="4126025">&#34;Location&#34;</span><span class="op" id="4126035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4126038">if</span>&nbsp;<span class="ident" id="4126041">lv</span>&nbsp;<span class="op" id="4126044">==</span>&nbsp;<span class="string" id="4126047">&#34;&#34;</span>&nbsp;<span class="op" id="4126050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4126054">return</span>&nbsp;<span class="builtintype" id="4126061">nil</span><span class="op" id="4126064">,</span>&nbsp;<span class="ident" id="4126066">ErrNoLocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4126081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4126084">if</span>&nbsp;<span class="ident" id="4126087">r</span><span class="op" id="4126088">.</span><span class="ident" id="4126089">Request</span>&nbsp;<span class="op" id="4126097">!=</span>&nbsp;<span class="builtintype" id="4126100">nil</span>&nbsp;<span class="op" id="4126104">&amp;&amp;</span>&nbsp;<span class="ident" id="4126107">r</span><span class="op" id="4126108">.</span><span class="ident" id="4126109">Request</span><span class="op" id="4126116">.</span><span class="ident" id="4126117">URL</span>&nbsp;<span class="op" id="4126121">!=</span>&nbsp;<span class="builtintype" id="4126124">nil</span>&nbsp;<span class="op" id="4126128">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4126132">return</span>&nbsp;<span class="ident" id="4126139">r</span><span class="op" id="4126140">.</span><span class="ident" id="4126141">Request</span><span class="op" id="4126148">.</span><span class="ident" id="4126149">URL</span><span class="op" id="4126152">.</span><span class="ident" id="4126153">Parse</span><span class="op" id="4126158">(</span><span class="ident" id="4126159">lv</span><span class="op" id="4126161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4126164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4126167">return</span>&nbsp;<span class="ident" id="4126174">url</span><span class="op" id="4126177">.</span><span class="ident" id="4126178">Parse</span><span class="op" id="4126183">(</span><span class="ident" id="4126184">lv</span><span class="op" id="4126186">)</span><br>
<span class="lineno"></span><span class="op" id="4126188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="4126191">//&nbsp;ReadResponse&nbsp;reads&nbsp;and&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;response&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4126250">//&nbsp;The&nbsp;req&nbsp;parameter&nbsp;optionally&nbsp;specifies&nbsp;the&nbsp;Request&nbsp;that&nbsp;corresponds</span><br>
<span class="lineno"></span><span class="comment" id="4126321">//&nbsp;to&nbsp;this&nbsp;Response.&nbsp;If&nbsp;nil,&nbsp;a&nbsp;GET&nbsp;request&nbsp;is&nbsp;assumed.</span><br>
<span class="lineno"></span><span class="comment" id="4126376">//&nbsp;Clients&nbsp;must&nbsp;call&nbsp;resp.Body.Close&nbsp;when&nbsp;finished&nbsp;reading&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="4126446">//&nbsp;After&nbsp;that&nbsp;call,&nbsp;clients&nbsp;can&nbsp;inspect&nbsp;resp.Trailer&nbsp;to&nbsp;find&nbsp;key/value</span><br>
<span class="lineno">115</span><span class="comment" id="4126517">//&nbsp;pairs&nbsp;included&nbsp;in&nbsp;the&nbsp;response&nbsp;trailer.</span><br>
<span class="lineno"></span><span class="keyword" id="4126560">func</span>&nbsp;<span class="ident" id="4126565">ReadResponse</span><span class="op" id="4126577">(</span><span class="ident" id="4126578">r</span>&nbsp;<span class="op" id="4126580">*</span><span class="ident" id="4126581">bufio</span><span class="op" id="4126586">.</span><span class="ident" id="4126587">Reader</span><span class="op" id="4126593">,</span>&nbsp;<span class="ident" id="4126595">req</span>&nbsp;<span class="op" id="4126599">*</span><span class="ident" id="4126600">Request</span><span class="op" id="4126607">)</span>&nbsp;<span class="op" id="4126609">(</span><span class="op" id="4126610">*</span><span class="ident" id="4126611">Response</span><span class="op" id="4126619">,</span>&nbsp;<span class="builtintype" id="4126621">error</span><span class="op" id="4126626">)</span>&nbsp;<span class="op" id="4126628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4126631">tp</span>&nbsp;<span class="op" id="4126634">:=</span>&nbsp;<span class="ident" id="4126637">textproto</span><span class="op" id="4126646">.</span><span class="ident" id="4126647">NewReader</span><span class="op" id="4126656">(</span><span class="ident" id="4126657">r</span><span class="op" id="4126658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4126661">resp</span>&nbsp;<span class="op" id="4126666">:=</span>&nbsp;<span class="op" id="4126669">&amp;</span><span class="ident" id="4126670">Response</span><span class="op" id="4126678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4126682">Request</span><span class="op" id="4126689">:</span>&nbsp;<span class="ident" id="4126691">req</span><span class="op" id="4126694">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4126697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4126701">//&nbsp;Parse&nbsp;the&nbsp;first&nbsp;line&nbsp;of&nbsp;the&nbsp;response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4126743">line</span><span class="op" id="4126747">,</span>&nbsp;<span class="ident" id="4126749">err</span>&nbsp;<span class="op" id="4126753">:=</span>&nbsp;<span class="ident" id="4126756">tp</span><span class="op" id="4126758">.</span><span class="ident" id="4126759">ReadLine</span><span class="op" id="4126767">(</span><span class="op" id="4126768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4126771">if</span>&nbsp;<span class="ident" id="4126774">err</span>&nbsp;<span class="op" id="4126778">!=</span>&nbsp;<span class="builtintype" id="4126781">nil</span>&nbsp;<span class="op" id="4126785">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4126789">if</span>&nbsp;<span class="ident" id="4126792">err</span>&nbsp;<span class="op" id="4126796">==</span>&nbsp;<span class="ident" id="4126799">io</span><span class="op" id="4126801">.</span><span class="ident" id="4126802">EOF</span>&nbsp;<span class="op" id="4126806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4126811">err</span>&nbsp;<span class="op" id="4126815">=</span>&nbsp;<span class="ident" id="4126817">io</span><span class="op" id="4126819">.</span><span class="ident" id="4126820">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4126839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4126843">return</span>&nbsp;<span class="builtintype" id="4126850">nil</span><span class="op" id="4126853">,</span>&nbsp;<span class="ident" id="4126855">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4126860">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4126863">f</span>&nbsp;<span class="op" id="4126865">:=</span>&nbsp;<span class="ident" id="4126868">strings</span><span class="op" id="4126875">.</span><span class="ident" id="4126876">SplitN</span><span class="op" id="4126882">(</span><span class="ident" id="4126883">line</span><span class="op" id="4126887">,</span>&nbsp;<span class="string" id="4126889">&#34;&nbsp;&#34;</span><span class="op" id="4126892">,</span>&nbsp;<span class="num" id="4126894">3</span><span class="op" id="4126895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4126898">if</span>&nbsp;<span class="builtinfunc" id="4126901">len</span><span class="op" id="4126904">(</span><span class="ident" id="4126905">f</span><span class="op" id="4126906">)</span>&nbsp;<span class="op" id="4126908">&lt;</span>&nbsp;<span class="num" id="4126910">2</span>&nbsp;<span class="op" id="4126912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4126916">return</span>&nbsp;<span class="builtintype" id="4126923">nil</span><span class="op" id="4126926">,</span>&nbsp;<span class="op" id="4126928">&amp;</span><span class="ident" id="4126929">badStringError</span><span class="op" id="4126943">{</span><span class="string" id="4126944">&#34;malformed&nbsp;HTTP&nbsp;response&#34;</span><span class="op" id="4126969">,</span>&nbsp;<span class="ident" id="4126971">line</span><span class="op" id="4126975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4126978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4126981">reasonPhrase</span>&nbsp;<span class="op" id="4126994">:=</span>&nbsp;<span class="string" id="4126997">&#34;&#34;</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4127001">if</span>&nbsp;<span class="builtinfunc" id="4127004">len</span><span class="op" id="4127007">(</span><span class="ident" id="4127008">f</span><span class="op" id="4127009">)</span>&nbsp;<span class="op" id="4127011">&gt;</span>&nbsp;<span class="num" id="4127013">2</span>&nbsp;<span class="op" id="4127015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4127019">reasonPhrase</span>&nbsp;<span class="op" id="4127032">=</span>&nbsp;<span class="ident" id="4127034">f</span><span class="op" id="4127035">[</span><span class="num" id="4127036">2</span><span class="op" id="4127037">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4127040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4127043">resp</span><span class="op" id="4127047">.</span><span class="ident" id="4127048">Status</span>&nbsp;<span class="op" id="4127055">=</span>&nbsp;<span class="ident" id="4127057">f</span><span class="op" id="4127058">[</span><span class="num" id="4127059">1</span><span class="op" id="4127060">]</span>&nbsp;<span class="op" id="4127062">+</span>&nbsp;<span class="string" id="4127064">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="4127068">+</span>&nbsp;<span class="ident" id="4127070">reasonPhrase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4127084">resp</span><span class="op" id="4127088">.</span><span class="ident" id="4127089">StatusCode</span><span class="op" id="4127099">,</span>&nbsp;<span class="ident" id="4127101">err</span>&nbsp;<span class="op" id="4127105">=</span>&nbsp;<span class="ident" id="4127107">strconv</span><span class="op" id="4127114">.</span><span class="ident" id="4127115">Atoi</span><span class="op" id="4127119">(</span><span class="ident" id="4127120">f</span><span class="op" id="4127121">[</span><span class="num" id="4127122">1</span><span class="op" id="4127123">]</span><span class="op" id="4127124">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4127127">if</span>&nbsp;<span class="ident" id="4127130">err</span>&nbsp;<span class="op" id="4127134">!=</span>&nbsp;<span class="builtintype" id="4127137">nil</span>&nbsp;<span class="op" id="4127141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4127145">return</span>&nbsp;<span class="builtintype" id="4127152">nil</span><span class="op" id="4127155">,</span>&nbsp;<span class="op" id="4127157">&amp;</span><span class="ident" id="4127158">badStringError</span><span class="op" id="4127172">{</span><span class="string" id="4127173">&#34;malformed&nbsp;HTTP&nbsp;status&nbsp;code&#34;</span><span class="op" id="4127201">,</span>&nbsp;<span class="ident" id="4127203">f</span><span class="op" id="4127204">[</span><span class="num" id="4127205">1</span><span class="op" id="4127206">]</span><span class="op" id="4127207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4127210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4127214">resp</span><span class="op" id="4127218">.</span><span class="ident" id="4127219">Proto</span>&nbsp;<span class="op" id="4127225">=</span>&nbsp;<span class="ident" id="4127227">f</span><span class="op" id="4127228">[</span><span class="num" id="4127229">0</span><span class="op" id="4127230">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4127233">var</span>&nbsp;<span class="ident" id="4127237">ok</span>&nbsp;<span class="builtintype" id="4127240">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4127246">if</span>&nbsp;<span class="ident" id="4127249">resp</span><span class="op" id="4127253">.</span><span class="ident" id="4127254">ProtoMajor</span><span class="op" id="4127264">,</span>&nbsp;<span class="ident" id="4127266">resp</span><span class="op" id="4127270">.</span><span class="ident" id="4127271">ProtoMinor</span><span class="op" id="4127281">,</span>&nbsp;<span class="ident" id="4127283">ok</span>&nbsp;<span class="op" id="4127286">=</span>&nbsp;<span class="ident" id="4127288">ParseHTTPVersion</span><span class="op" id="4127304">(</span><span class="ident" id="4127305">resp</span><span class="op" id="4127309">.</span><span class="ident" id="4127310">Proto</span><span class="op" id="4127315">)</span><span class="op" id="4127316">;</span>&nbsp;<span class="op" id="4127318">!</span><span class="ident" id="4127319">ok</span>&nbsp;<span class="op" id="4127322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4127326">return</span>&nbsp;<span class="builtintype" id="4127333">nil</span><span class="op" id="4127336">,</span>&nbsp;<span class="op" id="4127338">&amp;</span><span class="ident" id="4127339">badStringError</span><span class="op" id="4127353">{</span><span class="string" id="4127354">&#34;malformed&nbsp;HTTP&nbsp;version&#34;</span><span class="op" id="4127378">,</span>&nbsp;<span class="ident" id="4127380">resp</span><span class="op" id="4127384">.</span><span class="ident" id="4127385">Proto</span><span class="op" id="4127390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4127393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4127397">//&nbsp;Parse&nbsp;the&nbsp;response&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4127429">mimeHeader</span><span class="op" id="4127439">,</span>&nbsp;<span class="ident" id="4127441">err</span>&nbsp;<span class="op" id="4127445">:=</span>&nbsp;<span class="ident" id="4127448">tp</span><span class="op" id="4127450">.</span><span class="ident" id="4127451">ReadMIMEHeader</span><span class="op" id="4127465">(</span><span class="op" id="4127466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4127469">if</span>&nbsp;<span class="ident" id="4127472">err</span>&nbsp;<span class="op" id="4127476">!=</span>&nbsp;<span class="builtintype" id="4127479">nil</span>&nbsp;<span class="op" id="4127483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4127487">if</span>&nbsp;<span class="ident" id="4127490">err</span>&nbsp;<span class="op" id="4127494">==</span>&nbsp;<span class="ident" id="4127497">io</span><span class="op" id="4127499">.</span><span class="ident" id="4127500">EOF</span>&nbsp;<span class="op" id="4127504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4127509">err</span>&nbsp;<span class="op" id="4127513">=</span>&nbsp;<span class="ident" id="4127515">io</span><span class="op" id="4127517">.</span><span class="ident" id="4127518">ErrUnexpectedEOF</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4127537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4127541">return</span>&nbsp;<span class="builtintype" id="4127548">nil</span><span class="op" id="4127551">,</span>&nbsp;<span class="ident" id="4127553">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4127558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4127561">resp</span><span class="op" id="4127565">.</span><span class="ident" id="4127566">Header</span>&nbsp;<span class="op" id="4127573">=</span>&nbsp;<span class="ident" id="4127575">Header</span><span class="op" id="4127581">(</span><span class="ident" id="4127582">mimeHeader</span><span class="op" id="4127592">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4127596">fixPragmaCacheControl</span><span class="op" id="4127617">(</span><span class="ident" id="4127618">resp</span><span class="op" id="4127622">.</span><span class="ident" id="4127623">Header</span><span class="op" id="4127629">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4127633">err</span>&nbsp;<span class="op" id="4127637">=</span>&nbsp;<span class="ident" id="4127639">readTransfer</span><span class="op" id="4127651">(</span><span class="ident" id="4127652">resp</span><span class="op" id="4127656">,</span>&nbsp;<span class="ident" id="4127658">r</span><span class="op" id="4127659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4127662">if</span>&nbsp;<span class="ident" id="4127665">err</span>&nbsp;<span class="op" id="4127669">!=</span>&nbsp;<span class="builtintype" id="4127672">nil</span>&nbsp;<span class="op" id="4127676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4127680">return</span>&nbsp;<span class="builtintype" id="4127687">nil</span><span class="op" id="4127690">,</span>&nbsp;<span class="ident" id="4127692">err</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4127697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4127701">return</span>&nbsp;<span class="ident" id="4127708">resp</span><span class="op" id="4127712">,</span>&nbsp;<span class="builtintype" id="4127714">nil</span><br>
<span class="lineno"></span><span class="op" id="4127718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="4127721">//&nbsp;RFC2616:&nbsp;Should&nbsp;treat</span><br>
<span class="lineno"></span><span class="comment" id="4127746">//&nbsp;&nbsp;&nbsp;&nbsp;Pragma:&nbsp;no-cache</span><br>
<span class="lineno"></span><span class="comment" id="4127766">//&nbsp;like</span><br>
<span class="lineno"></span><span class="comment" id="4127774">//&nbsp;&nbsp;&nbsp;&nbsp;Cache-Control:&nbsp;no-cache</span><br>
<span class="lineno"></span><span class="keyword" id="4127801">func</span>&nbsp;<span class="ident" id="4127806">fixPragmaCacheControl</span><span class="op" id="4127827">(</span><span class="ident" id="4127828">header</span>&nbsp;<span class="ident" id="4127835">Header</span><span class="op" id="4127841">)</span>&nbsp;<span class="op" id="4127843">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4127846">if</span>&nbsp;<span class="ident" id="4127849">hp</span><span class="op" id="4127851">,</span>&nbsp;<span class="ident" id="4127853">ok</span>&nbsp;<span class="op" id="4127856">:=</span>&nbsp;<span class="ident" id="4127859">header</span><span class="op" id="4127865">[</span><span class="string" id="4127866">&#34;Pragma&#34;</span><span class="op" id="4127874">]</span><span class="op" id="4127875">;</span>&nbsp;<span class="ident" id="4127877">ok</span>&nbsp;<span class="op" id="4127880">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4127883">len</span><span class="op" id="4127886">(</span><span class="ident" id="4127887">hp</span><span class="op" id="4127889">)</span>&nbsp;<span class="op" id="4127891">&gt;</span>&nbsp;<span class="num" id="4127893">0</span>&nbsp;<span class="op" id="4127895">&amp;&amp;</span>&nbsp;<span class="ident" id="4127898">hp</span><span class="op" id="4127900">[</span><span class="num" id="4127901">0</span><span class="op" id="4127902">]</span>&nbsp;<span class="op" id="4127904">==</span>&nbsp;<span class="string" id="4127907">&#34;no-cache&#34;</span>&nbsp;<span class="op" id="4127918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4127922">if</span>&nbsp;<span class="ident" id="4127925">_</span><span class="op" id="4127926">,</span>&nbsp;<span class="ident" id="4127928">presentcc</span>&nbsp;<span class="op" id="4127938">:=</span>&nbsp;<span class="ident" id="4127941">header</span><span class="op" id="4127947">[</span><span class="string" id="4127948">&#34;Cache-Control&#34;</span><span class="op" id="4127963">]</span><span class="op" id="4127964">;</span>&nbsp;<span class="op" id="4127966">!</span><span class="ident" id="4127967">presentcc</span>&nbsp;<span class="op" id="4127977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4127982">header</span><span class="op" id="4127988">[</span><span class="string" id="4127989">&#34;Cache-Control&#34;</span><span class="op" id="4128004">]</span>&nbsp;<span class="op" id="4128006">=</span>&nbsp;<span class="op" id="4128008">[</span><span class="op" id="4128009">]</span><span class="builtintype" id="4128010">string</span><span class="op" id="4128016">{</span><span class="string" id="4128017">&#34;no-cache&#34;</span><span class="op" id="4128027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4128031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4128034">}</span><br>
<span class="lineno">180</span><span class="op" id="4128036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4128039">//&nbsp;ProtoAtLeast&nbsp;reports&nbsp;whether&nbsp;the&nbsp;HTTP&nbsp;protocol&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4128094">//&nbsp;in&nbsp;the&nbsp;response&nbsp;is&nbsp;at&nbsp;least&nbsp;major.minor.</span><br>
<span class="lineno"></span><span class="keyword" id="4128138">func</span>&nbsp;<span class="op" id="4128143">(</span><span class="ident" id="4128144">r</span>&nbsp;<span class="op" id="4128146">*</span><span class="ident" id="4128147">Response</span><span class="op" id="4128155">)</span>&nbsp;<span class="ident" id="4128157">ProtoAtLeast</span><span class="op" id="4128169">(</span><span class="ident" id="4128170">major</span><span class="op" id="4128175">,</span>&nbsp;<span class="ident" id="4128177">minor</span>&nbsp;<span class="builtintype" id="4128183">int</span><span class="op" id="4128186">)</span>&nbsp;<span class="builtintype" id="4128188">bool</span>&nbsp;<span class="op" id="4128193">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4128196">return</span>&nbsp;<span class="ident" id="4128203">r</span><span class="op" id="4128204">.</span><span class="ident" id="4128205">ProtoMajor</span>&nbsp;<span class="op" id="4128216">&gt;</span>&nbsp;<span class="ident" id="4128218">major</span>&nbsp;<span class="op" id="4128224">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4128229">r</span><span class="op" id="4128230">.</span><span class="ident" id="4128231">ProtoMajor</span>&nbsp;<span class="op" id="4128242">==</span>&nbsp;<span class="ident" id="4128245">major</span>&nbsp;<span class="op" id="4128251">&amp;&amp;</span>&nbsp;<span class="ident" id="4128254">r</span><span class="op" id="4128255">.</span><span class="ident" id="4128256">ProtoMinor</span>&nbsp;<span class="op" id="4128267">&gt;=</span>&nbsp;<span class="ident" id="4128270">minor</span><br>
<span class="lineno"></span><span class="op" id="4128276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4128279">//&nbsp;Writes&nbsp;the&nbsp;response&nbsp;(header,&nbsp;body&nbsp;and&nbsp;trailer)&nbsp;in&nbsp;wire&nbsp;format.&nbsp;This&nbsp;method</span><br>
<span class="lineno">190</span><span class="comment" id="4128357">//&nbsp;consults&nbsp;the&nbsp;following&nbsp;fields&nbsp;of&nbsp;the&nbsp;response:</span><br>
<span class="lineno"></span><span class="comment" id="4128407">//</span><br>
<span class="lineno"></span><span class="comment" id="4128410">//&nbsp;&nbsp;StatusCode</span><br>
<span class="lineno"></span><span class="comment" id="4128425">//&nbsp;&nbsp;ProtoMajor</span><br>
<span class="lineno"></span><span class="comment" id="4128440">//&nbsp;&nbsp;ProtoMinor</span><br>
<span class="lineno">195</span><span class="comment" id="4128455">//&nbsp;&nbsp;Request.Method</span><br>
<span class="lineno"></span><span class="comment" id="4128474">//&nbsp;&nbsp;TransferEncoding</span><br>
<span class="lineno"></span><span class="comment" id="4128495">//&nbsp;&nbsp;Trailer</span><br>
<span class="lineno"></span><span class="comment" id="4128507">//&nbsp;&nbsp;Body</span><br>
<span class="lineno"></span><span class="comment" id="4128516">//&nbsp;&nbsp;ContentLength</span><br>
<span class="lineno">200</span><span class="comment" id="4128534">//&nbsp;&nbsp;Header,&nbsp;values&nbsp;for&nbsp;non-canonical&nbsp;keys&nbsp;will&nbsp;have&nbsp;unpredictable&nbsp;behavior</span><br>
<span class="lineno"></span><span class="comment" id="4128609">//</span><br>
<span class="lineno"></span><span class="comment" id="4128612">//&nbsp;Body&nbsp;is&nbsp;closed&nbsp;after&nbsp;it&nbsp;is&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="4128648">func</span>&nbsp;<span class="op" id="4128653">(</span><span class="ident" id="4128654">r</span>&nbsp;<span class="op" id="4128656">*</span><span class="ident" id="4128657">Response</span><span class="op" id="4128665">)</span>&nbsp;<span class="ident" id="4128667">Write</span><span class="op" id="4128672">(</span><span class="ident" id="4128673">w</span>&nbsp;<span class="ident" id="4128675">io</span><span class="op" id="4128677">.</span><span class="ident" id="4128678">Writer</span><span class="op" id="4128684">)</span>&nbsp;<span class="builtintype" id="4128686">error</span>&nbsp;<span class="op" id="4128692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4128695">//&nbsp;Status&nbsp;line</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4128711">text</span>&nbsp;<span class="op" id="4128716">:=</span>&nbsp;<span class="ident" id="4128719">r</span><span class="op" id="4128720">.</span><span class="ident" id="4128721">Status</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4128729">if</span>&nbsp;<span class="ident" id="4128732">text</span>&nbsp;<span class="op" id="4128737">==</span>&nbsp;<span class="string" id="4128740">&#34;&#34;</span>&nbsp;<span class="op" id="4128743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4128747">var</span>&nbsp;<span class="ident" id="4128751">ok</span>&nbsp;<span class="builtintype" id="4128754">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4128761">text</span><span class="op" id="4128765">,</span>&nbsp;<span class="ident" id="4128767">ok</span>&nbsp;<span class="op" id="4128770">=</span>&nbsp;<span class="ident" id="4128772">statusText</span><span class="op" id="4128782">[</span><span class="ident" id="4128783">r</span><span class="op" id="4128784">.</span><span class="ident" id="4128785">StatusCode</span><span class="op" id="4128795">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4128799">if</span>&nbsp;<span class="op" id="4128802">!</span><span class="ident" id="4128803">ok</span>&nbsp;<span class="op" id="4128806">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4128811">text</span>&nbsp;<span class="op" id="4128816">=</span>&nbsp;<span class="string" id="4128818">&#34;status&nbsp;code&nbsp;&#34;</span>&nbsp;<span class="op" id="4128833">+</span>&nbsp;<span class="ident" id="4128835">strconv</span><span class="op" id="4128842">.</span><span class="ident" id="4128843">Itoa</span><span class="op" id="4128847">(</span><span class="ident" id="4128848">r</span><span class="op" id="4128849">.</span><span class="ident" id="4128850">StatusCode</span><span class="op" id="4128860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4128864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4128867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4128870">protoMajor</span><span class="op" id="4128880">,</span>&nbsp;<span class="ident" id="4128882">protoMinor</span>&nbsp;<span class="op" id="4128893">:=</span>&nbsp;<span class="ident" id="4128896">strconv</span><span class="op" id="4128903">.</span><span class="ident" id="4128904">Itoa</span><span class="op" id="4128908">(</span><span class="ident" id="4128909">r</span><span class="op" id="4128910">.</span><span class="ident" id="4128911">ProtoMajor</span><span class="op" id="4128921">)</span><span class="op" id="4128922">,</span>&nbsp;<span class="ident" id="4128924">strconv</span><span class="op" id="4128931">.</span><span class="ident" id="4128932">Itoa</span><span class="op" id="4128936">(</span><span class="ident" id="4128937">r</span><span class="op" id="4128938">.</span><span class="ident" id="4128939">ProtoMinor</span><span class="op" id="4128949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4128952">statusCode</span>&nbsp;<span class="op" id="4128963">:=</span>&nbsp;<span class="ident" id="4128966">strconv</span><span class="op" id="4128973">.</span><span class="ident" id="4128974">Itoa</span><span class="op" id="4128978">(</span><span class="ident" id="4128979">r</span><span class="op" id="4128980">.</span><span class="ident" id="4128981">StatusCode</span><span class="op" id="4128991">)</span>&nbsp;<span class="op" id="4128993">+</span>&nbsp;<span class="string" id="4128995">&#34;&nbsp;&#34;</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4129000">text</span>&nbsp;<span class="op" id="4129005">=</span>&nbsp;<span class="ident" id="4129007">strings</span><span class="op" id="4129014">.</span><span class="ident" id="4129015">TrimPrefix</span><span class="op" id="4129025">(</span><span class="ident" id="4129026">text</span><span class="op" id="4129030">,</span>&nbsp;<span class="ident" id="4129032">statusCode</span><span class="op" id="4129042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4129045">if</span>&nbsp;<span class="ident" id="4129048">_</span><span class="op" id="4129049">,</span>&nbsp;<span class="ident" id="4129051">err</span>&nbsp;<span class="op" id="4129055">:=</span>&nbsp;<span class="ident" id="4129058">io</span><span class="op" id="4129060">.</span><span class="ident" id="4129061">WriteString</span><span class="op" id="4129072">(</span><span class="ident" id="4129073">w</span><span class="op" id="4129074">,</span>&nbsp;<span class="string" id="4129076">&#34;HTTP/&#34;</span><span class="op" id="4129083">+</span><span class="ident" id="4129084">protoMajor</span><span class="op" id="4129094">+</span><span class="string" id="4129095">&#34;.&#34;</span><span class="op" id="4129098">+</span><span class="ident" id="4129099">protoMinor</span><span class="op" id="4129109">+</span><span class="string" id="4129110">&#34;&nbsp;&#34;</span><span class="op" id="4129113">+</span><span class="ident" id="4129114">statusCode</span><span class="op" id="4129124">+</span><span class="ident" id="4129125">text</span><span class="op" id="4129129">+</span><span class="string" id="4129130">&#34;\r\n&#34;</span><span class="op" id="4129136">)</span><span class="op" id="4129137">;</span>&nbsp;<span class="ident" id="4129139">err</span>&nbsp;<span class="op" id="4129143">!=</span>&nbsp;<span class="builtintype" id="4129146">nil</span>&nbsp;<span class="op" id="4129150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4129154">return</span>&nbsp;<span class="ident" id="4129161">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4129166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4129170">//&nbsp;Clone&nbsp;it,&nbsp;so&nbsp;we&nbsp;can&nbsp;modify&nbsp;r1&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4129215">r1</span>&nbsp;<span class="op" id="4129218">:=</span>&nbsp;<span class="builtinfunc" id="4129221">new</span><span class="op" id="4129224">(</span><span class="ident" id="4129225">Response</span><span class="op" id="4129233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4129236">*</span><span class="ident" id="4129237">r1</span>&nbsp;<span class="op" id="4129240">=</span>&nbsp;<span class="op" id="4129242">*</span><span class="ident" id="4129243">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4129246">if</span>&nbsp;<span class="ident" id="4129249">r1</span><span class="op" id="4129251">.</span><span class="ident" id="4129252">ContentLength</span>&nbsp;<span class="op" id="4129266">==</span>&nbsp;<span class="num" id="4129269">0</span>&nbsp;<span class="op" id="4129271">&amp;&amp;</span>&nbsp;<span class="ident" id="4129274">r1</span><span class="op" id="4129276">.</span><span class="ident" id="4129277">Body</span>&nbsp;<span class="op" id="4129282">!=</span>&nbsp;<span class="builtintype" id="4129285">nil</span>&nbsp;<span class="op" id="4129289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4129293">//&nbsp;Is&nbsp;it&nbsp;actually&nbsp;0&nbsp;length?&nbsp;Or&nbsp;just&nbsp;unknown?</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4129340">var</span>&nbsp;<span class="ident" id="4129344">buf</span>&nbsp;<span class="op" id="4129348">[</span><span class="num" id="4129349">1</span><span class="op" id="4129350">]</span><span class="builtintype" id="4129351">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4129358">n</span><span class="op" id="4129359">,</span>&nbsp;<span class="ident" id="4129361">err</span>&nbsp;<span class="op" id="4129365">:=</span>&nbsp;<span class="ident" id="4129368">r1</span><span class="op" id="4129370">.</span><span class="ident" id="4129371">Body</span><span class="op" id="4129375">.</span><span class="ident" id="4129376">Read</span><span class="op" id="4129380">(</span><span class="ident" id="4129381">buf</span><span class="op" id="4129384">[</span><span class="op" id="4129385">:</span><span class="op" id="4129386">]</span><span class="op" id="4129387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4129391">if</span>&nbsp;<span class="ident" id="4129394">err</span>&nbsp;<span class="op" id="4129398">!=</span>&nbsp;<span class="builtintype" id="4129401">nil</span>&nbsp;<span class="op" id="4129405">&amp;&amp;</span>&nbsp;<span class="ident" id="4129408">err</span>&nbsp;<span class="op" id="4129412">!=</span>&nbsp;<span class="ident" id="4129415">io</span><span class="op" id="4129417">.</span><span class="ident" id="4129418">EOF</span>&nbsp;<span class="op" id="4129422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4129427">return</span>&nbsp;<span class="ident" id="4129434">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4129440">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4129444">if</span>&nbsp;<span class="ident" id="4129447">n</span>&nbsp;<span class="op" id="4129449">==</span>&nbsp;<span class="num" id="4129452">0</span>&nbsp;<span class="op" id="4129454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4129459">//&nbsp;Reset&nbsp;it&nbsp;to&nbsp;a&nbsp;known&nbsp;zero&nbsp;reader,&nbsp;in&nbsp;case&nbsp;underlying&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4129521">//&nbsp;is&nbsp;unhappy&nbsp;being&nbsp;read&nbsp;repeatedly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4129561">r1</span><span class="op" id="4129563">.</span><span class="ident" id="4129564">Body</span>&nbsp;<span class="op" id="4129569">=</span>&nbsp;<span class="ident" id="4129571">eofReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4129583">}</span>&nbsp;<span class="keyword" id="4129585">else</span>&nbsp;<span class="op" id="4129590">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4129595">r1</span><span class="op" id="4129597">.</span><span class="ident" id="4129598">ContentLength</span>&nbsp;<span class="op" id="4129612">=</span>&nbsp;<span class="op" id="4129614">-</span><span class="num" id="4129615">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4129620">r1</span><span class="op" id="4129622">.</span><span class="ident" id="4129623">Body</span>&nbsp;<span class="op" id="4129628">=</span>&nbsp;<span class="keyword" id="4129630">struct</span>&nbsp;<span class="op" id="4129637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4129643">io</span><span class="op" id="4129645">.</span><span class="ident" id="4129646">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4129657">io</span><span class="op" id="4129659">.</span><span class="ident" id="4129660">Closer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4129670">}</span><span class="op" id="4129671">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4129677">io</span><span class="op" id="4129679">.</span><span class="ident" id="4129680">MultiReader</span><span class="op" id="4129691">(</span><span class="ident" id="4129692">bytes</span><span class="op" id="4129697">.</span><span class="ident" id="4129698">NewReader</span><span class="op" id="4129707">(</span><span class="ident" id="4129708">buf</span><span class="op" id="4129711">[</span><span class="op" id="4129712">:</span><span class="num" id="4129713">1</span><span class="op" id="4129714">]</span><span class="op" id="4129715">)</span><span class="op" id="4129716">,</span>&nbsp;<span class="ident" id="4129718">r</span><span class="op" id="4129719">.</span><span class="ident" id="4129720">Body</span><span class="op" id="4129724">)</span><span class="op" id="4129725">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4129731">r</span><span class="op" id="4129732">.</span><span class="ident" id="4129733">Body</span><span class="op" id="4129737">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4129742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4129746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4129749">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4129752">//&nbsp;If&nbsp;we&#39;re&nbsp;sending&nbsp;a&nbsp;non-chunked&nbsp;HTTP/1.1&nbsp;response&nbsp;without&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4129815">//&nbsp;content-length,&nbsp;the&nbsp;only&nbsp;way&nbsp;to&nbsp;do&nbsp;that&nbsp;is&nbsp;the&nbsp;old&nbsp;HTTP/1.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4129879">//&nbsp;way,&nbsp;by&nbsp;noting&nbsp;the&nbsp;EOF&nbsp;with&nbsp;a&nbsp;connection&nbsp;close,&nbsp;so&nbsp;we&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4129942">//&nbsp;to&nbsp;set&nbsp;Close.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4129960">if</span>&nbsp;<span class="ident" id="4129963">r1</span><span class="op" id="4129965">.</span><span class="ident" id="4129966">ContentLength</span>&nbsp;<span class="op" id="4129980">==</span>&nbsp;<span class="op" id="4129983">-</span><span class="num" id="4129984">1</span>&nbsp;<span class="op" id="4129986">&amp;&amp;</span>&nbsp;<span class="op" id="4129989">!</span><span class="ident" id="4129990">r1</span><span class="op" id="4129992">.</span><span class="ident" id="4129993">Close</span>&nbsp;<span class="op" id="4129999">&amp;&amp;</span>&nbsp;<span class="ident" id="4130002">r1</span><span class="op" id="4130004">.</span><span class="ident" id="4130005">ProtoAtLeast</span><span class="op" id="4130017">(</span><span class="num" id="4130018">1</span><span class="op" id="4130019">,</span>&nbsp;<span class="num" id="4130021">1</span><span class="op" id="4130022">)</span>&nbsp;<span class="op" id="4130024">&amp;&amp;</span>&nbsp;<span class="op" id="4130027">!</span><span class="ident" id="4130028">chunked</span><span class="op" id="4130035">(</span><span class="ident" id="4130036">r1</span><span class="op" id="4130038">.</span><span class="ident" id="4130039">TransferEncoding</span><span class="op" id="4130055">)</span>&nbsp;<span class="op" id="4130057">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4130061">r1</span><span class="op" id="4130063">.</span><span class="ident" id="4130064">Close</span>&nbsp;<span class="op" id="4130070">=</span>&nbsp;<span class="builtintype" id="4130072">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4130078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4130082">//&nbsp;Process&nbsp;Body,ContentLength,Close,Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4130127">tw</span><span class="op" id="4130129">,</span>&nbsp;<span class="ident" id="4130131">err</span>&nbsp;<span class="op" id="4130135">:=</span>&nbsp;<span class="ident" id="4130138">newTransferWriter</span><span class="op" id="4130155">(</span><span class="ident" id="4130156">r1</span><span class="op" id="4130158">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4130161">if</span>&nbsp;<span class="ident" id="4130164">err</span>&nbsp;<span class="op" id="4130168">!=</span>&nbsp;<span class="builtintype" id="4130171">nil</span>&nbsp;<span class="op" id="4130175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4130179">return</span>&nbsp;<span class="ident" id="4130186">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4130191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4130194">err</span>&nbsp;<span class="op" id="4130198">=</span>&nbsp;<span class="ident" id="4130200">tw</span><span class="op" id="4130202">.</span><span class="ident" id="4130203">WriteHeader</span><span class="op" id="4130214">(</span><span class="ident" id="4130215">w</span><span class="op" id="4130216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4130219">if</span>&nbsp;<span class="ident" id="4130222">err</span>&nbsp;<span class="op" id="4130226">!=</span>&nbsp;<span class="builtintype" id="4130229">nil</span>&nbsp;<span class="op" id="4130233">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4130237">return</span>&nbsp;<span class="ident" id="4130244">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4130249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4130253">//&nbsp;Rest&nbsp;of&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4130272">err</span>&nbsp;<span class="op" id="4130276">=</span>&nbsp;<span class="ident" id="4130278">r</span><span class="op" id="4130279">.</span><span class="ident" id="4130280">Header</span><span class="op" id="4130286">.</span><span class="ident" id="4130287">WriteSubset</span><span class="op" id="4130298">(</span><span class="ident" id="4130299">w</span><span class="op" id="4130300">,</span>&nbsp;<span class="ident" id="4130302">respExcludeHeader</span><span class="op" id="4130319">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4130322">if</span>&nbsp;<span class="ident" id="4130325">err</span>&nbsp;<span class="op" id="4130329">!=</span>&nbsp;<span class="builtintype" id="4130332">nil</span>&nbsp;<span class="op" id="4130336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4130340">return</span>&nbsp;<span class="ident" id="4130347">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4130352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4130356">//&nbsp;contentLengthAlreadySent&nbsp;may&nbsp;have&nbsp;been&nbsp;already&nbsp;sent&nbsp;for</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4130416">//&nbsp;POST/PUT&nbsp;requests,&nbsp;even&nbsp;if&nbsp;zero&nbsp;length.&nbsp;See&nbsp;Issue&nbsp;8180.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4130476">contentLengthAlreadySent</span>&nbsp;<span class="op" id="4130501">:=</span>&nbsp;<span class="ident" id="4130504">tw</span><span class="op" id="4130506">.</span><span class="ident" id="4130507">shouldSendContentLength</span><span class="op" id="4130530">(</span><span class="op" id="4130531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4130534">if</span>&nbsp;<span class="ident" id="4130537">r1</span><span class="op" id="4130539">.</span><span class="ident" id="4130540">ContentLength</span>&nbsp;<span class="op" id="4130554">==</span>&nbsp;<span class="num" id="4130557">0</span>&nbsp;<span class="op" id="4130559">&amp;&amp;</span>&nbsp;<span class="op" id="4130562">!</span><span class="ident" id="4130563">chunked</span><span class="op" id="4130570">(</span><span class="ident" id="4130571">r1</span><span class="op" id="4130573">.</span><span class="ident" id="4130574">TransferEncoding</span><span class="op" id="4130590">)</span>&nbsp;<span class="op" id="4130592">&amp;&amp;</span>&nbsp;<span class="op" id="4130595">!</span><span class="ident" id="4130596">contentLengthAlreadySent</span>&nbsp;<span class="op" id="4130621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4130625">if</span>&nbsp;<span class="ident" id="4130628">_</span><span class="op" id="4130629">,</span>&nbsp;<span class="ident" id="4130631">err</span>&nbsp;<span class="op" id="4130635">:=</span>&nbsp;<span class="ident" id="4130638">io</span><span class="op" id="4130640">.</span><span class="ident" id="4130641">WriteString</span><span class="op" id="4130652">(</span><span class="ident" id="4130653">w</span><span class="op" id="4130654">,</span>&nbsp;<span class="string" id="4130656">&#34;Content-Length:&nbsp;0\r\n&#34;</span><span class="op" id="4130679">)</span><span class="op" id="4130680">;</span>&nbsp;<span class="ident" id="4130682">err</span>&nbsp;<span class="op" id="4130686">!=</span>&nbsp;<span class="builtintype" id="4130689">nil</span>&nbsp;<span class="op" id="4130693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4130698">return</span>&nbsp;<span class="ident" id="4130705">err</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4130711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4130714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4130718">//&nbsp;End-of-header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4130736">if</span>&nbsp;<span class="ident" id="4130739">_</span><span class="op" id="4130740">,</span>&nbsp;<span class="ident" id="4130742">err</span>&nbsp;<span class="op" id="4130746">:=</span>&nbsp;<span class="ident" id="4130749">io</span><span class="op" id="4130751">.</span><span class="ident" id="4130752">WriteString</span><span class="op" id="4130763">(</span><span class="ident" id="4130764">w</span><span class="op" id="4130765">,</span>&nbsp;<span class="string" id="4130767">&#34;\r\n&#34;</span><span class="op" id="4130773">)</span><span class="op" id="4130774">;</span>&nbsp;<span class="ident" id="4130776">err</span>&nbsp;<span class="op" id="4130780">!=</span>&nbsp;<span class="builtintype" id="4130783">nil</span>&nbsp;<span class="op" id="4130787">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4130791">return</span>&nbsp;<span class="ident" id="4130798">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4130803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4130807">//&nbsp;Write&nbsp;body&nbsp;and&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4130834">err</span>&nbsp;<span class="op" id="4130838">=</span>&nbsp;<span class="ident" id="4130840">tw</span><span class="op" id="4130842">.</span><span class="ident" id="4130843">WriteBody</span><span class="op" id="4130852">(</span><span class="ident" id="4130853">w</span><span class="op" id="4130854">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4130857">if</span>&nbsp;<span class="ident" id="4130860">err</span>&nbsp;<span class="op" id="4130864">!=</span>&nbsp;<span class="builtintype" id="4130867">nil</span>&nbsp;<span class="op" id="4130871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4130875">return</span>&nbsp;<span class="ident" id="4130882">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4130887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4130891">//&nbsp;Success</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4130903">return</span>&nbsp;<span class="builtintype" id="4130910">nil</span><br>
<span class="lineno"></span><span class="op" id="4130914">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
