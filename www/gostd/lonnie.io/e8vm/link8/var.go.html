<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="5136698">package</span>&nbsp;<span class="ident" id="5136706">link8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5136713">import</span>&nbsp;<span class="op" id="5136720">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5136723">&#34;bytes&#34;</span><br>
<span class="lineno">5</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5136732">&#34;math&#34;</span><br>
<span class="lineno"></span><span class="op" id="5136739">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5136742">//&nbsp;Var&nbsp;reprsents&nbsp;a&nbsp;variable&nbsp;object</span><br>
<span class="lineno"></span><span class="keyword" id="5136777">type</span>&nbsp;<span class="ident" id="5136782">Var</span>&nbsp;<span class="keyword" id="5136786">struct</span>&nbsp;<span class="op" id="5136793">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5136796">align</span>&nbsp;<span class="builtintype" id="5136802">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5136810">buf</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5136816">*</span><span class="ident" id="5136817">bytes</span><span class="op" id="5136822">.</span><span class="ident" id="5136823">Buffer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5136832">addr</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5136839">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5136847">prePad</span>&nbsp;<span class="builtintype" id="5136854">uint32</span><br>
<span class="lineno">15</span><span class="op" id="5136861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5136864">//&nbsp;NewVar&nbsp;creates&nbsp;a&nbsp;new&nbsp;relocatable&nbsp;data&nbsp;section.</span><br>
<span class="lineno"></span><span class="keyword" id="5136914">func</span>&nbsp;<span class="ident" id="5136919">NewVar</span><span class="op" id="5136925">(</span><span class="ident" id="5136926">align</span>&nbsp;<span class="builtintype" id="5136932">uint32</span><span class="op" id="5136938">)</span>&nbsp;<span class="op" id="5136940">*</span><span class="ident" id="5136941">Var</span>&nbsp;<span class="op" id="5136945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5136948">ret</span>&nbsp;<span class="op" id="5136952">:=</span>&nbsp;<span class="builtinfunc" id="5136955">new</span><span class="op" id="5136958">(</span><span class="ident" id="5136959">Var</span><span class="op" id="5136962">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5136966">if</span>&nbsp;<span class="ident" id="5136969">align</span>&nbsp;<span class="op" id="5136975">==</span>&nbsp;<span class="num" id="5136978">0</span>&nbsp;<span class="op" id="5136980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5136984">align</span>&nbsp;<span class="op" id="5136990">=</span>&nbsp;<span class="num" id="5136992">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5136995">}</span>&nbsp;<span class="keyword" id="5136997">else</span>&nbsp;<span class="keyword" id="5137002">if</span>&nbsp;<span class="ident" id="5137005">align</span>&nbsp;<span class="op" id="5137011">!=</span>&nbsp;<span class="num" id="5137014">1</span>&nbsp;<span class="op" id="5137016">&amp;&amp;</span>&nbsp;<span class="ident" id="5137019">align</span>&nbsp;<span class="op" id="5137025">!=</span>&nbsp;<span class="num" id="5137028">4</span>&nbsp;<span class="op" id="5137030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5137034">panic</span><span class="op" id="5137039">(</span><span class="string" id="5137040">&#34;invalid&nbsp;align&#34;</span><span class="op" id="5137055">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5137058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5137062">ret</span><span class="op" id="5137065">.</span><span class="ident" id="5137066">align</span>&nbsp;<span class="op" id="5137072">=</span>&nbsp;<span class="ident" id="5137074">align</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5137081">ret</span><span class="op" id="5137084">.</span><span class="ident" id="5137085">buf</span>&nbsp;<span class="op" id="5137089">=</span>&nbsp;<span class="builtinfunc" id="5137091">new</span><span class="op" id="5137094">(</span><span class="ident" id="5137095">bytes</span><span class="op" id="5137100">.</span><span class="ident" id="5137101">Buffer</span><span class="op" id="5137107">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5137111">return</span>&nbsp;<span class="ident" id="5137118">ret</span><br>
<span class="lineno"></span><span class="op" id="5137122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5137125">//&nbsp;Write&nbsp;appends&nbsp;bytes&nbsp;to&nbsp;this&nbsp;data&nbsp;section.</span><br>
<span class="lineno"></span><span class="keyword" id="5137170">func</span>&nbsp;<span class="op" id="5137175">(</span><span class="ident" id="5137176">v</span>&nbsp;<span class="op" id="5137178">*</span><span class="ident" id="5137179">Var</span><span class="op" id="5137182">)</span>&nbsp;<span class="ident" id="5137184">Write</span><span class="op" id="5137189">(</span><span class="ident" id="5137190">buf</span>&nbsp;<span class="op" id="5137194">[</span><span class="op" id="5137195">]</span><span class="builtintype" id="5137196">byte</span><span class="op" id="5137200">)</span>&nbsp;<span class="op" id="5137202">(</span><span class="builtintype" id="5137203">int</span><span class="op" id="5137206">,</span>&nbsp;<span class="builtintype" id="5137208">error</span><span class="op" id="5137213">)</span>&nbsp;<span class="op" id="5137215">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5137218">return</span>&nbsp;<span class="ident" id="5137225">v</span><span class="op" id="5137226">.</span><span class="ident" id="5137227">buf</span><span class="op" id="5137230">.</span><span class="ident" id="5137231">Write</span><span class="op" id="5137236">(</span><span class="ident" id="5137237">buf</span><span class="op" id="5137240">)</span><br>
<span class="lineno"></span><span class="op" id="5137242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5137245">//&nbsp;Pad&nbsp;pads&nbsp;n&nbsp;bytes&nbsp;into&nbsp;this&nbsp;data&nbsp;section</span><br>
<span class="lineno"></span><span class="keyword" id="5137288">func</span>&nbsp;<span class="op" id="5137293">(</span><span class="ident" id="5137294">v</span>&nbsp;<span class="op" id="5137296">*</span><span class="ident" id="5137297">Var</span><span class="op" id="5137300">)</span>&nbsp;<span class="ident" id="5137302">Pad</span><span class="op" id="5137305">(</span><span class="ident" id="5137306">n</span>&nbsp;<span class="builtintype" id="5137308">uint32</span><span class="op" id="5137314">)</span>&nbsp;<span class="op" id="5137316">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5137319">v</span><span class="op" id="5137320">.</span><span class="ident" id="5137321">buf</span><span class="op" id="5137324">.</span><span class="ident" id="5137325">Write</span><span class="op" id="5137330">(</span><span class="builtinfunc" id="5137331">make</span><span class="op" id="5137335">(</span><span class="op" id="5137336">[</span><span class="op" id="5137337">]</span><span class="builtintype" id="5137338">byte</span><span class="op" id="5137342">,</span>&nbsp;<span class="ident" id="5137344">n</span><span class="op" id="5137345">)</span><span class="op" id="5137346">)</span><br>
<span class="lineno"></span><span class="op" id="5137348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5137351">//&nbsp;Size&nbsp;returns&nbsp;the&nbsp;current&nbsp;size&nbsp;of&nbsp;the&nbsp;section</span><br>
<span class="lineno"></span><span class="keyword" id="5137399">func</span>&nbsp;<span class="op" id="5137404">(</span><span class="ident" id="5137405">v</span>&nbsp;<span class="op" id="5137407">*</span><span class="ident" id="5137408">Var</span><span class="op" id="5137411">)</span>&nbsp;<span class="ident" id="5137413">Size</span><span class="op" id="5137417">(</span><span class="op" id="5137418">)</span>&nbsp;<span class="builtintype" id="5137420">uint32</span>&nbsp;<span class="op" id="5137427">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5137430">return</span>&nbsp;<span class="builtintype" id="5137437">uint32</span><span class="op" id="5137443">(</span><span class="ident" id="5137444">v</span><span class="op" id="5137445">.</span><span class="ident" id="5137446">buf</span><span class="op" id="5137449">.</span><span class="ident" id="5137450">Len</span><span class="op" id="5137453">(</span><span class="op" id="5137454">)</span><span class="op" id="5137455">)</span><br>
<span class="lineno"></span><span class="op" id="5137457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5137460">//&nbsp;TooLarge&nbsp;checks&nbsp;if&nbsp;the&nbsp;size&nbsp;is&nbsp;larger&nbsp;than&nbsp;2GB</span><br>
<span class="lineno"></span><span class="keyword" id="5137510">func</span>&nbsp;<span class="op" id="5137515">(</span><span class="ident" id="5137516">v</span>&nbsp;<span class="op" id="5137518">*</span><span class="ident" id="5137519">Var</span><span class="op" id="5137522">)</span>&nbsp;<span class="ident" id="5137524">TooLarge</span><span class="op" id="5137532">(</span><span class="op" id="5137533">)</span>&nbsp;<span class="builtintype" id="5137535">bool</span>&nbsp;<span class="op" id="5137540">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5137543">return</span>&nbsp;<span class="ident" id="5137550">v</span><span class="op" id="5137551">.</span><span class="ident" id="5137552">buf</span><span class="op" id="5137555">.</span><span class="ident" id="5137556">Len</span><span class="op" id="5137559">(</span><span class="op" id="5137560">)</span>&nbsp;<span class="op" id="5137562">&gt;</span>&nbsp;<span class="ident" id="5137564">math</span><span class="op" id="5137568">.</span><span class="ident" id="5137569">MaxInt32</span><br>
<span class="lineno"></span><span class="op" id="5137578">}</span>
</div>
</body>
</html>
