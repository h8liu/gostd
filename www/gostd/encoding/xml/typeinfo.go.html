<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/xml</h2>
<ul>
<li><a href="/gostd/encoding/xml/atom_test.go.html">atom_test.go</a></li>
<li><a href="/gostd/encoding/xml/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/xml/marshal.go.html">marshal.go</a></li>
<li><a href="/gostd/encoding/xml/marshal_test.go.html">marshal_test.go</a></li>
<li><a href="/gostd/encoding/xml/read.go.html">read.go</a></li>
<li><a href="/gostd/encoding/xml/read_test.go.html">read_test.go</a></li>
<li><a href="/gostd/encoding/xml/typeinfo.go.html" class="current">typeinfo.go</a></li>
<li><a href="/gostd/encoding/xml/xml.go.html">xml.go</a></li>
<li><a href="/gostd/encoding/xml/xml_test.go.html">xml_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4807063">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4807119">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4807173">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4807224">package</span>&nbsp;<span class="ident" id="4807232">xml</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4807237">import</span>&nbsp;<span class="op" id="4807244">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4807247">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4807254">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4807265">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4807276">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="4807283">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4807286">//&nbsp;typeInfo&nbsp;holds&nbsp;details&nbsp;for&nbsp;the&nbsp;xml&nbsp;representation&nbsp;of&nbsp;a&nbsp;type.</span><br>
<span class="lineno">15</span><span class="keyword" id="4807350">type</span>&nbsp;<span class="ident" id="4807355">typeInfo</span>&nbsp;<span class="keyword" id="4807364">struct</span>&nbsp;<span class="op" id="4807371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807374">xmlname</span>&nbsp;<span class="op" id="4807382">*</span><span class="ident" id="4807383">fieldInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807394">fields</span>&nbsp;&nbsp;<span class="op" id="4807402">[</span><span class="op" id="4807403">]</span><span class="ident" id="4807404">fieldInfo</span><br>
<span class="lineno"></span><span class="op" id="4807414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="4807417">//&nbsp;fieldInfo&nbsp;holds&nbsp;details&nbsp;for&nbsp;the&nbsp;xml&nbsp;representation&nbsp;of&nbsp;a&nbsp;single&nbsp;field.</span><br>
<span class="lineno"></span><span class="keyword" id="4807490">type</span>&nbsp;<span class="ident" id="4807495">fieldInfo</span>&nbsp;<span class="keyword" id="4807505">struct</span>&nbsp;<span class="op" id="4807512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807515">idx</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4807523">[</span><span class="op" id="4807524">]</span><span class="builtintype" id="4807525">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807530">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4807538">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807546">xmlns</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4807554">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807562">flags</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4807570">fieldFlags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807582">parents</span>&nbsp;<span class="op" id="4807590">[</span><span class="op" id="4807591">]</span><span class="builtintype" id="4807592">string</span><br>
<span class="lineno"></span><span class="op" id="4807599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4807602">type</span>&nbsp;<span class="ident" id="4807607">fieldFlags</span>&nbsp;<span class="builtintype" id="4807618">int</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="4807623">const</span>&nbsp;<span class="op" id="4807629">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807632">fElement</span>&nbsp;<span class="ident" id="4807641">fieldFlags</span>&nbsp;<span class="op" id="4807652">=</span>&nbsp;<span class="num" id="4807654">1</span>&nbsp;<span class="op" id="4807656">&lt;&lt;</span>&nbsp;<span class="ident" id="4807659">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807665">fAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807672">fCharData</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807683">fInnerXml</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807694">fComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807704">fAny</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807711">fOmitEmpty</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807724">fMode</span>&nbsp;<span class="op" id="4807730">=</span>&nbsp;<span class="ident" id="4807732">fElement</span>&nbsp;<span class="op" id="4807741">|</span>&nbsp;<span class="ident" id="4807743">fAttr</span>&nbsp;<span class="op" id="4807749">|</span>&nbsp;<span class="ident" id="4807751">fCharData</span>&nbsp;<span class="op" id="4807761">|</span>&nbsp;<span class="ident" id="4807763">fInnerXml</span>&nbsp;<span class="op" id="4807773">|</span>&nbsp;<span class="ident" id="4807775">fComment</span>&nbsp;<span class="op" id="4807784">|</span>&nbsp;<span class="ident" id="4807786">fAny</span><br>
<span class="lineno"></span><span class="op" id="4807791">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4807794">var</span>&nbsp;<span class="ident" id="4807798">tinfoMap</span>&nbsp;<span class="op" id="4807807">=</span>&nbsp;<span class="builtinfunc" id="4807809">make</span><span class="op" id="4807813">(</span><span class="keyword" id="4807814">map</span><span class="op" id="4807817">[</span><span class="ident" id="4807818">reflect</span><span class="op" id="4807825">.</span><span class="ident" id="4807826">Type</span><span class="op" id="4807830">]</span><span class="op" id="4807831">*</span><span class="ident" id="4807832">typeInfo</span><span class="op" id="4807840">)</span><br>
<span class="lineno">45</span><span class="keyword" id="4807842">var</span>&nbsp;<span class="ident" id="4807846">tinfoLock</span>&nbsp;<span class="ident" id="4807856">sync</span><span class="op" id="4807860">.</span><span class="ident" id="4807861">RWMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4807870">var</span>&nbsp;<span class="ident" id="4807874">nameType</span>&nbsp;<span class="op" id="4807883">=</span>&nbsp;<span class="ident" id="4807885">reflect</span><span class="op" id="4807892">.</span><span class="ident" id="4807893">TypeOf</span><span class="op" id="4807899">(</span><span class="ident" id="4807900">Name</span><span class="op" id="4807904">{</span><span class="op" id="4807905">}</span><span class="op" id="4807906">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4807909">//&nbsp;getTypeInfo&nbsp;returns&nbsp;the&nbsp;typeInfo&nbsp;structure&nbsp;with&nbsp;details&nbsp;necessary</span><br>
<span class="lineno">50</span><span class="comment" id="4807978">//&nbsp;for&nbsp;marshalling&nbsp;and&nbsp;unmarshalling&nbsp;typ.</span><br>
<span class="lineno"></span><span class="keyword" id="4808020">func</span>&nbsp;<span class="ident" id="4808025">getTypeInfo</span><span class="op" id="4808036">(</span><span class="ident" id="4808037">typ</span>&nbsp;<span class="ident" id="4808041">reflect</span><span class="op" id="4808048">.</span><span class="ident" id="4808049">Type</span><span class="op" id="4808053">)</span>&nbsp;<span class="op" id="4808055">(</span><span class="op" id="4808056">*</span><span class="ident" id="4808057">typeInfo</span><span class="op" id="4808065">,</span>&nbsp;<span class="builtintype" id="4808067">error</span><span class="op" id="4808072">)</span>&nbsp;<span class="op" id="4808074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4808077">tinfoLock</span><span class="op" id="4808086">.</span><span class="ident" id="4808087">RLock</span><span class="op" id="4808092">(</span><span class="op" id="4808093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4808096">tinfo</span><span class="op" id="4808101">,</span>&nbsp;<span class="ident" id="4808103">ok</span>&nbsp;<span class="op" id="4808106">:=</span>&nbsp;<span class="ident" id="4808109">tinfoMap</span><span class="op" id="4808117">[</span><span class="ident" id="4808118">typ</span><span class="op" id="4808121">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4808124">tinfoLock</span><span class="op" id="4808133">.</span><span class="ident" id="4808134">RUnlock</span><span class="op" id="4808141">(</span><span class="op" id="4808142">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4808145">if</span>&nbsp;<span class="ident" id="4808148">ok</span>&nbsp;<span class="op" id="4808151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4808155">return</span>&nbsp;<span class="ident" id="4808162">tinfo</span><span class="op" id="4808167">,</span>&nbsp;<span class="builtintype" id="4808169">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4808174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4808177">tinfo</span>&nbsp;<span class="op" id="4808183">=</span>&nbsp;<span class="op" id="4808185">&amp;</span><span class="ident" id="4808186">typeInfo</span><span class="op" id="4808194">{</span><span class="op" id="4808195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4808198">if</span>&nbsp;<span class="ident" id="4808201">typ</span><span class="op" id="4808204">.</span><span class="ident" id="4808205">Kind</span><span class="op" id="4808209">(</span><span class="op" id="4808210">)</span>&nbsp;<span class="op" id="4808212">==</span>&nbsp;<span class="ident" id="4808215">reflect</span><span class="op" id="4808222">.</span><span class="ident" id="4808223">Struct</span>&nbsp;<span class="op" id="4808230">&amp;&amp;</span>&nbsp;<span class="ident" id="4808233">typ</span>&nbsp;<span class="op" id="4808237">!=</span>&nbsp;<span class="ident" id="4808240">nameType</span>&nbsp;<span class="op" id="4808249">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4808253">n</span>&nbsp;<span class="op" id="4808255">:=</span>&nbsp;<span class="ident" id="4808258">typ</span><span class="op" id="4808261">.</span><span class="ident" id="4808262">NumField</span><span class="op" id="4808270">(</span><span class="op" id="4808271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4808275">for</span>&nbsp;<span class="ident" id="4808279">i</span>&nbsp;<span class="op" id="4808281">:=</span>&nbsp;<span class="num" id="4808284">0</span><span class="op" id="4808285">;</span>&nbsp;<span class="ident" id="4808287">i</span>&nbsp;<span class="op" id="4808289">&lt;</span>&nbsp;<span class="ident" id="4808291">n</span><span class="op" id="4808292">;</span>&nbsp;<span class="ident" id="4808294">i</span><span class="op" id="4808295">++</span>&nbsp;<span class="op" id="4808298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4808303">f</span>&nbsp;<span class="op" id="4808305">:=</span>&nbsp;<span class="ident" id="4808308">typ</span><span class="op" id="4808311">.</span><span class="ident" id="4808312">Field</span><span class="op" id="4808317">(</span><span class="ident" id="4808318">i</span><span class="op" id="4808319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4808324">if</span>&nbsp;<span class="ident" id="4808327">f</span><span class="op" id="4808328">.</span><span class="ident" id="4808329">PkgPath</span>&nbsp;<span class="op" id="4808337">!=</span>&nbsp;<span class="string" id="4808340">&#34;&#34;</span>&nbsp;<span class="op" id="4808343">||</span>&nbsp;<span class="ident" id="4808346">f</span><span class="op" id="4808347">.</span><span class="ident" id="4808348">Tag</span><span class="op" id="4808351">.</span><span class="ident" id="4808352">Get</span><span class="op" id="4808355">(</span><span class="string" id="4808356">&#34;xml&#34;</span><span class="op" id="4808361">)</span>&nbsp;<span class="op" id="4808363">==</span>&nbsp;<span class="string" id="4808366">&#34;-&#34;</span>&nbsp;<span class="op" id="4808370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4808376">continue</span>&nbsp;<span class="comment" id="4808385">//&nbsp;Private&nbsp;field</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4808405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4808411">//&nbsp;For&nbsp;embedded&nbsp;structs,&nbsp;embed&nbsp;its&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4808457">if</span>&nbsp;<span class="ident" id="4808460">f</span><span class="op" id="4808461">.</span><span class="ident" id="4808462">Anonymous</span>&nbsp;<span class="op" id="4808472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4808478">t</span>&nbsp;<span class="op" id="4808480">:=</span>&nbsp;<span class="ident" id="4808483">f</span><span class="op" id="4808484">.</span><span class="ident" id="4808485">Type</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4808494">if</span>&nbsp;<span class="ident" id="4808497">t</span><span class="op" id="4808498">.</span><span class="ident" id="4808499">Kind</span><span class="op" id="4808503">(</span><span class="op" id="4808504">)</span>&nbsp;<span class="op" id="4808506">==</span>&nbsp;<span class="ident" id="4808509">reflect</span><span class="op" id="4808516">.</span><span class="ident" id="4808517">Ptr</span>&nbsp;<span class="op" id="4808521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4808528">t</span>&nbsp;<span class="op" id="4808530">=</span>&nbsp;<span class="ident" id="4808532">t</span><span class="op" id="4808533">.</span><span class="ident" id="4808534">Elem</span><span class="op" id="4808538">(</span><span class="op" id="4808539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4808545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4808551">if</span>&nbsp;<span class="ident" id="4808554">t</span><span class="op" id="4808555">.</span><span class="ident" id="4808556">Kind</span><span class="op" id="4808560">(</span><span class="op" id="4808561">)</span>&nbsp;<span class="op" id="4808563">==</span>&nbsp;<span class="ident" id="4808566">reflect</span><span class="op" id="4808573">.</span><span class="ident" id="4808574">Struct</span>&nbsp;<span class="op" id="4808581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4808588">inner</span><span class="op" id="4808593">,</span>&nbsp;<span class="ident" id="4808595">err</span>&nbsp;<span class="op" id="4808599">:=</span>&nbsp;<span class="ident" id="4808602">getTypeInfo</span><span class="op" id="4808613">(</span><span class="ident" id="4808614">t</span><span class="op" id="4808615">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4808622">if</span>&nbsp;<span class="ident" id="4808625">err</span>&nbsp;<span class="op" id="4808629">!=</span>&nbsp;<span class="builtintype" id="4808632">nil</span>&nbsp;<span class="op" id="4808636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4808644">return</span>&nbsp;<span class="builtintype" id="4808651">nil</span><span class="op" id="4808654">,</span>&nbsp;<span class="ident" id="4808656">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4808665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4808672">if</span>&nbsp;<span class="ident" id="4808675">tinfo</span><span class="op" id="4808680">.</span><span class="ident" id="4808681">xmlname</span>&nbsp;<span class="op" id="4808689">==</span>&nbsp;<span class="builtintype" id="4808692">nil</span>&nbsp;<span class="op" id="4808696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4808704">tinfo</span><span class="op" id="4808709">.</span><span class="ident" id="4808710">xmlname</span>&nbsp;<span class="op" id="4808718">=</span>&nbsp;<span class="ident" id="4808720">inner</span><span class="op" id="4808725">.</span><span class="ident" id="4808726">xmlname</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4808739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4808746">for</span>&nbsp;<span class="ident" id="4808750">_</span><span class="op" id="4808751">,</span>&nbsp;<span class="ident" id="4808753">finfo</span>&nbsp;<span class="op" id="4808759">:=</span>&nbsp;<span class="keyword" id="4808762">range</span>&nbsp;<span class="ident" id="4808768">inner</span><span class="op" id="4808773">.</span><span class="ident" id="4808774">fields</span>&nbsp;<span class="op" id="4808781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4808789">finfo</span><span class="op" id="4808794">.</span><span class="ident" id="4808795">idx</span>&nbsp;<span class="op" id="4808799">=</span>&nbsp;<span class="builtinfunc" id="4808801">append</span><span class="op" id="4808807">(</span><span class="op" id="4808808">[</span><span class="op" id="4808809">]</span><span class="builtintype" id="4808810">int</span><span class="op" id="4808813">{</span><span class="ident" id="4808814">i</span><span class="op" id="4808815">}</span><span class="op" id="4808816">,</span>&nbsp;<span class="ident" id="4808818">finfo</span><span class="op" id="4808823">.</span><span class="ident" id="4808824">idx</span><span class="op" id="4808827">...</span><span class="op" id="4808830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4808838">if</span>&nbsp;<span class="ident" id="4808841">err</span>&nbsp;<span class="op" id="4808845">:=</span>&nbsp;<span class="ident" id="4808848">addFieldInfo</span><span class="op" id="4808860">(</span><span class="ident" id="4808861">typ</span><span class="op" id="4808864">,</span>&nbsp;<span class="ident" id="4808866">tinfo</span><span class="op" id="4808871">,</span>&nbsp;<span class="op" id="4808873">&amp;</span><span class="ident" id="4808874">finfo</span><span class="op" id="4808879">)</span><span class="op" id="4808880">;</span>&nbsp;<span class="ident" id="4808882">err</span>&nbsp;<span class="op" id="4808886">!=</span>&nbsp;<span class="builtintype" id="4808889">nil</span>&nbsp;<span class="op" id="4808893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4808902">return</span>&nbsp;<span class="builtintype" id="4808909">nil</span><span class="op" id="4808912">,</span>&nbsp;<span class="ident" id="4808914">err</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4808924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4808931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4808938">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4808951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4808956">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4808962">finfo</span><span class="op" id="4808967">,</span>&nbsp;<span class="ident" id="4808969">err</span>&nbsp;<span class="op" id="4808973">:=</span>&nbsp;<span class="ident" id="4808976">structFieldInfo</span><span class="op" id="4808991">(</span><span class="ident" id="4808992">typ</span><span class="op" id="4808995">,</span>&nbsp;<span class="op" id="4808997">&amp;</span><span class="ident" id="4808998">f</span><span class="op" id="4808999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4809004">if</span>&nbsp;<span class="ident" id="4809007">err</span>&nbsp;<span class="op" id="4809011">!=</span>&nbsp;<span class="builtintype" id="4809014">nil</span>&nbsp;<span class="op" id="4809018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4809024">return</span>&nbsp;<span class="builtintype" id="4809031">nil</span><span class="op" id="4809034">,</span>&nbsp;<span class="ident" id="4809036">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4809043">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4809049">if</span>&nbsp;<span class="ident" id="4809052">f</span><span class="op" id="4809053">.</span><span class="ident" id="4809054">Name</span>&nbsp;<span class="op" id="4809059">==</span>&nbsp;<span class="string" id="4809062">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="4809072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4809078">tinfo</span><span class="op" id="4809083">.</span><span class="ident" id="4809084">xmlname</span>&nbsp;<span class="op" id="4809092">=</span>&nbsp;<span class="ident" id="4809094">finfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4809104">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4809116">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4809122">//&nbsp;Add&nbsp;the&nbsp;field&nbsp;if&nbsp;it&nbsp;doesn&#39;t&nbsp;conflict&nbsp;with&nbsp;other&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4809184">if</span>&nbsp;<span class="ident" id="4809187">err</span>&nbsp;<span class="op" id="4809191">:=</span>&nbsp;<span class="ident" id="4809194">addFieldInfo</span><span class="op" id="4809206">(</span><span class="ident" id="4809207">typ</span><span class="op" id="4809210">,</span>&nbsp;<span class="ident" id="4809212">tinfo</span><span class="op" id="4809217">,</span>&nbsp;<span class="ident" id="4809219">finfo</span><span class="op" id="4809224">)</span><span class="op" id="4809225">;</span>&nbsp;<span class="ident" id="4809227">err</span>&nbsp;<span class="op" id="4809231">!=</span>&nbsp;<span class="builtintype" id="4809234">nil</span>&nbsp;<span class="op" id="4809238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4809244">return</span>&nbsp;<span class="builtintype" id="4809251">nil</span><span class="op" id="4809254">,</span>&nbsp;<span class="ident" id="4809256">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4809263">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4809267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4809270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4809273">tinfoLock</span><span class="op" id="4809282">.</span><span class="ident" id="4809283">Lock</span><span class="op" id="4809287">(</span><span class="op" id="4809288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4809291">tinfoMap</span><span class="op" id="4809299">[</span><span class="ident" id="4809300">typ</span><span class="op" id="4809303">]</span>&nbsp;<span class="op" id="4809305">=</span>&nbsp;<span class="ident" id="4809307">tinfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4809314">tinfoLock</span><span class="op" id="4809323">.</span><span class="ident" id="4809324">Unlock</span><span class="op" id="4809330">(</span><span class="op" id="4809331">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4809334">return</span>&nbsp;<span class="ident" id="4809341">tinfo</span><span class="op" id="4809346">,</span>&nbsp;<span class="builtintype" id="4809348">nil</span><br>
<span class="lineno"></span><span class="op" id="4809352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4809355">//&nbsp;structFieldInfo&nbsp;builds&nbsp;and&nbsp;returns&nbsp;a&nbsp;fieldInfo&nbsp;for&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="4809412">func</span>&nbsp;<span class="ident" id="4809417">structFieldInfo</span><span class="op" id="4809432">(</span><span class="ident" id="4809433">typ</span>&nbsp;<span class="ident" id="4809437">reflect</span><span class="op" id="4809444">.</span><span class="ident" id="4809445">Type</span><span class="op" id="4809449">,</span>&nbsp;<span class="ident" id="4809451">f</span>&nbsp;<span class="op" id="4809453">*</span><span class="ident" id="4809454">reflect</span><span class="op" id="4809461">.</span><span class="ident" id="4809462">StructField</span><span class="op" id="4809473">)</span>&nbsp;<span class="op" id="4809475">(</span><span class="op" id="4809476">*</span><span class="ident" id="4809477">fieldInfo</span><span class="op" id="4809486">,</span>&nbsp;<span class="builtintype" id="4809488">error</span><span class="op" id="4809493">)</span>&nbsp;<span class="op" id="4809495">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4809498">finfo</span>&nbsp;<span class="op" id="4809504">:=</span>&nbsp;<span class="op" id="4809507">&amp;</span><span class="ident" id="4809508">fieldInfo</span><span class="op" id="4809517">{</span><span class="ident" id="4809518">idx</span><span class="op" id="4809521">:</span>&nbsp;<span class="ident" id="4809523">f</span><span class="op" id="4809524">.</span><span class="ident" id="4809525">Index</span><span class="op" id="4809530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4809534">//&nbsp;Split&nbsp;the&nbsp;tag&nbsp;from&nbsp;the&nbsp;xml&nbsp;namespace&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4809589">tag</span>&nbsp;<span class="op" id="4809593">:=</span>&nbsp;<span class="ident" id="4809596">f</span><span class="op" id="4809597">.</span><span class="ident" id="4809598">Tag</span><span class="op" id="4809601">.</span><span class="ident" id="4809602">Get</span><span class="op" id="4809605">(</span><span class="string" id="4809606">&#34;xml&#34;</span><span class="op" id="4809611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4809614">if</span>&nbsp;<span class="ident" id="4809617">i</span>&nbsp;<span class="op" id="4809619">:=</span>&nbsp;<span class="ident" id="4809622">strings</span><span class="op" id="4809629">.</span><span class="ident" id="4809630">Index</span><span class="op" id="4809635">(</span><span class="ident" id="4809636">tag</span><span class="op" id="4809639">,</span>&nbsp;<span class="string" id="4809641">&#34;&nbsp;&#34;</span><span class="op" id="4809644">)</span><span class="op" id="4809645">;</span>&nbsp;<span class="ident" id="4809647">i</span>&nbsp;<span class="op" id="4809649">&gt;=</span>&nbsp;<span class="num" id="4809652">0</span>&nbsp;<span class="op" id="4809654">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4809658">finfo</span><span class="op" id="4809663">.</span><span class="ident" id="4809664">xmlns</span><span class="op" id="4809669">,</span>&nbsp;<span class="ident" id="4809671">tag</span>&nbsp;<span class="op" id="4809675">=</span>&nbsp;<span class="ident" id="4809677">tag</span><span class="op" id="4809680">[</span><span class="op" id="4809681">:</span><span class="ident" id="4809682">i</span><span class="op" id="4809683">]</span><span class="op" id="4809684">,</span>&nbsp;<span class="ident" id="4809686">tag</span><span class="op" id="4809689">[</span><span class="ident" id="4809690">i</span><span class="op" id="4809691">+</span><span class="num" id="4809692">1</span><span class="op" id="4809693">:</span><span class="op" id="4809694">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4809697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4809701">//&nbsp;Parse&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4809718">tokens</span>&nbsp;<span class="op" id="4809725">:=</span>&nbsp;<span class="ident" id="4809728">strings</span><span class="op" id="4809735">.</span><span class="ident" id="4809736">Split</span><span class="op" id="4809741">(</span><span class="ident" id="4809742">tag</span><span class="op" id="4809745">,</span>&nbsp;<span class="string" id="4809747">&#34;,&#34;</span><span class="op" id="4809750">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4809753">if</span>&nbsp;<span class="builtinfunc" id="4809756">len</span><span class="op" id="4809759">(</span><span class="ident" id="4809760">tokens</span><span class="op" id="4809766">)</span>&nbsp;<span class="op" id="4809768">==</span>&nbsp;<span class="num" id="4809771">1</span>&nbsp;<span class="op" id="4809773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4809777">finfo</span><span class="op" id="4809782">.</span><span class="ident" id="4809783">flags</span>&nbsp;<span class="op" id="4809789">=</span>&nbsp;<span class="ident" id="4809791">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4809801">}</span>&nbsp;<span class="keyword" id="4809803">else</span>&nbsp;<span class="op" id="4809808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4809812">tag</span>&nbsp;<span class="op" id="4809816">=</span>&nbsp;<span class="ident" id="4809818">tokens</span><span class="op" id="4809824">[</span><span class="num" id="4809825">0</span><span class="op" id="4809826">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4809830">for</span>&nbsp;<span class="ident" id="4809834">_</span><span class="op" id="4809835">,</span>&nbsp;<span class="ident" id="4809837">flag</span>&nbsp;<span class="op" id="4809842">:=</span>&nbsp;<span class="keyword" id="4809845">range</span>&nbsp;<span class="ident" id="4809851">tokens</span><span class="op" id="4809857">[</span><span class="num" id="4809858">1</span><span class="op" id="4809859">:</span><span class="op" id="4809860">]</span>&nbsp;<span class="op" id="4809862">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4809867">switch</span>&nbsp;<span class="ident" id="4809874">flag</span>&nbsp;<span class="op" id="4809879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4809884">case</span>&nbsp;<span class="string" id="4809889">&#34;attr&#34;</span><span class="op" id="4809895">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4809901">finfo</span><span class="op" id="4809906">.</span><span class="ident" id="4809907">flags</span>&nbsp;<span class="op" id="4809913">|=</span>&nbsp;<span class="ident" id="4809916">fAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4809925">case</span>&nbsp;<span class="string" id="4809930">&#34;chardata&#34;</span><span class="op" id="4809940">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4809946">finfo</span><span class="op" id="4809951">.</span><span class="ident" id="4809952">flags</span>&nbsp;<span class="op" id="4809958">|=</span>&nbsp;<span class="ident" id="4809961">fCharData</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4809974">case</span>&nbsp;<span class="string" id="4809979">&#34;innerxml&#34;</span><span class="op" id="4809989">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4809995">finfo</span><span class="op" id="4810000">.</span><span class="ident" id="4810001">flags</span>&nbsp;<span class="op" id="4810007">|=</span>&nbsp;<span class="ident" id="4810010">fInnerXml</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4810023">case</span>&nbsp;<span class="string" id="4810028">&#34;comment&#34;</span><span class="op" id="4810037">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4810043">finfo</span><span class="op" id="4810048">.</span><span class="ident" id="4810049">flags</span>&nbsp;<span class="op" id="4810055">|=</span>&nbsp;<span class="ident" id="4810058">fComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4810070">case</span>&nbsp;<span class="string" id="4810075">&#34;any&#34;</span><span class="op" id="4810080">:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4810086">finfo</span><span class="op" id="4810091">.</span><span class="ident" id="4810092">flags</span>&nbsp;<span class="op" id="4810098">|=</span>&nbsp;<span class="ident" id="4810101">fAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4810109">case</span>&nbsp;<span class="string" id="4810114">&#34;omitempty&#34;</span><span class="op" id="4810125">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4810131">finfo</span><span class="op" id="4810136">.</span><span class="ident" id="4810137">flags</span>&nbsp;<span class="op" id="4810143">|=</span>&nbsp;<span class="ident" id="4810146">fOmitEmpty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4810160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4810164">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4810169">//&nbsp;Validate&nbsp;the&nbsp;flags&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4810199">valid</span>&nbsp;<span class="op" id="4810205">:=</span>&nbsp;<span class="builtintype" id="4810208">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4810215">switch</span>&nbsp;<span class="ident" id="4810222">mode</span>&nbsp;<span class="op" id="4810227">:=</span>&nbsp;<span class="ident" id="4810230">finfo</span><span class="op" id="4810235">.</span><span class="ident" id="4810236">flags</span>&nbsp;<span class="op" id="4810242">&amp;</span>&nbsp;<span class="ident" id="4810244">fMode</span><span class="op" id="4810249">;</span>&nbsp;<span class="ident" id="4810251">mode</span>&nbsp;<span class="op" id="4810256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4810260">case</span>&nbsp;<span class="num" id="4810265">0</span><span class="op" id="4810266">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4810271">finfo</span><span class="op" id="4810276">.</span><span class="ident" id="4810277">flags</span>&nbsp;<span class="op" id="4810283">|=</span>&nbsp;<span class="ident" id="4810286">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4810297">case</span>&nbsp;<span class="ident" id="4810302">fAttr</span><span class="op" id="4810307">,</span>&nbsp;<span class="ident" id="4810309">fCharData</span><span class="op" id="4810318">,</span>&nbsp;<span class="ident" id="4810320">fInnerXml</span><span class="op" id="4810329">,</span>&nbsp;<span class="ident" id="4810331">fComment</span><span class="op" id="4810339">,</span>&nbsp;<span class="ident" id="4810341">fAny</span><span class="op" id="4810345">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4810350">if</span>&nbsp;<span class="ident" id="4810353">f</span><span class="op" id="4810354">.</span><span class="ident" id="4810355">Name</span>&nbsp;<span class="op" id="4810360">==</span>&nbsp;<span class="string" id="4810363">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="4810373">||</span>&nbsp;<span class="ident" id="4810376">tag</span>&nbsp;<span class="op" id="4810380">!=</span>&nbsp;<span class="string" id="4810383">&#34;&#34;</span>&nbsp;<span class="op" id="4810386">&amp;&amp;</span>&nbsp;<span class="ident" id="4810389">mode</span>&nbsp;<span class="op" id="4810394">!=</span>&nbsp;<span class="ident" id="4810397">fAttr</span>&nbsp;<span class="op" id="4810403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4810409">valid</span>&nbsp;<span class="op" id="4810415">=</span>&nbsp;<span class="builtintype" id="4810417">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4810426">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4810430">default</span><span class="op" id="4810437">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4810442">//&nbsp;This&nbsp;will&nbsp;also&nbsp;catch&nbsp;multiple&nbsp;modes&nbsp;in&nbsp;a&nbsp;single&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4810503">valid</span>&nbsp;<span class="op" id="4810509">=</span>&nbsp;<span class="builtintype" id="4810511">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4810519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4810523">if</span>&nbsp;<span class="ident" id="4810526">finfo</span><span class="op" id="4810531">.</span><span class="ident" id="4810532">flags</span><span class="op" id="4810537">&amp;</span><span class="ident" id="4810538">fMode</span>&nbsp;<span class="op" id="4810544">==</span>&nbsp;<span class="ident" id="4810547">fAny</span>&nbsp;<span class="op" id="4810552">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4810557">finfo</span><span class="op" id="4810562">.</span><span class="ident" id="4810563">flags</span>&nbsp;<span class="op" id="4810569">|=</span>&nbsp;<span class="ident" id="4810572">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4810583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4810587">if</span>&nbsp;<span class="ident" id="4810590">finfo</span><span class="op" id="4810595">.</span><span class="ident" id="4810596">flags</span><span class="op" id="4810601">&amp;</span><span class="ident" id="4810602">fOmitEmpty</span>&nbsp;<span class="op" id="4810613">!=</span>&nbsp;<span class="num" id="4810616">0</span>&nbsp;<span class="op" id="4810618">&amp;&amp;</span>&nbsp;<span class="ident" id="4810621">finfo</span><span class="op" id="4810626">.</span><span class="ident" id="4810627">flags</span><span class="op" id="4810632">&amp;</span><span class="op" id="4810633">(</span><span class="ident" id="4810634">fElement</span><span class="op" id="4810642">|</span><span class="ident" id="4810643">fAttr</span><span class="op" id="4810648">)</span>&nbsp;<span class="op" id="4810650">==</span>&nbsp;<span class="num" id="4810653">0</span>&nbsp;<span class="op" id="4810655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4810660">valid</span>&nbsp;<span class="op" id="4810666">=</span>&nbsp;<span class="builtintype" id="4810668">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4810676">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4810680">if</span>&nbsp;<span class="op" id="4810683">!</span><span class="ident" id="4810684">valid</span>&nbsp;<span class="op" id="4810690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4810695">return</span>&nbsp;<span class="builtintype" id="4810702">nil</span><span class="op" id="4810705">,</span>&nbsp;<span class="ident" id="4810707">fmt</span><span class="op" id="4810710">.</span><span class="ident" id="4810711">Errorf</span><span class="op" id="4810717">(</span><span class="string" id="4810718">&#34;xml:&nbsp;invalid&nbsp;tag&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s:&nbsp;%q&#34;</span><span class="op" id="4810763">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4810769">f</span><span class="op" id="4810770">.</span><span class="ident" id="4810771">Name</span><span class="op" id="4810775">,</span>&nbsp;<span class="ident" id="4810777">typ</span><span class="op" id="4810780">,</span>&nbsp;<span class="ident" id="4810782">f</span><span class="op" id="4810783">.</span><span class="ident" id="4810784">Tag</span><span class="op" id="4810787">.</span><span class="ident" id="4810788">Get</span><span class="op" id="4810791">(</span><span class="string" id="4810792">&#34;xml&#34;</span><span class="op" id="4810797">)</span><span class="op" id="4810798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4810802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4810805">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4810809">//&nbsp;Use&nbsp;of&nbsp;xmlns&nbsp;without&nbsp;a&nbsp;name&nbsp;is&nbsp;not&nbsp;allowed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4810857">if</span>&nbsp;<span class="ident" id="4810860">finfo</span><span class="op" id="4810865">.</span><span class="ident" id="4810866">xmlns</span>&nbsp;<span class="op" id="4810872">!=</span>&nbsp;<span class="string" id="4810875">&#34;&#34;</span>&nbsp;<span class="op" id="4810878">&amp;&amp;</span>&nbsp;<span class="ident" id="4810881">tag</span>&nbsp;<span class="op" id="4810885">==</span>&nbsp;<span class="string" id="4810888">&#34;&#34;</span>&nbsp;<span class="op" id="4810891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4810895">return</span>&nbsp;<span class="builtintype" id="4810902">nil</span><span class="op" id="4810905">,</span>&nbsp;<span class="ident" id="4810907">fmt</span><span class="op" id="4810910">.</span><span class="ident" id="4810911">Errorf</span><span class="op" id="4810917">(</span><span class="string" id="4810918">&#34;xml:&nbsp;namespace&nbsp;without&nbsp;name&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s:&nbsp;%q&#34;</span><span class="op" id="4810974">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4810979">f</span><span class="op" id="4810980">.</span><span class="ident" id="4810981">Name</span><span class="op" id="4810985">,</span>&nbsp;<span class="ident" id="4810987">typ</span><span class="op" id="4810990">,</span>&nbsp;<span class="ident" id="4810992">f</span><span class="op" id="4810993">.</span><span class="ident" id="4810994">Tag</span><span class="op" id="4810997">.</span><span class="ident" id="4810998">Get</span><span class="op" id="4811001">(</span><span class="string" id="4811002">&#34;xml&#34;</span><span class="op" id="4811007">)</span><span class="op" id="4811008">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4811011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4811015">if</span>&nbsp;<span class="ident" id="4811018">f</span><span class="op" id="4811019">.</span><span class="ident" id="4811020">Name</span>&nbsp;<span class="op" id="4811025">==</span>&nbsp;<span class="string" id="4811028">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="4811038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4811042">//&nbsp;The&nbsp;XMLName&nbsp;field&nbsp;records&nbsp;the&nbsp;XML&nbsp;element&nbsp;name.&nbsp;Don&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4811101">//&nbsp;process&nbsp;it&nbsp;as&nbsp;usual&nbsp;because&nbsp;its&nbsp;name&nbsp;should&nbsp;default&nbsp;to</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4811161">//&nbsp;empty&nbsp;rather&nbsp;than&nbsp;to&nbsp;the&nbsp;field&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4811203">finfo</span><span class="op" id="4811208">.</span><span class="ident" id="4811209">name</span>&nbsp;<span class="op" id="4811214">=</span>&nbsp;<span class="ident" id="4811216">tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4811222">return</span>&nbsp;<span class="ident" id="4811229">finfo</span><span class="op" id="4811234">,</span>&nbsp;<span class="builtintype" id="4811236">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4811241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4811245">if</span>&nbsp;<span class="ident" id="4811248">tag</span>&nbsp;<span class="op" id="4811252">==</span>&nbsp;<span class="string" id="4811255">&#34;&#34;</span>&nbsp;<span class="op" id="4811258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4811262">//&nbsp;If&nbsp;the&nbsp;name&nbsp;part&nbsp;of&nbsp;the&nbsp;tag&nbsp;is&nbsp;completely&nbsp;empty,&nbsp;get</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4811320">//&nbsp;default&nbsp;from&nbsp;XMLName&nbsp;of&nbsp;underlying&nbsp;struct&nbsp;if&nbsp;feasible,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4811380">//&nbsp;or&nbsp;field&nbsp;name&nbsp;otherwise.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4811410">if</span>&nbsp;<span class="ident" id="4811413">xmlname</span>&nbsp;<span class="op" id="4811421">:=</span>&nbsp;<span class="ident" id="4811424">lookupXMLName</span><span class="op" id="4811437">(</span><span class="ident" id="4811438">f</span><span class="op" id="4811439">.</span><span class="ident" id="4811440">Type</span><span class="op" id="4811444">)</span><span class="op" id="4811445">;</span>&nbsp;<span class="ident" id="4811447">xmlname</span>&nbsp;<span class="op" id="4811455">!=</span>&nbsp;<span class="builtintype" id="4811458">nil</span>&nbsp;<span class="op" id="4811462">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4811467">finfo</span><span class="op" id="4811472">.</span><span class="ident" id="4811473">xmlns</span><span class="op" id="4811478">,</span>&nbsp;<span class="ident" id="4811480">finfo</span><span class="op" id="4811485">.</span><span class="ident" id="4811486">name</span>&nbsp;<span class="op" id="4811491">=</span>&nbsp;<span class="ident" id="4811493">xmlname</span><span class="op" id="4811500">.</span><span class="ident" id="4811501">xmlns</span><span class="op" id="4811506">,</span>&nbsp;<span class="ident" id="4811508">xmlname</span><span class="op" id="4811515">.</span><span class="ident" id="4811516">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4811523">}</span>&nbsp;<span class="keyword" id="4811525">else</span>&nbsp;<span class="op" id="4811530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4811535">finfo</span><span class="op" id="4811540">.</span><span class="ident" id="4811541">name</span>&nbsp;<span class="op" id="4811546">=</span>&nbsp;<span class="ident" id="4811548">f</span><span class="op" id="4811549">.</span><span class="ident" id="4811550">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4811557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4811561">return</span>&nbsp;<span class="ident" id="4811568">finfo</span><span class="op" id="4811573">,</span>&nbsp;<span class="builtintype" id="4811575">nil</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4811580">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4811584">//&nbsp;Prepare&nbsp;field&nbsp;name&nbsp;and&nbsp;parents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4811620">parents</span>&nbsp;<span class="op" id="4811628">:=</span>&nbsp;<span class="ident" id="4811631">strings</span><span class="op" id="4811638">.</span><span class="ident" id="4811639">Split</span><span class="op" id="4811644">(</span><span class="ident" id="4811645">tag</span><span class="op" id="4811648">,</span>&nbsp;<span class="string" id="4811650">&#34;&gt;&#34;</span><span class="op" id="4811653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4811656">if</span>&nbsp;<span class="ident" id="4811659">parents</span><span class="op" id="4811666">[</span><span class="num" id="4811667">0</span><span class="op" id="4811668">]</span>&nbsp;<span class="op" id="4811670">==</span>&nbsp;<span class="string" id="4811673">&#34;&#34;</span>&nbsp;<span class="op" id="4811676">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4811680">parents</span><span class="op" id="4811687">[</span><span class="num" id="4811688">0</span><span class="op" id="4811689">]</span>&nbsp;<span class="op" id="4811691">=</span>&nbsp;<span class="ident" id="4811693">f</span><span class="op" id="4811694">.</span><span class="ident" id="4811695">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4811701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4811704">if</span>&nbsp;<span class="ident" id="4811707">parents</span><span class="op" id="4811714">[</span><span class="builtinfunc" id="4811715">len</span><span class="op" id="4811718">(</span><span class="ident" id="4811719">parents</span><span class="op" id="4811726">)</span><span class="op" id="4811727">-</span><span class="num" id="4811728">1</span><span class="op" id="4811729">]</span>&nbsp;<span class="op" id="4811731">==</span>&nbsp;<span class="string" id="4811734">&#34;&#34;</span>&nbsp;<span class="op" id="4811737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4811741">return</span>&nbsp;<span class="builtintype" id="4811748">nil</span><span class="op" id="4811751">,</span>&nbsp;<span class="ident" id="4811753">fmt</span><span class="op" id="4811756">.</span><span class="ident" id="4811757">Errorf</span><span class="op" id="4811763">(</span><span class="string" id="4811764">&#34;xml:&nbsp;trailing&nbsp;&#39;&gt;&#39;&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s&#34;</span><span class="op" id="4811806">,</span>&nbsp;<span class="ident" id="4811808">f</span><span class="op" id="4811809">.</span><span class="ident" id="4811810">Name</span><span class="op" id="4811814">,</span>&nbsp;<span class="ident" id="4811816">typ</span><span class="op" id="4811819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4811822">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4811825">finfo</span><span class="op" id="4811830">.</span><span class="ident" id="4811831">name</span>&nbsp;<span class="op" id="4811836">=</span>&nbsp;<span class="ident" id="4811838">parents</span><span class="op" id="4811845">[</span><span class="builtinfunc" id="4811846">len</span><span class="op" id="4811849">(</span><span class="ident" id="4811850">parents</span><span class="op" id="4811857">)</span><span class="op" id="4811858">-</span><span class="num" id="4811859">1</span><span class="op" id="4811860">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4811863">if</span>&nbsp;<span class="builtinfunc" id="4811866">len</span><span class="op" id="4811869">(</span><span class="ident" id="4811870">parents</span><span class="op" id="4811877">)</span>&nbsp;<span class="op" id="4811879">&gt;</span>&nbsp;<span class="num" id="4811881">1</span>&nbsp;<span class="op" id="4811883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4811887">if</span>&nbsp;<span class="op" id="4811890">(</span><span class="ident" id="4811891">finfo</span><span class="op" id="4811896">.</span><span class="ident" id="4811897">flags</span>&nbsp;<span class="op" id="4811903">&amp;</span>&nbsp;<span class="ident" id="4811905">fElement</span><span class="op" id="4811913">)</span>&nbsp;<span class="op" id="4811915">==</span>&nbsp;<span class="num" id="4811918">0</span>&nbsp;<span class="op" id="4811920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4811925">return</span>&nbsp;<span class="builtintype" id="4811932">nil</span><span class="op" id="4811935">,</span>&nbsp;<span class="ident" id="4811937">fmt</span><span class="op" id="4811940">.</span><span class="ident" id="4811941">Errorf</span><span class="op" id="4811947">(</span><span class="string" id="4811948">&#34;xml:&nbsp;%s&nbsp;chain&nbsp;not&nbsp;valid&nbsp;with&nbsp;%s&nbsp;flag&#34;</span><span class="op" id="4811986">,</span>&nbsp;<span class="ident" id="4811988">tag</span><span class="op" id="4811991">,</span>&nbsp;<span class="ident" id="4811993">strings</span><span class="op" id="4812000">.</span><span class="ident" id="4812001">Join</span><span class="op" id="4812005">(</span><span class="ident" id="4812006">tokens</span><span class="op" id="4812012">[</span><span class="num" id="4812013">1</span><span class="op" id="4812014">:</span><span class="op" id="4812015">]</span><span class="op" id="4812016">,</span>&nbsp;<span class="string" id="4812018">&#34;,&#34;</span><span class="op" id="4812021">)</span><span class="op" id="4812022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4812026">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4812030">finfo</span><span class="op" id="4812035">.</span><span class="ident" id="4812036">parents</span>&nbsp;<span class="op" id="4812044">=</span>&nbsp;<span class="ident" id="4812046">parents</span><span class="op" id="4812053">[</span><span class="op" id="4812054">:</span><span class="builtinfunc" id="4812055">len</span><span class="op" id="4812058">(</span><span class="ident" id="4812059">parents</span><span class="op" id="4812066">)</span><span class="op" id="4812067">-</span><span class="num" id="4812068">1</span><span class="op" id="4812069">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4812072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4812076">//&nbsp;If&nbsp;the&nbsp;field&nbsp;type&nbsp;has&nbsp;an&nbsp;XMLName&nbsp;field,&nbsp;the&nbsp;names&nbsp;must&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4812141">//&nbsp;so&nbsp;that&nbsp;the&nbsp;behavior&nbsp;of&nbsp;both&nbsp;marshalling&nbsp;and&nbsp;unmarshalling</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4812204">//&nbsp;is&nbsp;straightforward&nbsp;and&nbsp;unambiguous.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4812244">if</span>&nbsp;<span class="ident" id="4812247">finfo</span><span class="op" id="4812252">.</span><span class="ident" id="4812253">flags</span><span class="op" id="4812258">&amp;</span><span class="ident" id="4812259">fElement</span>&nbsp;<span class="op" id="4812268">!=</span>&nbsp;<span class="num" id="4812271">0</span>&nbsp;<span class="op" id="4812273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4812277">ftyp</span>&nbsp;<span class="op" id="4812282">:=</span>&nbsp;<span class="ident" id="4812285">f</span><span class="op" id="4812286">.</span><span class="ident" id="4812287">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4812294">xmlname</span>&nbsp;<span class="op" id="4812302">:=</span>&nbsp;<span class="ident" id="4812305">lookupXMLName</span><span class="op" id="4812318">(</span><span class="ident" id="4812319">ftyp</span><span class="op" id="4812323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4812327">if</span>&nbsp;<span class="ident" id="4812330">xmlname</span>&nbsp;<span class="op" id="4812338">!=</span>&nbsp;<span class="builtintype" id="4812341">nil</span>&nbsp;<span class="op" id="4812345">&amp;&amp;</span>&nbsp;<span class="ident" id="4812348">xmlname</span><span class="op" id="4812355">.</span><span class="ident" id="4812356">name</span>&nbsp;<span class="op" id="4812361">!=</span>&nbsp;<span class="ident" id="4812364">finfo</span><span class="op" id="4812369">.</span><span class="ident" id="4812370">name</span>&nbsp;<span class="op" id="4812375">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4812380">return</span>&nbsp;<span class="builtintype" id="4812387">nil</span><span class="op" id="4812390">,</span>&nbsp;<span class="ident" id="4812392">fmt</span><span class="op" id="4812395">.</span><span class="ident" id="4812396">Errorf</span><span class="op" id="4812402">(</span><span class="string" id="4812403">&#34;xml:&nbsp;name&nbsp;%q&nbsp;in&nbsp;tag&nbsp;of&nbsp;%s.%s&nbsp;conflicts&nbsp;with&nbsp;name&nbsp;%q&nbsp;in&nbsp;%s.XMLName&#34;</span><span class="op" id="4812470">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4812476">finfo</span><span class="op" id="4812481">.</span><span class="ident" id="4812482">name</span><span class="op" id="4812486">,</span>&nbsp;<span class="ident" id="4812488">typ</span><span class="op" id="4812491">,</span>&nbsp;<span class="ident" id="4812493">f</span><span class="op" id="4812494">.</span><span class="ident" id="4812495">Name</span><span class="op" id="4812499">,</span>&nbsp;<span class="ident" id="4812501">xmlname</span><span class="op" id="4812508">.</span><span class="ident" id="4812509">name</span><span class="op" id="4812513">,</span>&nbsp;<span class="ident" id="4812515">ftyp</span><span class="op" id="4812519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4812523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4812526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4812529">return</span>&nbsp;<span class="ident" id="4812536">finfo</span><span class="op" id="4812541">,</span>&nbsp;<span class="builtintype" id="4812543">nil</span><br>
<span class="lineno">225</span><span class="op" id="4812547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4812550">//&nbsp;lookupXMLName&nbsp;returns&nbsp;the&nbsp;fieldInfo&nbsp;for&nbsp;typ&#39;s&nbsp;XMLName&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="4812613">//&nbsp;in&nbsp;case&nbsp;it&nbsp;exists&nbsp;and&nbsp;has&nbsp;a&nbsp;valid&nbsp;xml&nbsp;field&nbsp;tag,&nbsp;otherwise</span><br>
<span class="lineno"></span><span class="comment" id="4812675">//&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno">230</span><span class="keyword" id="4812694">func</span>&nbsp;<span class="ident" id="4812699">lookupXMLName</span><span class="op" id="4812712">(</span><span class="ident" id="4812713">typ</span>&nbsp;<span class="ident" id="4812717">reflect</span><span class="op" id="4812724">.</span><span class="ident" id="4812725">Type</span><span class="op" id="4812729">)</span>&nbsp;<span class="op" id="4812731">(</span><span class="ident" id="4812732">xmlname</span>&nbsp;<span class="op" id="4812740">*</span><span class="ident" id="4812741">fieldInfo</span><span class="op" id="4812750">)</span>&nbsp;<span class="op" id="4812752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4812755">for</span>&nbsp;<span class="ident" id="4812759">typ</span><span class="op" id="4812762">.</span><span class="ident" id="4812763">Kind</span><span class="op" id="4812767">(</span><span class="op" id="4812768">)</span>&nbsp;<span class="op" id="4812770">==</span>&nbsp;<span class="ident" id="4812773">reflect</span><span class="op" id="4812780">.</span><span class="ident" id="4812781">Ptr</span>&nbsp;<span class="op" id="4812785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4812789">typ</span>&nbsp;<span class="op" id="4812793">=</span>&nbsp;<span class="ident" id="4812795">typ</span><span class="op" id="4812798">.</span><span class="ident" id="4812799">Elem</span><span class="op" id="4812803">(</span><span class="op" id="4812804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4812807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4812810">if</span>&nbsp;<span class="ident" id="4812813">typ</span><span class="op" id="4812816">.</span><span class="ident" id="4812817">Kind</span><span class="op" id="4812821">(</span><span class="op" id="4812822">)</span>&nbsp;<span class="op" id="4812824">!=</span>&nbsp;<span class="ident" id="4812827">reflect</span><span class="op" id="4812834">.</span><span class="ident" id="4812835">Struct</span>&nbsp;<span class="op" id="4812842">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4812846">return</span>&nbsp;<span class="builtintype" id="4812853">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4812858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4812861">for</span>&nbsp;<span class="ident" id="4812865">i</span><span class="op" id="4812866">,</span>&nbsp;<span class="ident" id="4812868">n</span>&nbsp;<span class="op" id="4812870">:=</span>&nbsp;<span class="num" id="4812873">0</span><span class="op" id="4812874">,</span>&nbsp;<span class="ident" id="4812876">typ</span><span class="op" id="4812879">.</span><span class="ident" id="4812880">NumField</span><span class="op" id="4812888">(</span><span class="op" id="4812889">)</span><span class="op" id="4812890">;</span>&nbsp;<span class="ident" id="4812892">i</span>&nbsp;<span class="op" id="4812894">&lt;</span>&nbsp;<span class="ident" id="4812896">n</span><span class="op" id="4812897">;</span>&nbsp;<span class="ident" id="4812899">i</span><span class="op" id="4812900">++</span>&nbsp;<span class="op" id="4812903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4812907">f</span>&nbsp;<span class="op" id="4812909">:=</span>&nbsp;<span class="ident" id="4812912">typ</span><span class="op" id="4812915">.</span><span class="ident" id="4812916">Field</span><span class="op" id="4812921">(</span><span class="ident" id="4812922">i</span><span class="op" id="4812923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4812927">if</span>&nbsp;<span class="ident" id="4812930">f</span><span class="op" id="4812931">.</span><span class="ident" id="4812932">Name</span>&nbsp;<span class="op" id="4812937">!=</span>&nbsp;<span class="string" id="4812940">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="4812950">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4812955">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4812966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4812970">finfo</span><span class="op" id="4812975">,</span>&nbsp;<span class="ident" id="4812977">err</span>&nbsp;<span class="op" id="4812981">:=</span>&nbsp;<span class="ident" id="4812984">structFieldInfo</span><span class="op" id="4812999">(</span><span class="ident" id="4813000">typ</span><span class="op" id="4813003">,</span>&nbsp;<span class="op" id="4813005">&amp;</span><span class="ident" id="4813006">f</span><span class="op" id="4813007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4813011">if</span>&nbsp;<span class="ident" id="4813014">finfo</span><span class="op" id="4813019">.</span><span class="ident" id="4813020">name</span>&nbsp;<span class="op" id="4813025">!=</span>&nbsp;<span class="string" id="4813028">&#34;&#34;</span>&nbsp;<span class="op" id="4813031">&amp;&amp;</span>&nbsp;<span class="ident" id="4813034">err</span>&nbsp;<span class="op" id="4813038">==</span>&nbsp;<span class="builtintype" id="4813041">nil</span>&nbsp;<span class="op" id="4813045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4813050">return</span>&nbsp;<span class="ident" id="4813057">finfo</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4813065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4813069">//&nbsp;Also&nbsp;consider&nbsp;errors&nbsp;as&nbsp;a&nbsp;non-existent&nbsp;field&nbsp;tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4813123">//&nbsp;and&nbsp;let&nbsp;getTypeInfo&nbsp;itself&nbsp;report&nbsp;the&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4813173">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4813180">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4813183">return</span>&nbsp;<span class="builtintype" id="4813190">nil</span><br>
<span class="lineno"></span><span class="op" id="4813194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4813197">func</span>&nbsp;<span class="ident" id="4813202">min</span><span class="op" id="4813205">(</span><span class="ident" id="4813206">a</span><span class="op" id="4813207">,</span>&nbsp;<span class="ident" id="4813209">b</span>&nbsp;<span class="builtintype" id="4813211">int</span><span class="op" id="4813214">)</span>&nbsp;<span class="builtintype" id="4813216">int</span>&nbsp;<span class="op" id="4813220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4813223">if</span>&nbsp;<span class="ident" id="4813226">a</span>&nbsp;<span class="op" id="4813228">&lt;=</span>&nbsp;<span class="ident" id="4813231">b</span>&nbsp;<span class="op" id="4813233">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4813237">return</span>&nbsp;<span class="ident" id="4813244">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4813247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4813250">return</span>&nbsp;<span class="ident" id="4813257">b</span><br>
<span class="lineno"></span><span class="op" id="4813259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="4813262">//&nbsp;addFieldInfo&nbsp;adds&nbsp;finfo&nbsp;to&nbsp;tinfo.fields&nbsp;if&nbsp;there&nbsp;are&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="4813321">//&nbsp;conflicts,&nbsp;or&nbsp;if&nbsp;conflicts&nbsp;arise&nbsp;from&nbsp;previous&nbsp;fields&nbsp;that&nbsp;were</span><br>
<span class="lineno"></span><span class="comment" id="4813388">//&nbsp;obtained&nbsp;from&nbsp;deeper&nbsp;embedded&nbsp;structures&nbsp;than&nbsp;finfo.&nbsp;In&nbsp;the&nbsp;latter</span><br>
<span class="lineno"></span><span class="comment" id="4813458">//&nbsp;case,&nbsp;the&nbsp;conflicting&nbsp;entries&nbsp;are&nbsp;dropped.</span><br>
<span class="lineno"></span><span class="comment" id="4813504">//&nbsp;A&nbsp;conflict&nbsp;occurs&nbsp;when&nbsp;the&nbsp;path&nbsp;(parent&nbsp;+&nbsp;name)&nbsp;to&nbsp;a&nbsp;field&nbsp;is</span><br>
<span class="lineno">265</span><span class="comment" id="4813569">//&nbsp;itself&nbsp;a&nbsp;prefix&nbsp;of&nbsp;another&nbsp;path,&nbsp;or&nbsp;when&nbsp;two&nbsp;paths&nbsp;match&nbsp;exactly.</span><br>
<span class="lineno"></span><span class="comment" id="4813638">//&nbsp;It&nbsp;is&nbsp;okay&nbsp;for&nbsp;field&nbsp;paths&nbsp;to&nbsp;share&nbsp;a&nbsp;common,&nbsp;shorter&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="4813703">func</span>&nbsp;<span class="ident" id="4813708">addFieldInfo</span><span class="op" id="4813720">(</span><span class="ident" id="4813721">typ</span>&nbsp;<span class="ident" id="4813725">reflect</span><span class="op" id="4813732">.</span><span class="ident" id="4813733">Type</span><span class="op" id="4813737">,</span>&nbsp;<span class="ident" id="4813739">tinfo</span>&nbsp;<span class="op" id="4813745">*</span><span class="ident" id="4813746">typeInfo</span><span class="op" id="4813754">,</span>&nbsp;<span class="ident" id="4813756">newf</span>&nbsp;<span class="op" id="4813761">*</span><span class="ident" id="4813762">fieldInfo</span><span class="op" id="4813771">)</span>&nbsp;<span class="builtintype" id="4813773">error</span>&nbsp;<span class="op" id="4813779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4813782">var</span>&nbsp;<span class="ident" id="4813786">conflicts</span>&nbsp;<span class="op" id="4813796">[</span><span class="op" id="4813797">]</span><span class="builtintype" id="4813798">int</span><br>
<span class="lineno"></span><span class="ident" id="4813802">Loop</span><span class="op" id="4813806">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4813809">//&nbsp;First,&nbsp;figure&nbsp;all&nbsp;conflicts.&nbsp;Most&nbsp;working&nbsp;code&nbsp;will&nbsp;have&nbsp;none.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4813876">for</span>&nbsp;<span class="ident" id="4813880">i</span>&nbsp;<span class="op" id="4813882">:=</span>&nbsp;<span class="keyword" id="4813885">range</span>&nbsp;<span class="ident" id="4813891">tinfo</span><span class="op" id="4813896">.</span><span class="ident" id="4813897">fields</span>&nbsp;<span class="op" id="4813904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4813908">oldf</span>&nbsp;<span class="op" id="4813913">:=</span>&nbsp;<span class="op" id="4813916">&amp;</span><span class="ident" id="4813917">tinfo</span><span class="op" id="4813922">.</span><span class="ident" id="4813923">fields</span><span class="op" id="4813929">[</span><span class="ident" id="4813930">i</span><span class="op" id="4813931">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4813935">if</span>&nbsp;<span class="ident" id="4813938">oldf</span><span class="op" id="4813942">.</span><span class="ident" id="4813943">flags</span><span class="op" id="4813948">&amp;</span><span class="ident" id="4813949">fMode</span>&nbsp;<span class="op" id="4813955">!=</span>&nbsp;<span class="ident" id="4813958">newf</span><span class="op" id="4813962">.</span><span class="ident" id="4813963">flags</span><span class="op" id="4813968">&amp;</span><span class="ident" id="4813969">fMode</span>&nbsp;<span class="op" id="4813975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4813980">continue</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4813991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4813995">if</span>&nbsp;<span class="ident" id="4813998">oldf</span><span class="op" id="4814002">.</span><span class="ident" id="4814003">xmlns</span>&nbsp;<span class="op" id="4814009">!=</span>&nbsp;<span class="string" id="4814012">&#34;&#34;</span>&nbsp;<span class="op" id="4814015">&amp;&amp;</span>&nbsp;<span class="ident" id="4814018">newf</span><span class="op" id="4814022">.</span><span class="ident" id="4814023">xmlns</span>&nbsp;<span class="op" id="4814029">!=</span>&nbsp;<span class="string" id="4814032">&#34;&#34;</span>&nbsp;<span class="op" id="4814035">&amp;&amp;</span>&nbsp;<span class="ident" id="4814038">oldf</span><span class="op" id="4814042">.</span><span class="ident" id="4814043">xmlns</span>&nbsp;<span class="op" id="4814049">!=</span>&nbsp;<span class="ident" id="4814052">newf</span><span class="op" id="4814056">.</span><span class="ident" id="4814057">xmlns</span>&nbsp;<span class="op" id="4814063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4814068">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4814079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4814083">minl</span>&nbsp;<span class="op" id="4814088">:=</span>&nbsp;<span class="ident" id="4814091">min</span><span class="op" id="4814094">(</span><span class="builtinfunc" id="4814095">len</span><span class="op" id="4814098">(</span><span class="ident" id="4814099">newf</span><span class="op" id="4814103">.</span><span class="ident" id="4814104">parents</span><span class="op" id="4814111">)</span><span class="op" id="4814112">,</span>&nbsp;<span class="builtinfunc" id="4814114">len</span><span class="op" id="4814117">(</span><span class="ident" id="4814118">oldf</span><span class="op" id="4814122">.</span><span class="ident" id="4814123">parents</span><span class="op" id="4814130">)</span><span class="op" id="4814131">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4814135">for</span>&nbsp;<span class="ident" id="4814139">p</span>&nbsp;<span class="op" id="4814141">:=</span>&nbsp;<span class="num" id="4814144">0</span><span class="op" id="4814145">;</span>&nbsp;<span class="ident" id="4814147">p</span>&nbsp;<span class="op" id="4814149">&lt;</span>&nbsp;<span class="ident" id="4814151">minl</span><span class="op" id="4814155">;</span>&nbsp;<span class="ident" id="4814157">p</span><span class="op" id="4814158">++</span>&nbsp;<span class="op" id="4814161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4814166">if</span>&nbsp;<span class="ident" id="4814169">oldf</span><span class="op" id="4814173">.</span><span class="ident" id="4814174">parents</span><span class="op" id="4814181">[</span><span class="ident" id="4814182">p</span><span class="op" id="4814183">]</span>&nbsp;<span class="op" id="4814185">!=</span>&nbsp;<span class="ident" id="4814188">newf</span><span class="op" id="4814192">.</span><span class="ident" id="4814193">parents</span><span class="op" id="4814200">[</span><span class="ident" id="4814201">p</span><span class="op" id="4814202">]</span>&nbsp;<span class="op" id="4814204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4814210">continue</span>&nbsp;<span class="ident" id="4814219">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4814227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4814231">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4814235">if</span>&nbsp;<span class="builtinfunc" id="4814238">len</span><span class="op" id="4814241">(</span><span class="ident" id="4814242">oldf</span><span class="op" id="4814246">.</span><span class="ident" id="4814247">parents</span><span class="op" id="4814254">)</span>&nbsp;<span class="op" id="4814256">&gt;</span>&nbsp;<span class="builtinfunc" id="4814258">len</span><span class="op" id="4814261">(</span><span class="ident" id="4814262">newf</span><span class="op" id="4814266">.</span><span class="ident" id="4814267">parents</span><span class="op" id="4814274">)</span>&nbsp;<span class="op" id="4814276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4814281">if</span>&nbsp;<span class="ident" id="4814284">oldf</span><span class="op" id="4814288">.</span><span class="ident" id="4814289">parents</span><span class="op" id="4814296">[</span><span class="builtinfunc" id="4814297">len</span><span class="op" id="4814300">(</span><span class="ident" id="4814301">newf</span><span class="op" id="4814305">.</span><span class="ident" id="4814306">parents</span><span class="op" id="4814313">)</span><span class="op" id="4814314">]</span>&nbsp;<span class="op" id="4814316">==</span>&nbsp;<span class="ident" id="4814319">newf</span><span class="op" id="4814323">.</span><span class="ident" id="4814324">name</span>&nbsp;<span class="op" id="4814329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4814335">conflicts</span>&nbsp;<span class="op" id="4814345">=</span>&nbsp;<span class="builtinfunc" id="4814347">append</span><span class="op" id="4814353">(</span><span class="ident" id="4814354">conflicts</span><span class="op" id="4814363">,</span>&nbsp;<span class="ident" id="4814365">i</span><span class="op" id="4814366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4814371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4814375">}</span>&nbsp;<span class="keyword" id="4814377">else</span>&nbsp;<span class="keyword" id="4814382">if</span>&nbsp;<span class="builtinfunc" id="4814385">len</span><span class="op" id="4814388">(</span><span class="ident" id="4814389">oldf</span><span class="op" id="4814393">.</span><span class="ident" id="4814394">parents</span><span class="op" id="4814401">)</span>&nbsp;<span class="op" id="4814403">&lt;</span>&nbsp;<span class="builtinfunc" id="4814405">len</span><span class="op" id="4814408">(</span><span class="ident" id="4814409">newf</span><span class="op" id="4814413">.</span><span class="ident" id="4814414">parents</span><span class="op" id="4814421">)</span>&nbsp;<span class="op" id="4814423">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4814428">if</span>&nbsp;<span class="ident" id="4814431">newf</span><span class="op" id="4814435">.</span><span class="ident" id="4814436">parents</span><span class="op" id="4814443">[</span><span class="builtinfunc" id="4814444">len</span><span class="op" id="4814447">(</span><span class="ident" id="4814448">oldf</span><span class="op" id="4814452">.</span><span class="ident" id="4814453">parents</span><span class="op" id="4814460">)</span><span class="op" id="4814461">]</span>&nbsp;<span class="op" id="4814463">==</span>&nbsp;<span class="ident" id="4814466">oldf</span><span class="op" id="4814470">.</span><span class="ident" id="4814471">name</span>&nbsp;<span class="op" id="4814476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4814482">conflicts</span>&nbsp;<span class="op" id="4814492">=</span>&nbsp;<span class="builtinfunc" id="4814494">append</span><span class="op" id="4814500">(</span><span class="ident" id="4814501">conflicts</span><span class="op" id="4814510">,</span>&nbsp;<span class="ident" id="4814512">i</span><span class="op" id="4814513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4814518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4814522">}</span>&nbsp;<span class="keyword" id="4814524">else</span>&nbsp;<span class="op" id="4814529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4814534">if</span>&nbsp;<span class="ident" id="4814537">newf</span><span class="op" id="4814541">.</span><span class="ident" id="4814542">name</span>&nbsp;<span class="op" id="4814547">==</span>&nbsp;<span class="ident" id="4814550">oldf</span><span class="op" id="4814554">.</span><span class="ident" id="4814555">name</span>&nbsp;<span class="op" id="4814560">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4814566">conflicts</span>&nbsp;<span class="op" id="4814576">=</span>&nbsp;<span class="builtinfunc" id="4814578">append</span><span class="op" id="4814584">(</span><span class="ident" id="4814585">conflicts</span><span class="op" id="4814594">,</span>&nbsp;<span class="ident" id="4814596">i</span><span class="op" id="4814597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4814602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4814606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4814609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4814612">//&nbsp;Without&nbsp;conflicts,&nbsp;add&nbsp;the&nbsp;new&nbsp;field&nbsp;and&nbsp;return.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4814665">if</span>&nbsp;<span class="ident" id="4814668">conflicts</span>&nbsp;<span class="op" id="4814678">==</span>&nbsp;<span class="builtintype" id="4814681">nil</span>&nbsp;<span class="op" id="4814685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4814689">tinfo</span><span class="op" id="4814694">.</span><span class="ident" id="4814695">fields</span>&nbsp;<span class="op" id="4814702">=</span>&nbsp;<span class="builtinfunc" id="4814704">append</span><span class="op" id="4814710">(</span><span class="ident" id="4814711">tinfo</span><span class="op" id="4814716">.</span><span class="ident" id="4814717">fields</span><span class="op" id="4814723">,</span>&nbsp;<span class="op" id="4814725">*</span><span class="ident" id="4814726">newf</span><span class="op" id="4814730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4814734">return</span>&nbsp;<span class="builtintype" id="4814741">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4814746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4814750">//&nbsp;If&nbsp;any&nbsp;conflict&nbsp;is&nbsp;shallower,&nbsp;ignore&nbsp;the&nbsp;new&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4814806">//&nbsp;This&nbsp;matches&nbsp;the&nbsp;Go&nbsp;field&nbsp;resolution&nbsp;on&nbsp;embedding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4814861">for</span>&nbsp;<span class="ident" id="4814865">_</span><span class="op" id="4814866">,</span>&nbsp;<span class="ident" id="4814868">i</span>&nbsp;<span class="op" id="4814870">:=</span>&nbsp;<span class="keyword" id="4814873">range</span>&nbsp;<span class="ident" id="4814879">conflicts</span>&nbsp;<span class="op" id="4814889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4814893">if</span>&nbsp;<span class="builtinfunc" id="4814896">len</span><span class="op" id="4814899">(</span><span class="ident" id="4814900">tinfo</span><span class="op" id="4814905">.</span><span class="ident" id="4814906">fields</span><span class="op" id="4814912">[</span><span class="ident" id="4814913">i</span><span class="op" id="4814914">]</span><span class="op" id="4814915">.</span><span class="ident" id="4814916">idx</span><span class="op" id="4814919">)</span>&nbsp;<span class="op" id="4814921">&lt;</span>&nbsp;<span class="builtinfunc" id="4814923">len</span><span class="op" id="4814926">(</span><span class="ident" id="4814927">newf</span><span class="op" id="4814931">.</span><span class="ident" id="4814932">idx</span><span class="op" id="4814935">)</span>&nbsp;<span class="op" id="4814937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4814942">return</span>&nbsp;<span class="builtintype" id="4814949">nil</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4814955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4814958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4814962">//&nbsp;Otherwise,&nbsp;if&nbsp;any&nbsp;of&nbsp;them&nbsp;is&nbsp;at&nbsp;the&nbsp;same&nbsp;depth&nbsp;level,&nbsp;it&#39;s&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4815035">for</span>&nbsp;<span class="ident" id="4815039">_</span><span class="op" id="4815040">,</span>&nbsp;<span class="ident" id="4815042">i</span>&nbsp;<span class="op" id="4815044">:=</span>&nbsp;<span class="keyword" id="4815047">range</span>&nbsp;<span class="ident" id="4815053">conflicts</span>&nbsp;<span class="op" id="4815063">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4815067">oldf</span>&nbsp;<span class="op" id="4815072">:=</span>&nbsp;<span class="op" id="4815075">&amp;</span><span class="ident" id="4815076">tinfo</span><span class="op" id="4815081">.</span><span class="ident" id="4815082">fields</span><span class="op" id="4815088">[</span><span class="ident" id="4815089">i</span><span class="op" id="4815090">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4815094">if</span>&nbsp;<span class="builtinfunc" id="4815097">len</span><span class="op" id="4815100">(</span><span class="ident" id="4815101">oldf</span><span class="op" id="4815105">.</span><span class="ident" id="4815106">idx</span><span class="op" id="4815109">)</span>&nbsp;<span class="op" id="4815111">==</span>&nbsp;<span class="builtinfunc" id="4815114">len</span><span class="op" id="4815117">(</span><span class="ident" id="4815118">newf</span><span class="op" id="4815122">.</span><span class="ident" id="4815123">idx</span><span class="op" id="4815126">)</span>&nbsp;<span class="op" id="4815128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4815133">f1</span>&nbsp;<span class="op" id="4815136">:=</span>&nbsp;<span class="ident" id="4815139">typ</span><span class="op" id="4815142">.</span><span class="ident" id="4815143">FieldByIndex</span><span class="op" id="4815155">(</span><span class="ident" id="4815156">oldf</span><span class="op" id="4815160">.</span><span class="ident" id="4815161">idx</span><span class="op" id="4815164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4815169">f2</span>&nbsp;<span class="op" id="4815172">:=</span>&nbsp;<span class="ident" id="4815175">typ</span><span class="op" id="4815178">.</span><span class="ident" id="4815179">FieldByIndex</span><span class="op" id="4815191">(</span><span class="ident" id="4815192">newf</span><span class="op" id="4815196">.</span><span class="ident" id="4815197">idx</span><span class="op" id="4815200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4815205">return</span>&nbsp;<span class="op" id="4815212">&amp;</span><span class="ident" id="4815213">TagPathError</span><span class="op" id="4815225">{</span><span class="ident" id="4815226">typ</span><span class="op" id="4815229">,</span>&nbsp;<span class="ident" id="4815231">f1</span><span class="op" id="4815233">.</span><span class="ident" id="4815234">Name</span><span class="op" id="4815238">,</span>&nbsp;<span class="ident" id="4815240">f1</span><span class="op" id="4815242">.</span><span class="ident" id="4815243">Tag</span><span class="op" id="4815246">.</span><span class="ident" id="4815247">Get</span><span class="op" id="4815250">(</span><span class="string" id="4815251">&#34;xml&#34;</span><span class="op" id="4815256">)</span><span class="op" id="4815257">,</span>&nbsp;<span class="ident" id="4815259">f2</span><span class="op" id="4815261">.</span><span class="ident" id="4815262">Name</span><span class="op" id="4815266">,</span>&nbsp;<span class="ident" id="4815268">f2</span><span class="op" id="4815270">.</span><span class="ident" id="4815271">Tag</span><span class="op" id="4815274">.</span><span class="ident" id="4815275">Get</span><span class="op" id="4815278">(</span><span class="string" id="4815279">&#34;xml&#34;</span><span class="op" id="4815284">)</span><span class="op" id="4815285">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4815289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4815292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4815296">//&nbsp;Otherwise,&nbsp;the&nbsp;new&nbsp;field&nbsp;is&nbsp;shallower,&nbsp;and&nbsp;thus&nbsp;takes&nbsp;precedence,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4815366">//&nbsp;so&nbsp;drop&nbsp;the&nbsp;conflicting&nbsp;fields&nbsp;from&nbsp;tinfo&nbsp;and&nbsp;append&nbsp;the&nbsp;new&nbsp;one.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4815436">for</span>&nbsp;<span class="ident" id="4815440">c</span>&nbsp;<span class="op" id="4815442">:=</span>&nbsp;<span class="builtinfunc" id="4815445">len</span><span class="op" id="4815448">(</span><span class="ident" id="4815449">conflicts</span><span class="op" id="4815458">)</span>&nbsp;<span class="op" id="4815460">-</span>&nbsp;<span class="num" id="4815462">1</span><span class="op" id="4815463">;</span>&nbsp;<span class="ident" id="4815465">c</span>&nbsp;<span class="op" id="4815467">&gt;=</span>&nbsp;<span class="num" id="4815470">0</span><span class="op" id="4815471">;</span>&nbsp;<span class="ident" id="4815473">c</span><span class="op" id="4815474">--</span>&nbsp;<span class="op" id="4815477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4815481">i</span>&nbsp;<span class="op" id="4815483">:=</span>&nbsp;<span class="ident" id="4815486">conflicts</span><span class="op" id="4815495">[</span><span class="ident" id="4815496">c</span><span class="op" id="4815497">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4815501">copy</span><span class="op" id="4815505">(</span><span class="ident" id="4815506">tinfo</span><span class="op" id="4815511">.</span><span class="ident" id="4815512">fields</span><span class="op" id="4815518">[</span><span class="ident" id="4815519">i</span><span class="op" id="4815520">:</span><span class="op" id="4815521">]</span><span class="op" id="4815522">,</span>&nbsp;<span class="ident" id="4815524">tinfo</span><span class="op" id="4815529">.</span><span class="ident" id="4815530">fields</span><span class="op" id="4815536">[</span><span class="ident" id="4815537">i</span><span class="op" id="4815538">+</span><span class="num" id="4815539">1</span><span class="op" id="4815540">:</span><span class="op" id="4815541">]</span><span class="op" id="4815542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4815546">tinfo</span><span class="op" id="4815551">.</span><span class="ident" id="4815552">fields</span>&nbsp;<span class="op" id="4815559">=</span>&nbsp;<span class="ident" id="4815561">tinfo</span><span class="op" id="4815566">.</span><span class="ident" id="4815567">fields</span><span class="op" id="4815573">[</span><span class="op" id="4815574">:</span><span class="builtinfunc" id="4815575">len</span><span class="op" id="4815578">(</span><span class="ident" id="4815579">tinfo</span><span class="op" id="4815584">.</span><span class="ident" id="4815585">fields</span><span class="op" id="4815591">)</span><span class="op" id="4815592">-</span><span class="num" id="4815593">1</span><span class="op" id="4815594">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4815597">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4815600">tinfo</span><span class="op" id="4815605">.</span><span class="ident" id="4815606">fields</span>&nbsp;<span class="op" id="4815613">=</span>&nbsp;<span class="builtinfunc" id="4815615">append</span><span class="op" id="4815621">(</span><span class="ident" id="4815622">tinfo</span><span class="op" id="4815627">.</span><span class="ident" id="4815628">fields</span><span class="op" id="4815634">,</span>&nbsp;<span class="op" id="4815636">*</span><span class="ident" id="4815637">newf</span><span class="op" id="4815641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4815644">return</span>&nbsp;<span class="builtintype" id="4815651">nil</span><br>
<span class="lineno"></span><span class="op" id="4815655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4815658">//&nbsp;A&nbsp;TagPathError&nbsp;represents&nbsp;an&nbsp;error&nbsp;in&nbsp;the&nbsp;unmarshalling&nbsp;process</span><br>
<span class="lineno">335</span><span class="comment" id="4815725">//&nbsp;caused&nbsp;by&nbsp;the&nbsp;use&nbsp;of&nbsp;field&nbsp;tags&nbsp;with&nbsp;conflicting&nbsp;paths.</span><br>
<span class="lineno"></span><span class="keyword" id="4815784">type</span>&nbsp;<span class="ident" id="4815789">TagPathError</span>&nbsp;<span class="keyword" id="4815802">struct</span>&nbsp;<span class="op" id="4815809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4815812">Struct</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4815825">reflect</span><span class="op" id="4815832">.</span><span class="ident" id="4815833">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4815839">Field1</span><span class="op" id="4815845">,</span>&nbsp;<span class="ident" id="4815847">Tag1</span>&nbsp;<span class="builtintype" id="4815852">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4815860">Field2</span><span class="op" id="4815866">,</span>&nbsp;<span class="ident" id="4815868">Tag2</span>&nbsp;<span class="builtintype" id="4815873">string</span><br>
<span class="lineno">340</span><span class="op" id="4815880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4815883">func</span>&nbsp;<span class="op" id="4815888">(</span><span class="ident" id="4815889">e</span>&nbsp;<span class="op" id="4815891">*</span><span class="ident" id="4815892">TagPathError</span><span class="op" id="4815904">)</span>&nbsp;<span class="ident" id="4815906">Error</span><span class="op" id="4815911">(</span><span class="op" id="4815912">)</span>&nbsp;<span class="builtintype" id="4815914">string</span>&nbsp;<span class="op" id="4815921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4815924">return</span>&nbsp;<span class="ident" id="4815931">fmt</span><span class="op" id="4815934">.</span><span class="ident" id="4815935">Sprintf</span><span class="op" id="4815942">(</span><span class="string" id="4815943">&#34;%s&nbsp;field&nbsp;%q&nbsp;with&nbsp;tag&nbsp;%q&nbsp;conflicts&nbsp;with&nbsp;field&nbsp;%q&nbsp;with&nbsp;tag&nbsp;%q&#34;</span><span class="op" id="4816004">,</span>&nbsp;<span class="ident" id="4816006">e</span><span class="op" id="4816007">.</span><span class="ident" id="4816008">Struct</span><span class="op" id="4816014">,</span>&nbsp;<span class="ident" id="4816016">e</span><span class="op" id="4816017">.</span><span class="ident" id="4816018">Field1</span><span class="op" id="4816024">,</span>&nbsp;<span class="ident" id="4816026">e</span><span class="op" id="4816027">.</span><span class="ident" id="4816028">Tag1</span><span class="op" id="4816032">,</span>&nbsp;<span class="ident" id="4816034">e</span><span class="op" id="4816035">.</span><span class="ident" id="4816036">Field2</span><span class="op" id="4816042">,</span>&nbsp;<span class="ident" id="4816044">e</span><span class="op" id="4816045">.</span><span class="ident" id="4816046">Tag2</span><span class="op" id="4816050">)</span><br>
<span class="lineno"></span><span class="op" id="4816052">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="comment" id="4816055">//&nbsp;value&nbsp;returns&nbsp;v&#39;s&nbsp;field&nbsp;value&nbsp;corresponding&nbsp;to&nbsp;finfo.</span><br>
<span class="lineno"></span><span class="comment" id="4816112">//&nbsp;It&#39;s&nbsp;equivalent&nbsp;to&nbsp;v.FieldByIndex(finfo.idx),&nbsp;but&nbsp;initializes</span><br>
<span class="lineno"></span><span class="comment" id="4816177">//&nbsp;and&nbsp;dereferences&nbsp;pointers&nbsp;as&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="4816220">func</span>&nbsp;<span class="op" id="4816225">(</span><span class="ident" id="4816226">finfo</span>&nbsp;<span class="op" id="4816232">*</span><span class="ident" id="4816233">fieldInfo</span><span class="op" id="4816242">)</span>&nbsp;<span class="ident" id="4816244">value</span><span class="op" id="4816249">(</span><span class="ident" id="4816250">v</span>&nbsp;<span class="ident" id="4816252">reflect</span><span class="op" id="4816259">.</span><span class="ident" id="4816260">Value</span><span class="op" id="4816265">)</span>&nbsp;<span class="ident" id="4816267">reflect</span><span class="op" id="4816274">.</span><span class="ident" id="4816275">Value</span>&nbsp;<span class="op" id="4816281">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4816284">for</span>&nbsp;<span class="ident" id="4816288">i</span><span class="op" id="4816289">,</span>&nbsp;<span class="ident" id="4816291">x</span>&nbsp;<span class="op" id="4816293">:=</span>&nbsp;<span class="keyword" id="4816296">range</span>&nbsp;<span class="ident" id="4816302">finfo</span><span class="op" id="4816307">.</span><span class="ident" id="4816308">idx</span>&nbsp;<span class="op" id="4816312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4816316">if</span>&nbsp;<span class="ident" id="4816319">i</span>&nbsp;<span class="op" id="4816321">&gt;</span>&nbsp;<span class="num" id="4816323">0</span>&nbsp;<span class="op" id="4816325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4816330">t</span>&nbsp;<span class="op" id="4816332">:=</span>&nbsp;<span class="ident" id="4816335">v</span><span class="op" id="4816336">.</span><span class="ident" id="4816337">Type</span><span class="op" id="4816341">(</span><span class="op" id="4816342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4816347">if</span>&nbsp;<span class="ident" id="4816350">t</span><span class="op" id="4816351">.</span><span class="ident" id="4816352">Kind</span><span class="op" id="4816356">(</span><span class="op" id="4816357">)</span>&nbsp;<span class="op" id="4816359">==</span>&nbsp;<span class="ident" id="4816362">reflect</span><span class="op" id="4816369">.</span><span class="ident" id="4816370">Ptr</span>&nbsp;<span class="op" id="4816374">&amp;&amp;</span>&nbsp;<span class="ident" id="4816377">t</span><span class="op" id="4816378">.</span><span class="ident" id="4816379">Elem</span><span class="op" id="4816383">(</span><span class="op" id="4816384">)</span><span class="op" id="4816385">.</span><span class="ident" id="4816386">Kind</span><span class="op" id="4816390">(</span><span class="op" id="4816391">)</span>&nbsp;<span class="op" id="4816393">==</span>&nbsp;<span class="ident" id="4816396">reflect</span><span class="op" id="4816403">.</span><span class="ident" id="4816404">Struct</span>&nbsp;<span class="op" id="4816411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4816417">if</span>&nbsp;<span class="ident" id="4816420">v</span><span class="op" id="4816421">.</span><span class="ident" id="4816422">IsNil</span><span class="op" id="4816427">(</span><span class="op" id="4816428">)</span>&nbsp;<span class="op" id="4816430">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4816437">v</span><span class="op" id="4816438">.</span><span class="ident" id="4816439">Set</span><span class="op" id="4816442">(</span><span class="ident" id="4816443">reflect</span><span class="op" id="4816450">.</span><span class="ident" id="4816451">New</span><span class="op" id="4816454">(</span><span class="ident" id="4816455">v</span><span class="op" id="4816456">.</span><span class="ident" id="4816457">Type</span><span class="op" id="4816461">(</span><span class="op" id="4816462">)</span><span class="op" id="4816463">.</span><span class="ident" id="4816464">Elem</span><span class="op" id="4816468">(</span><span class="op" id="4816469">)</span><span class="op" id="4816470">)</span><span class="op" id="4816471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4816477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4816483">v</span>&nbsp;<span class="op" id="4816485">=</span>&nbsp;<span class="ident" id="4816487">v</span><span class="op" id="4816488">.</span><span class="ident" id="4816489">Elem</span><span class="op" id="4816493">(</span><span class="op" id="4816494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4816499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4816503">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4816507">v</span>&nbsp;<span class="op" id="4816509">=</span>&nbsp;<span class="ident" id="4816511">v</span><span class="op" id="4816512">.</span><span class="ident" id="4816513">Field</span><span class="op" id="4816518">(</span><span class="ident" id="4816519">x</span><span class="op" id="4816520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4816523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4816526">return</span>&nbsp;<span class="ident" id="4816533">v</span><br>
<span class="lineno"></span><span class="op" id="4816535">}</span>
</div>
</body>
</html>
