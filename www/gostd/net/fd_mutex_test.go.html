<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8375088">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8375143">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8375197">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8375248">package</span>&nbsp;<span class="ident" id="8375256">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8375261">import</span>&nbsp;<span class="op" id="8375268">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8375271">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8375284">&#34;runtime&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8375295">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8375306">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8375313">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8375316">func</span>&nbsp;<span class="ident" id="8375321">TestMutexLock</span><span class="op" id="8375334">(</span><span class="ident" id="8375335">t</span>&nbsp;<span class="op" id="8375337">*</span><span class="ident" id="8375338">testing</span><span class="op" id="8375345">.</span><span class="ident" id="8375346">T</span><span class="op" id="8375347">)</span>&nbsp;<span class="op" id="8375349">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8375352">var</span>&nbsp;<span class="ident" id="8375356">mu</span>&nbsp;<span class="ident" id="8375359">fdMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8375369">if</span>&nbsp;<span class="op" id="8375372">!</span><span class="ident" id="8375373">mu</span><span class="op" id="8375375">.</span><span class="ident" id="8375376">Incref</span><span class="op" id="8375382">(</span><span class="op" id="8375383">)</span>&nbsp;<span class="op" id="8375385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8375389">t</span><span class="op" id="8375390">.</span><span class="ident" id="8375391">Fatal</span><span class="op" id="8375396">(</span><span class="string" id="8375397">&#34;broken&#34;</span><span class="op" id="8375405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8375408">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8375411">if</span>&nbsp;<span class="ident" id="8375414">mu</span><span class="op" id="8375416">.</span><span class="ident" id="8375417">Decref</span><span class="op" id="8375423">(</span><span class="op" id="8375424">)</span>&nbsp;<span class="op" id="8375426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8375430">t</span><span class="op" id="8375431">.</span><span class="ident" id="8375432">Fatal</span><span class="op" id="8375437">(</span><span class="string" id="8375438">&#34;broken&#34;</span><span class="op" id="8375446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8375449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8375453">if</span>&nbsp;<span class="op" id="8375456">!</span><span class="ident" id="8375457">mu</span><span class="op" id="8375459">.</span><span class="ident" id="8375460">RWLock</span><span class="op" id="8375466">(</span><span class="builtintype" id="8375467">true</span><span class="op" id="8375471">)</span>&nbsp;<span class="op" id="8375473">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8375477">t</span><span class="op" id="8375478">.</span><span class="ident" id="8375479">Fatal</span><span class="op" id="8375484">(</span><span class="string" id="8375485">&#34;broken&#34;</span><span class="op" id="8375493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8375496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8375499">if</span>&nbsp;<span class="ident" id="8375502">mu</span><span class="op" id="8375504">.</span><span class="ident" id="8375505">RWUnlock</span><span class="op" id="8375513">(</span><span class="builtintype" id="8375514">true</span><span class="op" id="8375518">)</span>&nbsp;<span class="op" id="8375520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8375524">t</span><span class="op" id="8375525">.</span><span class="ident" id="8375526">Fatal</span><span class="op" id="8375531">(</span><span class="string" id="8375532">&#34;broken&#34;</span><span class="op" id="8375540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8375543">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8375547">if</span>&nbsp;<span class="op" id="8375550">!</span><span class="ident" id="8375551">mu</span><span class="op" id="8375553">.</span><span class="ident" id="8375554">RWLock</span><span class="op" id="8375560">(</span><span class="builtintype" id="8375561">false</span><span class="op" id="8375566">)</span>&nbsp;<span class="op" id="8375568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8375572">t</span><span class="op" id="8375573">.</span><span class="ident" id="8375574">Fatal</span><span class="op" id="8375579">(</span><span class="string" id="8375580">&#34;broken&#34;</span><span class="op" id="8375588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8375591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8375594">if</span>&nbsp;<span class="ident" id="8375597">mu</span><span class="op" id="8375599">.</span><span class="ident" id="8375600">RWUnlock</span><span class="op" id="8375608">(</span><span class="builtintype" id="8375609">false</span><span class="op" id="8375614">)</span>&nbsp;<span class="op" id="8375616">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8375620">t</span><span class="op" id="8375621">.</span><span class="ident" id="8375622">Fatal</span><span class="op" id="8375627">(</span><span class="string" id="8375628">&#34;broken&#34;</span><span class="op" id="8375636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8375639">}</span><br>
<span class="lineno"></span><span class="op" id="8375641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8375644">func</span>&nbsp;<span class="ident" id="8375649">TestMutexClose</span><span class="op" id="8375663">(</span><span class="ident" id="8375664">t</span>&nbsp;<span class="op" id="8375666">*</span><span class="ident" id="8375667">testing</span><span class="op" id="8375674">.</span><span class="ident" id="8375675">T</span><span class="op" id="8375676">)</span>&nbsp;<span class="op" id="8375678">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8375681">var</span>&nbsp;<span class="ident" id="8375685">mu</span>&nbsp;<span class="ident" id="8375688">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8375697">if</span>&nbsp;<span class="op" id="8375700">!</span><span class="ident" id="8375701">mu</span><span class="op" id="8375703">.</span><span class="ident" id="8375704">IncrefAndClose</span><span class="op" id="8375718">(</span><span class="op" id="8375719">)</span>&nbsp;<span class="op" id="8375721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8375725">t</span><span class="op" id="8375726">.</span><span class="ident" id="8375727">Fatal</span><span class="op" id="8375732">(</span><span class="string" id="8375733">&#34;broken&#34;</span><span class="op" id="8375741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8375744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8375748">if</span>&nbsp;<span class="ident" id="8375751">mu</span><span class="op" id="8375753">.</span><span class="ident" id="8375754">Incref</span><span class="op" id="8375760">(</span><span class="op" id="8375761">)</span>&nbsp;<span class="op" id="8375763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8375767">t</span><span class="op" id="8375768">.</span><span class="ident" id="8375769">Fatal</span><span class="op" id="8375774">(</span><span class="string" id="8375775">&#34;broken&#34;</span><span class="op" id="8375783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8375786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8375789">if</span>&nbsp;<span class="ident" id="8375792">mu</span><span class="op" id="8375794">.</span><span class="ident" id="8375795">RWLock</span><span class="op" id="8375801">(</span><span class="builtintype" id="8375802">true</span><span class="op" id="8375806">)</span>&nbsp;<span class="op" id="8375808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8375812">t</span><span class="op" id="8375813">.</span><span class="ident" id="8375814">Fatal</span><span class="op" id="8375819">(</span><span class="string" id="8375820">&#34;broken&#34;</span><span class="op" id="8375828">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8375831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8375834">if</span>&nbsp;<span class="ident" id="8375837">mu</span><span class="op" id="8375839">.</span><span class="ident" id="8375840">RWLock</span><span class="op" id="8375846">(</span><span class="builtintype" id="8375847">false</span><span class="op" id="8375852">)</span>&nbsp;<span class="op" id="8375854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8375858">t</span><span class="op" id="8375859">.</span><span class="ident" id="8375860">Fatal</span><span class="op" id="8375865">(</span><span class="string" id="8375866">&#34;broken&#34;</span><span class="op" id="8375874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8375877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8375880">if</span>&nbsp;<span class="ident" id="8375883">mu</span><span class="op" id="8375885">.</span><span class="ident" id="8375886">IncrefAndClose</span><span class="op" id="8375900">(</span><span class="op" id="8375901">)</span>&nbsp;<span class="op" id="8375903">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8375907">t</span><span class="op" id="8375908">.</span><span class="ident" id="8375909">Fatal</span><span class="op" id="8375914">(</span><span class="string" id="8375915">&#34;broken&#34;</span><span class="op" id="8375923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8375926">}</span><br>
<span class="lineno"></span><span class="op" id="8375928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8375931">func</span>&nbsp;<span class="ident" id="8375936">TestMutexCloseUnblock</span><span class="op" id="8375957">(</span><span class="ident" id="8375958">t</span>&nbsp;<span class="op" id="8375960">*</span><span class="ident" id="8375961">testing</span><span class="op" id="8375968">.</span><span class="ident" id="8375969">T</span><span class="op" id="8375970">)</span>&nbsp;<span class="op" id="8375972">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8375975">c</span>&nbsp;<span class="op" id="8375977">:=</span>&nbsp;<span class="builtinfunc" id="8375980">make</span><span class="op" id="8375984">(</span><span class="keyword" id="8375985">chan</span>&nbsp;<span class="builtintype" id="8375990">bool</span><span class="op" id="8375994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8375997">var</span>&nbsp;<span class="ident" id="8376001">mu</span>&nbsp;<span class="ident" id="8376004">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8376013">mu</span><span class="op" id="8376015">.</span><span class="ident" id="8376016">RWLock</span><span class="op" id="8376022">(</span><span class="builtintype" id="8376023">true</span><span class="op" id="8376027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8376030">for</span>&nbsp;<span class="ident" id="8376034">i</span>&nbsp;<span class="op" id="8376036">:=</span>&nbsp;<span class="num" id="8376039">0</span><span class="op" id="8376040">;</span>&nbsp;<span class="ident" id="8376042">i</span>&nbsp;<span class="op" id="8376044">&lt;</span>&nbsp;<span class="num" id="8376046">4</span><span class="op" id="8376047">;</span>&nbsp;<span class="ident" id="8376049">i</span><span class="op" id="8376050">++</span>&nbsp;<span class="op" id="8376053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8376057">go</span>&nbsp;<span class="keyword" id="8376060">func</span><span class="op" id="8376064">(</span><span class="op" id="8376065">)</span>&nbsp;<span class="op" id="8376067">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8376072">if</span>&nbsp;<span class="ident" id="8376075">mu</span><span class="op" id="8376077">.</span><span class="ident" id="8376078">RWLock</span><span class="op" id="8376084">(</span><span class="builtintype" id="8376085">true</span><span class="op" id="8376089">)</span>&nbsp;<span class="op" id="8376091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8376097">t</span><span class="op" id="8376098">.</span><span class="ident" id="8376099">Error</span><span class="op" id="8376104">(</span><span class="string" id="8376105">&#34;broken&#34;</span><span class="op" id="8376113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8376119">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8376129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8376134">c</span>&nbsp;<span class="op" id="8376136">&lt;-</span>&nbsp;<span class="builtintype" id="8376139">true</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8376146">}</span><span class="op" id="8376147">(</span><span class="op" id="8376148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8376151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8376154">//&nbsp;Concurrent&nbsp;goroutines&nbsp;must&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;read&nbsp;lock&nbsp;the&nbsp;mutex.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8376221">time</span><span class="op" id="8376225">.</span><span class="ident" id="8376226">Sleep</span><span class="op" id="8376231">(</span><span class="ident" id="8376232">time</span><span class="op" id="8376236">.</span><span class="ident" id="8376237">Millisecond</span><span class="op" id="8376248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8376251">select</span>&nbsp;<span class="op" id="8376258">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8376261">case</span>&nbsp;<span class="op" id="8376266">&lt;-</span><span class="ident" id="8376268">c</span><span class="op" id="8376269">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8376273">t</span><span class="op" id="8376274">.</span><span class="ident" id="8376275">Fatal</span><span class="op" id="8376280">(</span><span class="string" id="8376281">&#34;broken&#34;</span><span class="op" id="8376289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8376292">default</span><span class="op" id="8376299">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8376302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8376305">mu</span><span class="op" id="8376307">.</span><span class="ident" id="8376308">IncrefAndClose</span><span class="op" id="8376322">(</span><span class="op" id="8376323">)</span>&nbsp;<span class="comment" id="8376325">//&nbsp;Must&nbsp;unblock&nbsp;the&nbsp;readers.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8376355">for</span>&nbsp;<span class="ident" id="8376359">i</span>&nbsp;<span class="op" id="8376361">:=</span>&nbsp;<span class="num" id="8376364">0</span><span class="op" id="8376365">;</span>&nbsp;<span class="ident" id="8376367">i</span>&nbsp;<span class="op" id="8376369">&lt;</span>&nbsp;<span class="num" id="8376371">4</span><span class="op" id="8376372">;</span>&nbsp;<span class="ident" id="8376374">i</span><span class="op" id="8376375">++</span>&nbsp;<span class="op" id="8376378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8376382">select</span>&nbsp;<span class="op" id="8376389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8376393">case</span>&nbsp;<span class="op" id="8376398">&lt;-</span><span class="ident" id="8376400">c</span><span class="op" id="8376401">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8376405">case</span>&nbsp;<span class="op" id="8376410">&lt;-</span><span class="ident" id="8376412">time</span><span class="op" id="8376416">.</span><span class="ident" id="8376417">After</span><span class="op" id="8376422">(</span><span class="num" id="8376423">10</span>&nbsp;<span class="op" id="8376426">*</span>&nbsp;<span class="ident" id="8376428">time</span><span class="op" id="8376432">.</span><span class="ident" id="8376433">Second</span><span class="op" id="8376439">)</span><span class="op" id="8376440">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8376445">t</span><span class="op" id="8376446">.</span><span class="ident" id="8376447">Fatal</span><span class="op" id="8376452">(</span><span class="string" id="8376453">&#34;broken&#34;</span><span class="op" id="8376461">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8376465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8376468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8376471">if</span>&nbsp;<span class="ident" id="8376474">mu</span><span class="op" id="8376476">.</span><span class="ident" id="8376477">Decref</span><span class="op" id="8376483">(</span><span class="op" id="8376484">)</span>&nbsp;<span class="op" id="8376486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8376490">t</span><span class="op" id="8376491">.</span><span class="ident" id="8376492">Fatal</span><span class="op" id="8376497">(</span><span class="string" id="8376498">&#34;broken&#34;</span><span class="op" id="8376506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8376509">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8376512">if</span>&nbsp;<span class="op" id="8376515">!</span><span class="ident" id="8376516">mu</span><span class="op" id="8376518">.</span><span class="ident" id="8376519">RWUnlock</span><span class="op" id="8376527">(</span><span class="builtintype" id="8376528">true</span><span class="op" id="8376532">)</span>&nbsp;<span class="op" id="8376534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8376538">t</span><span class="op" id="8376539">.</span><span class="ident" id="8376540">Fatal</span><span class="op" id="8376545">(</span><span class="string" id="8376546">&#34;broken&#34;</span><span class="op" id="8376554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8376557">}</span><br>
<span class="lineno"></span><span class="op" id="8376559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="8376562">func</span>&nbsp;<span class="ident" id="8376567">TestMutexPanic</span><span class="op" id="8376581">(</span><span class="ident" id="8376582">t</span>&nbsp;<span class="op" id="8376584">*</span><span class="ident" id="8376585">testing</span><span class="op" id="8376592">.</span><span class="ident" id="8376593">T</span><span class="op" id="8376594">)</span>&nbsp;<span class="op" id="8376596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8376599">ensurePanics</span>&nbsp;<span class="op" id="8376612">:=</span>&nbsp;<span class="keyword" id="8376615">func</span><span class="op" id="8376619">(</span><span class="ident" id="8376620">f</span>&nbsp;<span class="keyword" id="8376622">func</span><span class="op" id="8376626">(</span><span class="op" id="8376627">)</span><span class="op" id="8376628">)</span>&nbsp;<span class="op" id="8376630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8376634">defer</span>&nbsp;<span class="keyword" id="8376640">func</span><span class="op" id="8376644">(</span><span class="op" id="8376645">)</span>&nbsp;<span class="op" id="8376647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8376652">if</span>&nbsp;<span class="builtinfunc" id="8376655">recover</span><span class="op" id="8376662">(</span><span class="op" id="8376663">)</span>&nbsp;<span class="op" id="8376665">==</span>&nbsp;<span class="ident" id="8376668">nil</span>&nbsp;<span class="op" id="8376672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8376678">t</span><span class="op" id="8376679">.</span><span class="ident" id="8376680">Fatal</span><span class="op" id="8376685">(</span><span class="string" id="8376686">&#34;does&nbsp;not&nbsp;panic&#34;</span><span class="op" id="8376702">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8376707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8376711">}</span><span class="op" id="8376712">(</span><span class="op" id="8376713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8376717">f</span><span class="op" id="8376718">(</span><span class="op" id="8376719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8376722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8376726">var</span>&nbsp;<span class="ident" id="8376730">mu</span>&nbsp;<span class="ident" id="8376733">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8376742">ensurePanics</span><span class="op" id="8376754">(</span><span class="keyword" id="8376755">func</span><span class="op" id="8376759">(</span><span class="op" id="8376760">)</span>&nbsp;<span class="op" id="8376762">{</span>&nbsp;<span class="ident" id="8376764">mu</span><span class="op" id="8376766">.</span><span class="ident" id="8376767">Decref</span><span class="op" id="8376773">(</span><span class="op" id="8376774">)</span>&nbsp;<span class="op" id="8376776">}</span><span class="op" id="8376777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8376780">ensurePanics</span><span class="op" id="8376792">(</span><span class="keyword" id="8376793">func</span><span class="op" id="8376797">(</span><span class="op" id="8376798">)</span>&nbsp;<span class="op" id="8376800">{</span>&nbsp;<span class="ident" id="8376802">mu</span><span class="op" id="8376804">.</span><span class="ident" id="8376805">RWUnlock</span><span class="op" id="8376813">(</span><span class="builtintype" id="8376814">true</span><span class="op" id="8376818">)</span>&nbsp;<span class="op" id="8376820">}</span><span class="op" id="8376821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8376824">ensurePanics</span><span class="op" id="8376836">(</span><span class="keyword" id="8376837">func</span><span class="op" id="8376841">(</span><span class="op" id="8376842">)</span>&nbsp;<span class="op" id="8376844">{</span>&nbsp;<span class="ident" id="8376846">mu</span><span class="op" id="8376848">.</span><span class="ident" id="8376849">RWUnlock</span><span class="op" id="8376857">(</span><span class="builtintype" id="8376858">false</span><span class="op" id="8376863">)</span>&nbsp;<span class="op" id="8376865">}</span><span class="op" id="8376866">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8376870">ensurePanics</span><span class="op" id="8376882">(</span><span class="keyword" id="8376883">func</span><span class="op" id="8376887">(</span><span class="op" id="8376888">)</span>&nbsp;<span class="op" id="8376890">{</span>&nbsp;<span class="ident" id="8376892">mu</span><span class="op" id="8376894">.</span><span class="ident" id="8376895">Incref</span><span class="op" id="8376901">(</span><span class="op" id="8376902">)</span><span class="op" id="8376903">;</span>&nbsp;<span class="ident" id="8376905">mu</span><span class="op" id="8376907">.</span><span class="ident" id="8376908">Decref</span><span class="op" id="8376914">(</span><span class="op" id="8376915">)</span><span class="op" id="8376916">;</span>&nbsp;<span class="ident" id="8376918">mu</span><span class="op" id="8376920">.</span><span class="ident" id="8376921">Decref</span><span class="op" id="8376927">(</span><span class="op" id="8376928">)</span>&nbsp;<span class="op" id="8376930">}</span><span class="op" id="8376931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8376934">ensurePanics</span><span class="op" id="8376946">(</span><span class="keyword" id="8376947">func</span><span class="op" id="8376951">(</span><span class="op" id="8376952">)</span>&nbsp;<span class="op" id="8376954">{</span>&nbsp;<span class="ident" id="8376956">mu</span><span class="op" id="8376958">.</span><span class="ident" id="8376959">RWLock</span><span class="op" id="8376965">(</span><span class="builtintype" id="8376966">true</span><span class="op" id="8376970">)</span><span class="op" id="8376971">;</span>&nbsp;<span class="ident" id="8376973">mu</span><span class="op" id="8376975">.</span><span class="ident" id="8376976">RWUnlock</span><span class="op" id="8376984">(</span><span class="builtintype" id="8376985">true</span><span class="op" id="8376989">)</span><span class="op" id="8376990">;</span>&nbsp;<span class="ident" id="8376992">mu</span><span class="op" id="8376994">.</span><span class="ident" id="8376995">RWUnlock</span><span class="op" id="8377003">(</span><span class="builtintype" id="8377004">true</span><span class="op" id="8377008">)</span>&nbsp;<span class="op" id="8377010">}</span><span class="op" id="8377011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8377014">ensurePanics</span><span class="op" id="8377026">(</span><span class="keyword" id="8377027">func</span><span class="op" id="8377031">(</span><span class="op" id="8377032">)</span>&nbsp;<span class="op" id="8377034">{</span>&nbsp;<span class="ident" id="8377036">mu</span><span class="op" id="8377038">.</span><span class="ident" id="8377039">RWLock</span><span class="op" id="8377045">(</span><span class="builtintype" id="8377046">false</span><span class="op" id="8377051">)</span><span class="op" id="8377052">;</span>&nbsp;<span class="ident" id="8377054">mu</span><span class="op" id="8377056">.</span><span class="ident" id="8377057">RWUnlock</span><span class="op" id="8377065">(</span><span class="builtintype" id="8377066">false</span><span class="op" id="8377071">)</span><span class="op" id="8377072">;</span>&nbsp;<span class="ident" id="8377074">mu</span><span class="op" id="8377076">.</span><span class="ident" id="8377077">RWUnlock</span><span class="op" id="8377085">(</span><span class="builtintype" id="8377086">false</span><span class="op" id="8377091">)</span>&nbsp;<span class="op" id="8377093">}</span><span class="op" id="8377094">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8377098">//&nbsp;ensure&nbsp;that&nbsp;it&#39;s&nbsp;still&nbsp;not&nbsp;broken</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8377136">mu</span><span class="op" id="8377138">.</span><span class="ident" id="8377139">Incref</span><span class="op" id="8377145">(</span><span class="op" id="8377146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8377149">mu</span><span class="op" id="8377151">.</span><span class="ident" id="8377152">Decref</span><span class="op" id="8377158">(</span><span class="op" id="8377159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8377162">mu</span><span class="op" id="8377164">.</span><span class="ident" id="8377165">RWLock</span><span class="op" id="8377171">(</span><span class="builtintype" id="8377172">true</span><span class="op" id="8377176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8377179">mu</span><span class="op" id="8377181">.</span><span class="ident" id="8377182">RWUnlock</span><span class="op" id="8377190">(</span><span class="builtintype" id="8377191">true</span><span class="op" id="8377195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8377198">mu</span><span class="op" id="8377200">.</span><span class="ident" id="8377201">RWLock</span><span class="op" id="8377207">(</span><span class="builtintype" id="8377208">false</span><span class="op" id="8377213">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8377216">mu</span><span class="op" id="8377218">.</span><span class="ident" id="8377219">RWUnlock</span><span class="op" id="8377227">(</span><span class="builtintype" id="8377228">false</span><span class="op" id="8377233">)</span><br>
<span class="lineno"></span><span class="op" id="8377235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8377238">func</span>&nbsp;<span class="ident" id="8377243">TestMutexStress</span><span class="op" id="8377258">(</span><span class="ident" id="8377259">t</span>&nbsp;<span class="op" id="8377261">*</span><span class="ident" id="8377262">testing</span><span class="op" id="8377269">.</span><span class="ident" id="8377270">T</span><span class="op" id="8377271">)</span>&nbsp;<span class="op" id="8377273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8377276">P</span>&nbsp;<span class="op" id="8377278">:=</span>&nbsp;<span class="num" id="8377281">8</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8377284">N</span>&nbsp;<span class="op" id="8377286">:=</span>&nbsp;<span class="builtintype" id="8377289">int</span><span class="op" id="8377292">(</span><span class="num" id="8377293">1e6</span><span class="op" id="8377296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8377299">if</span>&nbsp;<span class="ident" id="8377302">testing</span><span class="op" id="8377309">.</span><span class="ident" id="8377310">Short</span><span class="op" id="8377315">(</span><span class="op" id="8377316">)</span>&nbsp;<span class="op" id="8377318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8377322">P</span>&nbsp;<span class="op" id="8377324">=</span>&nbsp;<span class="num" id="8377326">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8377330">N</span>&nbsp;<span class="op" id="8377332">=</span>&nbsp;<span class="num" id="8377334">1e4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8377339">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8377342">defer</span>&nbsp;<span class="ident" id="8377348">runtime</span><span class="op" id="8377355">.</span><span class="ident" id="8377356">GOMAXPROCS</span><span class="op" id="8377366">(</span><span class="ident" id="8377367">runtime</span><span class="op" id="8377374">.</span><span class="ident" id="8377375">GOMAXPROCS</span><span class="op" id="8377385">(</span><span class="ident" id="8377386">P</span><span class="op" id="8377387">)</span><span class="op" id="8377388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8377391">done</span>&nbsp;<span class="op" id="8377396">:=</span>&nbsp;<span class="builtinfunc" id="8377399">make</span><span class="op" id="8377403">(</span><span class="keyword" id="8377404">chan</span>&nbsp;<span class="builtintype" id="8377409">bool</span><span class="op" id="8377413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8377416">var</span>&nbsp;<span class="ident" id="8377420">mu</span>&nbsp;<span class="ident" id="8377423">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8377432">var</span>&nbsp;<span class="ident" id="8377436">readState</span>&nbsp;<span class="op" id="8377446">[</span><span class="num" id="8377447">2</span><span class="op" id="8377448">]</span><span class="ident" id="8377449">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8377457">var</span>&nbsp;<span class="ident" id="8377461">writeState</span>&nbsp;<span class="op" id="8377472">[</span><span class="num" id="8377473">2</span><span class="op" id="8377474">]</span><span class="ident" id="8377475">uint64</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8377483">for</span>&nbsp;<span class="ident" id="8377487">p</span>&nbsp;<span class="op" id="8377489">:=</span>&nbsp;<span class="num" id="8377492">0</span><span class="op" id="8377493">;</span>&nbsp;<span class="ident" id="8377495">p</span>&nbsp;<span class="op" id="8377497">&lt;</span>&nbsp;<span class="ident" id="8377499">P</span><span class="op" id="8377500">;</span>&nbsp;<span class="ident" id="8377502">p</span><span class="op" id="8377503">++</span>&nbsp;<span class="op" id="8377506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8377510">go</span>&nbsp;<span class="keyword" id="8377513">func</span><span class="op" id="8377517">(</span><span class="op" id="8377518">)</span>&nbsp;<span class="op" id="8377520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8377525">r</span>&nbsp;<span class="op" id="8377527">:=</span>&nbsp;<span class="ident" id="8377530">rand</span><span class="op" id="8377534">.</span><span class="ident" id="8377535">New</span><span class="op" id="8377538">(</span><span class="ident" id="8377539">rand</span><span class="op" id="8377543">.</span><span class="ident" id="8377544">NewSource</span><span class="op" id="8377553">(</span><span class="ident" id="8377554">rand</span><span class="op" id="8377558">.</span><span class="ident" id="8377559">Int63</span><span class="op" id="8377564">(</span><span class="op" id="8377565">)</span><span class="op" id="8377566">)</span><span class="op" id="8377567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8377572">for</span>&nbsp;<span class="ident" id="8377576">i</span>&nbsp;<span class="op" id="8377578">:=</span>&nbsp;<span class="num" id="8377581">0</span><span class="op" id="8377582">;</span>&nbsp;<span class="ident" id="8377584">i</span>&nbsp;<span class="op" id="8377586">&lt;</span>&nbsp;<span class="ident" id="8377588">N</span><span class="op" id="8377589">;</span>&nbsp;<span class="ident" id="8377591">i</span><span class="op" id="8377592">++</span>&nbsp;<span class="op" id="8377595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8377601">switch</span>&nbsp;<span class="ident" id="8377608">r</span><span class="op" id="8377609">.</span><span class="ident" id="8377610">Intn</span><span class="op" id="8377614">(</span><span class="num" id="8377615">3</span><span class="op" id="8377616">)</span>&nbsp;<span class="op" id="8377618">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8377624">case</span>&nbsp;<span class="num" id="8377629">0</span><span class="op" id="8377630">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8377637">if</span>&nbsp;<span class="op" id="8377640">!</span><span class="ident" id="8377641">mu</span><span class="op" id="8377643">.</span><span class="ident" id="8377644">Incref</span><span class="op" id="8377650">(</span><span class="op" id="8377651">)</span>&nbsp;<span class="op" id="8377653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8377661">t</span><span class="op" id="8377662">.</span><span class="ident" id="8377663">Error</span><span class="op" id="8377668">(</span><span class="string" id="8377669">&#34;broken&#34;</span><span class="op" id="8377677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8377685">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8377697">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8377704">if</span>&nbsp;<span class="ident" id="8377707">mu</span><span class="op" id="8377709">.</span><span class="ident" id="8377710">Decref</span><span class="op" id="8377716">(</span><span class="op" id="8377717">)</span>&nbsp;<span class="op" id="8377719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8377727">t</span><span class="op" id="8377728">.</span><span class="ident" id="8377729">Error</span><span class="op" id="8377734">(</span><span class="string" id="8377735">&#34;broken&#34;</span><span class="op" id="8377743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8377751">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8377763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8377769">case</span>&nbsp;<span class="num" id="8377774">1</span><span class="op" id="8377775">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8377782">if</span>&nbsp;<span class="op" id="8377785">!</span><span class="ident" id="8377786">mu</span><span class="op" id="8377788">.</span><span class="ident" id="8377789">RWLock</span><span class="op" id="8377795">(</span><span class="builtintype" id="8377796">true</span><span class="op" id="8377800">)</span>&nbsp;<span class="op" id="8377802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8377810">t</span><span class="op" id="8377811">.</span><span class="ident" id="8377812">Error</span><span class="op" id="8377817">(</span><span class="string" id="8377818">&#34;broken&#34;</span><span class="op" id="8377826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8377834">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8377846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8377853">//&nbsp;Ensure&nbsp;that&nbsp;it&nbsp;provides&nbsp;mutual&nbsp;exclusion&nbsp;for&nbsp;readers.</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8377915">if</span>&nbsp;<span class="ident" id="8377918">readState</span><span class="op" id="8377927">[</span><span class="num" id="8377928">0</span><span class="op" id="8377929">]</span>&nbsp;<span class="op" id="8377931">!=</span>&nbsp;<span class="ident" id="8377934">readState</span><span class="op" id="8377943">[</span><span class="num" id="8377944">1</span><span class="op" id="8377945">]</span>&nbsp;<span class="op" id="8377947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8377955">t</span><span class="op" id="8377956">.</span><span class="ident" id="8377957">Error</span><span class="op" id="8377962">(</span><span class="string" id="8377963">&#34;broken&#34;</span><span class="op" id="8377971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8377979">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8377991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8377998">readState</span><span class="op" id="8378007">[</span><span class="num" id="8378008">0</span><span class="op" id="8378009">]</span><span class="op" id="8378010">++</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8378018">readState</span><span class="op" id="8378027">[</span><span class="num" id="8378028">1</span><span class="op" id="8378029">]</span><span class="op" id="8378030">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8378038">if</span>&nbsp;<span class="ident" id="8378041">mu</span><span class="op" id="8378043">.</span><span class="ident" id="8378044">RWUnlock</span><span class="op" id="8378052">(</span><span class="builtintype" id="8378053">true</span><span class="op" id="8378057">)</span>&nbsp;<span class="op" id="8378059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8378067">t</span><span class="op" id="8378068">.</span><span class="ident" id="8378069">Error</span><span class="op" id="8378074">(</span><span class="string" id="8378075">&#34;broken&#34;</span><span class="op" id="8378083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8378091">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8378103">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8378109">case</span>&nbsp;<span class="num" id="8378114">2</span><span class="op" id="8378115">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8378122">if</span>&nbsp;<span class="op" id="8378125">!</span><span class="ident" id="8378126">mu</span><span class="op" id="8378128">.</span><span class="ident" id="8378129">RWLock</span><span class="op" id="8378135">(</span><span class="builtintype" id="8378136">false</span><span class="op" id="8378141">)</span>&nbsp;<span class="op" id="8378143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8378151">t</span><span class="op" id="8378152">.</span><span class="ident" id="8378153">Error</span><span class="op" id="8378158">(</span><span class="string" id="8378159">&#34;broken&#34;</span><span class="op" id="8378167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8378175">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8378187">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8378194">//&nbsp;Ensure&nbsp;that&nbsp;it&nbsp;provides&nbsp;mutual&nbsp;exclusion&nbsp;for&nbsp;writers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8378256">if</span>&nbsp;<span class="ident" id="8378259">writeState</span><span class="op" id="8378269">[</span><span class="num" id="8378270">0</span><span class="op" id="8378271">]</span>&nbsp;<span class="op" id="8378273">!=</span>&nbsp;<span class="ident" id="8378276">writeState</span><span class="op" id="8378286">[</span><span class="num" id="8378287">1</span><span class="op" id="8378288">]</span>&nbsp;<span class="op" id="8378290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8378298">t</span><span class="op" id="8378299">.</span><span class="ident" id="8378300">Error</span><span class="op" id="8378305">(</span><span class="string" id="8378306">&#34;broken&#34;</span><span class="op" id="8378314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8378322">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8378334">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8378341">writeState</span><span class="op" id="8378351">[</span><span class="num" id="8378352">0</span><span class="op" id="8378353">]</span><span class="op" id="8378354">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8378362">writeState</span><span class="op" id="8378372">[</span><span class="num" id="8378373">1</span><span class="op" id="8378374">]</span><span class="op" id="8378375">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8378383">if</span>&nbsp;<span class="ident" id="8378386">mu</span><span class="op" id="8378388">.</span><span class="ident" id="8378389">RWUnlock</span><span class="op" id="8378397">(</span><span class="builtintype" id="8378398">false</span><span class="op" id="8378403">)</span>&nbsp;<span class="op" id="8378405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8378413">t</span><span class="op" id="8378414">.</span><span class="ident" id="8378415">Error</span><span class="op" id="8378420">(</span><span class="string" id="8378421">&#34;broken&#34;</span><span class="op" id="8378429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8378437">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8378449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8378455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8378460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8378465">done</span>&nbsp;<span class="op" id="8378470">&lt;-</span>&nbsp;<span class="builtintype" id="8378473">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8378480">}</span><span class="op" id="8378481">(</span><span class="op" id="8378482">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8378485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8378488">for</span>&nbsp;<span class="ident" id="8378492">p</span>&nbsp;<span class="op" id="8378494">:=</span>&nbsp;<span class="num" id="8378497">0</span><span class="op" id="8378498">;</span>&nbsp;<span class="ident" id="8378500">p</span>&nbsp;<span class="op" id="8378502">&lt;</span>&nbsp;<span class="ident" id="8378504">P</span><span class="op" id="8378505">;</span>&nbsp;<span class="ident" id="8378507">p</span><span class="op" id="8378508">++</span>&nbsp;<span class="op" id="8378511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8378515">&lt;-</span><span class="ident" id="8378517">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8378523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8378526">if</span>&nbsp;<span class="op" id="8378529">!</span><span class="ident" id="8378530">mu</span><span class="op" id="8378532">.</span><span class="ident" id="8378533">IncrefAndClose</span><span class="op" id="8378547">(</span><span class="op" id="8378548">)</span>&nbsp;<span class="op" id="8378550">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8378554">t</span><span class="op" id="8378555">.</span><span class="ident" id="8378556">Fatal</span><span class="op" id="8378561">(</span><span class="string" id="8378562">&#34;broken&#34;</span><span class="op" id="8378570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8378573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8378576">if</span>&nbsp;<span class="op" id="8378579">!</span><span class="ident" id="8378580">mu</span><span class="op" id="8378582">.</span><span class="ident" id="8378583">Decref</span><span class="op" id="8378589">(</span><span class="op" id="8378590">)</span>&nbsp;<span class="op" id="8378592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8378596">t</span><span class="op" id="8378597">.</span><span class="ident" id="8378598">Fatal</span><span class="op" id="8378603">(</span><span class="string" id="8378604">&#34;broken&#34;</span><span class="op" id="8378612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8378615">}</span><br>
<span class="lineno">195</span><span class="op" id="8378617">}</span>
</div>
</body>
</html>
