<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="4883867">package</span>&nbsp;<span class="ident" id="4883875">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4883882">import</span>&nbsp;<span class="op" id="4883889">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4883892">&#34;bytes&#34;</span><br>
<span class="lineno">5</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4883901">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4883907">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4883914">&#34;os&#34;</span><br>
<span class="lineno"></span><span class="op" id="4883919">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="comment" id="4883922">//&nbsp;Serial&nbsp;is&nbsp;a&nbsp;serial&nbsp;console&nbsp;device</span><br>
<span class="lineno"></span><span class="comment" id="4883959">//&nbsp;It&nbsp;is&nbsp;basically&nbsp;two&nbsp;DMA&nbsp;pipes&nbsp;of&nbsp;ring&nbsp;buffered&nbsp;bytes:</span><br>
<span class="lineno"></span><span class="comment" id="4884016">//&nbsp;one&nbsp;pipe&nbsp;for&nbsp;input,&nbsp;one&nbsp;pipe&nbsp;for&nbsp;output.</span><br>
<span class="lineno"></span><span class="keyword" id="4884060">type</span>&nbsp;<span class="ident" id="4884065">serial</span>&nbsp;<span class="keyword" id="4884072">struct</span>&nbsp;<span class="op" id="4884079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884082">intBus</span>&nbsp;<span class="ident" id="4884089">intBus</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884097">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4884104">*</span><span class="ident" id="4884105">page</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884112">Core</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4884119">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884125">IntIn</span>&nbsp;&nbsp;<span class="builtintype" id="4884132">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884138">IntOut</span>&nbsp;<span class="builtintype" id="4884145">byte</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884152">Output</span>&nbsp;<span class="ident" id="4884159">io</span><span class="op" id="4884161">.</span><span class="ident" id="4884162">Writer</span><br>
<span class="lineno"></span><span class="op" id="4884169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4884172">var</span>&nbsp;<span class="ident" id="4884176">_</span>&nbsp;<span class="ident" id="4884178">device</span>&nbsp;<span class="op" id="4884185">=</span>&nbsp;<span class="builtinfunc" id="4884187">new</span><span class="op" id="4884190">(</span><span class="ident" id="4884191">serial</span><span class="op" id="4884197">)</span>&nbsp;<span class="comment" id="4884199">//&nbsp;Serial&nbsp;is&nbsp;a&nbsp;device</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="4884222">const</span>&nbsp;<span class="op" id="4884228">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884231">serialBase</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4884246">=</span>&nbsp;<span class="num" id="4884248">128</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884253">serialInHead</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4884268">=</span>&nbsp;<span class="ident" id="4884270">serialBase</span>&nbsp;<span class="op" id="4884281">+</span>&nbsp;<span class="num" id="4884283">0</span>&nbsp;&nbsp;<span class="comment" id="4884286">//&nbsp;updated&nbsp;by&nbsp;hardware</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884310">serialInTail</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4884325">=</span>&nbsp;<span class="ident" id="4884327">serialBase</span>&nbsp;<span class="op" id="4884338">+</span>&nbsp;<span class="num" id="4884340">4</span>&nbsp;&nbsp;<span class="comment" id="4884343">//&nbsp;updated&nbsp;by&nbsp;cpu</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884362">serialInWait</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4884377">=</span>&nbsp;<span class="ident" id="4884379">serialBase</span>&nbsp;<span class="op" id="4884390">+</span>&nbsp;<span class="num" id="4884392">8</span>&nbsp;&nbsp;<span class="comment" id="4884395">//&nbsp;cycles&nbsp;to&nbsp;wait&nbsp;to&nbsp;raise&nbsp;an&nbsp;interrupt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884436">serialInThresh</span>&nbsp;<span class="op" id="4884451">=</span>&nbsp;<span class="ident" id="4884453">serialBase</span>&nbsp;<span class="op" id="4884464">+</span>&nbsp;<span class="num" id="4884466">12</span>&nbsp;<span class="comment" id="4884469">//&nbsp;threashold&nbsp;to&nbsp;raise&nbsp;an&nbsp;input&nbsp;interrupt</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884513">serialOutHead</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4884529">=</span>&nbsp;<span class="ident" id="4884531">serialBase</span>&nbsp;<span class="op" id="4884542">+</span>&nbsp;<span class="num" id="4884544">16</span>&nbsp;<span class="comment" id="4884547">//&nbsp;updated&nbsp;by&nbsp;cpu</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884566">serialOutTail</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4884582">=</span>&nbsp;<span class="ident" id="4884584">serialBase</span>&nbsp;<span class="op" id="4884595">+</span>&nbsp;<span class="num" id="4884597">20</span>&nbsp;<span class="comment" id="4884600">//&nbsp;updated&nbsp;by&nbsp;hardware</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884624">serialOutWait</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4884640">=</span>&nbsp;<span class="ident" id="4884642">serialBase</span>&nbsp;<span class="op" id="4884653">+</span>&nbsp;<span class="num" id="4884655">24</span>&nbsp;<span class="comment" id="4884658">//&nbsp;cycles&nbsp;to&nbsp;wait&nbsp;to&nbsp;raise&nbsp;an&nbsp;interrupt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884699">serialOutThresh</span>&nbsp;<span class="op" id="4884715">=</span>&nbsp;<span class="ident" id="4884717">serialBase</span>&nbsp;<span class="op" id="4884728">+</span>&nbsp;<span class="num" id="4884730">28</span>&nbsp;<span class="comment" id="4884733">//&nbsp;threashold&nbsp;to&nbsp;raise&nbsp;an&nbsp;output&nbsp;interrupt</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884778">serialInBuf</span>&nbsp;&nbsp;<span class="op" id="4884791">=</span>&nbsp;<span class="ident" id="4884793">serialBase</span>&nbsp;<span class="op" id="4884804">+</span>&nbsp;<span class="num" id="4884806">64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884810">serialOutBuf</span>&nbsp;<span class="op" id="4884823">=</span>&nbsp;<span class="ident" id="4884825">serialBase</span>&nbsp;<span class="op" id="4884836">+</span>&nbsp;<span class="num" id="4884838">96</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884843">serialCap</span>&nbsp;<span class="op" id="4884853">=</span>&nbsp;<span class="num" id="4884855">30</span>&nbsp;<span class="comment" id="4884858">//&nbsp;30&nbsp;bytes&nbsp;maximum&nbsp;in&nbsp;each&nbsp;pipe</span><br>
<span class="lineno"></span><span class="op" id="4884891">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4884894">//&nbsp;NewSerial&nbsp;creates&nbsp;a&nbsp;new&nbsp;serial&nbsp;controller.</span><br>
<span class="lineno">45</span><span class="keyword" id="4884940">func</span>&nbsp;<span class="ident" id="4884945">newSerial</span><span class="op" id="4884954">(</span><span class="ident" id="4884955">p</span>&nbsp;<span class="op" id="4884957">*</span><span class="ident" id="4884958">page</span><span class="op" id="4884962">,</span>&nbsp;<span class="ident" id="4884964">i</span>&nbsp;<span class="ident" id="4884966">intBus</span><span class="op" id="4884972">)</span>&nbsp;<span class="op" id="4884974">*</span><span class="ident" id="4884975">serial</span>&nbsp;<span class="op" id="4884982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884985">ret</span>&nbsp;<span class="op" id="4884989">:=</span>&nbsp;<span class="builtinfunc" id="4884992">new</span><span class="op" id="4884995">(</span><span class="ident" id="4884996">serial</span><span class="op" id="4885002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4885005">ret</span><span class="op" id="4885008">.</span><span class="ident" id="4885009">intBus</span>&nbsp;<span class="op" id="4885016">=</span>&nbsp;<span class="ident" id="4885018">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4885021">ret</span><span class="op" id="4885024">.</span><span class="ident" id="4885025">p</span>&nbsp;<span class="op" id="4885027">=</span>&nbsp;<span class="ident" id="4885029">p</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4885033">//&nbsp;default&nbsp;interrupts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4885056">ret</span><span class="op" id="4885059">.</span><span class="ident" id="4885060">Core</span>&nbsp;<span class="op" id="4885065">=</span>&nbsp;<span class="num" id="4885067">0</span>&nbsp;<span class="comment" id="4885069">//&nbsp;to&nbsp;core&nbsp;0&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4885088">ret</span><span class="op" id="4885091">.</span><span class="ident" id="4885092">IntIn</span>&nbsp;<span class="op" id="4885098">=</span>&nbsp;<span class="num" id="4885100">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4885103">ret</span><span class="op" id="4885106">.</span><span class="ident" id="4885107">IntOut</span>&nbsp;<span class="op" id="4885114">=</span>&nbsp;<span class="num" id="4885116">9</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4885120">ret</span><span class="op" id="4885123">.</span><span class="ident" id="4885124">Output</span>&nbsp;<span class="op" id="4885131">=</span>&nbsp;<span class="ident" id="4885133">os</span><span class="op" id="4885135">.</span><span class="ident" id="4885136">Stdout</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4885145">return</span>&nbsp;<span class="ident" id="4885152">ret</span><br>
<span class="lineno"></span><span class="op" id="4885156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="keyword" id="4885159">func</span>&nbsp;<span class="op" id="4885164">(</span><span class="ident" id="4885165">s</span>&nbsp;<span class="op" id="4885167">*</span><span class="ident" id="4885168">serial</span><span class="op" id="4885174">)</span>&nbsp;<span class="ident" id="4885176">interrupt</span><span class="op" id="4885185">(</span><span class="ident" id="4885186">code</span>&nbsp;<span class="builtintype" id="4885191">byte</span><span class="op" id="4885195">)</span>&nbsp;<span class="op" id="4885197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4885200">s</span><span class="op" id="4885201">.</span><span class="ident" id="4885202">intBus</span><span class="op" id="4885208">.</span><span class="ident" id="4885209">Interrupt</span><span class="op" id="4885218">(</span><span class="ident" id="4885219">code</span><span class="op" id="4885223">,</span>&nbsp;<span class="ident" id="4885225">s</span><span class="op" id="4885226">.</span><span class="ident" id="4885227">Core</span><span class="op" id="4885231">)</span><br>
<span class="lineno"></span><span class="op" id="4885233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4885236">//&nbsp;WriteByte&nbsp;appends&nbsp;a&nbsp;byte&nbsp;into&nbsp;the&nbsp;input&nbsp;ring&nbsp;buffer.</span><br>
<span class="lineno">65</span><span class="keyword" id="4885292">func</span>&nbsp;<span class="op" id="4885297">(</span><span class="ident" id="4885298">s</span>&nbsp;<span class="op" id="4885300">*</span><span class="ident" id="4885301">serial</span><span class="op" id="4885307">)</span>&nbsp;<span class="ident" id="4885309">WriteByte</span><span class="op" id="4885318">(</span><span class="ident" id="4885319">b</span>&nbsp;<span class="builtintype" id="4885321">byte</span><span class="op" id="4885325">)</span>&nbsp;<span class="builtintype" id="4885327">bool</span>&nbsp;<span class="op" id="4885332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4885335">head</span>&nbsp;<span class="op" id="4885340">:=</span>&nbsp;<span class="ident" id="4885343">s</span><span class="op" id="4885344">.</span><span class="ident" id="4885345">p</span><span class="op" id="4885346">.</span><span class="ident" id="4885347">ReadWord</span><span class="op" id="4885355">(</span><span class="ident" id="4885356">serialInHead</span><span class="op" id="4885368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4885371">tail</span>&nbsp;<span class="op" id="4885376">:=</span>&nbsp;<span class="ident" id="4885379">s</span><span class="op" id="4885380">.</span><span class="ident" id="4885381">p</span><span class="op" id="4885382">.</span><span class="ident" id="4885383">ReadWord</span><span class="op" id="4885391">(</span><span class="ident" id="4885392">serialInTail</span><span class="op" id="4885404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4885407">n</span>&nbsp;<span class="op" id="4885409">:=</span>&nbsp;<span class="ident" id="4885412">head</span>&nbsp;<span class="op" id="4885417">-</span>&nbsp;<span class="ident" id="4885419">tail</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4885425">if</span>&nbsp;<span class="ident" id="4885428">n</span>&nbsp;<span class="op" id="4885430">&gt;=</span>&nbsp;<span class="ident" id="4885433">serialCap</span>&nbsp;<span class="op" id="4885443">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4885447">return</span>&nbsp;<span class="ident" id="4885454">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4885461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4885465">s</span><span class="op" id="4885466">.</span><span class="ident" id="4885467">p</span><span class="op" id="4885468">.</span><span class="ident" id="4885469">WriteByte</span><span class="op" id="4885478">(</span><span class="ident" id="4885479">serialInBuf</span><span class="op" id="4885490">+</span><span class="ident" id="4885491">head</span><span class="op" id="4885495">%</span><span class="num" id="4885496">32</span><span class="op" id="4885498">,</span>&nbsp;<span class="ident" id="4885500">b</span><span class="op" id="4885501">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4885505">head</span><span class="op" id="4885509">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4885513">s</span><span class="op" id="4885514">.</span><span class="ident" id="4885515">p</span><span class="op" id="4885516">.</span><span class="ident" id="4885517">WriteWord</span><span class="op" id="4885526">(</span><span class="ident" id="4885527">serialInTail</span><span class="op" id="4885539">,</span>&nbsp;<span class="ident" id="4885541">head</span><span class="op" id="4885545">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4885549">n</span><span class="op" id="4885550">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4885554">thresh</span>&nbsp;<span class="op" id="4885561">:=</span>&nbsp;<span class="ident" id="4885564">s</span><span class="op" id="4885565">.</span><span class="ident" id="4885566">p</span><span class="op" id="4885567">.</span><span class="ident" id="4885568">ReadWord</span><span class="op" id="4885576">(</span><span class="ident" id="4885577">serialInThresh</span><span class="op" id="4885591">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4885594">if</span>&nbsp;<span class="ident" id="4885597">n</span>&nbsp;<span class="op" id="4885599">&gt;=</span>&nbsp;<span class="ident" id="4885602">thresh</span>&nbsp;<span class="op" id="4885609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4885613">s</span><span class="op" id="4885614">.</span><span class="ident" id="4885615">interrupt</span><span class="op" id="4885624">(</span><span class="ident" id="4885625">s</span><span class="op" id="4885626">.</span><span class="ident" id="4885627">IntIn</span><span class="op" id="4885632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4885635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4885639">return</span>&nbsp;<span class="ident" id="4885646">true</span><br>
<span class="lineno">85</span><span class="op" id="4885651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4885654">//&nbsp;OutLen&nbsp;returns&nbsp;the&nbsp;current&nbsp;buffer&nbsp;length&nbsp;of&nbsp;the&nbsp;output&nbsp;ring&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="4885725">func</span>&nbsp;<span class="op" id="4885730">(</span><span class="ident" id="4885731">s</span>&nbsp;<span class="op" id="4885733">*</span><span class="ident" id="4885734">serial</span><span class="op" id="4885740">)</span>&nbsp;<span class="ident" id="4885742">OutLen</span><span class="op" id="4885748">(</span><span class="op" id="4885749">)</span>&nbsp;<span class="builtintype" id="4885751">uint32</span>&nbsp;<span class="op" id="4885758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4885761">head</span>&nbsp;<span class="op" id="4885766">:=</span>&nbsp;<span class="ident" id="4885769">s</span><span class="op" id="4885770">.</span><span class="ident" id="4885771">p</span><span class="op" id="4885772">.</span><span class="ident" id="4885773">ReadWord</span><span class="op" id="4885781">(</span><span class="ident" id="4885782">serialOutHead</span><span class="op" id="4885795">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4885798">tail</span>&nbsp;<span class="op" id="4885803">:=</span>&nbsp;<span class="ident" id="4885806">s</span><span class="op" id="4885807">.</span><span class="ident" id="4885808">p</span><span class="op" id="4885809">.</span><span class="ident" id="4885810">ReadWord</span><span class="op" id="4885818">(</span><span class="ident" id="4885819">serialOutTail</span><span class="op" id="4885832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4885835">ret</span>&nbsp;<span class="op" id="4885839">:=</span>&nbsp;<span class="ident" id="4885842">head</span>&nbsp;<span class="op" id="4885847">-</span>&nbsp;<span class="ident" id="4885849">tail</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4885855">if</span>&nbsp;<span class="ident" id="4885858">ret</span>&nbsp;<span class="op" id="4885862">&gt;</span>&nbsp;<span class="ident" id="4885864">serialCap</span>&nbsp;<span class="op" id="4885874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4885878">log</span><span class="op" id="4885881">.</span><span class="ident" id="4885882">Printf</span><span class="op" id="4885888">(</span><span class="string" id="4885889">&#34;error&nbsp;output&nbsp;buffer&nbsp;length&#34;</span><span class="op" id="4885917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4885921">//&nbsp;on&nbsp;error&nbsp;set&nbsp;the&nbsp;length&nbsp;to&nbsp;full</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4885958">//&nbsp;to&nbsp;avoid&nbsp;trigger&nbsp;interrupt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4885990">ret</span>&nbsp;<span class="op" id="4885994">=</span>&nbsp;<span class="ident" id="4885996">serialCap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4886007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4886010">return</span>&nbsp;<span class="ident" id="4886017">ret</span><br>
<span class="lineno"></span><span class="op" id="4886021">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="4886024">//&nbsp;InLen&nbsp;returns&nbsp;the&nbsp;current&nbsp;buffer&nbsp;length&nbsp;of&nbsp;the&nbsp;input&nbsp;ring&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="4886093">func</span>&nbsp;<span class="op" id="4886098">(</span><span class="ident" id="4886099">s</span>&nbsp;<span class="op" id="4886101">*</span><span class="ident" id="4886102">serial</span><span class="op" id="4886108">)</span>&nbsp;<span class="ident" id="4886110">InLen</span><span class="op" id="4886115">(</span><span class="op" id="4886116">)</span>&nbsp;<span class="builtintype" id="4886118">uint32</span>&nbsp;<span class="op" id="4886125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4886128">head</span>&nbsp;<span class="op" id="4886133">:=</span>&nbsp;<span class="ident" id="4886136">s</span><span class="op" id="4886137">.</span><span class="ident" id="4886138">p</span><span class="op" id="4886139">.</span><span class="ident" id="4886140">ReadWord</span><span class="op" id="4886148">(</span><span class="ident" id="4886149">serialInHead</span><span class="op" id="4886161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4886164">tail</span>&nbsp;<span class="op" id="4886169">:=</span>&nbsp;<span class="ident" id="4886172">s</span><span class="op" id="4886173">.</span><span class="ident" id="4886174">p</span><span class="op" id="4886175">.</span><span class="ident" id="4886176">ReadWord</span><span class="op" id="4886184">(</span><span class="ident" id="4886185">serialInTail</span><span class="op" id="4886197">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4886200">ret</span>&nbsp;<span class="op" id="4886204">:=</span>&nbsp;<span class="ident" id="4886207">head</span>&nbsp;<span class="op" id="4886212">-</span>&nbsp;<span class="ident" id="4886214">tail</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4886220">if</span>&nbsp;<span class="ident" id="4886223">ret</span>&nbsp;<span class="op" id="4886227">&gt;</span>&nbsp;<span class="ident" id="4886229">serialCap</span>&nbsp;<span class="op" id="4886239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4886243">log</span><span class="op" id="4886246">.</span><span class="ident" id="4886247">Printf</span><span class="op" id="4886253">(</span><span class="string" id="4886254">&#34;error&nbsp;input&nbsp;buffer&nbsp;length&#34;</span><span class="op" id="4886281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4886285">//&nbsp;on&nbsp;error,&nbsp;set&nbsp;the&nbsp;length&nbsp;to&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4886324">//&nbsp;to&nbsp;avoid&nbsp;trigger&nbsp;interrupt</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4886356">ret</span>&nbsp;<span class="op" id="4886360">=</span>&nbsp;<span class="num" id="4886362">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4886365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4886368">return</span>&nbsp;<span class="ident" id="4886375">ret</span><br>
<span class="lineno"></span><span class="op" id="4886379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="4886382">//&nbsp;ReadByte&nbsp;reads&nbsp;a&nbsp;byte&nbsp;out&nbsp;of&nbsp;serial&nbsp;output&nbsp;ring&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="4886441">func</span>&nbsp;<span class="op" id="4886446">(</span><span class="ident" id="4886447">s</span>&nbsp;<span class="op" id="4886449">*</span><span class="ident" id="4886450">serial</span><span class="op" id="4886456">)</span>&nbsp;<span class="ident" id="4886458">ReadByte</span><span class="op" id="4886466">(</span><span class="op" id="4886467">)</span>&nbsp;<span class="op" id="4886469">(</span><span class="builtintype" id="4886470">byte</span><span class="op" id="4886474">,</span>&nbsp;<span class="builtintype" id="4886476">bool</span><span class="op" id="4886480">)</span>&nbsp;<span class="op" id="4886482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4886485">head</span>&nbsp;<span class="op" id="4886490">:=</span>&nbsp;<span class="ident" id="4886493">s</span><span class="op" id="4886494">.</span><span class="ident" id="4886495">p</span><span class="op" id="4886496">.</span><span class="ident" id="4886497">ReadWord</span><span class="op" id="4886505">(</span><span class="ident" id="4886506">serialOutHead</span><span class="op" id="4886519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4886522">tail</span>&nbsp;<span class="op" id="4886527">:=</span>&nbsp;<span class="ident" id="4886530">s</span><span class="op" id="4886531">.</span><span class="ident" id="4886532">p</span><span class="op" id="4886533">.</span><span class="ident" id="4886534">ReadWord</span><span class="op" id="4886542">(</span><span class="ident" id="4886543">serialOutTail</span><span class="op" id="4886556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4886559">n</span>&nbsp;<span class="op" id="4886561">:=</span>&nbsp;<span class="ident" id="4886564">head</span>&nbsp;<span class="op" id="4886569">-</span>&nbsp;<span class="ident" id="4886571">tail</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4886577">if</span>&nbsp;<span class="ident" id="4886580">n</span>&nbsp;<span class="op" id="4886582">==</span>&nbsp;<span class="num" id="4886585">0</span>&nbsp;<span class="op" id="4886587">||</span>&nbsp;<span class="ident" id="4886590">n</span>&nbsp;<span class="op" id="4886592">&gt;</span>&nbsp;<span class="ident" id="4886594">serialCap</span>&nbsp;<span class="op" id="4886604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4886608">return</span>&nbsp;<span class="num" id="4886615">0</span><span class="op" id="4886616">,</span>&nbsp;<span class="ident" id="4886618">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4886625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4886629">b</span>&nbsp;<span class="op" id="4886631">:=</span>&nbsp;<span class="ident" id="4886634">s</span><span class="op" id="4886635">.</span><span class="ident" id="4886636">p</span><span class="op" id="4886637">.</span><span class="ident" id="4886638">ReadByte</span><span class="op" id="4886646">(</span><span class="ident" id="4886647">serialOutBuf</span>&nbsp;<span class="op" id="4886660">+</span>&nbsp;<span class="ident" id="4886662">tail</span><span class="op" id="4886666">%</span><span class="num" id="4886667">32</span><span class="op" id="4886669">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4886672">tail</span><span class="op" id="4886676">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4886680">s</span><span class="op" id="4886681">.</span><span class="ident" id="4886682">p</span><span class="op" id="4886683">.</span><span class="ident" id="4886684">WriteWord</span><span class="op" id="4886693">(</span><span class="ident" id="4886694">serialOutTail</span><span class="op" id="4886707">,</span>&nbsp;<span class="ident" id="4886709">tail</span><span class="op" id="4886713">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4886717">n</span><span class="op" id="4886718">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4886722">thresh</span>&nbsp;<span class="op" id="4886729">:=</span>&nbsp;<span class="ident" id="4886732">s</span><span class="op" id="4886733">.</span><span class="ident" id="4886734">p</span><span class="op" id="4886735">.</span><span class="ident" id="4886736">ReadWord</span><span class="op" id="4886744">(</span><span class="ident" id="4886745">serialOutThresh</span><span class="op" id="4886760">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4886763">if</span>&nbsp;<span class="ident" id="4886766">n</span>&nbsp;<span class="op" id="4886768">&lt;=</span>&nbsp;<span class="ident" id="4886771">thresh</span>&nbsp;<span class="op" id="4886778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4886782">s</span><span class="op" id="4886783">.</span><span class="ident" id="4886784">interrupt</span><span class="op" id="4886793">(</span><span class="ident" id="4886794">s</span><span class="op" id="4886795">.</span><span class="ident" id="4886796">IntOut</span><span class="op" id="4886802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4886805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4886809">return</span>&nbsp;<span class="ident" id="4886816">b</span><span class="op" id="4886817">,</span>&nbsp;<span class="ident" id="4886819">true</span><br>
<span class="lineno">135</span><span class="op" id="4886824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4886827">func</span>&nbsp;<span class="op" id="4886832">(</span><span class="ident" id="4886833">s</span>&nbsp;<span class="op" id="4886835">*</span><span class="ident" id="4886836">serial</span><span class="op" id="4886842">)</span>&nbsp;<span class="ident" id="4886844">countDown</span><span class="op" id="4886853">(</span><span class="op" id="4886854">)</span>&nbsp;<span class="op" id="4886856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4886859">inWait</span>&nbsp;<span class="op" id="4886866">:=</span>&nbsp;<span class="ident" id="4886869">s</span><span class="op" id="4886870">.</span><span class="ident" id="4886871">p</span><span class="op" id="4886872">.</span><span class="ident" id="4886873">ReadWord</span><span class="op" id="4886881">(</span><span class="ident" id="4886882">serialInWait</span><span class="op" id="4886894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4886897">outWait</span>&nbsp;<span class="op" id="4886905">:=</span>&nbsp;<span class="ident" id="4886908">s</span><span class="op" id="4886909">.</span><span class="ident" id="4886910">p</span><span class="op" id="4886911">.</span><span class="ident" id="4886912">ReadWord</span><span class="op" id="4886920">(</span><span class="ident" id="4886921">serialOutWait</span><span class="op" id="4886934">)</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4886938">if</span>&nbsp;<span class="ident" id="4886941">inWait</span>&nbsp;<span class="op" id="4886948">&gt;</span>&nbsp;<span class="num" id="4886950">0</span>&nbsp;<span class="op" id="4886952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4886956">inWait</span><span class="op" id="4886962">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4886966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4886969">if</span>&nbsp;<span class="ident" id="4886972">outWait</span>&nbsp;<span class="op" id="4886980">&gt;</span>&nbsp;<span class="num" id="4886982">0</span>&nbsp;<span class="op" id="4886984">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4886988">outWait</span><span class="op" id="4886995">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4886999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4887003">if</span>&nbsp;<span class="ident" id="4887006">inWait</span>&nbsp;<span class="op" id="4887013">==</span>&nbsp;<span class="num" id="4887016">0</span>&nbsp;<span class="op" id="4887018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4887022">if</span>&nbsp;<span class="ident" id="4887025">s</span><span class="op" id="4887026">.</span><span class="ident" id="4887027">InLen</span><span class="op" id="4887032">(</span><span class="op" id="4887033">)</span>&nbsp;<span class="op" id="4887035">&gt;</span>&nbsp;<span class="num" id="4887037">0</span>&nbsp;<span class="op" id="4887039">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4887044">s</span><span class="op" id="4887045">.</span><span class="ident" id="4887046">interrupt</span><span class="op" id="4887055">(</span><span class="ident" id="4887056">s</span><span class="op" id="4887057">.</span><span class="ident" id="4887058">IntIn</span><span class="op" id="4887063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4887067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4887070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4887074">if</span>&nbsp;<span class="ident" id="4887077">outWait</span>&nbsp;<span class="op" id="4887085">==</span>&nbsp;<span class="num" id="4887088">0</span>&nbsp;<span class="op" id="4887090">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4887094">if</span>&nbsp;<span class="ident" id="4887097">s</span><span class="op" id="4887098">.</span><span class="ident" id="4887099">OutLen</span><span class="op" id="4887105">(</span><span class="op" id="4887106">)</span>&nbsp;<span class="op" id="4887108">&lt;</span>&nbsp;<span class="ident" id="4887110">serialCap</span>&nbsp;<span class="op" id="4887120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4887125">s</span><span class="op" id="4887126">.</span><span class="ident" id="4887127">interrupt</span><span class="op" id="4887136">(</span><span class="ident" id="4887137">s</span><span class="op" id="4887138">.</span><span class="ident" id="4887139">IntOut</span><span class="op" id="4887145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4887149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4887152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4887156">s</span><span class="op" id="4887157">.</span><span class="ident" id="4887158">p</span><span class="op" id="4887159">.</span><span class="ident" id="4887160">WriteWord</span><span class="op" id="4887169">(</span><span class="ident" id="4887170">serialInWait</span><span class="op" id="4887182">,</span>&nbsp;<span class="ident" id="4887184">inWait</span><span class="op" id="4887190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4887193">s</span><span class="op" id="4887194">.</span><span class="ident" id="4887195">p</span><span class="op" id="4887196">.</span><span class="ident" id="4887197">WriteWord</span><span class="op" id="4887206">(</span><span class="ident" id="4887207">serialOutWait</span><span class="op" id="4887220">,</span>&nbsp;<span class="ident" id="4887222">outWait</span><span class="op" id="4887229">)</span><br>
<span class="lineno"></span><span class="op" id="4887231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4887234">func</span>&nbsp;<span class="op" id="4887239">(</span><span class="ident" id="4887240">s</span>&nbsp;<span class="op" id="4887242">*</span><span class="ident" id="4887243">serial</span><span class="op" id="4887249">)</span>&nbsp;<span class="ident" id="4887251">flush</span><span class="op" id="4887256">(</span><span class="op" id="4887257">)</span>&nbsp;<span class="op" id="4887259">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4887262">buf</span>&nbsp;<span class="op" id="4887266">:=</span>&nbsp;<span class="builtinfunc" id="4887269">new</span><span class="op" id="4887272">(</span><span class="ident" id="4887273">bytes</span><span class="op" id="4887278">.</span><span class="ident" id="4887279">Buffer</span><span class="op" id="4887285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4887288">for</span>&nbsp;<span class="op" id="4887292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4887296">b</span><span class="op" id="4887297">,</span>&nbsp;<span class="ident" id="4887299">valid</span>&nbsp;<span class="op" id="4887305">:=</span>&nbsp;<span class="ident" id="4887308">s</span><span class="op" id="4887309">.</span><span class="ident" id="4887310">ReadByte</span><span class="op" id="4887318">(</span><span class="op" id="4887319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4887323">if</span>&nbsp;<span class="ident" id="4887326">valid</span>&nbsp;<span class="op" id="4887332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4887337">buf</span><span class="op" id="4887340">.</span><span class="ident" id="4887341">WriteByte</span><span class="op" id="4887350">(</span><span class="ident" id="4887351">b</span><span class="op" id="4887352">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4887356">}</span>&nbsp;<span class="keyword" id="4887358">else</span>&nbsp;<span class="op" id="4887363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4887368">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4887376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4887379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4887383">if</span>&nbsp;<span class="ident" id="4887386">s</span><span class="op" id="4887387">.</span><span class="ident" id="4887388">Output</span>&nbsp;<span class="op" id="4887395">!=</span>&nbsp;<span class="ident" id="4887398">nil</span>&nbsp;<span class="op" id="4887402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4887406">_</span><span class="op" id="4887407">,</span>&nbsp;<span class="ident" id="4887409">e</span>&nbsp;<span class="op" id="4887411">:=</span>&nbsp;<span class="ident" id="4887414">s</span><span class="op" id="4887415">.</span><span class="ident" id="4887416">Output</span><span class="op" id="4887422">.</span><span class="ident" id="4887423">Write</span><span class="op" id="4887428">(</span><span class="ident" id="4887429">buf</span><span class="op" id="4887432">.</span><span class="ident" id="4887433">Bytes</span><span class="op" id="4887438">(</span><span class="op" id="4887439">)</span><span class="op" id="4887440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4887444">if</span>&nbsp;<span class="ident" id="4887447">e</span>&nbsp;<span class="op" id="4887449">!=</span>&nbsp;<span class="ident" id="4887452">nil</span>&nbsp;<span class="op" id="4887456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4887461">log</span><span class="op" id="4887464">.</span><span class="ident" id="4887465">Print</span><span class="op" id="4887470">(</span><span class="ident" id="4887471">e</span><span class="op" id="4887472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4887476">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4887479">}</span><br>
<span class="lineno"></span><span class="op" id="4887481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4887484">//&nbsp;Tick&nbsp;counts&nbsp;down&nbsp;the&nbsp;waiting&nbsp;counters&nbsp;and&nbsp;triggers</span><br>
<span class="lineno"></span><span class="comment" id="4887538">//&nbsp;interrupt&nbsp;when&nbsp;the&nbsp;count&nbsp;down&nbsp;reaches&nbsp;zero.</span><br>
<span class="lineno">185</span><span class="keyword" id="4887585">func</span>&nbsp;<span class="op" id="4887590">(</span><span class="ident" id="4887591">s</span>&nbsp;<span class="op" id="4887593">*</span><span class="ident" id="4887594">serial</span><span class="op" id="4887600">)</span>&nbsp;<span class="ident" id="4887602">Tick</span><span class="op" id="4887606">(</span><span class="op" id="4887607">)</span>&nbsp;<span class="op" id="4887609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4887612">s</span><span class="op" id="4887613">.</span><span class="ident" id="4887614">flush</span><span class="op" id="4887619">(</span><span class="op" id="4887620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4887623">s</span><span class="op" id="4887624">.</span><span class="ident" id="4887625">countDown</span><span class="op" id="4887634">(</span><span class="op" id="4887635">)</span><br>
<span class="lineno"></span><span class="op" id="4887637">}</span>
</div>
</body>
</html>
