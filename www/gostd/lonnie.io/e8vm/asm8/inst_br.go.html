<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/asm8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/asm8/bare_func.go.html">bare_func.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/build_file.go.html">build_file.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/build_func.go.html">build_func.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/build_lib.go.html">build_lib.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/build_var.go.html">build_var.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/builder.go.html">builder.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/check_type.go.html">check_type.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/data_hex.go.html">data_hex.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/data_nums.go.html">data_nums.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/data_str.go.html">data_str.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/file.go.html">file.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/func_decl.go.html">func_decl.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/func_stmt.go.html">func_stmt.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/inst.go.html">inst.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/inst_all.go.html">inst_all.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/inst_br.go.html">inst_br.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/inst_imm.go.html">inst_imm.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/inst_jmp.go.html">inst_jmp.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/inst_reg.go.html">inst_reg.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/inst_sys.go.html">inst_sys.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/lex_all.go.html">lex_all.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/lex_all_test.go.html">lex_all_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/lex_comment.go.html">lex_comment.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/lex_operand.go.html">lex_operand.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/lex_string.go.html">lex_string.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/lib.go.html">lib.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/package.go.html">package.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parse_arg.go.html">parse_arg.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parse_file.go.html">parse_file.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parse_func.go.html">parse_func.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parse_func_stmt.go.html">parse_func_stmt.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parse_func_test.go.html">parse_func_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parse_inst.go.html">parse_inst.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parse_label.go.html">parse_label.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parse_reg.go.html">parse_reg.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parse_sym.go.html">parse_sym.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parse_var.go.html">parse_var.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parse_var_stmt.go.html">parse_var_stmt.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parser.go.html">parser.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/single_file.go.html">single_file.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/stmt_lexer.go.html">stmt_lexer.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/sym_scope.go.html">sym_scope.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/sym_table.go.html">sym_table.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/symbol.go.html">symbol.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/token.go.html">token.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/var_decl.go.html">var_decl.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/var_stmt.go.html">var_stmt.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="4865332">package</span>&nbsp;<span class="ident" id="4865340">asm8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4865346">import</span>&nbsp;<span class="op" id="4865353">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4865356">&#34;lonnie.io/e8vm/lex8&#34;</span><br>
<span class="lineno">5</span><span class="op" id="4865378">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4865381">var</span>&nbsp;<span class="op" id="4865385">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4865388">//&nbsp;op&nbsp;reg&nbsp;reg&nbsp;label</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865409">opBrMap</span>&nbsp;<span class="op" id="4865417">=</span>&nbsp;<span class="keyword" id="4865419">map</span><span class="op" id="4865422">[</span><span class="builtintype" id="4865423">string</span><span class="op" id="4865429">]</span><span class="builtintype" id="4865430">uint32</span><span class="op" id="4865436">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4865440">&#34;bne&#34;</span><span class="op" id="4865445">:</span>&nbsp;<span class="num" id="4865447">32</span><span class="op" id="4865449">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4865453">&#34;beq&#34;</span><span class="op" id="4865458">:</span>&nbsp;<span class="num" id="4865460">33</span><span class="op" id="4865462">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4865465">}</span><br>
<span class="lineno"></span><span class="op" id="4865467">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="4865470">func</span>&nbsp;<span class="ident" id="4865475">makeInstBr</span><span class="op" id="4865485">(</span><span class="ident" id="4865486">op</span><span class="op" id="4865488">,</span>&nbsp;<span class="ident" id="4865490">s1</span><span class="op" id="4865492">,</span>&nbsp;<span class="ident" id="4865494">s2</span>&nbsp;<span class="builtintype" id="4865497">uint32</span><span class="op" id="4865503">)</span>&nbsp;<span class="op" id="4865505">*</span><span class="ident" id="4865506">inst</span>&nbsp;<span class="op" id="4865511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865514">ret</span>&nbsp;<span class="op" id="4865518">:=</span>&nbsp;<span class="op" id="4865521">(</span><span class="ident" id="4865522">op</span>&nbsp;<span class="op" id="4865525">&amp;</span>&nbsp;<span class="num" id="4865527">0xff</span><span class="op" id="4865531">)</span>&nbsp;<span class="op" id="4865533">&lt;&lt;</span>&nbsp;<span class="num" id="4865536">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865540">ret</span>&nbsp;<span class="op" id="4865544">|=</span>&nbsp;<span class="op" id="4865547">(</span><span class="ident" id="4865548">s1</span>&nbsp;<span class="op" id="4865551">&amp;</span>&nbsp;<span class="num" id="4865553">0x7</span><span class="op" id="4865556">)</span>&nbsp;<span class="op" id="4865558">&lt;&lt;</span>&nbsp;<span class="num" id="4865561">21</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865565">ret</span>&nbsp;<span class="op" id="4865569">|=</span>&nbsp;<span class="op" id="4865572">(</span><span class="ident" id="4865573">s2</span>&nbsp;<span class="op" id="4865576">&amp;</span>&nbsp;<span class="num" id="4865578">0x7</span><span class="op" id="4865581">)</span>&nbsp;<span class="op" id="4865583">&lt;&lt;</span>&nbsp;<span class="num" id="4865586">18</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865590">return</span>&nbsp;<span class="op" id="4865597">&amp;</span><span class="ident" id="4865598">inst</span><span class="op" id="4865602">{</span><span class="ident" id="4865603">inst</span><span class="op" id="4865607">:</span>&nbsp;<span class="ident" id="4865609">ret</span><span class="op" id="4865612">}</span><br>
<span class="lineno">20</span><span class="op" id="4865614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4865617">func</span>&nbsp;<span class="ident" id="4865622">parseInstBr</span><span class="op" id="4865633">(</span><span class="ident" id="4865634">p</span>&nbsp;<span class="op" id="4865636">*</span><span class="ident" id="4865637">parser</span><span class="op" id="4865643">,</span>&nbsp;<span class="ident" id="4865645">ops</span>&nbsp;<span class="op" id="4865649">[</span><span class="op" id="4865650">]</span><span class="op" id="4865651">*</span><span class="ident" id="4865652">lex8</span><span class="op" id="4865656">.</span><span class="ident" id="4865657">Token</span><span class="op" id="4865662">)</span>&nbsp;<span class="op" id="4865664">(</span><span class="op" id="4865665">*</span><span class="ident" id="4865666">inst</span><span class="op" id="4865670">,</span>&nbsp;<span class="builtintype" id="4865672">bool</span><span class="op" id="4865676">)</span>&nbsp;<span class="op" id="4865678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865681">op0</span>&nbsp;<span class="op" id="4865685">:=</span>&nbsp;<span class="ident" id="4865688">ops</span><span class="op" id="4865691">[</span><span class="num" id="4865692">0</span><span class="op" id="4865693">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865696">opName</span>&nbsp;<span class="op" id="4865703">:=</span>&nbsp;<span class="ident" id="4865706">op0</span><span class="op" id="4865709">.</span><span class="ident" id="4865710">Lit</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865715">args</span>&nbsp;<span class="op" id="4865720">:=</span>&nbsp;<span class="ident" id="4865723">ops</span><span class="op" id="4865726">[</span><span class="num" id="4865727">1</span><span class="op" id="4865728">:</span><span class="op" id="4865729">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865733">var</span>&nbsp;<span class="op" id="4865737">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865741">op</span><span class="op" id="4865743">,</span>&nbsp;<span class="ident" id="4865745">s1</span><span class="op" id="4865747">,</span>&nbsp;<span class="ident" id="4865749">s2</span>&nbsp;<span class="builtintype" id="4865752">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865761">lab</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4865772">string</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865781">symTok</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4865792">*</span><span class="ident" id="4865793">lex8</span><span class="op" id="4865797">.</span><span class="ident" id="4865798">Token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865807">found</span>&nbsp;<span class="builtintype" id="4865813">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4865819">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865823">if</span>&nbsp;<span class="ident" id="4865826">op</span><span class="op" id="4865828">,</span>&nbsp;<span class="ident" id="4865830">found</span>&nbsp;<span class="op" id="4865836">=</span>&nbsp;<span class="ident" id="4865838">opBrMap</span><span class="op" id="4865845">[</span><span class="ident" id="4865846">opName</span><span class="op" id="4865852">]</span><span class="op" id="4865853">;</span>&nbsp;<span class="ident" id="4865855">found</span>&nbsp;<span class="op" id="4865861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4865865">//&nbsp;op&nbsp;reg&nbsp;reg&nbsp;label</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865887">if</span>&nbsp;<span class="ident" id="4865890">argCount</span><span class="op" id="4865898">(</span><span class="ident" id="4865899">p</span><span class="op" id="4865900">,</span>&nbsp;<span class="ident" id="4865902">ops</span><span class="op" id="4865905">,</span>&nbsp;<span class="num" id="4865907">3</span><span class="op" id="4865908">)</span>&nbsp;<span class="op" id="4865910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865915">s1</span>&nbsp;<span class="op" id="4865918">=</span>&nbsp;<span class="ident" id="4865920">parseReg</span><span class="op" id="4865928">(</span><span class="ident" id="4865929">p</span><span class="op" id="4865930">,</span>&nbsp;<span class="ident" id="4865932">args</span><span class="op" id="4865936">[</span><span class="num" id="4865937">0</span><span class="op" id="4865938">]</span><span class="op" id="4865939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865944">s2</span>&nbsp;<span class="op" id="4865947">=</span>&nbsp;<span class="ident" id="4865949">parseReg</span><span class="op" id="4865957">(</span><span class="ident" id="4865958">p</span><span class="op" id="4865959">,</span>&nbsp;<span class="ident" id="4865961">args</span><span class="op" id="4865965">[</span><span class="num" id="4865966">1</span><span class="op" id="4865967">]</span><span class="op" id="4865968">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865973">symTok</span>&nbsp;<span class="op" id="4865980">=</span>&nbsp;<span class="ident" id="4865982">args</span><span class="op" id="4865986">[</span><span class="num" id="4865987">2</span><span class="op" id="4865988">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865993">if</span>&nbsp;<span class="ident" id="4865996">parseLabel</span><span class="op" id="4866006">(</span><span class="ident" id="4866007">p</span><span class="op" id="4866008">,</span>&nbsp;<span class="ident" id="4866010">symTok</span><span class="op" id="4866016">)</span>&nbsp;<span class="op" id="4866018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866024">lab</span>&nbsp;<span class="op" id="4866028">=</span>&nbsp;<span class="ident" id="4866030">symTok</span><span class="op" id="4866036">.</span><span class="ident" id="4866037">Lit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4866044">}</span>&nbsp;<span class="keyword" id="4866046">else</span>&nbsp;<span class="op" id="4866051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866057">p</span><span class="op" id="4866058">.</span><span class="ident" id="4866059">err</span><span class="op" id="4866062">(</span><span class="ident" id="4866063">symTok</span><span class="op" id="4866069">.</span><span class="ident" id="4866070">Pos</span><span class="op" id="4866073">,</span>&nbsp;<span class="string" id="4866075">&#34;expects&nbsp;a&nbsp;label&nbsp;for&nbsp;%s&#34;</span><span class="op" id="4866099">,</span>&nbsp;<span class="ident" id="4866101">opName</span><span class="op" id="4866107">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4866112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4866116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4866119">}</span>&nbsp;<span class="keyword" id="4866121">else</span>&nbsp;<span class="op" id="4866126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866130">return</span>&nbsp;<span class="ident" id="4866137">nil</span><span class="op" id="4866140">,</span>&nbsp;<span class="builtintype" id="4866142">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4866149">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866153">ret</span>&nbsp;<span class="op" id="4866157">:=</span>&nbsp;<span class="ident" id="4866160">makeInstBr</span><span class="op" id="4866170">(</span><span class="ident" id="4866171">op</span><span class="op" id="4866173">,</span>&nbsp;<span class="ident" id="4866175">s1</span><span class="op" id="4866177">,</span>&nbsp;<span class="ident" id="4866179">s2</span><span class="op" id="4866181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866184">ret</span><span class="op" id="4866187">.</span><span class="ident" id="4866188">symbol</span>&nbsp;<span class="op" id="4866195">=</span>&nbsp;<span class="ident" id="4866197">lab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866202">ret</span><span class="op" id="4866205">.</span><span class="ident" id="4866206">fill</span>&nbsp;<span class="op" id="4866211">=</span>&nbsp;<span class="ident" id="4866213">fillLabel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866224">ret</span><span class="op" id="4866227">.</span><span class="ident" id="4866228">symTok</span>&nbsp;<span class="op" id="4866235">=</span>&nbsp;<span class="ident" id="4866237">symTok</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866246">return</span>&nbsp;<span class="ident" id="4866253">ret</span><span class="op" id="4866256">,</span>&nbsp;<span class="builtintype" id="4866258">true</span><br>
<span class="lineno"></span><span class="op" id="4866263">}</span>
</div>
</body>
</html>
