<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>math/big</h2>
<ul>
<li><a href="/gostd/math/big/arith.go.html">arith.go</a></li>
<li><a href="/gostd/math/big/arith_decl.go.html">arith_decl.go</a></li>
<li><a href="/gostd/math/big/arith_test.go.html">arith_test.go</a></li>
<li><a href="/gostd/math/big/calibrate_test.go.html">calibrate_test.go</a></li>
<li><a href="/gostd/math/big/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/math/big/gcd_test.go.html">gcd_test.go</a></li>
<li><a href="/gostd/math/big/hilbert_test.go.html">hilbert_test.go</a></li>
<li><a href="/gostd/math/big/int.go.html">int.go</a></li>
<li><a href="/gostd/math/big/int_test.go.html">int_test.go</a></li>
<li><a href="/gostd/math/big/nat.go.html">nat.go</a></li>
<li><a href="/gostd/math/big/nat_test.go.html">nat_test.go</a></li>
<li><a href="/gostd/math/big/rat.go.html">rat.go</a></li>
<li><a href="/gostd/math/big/rat_test.go.html">rat_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3755581">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3755636">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3755690">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3755741">//&nbsp;Package&nbsp;big&nbsp;implements&nbsp;multi-precision&nbsp;arithmetic&nbsp;(big&nbsp;numbers).</span><br>
<span class="lineno"></span><span class="comment" id="3755809">//&nbsp;The&nbsp;following&nbsp;numeric&nbsp;types&nbsp;are&nbsp;supported:</span><br>
<span class="lineno"></span><span class="comment" id="3755855">//</span><br>
<span class="lineno"></span><span class="comment" id="3755858">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;Int&nbsp;&nbsp;&nbsp;&nbspsigned&nbsp;integers</span><br>
<span class="lineno"></span><span class="comment" id="3755883">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;Rat&nbsp;&nbsp;&nbsp;&nbsprational&nbsp;numbers</span><br>
<span class="lineno">10</span><span class="comment" id="3755909">//</span><br>
<span class="lineno"></span><span class="comment" id="3755912">//&nbsp;Methods&nbsp;are&nbsp;typically&nbsp;of&nbsp;the&nbsp;form:</span><br>
<span class="lineno"></span><span class="comment" id="3755950">//</span><br>
<span class="lineno"></span><span class="comment" id="3755953">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;(z&nbsp;*Int)&nbsp;Op(x,&nbsp;y&nbsp;*Int)&nbsp;*Int&nbsp;&nbsp;&nbsp;&nbsp(similar&nbsp;for&nbsp;*Rat)</span><br>
<span class="lineno"></span><span class="comment" id="3756008">//</span><br>
<span class="lineno">15</span><span class="comment" id="3756011">//&nbsp;and&nbsp;implement&nbsp;operations&nbsp;z&nbsp;=&nbsp;x&nbsp;Op&nbsp;y&nbsp;with&nbsp;the&nbsp;result&nbsp;as&nbsp;receiver;&nbsp;if&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3756085">//&nbsp;is&nbsp;one&nbsp;of&nbsp;the&nbsp;operands&nbsp;it&nbsp;may&nbsp;be&nbsp;overwritten&nbsp;(and&nbsp;its&nbsp;memory&nbsp;reused).</span><br>
<span class="lineno"></span><span class="comment" id="3756158">//&nbsp;To&nbsp;enable&nbsp;chaining&nbsp;of&nbsp;operations,&nbsp;the&nbsp;result&nbsp;is&nbsp;also&nbsp;returned.&nbsp;Methods</span><br>
<span class="lineno"></span><span class="comment" id="3756232">//&nbsp;returning&nbsp;a&nbsp;result&nbsp;other&nbsp;than&nbsp;*Int&nbsp;or&nbsp;*Rat&nbsp;take&nbsp;one&nbsp;of&nbsp;the&nbsp;operands&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="3756306">//&nbsp;the&nbsp;receiver.</span><br>
<span class="lineno">20</span><span class="comment" id="3756323">//</span><br>
<span class="lineno"></span><span class="keyword" id="3756326">package</span>&nbsp;<span class="ident" id="3756334">big</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3756339">//&nbsp;This&nbsp;file&nbsp;contains&nbsp;operations&nbsp;on&nbsp;unsigned&nbsp;multi-precision&nbsp;integers.</span><br>
<span class="lineno"></span><span class="comment" id="3756410">//&nbsp;These&nbsp;are&nbsp;the&nbsp;building&nbsp;blocks&nbsp;for&nbsp;the&nbsp;operations&nbsp;on&nbsp;signed&nbsp;integers</span><br>
<span class="lineno">25</span><span class="comment" id="3756481">//&nbsp;and&nbsp;rationals.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3756500">import</span>&nbsp;<span class="op" id="3756507">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3756510">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3756520">&#34;io&#34;</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3756526">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3756534">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3756547">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="3756554">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="3756557">//&nbsp;An&nbsp;unsigned&nbsp;integer&nbsp;x&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3756594">//</span><br>
<span class="lineno"></span><span class="comment" id="3756597">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;x[n-1]*_B^(n-1)&nbsp;+&nbsp;x[n-2]*_B^(n-2)&nbsp;+&nbsp;...&nbsp;+&nbsp;x[1]*_B&nbsp;+&nbsp;x[0]</span><br>
<span class="lineno"></span><span class="comment" id="3756663">//</span><br>
<span class="lineno"></span><span class="comment" id="3756666">//&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;x[i]&nbsp;&lt;&nbsp;_B&nbsp;and&nbsp;0&nbsp;&lt;=&nbsp;i&nbsp;&lt;&nbsp;n&nbsp;is&nbsp;stored&nbsp;in&nbsp;a&nbsp;slice&nbsp;of&nbsp;length&nbsp;n,</span><br>
<span class="lineno">40</span><span class="comment" id="3756738">//&nbsp;with&nbsp;the&nbsp;digits&nbsp;x[i]&nbsp;as&nbsp;the&nbsp;slice&nbsp;elements.</span><br>
<span class="lineno"></span><span class="comment" id="3756785">//</span><br>
<span class="lineno"></span><span class="comment" id="3756788">//&nbsp;A&nbsp;number&nbsp;is&nbsp;normalized&nbsp;if&nbsp;the&nbsp;slice&nbsp;contains&nbsp;no&nbsp;leading&nbsp;0&nbsp;digits.</span><br>
<span class="lineno"></span><span class="comment" id="3756857">//&nbsp;During&nbsp;arithmetic&nbsp;operations,&nbsp;denormalized&nbsp;values&nbsp;may&nbsp;occur&nbsp;but&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="3756928">//&nbsp;always&nbsp;normalized&nbsp;before&nbsp;returning&nbsp;the&nbsp;final&nbsp;result.&nbsp;The&nbsp;normalized</span><br>
<span class="lineno">45</span><span class="comment" id="3756999">//&nbsp;representation&nbsp;of&nbsp;0&nbsp;is&nbsp;the&nbsp;empty&nbsp;or&nbsp;nil&nbsp;slice&nbsp;(length&nbsp;=&nbsp;0).</span><br>
<span class="lineno"></span><span class="comment" id="3757062">//</span><br>
<span class="lineno"></span><span class="keyword" id="3757065">type</span>&nbsp;<span class="ident" id="3757070">nat</span>&nbsp;<span class="op" id="3757074">[</span><span class="op" id="3757075">]</span><span class="ident" id="3757076">Word</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3757082">var</span>&nbsp;<span class="op" id="3757086">(</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3757089">natOne</span>&nbsp;<span class="op" id="3757096">=</span>&nbsp;<span class="ident" id="3757098">nat</span><span class="op" id="3757101">{</span><span class="num" id="3757102">1</span><span class="op" id="3757103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3757106">natTwo</span>&nbsp;<span class="op" id="3757113">=</span>&nbsp;<span class="ident" id="3757115">nat</span><span class="op" id="3757118">{</span><span class="num" id="3757119">2</span><span class="op" id="3757120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3757123">natTen</span>&nbsp;<span class="op" id="3757130">=</span>&nbsp;<span class="ident" id="3757132">nat</span><span class="op" id="3757135">{</span><span class="num" id="3757136">10</span><span class="op" id="3757138">}</span><br>
<span class="lineno"></span><span class="op" id="3757140">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="3757143">func</span>&nbsp;<span class="op" id="3757148">(</span><span class="ident" id="3757149">z</span>&nbsp;<span class="ident" id="3757151">nat</span><span class="op" id="3757154">)</span>&nbsp;<span class="ident" id="3757156">clear</span><span class="op" id="3757161">(</span><span class="op" id="3757162">)</span>&nbsp;<span class="op" id="3757164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757167">for</span>&nbsp;<span class="ident" id="3757171">i</span>&nbsp;<span class="op" id="3757173">:=</span>&nbsp;<span class="keyword" id="3757176">range</span>&nbsp;<span class="ident" id="3757182">z</span>&nbsp;<span class="op" id="3757184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3757188">z</span><span class="op" id="3757189">[</span><span class="ident" id="3757190">i</span><span class="op" id="3757191">]</span>&nbsp;<span class="op" id="3757193">=</span>&nbsp;<span class="num" id="3757195">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3757198">}</span><br>
<span class="lineno"></span><span class="op" id="3757200">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3757203">func</span>&nbsp;<span class="op" id="3757208">(</span><span class="ident" id="3757209">z</span>&nbsp;<span class="ident" id="3757211">nat</span><span class="op" id="3757214">)</span>&nbsp;<span class="ident" id="3757216">norm</span><span class="op" id="3757220">(</span><span class="op" id="3757221">)</span>&nbsp;<span class="ident" id="3757223">nat</span>&nbsp;<span class="op" id="3757227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3757230">i</span>&nbsp;<span class="op" id="3757232">:=</span>&nbsp;<span class="builtinfunc" id="3757235">len</span><span class="op" id="3757238">(</span><span class="ident" id="3757239">z</span><span class="op" id="3757240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757243">for</span>&nbsp;<span class="ident" id="3757247">i</span>&nbsp;<span class="op" id="3757249">&gt;</span>&nbsp;<span class="num" id="3757251">0</span>&nbsp;<span class="op" id="3757253">&amp;&amp;</span>&nbsp;<span class="ident" id="3757256">z</span><span class="op" id="3757257">[</span><span class="ident" id="3757258">i</span><span class="op" id="3757259">-</span><span class="num" id="3757260">1</span><span class="op" id="3757261">]</span>&nbsp;<span class="op" id="3757263">==</span>&nbsp;<span class="num" id="3757266">0</span>&nbsp;<span class="op" id="3757268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3757272">i</span><span class="op" id="3757273">--</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3757277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757280">return</span>&nbsp;<span class="ident" id="3757287">z</span><span class="op" id="3757288">[</span><span class="num" id="3757289">0</span><span class="op" id="3757290">:</span><span class="ident" id="3757291">i</span><span class="op" id="3757292">]</span><br>
<span class="lineno"></span><span class="op" id="3757294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3757297">func</span>&nbsp;<span class="op" id="3757302">(</span><span class="ident" id="3757303">z</span>&nbsp;<span class="ident" id="3757305">nat</span><span class="op" id="3757308">)</span>&nbsp;<span class="builtinfunc" id="3757310">make</span><span class="op" id="3757314">(</span><span class="ident" id="3757315">n</span>&nbsp;<span class="builtintype" id="3757317">int</span><span class="op" id="3757320">)</span>&nbsp;<span class="ident" id="3757322">nat</span>&nbsp;<span class="op" id="3757326">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757329">if</span>&nbsp;<span class="ident" id="3757332">n</span>&nbsp;<span class="op" id="3757334">&lt;=</span>&nbsp;<span class="builtinfunc" id="3757337">cap</span><span class="op" id="3757340">(</span><span class="ident" id="3757341">z</span><span class="op" id="3757342">)</span>&nbsp;<span class="op" id="3757344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757348">return</span>&nbsp;<span class="ident" id="3757355">z</span><span class="op" id="3757356">[</span><span class="num" id="3757357">0</span><span class="op" id="3757358">:</span><span class="ident" id="3757359">n</span><span class="op" id="3757360">]</span>&nbsp;<span class="comment" id="3757362">//&nbsp;reuse&nbsp;z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3757374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3757377">//&nbsp;Choosing&nbsp;a&nbsp;good&nbsp;value&nbsp;for&nbsp;e&nbsp;has&nbsp;significant&nbsp;performance&nbsp;impact</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3757444">//&nbsp;because&nbsp;it&nbsp;increases&nbsp;the&nbsp;chance&nbsp;that&nbsp;a&nbsp;value&nbsp;can&nbsp;be&nbsp;reused.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757508">const</span>&nbsp;<span class="ident" id="3757514">e</span>&nbsp;<span class="op" id="3757516">=</span>&nbsp;<span class="num" id="3757518">4</span>&nbsp;<span class="comment" id="3757520">//&nbsp;extra&nbsp;capacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757539">return</span>&nbsp;<span class="builtinfunc" id="3757546">make</span><span class="op" id="3757550">(</span><span class="ident" id="3757551">nat</span><span class="op" id="3757554">,</span>&nbsp;<span class="ident" id="3757556">n</span><span class="op" id="3757557">,</span>&nbsp;<span class="ident" id="3757559">n</span><span class="op" id="3757560">+</span><span class="ident" id="3757561">e</span><span class="op" id="3757562">)</span><br>
<span class="lineno"></span><span class="op" id="3757564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3757567">func</span>&nbsp;<span class="op" id="3757572">(</span><span class="ident" id="3757573">z</span>&nbsp;<span class="ident" id="3757575">nat</span><span class="op" id="3757578">)</span>&nbsp;<span class="ident" id="3757580">setWord</span><span class="op" id="3757587">(</span><span class="ident" id="3757588">x</span>&nbsp;<span class="ident" id="3757590">Word</span><span class="op" id="3757594">)</span>&nbsp;<span class="ident" id="3757596">nat</span>&nbsp;<span class="op" id="3757600">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757603">if</span>&nbsp;<span class="ident" id="3757606">x</span>&nbsp;<span class="op" id="3757608">==</span>&nbsp;<span class="num" id="3757611">0</span>&nbsp;<span class="op" id="3757613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757617">return</span>&nbsp;<span class="ident" id="3757624">z</span><span class="op" id="3757625">.</span><span class="builtinfunc" id="3757626">make</span><span class="op" id="3757630">(</span><span class="num" id="3757631">0</span><span class="op" id="3757632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3757635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3757638">z</span>&nbsp;<span class="op" id="3757640">=</span>&nbsp;<span class="ident" id="3757642">z</span><span class="op" id="3757643">.</span><span class="builtinfunc" id="3757644">make</span><span class="op" id="3757648">(</span><span class="num" id="3757649">1</span><span class="op" id="3757650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3757653">z</span><span class="op" id="3757654">[</span><span class="num" id="3757655">0</span><span class="op" id="3757656">]</span>&nbsp;<span class="op" id="3757658">=</span>&nbsp;<span class="ident" id="3757660">x</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757663">return</span>&nbsp;<span class="ident" id="3757670">z</span><br>
<span class="lineno"></span><span class="op" id="3757672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3757675">func</span>&nbsp;<span class="op" id="3757680">(</span><span class="ident" id="3757681">z</span>&nbsp;<span class="ident" id="3757683">nat</span><span class="op" id="3757686">)</span>&nbsp;<span class="ident" id="3757688">setUint64</span><span class="op" id="3757697">(</span><span class="ident" id="3757698">x</span>&nbsp;<span class="ident" id="3757700">uint64</span><span class="op" id="3757706">)</span>&nbsp;<span class="ident" id="3757708">nat</span>&nbsp;<span class="op" id="3757712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3757715">//&nbsp;single-digit&nbsp;values</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757739">if</span>&nbsp;<span class="ident" id="3757742">w</span>&nbsp;<span class="op" id="3757744">:=</span>&nbsp;<span class="ident" id="3757747">Word</span><span class="op" id="3757751">(</span><span class="ident" id="3757752">x</span><span class="op" id="3757753">)</span><span class="op" id="3757754">;</span>&nbsp;<span class="ident" id="3757756">uint64</span><span class="op" id="3757762">(</span><span class="ident" id="3757763">w</span><span class="op" id="3757764">)</span>&nbsp;<span class="op" id="3757766">==</span>&nbsp;<span class="ident" id="3757769">x</span>&nbsp;<span class="op" id="3757771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757775">return</span>&nbsp;<span class="ident" id="3757782">z</span><span class="op" id="3757783">.</span><span class="ident" id="3757784">setWord</span><span class="op" id="3757791">(</span><span class="ident" id="3757792">w</span><span class="op" id="3757793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3757796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3757800">//&nbsp;compute&nbsp;number&nbsp;of&nbsp;words&nbsp;n&nbsp;required&nbsp;to&nbsp;represent&nbsp;x</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3757854">n</span>&nbsp;<span class="op" id="3757856">:=</span>&nbsp;<span class="num" id="3757859">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757862">for</span>&nbsp;<span class="ident" id="3757866">t</span>&nbsp;<span class="op" id="3757868">:=</span>&nbsp;<span class="ident" id="3757871">x</span><span class="op" id="3757872">;</span>&nbsp;<span class="ident" id="3757874">t</span>&nbsp;<span class="op" id="3757876">&gt;</span>&nbsp;<span class="num" id="3757878">0</span><span class="op" id="3757879">;</span>&nbsp;<span class="ident" id="3757881">t</span>&nbsp;<span class="op" id="3757883">&gt;&gt;=</span>&nbsp;<span class="ident" id="3757887">_W</span>&nbsp;<span class="op" id="3757890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3757894">n</span><span class="op" id="3757895">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3757899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3757903">//&nbsp;split&nbsp;x&nbsp;into&nbsp;n&nbsp;words</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3757928">z</span>&nbsp;<span class="op" id="3757930">=</span>&nbsp;<span class="ident" id="3757932">z</span><span class="op" id="3757933">.</span><span class="builtinfunc" id="3757934">make</span><span class="op" id="3757938">(</span><span class="ident" id="3757939">n</span><span class="op" id="3757940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757943">for</span>&nbsp;<span class="ident" id="3757947">i</span>&nbsp;<span class="op" id="3757949">:=</span>&nbsp;<span class="keyword" id="3757952">range</span>&nbsp;<span class="ident" id="3757958">z</span>&nbsp;<span class="op" id="3757960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3757964">z</span><span class="op" id="3757965">[</span><span class="ident" id="3757966">i</span><span class="op" id="3757967">]</span>&nbsp;<span class="op" id="3757969">=</span>&nbsp;<span class="ident" id="3757971">Word</span><span class="op" id="3757975">(</span><span class="ident" id="3757976">x</span>&nbsp;<span class="op" id="3757978">&amp;</span>&nbsp;<span class="ident" id="3757980">_M</span><span class="op" id="3757982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3757986">x</span>&nbsp;<span class="op" id="3757988">&gt;&gt;=</span>&nbsp;<span class="ident" id="3757992">_W</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3757996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758000">return</span>&nbsp;<span class="ident" id="3758007">z</span><br>
<span class="lineno"></span><span class="op" id="3758009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="3758012">func</span>&nbsp;<span class="op" id="3758017">(</span><span class="ident" id="3758018">z</span>&nbsp;<span class="ident" id="3758020">nat</span><span class="op" id="3758023">)</span>&nbsp;<span class="ident" id="3758025">set</span><span class="op" id="3758028">(</span><span class="ident" id="3758029">x</span>&nbsp;<span class="ident" id="3758031">nat</span><span class="op" id="3758034">)</span>&nbsp;<span class="ident" id="3758036">nat</span>&nbsp;<span class="op" id="3758040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3758043">z</span>&nbsp;<span class="op" id="3758045">=</span>&nbsp;<span class="ident" id="3758047">z</span><span class="op" id="3758048">.</span><span class="builtinfunc" id="3758049">make</span><span class="op" id="3758053">(</span><span class="builtinfunc" id="3758054">len</span><span class="op" id="3758057">(</span><span class="ident" id="3758058">x</span><span class="op" id="3758059">)</span><span class="op" id="3758060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3758063">copy</span><span class="op" id="3758067">(</span><span class="ident" id="3758068">z</span><span class="op" id="3758069">,</span>&nbsp;<span class="ident" id="3758071">x</span><span class="op" id="3758072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758075">return</span>&nbsp;<span class="ident" id="3758082">z</span><br>
<span class="lineno"></span><span class="op" id="3758084">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="3758087">func</span>&nbsp;<span class="op" id="3758092">(</span><span class="ident" id="3758093">z</span>&nbsp;<span class="ident" id="3758095">nat</span><span class="op" id="3758098">)</span>&nbsp;<span class="ident" id="3758100">add</span><span class="op" id="3758103">(</span><span class="ident" id="3758104">x</span><span class="op" id="3758105">,</span>&nbsp;<span class="ident" id="3758107">y</span>&nbsp;<span class="ident" id="3758109">nat</span><span class="op" id="3758112">)</span>&nbsp;<span class="ident" id="3758114">nat</span>&nbsp;<span class="op" id="3758118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3758121">m</span>&nbsp;<span class="op" id="3758123">:=</span>&nbsp;<span class="builtinfunc" id="3758126">len</span><span class="op" id="3758129">(</span><span class="ident" id="3758130">x</span><span class="op" id="3758131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3758134">n</span>&nbsp;<span class="op" id="3758136">:=</span>&nbsp;<span class="builtinfunc" id="3758139">len</span><span class="op" id="3758142">(</span><span class="ident" id="3758143">y</span><span class="op" id="3758144">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758148">switch</span>&nbsp;<span class="op" id="3758155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758158">case</span>&nbsp;<span class="ident" id="3758163">m</span>&nbsp;<span class="op" id="3758165">&lt;</span>&nbsp;<span class="ident" id="3758167">n</span><span class="op" id="3758168">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758172">return</span>&nbsp;<span class="ident" id="3758179">z</span><span class="op" id="3758180">.</span><span class="ident" id="3758181">add</span><span class="op" id="3758184">(</span><span class="ident" id="3758185">y</span><span class="op" id="3758186">,</span>&nbsp;<span class="ident" id="3758188">x</span><span class="op" id="3758189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758192">case</span>&nbsp;<span class="ident" id="3758197">m</span>&nbsp;<span class="op" id="3758199">==</span>&nbsp;<span class="num" id="3758202">0</span><span class="op" id="3758203">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3758207">//&nbsp;n&nbsp;==&nbsp;0&nbsp;because&nbsp;m&nbsp;&gt;=&nbsp;n;&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758247">return</span>&nbsp;<span class="ident" id="3758254">z</span><span class="op" id="3758255">.</span><span class="builtinfunc" id="3758256">make</span><span class="op" id="3758260">(</span><span class="num" id="3758261">0</span><span class="op" id="3758262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758265">case</span>&nbsp;<span class="ident" id="3758270">n</span>&nbsp;<span class="op" id="3758272">==</span>&nbsp;<span class="num" id="3758275">0</span><span class="op" id="3758276">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3758280">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758297">return</span>&nbsp;<span class="ident" id="3758304">z</span><span class="op" id="3758305">.</span><span class="ident" id="3758306">set</span><span class="op" id="3758309">(</span><span class="ident" id="3758310">x</span><span class="op" id="3758311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3758314">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3758317">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3758328">z</span>&nbsp;<span class="op" id="3758330">=</span>&nbsp;<span class="ident" id="3758332">z</span><span class="op" id="3758333">.</span><span class="builtinfunc" id="3758334">make</span><span class="op" id="3758338">(</span><span class="ident" id="3758339">m</span>&nbsp;<span class="op" id="3758341">+</span>&nbsp;<span class="num" id="3758343">1</span><span class="op" id="3758344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3758347">c</span>&nbsp;<span class="op" id="3758349">:=</span>&nbsp;<span class="ident" id="3758352">addVV</span><span class="op" id="3758357">(</span><span class="ident" id="3758358">z</span><span class="op" id="3758359">[</span><span class="num" id="3758360">0</span><span class="op" id="3758361">:</span><span class="ident" id="3758362">n</span><span class="op" id="3758363">]</span><span class="op" id="3758364">,</span>&nbsp;<span class="ident" id="3758366">x</span><span class="op" id="3758367">,</span>&nbsp;<span class="ident" id="3758369">y</span><span class="op" id="3758370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758373">if</span>&nbsp;<span class="ident" id="3758376">m</span>&nbsp;<span class="op" id="3758378">&gt;</span>&nbsp;<span class="ident" id="3758380">n</span>&nbsp;<span class="op" id="3758382">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3758386">c</span>&nbsp;<span class="op" id="3758388">=</span>&nbsp;<span class="ident" id="3758390">addVW</span><span class="op" id="3758395">(</span><span class="ident" id="3758396">z</span><span class="op" id="3758397">[</span><span class="ident" id="3758398">n</span><span class="op" id="3758399">:</span><span class="ident" id="3758400">m</span><span class="op" id="3758401">]</span><span class="op" id="3758402">,</span>&nbsp;<span class="ident" id="3758404">x</span><span class="op" id="3758405">[</span><span class="ident" id="3758406">n</span><span class="op" id="3758407">:</span><span class="op" id="3758408">]</span><span class="op" id="3758409">,</span>&nbsp;<span class="ident" id="3758411">c</span><span class="op" id="3758412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3758415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3758418">z</span><span class="op" id="3758419">[</span><span class="ident" id="3758420">m</span><span class="op" id="3758421">]</span>&nbsp;<span class="op" id="3758423">=</span>&nbsp;<span class="ident" id="3758425">c</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758429">return</span>&nbsp;<span class="ident" id="3758436">z</span><span class="op" id="3758437">.</span><span class="ident" id="3758438">norm</span><span class="op" id="3758442">(</span><span class="op" id="3758443">)</span><br>
<span class="lineno">140</span><span class="op" id="3758445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3758448">func</span>&nbsp;<span class="op" id="3758453">(</span><span class="ident" id="3758454">z</span>&nbsp;<span class="ident" id="3758456">nat</span><span class="op" id="3758459">)</span>&nbsp;<span class="ident" id="3758461">sub</span><span class="op" id="3758464">(</span><span class="ident" id="3758465">x</span><span class="op" id="3758466">,</span>&nbsp;<span class="ident" id="3758468">y</span>&nbsp;<span class="ident" id="3758470">nat</span><span class="op" id="3758473">)</span>&nbsp;<span class="ident" id="3758475">nat</span>&nbsp;<span class="op" id="3758479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3758482">m</span>&nbsp;<span class="op" id="3758484">:=</span>&nbsp;<span class="builtinfunc" id="3758487">len</span><span class="op" id="3758490">(</span><span class="ident" id="3758491">x</span><span class="op" id="3758492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3758495">n</span>&nbsp;<span class="op" id="3758497">:=</span>&nbsp;<span class="builtinfunc" id="3758500">len</span><span class="op" id="3758503">(</span><span class="ident" id="3758504">y</span><span class="op" id="3758505">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758509">switch</span>&nbsp;<span class="op" id="3758516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758519">case</span>&nbsp;<span class="ident" id="3758524">m</span>&nbsp;<span class="op" id="3758526">&lt;</span>&nbsp;<span class="ident" id="3758528">n</span><span class="op" id="3758529">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3758533">panic</span><span class="op" id="3758538">(</span><span class="string" id="3758539">&#34;underflow&#34;</span><span class="op" id="3758550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758553">case</span>&nbsp;<span class="ident" id="3758558">m</span>&nbsp;<span class="op" id="3758560">==</span>&nbsp;<span class="num" id="3758563">0</span><span class="op" id="3758564">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3758568">//&nbsp;n&nbsp;==&nbsp;0&nbsp;because&nbsp;m&nbsp;&gt;=&nbsp;n;&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758608">return</span>&nbsp;<span class="ident" id="3758615">z</span><span class="op" id="3758616">.</span><span class="builtinfunc" id="3758617">make</span><span class="op" id="3758621">(</span><span class="num" id="3758622">0</span><span class="op" id="3758623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758626">case</span>&nbsp;<span class="ident" id="3758631">n</span>&nbsp;<span class="op" id="3758633">==</span>&nbsp;<span class="num" id="3758636">0</span><span class="op" id="3758637">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3758641">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758658">return</span>&nbsp;<span class="ident" id="3758665">z</span><span class="op" id="3758666">.</span><span class="ident" id="3758667">set</span><span class="op" id="3758670">(</span><span class="ident" id="3758671">x</span><span class="op" id="3758672">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3758675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3758678">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3758689">z</span>&nbsp;<span class="op" id="3758691">=</span>&nbsp;<span class="ident" id="3758693">z</span><span class="op" id="3758694">.</span><span class="builtinfunc" id="3758695">make</span><span class="op" id="3758699">(</span><span class="ident" id="3758700">m</span><span class="op" id="3758701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3758704">c</span>&nbsp;<span class="op" id="3758706">:=</span>&nbsp;<span class="ident" id="3758709">subVV</span><span class="op" id="3758714">(</span><span class="ident" id="3758715">z</span><span class="op" id="3758716">[</span><span class="num" id="3758717">0</span><span class="op" id="3758718">:</span><span class="ident" id="3758719">n</span><span class="op" id="3758720">]</span><span class="op" id="3758721">,</span>&nbsp;<span class="ident" id="3758723">x</span><span class="op" id="3758724">,</span>&nbsp;<span class="ident" id="3758726">y</span><span class="op" id="3758727">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758730">if</span>&nbsp;<span class="ident" id="3758733">m</span>&nbsp;<span class="op" id="3758735">&gt;</span>&nbsp;<span class="ident" id="3758737">n</span>&nbsp;<span class="op" id="3758739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3758743">c</span>&nbsp;<span class="op" id="3758745">=</span>&nbsp;<span class="ident" id="3758747">subVW</span><span class="op" id="3758752">(</span><span class="ident" id="3758753">z</span><span class="op" id="3758754">[</span><span class="ident" id="3758755">n</span><span class="op" id="3758756">:</span><span class="op" id="3758757">]</span><span class="op" id="3758758">,</span>&nbsp;<span class="ident" id="3758760">x</span><span class="op" id="3758761">[</span><span class="ident" id="3758762">n</span><span class="op" id="3758763">:</span><span class="op" id="3758764">]</span><span class="op" id="3758765">,</span>&nbsp;<span class="ident" id="3758767">c</span><span class="op" id="3758768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3758771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758774">if</span>&nbsp;<span class="ident" id="3758777">c</span>&nbsp;<span class="op" id="3758779">!=</span>&nbsp;<span class="num" id="3758782">0</span>&nbsp;<span class="op" id="3758784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3758788">panic</span><span class="op" id="3758793">(</span><span class="string" id="3758794">&#34;underflow&#34;</span><span class="op" id="3758805">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3758808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758812">return</span>&nbsp;<span class="ident" id="3758819">z</span><span class="op" id="3758820">.</span><span class="ident" id="3758821">norm</span><span class="op" id="3758825">(</span><span class="op" id="3758826">)</span><br>
<span class="lineno"></span><span class="op" id="3758828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="3758831">func</span>&nbsp;<span class="op" id="3758836">(</span><span class="ident" id="3758837">x</span>&nbsp;<span class="ident" id="3758839">nat</span><span class="op" id="3758842">)</span>&nbsp;<span class="ident" id="3758844">cmp</span><span class="op" id="3758847">(</span><span class="ident" id="3758848">y</span>&nbsp;<span class="ident" id="3758850">nat</span><span class="op" id="3758853">)</span>&nbsp;<span class="op" id="3758855">(</span><span class="ident" id="3758856">r</span>&nbsp;<span class="builtintype" id="3758858">int</span><span class="op" id="3758861">)</span>&nbsp;<span class="op" id="3758863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3758866">m</span>&nbsp;<span class="op" id="3758868">:=</span>&nbsp;<span class="builtinfunc" id="3758871">len</span><span class="op" id="3758874">(</span><span class="ident" id="3758875">x</span><span class="op" id="3758876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3758879">n</span>&nbsp;<span class="op" id="3758881">:=</span>&nbsp;<span class="builtinfunc" id="3758884">len</span><span class="op" id="3758887">(</span><span class="ident" id="3758888">y</span><span class="op" id="3758889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758892">if</span>&nbsp;<span class="ident" id="3758895">m</span>&nbsp;<span class="op" id="3758897">!=</span>&nbsp;<span class="ident" id="3758900">n</span>&nbsp;<span class="op" id="3758902">||</span>&nbsp;<span class="ident" id="3758905">m</span>&nbsp;<span class="op" id="3758907">==</span>&nbsp;<span class="num" id="3758910">0</span>&nbsp;<span class="op" id="3758912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758916">switch</span>&nbsp;<span class="op" id="3758923">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758927">case</span>&nbsp;<span class="ident" id="3758932">m</span>&nbsp;<span class="op" id="3758934">&lt;</span>&nbsp;<span class="ident" id="3758936">n</span><span class="op" id="3758937">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3758942">r</span>&nbsp;<span class="op" id="3758944">=</span>&nbsp;<span class="op" id="3758946">-</span><span class="num" id="3758947">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758951">case</span>&nbsp;<span class="ident" id="3758956">m</span>&nbsp;<span class="op" id="3758958">&gt;</span>&nbsp;<span class="ident" id="3758960">n</span><span class="op" id="3758961">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3758966">r</span>&nbsp;<span class="op" id="3758968">=</span>&nbsp;<span class="num" id="3758970">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3758974">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758978">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3758986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3758990">i</span>&nbsp;<span class="op" id="3758992">:=</span>&nbsp;<span class="ident" id="3758995">m</span>&nbsp;<span class="op" id="3758997">-</span>&nbsp;<span class="num" id="3758999">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759002">for</span>&nbsp;<span class="ident" id="3759006">i</span>&nbsp;<span class="op" id="3759008">&gt;</span>&nbsp;<span class="num" id="3759010">0</span>&nbsp;<span class="op" id="3759012">&amp;&amp;</span>&nbsp;<span class="ident" id="3759015">x</span><span class="op" id="3759016">[</span><span class="ident" id="3759017">i</span><span class="op" id="3759018">]</span>&nbsp;<span class="op" id="3759020">==</span>&nbsp;<span class="ident" id="3759023">y</span><span class="op" id="3759024">[</span><span class="ident" id="3759025">i</span><span class="op" id="3759026">]</span>&nbsp;<span class="op" id="3759028">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759032">i</span><span class="op" id="3759033">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3759037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759041">switch</span>&nbsp;<span class="op" id="3759048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759051">case</span>&nbsp;<span class="ident" id="3759056">x</span><span class="op" id="3759057">[</span><span class="ident" id="3759058">i</span><span class="op" id="3759059">]</span>&nbsp;<span class="op" id="3759061">&lt;</span>&nbsp;<span class="ident" id="3759063">y</span><span class="op" id="3759064">[</span><span class="ident" id="3759065">i</span><span class="op" id="3759066">]</span><span class="op" id="3759067">:</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759071">r</span>&nbsp;<span class="op" id="3759073">=</span>&nbsp;<span class="op" id="3759075">-</span><span class="num" id="3759076">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759079">case</span>&nbsp;<span class="ident" id="3759084">x</span><span class="op" id="3759085">[</span><span class="ident" id="3759086">i</span><span class="op" id="3759087">]</span>&nbsp;<span class="op" id="3759089">&gt;</span>&nbsp;<span class="ident" id="3759091">y</span><span class="op" id="3759092">[</span><span class="ident" id="3759093">i</span><span class="op" id="3759094">]</span><span class="op" id="3759095">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759099">r</span>&nbsp;<span class="op" id="3759101">=</span>&nbsp;<span class="num" id="3759103">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3759106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759109">return</span><br>
<span class="lineno">195</span><span class="op" id="3759116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3759119">func</span>&nbsp;<span class="op" id="3759124">(</span><span class="ident" id="3759125">z</span>&nbsp;<span class="ident" id="3759127">nat</span><span class="op" id="3759130">)</span>&nbsp;<span class="ident" id="3759132">mulAddWW</span><span class="op" id="3759140">(</span><span class="ident" id="3759141">x</span>&nbsp;<span class="ident" id="3759143">nat</span><span class="op" id="3759146">,</span>&nbsp;<span class="ident" id="3759148">y</span><span class="op" id="3759149">,</span>&nbsp;<span class="ident" id="3759151">r</span>&nbsp;<span class="ident" id="3759153">Word</span><span class="op" id="3759157">)</span>&nbsp;<span class="ident" id="3759159">nat</span>&nbsp;<span class="op" id="3759163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759166">m</span>&nbsp;<span class="op" id="3759168">:=</span>&nbsp;<span class="builtinfunc" id="3759171">len</span><span class="op" id="3759174">(</span><span class="ident" id="3759175">x</span><span class="op" id="3759176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759179">if</span>&nbsp;<span class="ident" id="3759182">m</span>&nbsp;<span class="op" id="3759184">==</span>&nbsp;<span class="num" id="3759187">0</span>&nbsp;<span class="op" id="3759189">||</span>&nbsp;<span class="ident" id="3759192">y</span>&nbsp;<span class="op" id="3759194">==</span>&nbsp;<span class="num" id="3759197">0</span>&nbsp;<span class="op" id="3759199">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759203">return</span>&nbsp;<span class="ident" id="3759210">z</span><span class="op" id="3759211">.</span><span class="ident" id="3759212">setWord</span><span class="op" id="3759219">(</span><span class="ident" id="3759220">r</span><span class="op" id="3759221">)</span>&nbsp;<span class="comment" id="3759223">//&nbsp;result&nbsp;is&nbsp;r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3759239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3759242">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759253">z</span>&nbsp;<span class="op" id="3759255">=</span>&nbsp;<span class="ident" id="3759257">z</span><span class="op" id="3759258">.</span><span class="builtinfunc" id="3759259">make</span><span class="op" id="3759263">(</span><span class="ident" id="3759264">m</span>&nbsp;<span class="op" id="3759266">+</span>&nbsp;<span class="num" id="3759268">1</span><span class="op" id="3759269">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759272">z</span><span class="op" id="3759273">[</span><span class="ident" id="3759274">m</span><span class="op" id="3759275">]</span>&nbsp;<span class="op" id="3759277">=</span>&nbsp;<span class="ident" id="3759279">mulAddVWW</span><span class="op" id="3759288">(</span><span class="ident" id="3759289">z</span><span class="op" id="3759290">[</span><span class="num" id="3759291">0</span><span class="op" id="3759292">:</span><span class="ident" id="3759293">m</span><span class="op" id="3759294">]</span><span class="op" id="3759295">,</span>&nbsp;<span class="ident" id="3759297">x</span><span class="op" id="3759298">,</span>&nbsp;<span class="ident" id="3759300">y</span><span class="op" id="3759301">,</span>&nbsp;<span class="ident" id="3759303">r</span><span class="op" id="3759304">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759308">return</span>&nbsp;<span class="ident" id="3759315">z</span><span class="op" id="3759316">.</span><span class="ident" id="3759317">norm</span><span class="op" id="3759321">(</span><span class="op" id="3759322">)</span><br>
<span class="lineno"></span><span class="op" id="3759324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="comment" id="3759327">//&nbsp;basicMul&nbsp;multiplies&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;leaves&nbsp;the&nbsp;result&nbsp;in&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="3759386">//&nbsp;The&nbsp;(non-normalized)&nbsp;result&nbsp;is&nbsp;placed&nbsp;in&nbsp;z[0&nbsp;:&nbsp;len(x)&nbsp;+&nbsp;len(y)].</span><br>
<span class="lineno"></span><span class="keyword" id="3759454">func</span>&nbsp;<span class="ident" id="3759459">basicMul</span><span class="op" id="3759467">(</span><span class="ident" id="3759468">z</span><span class="op" id="3759469">,</span>&nbsp;<span class="ident" id="3759471">x</span><span class="op" id="3759472">,</span>&nbsp;<span class="ident" id="3759474">y</span>&nbsp;<span class="ident" id="3759476">nat</span><span class="op" id="3759479">)</span>&nbsp;<span class="op" id="3759481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759484">z</span><span class="op" id="3759485">[</span><span class="num" id="3759486">0</span>&nbsp;<span class="op" id="3759488">:</span>&nbsp;<span class="builtinfunc" id="3759490">len</span><span class="op" id="3759493">(</span><span class="ident" id="3759494">x</span><span class="op" id="3759495">)</span><span class="op" id="3759496">+</span><span class="builtinfunc" id="3759497">len</span><span class="op" id="3759500">(</span><span class="ident" id="3759501">y</span><span class="op" id="3759502">)</span><span class="op" id="3759503">]</span><span class="op" id="3759504">.</span><span class="ident" id="3759505">clear</span><span class="op" id="3759510">(</span><span class="op" id="3759511">)</span>&nbsp;<span class="comment" id="3759513">//&nbsp;initialize&nbsp;z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759530">for</span>&nbsp;<span class="ident" id="3759534">i</span><span class="op" id="3759535">,</span>&nbsp;<span class="ident" id="3759537">d</span>&nbsp;<span class="op" id="3759539">:=</span>&nbsp;<span class="keyword" id="3759542">range</span>&nbsp;<span class="ident" id="3759548">y</span>&nbsp;<span class="op" id="3759550">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759554">if</span>&nbsp;<span class="ident" id="3759557">d</span>&nbsp;<span class="op" id="3759559">!=</span>&nbsp;<span class="num" id="3759562">0</span>&nbsp;<span class="op" id="3759564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759569">z</span><span class="op" id="3759570">[</span><span class="builtinfunc" id="3759571">len</span><span class="op" id="3759574">(</span><span class="ident" id="3759575">x</span><span class="op" id="3759576">)</span><span class="op" id="3759577">+</span><span class="ident" id="3759578">i</span><span class="op" id="3759579">]</span>&nbsp;<span class="op" id="3759581">=</span>&nbsp;<span class="ident" id="3759583">addMulVVW</span><span class="op" id="3759592">(</span><span class="ident" id="3759593">z</span><span class="op" id="3759594">[</span><span class="ident" id="3759595">i</span><span class="op" id="3759596">:</span><span class="ident" id="3759597">i</span><span class="op" id="3759598">+</span><span class="builtinfunc" id="3759599">len</span><span class="op" id="3759602">(</span><span class="ident" id="3759603">x</span><span class="op" id="3759604">)</span><span class="op" id="3759605">]</span><span class="op" id="3759606">,</span>&nbsp;<span class="ident" id="3759608">x</span><span class="op" id="3759609">,</span>&nbsp;<span class="ident" id="3759611">d</span><span class="op" id="3759612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3759616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3759619">}</span><br>
<span class="lineno"></span><span class="op" id="3759621">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="3759624">//&nbsp;Fast&nbsp;version&nbsp;of&nbsp;z[0:n+n&gt;&gt;1].add(z[0:n+n&gt;&gt;1],&nbsp;x[0:n])&nbsp;w/o&nbsp;bounds&nbsp;checks.</span><br>
<span class="lineno"></span><span class="comment" id="3759699">//&nbsp;Factored&nbsp;out&nbsp;for&nbsp;readability&nbsp;-&nbsp;do&nbsp;not&nbsp;use&nbsp;outside&nbsp;karatsuba.</span><br>
<span class="lineno"></span><span class="keyword" id="3759763">func</span>&nbsp;<span class="ident" id="3759768">karatsubaAdd</span><span class="op" id="3759780">(</span><span class="ident" id="3759781">z</span><span class="op" id="3759782">,</span>&nbsp;<span class="ident" id="3759784">x</span>&nbsp;<span class="ident" id="3759786">nat</span><span class="op" id="3759789">,</span>&nbsp;<span class="ident" id="3759791">n</span>&nbsp;<span class="builtintype" id="3759793">int</span><span class="op" id="3759796">)</span>&nbsp;<span class="op" id="3759798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759801">if</span>&nbsp;<span class="ident" id="3759804">c</span>&nbsp;<span class="op" id="3759806">:=</span>&nbsp;<span class="ident" id="3759809">addVV</span><span class="op" id="3759814">(</span><span class="ident" id="3759815">z</span><span class="op" id="3759816">[</span><span class="num" id="3759817">0</span><span class="op" id="3759818">:</span><span class="ident" id="3759819">n</span><span class="op" id="3759820">]</span><span class="op" id="3759821">,</span>&nbsp;<span class="ident" id="3759823">z</span><span class="op" id="3759824">,</span>&nbsp;<span class="ident" id="3759826">x</span><span class="op" id="3759827">)</span><span class="op" id="3759828">;</span>&nbsp;<span class="ident" id="3759830">c</span>&nbsp;<span class="op" id="3759832">!=</span>&nbsp;<span class="num" id="3759835">0</span>&nbsp;<span class="op" id="3759837">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759841">addVW</span><span class="op" id="3759846">(</span><span class="ident" id="3759847">z</span><span class="op" id="3759848">[</span><span class="ident" id="3759849">n</span><span class="op" id="3759850">:</span><span class="ident" id="3759851">n</span><span class="op" id="3759852">+</span><span class="ident" id="3759853">n</span><span class="op" id="3759854">&gt;&gt;</span><span class="num" id="3759856">1</span><span class="op" id="3759857">]</span><span class="op" id="3759858">,</span>&nbsp;<span class="ident" id="3759860">z</span><span class="op" id="3759861">[</span><span class="ident" id="3759862">n</span><span class="op" id="3759863">:</span><span class="op" id="3759864">]</span><span class="op" id="3759865">,</span>&nbsp;<span class="ident" id="3759867">c</span><span class="op" id="3759868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3759871">}</span><br>
<span class="lineno"></span><span class="op" id="3759873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3759876">//&nbsp;Like&nbsp;karatsubaAdd,&nbsp;but&nbsp;does&nbsp;subtract.</span><br>
<span class="lineno">230</span><span class="keyword" id="3759917">func</span>&nbsp;<span class="ident" id="3759922">karatsubaSub</span><span class="op" id="3759934">(</span><span class="ident" id="3759935">z</span><span class="op" id="3759936">,</span>&nbsp;<span class="ident" id="3759938">x</span>&nbsp;<span class="ident" id="3759940">nat</span><span class="op" id="3759943">,</span>&nbsp;<span class="ident" id="3759945">n</span>&nbsp;<span class="builtintype" id="3759947">int</span><span class="op" id="3759950">)</span>&nbsp;<span class="op" id="3759952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759955">if</span>&nbsp;<span class="ident" id="3759958">c</span>&nbsp;<span class="op" id="3759960">:=</span>&nbsp;<span class="ident" id="3759963">subVV</span><span class="op" id="3759968">(</span><span class="ident" id="3759969">z</span><span class="op" id="3759970">[</span><span class="num" id="3759971">0</span><span class="op" id="3759972">:</span><span class="ident" id="3759973">n</span><span class="op" id="3759974">]</span><span class="op" id="3759975">,</span>&nbsp;<span class="ident" id="3759977">z</span><span class="op" id="3759978">,</span>&nbsp;<span class="ident" id="3759980">x</span><span class="op" id="3759981">)</span><span class="op" id="3759982">;</span>&nbsp;<span class="ident" id="3759984">c</span>&nbsp;<span class="op" id="3759986">!=</span>&nbsp;<span class="num" id="3759989">0</span>&nbsp;<span class="op" id="3759991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759995">subVW</span><span class="op" id="3760000">(</span><span class="ident" id="3760001">z</span><span class="op" id="3760002">[</span><span class="ident" id="3760003">n</span><span class="op" id="3760004">:</span><span class="ident" id="3760005">n</span><span class="op" id="3760006">+</span><span class="ident" id="3760007">n</span><span class="op" id="3760008">&gt;&gt;</span><span class="num" id="3760010">1</span><span class="op" id="3760011">]</span><span class="op" id="3760012">,</span>&nbsp;<span class="ident" id="3760014">z</span><span class="op" id="3760015">[</span><span class="ident" id="3760016">n</span><span class="op" id="3760017">:</span><span class="op" id="3760018">]</span><span class="op" id="3760019">,</span>&nbsp;<span class="ident" id="3760021">c</span><span class="op" id="3760022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3760025">}</span><br>
<span class="lineno"></span><span class="op" id="3760027">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="3760030">//&nbsp;Operands&nbsp;that&nbsp;are&nbsp;shorter&nbsp;than&nbsp;karatsubaThreshold&nbsp;are&nbsp;multiplied&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="3760104">//&nbsp;&#34;grade&nbsp;school&#34;&nbsp;multiplication;&nbsp;for&nbsp;longer&nbsp;operands&nbsp;the&nbsp;Karatsuba&nbsp;algorithm</span><br>
<span class="lineno"></span><span class="comment" id="3760182">//&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="3760194">var</span>&nbsp;<span class="ident" id="3760198">karatsubaThreshold</span>&nbsp;<span class="builtintype" id="3760217">int</span>&nbsp;<span class="op" id="3760221">=</span>&nbsp;<span class="num" id="3760223">40</span>&nbsp;<span class="comment" id="3760226">//&nbsp;computed&nbsp;by&nbsp;calibrate.go</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="3760255">//&nbsp;karatsuba&nbsp;multiplies&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;leaves&nbsp;the&nbsp;result&nbsp;in&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="3760315">//&nbsp;Both&nbsp;x&nbsp;and&nbsp;y&nbsp;must&nbsp;have&nbsp;the&nbsp;same&nbsp;length&nbsp;n&nbsp;and&nbsp;n&nbsp;must&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3760375">//&nbsp;power&nbsp;of&nbsp;2.&nbsp;The&nbsp;result&nbsp;vector&nbsp;z&nbsp;must&nbsp;have&nbsp;len(z)&nbsp;&gt;=&nbsp;6*n.</span><br>
<span class="lineno"></span><span class="comment" id="3760435">//&nbsp;The&nbsp;(non-normalized)&nbsp;result&nbsp;is&nbsp;placed&nbsp;in&nbsp;z[0&nbsp;:&nbsp;2*n].</span><br>
<span class="lineno">245</span><span class="keyword" id="3760491">func</span>&nbsp;<span class="ident" id="3760496">karatsuba</span><span class="op" id="3760505">(</span><span class="ident" id="3760506">z</span><span class="op" id="3760507">,</span>&nbsp;<span class="ident" id="3760509">x</span><span class="op" id="3760510">,</span>&nbsp;<span class="ident" id="3760512">y</span>&nbsp;<span class="ident" id="3760514">nat</span><span class="op" id="3760517">)</span>&nbsp;<span class="op" id="3760519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760522">n</span>&nbsp;<span class="op" id="3760524">:=</span>&nbsp;<span class="builtinfunc" id="3760527">len</span><span class="op" id="3760530">(</span><span class="ident" id="3760531">y</span><span class="op" id="3760532">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3760536">//&nbsp;Switch&nbsp;to&nbsp;basic&nbsp;multiplication&nbsp;if&nbsp;numbers&nbsp;are&nbsp;odd&nbsp;or&nbsp;small.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3760600">//&nbsp;(n&nbsp;is&nbsp;always&nbsp;even&nbsp;if&nbsp;karatsubaThreshold&nbsp;is&nbsp;even,&nbsp;but&nbsp;be</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3760660">//&nbsp;conservative)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760678">if</span>&nbsp;<span class="ident" id="3760681">n</span><span class="op" id="3760682">&amp;</span><span class="num" id="3760683">1</span>&nbsp;<span class="op" id="3760685">!=</span>&nbsp;<span class="num" id="3760688">0</span>&nbsp;<span class="op" id="3760690">||</span>&nbsp;<span class="ident" id="3760693">n</span>&nbsp;<span class="op" id="3760695">&lt;</span>&nbsp;<span class="ident" id="3760697">karatsubaThreshold</span>&nbsp;<span class="op" id="3760716">||</span>&nbsp;<span class="ident" id="3760719">n</span>&nbsp;<span class="op" id="3760721">&lt;</span>&nbsp;<span class="num" id="3760723">2</span>&nbsp;<span class="op" id="3760725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760729">basicMul</span><span class="op" id="3760737">(</span><span class="ident" id="3760738">z</span><span class="op" id="3760739">,</span>&nbsp;<span class="ident" id="3760741">x</span><span class="op" id="3760742">,</span>&nbsp;<span class="ident" id="3760744">y</span><span class="op" id="3760745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760749">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3760757">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3760760">//&nbsp;n&amp;1&nbsp;==&nbsp;0&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;karatsubaThreshold&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3760811">//&nbsp;Karatsuba&nbsp;multiplication&nbsp;is&nbsp;based&nbsp;on&nbsp;the&nbsp;observation&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3760873">//&nbsp;for&nbsp;two&nbsp;numbers&nbsp;x&nbsp;and&nbsp;y&nbsp;with:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3760907">//</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3760911">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;x1*b&nbsp;+&nbsp;x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3760931">//&nbsp;&nbsp;&nbsp;y&nbsp;=&nbsp;y1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3760951">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3760955">//&nbsp;the&nbsp;product&nbsp;x*y&nbsp;can&nbsp;be&nbsp;obtained&nbsp;with&nbsp;3&nbsp;products&nbsp;z2,&nbsp;z1,&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3761018">//&nbsp;instead&nbsp;of&nbsp;4:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3761036">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3761040">//&nbsp;&nbsp;&nbsp;x*y&nbsp;=&nbsp;x1*y1*b*b&nbsp;+&nbsp;(x1*y0&nbsp;+&nbsp;x0*y1)*b&nbsp;+&nbsp;x0*y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3761090">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;z2*b*b&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;z1*b&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3761140">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3761144">//&nbsp;with:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3761154">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3761158">//&nbsp;&nbsp;&nbsp;xd&nbsp;=&nbsp;x1&nbsp;-&nbsp;x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3761177">//&nbsp;&nbsp;&nbsp;yd&nbsp;=&nbsp;y0&nbsp;-&nbsp;y1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3761196">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3761200">//&nbsp;&nbsp;&nbsp;z1&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xd*yd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3761251">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;(x1-x0)*(y0&nbsp;-&nbsp;y1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3761302">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;-&nbsp;x1*y1&nbsp;-&nbsp;x0*y0&nbsp;+&nbsp;x0*y1&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3761353">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;z2&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;z0&nbsp;+&nbsp;x0*y1&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3761404">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;x0*y1</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3761446">//&nbsp;split&nbsp;x,&nbsp;y&nbsp;into&nbsp;&#34;digits&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3761475">n2</span>&nbsp;<span class="op" id="3761478">:=</span>&nbsp;<span class="ident" id="3761481">n</span>&nbsp;<span class="op" id="3761483">&gt;&gt;</span>&nbsp;<span class="num" id="3761486">1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3761501">//&nbsp;n2&nbsp;&gt;=&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3761513">x1</span><span class="op" id="3761515">,</span>&nbsp;<span class="ident" id="3761517">x0</span>&nbsp;<span class="op" id="3761520">:=</span>&nbsp;<span class="ident" id="3761523">x</span><span class="op" id="3761524">[</span><span class="ident" id="3761525">n2</span><span class="op" id="3761527">:</span><span class="op" id="3761528">]</span><span class="op" id="3761529">,</span>&nbsp;<span class="ident" id="3761531">x</span><span class="op" id="3761532">[</span><span class="num" id="3761533">0</span><span class="op" id="3761534">:</span><span class="ident" id="3761535">n2</span><span class="op" id="3761537">]</span>&nbsp;<span class="comment" id="3761539">//&nbsp;x&nbsp;=&nbsp;x1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3761557">y1</span><span class="op" id="3761559">,</span>&nbsp;<span class="ident" id="3761561">y0</span>&nbsp;<span class="op" id="3761564">:=</span>&nbsp;<span class="ident" id="3761567">y</span><span class="op" id="3761568">[</span><span class="ident" id="3761569">n2</span><span class="op" id="3761571">:</span><span class="op" id="3761572">]</span><span class="op" id="3761573">,</span>&nbsp;<span class="ident" id="3761575">y</span><span class="op" id="3761576">[</span><span class="num" id="3761577">0</span><span class="op" id="3761578">:</span><span class="ident" id="3761579">n2</span><span class="op" id="3761581">]</span>&nbsp;<span class="comment" id="3761583">//&nbsp;y&nbsp;=&nbsp;y1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3761602">//&nbsp;z&nbsp;is&nbsp;used&nbsp;for&nbsp;the&nbsp;result&nbsp;and&nbsp;temporary&nbsp;storage:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3761654">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3761658">//&nbsp;&nbsp;&nbsp;6*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0*n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3761716">//&nbsp;z&nbsp;=&nbsp;[z2&nbsp;copy|z0&nbsp;copy|&nbsp;xd*yd&nbsp;|&nbsp;yd:xd&nbsp;|&nbsp;x1*y1&nbsp;|&nbsp;x0*y0&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3761774">//</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3761778">//&nbsp;For&nbsp;each&nbsp;recursive&nbsp;call&nbsp;of&nbsp;karatsuba,&nbsp;an&nbsp;unused&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3761839">//&nbsp;z&nbsp;is&nbsp;passed&nbsp;in&nbsp;that&nbsp;has&nbsp;(at&nbsp;least)&nbsp;half&nbsp;the&nbsp;length&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3761901">//&nbsp;caller&#39;s&nbsp;z.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3761918">//&nbsp;compute&nbsp;z0&nbsp;and&nbsp;z2&nbsp;with&nbsp;the&nbsp;result&nbsp;&#34;in&nbsp;place&#34;&nbsp;in&nbsp;z</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3761972">karatsuba</span><span class="op" id="3761981">(</span><span class="ident" id="3761982">z</span><span class="op" id="3761983">,</span>&nbsp;<span class="ident" id="3761985">x0</span><span class="op" id="3761987">,</span>&nbsp;<span class="ident" id="3761989">y0</span><span class="op" id="3761991">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3761997">//&nbsp;z0&nbsp;=&nbsp;x0*y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3762012">karatsuba</span><span class="op" id="3762021">(</span><span class="ident" id="3762022">z</span><span class="op" id="3762023">[</span><span class="ident" id="3762024">n</span><span class="op" id="3762025">:</span><span class="op" id="3762026">]</span><span class="op" id="3762027">,</span>&nbsp;<span class="ident" id="3762029">x1</span><span class="op" id="3762031">,</span>&nbsp;<span class="ident" id="3762033">y1</span><span class="op" id="3762035">)</span>&nbsp;<span class="comment" id="3762037">//&nbsp;z2&nbsp;=&nbsp;x1*y1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3762053">//&nbsp;compute&nbsp;xd&nbsp;(or&nbsp;the&nbsp;negative&nbsp;value&nbsp;if&nbsp;underflow&nbsp;occurs)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3762112">s</span>&nbsp;<span class="op" id="3762114">:=</span>&nbsp;<span class="num" id="3762117">1</span>&nbsp;<span class="comment" id="3762119">//&nbsp;sign&nbsp;of&nbsp;product&nbsp;xd*yd</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3762145">xd</span>&nbsp;<span class="op" id="3762148">:=</span>&nbsp;<span class="ident" id="3762151">z</span><span class="op" id="3762152">[</span><span class="num" id="3762153">2</span><span class="op" id="3762154">*</span><span class="ident" id="3762155">n</span>&nbsp;<span class="op" id="3762157">:</span>&nbsp;<span class="num" id="3762159">2</span><span class="op" id="3762160">*</span><span class="ident" id="3762161">n</span><span class="op" id="3762162">+</span><span class="ident" id="3762163">n2</span><span class="op" id="3762165">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3762168">if</span>&nbsp;<span class="ident" id="3762171">subVV</span><span class="op" id="3762176">(</span><span class="ident" id="3762177">xd</span><span class="op" id="3762179">,</span>&nbsp;<span class="ident" id="3762181">x1</span><span class="op" id="3762183">,</span>&nbsp;<span class="ident" id="3762185">x0</span><span class="op" id="3762187">)</span>&nbsp;<span class="op" id="3762189">!=</span>&nbsp;<span class="num" id="3762192">0</span>&nbsp;<span class="op" id="3762194">{</span>&nbsp;<span class="comment" id="3762196">//&nbsp;x1-x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3762207">s</span>&nbsp;<span class="op" id="3762209">=</span>&nbsp;<span class="op" id="3762211">-</span><span class="ident" id="3762212">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3762216">subVV</span><span class="op" id="3762221">(</span><span class="ident" id="3762222">xd</span><span class="op" id="3762224">,</span>&nbsp;<span class="ident" id="3762226">x0</span><span class="op" id="3762228">,</span>&nbsp;<span class="ident" id="3762230">x1</span><span class="op" id="3762232">)</span>&nbsp;<span class="comment" id="3762234">//&nbsp;x0-x1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3762244">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3762248">//&nbsp;compute&nbsp;yd&nbsp;(or&nbsp;the&nbsp;negative&nbsp;value&nbsp;if&nbsp;underflow&nbsp;occurs)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3762307">yd</span>&nbsp;<span class="op" id="3762310">:=</span>&nbsp;<span class="ident" id="3762313">z</span><span class="op" id="3762314">[</span><span class="num" id="3762315">2</span><span class="op" id="3762316">*</span><span class="ident" id="3762317">n</span><span class="op" id="3762318">+</span><span class="ident" id="3762319">n2</span>&nbsp;<span class="op" id="3762322">:</span>&nbsp;<span class="num" id="3762324">3</span><span class="op" id="3762325">*</span><span class="ident" id="3762326">n</span><span class="op" id="3762327">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3762330">if</span>&nbsp;<span class="ident" id="3762333">subVV</span><span class="op" id="3762338">(</span><span class="ident" id="3762339">yd</span><span class="op" id="3762341">,</span>&nbsp;<span class="ident" id="3762343">y0</span><span class="op" id="3762345">,</span>&nbsp;<span class="ident" id="3762347">y1</span><span class="op" id="3762349">)</span>&nbsp;<span class="op" id="3762351">!=</span>&nbsp;<span class="num" id="3762354">0</span>&nbsp;<span class="op" id="3762356">{</span>&nbsp;<span class="comment" id="3762358">//&nbsp;y0-y1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3762369">s</span>&nbsp;<span class="op" id="3762371">=</span>&nbsp;<span class="op" id="3762373">-</span><span class="ident" id="3762374">s</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3762378">subVV</span><span class="op" id="3762383">(</span><span class="ident" id="3762384">yd</span><span class="op" id="3762386">,</span>&nbsp;<span class="ident" id="3762388">y1</span><span class="op" id="3762390">,</span>&nbsp;<span class="ident" id="3762392">y0</span><span class="op" id="3762394">)</span>&nbsp;<span class="comment" id="3762396">//&nbsp;y1-y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3762406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3762410">//&nbsp;p&nbsp;=&nbsp;(x1-x0)*(y0-y1)&nbsp;==&nbsp;x1*y0&nbsp;-&nbsp;x1*y1&nbsp;-&nbsp;x0*y0&nbsp;+&nbsp;x0*y1&nbsp;for&nbsp;s&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3762477">//&nbsp;p&nbsp;=&nbsp;(x0-x1)*(y0-y1)&nbsp;==&nbsp;x0*y0&nbsp;-&nbsp;x0*y1&nbsp;-&nbsp;x1*y0&nbsp;+&nbsp;x1*y1&nbsp;for&nbsp;s&nbsp;&lt;&nbsp;0</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3762544">p</span>&nbsp;<span class="op" id="3762546">:=</span>&nbsp;<span class="ident" id="3762549">z</span><span class="op" id="3762550">[</span><span class="ident" id="3762551">n</span><span class="op" id="3762552">*</span><span class="num" id="3762553">3</span><span class="op" id="3762554">:</span><span class="op" id="3762555">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3762558">karatsuba</span><span class="op" id="3762567">(</span><span class="ident" id="3762568">p</span><span class="op" id="3762569">,</span>&nbsp;<span class="ident" id="3762571">xd</span><span class="op" id="3762573">,</span>&nbsp;<span class="ident" id="3762575">yd</span><span class="op" id="3762577">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3762581">//&nbsp;save&nbsp;original&nbsp;z2:z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3762605">//&nbsp;(ok&nbsp;to&nbsp;use&nbsp;upper&nbsp;half&nbsp;of&nbsp;z&nbsp;since&nbsp;we&#39;re&nbsp;done&nbsp;recursing)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3762664">r</span>&nbsp;<span class="op" id="3762666">:=</span>&nbsp;<span class="ident" id="3762669">z</span><span class="op" id="3762670">[</span><span class="ident" id="3762671">n</span><span class="op" id="3762672">*</span><span class="num" id="3762673">4</span><span class="op" id="3762674">:</span><span class="op" id="3762675">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3762678">copy</span><span class="op" id="3762682">(</span><span class="ident" id="3762683">r</span><span class="op" id="3762684">,</span>&nbsp;<span class="ident" id="3762686">z</span><span class="op" id="3762687">[</span><span class="op" id="3762688">:</span><span class="ident" id="3762689">n</span><span class="op" id="3762690">*</span><span class="num" id="3762691">2</span><span class="op" id="3762692">]</span><span class="op" id="3762693">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3762697">//&nbsp;add&nbsp;up&nbsp;all&nbsp;partial&nbsp;products</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3762729">//</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3762733">//&nbsp;&nbsp;&nbsp;2*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3762755">//&nbsp;z&nbsp;=&nbsp;[&nbsp;z2&nbsp;&nbsp;|&nbsp;z0&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3762777">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;z0&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3762796">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;z2&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3762815">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;&nbsp;p&nbsp;&nbsp;]</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3762834">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3762838">karatsubaAdd</span><span class="op" id="3762850">(</span><span class="ident" id="3762851">z</span><span class="op" id="3762852">[</span><span class="ident" id="3762853">n2</span><span class="op" id="3762855">:</span><span class="op" id="3762856">]</span><span class="op" id="3762857">,</span>&nbsp;<span class="ident" id="3762859">r</span><span class="op" id="3762860">,</span>&nbsp;<span class="ident" id="3762862">n</span><span class="op" id="3762863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3762866">karatsubaAdd</span><span class="op" id="3762878">(</span><span class="ident" id="3762879">z</span><span class="op" id="3762880">[</span><span class="ident" id="3762881">n2</span><span class="op" id="3762883">:</span><span class="op" id="3762884">]</span><span class="op" id="3762885">,</span>&nbsp;<span class="ident" id="3762887">r</span><span class="op" id="3762888">[</span><span class="ident" id="3762889">n</span><span class="op" id="3762890">:</span><span class="op" id="3762891">]</span><span class="op" id="3762892">,</span>&nbsp;<span class="ident" id="3762894">n</span><span class="op" id="3762895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3762898">if</span>&nbsp;<span class="ident" id="3762901">s</span>&nbsp;<span class="op" id="3762903">&gt;</span>&nbsp;<span class="num" id="3762905">0</span>&nbsp;<span class="op" id="3762907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3762911">karatsubaAdd</span><span class="op" id="3762923">(</span><span class="ident" id="3762924">z</span><span class="op" id="3762925">[</span><span class="ident" id="3762926">n2</span><span class="op" id="3762928">:</span><span class="op" id="3762929">]</span><span class="op" id="3762930">,</span>&nbsp;<span class="ident" id="3762932">p</span><span class="op" id="3762933">,</span>&nbsp;<span class="ident" id="3762935">n</span><span class="op" id="3762936">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3762939">}</span>&nbsp;<span class="keyword" id="3762941">else</span>&nbsp;<span class="op" id="3762946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3762950">karatsubaSub</span><span class="op" id="3762962">(</span><span class="ident" id="3762963">z</span><span class="op" id="3762964">[</span><span class="ident" id="3762965">n2</span><span class="op" id="3762967">:</span><span class="op" id="3762968">]</span><span class="op" id="3762969">,</span>&nbsp;<span class="ident" id="3762971">p</span><span class="op" id="3762972">,</span>&nbsp;<span class="ident" id="3762974">n</span><span class="op" id="3762975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3762978">}</span><br>
<span class="lineno"></span><span class="op" id="3762980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="3762983">//&nbsp;alias&nbsp;returns&nbsp;true&nbsp;if&nbsp;x&nbsp;and&nbsp;y&nbsp;share&nbsp;the&nbsp;same&nbsp;base&nbsp;array.</span><br>
<span class="lineno"></span><span class="keyword" id="3763043">func</span>&nbsp;<span class="ident" id="3763048">alias</span><span class="op" id="3763053">(</span><span class="ident" id="3763054">x</span><span class="op" id="3763055">,</span>&nbsp;<span class="ident" id="3763057">y</span>&nbsp;<span class="ident" id="3763059">nat</span><span class="op" id="3763062">)</span>&nbsp;<span class="builtintype" id="3763064">bool</span>&nbsp;<span class="op" id="3763069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3763072">return</span>&nbsp;<span class="builtinfunc" id="3763079">cap</span><span class="op" id="3763082">(</span><span class="ident" id="3763083">x</span><span class="op" id="3763084">)</span>&nbsp;<span class="op" id="3763086">&gt;</span>&nbsp;<span class="num" id="3763088">0</span>&nbsp;<span class="op" id="3763090">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3763093">cap</span><span class="op" id="3763096">(</span><span class="ident" id="3763097">y</span><span class="op" id="3763098">)</span>&nbsp;<span class="op" id="3763100">&gt;</span>&nbsp;<span class="num" id="3763102">0</span>&nbsp;<span class="op" id="3763104">&amp;&amp;</span>&nbsp;<span class="op" id="3763107">&amp;</span><span class="ident" id="3763108">x</span><span class="op" id="3763109">[</span><span class="num" id="3763110">0</span><span class="op" id="3763111">:</span><span class="builtinfunc" id="3763112">cap</span><span class="op" id="3763115">(</span><span class="ident" id="3763116">x</span><span class="op" id="3763117">)</span><span class="op" id="3763118">]</span><span class="op" id="3763119">[</span><span class="builtinfunc" id="3763120">cap</span><span class="op" id="3763123">(</span><span class="ident" id="3763124">x</span><span class="op" id="3763125">)</span><span class="op" id="3763126">-</span><span class="num" id="3763127">1</span><span class="op" id="3763128">]</span>&nbsp;<span class="op" id="3763130">==</span>&nbsp;<span class="op" id="3763133">&amp;</span><span class="ident" id="3763134">y</span><span class="op" id="3763135">[</span><span class="num" id="3763136">0</span><span class="op" id="3763137">:</span><span class="builtinfunc" id="3763138">cap</span><span class="op" id="3763141">(</span><span class="ident" id="3763142">y</span><span class="op" id="3763143">)</span><span class="op" id="3763144">]</span><span class="op" id="3763145">[</span><span class="builtinfunc" id="3763146">cap</span><span class="op" id="3763149">(</span><span class="ident" id="3763150">y</span><span class="op" id="3763151">)</span><span class="op" id="3763152">-</span><span class="num" id="3763153">1</span><span class="op" id="3763154">]</span><br>
<span class="lineno"></span><span class="op" id="3763156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="comment" id="3763159">//&nbsp;addAt&nbsp;implements&nbsp;z&nbsp;+=&nbsp;x&lt;&lt;(_W*i);&nbsp;z&nbsp;must&nbsp;be&nbsp;long&nbsp;enough.</span><br>
<span class="lineno"></span><span class="comment" id="3763218">//&nbsp;(we&nbsp;don&#39;t&nbsp;use&nbsp;nat.add&nbsp;because&nbsp;we&nbsp;need&nbsp;z&nbsp;to&nbsp;stay&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="3763278">//&nbsp;slice,&nbsp;and&nbsp;we&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;normalize&nbsp;z&nbsp;after&nbsp;each&nbsp;addition)</span><br>
<span class="lineno"></span><span class="keyword" id="3763342">func</span>&nbsp;<span class="ident" id="3763347">addAt</span><span class="op" id="3763352">(</span><span class="ident" id="3763353">z</span><span class="op" id="3763354">,</span>&nbsp;<span class="ident" id="3763356">x</span>&nbsp;<span class="ident" id="3763358">nat</span><span class="op" id="3763361">,</span>&nbsp;<span class="ident" id="3763363">i</span>&nbsp;<span class="builtintype" id="3763365">int</span><span class="op" id="3763368">)</span>&nbsp;<span class="op" id="3763370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3763373">if</span>&nbsp;<span class="ident" id="3763376">n</span>&nbsp;<span class="op" id="3763378">:=</span>&nbsp;<span class="builtinfunc" id="3763381">len</span><span class="op" id="3763384">(</span><span class="ident" id="3763385">x</span><span class="op" id="3763386">)</span><span class="op" id="3763387">;</span>&nbsp;<span class="ident" id="3763389">n</span>&nbsp;<span class="op" id="3763391">&gt;</span>&nbsp;<span class="num" id="3763393">0</span>&nbsp;<span class="op" id="3763395">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3763399">if</span>&nbsp;<span class="ident" id="3763402">c</span>&nbsp;<span class="op" id="3763404">:=</span>&nbsp;<span class="ident" id="3763407">addVV</span><span class="op" id="3763412">(</span><span class="ident" id="3763413">z</span><span class="op" id="3763414">[</span><span class="ident" id="3763415">i</span><span class="op" id="3763416">:</span><span class="ident" id="3763417">i</span><span class="op" id="3763418">+</span><span class="ident" id="3763419">n</span><span class="op" id="3763420">]</span><span class="op" id="3763421">,</span>&nbsp;<span class="ident" id="3763423">z</span><span class="op" id="3763424">[</span><span class="ident" id="3763425">i</span><span class="op" id="3763426">:</span><span class="op" id="3763427">]</span><span class="op" id="3763428">,</span>&nbsp;<span class="ident" id="3763430">x</span><span class="op" id="3763431">)</span><span class="op" id="3763432">;</span>&nbsp;<span class="ident" id="3763434">c</span>&nbsp;<span class="op" id="3763436">!=</span>&nbsp;<span class="num" id="3763439">0</span>&nbsp;<span class="op" id="3763441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3763446">j</span>&nbsp;<span class="op" id="3763448">:=</span>&nbsp;<span class="ident" id="3763451">i</span>&nbsp;<span class="op" id="3763453">+</span>&nbsp;<span class="ident" id="3763455">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3763460">if</span>&nbsp;<span class="ident" id="3763463">j</span>&nbsp;<span class="op" id="3763465">&lt;</span>&nbsp;<span class="builtinfunc" id="3763467">len</span><span class="op" id="3763470">(</span><span class="ident" id="3763471">z</span><span class="op" id="3763472">)</span>&nbsp;<span class="op" id="3763474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3763480">addVW</span><span class="op" id="3763485">(</span><span class="ident" id="3763486">z</span><span class="op" id="3763487">[</span><span class="ident" id="3763488">j</span><span class="op" id="3763489">:</span><span class="op" id="3763490">]</span><span class="op" id="3763491">,</span>&nbsp;<span class="ident" id="3763493">z</span><span class="op" id="3763494">[</span><span class="ident" id="3763495">j</span><span class="op" id="3763496">:</span><span class="op" id="3763497">]</span><span class="op" id="3763498">,</span>&nbsp;<span class="ident" id="3763500">c</span><span class="op" id="3763501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3763506">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3763510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3763513">}</span><br>
<span class="lineno"></span><span class="op" id="3763515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3763518">func</span>&nbsp;<span class="ident" id="3763523">max</span><span class="op" id="3763526">(</span><span class="ident" id="3763527">x</span><span class="op" id="3763528">,</span>&nbsp;<span class="ident" id="3763530">y</span>&nbsp;<span class="builtintype" id="3763532">int</span><span class="op" id="3763535">)</span>&nbsp;<span class="builtintype" id="3763537">int</span>&nbsp;<span class="op" id="3763541">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3763544">if</span>&nbsp;<span class="ident" id="3763547">x</span>&nbsp;<span class="op" id="3763549">&gt;</span>&nbsp;<span class="ident" id="3763551">y</span>&nbsp;<span class="op" id="3763553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3763557">return</span>&nbsp;<span class="ident" id="3763564">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3763567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3763570">return</span>&nbsp;<span class="ident" id="3763577">y</span><br>
<span class="lineno"></span><span class="op" id="3763579">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="comment" id="3763582">//&nbsp;karatsubaLen&nbsp;computes&nbsp;an&nbsp;approximation&nbsp;to&nbsp;the&nbsp;maximum&nbsp;k&nbsp;&lt;=&nbsp;n&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3763656">//&nbsp;k&nbsp;=&nbsp;p&lt;&lt;i&nbsp;for&nbsp;a&nbsp;number&nbsp;p&nbsp;&lt;=&nbsp;karatsubaThreshold&nbsp;and&nbsp;an&nbsp;i&nbsp;&gt;=&nbsp;0.&nbsp;Thus,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3763730">//&nbsp;result&nbsp;is&nbsp;the&nbsp;largest&nbsp;number&nbsp;that&nbsp;can&nbsp;be&nbsp;divided&nbsp;repeatedly&nbsp;by&nbsp;2&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="3763805">//&nbsp;becoming&nbsp;about&nbsp;the&nbsp;value&nbsp;of&nbsp;karatsubaThreshold.</span><br>
<span class="lineno">370</span><span class="keyword" id="3763856">func</span>&nbsp;<span class="ident" id="3763861">karatsubaLen</span><span class="op" id="3763873">(</span><span class="ident" id="3763874">n</span>&nbsp;<span class="builtintype" id="3763876">int</span><span class="op" id="3763879">)</span>&nbsp;<span class="builtintype" id="3763881">int</span>&nbsp;<span class="op" id="3763885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3763888">i</span>&nbsp;<span class="op" id="3763890">:=</span>&nbsp;<span class="builtintype" id="3763893">uint</span><span class="op" id="3763897">(</span><span class="num" id="3763898">0</span><span class="op" id="3763899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3763902">for</span>&nbsp;<span class="ident" id="3763906">n</span>&nbsp;<span class="op" id="3763908">&gt;</span>&nbsp;<span class="ident" id="3763910">karatsubaThreshold</span>&nbsp;<span class="op" id="3763929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3763933">n</span>&nbsp;<span class="op" id="3763935">&gt;&gt;=</span>&nbsp;<span class="num" id="3763939">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3763943">i</span><span class="op" id="3763944">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3763948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3763951">return</span>&nbsp;<span class="ident" id="3763958">n</span>&nbsp;<span class="op" id="3763960">&lt;&lt;</span>&nbsp;<span class="ident" id="3763963">i</span><br>
<span class="lineno"></span><span class="op" id="3763965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3763968">func</span>&nbsp;<span class="op" id="3763973">(</span><span class="ident" id="3763974">z</span>&nbsp;<span class="ident" id="3763976">nat</span><span class="op" id="3763979">)</span>&nbsp;<span class="ident" id="3763981">mul</span><span class="op" id="3763984">(</span><span class="ident" id="3763985">x</span><span class="op" id="3763986">,</span>&nbsp;<span class="ident" id="3763988">y</span>&nbsp;<span class="ident" id="3763990">nat</span><span class="op" id="3763993">)</span>&nbsp;<span class="ident" id="3763995">nat</span>&nbsp;<span class="op" id="3763999">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764002">m</span>&nbsp;<span class="op" id="3764004">:=</span>&nbsp;<span class="builtinfunc" id="3764007">len</span><span class="op" id="3764010">(</span><span class="ident" id="3764011">x</span><span class="op" id="3764012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764015">n</span>&nbsp;<span class="op" id="3764017">:=</span>&nbsp;<span class="builtinfunc" id="3764020">len</span><span class="op" id="3764023">(</span><span class="ident" id="3764024">y</span><span class="op" id="3764025">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3764029">switch</span>&nbsp;<span class="op" id="3764036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3764039">case</span>&nbsp;<span class="ident" id="3764044">m</span>&nbsp;<span class="op" id="3764046">&lt;</span>&nbsp;<span class="ident" id="3764048">n</span><span class="op" id="3764049">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3764053">return</span>&nbsp;<span class="ident" id="3764060">z</span><span class="op" id="3764061">.</span><span class="ident" id="3764062">mul</span><span class="op" id="3764065">(</span><span class="ident" id="3764066">y</span><span class="op" id="3764067">,</span>&nbsp;<span class="ident" id="3764069">x</span><span class="op" id="3764070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3764073">case</span>&nbsp;<span class="ident" id="3764078">m</span>&nbsp;<span class="op" id="3764080">==</span>&nbsp;<span class="num" id="3764083">0</span>&nbsp;<span class="op" id="3764085">||</span>&nbsp;<span class="ident" id="3764088">n</span>&nbsp;<span class="op" id="3764090">==</span>&nbsp;<span class="num" id="3764093">0</span><span class="op" id="3764094">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3764098">return</span>&nbsp;<span class="ident" id="3764105">z</span><span class="op" id="3764106">.</span><span class="builtinfunc" id="3764107">make</span><span class="op" id="3764111">(</span><span class="num" id="3764112">0</span><span class="op" id="3764113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3764116">case</span>&nbsp;<span class="ident" id="3764121">n</span>&nbsp;<span class="op" id="3764123">==</span>&nbsp;<span class="num" id="3764126">1</span><span class="op" id="3764127">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3764131">return</span>&nbsp;<span class="ident" id="3764138">z</span><span class="op" id="3764139">.</span><span class="ident" id="3764140">mulAddWW</span><span class="op" id="3764148">(</span><span class="ident" id="3764149">x</span><span class="op" id="3764150">,</span>&nbsp;<span class="ident" id="3764152">y</span><span class="op" id="3764153">[</span><span class="num" id="3764154">0</span><span class="op" id="3764155">]</span><span class="op" id="3764156">,</span>&nbsp;<span class="num" id="3764158">0</span><span class="op" id="3764159">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3764162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3764165">//&nbsp;m&nbsp;&gt;=&nbsp;n&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3764181">//&nbsp;determine&nbsp;if&nbsp;z&nbsp;can&nbsp;be&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3764214">if</span>&nbsp;<span class="ident" id="3764217">alias</span><span class="op" id="3764222">(</span><span class="ident" id="3764223">z</span><span class="op" id="3764224">,</span>&nbsp;<span class="ident" id="3764226">x</span><span class="op" id="3764227">)</span>&nbsp;<span class="op" id="3764229">||</span>&nbsp;<span class="ident" id="3764232">alias</span><span class="op" id="3764237">(</span><span class="ident" id="3764238">z</span><span class="op" id="3764239">,</span>&nbsp;<span class="ident" id="3764241">y</span><span class="op" id="3764242">)</span>&nbsp;<span class="op" id="3764244">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764248">z</span>&nbsp;<span class="op" id="3764250">=</span>&nbsp;<span class="ident" id="3764252">nil</span>&nbsp;<span class="comment" id="3764256">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;x&nbsp;or&nbsp;y&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3764300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3764304">//&nbsp;use&nbsp;basic&nbsp;multiplication&nbsp;if&nbsp;the&nbsp;numbers&nbsp;are&nbsp;small</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3764358">if</span>&nbsp;<span class="ident" id="3764361">n</span>&nbsp;<span class="op" id="3764363">&lt;</span>&nbsp;<span class="ident" id="3764365">karatsubaThreshold</span>&nbsp;<span class="op" id="3764384">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764388">z</span>&nbsp;<span class="op" id="3764390">=</span>&nbsp;<span class="ident" id="3764392">z</span><span class="op" id="3764393">.</span><span class="builtinfunc" id="3764394">make</span><span class="op" id="3764398">(</span><span class="ident" id="3764399">m</span>&nbsp;<span class="op" id="3764401">+</span>&nbsp;<span class="ident" id="3764403">n</span><span class="op" id="3764404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764408">basicMul</span><span class="op" id="3764416">(</span><span class="ident" id="3764417">z</span><span class="op" id="3764418">,</span>&nbsp;<span class="ident" id="3764420">x</span><span class="op" id="3764421">,</span>&nbsp;<span class="ident" id="3764423">y</span><span class="op" id="3764424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3764428">return</span>&nbsp;<span class="ident" id="3764435">z</span><span class="op" id="3764436">.</span><span class="ident" id="3764437">norm</span><span class="op" id="3764441">(</span><span class="op" id="3764442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3764445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3764448">//&nbsp;m&nbsp;&gt;=&nbsp;n&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;karatsubaThreshold&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3764497">//&nbsp;determine&nbsp;Karatsuba&nbsp;length&nbsp;k&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3764540">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3764544">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;xh*b&nbsp;+&nbsp;x0&nbsp;&nbsp;(0&nbsp;&lt;=&nbsp;x0&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3764579">//&nbsp;&nbsp;&nbsp;y&nbsp;=&nbsp;yh*b&nbsp;+&nbsp;y0&nbsp;&nbsp;(0&nbsp;&lt;=&nbsp;y0&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3764614">//&nbsp;&nbsp;&nbsp;b&nbsp;=&nbsp;1&lt;&lt;(_W*k)&nbsp;&nbsp;(&#34;base&#34;&nbsp;of&nbsp;digits&nbsp;xi,&nbsp;yi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3764661">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764665">k</span>&nbsp;<span class="op" id="3764667">:=</span>&nbsp;<span class="ident" id="3764670">karatsubaLen</span><span class="op" id="3764682">(</span><span class="ident" id="3764683">n</span><span class="op" id="3764684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3764687">//&nbsp;k&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3764699">//&nbsp;multiply&nbsp;x0&nbsp;and&nbsp;y0&nbsp;via&nbsp;Karatsuba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764736">x0</span>&nbsp;<span class="op" id="3764739">:=</span>&nbsp;<span class="ident" id="3764742">x</span><span class="op" id="3764743">[</span><span class="num" id="3764744">0</span><span class="op" id="3764745">:</span><span class="ident" id="3764746">k</span><span class="op" id="3764747">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3764762">//&nbsp;x0&nbsp;is&nbsp;not&nbsp;normalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764787">y0</span>&nbsp;<span class="op" id="3764790">:=</span>&nbsp;<span class="ident" id="3764793">y</span><span class="op" id="3764794">[</span><span class="num" id="3764795">0</span><span class="op" id="3764796">:</span><span class="ident" id="3764797">k</span><span class="op" id="3764798">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3764813">//&nbsp;y0&nbsp;is&nbsp;not&nbsp;normalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764838">z</span>&nbsp;<span class="op" id="3764840">=</span>&nbsp;<span class="ident" id="3764842">z</span><span class="op" id="3764843">.</span><span class="builtinfunc" id="3764844">make</span><span class="op" id="3764848">(</span><span class="ident" id="3764849">max</span><span class="op" id="3764852">(</span><span class="num" id="3764853">6</span><span class="op" id="3764854">*</span><span class="ident" id="3764855">k</span><span class="op" id="3764856">,</span>&nbsp;<span class="ident" id="3764858">m</span><span class="op" id="3764859">+</span><span class="ident" id="3764860">n</span><span class="op" id="3764861">)</span><span class="op" id="3764862">)</span>&nbsp;<span class="comment" id="3764864">//&nbsp;enough&nbsp;space&nbsp;for&nbsp;karatsuba&nbsp;of&nbsp;x0*y0&nbsp;and&nbsp;full&nbsp;result&nbsp;of&nbsp;x*y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764927">karatsuba</span><span class="op" id="3764936">(</span><span class="ident" id="3764937">z</span><span class="op" id="3764938">,</span>&nbsp;<span class="ident" id="3764940">x0</span><span class="op" id="3764942">,</span>&nbsp;<span class="ident" id="3764944">y0</span><span class="op" id="3764946">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764949">z</span>&nbsp;<span class="op" id="3764951">=</span>&nbsp;<span class="ident" id="3764953">z</span><span class="op" id="3764954">[</span><span class="num" id="3764955">0</span>&nbsp;<span class="op" id="3764957">:</span>&nbsp;<span class="ident" id="3764959">m</span><span class="op" id="3764960">+</span><span class="ident" id="3764961">n</span><span class="op" id="3764962">]</span>&nbsp;&nbsp;<span class="comment" id="3764965">//&nbsp;z&nbsp;has&nbsp;final&nbsp;length&nbsp;but&nbsp;may&nbsp;be&nbsp;incomplete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765010">z</span><span class="op" id="3765011">[</span><span class="num" id="3765012">2</span><span class="op" id="3765013">*</span><span class="ident" id="3765014">k</span><span class="op" id="3765015">:</span><span class="op" id="3765016">]</span><span class="op" id="3765017">.</span><span class="ident" id="3765018">clear</span><span class="op" id="3765023">(</span><span class="op" id="3765024">)</span>&nbsp;<span class="comment" id="3765026">//&nbsp;upper&nbsp;portion&nbsp;of&nbsp;z&nbsp;is&nbsp;garbage&nbsp;(and&nbsp;2*k&nbsp;&lt;=&nbsp;m+n&nbsp;since&nbsp;k&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;m)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3765096">//&nbsp;If&nbsp;xh&nbsp;!=&nbsp;0&nbsp;or&nbsp;yh&nbsp;!=&nbsp;0,&nbsp;add&nbsp;the&nbsp;missing&nbsp;terms&nbsp;to&nbsp;z.&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3765155">//</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3765159">//&nbsp;&nbsp;&nbsp;xh&nbsp;=&nbsp;xi*b^i&nbsp;+&nbsp;...&nbsp;+&nbsp;x2*b^2&nbsp;+&nbsp;x1*b&nbsp;(0&nbsp;&lt;=&nbsp;xi&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3765213">//&nbsp;&nbsp;&nbsp;yh&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y1*b&nbsp;(0&nbsp;&lt;=&nbsp;y1&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3765267">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3765271">//&nbsp;the&nbsp;missing&nbsp;terms&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3765297">//</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3765301">//&nbsp;&nbsp;&nbsp;x0*y1*b&nbsp;and&nbsp;xi*y0*b^i,&nbsp;xi*y1*b^(i+1)&nbsp;for&nbsp;i&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3765354">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3765358">//&nbsp;since&nbsp;all&nbsp;the&nbsp;yi&nbsp;for&nbsp;i&nbsp;&gt;&nbsp;1&nbsp;are&nbsp;0&nbsp;by&nbsp;choice&nbsp;of&nbsp;k:&nbsp;If&nbsp;any&nbsp;of&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3765426">//&nbsp;were&nbsp;&gt;&nbsp;0,&nbsp;then&nbsp;yh&nbsp;&gt;=&nbsp;b^2&nbsp;and&nbsp;thus&nbsp;y&nbsp;&gt;=&nbsp;b^2.&nbsp;Then&nbsp;k&#39;&nbsp;=&nbsp;k*2&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3765494">//&nbsp;be&nbsp;a&nbsp;larger&nbsp;valid&nbsp;threshold&nbsp;contradicting&nbsp;the&nbsp;assumption&nbsp;about&nbsp;k.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3765564">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3765568">if</span>&nbsp;<span class="ident" id="3765571">k</span>&nbsp;<span class="op" id="3765573">&lt;</span>&nbsp;<span class="ident" id="3765575">n</span>&nbsp;<span class="op" id="3765577">||</span>&nbsp;<span class="ident" id="3765580">m</span>&nbsp;<span class="op" id="3765582">!=</span>&nbsp;<span class="ident" id="3765585">n</span>&nbsp;<span class="op" id="3765587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3765591">var</span>&nbsp;<span class="ident" id="3765595">t</span>&nbsp;<span class="ident" id="3765597">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3765604">//&nbsp;add&nbsp;x0*y1*b</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765621">x0</span>&nbsp;<span class="op" id="3765624">:=</span>&nbsp;<span class="ident" id="3765627">x0</span><span class="op" id="3765629">.</span><span class="ident" id="3765630">norm</span><span class="op" id="3765634">(</span><span class="op" id="3765635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765639">y1</span>&nbsp;<span class="op" id="3765642">:=</span>&nbsp;<span class="ident" id="3765645">y</span><span class="op" id="3765646">[</span><span class="ident" id="3765647">k</span><span class="op" id="3765648">:</span><span class="op" id="3765649">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3765657">//&nbsp;y1&nbsp;is&nbsp;normalized&nbsp;because&nbsp;y&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765692">t</span>&nbsp;<span class="op" id="3765694">=</span>&nbsp;<span class="ident" id="3765696">t</span><span class="op" id="3765697">.</span><span class="ident" id="3765698">mul</span><span class="op" id="3765701">(</span><span class="ident" id="3765702">x0</span><span class="op" id="3765704">,</span>&nbsp;<span class="ident" id="3765706">y1</span><span class="op" id="3765708">)</span>&nbsp;<span class="comment" id="3765710">//&nbsp;update&nbsp;t&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;lose&nbsp;t&#39;s&nbsp;underlying&nbsp;array</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765762">addAt</span><span class="op" id="3765767">(</span><span class="ident" id="3765768">z</span><span class="op" id="3765769">,</span>&nbsp;<span class="ident" id="3765771">t</span><span class="op" id="3765772">,</span>&nbsp;<span class="ident" id="3765774">k</span><span class="op" id="3765775">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3765780">//&nbsp;add&nbsp;xi*y0&lt;&lt;i,&nbsp;xi*y1*b&lt;&lt;(i+k)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765814">y0</span>&nbsp;<span class="op" id="3765817">:=</span>&nbsp;<span class="ident" id="3765820">y0</span><span class="op" id="3765822">.</span><span class="ident" id="3765823">norm</span><span class="op" id="3765827">(</span><span class="op" id="3765828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3765832">for</span>&nbsp;<span class="ident" id="3765836">i</span>&nbsp;<span class="op" id="3765838">:=</span>&nbsp;<span class="ident" id="3765841">k</span><span class="op" id="3765842">;</span>&nbsp;<span class="ident" id="3765844">i</span>&nbsp;<span class="op" id="3765846">&lt;</span>&nbsp;<span class="builtinfunc" id="3765848">len</span><span class="op" id="3765851">(</span><span class="ident" id="3765852">x</span><span class="op" id="3765853">)</span><span class="op" id="3765854">;</span>&nbsp;<span class="ident" id="3765856">i</span>&nbsp;<span class="op" id="3765858">+=</span>&nbsp;<span class="ident" id="3765861">k</span>&nbsp;<span class="op" id="3765863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765868">xi</span>&nbsp;<span class="op" id="3765871">:=</span>&nbsp;<span class="ident" id="3765874">x</span><span class="op" id="3765875">[</span><span class="ident" id="3765876">i</span><span class="op" id="3765877">:</span><span class="op" id="3765878">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3765883">if</span>&nbsp;<span class="builtinfunc" id="3765886">len</span><span class="op" id="3765889">(</span><span class="ident" id="3765890">xi</span><span class="op" id="3765892">)</span>&nbsp;<span class="op" id="3765894">&gt;</span>&nbsp;<span class="ident" id="3765896">k</span>&nbsp;<span class="op" id="3765898">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765904">xi</span>&nbsp;<span class="op" id="3765907">=</span>&nbsp;<span class="ident" id="3765909">xi</span><span class="op" id="3765911">[</span><span class="op" id="3765912">:</span><span class="ident" id="3765913">k</span><span class="op" id="3765914">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3765919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765924">xi</span>&nbsp;<span class="op" id="3765927">=</span>&nbsp;<span class="ident" id="3765929">xi</span><span class="op" id="3765931">.</span><span class="ident" id="3765932">norm</span><span class="op" id="3765936">(</span><span class="op" id="3765937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765942">t</span>&nbsp;<span class="op" id="3765944">=</span>&nbsp;<span class="ident" id="3765946">t</span><span class="op" id="3765947">.</span><span class="ident" id="3765948">mul</span><span class="op" id="3765951">(</span><span class="ident" id="3765952">xi</span><span class="op" id="3765954">,</span>&nbsp;<span class="ident" id="3765956">y0</span><span class="op" id="3765958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765963">addAt</span><span class="op" id="3765968">(</span><span class="ident" id="3765969">z</span><span class="op" id="3765970">,</span>&nbsp;<span class="ident" id="3765972">t</span><span class="op" id="3765973">,</span>&nbsp;<span class="ident" id="3765975">i</span><span class="op" id="3765976">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765981">t</span>&nbsp;<span class="op" id="3765983">=</span>&nbsp;<span class="ident" id="3765985">t</span><span class="op" id="3765986">.</span><span class="ident" id="3765987">mul</span><span class="op" id="3765990">(</span><span class="ident" id="3765991">xi</span><span class="op" id="3765993">,</span>&nbsp;<span class="ident" id="3765995">y1</span><span class="op" id="3765997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766002">addAt</span><span class="op" id="3766007">(</span><span class="ident" id="3766008">z</span><span class="op" id="3766009">,</span>&nbsp;<span class="ident" id="3766011">t</span><span class="op" id="3766012">,</span>&nbsp;<span class="ident" id="3766014">i</span><span class="op" id="3766015">+</span><span class="ident" id="3766016">k</span><span class="op" id="3766017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3766021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3766024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766028">return</span>&nbsp;<span class="ident" id="3766035">z</span><span class="op" id="3766036">.</span><span class="ident" id="3766037">norm</span><span class="op" id="3766041">(</span><span class="op" id="3766042">)</span><br>
<span class="lineno"></span><span class="op" id="3766044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3766047">//&nbsp;mulRange&nbsp;computes&nbsp;the&nbsp;product&nbsp;of&nbsp;all&nbsp;the&nbsp;unsigned&nbsp;integers&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3766116">//&nbsp;range&nbsp;[a,&nbsp;b]&nbsp;inclusively.&nbsp;If&nbsp;a&nbsp;&gt;&nbsp;b&nbsp;(empty&nbsp;range),&nbsp;the&nbsp;result&nbsp;is&nbsp;1.</span><br>
<span class="lineno">465</span><span class="keyword" id="3766186">func</span>&nbsp;<span class="op" id="3766191">(</span><span class="ident" id="3766192">z</span>&nbsp;<span class="ident" id="3766194">nat</span><span class="op" id="3766197">)</span>&nbsp;<span class="ident" id="3766199">mulRange</span><span class="op" id="3766207">(</span><span class="ident" id="3766208">a</span><span class="op" id="3766209">,</span>&nbsp;<span class="ident" id="3766211">b</span>&nbsp;<span class="ident" id="3766213">uint64</span><span class="op" id="3766219">)</span>&nbsp;<span class="ident" id="3766221">nat</span>&nbsp;<span class="op" id="3766225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766228">switch</span>&nbsp;<span class="op" id="3766235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766238">case</span>&nbsp;<span class="ident" id="3766243">a</span>&nbsp;<span class="op" id="3766245">==</span>&nbsp;<span class="num" id="3766248">0</span><span class="op" id="3766249">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3766253">//&nbsp;cut&nbsp;long&nbsp;ranges&nbsp;short&nbsp;(optimization)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766295">return</span>&nbsp;<span class="ident" id="3766302">z</span><span class="op" id="3766303">.</span><span class="ident" id="3766304">setUint64</span><span class="op" id="3766313">(</span><span class="num" id="3766314">0</span><span class="op" id="3766315">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766318">case</span>&nbsp;<span class="ident" id="3766323">a</span>&nbsp;<span class="op" id="3766325">&gt;</span>&nbsp;<span class="ident" id="3766327">b</span><span class="op" id="3766328">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766332">return</span>&nbsp;<span class="ident" id="3766339">z</span><span class="op" id="3766340">.</span><span class="ident" id="3766341">setUint64</span><span class="op" id="3766350">(</span><span class="num" id="3766351">1</span><span class="op" id="3766352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766355">case</span>&nbsp;<span class="ident" id="3766360">a</span>&nbsp;<span class="op" id="3766362">==</span>&nbsp;<span class="ident" id="3766365">b</span><span class="op" id="3766366">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766370">return</span>&nbsp;<span class="ident" id="3766377">z</span><span class="op" id="3766378">.</span><span class="ident" id="3766379">setUint64</span><span class="op" id="3766388">(</span><span class="ident" id="3766389">a</span><span class="op" id="3766390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766393">case</span>&nbsp;<span class="ident" id="3766398">a</span><span class="op" id="3766399">+</span><span class="num" id="3766400">1</span>&nbsp;<span class="op" id="3766402">==</span>&nbsp;<span class="ident" id="3766405">b</span><span class="op" id="3766406">:</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766410">return</span>&nbsp;<span class="ident" id="3766417">z</span><span class="op" id="3766418">.</span><span class="ident" id="3766419">mul</span><span class="op" id="3766422">(</span><span class="ident" id="3766423">nat</span><span class="op" id="3766426">(</span><span class="ident" id="3766427">nil</span><span class="op" id="3766430">)</span><span class="op" id="3766431">.</span><span class="ident" id="3766432">setUint64</span><span class="op" id="3766441">(</span><span class="ident" id="3766442">a</span><span class="op" id="3766443">)</span><span class="op" id="3766444">,</span>&nbsp;<span class="ident" id="3766446">nat</span><span class="op" id="3766449">(</span><span class="ident" id="3766450">nil</span><span class="op" id="3766453">)</span><span class="op" id="3766454">.</span><span class="ident" id="3766455">setUint64</span><span class="op" id="3766464">(</span><span class="ident" id="3766465">b</span><span class="op" id="3766466">)</span><span class="op" id="3766467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3766470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766473">m</span>&nbsp;<span class="op" id="3766475">:=</span>&nbsp;<span class="op" id="3766478">(</span><span class="ident" id="3766479">a</span>&nbsp;<span class="op" id="3766481">+</span>&nbsp;<span class="ident" id="3766483">b</span><span class="op" id="3766484">)</span>&nbsp;<span class="op" id="3766486">/</span>&nbsp;<span class="num" id="3766488">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766491">return</span>&nbsp;<span class="ident" id="3766498">z</span><span class="op" id="3766499">.</span><span class="ident" id="3766500">mul</span><span class="op" id="3766503">(</span><span class="ident" id="3766504">nat</span><span class="op" id="3766507">(</span><span class="ident" id="3766508">nil</span><span class="op" id="3766511">)</span><span class="op" id="3766512">.</span><span class="ident" id="3766513">mulRange</span><span class="op" id="3766521">(</span><span class="ident" id="3766522">a</span><span class="op" id="3766523">,</span>&nbsp;<span class="ident" id="3766525">m</span><span class="op" id="3766526">)</span><span class="op" id="3766527">,</span>&nbsp;<span class="ident" id="3766529">nat</span><span class="op" id="3766532">(</span><span class="ident" id="3766533">nil</span><span class="op" id="3766536">)</span><span class="op" id="3766537">.</span><span class="ident" id="3766538">mulRange</span><span class="op" id="3766546">(</span><span class="ident" id="3766547">m</span><span class="op" id="3766548">+</span><span class="num" id="3766549">1</span><span class="op" id="3766550">,</span>&nbsp;<span class="ident" id="3766552">b</span><span class="op" id="3766553">)</span><span class="op" id="3766554">)</span><br>
<span class="lineno"></span><span class="op" id="3766556">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="3766559">//&nbsp;q&nbsp;=&nbsp;(x-r)/y,&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;r&nbsp;&lt;&nbsp;y</span><br>
<span class="lineno"></span><span class="keyword" id="3766591">func</span>&nbsp;<span class="op" id="3766596">(</span><span class="ident" id="3766597">z</span>&nbsp;<span class="ident" id="3766599">nat</span><span class="op" id="3766602">)</span>&nbsp;<span class="ident" id="3766604">divW</span><span class="op" id="3766608">(</span><span class="ident" id="3766609">x</span>&nbsp;<span class="ident" id="3766611">nat</span><span class="op" id="3766614">,</span>&nbsp;<span class="ident" id="3766616">y</span>&nbsp;<span class="ident" id="3766618">Word</span><span class="op" id="3766622">)</span>&nbsp;<span class="op" id="3766624">(</span><span class="ident" id="3766625">q</span>&nbsp;<span class="ident" id="3766627">nat</span><span class="op" id="3766630">,</span>&nbsp;<span class="ident" id="3766632">r</span>&nbsp;<span class="ident" id="3766634">Word</span><span class="op" id="3766638">)</span>&nbsp;<span class="op" id="3766640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766643">m</span>&nbsp;<span class="op" id="3766645">:=</span>&nbsp;<span class="builtinfunc" id="3766648">len</span><span class="op" id="3766651">(</span><span class="ident" id="3766652">x</span><span class="op" id="3766653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766656">switch</span>&nbsp;<span class="op" id="3766663">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766666">case</span>&nbsp;<span class="ident" id="3766671">y</span>&nbsp;<span class="op" id="3766673">==</span>&nbsp;<span class="num" id="3766676">0</span><span class="op" id="3766677">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3766681">panic</span><span class="op" id="3766686">(</span><span class="string" id="3766687">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3766705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766708">case</span>&nbsp;<span class="ident" id="3766713">y</span>&nbsp;<span class="op" id="3766715">==</span>&nbsp;<span class="num" id="3766718">1</span><span class="op" id="3766719">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766723">q</span>&nbsp;<span class="op" id="3766725">=</span>&nbsp;<span class="ident" id="3766727">z</span><span class="op" id="3766728">.</span><span class="ident" id="3766729">set</span><span class="op" id="3766732">(</span><span class="ident" id="3766733">x</span><span class="op" id="3766734">)</span>&nbsp;<span class="comment" id="3766736">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766753">return</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766761">case</span>&nbsp;<span class="ident" id="3766766">m</span>&nbsp;<span class="op" id="3766768">==</span>&nbsp;<span class="num" id="3766771">0</span><span class="op" id="3766772">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766776">q</span>&nbsp;<span class="op" id="3766778">=</span>&nbsp;<span class="ident" id="3766780">z</span><span class="op" id="3766781">.</span><span class="builtinfunc" id="3766782">make</span><span class="op" id="3766786">(</span><span class="num" id="3766787">0</span><span class="op" id="3766788">)</span>&nbsp;<span class="comment" id="3766790">//&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766807">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3766815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3766818">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766828">z</span>&nbsp;<span class="op" id="3766830">=</span>&nbsp;<span class="ident" id="3766832">z</span><span class="op" id="3766833">.</span><span class="builtinfunc" id="3766834">make</span><span class="op" id="3766838">(</span><span class="ident" id="3766839">m</span><span class="op" id="3766840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766843">r</span>&nbsp;<span class="op" id="3766845">=</span>&nbsp;<span class="ident" id="3766847">divWVW</span><span class="op" id="3766853">(</span><span class="ident" id="3766854">z</span><span class="op" id="3766855">,</span>&nbsp;<span class="num" id="3766857">0</span><span class="op" id="3766858">,</span>&nbsp;<span class="ident" id="3766860">x</span><span class="op" id="3766861">,</span>&nbsp;<span class="ident" id="3766863">y</span><span class="op" id="3766864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766867">q</span>&nbsp;<span class="op" id="3766869">=</span>&nbsp;<span class="ident" id="3766871">z</span><span class="op" id="3766872">.</span><span class="ident" id="3766873">norm</span><span class="op" id="3766877">(</span><span class="op" id="3766878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766881">return</span><br>
<span class="lineno"></span><span class="op" id="3766888">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="3766891">func</span>&nbsp;<span class="op" id="3766896">(</span><span class="ident" id="3766897">z</span>&nbsp;<span class="ident" id="3766899">nat</span><span class="op" id="3766902">)</span>&nbsp;<span class="ident" id="3766904">div</span><span class="op" id="3766907">(</span><span class="ident" id="3766908">z2</span><span class="op" id="3766910">,</span>&nbsp;<span class="ident" id="3766912">u</span><span class="op" id="3766913">,</span>&nbsp;<span class="ident" id="3766915">v</span>&nbsp;<span class="ident" id="3766917">nat</span><span class="op" id="3766920">)</span>&nbsp;<span class="op" id="3766922">(</span><span class="ident" id="3766923">q</span><span class="op" id="3766924">,</span>&nbsp;<span class="ident" id="3766926">r</span>&nbsp;<span class="ident" id="3766928">nat</span><span class="op" id="3766931">)</span>&nbsp;<span class="op" id="3766933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766936">if</span>&nbsp;<span class="builtinfunc" id="3766939">len</span><span class="op" id="3766942">(</span><span class="ident" id="3766943">v</span><span class="op" id="3766944">)</span>&nbsp;<span class="op" id="3766946">==</span>&nbsp;<span class="num" id="3766949">0</span>&nbsp;<span class="op" id="3766951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3766955">panic</span><span class="op" id="3766960">(</span><span class="string" id="3766961">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3766979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3766982">}</span><br>
<span class="lineno">505</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766986">if</span>&nbsp;<span class="ident" id="3766989">u</span><span class="op" id="3766990">.</span><span class="ident" id="3766991">cmp</span><span class="op" id="3766994">(</span><span class="ident" id="3766995">v</span><span class="op" id="3766996">)</span>&nbsp;<span class="op" id="3766998">&lt;</span>&nbsp;<span class="num" id="3767000">0</span>&nbsp;<span class="op" id="3767002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767006">q</span>&nbsp;<span class="op" id="3767008">=</span>&nbsp;<span class="ident" id="3767010">z</span><span class="op" id="3767011">.</span><span class="builtinfunc" id="3767012">make</span><span class="op" id="3767016">(</span><span class="num" id="3767017">0</span><span class="op" id="3767018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767022">r</span>&nbsp;<span class="op" id="3767024">=</span>&nbsp;<span class="ident" id="3767026">z2</span><span class="op" id="3767028">.</span><span class="ident" id="3767029">set</span><span class="op" id="3767032">(</span><span class="ident" id="3767033">u</span><span class="op" id="3767034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3767038">return</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3767046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3767050">if</span>&nbsp;<span class="builtinfunc" id="3767053">len</span><span class="op" id="3767056">(</span><span class="ident" id="3767057">v</span><span class="op" id="3767058">)</span>&nbsp;<span class="op" id="3767060">==</span>&nbsp;<span class="num" id="3767063">1</span>&nbsp;<span class="op" id="3767065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3767069">var</span>&nbsp;<span class="ident" id="3767073">r2</span>&nbsp;<span class="ident" id="3767076">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767083">q</span><span class="op" id="3767084">,</span>&nbsp;<span class="ident" id="3767086">r2</span>&nbsp;<span class="op" id="3767089">=</span>&nbsp;<span class="ident" id="3767091">z</span><span class="op" id="3767092">.</span><span class="ident" id="3767093">divW</span><span class="op" id="3767097">(</span><span class="ident" id="3767098">u</span><span class="op" id="3767099">,</span>&nbsp;<span class="ident" id="3767101">v</span><span class="op" id="3767102">[</span><span class="num" id="3767103">0</span><span class="op" id="3767104">]</span><span class="op" id="3767105">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767109">r</span>&nbsp;<span class="op" id="3767111">=</span>&nbsp;<span class="ident" id="3767113">z2</span><span class="op" id="3767115">.</span><span class="ident" id="3767116">setWord</span><span class="op" id="3767123">(</span><span class="ident" id="3767124">r2</span><span class="op" id="3767126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3767130">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3767138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767142">q</span><span class="op" id="3767143">,</span>&nbsp;<span class="ident" id="3767145">r</span>&nbsp;<span class="op" id="3767147">=</span>&nbsp;<span class="ident" id="3767149">z</span><span class="op" id="3767150">.</span><span class="ident" id="3767151">divLarge</span><span class="op" id="3767159">(</span><span class="ident" id="3767160">z2</span><span class="op" id="3767162">,</span>&nbsp;<span class="ident" id="3767164">u</span><span class="op" id="3767165">,</span>&nbsp;<span class="ident" id="3767167">v</span><span class="op" id="3767168">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3767171">return</span><br>
<span class="lineno"></span><span class="op" id="3767178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3767181">//&nbsp;q&nbsp;=&nbsp;(uIn-r)/v,&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;r&nbsp;&lt;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="3767215">//&nbsp;Uses&nbsp;z&nbsp;as&nbsp;storage&nbsp;for&nbsp;q,&nbsp;and&nbsp;u&nbsp;as&nbsp;storage&nbsp;for&nbsp;r&nbsp;if&nbsp;possible.</span><br>
<span class="lineno">525</span><span class="comment" id="3767279">//&nbsp;See&nbsp;Knuth,&nbsp;Volume&nbsp;2,&nbsp;section&nbsp;4.3.1,&nbsp;Algorithm&nbsp;D.</span><br>
<span class="lineno"></span><span class="comment" id="3767331">//&nbsp;Preconditions:</span><br>
<span class="lineno"></span><span class="comment" id="3767349">//&nbsp;&nbsp;&nbsp;&nbsp;len(v)&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="3767367">//&nbsp;&nbsp;&nbsp;&nbsp;len(uIn)&nbsp;&gt;=&nbsp;len(v)</span><br>
<span class="lineno"></span><span class="keyword" id="3767392">func</span>&nbsp;<span class="op" id="3767397">(</span><span class="ident" id="3767398">z</span>&nbsp;<span class="ident" id="3767400">nat</span><span class="op" id="3767403">)</span>&nbsp;<span class="ident" id="3767405">divLarge</span><span class="op" id="3767413">(</span><span class="ident" id="3767414">u</span><span class="op" id="3767415">,</span>&nbsp;<span class="ident" id="3767417">uIn</span><span class="op" id="3767420">,</span>&nbsp;<span class="ident" id="3767422">v</span>&nbsp;<span class="ident" id="3767424">nat</span><span class="op" id="3767427">)</span>&nbsp;<span class="op" id="3767429">(</span><span class="ident" id="3767430">q</span><span class="op" id="3767431">,</span>&nbsp;<span class="ident" id="3767433">r</span>&nbsp;<span class="ident" id="3767435">nat</span><span class="op" id="3767438">)</span>&nbsp;<span class="op" id="3767440">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767443">n</span>&nbsp;<span class="op" id="3767445">:=</span>&nbsp;<span class="builtinfunc" id="3767448">len</span><span class="op" id="3767451">(</span><span class="ident" id="3767452">v</span><span class="op" id="3767453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767456">m</span>&nbsp;<span class="op" id="3767458">:=</span>&nbsp;<span class="builtinfunc" id="3767461">len</span><span class="op" id="3767464">(</span><span class="ident" id="3767465">uIn</span><span class="op" id="3767468">)</span>&nbsp;<span class="op" id="3767470">-</span>&nbsp;<span class="ident" id="3767472">n</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3767476">//&nbsp;determine&nbsp;if&nbsp;z&nbsp;can&nbsp;be&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3767509">//&nbsp;TODO(gri)&nbsp;should&nbsp;find&nbsp;a&nbsp;better&nbsp;solution&nbsp;-&nbsp;this&nbsp;if&nbsp;statement</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3767573">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;very&nbsp;costly&nbsp;(see&nbsp;e.g.&nbsp;time&nbsp;pidigits&nbsp;-s&nbsp;-n&nbsp;10000)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3767639">if</span>&nbsp;<span class="ident" id="3767642">alias</span><span class="op" id="3767647">(</span><span class="ident" id="3767648">z</span><span class="op" id="3767649">,</span>&nbsp;<span class="ident" id="3767651">uIn</span><span class="op" id="3767654">)</span>&nbsp;<span class="op" id="3767656">||</span>&nbsp;<span class="ident" id="3767659">alias</span><span class="op" id="3767664">(</span><span class="ident" id="3767665">z</span><span class="op" id="3767666">,</span>&nbsp;<span class="ident" id="3767668">v</span><span class="op" id="3767669">)</span>&nbsp;<span class="op" id="3767671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767675">z</span>&nbsp;<span class="op" id="3767677">=</span>&nbsp;<span class="ident" id="3767679">nil</span>&nbsp;<span class="comment" id="3767683">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;uIn&nbsp;or&nbsp;v&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3767729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767732">q</span>&nbsp;<span class="op" id="3767734">=</span>&nbsp;<span class="ident" id="3767736">z</span><span class="op" id="3767737">.</span><span class="builtinfunc" id="3767738">make</span><span class="op" id="3767742">(</span><span class="ident" id="3767743">m</span>&nbsp;<span class="op" id="3767745">+</span>&nbsp;<span class="num" id="3767747">1</span><span class="op" id="3767748">)</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767752">qhatv</span>&nbsp;<span class="op" id="3767758">:=</span>&nbsp;<span class="builtinfunc" id="3767761">make</span><span class="op" id="3767765">(</span><span class="ident" id="3767766">nat</span><span class="op" id="3767769">,</span>&nbsp;<span class="ident" id="3767771">n</span><span class="op" id="3767772">+</span><span class="num" id="3767773">1</span><span class="op" id="3767774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3767777">if</span>&nbsp;<span class="ident" id="3767780">alias</span><span class="op" id="3767785">(</span><span class="ident" id="3767786">u</span><span class="op" id="3767787">,</span>&nbsp;<span class="ident" id="3767789">uIn</span><span class="op" id="3767792">)</span>&nbsp;<span class="op" id="3767794">||</span>&nbsp;<span class="ident" id="3767797">alias</span><span class="op" id="3767802">(</span><span class="ident" id="3767803">u</span><span class="op" id="3767804">,</span>&nbsp;<span class="ident" id="3767806">v</span><span class="op" id="3767807">)</span>&nbsp;<span class="op" id="3767809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767813">u</span>&nbsp;<span class="op" id="3767815">=</span>&nbsp;<span class="ident" id="3767817">nil</span>&nbsp;<span class="comment" id="3767821">//&nbsp;u&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;uIn&nbsp;or&nbsp;v&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3767867">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767870">u</span>&nbsp;<span class="op" id="3767872">=</span>&nbsp;<span class="ident" id="3767874">u</span><span class="op" id="3767875">.</span><span class="builtinfunc" id="3767876">make</span><span class="op" id="3767880">(</span><span class="builtinfunc" id="3767881">len</span><span class="op" id="3767884">(</span><span class="ident" id="3767885">uIn</span><span class="op" id="3767888">)</span>&nbsp;<span class="op" id="3767890">+</span>&nbsp;<span class="num" id="3767892">1</span><span class="op" id="3767893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767896">u</span><span class="op" id="3767897">.</span><span class="ident" id="3767898">clear</span><span class="op" id="3767903">(</span><span class="op" id="3767904">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3767908">//&nbsp;D1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767916">shift</span>&nbsp;<span class="op" id="3767922">:=</span>&nbsp;<span class="ident" id="3767925">leadingZeros</span><span class="op" id="3767937">(</span><span class="ident" id="3767938">v</span><span class="op" id="3767939">[</span><span class="ident" id="3767940">n</span><span class="op" id="3767941">-</span><span class="num" id="3767942">1</span><span class="op" id="3767943">]</span><span class="op" id="3767944">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3767947">if</span>&nbsp;<span class="ident" id="3767950">shift</span>&nbsp;<span class="op" id="3767956">&gt;</span>&nbsp;<span class="num" id="3767958">0</span>&nbsp;<span class="op" id="3767960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3767964">//&nbsp;do&nbsp;not&nbsp;modify&nbsp;v,&nbsp;it&nbsp;may&nbsp;be&nbsp;used&nbsp;by&nbsp;another&nbsp;goroutine&nbsp;simultaneously</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768037">v1</span>&nbsp;<span class="op" id="3768040">:=</span>&nbsp;<span class="builtinfunc" id="3768043">make</span><span class="op" id="3768047">(</span><span class="ident" id="3768048">nat</span><span class="op" id="3768051">,</span>&nbsp;<span class="ident" id="3768053">n</span><span class="op" id="3768054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768058">shlVU</span><span class="op" id="3768063">(</span><span class="ident" id="3768064">v1</span><span class="op" id="3768066">,</span>&nbsp;<span class="ident" id="3768068">v</span><span class="op" id="3768069">,</span>&nbsp;<span class="ident" id="3768071">shift</span><span class="op" id="3768076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768080">v</span>&nbsp;<span class="op" id="3768082">=</span>&nbsp;<span class="ident" id="3768084">v1</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3768088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768091">u</span><span class="op" id="3768092">[</span><span class="builtinfunc" id="3768093">len</span><span class="op" id="3768096">(</span><span class="ident" id="3768097">uIn</span><span class="op" id="3768100">)</span><span class="op" id="3768101">]</span>&nbsp;<span class="op" id="3768103">=</span>&nbsp;<span class="ident" id="3768105">shlVU</span><span class="op" id="3768110">(</span><span class="ident" id="3768111">u</span><span class="op" id="3768112">[</span><span class="num" id="3768113">0</span><span class="op" id="3768114">:</span><span class="builtinfunc" id="3768115">len</span><span class="op" id="3768118">(</span><span class="ident" id="3768119">uIn</span><span class="op" id="3768122">)</span><span class="op" id="3768123">]</span><span class="op" id="3768124">,</span>&nbsp;<span class="ident" id="3768126">uIn</span><span class="op" id="3768129">,</span>&nbsp;<span class="ident" id="3768131">shift</span><span class="op" id="3768136">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3768140">//&nbsp;D2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768148">for</span>&nbsp;<span class="ident" id="3768152">j</span>&nbsp;<span class="op" id="3768154">:=</span>&nbsp;<span class="ident" id="3768157">m</span><span class="op" id="3768158">;</span>&nbsp;<span class="ident" id="3768160">j</span>&nbsp;<span class="op" id="3768162">&gt;=</span>&nbsp;<span class="num" id="3768165">0</span><span class="op" id="3768166">;</span>&nbsp;<span class="ident" id="3768168">j</span><span class="op" id="3768169">--</span>&nbsp;<span class="op" id="3768172">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3768176">//&nbsp;D3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768185">qhat</span>&nbsp;<span class="op" id="3768190">:=</span>&nbsp;<span class="ident" id="3768193">Word</span><span class="op" id="3768197">(</span><span class="ident" id="3768198">_M</span><span class="op" id="3768200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768204">if</span>&nbsp;<span class="ident" id="3768207">u</span><span class="op" id="3768208">[</span><span class="ident" id="3768209">j</span><span class="op" id="3768210">+</span><span class="ident" id="3768211">n</span><span class="op" id="3768212">]</span>&nbsp;<span class="op" id="3768214">!=</span>&nbsp;<span class="ident" id="3768217">v</span><span class="op" id="3768218">[</span><span class="ident" id="3768219">n</span><span class="op" id="3768220">-</span><span class="num" id="3768221">1</span><span class="op" id="3768222">]</span>&nbsp;<span class="op" id="3768224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768229">var</span>&nbsp;<span class="ident" id="3768233">rhat</span>&nbsp;<span class="ident" id="3768238">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768246">qhat</span><span class="op" id="3768250">,</span>&nbsp;<span class="ident" id="3768252">rhat</span>&nbsp;<span class="op" id="3768257">=</span>&nbsp;<span class="ident" id="3768259">divWW</span><span class="op" id="3768264">(</span><span class="ident" id="3768265">u</span><span class="op" id="3768266">[</span><span class="ident" id="3768267">j</span><span class="op" id="3768268">+</span><span class="ident" id="3768269">n</span><span class="op" id="3768270">]</span><span class="op" id="3768271">,</span>&nbsp;<span class="ident" id="3768273">u</span><span class="op" id="3768274">[</span><span class="ident" id="3768275">j</span><span class="op" id="3768276">+</span><span class="ident" id="3768277">n</span><span class="op" id="3768278">-</span><span class="num" id="3768279">1</span><span class="op" id="3768280">]</span><span class="op" id="3768281">,</span>&nbsp;<span class="ident" id="3768283">v</span><span class="op" id="3768284">[</span><span class="ident" id="3768285">n</span><span class="op" id="3768286">-</span><span class="num" id="3768287">1</span><span class="op" id="3768288">]</span><span class="op" id="3768289">)</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3768295">//&nbsp;x1&nbsp;|&nbsp;x2&nbsp;=&nbsp;qv_{n-2}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768322">x1</span><span class="op" id="3768324">,</span>&nbsp;<span class="ident" id="3768326">x2</span>&nbsp;<span class="op" id="3768329">:=</span>&nbsp;<span class="ident" id="3768332">mulWW</span><span class="op" id="3768337">(</span><span class="ident" id="3768338">qhat</span><span class="op" id="3768342">,</span>&nbsp;<span class="ident" id="3768344">v</span><span class="op" id="3768345">[</span><span class="ident" id="3768346">n</span><span class="op" id="3768347">-</span><span class="num" id="3768348">2</span><span class="op" id="3768349">]</span><span class="op" id="3768350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3768355">//&nbsp;test&nbsp;if&nbsp;qv_{n-2}&nbsp;&gt;&nbsp;br&nbsp;+&nbsp;u_{j+n-2}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768399">for</span>&nbsp;<span class="ident" id="3768403">greaterThan</span><span class="op" id="3768414">(</span><span class="ident" id="3768415">x1</span><span class="op" id="3768417">,</span>&nbsp;<span class="ident" id="3768419">x2</span><span class="op" id="3768421">,</span>&nbsp;<span class="ident" id="3768423">rhat</span><span class="op" id="3768427">,</span>&nbsp;<span class="ident" id="3768429">u</span><span class="op" id="3768430">[</span><span class="ident" id="3768431">j</span><span class="op" id="3768432">+</span><span class="ident" id="3768433">n</span><span class="op" id="3768434">-</span><span class="num" id="3768435">2</span><span class="op" id="3768436">]</span><span class="op" id="3768437">)</span>&nbsp;<span class="op" id="3768439">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768445">qhat</span><span class="op" id="3768449">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768456">prevRhat</span>&nbsp;<span class="op" id="3768465">:=</span>&nbsp;<span class="ident" id="3768468">rhat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768477">rhat</span>&nbsp;<span class="op" id="3768482">+=</span>&nbsp;<span class="ident" id="3768485">v</span><span class="op" id="3768486">[</span><span class="ident" id="3768487">n</span><span class="op" id="3768488">-</span><span class="num" id="3768489">1</span><span class="op" id="3768490">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3768496">//&nbsp;v[n-1]&nbsp;&gt;=&nbsp;0,&nbsp;so&nbsp;this&nbsp;tests&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768544">if</span>&nbsp;<span class="ident" id="3768547">rhat</span>&nbsp;<span class="op" id="3768552">&lt;</span>&nbsp;<span class="ident" id="3768554">prevRhat</span>&nbsp;<span class="op" id="3768563">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768570">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3768580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768586">x1</span><span class="op" id="3768588">,</span>&nbsp;<span class="ident" id="3768590">x2</span>&nbsp;<span class="op" id="3768593">=</span>&nbsp;<span class="ident" id="3768595">mulWW</span><span class="op" id="3768600">(</span><span class="ident" id="3768601">qhat</span><span class="op" id="3768605">,</span>&nbsp;<span class="ident" id="3768607">v</span><span class="op" id="3768608">[</span><span class="ident" id="3768609">n</span><span class="op" id="3768610">-</span><span class="num" id="3768611">2</span><span class="op" id="3768612">]</span><span class="op" id="3768613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3768618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3768622">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3768627">//&nbsp;D4.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768636">qhatv</span><span class="op" id="3768641">[</span><span class="ident" id="3768642">n</span><span class="op" id="3768643">]</span>&nbsp;<span class="op" id="3768645">=</span>&nbsp;<span class="ident" id="3768647">mulAddVWW</span><span class="op" id="3768656">(</span><span class="ident" id="3768657">qhatv</span><span class="op" id="3768662">[</span><span class="num" id="3768663">0</span><span class="op" id="3768664">:</span><span class="ident" id="3768665">n</span><span class="op" id="3768666">]</span><span class="op" id="3768667">,</span>&nbsp;<span class="ident" id="3768669">v</span><span class="op" id="3768670">,</span>&nbsp;<span class="ident" id="3768672">qhat</span><span class="op" id="3768676">,</span>&nbsp;<span class="num" id="3768678">0</span><span class="op" id="3768679">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768684">c</span>&nbsp;<span class="op" id="3768686">:=</span>&nbsp;<span class="ident" id="3768689">subVV</span><span class="op" id="3768694">(</span><span class="ident" id="3768695">u</span><span class="op" id="3768696">[</span><span class="ident" id="3768697">j</span><span class="op" id="3768698">:</span><span class="ident" id="3768699">j</span><span class="op" id="3768700">+</span><span class="builtinfunc" id="3768701">len</span><span class="op" id="3768704">(</span><span class="ident" id="3768705">qhatv</span><span class="op" id="3768710">)</span><span class="op" id="3768711">]</span><span class="op" id="3768712">,</span>&nbsp;<span class="ident" id="3768714">u</span><span class="op" id="3768715">[</span><span class="ident" id="3768716">j</span><span class="op" id="3768717">:</span><span class="op" id="3768718">]</span><span class="op" id="3768719">,</span>&nbsp;<span class="ident" id="3768721">qhatv</span><span class="op" id="3768726">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768730">if</span>&nbsp;<span class="ident" id="3768733">c</span>&nbsp;<span class="op" id="3768735">!=</span>&nbsp;<span class="num" id="3768738">0</span>&nbsp;<span class="op" id="3768740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768745">c</span>&nbsp;<span class="op" id="3768747">:=</span>&nbsp;<span class="ident" id="3768750">addVV</span><span class="op" id="3768755">(</span><span class="ident" id="3768756">u</span><span class="op" id="3768757">[</span><span class="ident" id="3768758">j</span><span class="op" id="3768759">:</span><span class="ident" id="3768760">j</span><span class="op" id="3768761">+</span><span class="ident" id="3768762">n</span><span class="op" id="3768763">]</span><span class="op" id="3768764">,</span>&nbsp;<span class="ident" id="3768766">u</span><span class="op" id="3768767">[</span><span class="ident" id="3768768">j</span><span class="op" id="3768769">:</span><span class="op" id="3768770">]</span><span class="op" id="3768771">,</span>&nbsp;<span class="ident" id="3768773">v</span><span class="op" id="3768774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768779">u</span><span class="op" id="3768780">[</span><span class="ident" id="3768781">j</span><span class="op" id="3768782">+</span><span class="ident" id="3768783">n</span><span class="op" id="3768784">]</span>&nbsp;<span class="op" id="3768786">+=</span>&nbsp;<span class="ident" id="3768789">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768794">qhat</span><span class="op" id="3768798">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3768803">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768808">q</span><span class="op" id="3768809">[</span><span class="ident" id="3768810">j</span><span class="op" id="3768811">]</span>&nbsp;<span class="op" id="3768813">=</span>&nbsp;<span class="ident" id="3768815">qhat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3768821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768825">q</span>&nbsp;<span class="op" id="3768827">=</span>&nbsp;<span class="ident" id="3768829">q</span><span class="op" id="3768830">.</span><span class="ident" id="3768831">norm</span><span class="op" id="3768835">(</span><span class="op" id="3768836">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768839">shrVU</span><span class="op" id="3768844">(</span><span class="ident" id="3768845">u</span><span class="op" id="3768846">,</span>&nbsp;<span class="ident" id="3768848">u</span><span class="op" id="3768849">,</span>&nbsp;<span class="ident" id="3768851">shift</span><span class="op" id="3768856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768859">r</span>&nbsp;<span class="op" id="3768861">=</span>&nbsp;<span class="ident" id="3768863">u</span><span class="op" id="3768864">.</span><span class="ident" id="3768865">norm</span><span class="op" id="3768869">(</span><span class="op" id="3768870">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768874">return</span>&nbsp;<span class="ident" id="3768881">q</span><span class="op" id="3768882">,</span>&nbsp;<span class="ident" id="3768884">r</span><br>
<span class="lineno"></span><span class="op" id="3768886">}</span><br>
<span class="lineno">600</span><br>
<span class="lineno"></span><span class="comment" id="3768889">//&nbsp;Length&nbsp;of&nbsp;x&nbsp;in&nbsp;bits.&nbsp;x&nbsp;must&nbsp;be&nbsp;normalized.</span><br>
<span class="lineno"></span><span class="keyword" id="3768935">func</span>&nbsp;<span class="op" id="3768940">(</span><span class="ident" id="3768941">x</span>&nbsp;<span class="ident" id="3768943">nat</span><span class="op" id="3768946">)</span>&nbsp;<span class="ident" id="3768948">bitLen</span><span class="op" id="3768954">(</span><span class="op" id="3768955">)</span>&nbsp;<span class="builtintype" id="3768957">int</span>&nbsp;<span class="op" id="3768961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768964">if</span>&nbsp;<span class="ident" id="3768967">i</span>&nbsp;<span class="op" id="3768969">:=</span>&nbsp;<span class="builtinfunc" id="3768972">len</span><span class="op" id="3768975">(</span><span class="ident" id="3768976">x</span><span class="op" id="3768977">)</span>&nbsp;<span class="op" id="3768979">-</span>&nbsp;<span class="num" id="3768981">1</span><span class="op" id="3768982">;</span>&nbsp;<span class="ident" id="3768984">i</span>&nbsp;<span class="op" id="3768986">&gt;=</span>&nbsp;<span class="num" id="3768989">0</span>&nbsp;<span class="op" id="3768991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768995">return</span>&nbsp;<span class="ident" id="3769002">i</span><span class="op" id="3769003">*</span><span class="ident" id="3769004">_W</span>&nbsp;<span class="op" id="3769007">+</span>&nbsp;<span class="ident" id="3769009">bitLen</span><span class="op" id="3769015">(</span><span class="ident" id="3769016">x</span><span class="op" id="3769017">[</span><span class="ident" id="3769018">i</span><span class="op" id="3769019">]</span><span class="op" id="3769020">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3769023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3769026">return</span>&nbsp;<span class="num" id="3769033">0</span><br>
<span class="lineno"></span><span class="op" id="3769035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3769038">//&nbsp;MaxBase&nbsp;is&nbsp;the&nbsp;largest&nbsp;number&nbsp;base&nbsp;accepted&nbsp;for&nbsp;string&nbsp;conversions.</span><br>
<span class="lineno">610</span><span class="keyword" id="3769109">const</span>&nbsp;<span class="ident" id="3769115">MaxBase</span>&nbsp;<span class="op" id="3769123">=</span>&nbsp;<span class="string" id="3769125">&#39;z&#39;</span>&nbsp;<span class="op" id="3769129">-</span>&nbsp;<span class="string" id="3769131">&#39;a&#39;</span>&nbsp;<span class="op" id="3769135">+</span>&nbsp;<span class="num" id="3769137">10</span>&nbsp;<span class="op" id="3769140">+</span>&nbsp;<span class="num" id="3769142">1</span>&nbsp;<span class="comment" id="3769144">//&nbsp;=&nbsp;hexValue(&#39;z&#39;)&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3769168">func</span>&nbsp;<span class="ident" id="3769173">hexValue</span><span class="op" id="3769181">(</span><span class="ident" id="3769182">ch</span>&nbsp;<span class="builtintype" id="3769185">rune</span><span class="op" id="3769189">)</span>&nbsp;<span class="ident" id="3769191">Word</span>&nbsp;<span class="op" id="3769196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3769199">d</span>&nbsp;<span class="op" id="3769201">:=</span>&nbsp;<span class="builtintype" id="3769204">int</span><span class="op" id="3769207">(</span><span class="ident" id="3769208">MaxBase</span>&nbsp;<span class="op" id="3769216">+</span>&nbsp;<span class="num" id="3769218">1</span><span class="op" id="3769219">)</span>&nbsp;<span class="comment" id="3769221">//&nbsp;illegal&nbsp;base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3769238">switch</span>&nbsp;<span class="op" id="3769245">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3769248">case</span>&nbsp;<span class="string" id="3769253">&#39;0&#39;</span>&nbsp;<span class="op" id="3769257">&lt;=</span>&nbsp;<span class="ident" id="3769260">ch</span>&nbsp;<span class="op" id="3769263">&amp;&amp;</span>&nbsp;<span class="ident" id="3769266">ch</span>&nbsp;<span class="op" id="3769269">&lt;=</span>&nbsp;<span class="string" id="3769272">&#39;9&#39;</span><span class="op" id="3769275">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3769279">d</span>&nbsp;<span class="op" id="3769281">=</span>&nbsp;<span class="builtintype" id="3769283">int</span><span class="op" id="3769286">(</span><span class="ident" id="3769287">ch</span>&nbsp;<span class="op" id="3769290">-</span>&nbsp;<span class="string" id="3769292">&#39;0&#39;</span><span class="op" id="3769295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3769298">case</span>&nbsp;<span class="string" id="3769303">&#39;a&#39;</span>&nbsp;<span class="op" id="3769307">&lt;=</span>&nbsp;<span class="ident" id="3769310">ch</span>&nbsp;<span class="op" id="3769313">&amp;&amp;</span>&nbsp;<span class="ident" id="3769316">ch</span>&nbsp;<span class="op" id="3769319">&lt;=</span>&nbsp;<span class="string" id="3769322">&#39;z&#39;</span><span class="op" id="3769325">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3769329">d</span>&nbsp;<span class="op" id="3769331">=</span>&nbsp;<span class="builtintype" id="3769333">int</span><span class="op" id="3769336">(</span><span class="ident" id="3769337">ch</span>&nbsp;<span class="op" id="3769340">-</span>&nbsp;<span class="string" id="3769342">&#39;a&#39;</span>&nbsp;<span class="op" id="3769346">+</span>&nbsp;<span class="num" id="3769348">10</span><span class="op" id="3769350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3769353">case</span>&nbsp;<span class="string" id="3769358">&#39;A&#39;</span>&nbsp;<span class="op" id="3769362">&lt;=</span>&nbsp;<span class="ident" id="3769365">ch</span>&nbsp;<span class="op" id="3769368">&amp;&amp;</span>&nbsp;<span class="ident" id="3769371">ch</span>&nbsp;<span class="op" id="3769374">&lt;=</span>&nbsp;<span class="string" id="3769377">&#39;Z&#39;</span><span class="op" id="3769380">:</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3769384">d</span>&nbsp;<span class="op" id="3769386">=</span>&nbsp;<span class="builtintype" id="3769388">int</span><span class="op" id="3769391">(</span><span class="ident" id="3769392">ch</span>&nbsp;<span class="op" id="3769395">-</span>&nbsp;<span class="string" id="3769397">&#39;A&#39;</span>&nbsp;<span class="op" id="3769401">+</span>&nbsp;<span class="num" id="3769403">10</span><span class="op" id="3769405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3769408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3769411">return</span>&nbsp;<span class="ident" id="3769418">Word</span><span class="op" id="3769422">(</span><span class="ident" id="3769423">d</span><span class="op" id="3769424">)</span><br>
<span class="lineno"></span><span class="op" id="3769426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">625</span><span class="comment" id="3769429">//&nbsp;scan&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;natural&nbsp;number&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;longest&nbsp;possible&nbsp;prefix</span><br>
<span class="lineno"></span><span class="comment" id="3769511">//&nbsp;read&nbsp;from&nbsp;r&nbsp;representing&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;in&nbsp;a&nbsp;given&nbsp;conversion&nbsp;base.</span><br>
<span class="lineno"></span><span class="comment" id="3769587">//&nbsp;It&nbsp;returns&nbsp;z,&nbsp;the&nbsp;actual&nbsp;conversion&nbsp;base&nbsp;used,&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.&nbsp;In&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3769666">//&nbsp;error&nbsp;case,&nbsp;the&nbsp;value&nbsp;of&nbsp;z&nbsp;is&nbsp;undefined.&nbsp;The&nbsp;syntax&nbsp;follows&nbsp;the&nbsp;syntax&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3769743">//&nbsp;unsigned&nbsp;integer&nbsp;literals&nbsp;in&nbsp;Go.</span><br>
<span class="lineno">630</span><span class="comment" id="3769779">//</span><br>
<span class="lineno"></span><span class="comment" id="3769782">//&nbsp;The&nbsp;base&nbsp;argument&nbsp;must&nbsp;be&nbsp;0&nbsp;or&nbsp;a&nbsp;value&nbsp;from&nbsp;2&nbsp;through&nbsp;MaxBase.&nbsp;If&nbsp;the&nbsp;base</span><br>
<span class="lineno"></span><span class="comment" id="3769860">//&nbsp;is&nbsp;0,&nbsp;the&nbsp;string&nbsp;prefix&nbsp;determines&nbsp;the&nbsp;actual&nbsp;conversion&nbsp;base.&nbsp;A&nbsp;prefix&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3769938">//&nbsp;``0x&#39;&#39;&nbsp;or&nbsp;``0X&#39;&#39;&nbsp;selects&nbsp;base&nbsp;16;&nbsp;the&nbsp;``0&#39;&#39;&nbsp;prefix&nbsp;selects&nbsp;base&nbsp;8,&nbsp;and&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3770014">//&nbsp;``0b&#39;&#39;&nbsp;or&nbsp;``0B&#39;&#39;&nbsp;prefix&nbsp;selects&nbsp;base&nbsp;2.&nbsp;Otherwise&nbsp;the&nbsp;selected&nbsp;base&nbsp;is&nbsp;10.</span><br>
<span class="lineno">635</span><span class="comment" id="3770092">//</span><br>
<span class="lineno"></span><span class="keyword" id="3770095">func</span>&nbsp;<span class="op" id="3770100">(</span><span class="ident" id="3770101">z</span>&nbsp;<span class="ident" id="3770103">nat</span><span class="op" id="3770106">)</span>&nbsp;<span class="ident" id="3770108">scan</span><span class="op" id="3770112">(</span><span class="ident" id="3770113">r</span>&nbsp;<span class="ident" id="3770115">io</span><span class="op" id="3770117">.</span><span class="ident" id="3770118">RuneScanner</span><span class="op" id="3770129">,</span>&nbsp;<span class="ident" id="3770131">base</span>&nbsp;<span class="builtintype" id="3770136">int</span><span class="op" id="3770139">)</span>&nbsp;<span class="op" id="3770141">(</span><span class="ident" id="3770142">nat</span><span class="op" id="3770145">,</span>&nbsp;<span class="builtintype" id="3770147">int</span><span class="op" id="3770150">,</span>&nbsp;<span class="builtintype" id="3770152">error</span><span class="op" id="3770157">)</span>&nbsp;<span class="op" id="3770159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770162">//&nbsp;reject&nbsp;illegal&nbsp;bases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770187">if</span>&nbsp;<span class="ident" id="3770190">base</span>&nbsp;<span class="op" id="3770195">&lt;</span>&nbsp;<span class="num" id="3770197">0</span>&nbsp;<span class="op" id="3770199">||</span>&nbsp;<span class="ident" id="3770202">base</span>&nbsp;<span class="op" id="3770207">==</span>&nbsp;<span class="num" id="3770210">1</span>&nbsp;<span class="op" id="3770212">||</span>&nbsp;<span class="ident" id="3770215">MaxBase</span>&nbsp;<span class="op" id="3770223">&lt;</span>&nbsp;<span class="ident" id="3770225">base</span>&nbsp;<span class="op" id="3770230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770234">return</span>&nbsp;<span class="ident" id="3770241">z</span><span class="op" id="3770242">,</span>&nbsp;<span class="num" id="3770244">0</span><span class="op" id="3770245">,</span>&nbsp;<span class="ident" id="3770247">errors</span><span class="op" id="3770253">.</span><span class="ident" id="3770254">New</span><span class="op" id="3770257">(</span><span class="string" id="3770258">&#34;illegal&nbsp;number&nbsp;base&#34;</span><span class="op" id="3770279">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3770282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770286">//&nbsp;one&nbsp;char&nbsp;look-ahead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770310">ch</span><span class="op" id="3770312">,</span>&nbsp;<span class="ident" id="3770314">_</span><span class="op" id="3770315">,</span>&nbsp;<span class="ident" id="3770317">err</span>&nbsp;<span class="op" id="3770321">:=</span>&nbsp;<span class="ident" id="3770324">r</span><span class="op" id="3770325">.</span><span class="ident" id="3770326">ReadRune</span><span class="op" id="3770334">(</span><span class="op" id="3770335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770338">if</span>&nbsp;<span class="ident" id="3770341">err</span>&nbsp;<span class="op" id="3770345">!=</span>&nbsp;<span class="ident" id="3770348">nil</span>&nbsp;<span class="op" id="3770352">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770356">return</span>&nbsp;<span class="ident" id="3770363">z</span><span class="op" id="3770364">,</span>&nbsp;<span class="num" id="3770366">0</span><span class="op" id="3770367">,</span>&nbsp;<span class="ident" id="3770369">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3770374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770378">//&nbsp;determine&nbsp;base&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770410">b</span>&nbsp;<span class="op" id="3770412">:=</span>&nbsp;<span class="ident" id="3770415">Word</span><span class="op" id="3770419">(</span><span class="ident" id="3770420">base</span><span class="op" id="3770424">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770427">if</span>&nbsp;<span class="ident" id="3770430">base</span>&nbsp;<span class="op" id="3770435">==</span>&nbsp;<span class="num" id="3770438">0</span>&nbsp;<span class="op" id="3770440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770444">b</span>&nbsp;<span class="op" id="3770446">=</span>&nbsp;<span class="num" id="3770448">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770453">if</span>&nbsp;<span class="ident" id="3770456">ch</span>&nbsp;<span class="op" id="3770459">==</span>&nbsp;<span class="string" id="3770462">&#39;0&#39;</span>&nbsp;<span class="op" id="3770466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770471">switch</span>&nbsp;<span class="ident" id="3770478">ch</span><span class="op" id="3770480">,</span>&nbsp;<span class="ident" id="3770482">_</span><span class="op" id="3770483">,</span>&nbsp;<span class="ident" id="3770485">err</span>&nbsp;<span class="op" id="3770489">=</span>&nbsp;<span class="ident" id="3770491">r</span><span class="op" id="3770492">.</span><span class="ident" id="3770493">ReadRune</span><span class="op" id="3770501">(</span><span class="op" id="3770502">)</span><span class="op" id="3770503">;</span>&nbsp;<span class="ident" id="3770505">err</span>&nbsp;<span class="op" id="3770509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770514">case</span>&nbsp;<span class="ident" id="3770519">nil</span><span class="op" id="3770522">:</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770528">b</span>&nbsp;<span class="op" id="3770530">=</span>&nbsp;<span class="num" id="3770532">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770538">switch</span>&nbsp;<span class="ident" id="3770545">ch</span>&nbsp;<span class="op" id="3770548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770554">case</span>&nbsp;<span class="string" id="3770559">&#39;x&#39;</span><span class="op" id="3770562">,</span>&nbsp;<span class="string" id="3770564">&#39;X&#39;</span><span class="op" id="3770567">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770574">b</span>&nbsp;<span class="op" id="3770576">=</span>&nbsp;<span class="num" id="3770578">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770585">case</span>&nbsp;<span class="string" id="3770590">&#39;b&#39;</span><span class="op" id="3770593">,</span>&nbsp;<span class="string" id="3770595">&#39;B&#39;</span><span class="op" id="3770598">:</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770605">b</span>&nbsp;<span class="op" id="3770607">=</span>&nbsp;<span class="num" id="3770609">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3770615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770621">if</span>&nbsp;<span class="ident" id="3770624">b</span>&nbsp;<span class="op" id="3770626">==</span>&nbsp;<span class="num" id="3770629">2</span>&nbsp;<span class="op" id="3770631">||</span>&nbsp;<span class="ident" id="3770634">b</span>&nbsp;<span class="op" id="3770636">==</span>&nbsp;<span class="num" id="3770639">16</span>&nbsp;<span class="op" id="3770642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770649">if</span>&nbsp;<span class="ident" id="3770652">ch</span><span class="op" id="3770654">,</span>&nbsp;<span class="ident" id="3770656">_</span><span class="op" id="3770657">,</span>&nbsp;<span class="ident" id="3770659">err</span>&nbsp;<span class="op" id="3770663">=</span>&nbsp;<span class="ident" id="3770665">r</span><span class="op" id="3770666">.</span><span class="ident" id="3770667">ReadRune</span><span class="op" id="3770675">(</span><span class="op" id="3770676">)</span><span class="op" id="3770677">;</span>&nbsp;<span class="ident" id="3770679">err</span>&nbsp;<span class="op" id="3770683">!=</span>&nbsp;<span class="ident" id="3770686">nil</span>&nbsp;<span class="op" id="3770690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770698">return</span>&nbsp;<span class="ident" id="3770705">z</span><span class="op" id="3770706">,</span>&nbsp;<span class="num" id="3770708">0</span><span class="op" id="3770709">,</span>&nbsp;<span class="ident" id="3770711">err</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3770720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3770726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770731">case</span>&nbsp;<span class="ident" id="3770736">io</span><span class="op" id="3770738">.</span><span class="ident" id="3770739">EOF</span><span class="op" id="3770742">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770748">return</span>&nbsp;<span class="ident" id="3770755">z</span><span class="op" id="3770756">.</span><span class="builtinfunc" id="3770757">make</span><span class="op" id="3770761">(</span><span class="num" id="3770762">0</span><span class="op" id="3770763">)</span><span class="op" id="3770764">,</span>&nbsp;<span class="num" id="3770766">10</span><span class="op" id="3770768">,</span>&nbsp;<span class="ident" id="3770770">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770777">default</span><span class="op" id="3770784">:</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770790">return</span>&nbsp;<span class="ident" id="3770797">z</span><span class="op" id="3770798">,</span>&nbsp;<span class="num" id="3770800">10</span><span class="op" id="3770802">,</span>&nbsp;<span class="ident" id="3770804">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3770811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3770815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3770818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770822">//&nbsp;convert&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770841">//&nbsp;-&nbsp;group&nbsp;as&nbsp;many&nbsp;digits&nbsp;d&nbsp;as&nbsp;possible&nbsp;together&nbsp;into&nbsp;a&nbsp;&#34;super-digit&#34;&nbsp;dd&nbsp;with&nbsp;&#34;super-base&#34;&nbsp;bb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770936">//&nbsp;-&nbsp;only&nbsp;when&nbsp;bb&nbsp;does&nbsp;not&nbsp;fit&nbsp;into&nbsp;a&nbsp;word&nbsp;anymore,&nbsp;do&nbsp;a&nbsp;full&nbsp;number&nbsp;mulAddWW&nbsp;using&nbsp;bb&nbsp;and&nbsp;dd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771031">z</span>&nbsp;<span class="op" id="3771033">=</span>&nbsp;<span class="ident" id="3771035">z</span><span class="op" id="3771036">.</span><span class="builtinfunc" id="3771037">make</span><span class="op" id="3771041">(</span><span class="num" id="3771042">0</span><span class="op" id="3771043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771046">bb</span>&nbsp;<span class="op" id="3771049">:=</span>&nbsp;<span class="ident" id="3771052">Word</span><span class="op" id="3771056">(</span><span class="num" id="3771057">1</span><span class="op" id="3771058">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771061">dd</span>&nbsp;<span class="op" id="3771064">:=</span>&nbsp;<span class="ident" id="3771067">Word</span><span class="op" id="3771071">(</span><span class="num" id="3771072">0</span><span class="op" id="3771073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771076">for</span>&nbsp;<span class="ident" id="3771080">max</span>&nbsp;<span class="op" id="3771084">:=</span>&nbsp;<span class="ident" id="3771087">_M</span>&nbsp;<span class="op" id="3771090">/</span>&nbsp;<span class="ident" id="3771092">b</span><span class="op" id="3771093">;</span>&nbsp;<span class="op" id="3771095">;</span>&nbsp;<span class="op" id="3771097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771101">d</span>&nbsp;<span class="op" id="3771103">:=</span>&nbsp;<span class="ident" id="3771106">hexValue</span><span class="op" id="3771114">(</span><span class="ident" id="3771115">ch</span><span class="op" id="3771117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771121">if</span>&nbsp;<span class="ident" id="3771124">d</span>&nbsp;<span class="op" id="3771126">&gt;=</span>&nbsp;<span class="ident" id="3771129">b</span>&nbsp;<span class="op" id="3771131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771136">r</span><span class="op" id="3771137">.</span><span class="ident" id="3771138">UnreadRune</span><span class="op" id="3771148">(</span><span class="op" id="3771149">)</span>&nbsp;<span class="comment" id="3771151">//&nbsp;ch&nbsp;does&nbsp;not&nbsp;belong&nbsp;to&nbsp;number&nbsp;anymore</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771194">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3771202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771207">if</span>&nbsp;<span class="ident" id="3771210">bb</span>&nbsp;<span class="op" id="3771213">&lt;=</span>&nbsp;<span class="ident" id="3771216">max</span>&nbsp;<span class="op" id="3771220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771225">bb</span>&nbsp;<span class="op" id="3771228">*=</span>&nbsp;<span class="ident" id="3771231">b</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771236">dd</span>&nbsp;<span class="op" id="3771239">=</span>&nbsp;<span class="ident" id="3771241">dd</span><span class="op" id="3771243">*</span><span class="ident" id="3771244">b</span>&nbsp;<span class="op" id="3771246">+</span>&nbsp;<span class="ident" id="3771248">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3771252">}</span>&nbsp;<span class="keyword" id="3771254">else</span>&nbsp;<span class="op" id="3771259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771264">//&nbsp;bb&nbsp;*&nbsp;b&nbsp;would&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771292">z</span>&nbsp;<span class="op" id="3771294">=</span>&nbsp;<span class="ident" id="3771296">z</span><span class="op" id="3771297">.</span><span class="ident" id="3771298">mulAddWW</span><span class="op" id="3771306">(</span><span class="ident" id="3771307">z</span><span class="op" id="3771308">,</span>&nbsp;<span class="ident" id="3771310">bb</span><span class="op" id="3771312">,</span>&nbsp;<span class="ident" id="3771314">dd</span><span class="op" id="3771316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771321">bb</span>&nbsp;<span class="op" id="3771324">=</span>&nbsp;<span class="ident" id="3771326">b</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771331">dd</span>&nbsp;<span class="op" id="3771334">=</span>&nbsp;<span class="ident" id="3771336">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3771340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771345">if</span>&nbsp;<span class="ident" id="3771348">ch</span><span class="op" id="3771350">,</span>&nbsp;<span class="ident" id="3771352">_</span><span class="op" id="3771353">,</span>&nbsp;<span class="ident" id="3771355">err</span>&nbsp;<span class="op" id="3771359">=</span>&nbsp;<span class="ident" id="3771361">r</span><span class="op" id="3771362">.</span><span class="ident" id="3771363">ReadRune</span><span class="op" id="3771371">(</span><span class="op" id="3771372">)</span><span class="op" id="3771373">;</span>&nbsp;<span class="ident" id="3771375">err</span>&nbsp;<span class="op" id="3771379">!=</span>&nbsp;<span class="ident" id="3771382">nil</span>&nbsp;<span class="op" id="3771386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771391">if</span>&nbsp;<span class="ident" id="3771394">err</span>&nbsp;<span class="op" id="3771398">!=</span>&nbsp;<span class="ident" id="3771401">io</span><span class="op" id="3771403">.</span><span class="ident" id="3771404">EOF</span>&nbsp;<span class="op" id="3771408">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771414">return</span>&nbsp;<span class="ident" id="3771421">z</span><span class="op" id="3771422">,</span>&nbsp;<span class="builtintype" id="3771424">int</span><span class="op" id="3771427">(</span><span class="ident" id="3771428">b</span><span class="op" id="3771429">)</span><span class="op" id="3771430">,</span>&nbsp;<span class="ident" id="3771432">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3771439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771444">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3771452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3771455">}</span><br>
<span class="lineno">705</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771459">switch</span>&nbsp;<span class="op" id="3771466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771469">case</span>&nbsp;<span class="ident" id="3771474">bb</span>&nbsp;<span class="op" id="3771477">&gt;</span>&nbsp;<span class="num" id="3771479">1</span><span class="op" id="3771480">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771484">//&nbsp;there&nbsp;was&nbsp;at&nbsp;least&nbsp;one&nbsp;mantissa&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771527">z</span>&nbsp;<span class="op" id="3771529">=</span>&nbsp;<span class="ident" id="3771531">z</span><span class="op" id="3771532">.</span><span class="ident" id="3771533">mulAddWW</span><span class="op" id="3771541">(</span><span class="ident" id="3771542">z</span><span class="op" id="3771543">,</span>&nbsp;<span class="ident" id="3771545">bb</span><span class="op" id="3771547">,</span>&nbsp;<span class="ident" id="3771549">dd</span><span class="op" id="3771551">)</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771554">case</span>&nbsp;<span class="ident" id="3771559">base</span>&nbsp;<span class="op" id="3771564">==</span>&nbsp;<span class="num" id="3771567">0</span>&nbsp;<span class="op" id="3771569">&amp;&amp;</span>&nbsp;<span class="ident" id="3771572">b</span>&nbsp;<span class="op" id="3771574">==</span>&nbsp;<span class="num" id="3771577">8</span><span class="op" id="3771578">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771582">//&nbsp;there&nbsp;was&nbsp;only&nbsp;the&nbsp;octal&nbsp;prefix&nbsp;0&nbsp;(possibly&nbsp;followed&nbsp;by&nbsp;digits&nbsp;&gt;&nbsp;7);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771656">//&nbsp;return&nbsp;base&nbsp;10,&nbsp;not&nbsp;8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771683">return</span>&nbsp;<span class="ident" id="3771690">z</span><span class="op" id="3771691">,</span>&nbsp;<span class="num" id="3771693">10</span><span class="op" id="3771695">,</span>&nbsp;<span class="ident" id="3771697">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771702">case</span>&nbsp;<span class="ident" id="3771707">base</span>&nbsp;<span class="op" id="3771712">!=</span>&nbsp;<span class="num" id="3771715">0</span>&nbsp;<span class="op" id="3771717">||</span>&nbsp;<span class="ident" id="3771720">b</span>&nbsp;<span class="op" id="3771722">!=</span>&nbsp;<span class="num" id="3771725">8</span><span class="op" id="3771726">:</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771730">//&nbsp;there&nbsp;was&nbsp;neither&nbsp;a&nbsp;mantissa&nbsp;digit&nbsp;nor&nbsp;the&nbsp;octal&nbsp;prefix&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771793">return</span>&nbsp;<span class="ident" id="3771800">z</span><span class="op" id="3771801">,</span>&nbsp;<span class="builtintype" id="3771803">int</span><span class="op" id="3771806">(</span><span class="ident" id="3771807">b</span><span class="op" id="3771808">)</span><span class="op" id="3771809">,</span>&nbsp;<span class="ident" id="3771811">errors</span><span class="op" id="3771817">.</span><span class="ident" id="3771818">New</span><span class="op" id="3771821">(</span><span class="string" id="3771822">&#34;syntax&nbsp;error&nbsp;scanning&nbsp;number&#34;</span><span class="op" id="3771852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3771855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771859">return</span>&nbsp;<span class="ident" id="3771866">z</span><span class="op" id="3771867">.</span><span class="ident" id="3771868">norm</span><span class="op" id="3771872">(</span><span class="op" id="3771873">)</span><span class="op" id="3771874">,</span>&nbsp;<span class="builtintype" id="3771876">int</span><span class="op" id="3771879">(</span><span class="ident" id="3771880">b</span><span class="op" id="3771881">)</span><span class="op" id="3771882">,</span>&nbsp;<span class="ident" id="3771884">nil</span><br>
<span class="lineno">720</span><span class="op" id="3771888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3771891">//&nbsp;Character&nbsp;sets&nbsp;for&nbsp;string&nbsp;conversion.</span><br>
<span class="lineno"></span><span class="keyword" id="3771932">const</span>&nbsp;<span class="op" id="3771938">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771941">lowercaseDigits</span>&nbsp;<span class="op" id="3771957">=</span>&nbsp;<span class="string" id="3771959">&#34;0123456789abcdefghijklmnopqrstuvwxyz&#34;</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771999">uppercaseDigits</span>&nbsp;<span class="op" id="3772015">=</span>&nbsp;<span class="string" id="3772017">&#34;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><br>
<span class="lineno"></span><span class="op" id="3772056">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3772059">//&nbsp;decimalString&nbsp;returns&nbsp;a&nbsp;decimal&nbsp;representation&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="3772115">//&nbsp;It&nbsp;calls&nbsp;x.string&nbsp;with&nbsp;the&nbsp;charset&nbsp;&#34;0123456789&#34;.</span><br>
<span class="lineno">730</span><span class="keyword" id="3772167">func</span>&nbsp;<span class="op" id="3772172">(</span><span class="ident" id="3772173">x</span>&nbsp;<span class="ident" id="3772175">nat</span><span class="op" id="3772178">)</span>&nbsp;<span class="ident" id="3772180">decimalString</span><span class="op" id="3772193">(</span><span class="op" id="3772194">)</span>&nbsp;<span class="builtintype" id="3772196">string</span>&nbsp;<span class="op" id="3772203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772206">return</span>&nbsp;<span class="ident" id="3772213">x</span><span class="op" id="3772214">.</span><span class="builtintype" id="3772215">string</span><span class="op" id="3772221">(</span><span class="ident" id="3772222">lowercaseDigits</span><span class="op" id="3772237">[</span><span class="num" id="3772238">0</span><span class="op" id="3772239">:</span><span class="num" id="3772240">10</span><span class="op" id="3772242">]</span><span class="op" id="3772243">)</span><br>
<span class="lineno"></span><span class="op" id="3772245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3772248">//&nbsp;string&nbsp;converts&nbsp;x&nbsp;to&nbsp;a&nbsp;string&nbsp;using&nbsp;digits&nbsp;from&nbsp;a&nbsp;charset;&nbsp;a&nbsp;digit&nbsp;with</span><br>
<span class="lineno">735</span><span class="comment" id="3772323">//&nbsp;value&nbsp;d&nbsp;is&nbsp;represented&nbsp;by&nbsp;charset[d].&nbsp;The&nbsp;conversion&nbsp;base&nbsp;is&nbsp;determined</span><br>
<span class="lineno"></span><span class="comment" id="3772398">//&nbsp;by&nbsp;len(charset),&nbsp;which&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;2&nbsp;and&nbsp;&lt;=&nbsp;256.</span><br>
<span class="lineno"></span><span class="keyword" id="3772449">func</span>&nbsp;<span class="op" id="3772454">(</span><span class="ident" id="3772455">x</span>&nbsp;<span class="ident" id="3772457">nat</span><span class="op" id="3772460">)</span>&nbsp;<span class="builtintype" id="3772462">string</span><span class="op" id="3772468">(</span><span class="ident" id="3772469">charset</span>&nbsp;<span class="builtintype" id="3772477">string</span><span class="op" id="3772483">)</span>&nbsp;<span class="builtintype" id="3772485">string</span>&nbsp;<span class="op" id="3772492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772495">b</span>&nbsp;<span class="op" id="3772497">:=</span>&nbsp;<span class="ident" id="3772500">Word</span><span class="op" id="3772504">(</span><span class="builtinfunc" id="3772505">len</span><span class="op" id="3772508">(</span><span class="ident" id="3772509">charset</span><span class="op" id="3772516">)</span><span class="op" id="3772517">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3772521">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772539">switch</span>&nbsp;<span class="op" id="3772546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772549">case</span>&nbsp;<span class="ident" id="3772554">b</span>&nbsp;<span class="op" id="3772556">&lt;</span>&nbsp;<span class="num" id="3772558">2</span>&nbsp;<span class="op" id="3772560">||</span>&nbsp;<span class="ident" id="3772563">MaxBase</span>&nbsp;<span class="op" id="3772571">&gt;</span>&nbsp;<span class="num" id="3772573">256</span><span class="op" id="3772576">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3772580">panic</span><span class="op" id="3772585">(</span><span class="string" id="3772586">&#34;illegal&nbsp;base&#34;</span><span class="op" id="3772600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772603">case</span>&nbsp;<span class="builtinfunc" id="3772608">len</span><span class="op" id="3772611">(</span><span class="ident" id="3772612">x</span><span class="op" id="3772613">)</span>&nbsp;<span class="op" id="3772615">==</span>&nbsp;<span class="num" id="3772618">0</span><span class="op" id="3772619">:</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772623">return</span>&nbsp;<span class="builtintype" id="3772630">string</span><span class="op" id="3772636">(</span><span class="ident" id="3772637">charset</span><span class="op" id="3772644">[</span><span class="num" id="3772645">0</span><span class="op" id="3772646">]</span><span class="op" id="3772647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3772654">//&nbsp;allocate&nbsp;buffer&nbsp;for&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772689">i</span>&nbsp;<span class="op" id="3772691">:=</span>&nbsp;<span class="builtintype" id="3772694">int</span><span class="op" id="3772697">(</span><span class="builtintype" id="3772698">float64</span><span class="op" id="3772705">(</span><span class="ident" id="3772706">x</span><span class="op" id="3772707">.</span><span class="ident" id="3772708">bitLen</span><span class="op" id="3772714">(</span><span class="op" id="3772715">)</span><span class="op" id="3772716">)</span><span class="op" id="3772717">/</span><span class="ident" id="3772718">math</span><span class="op" id="3772722">.</span><span class="ident" id="3772723">Log2</span><span class="op" id="3772727">(</span><span class="builtintype" id="3772728">float64</span><span class="op" id="3772735">(</span><span class="ident" id="3772736">b</span><span class="op" id="3772737">)</span><span class="op" id="3772738">)</span><span class="op" id="3772739">)</span>&nbsp;<span class="op" id="3772741">+</span>&nbsp;<span class="num" id="3772743">1</span>&nbsp;<span class="comment" id="3772745">//&nbsp;off&nbsp;by&nbsp;one&nbsp;at&nbsp;most</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772768">s</span>&nbsp;<span class="op" id="3772770">:=</span>&nbsp;<span class="builtinfunc" id="3772773">make</span><span class="op" id="3772777">(</span><span class="op" id="3772778">[</span><span class="op" id="3772779">]</span><span class="builtintype" id="3772780">byte</span><span class="op" id="3772784">,</span>&nbsp;<span class="ident" id="3772786">i</span><span class="op" id="3772787">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3772791">//&nbsp;convert&nbsp;power&nbsp;of&nbsp;two&nbsp;and&nbsp;non&nbsp;power&nbsp;of&nbsp;two&nbsp;bases&nbsp;separately</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772854">if</span>&nbsp;<span class="ident" id="3772857">b</span>&nbsp;<span class="op" id="3772859">==</span>&nbsp;<span class="ident" id="3772862">b</span><span class="op" id="3772863">&amp;</span><span class="op" id="3772864">-</span><span class="ident" id="3772865">b</span>&nbsp;<span class="op" id="3772867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3772871">//&nbsp;shift&nbsp;is&nbsp;base-b&nbsp;digit&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772911">shift</span>&nbsp;<span class="op" id="3772917">:=</span>&nbsp;<span class="ident" id="3772920">trailingZeroBits</span><span class="op" id="3772936">(</span><span class="ident" id="3772937">b</span><span class="op" id="3772938">)</span>&nbsp;<span class="comment" id="3772940">//&nbsp;shift&nbsp;&gt;&nbsp;0&nbsp;because&nbsp;b&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772970">mask</span>&nbsp;<span class="op" id="3772975">:=</span>&nbsp;<span class="ident" id="3772978">Word</span><span class="op" id="3772982">(</span><span class="num" id="3772983">1</span><span class="op" id="3772984">)</span><span class="op" id="3772985">&lt;&lt;</span><span class="ident" id="3772987">shift</span>&nbsp;<span class="op" id="3772993">-</span>&nbsp;<span class="num" id="3772995">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772999">w</span>&nbsp;<span class="op" id="3773001">:=</span>&nbsp;<span class="ident" id="3773004">x</span><span class="op" id="3773005">[</span><span class="num" id="3773006">0</span><span class="op" id="3773007">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773011">nbits</span>&nbsp;<span class="op" id="3773017">:=</span>&nbsp;<span class="builtintype" id="3773020">uint</span><span class="op" id="3773024">(</span><span class="ident" id="3773025">_W</span><span class="op" id="3773027">)</span>&nbsp;<span class="comment" id="3773029">//&nbsp;number&nbsp;of&nbsp;unprocessed&nbsp;bits&nbsp;in&nbsp;w</span><br>
<span class="lineno"></span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773067">//&nbsp;convert&nbsp;less-significant&nbsp;words</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773103">for</span>&nbsp;<span class="ident" id="3773107">k</span>&nbsp;<span class="op" id="3773109">:=</span>&nbsp;<span class="num" id="3773112">1</span><span class="op" id="3773113">;</span>&nbsp;<span class="ident" id="3773115">k</span>&nbsp;<span class="op" id="3773117">&lt;</span>&nbsp;<span class="builtinfunc" id="3773119">len</span><span class="op" id="3773122">(</span><span class="ident" id="3773123">x</span><span class="op" id="3773124">)</span><span class="op" id="3773125">;</span>&nbsp;<span class="ident" id="3773127">k</span><span class="op" id="3773128">++</span>&nbsp;<span class="op" id="3773131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773136">//&nbsp;convert&nbsp;full&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773162">for</span>&nbsp;<span class="ident" id="3773166">nbits</span>&nbsp;<span class="op" id="3773172">&gt;=</span>&nbsp;<span class="ident" id="3773175">shift</span>&nbsp;<span class="op" id="3773181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773187">i</span><span class="op" id="3773188">--</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773195">s</span><span class="op" id="3773196">[</span><span class="ident" id="3773197">i</span><span class="op" id="3773198">]</span>&nbsp;<span class="op" id="3773200">=</span>&nbsp;<span class="ident" id="3773202">charset</span><span class="op" id="3773209">[</span><span class="ident" id="3773210">w</span><span class="op" id="3773211">&amp;</span><span class="ident" id="3773212">mask</span><span class="op" id="3773216">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773222">w</span>&nbsp;<span class="op" id="3773224">&gt;&gt;=</span>&nbsp;<span class="ident" id="3773228">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773238">nbits</span>&nbsp;<span class="op" id="3773244">-=</span>&nbsp;<span class="ident" id="3773247">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3773256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773262">//&nbsp;convert&nbsp;any&nbsp;partial&nbsp;leading&nbsp;digit&nbsp;and&nbsp;advance&nbsp;to&nbsp;next&nbsp;word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773327">if</span>&nbsp;<span class="ident" id="3773330">nbits</span>&nbsp;<span class="op" id="3773336">==</span>&nbsp;<span class="num" id="3773339">0</span>&nbsp;<span class="op" id="3773341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773347">//&nbsp;no&nbsp;partial&nbsp;digit&nbsp;remaining,&nbsp;just&nbsp;advance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773395">w</span>&nbsp;<span class="op" id="3773397">=</span>&nbsp;<span class="ident" id="3773399">x</span><span class="op" id="3773400">[</span><span class="ident" id="3773401">k</span><span class="op" id="3773402">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773408">nbits</span>&nbsp;<span class="op" id="3773414">=</span>&nbsp;<span class="ident" id="3773416">_W</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3773422">}</span>&nbsp;<span class="keyword" id="3773424">else</span>&nbsp;<span class="op" id="3773429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773435">//&nbsp;partial&nbsp;digit&nbsp;in&nbsp;current&nbsp;(k-1)&nbsp;and&nbsp;next&nbsp;(k)&nbsp;word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773491">w</span>&nbsp;<span class="op" id="3773493">|=</span>&nbsp;<span class="ident" id="3773496">x</span><span class="op" id="3773497">[</span><span class="ident" id="3773498">k</span><span class="op" id="3773499">]</span>&nbsp;<span class="op" id="3773501">&lt;&lt;</span>&nbsp;<span class="ident" id="3773504">nbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773514">i</span><span class="op" id="3773515">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773522">s</span><span class="op" id="3773523">[</span><span class="ident" id="3773524">i</span><span class="op" id="3773525">]</span>&nbsp;<span class="op" id="3773527">=</span>&nbsp;<span class="ident" id="3773529">charset</span><span class="op" id="3773536">[</span><span class="ident" id="3773537">w</span><span class="op" id="3773538">&amp;</span><span class="ident" id="3773539">mask</span><span class="op" id="3773543">]</span><br>
<span class="lineno">780</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773550">//&nbsp;advance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773565">w</span>&nbsp;<span class="op" id="3773567">=</span>&nbsp;<span class="ident" id="3773569">x</span><span class="op" id="3773570">[</span><span class="ident" id="3773571">k</span><span class="op" id="3773572">]</span>&nbsp;<span class="op" id="3773574">&gt;&gt;</span>&nbsp;<span class="op" id="3773577">(</span><span class="ident" id="3773578">shift</span>&nbsp;<span class="op" id="3773584">-</span>&nbsp;<span class="ident" id="3773586">nbits</span><span class="op" id="3773591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773597">nbits</span>&nbsp;<span class="op" id="3773603">=</span>&nbsp;<span class="ident" id="3773605">_W</span>&nbsp;<span class="op" id="3773608">-</span>&nbsp;<span class="op" id="3773610">(</span><span class="ident" id="3773611">shift</span>&nbsp;<span class="op" id="3773617">-</span>&nbsp;<span class="ident" id="3773619">nbits</span><span class="op" id="3773624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3773629">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3773633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773638">//&nbsp;convert&nbsp;digits&nbsp;of&nbsp;most-significant&nbsp;word&nbsp;(omit&nbsp;leading&nbsp;zeros)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773704">for</span>&nbsp;<span class="ident" id="3773708">nbits</span>&nbsp;<span class="op" id="3773714">&gt;=</span>&nbsp;<span class="num" id="3773717">0</span>&nbsp;<span class="op" id="3773719">&amp;&amp;</span>&nbsp;<span class="ident" id="3773722">w</span>&nbsp;<span class="op" id="3773724">!=</span>&nbsp;<span class="num" id="3773727">0</span>&nbsp;<span class="op" id="3773729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773734">i</span><span class="op" id="3773735">--</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773741">s</span><span class="op" id="3773742">[</span><span class="ident" id="3773743">i</span><span class="op" id="3773744">]</span>&nbsp;<span class="op" id="3773746">=</span>&nbsp;<span class="ident" id="3773748">charset</span><span class="op" id="3773755">[</span><span class="ident" id="3773756">w</span><span class="op" id="3773757">&amp;</span><span class="ident" id="3773758">mask</span><span class="op" id="3773762">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773767">w</span>&nbsp;<span class="op" id="3773769">&gt;&gt;=</span>&nbsp;<span class="ident" id="3773773">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773782">nbits</span>&nbsp;<span class="op" id="3773788">-=</span>&nbsp;<span class="ident" id="3773791">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3773799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3773803">}</span>&nbsp;<span class="keyword" id="3773805">else</span>&nbsp;<span class="op" id="3773810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773814">//&nbsp;determine&nbsp;&#34;big&nbsp;base&#34;;&nbsp;i.e.,&nbsp;the&nbsp;largest&nbsp;possible&nbsp;value&nbsp;bb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773877">//&nbsp;that&nbsp;is&nbsp;a&nbsp;power&nbsp;of&nbsp;base&nbsp;b&nbsp;and&nbsp;still&nbsp;fits&nbsp;into&nbsp;a&nbsp;Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773935">//&nbsp;(as&nbsp;in&nbsp;10^19&nbsp;for&nbsp;19&nbsp;decimal&nbsp;digits&nbsp;in&nbsp;a&nbsp;64bit&nbsp;Word)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773992">bb</span>&nbsp;<span class="op" id="3773995">:=</span>&nbsp;<span class="ident" id="3773998">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3774005">//&nbsp;big&nbsp;base&nbsp;is&nbsp;b**ndigits</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774033">ndigits</span>&nbsp;<span class="op" id="3774041">:=</span>&nbsp;<span class="num" id="3774044">1</span>&nbsp;<span class="comment" id="3774046">//&nbsp;number&nbsp;of&nbsp;base&nbsp;b&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3774075">for</span>&nbsp;<span class="ident" id="3774079">max</span>&nbsp;<span class="op" id="3774083">:=</span>&nbsp;<span class="ident" id="3774086">Word</span><span class="op" id="3774090">(</span><span class="ident" id="3774091">_M</span>&nbsp;<span class="op" id="3774094">/</span>&nbsp;<span class="ident" id="3774096">b</span><span class="op" id="3774097">)</span><span class="op" id="3774098">;</span>&nbsp;<span class="ident" id="3774100">bb</span>&nbsp;<span class="op" id="3774103">&lt;=</span>&nbsp;<span class="ident" id="3774106">max</span><span class="op" id="3774109">;</span>&nbsp;<span class="ident" id="3774111">bb</span>&nbsp;<span class="op" id="3774114">*=</span>&nbsp;<span class="ident" id="3774117">b</span>&nbsp;<span class="op" id="3774119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774124">ndigits</span><span class="op" id="3774131">++</span>&nbsp;<span class="comment" id="3774134">//&nbsp;maximize&nbsp;ndigits&nbsp;where&nbsp;bb&nbsp;=&nbsp;b**ndigits,&nbsp;bb&nbsp;&lt;=&nbsp;_M</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3774188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774193">//&nbsp;construct&nbsp;table&nbsp;of&nbsp;successive&nbsp;squares&nbsp;of&nbsp;bb*leafSize&nbsp;to&nbsp;use&nbsp;in&nbsp;subdivisions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774274">//&nbsp;result&nbsp;(table&nbsp;!=&nbsp;nil)&nbsp;&lt;=&gt;&nbsp;(len(x)&nbsp;&gt;&nbsp;leafSize&nbsp;&gt;&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774329">table</span>&nbsp;<span class="op" id="3774335">:=</span>&nbsp;<span class="ident" id="3774338">divisors</span><span class="op" id="3774346">(</span><span class="builtinfunc" id="3774347">len</span><span class="op" id="3774350">(</span><span class="ident" id="3774351">x</span><span class="op" id="3774352">)</span><span class="op" id="3774353">,</span>&nbsp;<span class="ident" id="3774355">b</span><span class="op" id="3774356">,</span>&nbsp;<span class="ident" id="3774358">ndigits</span><span class="op" id="3774365">,</span>&nbsp;<span class="ident" id="3774367">bb</span><span class="op" id="3774369">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774374">//&nbsp;preserve&nbsp;x,&nbsp;create&nbsp;local&nbsp;copy&nbsp;for&nbsp;use&nbsp;by&nbsp;convertWords</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774433">q</span>&nbsp;<span class="op" id="3774435">:=</span>&nbsp;<span class="ident" id="3774438">nat</span><span class="op" id="3774441">(</span><span class="ident" id="3774442">nil</span><span class="op" id="3774445">)</span><span class="op" id="3774446">.</span><span class="ident" id="3774447">set</span><span class="op" id="3774450">(</span><span class="ident" id="3774451">x</span><span class="op" id="3774452">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774457">//&nbsp;convert&nbsp;q&nbsp;to&nbsp;string&nbsp;s&nbsp;in&nbsp;base&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774494">q</span><span class="op" id="3774495">.</span><span class="ident" id="3774496">convertWords</span><span class="op" id="3774508">(</span><span class="ident" id="3774509">s</span><span class="op" id="3774510">,</span>&nbsp;<span class="ident" id="3774512">charset</span><span class="op" id="3774519">,</span>&nbsp;<span class="ident" id="3774521">b</span><span class="op" id="3774522">,</span>&nbsp;<span class="ident" id="3774524">ndigits</span><span class="op" id="3774531">,</span>&nbsp;<span class="ident" id="3774533">bb</span><span class="op" id="3774535">,</span>&nbsp;<span class="ident" id="3774537">table</span><span class="op" id="3774542">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774547">//&nbsp;strip&nbsp;leading&nbsp;zeros</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774572">//&nbsp;(x&nbsp;!=&nbsp;0;&nbsp;thus&nbsp;s&nbsp;must&nbsp;contain&nbsp;at&nbsp;least&nbsp;one&nbsp;non-zero&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774634">//&nbsp;and&nbsp;the&nbsp;loop&nbsp;will&nbsp;terminate)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774668">i</span>&nbsp;<span class="op" id="3774670">=</span>&nbsp;<span class="num" id="3774672">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3774676">for</span>&nbsp;<span class="ident" id="3774680">zero</span>&nbsp;<span class="op" id="3774685">:=</span>&nbsp;<span class="ident" id="3774688">charset</span><span class="op" id="3774695">[</span><span class="num" id="3774696">0</span><span class="op" id="3774697">]</span><span class="op" id="3774698">;</span>&nbsp;<span class="ident" id="3774700">s</span><span class="op" id="3774701">[</span><span class="ident" id="3774702">i</span><span class="op" id="3774703">]</span>&nbsp;<span class="op" id="3774705">==</span>&nbsp;<span class="ident" id="3774708">zero</span><span class="op" id="3774712">;</span>&nbsp;<span class="op" id="3774714">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774719">i</span><span class="op" id="3774720">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3774725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3774728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3774732">return</span>&nbsp;<span class="builtintype" id="3774739">string</span><span class="op" id="3774745">(</span><span class="ident" id="3774746">s</span><span class="op" id="3774747">[</span><span class="ident" id="3774748">i</span><span class="op" id="3774749">:</span><span class="op" id="3774750">]</span><span class="op" id="3774751">)</span><br>
<span class="lineno">825</span><span class="op" id="3774753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3774756">//&nbsp;Convert&nbsp;words&nbsp;of&nbsp;q&nbsp;to&nbsp;base&nbsp;b&nbsp;digits&nbsp;in&nbsp;s.&nbsp;If&nbsp;q&nbsp;is&nbsp;large,&nbsp;it&nbsp;is&nbsp;recursively&nbsp;&#34;split&nbsp;in&nbsp;half&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3774850">//&nbsp;by&nbsp;nat/nat&nbsp;division&nbsp;using&nbsp;tabulated&nbsp;divisors.&nbsp;Otherwise,&nbsp;it&nbsp;is&nbsp;converted&nbsp;iteratively&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="3774944">//&nbsp;repeated&nbsp;nat/Word&nbsp;division.</span><br>
<span class="lineno">830</span><span class="comment" id="3774975">//</span><br>
<span class="lineno"></span><span class="comment" id="3774978">//&nbsp;The&nbsp;iterative&nbsp;method&nbsp;processes&nbsp;n&nbsp;Words&nbsp;by&nbsp;n&nbsp;divW()&nbsp;calls,&nbsp;each&nbsp;of&nbsp;which&nbsp;visits&nbsp;every&nbsp;Word&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3775078">//&nbsp;incrementally&nbsp;shortened&nbsp;q&nbsp;for&nbsp;a&nbsp;total&nbsp;of&nbsp;n&nbsp;+&nbsp;(n-1)&nbsp;+&nbsp;(n-2)&nbsp;...&nbsp;+&nbsp;2&nbsp;+&nbsp;1,&nbsp;or&nbsp;n(n+1)/2&nbsp;divW()&#39;s.</span><br>
<span class="lineno"></span><span class="comment" id="3775175">//&nbsp;Recursive&nbsp;conversion&nbsp;divides&nbsp;q&nbsp;by&nbsp;its&nbsp;approximate&nbsp;square&nbsp;root,&nbsp;yielding&nbsp;two&nbsp;parts,&nbsp;each&nbsp;half</span><br>
<span class="lineno"></span><span class="comment" id="3775271">//&nbsp;the&nbsp;size&nbsp;of&nbsp;q.&nbsp;Using&nbsp;the&nbsp;iterative&nbsp;method&nbsp;on&nbsp;both&nbsp;halves&nbsp;means&nbsp;2&nbsp;*&nbsp;(n/2)(n/2&nbsp;+&nbsp;1)/2&nbsp;divW()&#39;s</span><br>
<span class="lineno">835</span><span class="comment" id="3775367">//&nbsp;plus&nbsp;the&nbsp;expensive&nbsp;long&nbsp;div().&nbsp;Asymptotically,&nbsp;the&nbsp;ratio&nbsp;is&nbsp;favorable&nbsp;at&nbsp;1/2&nbsp;the&nbsp;divW()&#39;s,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3775465">//&nbsp;is&nbsp;made&nbsp;better&nbsp;by&nbsp;splitting&nbsp;the&nbsp;subblocks&nbsp;recursively.&nbsp;Best&nbsp;is&nbsp;to&nbsp;split&nbsp;blocks&nbsp;until&nbsp;one&nbsp;more</span><br>
<span class="lineno"></span><span class="comment" id="3775562">//&nbsp;split&nbsp;would&nbsp;take&nbsp;longer&nbsp;(because&nbsp;of&nbsp;the&nbsp;nat/nat&nbsp;div())&nbsp;than&nbsp;the&nbsp;twice&nbsp;as&nbsp;many&nbsp;divW()&#39;s&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3775659">//&nbsp;iterative&nbsp;approach.&nbsp;This&nbsp;threshold&nbsp;is&nbsp;represented&nbsp;by&nbsp;leafSize.&nbsp;Benchmarking&nbsp;of&nbsp;leafSize&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3775757">//&nbsp;range&nbsp;2..64&nbsp;shows&nbsp;that&nbsp;values&nbsp;of&nbsp;8&nbsp;and&nbsp;16&nbsp;work&nbsp;well,&nbsp;with&nbsp;a&nbsp;4x&nbsp;speedup&nbsp;at&nbsp;medium&nbsp;lengths&nbsp;and</span><br>
<span class="lineno">840</span><span class="comment" id="3775853">//&nbsp;~30x&nbsp;for&nbsp;20000&nbsp;digits.&nbsp;Use&nbsp;nat_test.go&#39;s&nbsp;BenchmarkLeafSize&nbsp;tests&nbsp;to&nbsp;optimize&nbsp;leafSize&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3775946">//&nbsp;specific&nbsp;hardware.</span><br>
<span class="lineno"></span><span class="comment" id="3775968">//</span><br>
<span class="lineno"></span><span class="keyword" id="3775971">func</span>&nbsp;<span class="op" id="3775976">(</span><span class="ident" id="3775977">q</span>&nbsp;<span class="ident" id="3775979">nat</span><span class="op" id="3775982">)</span>&nbsp;<span class="ident" id="3775984">convertWords</span><span class="op" id="3775996">(</span><span class="ident" id="3775997">s</span>&nbsp;<span class="op" id="3775999">[</span><span class="op" id="3776000">]</span><span class="builtintype" id="3776001">byte</span><span class="op" id="3776005">,</span>&nbsp;<span class="ident" id="3776007">charset</span>&nbsp;<span class="builtintype" id="3776015">string</span><span class="op" id="3776021">,</span>&nbsp;<span class="ident" id="3776023">b</span>&nbsp;<span class="ident" id="3776025">Word</span><span class="op" id="3776029">,</span>&nbsp;<span class="ident" id="3776031">ndigits</span>&nbsp;<span class="builtintype" id="3776039">int</span><span class="op" id="3776042">,</span>&nbsp;<span class="ident" id="3776044">bb</span>&nbsp;<span class="ident" id="3776047">Word</span><span class="op" id="3776051">,</span>&nbsp;<span class="ident" id="3776053">table</span>&nbsp;<span class="op" id="3776059">[</span><span class="op" id="3776060">]</span><span class="ident" id="3776061">divisor</span><span class="op" id="3776068">)</span>&nbsp;<span class="op" id="3776070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3776073">//&nbsp;split&nbsp;larger&nbsp;blocks&nbsp;recursively</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776109">if</span>&nbsp;<span class="ident" id="3776112">table</span>&nbsp;<span class="op" id="3776118">!=</span>&nbsp;<span class="ident" id="3776121">nil</span>&nbsp;<span class="op" id="3776125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3776129">//&nbsp;len(q)&nbsp;&gt;&nbsp;leafSize&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776156">var</span>&nbsp;<span class="ident" id="3776160">r</span>&nbsp;<span class="ident" id="3776162">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776168">index</span>&nbsp;<span class="op" id="3776174">:=</span>&nbsp;<span class="builtinfunc" id="3776177">len</span><span class="op" id="3776180">(</span><span class="ident" id="3776181">table</span><span class="op" id="3776186">)</span>&nbsp;<span class="op" id="3776188">-</span>&nbsp;<span class="num" id="3776190">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776194">for</span>&nbsp;<span class="builtinfunc" id="3776198">len</span><span class="op" id="3776201">(</span><span class="ident" id="3776202">q</span><span class="op" id="3776203">)</span>&nbsp;<span class="op" id="3776205">&gt;</span>&nbsp;<span class="ident" id="3776207">leafSize</span>&nbsp;<span class="op" id="3776216">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3776221">//&nbsp;find&nbsp;divisor&nbsp;close&nbsp;to&nbsp;sqrt(q)&nbsp;if&nbsp;possible,&nbsp;but&nbsp;in&nbsp;any&nbsp;case&nbsp;&lt;&nbsp;q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776290">maxLength</span>&nbsp;<span class="op" id="3776300">:=</span>&nbsp;<span class="ident" id="3776303">q</span><span class="op" id="3776304">.</span><span class="ident" id="3776305">bitLen</span><span class="op" id="3776311">(</span><span class="op" id="3776312">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3776318">//&nbsp;~=&nbsp;log2&nbsp;q,&nbsp;or&nbsp;at&nbsp;of&nbsp;least&nbsp;largest&nbsp;possible&nbsp;q&nbsp;of&nbsp;this&nbsp;bit&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776388">minLength</span>&nbsp;<span class="op" id="3776398">:=</span>&nbsp;<span class="ident" id="3776401">maxLength</span>&nbsp;<span class="op" id="3776411">&gt;&gt;</span>&nbsp;<span class="num" id="3776414">1</span>&nbsp;<span class="comment" id="3776416">//&nbsp;~=&nbsp;log2&nbsp;sqrt(q)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776438">for</span>&nbsp;<span class="ident" id="3776442">index</span>&nbsp;<span class="op" id="3776448">&gt;</span>&nbsp;<span class="num" id="3776450">0</span>&nbsp;<span class="op" id="3776452">&amp;&amp;</span>&nbsp;<span class="ident" id="3776455">table</span><span class="op" id="3776460">[</span><span class="ident" id="3776461">index</span><span class="op" id="3776466">-</span><span class="num" id="3776467">1</span><span class="op" id="3776468">]</span><span class="op" id="3776469">.</span><span class="ident" id="3776470">nbits</span>&nbsp;<span class="op" id="3776476">&gt;</span>&nbsp;<span class="ident" id="3776478">minLength</span>&nbsp;<span class="op" id="3776488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776494">index</span><span class="op" id="3776499">--</span>&nbsp;<span class="comment" id="3776502">//&nbsp;desired</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3776516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776521">if</span>&nbsp;<span class="ident" id="3776524">table</span><span class="op" id="3776529">[</span><span class="ident" id="3776530">index</span><span class="op" id="3776535">]</span><span class="op" id="3776536">.</span><span class="ident" id="3776537">nbits</span>&nbsp;<span class="op" id="3776543">&gt;=</span>&nbsp;<span class="ident" id="3776546">maxLength</span>&nbsp;<span class="op" id="3776556">&amp;&amp;</span>&nbsp;<span class="ident" id="3776559">table</span><span class="op" id="3776564">[</span><span class="ident" id="3776565">index</span><span class="op" id="3776570">]</span><span class="op" id="3776571">.</span><span class="ident" id="3776572">bbb</span><span class="op" id="3776575">.</span><span class="ident" id="3776576">cmp</span><span class="op" id="3776579">(</span><span class="ident" id="3776580">q</span><span class="op" id="3776581">)</span>&nbsp;<span class="op" id="3776583">&gt;=</span>&nbsp;<span class="num" id="3776586">0</span>&nbsp;<span class="op" id="3776588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776594">index</span><span class="op" id="3776599">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776606">if</span>&nbsp;<span class="ident" id="3776609">index</span>&nbsp;<span class="op" id="3776615">&lt;</span>&nbsp;<span class="num" id="3776617">0</span>&nbsp;<span class="op" id="3776619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3776626">panic</span><span class="op" id="3776631">(</span><span class="string" id="3776632">&#34;internal&nbsp;inconsistency&#34;</span><span class="op" id="3776656">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3776662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3776667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3776673">//&nbsp;split&nbsp;q&nbsp;into&nbsp;the&nbsp;two&nbsp;digit&nbsp;number&nbsp;(q&#39;*bbb&nbsp;+&nbsp;r)&nbsp;to&nbsp;form&nbsp;independent&nbsp;subblocks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776756">q</span><span class="op" id="3776757">,</span>&nbsp;<span class="ident" id="3776759">r</span>&nbsp;<span class="op" id="3776761">=</span>&nbsp;<span class="ident" id="3776763">q</span><span class="op" id="3776764">.</span><span class="ident" id="3776765">div</span><span class="op" id="3776768">(</span><span class="ident" id="3776769">r</span><span class="op" id="3776770">,</span>&nbsp;<span class="ident" id="3776772">q</span><span class="op" id="3776773">,</span>&nbsp;<span class="ident" id="3776775">table</span><span class="op" id="3776780">[</span><span class="ident" id="3776781">index</span><span class="op" id="3776786">]</span><span class="op" id="3776787">.</span><span class="ident" id="3776788">bbb</span><span class="op" id="3776791">)</span><br>
<span class="lineno">865</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3776797">//&nbsp;convert&nbsp;subblocks&nbsp;and&nbsp;collect&nbsp;results&nbsp;in&nbsp;s[:h]&nbsp;and&nbsp;s[h:]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776860">h</span>&nbsp;<span class="op" id="3776862">:=</span>&nbsp;<span class="builtinfunc" id="3776865">len</span><span class="op" id="3776868">(</span><span class="ident" id="3776869">s</span><span class="op" id="3776870">)</span>&nbsp;<span class="op" id="3776872">-</span>&nbsp;<span class="ident" id="3776874">table</span><span class="op" id="3776879">[</span><span class="ident" id="3776880">index</span><span class="op" id="3776885">]</span><span class="op" id="3776886">.</span><span class="ident" id="3776887">ndigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776898">r</span><span class="op" id="3776899">.</span><span class="ident" id="3776900">convertWords</span><span class="op" id="3776912">(</span><span class="ident" id="3776913">s</span><span class="op" id="3776914">[</span><span class="ident" id="3776915">h</span><span class="op" id="3776916">:</span><span class="op" id="3776917">]</span><span class="op" id="3776918">,</span>&nbsp;<span class="ident" id="3776920">charset</span><span class="op" id="3776927">,</span>&nbsp;<span class="ident" id="3776929">b</span><span class="op" id="3776930">,</span>&nbsp;<span class="ident" id="3776932">ndigits</span><span class="op" id="3776939">,</span>&nbsp;<span class="ident" id="3776941">bb</span><span class="op" id="3776943">,</span>&nbsp;<span class="ident" id="3776945">table</span><span class="op" id="3776950">[</span><span class="num" id="3776951">0</span><span class="op" id="3776952">:</span><span class="ident" id="3776953">index</span><span class="op" id="3776958">]</span><span class="op" id="3776959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776964">s</span>&nbsp;<span class="op" id="3776966">=</span>&nbsp;<span class="ident" id="3776968">s</span><span class="op" id="3776969">[</span><span class="op" id="3776970">:</span><span class="ident" id="3776971">h</span><span class="op" id="3776972">]</span>&nbsp;<span class="comment" id="3776974">//&nbsp;==&nbsp;q.convertWords(s,&nbsp;charset,&nbsp;b,&nbsp;ndigits,&nbsp;bb,&nbsp;table[0:index+1])</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3777043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3777046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3777050">//&nbsp;having&nbsp;split&nbsp;any&nbsp;large&nbsp;blocks&nbsp;now&nbsp;process&nbsp;the&nbsp;remaining&nbsp;(small)&nbsp;block&nbsp;iteratively</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777136">i</span>&nbsp;<span class="op" id="3777138">:=</span>&nbsp;<span class="builtinfunc" id="3777141">len</span><span class="op" id="3777144">(</span><span class="ident" id="3777145">s</span><span class="op" id="3777146">)</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777149">var</span>&nbsp;<span class="ident" id="3777153">r</span>&nbsp;<span class="ident" id="3777155">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777161">if</span>&nbsp;<span class="ident" id="3777164">b</span>&nbsp;<span class="op" id="3777166">==</span>&nbsp;<span class="num" id="3777169">10</span>&nbsp;<span class="op" id="3777172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3777176">//&nbsp;hard-coding&nbsp;for&nbsp;10&nbsp;here&nbsp;speeds&nbsp;this&nbsp;up&nbsp;by&nbsp;1.25x&nbsp;(allows&nbsp;for&nbsp;/&nbsp;and&nbsp;%&nbsp;by&nbsp;constants)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777263">for</span>&nbsp;<span class="builtinfunc" id="3777267">len</span><span class="op" id="3777270">(</span><span class="ident" id="3777271">q</span><span class="op" id="3777272">)</span>&nbsp;<span class="op" id="3777274">&gt;</span>&nbsp;<span class="num" id="3777276">0</span>&nbsp;<span class="op" id="3777278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3777283">//&nbsp;extract&nbsp;least&nbsp;significant,&nbsp;base&nbsp;bb&nbsp;&#34;digit&#34;</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777332">q</span><span class="op" id="3777333">,</span>&nbsp;<span class="ident" id="3777335">r</span>&nbsp;<span class="op" id="3777337">=</span>&nbsp;<span class="ident" id="3777339">q</span><span class="op" id="3777340">.</span><span class="ident" id="3777341">divW</span><span class="op" id="3777345">(</span><span class="ident" id="3777346">q</span><span class="op" id="3777347">,</span>&nbsp;<span class="ident" id="3777349">bb</span><span class="op" id="3777351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777356">for</span>&nbsp;<span class="ident" id="3777360">j</span>&nbsp;<span class="op" id="3777362">:=</span>&nbsp;<span class="num" id="3777365">0</span><span class="op" id="3777366">;</span>&nbsp;<span class="ident" id="3777368">j</span>&nbsp;<span class="op" id="3777370">&lt;</span>&nbsp;<span class="ident" id="3777372">ndigits</span>&nbsp;<span class="op" id="3777380">&amp;&amp;</span>&nbsp;<span class="ident" id="3777383">i</span>&nbsp;<span class="op" id="3777385">&gt;</span>&nbsp;<span class="num" id="3777387">0</span><span class="op" id="3777388">;</span>&nbsp;<span class="ident" id="3777390">j</span><span class="op" id="3777391">++</span>&nbsp;<span class="op" id="3777394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777400">i</span><span class="op" id="3777401">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3777408">//&nbsp;avoid&nbsp;%&nbsp;computation&nbsp;since&nbsp;r%10&nbsp;==&nbsp;r&nbsp;-&nbsp;int(r/10)*10;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3777467">//&nbsp;this&nbsp;appears&nbsp;to&nbsp;be&nbsp;faster&nbsp;for&nbsp;BenchmarkString10000Base10</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3777531">//&nbsp;and&nbsp;smaller&nbsp;strings&nbsp;(but&nbsp;a&nbsp;bit&nbsp;slower&nbsp;for&nbsp;larger&nbsp;ones)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777593">t</span>&nbsp;<span class="op" id="3777595">:=</span>&nbsp;<span class="ident" id="3777598">r</span>&nbsp;<span class="op" id="3777600">/</span>&nbsp;<span class="num" id="3777602">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777609">s</span><span class="op" id="3777610">[</span><span class="ident" id="3777611">i</span><span class="op" id="3777612">]</span>&nbsp;<span class="op" id="3777614">=</span>&nbsp;<span class="ident" id="3777616">charset</span><span class="op" id="3777623">[</span><span class="ident" id="3777624">r</span><span class="op" id="3777625">-</span><span class="ident" id="3777626">t</span><span class="op" id="3777627">&lt;&lt;</span><span class="num" id="3777629">3</span><span class="op" id="3777630">-</span><span class="ident" id="3777631">t</span><span class="op" id="3777632">-</span><span class="ident" id="3777633">t</span><span class="op" id="3777634">]</span>&nbsp;<span class="comment" id="3777636">//&nbsp;TODO(gri)&nbsp;replace&nbsp;w/&nbsp;t*10&nbsp;once&nbsp;compiler&nbsp;produces&nbsp;better&nbsp;code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777704">r</span>&nbsp;<span class="op" id="3777706">=</span>&nbsp;<span class="ident" id="3777708">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3777713">}</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3777717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3777720">}</span>&nbsp;<span class="keyword" id="3777722">else</span>&nbsp;<span class="op" id="3777727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777731">for</span>&nbsp;<span class="builtinfunc" id="3777735">len</span><span class="op" id="3777738">(</span><span class="ident" id="3777739">q</span><span class="op" id="3777740">)</span>&nbsp;<span class="op" id="3777742">&gt;</span>&nbsp;<span class="num" id="3777744">0</span>&nbsp;<span class="op" id="3777746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3777751">//&nbsp;extract&nbsp;least&nbsp;significant,&nbsp;base&nbsp;bb&nbsp;&#34;digit&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777800">q</span><span class="op" id="3777801">,</span>&nbsp;<span class="ident" id="3777803">r</span>&nbsp;<span class="op" id="3777805">=</span>&nbsp;<span class="ident" id="3777807">q</span><span class="op" id="3777808">.</span><span class="ident" id="3777809">divW</span><span class="op" id="3777813">(</span><span class="ident" id="3777814">q</span><span class="op" id="3777815">,</span>&nbsp;<span class="ident" id="3777817">bb</span><span class="op" id="3777819">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777824">for</span>&nbsp;<span class="ident" id="3777828">j</span>&nbsp;<span class="op" id="3777830">:=</span>&nbsp;<span class="num" id="3777833">0</span><span class="op" id="3777834">;</span>&nbsp;<span class="ident" id="3777836">j</span>&nbsp;<span class="op" id="3777838">&lt;</span>&nbsp;<span class="ident" id="3777840">ndigits</span>&nbsp;<span class="op" id="3777848">&amp;&amp;</span>&nbsp;<span class="ident" id="3777851">i</span>&nbsp;<span class="op" id="3777853">&gt;</span>&nbsp;<span class="num" id="3777855">0</span><span class="op" id="3777856">;</span>&nbsp;<span class="ident" id="3777858">j</span><span class="op" id="3777859">++</span>&nbsp;<span class="op" id="3777862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777868">i</span><span class="op" id="3777869">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777876">s</span><span class="op" id="3777877">[</span><span class="ident" id="3777878">i</span><span class="op" id="3777879">]</span>&nbsp;<span class="op" id="3777881">=</span>&nbsp;<span class="ident" id="3777883">charset</span><span class="op" id="3777890">[</span><span class="ident" id="3777891">r</span><span class="op" id="3777892">%</span><span class="ident" id="3777893">b</span><span class="op" id="3777894">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777900">r</span>&nbsp;<span class="op" id="3777902">/=</span>&nbsp;<span class="ident" id="3777905">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3777910">}</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3777914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3777917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3777921">//&nbsp;prepend&nbsp;high-order&nbsp;zeroes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777951">zero</span>&nbsp;<span class="op" id="3777956">:=</span>&nbsp;<span class="ident" id="3777959">charset</span><span class="op" id="3777966">[</span><span class="num" id="3777967">0</span><span class="op" id="3777968">]</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777971">for</span>&nbsp;<span class="ident" id="3777975">i</span>&nbsp;<span class="op" id="3777977">&gt;</span>&nbsp;<span class="num" id="3777979">0</span>&nbsp;<span class="op" id="3777981">{</span>&nbsp;<span class="comment" id="3777983">//&nbsp;while&nbsp;need&nbsp;more&nbsp;leading&nbsp;zeroes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778019">i</span><span class="op" id="3778020">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778025">s</span><span class="op" id="3778026">[</span><span class="ident" id="3778027">i</span><span class="op" id="3778028">]</span>&nbsp;<span class="op" id="3778030">=</span>&nbsp;<span class="ident" id="3778032">zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3778038">}</span><br>
<span class="lineno"></span><span class="op" id="3778040">}</span><br>
<span class="lineno">910</span><br>
<span class="lineno"></span><span class="comment" id="3778043">//&nbsp;Split&nbsp;blocks&nbsp;greater&nbsp;than&nbsp;leafSize&nbsp;Words&nbsp;(or&nbsp;set&nbsp;to&nbsp;0&nbsp;to&nbsp;disable&nbsp;recursive&nbsp;conversion)</span><br>
<span class="lineno"></span><span class="comment" id="3778133">//&nbsp;Benchmark&nbsp;and&nbsp;configure&nbsp;leafSize&nbsp;using:&nbsp;go&nbsp;test&nbsp;-bench=&#34;Leaf&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3778198">//&nbsp;&nbsp;&nbsp;8&nbsp;and&nbsp;16&nbsp;effective&nbsp;on&nbsp;3.0&nbsp;GHz&nbsp;Xeon&nbsp;&#34;Clovertown&#34;&nbsp;CPU&nbsp;(128&nbsp;byte&nbsp;cache&nbsp;lines)</span><br>
<span class="lineno"></span><span class="comment" id="3778278">//&nbsp;&nbsp;&nbsp;8&nbsp;and&nbsp;16&nbsp;effective&nbsp;on&nbsp;2.66&nbsp;GHz&nbsp;Core&nbsp;2&nbsp;Duo&nbsp;&#34;Penryn&#34;&nbsp;CPU</span><br>
<span class="lineno">915</span><span class="keyword" id="3778338">var</span>&nbsp;<span class="ident" id="3778342">leafSize</span>&nbsp;<span class="builtintype" id="3778351">int</span>&nbsp;<span class="op" id="3778355">=</span>&nbsp;<span class="num" id="3778357">8</span>&nbsp;<span class="comment" id="3778359">//&nbsp;number&nbsp;of&nbsp;Word-size&nbsp;binary&nbsp;values&nbsp;treat&nbsp;as&nbsp;a&nbsp;monolithic&nbsp;block</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3778425">type</span>&nbsp;<span class="ident" id="3778430">divisor</span>&nbsp;<span class="keyword" id="3778438">struct</span>&nbsp;<span class="op" id="3778445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778448">bbb</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3778456">nat</span>&nbsp;<span class="comment" id="3778460">//&nbsp;divisor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778472">nbits</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3778480">int</span>&nbsp;<span class="comment" id="3778484">//&nbsp;bit&nbsp;length&nbsp;of&nbsp;divisor&nbsp;(discounting&nbsp;leading&nbsp;zeroes)&nbsp;~=&nbsp;log2(bbb)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778552">ndigits</span>&nbsp;<span class="builtintype" id="3778560">int</span>&nbsp;<span class="comment" id="3778564">//&nbsp;digit&nbsp;length&nbsp;of&nbsp;divisor&nbsp;in&nbsp;terms&nbsp;of&nbsp;output&nbsp;base&nbsp;digits</span><br>
<span class="lineno"></span><span class="op" id="3778622">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3778625">var</span>&nbsp;<span class="ident" id="3778629">cacheBase10</span>&nbsp;<span class="keyword" id="3778641">struct</span>&nbsp;<span class="op" id="3778648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778651">sync</span><span class="op" id="3778655">.</span><span class="ident" id="3778656">Mutex</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778663">table</span>&nbsp;<span class="op" id="3778669">[</span><span class="num" id="3778670">64</span><span class="op" id="3778672">]</span><span class="ident" id="3778673">divisor</span>&nbsp;<span class="comment" id="3778681">//&nbsp;cached&nbsp;divisors&nbsp;for&nbsp;base&nbsp;10</span><br>
<span class="lineno"></span><span class="op" id="3778712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3778715">//&nbsp;expWW&nbsp;computes&nbsp;x**y</span><br>
<span class="lineno"></span><span class="keyword" id="3778738">func</span>&nbsp;<span class="op" id="3778743">(</span><span class="ident" id="3778744">z</span>&nbsp;<span class="ident" id="3778746">nat</span><span class="op" id="3778749">)</span>&nbsp;<span class="ident" id="3778751">expWW</span><span class="op" id="3778756">(</span><span class="ident" id="3778757">x</span><span class="op" id="3778758">,</span>&nbsp;<span class="ident" id="3778760">y</span>&nbsp;<span class="ident" id="3778762">Word</span><span class="op" id="3778766">)</span>&nbsp;<span class="ident" id="3778768">nat</span>&nbsp;<span class="op" id="3778772">{</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3778775">return</span>&nbsp;<span class="ident" id="3778782">z</span><span class="op" id="3778783">.</span><span class="ident" id="3778784">expNN</span><span class="op" id="3778789">(</span><span class="ident" id="3778790">nat</span><span class="op" id="3778793">(</span><span class="ident" id="3778794">nil</span><span class="op" id="3778797">)</span><span class="op" id="3778798">.</span><span class="ident" id="3778799">setWord</span><span class="op" id="3778806">(</span><span class="ident" id="3778807">x</span><span class="op" id="3778808">)</span><span class="op" id="3778809">,</span>&nbsp;<span class="ident" id="3778811">nat</span><span class="op" id="3778814">(</span><span class="ident" id="3778815">nil</span><span class="op" id="3778818">)</span><span class="op" id="3778819">.</span><span class="ident" id="3778820">setWord</span><span class="op" id="3778827">(</span><span class="ident" id="3778828">y</span><span class="op" id="3778829">)</span><span class="op" id="3778830">,</span>&nbsp;<span class="ident" id="3778832">nil</span><span class="op" id="3778835">)</span><br>
<span class="lineno"></span><span class="op" id="3778837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3778840">//&nbsp;construct&nbsp;table&nbsp;of&nbsp;powers&nbsp;of&nbsp;bb*leafSize&nbsp;to&nbsp;use&nbsp;in&nbsp;subdivisions</span><br>
<span class="lineno"></span><span class="keyword" id="3778907">func</span>&nbsp;<span class="ident" id="3778912">divisors</span><span class="op" id="3778920">(</span><span class="ident" id="3778921">m</span>&nbsp;<span class="builtintype" id="3778923">int</span><span class="op" id="3778926">,</span>&nbsp;<span class="ident" id="3778928">b</span>&nbsp;<span class="ident" id="3778930">Word</span><span class="op" id="3778934">,</span>&nbsp;<span class="ident" id="3778936">ndigits</span>&nbsp;<span class="builtintype" id="3778944">int</span><span class="op" id="3778947">,</span>&nbsp;<span class="ident" id="3778949">bb</span>&nbsp;<span class="ident" id="3778952">Word</span><span class="op" id="3778956">)</span>&nbsp;<span class="op" id="3778958">[</span><span class="op" id="3778959">]</span><span class="ident" id="3778960">divisor</span>&nbsp;<span class="op" id="3778968">{</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3778971">//&nbsp;only&nbsp;compute&nbsp;table&nbsp;when&nbsp;recursive&nbsp;conversion&nbsp;is&nbsp;enabled&nbsp;and&nbsp;x&nbsp;is&nbsp;large</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779046">if</span>&nbsp;<span class="ident" id="3779049">leafSize</span>&nbsp;<span class="op" id="3779058">==</span>&nbsp;<span class="num" id="3779061">0</span>&nbsp;<span class="op" id="3779063">||</span>&nbsp;<span class="ident" id="3779066">m</span>&nbsp;<span class="op" id="3779068">&lt;=</span>&nbsp;<span class="ident" id="3779071">leafSize</span>&nbsp;<span class="op" id="3779080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779084">return</span>&nbsp;<span class="ident" id="3779091">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3779096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3779100">//&nbsp;determine&nbsp;k&nbsp;where&nbsp;(bb**leafSize)**(2**k)&nbsp;&gt;=&nbsp;sqrt(x)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779156">k</span>&nbsp;<span class="op" id="3779158">:=</span>&nbsp;<span class="num" id="3779161">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779164">for</span>&nbsp;<span class="ident" id="3779168">words</span>&nbsp;<span class="op" id="3779174">:=</span>&nbsp;<span class="ident" id="3779177">leafSize</span><span class="op" id="3779185">;</span>&nbsp;<span class="ident" id="3779187">words</span>&nbsp;<span class="op" id="3779193">&lt;</span>&nbsp;<span class="ident" id="3779195">m</span><span class="op" id="3779196">&gt;&gt;</span><span class="num" id="3779198">1</span>&nbsp;<span class="op" id="3779200">&amp;&amp;</span>&nbsp;<span class="ident" id="3779203">k</span>&nbsp;<span class="op" id="3779205">&lt;</span>&nbsp;<span class="builtinfunc" id="3779207">len</span><span class="op" id="3779210">(</span><span class="ident" id="3779211">cacheBase10</span><span class="op" id="3779222">.</span><span class="ident" id="3779223">table</span><span class="op" id="3779228">)</span><span class="op" id="3779229">;</span>&nbsp;<span class="ident" id="3779231">words</span>&nbsp;<span class="op" id="3779237">&lt;&lt;=</span>&nbsp;<span class="num" id="3779241">1</span>&nbsp;<span class="op" id="3779243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779247">k</span><span class="op" id="3779248">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3779252">}</span><br>
<span class="lineno">945</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3779256">//&nbsp;reuse&nbsp;and&nbsp;extend&nbsp;existing&nbsp;table&nbsp;of&nbsp;divisors&nbsp;or&nbsp;create&nbsp;new&nbsp;table&nbsp;as&nbsp;appropriate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779339">var</span>&nbsp;<span class="ident" id="3779343">table</span>&nbsp;<span class="op" id="3779349">[</span><span class="op" id="3779350">]</span><span class="ident" id="3779351">divisor</span>&nbsp;<span class="comment" id="3779359">//&nbsp;for&nbsp;b&nbsp;==&nbsp;10,&nbsp;table&nbsp;overlaps&nbsp;with&nbsp;cacheBase10.table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779414">if</span>&nbsp;<span class="ident" id="3779417">b</span>&nbsp;<span class="op" id="3779419">==</span>&nbsp;<span class="num" id="3779422">10</span>&nbsp;<span class="op" id="3779425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779429">cacheBase10</span><span class="op" id="3779440">.</span><span class="ident" id="3779441">Lock</span><span class="op" id="3779445">(</span><span class="op" id="3779446">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779450">table</span>&nbsp;<span class="op" id="3779456">=</span>&nbsp;<span class="ident" id="3779458">cacheBase10</span><span class="op" id="3779469">.</span><span class="ident" id="3779470">table</span><span class="op" id="3779475">[</span><span class="num" id="3779476">0</span><span class="op" id="3779477">:</span><span class="ident" id="3779478">k</span><span class="op" id="3779479">]</span>&nbsp;<span class="comment" id="3779481">//&nbsp;reuse&nbsp;old&nbsp;table&nbsp;for&nbsp;this&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3779521">}</span>&nbsp;<span class="keyword" id="3779523">else</span>&nbsp;<span class="op" id="3779528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779532">table</span>&nbsp;<span class="op" id="3779538">=</span>&nbsp;<span class="builtinfunc" id="3779540">make</span><span class="op" id="3779544">(</span><span class="op" id="3779545">[</span><span class="op" id="3779546">]</span><span class="ident" id="3779547">divisor</span><span class="op" id="3779554">,</span>&nbsp;<span class="ident" id="3779556">k</span><span class="op" id="3779557">)</span>&nbsp;<span class="comment" id="3779559">//&nbsp;create&nbsp;new&nbsp;table&nbsp;for&nbsp;this&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3779600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3779604">//&nbsp;extend&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779621">if</span>&nbsp;<span class="ident" id="3779624">table</span><span class="op" id="3779629">[</span><span class="ident" id="3779630">k</span><span class="op" id="3779631">-</span><span class="num" id="3779632">1</span><span class="op" id="3779633">]</span><span class="op" id="3779634">.</span><span class="ident" id="3779635">ndigits</span>&nbsp;<span class="op" id="3779643">==</span>&nbsp;<span class="num" id="3779646">0</span>&nbsp;<span class="op" id="3779648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3779652">//&nbsp;add&nbsp;new&nbsp;entries&nbsp;as&nbsp;needed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779683">var</span>&nbsp;<span class="ident" id="3779687">larger</span>&nbsp;<span class="ident" id="3779694">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779700">for</span>&nbsp;<span class="ident" id="3779704">i</span>&nbsp;<span class="op" id="3779706">:=</span>&nbsp;<span class="num" id="3779709">0</span><span class="op" id="3779710">;</span>&nbsp;<span class="ident" id="3779712">i</span>&nbsp;<span class="op" id="3779714">&lt;</span>&nbsp;<span class="ident" id="3779716">k</span><span class="op" id="3779717">;</span>&nbsp;<span class="ident" id="3779719">i</span><span class="op" id="3779720">++</span>&nbsp;<span class="op" id="3779723">{</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779728">if</span>&nbsp;<span class="ident" id="3779731">table</span><span class="op" id="3779736">[</span><span class="ident" id="3779737">i</span><span class="op" id="3779738">]</span><span class="op" id="3779739">.</span><span class="ident" id="3779740">ndigits</span>&nbsp;<span class="op" id="3779748">==</span>&nbsp;<span class="num" id="3779751">0</span>&nbsp;<span class="op" id="3779753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779759">if</span>&nbsp;<span class="ident" id="3779762">i</span>&nbsp;<span class="op" id="3779764">==</span>&nbsp;<span class="num" id="3779767">0</span>&nbsp;<span class="op" id="3779769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779776">table</span><span class="op" id="3779781">[</span><span class="num" id="3779782">0</span><span class="op" id="3779783">]</span><span class="op" id="3779784">.</span><span class="ident" id="3779785">bbb</span>&nbsp;<span class="op" id="3779789">=</span>&nbsp;<span class="ident" id="3779791">nat</span><span class="op" id="3779794">(</span><span class="ident" id="3779795">nil</span><span class="op" id="3779798">)</span><span class="op" id="3779799">.</span><span class="ident" id="3779800">expWW</span><span class="op" id="3779805">(</span><span class="ident" id="3779806">bb</span><span class="op" id="3779808">,</span>&nbsp;<span class="ident" id="3779810">Word</span><span class="op" id="3779814">(</span><span class="ident" id="3779815">leafSize</span><span class="op" id="3779823">)</span><span class="op" id="3779824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779831">table</span><span class="op" id="3779836">[</span><span class="num" id="3779837">0</span><span class="op" id="3779838">]</span><span class="op" id="3779839">.</span><span class="ident" id="3779840">ndigits</span>&nbsp;<span class="op" id="3779848">=</span>&nbsp;<span class="ident" id="3779850">ndigits</span>&nbsp;<span class="op" id="3779858">*</span>&nbsp;<span class="ident" id="3779860">leafSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3779873">}</span>&nbsp;<span class="keyword" id="3779875">else</span>&nbsp;<span class="op" id="3779880">{</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779887">table</span><span class="op" id="3779892">[</span><span class="ident" id="3779893">i</span><span class="op" id="3779894">]</span><span class="op" id="3779895">.</span><span class="ident" id="3779896">bbb</span>&nbsp;<span class="op" id="3779900">=</span>&nbsp;<span class="ident" id="3779902">nat</span><span class="op" id="3779905">(</span><span class="ident" id="3779906">nil</span><span class="op" id="3779909">)</span><span class="op" id="3779910">.</span><span class="ident" id="3779911">mul</span><span class="op" id="3779914">(</span><span class="ident" id="3779915">table</span><span class="op" id="3779920">[</span><span class="ident" id="3779921">i</span><span class="op" id="3779922">-</span><span class="num" id="3779923">1</span><span class="op" id="3779924">]</span><span class="op" id="3779925">.</span><span class="ident" id="3779926">bbb</span><span class="op" id="3779929">,</span>&nbsp;<span class="ident" id="3779931">table</span><span class="op" id="3779936">[</span><span class="ident" id="3779937">i</span><span class="op" id="3779938">-</span><span class="num" id="3779939">1</span><span class="op" id="3779940">]</span><span class="op" id="3779941">.</span><span class="ident" id="3779942">bbb</span><span class="op" id="3779945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779952">table</span><span class="op" id="3779957">[</span><span class="ident" id="3779958">i</span><span class="op" id="3779959">]</span><span class="op" id="3779960">.</span><span class="ident" id="3779961">ndigits</span>&nbsp;<span class="op" id="3779969">=</span>&nbsp;<span class="num" id="3779971">2</span>&nbsp;<span class="op" id="3779973">*</span>&nbsp;<span class="ident" id="3779975">table</span><span class="op" id="3779980">[</span><span class="ident" id="3779981">i</span><span class="op" id="3779982">-</span><span class="num" id="3779983">1</span><span class="op" id="3779984">]</span><span class="op" id="3779985">.</span><span class="ident" id="3779986">ndigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3779998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3780005">//&nbsp;optimization:&nbsp;exploit&nbsp;aggregated&nbsp;extra&nbsp;bits&nbsp;in&nbsp;macro&nbsp;blocks</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780072">larger</span>&nbsp;<span class="op" id="3780079">=</span>&nbsp;<span class="ident" id="3780081">nat</span><span class="op" id="3780084">(</span><span class="ident" id="3780085">nil</span><span class="op" id="3780088">)</span><span class="op" id="3780089">.</span><span class="ident" id="3780090">set</span><span class="op" id="3780093">(</span><span class="ident" id="3780094">table</span><span class="op" id="3780099">[</span><span class="ident" id="3780100">i</span><span class="op" id="3780101">]</span><span class="op" id="3780102">.</span><span class="ident" id="3780103">bbb</span><span class="op" id="3780106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3780112">for</span>&nbsp;<span class="ident" id="3780116">mulAddVWW</span><span class="op" id="3780125">(</span><span class="ident" id="3780126">larger</span><span class="op" id="3780132">,</span>&nbsp;<span class="ident" id="3780134">larger</span><span class="op" id="3780140">,</span>&nbsp;<span class="ident" id="3780142">b</span><span class="op" id="3780143">,</span>&nbsp;<span class="num" id="3780145">0</span><span class="op" id="3780146">)</span>&nbsp;<span class="op" id="3780148">==</span>&nbsp;<span class="num" id="3780151">0</span>&nbsp;<span class="op" id="3780153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780160">table</span><span class="op" id="3780165">[</span><span class="ident" id="3780166">i</span><span class="op" id="3780167">]</span><span class="op" id="3780168">.</span><span class="ident" id="3780169">bbb</span>&nbsp;<span class="op" id="3780173">=</span>&nbsp;<span class="ident" id="3780175">table</span><span class="op" id="3780180">[</span><span class="ident" id="3780181">i</span><span class="op" id="3780182">]</span><span class="op" id="3780183">.</span><span class="ident" id="3780184">bbb</span><span class="op" id="3780187">.</span><span class="ident" id="3780188">set</span><span class="op" id="3780191">(</span><span class="ident" id="3780192">larger</span><span class="op" id="3780198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780205">table</span><span class="op" id="3780210">[</span><span class="ident" id="3780211">i</span><span class="op" id="3780212">]</span><span class="op" id="3780213">.</span><span class="ident" id="3780214">ndigits</span><span class="op" id="3780221">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3780228">}</span><br>
<span class="lineno">975</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780235">table</span><span class="op" id="3780240">[</span><span class="ident" id="3780241">i</span><span class="op" id="3780242">]</span><span class="op" id="3780243">.</span><span class="ident" id="3780244">nbits</span>&nbsp;<span class="op" id="3780250">=</span>&nbsp;<span class="ident" id="3780252">table</span><span class="op" id="3780257">[</span><span class="ident" id="3780258">i</span><span class="op" id="3780259">]</span><span class="op" id="3780260">.</span><span class="ident" id="3780261">bbb</span><span class="op" id="3780264">.</span><span class="ident" id="3780265">bitLen</span><span class="op" id="3780271">(</span><span class="op" id="3780272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3780277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3780281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3780284">}</span><br>
<span class="lineno">980</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3780288">if</span>&nbsp;<span class="ident" id="3780291">b</span>&nbsp;<span class="op" id="3780293">==</span>&nbsp;<span class="num" id="3780296">10</span>&nbsp;<span class="op" id="3780299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780303">cacheBase10</span><span class="op" id="3780314">.</span><span class="ident" id="3780315">Unlock</span><span class="op" id="3780321">(</span><span class="op" id="3780322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3780325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3780329">return</span>&nbsp;<span class="ident" id="3780336">table</span><br>
<span class="lineno"></span><span class="op" id="3780342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3780345">const</span>&nbsp;<span class="ident" id="3780351">deBruijn32</span>&nbsp;<span class="op" id="3780362">=</span>&nbsp;<span class="num" id="3780364">0x077CB531</span><br>
<span class="lineno"></span><br>
<span class="lineno">990</span><span class="keyword" id="3780376">var</span>&nbsp;<span class="ident" id="3780380">deBruijn32Lookup</span>&nbsp;<span class="op" id="3780397">=</span>&nbsp;<span class="op" id="3780399">[</span><span class="op" id="3780400">]</span><span class="builtintype" id="3780401">byte</span><span class="op" id="3780405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3780408">0</span><span class="op" id="3780409">,</span>&nbsp;<span class="num" id="3780411">1</span><span class="op" id="3780412">,</span>&nbsp;<span class="num" id="3780414">28</span><span class="op" id="3780416">,</span>&nbsp;<span class="num" id="3780418">2</span><span class="op" id="3780419">,</span>&nbsp;<span class="num" id="3780421">29</span><span class="op" id="3780423">,</span>&nbsp;<span class="num" id="3780425">14</span><span class="op" id="3780427">,</span>&nbsp;<span class="num" id="3780429">24</span><span class="op" id="3780431">,</span>&nbsp;<span class="num" id="3780433">3</span><span class="op" id="3780434">,</span>&nbsp;<span class="num" id="3780436">30</span><span class="op" id="3780438">,</span>&nbsp;<span class="num" id="3780440">22</span><span class="op" id="3780442">,</span>&nbsp;<span class="num" id="3780444">20</span><span class="op" id="3780446">,</span>&nbsp;<span class="num" id="3780448">15</span><span class="op" id="3780450">,</span>&nbsp;<span class="num" id="3780452">25</span><span class="op" id="3780454">,</span>&nbsp;<span class="num" id="3780456">17</span><span class="op" id="3780458">,</span>&nbsp;<span class="num" id="3780460">4</span><span class="op" id="3780461">,</span>&nbsp;<span class="num" id="3780463">8</span><span class="op" id="3780464">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3780467">31</span><span class="op" id="3780469">,</span>&nbsp;<span class="num" id="3780471">27</span><span class="op" id="3780473">,</span>&nbsp;<span class="num" id="3780475">13</span><span class="op" id="3780477">,</span>&nbsp;<span class="num" id="3780479">23</span><span class="op" id="3780481">,</span>&nbsp;<span class="num" id="3780483">21</span><span class="op" id="3780485">,</span>&nbsp;<span class="num" id="3780487">19</span><span class="op" id="3780489">,</span>&nbsp;<span class="num" id="3780491">16</span><span class="op" id="3780493">,</span>&nbsp;<span class="num" id="3780495">7</span><span class="op" id="3780496">,</span>&nbsp;<span class="num" id="3780498">26</span><span class="op" id="3780500">,</span>&nbsp;<span class="num" id="3780502">12</span><span class="op" id="3780504">,</span>&nbsp;<span class="num" id="3780506">18</span><span class="op" id="3780508">,</span>&nbsp;<span class="num" id="3780510">6</span><span class="op" id="3780511">,</span>&nbsp;<span class="num" id="3780513">11</span><span class="op" id="3780515">,</span>&nbsp;<span class="num" id="3780517">5</span><span class="op" id="3780518">,</span>&nbsp;<span class="num" id="3780520">10</span><span class="op" id="3780522">,</span>&nbsp;<span class="num" id="3780524">9</span><span class="op" id="3780525">,</span><br>
<span class="lineno"></span><span class="op" id="3780527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">995</span><span class="keyword" id="3780530">const</span>&nbsp;<span class="ident" id="3780536">deBruijn64</span>&nbsp;<span class="op" id="3780547">=</span>&nbsp;<span class="num" id="3780549">0x03f79d71b4ca8b09</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3780569">var</span>&nbsp;<span class="ident" id="3780573">deBruijn64Lookup</span>&nbsp;<span class="op" id="3780590">=</span>&nbsp;<span class="op" id="3780592">[</span><span class="op" id="3780593">]</span><span class="builtintype" id="3780594">byte</span><span class="op" id="3780598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3780601">0</span><span class="op" id="3780602">,</span>&nbsp;<span class="num" id="3780604">1</span><span class="op" id="3780605">,</span>&nbsp;<span class="num" id="3780607">56</span><span class="op" id="3780609">,</span>&nbsp;<span class="num" id="3780611">2</span><span class="op" id="3780612">,</span>&nbsp;<span class="num" id="3780614">57</span><span class="op" id="3780616">,</span>&nbsp;<span class="num" id="3780618">49</span><span class="op" id="3780620">,</span>&nbsp;<span class="num" id="3780622">28</span><span class="op" id="3780624">,</span>&nbsp;<span class="num" id="3780626">3</span><span class="op" id="3780627">,</span>&nbsp;<span class="num" id="3780629">61</span><span class="op" id="3780631">,</span>&nbsp;<span class="num" id="3780633">58</span><span class="op" id="3780635">,</span>&nbsp;<span class="num" id="3780637">42</span><span class="op" id="3780639">,</span>&nbsp;<span class="num" id="3780641">50</span><span class="op" id="3780643">,</span>&nbsp;<span class="num" id="3780645">38</span><span class="op" id="3780647">,</span>&nbsp;<span class="num" id="3780649">29</span><span class="op" id="3780651">,</span>&nbsp;<span class="num" id="3780653">17</span><span class="op" id="3780655">,</span>&nbsp;<span class="num" id="3780657">4</span><span class="op" id="3780658">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3780661">62</span><span class="op" id="3780663">,</span>&nbsp;<span class="num" id="3780665">47</span><span class="op" id="3780667">,</span>&nbsp;<span class="num" id="3780669">59</span><span class="op" id="3780671">,</span>&nbsp;<span class="num" id="3780673">36</span><span class="op" id="3780675">,</span>&nbsp;<span class="num" id="3780677">45</span><span class="op" id="3780679">,</span>&nbsp;<span class="num" id="3780681">43</span><span class="op" id="3780683">,</span>&nbsp;<span class="num" id="3780685">51</span><span class="op" id="3780687">,</span>&nbsp;<span class="num" id="3780689">22</span><span class="op" id="3780691">,</span>&nbsp;<span class="num" id="3780693">53</span><span class="op" id="3780695">,</span>&nbsp;<span class="num" id="3780697">39</span><span class="op" id="3780699">,</span>&nbsp;<span class="num" id="3780701">33</span><span class="op" id="3780703">,</span>&nbsp;<span class="num" id="3780705">30</span><span class="op" id="3780707">,</span>&nbsp;<span class="num" id="3780709">24</span><span class="op" id="3780711">,</span>&nbsp;<span class="num" id="3780713">18</span><span class="op" id="3780715">,</span>&nbsp;<span class="num" id="3780717">12</span><span class="op" id="3780719">,</span>&nbsp;<span class="num" id="3780721">5</span><span class="op" id="3780722">,</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3780725">63</span><span class="op" id="3780727">,</span>&nbsp;<span class="num" id="3780729">55</span><span class="op" id="3780731">,</span>&nbsp;<span class="num" id="3780733">48</span><span class="op" id="3780735">,</span>&nbsp;<span class="num" id="3780737">27</span><span class="op" id="3780739">,</span>&nbsp;<span class="num" id="3780741">60</span><span class="op" id="3780743">,</span>&nbsp;<span class="num" id="3780745">41</span><span class="op" id="3780747">,</span>&nbsp;<span class="num" id="3780749">37</span><span class="op" id="3780751">,</span>&nbsp;<span class="num" id="3780753">16</span><span class="op" id="3780755">,</span>&nbsp;<span class="num" id="3780757">46</span><span class="op" id="3780759">,</span>&nbsp;<span class="num" id="3780761">35</span><span class="op" id="3780763">,</span>&nbsp;<span class="num" id="3780765">44</span><span class="op" id="3780767">,</span>&nbsp;<span class="num" id="3780769">21</span><span class="op" id="3780771">,</span>&nbsp;<span class="num" id="3780773">52</span><span class="op" id="3780775">,</span>&nbsp;<span class="num" id="3780777">32</span><span class="op" id="3780779">,</span>&nbsp;<span class="num" id="3780781">23</span><span class="op" id="3780783">,</span>&nbsp;<span class="num" id="3780785">11</span><span class="op" id="3780787">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3780790">54</span><span class="op" id="3780792">,</span>&nbsp;<span class="num" id="3780794">26</span><span class="op" id="3780796">,</span>&nbsp;<span class="num" id="3780798">40</span><span class="op" id="3780800">,</span>&nbsp;<span class="num" id="3780802">15</span><span class="op" id="3780804">,</span>&nbsp;<span class="num" id="3780806">34</span><span class="op" id="3780808">,</span>&nbsp;<span class="num" id="3780810">20</span><span class="op" id="3780812">,</span>&nbsp;<span class="num" id="3780814">31</span><span class="op" id="3780816">,</span>&nbsp;<span class="num" id="3780818">10</span><span class="op" id="3780820">,</span>&nbsp;<span class="num" id="3780822">25</span><span class="op" id="3780824">,</span>&nbsp;<span class="num" id="3780826">14</span><span class="op" id="3780828">,</span>&nbsp;<span class="num" id="3780830">19</span><span class="op" id="3780832">,</span>&nbsp;<span class="num" id="3780834">9</span><span class="op" id="3780835">,</span>&nbsp;<span class="num" id="3780837">13</span><span class="op" id="3780839">,</span>&nbsp;<span class="num" id="3780841">8</span><span class="op" id="3780842">,</span>&nbsp;<span class="num" id="3780844">7</span><span class="op" id="3780845">,</span>&nbsp;<span class="num" id="3780847">6</span><span class="op" id="3780848">,</span><br>
<span class="lineno"></span><span class="op" id="3780850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3780853">//&nbsp;trailingZeroBits&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;least&nbsp;significant&nbsp;zero</span><br>
<span class="lineno">1005</span><span class="comment" id="3780930">//&nbsp;bits&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="3780944">func</span>&nbsp;<span class="ident" id="3780949">trailingZeroBits</span><span class="op" id="3780965">(</span><span class="ident" id="3780966">x</span>&nbsp;<span class="ident" id="3780968">Word</span><span class="op" id="3780972">)</span>&nbsp;<span class="builtintype" id="3780974">uint</span>&nbsp;<span class="op" id="3780979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3780982">//&nbsp;x&nbsp;&amp;&nbsp;-x&nbsp;leaves&nbsp;only&nbsp;the&nbsp;right-most&nbsp;bit&nbsp;set&nbsp;in&nbsp;the&nbsp;word.&nbsp;Let&nbsp;k&nbsp;be&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3781054">//&nbsp;index&nbsp;of&nbsp;that&nbsp;bit.&nbsp;Since&nbsp;only&nbsp;a&nbsp;single&nbsp;bit&nbsp;is&nbsp;set,&nbsp;the&nbsp;value&nbsp;is&nbsp;two</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3781126">//&nbsp;to&nbsp;the&nbsp;power&nbsp;of&nbsp;k.&nbsp;Multiplying&nbsp;by&nbsp;a&nbsp;power&nbsp;of&nbsp;two&nbsp;is&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3781196">//&nbsp;left&nbsp;shifting,&nbsp;in&nbsp;this&nbsp;case&nbsp;by&nbsp;k&nbsp;bits.&nbsp;&nbsp;The&nbsp;de&nbsp;Bruijn&nbsp;constant&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3781266">//&nbsp;such&nbsp;that&nbsp;all&nbsp;six&nbsp;bit,&nbsp;consecutive&nbsp;substrings&nbsp;are&nbsp;distinct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3781330">//&nbsp;Therefore,&nbsp;if&nbsp;we&nbsp;have&nbsp;a&nbsp;left&nbsp;shifted&nbsp;version&nbsp;of&nbsp;this&nbsp;constant&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3781403">//&nbsp;find&nbsp;by&nbsp;how&nbsp;many&nbsp;bits&nbsp;it&nbsp;was&nbsp;shifted&nbsp;by&nbsp;looking&nbsp;at&nbsp;which&nbsp;six&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3781472">//&nbsp;substring&nbsp;ended&nbsp;up&nbsp;at&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;word.</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3781519">//&nbsp;(Knuth,&nbsp;volume&nbsp;4,&nbsp;section&nbsp;7.3.1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781556">switch</span>&nbsp;<span class="ident" id="3781563">_W</span>&nbsp;<span class="op" id="3781566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781569">case</span>&nbsp;<span class="num" id="3781574">32</span><span class="op" id="3781576">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781580">return</span>&nbsp;<span class="builtintype" id="3781587">uint</span><span class="op" id="3781591">(</span><span class="ident" id="3781592">deBruijn32Lookup</span><span class="op" id="3781608">[</span><span class="op" id="3781609">(</span><span class="op" id="3781610">(</span><span class="ident" id="3781611">x</span><span class="op" id="3781612">&amp;</span><span class="op" id="3781613">-</span><span class="ident" id="3781614">x</span><span class="op" id="3781615">)</span><span class="op" id="3781616">*</span><span class="ident" id="3781617">deBruijn32</span><span class="op" id="3781627">)</span><span class="op" id="3781628">&gt;&gt;</span><span class="num" id="3781630">27</span><span class="op" id="3781632">]</span><span class="op" id="3781633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781636">case</span>&nbsp;<span class="num" id="3781641">64</span><span class="op" id="3781643">:</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781647">return</span>&nbsp;<span class="builtintype" id="3781654">uint</span><span class="op" id="3781658">(</span><span class="ident" id="3781659">deBruijn64Lookup</span><span class="op" id="3781675">[</span><span class="op" id="3781676">(</span><span class="op" id="3781677">(</span><span class="ident" id="3781678">x</span><span class="op" id="3781679">&amp;</span><span class="op" id="3781680">-</span><span class="ident" id="3781681">x</span><span class="op" id="3781682">)</span><span class="op" id="3781683">*</span><span class="op" id="3781684">(</span><span class="ident" id="3781685">deBruijn64</span><span class="op" id="3781695">&amp;</span><span class="ident" id="3781696">_M</span><span class="op" id="3781698">)</span><span class="op" id="3781699">)</span><span class="op" id="3781700">&gt;&gt;</span><span class="num" id="3781702">58</span><span class="op" id="3781704">]</span><span class="op" id="3781705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781708">default</span><span class="op" id="3781715">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3781719">panic</span><span class="op" id="3781724">(</span><span class="string" id="3781725">&#34;unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="3781744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3781747">}</span><br>
<span class="lineno"></span><span class="op" id="3781749">}</span><br>
<span class="lineno">1025</span><br>
<span class="lineno"></span><span class="comment" id="3781752">//&nbsp;trailingZeroBits&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;least&nbsp;significant&nbsp;zero</span><br>
<span class="lineno"></span><span class="comment" id="3781829">//&nbsp;bits&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="3781843">func</span>&nbsp;<span class="op" id="3781848">(</span><span class="ident" id="3781849">x</span>&nbsp;<span class="ident" id="3781851">nat</span><span class="op" id="3781854">)</span>&nbsp;<span class="ident" id="3781856">trailingZeroBits</span><span class="op" id="3781872">(</span><span class="op" id="3781873">)</span>&nbsp;<span class="builtintype" id="3781875">uint</span>&nbsp;<span class="op" id="3781880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781883">if</span>&nbsp;<span class="builtinfunc" id="3781886">len</span><span class="op" id="3781889">(</span><span class="ident" id="3781890">x</span><span class="op" id="3781891">)</span>&nbsp;<span class="op" id="3781893">==</span>&nbsp;<span class="num" id="3781896">0</span>&nbsp;<span class="op" id="3781898">{</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781902">return</span>&nbsp;<span class="num" id="3781909">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3781912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781915">var</span>&nbsp;<span class="ident" id="3781919">i</span>&nbsp;<span class="builtintype" id="3781921">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781927">for</span>&nbsp;<span class="ident" id="3781931">x</span><span class="op" id="3781932">[</span><span class="ident" id="3781933">i</span><span class="op" id="3781934">]</span>&nbsp;<span class="op" id="3781936">==</span>&nbsp;<span class="num" id="3781939">0</span>&nbsp;<span class="op" id="3781941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3781945">i</span><span class="op" id="3781946">++</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3781950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3781953">//&nbsp;x[i]&nbsp;!=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781967">return</span>&nbsp;<span class="ident" id="3781974">i</span><span class="op" id="3781975">*</span><span class="ident" id="3781976">_W</span>&nbsp;<span class="op" id="3781979">+</span>&nbsp;<span class="ident" id="3781981">trailingZeroBits</span><span class="op" id="3781997">(</span><span class="ident" id="3781998">x</span><span class="op" id="3781999">[</span><span class="ident" id="3782000">i</span><span class="op" id="3782001">]</span><span class="op" id="3782002">)</span><br>
<span class="lineno"></span><span class="op" id="3782004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1040</span><span class="comment" id="3782007">//&nbsp;z&nbsp;=&nbsp;x&nbsp;&lt;&lt;&nbsp;s</span><br>
<span class="lineno"></span><span class="keyword" id="3782021">func</span>&nbsp;<span class="op" id="3782026">(</span><span class="ident" id="3782027">z</span>&nbsp;<span class="ident" id="3782029">nat</span><span class="op" id="3782032">)</span>&nbsp;<span class="ident" id="3782034">shl</span><span class="op" id="3782037">(</span><span class="ident" id="3782038">x</span>&nbsp;<span class="ident" id="3782040">nat</span><span class="op" id="3782043">,</span>&nbsp;<span class="ident" id="3782045">s</span>&nbsp;<span class="builtintype" id="3782047">uint</span><span class="op" id="3782051">)</span>&nbsp;<span class="ident" id="3782053">nat</span>&nbsp;<span class="op" id="3782057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782060">m</span>&nbsp;<span class="op" id="3782062">:=</span>&nbsp;<span class="builtinfunc" id="3782065">len</span><span class="op" id="3782068">(</span><span class="ident" id="3782069">x</span><span class="op" id="3782070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3782073">if</span>&nbsp;<span class="ident" id="3782076">m</span>&nbsp;<span class="op" id="3782078">==</span>&nbsp;<span class="num" id="3782081">0</span>&nbsp;<span class="op" id="3782083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3782087">return</span>&nbsp;<span class="ident" id="3782094">z</span><span class="op" id="3782095">.</span><span class="builtinfunc" id="3782096">make</span><span class="op" id="3782100">(</span><span class="num" id="3782101">0</span><span class="op" id="3782102">)</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3782105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3782108">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782119">n</span>&nbsp;<span class="op" id="3782121">:=</span>&nbsp;<span class="ident" id="3782124">m</span>&nbsp;<span class="op" id="3782126">+</span>&nbsp;<span class="builtintype" id="3782128">int</span><span class="op" id="3782131">(</span><span class="ident" id="3782132">s</span><span class="op" id="3782133">/</span><span class="ident" id="3782134">_W</span><span class="op" id="3782136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782139">z</span>&nbsp;<span class="op" id="3782141">=</span>&nbsp;<span class="ident" id="3782143">z</span><span class="op" id="3782144">.</span><span class="builtinfunc" id="3782145">make</span><span class="op" id="3782149">(</span><span class="ident" id="3782150">n</span>&nbsp;<span class="op" id="3782152">+</span>&nbsp;<span class="num" id="3782154">1</span><span class="op" id="3782155">)</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782158">z</span><span class="op" id="3782159">[</span><span class="ident" id="3782160">n</span><span class="op" id="3782161">]</span>&nbsp;<span class="op" id="3782163">=</span>&nbsp;<span class="ident" id="3782165">shlVU</span><span class="op" id="3782170">(</span><span class="ident" id="3782171">z</span><span class="op" id="3782172">[</span><span class="ident" id="3782173">n</span><span class="op" id="3782174">-</span><span class="ident" id="3782175">m</span><span class="op" id="3782176">:</span><span class="ident" id="3782177">n</span><span class="op" id="3782178">]</span><span class="op" id="3782179">,</span>&nbsp;<span class="ident" id="3782181">x</span><span class="op" id="3782182">,</span>&nbsp;<span class="ident" id="3782184">s</span><span class="op" id="3782185">%</span><span class="ident" id="3782186">_W</span><span class="op" id="3782188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782191">z</span><span class="op" id="3782192">[</span><span class="num" id="3782193">0</span>&nbsp;<span class="op" id="3782195">:</span>&nbsp;<span class="ident" id="3782197">n</span><span class="op" id="3782198">-</span><span class="ident" id="3782199">m</span><span class="op" id="3782200">]</span><span class="op" id="3782201">.</span><span class="ident" id="3782202">clear</span><span class="op" id="3782207">(</span><span class="op" id="3782208">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3782212">return</span>&nbsp;<span class="ident" id="3782219">z</span><span class="op" id="3782220">.</span><span class="ident" id="3782221">norm</span><span class="op" id="3782225">(</span><span class="op" id="3782226">)</span><br>
<span class="lineno"></span><span class="op" id="3782228">}</span><br>
<span class="lineno">1055</span><br>
<span class="lineno"></span><span class="comment" id="3782231">//&nbsp;z&nbsp;=&nbsp;x&nbsp;&gt;&gt;&nbsp;s</span><br>
<span class="lineno"></span><span class="keyword" id="3782245">func</span>&nbsp;<span class="op" id="3782250">(</span><span class="ident" id="3782251">z</span>&nbsp;<span class="ident" id="3782253">nat</span><span class="op" id="3782256">)</span>&nbsp;<span class="ident" id="3782258">shr</span><span class="op" id="3782261">(</span><span class="ident" id="3782262">x</span>&nbsp;<span class="ident" id="3782264">nat</span><span class="op" id="3782267">,</span>&nbsp;<span class="ident" id="3782269">s</span>&nbsp;<span class="builtintype" id="3782271">uint</span><span class="op" id="3782275">)</span>&nbsp;<span class="ident" id="3782277">nat</span>&nbsp;<span class="op" id="3782281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782284">m</span>&nbsp;<span class="op" id="3782286">:=</span>&nbsp;<span class="builtinfunc" id="3782289">len</span><span class="op" id="3782292">(</span><span class="ident" id="3782293">x</span><span class="op" id="3782294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782297">n</span>&nbsp;<span class="op" id="3782299">:=</span>&nbsp;<span class="ident" id="3782302">m</span>&nbsp;<span class="op" id="3782304">-</span>&nbsp;<span class="builtintype" id="3782306">int</span><span class="op" id="3782309">(</span><span class="ident" id="3782310">s</span><span class="op" id="3782311">/</span><span class="ident" id="3782312">_W</span><span class="op" id="3782314">)</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3782317">if</span>&nbsp;<span class="ident" id="3782320">n</span>&nbsp;<span class="op" id="3782322">&lt;=</span>&nbsp;<span class="num" id="3782325">0</span>&nbsp;<span class="op" id="3782327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3782331">return</span>&nbsp;<span class="ident" id="3782338">z</span><span class="op" id="3782339">.</span><span class="builtinfunc" id="3782340">make</span><span class="op" id="3782344">(</span><span class="num" id="3782345">0</span><span class="op" id="3782346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3782349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3782352">//&nbsp;n&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782363">z</span>&nbsp;<span class="op" id="3782365">=</span>&nbsp;<span class="ident" id="3782367">z</span><span class="op" id="3782368">.</span><span class="builtinfunc" id="3782369">make</span><span class="op" id="3782373">(</span><span class="ident" id="3782374">n</span><span class="op" id="3782375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782378">shrVU</span><span class="op" id="3782383">(</span><span class="ident" id="3782384">z</span><span class="op" id="3782385">,</span>&nbsp;<span class="ident" id="3782387">x</span><span class="op" id="3782388">[</span><span class="ident" id="3782389">m</span><span class="op" id="3782390">-</span><span class="ident" id="3782391">n</span><span class="op" id="3782392">:</span><span class="op" id="3782393">]</span><span class="op" id="3782394">,</span>&nbsp;<span class="ident" id="3782396">s</span><span class="op" id="3782397">%</span><span class="ident" id="3782398">_W</span><span class="op" id="3782400">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3782404">return</span>&nbsp;<span class="ident" id="3782411">z</span><span class="op" id="3782412">.</span><span class="ident" id="3782413">norm</span><span class="op" id="3782417">(</span><span class="op" id="3782418">)</span><br>
<span class="lineno"></span><span class="op" id="3782420">}</span><br>
<span class="lineno">1070</span><br>
<span class="lineno"></span><span class="keyword" id="3782423">func</span>&nbsp;<span class="op" id="3782428">(</span><span class="ident" id="3782429">z</span>&nbsp;<span class="ident" id="3782431">nat</span><span class="op" id="3782434">)</span>&nbsp;<span class="ident" id="3782436">setBit</span><span class="op" id="3782442">(</span><span class="ident" id="3782443">x</span>&nbsp;<span class="ident" id="3782445">nat</span><span class="op" id="3782448">,</span>&nbsp;<span class="ident" id="3782450">i</span>&nbsp;<span class="builtintype" id="3782452">uint</span><span class="op" id="3782456">,</span>&nbsp;<span class="ident" id="3782458">b</span>&nbsp;<span class="builtintype" id="3782460">uint</span><span class="op" id="3782464">)</span>&nbsp;<span class="ident" id="3782466">nat</span>&nbsp;<span class="op" id="3782470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782473">j</span>&nbsp;<span class="op" id="3782475">:=</span>&nbsp;<span class="builtintype" id="3782478">int</span><span class="op" id="3782481">(</span><span class="ident" id="3782482">i</span>&nbsp;<span class="op" id="3782484">/</span>&nbsp;<span class="ident" id="3782486">_W</span><span class="op" id="3782488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782491">m</span>&nbsp;<span class="op" id="3782493">:=</span>&nbsp;<span class="ident" id="3782496">Word</span><span class="op" id="3782500">(</span><span class="num" id="3782501">1</span><span class="op" id="3782502">)</span>&nbsp;<span class="op" id="3782504">&lt;&lt;</span>&nbsp;<span class="op" id="3782507">(</span><span class="ident" id="3782508">i</span>&nbsp;<span class="op" id="3782510">%</span>&nbsp;<span class="ident" id="3782512">_W</span><span class="op" id="3782514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782517">n</span>&nbsp;<span class="op" id="3782519">:=</span>&nbsp;<span class="builtinfunc" id="3782522">len</span><span class="op" id="3782525">(</span><span class="ident" id="3782526">x</span><span class="op" id="3782527">)</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3782530">switch</span>&nbsp;<span class="ident" id="3782537">b</span>&nbsp;<span class="op" id="3782539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3782542">case</span>&nbsp;<span class="num" id="3782547">0</span><span class="op" id="3782548">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782552">z</span>&nbsp;<span class="op" id="3782554">=</span>&nbsp;<span class="ident" id="3782556">z</span><span class="op" id="3782557">.</span><span class="builtinfunc" id="3782558">make</span><span class="op" id="3782562">(</span><span class="ident" id="3782563">n</span><span class="op" id="3782564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3782568">copy</span><span class="op" id="3782572">(</span><span class="ident" id="3782573">z</span><span class="op" id="3782574">,</span>&nbsp;<span class="ident" id="3782576">x</span><span class="op" id="3782577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3782581">if</span>&nbsp;<span class="ident" id="3782584">j</span>&nbsp;<span class="op" id="3782586">&gt;=</span>&nbsp;<span class="ident" id="3782589">n</span>&nbsp;<span class="op" id="3782591">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3782596">//&nbsp;no&nbsp;need&nbsp;to&nbsp;grow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3782618">return</span>&nbsp;<span class="ident" id="3782625">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3782629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782633">z</span><span class="op" id="3782634">[</span><span class="ident" id="3782635">j</span><span class="op" id="3782636">]</span>&nbsp;<span class="op" id="3782638">&amp;^=</span>&nbsp;<span class="ident" id="3782642">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3782646">return</span>&nbsp;<span class="ident" id="3782653">z</span><span class="op" id="3782654">.</span><span class="ident" id="3782655">norm</span><span class="op" id="3782659">(</span><span class="op" id="3782660">)</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3782663">case</span>&nbsp;<span class="num" id="3782668">1</span><span class="op" id="3782669">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3782673">if</span>&nbsp;<span class="ident" id="3782676">j</span>&nbsp;<span class="op" id="3782678">&gt;=</span>&nbsp;<span class="ident" id="3782681">n</span>&nbsp;<span class="op" id="3782683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782688">z</span>&nbsp;<span class="op" id="3782690">=</span>&nbsp;<span class="ident" id="3782692">z</span><span class="op" id="3782693">.</span><span class="builtinfunc" id="3782694">make</span><span class="op" id="3782698">(</span><span class="ident" id="3782699">j</span>&nbsp;<span class="op" id="3782701">+</span>&nbsp;<span class="num" id="3782703">1</span><span class="op" id="3782704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782709">z</span><span class="op" id="3782710">[</span><span class="ident" id="3782711">n</span><span class="op" id="3782712">:</span><span class="op" id="3782713">]</span><span class="op" id="3782714">.</span><span class="ident" id="3782715">clear</span><span class="op" id="3782720">(</span><span class="op" id="3782721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3782725">}</span>&nbsp;<span class="keyword" id="3782727">else</span>&nbsp;<span class="op" id="3782732">{</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782737">z</span>&nbsp;<span class="op" id="3782739">=</span>&nbsp;<span class="ident" id="3782741">z</span><span class="op" id="3782742">.</span><span class="builtinfunc" id="3782743">make</span><span class="op" id="3782747">(</span><span class="ident" id="3782748">n</span><span class="op" id="3782749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3782753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3782757">copy</span><span class="op" id="3782761">(</span><span class="ident" id="3782762">z</span><span class="op" id="3782763">,</span>&nbsp;<span class="ident" id="3782765">x</span><span class="op" id="3782766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782770">z</span><span class="op" id="3782771">[</span><span class="ident" id="3782772">j</span><span class="op" id="3782773">]</span>&nbsp;<span class="op" id="3782775">|=</span>&nbsp;<span class="ident" id="3782778">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3782782">//&nbsp;no&nbsp;need&nbsp;to&nbsp;normalize</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3782808">return</span>&nbsp;<span class="ident" id="3782815">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3782818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3782821">panic</span><span class="op" id="3782826">(</span><span class="string" id="3782827">&#34;set&nbsp;bit&nbsp;is&nbsp;not&nbsp;0&nbsp;or&nbsp;1&#34;</span><span class="op" id="3782850">)</span><br>
<span class="lineno"></span><span class="op" id="3782852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1100</span><span class="keyword" id="3782855">func</span>&nbsp;<span class="op" id="3782860">(</span><span class="ident" id="3782861">z</span>&nbsp;<span class="ident" id="3782863">nat</span><span class="op" id="3782866">)</span>&nbsp;<span class="ident" id="3782868">bit</span><span class="op" id="3782871">(</span><span class="ident" id="3782872">i</span>&nbsp;<span class="builtintype" id="3782874">uint</span><span class="op" id="3782878">)</span>&nbsp;<span class="builtintype" id="3782880">uint</span>&nbsp;<span class="op" id="3782885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782888">j</span>&nbsp;<span class="op" id="3782890">:=</span>&nbsp;<span class="builtintype" id="3782893">int</span><span class="op" id="3782896">(</span><span class="ident" id="3782897">i</span>&nbsp;<span class="op" id="3782899">/</span>&nbsp;<span class="ident" id="3782901">_W</span><span class="op" id="3782903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3782906">if</span>&nbsp;<span class="ident" id="3782909">j</span>&nbsp;<span class="op" id="3782911">&gt;=</span>&nbsp;<span class="builtinfunc" id="3782914">len</span><span class="op" id="3782917">(</span><span class="ident" id="3782918">z</span><span class="op" id="3782919">)</span>&nbsp;<span class="op" id="3782921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3782925">return</span>&nbsp;<span class="num" id="3782932">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3782935">}</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3782938">return</span>&nbsp;<span class="builtintype" id="3782945">uint</span><span class="op" id="3782949">(</span><span class="ident" id="3782950">z</span><span class="op" id="3782951">[</span><span class="ident" id="3782952">j</span><span class="op" id="3782953">]</span>&nbsp;<span class="op" id="3782955">&gt;&gt;</span>&nbsp;<span class="op" id="3782958">(</span><span class="ident" id="3782959">i</span>&nbsp;<span class="op" id="3782961">%</span>&nbsp;<span class="ident" id="3782963">_W</span><span class="op" id="3782965">)</span>&nbsp;<span class="op" id="3782967">&amp;</span>&nbsp;<span class="num" id="3782969">1</span><span class="op" id="3782970">)</span><br>
<span class="lineno"></span><span class="op" id="3782972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3782975">func</span>&nbsp;<span class="op" id="3782980">(</span><span class="ident" id="3782981">z</span>&nbsp;<span class="ident" id="3782983">nat</span><span class="op" id="3782986">)</span>&nbsp;<span class="ident" id="3782988">and</span><span class="op" id="3782991">(</span><span class="ident" id="3782992">x</span><span class="op" id="3782993">,</span>&nbsp;<span class="ident" id="3782995">y</span>&nbsp;<span class="ident" id="3782997">nat</span><span class="op" id="3783000">)</span>&nbsp;<span class="ident" id="3783002">nat</span>&nbsp;<span class="op" id="3783006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783009">m</span>&nbsp;<span class="op" id="3783011">:=</span>&nbsp;<span class="builtinfunc" id="3783014">len</span><span class="op" id="3783017">(</span><span class="ident" id="3783018">x</span><span class="op" id="3783019">)</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783022">n</span>&nbsp;<span class="op" id="3783024">:=</span>&nbsp;<span class="builtinfunc" id="3783027">len</span><span class="op" id="3783030">(</span><span class="ident" id="3783031">y</span><span class="op" id="3783032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3783035">if</span>&nbsp;<span class="ident" id="3783038">m</span>&nbsp;<span class="op" id="3783040">&gt;</span>&nbsp;<span class="ident" id="3783042">n</span>&nbsp;<span class="op" id="3783044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783048">m</span>&nbsp;<span class="op" id="3783050">=</span>&nbsp;<span class="ident" id="3783052">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3783055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3783058">//&nbsp;m&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno">1115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783070">z</span>&nbsp;<span class="op" id="3783072">=</span>&nbsp;<span class="ident" id="3783074">z</span><span class="op" id="3783075">.</span><span class="builtinfunc" id="3783076">make</span><span class="op" id="3783080">(</span><span class="ident" id="3783081">m</span><span class="op" id="3783082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3783085">for</span>&nbsp;<span class="ident" id="3783089">i</span>&nbsp;<span class="op" id="3783091">:=</span>&nbsp;<span class="num" id="3783094">0</span><span class="op" id="3783095">;</span>&nbsp;<span class="ident" id="3783097">i</span>&nbsp;<span class="op" id="3783099">&lt;</span>&nbsp;<span class="ident" id="3783101">m</span><span class="op" id="3783102">;</span>&nbsp;<span class="ident" id="3783104">i</span><span class="op" id="3783105">++</span>&nbsp;<span class="op" id="3783108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783112">z</span><span class="op" id="3783113">[</span><span class="ident" id="3783114">i</span><span class="op" id="3783115">]</span>&nbsp;<span class="op" id="3783117">=</span>&nbsp;<span class="ident" id="3783119">x</span><span class="op" id="3783120">[</span><span class="ident" id="3783121">i</span><span class="op" id="3783122">]</span>&nbsp;<span class="op" id="3783124">&amp;</span>&nbsp;<span class="ident" id="3783126">y</span><span class="op" id="3783127">[</span><span class="ident" id="3783128">i</span><span class="op" id="3783129">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3783132">}</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3783136">return</span>&nbsp;<span class="ident" id="3783143">z</span><span class="op" id="3783144">.</span><span class="ident" id="3783145">norm</span><span class="op" id="3783149">(</span><span class="op" id="3783150">)</span><br>
<span class="lineno"></span><span class="op" id="3783152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3783155">func</span>&nbsp;<span class="op" id="3783160">(</span><span class="ident" id="3783161">z</span>&nbsp;<span class="ident" id="3783163">nat</span><span class="op" id="3783166">)</span>&nbsp;<span class="ident" id="3783168">andNot</span><span class="op" id="3783174">(</span><span class="ident" id="3783175">x</span><span class="op" id="3783176">,</span>&nbsp;<span class="ident" id="3783178">y</span>&nbsp;<span class="ident" id="3783180">nat</span><span class="op" id="3783183">)</span>&nbsp;<span class="ident" id="3783185">nat</span>&nbsp;<span class="op" id="3783189">{</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783192">m</span>&nbsp;<span class="op" id="3783194">:=</span>&nbsp;<span class="builtinfunc" id="3783197">len</span><span class="op" id="3783200">(</span><span class="ident" id="3783201">x</span><span class="op" id="3783202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783205">n</span>&nbsp;<span class="op" id="3783207">:=</span>&nbsp;<span class="builtinfunc" id="3783210">len</span><span class="op" id="3783213">(</span><span class="ident" id="3783214">y</span><span class="op" id="3783215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3783218">if</span>&nbsp;<span class="ident" id="3783221">n</span>&nbsp;<span class="op" id="3783223">&gt;</span>&nbsp;<span class="ident" id="3783225">m</span>&nbsp;<span class="op" id="3783227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783231">n</span>&nbsp;<span class="op" id="3783233">=</span>&nbsp;<span class="ident" id="3783235">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3783238">}</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3783241">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783253">z</span>&nbsp;<span class="op" id="3783255">=</span>&nbsp;<span class="ident" id="3783257">z</span><span class="op" id="3783258">.</span><span class="builtinfunc" id="3783259">make</span><span class="op" id="3783263">(</span><span class="ident" id="3783264">m</span><span class="op" id="3783265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3783268">for</span>&nbsp;<span class="ident" id="3783272">i</span>&nbsp;<span class="op" id="3783274">:=</span>&nbsp;<span class="num" id="3783277">0</span><span class="op" id="3783278">;</span>&nbsp;<span class="ident" id="3783280">i</span>&nbsp;<span class="op" id="3783282">&lt;</span>&nbsp;<span class="ident" id="3783284">n</span><span class="op" id="3783285">;</span>&nbsp;<span class="ident" id="3783287">i</span><span class="op" id="3783288">++</span>&nbsp;<span class="op" id="3783291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783295">z</span><span class="op" id="3783296">[</span><span class="ident" id="3783297">i</span><span class="op" id="3783298">]</span>&nbsp;<span class="op" id="3783300">=</span>&nbsp;<span class="ident" id="3783302">x</span><span class="op" id="3783303">[</span><span class="ident" id="3783304">i</span><span class="op" id="3783305">]</span>&nbsp;<span class="op" id="3783307">&amp;^</span>&nbsp;<span class="ident" id="3783310">y</span><span class="op" id="3783311">[</span><span class="ident" id="3783312">i</span><span class="op" id="3783313">]</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3783316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3783319">copy</span><span class="op" id="3783323">(</span><span class="ident" id="3783324">z</span><span class="op" id="3783325">[</span><span class="ident" id="3783326">n</span><span class="op" id="3783327">:</span><span class="ident" id="3783328">m</span><span class="op" id="3783329">]</span><span class="op" id="3783330">,</span>&nbsp;<span class="ident" id="3783332">x</span><span class="op" id="3783333">[</span><span class="ident" id="3783334">n</span><span class="op" id="3783335">:</span><span class="ident" id="3783336">m</span><span class="op" id="3783337">]</span><span class="op" id="3783338">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3783342">return</span>&nbsp;<span class="ident" id="3783349">z</span><span class="op" id="3783350">.</span><span class="ident" id="3783351">norm</span><span class="op" id="3783355">(</span><span class="op" id="3783356">)</span><br>
<span class="lineno"></span><span class="op" id="3783358">}</span><br>
<span class="lineno">1140</span><br>
<span class="lineno"></span><span class="keyword" id="3783361">func</span>&nbsp;<span class="op" id="3783366">(</span><span class="ident" id="3783367">z</span>&nbsp;<span class="ident" id="3783369">nat</span><span class="op" id="3783372">)</span>&nbsp;<span class="ident" id="3783374">or</span><span class="op" id="3783376">(</span><span class="ident" id="3783377">x</span><span class="op" id="3783378">,</span>&nbsp;<span class="ident" id="3783380">y</span>&nbsp;<span class="ident" id="3783382">nat</span><span class="op" id="3783385">)</span>&nbsp;<span class="ident" id="3783387">nat</span>&nbsp;<span class="op" id="3783391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783394">m</span>&nbsp;<span class="op" id="3783396">:=</span>&nbsp;<span class="builtinfunc" id="3783399">len</span><span class="op" id="3783402">(</span><span class="ident" id="3783403">x</span><span class="op" id="3783404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783407">n</span>&nbsp;<span class="op" id="3783409">:=</span>&nbsp;<span class="builtinfunc" id="3783412">len</span><span class="op" id="3783415">(</span><span class="ident" id="3783416">y</span><span class="op" id="3783417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783420">s</span>&nbsp;<span class="op" id="3783422">:=</span>&nbsp;<span class="ident" id="3783425">x</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3783428">if</span>&nbsp;<span class="ident" id="3783431">m</span>&nbsp;<span class="op" id="3783433">&lt;</span>&nbsp;<span class="ident" id="3783435">n</span>&nbsp;<span class="op" id="3783437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783441">n</span><span class="op" id="3783442">,</span>&nbsp;<span class="ident" id="3783444">m</span>&nbsp;<span class="op" id="3783446">=</span>&nbsp;<span class="ident" id="3783448">m</span><span class="op" id="3783449">,</span>&nbsp;<span class="ident" id="3783451">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783455">s</span>&nbsp;<span class="op" id="3783457">=</span>&nbsp;<span class="ident" id="3783459">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3783462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3783465">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno">1150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783477">z</span>&nbsp;<span class="op" id="3783479">=</span>&nbsp;<span class="ident" id="3783481">z</span><span class="op" id="3783482">.</span><span class="builtinfunc" id="3783483">make</span><span class="op" id="3783487">(</span><span class="ident" id="3783488">m</span><span class="op" id="3783489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3783492">for</span>&nbsp;<span class="ident" id="3783496">i</span>&nbsp;<span class="op" id="3783498">:=</span>&nbsp;<span class="num" id="3783501">0</span><span class="op" id="3783502">;</span>&nbsp;<span class="ident" id="3783504">i</span>&nbsp;<span class="op" id="3783506">&lt;</span>&nbsp;<span class="ident" id="3783508">n</span><span class="op" id="3783509">;</span>&nbsp;<span class="ident" id="3783511">i</span><span class="op" id="3783512">++</span>&nbsp;<span class="op" id="3783515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783519">z</span><span class="op" id="3783520">[</span><span class="ident" id="3783521">i</span><span class="op" id="3783522">]</span>&nbsp;<span class="op" id="3783524">=</span>&nbsp;<span class="ident" id="3783526">x</span><span class="op" id="3783527">[</span><span class="ident" id="3783528">i</span><span class="op" id="3783529">]</span>&nbsp;<span class="op" id="3783531">|</span>&nbsp;<span class="ident" id="3783533">y</span><span class="op" id="3783534">[</span><span class="ident" id="3783535">i</span><span class="op" id="3783536">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3783539">}</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3783542">copy</span><span class="op" id="3783546">(</span><span class="ident" id="3783547">z</span><span class="op" id="3783548">[</span><span class="ident" id="3783549">n</span><span class="op" id="3783550">:</span><span class="ident" id="3783551">m</span><span class="op" id="3783552">]</span><span class="op" id="3783553">,</span>&nbsp;<span class="ident" id="3783555">s</span><span class="op" id="3783556">[</span><span class="ident" id="3783557">n</span><span class="op" id="3783558">:</span><span class="ident" id="3783559">m</span><span class="op" id="3783560">]</span><span class="op" id="3783561">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3783565">return</span>&nbsp;<span class="ident" id="3783572">z</span><span class="op" id="3783573">.</span><span class="ident" id="3783574">norm</span><span class="op" id="3783578">(</span><span class="op" id="3783579">)</span><br>
<span class="lineno"></span><span class="op" id="3783581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1160</span><span class="keyword" id="3783584">func</span>&nbsp;<span class="op" id="3783589">(</span><span class="ident" id="3783590">z</span>&nbsp;<span class="ident" id="3783592">nat</span><span class="op" id="3783595">)</span>&nbsp;<span class="ident" id="3783597">xor</span><span class="op" id="3783600">(</span><span class="ident" id="3783601">x</span><span class="op" id="3783602">,</span>&nbsp;<span class="ident" id="3783604">y</span>&nbsp;<span class="ident" id="3783606">nat</span><span class="op" id="3783609">)</span>&nbsp;<span class="ident" id="3783611">nat</span>&nbsp;<span class="op" id="3783615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783618">m</span>&nbsp;<span class="op" id="3783620">:=</span>&nbsp;<span class="builtinfunc" id="3783623">len</span><span class="op" id="3783626">(</span><span class="ident" id="3783627">x</span><span class="op" id="3783628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783631">n</span>&nbsp;<span class="op" id="3783633">:=</span>&nbsp;<span class="builtinfunc" id="3783636">len</span><span class="op" id="3783639">(</span><span class="ident" id="3783640">y</span><span class="op" id="3783641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783644">s</span>&nbsp;<span class="op" id="3783646">:=</span>&nbsp;<span class="ident" id="3783649">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3783652">if</span>&nbsp;<span class="ident" id="3783655">m</span>&nbsp;<span class="op" id="3783657">&lt;</span>&nbsp;<span class="ident" id="3783659">n</span>&nbsp;<span class="op" id="3783661">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783665">n</span><span class="op" id="3783666">,</span>&nbsp;<span class="ident" id="3783668">m</span>&nbsp;<span class="op" id="3783670">=</span>&nbsp;<span class="ident" id="3783672">m</span><span class="op" id="3783673">,</span>&nbsp;<span class="ident" id="3783675">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783679">s</span>&nbsp;<span class="op" id="3783681">=</span>&nbsp;<span class="ident" id="3783683">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3783686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3783689">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783701">z</span>&nbsp;<span class="op" id="3783703">=</span>&nbsp;<span class="ident" id="3783705">z</span><span class="op" id="3783706">.</span><span class="builtinfunc" id="3783707">make</span><span class="op" id="3783711">(</span><span class="ident" id="3783712">m</span><span class="op" id="3783713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3783716">for</span>&nbsp;<span class="ident" id="3783720">i</span>&nbsp;<span class="op" id="3783722">:=</span>&nbsp;<span class="num" id="3783725">0</span><span class="op" id="3783726">;</span>&nbsp;<span class="ident" id="3783728">i</span>&nbsp;<span class="op" id="3783730">&lt;</span>&nbsp;<span class="ident" id="3783732">n</span><span class="op" id="3783733">;</span>&nbsp;<span class="ident" id="3783735">i</span><span class="op" id="3783736">++</span>&nbsp;<span class="op" id="3783739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783743">z</span><span class="op" id="3783744">[</span><span class="ident" id="3783745">i</span><span class="op" id="3783746">]</span>&nbsp;<span class="op" id="3783748">=</span>&nbsp;<span class="ident" id="3783750">x</span><span class="op" id="3783751">[</span><span class="ident" id="3783752">i</span><span class="op" id="3783753">]</span>&nbsp;<span class="op" id="3783755">^</span>&nbsp;<span class="ident" id="3783757">y</span><span class="op" id="3783758">[</span><span class="ident" id="3783759">i</span><span class="op" id="3783760">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3783763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3783766">copy</span><span class="op" id="3783770">(</span><span class="ident" id="3783771">z</span><span class="op" id="3783772">[</span><span class="ident" id="3783773">n</span><span class="op" id="3783774">:</span><span class="ident" id="3783775">m</span><span class="op" id="3783776">]</span><span class="op" id="3783777">,</span>&nbsp;<span class="ident" id="3783779">s</span><span class="op" id="3783780">[</span><span class="ident" id="3783781">n</span><span class="op" id="3783782">:</span><span class="ident" id="3783783">m</span><span class="op" id="3783784">]</span><span class="op" id="3783785">)</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3783789">return</span>&nbsp;<span class="ident" id="3783796">z</span><span class="op" id="3783797">.</span><span class="ident" id="3783798">norm</span><span class="op" id="3783802">(</span><span class="op" id="3783803">)</span><br>
<span class="lineno"></span><span class="op" id="3783805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3783808">//&nbsp;greaterThan&nbsp;returns&nbsp;true&nbsp;iff&nbsp;(x1&lt;&lt;_W&nbsp;+&nbsp;x2)&nbsp;&gt;&nbsp;(y1&lt;&lt;_W&nbsp;+&nbsp;y2)</span><br>
<span class="lineno">1180</span><span class="keyword" id="3783870">func</span>&nbsp;<span class="ident" id="3783875">greaterThan</span><span class="op" id="3783886">(</span><span class="ident" id="3783887">x1</span><span class="op" id="3783889">,</span>&nbsp;<span class="ident" id="3783891">x2</span><span class="op" id="3783893">,</span>&nbsp;<span class="ident" id="3783895">y1</span><span class="op" id="3783897">,</span>&nbsp;<span class="ident" id="3783899">y2</span>&nbsp;<span class="ident" id="3783902">Word</span><span class="op" id="3783906">)</span>&nbsp;<span class="builtintype" id="3783908">bool</span>&nbsp;<span class="op" id="3783913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3783916">return</span>&nbsp;<span class="ident" id="3783923">x1</span>&nbsp;<span class="op" id="3783926">&gt;</span>&nbsp;<span class="ident" id="3783928">y1</span>&nbsp;<span class="op" id="3783931">||</span>&nbsp;<span class="ident" id="3783934">x1</span>&nbsp;<span class="op" id="3783937">==</span>&nbsp;<span class="ident" id="3783940">y1</span>&nbsp;<span class="op" id="3783943">&amp;&amp;</span>&nbsp;<span class="ident" id="3783946">x2</span>&nbsp;<span class="op" id="3783949">&gt;</span>&nbsp;<span class="ident" id="3783951">y2</span><br>
<span class="lineno"></span><span class="op" id="3783954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3783957">//&nbsp;modW&nbsp;returns&nbsp;x&nbsp;%&nbsp;d.</span><br>
<span class="lineno">1185</span><span class="keyword" id="3783980">func</span>&nbsp;<span class="op" id="3783985">(</span><span class="ident" id="3783986">x</span>&nbsp;<span class="ident" id="3783988">nat</span><span class="op" id="3783991">)</span>&nbsp;<span class="ident" id="3783993">modW</span><span class="op" id="3783997">(</span><span class="ident" id="3783998">d</span>&nbsp;<span class="ident" id="3784000">Word</span><span class="op" id="3784004">)</span>&nbsp;<span class="op" id="3784006">(</span><span class="ident" id="3784007">r</span>&nbsp;<span class="ident" id="3784009">Word</span><span class="op" id="3784013">)</span>&nbsp;<span class="op" id="3784015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3784018">//&nbsp;TODO(agl):&nbsp;we&nbsp;don&#39;t&nbsp;actually&nbsp;need&nbsp;to&nbsp;store&nbsp;the&nbsp;q&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784078">var</span>&nbsp;<span class="ident" id="3784082">q</span>&nbsp;<span class="ident" id="3784084">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784089">q</span>&nbsp;<span class="op" id="3784091">=</span>&nbsp;<span class="ident" id="3784093">q</span><span class="op" id="3784094">.</span><span class="builtinfunc" id="3784095">make</span><span class="op" id="3784099">(</span><span class="builtinfunc" id="3784100">len</span><span class="op" id="3784103">(</span><span class="ident" id="3784104">x</span><span class="op" id="3784105">)</span><span class="op" id="3784106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784109">return</span>&nbsp;<span class="ident" id="3784116">divWVW</span><span class="op" id="3784122">(</span><span class="ident" id="3784123">q</span><span class="op" id="3784124">,</span>&nbsp;<span class="num" id="3784126">0</span><span class="op" id="3784127">,</span>&nbsp;<span class="ident" id="3784129">x</span><span class="op" id="3784130">,</span>&nbsp;<span class="ident" id="3784132">d</span><span class="op" id="3784133">)</span><br>
<span class="lineno">1190</span><span class="op" id="3784135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3784138">//&nbsp;random&nbsp;creates&nbsp;a&nbsp;random&nbsp;integer&nbsp;in&nbsp;[0..limit),&nbsp;using&nbsp;the&nbsp;space&nbsp;in&nbsp;z&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3784212">//&nbsp;possible.&nbsp;n&nbsp;is&nbsp;the&nbsp;bit&nbsp;length&nbsp;of&nbsp;limit.</span><br>
<span class="lineno"></span><span class="keyword" id="3784255">func</span>&nbsp;<span class="op" id="3784260">(</span><span class="ident" id="3784261">z</span>&nbsp;<span class="ident" id="3784263">nat</span><span class="op" id="3784266">)</span>&nbsp;<span class="ident" id="3784268">random</span><span class="op" id="3784274">(</span><span class="ident" id="3784275">rand</span>&nbsp;<span class="op" id="3784280">*</span><span class="ident" id="3784281">rand</span><span class="op" id="3784285">.</span><span class="ident" id="3784286">Rand</span><span class="op" id="3784290">,</span>&nbsp;<span class="ident" id="3784292">limit</span>&nbsp;<span class="ident" id="3784298">nat</span><span class="op" id="3784301">,</span>&nbsp;<span class="ident" id="3784303">n</span>&nbsp;<span class="builtintype" id="3784305">int</span><span class="op" id="3784308">)</span>&nbsp;<span class="ident" id="3784310">nat</span>&nbsp;<span class="op" id="3784314">{</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784317">if</span>&nbsp;<span class="ident" id="3784320">alias</span><span class="op" id="3784325">(</span><span class="ident" id="3784326">z</span><span class="op" id="3784327">,</span>&nbsp;<span class="ident" id="3784329">limit</span><span class="op" id="3784334">)</span>&nbsp;<span class="op" id="3784336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784340">z</span>&nbsp;<span class="op" id="3784342">=</span>&nbsp;<span class="ident" id="3784344">nil</span>&nbsp;<span class="comment" id="3784348">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;limit&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3784391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784394">z</span>&nbsp;<span class="op" id="3784396">=</span>&nbsp;<span class="ident" id="3784398">z</span><span class="op" id="3784399">.</span><span class="builtinfunc" id="3784400">make</span><span class="op" id="3784404">(</span><span class="builtinfunc" id="3784405">len</span><span class="op" id="3784408">(</span><span class="ident" id="3784409">limit</span><span class="op" id="3784414">)</span><span class="op" id="3784415">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784419">bitLengthOfMSW</span>&nbsp;<span class="op" id="3784434">:=</span>&nbsp;<span class="builtintype" id="3784437">uint</span><span class="op" id="3784441">(</span><span class="ident" id="3784442">n</span>&nbsp;<span class="op" id="3784444">%</span>&nbsp;<span class="ident" id="3784446">_W</span><span class="op" id="3784448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784451">if</span>&nbsp;<span class="ident" id="3784454">bitLengthOfMSW</span>&nbsp;<span class="op" id="3784469">==</span>&nbsp;<span class="num" id="3784472">0</span>&nbsp;<span class="op" id="3784474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784478">bitLengthOfMSW</span>&nbsp;<span class="op" id="3784493">=</span>&nbsp;<span class="ident" id="3784495">_W</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3784499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784502">mask</span>&nbsp;<span class="op" id="3784507">:=</span>&nbsp;<span class="ident" id="3784510">Word</span><span class="op" id="3784514">(</span><span class="op" id="3784515">(</span><span class="num" id="3784516">1</span>&nbsp;<span class="op" id="3784518">&lt;&lt;</span>&nbsp;<span class="ident" id="3784521">bitLengthOfMSW</span><span class="op" id="3784535">)</span>&nbsp;<span class="op" id="3784537">-</span>&nbsp;<span class="num" id="3784539">1</span><span class="op" id="3784540">)</span><br>
<span class="lineno">1205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784544">for</span>&nbsp;<span class="op" id="3784548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784552">switch</span>&nbsp;<span class="ident" id="3784559">_W</span>&nbsp;<span class="op" id="3784562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784566">case</span>&nbsp;<span class="num" id="3784571">32</span><span class="op" id="3784573">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784578">for</span>&nbsp;<span class="ident" id="3784582">i</span>&nbsp;<span class="op" id="3784584">:=</span>&nbsp;<span class="keyword" id="3784587">range</span>&nbsp;<span class="ident" id="3784593">z</span>&nbsp;<span class="op" id="3784595">{</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784601">z</span><span class="op" id="3784602">[</span><span class="ident" id="3784603">i</span><span class="op" id="3784604">]</span>&nbsp;<span class="op" id="3784606">=</span>&nbsp;<span class="ident" id="3784608">Word</span><span class="op" id="3784612">(</span><span class="ident" id="3784613">rand</span><span class="op" id="3784617">.</span><span class="ident" id="3784618">Uint32</span><span class="op" id="3784624">(</span><span class="op" id="3784625">)</span><span class="op" id="3784626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3784631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784635">case</span>&nbsp;<span class="num" id="3784640">64</span><span class="op" id="3784642">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784647">for</span>&nbsp;<span class="ident" id="3784651">i</span>&nbsp;<span class="op" id="3784653">:=</span>&nbsp;<span class="keyword" id="3784656">range</span>&nbsp;<span class="ident" id="3784662">z</span>&nbsp;<span class="op" id="3784664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784670">z</span><span class="op" id="3784671">[</span><span class="ident" id="3784672">i</span><span class="op" id="3784673">]</span>&nbsp;<span class="op" id="3784675">=</span>&nbsp;<span class="ident" id="3784677">Word</span><span class="op" id="3784681">(</span><span class="ident" id="3784682">rand</span><span class="op" id="3784686">.</span><span class="ident" id="3784687">Uint32</span><span class="op" id="3784693">(</span><span class="op" id="3784694">)</span><span class="op" id="3784695">)</span>&nbsp;<span class="op" id="3784697">|</span>&nbsp;<span class="ident" id="3784699">Word</span><span class="op" id="3784703">(</span><span class="ident" id="3784704">rand</span><span class="op" id="3784708">.</span><span class="ident" id="3784709">Uint32</span><span class="op" id="3784715">(</span><span class="op" id="3784716">)</span><span class="op" id="3784717">)</span><span class="op" id="3784718">&lt;&lt;</span><span class="num" id="3784720">32</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3784726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784730">default</span><span class="op" id="3784737">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3784742">panic</span><span class="op" id="3784747">(</span><span class="string" id="3784748">&#34;unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="3784767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3784771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784775">z</span><span class="op" id="3784776">[</span><span class="builtinfunc" id="3784777">len</span><span class="op" id="3784780">(</span><span class="ident" id="3784781">limit</span><span class="op" id="3784786">)</span><span class="op" id="3784787">-</span><span class="num" id="3784788">1</span><span class="op" id="3784789">]</span>&nbsp;<span class="op" id="3784791">&amp;=</span>&nbsp;<span class="ident" id="3784794">mask</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784801">if</span>&nbsp;<span class="ident" id="3784804">z</span><span class="op" id="3784805">.</span><span class="ident" id="3784806">cmp</span><span class="op" id="3784809">(</span><span class="ident" id="3784810">limit</span><span class="op" id="3784815">)</span>&nbsp;<span class="op" id="3784817">&lt;</span>&nbsp;<span class="num" id="3784819">0</span>&nbsp;<span class="op" id="3784821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784826">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3784834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3784837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784841">return</span>&nbsp;<span class="ident" id="3784848">z</span><span class="op" id="3784849">.</span><span class="ident" id="3784850">norm</span><span class="op" id="3784854">(</span><span class="op" id="3784855">)</span><br>
<span class="lineno"></span><span class="op" id="3784857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3784860">//&nbsp;If&nbsp;m&nbsp;!=&nbsp;0&nbsp;(i.e.,&nbsp;len(m)&nbsp;!=&nbsp;0),&nbsp;expNN&nbsp;sets&nbsp;z&nbsp;to&nbsp;x**y&nbsp;mod&nbsp;m;</span><br>
<span class="lineno"></span><span class="comment" id="3784922">//&nbsp;otherwise&nbsp;it&nbsp;sets&nbsp;z&nbsp;to&nbsp;x**y.&nbsp;The&nbsp;result&nbsp;is&nbsp;the&nbsp;value&nbsp;of&nbsp;z.</span><br>
<span class="lineno">1230</span><span class="keyword" id="3784984">func</span>&nbsp;<span class="op" id="3784989">(</span><span class="ident" id="3784990">z</span>&nbsp;<span class="ident" id="3784992">nat</span><span class="op" id="3784995">)</span>&nbsp;<span class="ident" id="3784997">expNN</span><span class="op" id="3785002">(</span><span class="ident" id="3785003">x</span><span class="op" id="3785004">,</span>&nbsp;<span class="ident" id="3785006">y</span><span class="op" id="3785007">,</span>&nbsp;<span class="ident" id="3785009">m</span>&nbsp;<span class="ident" id="3785011">nat</span><span class="op" id="3785014">)</span>&nbsp;<span class="ident" id="3785016">nat</span>&nbsp;<span class="op" id="3785020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785023">if</span>&nbsp;<span class="ident" id="3785026">alias</span><span class="op" id="3785031">(</span><span class="ident" id="3785032">z</span><span class="op" id="3785033">,</span>&nbsp;<span class="ident" id="3785035">x</span><span class="op" id="3785036">)</span>&nbsp;<span class="op" id="3785038">||</span>&nbsp;<span class="ident" id="3785041">alias</span><span class="op" id="3785046">(</span><span class="ident" id="3785047">z</span><span class="op" id="3785048">,</span>&nbsp;<span class="ident" id="3785050">y</span><span class="op" id="3785051">)</span>&nbsp;<span class="op" id="3785053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3785057">//&nbsp;We&nbsp;cannot&nbsp;allow&nbsp;in-place&nbsp;modification&nbsp;of&nbsp;x&nbsp;or&nbsp;y.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785111">z</span>&nbsp;<span class="op" id="3785113">=</span>&nbsp;<span class="ident" id="3785115">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3785120">}</span><br>
<span class="lineno">1235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3785124">//&nbsp;x**y&nbsp;mod&nbsp;1&nbsp;==&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785144">if</span>&nbsp;<span class="builtinfunc" id="3785147">len</span><span class="op" id="3785150">(</span><span class="ident" id="3785151">m</span><span class="op" id="3785152">)</span>&nbsp;<span class="op" id="3785154">==</span>&nbsp;<span class="num" id="3785157">1</span>&nbsp;<span class="op" id="3785159">&amp;&amp;</span>&nbsp;<span class="ident" id="3785162">m</span><span class="op" id="3785163">[</span><span class="num" id="3785164">0</span><span class="op" id="3785165">]</span>&nbsp;<span class="op" id="3785167">==</span>&nbsp;<span class="num" id="3785170">1</span>&nbsp;<span class="op" id="3785172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785176">return</span>&nbsp;<span class="ident" id="3785183">z</span><span class="op" id="3785184">.</span><span class="ident" id="3785185">setWord</span><span class="op" id="3785192">(</span><span class="num" id="3785193">0</span><span class="op" id="3785194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3785197">}</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3785200">//&nbsp;m&nbsp;==&nbsp;0&nbsp;||&nbsp;m&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3785221">//&nbsp;x**0&nbsp;==&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785235">if</span>&nbsp;<span class="builtinfunc" id="3785238">len</span><span class="op" id="3785241">(</span><span class="ident" id="3785242">y</span><span class="op" id="3785243">)</span>&nbsp;<span class="op" id="3785245">==</span>&nbsp;<span class="num" id="3785248">0</span>&nbsp;<span class="op" id="3785250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785254">return</span>&nbsp;<span class="ident" id="3785261">z</span><span class="op" id="3785262">.</span><span class="ident" id="3785263">setWord</span><span class="op" id="3785270">(</span><span class="num" id="3785271">1</span><span class="op" id="3785272">)</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3785275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3785278">//&nbsp;y&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785289">if</span>&nbsp;<span class="builtinfunc" id="3785292">len</span><span class="op" id="3785295">(</span><span class="ident" id="3785296">m</span><span class="op" id="3785297">)</span>&nbsp;<span class="op" id="3785299">!=</span>&nbsp;<span class="num" id="3785302">0</span>&nbsp;<span class="op" id="3785304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3785308">//&nbsp;We&nbsp;likely&nbsp;end&nbsp;up&nbsp;being&nbsp;as&nbsp;long&nbsp;as&nbsp;the&nbsp;modulus.</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785360">z</span>&nbsp;<span class="op" id="3785362">=</span>&nbsp;<span class="ident" id="3785364">z</span><span class="op" id="3785365">.</span><span class="builtinfunc" id="3785366">make</span><span class="op" id="3785370">(</span><span class="builtinfunc" id="3785371">len</span><span class="op" id="3785374">(</span><span class="ident" id="3785375">m</span><span class="op" id="3785376">)</span><span class="op" id="3785377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3785380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785383">z</span>&nbsp;<span class="op" id="3785385">=</span>&nbsp;<span class="ident" id="3785387">z</span><span class="op" id="3785388">.</span><span class="ident" id="3785389">set</span><span class="op" id="3785392">(</span><span class="ident" id="3785393">x</span><span class="op" id="3785394">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3785398">//&nbsp;If&nbsp;the&nbsp;base&nbsp;is&nbsp;non-trivial&nbsp;and&nbsp;the&nbsp;exponent&nbsp;is&nbsp;large,&nbsp;we&nbsp;use</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3785463">//&nbsp;4-bit,&nbsp;windowed&nbsp;exponentiation.&nbsp;This&nbsp;involves&nbsp;precomputing&nbsp;14&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3785536">//&nbsp;(x^2...x^15)&nbsp;but&nbsp;then&nbsp;reduces&nbsp;the&nbsp;number&nbsp;of&nbsp;multiply-reduces&nbsp;by&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3785606">//&nbsp;third.&nbsp;Even&nbsp;for&nbsp;a&nbsp;32-bit&nbsp;exponent,&nbsp;this&nbsp;reduces&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3785672">//&nbsp;operations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785688">if</span>&nbsp;<span class="builtinfunc" id="3785691">len</span><span class="op" id="3785694">(</span><span class="ident" id="3785695">x</span><span class="op" id="3785696">)</span>&nbsp;<span class="op" id="3785698">&gt;</span>&nbsp;<span class="num" id="3785700">1</span>&nbsp;<span class="op" id="3785702">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3785705">len</span><span class="op" id="3785708">(</span><span class="ident" id="3785709">y</span><span class="op" id="3785710">)</span>&nbsp;<span class="op" id="3785712">&gt;</span>&nbsp;<span class="num" id="3785714">1</span>&nbsp;<span class="op" id="3785716">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3785719">len</span><span class="op" id="3785722">(</span><span class="ident" id="3785723">m</span><span class="op" id="3785724">)</span>&nbsp;<span class="op" id="3785726">&gt;</span>&nbsp;<span class="num" id="3785728">0</span>&nbsp;<span class="op" id="3785730">{</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785734">return</span>&nbsp;<span class="ident" id="3785741">z</span><span class="op" id="3785742">.</span><span class="ident" id="3785743">expNNWindowed</span><span class="op" id="3785756">(</span><span class="ident" id="3785757">x</span><span class="op" id="3785758">,</span>&nbsp;<span class="ident" id="3785760">y</span><span class="op" id="3785761">,</span>&nbsp;<span class="ident" id="3785763">m</span><span class="op" id="3785764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3785767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785771">v</span>&nbsp;<span class="op" id="3785773">:=</span>&nbsp;<span class="ident" id="3785776">y</span><span class="op" id="3785777">[</span><span class="builtinfunc" id="3785778">len</span><span class="op" id="3785781">(</span><span class="ident" id="3785782">y</span><span class="op" id="3785783">)</span><span class="op" id="3785784">-</span><span class="num" id="3785785">1</span><span class="op" id="3785786">]</span>&nbsp;<span class="comment" id="3785788">//&nbsp;v&nbsp;&gt;&nbsp;0&nbsp;because&nbsp;y&nbsp;is&nbsp;normalized&nbsp;and&nbsp;y&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785832">shift</span>&nbsp;<span class="op" id="3785838">:=</span>&nbsp;<span class="ident" id="3785841">leadingZeros</span><span class="op" id="3785853">(</span><span class="ident" id="3785854">v</span><span class="op" id="3785855">)</span>&nbsp;<span class="op" id="3785857">+</span>&nbsp;<span class="num" id="3785859">1</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785862">v</span>&nbsp;<span class="op" id="3785864">&lt;&lt;=</span>&nbsp;<span class="ident" id="3785868">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785875">var</span>&nbsp;<span class="ident" id="3785879">q</span>&nbsp;<span class="ident" id="3785881">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785887">const</span>&nbsp;<span class="ident" id="3785893">mask</span>&nbsp;<span class="op" id="3785898">=</span>&nbsp;<span class="num" id="3785900">1</span>&nbsp;<span class="op" id="3785902">&lt;&lt;</span>&nbsp;<span class="op" id="3785905">(</span><span class="ident" id="3785906">_W</span>&nbsp;<span class="op" id="3785909">-</span>&nbsp;<span class="num" id="3785911">1</span><span class="op" id="3785912">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3785916">//&nbsp;We&nbsp;walk&nbsp;through&nbsp;the&nbsp;bits&nbsp;of&nbsp;the&nbsp;exponent&nbsp;one&nbsp;by&nbsp;one.&nbsp;Each&nbsp;time&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3785986">//&nbsp;see&nbsp;a&nbsp;bit,&nbsp;we&nbsp;square,&nbsp;thus&nbsp;doubling&nbsp;the&nbsp;power.&nbsp;If&nbsp;the&nbsp;bit&nbsp;is&nbsp;a&nbsp;one,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3786058">//&nbsp;we&nbsp;also&nbsp;multiply&nbsp;by&nbsp;x,&nbsp;thus&nbsp;adding&nbsp;one&nbsp;to&nbsp;the&nbsp;power.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786116">w</span>&nbsp;<span class="op" id="3786118">:=</span>&nbsp;<span class="ident" id="3786121">_W</span>&nbsp;<span class="op" id="3786124">-</span>&nbsp;<span class="builtintype" id="3786126">int</span><span class="op" id="3786129">(</span><span class="ident" id="3786130">shift</span><span class="op" id="3786135">)</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3786138">//&nbsp;zz&nbsp;and&nbsp;r&nbsp;are&nbsp;used&nbsp;to&nbsp;avoid&nbsp;allocating&nbsp;in&nbsp;mul&nbsp;and&nbsp;div&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3786198">//&nbsp;otherwise&nbsp;the&nbsp;arguments&nbsp;would&nbsp;alias.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786239">var</span>&nbsp;<span class="ident" id="3786243">zz</span><span class="op" id="3786245">,</span>&nbsp;<span class="ident" id="3786247">r</span>&nbsp;<span class="ident" id="3786249">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786254">for</span>&nbsp;<span class="ident" id="3786258">j</span>&nbsp;<span class="op" id="3786260">:=</span>&nbsp;<span class="num" id="3786263">0</span><span class="op" id="3786264">;</span>&nbsp;<span class="ident" id="3786266">j</span>&nbsp;<span class="op" id="3786268">&lt;</span>&nbsp;<span class="ident" id="3786270">w</span><span class="op" id="3786271">;</span>&nbsp;<span class="ident" id="3786273">j</span><span class="op" id="3786274">++</span>&nbsp;<span class="op" id="3786277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786281">zz</span>&nbsp;<span class="op" id="3786284">=</span>&nbsp;<span class="ident" id="3786286">zz</span><span class="op" id="3786288">.</span><span class="ident" id="3786289">mul</span><span class="op" id="3786292">(</span><span class="ident" id="3786293">z</span><span class="op" id="3786294">,</span>&nbsp;<span class="ident" id="3786296">z</span><span class="op" id="3786297">)</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786301">zz</span><span class="op" id="3786303">,</span>&nbsp;<span class="ident" id="3786305">z</span>&nbsp;<span class="op" id="3786307">=</span>&nbsp;<span class="ident" id="3786309">z</span><span class="op" id="3786310">,</span>&nbsp;<span class="ident" id="3786312">zz</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786318">if</span>&nbsp;<span class="ident" id="3786321">v</span><span class="op" id="3786322">&amp;</span><span class="ident" id="3786323">mask</span>&nbsp;<span class="op" id="3786328">!=</span>&nbsp;<span class="num" id="3786331">0</span>&nbsp;<span class="op" id="3786333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786338">zz</span>&nbsp;<span class="op" id="3786341">=</span>&nbsp;<span class="ident" id="3786343">zz</span><span class="op" id="3786345">.</span><span class="ident" id="3786346">mul</span><span class="op" id="3786349">(</span><span class="ident" id="3786350">z</span><span class="op" id="3786351">,</span>&nbsp;<span class="ident" id="3786353">x</span><span class="op" id="3786354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786359">zz</span><span class="op" id="3786361">,</span>&nbsp;<span class="ident" id="3786363">z</span>&nbsp;<span class="op" id="3786365">=</span>&nbsp;<span class="ident" id="3786367">z</span><span class="op" id="3786368">,</span>&nbsp;<span class="ident" id="3786370">zz</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3786375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786380">if</span>&nbsp;<span class="builtinfunc" id="3786383">len</span><span class="op" id="3786386">(</span><span class="ident" id="3786387">m</span><span class="op" id="3786388">)</span>&nbsp;<span class="op" id="3786390">!=</span>&nbsp;<span class="num" id="3786393">0</span>&nbsp;<span class="op" id="3786395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786400">zz</span><span class="op" id="3786402">,</span>&nbsp;<span class="ident" id="3786404">r</span>&nbsp;<span class="op" id="3786406">=</span>&nbsp;<span class="ident" id="3786408">zz</span><span class="op" id="3786410">.</span><span class="ident" id="3786411">div</span><span class="op" id="3786414">(</span><span class="ident" id="3786415">r</span><span class="op" id="3786416">,</span>&nbsp;<span class="ident" id="3786418">z</span><span class="op" id="3786419">,</span>&nbsp;<span class="ident" id="3786421">m</span><span class="op" id="3786422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786427">zz</span><span class="op" id="3786429">,</span>&nbsp;<span class="ident" id="3786431">r</span><span class="op" id="3786432">,</span>&nbsp;<span class="ident" id="3786434">q</span><span class="op" id="3786435">,</span>&nbsp;<span class="ident" id="3786437">z</span>&nbsp;<span class="op" id="3786439">=</span>&nbsp;<span class="ident" id="3786441">q</span><span class="op" id="3786442">,</span>&nbsp;<span class="ident" id="3786444">z</span><span class="op" id="3786445">,</span>&nbsp;<span class="ident" id="3786447">zz</span><span class="op" id="3786449">,</span>&nbsp;<span class="ident" id="3786451">r</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3786455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786460">v</span>&nbsp;<span class="op" id="3786462">&lt;&lt;=</span>&nbsp;<span class="num" id="3786466">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3786469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786473">for</span>&nbsp;<span class="ident" id="3786477">i</span>&nbsp;<span class="op" id="3786479">:=</span>&nbsp;<span class="builtinfunc" id="3786482">len</span><span class="op" id="3786485">(</span><span class="ident" id="3786486">y</span><span class="op" id="3786487">)</span>&nbsp;<span class="op" id="3786489">-</span>&nbsp;<span class="num" id="3786491">2</span><span class="op" id="3786492">;</span>&nbsp;<span class="ident" id="3786494">i</span>&nbsp;<span class="op" id="3786496">&gt;=</span>&nbsp;<span class="num" id="3786499">0</span><span class="op" id="3786500">;</span>&nbsp;<span class="ident" id="3786502">i</span><span class="op" id="3786503">--</span>&nbsp;<span class="op" id="3786506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786510">v</span>&nbsp;<span class="op" id="3786512">=</span>&nbsp;<span class="ident" id="3786514">y</span><span class="op" id="3786515">[</span><span class="ident" id="3786516">i</span><span class="op" id="3786517">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786522">for</span>&nbsp;<span class="ident" id="3786526">j</span>&nbsp;<span class="op" id="3786528">:=</span>&nbsp;<span class="num" id="3786531">0</span><span class="op" id="3786532">;</span>&nbsp;<span class="ident" id="3786534">j</span>&nbsp;<span class="op" id="3786536">&lt;</span>&nbsp;<span class="ident" id="3786538">_W</span><span class="op" id="3786540">;</span>&nbsp;<span class="ident" id="3786542">j</span><span class="op" id="3786543">++</span>&nbsp;<span class="op" id="3786546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786551">zz</span>&nbsp;<span class="op" id="3786554">=</span>&nbsp;<span class="ident" id="3786556">zz</span><span class="op" id="3786558">.</span><span class="ident" id="3786559">mul</span><span class="op" id="3786562">(</span><span class="ident" id="3786563">z</span><span class="op" id="3786564">,</span>&nbsp;<span class="ident" id="3786566">z</span><span class="op" id="3786567">)</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786572">zz</span><span class="op" id="3786574">,</span>&nbsp;<span class="ident" id="3786576">z</span>&nbsp;<span class="op" id="3786578">=</span>&nbsp;<span class="ident" id="3786580">z</span><span class="op" id="3786581">,</span>&nbsp;<span class="ident" id="3786583">zz</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786590">if</span>&nbsp;<span class="ident" id="3786593">v</span><span class="op" id="3786594">&amp;</span><span class="ident" id="3786595">mask</span>&nbsp;<span class="op" id="3786600">!=</span>&nbsp;<span class="num" id="3786603">0</span>&nbsp;<span class="op" id="3786605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786611">zz</span>&nbsp;<span class="op" id="3786614">=</span>&nbsp;<span class="ident" id="3786616">zz</span><span class="op" id="3786618">.</span><span class="ident" id="3786619">mul</span><span class="op" id="3786622">(</span><span class="ident" id="3786623">z</span><span class="op" id="3786624">,</span>&nbsp;<span class="ident" id="3786626">x</span><span class="op" id="3786627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786633">zz</span><span class="op" id="3786635">,</span>&nbsp;<span class="ident" id="3786637">z</span>&nbsp;<span class="op" id="3786639">=</span>&nbsp;<span class="ident" id="3786641">z</span><span class="op" id="3786642">,</span>&nbsp;<span class="ident" id="3786644">zz</span><br>
<span class="lineno">1305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3786650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786656">if</span>&nbsp;<span class="builtinfunc" id="3786659">len</span><span class="op" id="3786662">(</span><span class="ident" id="3786663">m</span><span class="op" id="3786664">)</span>&nbsp;<span class="op" id="3786666">!=</span>&nbsp;<span class="num" id="3786669">0</span>&nbsp;<span class="op" id="3786671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786677">zz</span><span class="op" id="3786679">,</span>&nbsp;<span class="ident" id="3786681">r</span>&nbsp;<span class="op" id="3786683">=</span>&nbsp;<span class="ident" id="3786685">zz</span><span class="op" id="3786687">.</span><span class="ident" id="3786688">div</span><span class="op" id="3786691">(</span><span class="ident" id="3786692">r</span><span class="op" id="3786693">,</span>&nbsp;<span class="ident" id="3786695">z</span><span class="op" id="3786696">,</span>&nbsp;<span class="ident" id="3786698">m</span><span class="op" id="3786699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786705">zz</span><span class="op" id="3786707">,</span>&nbsp;<span class="ident" id="3786709">r</span><span class="op" id="3786710">,</span>&nbsp;<span class="ident" id="3786712">q</span><span class="op" id="3786713">,</span>&nbsp;<span class="ident" id="3786715">z</span>&nbsp;<span class="op" id="3786717">=</span>&nbsp;<span class="ident" id="3786719">q</span><span class="op" id="3786720">,</span>&nbsp;<span class="ident" id="3786722">z</span><span class="op" id="3786723">,</span>&nbsp;<span class="ident" id="3786725">zz</span><span class="op" id="3786727">,</span>&nbsp;<span class="ident" id="3786729">r</span><br>
<span class="lineno">1310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3786734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786740">v</span>&nbsp;<span class="op" id="3786742">&lt;&lt;=</span>&nbsp;<span class="num" id="3786746">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3786750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3786753">}</span><br>
<span class="lineno">1315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786757">return</span>&nbsp;<span class="ident" id="3786764">z</span><span class="op" id="3786765">.</span><span class="ident" id="3786766">norm</span><span class="op" id="3786770">(</span><span class="op" id="3786771">)</span><br>
<span class="lineno"></span><span class="op" id="3786773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3786776">//&nbsp;expNNWindowed&nbsp;calculates&nbsp;x**y&nbsp;mod&nbsp;m&nbsp;using&nbsp;a&nbsp;fixed,&nbsp;4-bit&nbsp;window.</span><br>
<span class="lineno">1320</span><span class="keyword" id="3786844">func</span>&nbsp;<span class="op" id="3786849">(</span><span class="ident" id="3786850">z</span>&nbsp;<span class="ident" id="3786852">nat</span><span class="op" id="3786855">)</span>&nbsp;<span class="ident" id="3786857">expNNWindowed</span><span class="op" id="3786870">(</span><span class="ident" id="3786871">x</span><span class="op" id="3786872">,</span>&nbsp;<span class="ident" id="3786874">y</span><span class="op" id="3786875">,</span>&nbsp;<span class="ident" id="3786877">m</span>&nbsp;<span class="ident" id="3786879">nat</span><span class="op" id="3786882">)</span>&nbsp;<span class="ident" id="3786884">nat</span>&nbsp;<span class="op" id="3786888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3786891">//&nbsp;zz&nbsp;and&nbsp;r&nbsp;are&nbsp;used&nbsp;to&nbsp;avoid&nbsp;allocating&nbsp;in&nbsp;mul&nbsp;and&nbsp;div&nbsp;as&nbsp;otherwise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3786961">//&nbsp;the&nbsp;arguments&nbsp;would&nbsp;alias.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786992">var</span>&nbsp;<span class="ident" id="3786996">zz</span><span class="op" id="3786998">,</span>&nbsp;<span class="ident" id="3787000">r</span>&nbsp;<span class="ident" id="3787002">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno">1325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787008">const</span>&nbsp;<span class="ident" id="3787014">n</span>&nbsp;<span class="op" id="3787016">=</span>&nbsp;<span class="num" id="3787018">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3787021">//&nbsp;powers[i]&nbsp;contains&nbsp;x^i.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787049">var</span>&nbsp;<span class="ident" id="3787053">powers</span>&nbsp;<span class="op" id="3787060">[</span><span class="num" id="3787061">1</span>&nbsp;<span class="op" id="3787063">&lt;&lt;</span>&nbsp;<span class="ident" id="3787066">n</span><span class="op" id="3787067">]</span><span class="ident" id="3787068">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787073">powers</span><span class="op" id="3787079">[</span><span class="num" id="3787080">0</span><span class="op" id="3787081">]</span>&nbsp;<span class="op" id="3787083">=</span>&nbsp;<span class="ident" id="3787085">natOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787093">powers</span><span class="op" id="3787099">[</span><span class="num" id="3787100">1</span><span class="op" id="3787101">]</span>&nbsp;<span class="op" id="3787103">=</span>&nbsp;<span class="ident" id="3787105">x</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787108">for</span>&nbsp;<span class="ident" id="3787112">i</span>&nbsp;<span class="op" id="3787114">:=</span>&nbsp;<span class="num" id="3787117">2</span><span class="op" id="3787118">;</span>&nbsp;<span class="ident" id="3787120">i</span>&nbsp;<span class="op" id="3787122">&lt;</span>&nbsp;<span class="num" id="3787124">1</span><span class="op" id="3787125">&lt;&lt;</span><span class="ident" id="3787127">n</span><span class="op" id="3787128">;</span>&nbsp;<span class="ident" id="3787130">i</span>&nbsp;<span class="op" id="3787132">+=</span>&nbsp;<span class="num" id="3787135">2</span>&nbsp;<span class="op" id="3787137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787141">p2</span><span class="op" id="3787143">,</span>&nbsp;<span class="ident" id="3787145">p</span><span class="op" id="3787146">,</span>&nbsp;<span class="ident" id="3787148">p1</span>&nbsp;<span class="op" id="3787151">:=</span>&nbsp;<span class="op" id="3787154">&amp;</span><span class="ident" id="3787155">powers</span><span class="op" id="3787161">[</span><span class="ident" id="3787162">i</span><span class="op" id="3787163">/</span><span class="num" id="3787164">2</span><span class="op" id="3787165">]</span><span class="op" id="3787166">,</span>&nbsp;<span class="op" id="3787168">&amp;</span><span class="ident" id="3787169">powers</span><span class="op" id="3787175">[</span><span class="ident" id="3787176">i</span><span class="op" id="3787177">]</span><span class="op" id="3787178">,</span>&nbsp;<span class="op" id="3787180">&amp;</span><span class="ident" id="3787181">powers</span><span class="op" id="3787187">[</span><span class="ident" id="3787188">i</span><span class="op" id="3787189">+</span><span class="num" id="3787190">1</span><span class="op" id="3787191">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3787195">*</span><span class="ident" id="3787196">p</span>&nbsp;<span class="op" id="3787198">=</span>&nbsp;<span class="ident" id="3787200">p</span><span class="op" id="3787201">.</span><span class="ident" id="3787202">mul</span><span class="op" id="3787205">(</span><span class="op" id="3787206">*</span><span class="ident" id="3787207">p2</span><span class="op" id="3787209">,</span>&nbsp;<span class="op" id="3787211">*</span><span class="ident" id="3787212">p2</span><span class="op" id="3787214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787218">zz</span><span class="op" id="3787220">,</span>&nbsp;<span class="ident" id="3787222">r</span>&nbsp;<span class="op" id="3787224">=</span>&nbsp;<span class="ident" id="3787226">zz</span><span class="op" id="3787228">.</span><span class="ident" id="3787229">div</span><span class="op" id="3787232">(</span><span class="ident" id="3787233">r</span><span class="op" id="3787234">,</span>&nbsp;<span class="op" id="3787236">*</span><span class="ident" id="3787237">p</span><span class="op" id="3787238">,</span>&nbsp;<span class="ident" id="3787240">m</span><span class="op" id="3787241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3787245">*</span><span class="ident" id="3787246">p</span><span class="op" id="3787247">,</span>&nbsp;<span class="ident" id="3787249">r</span>&nbsp;<span class="op" id="3787251">=</span>&nbsp;<span class="ident" id="3787253">r</span><span class="op" id="3787254">,</span>&nbsp;<span class="op" id="3787256">*</span><span class="ident" id="3787257">p</span><br>
<span class="lineno">1335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3787261">*</span><span class="ident" id="3787262">p1</span>&nbsp;<span class="op" id="3787265">=</span>&nbsp;<span class="ident" id="3787267">p1</span><span class="op" id="3787269">.</span><span class="ident" id="3787270">mul</span><span class="op" id="3787273">(</span><span class="op" id="3787274">*</span><span class="ident" id="3787275">p</span><span class="op" id="3787276">,</span>&nbsp;<span class="ident" id="3787278">x</span><span class="op" id="3787279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787283">zz</span><span class="op" id="3787285">,</span>&nbsp;<span class="ident" id="3787287">r</span>&nbsp;<span class="op" id="3787289">=</span>&nbsp;<span class="ident" id="3787291">zz</span><span class="op" id="3787293">.</span><span class="ident" id="3787294">div</span><span class="op" id="3787297">(</span><span class="ident" id="3787298">r</span><span class="op" id="3787299">,</span>&nbsp;<span class="op" id="3787301">*</span><span class="ident" id="3787302">p1</span><span class="op" id="3787304">,</span>&nbsp;<span class="ident" id="3787306">m</span><span class="op" id="3787307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3787311">*</span><span class="ident" id="3787312">p1</span><span class="op" id="3787314">,</span>&nbsp;<span class="ident" id="3787316">r</span>&nbsp;<span class="op" id="3787318">=</span>&nbsp;<span class="ident" id="3787320">r</span><span class="op" id="3787321">,</span>&nbsp;<span class="op" id="3787323">*</span><span class="ident" id="3787324">p1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3787328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787332">z</span>&nbsp;<span class="op" id="3787334">=</span>&nbsp;<span class="ident" id="3787336">z</span><span class="op" id="3787337">.</span><span class="ident" id="3787338">setWord</span><span class="op" id="3787345">(</span><span class="num" id="3787346">1</span><span class="op" id="3787347">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787351">for</span>&nbsp;<span class="ident" id="3787355">i</span>&nbsp;<span class="op" id="3787357">:=</span>&nbsp;<span class="builtinfunc" id="3787360">len</span><span class="op" id="3787363">(</span><span class="ident" id="3787364">y</span><span class="op" id="3787365">)</span>&nbsp;<span class="op" id="3787367">-</span>&nbsp;<span class="num" id="3787369">1</span><span class="op" id="3787370">;</span>&nbsp;<span class="ident" id="3787372">i</span>&nbsp;<span class="op" id="3787374">&gt;=</span>&nbsp;<span class="num" id="3787377">0</span><span class="op" id="3787378">;</span>&nbsp;<span class="ident" id="3787380">i</span><span class="op" id="3787381">--</span>&nbsp;<span class="op" id="3787384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787388">yi</span>&nbsp;<span class="op" id="3787391">:=</span>&nbsp;<span class="ident" id="3787394">y</span><span class="op" id="3787395">[</span><span class="ident" id="3787396">i</span><span class="op" id="3787397">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787401">for</span>&nbsp;<span class="ident" id="3787405">j</span>&nbsp;<span class="op" id="3787407">:=</span>&nbsp;<span class="num" id="3787410">0</span><span class="op" id="3787411">;</span>&nbsp;<span class="ident" id="3787413">j</span>&nbsp;<span class="op" id="3787415">&lt;</span>&nbsp;<span class="ident" id="3787417">_W</span><span class="op" id="3787419">;</span>&nbsp;<span class="ident" id="3787421">j</span>&nbsp;<span class="op" id="3787423">+=</span>&nbsp;<span class="ident" id="3787426">n</span>&nbsp;<span class="op" id="3787428">{</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787433">if</span>&nbsp;<span class="ident" id="3787436">i</span>&nbsp;<span class="op" id="3787438">!=</span>&nbsp;<span class="builtinfunc" id="3787441">len</span><span class="op" id="3787444">(</span><span class="ident" id="3787445">y</span><span class="op" id="3787446">)</span><span class="op" id="3787447">-</span><span class="num" id="3787448">1</span>&nbsp;<span class="op" id="3787450">||</span>&nbsp;<span class="ident" id="3787453">j</span>&nbsp;<span class="op" id="3787455">!=</span>&nbsp;<span class="num" id="3787458">0</span>&nbsp;<span class="op" id="3787460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3787466">//&nbsp;Unrolled&nbsp;loop&nbsp;for&nbsp;significant&nbsp;performance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3787515">//&nbsp;gain.&nbsp;&nbsp;Use&nbsp;go&nbsp;test&nbsp;-bench=&#34;.*&#34;&nbsp;in&nbsp;crypto/rsa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3787567">//&nbsp;to&nbsp;check&nbsp;performance&nbsp;before&nbsp;making&nbsp;changes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787618">zz</span>&nbsp;<span class="op" id="3787621">=</span>&nbsp;<span class="ident" id="3787623">zz</span><span class="op" id="3787625">.</span><span class="ident" id="3787626">mul</span><span class="op" id="3787629">(</span><span class="ident" id="3787630">z</span><span class="op" id="3787631">,</span>&nbsp;<span class="ident" id="3787633">z</span><span class="op" id="3787634">)</span><br>
<span class="lineno">1350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787640">zz</span><span class="op" id="3787642">,</span>&nbsp;<span class="ident" id="3787644">z</span>&nbsp;<span class="op" id="3787646">=</span>&nbsp;<span class="ident" id="3787648">z</span><span class="op" id="3787649">,</span>&nbsp;<span class="ident" id="3787651">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787658">zz</span><span class="op" id="3787660">,</span>&nbsp;<span class="ident" id="3787662">r</span>&nbsp;<span class="op" id="3787664">=</span>&nbsp;<span class="ident" id="3787666">zz</span><span class="op" id="3787668">.</span><span class="ident" id="3787669">div</span><span class="op" id="3787672">(</span><span class="ident" id="3787673">r</span><span class="op" id="3787674">,</span>&nbsp;<span class="ident" id="3787676">z</span><span class="op" id="3787677">,</span>&nbsp;<span class="ident" id="3787679">m</span><span class="op" id="3787680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787686">z</span><span class="op" id="3787687">,</span>&nbsp;<span class="ident" id="3787689">r</span>&nbsp;<span class="op" id="3787691">=</span>&nbsp;<span class="ident" id="3787693">r</span><span class="op" id="3787694">,</span>&nbsp;<span class="ident" id="3787696">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787703">zz</span>&nbsp;<span class="op" id="3787706">=</span>&nbsp;<span class="ident" id="3787708">zz</span><span class="op" id="3787710">.</span><span class="ident" id="3787711">mul</span><span class="op" id="3787714">(</span><span class="ident" id="3787715">z</span><span class="op" id="3787716">,</span>&nbsp;<span class="ident" id="3787718">z</span><span class="op" id="3787719">)</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787725">zz</span><span class="op" id="3787727">,</span>&nbsp;<span class="ident" id="3787729">z</span>&nbsp;<span class="op" id="3787731">=</span>&nbsp;<span class="ident" id="3787733">z</span><span class="op" id="3787734">,</span>&nbsp;<span class="ident" id="3787736">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787743">zz</span><span class="op" id="3787745">,</span>&nbsp;<span class="ident" id="3787747">r</span>&nbsp;<span class="op" id="3787749">=</span>&nbsp;<span class="ident" id="3787751">zz</span><span class="op" id="3787753">.</span><span class="ident" id="3787754">div</span><span class="op" id="3787757">(</span><span class="ident" id="3787758">r</span><span class="op" id="3787759">,</span>&nbsp;<span class="ident" id="3787761">z</span><span class="op" id="3787762">,</span>&nbsp;<span class="ident" id="3787764">m</span><span class="op" id="3787765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787771">z</span><span class="op" id="3787772">,</span>&nbsp;<span class="ident" id="3787774">r</span>&nbsp;<span class="op" id="3787776">=</span>&nbsp;<span class="ident" id="3787778">r</span><span class="op" id="3787779">,</span>&nbsp;<span class="ident" id="3787781">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787788">zz</span>&nbsp;<span class="op" id="3787791">=</span>&nbsp;<span class="ident" id="3787793">zz</span><span class="op" id="3787795">.</span><span class="ident" id="3787796">mul</span><span class="op" id="3787799">(</span><span class="ident" id="3787800">z</span><span class="op" id="3787801">,</span>&nbsp;<span class="ident" id="3787803">z</span><span class="op" id="3787804">)</span><br>
<span class="lineno">1360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787810">zz</span><span class="op" id="3787812">,</span>&nbsp;<span class="ident" id="3787814">z</span>&nbsp;<span class="op" id="3787816">=</span>&nbsp;<span class="ident" id="3787818">z</span><span class="op" id="3787819">,</span>&nbsp;<span class="ident" id="3787821">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787828">zz</span><span class="op" id="3787830">,</span>&nbsp;<span class="ident" id="3787832">r</span>&nbsp;<span class="op" id="3787834">=</span>&nbsp;<span class="ident" id="3787836">zz</span><span class="op" id="3787838">.</span><span class="ident" id="3787839">div</span><span class="op" id="3787842">(</span><span class="ident" id="3787843">r</span><span class="op" id="3787844">,</span>&nbsp;<span class="ident" id="3787846">z</span><span class="op" id="3787847">,</span>&nbsp;<span class="ident" id="3787849">m</span><span class="op" id="3787850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787856">z</span><span class="op" id="3787857">,</span>&nbsp;<span class="ident" id="3787859">r</span>&nbsp;<span class="op" id="3787861">=</span>&nbsp;<span class="ident" id="3787863">r</span><span class="op" id="3787864">,</span>&nbsp;<span class="ident" id="3787866">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787873">zz</span>&nbsp;<span class="op" id="3787876">=</span>&nbsp;<span class="ident" id="3787878">zz</span><span class="op" id="3787880">.</span><span class="ident" id="3787881">mul</span><span class="op" id="3787884">(</span><span class="ident" id="3787885">z</span><span class="op" id="3787886">,</span>&nbsp;<span class="ident" id="3787888">z</span><span class="op" id="3787889">)</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787895">zz</span><span class="op" id="3787897">,</span>&nbsp;<span class="ident" id="3787899">z</span>&nbsp;<span class="op" id="3787901">=</span>&nbsp;<span class="ident" id="3787903">z</span><span class="op" id="3787904">,</span>&nbsp;<span class="ident" id="3787906">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787913">zz</span><span class="op" id="3787915">,</span>&nbsp;<span class="ident" id="3787917">r</span>&nbsp;<span class="op" id="3787919">=</span>&nbsp;<span class="ident" id="3787921">zz</span><span class="op" id="3787923">.</span><span class="ident" id="3787924">div</span><span class="op" id="3787927">(</span><span class="ident" id="3787928">r</span><span class="op" id="3787929">,</span>&nbsp;<span class="ident" id="3787931">z</span><span class="op" id="3787932">,</span>&nbsp;<span class="ident" id="3787934">m</span><span class="op" id="3787935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787941">z</span><span class="op" id="3787942">,</span>&nbsp;<span class="ident" id="3787944">r</span>&nbsp;<span class="op" id="3787946">=</span>&nbsp;<span class="ident" id="3787948">r</span><span class="op" id="3787949">,</span>&nbsp;<span class="ident" id="3787951">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3787956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787962">zz</span>&nbsp;<span class="op" id="3787965">=</span>&nbsp;<span class="ident" id="3787967">zz</span><span class="op" id="3787969">.</span><span class="ident" id="3787970">mul</span><span class="op" id="3787973">(</span><span class="ident" id="3787974">z</span><span class="op" id="3787975">,</span>&nbsp;<span class="ident" id="3787977">powers</span><span class="op" id="3787983">[</span><span class="ident" id="3787984">yi</span><span class="op" id="3787986">&gt;&gt;</span><span class="op" id="3787988">(</span><span class="ident" id="3787989">_W</span><span class="op" id="3787991">-</span><span class="ident" id="3787992">n</span><span class="op" id="3787993">)</span><span class="op" id="3787994">]</span><span class="op" id="3787995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788000">zz</span><span class="op" id="3788002">,</span>&nbsp;<span class="ident" id="3788004">z</span>&nbsp;<span class="op" id="3788006">=</span>&nbsp;<span class="ident" id="3788008">z</span><span class="op" id="3788009">,</span>&nbsp;<span class="ident" id="3788011">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788017">zz</span><span class="op" id="3788019">,</span>&nbsp;<span class="ident" id="3788021">r</span>&nbsp;<span class="op" id="3788023">=</span>&nbsp;<span class="ident" id="3788025">zz</span><span class="op" id="3788027">.</span><span class="ident" id="3788028">div</span><span class="op" id="3788031">(</span><span class="ident" id="3788032">r</span><span class="op" id="3788033">,</span>&nbsp;<span class="ident" id="3788035">z</span><span class="op" id="3788036">,</span>&nbsp;<span class="ident" id="3788038">m</span><span class="op" id="3788039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788044">z</span><span class="op" id="3788045">,</span>&nbsp;<span class="ident" id="3788047">r</span>&nbsp;<span class="op" id="3788049">=</span>&nbsp;<span class="ident" id="3788051">r</span><span class="op" id="3788052">,</span>&nbsp;<span class="ident" id="3788054">z</span><br>
<span class="lineno"></span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788060">yi</span>&nbsp;<span class="op" id="3788063">&lt;&lt;=</span>&nbsp;<span class="ident" id="3788067">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3788071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3788074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788078">return</span>&nbsp;<span class="ident" id="3788085">z</span><span class="op" id="3788086">.</span><span class="ident" id="3788087">norm</span><span class="op" id="3788091">(</span><span class="op" id="3788092">)</span><br>
<span class="lineno">1380</span><span class="op" id="3788094">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3788097">//&nbsp;probablyPrime&nbsp;performs&nbsp;reps&nbsp;Miller-Rabin&nbsp;tests&nbsp;to&nbsp;check&nbsp;whether&nbsp;n&nbsp;is&nbsp;prime.</span><br>
<span class="lineno"></span><span class="comment" id="3788176">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;true,&nbsp;n&nbsp;is&nbsp;prime&nbsp;with&nbsp;probability&nbsp;1&nbsp;-&nbsp;1/4^reps.</span><br>
<span class="lineno"></span><span class="comment" id="3788241">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;false,&nbsp;n&nbsp;is&nbsp;not&nbsp;prime.</span><br>
<span class="lineno">1385</span><span class="keyword" id="3788281">func</span>&nbsp;<span class="op" id="3788286">(</span><span class="ident" id="3788287">n</span>&nbsp;<span class="ident" id="3788289">nat</span><span class="op" id="3788292">)</span>&nbsp;<span class="ident" id="3788294">probablyPrime</span><span class="op" id="3788307">(</span><span class="ident" id="3788308">reps</span>&nbsp;<span class="builtintype" id="3788313">int</span><span class="op" id="3788316">)</span>&nbsp;<span class="builtintype" id="3788318">bool</span>&nbsp;<span class="op" id="3788323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788326">if</span>&nbsp;<span class="builtinfunc" id="3788329">len</span><span class="op" id="3788332">(</span><span class="ident" id="3788333">n</span><span class="op" id="3788334">)</span>&nbsp;<span class="op" id="3788336">==</span>&nbsp;<span class="num" id="3788339">0</span>&nbsp;<span class="op" id="3788341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788345">return</span>&nbsp;<span class="builtintype" id="3788352">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3788359">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788363">if</span>&nbsp;<span class="builtinfunc" id="3788366">len</span><span class="op" id="3788369">(</span><span class="ident" id="3788370">n</span><span class="op" id="3788371">)</span>&nbsp;<span class="op" id="3788373">==</span>&nbsp;<span class="num" id="3788376">1</span>&nbsp;<span class="op" id="3788378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788382">if</span>&nbsp;<span class="ident" id="3788385">n</span><span class="op" id="3788386">[</span><span class="num" id="3788387">0</span><span class="op" id="3788388">]</span>&nbsp;<span class="op" id="3788390">&lt;</span>&nbsp;<span class="num" id="3788392">2</span>&nbsp;<span class="op" id="3788394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788399">return</span>&nbsp;<span class="builtintype" id="3788406">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3788414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788419">if</span>&nbsp;<span class="ident" id="3788422">n</span><span class="op" id="3788423">[</span><span class="num" id="3788424">0</span><span class="op" id="3788425">]</span><span class="op" id="3788426">%</span><span class="num" id="3788427">2</span>&nbsp;<span class="op" id="3788429">==</span>&nbsp;<span class="num" id="3788432">0</span>&nbsp;<span class="op" id="3788434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788439">return</span>&nbsp;<span class="ident" id="3788446">n</span><span class="op" id="3788447">[</span><span class="num" id="3788448">0</span><span class="op" id="3788449">]</span>&nbsp;<span class="op" id="3788451">==</span>&nbsp;<span class="num" id="3788454">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3788458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3788463">//&nbsp;We&nbsp;have&nbsp;to&nbsp;exclude&nbsp;these&nbsp;cases&nbsp;because&nbsp;we&nbsp;reject&nbsp;all</span><br>
<span class="lineno">1400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3788521">//&nbsp;multiples&nbsp;of&nbsp;these&nbsp;numbers&nbsp;below.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788560">switch</span>&nbsp;<span class="ident" id="3788567">n</span><span class="op" id="3788568">[</span><span class="num" id="3788569">0</span><span class="op" id="3788570">]</span>&nbsp;<span class="op" id="3788572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788576">case</span>&nbsp;<span class="num" id="3788581">3</span><span class="op" id="3788582">,</span>&nbsp;<span class="num" id="3788584">5</span><span class="op" id="3788585">,</span>&nbsp;<span class="num" id="3788587">7</span><span class="op" id="3788588">,</span>&nbsp;<span class="num" id="3788590">11</span><span class="op" id="3788592">,</span>&nbsp;<span class="num" id="3788594">13</span><span class="op" id="3788596">,</span>&nbsp;<span class="num" id="3788598">17</span><span class="op" id="3788600">,</span>&nbsp;<span class="num" id="3788602">19</span><span class="op" id="3788604">,</span>&nbsp;<span class="num" id="3788606">23</span><span class="op" id="3788608">,</span>&nbsp;<span class="num" id="3788610">29</span><span class="op" id="3788612">,</span>&nbsp;<span class="num" id="3788614">31</span><span class="op" id="3788616">,</span>&nbsp;<span class="num" id="3788618">37</span><span class="op" id="3788620">,</span>&nbsp;<span class="num" id="3788622">41</span><span class="op" id="3788624">,</span>&nbsp;<span class="num" id="3788626">43</span><span class="op" id="3788628">,</span>&nbsp;<span class="num" id="3788630">47</span><span class="op" id="3788632">,</span>&nbsp;<span class="num" id="3788634">53</span><span class="op" id="3788636">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788641">return</span>&nbsp;<span class="builtintype" id="3788648">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3788655">}</span><br>
<span class="lineno">1405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3788658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788662">const</span>&nbsp;<span class="ident" id="3788668">primesProduct32</span>&nbsp;<span class="op" id="3788684">=</span>&nbsp;<span class="num" id="3788686">0xC0CFD797</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3788705">//&nbsp;&nbsp;{p&nbsp;&nbsp;primes,&nbsp;2&nbsp;&lt;&nbsp;p&nbsp;&lt;=&nbsp;29}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788740">const</span>&nbsp;<span class="ident" id="3788746">primesProduct64</span>&nbsp;<span class="op" id="3788762">=</span>&nbsp;<span class="num" id="3788764">0xE221F97C30E94E1D</span>&nbsp;<span class="comment" id="3788783">//&nbsp;&nbsp;{p&nbsp;&nbsp;primes,&nbsp;2&nbsp;&lt;&nbsp;p&nbsp;&lt;=&nbsp;53}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788819">var</span>&nbsp;<span class="ident" id="3788823">r</span>&nbsp;<span class="ident" id="3788825">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788831">switch</span>&nbsp;<span class="ident" id="3788838">_W</span>&nbsp;<span class="op" id="3788841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788844">case</span>&nbsp;<span class="num" id="3788849">32</span><span class="op" id="3788851">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788855">r</span>&nbsp;<span class="op" id="3788857">=</span>&nbsp;<span class="ident" id="3788859">n</span><span class="op" id="3788860">.</span><span class="ident" id="3788861">modW</span><span class="op" id="3788865">(</span><span class="ident" id="3788866">primesProduct32</span><span class="op" id="3788881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788884">case</span>&nbsp;<span class="num" id="3788889">64</span><span class="op" id="3788891">:</span><br>
<span class="lineno">1415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788895">r</span>&nbsp;<span class="op" id="3788897">=</span>&nbsp;<span class="ident" id="3788899">n</span><span class="op" id="3788900">.</span><span class="ident" id="3788901">modW</span><span class="op" id="3788905">(</span><span class="ident" id="3788906">primesProduct64</span>&nbsp;<span class="op" id="3788922">&amp;</span>&nbsp;<span class="ident" id="3788924">_M</span><span class="op" id="3788926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788929">default</span><span class="op" id="3788936">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3788940">panic</span><span class="op" id="3788945">(</span><span class="string" id="3788946">&#34;Unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="3788965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3788968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788972">if</span>&nbsp;<span class="ident" id="3788975">r</span><span class="op" id="3788976">%</span><span class="num" id="3788977">3</span>&nbsp;<span class="op" id="3788979">==</span>&nbsp;<span class="num" id="3788982">0</span>&nbsp;<span class="op" id="3788984">||</span>&nbsp;<span class="ident" id="3788987">r</span><span class="op" id="3788988">%</span><span class="num" id="3788989">5</span>&nbsp;<span class="op" id="3788991">==</span>&nbsp;<span class="num" id="3788994">0</span>&nbsp;<span class="op" id="3788996">||</span>&nbsp;<span class="ident" id="3788999">r</span><span class="op" id="3789000">%</span><span class="num" id="3789001">7</span>&nbsp;<span class="op" id="3789003">==</span>&nbsp;<span class="num" id="3789006">0</span>&nbsp;<span class="op" id="3789008">||</span>&nbsp;<span class="ident" id="3789011">r</span><span class="op" id="3789012">%</span><span class="num" id="3789013">11</span>&nbsp;<span class="op" id="3789016">==</span>&nbsp;<span class="num" id="3789019">0</span>&nbsp;<span class="op" id="3789021">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789026">r</span><span class="op" id="3789027">%</span><span class="num" id="3789028">13</span>&nbsp;<span class="op" id="3789031">==</span>&nbsp;<span class="num" id="3789034">0</span>&nbsp;<span class="op" id="3789036">||</span>&nbsp;<span class="ident" id="3789039">r</span><span class="op" id="3789040">%</span><span class="num" id="3789041">17</span>&nbsp;<span class="op" id="3789044">==</span>&nbsp;<span class="num" id="3789047">0</span>&nbsp;<span class="op" id="3789049">||</span>&nbsp;<span class="ident" id="3789052">r</span><span class="op" id="3789053">%</span><span class="num" id="3789054">19</span>&nbsp;<span class="op" id="3789057">==</span>&nbsp;<span class="num" id="3789060">0</span>&nbsp;<span class="op" id="3789062">||</span>&nbsp;<span class="ident" id="3789065">r</span><span class="op" id="3789066">%</span><span class="num" id="3789067">23</span>&nbsp;<span class="op" id="3789070">==</span>&nbsp;<span class="num" id="3789073">0</span>&nbsp;<span class="op" id="3789075">||</span>&nbsp;<span class="ident" id="3789078">r</span><span class="op" id="3789079">%</span><span class="num" id="3789080">29</span>&nbsp;<span class="op" id="3789083">==</span>&nbsp;<span class="num" id="3789086">0</span>&nbsp;<span class="op" id="3789088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789092">return</span>&nbsp;<span class="builtintype" id="3789099">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3789106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789110">if</span>&nbsp;<span class="ident" id="3789113">_W</span>&nbsp;<span class="op" id="3789116">==</span>&nbsp;<span class="num" id="3789119">64</span>&nbsp;<span class="op" id="3789122">&amp;&amp;</span>&nbsp;<span class="op" id="3789125">(</span><span class="ident" id="3789126">r</span><span class="op" id="3789127">%</span><span class="num" id="3789128">31</span>&nbsp;<span class="op" id="3789131">==</span>&nbsp;<span class="num" id="3789134">0</span>&nbsp;<span class="op" id="3789136">||</span>&nbsp;<span class="ident" id="3789139">r</span><span class="op" id="3789140">%</span><span class="num" id="3789141">37</span>&nbsp;<span class="op" id="3789144">==</span>&nbsp;<span class="num" id="3789147">0</span>&nbsp;<span class="op" id="3789149">||</span>&nbsp;<span class="ident" id="3789152">r</span><span class="op" id="3789153">%</span><span class="num" id="3789154">41</span>&nbsp;<span class="op" id="3789157">==</span>&nbsp;<span class="num" id="3789160">0</span>&nbsp;<span class="op" id="3789162">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789167">r</span><span class="op" id="3789168">%</span><span class="num" id="3789169">43</span>&nbsp;<span class="op" id="3789172">==</span>&nbsp;<span class="num" id="3789175">0</span>&nbsp;<span class="op" id="3789177">||</span>&nbsp;<span class="ident" id="3789180">r</span><span class="op" id="3789181">%</span><span class="num" id="3789182">47</span>&nbsp;<span class="op" id="3789185">==</span>&nbsp;<span class="num" id="3789188">0</span>&nbsp;<span class="op" id="3789190">||</span>&nbsp;<span class="ident" id="3789193">r</span><span class="op" id="3789194">%</span><span class="num" id="3789195">53</span>&nbsp;<span class="op" id="3789198">==</span>&nbsp;<span class="num" id="3789201">0</span><span class="op" id="3789202">)</span>&nbsp;<span class="op" id="3789204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789208">return</span>&nbsp;<span class="builtintype" id="3789215">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3789222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789226">nm1</span>&nbsp;<span class="op" id="3789230">:=</span>&nbsp;<span class="ident" id="3789233">nat</span><span class="op" id="3789236">(</span><span class="ident" id="3789237">nil</span><span class="op" id="3789240">)</span><span class="op" id="3789241">.</span><span class="ident" id="3789242">sub</span><span class="op" id="3789245">(</span><span class="ident" id="3789246">n</span><span class="op" id="3789247">,</span>&nbsp;<span class="ident" id="3789249">natOne</span><span class="op" id="3789255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789258">//&nbsp;determine&nbsp;q,&nbsp;k&nbsp;such&nbsp;that&nbsp;nm1&nbsp;=&nbsp;q&nbsp;&lt;&lt;&nbsp;k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789300">k</span>&nbsp;<span class="op" id="3789302">:=</span>&nbsp;<span class="ident" id="3789305">nm1</span><span class="op" id="3789308">.</span><span class="ident" id="3789309">trailingZeroBits</span><span class="op" id="3789325">(</span><span class="op" id="3789326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789329">q</span>&nbsp;<span class="op" id="3789331">:=</span>&nbsp;<span class="ident" id="3789334">nat</span><span class="op" id="3789337">(</span><span class="ident" id="3789338">nil</span><span class="op" id="3789341">)</span><span class="op" id="3789342">.</span><span class="ident" id="3789343">shr</span><span class="op" id="3789346">(</span><span class="ident" id="3789347">nm1</span><span class="op" id="3789350">,</span>&nbsp;<span class="ident" id="3789352">k</span><span class="op" id="3789353">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789357">nm3</span>&nbsp;<span class="op" id="3789361">:=</span>&nbsp;<span class="ident" id="3789364">nat</span><span class="op" id="3789367">(</span><span class="ident" id="3789368">nil</span><span class="op" id="3789371">)</span><span class="op" id="3789372">.</span><span class="ident" id="3789373">sub</span><span class="op" id="3789376">(</span><span class="ident" id="3789377">nm1</span><span class="op" id="3789380">,</span>&nbsp;<span class="ident" id="3789382">natTwo</span><span class="op" id="3789388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789391">rand</span>&nbsp;<span class="op" id="3789396">:=</span>&nbsp;<span class="ident" id="3789399">rand</span><span class="op" id="3789403">.</span><span class="ident" id="3789404">New</span><span class="op" id="3789407">(</span><span class="ident" id="3789408">rand</span><span class="op" id="3789412">.</span><span class="ident" id="3789413">NewSource</span><span class="op" id="3789422">(</span><span class="ident" id="3789423">int64</span><span class="op" id="3789428">(</span><span class="ident" id="3789429">n</span><span class="op" id="3789430">[</span><span class="num" id="3789431">0</span><span class="op" id="3789432">]</span><span class="op" id="3789433">)</span><span class="op" id="3789434">)</span><span class="op" id="3789435">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789439">var</span>&nbsp;<span class="ident" id="3789443">x</span><span class="op" id="3789444">,</span>&nbsp;<span class="ident" id="3789446">y</span><span class="op" id="3789447">,</span>&nbsp;<span class="ident" id="3789449">quotient</span>&nbsp;<span class="ident" id="3789458">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789463">nm3Len</span>&nbsp;<span class="op" id="3789470">:=</span>&nbsp;<span class="ident" id="3789473">nm3</span><span class="op" id="3789476">.</span><span class="ident" id="3789477">bitLen</span><span class="op" id="3789483">(</span><span class="op" id="3789484">)</span><br>
<span class="lineno">1440</span><br>
<span class="lineno"></span><span class="ident" id="3789487">NextRandom</span><span class="op" id="3789497">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789500">for</span>&nbsp;<span class="ident" id="3789504">i</span>&nbsp;<span class="op" id="3789506">:=</span>&nbsp;<span class="num" id="3789509">0</span><span class="op" id="3789510">;</span>&nbsp;<span class="ident" id="3789512">i</span>&nbsp;<span class="op" id="3789514">&lt;</span>&nbsp;<span class="ident" id="3789516">reps</span><span class="op" id="3789520">;</span>&nbsp;<span class="ident" id="3789522">i</span><span class="op" id="3789523">++</span>&nbsp;<span class="op" id="3789526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789530">x</span>&nbsp;<span class="op" id="3789532">=</span>&nbsp;<span class="ident" id="3789534">x</span><span class="op" id="3789535">.</span><span class="ident" id="3789536">random</span><span class="op" id="3789542">(</span><span class="ident" id="3789543">rand</span><span class="op" id="3789547">,</span>&nbsp;<span class="ident" id="3789549">nm3</span><span class="op" id="3789552">,</span>&nbsp;<span class="ident" id="3789554">nm3Len</span><span class="op" id="3789560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789564">x</span>&nbsp;<span class="op" id="3789566">=</span>&nbsp;<span class="ident" id="3789568">x</span><span class="op" id="3789569">.</span><span class="ident" id="3789570">add</span><span class="op" id="3789573">(</span><span class="ident" id="3789574">x</span><span class="op" id="3789575">,</span>&nbsp;<span class="ident" id="3789577">natTwo</span><span class="op" id="3789583">)</span><br>
<span class="lineno">1445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789587">y</span>&nbsp;<span class="op" id="3789589">=</span>&nbsp;<span class="ident" id="3789591">y</span><span class="op" id="3789592">.</span><span class="ident" id="3789593">expNN</span><span class="op" id="3789598">(</span><span class="ident" id="3789599">x</span><span class="op" id="3789600">,</span>&nbsp;<span class="ident" id="3789602">q</span><span class="op" id="3789603">,</span>&nbsp;<span class="ident" id="3789605">n</span><span class="op" id="3789606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789610">if</span>&nbsp;<span class="ident" id="3789613">y</span><span class="op" id="3789614">.</span><span class="ident" id="3789615">cmp</span><span class="op" id="3789618">(</span><span class="ident" id="3789619">natOne</span><span class="op" id="3789625">)</span>&nbsp;<span class="op" id="3789627">==</span>&nbsp;<span class="num" id="3789630">0</span>&nbsp;<span class="op" id="3789632">||</span>&nbsp;<span class="ident" id="3789635">y</span><span class="op" id="3789636">.</span><span class="ident" id="3789637">cmp</span><span class="op" id="3789640">(</span><span class="ident" id="3789641">nm1</span><span class="op" id="3789644">)</span>&nbsp;<span class="op" id="3789646">==</span>&nbsp;<span class="num" id="3789649">0</span>&nbsp;<span class="op" id="3789651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789656">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3789667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789671">for</span>&nbsp;<span class="ident" id="3789675">j</span>&nbsp;<span class="op" id="3789677">:=</span>&nbsp;<span class="builtintype" id="3789680">uint</span><span class="op" id="3789684">(</span><span class="num" id="3789685">1</span><span class="op" id="3789686">)</span><span class="op" id="3789687">;</span>&nbsp;<span class="ident" id="3789689">j</span>&nbsp;<span class="op" id="3789691">&lt;</span>&nbsp;<span class="ident" id="3789693">k</span><span class="op" id="3789694">;</span>&nbsp;<span class="ident" id="3789696">j</span><span class="op" id="3789697">++</span>&nbsp;<span class="op" id="3789700">{</span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789705">y</span>&nbsp;<span class="op" id="3789707">=</span>&nbsp;<span class="ident" id="3789709">y</span><span class="op" id="3789710">.</span><span class="ident" id="3789711">mul</span><span class="op" id="3789714">(</span><span class="ident" id="3789715">y</span><span class="op" id="3789716">,</span>&nbsp;<span class="ident" id="3789718">y</span><span class="op" id="3789719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789724">quotient</span><span class="op" id="3789732">,</span>&nbsp;<span class="ident" id="3789734">y</span>&nbsp;<span class="op" id="3789736">=</span>&nbsp;<span class="ident" id="3789738">quotient</span><span class="op" id="3789746">.</span><span class="ident" id="3789747">div</span><span class="op" id="3789750">(</span><span class="ident" id="3789751">y</span><span class="op" id="3789752">,</span>&nbsp;<span class="ident" id="3789754">y</span><span class="op" id="3789755">,</span>&nbsp;<span class="ident" id="3789757">n</span><span class="op" id="3789758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789763">if</span>&nbsp;<span class="ident" id="3789766">y</span><span class="op" id="3789767">.</span><span class="ident" id="3789768">cmp</span><span class="op" id="3789771">(</span><span class="ident" id="3789772">nm1</span><span class="op" id="3789775">)</span>&nbsp;<span class="op" id="3789777">==</span>&nbsp;<span class="num" id="3789780">0</span>&nbsp;<span class="op" id="3789782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789788">continue</span>&nbsp;<span class="ident" id="3789797">NextRandom</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3789811">}</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789816">if</span>&nbsp;<span class="ident" id="3789819">y</span><span class="op" id="3789820">.</span><span class="ident" id="3789821">cmp</span><span class="op" id="3789824">(</span><span class="ident" id="3789825">natOne</span><span class="op" id="3789831">)</span>&nbsp;<span class="op" id="3789833">==</span>&nbsp;<span class="num" id="3789836">0</span>&nbsp;<span class="op" id="3789838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789844">return</span>&nbsp;<span class="builtintype" id="3789851">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3789860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3789864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789868">return</span>&nbsp;<span class="builtintype" id="3789875">false</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3789882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789886">return</span>&nbsp;<span class="builtintype" id="3789893">true</span><br>
<span class="lineno"></span><span class="op" id="3789898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1465</span><span class="comment" id="3789901">//&nbsp;bytes&nbsp;writes&nbsp;the&nbsp;value&nbsp;of&nbsp;z&nbsp;into&nbsp;buf&nbsp;using&nbsp;big-endian&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="comment" id="3789968">//&nbsp;len(buf)&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;len(z)*_S.&nbsp;The&nbsp;value&nbsp;of&nbsp;z&nbsp;is&nbsp;encoded&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3790035">//&nbsp;slice&nbsp;buf[i:].&nbsp;The&nbsp;number&nbsp;i&nbsp;of&nbsp;unused&nbsp;bytes&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3790102">//&nbsp;buf&nbsp;is&nbsp;returned&nbsp;as&nbsp;result.</span><br>
<span class="lineno"></span><span class="keyword" id="3790132">func</span>&nbsp;<span class="op" id="3790137">(</span><span class="ident" id="3790138">z</span>&nbsp;<span class="ident" id="3790140">nat</span><span class="op" id="3790143">)</span>&nbsp;<span class="ident" id="3790145">bytes</span><span class="op" id="3790150">(</span><span class="ident" id="3790151">buf</span>&nbsp;<span class="op" id="3790155">[</span><span class="op" id="3790156">]</span><span class="builtintype" id="3790157">byte</span><span class="op" id="3790161">)</span>&nbsp;<span class="op" id="3790163">(</span><span class="ident" id="3790164">i</span>&nbsp;<span class="builtintype" id="3790166">int</span><span class="op" id="3790169">)</span>&nbsp;<span class="op" id="3790171">{</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790174">i</span>&nbsp;<span class="op" id="3790176">=</span>&nbsp;<span class="builtinfunc" id="3790178">len</span><span class="op" id="3790181">(</span><span class="ident" id="3790182">buf</span><span class="op" id="3790185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790188">for</span>&nbsp;<span class="ident" id="3790192">_</span><span class="op" id="3790193">,</span>&nbsp;<span class="ident" id="3790195">d</span>&nbsp;<span class="op" id="3790197">:=</span>&nbsp;<span class="keyword" id="3790200">range</span>&nbsp;<span class="ident" id="3790206">z</span>&nbsp;<span class="op" id="3790208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790212">for</span>&nbsp;<span class="ident" id="3790216">j</span>&nbsp;<span class="op" id="3790218">:=</span>&nbsp;<span class="num" id="3790221">0</span><span class="op" id="3790222">;</span>&nbsp;<span class="ident" id="3790224">j</span>&nbsp;<span class="op" id="3790226">&lt;</span>&nbsp;<span class="ident" id="3790228">_S</span><span class="op" id="3790230">;</span>&nbsp;<span class="ident" id="3790232">j</span><span class="op" id="3790233">++</span>&nbsp;<span class="op" id="3790236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790241">i</span><span class="op" id="3790242">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790248">buf</span><span class="op" id="3790251">[</span><span class="ident" id="3790252">i</span><span class="op" id="3790253">]</span>&nbsp;<span class="op" id="3790255">=</span>&nbsp;<span class="builtintype" id="3790257">byte</span><span class="op" id="3790261">(</span><span class="ident" id="3790262">d</span><span class="op" id="3790263">)</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790268">d</span>&nbsp;<span class="op" id="3790270">&gt;&gt;=</span>&nbsp;<span class="num" id="3790274">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3790278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3790281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790285">for</span>&nbsp;<span class="ident" id="3790289">i</span>&nbsp;<span class="op" id="3790291">&lt;</span>&nbsp;<span class="builtinfunc" id="3790293">len</span><span class="op" id="3790296">(</span><span class="ident" id="3790297">buf</span><span class="op" id="3790300">)</span>&nbsp;<span class="op" id="3790302">&amp;&amp;</span>&nbsp;<span class="ident" id="3790305">buf</span><span class="op" id="3790308">[</span><span class="ident" id="3790309">i</span><span class="op" id="3790310">]</span>&nbsp;<span class="op" id="3790312">==</span>&nbsp;<span class="num" id="3790315">0</span>&nbsp;<span class="op" id="3790317">{</span><br>
<span class="lineno">1480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790321">i</span><span class="op" id="3790322">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3790326">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790330">return</span><br>
<span class="lineno"></span><span class="op" id="3790337">}</span><br>
<span class="lineno">1485</span><br>
<span class="lineno"></span><span class="comment" id="3790340">//&nbsp;setBytes&nbsp;interprets&nbsp;buf&nbsp;as&nbsp;the&nbsp;bytes&nbsp;of&nbsp;a&nbsp;big-endian&nbsp;unsigned</span><br>
<span class="lineno"></span><span class="comment" id="3790405">//&nbsp;integer,&nbsp;sets&nbsp;z&nbsp;to&nbsp;that&nbsp;value,&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3790454">func</span>&nbsp;<span class="op" id="3790459">(</span><span class="ident" id="3790460">z</span>&nbsp;<span class="ident" id="3790462">nat</span><span class="op" id="3790465">)</span>&nbsp;<span class="ident" id="3790467">setBytes</span><span class="op" id="3790475">(</span><span class="ident" id="3790476">buf</span>&nbsp;<span class="op" id="3790480">[</span><span class="op" id="3790481">]</span><span class="builtintype" id="3790482">byte</span><span class="op" id="3790486">)</span>&nbsp;<span class="ident" id="3790488">nat</span>&nbsp;<span class="op" id="3790492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790495">z</span>&nbsp;<span class="op" id="3790497">=</span>&nbsp;<span class="ident" id="3790499">z</span><span class="op" id="3790500">.</span><span class="builtinfunc" id="3790501">make</span><span class="op" id="3790505">(</span><span class="op" id="3790506">(</span><span class="builtinfunc" id="3790507">len</span><span class="op" id="3790510">(</span><span class="ident" id="3790511">buf</span><span class="op" id="3790514">)</span>&nbsp;<span class="op" id="3790516">+</span>&nbsp;<span class="ident" id="3790518">_S</span>&nbsp;<span class="op" id="3790521">-</span>&nbsp;<span class="num" id="3790523">1</span><span class="op" id="3790524">)</span>&nbsp;<span class="op" id="3790526">/</span>&nbsp;<span class="ident" id="3790528">_S</span><span class="op" id="3790530">)</span><br>
<span class="lineno">1490</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790534">k</span>&nbsp;<span class="op" id="3790536">:=</span>&nbsp;<span class="num" id="3790539">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790542">s</span>&nbsp;<span class="op" id="3790544">:=</span>&nbsp;<span class="builtintype" id="3790547">uint</span><span class="op" id="3790551">(</span><span class="num" id="3790552">0</span><span class="op" id="3790553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790556">var</span>&nbsp;<span class="ident" id="3790560">d</span>&nbsp;<span class="ident" id="3790562">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790568">for</span>&nbsp;<span class="ident" id="3790572">i</span>&nbsp;<span class="op" id="3790574">:=</span>&nbsp;<span class="builtinfunc" id="3790577">len</span><span class="op" id="3790580">(</span><span class="ident" id="3790581">buf</span><span class="op" id="3790584">)</span><span class="op" id="3790585">;</span>&nbsp;<span class="ident" id="3790587">i</span>&nbsp;<span class="op" id="3790589">&gt;</span>&nbsp;<span class="num" id="3790591">0</span><span class="op" id="3790592">;</span>&nbsp;<span class="ident" id="3790594">i</span><span class="op" id="3790595">--</span>&nbsp;<span class="op" id="3790598">{</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790602">d</span>&nbsp;<span class="op" id="3790604">|=</span>&nbsp;<span class="ident" id="3790607">Word</span><span class="op" id="3790611">(</span><span class="ident" id="3790612">buf</span><span class="op" id="3790615">[</span><span class="ident" id="3790616">i</span><span class="op" id="3790617">-</span><span class="num" id="3790618">1</span><span class="op" id="3790619">]</span><span class="op" id="3790620">)</span>&nbsp;<span class="op" id="3790622">&lt;&lt;</span>&nbsp;<span class="ident" id="3790625">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790629">if</span>&nbsp;<span class="ident" id="3790632">s</span>&nbsp;<span class="op" id="3790634">+=</span>&nbsp;<span class="num" id="3790637">8</span><span class="op" id="3790638">;</span>&nbsp;<span class="ident" id="3790640">s</span>&nbsp;<span class="op" id="3790642">==</span>&nbsp;<span class="ident" id="3790645">_S</span><span class="op" id="3790647">*</span><span class="num" id="3790648">8</span>&nbsp;<span class="op" id="3790650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790655">z</span><span class="op" id="3790656">[</span><span class="ident" id="3790657">k</span><span class="op" id="3790658">]</span>&nbsp;<span class="op" id="3790660">=</span>&nbsp;<span class="ident" id="3790662">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790667">k</span><span class="op" id="3790668">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790674">s</span>&nbsp;<span class="op" id="3790676">=</span>&nbsp;<span class="num" id="3790678">0</span><br>
<span class="lineno">1500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790683">d</span>&nbsp;<span class="op" id="3790685">=</span>&nbsp;<span class="num" id="3790687">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3790691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3790694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790697">if</span>&nbsp;<span class="ident" id="3790700">k</span>&nbsp;<span class="op" id="3790702">&lt;</span>&nbsp;<span class="builtinfunc" id="3790704">len</span><span class="op" id="3790707">(</span><span class="ident" id="3790708">z</span><span class="op" id="3790709">)</span>&nbsp;<span class="op" id="3790711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790715">z</span><span class="op" id="3790716">[</span><span class="ident" id="3790717">k</span><span class="op" id="3790718">]</span>&nbsp;<span class="op" id="3790720">=</span>&nbsp;<span class="ident" id="3790722">d</span><br>
<span class="lineno">1505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3790725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790729">return</span>&nbsp;<span class="ident" id="3790736">z</span><span class="op" id="3790737">.</span><span class="ident" id="3790738">norm</span><span class="op" id="3790742">(</span><span class="op" id="3790743">)</span><br>
<span class="lineno"></span><span class="op" id="3790745">}</span>
</div>
</body>
</html>
