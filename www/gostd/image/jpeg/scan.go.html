<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html" class="current">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5812131">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5812186">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5812240">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5812291">package</span>&nbsp;<span class="ident" id="5812299">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5812305">import</span>&nbsp;<span class="op" id="5812312">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5812315">&#34;image&#34;</span><br>
<span class="lineno"></span><span class="op" id="5812323">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="5812326">//&nbsp;makeImg&nbsp;allocates&nbsp;and&nbsp;initializes&nbsp;the&nbsp;destination&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5812386">func</span>&nbsp;<span class="op" id="5812391">(</span><span class="ident" id="5812392">d</span>&nbsp;<span class="op" id="5812394">*</span><span class="ident" id="5812395">decoder</span><span class="op" id="5812402">)</span>&nbsp;<span class="ident" id="5812404">makeImg</span><span class="op" id="5812411">(</span><span class="ident" id="5812412">h0</span><span class="op" id="5812414">,</span>&nbsp;<span class="ident" id="5812416">v0</span><span class="op" id="5812418">,</span>&nbsp;<span class="ident" id="5812420">mxx</span><span class="op" id="5812423">,</span>&nbsp;<span class="ident" id="5812425">myy</span>&nbsp;<span class="builtintype" id="5812429">int</span><span class="op" id="5812432">)</span>&nbsp;<span class="op" id="5812434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812437">if</span>&nbsp;<span class="ident" id="5812440">d</span><span class="op" id="5812441">.</span><span class="ident" id="5812442">nComp</span>&nbsp;<span class="op" id="5812448">==</span>&nbsp;<span class="ident" id="5812451">nGrayComponent</span>&nbsp;<span class="op" id="5812466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5812470">m</span>&nbsp;<span class="op" id="5812472">:=</span>&nbsp;<span class="ident" id="5812475">image</span><span class="op" id="5812480">.</span><span class="ident" id="5812481">NewGray</span><span class="op" id="5812488">(</span><span class="ident" id="5812489">image</span><span class="op" id="5812494">.</span><span class="ident" id="5812495">Rect</span><span class="op" id="5812499">(</span><span class="num" id="5812500">0</span><span class="op" id="5812501">,</span>&nbsp;<span class="num" id="5812503">0</span><span class="op" id="5812504">,</span>&nbsp;<span class="num" id="5812506">8</span><span class="op" id="5812507">*</span><span class="ident" id="5812508">mxx</span><span class="op" id="5812511">,</span>&nbsp;<span class="num" id="5812513">8</span><span class="op" id="5812514">*</span><span class="ident" id="5812515">myy</span><span class="op" id="5812518">)</span><span class="op" id="5812519">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5812523">d</span><span class="op" id="5812524">.</span><span class="ident" id="5812525">img1</span>&nbsp;<span class="op" id="5812530">=</span>&nbsp;<span class="ident" id="5812532">m</span><span class="op" id="5812533">.</span><span class="ident" id="5812534">SubImage</span><span class="op" id="5812542">(</span><span class="ident" id="5812543">image</span><span class="op" id="5812548">.</span><span class="ident" id="5812549">Rect</span><span class="op" id="5812553">(</span><span class="num" id="5812554">0</span><span class="op" id="5812555">,</span>&nbsp;<span class="num" id="5812557">0</span><span class="op" id="5812558">,</span>&nbsp;<span class="ident" id="5812560">d</span><span class="op" id="5812561">.</span><span class="ident" id="5812562">width</span><span class="op" id="5812567">,</span>&nbsp;<span class="ident" id="5812569">d</span><span class="op" id="5812570">.</span><span class="ident" id="5812571">height</span><span class="op" id="5812577">)</span><span class="op" id="5812578">)</span><span class="op" id="5812579">.</span><span class="op" id="5812580">(</span><span class="op" id="5812581">*</span><span class="ident" id="5812582">image</span><span class="op" id="5812587">.</span><span class="ident" id="5812588">Gray</span><span class="op" id="5812592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812596">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5812604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812607">var</span>&nbsp;<span class="ident" id="5812611">subsampleRatio</span>&nbsp;<span class="ident" id="5812626">image</span><span class="op" id="5812631">.</span><span class="ident" id="5812632">YCbCrSubsampleRatio</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812653">switch</span>&nbsp;<span class="op" id="5812660">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812663">case</span>&nbsp;<span class="ident" id="5812668">h0</span>&nbsp;<span class="op" id="5812671">==</span>&nbsp;<span class="num" id="5812674">1</span>&nbsp;<span class="op" id="5812676">&amp;&amp;</span>&nbsp;<span class="ident" id="5812679">v0</span>&nbsp;<span class="op" id="5812682">==</span>&nbsp;<span class="num" id="5812685">1</span><span class="op" id="5812686">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5812690">subsampleRatio</span>&nbsp;<span class="op" id="5812705">=</span>&nbsp;<span class="ident" id="5812707">image</span><span class="op" id="5812712">.</span><span class="ident" id="5812713">YCbCrSubsampleRatio444</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812737">case</span>&nbsp;<span class="ident" id="5812742">h0</span>&nbsp;<span class="op" id="5812745">==</span>&nbsp;<span class="num" id="5812748">1</span>&nbsp;<span class="op" id="5812750">&amp;&amp;</span>&nbsp;<span class="ident" id="5812753">v0</span>&nbsp;<span class="op" id="5812756">==</span>&nbsp;<span class="num" id="5812759">2</span><span class="op" id="5812760">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5812764">subsampleRatio</span>&nbsp;<span class="op" id="5812779">=</span>&nbsp;<span class="ident" id="5812781">image</span><span class="op" id="5812786">.</span><span class="ident" id="5812787">YCbCrSubsampleRatio440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812811">case</span>&nbsp;<span class="ident" id="5812816">h0</span>&nbsp;<span class="op" id="5812819">==</span>&nbsp;<span class="num" id="5812822">2</span>&nbsp;<span class="op" id="5812824">&amp;&amp;</span>&nbsp;<span class="ident" id="5812827">v0</span>&nbsp;<span class="op" id="5812830">==</span>&nbsp;<span class="num" id="5812833">1</span><span class="op" id="5812834">:</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5812838">subsampleRatio</span>&nbsp;<span class="op" id="5812853">=</span>&nbsp;<span class="ident" id="5812855">image</span><span class="op" id="5812860">.</span><span class="ident" id="5812861">YCbCrSubsampleRatio422</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812885">case</span>&nbsp;<span class="ident" id="5812890">h0</span>&nbsp;<span class="op" id="5812893">==</span>&nbsp;<span class="num" id="5812896">2</span>&nbsp;<span class="op" id="5812898">&amp;&amp;</span>&nbsp;<span class="ident" id="5812901">v0</span>&nbsp;<span class="op" id="5812904">==</span>&nbsp;<span class="num" id="5812907">2</span><span class="op" id="5812908">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5812912">subsampleRatio</span>&nbsp;<span class="op" id="5812927">=</span>&nbsp;<span class="ident" id="5812929">image</span><span class="op" id="5812934">.</span><span class="ident" id="5812935">YCbCrSubsampleRatio420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812959">default</span><span class="op" id="5812966">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5812970">panic</span><span class="op" id="5812975">(</span><span class="string" id="5812976">&#34;unreachable&#34;</span><span class="op" id="5812989">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5812992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5812995">m</span>&nbsp;<span class="op" id="5812997">:=</span>&nbsp;<span class="ident" id="5813000">image</span><span class="op" id="5813005">.</span><span class="ident" id="5813006">NewYCbCr</span><span class="op" id="5813014">(</span><span class="ident" id="5813015">image</span><span class="op" id="5813020">.</span><span class="ident" id="5813021">Rect</span><span class="op" id="5813025">(</span><span class="num" id="5813026">0</span><span class="op" id="5813027">,</span>&nbsp;<span class="num" id="5813029">0</span><span class="op" id="5813030">,</span>&nbsp;<span class="num" id="5813032">8</span><span class="op" id="5813033">*</span><span class="ident" id="5813034">h0</span><span class="op" id="5813036">*</span><span class="ident" id="5813037">mxx</span><span class="op" id="5813040">,</span>&nbsp;<span class="num" id="5813042">8</span><span class="op" id="5813043">*</span><span class="ident" id="5813044">v0</span><span class="op" id="5813046">*</span><span class="ident" id="5813047">myy</span><span class="op" id="5813050">)</span><span class="op" id="5813051">,</span>&nbsp;<span class="ident" id="5813053">subsampleRatio</span><span class="op" id="5813067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5813070">d</span><span class="op" id="5813071">.</span><span class="ident" id="5813072">img3</span>&nbsp;<span class="op" id="5813077">=</span>&nbsp;<span class="ident" id="5813079">m</span><span class="op" id="5813080">.</span><span class="ident" id="5813081">SubImage</span><span class="op" id="5813089">(</span><span class="ident" id="5813090">image</span><span class="op" id="5813095">.</span><span class="ident" id="5813096">Rect</span><span class="op" id="5813100">(</span><span class="num" id="5813101">0</span><span class="op" id="5813102">,</span>&nbsp;<span class="num" id="5813104">0</span><span class="op" id="5813105">,</span>&nbsp;<span class="ident" id="5813107">d</span><span class="op" id="5813108">.</span><span class="ident" id="5813109">width</span><span class="op" id="5813114">,</span>&nbsp;<span class="ident" id="5813116">d</span><span class="op" id="5813117">.</span><span class="ident" id="5813118">height</span><span class="op" id="5813124">)</span><span class="op" id="5813125">)</span><span class="op" id="5813126">.</span><span class="op" id="5813127">(</span><span class="op" id="5813128">*</span><span class="ident" id="5813129">image</span><span class="op" id="5813134">.</span><span class="ident" id="5813135">YCbCr</span><span class="op" id="5813140">)</span><br>
<span class="lineno"></span><span class="op" id="5813142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="5813145">//&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.3.</span><br>
<span class="lineno"></span><span class="keyword" id="5813176">func</span>&nbsp;<span class="op" id="5813181">(</span><span class="ident" id="5813182">d</span>&nbsp;<span class="op" id="5813184">*</span><span class="ident" id="5813185">decoder</span><span class="op" id="5813192">)</span>&nbsp;<span class="ident" id="5813194">processSOS</span><span class="op" id="5813204">(</span><span class="ident" id="5813205">n</span>&nbsp;<span class="builtintype" id="5813207">int</span><span class="op" id="5813210">)</span>&nbsp;<span class="builtintype" id="5813212">error</span>&nbsp;<span class="op" id="5813218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813221">if</span>&nbsp;<span class="ident" id="5813224">d</span><span class="op" id="5813225">.</span><span class="ident" id="5813226">nComp</span>&nbsp;<span class="op" id="5813232">==</span>&nbsp;<span class="num" id="5813235">0</span>&nbsp;<span class="op" id="5813237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813241">return</span>&nbsp;<span class="ident" id="5813248">FormatError</span><span class="op" id="5813259">(</span><span class="string" id="5813260">&#34;missing&nbsp;SOF&nbsp;marker&#34;</span><span class="op" id="5813280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5813283">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813286">if</span>&nbsp;<span class="ident" id="5813289">n</span>&nbsp;<span class="op" id="5813291">&lt;</span>&nbsp;<span class="num" id="5813293">6</span>&nbsp;<span class="op" id="5813295">||</span>&nbsp;<span class="num" id="5813298">4</span><span class="op" id="5813299">+</span><span class="num" id="5813300">2</span><span class="op" id="5813301">*</span><span class="ident" id="5813302">d</span><span class="op" id="5813303">.</span><span class="ident" id="5813304">nComp</span>&nbsp;<span class="op" id="5813310">&lt;</span>&nbsp;<span class="ident" id="5813312">n</span>&nbsp;<span class="op" id="5813314">||</span>&nbsp;<span class="ident" id="5813317">n</span><span class="op" id="5813318">%</span><span class="num" id="5813319">2</span>&nbsp;<span class="op" id="5813321">!=</span>&nbsp;<span class="num" id="5813324">0</span>&nbsp;<span class="op" id="5813326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813330">return</span>&nbsp;<span class="ident" id="5813337">FormatError</span><span class="op" id="5813348">(</span><span class="string" id="5813349">&#34;SOS&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="5813371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5813374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813377">if</span>&nbsp;<span class="ident" id="5813380">err</span>&nbsp;<span class="op" id="5813384">:=</span>&nbsp;<span class="ident" id="5813387">d</span><span class="op" id="5813388">.</span><span class="ident" id="5813389">readFull</span><span class="op" id="5813397">(</span><span class="ident" id="5813398">d</span><span class="op" id="5813399">.</span><span class="ident" id="5813400">tmp</span><span class="op" id="5813403">[</span><span class="op" id="5813404">:</span><span class="ident" id="5813405">n</span><span class="op" id="5813406">]</span><span class="op" id="5813407">)</span><span class="op" id="5813408">;</span>&nbsp;<span class="ident" id="5813410">err</span>&nbsp;<span class="op" id="5813414">!=</span>&nbsp;<span class="ident" id="5813417">nil</span>&nbsp;<span class="op" id="5813421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813425">return</span>&nbsp;<span class="ident" id="5813432">err</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5813437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5813440">nComp</span>&nbsp;<span class="op" id="5813446">:=</span>&nbsp;<span class="builtintype" id="5813449">int</span><span class="op" id="5813452">(</span><span class="ident" id="5813453">d</span><span class="op" id="5813454">.</span><span class="ident" id="5813455">tmp</span><span class="op" id="5813458">[</span><span class="num" id="5813459">0</span><span class="op" id="5813460">]</span><span class="op" id="5813461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813464">if</span>&nbsp;<span class="ident" id="5813467">n</span>&nbsp;<span class="op" id="5813469">!=</span>&nbsp;<span class="num" id="5813472">4</span><span class="op" id="5813473">+</span><span class="num" id="5813474">2</span><span class="op" id="5813475">*</span><span class="ident" id="5813476">nComp</span>&nbsp;<span class="op" id="5813482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813486">return</span>&nbsp;<span class="ident" id="5813493">FormatError</span><span class="op" id="5813504">(</span><span class="string" id="5813505">&#34;SOS&nbsp;length&nbsp;inconsistent&nbsp;with&nbsp;number&nbsp;of&nbsp;components&#34;</span><span class="op" id="5813556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5813559">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813562">var</span>&nbsp;<span class="ident" id="5813566">scan</span>&nbsp;<span class="op" id="5813571">[</span><span class="ident" id="5813572">nColorComponent</span><span class="op" id="5813587">]</span><span class="keyword" id="5813588">struct</span>&nbsp;<span class="op" id="5813595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5813599">compIndex</span>&nbsp;<span class="builtintype" id="5813609">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5813617">td</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5813627">uint8</span>&nbsp;<span class="comment" id="5813633">//&nbsp;DC&nbsp;table&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5813657">ta</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5813667">uint8</span>&nbsp;<span class="comment" id="5813673">//&nbsp;AC&nbsp;table&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5813696">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813699">for</span>&nbsp;<span class="ident" id="5813703">i</span>&nbsp;<span class="op" id="5813705">:=</span>&nbsp;<span class="num" id="5813708">0</span><span class="op" id="5813709">;</span>&nbsp;<span class="ident" id="5813711">i</span>&nbsp;<span class="op" id="5813713">&lt;</span>&nbsp;<span class="ident" id="5813715">nComp</span><span class="op" id="5813720">;</span>&nbsp;<span class="ident" id="5813722">i</span><span class="op" id="5813723">++</span>&nbsp;<span class="op" id="5813726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5813730">cs</span>&nbsp;<span class="op" id="5813733">:=</span>&nbsp;<span class="ident" id="5813736">d</span><span class="op" id="5813737">.</span><span class="ident" id="5813738">tmp</span><span class="op" id="5813741">[</span><span class="num" id="5813742">1</span><span class="op" id="5813743">+</span><span class="num" id="5813744">2</span><span class="op" id="5813745">*</span><span class="ident" id="5813746">i</span><span class="op" id="5813747">]</span>&nbsp;<span class="comment" id="5813749">//&nbsp;Component&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5813774">compIndex</span>&nbsp;<span class="op" id="5813784">:=</span>&nbsp;<span class="op" id="5813787">-</span><span class="num" id="5813788">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813792">for</span>&nbsp;<span class="ident" id="5813796">j</span><span class="op" id="5813797">,</span>&nbsp;<span class="ident" id="5813799">comp</span>&nbsp;<span class="op" id="5813804">:=</span>&nbsp;<span class="keyword" id="5813807">range</span>&nbsp;<span class="ident" id="5813813">d</span><span class="op" id="5813814">.</span><span class="ident" id="5813815">comp</span>&nbsp;<span class="op" id="5813820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813825">if</span>&nbsp;<span class="ident" id="5813828">cs</span>&nbsp;<span class="op" id="5813831">==</span>&nbsp;<span class="ident" id="5813834">comp</span><span class="op" id="5813838">.</span><span class="ident" id="5813839">c</span>&nbsp;<span class="op" id="5813841">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5813847">compIndex</span>&nbsp;<span class="op" id="5813857">=</span>&nbsp;<span class="ident" id="5813859">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5813864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5813868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813872">if</span>&nbsp;<span class="ident" id="5813875">compIndex</span>&nbsp;<span class="op" id="5813885">&lt;</span>&nbsp;<span class="num" id="5813887">0</span>&nbsp;<span class="op" id="5813889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813894">return</span>&nbsp;<span class="ident" id="5813901">FormatError</span><span class="op" id="5813912">(</span><span class="string" id="5813913">&#34;unknown&nbsp;component&nbsp;selector&#34;</span><span class="op" id="5813941">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5813945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5813949">scan</span><span class="op" id="5813953">[</span><span class="ident" id="5813954">i</span><span class="op" id="5813955">]</span><span class="op" id="5813956">.</span><span class="ident" id="5813957">compIndex</span>&nbsp;<span class="op" id="5813967">=</span>&nbsp;<span class="builtintype" id="5813969">uint8</span><span class="op" id="5813974">(</span><span class="ident" id="5813975">compIndex</span><span class="op" id="5813984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5813988">scan</span><span class="op" id="5813992">[</span><span class="ident" id="5813993">i</span><span class="op" id="5813994">]</span><span class="op" id="5813995">.</span><span class="ident" id="5813996">td</span>&nbsp;<span class="op" id="5813999">=</span>&nbsp;<span class="ident" id="5814001">d</span><span class="op" id="5814002">.</span><span class="ident" id="5814003">tmp</span><span class="op" id="5814006">[</span><span class="num" id="5814007">2</span><span class="op" id="5814008">+</span><span class="num" id="5814009">2</span><span class="op" id="5814010">*</span><span class="ident" id="5814011">i</span><span class="op" id="5814012">]</span>&nbsp;<span class="op" id="5814014">&gt;&gt;</span>&nbsp;<span class="num" id="5814017">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5814021">if</span>&nbsp;<span class="ident" id="5814024">scan</span><span class="op" id="5814028">[</span><span class="ident" id="5814029">i</span><span class="op" id="5814030">]</span><span class="op" id="5814031">.</span><span class="ident" id="5814032">td</span>&nbsp;<span class="op" id="5814035">&gt;</span>&nbsp;<span class="ident" id="5814037">maxTh</span>&nbsp;<span class="op" id="5814043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5814048">return</span>&nbsp;<span class="ident" id="5814055">FormatError</span><span class="op" id="5814066">(</span><span class="string" id="5814067">&#34;bad&nbsp;Td&nbsp;value&#34;</span><span class="op" id="5814081">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5814085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5814089">scan</span><span class="op" id="5814093">[</span><span class="ident" id="5814094">i</span><span class="op" id="5814095">]</span><span class="op" id="5814096">.</span><span class="ident" id="5814097">ta</span>&nbsp;<span class="op" id="5814100">=</span>&nbsp;<span class="ident" id="5814102">d</span><span class="op" id="5814103">.</span><span class="ident" id="5814104">tmp</span><span class="op" id="5814107">[</span><span class="num" id="5814108">2</span><span class="op" id="5814109">+</span><span class="num" id="5814110">2</span><span class="op" id="5814111">*</span><span class="ident" id="5814112">i</span><span class="op" id="5814113">]</span>&nbsp;<span class="op" id="5814115">&amp;</span>&nbsp;<span class="num" id="5814117">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5814124">if</span>&nbsp;<span class="ident" id="5814127">scan</span><span class="op" id="5814131">[</span><span class="ident" id="5814132">i</span><span class="op" id="5814133">]</span><span class="op" id="5814134">.</span><span class="ident" id="5814135">ta</span>&nbsp;<span class="op" id="5814138">&gt;</span>&nbsp;<span class="ident" id="5814140">maxTh</span>&nbsp;<span class="op" id="5814146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5814151">return</span>&nbsp;<span class="ident" id="5814158">FormatError</span><span class="op" id="5814169">(</span><span class="string" id="5814170">&#34;bad&nbsp;Ta&nbsp;value&#34;</span><span class="op" id="5814184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5814188">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5814191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5814195">//&nbsp;zigStart&nbsp;and&nbsp;zigEnd&nbsp;are&nbsp;the&nbsp;spectral&nbsp;selection&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5814254">//&nbsp;ah&nbsp;and&nbsp;al&nbsp;are&nbsp;the&nbsp;successive&nbsp;approximation&nbsp;high&nbsp;and&nbsp;low&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5814322">//&nbsp;The&nbsp;spec&nbsp;calls&nbsp;these&nbsp;values&nbsp;Ss,&nbsp;Se,&nbsp;Ah&nbsp;and&nbsp;Al.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5814373">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5814377">//&nbsp;For&nbsp;progressive&nbsp;JPEGs,&nbsp;these&nbsp;are&nbsp;the&nbsp;two&nbsp;more-or-less&nbsp;independent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5814447">//&nbsp;aspects&nbsp;of&nbsp;progression.&nbsp;Spectral&nbsp;selection&nbsp;progression&nbsp;is&nbsp;when&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5814518">//&nbsp;all&nbsp;of&nbsp;a&nbsp;block&#39;s&nbsp;64&nbsp;DCT&nbsp;coefficients&nbsp;are&nbsp;transmitted&nbsp;in&nbsp;one&nbsp;pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5814588">//&nbsp;For&nbsp;example,&nbsp;three&nbsp;passes&nbsp;could&nbsp;transmit&nbsp;coefficient&nbsp;0&nbsp;(the&nbsp;DC</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5814655">//&nbsp;component),&nbsp;coefficients&nbsp;1-5,&nbsp;and&nbsp;coefficients&nbsp;6-63,&nbsp;in&nbsp;zig-zag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5814723">//&nbsp;order.&nbsp;Successive&nbsp;approximation&nbsp;is&nbsp;when&nbsp;not&nbsp;all&nbsp;of&nbsp;the&nbsp;bits&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5814792">//&nbsp;band&nbsp;of&nbsp;coefficients&nbsp;are&nbsp;transmitted&nbsp;in&nbsp;one&nbsp;pass.&nbsp;For&nbsp;example,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5814859">//&nbsp;three&nbsp;passes&nbsp;could&nbsp;transmit&nbsp;the&nbsp;6&nbsp;most&nbsp;significant&nbsp;bits,&nbsp;followed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5814929">//&nbsp;by&nbsp;the&nbsp;second-least&nbsp;significant&nbsp;bit,&nbsp;followed&nbsp;by&nbsp;the&nbsp;least</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5814992">//&nbsp;significant&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5815013">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5815017">//&nbsp;For&nbsp;baseline&nbsp;JPEGs,&nbsp;these&nbsp;parameters&nbsp;are&nbsp;hard-coded&nbsp;to&nbsp;0/63/0/0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815086">zigStart</span><span class="op" id="5815094">,</span>&nbsp;<span class="ident" id="5815096">zigEnd</span><span class="op" id="5815102">,</span>&nbsp;<span class="ident" id="5815104">ah</span><span class="op" id="5815106">,</span>&nbsp;<span class="ident" id="5815108">al</span>&nbsp;<span class="op" id="5815111">:=</span>&nbsp;<span class="builtintype" id="5815114">int32</span><span class="op" id="5815119">(</span><span class="num" id="5815120">0</span><span class="op" id="5815121">)</span><span class="op" id="5815122">,</span>&nbsp;<span class="builtintype" id="5815124">int32</span><span class="op" id="5815129">(</span><span class="ident" id="5815130">blockSize</span><span class="op" id="5815139">-</span><span class="num" id="5815140">1</span><span class="op" id="5815141">)</span><span class="op" id="5815142">,</span>&nbsp;<span class="builtintype" id="5815144">uint32</span><span class="op" id="5815150">(</span><span class="num" id="5815151">0</span><span class="op" id="5815152">)</span><span class="op" id="5815153">,</span>&nbsp;<span class="builtintype" id="5815155">uint32</span><span class="op" id="5815161">(</span><span class="num" id="5815162">0</span><span class="op" id="5815163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5815166">if</span>&nbsp;<span class="ident" id="5815169">d</span><span class="op" id="5815170">.</span><span class="ident" id="5815171">progressive</span>&nbsp;<span class="op" id="5815183">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815187">zigStart</span>&nbsp;<span class="op" id="5815196">=</span>&nbsp;<span class="builtintype" id="5815198">int32</span><span class="op" id="5815203">(</span><span class="ident" id="5815204">d</span><span class="op" id="5815205">.</span><span class="ident" id="5815206">tmp</span><span class="op" id="5815209">[</span><span class="num" id="5815210">1</span><span class="op" id="5815211">+</span><span class="num" id="5815212">2</span><span class="op" id="5815213">*</span><span class="ident" id="5815214">nComp</span><span class="op" id="5815219">]</span><span class="op" id="5815220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815224">zigEnd</span>&nbsp;<span class="op" id="5815231">=</span>&nbsp;<span class="builtintype" id="5815233">int32</span><span class="op" id="5815238">(</span><span class="ident" id="5815239">d</span><span class="op" id="5815240">.</span><span class="ident" id="5815241">tmp</span><span class="op" id="5815244">[</span><span class="num" id="5815245">2</span><span class="op" id="5815246">+</span><span class="num" id="5815247">2</span><span class="op" id="5815248">*</span><span class="ident" id="5815249">nComp</span><span class="op" id="5815254">]</span><span class="op" id="5815255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815259">ah</span>&nbsp;<span class="op" id="5815262">=</span>&nbsp;<span class="builtintype" id="5815264">uint32</span><span class="op" id="5815270">(</span><span class="ident" id="5815271">d</span><span class="op" id="5815272">.</span><span class="ident" id="5815273">tmp</span><span class="op" id="5815276">[</span><span class="num" id="5815277">3</span><span class="op" id="5815278">+</span><span class="num" id="5815279">2</span><span class="op" id="5815280">*</span><span class="ident" id="5815281">nComp</span><span class="op" id="5815286">]</span>&nbsp;<span class="op" id="5815288">&gt;&gt;</span>&nbsp;<span class="num" id="5815291">4</span><span class="op" id="5815292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815296">al</span>&nbsp;<span class="op" id="5815299">=</span>&nbsp;<span class="builtintype" id="5815301">uint32</span><span class="op" id="5815307">(</span><span class="ident" id="5815308">d</span><span class="op" id="5815309">.</span><span class="ident" id="5815310">tmp</span><span class="op" id="5815313">[</span><span class="num" id="5815314">3</span><span class="op" id="5815315">+</span><span class="num" id="5815316">2</span><span class="op" id="5815317">*</span><span class="ident" id="5815318">nComp</span><span class="op" id="5815323">]</span>&nbsp;<span class="op" id="5815325">&amp;</span>&nbsp;<span class="num" id="5815327">0x0f</span><span class="op" id="5815331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5815335">if</span>&nbsp;<span class="op" id="5815338">(</span><span class="ident" id="5815339">zigStart</span>&nbsp;<span class="op" id="5815348">==</span>&nbsp;<span class="num" id="5815351">0</span>&nbsp;<span class="op" id="5815353">&amp;&amp;</span>&nbsp;<span class="ident" id="5815356">zigEnd</span>&nbsp;<span class="op" id="5815363">!=</span>&nbsp;<span class="num" id="5815366">0</span><span class="op" id="5815367">)</span>&nbsp;<span class="op" id="5815369">||</span>&nbsp;<span class="ident" id="5815372">zigStart</span>&nbsp;<span class="op" id="5815381">&gt;</span>&nbsp;<span class="ident" id="5815383">zigEnd</span>&nbsp;<span class="op" id="5815390">||</span>&nbsp;<span class="ident" id="5815393">blockSize</span>&nbsp;<span class="op" id="5815403">&lt;=</span>&nbsp;<span class="ident" id="5815406">zigEnd</span>&nbsp;<span class="op" id="5815413">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5815418">return</span>&nbsp;<span class="ident" id="5815425">FormatError</span><span class="op" id="5815436">(</span><span class="string" id="5815437">&#34;bad&nbsp;spectral&nbsp;selection&nbsp;bounds&#34;</span><span class="op" id="5815468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5815472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5815476">if</span>&nbsp;<span class="ident" id="5815479">zigStart</span>&nbsp;<span class="op" id="5815488">!=</span>&nbsp;<span class="num" id="5815491">0</span>&nbsp;<span class="op" id="5815493">&amp;&amp;</span>&nbsp;<span class="ident" id="5815496">nComp</span>&nbsp;<span class="op" id="5815502">!=</span>&nbsp;<span class="num" id="5815505">1</span>&nbsp;<span class="op" id="5815507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5815512">return</span>&nbsp;<span class="ident" id="5815519">FormatError</span><span class="op" id="5815530">(</span><span class="string" id="5815531">&#34;progressive&nbsp;AC&nbsp;coefficients&nbsp;for&nbsp;more&nbsp;than&nbsp;one&nbsp;component&#34;</span><span class="op" id="5815588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5815592">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5815596">if</span>&nbsp;<span class="ident" id="5815599">ah</span>&nbsp;<span class="op" id="5815602">!=</span>&nbsp;<span class="num" id="5815605">0</span>&nbsp;<span class="op" id="5815607">&amp;&amp;</span>&nbsp;<span class="ident" id="5815610">ah</span>&nbsp;<span class="op" id="5815613">!=</span>&nbsp;<span class="ident" id="5815616">al</span><span class="op" id="5815618">+</span><span class="num" id="5815619">1</span>&nbsp;<span class="op" id="5815621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5815626">return</span>&nbsp;<span class="ident" id="5815633">FormatError</span><span class="op" id="5815644">(</span><span class="string" id="5815645">&#34;bad&nbsp;successive&nbsp;approximation&nbsp;values&#34;</span><span class="op" id="5815682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5815686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5815689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5815693">//&nbsp;mxx&nbsp;and&nbsp;myy&nbsp;are&nbsp;the&nbsp;number&nbsp;of&nbsp;MCUs&nbsp;(Minimum&nbsp;Coded&nbsp;Units)&nbsp;in&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815768">h0</span><span class="op" id="5815770">,</span>&nbsp;<span class="ident" id="5815772">v0</span>&nbsp;<span class="op" id="5815775">:=</span>&nbsp;<span class="ident" id="5815778">d</span><span class="op" id="5815779">.</span><span class="ident" id="5815780">comp</span><span class="op" id="5815784">[</span><span class="num" id="5815785">0</span><span class="op" id="5815786">]</span><span class="op" id="5815787">.</span><span class="ident" id="5815788">h</span><span class="op" id="5815789">,</span>&nbsp;<span class="ident" id="5815791">d</span><span class="op" id="5815792">.</span><span class="ident" id="5815793">comp</span><span class="op" id="5815797">[</span><span class="num" id="5815798">0</span><span class="op" id="5815799">]</span><span class="op" id="5815800">.</span><span class="ident" id="5815801">v</span>&nbsp;<span class="comment" id="5815803">//&nbsp;The&nbsp;h&nbsp;and&nbsp;v&nbsp;values&nbsp;from&nbsp;the&nbsp;Y&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815849">mxx</span>&nbsp;<span class="op" id="5815853">:=</span>&nbsp;<span class="op" id="5815856">(</span><span class="ident" id="5815857">d</span><span class="op" id="5815858">.</span><span class="ident" id="5815859">width</span>&nbsp;<span class="op" id="5815865">+</span>&nbsp;<span class="num" id="5815867">8</span><span class="op" id="5815868">*</span><span class="ident" id="5815869">h0</span>&nbsp;<span class="op" id="5815872">-</span>&nbsp;<span class="num" id="5815874">1</span><span class="op" id="5815875">)</span>&nbsp;<span class="op" id="5815877">/</span>&nbsp;<span class="op" id="5815879">(</span><span class="num" id="5815880">8</span>&nbsp;<span class="op" id="5815882">*</span>&nbsp;<span class="ident" id="5815884">h0</span><span class="op" id="5815886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815889">myy</span>&nbsp;<span class="op" id="5815893">:=</span>&nbsp;<span class="op" id="5815896">(</span><span class="ident" id="5815897">d</span><span class="op" id="5815898">.</span><span class="ident" id="5815899">height</span>&nbsp;<span class="op" id="5815906">+</span>&nbsp;<span class="num" id="5815908">8</span><span class="op" id="5815909">*</span><span class="ident" id="5815910">v0</span>&nbsp;<span class="op" id="5815913">-</span>&nbsp;<span class="num" id="5815915">1</span><span class="op" id="5815916">)</span>&nbsp;<span class="op" id="5815918">/</span>&nbsp;<span class="op" id="5815920">(</span><span class="num" id="5815921">8</span>&nbsp;<span class="op" id="5815923">*</span>&nbsp;<span class="ident" id="5815925">v0</span><span class="op" id="5815927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5815930">if</span>&nbsp;<span class="ident" id="5815933">d</span><span class="op" id="5815934">.</span><span class="ident" id="5815935">img1</span>&nbsp;<span class="op" id="5815940">==</span>&nbsp;<span class="ident" id="5815943">nil</span>&nbsp;<span class="op" id="5815947">&amp;&amp;</span>&nbsp;<span class="ident" id="5815950">d</span><span class="op" id="5815951">.</span><span class="ident" id="5815952">img3</span>&nbsp;<span class="op" id="5815957">==</span>&nbsp;<span class="ident" id="5815960">nil</span>&nbsp;<span class="op" id="5815964">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815968">d</span><span class="op" id="5815969">.</span><span class="ident" id="5815970">makeImg</span><span class="op" id="5815977">(</span><span class="ident" id="5815978">h0</span><span class="op" id="5815980">,</span>&nbsp;<span class="ident" id="5815982">v0</span><span class="op" id="5815984">,</span>&nbsp;<span class="ident" id="5815986">mxx</span><span class="op" id="5815989">,</span>&nbsp;<span class="ident" id="5815991">myy</span><span class="op" id="5815994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5815997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5816000">if</span>&nbsp;<span class="ident" id="5816003">d</span><span class="op" id="5816004">.</span><span class="ident" id="5816005">progressive</span>&nbsp;<span class="op" id="5816017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5816021">for</span>&nbsp;<span class="ident" id="5816025">i</span>&nbsp;<span class="op" id="5816027">:=</span>&nbsp;<span class="num" id="5816030">0</span><span class="op" id="5816031">;</span>&nbsp;<span class="ident" id="5816033">i</span>&nbsp;<span class="op" id="5816035">&lt;</span>&nbsp;<span class="ident" id="5816037">nComp</span><span class="op" id="5816042">;</span>&nbsp;<span class="ident" id="5816044">i</span><span class="op" id="5816045">++</span>&nbsp;<span class="op" id="5816048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816053">compIndex</span>&nbsp;<span class="op" id="5816063">:=</span>&nbsp;<span class="ident" id="5816066">scan</span><span class="op" id="5816070">[</span><span class="ident" id="5816071">i</span><span class="op" id="5816072">]</span><span class="op" id="5816073">.</span><span class="ident" id="5816074">compIndex</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5816087">if</span>&nbsp;<span class="ident" id="5816090">d</span><span class="op" id="5816091">.</span><span class="ident" id="5816092">progCoeffs</span><span class="op" id="5816102">[</span><span class="ident" id="5816103">compIndex</span><span class="op" id="5816112">]</span>&nbsp;<span class="op" id="5816114">==</span>&nbsp;<span class="ident" id="5816117">nil</span>&nbsp;<span class="op" id="5816121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816127">d</span><span class="op" id="5816128">.</span><span class="ident" id="5816129">progCoeffs</span><span class="op" id="5816139">[</span><span class="ident" id="5816140">compIndex</span><span class="op" id="5816149">]</span>&nbsp;<span class="op" id="5816151">=</span>&nbsp;<span class="builtinfunc" id="5816153">make</span><span class="op" id="5816157">(</span><span class="op" id="5816158">[</span><span class="op" id="5816159">]</span><span class="ident" id="5816160">block</span><span class="op" id="5816165">,</span>&nbsp;<span class="ident" id="5816167">mxx</span><span class="op" id="5816170">*</span><span class="ident" id="5816171">myy</span><span class="op" id="5816174">*</span><span class="ident" id="5816175">d</span><span class="op" id="5816176">.</span><span class="ident" id="5816177">comp</span><span class="op" id="5816181">[</span><span class="ident" id="5816182">compIndex</span><span class="op" id="5816191">]</span><span class="op" id="5816192">.</span><span class="ident" id="5816193">h</span><span class="op" id="5816194">*</span><span class="ident" id="5816195">d</span><span class="op" id="5816196">.</span><span class="ident" id="5816197">comp</span><span class="op" id="5816201">[</span><span class="ident" id="5816202">compIndex</span><span class="op" id="5816211">]</span><span class="op" id="5816212">.</span><span class="ident" id="5816213">v</span><span class="op" id="5816214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5816219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5816223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5816226">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816230">d</span><span class="op" id="5816231">.</span><span class="ident" id="5816232">bits</span>&nbsp;<span class="op" id="5816237">=</span>&nbsp;<span class="ident" id="5816239">bits</span><span class="op" id="5816243">{</span><span class="op" id="5816244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816247">mcu</span><span class="op" id="5816250">,</span>&nbsp;<span class="ident" id="5816252">expectedRST</span>&nbsp;<span class="op" id="5816264">:=</span>&nbsp;<span class="num" id="5816267">0</span><span class="op" id="5816268">,</span>&nbsp;<span class="builtintype" id="5816270">uint8</span><span class="op" id="5816275">(</span><span class="ident" id="5816276">rst0Marker</span><span class="op" id="5816286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5816289">var</span>&nbsp;<span class="op" id="5816293">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5816297">//&nbsp;b&nbsp;is&nbsp;the&nbsp;decoded&nbsp;coefficients,&nbsp;in&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816365">b</span>&nbsp;&nbsp;<span class="ident" id="5816368">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816376">dc</span>&nbsp;<span class="op" id="5816379">[</span><span class="ident" id="5816380">nColorComponent</span><span class="op" id="5816395">]</span><span class="builtintype" id="5816396">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5816404">//&nbsp;bx&nbsp;and&nbsp;by&nbsp;are&nbsp;the&nbsp;location&nbsp;of&nbsp;the&nbsp;current&nbsp;(in&nbsp;terms&nbsp;of&nbsp;8x8&nbsp;blocks).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5816477">//&nbsp;For&nbsp;example,&nbsp;with&nbsp;4:2:0&nbsp;chroma&nbsp;subsampling,&nbsp;the&nbsp;block&nbsp;whose&nbsp;top&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5816551">//&nbsp;pixel&nbsp;co-ordinates&nbsp;are&nbsp;(16,&nbsp;8)&nbsp;is&nbsp;the&nbsp;third&nbsp;block&nbsp;in&nbsp;the&nbsp;first&nbsp;row:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5816624">//&nbsp;bx&nbsp;is&nbsp;2&nbsp;and&nbsp;by&nbsp;is&nbsp;0,&nbsp;even&nbsp;though&nbsp;the&nbsp;pixel&nbsp;is&nbsp;in&nbsp;the&nbsp;second&nbsp;MCU.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816694">bx</span><span class="op" id="5816696">,</span>&nbsp;<span class="ident" id="5816698">by</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5816705">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816711">blockCount</span>&nbsp;<span class="builtintype" id="5816722">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5816727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5816730">for</span>&nbsp;<span class="ident" id="5816734">my</span>&nbsp;<span class="op" id="5816737">:=</span>&nbsp;<span class="num" id="5816740">0</span><span class="op" id="5816741">;</span>&nbsp;<span class="ident" id="5816743">my</span>&nbsp;<span class="op" id="5816746">&lt;</span>&nbsp;<span class="ident" id="5816748">myy</span><span class="op" id="5816751">;</span>&nbsp;<span class="ident" id="5816753">my</span><span class="op" id="5816755">++</span>&nbsp;<span class="op" id="5816758">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5816762">for</span>&nbsp;<span class="ident" id="5816766">mx</span>&nbsp;<span class="op" id="5816769">:=</span>&nbsp;<span class="num" id="5816772">0</span><span class="op" id="5816773">;</span>&nbsp;<span class="ident" id="5816775">mx</span>&nbsp;<span class="op" id="5816778">&lt;</span>&nbsp;<span class="ident" id="5816780">mxx</span><span class="op" id="5816783">;</span>&nbsp;<span class="ident" id="5816785">mx</span><span class="op" id="5816787">++</span>&nbsp;<span class="op" id="5816790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5816795">for</span>&nbsp;<span class="ident" id="5816799">i</span>&nbsp;<span class="op" id="5816801">:=</span>&nbsp;<span class="num" id="5816804">0</span><span class="op" id="5816805">;</span>&nbsp;<span class="ident" id="5816807">i</span>&nbsp;<span class="op" id="5816809">&lt;</span>&nbsp;<span class="ident" id="5816811">nComp</span><span class="op" id="5816816">;</span>&nbsp;<span class="ident" id="5816818">i</span><span class="op" id="5816819">++</span>&nbsp;<span class="op" id="5816822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816828">compIndex</span>&nbsp;<span class="op" id="5816838">:=</span>&nbsp;<span class="ident" id="5816841">scan</span><span class="op" id="5816845">[</span><span class="ident" id="5816846">i</span><span class="op" id="5816847">]</span><span class="op" id="5816848">.</span><span class="ident" id="5816849">compIndex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816863">qt</span>&nbsp;<span class="op" id="5816866">:=</span>&nbsp;<span class="op" id="5816869">&amp;</span><span class="ident" id="5816870">d</span><span class="op" id="5816871">.</span><span class="ident" id="5816872">quant</span><span class="op" id="5816877">[</span><span class="ident" id="5816878">d</span><span class="op" id="5816879">.</span><span class="ident" id="5816880">comp</span><span class="op" id="5816884">[</span><span class="ident" id="5816885">compIndex</span><span class="op" id="5816894">]</span><span class="op" id="5816895">.</span><span class="ident" id="5816896">tq</span><span class="op" id="5816898">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5816904">for</span>&nbsp;<span class="ident" id="5816908">j</span>&nbsp;<span class="op" id="5816910">:=</span>&nbsp;<span class="num" id="5816913">0</span><span class="op" id="5816914">;</span>&nbsp;<span class="ident" id="5816916">j</span>&nbsp;<span class="op" id="5816918">&lt;</span>&nbsp;<span class="ident" id="5816920">d</span><span class="op" id="5816921">.</span><span class="ident" id="5816922">comp</span><span class="op" id="5816926">[</span><span class="ident" id="5816927">compIndex</span><span class="op" id="5816936">]</span><span class="op" id="5816937">.</span><span class="ident" id="5816938">h</span><span class="op" id="5816939">*</span><span class="ident" id="5816940">d</span><span class="op" id="5816941">.</span><span class="ident" id="5816942">comp</span><span class="op" id="5816946">[</span><span class="ident" id="5816947">compIndex</span><span class="op" id="5816956">]</span><span class="op" id="5816957">.</span><span class="ident" id="5816958">v</span><span class="op" id="5816959">;</span>&nbsp;<span class="ident" id="5816961">j</span><span class="op" id="5816962">++</span>&nbsp;<span class="op" id="5816965">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5816972">//&nbsp;The&nbsp;blocks&nbsp;are&nbsp;traversed&nbsp;one&nbsp;MCU&nbsp;at&nbsp;a&nbsp;time.&nbsp;For&nbsp;4:2:0&nbsp;chroma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5817041">//&nbsp;subsampling,&nbsp;there&nbsp;are&nbsp;four&nbsp;Y&nbsp;8x8&nbsp;blocks&nbsp;in&nbsp;every&nbsp;16x16&nbsp;MCU.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5817110">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5817118">//&nbsp;For&nbsp;a&nbsp;baseline&nbsp;32x16&nbsp;pixel&nbsp;image,&nbsp;the&nbsp;Y&nbsp;blocks&nbsp;visiting&nbsp;order&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5817192">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;4&nbsp;5</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5817208">//&nbsp;&nbsp;&nbsp;&nbsp2&nbsp;3&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5817224">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5817232">//&nbsp;For&nbsp;progressive&nbsp;images,&nbsp;the&nbsp;interleaved&nbsp;scans&nbsp;(those&nbsp;with&nbsp;nComp&nbsp;&gt;&nbsp;1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5817309">//&nbsp;are&nbsp;traversed&nbsp;as&nbsp;above,&nbsp;but&nbsp;non-interleaved&nbsp;scans&nbsp;are&nbsp;traversed&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5817386">//&nbsp;to&nbsp;right,&nbsp;top&nbsp;to&nbsp;bottom:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5817419">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;2&nbsp;3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5817435">//&nbsp;&nbsp;&nbsp;&nbsp4&nbsp;5&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5817451">//&nbsp;Only&nbsp;DC&nbsp;scans&nbsp;(zigStart&nbsp;==&nbsp;0)&nbsp;can&nbsp;be&nbsp;interleaved.&nbsp;AC&nbsp;scans&nbsp;must&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5817528">//&nbsp;only&nbsp;one&nbsp;component.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5817556">//</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5817564">//&nbsp;To&nbsp;further&nbsp;complicate&nbsp;matters,&nbsp;for&nbsp;non-interleaved&nbsp;scans,&nbsp;there&nbsp;is&nbsp;no</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5817642">//&nbsp;data&nbsp;for&nbsp;any&nbsp;blocks&nbsp;that&nbsp;are&nbsp;inside&nbsp;the&nbsp;image&nbsp;at&nbsp;the&nbsp;MCU&nbsp;level&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5817717">//&nbsp;outside&nbsp;the&nbsp;image&nbsp;at&nbsp;the&nbsp;pixel&nbsp;level.&nbsp;For&nbsp;example,&nbsp;a&nbsp;24x16&nbsp;pixel&nbsp;4:2:0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5817796">//&nbsp;progressive&nbsp;image&nbsp;consists&nbsp;of&nbsp;two&nbsp;16x16&nbsp;MCUs.&nbsp;The&nbsp;interleaved&nbsp;scans</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5817872">//&nbsp;will&nbsp;process&nbsp;8&nbsp;Y&nbsp;blocks:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5817905">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;4&nbsp;5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5817921">//&nbsp;&nbsp;&nbsp;&nbsp2&nbsp;3&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5817937">//&nbsp;The&nbsp;non-interleaved&nbsp;scans&nbsp;will&nbsp;process&nbsp;only&nbsp;6&nbsp;Y&nbsp;blocks:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5818001">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5818015">//&nbsp;&nbsp;&nbsp;&nbsp3&nbsp;4&nbsp;5</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5818029">if</span>&nbsp;<span class="ident" id="5818032">nComp</span>&nbsp;<span class="op" id="5818038">!=</span>&nbsp;<span class="num" id="5818041">1</span>&nbsp;<span class="op" id="5818043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818051">bx</span><span class="op" id="5818053">,</span>&nbsp;<span class="ident" id="5818055">by</span>&nbsp;<span class="op" id="5818058">=</span>&nbsp;<span class="ident" id="5818060">d</span><span class="op" id="5818061">.</span><span class="ident" id="5818062">comp</span><span class="op" id="5818066">[</span><span class="ident" id="5818067">compIndex</span><span class="op" id="5818076">]</span><span class="op" id="5818077">.</span><span class="ident" id="5818078">h</span><span class="op" id="5818079">*</span><span class="ident" id="5818080">mx</span><span class="op" id="5818082">,</span>&nbsp;<span class="ident" id="5818084">d</span><span class="op" id="5818085">.</span><span class="ident" id="5818086">comp</span><span class="op" id="5818090">[</span><span class="ident" id="5818091">compIndex</span><span class="op" id="5818100">]</span><span class="op" id="5818101">.</span><span class="ident" id="5818102">v</span><span class="op" id="5818103">*</span><span class="ident" id="5818104">my</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5818113">if</span>&nbsp;<span class="ident" id="5818116">h0</span>&nbsp;<span class="op" id="5818119">==</span>&nbsp;<span class="num" id="5818122">1</span>&nbsp;<span class="op" id="5818124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818133">by</span>&nbsp;<span class="op" id="5818136">+=</span>&nbsp;<span class="ident" id="5818139">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5818147">}</span>&nbsp;<span class="keyword" id="5818149">else</span>&nbsp;<span class="op" id="5818154">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818163">bx</span>&nbsp;<span class="op" id="5818166">+=</span>&nbsp;<span class="ident" id="5818169">j</span>&nbsp;<span class="op" id="5818171">%</span>&nbsp;<span class="num" id="5818173">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818182">by</span>&nbsp;<span class="op" id="5818185">+=</span>&nbsp;<span class="ident" id="5818188">j</span>&nbsp;<span class="op" id="5818190">/</span>&nbsp;<span class="num" id="5818192">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5818200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5818207">}</span>&nbsp;<span class="keyword" id="5818209">else</span>&nbsp;<span class="op" id="5818214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818222">q</span>&nbsp;<span class="op" id="5818224">:=</span>&nbsp;<span class="ident" id="5818227">mxx</span>&nbsp;<span class="op" id="5818231">*</span>&nbsp;<span class="ident" id="5818233">d</span><span class="op" id="5818234">.</span><span class="ident" id="5818235">comp</span><span class="op" id="5818239">[</span><span class="ident" id="5818240">compIndex</span><span class="op" id="5818249">]</span><span class="op" id="5818250">.</span><span class="ident" id="5818251">h</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818259">bx</span>&nbsp;<span class="op" id="5818262">=</span>&nbsp;<span class="ident" id="5818264">blockCount</span>&nbsp;<span class="op" id="5818275">%</span>&nbsp;<span class="ident" id="5818277">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818285">by</span>&nbsp;<span class="op" id="5818288">=</span>&nbsp;<span class="ident" id="5818290">blockCount</span>&nbsp;<span class="op" id="5818301">/</span>&nbsp;<span class="ident" id="5818303">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818311">blockCount</span><span class="op" id="5818321">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5818330">if</span>&nbsp;<span class="ident" id="5818333">bx</span><span class="op" id="5818335">*</span><span class="num" id="5818336">8</span>&nbsp;<span class="op" id="5818338">&gt;=</span>&nbsp;<span class="ident" id="5818341">d</span><span class="op" id="5818342">.</span><span class="ident" id="5818343">width</span>&nbsp;<span class="op" id="5818349">||</span>&nbsp;<span class="ident" id="5818352">by</span><span class="op" id="5818354">*</span><span class="num" id="5818355">8</span>&nbsp;<span class="op" id="5818357">&gt;=</span>&nbsp;<span class="ident" id="5818360">d</span><span class="op" id="5818361">.</span><span class="ident" id="5818362">height</span>&nbsp;<span class="op" id="5818369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5818378">continue</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5818393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5818400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5818408">//&nbsp;Load&nbsp;the&nbsp;previous&nbsp;partially&nbsp;decoded&nbsp;coefficients,&nbsp;if&nbsp;applicable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5818481">if</span>&nbsp;<span class="ident" id="5818484">d</span><span class="op" id="5818485">.</span><span class="ident" id="5818486">progressive</span>&nbsp;<span class="op" id="5818498">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818506">b</span>&nbsp;<span class="op" id="5818508">=</span>&nbsp;<span class="ident" id="5818510">d</span><span class="op" id="5818511">.</span><span class="ident" id="5818512">progCoeffs</span><span class="op" id="5818522">[</span><span class="ident" id="5818523">compIndex</span><span class="op" id="5818532">]</span><span class="op" id="5818533">[</span><span class="ident" id="5818534">by</span><span class="op" id="5818536">*</span><span class="ident" id="5818537">mxx</span><span class="op" id="5818540">*</span><span class="ident" id="5818541">d</span><span class="op" id="5818542">.</span><span class="ident" id="5818543">comp</span><span class="op" id="5818547">[</span><span class="ident" id="5818548">compIndex</span><span class="op" id="5818557">]</span><span class="op" id="5818558">.</span><span class="ident" id="5818559">h</span><span class="op" id="5818560">+</span><span class="ident" id="5818561">bx</span><span class="op" id="5818563">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5818570">}</span>&nbsp;<span class="keyword" id="5818572">else</span>&nbsp;<span class="op" id="5818577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818585">b</span>&nbsp;<span class="op" id="5818587">=</span>&nbsp;<span class="ident" id="5818589">block</span><span class="op" id="5818594">{</span><span class="op" id="5818595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5818602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5818610">if</span>&nbsp;<span class="ident" id="5818613">ah</span>&nbsp;<span class="op" id="5818616">!=</span>&nbsp;<span class="num" id="5818619">0</span>&nbsp;<span class="op" id="5818621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5818629">if</span>&nbsp;<span class="ident" id="5818632">err</span>&nbsp;<span class="op" id="5818636">:=</span>&nbsp;<span class="ident" id="5818639">d</span><span class="op" id="5818640">.</span><span class="ident" id="5818641">refine</span><span class="op" id="5818647">(</span><span class="op" id="5818648">&amp;</span><span class="ident" id="5818649">b</span><span class="op" id="5818650">,</span>&nbsp;<span class="op" id="5818652">&amp;</span><span class="ident" id="5818653">d</span><span class="op" id="5818654">.</span><span class="ident" id="5818655">huff</span><span class="op" id="5818659">[</span><span class="ident" id="5818660">acTable</span><span class="op" id="5818667">]</span><span class="op" id="5818668">[</span><span class="ident" id="5818669">scan</span><span class="op" id="5818673">[</span><span class="ident" id="5818674">i</span><span class="op" id="5818675">]</span><span class="op" id="5818676">.</span><span class="ident" id="5818677">ta</span><span class="op" id="5818679">]</span><span class="op" id="5818680">,</span>&nbsp;<span class="ident" id="5818682">zigStart</span><span class="op" id="5818690">,</span>&nbsp;<span class="ident" id="5818692">zigEnd</span><span class="op" id="5818698">,</span>&nbsp;<span class="num" id="5818700">1</span><span class="op" id="5818701">&lt;&lt;</span><span class="ident" id="5818703">al</span><span class="op" id="5818705">)</span><span class="op" id="5818706">;</span>&nbsp;<span class="ident" id="5818708">err</span>&nbsp;<span class="op" id="5818712">!=</span>&nbsp;<span class="ident" id="5818715">nil</span>&nbsp;<span class="op" id="5818719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5818728">return</span>&nbsp;<span class="ident" id="5818735">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5818745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5818752">}</span>&nbsp;<span class="keyword" id="5818754">else</span>&nbsp;<span class="op" id="5818759">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818767">zig</span>&nbsp;<span class="op" id="5818771">:=</span>&nbsp;<span class="ident" id="5818774">zigStart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5818789">if</span>&nbsp;<span class="ident" id="5818792">zig</span>&nbsp;<span class="op" id="5818796">==</span>&nbsp;<span class="num" id="5818799">0</span>&nbsp;<span class="op" id="5818801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818810">zig</span><span class="op" id="5818813">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5818823">//&nbsp;Decode&nbsp;the&nbsp;DC&nbsp;coefficient,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;F.2.2.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818893">value</span><span class="op" id="5818898">,</span>&nbsp;<span class="ident" id="5818900">err</span>&nbsp;<span class="op" id="5818904">:=</span>&nbsp;<span class="ident" id="5818907">d</span><span class="op" id="5818908">.</span><span class="ident" id="5818909">decodeHuffman</span><span class="op" id="5818922">(</span><span class="op" id="5818923">&amp;</span><span class="ident" id="5818924">d</span><span class="op" id="5818925">.</span><span class="ident" id="5818926">huff</span><span class="op" id="5818930">[</span><span class="ident" id="5818931">dcTable</span><span class="op" id="5818938">]</span><span class="op" id="5818939">[</span><span class="ident" id="5818940">scan</span><span class="op" id="5818944">[</span><span class="ident" id="5818945">i</span><span class="op" id="5818946">]</span><span class="op" id="5818947">.</span><span class="ident" id="5818948">td</span><span class="op" id="5818950">]</span><span class="op" id="5818951">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5818960">if</span>&nbsp;<span class="ident" id="5818963">err</span>&nbsp;<span class="op" id="5818967">!=</span>&nbsp;<span class="ident" id="5818970">nil</span>&nbsp;<span class="op" id="5818974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5818984">return</span>&nbsp;<span class="ident" id="5818991">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5819002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5819011">if</span>&nbsp;<span class="ident" id="5819014">value</span>&nbsp;<span class="op" id="5819020">&gt;</span>&nbsp;<span class="num" id="5819022">16</span>&nbsp;<span class="op" id="5819025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5819035">return</span>&nbsp;<span class="ident" id="5819042">UnsupportedError</span><span class="op" id="5819058">(</span><span class="string" id="5819059">&#34;excessive&nbsp;DC&nbsp;component&#34;</span><span class="op" id="5819083">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5819092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5819101">dcDelta</span><span class="op" id="5819108">,</span>&nbsp;<span class="ident" id="5819110">err</span>&nbsp;<span class="op" id="5819114">:=</span>&nbsp;<span class="ident" id="5819117">d</span><span class="op" id="5819118">.</span><span class="ident" id="5819119">receiveExtend</span><span class="op" id="5819132">(</span><span class="ident" id="5819133">value</span><span class="op" id="5819138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5819147">if</span>&nbsp;<span class="ident" id="5819150">err</span>&nbsp;<span class="op" id="5819154">!=</span>&nbsp;<span class="ident" id="5819157">nil</span>&nbsp;<span class="op" id="5819161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5819171">return</span>&nbsp;<span class="ident" id="5819178">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5819189">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5819198">dc</span><span class="op" id="5819200">[</span><span class="ident" id="5819201">compIndex</span><span class="op" id="5819210">]</span>&nbsp;<span class="op" id="5819212">+=</span>&nbsp;<span class="ident" id="5819215">dcDelta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5819230">b</span><span class="op" id="5819231">[</span><span class="num" id="5819232">0</span><span class="op" id="5819233">]</span>&nbsp;<span class="op" id="5819235">=</span>&nbsp;<span class="ident" id="5819237">dc</span><span class="op" id="5819239">[</span><span class="ident" id="5819240">compIndex</span><span class="op" id="5819249">]</span>&nbsp;<span class="op" id="5819251">&lt;&lt;</span>&nbsp;<span class="ident" id="5819254">al</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5819263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5819272">if</span>&nbsp;<span class="ident" id="5819275">zig</span>&nbsp;<span class="op" id="5819279">&lt;=</span>&nbsp;<span class="ident" id="5819282">zigEnd</span>&nbsp;<span class="op" id="5819289">&amp;&amp;</span>&nbsp;<span class="ident" id="5819292">d</span><span class="op" id="5819293">.</span><span class="ident" id="5819294">eobRun</span>&nbsp;<span class="op" id="5819301">&gt;</span>&nbsp;<span class="num" id="5819303">0</span>&nbsp;<span class="op" id="5819305">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5819314">d</span><span class="op" id="5819315">.</span><span class="ident" id="5819316">eobRun</span><span class="op" id="5819322">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5819331">}</span>&nbsp;<span class="keyword" id="5819333">else</span>&nbsp;<span class="op" id="5819338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5819347">//&nbsp;Decode&nbsp;the&nbsp;AC&nbsp;coefficients,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;F.2.2.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5819418">huff</span>&nbsp;<span class="op" id="5819423">:=</span>&nbsp;<span class="op" id="5819426">&amp;</span><span class="ident" id="5819427">d</span><span class="op" id="5819428">.</span><span class="ident" id="5819429">huff</span><span class="op" id="5819433">[</span><span class="ident" id="5819434">acTable</span><span class="op" id="5819441">]</span><span class="op" id="5819442">[</span><span class="ident" id="5819443">scan</span><span class="op" id="5819447">[</span><span class="ident" id="5819448">i</span><span class="op" id="5819449">]</span><span class="op" id="5819450">.</span><span class="ident" id="5819451">ta</span><span class="op" id="5819453">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5819462">for</span>&nbsp;<span class="op" id="5819466">;</span>&nbsp;<span class="ident" id="5819468">zig</span>&nbsp;<span class="op" id="5819472">&lt;=</span>&nbsp;<span class="ident" id="5819475">zigEnd</span><span class="op" id="5819481">;</span>&nbsp;<span class="ident" id="5819483">zig</span><span class="op" id="5819486">++</span>&nbsp;<span class="op" id="5819489">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5819499">value</span><span class="op" id="5819504">,</span>&nbsp;<span class="ident" id="5819506">err</span>&nbsp;<span class="op" id="5819510">:=</span>&nbsp;<span class="ident" id="5819513">d</span><span class="op" id="5819514">.</span><span class="ident" id="5819515">decodeHuffman</span><span class="op" id="5819528">(</span><span class="ident" id="5819529">huff</span><span class="op" id="5819533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5819543">if</span>&nbsp;<span class="ident" id="5819546">err</span>&nbsp;<span class="op" id="5819550">!=</span>&nbsp;<span class="ident" id="5819553">nil</span>&nbsp;<span class="op" id="5819557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5819568">return</span>&nbsp;<span class="ident" id="5819575">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5819587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5819597">val0</span>&nbsp;<span class="op" id="5819602">:=</span>&nbsp;<span class="ident" id="5819605">value</span>&nbsp;<span class="op" id="5819611">&gt;&gt;</span>&nbsp;<span class="num" id="5819614">4</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5819624">val1</span>&nbsp;<span class="op" id="5819629">:=</span>&nbsp;<span class="ident" id="5819632">value</span>&nbsp;<span class="op" id="5819638">&amp;</span>&nbsp;<span class="num" id="5819640">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5819653">if</span>&nbsp;<span class="ident" id="5819656">val1</span>&nbsp;<span class="op" id="5819661">!=</span>&nbsp;<span class="num" id="5819664">0</span>&nbsp;<span class="op" id="5819666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5819677">zig</span>&nbsp;<span class="op" id="5819681">+=</span>&nbsp;<span class="builtintype" id="5819684">int32</span><span class="op" id="5819689">(</span><span class="ident" id="5819690">val0</span><span class="op" id="5819694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5819705">if</span>&nbsp;<span class="ident" id="5819708">zig</span>&nbsp;<span class="op" id="5819712">&gt;</span>&nbsp;<span class="ident" id="5819714">zigEnd</span>&nbsp;<span class="op" id="5819721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5819733">break</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5819748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5819759">ac</span><span class="op" id="5819761">,</span>&nbsp;<span class="ident" id="5819763">err</span>&nbsp;<span class="op" id="5819767">:=</span>&nbsp;<span class="ident" id="5819770">d</span><span class="op" id="5819771">.</span><span class="ident" id="5819772">receiveExtend</span><span class="op" id="5819785">(</span><span class="ident" id="5819786">val1</span><span class="op" id="5819790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5819801">if</span>&nbsp;<span class="ident" id="5819804">err</span>&nbsp;<span class="op" id="5819808">!=</span>&nbsp;<span class="ident" id="5819811">nil</span>&nbsp;<span class="op" id="5819815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5819827">return</span>&nbsp;<span class="ident" id="5819834">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5819847">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5819858">b</span><span class="op" id="5819859">[</span><span class="ident" id="5819860">unzig</span><span class="op" id="5819865">[</span><span class="ident" id="5819866">zig</span><span class="op" id="5819869">]</span><span class="op" id="5819870">]</span>&nbsp;<span class="op" id="5819872">=</span>&nbsp;<span class="ident" id="5819874">ac</span>&nbsp;<span class="op" id="5819877">&lt;&lt;</span>&nbsp;<span class="ident" id="5819880">al</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5819891">}</span>&nbsp;<span class="keyword" id="5819893">else</span>&nbsp;<span class="op" id="5819898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5819909">if</span>&nbsp;<span class="ident" id="5819912">val0</span>&nbsp;<span class="op" id="5819917">!=</span>&nbsp;<span class="num" id="5819920">0x0f</span>&nbsp;<span class="op" id="5819925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5819937">d</span><span class="op" id="5819938">.</span><span class="ident" id="5819939">eobRun</span>&nbsp;<span class="op" id="5819946">=</span>&nbsp;<span class="builtintype" id="5819948">uint16</span><span class="op" id="5819954">(</span><span class="num" id="5819955">1</span>&nbsp;<span class="op" id="5819957">&lt;&lt;</span>&nbsp;<span class="ident" id="5819960">val0</span><span class="op" id="5819964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5819976">if</span>&nbsp;<span class="ident" id="5819979">val0</span>&nbsp;<span class="op" id="5819984">!=</span>&nbsp;<span class="num" id="5819987">0</span>&nbsp;<span class="op" id="5819989">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5820002">bits</span><span class="op" id="5820006">,</span>&nbsp;<span class="ident" id="5820008">err</span>&nbsp;<span class="op" id="5820012">:=</span>&nbsp;<span class="ident" id="5820015">d</span><span class="op" id="5820016">.</span><span class="ident" id="5820017">decodeBits</span><span class="op" id="5820027">(</span><span class="builtintype" id="5820028">int32</span><span class="op" id="5820033">(</span><span class="ident" id="5820034">val0</span><span class="op" id="5820038">)</span><span class="op" id="5820039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5820052">if</span>&nbsp;<span class="ident" id="5820055">err</span>&nbsp;<span class="op" id="5820059">!=</span>&nbsp;<span class="ident" id="5820062">nil</span>&nbsp;<span class="op" id="5820066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5820080">return</span>&nbsp;<span class="ident" id="5820087">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5820102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5820115">d</span><span class="op" id="5820116">.</span><span class="ident" id="5820117">eobRun</span>&nbsp;<span class="op" id="5820124">|=</span>&nbsp;<span class="builtintype" id="5820127">uint16</span><span class="op" id="5820133">(</span><span class="ident" id="5820134">bits</span><span class="op" id="5820138">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5820150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5820162">d</span><span class="op" id="5820163">.</span><span class="ident" id="5820164">eobRun</span><span class="op" id="5820170">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5820183">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5820198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5820209">zig</span>&nbsp;<span class="op" id="5820213">+=</span>&nbsp;<span class="num" id="5820216">0x0f</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5820229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5820238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5820246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5820253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5820261">if</span>&nbsp;<span class="ident" id="5820264">d</span><span class="op" id="5820265">.</span><span class="ident" id="5820266">progressive</span>&nbsp;<span class="op" id="5820278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5820286">if</span>&nbsp;<span class="ident" id="5820289">zigEnd</span>&nbsp;<span class="op" id="5820296">!=</span>&nbsp;<span class="ident" id="5820299">blockSize</span><span class="op" id="5820308">-</span><span class="num" id="5820309">1</span>&nbsp;<span class="op" id="5820311">||</span>&nbsp;<span class="ident" id="5820314">al</span>&nbsp;<span class="op" id="5820317">!=</span>&nbsp;<span class="num" id="5820320">0</span>&nbsp;<span class="op" id="5820322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5820331">//&nbsp;We&nbsp;haven&#39;t&nbsp;completely&nbsp;decoded&nbsp;this&nbsp;8x8&nbsp;block.&nbsp;Save&nbsp;the&nbsp;coefficients.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5820410">d</span><span class="op" id="5820411">.</span><span class="ident" id="5820412">progCoeffs</span><span class="op" id="5820422">[</span><span class="ident" id="5820423">compIndex</span><span class="op" id="5820432">]</span><span class="op" id="5820433">[</span><span class="ident" id="5820434">by</span><span class="op" id="5820436">*</span><span class="ident" id="5820437">mxx</span><span class="op" id="5820440">*</span><span class="ident" id="5820441">d</span><span class="op" id="5820442">.</span><span class="ident" id="5820443">comp</span><span class="op" id="5820447">[</span><span class="ident" id="5820448">compIndex</span><span class="op" id="5820457">]</span><span class="op" id="5820458">.</span><span class="ident" id="5820459">h</span><span class="op" id="5820460">+</span><span class="ident" id="5820461">bx</span><span class="op" id="5820463">]</span>&nbsp;<span class="op" id="5820465">=</span>&nbsp;<span class="ident" id="5820467">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5820476">//&nbsp;At&nbsp;this&nbsp;point,&nbsp;we&nbsp;could&nbsp;execute&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;loop&nbsp;body&nbsp;to&nbsp;dequantize&nbsp;and</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5820562">//&nbsp;perform&nbsp;the&nbsp;inverse&nbsp;DCT,&nbsp;to&nbsp;save&nbsp;early&nbsp;stages&nbsp;of&nbsp;a&nbsp;progressive&nbsp;image&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5820648">//&nbsp;*image.YCbCr&nbsp;buffers&nbsp;(the&nbsp;whole&nbsp;point&nbsp;of&nbsp;progressive&nbsp;encoding),&nbsp;but&nbsp;in&nbsp;Go,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5820733">//&nbsp;the&nbsp;jpeg.Decode&nbsp;function&nbsp;does&nbsp;not&nbsp;return&nbsp;until&nbsp;the&nbsp;entire&nbsp;image&nbsp;is&nbsp;decoded,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5820819">//&nbsp;so&nbsp;we&nbsp;&#34;continue&#34;&nbsp;here&nbsp;to&nbsp;avoid&nbsp;wasted&nbsp;computation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5820880">continue</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5820895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5820902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5820910">//&nbsp;Dequantize,&nbsp;perform&nbsp;the&nbsp;inverse&nbsp;DCT&nbsp;and&nbsp;store&nbsp;the&nbsp;block&nbsp;to&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5820988">for</span>&nbsp;<span class="ident" id="5820992">zig</span>&nbsp;<span class="op" id="5820996">:=</span>&nbsp;<span class="num" id="5820999">0</span><span class="op" id="5821000">;</span>&nbsp;<span class="ident" id="5821002">zig</span>&nbsp;<span class="op" id="5821006">&lt;</span>&nbsp;<span class="ident" id="5821008">blockSize</span><span class="op" id="5821017">;</span>&nbsp;<span class="ident" id="5821019">zig</span><span class="op" id="5821022">++</span>&nbsp;<span class="op" id="5821025">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5821033">b</span><span class="op" id="5821034">[</span><span class="ident" id="5821035">unzig</span><span class="op" id="5821040">[</span><span class="ident" id="5821041">zig</span><span class="op" id="5821044">]</span><span class="op" id="5821045">]</span>&nbsp;<span class="op" id="5821047">*=</span>&nbsp;<span class="ident" id="5821050">qt</span><span class="op" id="5821052">[</span><span class="ident" id="5821053">zig</span><span class="op" id="5821056">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5821063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5821070">idct</span><span class="op" id="5821074">(</span><span class="op" id="5821075">&amp;</span><span class="ident" id="5821076">b</span><span class="op" id="5821077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5821084">dst</span><span class="op" id="5821087">,</span>&nbsp;<span class="ident" id="5821089">stride</span>&nbsp;<span class="op" id="5821096">:=</span>&nbsp;<span class="op" id="5821099">[</span><span class="op" id="5821100">]</span><span class="builtintype" id="5821101">byte</span><span class="op" id="5821105">(</span><span class="ident" id="5821106">nil</span><span class="op" id="5821109">)</span><span class="op" id="5821110">,</span>&nbsp;<span class="num" id="5821112">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5821119">if</span>&nbsp;<span class="ident" id="5821122">d</span><span class="op" id="5821123">.</span><span class="ident" id="5821124">nComp</span>&nbsp;<span class="op" id="5821130">==</span>&nbsp;<span class="ident" id="5821133">nGrayComponent</span>&nbsp;<span class="op" id="5821148">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5821156">dst</span><span class="op" id="5821159">,</span>&nbsp;<span class="ident" id="5821161">stride</span>&nbsp;<span class="op" id="5821168">=</span>&nbsp;<span class="ident" id="5821170">d</span><span class="op" id="5821171">.</span><span class="ident" id="5821172">img1</span><span class="op" id="5821176">.</span><span class="ident" id="5821177">Pix</span><span class="op" id="5821180">[</span><span class="num" id="5821181">8</span><span class="op" id="5821182">*</span><span class="op" id="5821183">(</span><span class="ident" id="5821184">by</span><span class="op" id="5821186">*</span><span class="ident" id="5821187">d</span><span class="op" id="5821188">.</span><span class="ident" id="5821189">img1</span><span class="op" id="5821193">.</span><span class="ident" id="5821194">Stride</span><span class="op" id="5821200">+</span><span class="ident" id="5821201">bx</span><span class="op" id="5821203">)</span><span class="op" id="5821204">:</span><span class="op" id="5821205">]</span><span class="op" id="5821206">,</span>&nbsp;<span class="ident" id="5821208">d</span><span class="op" id="5821209">.</span><span class="ident" id="5821210">img1</span><span class="op" id="5821214">.</span><span class="ident" id="5821215">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5821227">}</span>&nbsp;<span class="keyword" id="5821229">else</span>&nbsp;<span class="op" id="5821234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5821242">switch</span>&nbsp;<span class="ident" id="5821249">compIndex</span>&nbsp;<span class="op" id="5821259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5821267">case</span>&nbsp;<span class="num" id="5821272">0</span><span class="op" id="5821273">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5821282">dst</span><span class="op" id="5821285">,</span>&nbsp;<span class="ident" id="5821287">stride</span>&nbsp;<span class="op" id="5821294">=</span>&nbsp;<span class="ident" id="5821296">d</span><span class="op" id="5821297">.</span><span class="ident" id="5821298">img3</span><span class="op" id="5821302">.</span><span class="ident" id="5821303">Y</span><span class="op" id="5821304">[</span><span class="num" id="5821305">8</span><span class="op" id="5821306">*</span><span class="op" id="5821307">(</span><span class="ident" id="5821308">by</span><span class="op" id="5821310">*</span><span class="ident" id="5821311">d</span><span class="op" id="5821312">.</span><span class="ident" id="5821313">img3</span><span class="op" id="5821317">.</span><span class="ident" id="5821318">YStride</span><span class="op" id="5821325">+</span><span class="ident" id="5821326">bx</span><span class="op" id="5821328">)</span><span class="op" id="5821329">:</span><span class="op" id="5821330">]</span><span class="op" id="5821331">,</span>&nbsp;<span class="ident" id="5821333">d</span><span class="op" id="5821334">.</span><span class="ident" id="5821335">img3</span><span class="op" id="5821339">.</span><span class="ident" id="5821340">YStride</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5821354">case</span>&nbsp;<span class="num" id="5821359">1</span><span class="op" id="5821360">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5821369">dst</span><span class="op" id="5821372">,</span>&nbsp;<span class="ident" id="5821374">stride</span>&nbsp;<span class="op" id="5821381">=</span>&nbsp;<span class="ident" id="5821383">d</span><span class="op" id="5821384">.</span><span class="ident" id="5821385">img3</span><span class="op" id="5821389">.</span><span class="ident" id="5821390">Cb</span><span class="op" id="5821392">[</span><span class="num" id="5821393">8</span><span class="op" id="5821394">*</span><span class="op" id="5821395">(</span><span class="ident" id="5821396">by</span><span class="op" id="5821398">*</span><span class="ident" id="5821399">d</span><span class="op" id="5821400">.</span><span class="ident" id="5821401">img3</span><span class="op" id="5821405">.</span><span class="ident" id="5821406">CStride</span><span class="op" id="5821413">+</span><span class="ident" id="5821414">bx</span><span class="op" id="5821416">)</span><span class="op" id="5821417">:</span><span class="op" id="5821418">]</span><span class="op" id="5821419">,</span>&nbsp;<span class="ident" id="5821421">d</span><span class="op" id="5821422">.</span><span class="ident" id="5821423">img3</span><span class="op" id="5821427">.</span><span class="ident" id="5821428">CStride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5821442">case</span>&nbsp;<span class="num" id="5821447">2</span><span class="op" id="5821448">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5821457">dst</span><span class="op" id="5821460">,</span>&nbsp;<span class="ident" id="5821462">stride</span>&nbsp;<span class="op" id="5821469">=</span>&nbsp;<span class="ident" id="5821471">d</span><span class="op" id="5821472">.</span><span class="ident" id="5821473">img3</span><span class="op" id="5821477">.</span><span class="ident" id="5821478">Cr</span><span class="op" id="5821480">[</span><span class="num" id="5821481">8</span><span class="op" id="5821482">*</span><span class="op" id="5821483">(</span><span class="ident" id="5821484">by</span><span class="op" id="5821486">*</span><span class="ident" id="5821487">d</span><span class="op" id="5821488">.</span><span class="ident" id="5821489">img3</span><span class="op" id="5821493">.</span><span class="ident" id="5821494">CStride</span><span class="op" id="5821501">+</span><span class="ident" id="5821502">bx</span><span class="op" id="5821504">)</span><span class="op" id="5821505">:</span><span class="op" id="5821506">]</span><span class="op" id="5821507">,</span>&nbsp;<span class="ident" id="5821509">d</span><span class="op" id="5821510">.</span><span class="ident" id="5821511">img3</span><span class="op" id="5821515">.</span><span class="ident" id="5821516">CStride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5821530">default</span><span class="op" id="5821537">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5821546">return</span>&nbsp;<span class="ident" id="5821553">UnsupportedError</span><span class="op" id="5821569">(</span><span class="string" id="5821570">&#34;too&nbsp;many&nbsp;components&#34;</span><span class="op" id="5821591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5821599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5821606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5821613">//&nbsp;Level&nbsp;shift&nbsp;by&nbsp;+128,&nbsp;clip&nbsp;to&nbsp;[0,&nbsp;255],&nbsp;and&nbsp;write&nbsp;to&nbsp;dst.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5821678">for</span>&nbsp;<span class="ident" id="5821682">y</span>&nbsp;<span class="op" id="5821684">:=</span>&nbsp;<span class="num" id="5821687">0</span><span class="op" id="5821688">;</span>&nbsp;<span class="ident" id="5821690">y</span>&nbsp;<span class="op" id="5821692">&lt;</span>&nbsp;<span class="num" id="5821694">8</span><span class="op" id="5821695">;</span>&nbsp;<span class="ident" id="5821697">y</span><span class="op" id="5821698">++</span>&nbsp;<span class="op" id="5821701">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5821709">y8</span>&nbsp;<span class="op" id="5821712">:=</span>&nbsp;<span class="ident" id="5821715">y</span>&nbsp;<span class="op" id="5821717">*</span>&nbsp;<span class="num" id="5821719">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5821727">yStride</span>&nbsp;<span class="op" id="5821735">:=</span>&nbsp;<span class="ident" id="5821738">y</span>&nbsp;<span class="op" id="5821740">*</span>&nbsp;<span class="ident" id="5821742">stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5821755">for</span>&nbsp;<span class="ident" id="5821759">x</span>&nbsp;<span class="op" id="5821761">:=</span>&nbsp;<span class="num" id="5821764">0</span><span class="op" id="5821765">;</span>&nbsp;<span class="ident" id="5821767">x</span>&nbsp;<span class="op" id="5821769">&lt;</span>&nbsp;<span class="num" id="5821771">8</span><span class="op" id="5821772">;</span>&nbsp;<span class="ident" id="5821774">x</span><span class="op" id="5821775">++</span>&nbsp;<span class="op" id="5821778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5821787">c</span>&nbsp;<span class="op" id="5821789">:=</span>&nbsp;<span class="ident" id="5821792">b</span><span class="op" id="5821793">[</span><span class="ident" id="5821794">y8</span><span class="op" id="5821796">+</span><span class="ident" id="5821797">x</span><span class="op" id="5821798">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5821807">if</span>&nbsp;<span class="ident" id="5821810">c</span>&nbsp;<span class="op" id="5821812">&lt;</span>&nbsp;<span class="op" id="5821814">-</span><span class="num" id="5821815">128</span>&nbsp;<span class="op" id="5821819">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5821829">c</span>&nbsp;<span class="op" id="5821831">=</span>&nbsp;<span class="num" id="5821833">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5821842">}</span>&nbsp;<span class="keyword" id="5821844">else</span>&nbsp;<span class="keyword" id="5821849">if</span>&nbsp;<span class="ident" id="5821852">c</span>&nbsp;<span class="op" id="5821854">&gt;</span>&nbsp;<span class="num" id="5821856">127</span>&nbsp;<span class="op" id="5821860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5821870">c</span>&nbsp;<span class="op" id="5821872">=</span>&nbsp;<span class="num" id="5821874">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5821885">}</span>&nbsp;<span class="keyword" id="5821887">else</span>&nbsp;<span class="op" id="5821892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5821902">c</span>&nbsp;<span class="op" id="5821904">+=</span>&nbsp;<span class="num" id="5821907">128</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5821918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5821927">dst</span><span class="op" id="5821930">[</span><span class="ident" id="5821931">yStride</span><span class="op" id="5821938">+</span><span class="ident" id="5821939">x</span><span class="op" id="5821940">]</span>&nbsp;<span class="op" id="5821942">=</span>&nbsp;<span class="builtintype" id="5821944">uint8</span><span class="op" id="5821949">(</span><span class="ident" id="5821950">c</span><span class="op" id="5821951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5821959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5821966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5821972">}</span>&nbsp;<span class="comment" id="5821974">//&nbsp;for&nbsp;j</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5821986">}</span>&nbsp;<span class="comment" id="5821988">//&nbsp;for&nbsp;i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5822000">mcu</span><span class="op" id="5822003">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5822009">if</span>&nbsp;<span class="ident" id="5822012">d</span><span class="op" id="5822013">.</span><span class="ident" id="5822014">ri</span>&nbsp;<span class="op" id="5822017">&gt;</span>&nbsp;<span class="num" id="5822019">0</span>&nbsp;<span class="op" id="5822021">&amp;&amp;</span>&nbsp;<span class="ident" id="5822024">mcu</span><span class="op" id="5822027">%</span><span class="ident" id="5822028">d</span><span class="op" id="5822029">.</span><span class="ident" id="5822030">ri</span>&nbsp;<span class="op" id="5822033">==</span>&nbsp;<span class="num" id="5822036">0</span>&nbsp;<span class="op" id="5822038">&amp;&amp;</span>&nbsp;<span class="ident" id="5822041">mcu</span>&nbsp;<span class="op" id="5822045">&lt;</span>&nbsp;<span class="ident" id="5822047">mxx</span><span class="op" id="5822050">*</span><span class="ident" id="5822051">myy</span>&nbsp;<span class="op" id="5822055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5822061">//&nbsp;A&nbsp;more&nbsp;sophisticated&nbsp;decoder&nbsp;could&nbsp;use&nbsp;RST[0-7]&nbsp;markers&nbsp;to&nbsp;resynchronize&nbsp;from&nbsp;corrupt&nbsp;input,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5822161">//&nbsp;but&nbsp;this&nbsp;one&nbsp;assumes&nbsp;well-formed&nbsp;input,&nbsp;and&nbsp;hence&nbsp;the&nbsp;restart&nbsp;marker&nbsp;follows&nbsp;immediately.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5822258">if</span>&nbsp;<span class="ident" id="5822261">err</span>&nbsp;<span class="op" id="5822265">:=</span>&nbsp;<span class="ident" id="5822268">d</span><span class="op" id="5822269">.</span><span class="ident" id="5822270">readFull</span><span class="op" id="5822278">(</span><span class="ident" id="5822279">d</span><span class="op" id="5822280">.</span><span class="ident" id="5822281">tmp</span><span class="op" id="5822284">[</span><span class="op" id="5822285">:</span><span class="num" id="5822286">2</span><span class="op" id="5822287">]</span><span class="op" id="5822288">)</span><span class="op" id="5822289">;</span>&nbsp;<span class="ident" id="5822291">err</span>&nbsp;<span class="op" id="5822295">!=</span>&nbsp;<span class="ident" id="5822298">nil</span>&nbsp;<span class="op" id="5822302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5822309">return</span>&nbsp;<span class="ident" id="5822316">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5822324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5822330">if</span>&nbsp;<span class="ident" id="5822333">d</span><span class="op" id="5822334">.</span><span class="ident" id="5822335">tmp</span><span class="op" id="5822338">[</span><span class="num" id="5822339">0</span><span class="op" id="5822340">]</span>&nbsp;<span class="op" id="5822342">!=</span>&nbsp;<span class="num" id="5822345">0xff</span>&nbsp;<span class="op" id="5822350">||</span>&nbsp;<span class="ident" id="5822353">d</span><span class="op" id="5822354">.</span><span class="ident" id="5822355">tmp</span><span class="op" id="5822358">[</span><span class="num" id="5822359">1</span><span class="op" id="5822360">]</span>&nbsp;<span class="op" id="5822362">!=</span>&nbsp;<span class="ident" id="5822365">expectedRST</span>&nbsp;<span class="op" id="5822377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5822384">return</span>&nbsp;<span class="ident" id="5822391">FormatError</span><span class="op" id="5822402">(</span><span class="string" id="5822403">&#34;bad&nbsp;RST&nbsp;marker&#34;</span><span class="op" id="5822419">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5822425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5822431">expectedRST</span><span class="op" id="5822442">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5822449">if</span>&nbsp;<span class="ident" id="5822452">expectedRST</span>&nbsp;<span class="op" id="5822464">==</span>&nbsp;<span class="ident" id="5822467">rst7Marker</span><span class="op" id="5822477">+</span><span class="num" id="5822478">1</span>&nbsp;<span class="op" id="5822480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5822487">expectedRST</span>&nbsp;<span class="op" id="5822499">=</span>&nbsp;<span class="ident" id="5822501">rst0Marker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5822516">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5822522">//&nbsp;Reset&nbsp;the&nbsp;Huffman&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5822556">d</span><span class="op" id="5822557">.</span><span class="ident" id="5822558">bits</span>&nbsp;<span class="op" id="5822563">=</span>&nbsp;<span class="ident" id="5822565">bits</span><span class="op" id="5822569">{</span><span class="op" id="5822570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5822576">//&nbsp;Reset&nbsp;the&nbsp;DC&nbsp;components,&nbsp;as&nbsp;per&nbsp;section&nbsp;F.2.1.3.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5822634">dc</span>&nbsp;<span class="op" id="5822637">=</span>&nbsp;<span class="op" id="5822639">[</span><span class="ident" id="5822640">nColorComponent</span><span class="op" id="5822655">]</span><span class="builtintype" id="5822656">int32</span><span class="op" id="5822661">{</span><span class="op" id="5822662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5822668">//&nbsp;Reset&nbsp;the&nbsp;progressive&nbsp;decoder&nbsp;state,&nbsp;as&nbsp;per&nbsp;section&nbsp;G.1.2.2.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5822736">d</span><span class="op" id="5822737">.</span><span class="ident" id="5822738">eobRun</span>&nbsp;<span class="op" id="5822745">=</span>&nbsp;<span class="num" id="5822747">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5822752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5822756">}</span>&nbsp;<span class="comment" id="5822758">//&nbsp;for&nbsp;mx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5822769">}</span>&nbsp;<span class="comment" id="5822771">//&nbsp;for&nbsp;my</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5822783">return</span>&nbsp;<span class="ident" id="5822790">nil</span><br>
<span class="lineno"></span><span class="op" id="5822794">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5822797">//&nbsp;refine&nbsp;decodes&nbsp;a&nbsp;successive&nbsp;approximation&nbsp;refinement&nbsp;block,&nbsp;as&nbsp;specified&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5822876">//&nbsp;section&nbsp;G.1.2.</span><br>
<span class="lineno">340</span><span class="keyword" id="5822894">func</span>&nbsp;<span class="op" id="5822899">(</span><span class="ident" id="5822900">d</span>&nbsp;<span class="op" id="5822902">*</span><span class="ident" id="5822903">decoder</span><span class="op" id="5822910">)</span>&nbsp;<span class="ident" id="5822912">refine</span><span class="op" id="5822918">(</span><span class="ident" id="5822919">b</span>&nbsp;<span class="op" id="5822921">*</span><span class="ident" id="5822922">block</span><span class="op" id="5822927">,</span>&nbsp;<span class="ident" id="5822929">h</span>&nbsp;<span class="op" id="5822931">*</span><span class="ident" id="5822932">huffman</span><span class="op" id="5822939">,</span>&nbsp;<span class="ident" id="5822941">zigStart</span><span class="op" id="5822949">,</span>&nbsp;<span class="ident" id="5822951">zigEnd</span><span class="op" id="5822957">,</span>&nbsp;<span class="ident" id="5822959">delta</span>&nbsp;<span class="builtintype" id="5822965">int32</span><span class="op" id="5822970">)</span>&nbsp;<span class="builtintype" id="5822972">error</span>&nbsp;<span class="op" id="5822978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5822981">//&nbsp;Refining&nbsp;a&nbsp;DC&nbsp;component&nbsp;is&nbsp;trivial.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5823021">if</span>&nbsp;<span class="ident" id="5823024">zigStart</span>&nbsp;<span class="op" id="5823033">==</span>&nbsp;<span class="num" id="5823036">0</span>&nbsp;<span class="op" id="5823038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5823042">if</span>&nbsp;<span class="ident" id="5823045">zigEnd</span>&nbsp;<span class="op" id="5823052">!=</span>&nbsp;<span class="num" id="5823055">0</span>&nbsp;<span class="op" id="5823057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5823062">panic</span><span class="op" id="5823067">(</span><span class="string" id="5823068">&#34;unreachable&#34;</span><span class="op" id="5823081">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5823085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5823089">bit</span><span class="op" id="5823092">,</span>&nbsp;<span class="ident" id="5823094">err</span>&nbsp;<span class="op" id="5823098">:=</span>&nbsp;<span class="ident" id="5823101">d</span><span class="op" id="5823102">.</span><span class="ident" id="5823103">decodeBit</span><span class="op" id="5823112">(</span><span class="op" id="5823113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5823117">if</span>&nbsp;<span class="ident" id="5823120">err</span>&nbsp;<span class="op" id="5823124">!=</span>&nbsp;<span class="ident" id="5823127">nil</span>&nbsp;<span class="op" id="5823131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5823136">return</span>&nbsp;<span class="ident" id="5823143">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5823149">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5823153">if</span>&nbsp;<span class="ident" id="5823156">bit</span>&nbsp;<span class="op" id="5823160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5823165">b</span><span class="op" id="5823166">[</span><span class="num" id="5823167">0</span><span class="op" id="5823168">]</span>&nbsp;<span class="op" id="5823170">|=</span>&nbsp;<span class="ident" id="5823173">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5823181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5823185">return</span>&nbsp;<span class="ident" id="5823192">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5823197">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5823201">//&nbsp;Refining&nbsp;AC&nbsp;components&nbsp;is&nbsp;more&nbsp;complicated;&nbsp;see&nbsp;sections&nbsp;G.1.2.2&nbsp;and&nbsp;G.1.2.3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5823283">zig</span>&nbsp;<span class="op" id="5823287">:=</span>&nbsp;<span class="ident" id="5823290">zigStart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5823300">if</span>&nbsp;<span class="ident" id="5823303">d</span><span class="op" id="5823304">.</span><span class="ident" id="5823305">eobRun</span>&nbsp;<span class="op" id="5823312">==</span>&nbsp;<span class="num" id="5823315">0</span>&nbsp;<span class="op" id="5823317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5823320">loop</span><span class="op" id="5823324">:</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5823328">for</span>&nbsp;<span class="op" id="5823332">;</span>&nbsp;<span class="ident" id="5823334">zig</span>&nbsp;<span class="op" id="5823338">&lt;=</span>&nbsp;<span class="ident" id="5823341">zigEnd</span><span class="op" id="5823347">;</span>&nbsp;<span class="ident" id="5823349">zig</span><span class="op" id="5823352">++</span>&nbsp;<span class="op" id="5823355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5823360">z</span>&nbsp;<span class="op" id="5823362">:=</span>&nbsp;<span class="builtintype" id="5823365">int32</span><span class="op" id="5823370">(</span><span class="num" id="5823371">0</span><span class="op" id="5823372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5823377">value</span><span class="op" id="5823382">,</span>&nbsp;<span class="ident" id="5823384">err</span>&nbsp;<span class="op" id="5823388">:=</span>&nbsp;<span class="ident" id="5823391">d</span><span class="op" id="5823392">.</span><span class="ident" id="5823393">decodeHuffman</span><span class="op" id="5823406">(</span><span class="ident" id="5823407">h</span><span class="op" id="5823408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5823413">if</span>&nbsp;<span class="ident" id="5823416">err</span>&nbsp;<span class="op" id="5823420">!=</span>&nbsp;<span class="ident" id="5823423">nil</span>&nbsp;<span class="op" id="5823427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5823433">return</span>&nbsp;<span class="ident" id="5823440">err</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5823447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5823452">val0</span>&nbsp;<span class="op" id="5823457">:=</span>&nbsp;<span class="ident" id="5823460">value</span>&nbsp;<span class="op" id="5823466">&gt;&gt;</span>&nbsp;<span class="num" id="5823469">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5823474">val1</span>&nbsp;<span class="op" id="5823479">:=</span>&nbsp;<span class="ident" id="5823482">value</span>&nbsp;<span class="op" id="5823488">&amp;</span>&nbsp;<span class="num" id="5823490">0x0f</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5823499">switch</span>&nbsp;<span class="ident" id="5823506">val1</span>&nbsp;<span class="op" id="5823511">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5823516">case</span>&nbsp;<span class="num" id="5823521">0</span><span class="op" id="5823522">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5823528">if</span>&nbsp;<span class="ident" id="5823531">val0</span>&nbsp;<span class="op" id="5823536">!=</span>&nbsp;<span class="num" id="5823539">0x0f</span>&nbsp;<span class="op" id="5823544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5823551">d</span><span class="op" id="5823552">.</span><span class="ident" id="5823553">eobRun</span>&nbsp;<span class="op" id="5823560">=</span>&nbsp;<span class="builtintype" id="5823562">uint16</span><span class="op" id="5823568">(</span><span class="num" id="5823569">1</span>&nbsp;<span class="op" id="5823571">&lt;&lt;</span>&nbsp;<span class="ident" id="5823574">val0</span><span class="op" id="5823578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5823585">if</span>&nbsp;<span class="ident" id="5823588">val0</span>&nbsp;<span class="op" id="5823593">!=</span>&nbsp;<span class="num" id="5823596">0</span>&nbsp;<span class="op" id="5823598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5823606">bits</span><span class="op" id="5823610">,</span>&nbsp;<span class="ident" id="5823612">err</span>&nbsp;<span class="op" id="5823616">:=</span>&nbsp;<span class="ident" id="5823619">d</span><span class="op" id="5823620">.</span><span class="ident" id="5823621">decodeBits</span><span class="op" id="5823631">(</span><span class="builtintype" id="5823632">int32</span><span class="op" id="5823637">(</span><span class="ident" id="5823638">val0</span><span class="op" id="5823642">)</span><span class="op" id="5823643">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5823651">if</span>&nbsp;<span class="ident" id="5823654">err</span>&nbsp;<span class="op" id="5823658">!=</span>&nbsp;<span class="ident" id="5823661">nil</span>&nbsp;<span class="op" id="5823665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5823674">return</span>&nbsp;<span class="ident" id="5823681">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5823691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5823699">d</span><span class="op" id="5823700">.</span><span class="ident" id="5823701">eobRun</span>&nbsp;<span class="op" id="5823708">|=</span>&nbsp;<span class="builtintype" id="5823711">uint16</span><span class="op" id="5823717">(</span><span class="ident" id="5823718">bits</span><span class="op" id="5823722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5823729">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5823736">break</span>&nbsp;<span class="ident" id="5823742">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5823751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5823756">case</span>&nbsp;<span class="num" id="5823761">1</span><span class="op" id="5823762">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5823768">z</span>&nbsp;<span class="op" id="5823770">=</span>&nbsp;<span class="ident" id="5823772">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5823782">bit</span><span class="op" id="5823785">,</span>&nbsp;<span class="ident" id="5823787">err</span>&nbsp;<span class="op" id="5823791">:=</span>&nbsp;<span class="ident" id="5823794">d</span><span class="op" id="5823795">.</span><span class="ident" id="5823796">decodeBit</span><span class="op" id="5823805">(</span><span class="op" id="5823806">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5823812">if</span>&nbsp;<span class="ident" id="5823815">err</span>&nbsp;<span class="op" id="5823819">!=</span>&nbsp;<span class="ident" id="5823822">nil</span>&nbsp;<span class="op" id="5823826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5823833">return</span>&nbsp;<span class="ident" id="5823840">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5823848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5823854">if</span>&nbsp;<span class="op" id="5823857">!</span><span class="ident" id="5823858">bit</span>&nbsp;<span class="op" id="5823862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5823869">z</span>&nbsp;<span class="op" id="5823871">=</span>&nbsp;<span class="op" id="5823873">-</span><span class="ident" id="5823874">z</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5823880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5823885">default</span><span class="op" id="5823892">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5823898">return</span>&nbsp;<span class="ident" id="5823905">FormatError</span><span class="op" id="5823916">(</span><span class="string" id="5823917">&#34;unexpected&nbsp;Huffman&nbsp;code&#34;</span><span class="op" id="5823942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5823947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5823953">zig</span><span class="op" id="5823956">,</span>&nbsp;<span class="ident" id="5823958">err</span>&nbsp;<span class="op" id="5823962">=</span>&nbsp;<span class="ident" id="5823964">d</span><span class="op" id="5823965">.</span><span class="ident" id="5823966">refineNonZeroes</span><span class="op" id="5823981">(</span><span class="ident" id="5823982">b</span><span class="op" id="5823983">,</span>&nbsp;<span class="ident" id="5823985">zig</span><span class="op" id="5823988">,</span>&nbsp;<span class="ident" id="5823990">zigEnd</span><span class="op" id="5823996">,</span>&nbsp;<span class="builtintype" id="5823998">int32</span><span class="op" id="5824003">(</span><span class="ident" id="5824004">val0</span><span class="op" id="5824008">)</span><span class="op" id="5824009">,</span>&nbsp;<span class="ident" id="5824011">delta</span><span class="op" id="5824016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824021">if</span>&nbsp;<span class="ident" id="5824024">err</span>&nbsp;<span class="op" id="5824028">!=</span>&nbsp;<span class="ident" id="5824031">nil</span>&nbsp;<span class="op" id="5824035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824041">return</span>&nbsp;<span class="ident" id="5824048">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5824055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824060">if</span>&nbsp;<span class="ident" id="5824063">zig</span>&nbsp;<span class="op" id="5824067">&gt;</span>&nbsp;<span class="ident" id="5824069">zigEnd</span>&nbsp;<span class="op" id="5824076">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824082">return</span>&nbsp;<span class="ident" id="5824089">FormatError</span><span class="op" id="5824100">(</span><span class="string" id="5824101">&#34;too&nbsp;many&nbsp;coefficients&#34;</span><span class="op" id="5824124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5824129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824134">if</span>&nbsp;<span class="ident" id="5824137">z</span>&nbsp;<span class="op" id="5824139">!=</span>&nbsp;<span class="num" id="5824142">0</span>&nbsp;<span class="op" id="5824144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5824150">b</span><span class="op" id="5824151">[</span><span class="ident" id="5824152">unzig</span><span class="op" id="5824157">[</span><span class="ident" id="5824158">zig</span><span class="op" id="5824161">]</span><span class="op" id="5824162">]</span>&nbsp;<span class="op" id="5824164">=</span>&nbsp;<span class="ident" id="5824166">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5824171">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5824175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5824178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824181">if</span>&nbsp;<span class="ident" id="5824184">d</span><span class="op" id="5824185">.</span><span class="ident" id="5824186">eobRun</span>&nbsp;<span class="op" id="5824193">&gt;</span>&nbsp;<span class="num" id="5824195">0</span>&nbsp;<span class="op" id="5824197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5824201">d</span><span class="op" id="5824202">.</span><span class="ident" id="5824203">eobRun</span><span class="op" id="5824209">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824214">if</span>&nbsp;<span class="ident" id="5824217">_</span><span class="op" id="5824218">,</span>&nbsp;<span class="ident" id="5824220">err</span>&nbsp;<span class="op" id="5824224">:=</span>&nbsp;<span class="ident" id="5824227">d</span><span class="op" id="5824228">.</span><span class="ident" id="5824229">refineNonZeroes</span><span class="op" id="5824244">(</span><span class="ident" id="5824245">b</span><span class="op" id="5824246">,</span>&nbsp;<span class="ident" id="5824248">zig</span><span class="op" id="5824251">,</span>&nbsp;<span class="ident" id="5824253">zigEnd</span><span class="op" id="5824259">,</span>&nbsp;<span class="op" id="5824261">-</span><span class="num" id="5824262">1</span><span class="op" id="5824263">,</span>&nbsp;<span class="ident" id="5824265">delta</span><span class="op" id="5824270">)</span><span class="op" id="5824271">;</span>&nbsp;<span class="ident" id="5824273">err</span>&nbsp;<span class="op" id="5824277">!=</span>&nbsp;<span class="ident" id="5824280">nil</span>&nbsp;<span class="op" id="5824284">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824289">return</span>&nbsp;<span class="ident" id="5824296">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5824302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5824305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824308">return</span>&nbsp;<span class="ident" id="5824315">nil</span><br>
<span class="lineno"></span><span class="op" id="5824319">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="comment" id="5824322">//&nbsp;refineNonZeroes&nbsp;refines&nbsp;non-zero&nbsp;entries&nbsp;of&nbsp;b&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;If&nbsp;nz&nbsp;&gt;=&nbsp;0,</span><br>
<span class="lineno"></span><span class="comment" id="5824401">//&nbsp;the&nbsp;first&nbsp;nz&nbsp;zero&nbsp;entries&nbsp;are&nbsp;skipped&nbsp;over.</span><br>
<span class="lineno"></span><span class="keyword" id="5824448">func</span>&nbsp;<span class="op" id="5824453">(</span><span class="ident" id="5824454">d</span>&nbsp;<span class="op" id="5824456">*</span><span class="ident" id="5824457">decoder</span><span class="op" id="5824464">)</span>&nbsp;<span class="ident" id="5824466">refineNonZeroes</span><span class="op" id="5824481">(</span><span class="ident" id="5824482">b</span>&nbsp;<span class="op" id="5824484">*</span><span class="ident" id="5824485">block</span><span class="op" id="5824490">,</span>&nbsp;<span class="ident" id="5824492">zig</span><span class="op" id="5824495">,</span>&nbsp;<span class="ident" id="5824497">zigEnd</span><span class="op" id="5824503">,</span>&nbsp;<span class="ident" id="5824505">nz</span><span class="op" id="5824507">,</span>&nbsp;<span class="ident" id="5824509">delta</span>&nbsp;<span class="builtintype" id="5824515">int32</span><span class="op" id="5824520">)</span>&nbsp;<span class="op" id="5824522">(</span><span class="builtintype" id="5824523">int32</span><span class="op" id="5824528">,</span>&nbsp;<span class="builtintype" id="5824530">error</span><span class="op" id="5824535">)</span>&nbsp;<span class="op" id="5824537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824540">for</span>&nbsp;<span class="op" id="5824544">;</span>&nbsp;<span class="ident" id="5824546">zig</span>&nbsp;<span class="op" id="5824550">&lt;=</span>&nbsp;<span class="ident" id="5824553">zigEnd</span><span class="op" id="5824559">;</span>&nbsp;<span class="ident" id="5824561">zig</span><span class="op" id="5824564">++</span>&nbsp;<span class="op" id="5824567">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5824571">u</span>&nbsp;<span class="op" id="5824573">:=</span>&nbsp;<span class="ident" id="5824576">unzig</span><span class="op" id="5824581">[</span><span class="ident" id="5824582">zig</span><span class="op" id="5824585">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824589">if</span>&nbsp;<span class="ident" id="5824592">b</span><span class="op" id="5824593">[</span><span class="ident" id="5824594">u</span><span class="op" id="5824595">]</span>&nbsp;<span class="op" id="5824597">==</span>&nbsp;<span class="num" id="5824600">0</span>&nbsp;<span class="op" id="5824602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824607">if</span>&nbsp;<span class="ident" id="5824610">nz</span>&nbsp;<span class="op" id="5824613">==</span>&nbsp;<span class="num" id="5824616">0</span>&nbsp;<span class="op" id="5824618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824624">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5824633">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5824638">nz</span><span class="op" id="5824640">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824646">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5824657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5824661">bit</span><span class="op" id="5824664">,</span>&nbsp;<span class="ident" id="5824666">err</span>&nbsp;<span class="op" id="5824670">:=</span>&nbsp;<span class="ident" id="5824673">d</span><span class="op" id="5824674">.</span><span class="ident" id="5824675">decodeBit</span><span class="op" id="5824684">(</span><span class="op" id="5824685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824689">if</span>&nbsp;<span class="ident" id="5824692">err</span>&nbsp;<span class="op" id="5824696">!=</span>&nbsp;<span class="ident" id="5824699">nil</span>&nbsp;<span class="op" id="5824703">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824708">return</span>&nbsp;<span class="num" id="5824715">0</span><span class="op" id="5824716">,</span>&nbsp;<span class="ident" id="5824718">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5824724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824728">if</span>&nbsp;<span class="op" id="5824731">!</span><span class="ident" id="5824732">bit</span>&nbsp;<span class="op" id="5824736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824741">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5824752">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824756">if</span>&nbsp;<span class="ident" id="5824759">b</span><span class="op" id="5824760">[</span><span class="ident" id="5824761">u</span><span class="op" id="5824762">]</span>&nbsp;<span class="op" id="5824764">&gt;=</span>&nbsp;<span class="num" id="5824767">0</span>&nbsp;<span class="op" id="5824769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5824774">b</span><span class="op" id="5824775">[</span><span class="ident" id="5824776">u</span><span class="op" id="5824777">]</span>&nbsp;<span class="op" id="5824779">+=</span>&nbsp;<span class="ident" id="5824782">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5824790">}</span>&nbsp;<span class="keyword" id="5824792">else</span>&nbsp;<span class="op" id="5824797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5824802">b</span><span class="op" id="5824803">[</span><span class="ident" id="5824804">u</span><span class="op" id="5824805">]</span>&nbsp;<span class="op" id="5824807">-=</span>&nbsp;<span class="ident" id="5824810">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5824818">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5824821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824824">return</span>&nbsp;<span class="ident" id="5824831">zig</span><span class="op" id="5824834">,</span>&nbsp;<span class="ident" id="5824836">nil</span><br>
<span class="lineno"></span><span class="op" id="5824840">}</span>
</div>
</body>
</html>
