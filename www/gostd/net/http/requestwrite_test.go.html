<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7321162">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7321218">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7321272">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7321323">package</span>&nbsp;<span class="ident" id="7321331">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7321337">import</span>&nbsp;<span class="op" id="7321344">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7321347">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7321356">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7321366">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7321373">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7321379">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7321392">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7321403">&#34;strings&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7321414">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7321424">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7321427">type</span>&nbsp;<span class="ident" id="7321432">reqWriteTest</span>&nbsp;<span class="keyword" id="7321445">struct</span>&nbsp;<span class="op" id="7321452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7321455">Req</span>&nbsp;&nbsp;<span class="ident" id="7321460">Request</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7321469">Body</span>&nbsp;<span class="keyword" id="7321474">interface</span><span class="op" id="7321483">{</span><span class="op" id="7321484">}</span>&nbsp;<span class="comment" id="7321486">//&nbsp;optional&nbsp;[]byte&nbsp;or&nbsp;func()&nbsp;io.ReadCloser&nbsp;to&nbsp;populate&nbsp;Req.Body</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7321552">//&nbsp;Any&nbsp;of&nbsp;these&nbsp;three&nbsp;may&nbsp;be&nbsp;empty&nbsp;to&nbsp;skip&nbsp;that&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7321607">WantWrite</span>&nbsp;<span class="builtintype" id="7321617">string</span>&nbsp;<span class="comment" id="7321624">//&nbsp;Request.Write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7321642">WantProxy</span>&nbsp;<span class="builtintype" id="7321652">string</span>&nbsp;<span class="comment" id="7321659">//&nbsp;Request.WriteProxy</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7321683">WantError</span>&nbsp;<span class="builtintype" id="7321693">error</span>&nbsp;<span class="comment" id="7321699">//&nbsp;wanted&nbsp;error&nbsp;from&nbsp;Request.Write</span><br>
<span class="lineno"></span><span class="op" id="7321734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7321737">var</span>&nbsp;<span class="ident" id="7321741">reqWriteTests</span>&nbsp;<span class="op" id="7321755">=</span>&nbsp;<span class="op" id="7321757">[</span><span class="op" id="7321758">]</span><span class="ident" id="7321759">reqWriteTest</span><span class="op" id="7321771">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7321774">//&nbsp;HTTP/1.1&nbsp;=&gt;&nbsp;chunked&nbsp;coding;&nbsp;no&nbsp;body;&nbsp;no&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7321826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7321830">Req</span><span class="op" id="7321833">:</span>&nbsp;<span class="ident" id="7321835">Request</span><span class="op" id="7321842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7321847">Method</span><span class="op" id="7321853">:</span>&nbsp;<span class="string" id="7321855">&#34;GET&#34;</span><span class="op" id="7321860">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7321865">URL</span><span class="op" id="7321868">:</span>&nbsp;<span class="op" id="7321870">&amp;</span><span class="ident" id="7321871">url</span><span class="op" id="7321874">.</span><span class="ident" id="7321875">URL</span><span class="op" id="7321878">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7321884">Scheme</span><span class="op" id="7321890">:</span>&nbsp;<span class="string" id="7321892">&#34;http&#34;</span><span class="op" id="7321898">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7321904">Host</span><span class="op" id="7321908">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7321912">&#34;www.techcrunch.com&#34;</span><span class="op" id="7321932">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7321938">Path</span><span class="op" id="7321942">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7321946">&#34;/&#34;</span><span class="op" id="7321949">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7321954">}</span><span class="op" id="7321955">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7321960">Proto</span><span class="op" id="7321965">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7321972">&#34;HTTP/1.1&#34;</span><span class="op" id="7321982">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7321987">ProtoMajor</span><span class="op" id="7321997">:</span>&nbsp;<span class="num" id="7321999">1</span><span class="op" id="7322000">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7322005">ProtoMinor</span><span class="op" id="7322015">:</span>&nbsp;<span class="num" id="7322017">1</span><span class="op" id="7322018">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7322023">Header</span><span class="op" id="7322029">:</span>&nbsp;<span class="ident" id="7322031">Header</span><span class="op" id="7322037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7322043">&#34;Accept&#34;</span><span class="op" id="7322051">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7322063">{</span><span class="string" id="7322064">&#34;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&#34;</span><span class="op" id="7322129">}</span><span class="op" id="7322130">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7322136">&#34;Accept-Charset&#34;</span><span class="op" id="7322152">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7322156">{</span><span class="string" id="7322157">&#34;ISO-8859-1,utf-8;q=0.7,*;q=0.7&#34;</span><span class="op" id="7322189">}</span><span class="op" id="7322190">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7322196">&#34;Accept-Encoding&#34;</span><span class="op" id="7322213">:</span>&nbsp;&nbsp;<span class="op" id="7322216">{</span><span class="string" id="7322217">&#34;gzip,deflate&#34;</span><span class="op" id="7322231">}</span><span class="op" id="7322232">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7322238">&#34;Accept-Language&#34;</span><span class="op" id="7322255">:</span>&nbsp;&nbsp;<span class="op" id="7322258">{</span><span class="string" id="7322259">&#34;en-us,en;q=0.5&#34;</span><span class="op" id="7322275">}</span><span class="op" id="7322276">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7322282">&#34;Keep-Alive&#34;</span><span class="op" id="7322294">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7322302">{</span><span class="string" id="7322303">&#34;300&#34;</span><span class="op" id="7322308">}</span><span class="op" id="7322309">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7322315">&#34;Proxy-Connection&#34;</span><span class="op" id="7322333">:</span>&nbsp;<span class="op" id="7322335">{</span><span class="string" id="7322336">&#34;keep-alive&#34;</span><span class="op" id="7322348">}</span><span class="op" id="7322349">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7322355">&#34;User-Agent&#34;</span><span class="op" id="7322367">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7322375">{</span><span class="string" id="7322376">&#34;Fake&#34;</span><span class="op" id="7322382">}</span><span class="op" id="7322383">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7322388">}</span><span class="op" id="7322389">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7322394">Body</span><span class="op" id="7322398">:</span>&nbsp;&nbsp;<span class="ident" id="7322401">nil</span><span class="op" id="7322404">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7322409">Close</span><span class="op" id="7322414">:</span>&nbsp;<span class="builtintype" id="7322416">false</span><span class="op" id="7322421">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7322426">Host</span><span class="op" id="7322430">:</span>&nbsp;&nbsp;<span class="string" id="7322433">&#34;www.techcrunch.com&#34;</span><span class="op" id="7322453">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7322458">Form</span><span class="op" id="7322462">:</span>&nbsp;&nbsp;<span class="keyword" id="7322465">map</span><span class="op" id="7322468">[</span><span class="builtintype" id="7322469">string</span><span class="op" id="7322475">]</span><span class="op" id="7322476">[</span><span class="op" id="7322477">]</span><span class="builtintype" id="7322478">string</span><span class="op" id="7322484">{</span><span class="op" id="7322485">}</span><span class="op" id="7322486">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7322490">}</span><span class="op" id="7322491">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7322496">WantWrite</span><span class="op" id="7322505">:</span>&nbsp;<span class="string" id="7322507">&#34;GET&nbsp;/&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="7322528">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7322533">&#34;Host:&nbsp;www.techcrunch.com\r\n&#34;</span>&nbsp;<span class="op" id="7322564">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7322569">&#34;User-Agent:&nbsp;Fake\r\n&#34;</span>&nbsp;<span class="op" id="7322592">+</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7322597">&#34;Accept:&nbsp;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n&#34;</span>&nbsp;<span class="op" id="7322675">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7322680">&#34;Accept-Charset:&nbsp;ISO-8859-1,utf-8;q=0.7,*;q=0.7\r\n&#34;</span>&nbsp;<span class="op" id="7322733">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7322738">&#34;Accept-Encoding:&nbsp;gzip,deflate\r\n&#34;</span>&nbsp;<span class="op" id="7322774">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7322779">&#34;Accept-Language:&nbsp;en-us,en;q=0.5\r\n&#34;</span>&nbsp;<span class="op" id="7322817">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7322822">&#34;Keep-Alive:&nbsp;300\r\n&#34;</span>&nbsp;<span class="op" id="7322844">+</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7322849">&#34;Proxy-Connection:&nbsp;keep-alive\r\n\r\n&#34;</span><span class="op" id="7322887">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7322892">WantProxy</span><span class="op" id="7322901">:</span>&nbsp;<span class="string" id="7322903">&#34;GET&nbsp;http://www.techcrunch.com/&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="7322949">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7322954">&#34;Host:&nbsp;www.techcrunch.com\r\n&#34;</span>&nbsp;<span class="op" id="7322985">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7322990">&#34;User-Agent:&nbsp;Fake\r\n&#34;</span>&nbsp;<span class="op" id="7323013">+</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7323018">&#34;Accept:&nbsp;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n&#34;</span>&nbsp;<span class="op" id="7323096">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7323101">&#34;Accept-Charset:&nbsp;ISO-8859-1,utf-8;q=0.7,*;q=0.7\r\n&#34;</span>&nbsp;<span class="op" id="7323154">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7323159">&#34;Accept-Encoding:&nbsp;gzip,deflate\r\n&#34;</span>&nbsp;<span class="op" id="7323195">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7323200">&#34;Accept-Language:&nbsp;en-us,en;q=0.5\r\n&#34;</span>&nbsp;<span class="op" id="7323238">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7323243">&#34;Keep-Alive:&nbsp;300\r\n&#34;</span>&nbsp;<span class="op" id="7323265">+</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7323270">&#34;Proxy-Connection:&nbsp;keep-alive\r\n\r\n&#34;</span><span class="op" id="7323308">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7323311">}</span><span class="op" id="7323312">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7323315">//&nbsp;HTTP/1.1&nbsp;=&gt;&nbsp;chunked&nbsp;coding;&nbsp;body;&nbsp;empty&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7323367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7323371">Req</span><span class="op" id="7323374">:</span>&nbsp;<span class="ident" id="7323376">Request</span><span class="op" id="7323383">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7323388">Method</span><span class="op" id="7323394">:</span>&nbsp;<span class="string" id="7323396">&#34;GET&#34;</span><span class="op" id="7323401">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7323406">URL</span><span class="op" id="7323409">:</span>&nbsp;<span class="op" id="7323411">&amp;</span><span class="ident" id="7323412">url</span><span class="op" id="7323415">.</span><span class="ident" id="7323416">URL</span><span class="op" id="7323419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7323425">Scheme</span><span class="op" id="7323431">:</span>&nbsp;<span class="string" id="7323433">&#34;http&#34;</span><span class="op" id="7323439">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7323445">Host</span><span class="op" id="7323449">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7323453">&#34;www.google.com&#34;</span><span class="op" id="7323469">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7323475">Path</span><span class="op" id="7323479">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7323483">&#34;/search&#34;</span><span class="op" id="7323492">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7323497">}</span><span class="op" id="7323498">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7323503">ProtoMajor</span><span class="op" id="7323513">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7323521">1</span><span class="op" id="7323522">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7323527">ProtoMinor</span><span class="op" id="7323537">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7323545">1</span><span class="op" id="7323546">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7323551">Header</span><span class="op" id="7323557">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7323569">Header</span><span class="op" id="7323575">{</span><span class="op" id="7323576">}</span><span class="op" id="7323577">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7323582">TransferEncoding</span><span class="op" id="7323598">:</span>&nbsp;<span class="op" id="7323600">[</span><span class="op" id="7323601">]</span><span class="builtintype" id="7323602">string</span><span class="op" id="7323608">{</span><span class="string" id="7323609">&#34;chunked&#34;</span><span class="op" id="7323618">}</span><span class="op" id="7323619">,</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7323623">}</span><span class="op" id="7323624">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7323629">Body</span><span class="op" id="7323633">:</span>&nbsp;<span class="op" id="7323635">[</span><span class="op" id="7323636">]</span><span class="builtintype" id="7323637">byte</span><span class="op" id="7323641">(</span><span class="string" id="7323642">&#34;abcdef&#34;</span><span class="op" id="7323650">)</span><span class="op" id="7323651">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7323656">WantWrite</span><span class="op" id="7323665">:</span>&nbsp;<span class="string" id="7323667">&#34;GET&nbsp;/search&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="7323694">+</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7323699">&#34;Host:&nbsp;www.google.com\r\n&#34;</span>&nbsp;<span class="op" id="7323726">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7323731">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n&#34;</span>&nbsp;<span class="op" id="7323769">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7323774">&#34;Transfer-Encoding:&nbsp;chunked\r\n\r\n&#34;</span>&nbsp;<span class="op" id="7323811">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7323816">chunk</span><span class="op" id="7323821">(</span><span class="string" id="7323822">&#34;abcdef&#34;</span><span class="op" id="7323830">)</span>&nbsp;<span class="op" id="7323832">+</span>&nbsp;<span class="ident" id="7323834">chunk</span><span class="op" id="7323839">(</span><span class="string" id="7323840">&#34;&#34;</span><span class="op" id="7323842">)</span><span class="op" id="7323843">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7323848">WantProxy</span><span class="op" id="7323857">:</span>&nbsp;<span class="string" id="7323859">&#34;GET&nbsp;http://www.google.com/search&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="7323907">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7323912">&#34;Host:&nbsp;www.google.com\r\n&#34;</span>&nbsp;<span class="op" id="7323939">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7323944">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n&#34;</span>&nbsp;<span class="op" id="7323982">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7323987">&#34;Transfer-Encoding:&nbsp;chunked\r\n\r\n&#34;</span>&nbsp;<span class="op" id="7324024">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324029">chunk</span><span class="op" id="7324034">(</span><span class="string" id="7324035">&#34;abcdef&#34;</span><span class="op" id="7324043">)</span>&nbsp;<span class="op" id="7324045">+</span>&nbsp;<span class="ident" id="7324047">chunk</span><span class="op" id="7324052">(</span><span class="string" id="7324053">&#34;&#34;</span><span class="op" id="7324055">)</span><span class="op" id="7324056">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7324059">}</span><span class="op" id="7324060">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7324063">//&nbsp;HTTP/1.1&nbsp;POST&nbsp;=&gt;&nbsp;chunked&nbsp;coding;&nbsp;body;&nbsp;empty&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7324120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324124">Req</span><span class="op" id="7324127">:</span>&nbsp;<span class="ident" id="7324129">Request</span><span class="op" id="7324136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324141">Method</span><span class="op" id="7324147">:</span>&nbsp;<span class="string" id="7324149">&#34;POST&#34;</span><span class="op" id="7324155">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324160">URL</span><span class="op" id="7324163">:</span>&nbsp;<span class="op" id="7324165">&amp;</span><span class="ident" id="7324166">url</span><span class="op" id="7324169">.</span><span class="ident" id="7324170">URL</span><span class="op" id="7324173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324179">Scheme</span><span class="op" id="7324185">:</span>&nbsp;<span class="string" id="7324187">&#34;http&#34;</span><span class="op" id="7324193">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324199">Host</span><span class="op" id="7324203">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7324207">&#34;www.google.com&#34;</span><span class="op" id="7324223">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324229">Path</span><span class="op" id="7324233">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7324237">&#34;/search&#34;</span><span class="op" id="7324246">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7324251">}</span><span class="op" id="7324252">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324257">ProtoMajor</span><span class="op" id="7324267">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7324275">1</span><span class="op" id="7324276">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324281">ProtoMinor</span><span class="op" id="7324291">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7324299">1</span><span class="op" id="7324300">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324305">Header</span><span class="op" id="7324311">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7324323">Header</span><span class="op" id="7324329">{</span><span class="op" id="7324330">}</span><span class="op" id="7324331">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324336">Close</span><span class="op" id="7324341">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7324354">true</span><span class="op" id="7324358">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324363">TransferEncoding</span><span class="op" id="7324379">:</span>&nbsp;<span class="op" id="7324381">[</span><span class="op" id="7324382">]</span><span class="builtintype" id="7324383">string</span><span class="op" id="7324389">{</span><span class="string" id="7324390">&#34;chunked&#34;</span><span class="op" id="7324399">}</span><span class="op" id="7324400">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7324404">}</span><span class="op" id="7324405">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324410">Body</span><span class="op" id="7324414">:</span>&nbsp;<span class="op" id="7324416">[</span><span class="op" id="7324417">]</span><span class="builtintype" id="7324418">byte</span><span class="op" id="7324422">(</span><span class="string" id="7324423">&#34;abcdef&#34;</span><span class="op" id="7324431">)</span><span class="op" id="7324432">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324437">WantWrite</span><span class="op" id="7324446">:</span>&nbsp;<span class="string" id="7324448">&#34;POST&nbsp;/search&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="7324476">+</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7324481">&#34;Host:&nbsp;www.google.com\r\n&#34;</span>&nbsp;<span class="op" id="7324508">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7324513">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n&#34;</span>&nbsp;<span class="op" id="7324551">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7324556">&#34;Connection:&nbsp;close\r\n&#34;</span>&nbsp;<span class="op" id="7324580">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7324585">&#34;Transfer-Encoding:&nbsp;chunked\r\n\r\n&#34;</span>&nbsp;<span class="op" id="7324622">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324627">chunk</span><span class="op" id="7324632">(</span><span class="string" id="7324633">&#34;abcdef&#34;</span><span class="op" id="7324641">)</span>&nbsp;<span class="op" id="7324643">+</span>&nbsp;<span class="ident" id="7324645">chunk</span><span class="op" id="7324650">(</span><span class="string" id="7324651">&#34;&#34;</span><span class="op" id="7324653">)</span><span class="op" id="7324654">,</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324659">WantProxy</span><span class="op" id="7324668">:</span>&nbsp;<span class="string" id="7324670">&#34;POST&nbsp;http://www.google.com/search&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="7324719">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7324724">&#34;Host:&nbsp;www.google.com\r\n&#34;</span>&nbsp;<span class="op" id="7324751">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7324756">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n&#34;</span>&nbsp;<span class="op" id="7324794">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7324799">&#34;Connection:&nbsp;close\r\n&#34;</span>&nbsp;<span class="op" id="7324823">+</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7324828">&#34;Transfer-Encoding:&nbsp;chunked\r\n\r\n&#34;</span>&nbsp;<span class="op" id="7324865">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324870">chunk</span><span class="op" id="7324875">(</span><span class="string" id="7324876">&#34;abcdef&#34;</span><span class="op" id="7324884">)</span>&nbsp;<span class="op" id="7324886">+</span>&nbsp;<span class="ident" id="7324888">chunk</span><span class="op" id="7324893">(</span><span class="string" id="7324894">&#34;&#34;</span><span class="op" id="7324896">)</span><span class="op" id="7324897">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7324900">}</span><span class="op" id="7324901">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7324905">//&nbsp;HTTP/1.1&nbsp;POST&nbsp;with&nbsp;Content-Length,&nbsp;no&nbsp;chunking</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7324956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324960">Req</span><span class="op" id="7324963">:</span>&nbsp;<span class="ident" id="7324965">Request</span><span class="op" id="7324972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324977">Method</span><span class="op" id="7324983">:</span>&nbsp;<span class="string" id="7324985">&#34;POST&#34;</span><span class="op" id="7324991">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324996">URL</span><span class="op" id="7324999">:</span>&nbsp;<span class="op" id="7325001">&amp;</span><span class="ident" id="7325002">url</span><span class="op" id="7325005">.</span><span class="ident" id="7325006">URL</span><span class="op" id="7325009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325015">Scheme</span><span class="op" id="7325021">:</span>&nbsp;<span class="string" id="7325023">&#34;http&#34;</span><span class="op" id="7325029">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325035">Host</span><span class="op" id="7325039">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7325043">&#34;www.google.com&#34;</span><span class="op" id="7325059">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325065">Path</span><span class="op" id="7325069">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7325073">&#34;/search&#34;</span><span class="op" id="7325082">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7325087">}</span><span class="op" id="7325088">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325093">ProtoMajor</span><span class="op" id="7325103">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7325108">1</span><span class="op" id="7325109">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325114">ProtoMinor</span><span class="op" id="7325124">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7325129">1</span><span class="op" id="7325130">,</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325135">Header</span><span class="op" id="7325141">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7325150">Header</span><span class="op" id="7325156">{</span><span class="op" id="7325157">}</span><span class="op" id="7325158">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325163">Close</span><span class="op" id="7325168">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7325178">true</span><span class="op" id="7325182">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325187">ContentLength</span><span class="op" id="7325200">:</span>&nbsp;<span class="num" id="7325202">6</span><span class="op" id="7325203">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7325207">}</span><span class="op" id="7325208">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325213">Body</span><span class="op" id="7325217">:</span>&nbsp;<span class="op" id="7325219">[</span><span class="op" id="7325220">]</span><span class="builtintype" id="7325221">byte</span><span class="op" id="7325225">(</span><span class="string" id="7325226">&#34;abcdef&#34;</span><span class="op" id="7325234">)</span><span class="op" id="7325235">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325240">WantWrite</span><span class="op" id="7325249">:</span>&nbsp;<span class="string" id="7325251">&#34;POST&nbsp;/search&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="7325279">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7325284">&#34;Host:&nbsp;www.google.com\r\n&#34;</span>&nbsp;<span class="op" id="7325311">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7325316">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n&#34;</span>&nbsp;<span class="op" id="7325354">+</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7325359">&#34;Connection:&nbsp;close\r\n&#34;</span>&nbsp;<span class="op" id="7325383">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7325388">&#34;Content-Length:&nbsp;6\r\n&#34;</span>&nbsp;<span class="op" id="7325412">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7325417">&#34;\r\n&#34;</span>&nbsp;<span class="op" id="7325424">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7325429">&#34;abcdef&#34;</span><span class="op" id="7325437">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325442">WantProxy</span><span class="op" id="7325451">:</span>&nbsp;<span class="string" id="7325453">&#34;POST&nbsp;http://www.google.com/search&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="7325502">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7325507">&#34;Host:&nbsp;www.google.com\r\n&#34;</span>&nbsp;<span class="op" id="7325534">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7325539">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n&#34;</span>&nbsp;<span class="op" id="7325577">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7325582">&#34;Connection:&nbsp;close\r\n&#34;</span>&nbsp;<span class="op" id="7325606">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7325611">&#34;Content-Length:&nbsp;6\r\n&#34;</span>&nbsp;<span class="op" id="7325635">+</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7325640">&#34;\r\n&#34;</span>&nbsp;<span class="op" id="7325647">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7325652">&#34;abcdef&#34;</span><span class="op" id="7325660">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7325663">}</span><span class="op" id="7325664">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7325668">//&nbsp;HTTP/1.1&nbsp;POST&nbsp;with&nbsp;Content-Length&nbsp;in&nbsp;headers</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7325717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325721">Req</span><span class="op" id="7325724">:</span>&nbsp;<span class="ident" id="7325726">Request</span><span class="op" id="7325733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325738">Method</span><span class="op" id="7325744">:</span>&nbsp;<span class="string" id="7325746">&#34;POST&#34;</span><span class="op" id="7325752">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325757">URL</span><span class="op" id="7325760">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7325765">mustParseURL</span><span class="op" id="7325777">(</span><span class="string" id="7325778">&#34;http://example.com/&#34;</span><span class="op" id="7325799">)</span><span class="op" id="7325800">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325805">Host</span><span class="op" id="7325809">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7325813">&#34;example.com&#34;</span><span class="op" id="7325826">,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325831">Header</span><span class="op" id="7325837">:</span>&nbsp;<span class="ident" id="7325839">Header</span><span class="op" id="7325845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7325851">&#34;Content-Length&#34;</span><span class="op" id="7325867">:</span>&nbsp;<span class="op" id="7325869">[</span><span class="op" id="7325870">]</span><span class="builtintype" id="7325871">string</span><span class="op" id="7325877">{</span><span class="string" id="7325878">&#34;10&#34;</span><span class="op" id="7325882">}</span><span class="op" id="7325883">,</span>&nbsp;<span class="comment" id="7325885">//&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7325899">}</span><span class="op" id="7325900">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325905">ContentLength</span><span class="op" id="7325918">:</span>&nbsp;<span class="num" id="7325920">6</span><span class="op" id="7325921">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7325925">}</span><span class="op" id="7325926">,</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325931">Body</span><span class="op" id="7325935">:</span>&nbsp;<span class="op" id="7325937">[</span><span class="op" id="7325938">]</span><span class="builtintype" id="7325939">byte</span><span class="op" id="7325943">(</span><span class="string" id="7325944">&#34;abcdef&#34;</span><span class="op" id="7325952">)</span><span class="op" id="7325953">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325958">WantWrite</span><span class="op" id="7325967">:</span>&nbsp;<span class="string" id="7325969">&#34;POST&nbsp;/&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="7325991">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7325996">&#34;Host:&nbsp;example.com\r\n&#34;</span>&nbsp;<span class="op" id="7326020">+</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7326025">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n&#34;</span>&nbsp;<span class="op" id="7326063">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7326068">&#34;Content-Length:&nbsp;6\r\n&#34;</span>&nbsp;<span class="op" id="7326092">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7326097">&#34;\r\n&#34;</span>&nbsp;<span class="op" id="7326104">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7326109">&#34;abcdef&#34;</span><span class="op" id="7326117">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7326122">WantProxy</span><span class="op" id="7326131">:</span>&nbsp;<span class="string" id="7326133">&#34;POST&nbsp;http://example.com/&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="7326173">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7326178">&#34;Host:&nbsp;example.com\r\n&#34;</span>&nbsp;<span class="op" id="7326202">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7326207">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n&#34;</span>&nbsp;<span class="op" id="7326245">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7326250">&#34;Content-Length:&nbsp;6\r\n&#34;</span>&nbsp;<span class="op" id="7326274">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7326279">&#34;\r\n&#34;</span>&nbsp;<span class="op" id="7326286">+</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7326291">&#34;abcdef&#34;</span><span class="op" id="7326299">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7326302">}</span><span class="op" id="7326303">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7326307">//&nbsp;default&nbsp;to&nbsp;HTTP/1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7326331">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7326335">Req</span><span class="op" id="7326338">:</span>&nbsp;<span class="ident" id="7326340">Request</span><span class="op" id="7326347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7326352">Method</span><span class="op" id="7326358">:</span>&nbsp;<span class="string" id="7326360">&#34;GET&#34;</span><span class="op" id="7326365">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7326370">URL</span><span class="op" id="7326373">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7326378">mustParseURL</span><span class="op" id="7326390">(</span><span class="string" id="7326391">&#34;/search&#34;</span><span class="op" id="7326400">)</span><span class="op" id="7326401">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7326406">Host</span><span class="op" id="7326410">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7326414">&#34;www.google.com&#34;</span><span class="op" id="7326430">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7326434">}</span><span class="op" id="7326435">,</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7326440">WantWrite</span><span class="op" id="7326449">:</span>&nbsp;<span class="string" id="7326451">&#34;GET&nbsp;/search&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="7326478">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7326483">&#34;Host:&nbsp;www.google.com\r\n&#34;</span>&nbsp;<span class="op" id="7326510">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7326515">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n&#34;</span>&nbsp;<span class="op" id="7326553">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7326558">&#34;\r\n&#34;</span><span class="op" id="7326564">,</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7326567">}</span><span class="op" id="7326568">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7326572">//&nbsp;Request&nbsp;with&nbsp;a&nbsp;0&nbsp;ContentLength&nbsp;and&nbsp;a&nbsp;0&nbsp;byte&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7326626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7326630">Req</span><span class="op" id="7326633">:</span>&nbsp;<span class="ident" id="7326635">Request</span><span class="op" id="7326642">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7326647">Method</span><span class="op" id="7326653">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7326662">&#34;POST&#34;</span><span class="op" id="7326668">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7326673">URL</span><span class="op" id="7326676">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7326688">mustParseURL</span><span class="op" id="7326700">(</span><span class="string" id="7326701">&#34;/&#34;</span><span class="op" id="7326704">)</span><span class="op" id="7326705">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7326710">Host</span><span class="op" id="7326714">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7326725">&#34;example.com&#34;</span><span class="op" id="7326738">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7326743">ProtoMajor</span><span class="op" id="7326753">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7326758">1</span><span class="op" id="7326759">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7326764">ProtoMinor</span><span class="op" id="7326774">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7326779">1</span><span class="op" id="7326780">,</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7326785">ContentLength</span><span class="op" id="7326798">:</span>&nbsp;<span class="num" id="7326800">0</span><span class="op" id="7326801">,</span>&nbsp;<span class="comment" id="7326803">//&nbsp;as&nbsp;if&nbsp;unset&nbsp;by&nbsp;user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7326828">}</span><span class="op" id="7326829">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7326834">Body</span><span class="op" id="7326838">:</span>&nbsp;<span class="keyword" id="7326840">func</span><span class="op" id="7326844">(</span><span class="op" id="7326845">)</span>&nbsp;<span class="ident" id="7326847">io</span><span class="op" id="7326849">.</span><span class="ident" id="7326850">ReadCloser</span>&nbsp;<span class="op" id="7326861">{</span>&nbsp;<span class="keyword" id="7326863">return</span>&nbsp;<span class="ident" id="7326870">ioutil</span><span class="op" id="7326876">.</span><span class="ident" id="7326877">NopCloser</span><span class="op" id="7326886">(</span><span class="ident" id="7326887">io</span><span class="op" id="7326889">.</span><span class="ident" id="7326890">LimitReader</span><span class="op" id="7326901">(</span><span class="ident" id="7326902">strings</span><span class="op" id="7326909">.</span><span class="ident" id="7326910">NewReader</span><span class="op" id="7326919">(</span><span class="string" id="7326920">&#34;xx&#34;</span><span class="op" id="7326924">)</span><span class="op" id="7326925">,</span>&nbsp;<span class="num" id="7326927">0</span><span class="op" id="7326928">)</span><span class="op" id="7326929">)</span>&nbsp;<span class="op" id="7326931">}</span><span class="op" id="7326932">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7326937">//&nbsp;RFC&nbsp;2616&nbsp;Section&nbsp;14.13&nbsp;says&nbsp;Content-Length&nbsp;should&nbsp;be&nbsp;specified</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7327005">//&nbsp;unless&nbsp;body&nbsp;is&nbsp;prohibited&nbsp;by&nbsp;the&nbsp;request&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7327059">//&nbsp;Also,&nbsp;nginx&nbsp;expects&nbsp;it&nbsp;for&nbsp;POST&nbsp;and&nbsp;PUT.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7327105">WantWrite</span><span class="op" id="7327114">:</span>&nbsp;<span class="string" id="7327116">&#34;POST&nbsp;/&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="7327138">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7327143">&#34;Host:&nbsp;example.com\r\n&#34;</span>&nbsp;<span class="op" id="7327167">+</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7327172">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n&#34;</span>&nbsp;<span class="op" id="7327210">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7327215">&#34;Content-Length:&nbsp;0\r\n&#34;</span>&nbsp;<span class="op" id="7327239">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7327244">&#34;\r\n&#34;</span><span class="op" id="7327250">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7327255">WantProxy</span><span class="op" id="7327264">:</span>&nbsp;<span class="string" id="7327266">&#34;POST&nbsp;/&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="7327288">+</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7327293">&#34;Host:&nbsp;example.com\r\n&#34;</span>&nbsp;<span class="op" id="7327317">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7327322">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n&#34;</span>&nbsp;<span class="op" id="7327360">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7327365">&#34;Content-Length:&nbsp;0\r\n&#34;</span>&nbsp;<span class="op" id="7327389">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7327394">&#34;\r\n&#34;</span><span class="op" id="7327400">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7327403">}</span><span class="op" id="7327404">,</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7327408">//&nbsp;Request&nbsp;with&nbsp;a&nbsp;0&nbsp;ContentLength&nbsp;and&nbsp;a&nbsp;1&nbsp;byte&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7327462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7327466">Req</span><span class="op" id="7327469">:</span>&nbsp;<span class="ident" id="7327471">Request</span><span class="op" id="7327478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7327483">Method</span><span class="op" id="7327489">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7327498">&#34;POST&#34;</span><span class="op" id="7327504">,</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7327509">URL</span><span class="op" id="7327512">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7327524">mustParseURL</span><span class="op" id="7327536">(</span><span class="string" id="7327537">&#34;/&#34;</span><span class="op" id="7327540">)</span><span class="op" id="7327541">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7327546">Host</span><span class="op" id="7327550">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7327561">&#34;example.com&#34;</span><span class="op" id="7327574">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7327579">ProtoMajor</span><span class="op" id="7327589">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7327594">1</span><span class="op" id="7327595">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7327600">ProtoMinor</span><span class="op" id="7327610">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7327615">1</span><span class="op" id="7327616">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7327621">ContentLength</span><span class="op" id="7327634">:</span>&nbsp;<span class="num" id="7327636">0</span><span class="op" id="7327637">,</span>&nbsp;<span class="comment" id="7327639">//&nbsp;as&nbsp;if&nbsp;unset&nbsp;by&nbsp;user</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7327664">}</span><span class="op" id="7327665">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7327670">Body</span><span class="op" id="7327674">:</span>&nbsp;<span class="keyword" id="7327676">func</span><span class="op" id="7327680">(</span><span class="op" id="7327681">)</span>&nbsp;<span class="ident" id="7327683">io</span><span class="op" id="7327685">.</span><span class="ident" id="7327686">ReadCloser</span>&nbsp;<span class="op" id="7327697">{</span>&nbsp;<span class="keyword" id="7327699">return</span>&nbsp;<span class="ident" id="7327706">ioutil</span><span class="op" id="7327712">.</span><span class="ident" id="7327713">NopCloser</span><span class="op" id="7327722">(</span><span class="ident" id="7327723">io</span><span class="op" id="7327725">.</span><span class="ident" id="7327726">LimitReader</span><span class="op" id="7327737">(</span><span class="ident" id="7327738">strings</span><span class="op" id="7327745">.</span><span class="ident" id="7327746">NewReader</span><span class="op" id="7327755">(</span><span class="string" id="7327756">&#34;xx&#34;</span><span class="op" id="7327760">)</span><span class="op" id="7327761">,</span>&nbsp;<span class="num" id="7327763">1</span><span class="op" id="7327764">)</span><span class="op" id="7327765">)</span>&nbsp;<span class="op" id="7327767">}</span><span class="op" id="7327768">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7327773">WantWrite</span><span class="op" id="7327782">:</span>&nbsp;<span class="string" id="7327784">&#34;POST&nbsp;/&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="7327806">+</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7327811">&#34;Host:&nbsp;example.com\r\n&#34;</span>&nbsp;<span class="op" id="7327835">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7327840">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n&#34;</span>&nbsp;<span class="op" id="7327878">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7327883">&#34;Transfer-Encoding:&nbsp;chunked\r\n\r\n&#34;</span>&nbsp;<span class="op" id="7327920">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7327925">chunk</span><span class="op" id="7327930">(</span><span class="string" id="7327931">&#34;x&#34;</span><span class="op" id="7327934">)</span>&nbsp;<span class="op" id="7327936">+</span>&nbsp;<span class="ident" id="7327938">chunk</span><span class="op" id="7327943">(</span><span class="string" id="7327944">&#34;&#34;</span><span class="op" id="7327946">)</span><span class="op" id="7327947">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7327952">WantProxy</span><span class="op" id="7327961">:</span>&nbsp;<span class="string" id="7327963">&#34;POST&nbsp;/&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="7327985">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7327990">&#34;Host:&nbsp;example.com\r\n&#34;</span>&nbsp;<span class="op" id="7328014">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7328019">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n&#34;</span>&nbsp;<span class="op" id="7328057">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7328062">&#34;Transfer-Encoding:&nbsp;chunked\r\n\r\n&#34;</span>&nbsp;<span class="op" id="7328099">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328104">chunk</span><span class="op" id="7328109">(</span><span class="string" id="7328110">&#34;x&#34;</span><span class="op" id="7328113">)</span>&nbsp;<span class="op" id="7328115">+</span>&nbsp;<span class="ident" id="7328117">chunk</span><span class="op" id="7328122">(</span><span class="string" id="7328123">&#34;&#34;</span><span class="op" id="7328125">)</span><span class="op" id="7328126">,</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7328129">}</span><span class="op" id="7328130">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7328134">//&nbsp;Request&nbsp;with&nbsp;a&nbsp;ContentLength&nbsp;of&nbsp;10&nbsp;but&nbsp;a&nbsp;5&nbsp;byte&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7328192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328196">Req</span><span class="op" id="7328199">:</span>&nbsp;<span class="ident" id="7328201">Request</span><span class="op" id="7328208">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328213">Method</span><span class="op" id="7328219">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7328228">&#34;POST&#34;</span><span class="op" id="7328234">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328239">URL</span><span class="op" id="7328242">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7328254">mustParseURL</span><span class="op" id="7328266">(</span><span class="string" id="7328267">&#34;/&#34;</span><span class="op" id="7328270">)</span><span class="op" id="7328271">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328276">Host</span><span class="op" id="7328280">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7328291">&#34;example.com&#34;</span><span class="op" id="7328304">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328309">ProtoMajor</span><span class="op" id="7328319">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7328324">1</span><span class="op" id="7328325">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328330">ProtoMinor</span><span class="op" id="7328340">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7328345">1</span><span class="op" id="7328346">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328351">ContentLength</span><span class="op" id="7328364">:</span>&nbsp;<span class="num" id="7328366">10</span><span class="op" id="7328368">,</span>&nbsp;<span class="comment" id="7328370">//&nbsp;but&nbsp;we&#39;re&nbsp;going&nbsp;to&nbsp;send&nbsp;only&nbsp;5&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7328412">}</span><span class="op" id="7328413">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328417">Body</span><span class="op" id="7328421">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7328428">[</span><span class="op" id="7328429">]</span><span class="builtintype" id="7328430">byte</span><span class="op" id="7328434">(</span><span class="string" id="7328435">&#34;12345&#34;</span><span class="op" id="7328442">)</span><span class="op" id="7328443">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328447">WantError</span><span class="op" id="7328456">:</span>&nbsp;<span class="ident" id="7328458">errors</span><span class="op" id="7328464">.</span><span class="ident" id="7328465">New</span><span class="op" id="7328468">(</span><span class="string" id="7328469">&#34;http:&nbsp;ContentLength=10&nbsp;with&nbsp;Body&nbsp;length&nbsp;5&#34;</span><span class="op" id="7328512">)</span><span class="op" id="7328513">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7328516">}</span><span class="op" id="7328517">,</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7328521">//&nbsp;Request&nbsp;with&nbsp;a&nbsp;ContentLength&nbsp;of&nbsp;4&nbsp;but&nbsp;an&nbsp;8&nbsp;byte&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7328579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328583">Req</span><span class="op" id="7328586">:</span>&nbsp;<span class="ident" id="7328588">Request</span><span class="op" id="7328595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328600">Method</span><span class="op" id="7328606">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7328615">&#34;POST&#34;</span><span class="op" id="7328621">,</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328626">URL</span><span class="op" id="7328629">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7328641">mustParseURL</span><span class="op" id="7328653">(</span><span class="string" id="7328654">&#34;/&#34;</span><span class="op" id="7328657">)</span><span class="op" id="7328658">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328663">Host</span><span class="op" id="7328667">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7328678">&#34;example.com&#34;</span><span class="op" id="7328691">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328696">ProtoMajor</span><span class="op" id="7328706">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7328711">1</span><span class="op" id="7328712">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328717">ProtoMinor</span><span class="op" id="7328727">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7328732">1</span><span class="op" id="7328733">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328738">ContentLength</span><span class="op" id="7328751">:</span>&nbsp;<span class="num" id="7328753">4</span><span class="op" id="7328754">,</span>&nbsp;<span class="comment" id="7328756">//&nbsp;but&nbsp;we&#39;re&nbsp;going&nbsp;to&nbsp;try&nbsp;to&nbsp;send&nbsp;8&nbsp;bytes</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7328800">}</span><span class="op" id="7328801">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328805">Body</span><span class="op" id="7328809">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7328816">[</span><span class="op" id="7328817">]</span><span class="builtintype" id="7328818">byte</span><span class="op" id="7328822">(</span><span class="string" id="7328823">&#34;12345678&#34;</span><span class="op" id="7328833">)</span><span class="op" id="7328834">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328838">WantError</span><span class="op" id="7328847">:</span>&nbsp;<span class="ident" id="7328849">errors</span><span class="op" id="7328855">.</span><span class="ident" id="7328856">New</span><span class="op" id="7328859">(</span><span class="string" id="7328860">&#34;http:&nbsp;ContentLength=4&nbsp;with&nbsp;Body&nbsp;length&nbsp;8&#34;</span><span class="op" id="7328902">)</span><span class="op" id="7328903">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7328906">}</span><span class="op" id="7328907">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7328911">//&nbsp;Request&nbsp;with&nbsp;a&nbsp;5&nbsp;ContentLength&nbsp;and&nbsp;nil&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7328960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328964">Req</span><span class="op" id="7328967">:</span>&nbsp;<span class="ident" id="7328969">Request</span><span class="op" id="7328976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328981">Method</span><span class="op" id="7328987">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7328996">&#34;POST&#34;</span><span class="op" id="7329002">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329007">URL</span><span class="op" id="7329010">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7329022">mustParseURL</span><span class="op" id="7329034">(</span><span class="string" id="7329035">&#34;/&#34;</span><span class="op" id="7329038">)</span><span class="op" id="7329039">,</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329044">Host</span><span class="op" id="7329048">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7329059">&#34;example.com&#34;</span><span class="op" id="7329072">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329077">ProtoMajor</span><span class="op" id="7329087">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7329092">1</span><span class="op" id="7329093">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329098">ProtoMinor</span><span class="op" id="7329108">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7329113">1</span><span class="op" id="7329114">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329119">ContentLength</span><span class="op" id="7329132">:</span>&nbsp;<span class="num" id="7329134">5</span><span class="op" id="7329135">,</span>&nbsp;<span class="comment" id="7329137">//&nbsp;but&nbsp;we&#39;ll&nbsp;omit&nbsp;the&nbsp;body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7329166">}</span><span class="op" id="7329167">,</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329171">WantError</span><span class="op" id="7329180">:</span>&nbsp;<span class="ident" id="7329182">errors</span><span class="op" id="7329188">.</span><span class="ident" id="7329189">New</span><span class="op" id="7329192">(</span><span class="string" id="7329193">&#34;http:&nbsp;Request.ContentLength=5&nbsp;with&nbsp;nil&nbsp;Body&#34;</span><span class="op" id="7329238">)</span><span class="op" id="7329239">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7329242">}</span><span class="op" id="7329243">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7329247">//&nbsp;Request&nbsp;with&nbsp;a&nbsp;0&nbsp;ContentLength&nbsp;and&nbsp;a&nbsp;body&nbsp;with&nbsp;1&nbsp;byte&nbsp;content&nbsp;and&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7329327">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329331">Req</span><span class="op" id="7329334">:</span>&nbsp;<span class="ident" id="7329336">Request</span><span class="op" id="7329343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329348">Method</span><span class="op" id="7329354">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7329363">&#34;POST&#34;</span><span class="op" id="7329369">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329374">URL</span><span class="op" id="7329377">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7329389">mustParseURL</span><span class="op" id="7329401">(</span><span class="string" id="7329402">&#34;/&#34;</span><span class="op" id="7329405">)</span><span class="op" id="7329406">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329411">Host</span><span class="op" id="7329415">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7329426">&#34;example.com&#34;</span><span class="op" id="7329439">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329444">ProtoMajor</span><span class="op" id="7329454">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7329459">1</span><span class="op" id="7329460">,</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329465">ProtoMinor</span><span class="op" id="7329475">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7329480">1</span><span class="op" id="7329481">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329486">ContentLength</span><span class="op" id="7329499">:</span>&nbsp;<span class="num" id="7329501">0</span><span class="op" id="7329502">,</span>&nbsp;<span class="comment" id="7329504">//&nbsp;as&nbsp;if&nbsp;unset&nbsp;by&nbsp;user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7329529">}</span><span class="op" id="7329530">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329535">Body</span><span class="op" id="7329539">:</span>&nbsp;<span class="keyword" id="7329541">func</span><span class="op" id="7329545">(</span><span class="op" id="7329546">)</span>&nbsp;<span class="ident" id="7329548">io</span><span class="op" id="7329550">.</span><span class="ident" id="7329551">ReadCloser</span>&nbsp;<span class="op" id="7329562">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329567">err</span>&nbsp;<span class="op" id="7329571">:=</span>&nbsp;<span class="ident" id="7329574">errors</span><span class="op" id="7329580">.</span><span class="ident" id="7329581">New</span><span class="op" id="7329584">(</span><span class="string" id="7329585">&#34;Custom&nbsp;reader&nbsp;error&#34;</span><span class="op" id="7329606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329611">errReader</span>&nbsp;<span class="op" id="7329621">:=</span>&nbsp;<span class="op" id="7329624">&amp;</span><span class="ident" id="7329625">errorReader</span><span class="op" id="7329636">{</span><span class="ident" id="7329637">err</span><span class="op" id="7329640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7329645">return</span>&nbsp;<span class="ident" id="7329652">ioutil</span><span class="op" id="7329658">.</span><span class="ident" id="7329659">NopCloser</span><span class="op" id="7329668">(</span><span class="ident" id="7329669">io</span><span class="op" id="7329671">.</span><span class="ident" id="7329672">MultiReader</span><span class="op" id="7329683">(</span><span class="ident" id="7329684">strings</span><span class="op" id="7329691">.</span><span class="ident" id="7329692">NewReader</span><span class="op" id="7329701">(</span><span class="string" id="7329702">&#34;x&#34;</span><span class="op" id="7329705">)</span><span class="op" id="7329706">,</span>&nbsp;<span class="ident" id="7329708">errReader</span><span class="op" id="7329717">)</span><span class="op" id="7329718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7329722">}</span><span class="op" id="7329723">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329728">WantError</span><span class="op" id="7329737">:</span>&nbsp;<span class="ident" id="7329739">errors</span><span class="op" id="7329745">.</span><span class="ident" id="7329746">New</span><span class="op" id="7329749">(</span><span class="string" id="7329750">&#34;Custom&nbsp;reader&nbsp;error&#34;</span><span class="op" id="7329771">)</span><span class="op" id="7329772">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7329775">}</span><span class="op" id="7329776">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7329780">//&nbsp;Request&nbsp;with&nbsp;a&nbsp;0&nbsp;ContentLength&nbsp;and&nbsp;a&nbsp;body&nbsp;without&nbsp;content&nbsp;and&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7329856">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329860">Req</span><span class="op" id="7329863">:</span>&nbsp;<span class="ident" id="7329865">Request</span><span class="op" id="7329872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329877">Method</span><span class="op" id="7329883">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7329892">&#34;POST&#34;</span><span class="op" id="7329898">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329903">URL</span><span class="op" id="7329906">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7329918">mustParseURL</span><span class="op" id="7329930">(</span><span class="string" id="7329931">&#34;/&#34;</span><span class="op" id="7329934">)</span><span class="op" id="7329935">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329940">Host</span><span class="op" id="7329944">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7329955">&#34;example.com&#34;</span><span class="op" id="7329968">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329973">ProtoMajor</span><span class="op" id="7329983">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7329988">1</span><span class="op" id="7329989">,</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329994">ProtoMinor</span><span class="op" id="7330004">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7330009">1</span><span class="op" id="7330010">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7330015">ContentLength</span><span class="op" id="7330028">:</span>&nbsp;<span class="num" id="7330030">0</span><span class="op" id="7330031">,</span>&nbsp;<span class="comment" id="7330033">//&nbsp;as&nbsp;if&nbsp;unset&nbsp;by&nbsp;user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7330058">}</span><span class="op" id="7330059">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7330064">Body</span><span class="op" id="7330068">:</span>&nbsp;<span class="keyword" id="7330070">func</span><span class="op" id="7330074">(</span><span class="op" id="7330075">)</span>&nbsp;<span class="ident" id="7330077">io</span><span class="op" id="7330079">.</span><span class="ident" id="7330080">ReadCloser</span>&nbsp;<span class="op" id="7330091">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7330096">err</span>&nbsp;<span class="op" id="7330100">:=</span>&nbsp;<span class="ident" id="7330103">errors</span><span class="op" id="7330109">.</span><span class="ident" id="7330110">New</span><span class="op" id="7330113">(</span><span class="string" id="7330114">&#34;Custom&nbsp;reader&nbsp;error&#34;</span><span class="op" id="7330135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7330140">errReader</span>&nbsp;<span class="op" id="7330150">:=</span>&nbsp;<span class="op" id="7330153">&amp;</span><span class="ident" id="7330154">errorReader</span><span class="op" id="7330165">{</span><span class="ident" id="7330166">err</span><span class="op" id="7330169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7330174">return</span>&nbsp;<span class="ident" id="7330181">ioutil</span><span class="op" id="7330187">.</span><span class="ident" id="7330188">NopCloser</span><span class="op" id="7330197">(</span><span class="ident" id="7330198">errReader</span><span class="op" id="7330207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7330211">}</span><span class="op" id="7330212">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7330217">WantError</span><span class="op" id="7330226">:</span>&nbsp;<span class="ident" id="7330228">errors</span><span class="op" id="7330234">.</span><span class="ident" id="7330235">New</span><span class="op" id="7330238">(</span><span class="string" id="7330239">&#34;Custom&nbsp;reader&nbsp;error&#34;</span><span class="op" id="7330260">)</span><span class="op" id="7330261">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7330264">}</span><span class="op" id="7330265">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7330269">//&nbsp;Verify&nbsp;that&nbsp;DumpRequest&nbsp;preserves&nbsp;the&nbsp;HTTP&nbsp;version&nbsp;number,&nbsp;doesn&#39;t&nbsp;add&nbsp;a&nbsp;Host,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7330352">//&nbsp;and&nbsp;doesn&#39;t&nbsp;add&nbsp;a&nbsp;User-Agent.</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7330386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7330390">Req</span><span class="op" id="7330393">:</span>&nbsp;<span class="ident" id="7330395">Request</span><span class="op" id="7330402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7330407">Method</span><span class="op" id="7330413">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7330419">&#34;GET&#34;</span><span class="op" id="7330424">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7330429">URL</span><span class="op" id="7330432">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7330441">mustParseURL</span><span class="op" id="7330453">(</span><span class="string" id="7330454">&#34;/foo&#34;</span><span class="op" id="7330460">)</span><span class="op" id="7330461">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7330466">ProtoMajor</span><span class="op" id="7330476">:</span>&nbsp;<span class="num" id="7330478">1</span><span class="op" id="7330479">,</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7330484">ProtoMinor</span><span class="op" id="7330494">:</span>&nbsp;<span class="num" id="7330496">0</span><span class="op" id="7330497">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7330502">Header</span><span class="op" id="7330508">:</span>&nbsp;<span class="ident" id="7330510">Header</span><span class="op" id="7330516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7330522">&#34;X-Foo&#34;</span><span class="op" id="7330529">:</span>&nbsp;<span class="op" id="7330531">[</span><span class="op" id="7330532">]</span><span class="builtintype" id="7330533">string</span><span class="op" id="7330539">{</span><span class="string" id="7330540">&#34;X-Bar&#34;</span><span class="op" id="7330547">}</span><span class="op" id="7330548">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7330553">}</span><span class="op" id="7330554">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7330558">}</span><span class="op" id="7330559">,</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7330564">WantWrite</span><span class="op" id="7330573">:</span>&nbsp;<span class="string" id="7330575">&#34;GET&nbsp;/foo&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="7330599">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7330604">&#34;Host:&nbsp;\r\n&#34;</span>&nbsp;<span class="op" id="7330617">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7330622">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n&#34;</span>&nbsp;<span class="op" id="7330660">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7330665">&#34;X-Foo:&nbsp;X-Bar\r\n\r\n&#34;</span><span class="op" id="7330687">,</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7330690">}</span><span class="op" id="7330691">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7330695">//&nbsp;If&nbsp;no&nbsp;Request.Host&nbsp;and&nbsp;no&nbsp;Request.URL.Host,&nbsp;we&nbsp;send</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7330751">//&nbsp;an&nbsp;empty&nbsp;Host&nbsp;header,&nbsp;and&nbsp;don&#39;t&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7330791">//&nbsp;Request.Header[&#34;Host&#34;].&nbsp;This&nbsp;is&nbsp;just&nbsp;testing&nbsp;that</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7330845">//&nbsp;we&nbsp;don&#39;t&nbsp;change&nbsp;Go&nbsp;1.0&nbsp;behavior.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7330882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7330886">Req</span><span class="op" id="7330889">:</span>&nbsp;<span class="ident" id="7330891">Request</span><span class="op" id="7330898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7330903">Method</span><span class="op" id="7330909">:</span>&nbsp;<span class="string" id="7330911">&#34;GET&#34;</span><span class="op" id="7330916">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7330921">Host</span><span class="op" id="7330925">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7330929">&#34;&#34;</span><span class="op" id="7330931">,</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7330936">URL</span><span class="op" id="7330939">:</span>&nbsp;<span class="op" id="7330941">&amp;</span><span class="ident" id="7330942">url</span><span class="op" id="7330945">.</span><span class="ident" id="7330946">URL</span><span class="op" id="7330949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7330955">Scheme</span><span class="op" id="7330961">:</span>&nbsp;<span class="string" id="7330963">&#34;http&#34;</span><span class="op" id="7330969">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7330975">Host</span><span class="op" id="7330979">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7330983">&#34;&#34;</span><span class="op" id="7330985">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7330991">Path</span><span class="op" id="7330995">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7330999">&#34;/search&#34;</span><span class="op" id="7331008">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7331013">}</span><span class="op" id="7331014">,</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331019">ProtoMajor</span><span class="op" id="7331029">:</span>&nbsp;<span class="num" id="7331031">1</span><span class="op" id="7331032">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331037">ProtoMinor</span><span class="op" id="7331047">:</span>&nbsp;<span class="num" id="7331049">1</span><span class="op" id="7331050">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331055">Header</span><span class="op" id="7331061">:</span>&nbsp;<span class="ident" id="7331063">Header</span><span class="op" id="7331069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7331075">&#34;Host&#34;</span><span class="op" id="7331081">:</span>&nbsp;<span class="op" id="7331083">[</span><span class="op" id="7331084">]</span><span class="builtintype" id="7331085">string</span><span class="op" id="7331091">{</span><span class="string" id="7331092">&#34;bad.example.com&#34;</span><span class="op" id="7331109">}</span><span class="op" id="7331110">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7331115">}</span><span class="op" id="7331116">,</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7331120">}</span><span class="op" id="7331121">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331126">WantWrite</span><span class="op" id="7331135">:</span>&nbsp;<span class="string" id="7331137">&#34;GET&nbsp;/search&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="7331164">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7331169">&#34;Host:&nbsp;\r\n&#34;</span>&nbsp;<span class="op" id="7331182">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7331187">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n\r\n&#34;</span><span class="op" id="7331228">,</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7331231">}</span><span class="op" id="7331232">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7331236">//&nbsp;Opaque&nbsp;test&nbsp;#1&nbsp;from&nbsp;golang.org/issue/4860</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7331282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331286">Req</span><span class="op" id="7331289">:</span>&nbsp;<span class="ident" id="7331291">Request</span><span class="op" id="7331298">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331303">Method</span><span class="op" id="7331309">:</span>&nbsp;<span class="string" id="7331311">&#34;GET&#34;</span><span class="op" id="7331316">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331321">URL</span><span class="op" id="7331324">:</span>&nbsp;<span class="op" id="7331326">&amp;</span><span class="ident" id="7331327">url</span><span class="op" id="7331330">.</span><span class="ident" id="7331331">URL</span><span class="op" id="7331334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331340">Scheme</span><span class="op" id="7331346">:</span>&nbsp;<span class="string" id="7331348">&#34;http&#34;</span><span class="op" id="7331354">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331360">Host</span><span class="op" id="7331364">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7331368">&#34;www.google.com&#34;</span><span class="op" id="7331384">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331390">Opaque</span><span class="op" id="7331396">:</span>&nbsp;<span class="string" id="7331398">&#34;/%2F/%2F/&#34;</span><span class="op" id="7331409">,</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7331414">}</span><span class="op" id="7331415">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331420">ProtoMajor</span><span class="op" id="7331430">:</span>&nbsp;<span class="num" id="7331432">1</span><span class="op" id="7331433">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331438">ProtoMinor</span><span class="op" id="7331448">:</span>&nbsp;<span class="num" id="7331450">1</span><span class="op" id="7331451">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331456">Header</span><span class="op" id="7331462">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7331468">Header</span><span class="op" id="7331474">{</span><span class="op" id="7331475">}</span><span class="op" id="7331476">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7331480">}</span><span class="op" id="7331481">,</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331486">WantWrite</span><span class="op" id="7331495">:</span>&nbsp;<span class="string" id="7331497">&#34;GET&nbsp;/%2F/%2F/&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="7331526">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7331531">&#34;Host:&nbsp;www.google.com\r\n&#34;</span>&nbsp;<span class="op" id="7331558">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7331563">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n\r\n&#34;</span><span class="op" id="7331604">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7331607">}</span><span class="op" id="7331608">,</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7331612">//&nbsp;Opaque&nbsp;test&nbsp;#2&nbsp;from&nbsp;golang.org/issue/4860</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7331658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331662">Req</span><span class="op" id="7331665">:</span>&nbsp;<span class="ident" id="7331667">Request</span><span class="op" id="7331674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331679">Method</span><span class="op" id="7331685">:</span>&nbsp;<span class="string" id="7331687">&#34;GET&#34;</span><span class="op" id="7331692">,</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331697">URL</span><span class="op" id="7331700">:</span>&nbsp;<span class="op" id="7331702">&amp;</span><span class="ident" id="7331703">url</span><span class="op" id="7331706">.</span><span class="ident" id="7331707">URL</span><span class="op" id="7331710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331716">Scheme</span><span class="op" id="7331722">:</span>&nbsp;<span class="string" id="7331724">&#34;http&#34;</span><span class="op" id="7331730">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331736">Host</span><span class="op" id="7331740">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7331744">&#34;x.google.com&#34;</span><span class="op" id="7331758">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331764">Opaque</span><span class="op" id="7331770">:</span>&nbsp;<span class="string" id="7331772">&#34;//y.google.com/%2F/%2F/&#34;</span><span class="op" id="7331797">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7331802">}</span><span class="op" id="7331803">,</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331808">ProtoMajor</span><span class="op" id="7331818">:</span>&nbsp;<span class="num" id="7331820">1</span><span class="op" id="7331821">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331826">ProtoMinor</span><span class="op" id="7331836">:</span>&nbsp;<span class="num" id="7331838">1</span><span class="op" id="7331839">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331844">Header</span><span class="op" id="7331850">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7331856">Header</span><span class="op" id="7331862">{</span><span class="op" id="7331863">}</span><span class="op" id="7331864">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7331868">}</span><span class="op" id="7331869">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331874">WantWrite</span><span class="op" id="7331883">:</span>&nbsp;<span class="string" id="7331885">&#34;GET&nbsp;http://y.google.com/%2F/%2F/&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="7331933">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7331938">&#34;Host:&nbsp;x.google.com\r\n&#34;</span>&nbsp;<span class="op" id="7331963">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7331968">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n\r\n&#34;</span><span class="op" id="7332009">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7332012">}</span><span class="op" id="7332013">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7332017">//&nbsp;Testing&nbsp;custom&nbsp;case&nbsp;in&nbsp;header&nbsp;keys.&nbsp;Issue&nbsp;5022.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7332069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332073">Req</span><span class="op" id="7332076">:</span>&nbsp;<span class="ident" id="7332078">Request</span><span class="op" id="7332085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332090">Method</span><span class="op" id="7332096">:</span>&nbsp;<span class="string" id="7332098">&#34;GET&#34;</span><span class="op" id="7332103">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332108">URL</span><span class="op" id="7332111">:</span>&nbsp;<span class="op" id="7332113">&amp;</span><span class="ident" id="7332114">url</span><span class="op" id="7332117">.</span><span class="ident" id="7332118">URL</span><span class="op" id="7332121">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332127">Scheme</span><span class="op" id="7332133">:</span>&nbsp;<span class="string" id="7332135">&#34;http&#34;</span><span class="op" id="7332141">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332147">Host</span><span class="op" id="7332151">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7332155">&#34;www.google.com&#34;</span><span class="op" id="7332171">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332177">Path</span><span class="op" id="7332181">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7332185">&#34;/&#34;</span><span class="op" id="7332188">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7332193">}</span><span class="op" id="7332194">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332199">Proto</span><span class="op" id="7332204">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7332211">&#34;HTTP/1.1&#34;</span><span class="op" id="7332221">,</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332226">ProtoMajor</span><span class="op" id="7332236">:</span>&nbsp;<span class="num" id="7332238">1</span><span class="op" id="7332239">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332244">ProtoMinor</span><span class="op" id="7332254">:</span>&nbsp;<span class="num" id="7332256">1</span><span class="op" id="7332257">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332262">Header</span><span class="op" id="7332268">:</span>&nbsp;<span class="ident" id="7332270">Header</span><span class="op" id="7332276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7332282">&#34;ALL-CAPS&#34;</span><span class="op" id="7332292">:</span>&nbsp;<span class="op" id="7332294">{</span><span class="string" id="7332295">&#34;x&#34;</span><span class="op" id="7332298">}</span><span class="op" id="7332299">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7332304">}</span><span class="op" id="7332305">,</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7332309">}</span><span class="op" id="7332310">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332315">WantWrite</span><span class="op" id="7332324">:</span>&nbsp;<span class="string" id="7332326">&#34;GET&nbsp;/&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="7332347">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7332352">&#34;Host:&nbsp;www.google.com\r\n&#34;</span>&nbsp;<span class="op" id="7332379">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7332384">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n&#34;</span>&nbsp;<span class="op" id="7332422">+</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7332427">&#34;ALL-CAPS:&nbsp;x\r\n&#34;</span>&nbsp;<span class="op" id="7332445">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7332450">&#34;\r\n&#34;</span><span class="op" id="7332456">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7332459">}</span><span class="op" id="7332460">,</span><br>
<span class="lineno"></span><span class="op" id="7332462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span><span class="keyword" id="7332465">func</span>&nbsp;<span class="ident" id="7332470">TestRequestWrite</span><span class="op" id="7332486">(</span><span class="ident" id="7332487">t</span>&nbsp;<span class="op" id="7332489">*</span><span class="ident" id="7332490">testing</span><span class="op" id="7332497">.</span><span class="ident" id="7332498">T</span><span class="op" id="7332499">)</span>&nbsp;<span class="op" id="7332501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7332504">for</span>&nbsp;<span class="ident" id="7332508">i</span>&nbsp;<span class="op" id="7332510">:=</span>&nbsp;<span class="keyword" id="7332513">range</span>&nbsp;<span class="ident" id="7332519">reqWriteTests</span>&nbsp;<span class="op" id="7332533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332537">tt</span>&nbsp;<span class="op" id="7332540">:=</span>&nbsp;<span class="op" id="7332543">&amp;</span><span class="ident" id="7332544">reqWriteTests</span><span class="op" id="7332557">[</span><span class="ident" id="7332558">i</span><span class="op" id="7332559">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332564">setBody</span>&nbsp;<span class="op" id="7332572">:=</span>&nbsp;<span class="keyword" id="7332575">func</span><span class="op" id="7332579">(</span><span class="op" id="7332580">)</span>&nbsp;<span class="op" id="7332582">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7332587">if</span>&nbsp;<span class="ident" id="7332590">tt</span><span class="op" id="7332592">.</span><span class="ident" id="7332593">Body</span>&nbsp;<span class="op" id="7332598">==</span>&nbsp;<span class="ident" id="7332601">nil</span>&nbsp;<span class="op" id="7332605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7332611">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7332621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7332626">switch</span>&nbsp;<span class="ident" id="7332633">b</span>&nbsp;<span class="op" id="7332635">:=</span>&nbsp;<span class="ident" id="7332638">tt</span><span class="op" id="7332640">.</span><span class="ident" id="7332641">Body</span><span class="op" id="7332645">.</span><span class="op" id="7332646">(</span><span class="keyword" id="7332647">type</span><span class="op" id="7332651">)</span>&nbsp;<span class="op" id="7332653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7332658">case</span>&nbsp;<span class="op" id="7332663">[</span><span class="op" id="7332664">]</span><span class="builtintype" id="7332665">byte</span><span class="op" id="7332669">:</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332675">tt</span><span class="op" id="7332677">.</span><span class="ident" id="7332678">Req</span><span class="op" id="7332681">.</span><span class="ident" id="7332682">Body</span>&nbsp;<span class="op" id="7332687">=</span>&nbsp;<span class="ident" id="7332689">ioutil</span><span class="op" id="7332695">.</span><span class="ident" id="7332696">NopCloser</span><span class="op" id="7332705">(</span><span class="ident" id="7332706">bytes</span><span class="op" id="7332711">.</span><span class="ident" id="7332712">NewReader</span><span class="op" id="7332721">(</span><span class="ident" id="7332722">b</span><span class="op" id="7332723">)</span><span class="op" id="7332724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7332729">case</span>&nbsp;<span class="keyword" id="7332734">func</span><span class="op" id="7332738">(</span><span class="op" id="7332739">)</span>&nbsp;<span class="ident" id="7332741">io</span><span class="op" id="7332743">.</span><span class="ident" id="7332744">ReadCloser</span><span class="op" id="7332754">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332760">tt</span><span class="op" id="7332762">.</span><span class="ident" id="7332763">Req</span><span class="op" id="7332766">.</span><span class="ident" id="7332767">Body</span>&nbsp;<span class="op" id="7332772">=</span>&nbsp;<span class="ident" id="7332774">b</span><span class="op" id="7332775">(</span><span class="op" id="7332776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7332781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7332785">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332789">setBody</span><span class="op" id="7332796">(</span><span class="op" id="7332797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7332801">if</span>&nbsp;<span class="ident" id="7332804">tt</span><span class="op" id="7332806">.</span><span class="ident" id="7332807">Req</span><span class="op" id="7332810">.</span><span class="ident" id="7332811">Header</span>&nbsp;<span class="op" id="7332818">==</span>&nbsp;<span class="ident" id="7332821">nil</span>&nbsp;<span class="op" id="7332825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332830">tt</span><span class="op" id="7332832">.</span><span class="ident" id="7332833">Req</span><span class="op" id="7332836">.</span><span class="ident" id="7332837">Header</span>&nbsp;<span class="op" id="7332844">=</span>&nbsp;<span class="builtinfunc" id="7332846">make</span><span class="op" id="7332850">(</span><span class="ident" id="7332851">Header</span><span class="op" id="7332857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7332861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7332866">var</span>&nbsp;<span class="ident" id="7332870">braw</span>&nbsp;<span class="ident" id="7332875">bytes</span><span class="op" id="7332880">.</span><span class="ident" id="7332881">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332890">err</span>&nbsp;<span class="op" id="7332894">:=</span>&nbsp;<span class="ident" id="7332897">tt</span><span class="op" id="7332899">.</span><span class="ident" id="7332900">Req</span><span class="op" id="7332903">.</span><span class="ident" id="7332904">Write</span><span class="op" id="7332909">(</span><span class="op" id="7332910">&amp;</span><span class="ident" id="7332911">braw</span><span class="op" id="7332915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7332919">if</span>&nbsp;<span class="ident" id="7332922">g</span><span class="op" id="7332923">,</span>&nbsp;<span class="ident" id="7332925">e</span>&nbsp;<span class="op" id="7332927">:=</span>&nbsp;<span class="ident" id="7332930">fmt</span><span class="op" id="7332933">.</span><span class="ident" id="7332934">Sprintf</span><span class="op" id="7332941">(</span><span class="string" id="7332942">&#34;%v&#34;</span><span class="op" id="7332946">,</span>&nbsp;<span class="ident" id="7332948">err</span><span class="op" id="7332951">)</span><span class="op" id="7332952">,</span>&nbsp;<span class="ident" id="7332954">fmt</span><span class="op" id="7332957">.</span><span class="ident" id="7332958">Sprintf</span><span class="op" id="7332965">(</span><span class="string" id="7332966">&#34;%v&#34;</span><span class="op" id="7332970">,</span>&nbsp;<span class="ident" id="7332972">tt</span><span class="op" id="7332974">.</span><span class="ident" id="7332975">WantError</span><span class="op" id="7332984">)</span><span class="op" id="7332985">;</span>&nbsp;<span class="ident" id="7332987">g</span>&nbsp;<span class="op" id="7332989">!=</span>&nbsp;<span class="ident" id="7332992">e</span>&nbsp;<span class="op" id="7332994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332999">t</span><span class="op" id="7333000">.</span><span class="ident" id="7333001">Errorf</span><span class="op" id="7333007">(</span><span class="string" id="7333008">&#34;writing&nbsp;#%d,&nbsp;err&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7333040">,</span>&nbsp;<span class="ident" id="7333042">i</span><span class="op" id="7333043">,</span>&nbsp;<span class="ident" id="7333045">g</span><span class="op" id="7333046">,</span>&nbsp;<span class="ident" id="7333048">e</span><span class="op" id="7333049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7333054">continue</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7333065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7333069">if</span>&nbsp;<span class="ident" id="7333072">err</span>&nbsp;<span class="op" id="7333076">!=</span>&nbsp;<span class="ident" id="7333079">nil</span>&nbsp;<span class="op" id="7333083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7333088">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7333099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7333104">if</span>&nbsp;<span class="ident" id="7333107">tt</span><span class="op" id="7333109">.</span><span class="ident" id="7333110">WantWrite</span>&nbsp;<span class="op" id="7333120">!=</span>&nbsp;<span class="string" id="7333123">&#34;&#34;</span>&nbsp;<span class="op" id="7333126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333131">sraw</span>&nbsp;<span class="op" id="7333136">:=</span>&nbsp;<span class="ident" id="7333139">braw</span><span class="op" id="7333143">.</span><span class="ident" id="7333144">String</span><span class="op" id="7333150">(</span><span class="op" id="7333151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7333156">if</span>&nbsp;<span class="ident" id="7333159">sraw</span>&nbsp;<span class="op" id="7333164">!=</span>&nbsp;<span class="ident" id="7333167">tt</span><span class="op" id="7333169">.</span><span class="ident" id="7333170">WantWrite</span>&nbsp;<span class="op" id="7333180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333186">t</span><span class="op" id="7333187">.</span><span class="ident" id="7333188">Errorf</span><span class="op" id="7333194">(</span><span class="string" id="7333195">&#34;Test&nbsp;%d,&nbsp;expecting:\n%s\nGot:\n%s\n&#34;</span><span class="op" id="7333232">,</span>&nbsp;<span class="ident" id="7333234">i</span><span class="op" id="7333235">,</span>&nbsp;<span class="ident" id="7333237">tt</span><span class="op" id="7333239">.</span><span class="ident" id="7333240">WantWrite</span><span class="op" id="7333249">,</span>&nbsp;<span class="ident" id="7333251">sraw</span><span class="op" id="7333255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7333261">continue</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7333273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7333277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7333282">if</span>&nbsp;<span class="ident" id="7333285">tt</span><span class="op" id="7333287">.</span><span class="ident" id="7333288">WantProxy</span>&nbsp;<span class="op" id="7333298">!=</span>&nbsp;<span class="string" id="7333301">&#34;&#34;</span>&nbsp;<span class="op" id="7333304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333309">setBody</span><span class="op" id="7333316">(</span><span class="op" id="7333317">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7333322">var</span>&nbsp;<span class="ident" id="7333326">praw</span>&nbsp;<span class="ident" id="7333331">bytes</span><span class="op" id="7333336">.</span><span class="ident" id="7333337">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333347">err</span>&nbsp;<span class="op" id="7333351">=</span>&nbsp;<span class="ident" id="7333353">tt</span><span class="op" id="7333355">.</span><span class="ident" id="7333356">Req</span><span class="op" id="7333359">.</span><span class="ident" id="7333360">WriteProxy</span><span class="op" id="7333370">(</span><span class="op" id="7333371">&amp;</span><span class="ident" id="7333372">praw</span><span class="op" id="7333376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7333381">if</span>&nbsp;<span class="ident" id="7333384">err</span>&nbsp;<span class="op" id="7333388">!=</span>&nbsp;<span class="ident" id="7333391">nil</span>&nbsp;<span class="op" id="7333395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333401">t</span><span class="op" id="7333402">.</span><span class="ident" id="7333403">Errorf</span><span class="op" id="7333409">(</span><span class="string" id="7333410">&#34;WriteProxy&nbsp;#%d:&nbsp;%s&#34;</span><span class="op" id="7333430">,</span>&nbsp;<span class="ident" id="7333432">i</span><span class="op" id="7333433">,</span>&nbsp;<span class="ident" id="7333435">err</span><span class="op" id="7333438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7333444">continue</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7333456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333461">sraw</span>&nbsp;<span class="op" id="7333466">:=</span>&nbsp;<span class="ident" id="7333469">praw</span><span class="op" id="7333473">.</span><span class="ident" id="7333474">String</span><span class="op" id="7333480">(</span><span class="op" id="7333481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7333486">if</span>&nbsp;<span class="ident" id="7333489">sraw</span>&nbsp;<span class="op" id="7333494">!=</span>&nbsp;<span class="ident" id="7333497">tt</span><span class="op" id="7333499">.</span><span class="ident" id="7333500">WantProxy</span>&nbsp;<span class="op" id="7333510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333516">t</span><span class="op" id="7333517">.</span><span class="ident" id="7333518">Errorf</span><span class="op" id="7333524">(</span><span class="string" id="7333525">&#34;Test&nbsp;Proxy&nbsp;%d,&nbsp;expecting:\n%s\nGot:\n%s\n&#34;</span><span class="op" id="7333568">,</span>&nbsp;<span class="ident" id="7333570">i</span><span class="op" id="7333571">,</span>&nbsp;<span class="ident" id="7333573">tt</span><span class="op" id="7333575">.</span><span class="ident" id="7333576">WantProxy</span><span class="op" id="7333585">,</span>&nbsp;<span class="ident" id="7333587">sraw</span><span class="op" id="7333591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7333597">continue</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7333609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7333613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7333616">}</span><br>
<span class="lineno"></span><span class="op" id="7333618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="7333621">type</span>&nbsp;<span class="ident" id="7333626">closeChecker</span>&nbsp;<span class="keyword" id="7333639">struct</span>&nbsp;<span class="op" id="7333646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333649">io</span><span class="op" id="7333651">.</span><span class="ident" id="7333652">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333660">closed</span>&nbsp;<span class="builtintype" id="7333667">bool</span><br>
<span class="lineno"></span><span class="op" id="7333672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">520</span><span class="keyword" id="7333675">func</span>&nbsp;<span class="op" id="7333680">(</span><span class="ident" id="7333681">rc</span>&nbsp;<span class="op" id="7333684">*</span><span class="ident" id="7333685">closeChecker</span><span class="op" id="7333697">)</span>&nbsp;<span class="ident" id="7333699">Close</span><span class="op" id="7333704">(</span><span class="op" id="7333705">)</span>&nbsp;<span class="builtintype" id="7333707">error</span>&nbsp;<span class="op" id="7333713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333716">rc</span><span class="op" id="7333718">.</span><span class="ident" id="7333719">closed</span>&nbsp;<span class="op" id="7333726">=</span>&nbsp;<span class="builtintype" id="7333728">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7333734">return</span>&nbsp;<span class="ident" id="7333741">nil</span><br>
<span class="lineno"></span><span class="op" id="7333745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="comment" id="7333748">//&nbsp;TestRequestWriteClosesBody&nbsp;tests&nbsp;that&nbsp;Request.Write&nbsp;does&nbsp;close&nbsp;its&nbsp;request.Body.</span><br>
<span class="lineno"></span><span class="comment" id="7333832">//&nbsp;It&nbsp;also&nbsp;indirectly&nbsp;tests&nbsp;NewRequest&nbsp;and&nbsp;that&nbsp;it&nbsp;doesn&#39;t&nbsp;wrap&nbsp;an&nbsp;existing&nbsp;Closer</span><br>
<span class="lineno"></span><span class="comment" id="7333915">//&nbsp;inside&nbsp;a&nbsp;NopCloser,&nbsp;and&nbsp;that&nbsp;it&nbsp;serializes&nbsp;it&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="keyword" id="7333975">func</span>&nbsp;<span class="ident" id="7333980">TestRequestWriteClosesBody</span><span class="op" id="7334006">(</span><span class="ident" id="7334007">t</span>&nbsp;<span class="op" id="7334009">*</span><span class="ident" id="7334010">testing</span><span class="op" id="7334017">.</span><span class="ident" id="7334018">T</span><span class="op" id="7334019">)</span>&nbsp;<span class="op" id="7334021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334024">rc</span>&nbsp;<span class="op" id="7334027">:=</span>&nbsp;<span class="op" id="7334030">&amp;</span><span class="ident" id="7334031">closeChecker</span><span class="op" id="7334043">{</span><span class="ident" id="7334044">Reader</span><span class="op" id="7334050">:</span>&nbsp;<span class="ident" id="7334052">strings</span><span class="op" id="7334059">.</span><span class="ident" id="7334060">NewReader</span><span class="op" id="7334069">(</span><span class="string" id="7334070">&#34;my&nbsp;body&#34;</span><span class="op" id="7334079">)</span><span class="op" id="7334080">}</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334083">req</span><span class="op" id="7334086">,</span>&nbsp;<span class="ident" id="7334088">_</span>&nbsp;<span class="op" id="7334090">:=</span>&nbsp;<span class="ident" id="7334093">NewRequest</span><span class="op" id="7334103">(</span><span class="string" id="7334104">&#34;POST&#34;</span><span class="op" id="7334110">,</span>&nbsp;<span class="string" id="7334112">&#34;http://foo.com/&#34;</span><span class="op" id="7334129">,</span>&nbsp;<span class="ident" id="7334131">rc</span><span class="op" id="7334133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7334136">if</span>&nbsp;<span class="ident" id="7334139">req</span><span class="op" id="7334142">.</span><span class="ident" id="7334143">ContentLength</span>&nbsp;<span class="op" id="7334157">!=</span>&nbsp;<span class="num" id="7334160">0</span>&nbsp;<span class="op" id="7334162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334166">t</span><span class="op" id="7334167">.</span><span class="ident" id="7334168">Errorf</span><span class="op" id="7334174">(</span><span class="string" id="7334175">&#34;got&nbsp;req.ContentLength&nbsp;%d,&nbsp;want&nbsp;0&#34;</span><span class="op" id="7334209">,</span>&nbsp;<span class="ident" id="7334211">req</span><span class="op" id="7334214">.</span><span class="ident" id="7334215">ContentLength</span><span class="op" id="7334228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7334231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334234">buf</span>&nbsp;<span class="op" id="7334238">:=</span>&nbsp;<span class="builtinfunc" id="7334241">new</span><span class="op" id="7334244">(</span><span class="ident" id="7334245">bytes</span><span class="op" id="7334250">.</span><span class="ident" id="7334251">Buffer</span><span class="op" id="7334257">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334260">req</span><span class="op" id="7334263">.</span><span class="ident" id="7334264">Write</span><span class="op" id="7334269">(</span><span class="ident" id="7334270">buf</span><span class="op" id="7334273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7334276">if</span>&nbsp;<span class="op" id="7334279">!</span><span class="ident" id="7334280">rc</span><span class="op" id="7334282">.</span><span class="ident" id="7334283">closed</span>&nbsp;<span class="op" id="7334290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334294">t</span><span class="op" id="7334295">.</span><span class="ident" id="7334296">Error</span><span class="op" id="7334301">(</span><span class="string" id="7334302">&#34;body&nbsp;not&nbsp;closed&nbsp;after&nbsp;write&#34;</span><span class="op" id="7334331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7334334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334337">expected</span>&nbsp;<span class="op" id="7334346">:=</span>&nbsp;<span class="string" id="7334349">&#34;POST&nbsp;/&nbsp;HTTP/1.1\r\n&#34;</span>&nbsp;<span class="op" id="7334371">+</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7334375">&#34;Host:&nbsp;foo.com\r\n&#34;</span>&nbsp;<span class="op" id="7334395">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7334399">&#34;User-Agent:&nbsp;Go&nbsp;1.1&nbsp;package&nbsp;http\r\n&#34;</span>&nbsp;<span class="op" id="7334437">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7334441">&#34;Transfer-Encoding:&nbsp;chunked\r\n\r\n&#34;</span>&nbsp;<span class="op" id="7334478">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7334482">//&nbsp;TODO:&nbsp;currently&nbsp;we&nbsp;don&#39;t&nbsp;buffer&nbsp;before&nbsp;chunking,&nbsp;so&nbsp;we&nbsp;get&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7334548">//&nbsp;single&nbsp;&#34;m&#34;&nbsp;chunk&nbsp;before&nbsp;the&nbsp;other&nbsp;chunks,&nbsp;as&nbsp;this&nbsp;was&nbsp;the&nbsp;1-byte</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7334618">//&nbsp;read&nbsp;from&nbsp;our&nbsp;MultiReader&nbsp;where&nbsp;we&nbsp;stiched&nbsp;the&nbsp;Body&nbsp;back&nbsp;together</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7334689">//&nbsp;after&nbsp;sniffing&nbsp;whether&nbsp;the&nbsp;Body&nbsp;was&nbsp;0&nbsp;bytes&nbsp;or&nbsp;not.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334746">chunk</span><span class="op" id="7334751">(</span><span class="string" id="7334752">&#34;m&#34;</span><span class="op" id="7334755">)</span>&nbsp;<span class="op" id="7334757">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334761">chunk</span><span class="op" id="7334766">(</span><span class="string" id="7334767">&#34;y&nbsp;body&#34;</span><span class="op" id="7334775">)</span>&nbsp;<span class="op" id="7334777">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334781">chunk</span><span class="op" id="7334786">(</span><span class="string" id="7334787">&#34;&#34;</span><span class="op" id="7334789">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7334792">if</span>&nbsp;<span class="ident" id="7334795">buf</span><span class="op" id="7334798">.</span><span class="ident" id="7334799">String</span><span class="op" id="7334805">(</span><span class="op" id="7334806">)</span>&nbsp;<span class="op" id="7334808">!=</span>&nbsp;<span class="ident" id="7334811">expected</span>&nbsp;<span class="op" id="7334820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334824">t</span><span class="op" id="7334825">.</span><span class="ident" id="7334826">Errorf</span><span class="op" id="7334832">(</span><span class="string" id="7334833">&#34;write:\n&nbsp;got:&nbsp;%s\nwant:&nbsp;%s&#34;</span><span class="op" id="7334861">,</span>&nbsp;<span class="ident" id="7334863">buf</span><span class="op" id="7334866">.</span><span class="ident" id="7334867">String</span><span class="op" id="7334873">(</span><span class="op" id="7334874">)</span><span class="op" id="7334875">,</span>&nbsp;<span class="ident" id="7334877">expected</span><span class="op" id="7334885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7334888">}</span><br>
<span class="lineno"></span><span class="op" id="7334890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">555</span><span class="keyword" id="7334893">func</span>&nbsp;<span class="ident" id="7334898">chunk</span><span class="op" id="7334903">(</span><span class="ident" id="7334904">s</span>&nbsp;<span class="builtintype" id="7334906">string</span><span class="op" id="7334912">)</span>&nbsp;<span class="builtintype" id="7334914">string</span>&nbsp;<span class="op" id="7334921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7334924">return</span>&nbsp;<span class="ident" id="7334931">fmt</span><span class="op" id="7334934">.</span><span class="ident" id="7334935">Sprintf</span><span class="op" id="7334942">(</span><span class="string" id="7334943">&#34;%x\r\n%s\r\n&#34;</span><span class="op" id="7334957">,</span>&nbsp;<span class="builtinfunc" id="7334959">len</span><span class="op" id="7334962">(</span><span class="ident" id="7334963">s</span><span class="op" id="7334964">)</span><span class="op" id="7334965">,</span>&nbsp;<span class="ident" id="7334967">s</span><span class="op" id="7334968">)</span><br>
<span class="lineno"></span><span class="op" id="7334970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7334973">func</span>&nbsp;<span class="ident" id="7334978">mustParseURL</span><span class="op" id="7334990">(</span><span class="ident" id="7334991">s</span>&nbsp;<span class="builtintype" id="7334993">string</span><span class="op" id="7334999">)</span>&nbsp;<span class="op" id="7335001">*</span><span class="ident" id="7335002">url</span><span class="op" id="7335005">.</span><span class="ident" id="7335006">URL</span>&nbsp;<span class="op" id="7335010">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335013">u</span><span class="op" id="7335014">,</span>&nbsp;<span class="ident" id="7335016">err</span>&nbsp;<span class="op" id="7335020">:=</span>&nbsp;<span class="ident" id="7335023">url</span><span class="op" id="7335026">.</span><span class="ident" id="7335027">Parse</span><span class="op" id="7335032">(</span><span class="ident" id="7335033">s</span><span class="op" id="7335034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7335037">if</span>&nbsp;<span class="ident" id="7335040">err</span>&nbsp;<span class="op" id="7335044">!=</span>&nbsp;<span class="ident" id="7335047">nil</span>&nbsp;<span class="op" id="7335051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7335055">panic</span><span class="op" id="7335060">(</span><span class="ident" id="7335061">fmt</span><span class="op" id="7335064">.</span><span class="ident" id="7335065">Sprintf</span><span class="op" id="7335072">(</span><span class="string" id="7335073">&#34;Error&nbsp;parsing&nbsp;URL&nbsp;%q:&nbsp;%v&#34;</span><span class="op" id="7335099">,</span>&nbsp;<span class="ident" id="7335101">s</span><span class="op" id="7335102">,</span>&nbsp;<span class="ident" id="7335104">err</span><span class="op" id="7335107">)</span><span class="op" id="7335108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7335111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7335114">return</span>&nbsp;<span class="ident" id="7335121">u</span><br>
<span class="lineno">565</span><span class="op" id="7335123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7335126">type</span>&nbsp;<span class="ident" id="7335131">writerFunc</span>&nbsp;<span class="keyword" id="7335142">func</span><span class="op" id="7335146">(</span><span class="op" id="7335147">[</span><span class="op" id="7335148">]</span><span class="builtintype" id="7335149">byte</span><span class="op" id="7335153">)</span>&nbsp;<span class="op" id="7335155">(</span><span class="builtintype" id="7335156">int</span><span class="op" id="7335159">,</span>&nbsp;<span class="builtintype" id="7335161">error</span><span class="op" id="7335166">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7335169">func</span>&nbsp;<span class="op" id="7335174">(</span><span class="ident" id="7335175">f</span>&nbsp;<span class="ident" id="7335177">writerFunc</span><span class="op" id="7335187">)</span>&nbsp;<span class="ident" id="7335189">Write</span><span class="op" id="7335194">(</span><span class="ident" id="7335195">p</span>&nbsp;<span class="op" id="7335197">[</span><span class="op" id="7335198">]</span><span class="builtintype" id="7335199">byte</span><span class="op" id="7335203">)</span>&nbsp;<span class="op" id="7335205">(</span><span class="builtintype" id="7335206">int</span><span class="op" id="7335209">,</span>&nbsp;<span class="builtintype" id="7335211">error</span><span class="op" id="7335216">)</span>&nbsp;<span class="op" id="7335218">{</span>&nbsp;<span class="keyword" id="7335220">return</span>&nbsp;<span class="ident" id="7335227">f</span><span class="op" id="7335228">(</span><span class="ident" id="7335229">p</span><span class="op" id="7335230">)</span>&nbsp;<span class="op" id="7335232">}</span><br>
<span class="lineno">570</span><br>
<span class="lineno"></span><span class="comment" id="7335235">//&nbsp;TestRequestWriteError&nbsp;tests&nbsp;the&nbsp;Write&nbsp;err&nbsp;!=&nbsp;nil&nbsp;checks&nbsp;in&nbsp;(*Request).write.</span><br>
<span class="lineno"></span><span class="keyword" id="7335315">func</span>&nbsp;<span class="ident" id="7335320">TestRequestWriteError</span><span class="op" id="7335341">(</span><span class="ident" id="7335342">t</span>&nbsp;<span class="op" id="7335344">*</span><span class="ident" id="7335345">testing</span><span class="op" id="7335352">.</span><span class="ident" id="7335353">T</span><span class="op" id="7335354">)</span>&nbsp;<span class="op" id="7335356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335359">failAfter</span><span class="op" id="7335368">,</span>&nbsp;<span class="ident" id="7335370">writeCount</span>&nbsp;<span class="op" id="7335381">:=</span>&nbsp;<span class="num" id="7335384">0</span><span class="op" id="7335385">,</span>&nbsp;<span class="num" id="7335387">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335390">errFail</span>&nbsp;<span class="op" id="7335398">:=</span>&nbsp;<span class="ident" id="7335401">errors</span><span class="op" id="7335407">.</span><span class="ident" id="7335408">New</span><span class="op" id="7335411">(</span><span class="string" id="7335412">&#34;fake&nbsp;write&nbsp;failure&#34;</span><span class="op" id="7335432">)</span><br>
<span class="lineno">575</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7335436">//&nbsp;w&nbsp;is&nbsp;the&nbsp;buffered&nbsp;io.Writer&nbsp;to&nbsp;write&nbsp;the&nbsp;request&nbsp;to.&nbsp;&nbsp;It</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7335497">//&nbsp;fails&nbsp;exactly&nbsp;once&nbsp;on&nbsp;its&nbsp;Nth&nbsp;Write&nbsp;call,&nbsp;as&nbsp;controlled&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7335560">//&nbsp;failAfter.&nbsp;It&nbsp;also&nbsp;tracks&nbsp;the&nbsp;number&nbsp;of&nbsp;calls&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7335613">//&nbsp;writeCount.</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335629">w</span>&nbsp;<span class="op" id="7335631">:=</span>&nbsp;<span class="keyword" id="7335634">struct</span>&nbsp;<span class="op" id="7335641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335645">io</span><span class="op" id="7335647">.</span><span class="ident" id="7335648">ByteWriter</span>&nbsp;<span class="comment" id="7335659">//&nbsp;to&nbsp;avoid&nbsp;being&nbsp;wrapped&nbsp;by&nbsp;a&nbsp;bufio.Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335705">io</span><span class="op" id="7335707">.</span><span class="ident" id="7335708">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7335716">}</span><span class="op" id="7335717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335721">nil</span><span class="op" id="7335724">,</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335728">writerFunc</span><span class="op" id="7335738">(</span><span class="keyword" id="7335739">func</span><span class="op" id="7335743">(</span><span class="ident" id="7335744">p</span>&nbsp;<span class="op" id="7335746">[</span><span class="op" id="7335747">]</span><span class="builtintype" id="7335748">byte</span><span class="op" id="7335752">)</span>&nbsp;<span class="op" id="7335754">(</span><span class="ident" id="7335755">n</span>&nbsp;<span class="builtintype" id="7335757">int</span><span class="op" id="7335760">,</span>&nbsp;<span class="ident" id="7335762">err</span>&nbsp;<span class="builtintype" id="7335766">error</span><span class="op" id="7335771">)</span>&nbsp;<span class="op" id="7335773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335778">writeCount</span><span class="op" id="7335788">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7335794">if</span>&nbsp;<span class="ident" id="7335797">failAfter</span>&nbsp;<span class="op" id="7335807">==</span>&nbsp;<span class="num" id="7335810">0</span>&nbsp;<span class="op" id="7335812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335818">err</span>&nbsp;<span class="op" id="7335822">=</span>&nbsp;<span class="ident" id="7335824">errFail</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7335835">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335840">failAfter</span><span class="op" id="7335849">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7335855">return</span>&nbsp;<span class="builtinfunc" id="7335862">len</span><span class="op" id="7335865">(</span><span class="ident" id="7335866">p</span><span class="op" id="7335867">)</span><span class="op" id="7335868">,</span>&nbsp;<span class="ident" id="7335870">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7335876">}</span><span class="op" id="7335877">)</span><span class="op" id="7335878">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7335881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335885">req</span><span class="op" id="7335888">,</span>&nbsp;<span class="ident" id="7335890">_</span>&nbsp;<span class="op" id="7335892">:=</span>&nbsp;<span class="ident" id="7335895">NewRequest</span><span class="op" id="7335905">(</span><span class="string" id="7335906">&#34;GET&#34;</span><span class="op" id="7335911">,</span>&nbsp;<span class="string" id="7335913">&#34;http://example.com/&#34;</span><span class="op" id="7335934">,</span>&nbsp;<span class="ident" id="7335936">nil</span><span class="op" id="7335939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7335942">const</span>&nbsp;<span class="ident" id="7335948">writeCalls</span>&nbsp;<span class="op" id="7335959">=</span>&nbsp;<span class="num" id="7335961">4</span>&nbsp;<span class="comment" id="7335963">//&nbsp;number&nbsp;of&nbsp;Write&nbsp;calls&nbsp;in&nbsp;current&nbsp;implementation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7336015">sawGood</span>&nbsp;<span class="op" id="7336023">:=</span>&nbsp;<span class="builtintype" id="7336026">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7336033">for</span>&nbsp;<span class="ident" id="7336037">n</span>&nbsp;<span class="op" id="7336039">:=</span>&nbsp;<span class="num" id="7336042">0</span><span class="op" id="7336043">;</span>&nbsp;<span class="ident" id="7336045">n</span>&nbsp;<span class="op" id="7336047">&lt;=</span>&nbsp;<span class="ident" id="7336050">writeCalls</span><span class="op" id="7336060">+</span><span class="num" id="7336061">2</span><span class="op" id="7336062">;</span>&nbsp;<span class="ident" id="7336064">n</span><span class="op" id="7336065">++</span>&nbsp;<span class="op" id="7336068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7336072">failAfter</span>&nbsp;<span class="op" id="7336082">=</span>&nbsp;<span class="ident" id="7336084">n</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7336088">writeCount</span>&nbsp;<span class="op" id="7336099">=</span>&nbsp;<span class="num" id="7336101">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7336105">err</span>&nbsp;<span class="op" id="7336109">:=</span>&nbsp;<span class="ident" id="7336112">req</span><span class="op" id="7336115">.</span><span class="ident" id="7336116">Write</span><span class="op" id="7336121">(</span><span class="ident" id="7336122">w</span><span class="op" id="7336123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7336127">var</span>&nbsp;<span class="ident" id="7336131">wantErr</span>&nbsp;<span class="builtintype" id="7336139">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7336147">if</span>&nbsp;<span class="ident" id="7336150">n</span>&nbsp;<span class="op" id="7336152">&lt;</span>&nbsp;<span class="ident" id="7336154">writeCalls</span>&nbsp;<span class="op" id="7336165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7336170">wantErr</span>&nbsp;<span class="op" id="7336178">=</span>&nbsp;<span class="ident" id="7336180">errFail</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7336190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7336194">if</span>&nbsp;<span class="ident" id="7336197">err</span>&nbsp;<span class="op" id="7336201">!=</span>&nbsp;<span class="ident" id="7336204">wantErr</span>&nbsp;<span class="op" id="7336212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7336217">t</span><span class="op" id="7336218">.</span><span class="ident" id="7336219">Errorf</span><span class="op" id="7336225">(</span><span class="string" id="7336226">&#34;for&nbsp;fail-after&nbsp;%d&nbsp;Writes,&nbsp;err&nbsp;=&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7336271">,</span>&nbsp;<span class="ident" id="7336273">n</span><span class="op" id="7336274">,</span>&nbsp;<span class="ident" id="7336276">err</span><span class="op" id="7336279">,</span>&nbsp;<span class="ident" id="7336281">wantErr</span><span class="op" id="7336288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7336293">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7336304">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7336308">if</span>&nbsp;<span class="ident" id="7336311">err</span>&nbsp;<span class="op" id="7336315">==</span>&nbsp;<span class="ident" id="7336318">nil</span>&nbsp;<span class="op" id="7336322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7336327">sawGood</span>&nbsp;<span class="op" id="7336335">=</span>&nbsp;<span class="builtintype" id="7336337">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7336345">if</span>&nbsp;<span class="ident" id="7336348">writeCount</span>&nbsp;<span class="op" id="7336359">!=</span>&nbsp;<span class="ident" id="7336362">writeCalls</span>&nbsp;<span class="op" id="7336373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7336379">t</span><span class="op" id="7336380">.</span><span class="ident" id="7336381">Fatalf</span><span class="op" id="7336387">(</span><span class="string" id="7336388">&#34;writeCalls&nbsp;constant&nbsp;is&nbsp;outdated&nbsp;in&nbsp;test&#34;</span><span class="op" id="7336429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7336434">}</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7336438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7336442">if</span>&nbsp;<span class="ident" id="7336445">writeCount</span>&nbsp;<span class="op" id="7336456">&gt;</span>&nbsp;<span class="ident" id="7336458">writeCalls</span>&nbsp;<span class="op" id="7336469">||</span>&nbsp;<span class="ident" id="7336472">writeCount</span>&nbsp;<span class="op" id="7336483">&gt;</span>&nbsp;<span class="ident" id="7336485">n</span><span class="op" id="7336486">+</span><span class="num" id="7336487">1</span>&nbsp;<span class="op" id="7336489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7336494">t</span><span class="op" id="7336495">.</span><span class="ident" id="7336496">Errorf</span><span class="op" id="7336502">(</span><span class="string" id="7336503">&#34;for&nbsp;fail-after&nbsp;%d,&nbsp;saw&nbsp;unexpectedly&nbsp;high&nbsp;(%d)&nbsp;write&nbsp;calls&#34;</span><span class="op" id="7336562">,</span>&nbsp;<span class="ident" id="7336564">n</span><span class="op" id="7336565">,</span>&nbsp;<span class="ident" id="7336567">writeCount</span><span class="op" id="7336577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7336581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7336584">}</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7336587">if</span>&nbsp;<span class="op" id="7336590">!</span><span class="ident" id="7336591">sawGood</span>&nbsp;<span class="op" id="7336599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7336603">t</span><span class="op" id="7336604">.</span><span class="ident" id="7336605">Fatalf</span><span class="op" id="7336611">(</span><span class="string" id="7336612">&#34;writeCalls&nbsp;constant&nbsp;is&nbsp;outdated&nbsp;in&nbsp;test&#34;</span><span class="op" id="7336653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7336656">}</span><br>
<span class="lineno"></span><span class="op" id="7336658">}</span>
</div>
</body>
</html>
