<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7230214">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7230269">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7230323">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7230374">package</span>&nbsp;<span class="ident" id="7230382">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7230387">import</span>&nbsp;<span class="op" id="7230394">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7230397">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7230406">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7230413">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7230419">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7230426">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7230437">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7230448">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="7230455">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7230458">var</span>&nbsp;<span class="ident" id="7230462">rsaCertPEM</span>&nbsp;<span class="op" id="7230473">=</span>&nbsp;<span class="string" id="7230475">`-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB0zCCAX2gAwIBAgIJAI/M7BYjwB+uMA0GCSqGSIb3DQEBBQUAMEUxCzAJBgNV<br>
<span class="lineno"></span>BAYTAkFVMRMwEQYDVQQIDApTb21lLVN0YXRlMSEwHwYDVQQKDBhJbnRlcm5ldCBX<br>
<span class="lineno">20</span>aWRnaXRzIFB0eSBMdGQwHhcNMTIwOTEyMjE1MjAyWhcNMTUwOTEyMjE1MjAyWjBF<br>
<span class="lineno"></span>MQswCQYDVQQGEwJBVTETMBEGA1UECAwKU29tZS1TdGF0ZTEhMB8GA1UECgwYSW50<br>
<span class="lineno"></span>ZXJuZXQgV2lkZ2l0cyBQdHkgTHRkMFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBANLJ<br>
<span class="lineno"></span>hPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wok/4xIA+ui35/MmNa<br>
<span class="lineno"></span>rtNuC+BdZ1tMuVCPFZcCAwEAAaNQME4wHQYDVR0OBBYEFJvKs8RfJaXTH08W+SGv<br>
<span class="lineno">25</span>zQyKn0H8MB8GA1UdIwQYMBaAFJvKs8RfJaXTH08W+SGvzQyKn0H8MAwGA1UdEwQF<br>
<span class="lineno"></span>MAMBAf8wDQYJKoZIhvcNAQEFBQADQQBJlffJHybjDGxRMqaRmDhX0+6v02TUKZsW<br>
<span class="lineno"></span>r5QuVbpQhH6u+0UgcW0jp9QwpxoPTLTWGXEWBBBurxFwiCBhkQ+V<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="7231171">var</span>&nbsp;<span class="ident" id="7231175">rsaKeyPEM</span>&nbsp;<span class="op" id="7231185">=</span>&nbsp;<span class="string" id="7231187">`-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIIBOwIBAAJBANLJhPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wo<br>
<span class="lineno"></span>k/4xIA+ui35/MmNartNuC+BdZ1tMuVCPFZcCAwEAAQJAEJ2N+zsR0Xn8/Q6twa4G<br>
<span class="lineno"></span>6OB1M1WO+k+ztnX/1SvNeWu8D6GImtupLTYgjZcHufykj09jiHmjHx8u8ZZB/o1N<br>
<span class="lineno">35</span>MQIhAPW+eyZo7ay3lMz1V01WVjNKK9QSn1MJlb06h/LuYv9FAiEA25WPedKgVyCW<br>
<span class="lineno"></span>SmUwbPw8fnTcpqDWE3yTO3vKcebqMSsCIBF3UmVue8YU3jybC3NxuXq3wNm34R8T<br>
<span class="lineno"></span>xVLHwDXh/6NJAiEAl2oHGGLz64BuAfjKrqwz7qMYr9HCLIe/YsoWq/olzScCIQDi<br>
<span class="lineno"></span>D2lWusoe2/nEqfDVVWGWlyJ7yOmqaVm/iNUN9B2N2g==<br>
<span class="lineno"></span>-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">40</span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7231688">//&nbsp;keyPEM&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;rsaKeyPEM,&nbsp;but&nbsp;declares&nbsp;itself&nbsp;as&nbsp;just</span><br>
<span class="lineno"></span><span class="comment" id="7231752">//&nbsp;&#34;PRIVATE&nbsp;KEY&#34;,&nbsp;not&nbsp;&#34;RSA&nbsp;PRIVATE&nbsp;KEY&#34;.&nbsp;&nbsp;http://golang.org/issue/4477</span><br>
<span class="lineno"></span><span class="keyword" id="7231823">var</span>&nbsp;<span class="ident" id="7231827">keyPEM</span>&nbsp;<span class="op" id="7231834">=</span>&nbsp;<span class="string" id="7231836">`-----BEGIN&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">45</span>MIIBOwIBAAJBANLJhPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wo<br>
<span class="lineno"></span>k/4xIA+ui35/MmNartNuC+BdZ1tMuVCPFZcCAwEAAQJAEJ2N+zsR0Xn8/Q6twa4G<br>
<span class="lineno"></span>6OB1M1WO+k+ztnX/1SvNeWu8D6GImtupLTYgjZcHufykj09jiHmjHx8u8ZZB/o1N<br>
<span class="lineno"></span>MQIhAPW+eyZo7ay3lMz1V01WVjNKK9QSn1MJlb06h/LuYv9FAiEA25WPedKgVyCW<br>
<span class="lineno"></span>SmUwbPw8fnTcpqDWE3yTO3vKcebqMSsCIBF3UmVue8YU3jybC3NxuXq3wNm34R8T<br>
<span class="lineno">50</span>xVLHwDXh/6NJAiEAl2oHGGLz64BuAfjKrqwz7qMYr9HCLIe/YsoWq/olzScCIQDi<br>
<span class="lineno"></span>D2lWusoe2/nEqfDVVWGWlyJ7yOmqaVm/iNUN9B2N2g==<br>
<span class="lineno"></span>-----END&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="7232329">var</span>&nbsp;<span class="ident" id="7232333">ecdsaCertPEM</span>&nbsp;<span class="op" id="7232346">=</span>&nbsp;<span class="string" id="7232348">`-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB/jCCAWICCQDscdUxw16XFDAJBgcqhkjOPQQBMEUxCzAJBgNVBAYTAkFVMRMw<br>
<span class="lineno"></span>EQYDVQQIEwpTb21lLVN0YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBXaWRnaXRzIFB0<br>
<span class="lineno"></span>eSBMdGQwHhcNMTIxMTE0MTI0MDQ4WhcNMTUxMTE0MTI0MDQ4WjBFMQswCQYDVQQG<br>
<span class="lineno"></span>EwJBVTETMBEGA1UECBMKU29tZS1TdGF0ZTEhMB8GA1UEChMYSW50ZXJuZXQgV2lk<br>
<span class="lineno">60</span>Z2l0cyBQdHkgTHRkMIGbMBAGByqGSM49AgEGBSuBBAAjA4GGAAQBY9+my9OoeSUR<br>
<span class="lineno"></span>lDQdV/x8LsOuLilthhiS1Tz4aGDHIPwC1mlvnf7fg5lecYpMCrLLhauAc1UJXcgl<br>
<span class="lineno"></span>01xoLuzgtAEAgv2P/jgytzRSpUYvgLBt1UA0leLYBy6mQQbrNEuqT3INapKIcUv8<br>
<span class="lineno"></span>XxYP0xMEUksLPq6Ca+CRSqTtrd/23uTnapkwCQYHKoZIzj0EAQOBigAwgYYCQXJo<br>
<span class="lineno"></span>A7Sl2nLVf+4Iu/tAX/IF4MavARKC4PPHK3zfuGfPR3oCCcsAoz3kAzOeijvd0iXb<br>
<span class="lineno">65</span>H5jBImIxPL4WxQNiBTexAkF8D1EtpYuWdlVQ80/h/f4pBcGiXPqX5h2PQSQY7hP1<br>
<span class="lineno"></span>+jwM1FGS4fREIOvlBYr/SzzQRtwrvrzGYxDEDbsC0ZGRnA==<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="7233105">var</span>&nbsp;<span class="ident" id="7233109">ecdsaKeyPEM</span>&nbsp;<span class="op" id="7233121">=</span>&nbsp;<span class="string" id="7233123">`-----BEGIN&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>BgUrgQQAIw==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>-----BEGIN&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIHcAgEBBEIBrsoKp0oqcv6/JovJJDoDVSGWdirrkgCWxrprGlzB9o0X8fV675X0<br>
<span class="lineno">75</span>NwuBenXFfeZvVcwluO7/Q9wkYoPd/t3jGImgBwYFK4EEACOhgYkDgYYABAFj36bL<br>
<span class="lineno"></span>06h5JRGUNB1X/Hwuw64uKW2GGJLVPPhoYMcg/ALWaW+d/t+DmV5xikwKssuFq4Bz<br>
<span class="lineno"></span>VQldyCXTXGgu7OC0AQCC/Y/+ODK3NFKlRi+AsG3VQDSV4tgHLqZBBus0S6pPcg1q<br>
<span class="lineno"></span>kohxS/xfFg/TEwRSSws+roJr4JFKpO2t3/be5OdqmQ==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">80</span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7233563">var</span>&nbsp;<span class="ident" id="7233567">keyPairTests</span>&nbsp;<span class="op" id="7233580">=</span>&nbsp;<span class="op" id="7233582">[</span><span class="op" id="7233583">]</span><span class="keyword" id="7233584">struct</span>&nbsp;<span class="op" id="7233591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7233594">algo</span>&nbsp;<span class="builtintype" id="7233599">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7233607">cert</span>&nbsp;<span class="builtintype" id="7233612">string</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7233620">key</span>&nbsp;&nbsp;<span class="builtintype" id="7233625">string</span><br>
<span class="lineno"></span><span class="op" id="7233632">}</span><span class="op" id="7233633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7233636">{</span><span class="string" id="7233637">&#34;ECDSA&#34;</span><span class="op" id="7233644">,</span>&nbsp;<span class="ident" id="7233646">ecdsaCertPEM</span><span class="op" id="7233658">,</span>&nbsp;<span class="ident" id="7233660">ecdsaKeyPEM</span><span class="op" id="7233671">}</span><span class="op" id="7233672">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7233675">{</span><span class="string" id="7233676">&#34;RSA&#34;</span><span class="op" id="7233681">,</span>&nbsp;<span class="ident" id="7233683">rsaCertPEM</span><span class="op" id="7233693">,</span>&nbsp;<span class="ident" id="7233695">rsaKeyPEM</span><span class="op" id="7233704">}</span><span class="op" id="7233705">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7233708">{</span><span class="string" id="7233709">&#34;RSA-untyped&#34;</span><span class="op" id="7233722">,</span>&nbsp;<span class="ident" id="7233724">rsaCertPEM</span><span class="op" id="7233734">,</span>&nbsp;<span class="ident" id="7233736">keyPEM</span><span class="op" id="7233742">}</span><span class="op" id="7233743">,</span>&nbsp;<span class="comment" id="7233745">//&nbsp;golang.org/issue/4477</span><br>
<span class="lineno">90</span><span class="op" id="7233770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7233773">func</span>&nbsp;<span class="ident" id="7233778">TestX509KeyPair</span><span class="op" id="7233793">(</span><span class="ident" id="7233794">t</span>&nbsp;<span class="op" id="7233796">*</span><span class="ident" id="7233797">testing</span><span class="op" id="7233804">.</span><span class="ident" id="7233805">T</span><span class="op" id="7233806">)</span>&nbsp;<span class="op" id="7233808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7233811">var</span>&nbsp;<span class="ident" id="7233815">pem</span>&nbsp;<span class="op" id="7233819">[</span><span class="op" id="7233820">]</span><span class="builtintype" id="7233821">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7233827">for</span>&nbsp;<span class="ident" id="7233831">_</span><span class="op" id="7233832">,</span>&nbsp;<span class="ident" id="7233834">test</span>&nbsp;<span class="op" id="7233839">:=</span>&nbsp;<span class="keyword" id="7233842">range</span>&nbsp;<span class="ident" id="7233848">keyPairTests</span>&nbsp;<span class="op" id="7233861">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7233865">pem</span>&nbsp;<span class="op" id="7233869">=</span>&nbsp;<span class="op" id="7233871">[</span><span class="op" id="7233872">]</span><span class="builtintype" id="7233873">byte</span><span class="op" id="7233877">(</span><span class="ident" id="7233878">test</span><span class="op" id="7233882">.</span><span class="ident" id="7233883">cert</span>&nbsp;<span class="op" id="7233888">+</span>&nbsp;<span class="ident" id="7233890">test</span><span class="op" id="7233894">.</span><span class="ident" id="7233895">key</span><span class="op" id="7233898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7233902">if</span>&nbsp;<span class="ident" id="7233905">_</span><span class="op" id="7233906">,</span>&nbsp;<span class="ident" id="7233908">err</span>&nbsp;<span class="op" id="7233912">:=</span>&nbsp;<span class="ident" id="7233915">X509KeyPair</span><span class="op" id="7233926">(</span><span class="ident" id="7233927">pem</span><span class="op" id="7233930">,</span>&nbsp;<span class="ident" id="7233932">pem</span><span class="op" id="7233935">)</span><span class="op" id="7233936">;</span>&nbsp;<span class="ident" id="7233938">err</span>&nbsp;<span class="op" id="7233942">!=</span>&nbsp;<span class="ident" id="7233945">nil</span>&nbsp;<span class="op" id="7233949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7233954">t</span><span class="op" id="7233955">.</span><span class="ident" id="7233956">Errorf</span><span class="op" id="7233962">(</span><span class="string" id="7233963">&#34;Failed&nbsp;to&nbsp;load&nbsp;%s&nbsp;cert&nbsp;followed&nbsp;by&nbsp;%s&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="7234010">,</span>&nbsp;<span class="ident" id="7234012">test</span><span class="op" id="7234016">.</span><span class="ident" id="7234017">algo</span><span class="op" id="7234021">,</span>&nbsp;<span class="ident" id="7234023">test</span><span class="op" id="7234027">.</span><span class="ident" id="7234028">algo</span><span class="op" id="7234032">,</span>&nbsp;<span class="ident" id="7234034">err</span><span class="op" id="7234037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7234041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7234045">pem</span>&nbsp;<span class="op" id="7234049">=</span>&nbsp;<span class="op" id="7234051">[</span><span class="op" id="7234052">]</span><span class="builtintype" id="7234053">byte</span><span class="op" id="7234057">(</span><span class="ident" id="7234058">test</span><span class="op" id="7234062">.</span><span class="ident" id="7234063">key</span>&nbsp;<span class="op" id="7234067">+</span>&nbsp;<span class="ident" id="7234069">test</span><span class="op" id="7234073">.</span><span class="ident" id="7234074">cert</span><span class="op" id="7234078">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7234082">if</span>&nbsp;<span class="ident" id="7234085">_</span><span class="op" id="7234086">,</span>&nbsp;<span class="ident" id="7234088">err</span>&nbsp;<span class="op" id="7234092">:=</span>&nbsp;<span class="ident" id="7234095">X509KeyPair</span><span class="op" id="7234106">(</span><span class="ident" id="7234107">pem</span><span class="op" id="7234110">,</span>&nbsp;<span class="ident" id="7234112">pem</span><span class="op" id="7234115">)</span><span class="op" id="7234116">;</span>&nbsp;<span class="ident" id="7234118">err</span>&nbsp;<span class="op" id="7234122">!=</span>&nbsp;<span class="ident" id="7234125">nil</span>&nbsp;<span class="op" id="7234129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7234134">t</span><span class="op" id="7234135">.</span><span class="ident" id="7234136">Errorf</span><span class="op" id="7234142">(</span><span class="string" id="7234143">&#34;Failed&nbsp;to&nbsp;load&nbsp;%s&nbsp;key&nbsp;followed&nbsp;by&nbsp;%s&nbsp;cert:&nbsp;%s&#34;</span><span class="op" id="7234190">,</span>&nbsp;<span class="ident" id="7234192">test</span><span class="op" id="7234196">.</span><span class="ident" id="7234197">algo</span><span class="op" id="7234201">,</span>&nbsp;<span class="ident" id="7234203">test</span><span class="op" id="7234207">.</span><span class="ident" id="7234208">algo</span><span class="op" id="7234212">,</span>&nbsp;<span class="ident" id="7234214">err</span><span class="op" id="7234217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7234221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7234224">}</span><br>
<span class="lineno"></span><span class="op" id="7234226">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="7234229">func</span>&nbsp;<span class="ident" id="7234234">TestX509MixedKeyPair</span><span class="op" id="7234254">(</span><span class="ident" id="7234255">t</span>&nbsp;<span class="op" id="7234257">*</span><span class="ident" id="7234258">testing</span><span class="op" id="7234265">.</span><span class="ident" id="7234266">T</span><span class="op" id="7234267">)</span>&nbsp;<span class="op" id="7234269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7234272">if</span>&nbsp;<span class="ident" id="7234275">_</span><span class="op" id="7234276">,</span>&nbsp;<span class="ident" id="7234278">err</span>&nbsp;<span class="op" id="7234282">:=</span>&nbsp;<span class="ident" id="7234285">X509KeyPair</span><span class="op" id="7234296">(</span><span class="op" id="7234297">[</span><span class="op" id="7234298">]</span><span class="builtintype" id="7234299">byte</span><span class="op" id="7234303">(</span><span class="ident" id="7234304">rsaCertPEM</span><span class="op" id="7234314">)</span><span class="op" id="7234315">,</span>&nbsp;<span class="op" id="7234317">[</span><span class="op" id="7234318">]</span><span class="builtintype" id="7234319">byte</span><span class="op" id="7234323">(</span><span class="ident" id="7234324">ecdsaKeyPEM</span><span class="op" id="7234335">)</span><span class="op" id="7234336">)</span><span class="op" id="7234337">;</span>&nbsp;<span class="ident" id="7234339">err</span>&nbsp;<span class="op" id="7234343">==</span>&nbsp;<span class="ident" id="7234346">nil</span>&nbsp;<span class="op" id="7234350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7234354">t</span><span class="op" id="7234355">.</span><span class="ident" id="7234356">Error</span><span class="op" id="7234361">(</span><span class="string" id="7234362">&#34;Load&nbsp;of&nbsp;RSA&nbsp;certificate&nbsp;succeeded&nbsp;with&nbsp;ECDSA&nbsp;private&nbsp;key&#34;</span><span class="op" id="7234420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7234423">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7234426">if</span>&nbsp;<span class="ident" id="7234429">_</span><span class="op" id="7234430">,</span>&nbsp;<span class="ident" id="7234432">err</span>&nbsp;<span class="op" id="7234436">:=</span>&nbsp;<span class="ident" id="7234439">X509KeyPair</span><span class="op" id="7234450">(</span><span class="op" id="7234451">[</span><span class="op" id="7234452">]</span><span class="builtintype" id="7234453">byte</span><span class="op" id="7234457">(</span><span class="ident" id="7234458">ecdsaCertPEM</span><span class="op" id="7234470">)</span><span class="op" id="7234471">,</span>&nbsp;<span class="op" id="7234473">[</span><span class="op" id="7234474">]</span><span class="builtintype" id="7234475">byte</span><span class="op" id="7234479">(</span><span class="ident" id="7234480">rsaKeyPEM</span><span class="op" id="7234489">)</span><span class="op" id="7234490">)</span><span class="op" id="7234491">;</span>&nbsp;<span class="ident" id="7234493">err</span>&nbsp;<span class="op" id="7234497">==</span>&nbsp;<span class="ident" id="7234500">nil</span>&nbsp;<span class="op" id="7234504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7234508">t</span><span class="op" id="7234509">.</span><span class="ident" id="7234510">Error</span><span class="op" id="7234515">(</span><span class="string" id="7234516">&#34;Load&nbsp;of&nbsp;ECDSA&nbsp;certificate&nbsp;succeeded&nbsp;with&nbsp;RSA&nbsp;private&nbsp;key&#34;</span><span class="op" id="7234574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7234577">}</span><br>
<span class="lineno"></span><span class="op" id="7234579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="7234582">func</span>&nbsp;<span class="ident" id="7234587">newLocalListener</span><span class="op" id="7234603">(</span><span class="ident" id="7234604">t</span>&nbsp;<span class="op" id="7234606">*</span><span class="ident" id="7234607">testing</span><span class="op" id="7234614">.</span><span class="ident" id="7234615">T</span><span class="op" id="7234616">)</span>&nbsp;<span class="ident" id="7234618">net</span><span class="op" id="7234621">.</span><span class="ident" id="7234622">Listener</span>&nbsp;<span class="op" id="7234631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7234634">ln</span><span class="op" id="7234636">,</span>&nbsp;<span class="ident" id="7234638">err</span>&nbsp;<span class="op" id="7234642">:=</span>&nbsp;<span class="ident" id="7234645">net</span><span class="op" id="7234648">.</span><span class="ident" id="7234649">Listen</span><span class="op" id="7234655">(</span><span class="string" id="7234656">&#34;tcp&#34;</span><span class="op" id="7234661">,</span>&nbsp;<span class="string" id="7234663">&#34;127.0.0.1:0&#34;</span><span class="op" id="7234676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7234679">if</span>&nbsp;<span class="ident" id="7234682">err</span>&nbsp;<span class="op" id="7234686">!=</span>&nbsp;<span class="ident" id="7234689">nil</span>&nbsp;<span class="op" id="7234693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7234697">ln</span><span class="op" id="7234699">,</span>&nbsp;<span class="ident" id="7234701">err</span>&nbsp;<span class="op" id="7234705">=</span>&nbsp;<span class="ident" id="7234707">net</span><span class="op" id="7234710">.</span><span class="ident" id="7234711">Listen</span><span class="op" id="7234717">(</span><span class="string" id="7234718">&#34;tcp6&#34;</span><span class="op" id="7234724">,</span>&nbsp;<span class="string" id="7234726">&#34;[::1]:0&#34;</span><span class="op" id="7234735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7234738">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7234741">if</span>&nbsp;<span class="ident" id="7234744">err</span>&nbsp;<span class="op" id="7234748">!=</span>&nbsp;<span class="ident" id="7234751">nil</span>&nbsp;<span class="op" id="7234755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7234759">t</span><span class="op" id="7234760">.</span><span class="ident" id="7234761">Fatal</span><span class="op" id="7234766">(</span><span class="ident" id="7234767">err</span><span class="op" id="7234770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7234773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7234776">return</span>&nbsp;<span class="ident" id="7234783">ln</span><br>
<span class="lineno"></span><span class="op" id="7234786">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="7234789">func</span>&nbsp;<span class="ident" id="7234794">TestDialTimeout</span><span class="op" id="7234809">(</span><span class="ident" id="7234810">t</span>&nbsp;<span class="op" id="7234812">*</span><span class="ident" id="7234813">testing</span><span class="op" id="7234820">.</span><span class="ident" id="7234821">T</span><span class="op" id="7234822">)</span>&nbsp;<span class="op" id="7234824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7234827">if</span>&nbsp;<span class="ident" id="7234830">testing</span><span class="op" id="7234837">.</span><span class="ident" id="7234838">Short</span><span class="op" id="7234843">(</span><span class="op" id="7234844">)</span>&nbsp;<span class="op" id="7234846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7234850">t</span><span class="op" id="7234851">.</span><span class="ident" id="7234852">Skip</span><span class="op" id="7234856">(</span><span class="string" id="7234857">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="7234881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7234884">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7234887">listener</span>&nbsp;<span class="op" id="7234896">:=</span>&nbsp;<span class="ident" id="7234899">newLocalListener</span><span class="op" id="7234915">(</span><span class="ident" id="7234916">t</span><span class="op" id="7234917">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7234921">addr</span>&nbsp;<span class="op" id="7234926">:=</span>&nbsp;<span class="ident" id="7234929">listener</span><span class="op" id="7234937">.</span><span class="ident" id="7234938">Addr</span><span class="op" id="7234942">(</span><span class="op" id="7234943">)</span><span class="op" id="7234944">.</span><span class="ident" id="7234945">String</span><span class="op" id="7234951">(</span><span class="op" id="7234952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7234955">defer</span>&nbsp;<span class="ident" id="7234961">listener</span><span class="op" id="7234969">.</span><span class="ident" id="7234970">Close</span><span class="op" id="7234975">(</span><span class="op" id="7234976">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7234980">complete</span>&nbsp;<span class="op" id="7234989">:=</span>&nbsp;<span class="builtinfunc" id="7234992">make</span><span class="op" id="7234996">(</span><span class="keyword" id="7234997">chan</span>&nbsp;<span class="builtintype" id="7235002">bool</span><span class="op" id="7235006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7235009">defer</span>&nbsp;<span class="builtinfunc" id="7235015">close</span><span class="op" id="7235020">(</span><span class="ident" id="7235021">complete</span><span class="op" id="7235029">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7235033">go</span>&nbsp;<span class="keyword" id="7235036">func</span><span class="op" id="7235040">(</span><span class="op" id="7235041">)</span>&nbsp;<span class="op" id="7235043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7235047">conn</span><span class="op" id="7235051">,</span>&nbsp;<span class="ident" id="7235053">err</span>&nbsp;<span class="op" id="7235057">:=</span>&nbsp;<span class="ident" id="7235060">listener</span><span class="op" id="7235068">.</span><span class="ident" id="7235069">Accept</span><span class="op" id="7235075">(</span><span class="op" id="7235076">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7235080">if</span>&nbsp;<span class="ident" id="7235083">err</span>&nbsp;<span class="op" id="7235087">!=</span>&nbsp;<span class="ident" id="7235090">nil</span>&nbsp;<span class="op" id="7235094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7235099">t</span><span class="op" id="7235100">.</span><span class="ident" id="7235101">Error</span><span class="op" id="7235106">(</span><span class="ident" id="7235107">err</span><span class="op" id="7235110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7235115">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7235124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7235128">&lt;-</span><span class="ident" id="7235130">complete</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7235141">conn</span><span class="op" id="7235145">.</span><span class="ident" id="7235146">Close</span><span class="op" id="7235151">(</span><span class="op" id="7235152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7235155">}</span><span class="op" id="7235156">(</span><span class="op" id="7235157">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7235161">dialer</span>&nbsp;<span class="op" id="7235168">:=</span>&nbsp;<span class="op" id="7235171">&amp;</span><span class="ident" id="7235172">net</span><span class="op" id="7235175">.</span><span class="ident" id="7235176">Dialer</span><span class="op" id="7235182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7235186">Timeout</span><span class="op" id="7235193">:</span>&nbsp;<span class="num" id="7235195">10</span>&nbsp;<span class="op" id="7235198">*</span>&nbsp;<span class="ident" id="7235200">time</span><span class="op" id="7235204">.</span><span class="ident" id="7235205">Millisecond</span><span class="op" id="7235216">,</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7235219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7235223">var</span>&nbsp;<span class="ident" id="7235227">err</span>&nbsp;<span class="builtintype" id="7235231">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7235238">if</span>&nbsp;<span class="ident" id="7235241">_</span><span class="op" id="7235242">,</span>&nbsp;<span class="ident" id="7235244">err</span>&nbsp;<span class="op" id="7235248">=</span>&nbsp;<span class="ident" id="7235250">DialWithDialer</span><span class="op" id="7235264">(</span><span class="ident" id="7235265">dialer</span><span class="op" id="7235271">,</span>&nbsp;<span class="string" id="7235273">&#34;tcp&#34;</span><span class="op" id="7235278">,</span>&nbsp;<span class="ident" id="7235280">addr</span><span class="op" id="7235284">,</span>&nbsp;<span class="ident" id="7235286">nil</span><span class="op" id="7235289">)</span><span class="op" id="7235290">;</span>&nbsp;<span class="ident" id="7235292">err</span>&nbsp;<span class="op" id="7235296">==</span>&nbsp;<span class="ident" id="7235299">nil</span>&nbsp;<span class="op" id="7235303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7235307">t</span><span class="op" id="7235308">.</span><span class="ident" id="7235309">Fatal</span><span class="op" id="7235314">(</span><span class="string" id="7235315">&#34;DialWithTimeout&nbsp;completed&nbsp;successfully&#34;</span><span class="op" id="7235355">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7235358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7235362">if</span>&nbsp;<span class="op" id="7235365">!</span><span class="ident" id="7235366">strings</span><span class="op" id="7235373">.</span><span class="ident" id="7235374">Contains</span><span class="op" id="7235382">(</span><span class="ident" id="7235383">err</span><span class="op" id="7235386">.</span><span class="ident" id="7235387">Error</span><span class="op" id="7235392">(</span><span class="op" id="7235393">)</span><span class="op" id="7235394">,</span>&nbsp;<span class="string" id="7235396">&#34;timed&nbsp;out&#34;</span><span class="op" id="7235407">)</span>&nbsp;<span class="op" id="7235409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7235413">t</span><span class="op" id="7235414">.</span><span class="ident" id="7235415">Errorf</span><span class="op" id="7235421">(</span><span class="string" id="7235422">&#34;resulting&nbsp;error&nbsp;not&nbsp;a&nbsp;timeout:&nbsp;%s&#34;</span><span class="op" id="7235457">,</span>&nbsp;<span class="ident" id="7235459">err</span><span class="op" id="7235462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7235465">}</span><br>
<span class="lineno">160</span><span class="op" id="7235467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7235470">//&nbsp;tests&nbsp;that&nbsp;Conn.Read&nbsp;returns&nbsp;(non-zero,&nbsp;io.EOF)&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="7235532">//&nbsp;(non-zero,&nbsp;nil)&nbsp;when&nbsp;a&nbsp;Close&nbsp;(alertCloseNotify)&nbsp;is&nbsp;sitting&nbsp;right</span><br>
<span class="lineno"></span><span class="comment" id="7235600">//&nbsp;behind&nbsp;the&nbsp;application&nbsp;data&nbsp;in&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">165</span><span class="keyword" id="7235646">func</span>&nbsp;<span class="ident" id="7235651">TestConnReadNonzeroAndEOF</span><span class="op" id="7235676">(</span><span class="ident" id="7235677">t</span>&nbsp;<span class="op" id="7235679">*</span><span class="ident" id="7235680">testing</span><span class="op" id="7235687">.</span><span class="ident" id="7235688">T</span><span class="op" id="7235689">)</span>&nbsp;<span class="op" id="7235691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7235694">//&nbsp;This&nbsp;test&nbsp;is&nbsp;racy:&nbsp;it&nbsp;assumes&nbsp;that&nbsp;after&nbsp;a&nbsp;write&nbsp;to&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7235752">//&nbsp;localhost&nbsp;TCP&nbsp;connection,&nbsp;the&nbsp;peer&nbsp;TCP&nbsp;connection&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7235810">//&nbsp;immediately&nbsp;read&nbsp;it.&nbsp;&nbsp;Because&nbsp;it&#39;s&nbsp;racy,&nbsp;we&nbsp;skip&nbsp;this&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7235873">//&nbsp;in&nbsp;short&nbsp;mode,&nbsp;and&nbsp;then&nbsp;retry&nbsp;it&nbsp;several&nbsp;times&nbsp;with&nbsp;an</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7235932">//&nbsp;increasing&nbsp;sleep&nbsp;in&nbsp;between&nbsp;our&nbsp;final&nbsp;write&nbsp;(via&nbsp;srv.Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7235995">//&nbsp;below)&nbsp;and&nbsp;the&nbsp;following&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7236030">if</span>&nbsp;<span class="ident" id="7236033">testing</span><span class="op" id="7236040">.</span><span class="ident" id="7236041">Short</span><span class="op" id="7236046">(</span><span class="op" id="7236047">)</span>&nbsp;<span class="op" id="7236049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7236053">t</span><span class="op" id="7236054">.</span><span class="ident" id="7236055">Skip</span><span class="op" id="7236059">(</span><span class="string" id="7236060">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="7236084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7236087">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7236090">var</span>&nbsp;<span class="ident" id="7236094">err</span>&nbsp;<span class="builtintype" id="7236098">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7236105">for</span>&nbsp;<span class="ident" id="7236109">delay</span>&nbsp;<span class="op" id="7236115">:=</span>&nbsp;<span class="ident" id="7236118">time</span><span class="op" id="7236122">.</span><span class="ident" id="7236123">Millisecond</span><span class="op" id="7236134">;</span>&nbsp;<span class="ident" id="7236136">delay</span>&nbsp;<span class="op" id="7236142">&lt;=</span>&nbsp;<span class="num" id="7236145">64</span><span class="op" id="7236147">*</span><span class="ident" id="7236148">time</span><span class="op" id="7236152">.</span><span class="ident" id="7236153">Millisecond</span><span class="op" id="7236164">;</span>&nbsp;<span class="ident" id="7236166">delay</span>&nbsp;<span class="op" id="7236172">*=</span>&nbsp;<span class="num" id="7236175">2</span>&nbsp;<span class="op" id="7236177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7236181">if</span>&nbsp;<span class="ident" id="7236184">err</span>&nbsp;<span class="op" id="7236188">=</span>&nbsp;<span class="ident" id="7236190">testConnReadNonzeroAndEOF</span><span class="op" id="7236215">(</span><span class="ident" id="7236216">t</span><span class="op" id="7236217">,</span>&nbsp;<span class="ident" id="7236219">delay</span><span class="op" id="7236224">)</span><span class="op" id="7236225">;</span>&nbsp;<span class="ident" id="7236227">err</span>&nbsp;<span class="op" id="7236231">==</span>&nbsp;<span class="ident" id="7236234">nil</span>&nbsp;<span class="op" id="7236238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7236243">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7236252">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7236255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7236258">t</span><span class="op" id="7236259">.</span><span class="ident" id="7236260">Error</span><span class="op" id="7236265">(</span><span class="ident" id="7236266">err</span><span class="op" id="7236269">)</span><br>
<span class="lineno"></span><span class="op" id="7236271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7236274">func</span>&nbsp;<span class="ident" id="7236279">testConnReadNonzeroAndEOF</span><span class="op" id="7236304">(</span><span class="ident" id="7236305">t</span>&nbsp;<span class="op" id="7236307">*</span><span class="ident" id="7236308">testing</span><span class="op" id="7236315">.</span><span class="ident" id="7236316">T</span><span class="op" id="7236317">,</span>&nbsp;<span class="ident" id="7236319">delay</span>&nbsp;<span class="ident" id="7236325">time</span><span class="op" id="7236329">.</span><span class="ident" id="7236330">Duration</span><span class="op" id="7236338">)</span>&nbsp;<span class="builtintype" id="7236340">error</span>&nbsp;<span class="op" id="7236346">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7236349">ln</span>&nbsp;<span class="op" id="7236352">:=</span>&nbsp;<span class="ident" id="7236355">newLocalListener</span><span class="op" id="7236371">(</span><span class="ident" id="7236372">t</span><span class="op" id="7236373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7236376">defer</span>&nbsp;<span class="ident" id="7236382">ln</span><span class="op" id="7236384">.</span><span class="ident" id="7236385">Close</span><span class="op" id="7236390">(</span><span class="op" id="7236391">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7236395">srvCh</span>&nbsp;<span class="op" id="7236401">:=</span>&nbsp;<span class="builtinfunc" id="7236404">make</span><span class="op" id="7236408">(</span><span class="keyword" id="7236409">chan</span>&nbsp;<span class="op" id="7236414">*</span><span class="ident" id="7236415">Conn</span><span class="op" id="7236419">,</span>&nbsp;<span class="num" id="7236421">1</span><span class="op" id="7236422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7236425">var</span>&nbsp;<span class="ident" id="7236429">serr</span>&nbsp;<span class="builtintype" id="7236434">error</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7236441">go</span>&nbsp;<span class="keyword" id="7236444">func</span><span class="op" id="7236448">(</span><span class="op" id="7236449">)</span>&nbsp;<span class="op" id="7236451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7236455">sconn</span><span class="op" id="7236460">,</span>&nbsp;<span class="ident" id="7236462">err</span>&nbsp;<span class="op" id="7236466">:=</span>&nbsp;<span class="ident" id="7236469">ln</span><span class="op" id="7236471">.</span><span class="ident" id="7236472">Accept</span><span class="op" id="7236478">(</span><span class="op" id="7236479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7236483">if</span>&nbsp;<span class="ident" id="7236486">err</span>&nbsp;<span class="op" id="7236490">!=</span>&nbsp;<span class="ident" id="7236493">nil</span>&nbsp;<span class="op" id="7236497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7236502">serr</span>&nbsp;<span class="op" id="7236507">=</span>&nbsp;<span class="ident" id="7236509">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7236516">srvCh</span>&nbsp;<span class="op" id="7236522">&lt;-</span>&nbsp;<span class="ident" id="7236525">nil</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7236532">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7236541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7236545">serverConfig</span>&nbsp;<span class="op" id="7236558">:=</span>&nbsp;<span class="op" id="7236561">*</span><span class="ident" id="7236562">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7236575">srv</span>&nbsp;<span class="op" id="7236579">:=</span>&nbsp;<span class="ident" id="7236582">Server</span><span class="op" id="7236588">(</span><span class="ident" id="7236589">sconn</span><span class="op" id="7236594">,</span>&nbsp;<span class="op" id="7236596">&amp;</span><span class="ident" id="7236597">serverConfig</span><span class="op" id="7236609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7236613">if</span>&nbsp;<span class="ident" id="7236616">err</span>&nbsp;<span class="op" id="7236620">:=</span>&nbsp;<span class="ident" id="7236623">srv</span><span class="op" id="7236626">.</span><span class="ident" id="7236627">Handshake</span><span class="op" id="7236636">(</span><span class="op" id="7236637">)</span><span class="op" id="7236638">;</span>&nbsp;<span class="ident" id="7236640">err</span>&nbsp;<span class="op" id="7236644">!=</span>&nbsp;<span class="ident" id="7236647">nil</span>&nbsp;<span class="op" id="7236651">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7236656">serr</span>&nbsp;<span class="op" id="7236661">=</span>&nbsp;<span class="ident" id="7236663">fmt</span><span class="op" id="7236666">.</span><span class="ident" id="7236667">Errorf</span><span class="op" id="7236673">(</span><span class="string" id="7236674">&#34;handshake:&nbsp;%v&#34;</span><span class="op" id="7236689">,</span>&nbsp;<span class="ident" id="7236691">err</span><span class="op" id="7236694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7236699">srvCh</span>&nbsp;<span class="op" id="7236705">&lt;-</span>&nbsp;<span class="ident" id="7236708">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7236715">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7236724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7236728">srvCh</span>&nbsp;<span class="op" id="7236734">&lt;-</span>&nbsp;<span class="ident" id="7236737">srv</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7236742">}</span><span class="op" id="7236743">(</span><span class="op" id="7236744">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7236748">clientConfig</span>&nbsp;<span class="op" id="7236761">:=</span>&nbsp;<span class="op" id="7236764">*</span><span class="ident" id="7236765">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7236777">conn</span><span class="op" id="7236781">,</span>&nbsp;<span class="ident" id="7236783">err</span>&nbsp;<span class="op" id="7236787">:=</span>&nbsp;<span class="ident" id="7236790">Dial</span><span class="op" id="7236794">(</span><span class="string" id="7236795">&#34;tcp&#34;</span><span class="op" id="7236800">,</span>&nbsp;<span class="ident" id="7236802">ln</span><span class="op" id="7236804">.</span><span class="ident" id="7236805">Addr</span><span class="op" id="7236809">(</span><span class="op" id="7236810">)</span><span class="op" id="7236811">.</span><span class="ident" id="7236812">String</span><span class="op" id="7236818">(</span><span class="op" id="7236819">)</span><span class="op" id="7236820">,</span>&nbsp;<span class="op" id="7236822">&amp;</span><span class="ident" id="7236823">clientConfig</span><span class="op" id="7236835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7236838">if</span>&nbsp;<span class="ident" id="7236841">err</span>&nbsp;<span class="op" id="7236845">!=</span>&nbsp;<span class="ident" id="7236848">nil</span>&nbsp;<span class="op" id="7236852">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7236856">t</span><span class="op" id="7236857">.</span><span class="ident" id="7236858">Fatal</span><span class="op" id="7236863">(</span><span class="ident" id="7236864">err</span><span class="op" id="7236867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7236870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7236873">defer</span>&nbsp;<span class="ident" id="7236879">conn</span><span class="op" id="7236883">.</span><span class="ident" id="7236884">Close</span><span class="op" id="7236889">(</span><span class="op" id="7236890">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7236894">srv</span>&nbsp;<span class="op" id="7236898">:=</span>&nbsp;<span class="op" id="7236901">&lt;-</span><span class="ident" id="7236903">srvCh</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7236910">if</span>&nbsp;<span class="ident" id="7236913">srv</span>&nbsp;<span class="op" id="7236917">==</span>&nbsp;<span class="ident" id="7236920">nil</span>&nbsp;<span class="op" id="7236924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7236928">return</span>&nbsp;<span class="ident" id="7236935">serr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7236941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7236945">buf</span>&nbsp;<span class="op" id="7236949">:=</span>&nbsp;<span class="builtinfunc" id="7236952">make</span><span class="op" id="7236956">(</span><span class="op" id="7236957">[</span><span class="op" id="7236958">]</span><span class="builtintype" id="7236959">byte</span><span class="op" id="7236963">,</span>&nbsp;<span class="num" id="7236965">6</span><span class="op" id="7236966">)</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7236970">srv</span><span class="op" id="7236973">.</span><span class="ident" id="7236974">Write</span><span class="op" id="7236979">(</span><span class="op" id="7236980">[</span><span class="op" id="7236981">]</span><span class="builtintype" id="7236982">byte</span><span class="op" id="7236986">(</span><span class="string" id="7236987">&#34;foobar&#34;</span><span class="op" id="7236995">)</span><span class="op" id="7236996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7236999">n</span><span class="op" id="7237000">,</span>&nbsp;<span class="ident" id="7237002">err</span>&nbsp;<span class="op" id="7237006">:=</span>&nbsp;<span class="ident" id="7237009">conn</span><span class="op" id="7237013">.</span><span class="ident" id="7237014">Read</span><span class="op" id="7237018">(</span><span class="ident" id="7237019">buf</span><span class="op" id="7237022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7237025">if</span>&nbsp;<span class="ident" id="7237028">n</span>&nbsp;<span class="op" id="7237030">!=</span>&nbsp;<span class="num" id="7237033">6</span>&nbsp;<span class="op" id="7237035">||</span>&nbsp;<span class="ident" id="7237038">err</span>&nbsp;<span class="op" id="7237042">!=</span>&nbsp;<span class="ident" id="7237045">nil</span>&nbsp;<span class="op" id="7237049">||</span>&nbsp;<span class="builtintype" id="7237052">string</span><span class="op" id="7237058">(</span><span class="ident" id="7237059">buf</span><span class="op" id="7237062">)</span>&nbsp;<span class="op" id="7237064">!=</span>&nbsp;<span class="string" id="7237067">&#34;foobar&#34;</span>&nbsp;<span class="op" id="7237076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7237080">return</span>&nbsp;<span class="ident" id="7237087">fmt</span><span class="op" id="7237090">.</span><span class="ident" id="7237091">Errorf</span><span class="op" id="7237097">(</span><span class="string" id="7237098">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v,&nbsp;data&nbsp;%q;&nbsp;want&nbsp;6,&nbsp;nil,&nbsp;foobar&#34;</span><span class="op" id="7237143">,</span>&nbsp;<span class="ident" id="7237145">n</span><span class="op" id="7237146">,</span>&nbsp;<span class="ident" id="7237148">err</span><span class="op" id="7237151">,</span>&nbsp;<span class="ident" id="7237153">buf</span><span class="op" id="7237156">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7237159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7237163">srv</span><span class="op" id="7237166">.</span><span class="ident" id="7237167">Write</span><span class="op" id="7237172">(</span><span class="op" id="7237173">[</span><span class="op" id="7237174">]</span><span class="builtintype" id="7237175">byte</span><span class="op" id="7237179">(</span><span class="string" id="7237180">&#34;abcdef&#34;</span><span class="op" id="7237188">)</span><span class="op" id="7237189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7237192">srv</span><span class="op" id="7237195">.</span><span class="ident" id="7237196">Close</span><span class="op" id="7237201">(</span><span class="op" id="7237202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7237205">time</span><span class="op" id="7237209">.</span><span class="ident" id="7237210">Sleep</span><span class="op" id="7237215">(</span><span class="ident" id="7237216">delay</span><span class="op" id="7237221">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7237224">n</span><span class="op" id="7237225">,</span>&nbsp;<span class="ident" id="7237227">err</span>&nbsp;<span class="op" id="7237231">=</span>&nbsp;<span class="ident" id="7237233">conn</span><span class="op" id="7237237">.</span><span class="ident" id="7237238">Read</span><span class="op" id="7237242">(</span><span class="ident" id="7237243">buf</span><span class="op" id="7237246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7237249">if</span>&nbsp;<span class="ident" id="7237252">n</span>&nbsp;<span class="op" id="7237254">!=</span>&nbsp;<span class="num" id="7237257">6</span>&nbsp;<span class="op" id="7237259">||</span>&nbsp;<span class="builtintype" id="7237262">string</span><span class="op" id="7237268">(</span><span class="ident" id="7237269">buf</span><span class="op" id="7237272">)</span>&nbsp;<span class="op" id="7237274">!=</span>&nbsp;<span class="string" id="7237277">&#34;abcdef&#34;</span>&nbsp;<span class="op" id="7237286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7237290">return</span>&nbsp;<span class="ident" id="7237297">fmt</span><span class="op" id="7237300">.</span><span class="ident" id="7237301">Errorf</span><span class="op" id="7237307">(</span><span class="string" id="7237308">&#34;Read&nbsp;=&nbsp;%d,&nbsp;buf=&nbsp;%q;&nbsp;want&nbsp;6,&nbsp;abcdef&#34;</span><span class="op" id="7237344">,</span>&nbsp;<span class="ident" id="7237346">n</span><span class="op" id="7237347">,</span>&nbsp;<span class="ident" id="7237349">buf</span><span class="op" id="7237352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7237355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7237358">if</span>&nbsp;<span class="ident" id="7237361">err</span>&nbsp;<span class="op" id="7237365">!=</span>&nbsp;<span class="ident" id="7237368">io</span><span class="op" id="7237370">.</span><span class="ident" id="7237371">EOF</span>&nbsp;<span class="op" id="7237375">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7237379">return</span>&nbsp;<span class="ident" id="7237386">fmt</span><span class="op" id="7237389">.</span><span class="ident" id="7237390">Errorf</span><span class="op" id="7237396">(</span><span class="string" id="7237397">&#34;Second&nbsp;Read&nbsp;error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="7237434">,</span>&nbsp;<span class="ident" id="7237436">err</span><span class="op" id="7237439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7237442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7237445">return</span>&nbsp;<span class="ident" id="7237452">nil</span><br>
<span class="lineno"></span><span class="op" id="7237456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="7237459">func</span>&nbsp;<span class="ident" id="7237464">TestTLSUniqueMatches</span><span class="op" id="7237484">(</span><span class="ident" id="7237485">t</span>&nbsp;<span class="op" id="7237487">*</span><span class="ident" id="7237488">testing</span><span class="op" id="7237495">.</span><span class="ident" id="7237496">T</span><span class="op" id="7237497">)</span>&nbsp;<span class="op" id="7237499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7237502">ln</span>&nbsp;<span class="op" id="7237505">:=</span>&nbsp;<span class="ident" id="7237508">newLocalListener</span><span class="op" id="7237524">(</span><span class="ident" id="7237525">t</span><span class="op" id="7237526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7237529">defer</span>&nbsp;<span class="ident" id="7237535">ln</span><span class="op" id="7237537">.</span><span class="ident" id="7237538">Close</span><span class="op" id="7237543">(</span><span class="op" id="7237544">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7237548">serverTLSUniques</span>&nbsp;<span class="op" id="7237565">:=</span>&nbsp;<span class="builtinfunc" id="7237568">make</span><span class="op" id="7237572">(</span><span class="keyword" id="7237573">chan</span>&nbsp;<span class="op" id="7237578">[</span><span class="op" id="7237579">]</span><span class="builtintype" id="7237580">byte</span><span class="op" id="7237584">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7237587">go</span>&nbsp;<span class="keyword" id="7237590">func</span><span class="op" id="7237594">(</span><span class="op" id="7237595">)</span>&nbsp;<span class="op" id="7237597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7237601">for</span>&nbsp;<span class="ident" id="7237605">i</span>&nbsp;<span class="op" id="7237607">:=</span>&nbsp;<span class="num" id="7237610">0</span><span class="op" id="7237611">;</span>&nbsp;<span class="ident" id="7237613">i</span>&nbsp;<span class="op" id="7237615">&lt;</span>&nbsp;<span class="num" id="7237617">2</span><span class="op" id="7237618">;</span>&nbsp;<span class="ident" id="7237620">i</span><span class="op" id="7237621">++</span>&nbsp;<span class="op" id="7237624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7237629">sconn</span><span class="op" id="7237634">,</span>&nbsp;<span class="ident" id="7237636">err</span>&nbsp;<span class="op" id="7237640">:=</span>&nbsp;<span class="ident" id="7237643">ln</span><span class="op" id="7237645">.</span><span class="ident" id="7237646">Accept</span><span class="op" id="7237652">(</span><span class="op" id="7237653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7237658">if</span>&nbsp;<span class="ident" id="7237661">err</span>&nbsp;<span class="op" id="7237665">!=</span>&nbsp;<span class="ident" id="7237668">nil</span>&nbsp;<span class="op" id="7237672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7237678">t</span><span class="op" id="7237679">.</span><span class="ident" id="7237680">Fatal</span><span class="op" id="7237685">(</span><span class="ident" id="7237686">err</span><span class="op" id="7237689">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7237694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7237699">serverConfig</span>&nbsp;<span class="op" id="7237712">:=</span>&nbsp;<span class="op" id="7237715">*</span><span class="ident" id="7237716">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7237730">srv</span>&nbsp;<span class="op" id="7237734">:=</span>&nbsp;<span class="ident" id="7237737">Server</span><span class="op" id="7237743">(</span><span class="ident" id="7237744">sconn</span><span class="op" id="7237749">,</span>&nbsp;<span class="op" id="7237751">&amp;</span><span class="ident" id="7237752">serverConfig</span><span class="op" id="7237764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7237769">if</span>&nbsp;<span class="ident" id="7237772">err</span>&nbsp;<span class="op" id="7237776">:=</span>&nbsp;<span class="ident" id="7237779">srv</span><span class="op" id="7237782">.</span><span class="ident" id="7237783">Handshake</span><span class="op" id="7237792">(</span><span class="op" id="7237793">)</span><span class="op" id="7237794">;</span>&nbsp;<span class="ident" id="7237796">err</span>&nbsp;<span class="op" id="7237800">!=</span>&nbsp;<span class="ident" id="7237803">nil</span>&nbsp;<span class="op" id="7237807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7237813">t</span><span class="op" id="7237814">.</span><span class="ident" id="7237815">Fatal</span><span class="op" id="7237820">(</span><span class="ident" id="7237821">err</span><span class="op" id="7237824">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7237829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7237834">serverTLSUniques</span>&nbsp;<span class="op" id="7237851">&lt;-</span>&nbsp;<span class="ident" id="7237854">srv</span><span class="op" id="7237857">.</span><span class="ident" id="7237858">ConnectionState</span><span class="op" id="7237873">(</span><span class="op" id="7237874">)</span><span class="op" id="7237875">.</span><span class="ident" id="7237876">TLSUnique</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7237888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7237891">}</span><span class="op" id="7237892">(</span><span class="op" id="7237893">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7237897">clientConfig</span>&nbsp;<span class="op" id="7237910">:=</span>&nbsp;<span class="op" id="7237913">*</span><span class="ident" id="7237914">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7237926">clientConfig</span><span class="op" id="7237938">.</span><span class="ident" id="7237939">ClientSessionCache</span>&nbsp;<span class="op" id="7237958">=</span>&nbsp;<span class="ident" id="7237960">NewLRUClientSessionCache</span><span class="op" id="7237984">(</span><span class="num" id="7237985">1</span><span class="op" id="7237986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7237989">conn</span><span class="op" id="7237993">,</span>&nbsp;<span class="ident" id="7237995">err</span>&nbsp;<span class="op" id="7237999">:=</span>&nbsp;<span class="ident" id="7238002">Dial</span><span class="op" id="7238006">(</span><span class="string" id="7238007">&#34;tcp&#34;</span><span class="op" id="7238012">,</span>&nbsp;<span class="ident" id="7238014">ln</span><span class="op" id="7238016">.</span><span class="ident" id="7238017">Addr</span><span class="op" id="7238021">(</span><span class="op" id="7238022">)</span><span class="op" id="7238023">.</span><span class="ident" id="7238024">String</span><span class="op" id="7238030">(</span><span class="op" id="7238031">)</span><span class="op" id="7238032">,</span>&nbsp;<span class="op" id="7238034">&amp;</span><span class="ident" id="7238035">clientConfig</span><span class="op" id="7238047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7238050">if</span>&nbsp;<span class="ident" id="7238053">err</span>&nbsp;<span class="op" id="7238057">!=</span>&nbsp;<span class="ident" id="7238060">nil</span>&nbsp;<span class="op" id="7238064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7238068">t</span><span class="op" id="7238069">.</span><span class="ident" id="7238070">Fatal</span><span class="op" id="7238075">(</span><span class="ident" id="7238076">err</span><span class="op" id="7238079">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7238082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7238085">if</span>&nbsp;<span class="op" id="7238088">!</span><span class="ident" id="7238089">bytes</span><span class="op" id="7238094">.</span><span class="ident" id="7238095">Equal</span><span class="op" id="7238100">(</span><span class="ident" id="7238101">conn</span><span class="op" id="7238105">.</span><span class="ident" id="7238106">ConnectionState</span><span class="op" id="7238121">(</span><span class="op" id="7238122">)</span><span class="op" id="7238123">.</span><span class="ident" id="7238124">TLSUnique</span><span class="op" id="7238133">,</span>&nbsp;<span class="op" id="7238135">&lt;-</span><span class="ident" id="7238137">serverTLSUniques</span><span class="op" id="7238153">)</span>&nbsp;<span class="op" id="7238155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7238159">t</span><span class="op" id="7238160">.</span><span class="ident" id="7238161">Error</span><span class="op" id="7238166">(</span><span class="string" id="7238167">&#34;client&nbsp;and&nbsp;server&nbsp;channel&nbsp;bindings&nbsp;differ&#34;</span><span class="op" id="7238210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7238213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7238216">conn</span><span class="op" id="7238220">.</span><span class="ident" id="7238221">Close</span><span class="op" id="7238226">(</span><span class="op" id="7238227">)</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7238231">conn</span><span class="op" id="7238235">,</span>&nbsp;<span class="ident" id="7238237">err</span>&nbsp;<span class="op" id="7238241">=</span>&nbsp;<span class="ident" id="7238243">Dial</span><span class="op" id="7238247">(</span><span class="string" id="7238248">&#34;tcp&#34;</span><span class="op" id="7238253">,</span>&nbsp;<span class="ident" id="7238255">ln</span><span class="op" id="7238257">.</span><span class="ident" id="7238258">Addr</span><span class="op" id="7238262">(</span><span class="op" id="7238263">)</span><span class="op" id="7238264">.</span><span class="ident" id="7238265">String</span><span class="op" id="7238271">(</span><span class="op" id="7238272">)</span><span class="op" id="7238273">,</span>&nbsp;<span class="op" id="7238275">&amp;</span><span class="ident" id="7238276">clientConfig</span><span class="op" id="7238288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7238291">if</span>&nbsp;<span class="ident" id="7238294">err</span>&nbsp;<span class="op" id="7238298">!=</span>&nbsp;<span class="ident" id="7238301">nil</span>&nbsp;<span class="op" id="7238305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7238309">t</span><span class="op" id="7238310">.</span><span class="ident" id="7238311">Fatal</span><span class="op" id="7238316">(</span><span class="ident" id="7238317">err</span><span class="op" id="7238320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7238323">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7238326">defer</span>&nbsp;<span class="ident" id="7238332">conn</span><span class="op" id="7238336">.</span><span class="ident" id="7238337">Close</span><span class="op" id="7238342">(</span><span class="op" id="7238343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7238346">if</span>&nbsp;<span class="op" id="7238349">!</span><span class="ident" id="7238350">conn</span><span class="op" id="7238354">.</span><span class="ident" id="7238355">ConnectionState</span><span class="op" id="7238370">(</span><span class="op" id="7238371">)</span><span class="op" id="7238372">.</span><span class="ident" id="7238373">DidResume</span>&nbsp;<span class="op" id="7238383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7238387">t</span><span class="op" id="7238388">.</span><span class="ident" id="7238389">Error</span><span class="op" id="7238394">(</span><span class="string" id="7238395">&#34;second&nbsp;session&nbsp;did&nbsp;not&nbsp;use&nbsp;resumption&#34;</span><span class="op" id="7238434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7238437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7238440">if</span>&nbsp;<span class="op" id="7238443">!</span><span class="ident" id="7238444">bytes</span><span class="op" id="7238449">.</span><span class="ident" id="7238450">Equal</span><span class="op" id="7238455">(</span><span class="ident" id="7238456">conn</span><span class="op" id="7238460">.</span><span class="ident" id="7238461">ConnectionState</span><span class="op" id="7238476">(</span><span class="op" id="7238477">)</span><span class="op" id="7238478">.</span><span class="ident" id="7238479">TLSUnique</span><span class="op" id="7238488">,</span>&nbsp;<span class="op" id="7238490">&lt;-</span><span class="ident" id="7238492">serverTLSUniques</span><span class="op" id="7238508">)</span>&nbsp;<span class="op" id="7238510">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7238514">t</span><span class="op" id="7238515">.</span><span class="ident" id="7238516">Error</span><span class="op" id="7238521">(</span><span class="string" id="7238522">&#34;client&nbsp;and&nbsp;server&nbsp;channel&nbsp;bindings&nbsp;differ&nbsp;when&nbsp;session&nbsp;resumption&nbsp;is&nbsp;used&#34;</span><span class="op" id="7238597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7238600">}</span><br>
<span class="lineno"></span><span class="op" id="7238602">}</span>
</div>
</body>
</html>
