<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html" class="current">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6564376">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6564431">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6564485">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6564536">package</span>&nbsp;<span class="ident" id="6564544">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6564549">import</span>&nbsp;<span class="op" id="6564556">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6564559">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6564566">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6564572">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6564585">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6564596">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6564607">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6564614">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="6564617">func</span>&nbsp;<span class="ident" id="6564622">isTimeout</span><span class="op" id="6564631">(</span><span class="ident" id="6564632">err</span>&nbsp;<span class="builtintype" id="6564636">error</span><span class="op" id="6564641">)</span>&nbsp;<span class="builtintype" id="6564643">bool</span>&nbsp;<span class="op" id="6564648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6564651">e</span><span class="op" id="6564652">,</span>&nbsp;<span class="ident" id="6564654">ok</span>&nbsp;<span class="op" id="6564657">:=</span>&nbsp;<span class="ident" id="6564660">err</span><span class="op" id="6564663">.</span><span class="op" id="6564664">(</span><span class="ident" id="6564665">Error</span><span class="op" id="6564670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6564673">return</span>&nbsp;<span class="ident" id="6564680">ok</span>&nbsp;<span class="op" id="6564683">&amp;&amp;</span>&nbsp;<span class="ident" id="6564686">e</span><span class="op" id="6564687">.</span><span class="ident" id="6564688">Timeout</span><span class="op" id="6564695">(</span><span class="op" id="6564696">)</span><br>
<span class="lineno"></span><span class="op" id="6564698">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="6564701">type</span>&nbsp;<span class="ident" id="6564706">copyRes</span>&nbsp;<span class="keyword" id="6564714">struct</span>&nbsp;<span class="op" id="6564721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6564724">n</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6564728">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6564735">err</span>&nbsp;<span class="builtintype" id="6564739">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6564746">d</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6564750">time</span><span class="op" id="6564754">.</span><span class="ident" id="6564755">Duration</span><br>
<span class="lineno">25</span><span class="op" id="6564764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6564767">func</span>&nbsp;<span class="ident" id="6564772">TestAcceptTimeout</span><span class="op" id="6564789">(</span><span class="ident" id="6564790">t</span>&nbsp;<span class="op" id="6564792">*</span><span class="ident" id="6564793">testing</span><span class="op" id="6564800">.</span><span class="ident" id="6564801">T</span><span class="op" id="6564802">)</span>&nbsp;<span class="op" id="6564804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6564807">switch</span>&nbsp;<span class="ident" id="6564814">runtime</span><span class="op" id="6564821">.</span><span class="ident" id="6564822">GOOS</span>&nbsp;<span class="op" id="6564827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6564830">case</span>&nbsp;<span class="string" id="6564835">&#34;plan9&#34;</span><span class="op" id="6564842">:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6564846">t</span><span class="op" id="6564847">.</span><span class="ident" id="6564848">Skipf</span><span class="op" id="6564853">(</span><span class="string" id="6564854">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6564875">,</span>&nbsp;<span class="ident" id="6564877">runtime</span><span class="op" id="6564884">.</span><span class="ident" id="6564885">GOOS</span><span class="op" id="6564889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6564892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6564896">ln</span>&nbsp;<span class="op" id="6564899">:=</span>&nbsp;<span class="ident" id="6564902">newLocalListener</span><span class="op" id="6564918">(</span><span class="ident" id="6564919">t</span><span class="op" id="6564920">)</span><span class="op" id="6564921">.</span><span class="op" id="6564922">(</span><span class="op" id="6564923">*</span><span class="ident" id="6564924">TCPListener</span><span class="op" id="6564935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6564938">defer</span>&nbsp;<span class="ident" id="6564944">ln</span><span class="op" id="6564946">.</span><span class="ident" id="6564947">Close</span><span class="op" id="6564952">(</span><span class="op" id="6564953">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6564956">ln</span><span class="op" id="6564958">.</span><span class="ident" id="6564959">SetDeadline</span><span class="op" id="6564970">(</span><span class="ident" id="6564971">time</span><span class="op" id="6564975">.</span><span class="ident" id="6564976">Now</span><span class="op" id="6564979">(</span><span class="op" id="6564980">)</span><span class="op" id="6564981">.</span><span class="ident" id="6564982">Add</span><span class="op" id="6564985">(</span><span class="op" id="6564986">-</span><span class="num" id="6564987">1</span>&nbsp;<span class="op" id="6564989">*</span>&nbsp;<span class="ident" id="6564991">time</span><span class="op" id="6564995">.</span><span class="ident" id="6564996">Second</span><span class="op" id="6565002">)</span><span class="op" id="6565003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6565006">if</span>&nbsp;<span class="ident" id="6565009">_</span><span class="op" id="6565010">,</span>&nbsp;<span class="ident" id="6565012">err</span>&nbsp;<span class="op" id="6565016">:=</span>&nbsp;<span class="ident" id="6565019">ln</span><span class="op" id="6565021">.</span><span class="ident" id="6565022">Accept</span><span class="op" id="6565028">(</span><span class="op" id="6565029">)</span><span class="op" id="6565030">;</span>&nbsp;<span class="op" id="6565032">!</span><span class="ident" id="6565033">isTimeout</span><span class="op" id="6565042">(</span><span class="ident" id="6565043">err</span><span class="op" id="6565046">)</span>&nbsp;<span class="op" id="6565048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565052">t</span><span class="op" id="6565053">.</span><span class="ident" id="6565054">Fatalf</span><span class="op" id="6565060">(</span><span class="string" id="6565061">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6565094">,</span>&nbsp;<span class="ident" id="6565096">errTimeout</span><span class="op" id="6565106">,</span>&nbsp;<span class="ident" id="6565108">err</span><span class="op" id="6565111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6565114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6565117">if</span>&nbsp;<span class="ident" id="6565120">_</span><span class="op" id="6565121">,</span>&nbsp;<span class="ident" id="6565123">err</span>&nbsp;<span class="op" id="6565127">:=</span>&nbsp;<span class="ident" id="6565130">ln</span><span class="op" id="6565132">.</span><span class="ident" id="6565133">Accept</span><span class="op" id="6565139">(</span><span class="op" id="6565140">)</span><span class="op" id="6565141">;</span>&nbsp;<span class="op" id="6565143">!</span><span class="ident" id="6565144">isTimeout</span><span class="op" id="6565153">(</span><span class="ident" id="6565154">err</span><span class="op" id="6565157">)</span>&nbsp;<span class="op" id="6565159">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565163">t</span><span class="op" id="6565164">.</span><span class="ident" id="6565165">Fatalf</span><span class="op" id="6565171">(</span><span class="string" id="6565172">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6565205">,</span>&nbsp;<span class="ident" id="6565207">errTimeout</span><span class="op" id="6565217">,</span>&nbsp;<span class="ident" id="6565219">err</span><span class="op" id="6565222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6565225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565228">ln</span><span class="op" id="6565230">.</span><span class="ident" id="6565231">SetDeadline</span><span class="op" id="6565242">(</span><span class="ident" id="6565243">time</span><span class="op" id="6565247">.</span><span class="ident" id="6565248">Now</span><span class="op" id="6565251">(</span><span class="op" id="6565252">)</span><span class="op" id="6565253">.</span><span class="ident" id="6565254">Add</span><span class="op" id="6565257">(</span><span class="num" id="6565258">100</span>&nbsp;<span class="op" id="6565262">*</span>&nbsp;<span class="ident" id="6565264">time</span><span class="op" id="6565268">.</span><span class="ident" id="6565269">Millisecond</span><span class="op" id="6565280">)</span><span class="op" id="6565281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6565284">if</span>&nbsp;<span class="ident" id="6565287">_</span><span class="op" id="6565288">,</span>&nbsp;<span class="ident" id="6565290">err</span>&nbsp;<span class="op" id="6565294">:=</span>&nbsp;<span class="ident" id="6565297">ln</span><span class="op" id="6565299">.</span><span class="ident" id="6565300">Accept</span><span class="op" id="6565306">(</span><span class="op" id="6565307">)</span><span class="op" id="6565308">;</span>&nbsp;<span class="op" id="6565310">!</span><span class="ident" id="6565311">isTimeout</span><span class="op" id="6565320">(</span><span class="ident" id="6565321">err</span><span class="op" id="6565324">)</span>&nbsp;<span class="op" id="6565326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565330">t</span><span class="op" id="6565331">.</span><span class="ident" id="6565332">Fatalf</span><span class="op" id="6565338">(</span><span class="string" id="6565339">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6565372">,</span>&nbsp;<span class="ident" id="6565374">errTimeout</span><span class="op" id="6565384">,</span>&nbsp;<span class="ident" id="6565386">err</span><span class="op" id="6565389">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6565392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6565395">if</span>&nbsp;<span class="ident" id="6565398">_</span><span class="op" id="6565399">,</span>&nbsp;<span class="ident" id="6565401">err</span>&nbsp;<span class="op" id="6565405">:=</span>&nbsp;<span class="ident" id="6565408">ln</span><span class="op" id="6565410">.</span><span class="ident" id="6565411">Accept</span><span class="op" id="6565417">(</span><span class="op" id="6565418">)</span><span class="op" id="6565419">;</span>&nbsp;<span class="op" id="6565421">!</span><span class="ident" id="6565422">isTimeout</span><span class="op" id="6565431">(</span><span class="ident" id="6565432">err</span><span class="op" id="6565435">)</span>&nbsp;<span class="op" id="6565437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565441">t</span><span class="op" id="6565442">.</span><span class="ident" id="6565443">Fatalf</span><span class="op" id="6565449">(</span><span class="string" id="6565450">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6565483">,</span>&nbsp;<span class="ident" id="6565485">errTimeout</span><span class="op" id="6565495">,</span>&nbsp;<span class="ident" id="6565497">err</span><span class="op" id="6565500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6565503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565506">ln</span><span class="op" id="6565508">.</span><span class="ident" id="6565509">SetDeadline</span><span class="op" id="6565520">(</span><span class="ident" id="6565521">noDeadline</span><span class="op" id="6565531">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565534">errc</span>&nbsp;<span class="op" id="6565539">:=</span>&nbsp;<span class="builtinfunc" id="6565542">make</span><span class="op" id="6565546">(</span><span class="keyword" id="6565547">chan</span>&nbsp;<span class="builtintype" id="6565552">error</span><span class="op" id="6565557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6565560">go</span>&nbsp;<span class="keyword" id="6565563">func</span><span class="op" id="6565567">(</span><span class="op" id="6565568">)</span>&nbsp;<span class="op" id="6565570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565574">_</span><span class="op" id="6565575">,</span>&nbsp;<span class="ident" id="6565577">err</span>&nbsp;<span class="op" id="6565581">:=</span>&nbsp;<span class="ident" id="6565584">ln</span><span class="op" id="6565586">.</span><span class="ident" id="6565587">Accept</span><span class="op" id="6565593">(</span><span class="op" id="6565594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565598">errc</span>&nbsp;<span class="op" id="6565603">&lt;-</span>&nbsp;<span class="ident" id="6565606">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6565611">}</span><span class="op" id="6565612">(</span><span class="op" id="6565613">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565616">time</span><span class="op" id="6565620">.</span><span class="ident" id="6565621">Sleep</span><span class="op" id="6565626">(</span><span class="num" id="6565627">100</span>&nbsp;<span class="op" id="6565631">*</span>&nbsp;<span class="ident" id="6565633">time</span><span class="op" id="6565637">.</span><span class="ident" id="6565638">Millisecond</span><span class="op" id="6565649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6565652">select</span>&nbsp;<span class="op" id="6565659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6565662">case</span>&nbsp;<span class="ident" id="6565667">err</span>&nbsp;<span class="op" id="6565671">:=</span>&nbsp;<span class="op" id="6565674">&lt;-</span><span class="ident" id="6565676">errc</span><span class="op" id="6565680">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565684">t</span><span class="op" id="6565685">.</span><span class="ident" id="6565686">Fatalf</span><span class="op" id="6565692">(</span><span class="string" id="6565693">&#34;Expected&nbsp;Accept()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="6565753">,</span>&nbsp;<span class="ident" id="6565755">err</span><span class="op" id="6565758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6565761">default</span><span class="op" id="6565768">:</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6565771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565774">ln</span><span class="op" id="6565776">.</span><span class="ident" id="6565777">Close</span><span class="op" id="6565782">(</span><span class="op" id="6565783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6565786">switch</span>&nbsp;<span class="ident" id="6565793">nerr</span>&nbsp;<span class="op" id="6565798">:=</span>&nbsp;<span class="op" id="6565801">&lt;-</span><span class="ident" id="6565803">errc</span><span class="op" id="6565807">;</span>&nbsp;<span class="ident" id="6565809">err</span>&nbsp;<span class="op" id="6565813">:=</span>&nbsp;<span class="ident" id="6565816">nerr</span><span class="op" id="6565820">.</span><span class="op" id="6565821">(</span><span class="keyword" id="6565822">type</span><span class="op" id="6565826">)</span>&nbsp;<span class="op" id="6565828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6565831">case</span>&nbsp;<span class="op" id="6565836">*</span><span class="ident" id="6565837">OpError</span><span class="op" id="6565844">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6565848">if</span>&nbsp;<span class="ident" id="6565851">err</span><span class="op" id="6565854">.</span><span class="ident" id="6565855">Err</span>&nbsp;<span class="op" id="6565859">!=</span>&nbsp;<span class="ident" id="6565862">errClosing</span>&nbsp;<span class="op" id="6565873">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565878">t</span><span class="op" id="6565879">.</span><span class="ident" id="6565880">Fatalf</span><span class="op" id="6565886">(</span><span class="string" id="6565887">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6565920">,</span>&nbsp;<span class="ident" id="6565922">errClosing</span><span class="op" id="6565932">,</span>&nbsp;<span class="ident" id="6565934">err</span><span class="op" id="6565937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6565941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6565944">default</span><span class="op" id="6565951">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6565955">if</span>&nbsp;<span class="ident" id="6565958">err</span>&nbsp;<span class="op" id="6565962">!=</span>&nbsp;<span class="ident" id="6565965">errClosing</span>&nbsp;<span class="op" id="6565976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565981">t</span><span class="op" id="6565982">.</span><span class="ident" id="6565983">Fatalf</span><span class="op" id="6565989">(</span><span class="string" id="6565990">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6566023">,</span>&nbsp;<span class="ident" id="6566025">errClosing</span><span class="op" id="6566035">,</span>&nbsp;<span class="ident" id="6566037">err</span><span class="op" id="6566040">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6566044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6566047">}</span><br>
<span class="lineno"></span><span class="op" id="6566049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6566052">func</span>&nbsp;<span class="ident" id="6566057">TestReadTimeout</span><span class="op" id="6566072">(</span><span class="ident" id="6566073">t</span>&nbsp;<span class="op" id="6566075">*</span><span class="ident" id="6566076">testing</span><span class="op" id="6566083">.</span><span class="ident" id="6566084">T</span><span class="op" id="6566085">)</span>&nbsp;<span class="op" id="6566087">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6566090">switch</span>&nbsp;<span class="ident" id="6566097">runtime</span><span class="op" id="6566104">.</span><span class="ident" id="6566105">GOOS</span>&nbsp;<span class="op" id="6566110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6566113">case</span>&nbsp;<span class="string" id="6566118">&#34;plan9&#34;</span><span class="op" id="6566125">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566129">t</span><span class="op" id="6566130">.</span><span class="ident" id="6566131">Skipf</span><span class="op" id="6566136">(</span><span class="string" id="6566137">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6566158">,</span>&nbsp;<span class="ident" id="6566160">runtime</span><span class="op" id="6566167">.</span><span class="ident" id="6566168">GOOS</span><span class="op" id="6566172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6566175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566179">ln</span>&nbsp;<span class="op" id="6566182">:=</span>&nbsp;<span class="ident" id="6566185">newLocalListener</span><span class="op" id="6566201">(</span><span class="ident" id="6566202">t</span><span class="op" id="6566203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6566206">defer</span>&nbsp;<span class="ident" id="6566212">ln</span><span class="op" id="6566214">.</span><span class="ident" id="6566215">Close</span><span class="op" id="6566220">(</span><span class="op" id="6566221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566224">c</span><span class="op" id="6566225">,</span>&nbsp;<span class="ident" id="6566227">err</span>&nbsp;<span class="op" id="6566231">:=</span>&nbsp;<span class="ident" id="6566234">DialTCP</span><span class="op" id="6566241">(</span><span class="string" id="6566242">&#34;tcp&#34;</span><span class="op" id="6566247">,</span>&nbsp;<span class="builtintype" id="6566249">nil</span><span class="op" id="6566252">,</span>&nbsp;<span class="ident" id="6566254">ln</span><span class="op" id="6566256">.</span><span class="ident" id="6566257">Addr</span><span class="op" id="6566261">(</span><span class="op" id="6566262">)</span><span class="op" id="6566263">.</span><span class="op" id="6566264">(</span><span class="op" id="6566265">*</span><span class="ident" id="6566266">TCPAddr</span><span class="op" id="6566273">)</span><span class="op" id="6566274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6566277">if</span>&nbsp;<span class="ident" id="6566280">err</span>&nbsp;<span class="op" id="6566284">!=</span>&nbsp;<span class="builtintype" id="6566287">nil</span>&nbsp;<span class="op" id="6566291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566295">t</span><span class="op" id="6566296">.</span><span class="ident" id="6566297">Fatalf</span><span class="op" id="6566303">(</span><span class="string" id="6566304">&#34;Connect:&nbsp;%v&#34;</span><span class="op" id="6566317">,</span>&nbsp;<span class="ident" id="6566319">err</span><span class="op" id="6566322">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6566325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6566328">defer</span>&nbsp;<span class="ident" id="6566334">c</span><span class="op" id="6566335">.</span><span class="ident" id="6566336">Close</span><span class="op" id="6566341">(</span><span class="op" id="6566342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566345">c</span><span class="op" id="6566346">.</span><span class="ident" id="6566347">SetDeadline</span><span class="op" id="6566358">(</span><span class="ident" id="6566359">time</span><span class="op" id="6566363">.</span><span class="ident" id="6566364">Now</span><span class="op" id="6566367">(</span><span class="op" id="6566368">)</span><span class="op" id="6566369">.</span><span class="ident" id="6566370">Add</span><span class="op" id="6566373">(</span><span class="ident" id="6566374">time</span><span class="op" id="6566378">.</span><span class="ident" id="6566379">Hour</span><span class="op" id="6566383">)</span><span class="op" id="6566384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566387">c</span><span class="op" id="6566388">.</span><span class="ident" id="6566389">SetReadDeadline</span><span class="op" id="6566404">(</span><span class="ident" id="6566405">time</span><span class="op" id="6566409">.</span><span class="ident" id="6566410">Now</span><span class="op" id="6566413">(</span><span class="op" id="6566414">)</span><span class="op" id="6566415">.</span><span class="ident" id="6566416">Add</span><span class="op" id="6566419">(</span><span class="op" id="6566420">-</span><span class="num" id="6566421">1</span>&nbsp;<span class="op" id="6566423">*</span>&nbsp;<span class="ident" id="6566425">time</span><span class="op" id="6566429">.</span><span class="ident" id="6566430">Second</span><span class="op" id="6566436">)</span><span class="op" id="6566437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566440">buf</span>&nbsp;<span class="op" id="6566444">:=</span>&nbsp;<span class="builtinfunc" id="6566447">make</span><span class="op" id="6566451">(</span><span class="op" id="6566452">[</span><span class="op" id="6566453">]</span><span class="builtintype" id="6566454">byte</span><span class="op" id="6566458">,</span>&nbsp;<span class="num" id="6566460">1</span><span class="op" id="6566461">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6566464">if</span>&nbsp;<span class="ident" id="6566467">_</span><span class="op" id="6566468">,</span>&nbsp;<span class="ident" id="6566470">err</span>&nbsp;<span class="op" id="6566474">=</span>&nbsp;<span class="ident" id="6566476">c</span><span class="op" id="6566477">.</span><span class="ident" id="6566478">Read</span><span class="op" id="6566482">(</span><span class="ident" id="6566483">buf</span><span class="op" id="6566486">)</span><span class="op" id="6566487">;</span>&nbsp;<span class="op" id="6566489">!</span><span class="ident" id="6566490">isTimeout</span><span class="op" id="6566499">(</span><span class="ident" id="6566500">err</span><span class="op" id="6566503">)</span>&nbsp;<span class="op" id="6566505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566509">t</span><span class="op" id="6566510">.</span><span class="ident" id="6566511">Fatalf</span><span class="op" id="6566517">(</span><span class="string" id="6566518">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6566549">,</span>&nbsp;<span class="ident" id="6566551">errTimeout</span><span class="op" id="6566561">,</span>&nbsp;<span class="ident" id="6566563">err</span><span class="op" id="6566566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6566569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6566572">if</span>&nbsp;<span class="ident" id="6566575">_</span><span class="op" id="6566576">,</span>&nbsp;<span class="ident" id="6566578">err</span>&nbsp;<span class="op" id="6566582">=</span>&nbsp;<span class="ident" id="6566584">c</span><span class="op" id="6566585">.</span><span class="ident" id="6566586">Read</span><span class="op" id="6566590">(</span><span class="ident" id="6566591">buf</span><span class="op" id="6566594">)</span><span class="op" id="6566595">;</span>&nbsp;<span class="op" id="6566597">!</span><span class="ident" id="6566598">isTimeout</span><span class="op" id="6566607">(</span><span class="ident" id="6566608">err</span><span class="op" id="6566611">)</span>&nbsp;<span class="op" id="6566613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566617">t</span><span class="op" id="6566618">.</span><span class="ident" id="6566619">Fatalf</span><span class="op" id="6566625">(</span><span class="string" id="6566626">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6566657">,</span>&nbsp;<span class="ident" id="6566659">errTimeout</span><span class="op" id="6566669">,</span>&nbsp;<span class="ident" id="6566671">err</span><span class="op" id="6566674">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6566677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566680">c</span><span class="op" id="6566681">.</span><span class="ident" id="6566682">SetDeadline</span><span class="op" id="6566693">(</span><span class="ident" id="6566694">time</span><span class="op" id="6566698">.</span><span class="ident" id="6566699">Now</span><span class="op" id="6566702">(</span><span class="op" id="6566703">)</span><span class="op" id="6566704">.</span><span class="ident" id="6566705">Add</span><span class="op" id="6566708">(</span><span class="num" id="6566709">100</span>&nbsp;<span class="op" id="6566713">*</span>&nbsp;<span class="ident" id="6566715">time</span><span class="op" id="6566719">.</span><span class="ident" id="6566720">Millisecond</span><span class="op" id="6566731">)</span><span class="op" id="6566732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6566735">if</span>&nbsp;<span class="ident" id="6566738">_</span><span class="op" id="6566739">,</span>&nbsp;<span class="ident" id="6566741">err</span>&nbsp;<span class="op" id="6566745">=</span>&nbsp;<span class="ident" id="6566747">c</span><span class="op" id="6566748">.</span><span class="ident" id="6566749">Read</span><span class="op" id="6566753">(</span><span class="ident" id="6566754">buf</span><span class="op" id="6566757">)</span><span class="op" id="6566758">;</span>&nbsp;<span class="op" id="6566760">!</span><span class="ident" id="6566761">isTimeout</span><span class="op" id="6566770">(</span><span class="ident" id="6566771">err</span><span class="op" id="6566774">)</span>&nbsp;<span class="op" id="6566776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566780">t</span><span class="op" id="6566781">.</span><span class="ident" id="6566782">Fatalf</span><span class="op" id="6566788">(</span><span class="string" id="6566789">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6566820">,</span>&nbsp;<span class="ident" id="6566822">errTimeout</span><span class="op" id="6566832">,</span>&nbsp;<span class="ident" id="6566834">err</span><span class="op" id="6566837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6566840">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6566843">if</span>&nbsp;<span class="ident" id="6566846">_</span><span class="op" id="6566847">,</span>&nbsp;<span class="ident" id="6566849">err</span>&nbsp;<span class="op" id="6566853">=</span>&nbsp;<span class="ident" id="6566855">c</span><span class="op" id="6566856">.</span><span class="ident" id="6566857">Read</span><span class="op" id="6566861">(</span><span class="ident" id="6566862">buf</span><span class="op" id="6566865">)</span><span class="op" id="6566866">;</span>&nbsp;<span class="op" id="6566868">!</span><span class="ident" id="6566869">isTimeout</span><span class="op" id="6566878">(</span><span class="ident" id="6566879">err</span><span class="op" id="6566882">)</span>&nbsp;<span class="op" id="6566884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566888">t</span><span class="op" id="6566889">.</span><span class="ident" id="6566890">Fatalf</span><span class="op" id="6566896">(</span><span class="string" id="6566897">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6566928">,</span>&nbsp;<span class="ident" id="6566930">errTimeout</span><span class="op" id="6566940">,</span>&nbsp;<span class="ident" id="6566942">err</span><span class="op" id="6566945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6566948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566951">c</span><span class="op" id="6566952">.</span><span class="ident" id="6566953">SetReadDeadline</span><span class="op" id="6566968">(</span><span class="ident" id="6566969">noDeadline</span><span class="op" id="6566979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566982">c</span><span class="op" id="6566983">.</span><span class="ident" id="6566984">SetWriteDeadline</span><span class="op" id="6567000">(</span><span class="ident" id="6567001">time</span><span class="op" id="6567005">.</span><span class="ident" id="6567006">Now</span><span class="op" id="6567009">(</span><span class="op" id="6567010">)</span><span class="op" id="6567011">.</span><span class="ident" id="6567012">Add</span><span class="op" id="6567015">(</span><span class="op" id="6567016">-</span><span class="num" id="6567017">1</span>&nbsp;<span class="op" id="6567019">*</span>&nbsp;<span class="ident" id="6567021">time</span><span class="op" id="6567025">.</span><span class="ident" id="6567026">Second</span><span class="op" id="6567032">)</span><span class="op" id="6567033">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567036">errc</span>&nbsp;<span class="op" id="6567041">:=</span>&nbsp;<span class="builtinfunc" id="6567044">make</span><span class="op" id="6567048">(</span><span class="keyword" id="6567049">chan</span>&nbsp;<span class="builtintype" id="6567054">error</span><span class="op" id="6567059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6567062">go</span>&nbsp;<span class="keyword" id="6567065">func</span><span class="op" id="6567069">(</span><span class="op" id="6567070">)</span>&nbsp;<span class="op" id="6567072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567076">_</span><span class="op" id="6567077">,</span>&nbsp;<span class="ident" id="6567079">err</span>&nbsp;<span class="op" id="6567083">:=</span>&nbsp;<span class="ident" id="6567086">c</span><span class="op" id="6567087">.</span><span class="ident" id="6567088">Read</span><span class="op" id="6567092">(</span><span class="ident" id="6567093">buf</span><span class="op" id="6567096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567100">errc</span>&nbsp;<span class="op" id="6567105">&lt;-</span>&nbsp;<span class="ident" id="6567108">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6567113">}</span><span class="op" id="6567114">(</span><span class="op" id="6567115">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567118">time</span><span class="op" id="6567122">.</span><span class="ident" id="6567123">Sleep</span><span class="op" id="6567128">(</span><span class="num" id="6567129">100</span>&nbsp;<span class="op" id="6567133">*</span>&nbsp;<span class="ident" id="6567135">time</span><span class="op" id="6567139">.</span><span class="ident" id="6567140">Millisecond</span><span class="op" id="6567151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6567154">select</span>&nbsp;<span class="op" id="6567161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6567164">case</span>&nbsp;<span class="ident" id="6567169">err</span>&nbsp;<span class="op" id="6567173">:=</span>&nbsp;<span class="op" id="6567176">&lt;-</span><span class="ident" id="6567178">errc</span><span class="op" id="6567182">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567186">t</span><span class="op" id="6567187">.</span><span class="ident" id="6567188">Fatalf</span><span class="op" id="6567194">(</span><span class="string" id="6567195">&#34;Expected&nbsp;Read()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="6567253">,</span>&nbsp;<span class="ident" id="6567255">err</span><span class="op" id="6567258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6567261">default</span><span class="op" id="6567268">:</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6567271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567274">c</span><span class="op" id="6567275">.</span><span class="ident" id="6567276">Close</span><span class="op" id="6567281">(</span><span class="op" id="6567282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6567285">switch</span>&nbsp;<span class="ident" id="6567292">nerr</span>&nbsp;<span class="op" id="6567297">:=</span>&nbsp;<span class="op" id="6567300">&lt;-</span><span class="ident" id="6567302">errc</span><span class="op" id="6567306">;</span>&nbsp;<span class="ident" id="6567308">err</span>&nbsp;<span class="op" id="6567312">:=</span>&nbsp;<span class="ident" id="6567315">nerr</span><span class="op" id="6567319">.</span><span class="op" id="6567320">(</span><span class="keyword" id="6567321">type</span><span class="op" id="6567325">)</span>&nbsp;<span class="op" id="6567327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6567330">case</span>&nbsp;<span class="op" id="6567335">*</span><span class="ident" id="6567336">OpError</span><span class="op" id="6567343">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6567347">if</span>&nbsp;<span class="ident" id="6567350">err</span><span class="op" id="6567353">.</span><span class="ident" id="6567354">Err</span>&nbsp;<span class="op" id="6567358">!=</span>&nbsp;<span class="ident" id="6567361">errClosing</span>&nbsp;<span class="op" id="6567372">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567377">t</span><span class="op" id="6567378">.</span><span class="ident" id="6567379">Fatalf</span><span class="op" id="6567385">(</span><span class="string" id="6567386">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6567417">,</span>&nbsp;<span class="ident" id="6567419">errClosing</span><span class="op" id="6567429">,</span>&nbsp;<span class="ident" id="6567431">err</span><span class="op" id="6567434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6567438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6567441">default</span><span class="op" id="6567448">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6567452">if</span>&nbsp;<span class="ident" id="6567455">err</span>&nbsp;<span class="op" id="6567459">==</span>&nbsp;<span class="ident" id="6567462">io</span><span class="op" id="6567464">.</span><span class="ident" id="6567465">EOF</span>&nbsp;<span class="op" id="6567469">&amp;&amp;</span>&nbsp;<span class="ident" id="6567472">runtime</span><span class="op" id="6567479">.</span><span class="ident" id="6567480">GOOS</span>&nbsp;<span class="op" id="6567485">==</span>&nbsp;<span class="string" id="6567488">&#34;nacl&#34;</span>&nbsp;<span class="op" id="6567495">{</span>&nbsp;<span class="comment" id="6567497">//&nbsp;close&nbsp;enough;&nbsp;golang.org/issue/8044</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6567539">break</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6567547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6567551">if</span>&nbsp;<span class="ident" id="6567554">err</span>&nbsp;<span class="op" id="6567558">!=</span>&nbsp;<span class="ident" id="6567561">errClosing</span>&nbsp;<span class="op" id="6567572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567577">t</span><span class="op" id="6567578">.</span><span class="ident" id="6567579">Fatalf</span><span class="op" id="6567585">(</span><span class="string" id="6567586">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6567617">,</span>&nbsp;<span class="ident" id="6567619">errClosing</span><span class="op" id="6567629">,</span>&nbsp;<span class="ident" id="6567631">err</span><span class="op" id="6567634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6567638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6567641">}</span><br>
<span class="lineno">130</span><span class="op" id="6567643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6567646">func</span>&nbsp;<span class="ident" id="6567651">TestWriteTimeout</span><span class="op" id="6567667">(</span><span class="ident" id="6567668">t</span>&nbsp;<span class="op" id="6567670">*</span><span class="ident" id="6567671">testing</span><span class="op" id="6567678">.</span><span class="ident" id="6567679">T</span><span class="op" id="6567680">)</span>&nbsp;<span class="op" id="6567682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6567685">switch</span>&nbsp;<span class="ident" id="6567692">runtime</span><span class="op" id="6567699">.</span><span class="ident" id="6567700">GOOS</span>&nbsp;<span class="op" id="6567705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6567708">case</span>&nbsp;<span class="string" id="6567713">&#34;plan9&#34;</span><span class="op" id="6567720">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567724">t</span><span class="op" id="6567725">.</span><span class="ident" id="6567726">Skipf</span><span class="op" id="6567731">(</span><span class="string" id="6567732">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6567753">,</span>&nbsp;<span class="ident" id="6567755">runtime</span><span class="op" id="6567762">.</span><span class="ident" id="6567763">GOOS</span><span class="op" id="6567767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6567770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567774">ln</span>&nbsp;<span class="op" id="6567777">:=</span>&nbsp;<span class="ident" id="6567780">newLocalListener</span><span class="op" id="6567796">(</span><span class="ident" id="6567797">t</span><span class="op" id="6567798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6567801">defer</span>&nbsp;<span class="ident" id="6567807">ln</span><span class="op" id="6567809">.</span><span class="ident" id="6567810">Close</span><span class="op" id="6567815">(</span><span class="op" id="6567816">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567819">c</span><span class="op" id="6567820">,</span>&nbsp;<span class="ident" id="6567822">err</span>&nbsp;<span class="op" id="6567826">:=</span>&nbsp;<span class="ident" id="6567829">DialTCP</span><span class="op" id="6567836">(</span><span class="string" id="6567837">&#34;tcp&#34;</span><span class="op" id="6567842">,</span>&nbsp;<span class="builtintype" id="6567844">nil</span><span class="op" id="6567847">,</span>&nbsp;<span class="ident" id="6567849">ln</span><span class="op" id="6567851">.</span><span class="ident" id="6567852">Addr</span><span class="op" id="6567856">(</span><span class="op" id="6567857">)</span><span class="op" id="6567858">.</span><span class="op" id="6567859">(</span><span class="op" id="6567860">*</span><span class="ident" id="6567861">TCPAddr</span><span class="op" id="6567868">)</span><span class="op" id="6567869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6567872">if</span>&nbsp;<span class="ident" id="6567875">err</span>&nbsp;<span class="op" id="6567879">!=</span>&nbsp;<span class="builtintype" id="6567882">nil</span>&nbsp;<span class="op" id="6567886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567890">t</span><span class="op" id="6567891">.</span><span class="ident" id="6567892">Fatalf</span><span class="op" id="6567898">(</span><span class="string" id="6567899">&#34;Connect:&nbsp;%v&#34;</span><span class="op" id="6567912">,</span>&nbsp;<span class="ident" id="6567914">err</span><span class="op" id="6567917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6567920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6567923">defer</span>&nbsp;<span class="ident" id="6567929">c</span><span class="op" id="6567930">.</span><span class="ident" id="6567931">Close</span><span class="op" id="6567936">(</span><span class="op" id="6567937">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567940">c</span><span class="op" id="6567941">.</span><span class="ident" id="6567942">SetDeadline</span><span class="op" id="6567953">(</span><span class="ident" id="6567954">time</span><span class="op" id="6567958">.</span><span class="ident" id="6567959">Now</span><span class="op" id="6567962">(</span><span class="op" id="6567963">)</span><span class="op" id="6567964">.</span><span class="ident" id="6567965">Add</span><span class="op" id="6567968">(</span><span class="ident" id="6567969">time</span><span class="op" id="6567973">.</span><span class="ident" id="6567974">Hour</span><span class="op" id="6567978">)</span><span class="op" id="6567979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567982">c</span><span class="op" id="6567983">.</span><span class="ident" id="6567984">SetWriteDeadline</span><span class="op" id="6568000">(</span><span class="ident" id="6568001">time</span><span class="op" id="6568005">.</span><span class="ident" id="6568006">Now</span><span class="op" id="6568009">(</span><span class="op" id="6568010">)</span><span class="op" id="6568011">.</span><span class="ident" id="6568012">Add</span><span class="op" id="6568015">(</span><span class="op" id="6568016">-</span><span class="num" id="6568017">1</span>&nbsp;<span class="op" id="6568019">*</span>&nbsp;<span class="ident" id="6568021">time</span><span class="op" id="6568025">.</span><span class="ident" id="6568026">Second</span><span class="op" id="6568032">)</span><span class="op" id="6568033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568036">buf</span>&nbsp;<span class="op" id="6568040">:=</span>&nbsp;<span class="builtinfunc" id="6568043">make</span><span class="op" id="6568047">(</span><span class="op" id="6568048">[</span><span class="op" id="6568049">]</span><span class="builtintype" id="6568050">byte</span><span class="op" id="6568054">,</span>&nbsp;<span class="num" id="6568056">4096</span><span class="op" id="6568060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568063">writeUntilTimeout</span>&nbsp;<span class="op" id="6568081">:=</span>&nbsp;<span class="keyword" id="6568084">func</span><span class="op" id="6568088">(</span><span class="op" id="6568089">)</span>&nbsp;<span class="op" id="6568091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6568095">for</span>&nbsp;<span class="op" id="6568099">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568104">_</span><span class="op" id="6568105">,</span>&nbsp;<span class="ident" id="6568107">err</span>&nbsp;<span class="op" id="6568111">:=</span>&nbsp;<span class="ident" id="6568114">c</span><span class="op" id="6568115">.</span><span class="ident" id="6568116">Write</span><span class="op" id="6568121">(</span><span class="ident" id="6568122">buf</span><span class="op" id="6568125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6568130">if</span>&nbsp;<span class="ident" id="6568133">err</span>&nbsp;<span class="op" id="6568137">!=</span>&nbsp;<span class="builtintype" id="6568140">nil</span>&nbsp;<span class="op" id="6568144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6568150">if</span>&nbsp;<span class="ident" id="6568153">isTimeout</span><span class="op" id="6568162">(</span><span class="ident" id="6568163">err</span><span class="op" id="6568166">)</span>&nbsp;<span class="op" id="6568168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6568175">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6568186">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568192">t</span><span class="op" id="6568193">.</span><span class="ident" id="6568194">Fatalf</span><span class="op" id="6568200">(</span><span class="string" id="6568201">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6568233">,</span>&nbsp;<span class="ident" id="6568235">errTimeout</span><span class="op" id="6568245">,</span>&nbsp;<span class="ident" id="6568247">err</span><span class="op" id="6568250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6568255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6568259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6568262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568265">writeUntilTimeout</span><span class="op" id="6568282">(</span><span class="op" id="6568283">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568286">c</span><span class="op" id="6568287">.</span><span class="ident" id="6568288">SetDeadline</span><span class="op" id="6568299">(</span><span class="ident" id="6568300">time</span><span class="op" id="6568304">.</span><span class="ident" id="6568305">Now</span><span class="op" id="6568308">(</span><span class="op" id="6568309">)</span><span class="op" id="6568310">.</span><span class="ident" id="6568311">Add</span><span class="op" id="6568314">(</span><span class="num" id="6568315">10</span>&nbsp;<span class="op" id="6568318">*</span>&nbsp;<span class="ident" id="6568320">time</span><span class="op" id="6568324">.</span><span class="ident" id="6568325">Millisecond</span><span class="op" id="6568336">)</span><span class="op" id="6568337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568340">writeUntilTimeout</span><span class="op" id="6568357">(</span><span class="op" id="6568358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568361">writeUntilTimeout</span><span class="op" id="6568378">(</span><span class="op" id="6568379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568382">c</span><span class="op" id="6568383">.</span><span class="ident" id="6568384">SetWriteDeadline</span><span class="op" id="6568400">(</span><span class="ident" id="6568401">noDeadline</span><span class="op" id="6568411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568414">c</span><span class="op" id="6568415">.</span><span class="ident" id="6568416">SetReadDeadline</span><span class="op" id="6568431">(</span><span class="ident" id="6568432">time</span><span class="op" id="6568436">.</span><span class="ident" id="6568437">Now</span><span class="op" id="6568440">(</span><span class="op" id="6568441">)</span><span class="op" id="6568442">.</span><span class="ident" id="6568443">Add</span><span class="op" id="6568446">(</span><span class="op" id="6568447">-</span><span class="num" id="6568448">1</span>&nbsp;<span class="op" id="6568450">*</span>&nbsp;<span class="ident" id="6568452">time</span><span class="op" id="6568456">.</span><span class="ident" id="6568457">Second</span><span class="op" id="6568463">)</span><span class="op" id="6568464">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568467">errc</span>&nbsp;<span class="op" id="6568472">:=</span>&nbsp;<span class="builtinfunc" id="6568475">make</span><span class="op" id="6568479">(</span><span class="keyword" id="6568480">chan</span>&nbsp;<span class="builtintype" id="6568485">error</span><span class="op" id="6568490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6568493">go</span>&nbsp;<span class="keyword" id="6568496">func</span><span class="op" id="6568500">(</span><span class="op" id="6568501">)</span>&nbsp;<span class="op" id="6568503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6568507">for</span>&nbsp;<span class="op" id="6568511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568516">_</span><span class="op" id="6568517">,</span>&nbsp;<span class="ident" id="6568519">err</span>&nbsp;<span class="op" id="6568523">:=</span>&nbsp;<span class="ident" id="6568526">c</span><span class="op" id="6568527">.</span><span class="ident" id="6568528">Write</span><span class="op" id="6568533">(</span><span class="ident" id="6568534">buf</span><span class="op" id="6568537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6568542">if</span>&nbsp;<span class="ident" id="6568545">err</span>&nbsp;<span class="op" id="6568549">!=</span>&nbsp;<span class="builtintype" id="6568552">nil</span>&nbsp;<span class="op" id="6568556">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568562">errc</span>&nbsp;<span class="op" id="6568567">&lt;-</span>&nbsp;<span class="ident" id="6568570">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6568577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6568581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6568584">}</span><span class="op" id="6568585">(</span><span class="op" id="6568586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568589">time</span><span class="op" id="6568593">.</span><span class="ident" id="6568594">Sleep</span><span class="op" id="6568599">(</span><span class="num" id="6568600">100</span>&nbsp;<span class="op" id="6568604">*</span>&nbsp;<span class="ident" id="6568606">time</span><span class="op" id="6568610">.</span><span class="ident" id="6568611">Millisecond</span><span class="op" id="6568622">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6568625">select</span>&nbsp;<span class="op" id="6568632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6568635">case</span>&nbsp;<span class="ident" id="6568640">err</span>&nbsp;<span class="op" id="6568644">:=</span>&nbsp;<span class="op" id="6568647">&lt;-</span><span class="ident" id="6568649">errc</span><span class="op" id="6568653">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568657">t</span><span class="op" id="6568658">.</span><span class="ident" id="6568659">Fatalf</span><span class="op" id="6568665">(</span><span class="string" id="6568666">&#34;Expected&nbsp;Write()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="6568725">,</span>&nbsp;<span class="ident" id="6568727">err</span><span class="op" id="6568730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6568733">default</span><span class="op" id="6568740">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6568743">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568746">c</span><span class="op" id="6568747">.</span><span class="ident" id="6568748">Close</span><span class="op" id="6568753">(</span><span class="op" id="6568754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6568757">switch</span>&nbsp;<span class="ident" id="6568764">nerr</span>&nbsp;<span class="op" id="6568769">:=</span>&nbsp;<span class="op" id="6568772">&lt;-</span><span class="ident" id="6568774">errc</span><span class="op" id="6568778">;</span>&nbsp;<span class="ident" id="6568780">err</span>&nbsp;<span class="op" id="6568784">:=</span>&nbsp;<span class="ident" id="6568787">nerr</span><span class="op" id="6568791">.</span><span class="op" id="6568792">(</span><span class="keyword" id="6568793">type</span><span class="op" id="6568797">)</span>&nbsp;<span class="op" id="6568799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6568802">case</span>&nbsp;<span class="op" id="6568807">*</span><span class="ident" id="6568808">OpError</span><span class="op" id="6568815">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6568819">if</span>&nbsp;<span class="ident" id="6568822">err</span><span class="op" id="6568825">.</span><span class="ident" id="6568826">Err</span>&nbsp;<span class="op" id="6568830">!=</span>&nbsp;<span class="ident" id="6568833">errClosing</span>&nbsp;<span class="op" id="6568844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568849">t</span><span class="op" id="6568850">.</span><span class="ident" id="6568851">Fatalf</span><span class="op" id="6568857">(</span><span class="string" id="6568858">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6568890">,</span>&nbsp;<span class="ident" id="6568892">errClosing</span><span class="op" id="6568902">,</span>&nbsp;<span class="ident" id="6568904">err</span><span class="op" id="6568907">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6568911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6568914">default</span><span class="op" id="6568921">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6568925">if</span>&nbsp;<span class="ident" id="6568928">err</span>&nbsp;<span class="op" id="6568932">!=</span>&nbsp;<span class="ident" id="6568935">errClosing</span>&nbsp;<span class="op" id="6568946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568951">t</span><span class="op" id="6568952">.</span><span class="ident" id="6568953">Fatalf</span><span class="op" id="6568959">(</span><span class="string" id="6568960">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6568992">,</span>&nbsp;<span class="ident" id="6568994">errClosing</span><span class="op" id="6569004">,</span>&nbsp;<span class="ident" id="6569006">err</span><span class="op" id="6569009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6569013">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6569016">}</span><br>
<span class="lineno"></span><span class="op" id="6569018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6569021">func</span>&nbsp;<span class="ident" id="6569026">testTimeout</span><span class="op" id="6569037">(</span><span class="ident" id="6569038">t</span>&nbsp;<span class="op" id="6569040">*</span><span class="ident" id="6569041">testing</span><span class="op" id="6569048">.</span><span class="ident" id="6569049">T</span><span class="op" id="6569050">,</span>&nbsp;<span class="ident" id="6569052">net</span><span class="op" id="6569055">,</span>&nbsp;<span class="ident" id="6569057">addr</span>&nbsp;<span class="builtintype" id="6569062">string</span><span class="op" id="6569068">,</span>&nbsp;<span class="ident" id="6569070">readFrom</span>&nbsp;<span class="builtintype" id="6569079">bool</span><span class="op" id="6569083">)</span>&nbsp;<span class="op" id="6569085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569088">c</span><span class="op" id="6569089">,</span>&nbsp;<span class="ident" id="6569091">err</span>&nbsp;<span class="op" id="6569095">:=</span>&nbsp;<span class="ident" id="6569098">Dial</span><span class="op" id="6569102">(</span><span class="ident" id="6569103">net</span><span class="op" id="6569106">,</span>&nbsp;<span class="ident" id="6569108">addr</span><span class="op" id="6569112">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6569115">if</span>&nbsp;<span class="ident" id="6569118">err</span>&nbsp;<span class="op" id="6569122">!=</span>&nbsp;<span class="builtintype" id="6569125">nil</span>&nbsp;<span class="op" id="6569129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569133">t</span><span class="op" id="6569134">.</span><span class="ident" id="6569135">Errorf</span><span class="op" id="6569141">(</span><span class="string" id="6569142">&#34;Dial(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6569167">,</span>&nbsp;<span class="ident" id="6569169">net</span><span class="op" id="6569172">,</span>&nbsp;<span class="ident" id="6569174">addr</span><span class="op" id="6569178">,</span>&nbsp;<span class="ident" id="6569180">err</span><span class="op" id="6569183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6569187">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6569195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6569198">defer</span>&nbsp;<span class="ident" id="6569204">c</span><span class="op" id="6569205">.</span><span class="ident" id="6569206">Close</span><span class="op" id="6569211">(</span><span class="op" id="6569212">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569215">what</span>&nbsp;<span class="op" id="6569220">:=</span>&nbsp;<span class="string" id="6569223">&#34;Read&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6569231">if</span>&nbsp;<span class="ident" id="6569234">readFrom</span>&nbsp;<span class="op" id="6569243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569247">what</span>&nbsp;<span class="op" id="6569252">=</span>&nbsp;<span class="string" id="6569254">&#34;ReadFrom&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6569266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569270">errc</span>&nbsp;<span class="op" id="6569275">:=</span>&nbsp;<span class="builtinfunc" id="6569278">make</span><span class="op" id="6569282">(</span><span class="keyword" id="6569283">chan</span>&nbsp;<span class="builtintype" id="6569288">error</span><span class="op" id="6569293">,</span>&nbsp;<span class="num" id="6569295">1</span><span class="op" id="6569296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6569299">go</span>&nbsp;<span class="keyword" id="6569302">func</span><span class="op" id="6569306">(</span><span class="op" id="6569307">)</span>&nbsp;<span class="op" id="6569309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569313">t0</span>&nbsp;<span class="op" id="6569316">:=</span>&nbsp;<span class="ident" id="6569319">time</span><span class="op" id="6569323">.</span><span class="ident" id="6569324">Now</span><span class="op" id="6569327">(</span><span class="op" id="6569328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569332">c</span><span class="op" id="6569333">.</span><span class="ident" id="6569334">SetReadDeadline</span><span class="op" id="6569349">(</span><span class="ident" id="6569350">time</span><span class="op" id="6569354">.</span><span class="ident" id="6569355">Now</span><span class="op" id="6569358">(</span><span class="op" id="6569359">)</span><span class="op" id="6569360">.</span><span class="ident" id="6569361">Add</span><span class="op" id="6569364">(</span><span class="num" id="6569365">100</span>&nbsp;<span class="op" id="6569369">*</span>&nbsp;<span class="ident" id="6569371">time</span><span class="op" id="6569375">.</span><span class="ident" id="6569376">Millisecond</span><span class="op" id="6569387">)</span><span class="op" id="6569388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6569392">var</span>&nbsp;<span class="ident" id="6569396">b</span>&nbsp;<span class="op" id="6569398">[</span><span class="num" id="6569399">100</span><span class="op" id="6569402">]</span><span class="builtintype" id="6569403">byte</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6569410">var</span>&nbsp;<span class="ident" id="6569414">n</span>&nbsp;<span class="builtintype" id="6569416">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6569422">var</span>&nbsp;<span class="ident" id="6569426">err</span>&nbsp;<span class="builtintype" id="6569430">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6569438">if</span>&nbsp;<span class="ident" id="6569441">readFrom</span>&nbsp;<span class="op" id="6569450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569455">n</span><span class="op" id="6569456">,</span>&nbsp;<span class="ident" id="6569458">_</span><span class="op" id="6569459">,</span>&nbsp;<span class="ident" id="6569461">err</span>&nbsp;<span class="op" id="6569465">=</span>&nbsp;<span class="ident" id="6569467">c</span><span class="op" id="6569468">.</span><span class="op" id="6569469">(</span><span class="ident" id="6569470">PacketConn</span><span class="op" id="6569480">)</span><span class="op" id="6569481">.</span><span class="ident" id="6569482">ReadFrom</span><span class="op" id="6569490">(</span><span class="ident" id="6569491">b</span><span class="op" id="6569492">[</span><span class="num" id="6569493">0</span><span class="op" id="6569494">:</span><span class="op" id="6569495">]</span><span class="op" id="6569496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6569500">}</span>&nbsp;<span class="keyword" id="6569502">else</span>&nbsp;<span class="op" id="6569507">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569512">n</span><span class="op" id="6569513">,</span>&nbsp;<span class="ident" id="6569515">err</span>&nbsp;<span class="op" id="6569519">=</span>&nbsp;<span class="ident" id="6569521">c</span><span class="op" id="6569522">.</span><span class="ident" id="6569523">Read</span><span class="op" id="6569527">(</span><span class="ident" id="6569528">b</span><span class="op" id="6569529">[</span><span class="num" id="6569530">0</span><span class="op" id="6569531">:</span><span class="op" id="6569532">]</span><span class="op" id="6569533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6569537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569541">t1</span>&nbsp;<span class="op" id="6569544">:=</span>&nbsp;<span class="ident" id="6569547">time</span><span class="op" id="6569551">.</span><span class="ident" id="6569552">Now</span><span class="op" id="6569555">(</span><span class="op" id="6569556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6569560">if</span>&nbsp;<span class="ident" id="6569563">n</span>&nbsp;<span class="op" id="6569565">!=</span>&nbsp;<span class="num" id="6569568">0</span>&nbsp;<span class="op" id="6569570">||</span>&nbsp;<span class="ident" id="6569573">err</span>&nbsp;<span class="op" id="6569577">==</span>&nbsp;<span class="builtintype" id="6569580">nil</span>&nbsp;<span class="op" id="6569584">||</span>&nbsp;<span class="op" id="6569587">!</span><span class="ident" id="6569588">err</span><span class="op" id="6569591">.</span><span class="op" id="6569592">(</span><span class="ident" id="6569593">Error</span><span class="op" id="6569598">)</span><span class="op" id="6569599">.</span><span class="ident" id="6569600">Timeout</span><span class="op" id="6569607">(</span><span class="op" id="6569608">)</span>&nbsp;<span class="op" id="6569610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569615">errc</span>&nbsp;<span class="op" id="6569620">&lt;-</span>&nbsp;<span class="ident" id="6569623">fmt</span><span class="op" id="6569626">.</span><span class="ident" id="6569627">Errorf</span><span class="op" id="6569633">(</span><span class="string" id="6569634">&#34;%s(%q,&nbsp;%q)&nbsp;did&nbsp;not&nbsp;return&nbsp;0,&nbsp;timeout:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="6569680">,</span>&nbsp;<span class="ident" id="6569682">what</span><span class="op" id="6569686">,</span>&nbsp;<span class="ident" id="6569688">net</span><span class="op" id="6569691">,</span>&nbsp;<span class="ident" id="6569693">addr</span><span class="op" id="6569697">,</span>&nbsp;<span class="ident" id="6569699">n</span><span class="op" id="6569700">,</span>&nbsp;<span class="ident" id="6569702">err</span><span class="op" id="6569705">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6569710">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6569719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6569723">if</span>&nbsp;<span class="ident" id="6569726">dt</span>&nbsp;<span class="op" id="6569729">:=</span>&nbsp;<span class="ident" id="6569732">t1</span><span class="op" id="6569734">.</span><span class="ident" id="6569735">Sub</span><span class="op" id="6569738">(</span><span class="ident" id="6569739">t0</span><span class="op" id="6569741">)</span><span class="op" id="6569742">;</span>&nbsp;<span class="ident" id="6569744">dt</span>&nbsp;<span class="op" id="6569747">&lt;</span>&nbsp;<span class="num" id="6569749">50</span><span class="op" id="6569751">*</span><span class="ident" id="6569752">time</span><span class="op" id="6569756">.</span><span class="ident" id="6569757">Millisecond</span>&nbsp;<span class="op" id="6569769">||</span>&nbsp;<span class="op" id="6569772">!</span><span class="ident" id="6569773">testing</span><span class="op" id="6569780">.</span><span class="ident" id="6569781">Short</span><span class="op" id="6569786">(</span><span class="op" id="6569787">)</span>&nbsp;<span class="op" id="6569789">&amp;&amp;</span>&nbsp;<span class="ident" id="6569792">dt</span>&nbsp;<span class="op" id="6569795">&gt;</span>&nbsp;<span class="num" id="6569797">250</span><span class="op" id="6569800">*</span><span class="ident" id="6569801">time</span><span class="op" id="6569805">.</span><span class="ident" id="6569806">Millisecond</span>&nbsp;<span class="op" id="6569818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569823">errc</span>&nbsp;<span class="op" id="6569828">&lt;-</span>&nbsp;<span class="ident" id="6569831">fmt</span><span class="op" id="6569834">.</span><span class="ident" id="6569835">Errorf</span><span class="op" id="6569841">(</span><span class="string" id="6569842">&#34;%s(%q,&nbsp;%q)&nbsp;took&nbsp;%s,&nbsp;expected&nbsp;0.1s&#34;</span><span class="op" id="6569877">,</span>&nbsp;<span class="ident" id="6569879">what</span><span class="op" id="6569883">,</span>&nbsp;<span class="ident" id="6569885">net</span><span class="op" id="6569888">,</span>&nbsp;<span class="ident" id="6569890">addr</span><span class="op" id="6569894">,</span>&nbsp;<span class="ident" id="6569896">dt</span><span class="op" id="6569898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6569903">return</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6569912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569916">errc</span>&nbsp;<span class="op" id="6569921">&lt;-</span>&nbsp;<span class="builtintype" id="6569924">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6569929">}</span><span class="op" id="6569930">(</span><span class="op" id="6569931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6569934">select</span>&nbsp;<span class="op" id="6569941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6569944">case</span>&nbsp;<span class="ident" id="6569949">err</span>&nbsp;<span class="op" id="6569953">:=</span>&nbsp;<span class="op" id="6569956">&lt;-</span><span class="ident" id="6569958">errc</span><span class="op" id="6569962">:</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6569966">if</span>&nbsp;<span class="ident" id="6569969">err</span>&nbsp;<span class="op" id="6569973">!=</span>&nbsp;<span class="builtintype" id="6569976">nil</span>&nbsp;<span class="op" id="6569980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569985">t</span><span class="op" id="6569986">.</span><span class="ident" id="6569987">Error</span><span class="op" id="6569992">(</span><span class="ident" id="6569993">err</span><span class="op" id="6569996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6570000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6570003">case</span>&nbsp;<span class="op" id="6570008">&lt;-</span><span class="ident" id="6570010">time</span><span class="op" id="6570014">.</span><span class="ident" id="6570015">After</span><span class="op" id="6570020">(</span><span class="num" id="6570021">1</span>&nbsp;<span class="op" id="6570023">*</span>&nbsp;<span class="ident" id="6570025">time</span><span class="op" id="6570029">.</span><span class="ident" id="6570030">Second</span><span class="op" id="6570036">)</span><span class="op" id="6570037">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570041">t</span><span class="op" id="6570042">.</span><span class="ident" id="6570043">Errorf</span><span class="op" id="6570049">(</span><span class="string" id="6570050">&#34;%s(%q,&nbsp;%q)&nbsp;took&nbsp;over&nbsp;1&nbsp;second,&nbsp;expected&nbsp;0.1s&#34;</span><span class="op" id="6570096">,</span>&nbsp;<span class="ident" id="6570098">what</span><span class="op" id="6570102">,</span>&nbsp;<span class="ident" id="6570104">net</span><span class="op" id="6570107">,</span>&nbsp;<span class="ident" id="6570109">addr</span><span class="op" id="6570113">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6570116">}</span><br>
<span class="lineno"></span><span class="op" id="6570118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6570121">func</span>&nbsp;<span class="ident" id="6570126">TestTimeoutUDP</span><span class="op" id="6570140">(</span><span class="ident" id="6570141">t</span>&nbsp;<span class="op" id="6570143">*</span><span class="ident" id="6570144">testing</span><span class="op" id="6570151">.</span><span class="ident" id="6570152">T</span><span class="op" id="6570153">)</span>&nbsp;<span class="op" id="6570155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6570158">switch</span>&nbsp;<span class="ident" id="6570165">runtime</span><span class="op" id="6570172">.</span><span class="ident" id="6570173">GOOS</span>&nbsp;<span class="op" id="6570178">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6570181">case</span>&nbsp;<span class="string" id="6570186">&#34;plan9&#34;</span><span class="op" id="6570193">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570197">t</span><span class="op" id="6570198">.</span><span class="ident" id="6570199">Skipf</span><span class="op" id="6570204">(</span><span class="string" id="6570205">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6570226">,</span>&nbsp;<span class="ident" id="6570228">runtime</span><span class="op" id="6570235">.</span><span class="ident" id="6570236">GOOS</span><span class="op" id="6570240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6570243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6570247">//&nbsp;set&nbsp;up&nbsp;a&nbsp;listener&nbsp;that&nbsp;won&#39;t&nbsp;talk&nbsp;back</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570290">listening</span>&nbsp;<span class="op" id="6570300">:=</span>&nbsp;<span class="builtinfunc" id="6570303">make</span><span class="op" id="6570307">(</span><span class="keyword" id="6570308">chan</span>&nbsp;<span class="builtintype" id="6570313">string</span><span class="op" id="6570319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570322">done</span>&nbsp;<span class="op" id="6570327">:=</span>&nbsp;<span class="builtinfunc" id="6570330">make</span><span class="op" id="6570334">(</span><span class="keyword" id="6570335">chan</span>&nbsp;<span class="builtintype" id="6570340">int</span><span class="op" id="6570343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6570346">go</span>&nbsp;<span class="ident" id="6570349">runDatagramPacketConnServer</span><span class="op" id="6570376">(</span><span class="ident" id="6570377">t</span><span class="op" id="6570378">,</span>&nbsp;<span class="string" id="6570380">&#34;udp&#34;</span><span class="op" id="6570385">,</span>&nbsp;<span class="string" id="6570387">&#34;127.0.0.1:0&#34;</span><span class="op" id="6570400">,</span>&nbsp;<span class="ident" id="6570402">listening</span><span class="op" id="6570411">,</span>&nbsp;<span class="ident" id="6570413">done</span><span class="op" id="6570417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570420">addr</span>&nbsp;<span class="op" id="6570425">:=</span>&nbsp;<span class="op" id="6570428">&lt;-</span><span class="ident" id="6570430">listening</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570442">testTimeout</span><span class="op" id="6570453">(</span><span class="ident" id="6570454">t</span><span class="op" id="6570455">,</span>&nbsp;<span class="string" id="6570457">&#34;udp&#34;</span><span class="op" id="6570462">,</span>&nbsp;<span class="ident" id="6570464">addr</span><span class="op" id="6570468">,</span>&nbsp;<span class="builtintype" id="6570470">false</span><span class="op" id="6570475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570478">testTimeout</span><span class="op" id="6570489">(</span><span class="ident" id="6570490">t</span><span class="op" id="6570491">,</span>&nbsp;<span class="string" id="6570493">&#34;udp&#34;</span><span class="op" id="6570498">,</span>&nbsp;<span class="ident" id="6570500">addr</span><span class="op" id="6570504">,</span>&nbsp;<span class="builtintype" id="6570506">true</span><span class="op" id="6570510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6570513">&lt;-</span><span class="ident" id="6570515">done</span><br>
<span class="lineno"></span><span class="op" id="6570520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="6570523">func</span>&nbsp;<span class="ident" id="6570528">TestTimeoutTCP</span><span class="op" id="6570542">(</span><span class="ident" id="6570543">t</span>&nbsp;<span class="op" id="6570545">*</span><span class="ident" id="6570546">testing</span><span class="op" id="6570553">.</span><span class="ident" id="6570554">T</span><span class="op" id="6570555">)</span>&nbsp;<span class="op" id="6570557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6570560">switch</span>&nbsp;<span class="ident" id="6570567">runtime</span><span class="op" id="6570574">.</span><span class="ident" id="6570575">GOOS</span>&nbsp;<span class="op" id="6570580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6570583">case</span>&nbsp;<span class="string" id="6570588">&#34;plan9&#34;</span><span class="op" id="6570595">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570599">t</span><span class="op" id="6570600">.</span><span class="ident" id="6570601">Skipf</span><span class="op" id="6570606">(</span><span class="string" id="6570607">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6570628">,</span>&nbsp;<span class="ident" id="6570630">runtime</span><span class="op" id="6570637">.</span><span class="ident" id="6570638">GOOS</span><span class="op" id="6570642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6570645">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6570649">//&nbsp;set&nbsp;up&nbsp;a&nbsp;listener&nbsp;that&nbsp;won&#39;t&nbsp;talk&nbsp;back</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570692">listening</span>&nbsp;<span class="op" id="6570702">:=</span>&nbsp;<span class="builtinfunc" id="6570705">make</span><span class="op" id="6570709">(</span><span class="keyword" id="6570710">chan</span>&nbsp;<span class="builtintype" id="6570715">string</span><span class="op" id="6570721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570724">done</span>&nbsp;<span class="op" id="6570729">:=</span>&nbsp;<span class="builtinfunc" id="6570732">make</span><span class="op" id="6570736">(</span><span class="keyword" id="6570737">chan</span>&nbsp;<span class="builtintype" id="6570742">int</span><span class="op" id="6570745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6570748">go</span>&nbsp;<span class="ident" id="6570751">runStreamConnServer</span><span class="op" id="6570770">(</span><span class="ident" id="6570771">t</span><span class="op" id="6570772">,</span>&nbsp;<span class="string" id="6570774">&#34;tcp&#34;</span><span class="op" id="6570779">,</span>&nbsp;<span class="string" id="6570781">&#34;127.0.0.1:0&#34;</span><span class="op" id="6570794">,</span>&nbsp;<span class="ident" id="6570796">listening</span><span class="op" id="6570805">,</span>&nbsp;<span class="ident" id="6570807">done</span><span class="op" id="6570811">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570814">addr</span>&nbsp;<span class="op" id="6570819">:=</span>&nbsp;<span class="op" id="6570822">&lt;-</span><span class="ident" id="6570824">listening</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570836">testTimeout</span><span class="op" id="6570847">(</span><span class="ident" id="6570848">t</span><span class="op" id="6570849">,</span>&nbsp;<span class="string" id="6570851">&#34;tcp&#34;</span><span class="op" id="6570856">,</span>&nbsp;<span class="ident" id="6570858">addr</span><span class="op" id="6570862">,</span>&nbsp;<span class="builtintype" id="6570864">false</span><span class="op" id="6570869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6570872">&lt;-</span><span class="ident" id="6570874">done</span><br>
<span class="lineno"></span><span class="op" id="6570879">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="keyword" id="6570882">func</span>&nbsp;<span class="ident" id="6570887">TestDeadlineReset</span><span class="op" id="6570904">(</span><span class="ident" id="6570905">t</span>&nbsp;<span class="op" id="6570907">*</span><span class="ident" id="6570908">testing</span><span class="op" id="6570915">.</span><span class="ident" id="6570916">T</span><span class="op" id="6570917">)</span>&nbsp;<span class="op" id="6570919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6570922">switch</span>&nbsp;<span class="ident" id="6570929">runtime</span><span class="op" id="6570936">.</span><span class="ident" id="6570937">GOOS</span>&nbsp;<span class="op" id="6570942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6570945">case</span>&nbsp;<span class="string" id="6570950">&#34;plan9&#34;</span><span class="op" id="6570957">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570961">t</span><span class="op" id="6570962">.</span><span class="ident" id="6570963">Skipf</span><span class="op" id="6570968">(</span><span class="string" id="6570969">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6570990">,</span>&nbsp;<span class="ident" id="6570992">runtime</span><span class="op" id="6570999">.</span><span class="ident" id="6571000">GOOS</span><span class="op" id="6571004">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6571007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571010">ln</span><span class="op" id="6571012">,</span>&nbsp;<span class="ident" id="6571014">err</span>&nbsp;<span class="op" id="6571018">:=</span>&nbsp;<span class="ident" id="6571021">Listen</span><span class="op" id="6571027">(</span><span class="string" id="6571028">&#34;tcp&#34;</span><span class="op" id="6571033">,</span>&nbsp;<span class="string" id="6571035">&#34;127.0.0.1:0&#34;</span><span class="op" id="6571048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6571051">if</span>&nbsp;<span class="ident" id="6571054">err</span>&nbsp;<span class="op" id="6571058">!=</span>&nbsp;<span class="builtintype" id="6571061">nil</span>&nbsp;<span class="op" id="6571065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571069">t</span><span class="op" id="6571070">.</span><span class="ident" id="6571071">Fatal</span><span class="op" id="6571076">(</span><span class="ident" id="6571077">err</span><span class="op" id="6571080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6571083">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6571086">defer</span>&nbsp;<span class="ident" id="6571092">ln</span><span class="op" id="6571094">.</span><span class="ident" id="6571095">Close</span><span class="op" id="6571100">(</span><span class="op" id="6571101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571104">tl</span>&nbsp;<span class="op" id="6571107">:=</span>&nbsp;<span class="ident" id="6571110">ln</span><span class="op" id="6571112">.</span><span class="op" id="6571113">(</span><span class="op" id="6571114">*</span><span class="ident" id="6571115">TCPListener</span><span class="op" id="6571126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571129">tl</span><span class="op" id="6571131">.</span><span class="ident" id="6571132">SetDeadline</span><span class="op" id="6571143">(</span><span class="ident" id="6571144">time</span><span class="op" id="6571148">.</span><span class="ident" id="6571149">Now</span><span class="op" id="6571152">(</span><span class="op" id="6571153">)</span><span class="op" id="6571154">.</span><span class="ident" id="6571155">Add</span><span class="op" id="6571158">(</span><span class="num" id="6571159">1</span>&nbsp;<span class="op" id="6571161">*</span>&nbsp;<span class="ident" id="6571163">time</span><span class="op" id="6571167">.</span><span class="ident" id="6571168">Minute</span><span class="op" id="6571174">)</span><span class="op" id="6571175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571178">tl</span><span class="op" id="6571180">.</span><span class="ident" id="6571181">SetDeadline</span><span class="op" id="6571192">(</span><span class="ident" id="6571193">noDeadline</span><span class="op" id="6571203">)</span>&nbsp;<span class="comment" id="6571205">//&nbsp;reset&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571218">errc</span>&nbsp;<span class="op" id="6571223">:=</span>&nbsp;<span class="builtinfunc" id="6571226">make</span><span class="op" id="6571230">(</span><span class="keyword" id="6571231">chan</span>&nbsp;<span class="builtintype" id="6571236">error</span><span class="op" id="6571241">,</span>&nbsp;<span class="num" id="6571243">1</span><span class="op" id="6571244">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6571247">go</span>&nbsp;<span class="keyword" id="6571250">func</span><span class="op" id="6571254">(</span><span class="op" id="6571255">)</span>&nbsp;<span class="op" id="6571257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571261">_</span><span class="op" id="6571262">,</span>&nbsp;<span class="ident" id="6571264">err</span>&nbsp;<span class="op" id="6571268">:=</span>&nbsp;<span class="ident" id="6571271">ln</span><span class="op" id="6571273">.</span><span class="ident" id="6571274">Accept</span><span class="op" id="6571280">(</span><span class="op" id="6571281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571285">errc</span>&nbsp;<span class="op" id="6571290">&lt;-</span>&nbsp;<span class="ident" id="6571293">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6571298">}</span><span class="op" id="6571299">(</span><span class="op" id="6571300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6571303">select</span>&nbsp;<span class="op" id="6571310">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6571313">case</span>&nbsp;<span class="op" id="6571318">&lt;-</span><span class="ident" id="6571320">time</span><span class="op" id="6571324">.</span><span class="ident" id="6571325">After</span><span class="op" id="6571330">(</span><span class="num" id="6571331">50</span>&nbsp;<span class="op" id="6571334">*</span>&nbsp;<span class="ident" id="6571336">time</span><span class="op" id="6571340">.</span><span class="ident" id="6571341">Millisecond</span><span class="op" id="6571352">)</span><span class="op" id="6571353">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6571357">//&nbsp;Pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6571367">case</span>&nbsp;<span class="ident" id="6571372">err</span>&nbsp;<span class="op" id="6571376">:=</span>&nbsp;<span class="op" id="6571379">&lt;-</span><span class="ident" id="6571381">errc</span><span class="op" id="6571385">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6571389">//&nbsp;Accept&nbsp;should&nbsp;never&nbsp;return;&nbsp;we&nbsp;never</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6571431">//&nbsp;connected&nbsp;to&nbsp;it.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571453">t</span><span class="op" id="6571454">.</span><span class="ident" id="6571455">Errorf</span><span class="op" id="6571461">(</span><span class="string" id="6571462">&#34;unexpected&nbsp;return&nbsp;from&nbsp;Accept;&nbsp;err=%v&#34;</span><span class="op" id="6571501">,</span>&nbsp;<span class="ident" id="6571503">err</span><span class="op" id="6571506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6571509">}</span><br>
<span class="lineno"></span><span class="op" id="6571511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6571514">func</span>&nbsp;<span class="ident" id="6571519">TestTimeoutAccept</span><span class="op" id="6571536">(</span><span class="ident" id="6571537">t</span>&nbsp;<span class="op" id="6571539">*</span><span class="ident" id="6571540">testing</span><span class="op" id="6571547">.</span><span class="ident" id="6571548">T</span><span class="op" id="6571549">)</span>&nbsp;<span class="op" id="6571551">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6571554">switch</span>&nbsp;<span class="ident" id="6571561">runtime</span><span class="op" id="6571568">.</span><span class="ident" id="6571569">GOOS</span>&nbsp;<span class="op" id="6571574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6571577">case</span>&nbsp;<span class="string" id="6571582">&#34;plan9&#34;</span><span class="op" id="6571589">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571593">t</span><span class="op" id="6571594">.</span><span class="ident" id="6571595">Skipf</span><span class="op" id="6571600">(</span><span class="string" id="6571601">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6571622">,</span>&nbsp;<span class="ident" id="6571624">runtime</span><span class="op" id="6571631">.</span><span class="ident" id="6571632">GOOS</span><span class="op" id="6571636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6571639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571642">ln</span><span class="op" id="6571644">,</span>&nbsp;<span class="ident" id="6571646">err</span>&nbsp;<span class="op" id="6571650">:=</span>&nbsp;<span class="ident" id="6571653">Listen</span><span class="op" id="6571659">(</span><span class="string" id="6571660">&#34;tcp&#34;</span><span class="op" id="6571665">,</span>&nbsp;<span class="string" id="6571667">&#34;127.0.0.1:0&#34;</span><span class="op" id="6571680">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6571683">if</span>&nbsp;<span class="ident" id="6571686">err</span>&nbsp;<span class="op" id="6571690">!=</span>&nbsp;<span class="builtintype" id="6571693">nil</span>&nbsp;<span class="op" id="6571697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571701">t</span><span class="op" id="6571702">.</span><span class="ident" id="6571703">Fatal</span><span class="op" id="6571708">(</span><span class="ident" id="6571709">err</span><span class="op" id="6571712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6571715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6571718">defer</span>&nbsp;<span class="ident" id="6571724">ln</span><span class="op" id="6571726">.</span><span class="ident" id="6571727">Close</span><span class="op" id="6571732">(</span><span class="op" id="6571733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571736">tl</span>&nbsp;<span class="op" id="6571739">:=</span>&nbsp;<span class="ident" id="6571742">ln</span><span class="op" id="6571744">.</span><span class="op" id="6571745">(</span><span class="op" id="6571746">*</span><span class="ident" id="6571747">TCPListener</span><span class="op" id="6571758">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571761">tl</span><span class="op" id="6571763">.</span><span class="ident" id="6571764">SetDeadline</span><span class="op" id="6571775">(</span><span class="ident" id="6571776">time</span><span class="op" id="6571780">.</span><span class="ident" id="6571781">Now</span><span class="op" id="6571784">(</span><span class="op" id="6571785">)</span><span class="op" id="6571786">.</span><span class="ident" id="6571787">Add</span><span class="op" id="6571790">(</span><span class="num" id="6571791">100</span>&nbsp;<span class="op" id="6571795">*</span>&nbsp;<span class="ident" id="6571797">time</span><span class="op" id="6571801">.</span><span class="ident" id="6571802">Millisecond</span><span class="op" id="6571813">)</span><span class="op" id="6571814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571817">errc</span>&nbsp;<span class="op" id="6571822">:=</span>&nbsp;<span class="builtinfunc" id="6571825">make</span><span class="op" id="6571829">(</span><span class="keyword" id="6571830">chan</span>&nbsp;<span class="builtintype" id="6571835">error</span><span class="op" id="6571840">,</span>&nbsp;<span class="num" id="6571842">1</span><span class="op" id="6571843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6571846">go</span>&nbsp;<span class="keyword" id="6571849">func</span><span class="op" id="6571853">(</span><span class="op" id="6571854">)</span>&nbsp;<span class="op" id="6571856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571860">_</span><span class="op" id="6571861">,</span>&nbsp;<span class="ident" id="6571863">err</span>&nbsp;<span class="op" id="6571867">:=</span>&nbsp;<span class="ident" id="6571870">ln</span><span class="op" id="6571872">.</span><span class="ident" id="6571873">Accept</span><span class="op" id="6571879">(</span><span class="op" id="6571880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571884">errc</span>&nbsp;<span class="op" id="6571889">&lt;-</span>&nbsp;<span class="ident" id="6571892">err</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6571897">}</span><span class="op" id="6571898">(</span><span class="op" id="6571899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6571902">select</span>&nbsp;<span class="op" id="6571909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6571912">case</span>&nbsp;<span class="op" id="6571917">&lt;-</span><span class="ident" id="6571919">time</span><span class="op" id="6571923">.</span><span class="ident" id="6571924">After</span><span class="op" id="6571929">(</span><span class="num" id="6571930">1</span>&nbsp;<span class="op" id="6571932">*</span>&nbsp;<span class="ident" id="6571934">time</span><span class="op" id="6571938">.</span><span class="ident" id="6571939">Second</span><span class="op" id="6571945">)</span><span class="op" id="6571946">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6571950">//&nbsp;Accept&nbsp;shouldn&#39;t&nbsp;block&nbsp;indefinitely</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571991">t</span><span class="op" id="6571992">.</span><span class="ident" id="6571993">Errorf</span><span class="op" id="6571999">(</span><span class="string" id="6572000">&#34;Accept&nbsp;didn&#39;t&nbsp;return&nbsp;in&nbsp;an&nbsp;expected&nbsp;time&#34;</span><span class="op" id="6572042">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6572045">case</span>&nbsp;<span class="op" id="6572050">&lt;-</span><span class="ident" id="6572052">errc</span><span class="op" id="6572056">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6572060">//&nbsp;Pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6572070">}</span><br>
<span class="lineno"></span><span class="op" id="6572072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="6572075">func</span>&nbsp;<span class="ident" id="6572080">TestReadWriteDeadline</span><span class="op" id="6572101">(</span><span class="ident" id="6572102">t</span>&nbsp;<span class="op" id="6572104">*</span><span class="ident" id="6572105">testing</span><span class="op" id="6572112">.</span><span class="ident" id="6572113">T</span><span class="op" id="6572114">)</span>&nbsp;<span class="op" id="6572116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6572119">switch</span>&nbsp;<span class="ident" id="6572126">runtime</span><span class="op" id="6572133">.</span><span class="ident" id="6572134">GOOS</span>&nbsp;<span class="op" id="6572139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6572142">case</span>&nbsp;<span class="string" id="6572147">&#34;plan9&#34;</span><span class="op" id="6572154">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6572158">t</span><span class="op" id="6572159">.</span><span class="ident" id="6572160">Skipf</span><span class="op" id="6572165">(</span><span class="string" id="6572166">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6572187">,</span>&nbsp;<span class="ident" id="6572189">runtime</span><span class="op" id="6572196">.</span><span class="ident" id="6572197">GOOS</span><span class="op" id="6572201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6572204">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6572208">const</span>&nbsp;<span class="op" id="6572214">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6572218">readTimeout</span>&nbsp;&nbsp;<span class="op" id="6572231">=</span>&nbsp;<span class="num" id="6572233">50</span>&nbsp;<span class="op" id="6572236">*</span>&nbsp;<span class="ident" id="6572238">time</span><span class="op" id="6572242">.</span><span class="ident" id="6572243">Millisecond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6572257">writeTimeout</span>&nbsp;<span class="op" id="6572270">=</span>&nbsp;<span class="num" id="6572272">250</span>&nbsp;<span class="op" id="6572276">*</span>&nbsp;<span class="ident" id="6572278">time</span><span class="op" id="6572282">.</span><span class="ident" id="6572283">Millisecond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6572296">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6572299">checkTimeout</span>&nbsp;<span class="op" id="6572312">:=</span>&nbsp;<span class="keyword" id="6572315">func</span><span class="op" id="6572319">(</span><span class="ident" id="6572320">command</span>&nbsp;<span class="builtintype" id="6572328">string</span><span class="op" id="6572334">,</span>&nbsp;<span class="ident" id="6572336">start</span>&nbsp;<span class="ident" id="6572342">time</span><span class="op" id="6572346">.</span><span class="ident" id="6572347">Time</span><span class="op" id="6572351">,</span>&nbsp;<span class="ident" id="6572353">should</span>&nbsp;<span class="ident" id="6572360">time</span><span class="op" id="6572364">.</span><span class="ident" id="6572365">Duration</span><span class="op" id="6572373">)</span>&nbsp;<span class="op" id="6572375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6572379">is</span>&nbsp;<span class="op" id="6572382">:=</span>&nbsp;<span class="ident" id="6572385">time</span><span class="op" id="6572389">.</span><span class="ident" id="6572390">Now</span><span class="op" id="6572393">(</span><span class="op" id="6572394">)</span><span class="op" id="6572395">.</span><span class="ident" id="6572396">Sub</span><span class="op" id="6572399">(</span><span class="ident" id="6572400">start</span><span class="op" id="6572405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6572409">d</span>&nbsp;<span class="op" id="6572411">:=</span>&nbsp;<span class="ident" id="6572414">is</span>&nbsp;<span class="op" id="6572417">-</span>&nbsp;<span class="ident" id="6572419">should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6572428">if</span>&nbsp;<span class="ident" id="6572431">d</span>&nbsp;<span class="op" id="6572433">&lt;</span>&nbsp;<span class="op" id="6572435">-</span><span class="num" id="6572436">30</span><span class="op" id="6572438">*</span><span class="ident" id="6572439">time</span><span class="op" id="6572443">.</span><span class="ident" id="6572444">Millisecond</span>&nbsp;<span class="op" id="6572456">||</span>&nbsp;<span class="op" id="6572459">!</span><span class="ident" id="6572460">testing</span><span class="op" id="6572467">.</span><span class="ident" id="6572468">Short</span><span class="op" id="6572473">(</span><span class="op" id="6572474">)</span>&nbsp;<span class="op" id="6572476">&amp;&amp;</span>&nbsp;<span class="num" id="6572479">150</span><span class="op" id="6572482">*</span><span class="ident" id="6572483">time</span><span class="op" id="6572487">.</span><span class="ident" id="6572488">Millisecond</span>&nbsp;<span class="op" id="6572500">&lt;</span>&nbsp;<span class="ident" id="6572502">d</span>&nbsp;<span class="op" id="6572504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6572509">t</span><span class="op" id="6572510">.</span><span class="ident" id="6572511">Errorf</span><span class="op" id="6572517">(</span><span class="string" id="6572518">&#34;%s&nbsp;timeout&nbsp;test&nbsp;failed:&nbsp;is=%v&nbsp;should=%v\n&#34;</span><span class="op" id="6572561">,</span>&nbsp;<span class="ident" id="6572563">command</span><span class="op" id="6572570">,</span>&nbsp;<span class="ident" id="6572572">is</span><span class="op" id="6572574">,</span>&nbsp;<span class="ident" id="6572576">should</span><span class="op" id="6572582">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6572586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6572589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6572593">ln</span><span class="op" id="6572595">,</span>&nbsp;<span class="ident" id="6572597">err</span>&nbsp;<span class="op" id="6572601">:=</span>&nbsp;<span class="ident" id="6572604">Listen</span><span class="op" id="6572610">(</span><span class="string" id="6572611">&#34;tcp&#34;</span><span class="op" id="6572616">,</span>&nbsp;<span class="string" id="6572618">&#34;127.0.0.1:0&#34;</span><span class="op" id="6572631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6572634">if</span>&nbsp;<span class="ident" id="6572637">err</span>&nbsp;<span class="op" id="6572641">!=</span>&nbsp;<span class="builtintype" id="6572644">nil</span>&nbsp;<span class="op" id="6572648">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6572652">t</span><span class="op" id="6572653">.</span><span class="ident" id="6572654">Fatalf</span><span class="op" id="6572660">(</span><span class="string" id="6572661">&#34;ListenTCP&nbsp;on&nbsp;:0:&nbsp;%v&#34;</span><span class="op" id="6572682">,</span>&nbsp;<span class="ident" id="6572684">err</span><span class="op" id="6572687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6572690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6572693">defer</span>&nbsp;<span class="ident" id="6572699">ln</span><span class="op" id="6572701">.</span><span class="ident" id="6572702">Close</span><span class="op" id="6572707">(</span><span class="op" id="6572708">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6572712">lnquit</span>&nbsp;<span class="op" id="6572719">:=</span>&nbsp;<span class="builtinfunc" id="6572722">make</span><span class="op" id="6572726">(</span><span class="keyword" id="6572727">chan</span>&nbsp;<span class="builtintype" id="6572732">bool</span><span class="op" id="6572736">)</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6572740">go</span>&nbsp;<span class="keyword" id="6572743">func</span><span class="op" id="6572747">(</span><span class="op" id="6572748">)</span>&nbsp;<span class="op" id="6572750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6572754">c</span><span class="op" id="6572755">,</span>&nbsp;<span class="ident" id="6572757">err</span>&nbsp;<span class="op" id="6572761">:=</span>&nbsp;<span class="ident" id="6572764">ln</span><span class="op" id="6572766">.</span><span class="ident" id="6572767">Accept</span><span class="op" id="6572773">(</span><span class="op" id="6572774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6572778">if</span>&nbsp;<span class="ident" id="6572781">err</span>&nbsp;<span class="op" id="6572785">!=</span>&nbsp;<span class="builtintype" id="6572788">nil</span>&nbsp;<span class="op" id="6572792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6572797">t</span><span class="op" id="6572798">.</span><span class="ident" id="6572799">Errorf</span><span class="op" id="6572805">(</span><span class="string" id="6572806">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="6572818">,</span>&nbsp;<span class="ident" id="6572820">err</span><span class="op" id="6572823">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6572828">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6572837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6572841">defer</span>&nbsp;<span class="ident" id="6572847">c</span><span class="op" id="6572848">.</span><span class="ident" id="6572849">Close</span><span class="op" id="6572854">(</span><span class="op" id="6572855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6572859">lnquit</span>&nbsp;<span class="op" id="6572866">&lt;-</span>&nbsp;<span class="builtintype" id="6572869">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6572875">}</span><span class="op" id="6572876">(</span><span class="op" id="6572877">)</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6572881">c</span><span class="op" id="6572882">,</span>&nbsp;<span class="ident" id="6572884">err</span>&nbsp;<span class="op" id="6572888">:=</span>&nbsp;<span class="ident" id="6572891">Dial</span><span class="op" id="6572895">(</span><span class="string" id="6572896">&#34;tcp&#34;</span><span class="op" id="6572901">,</span>&nbsp;<span class="ident" id="6572903">ln</span><span class="op" id="6572905">.</span><span class="ident" id="6572906">Addr</span><span class="op" id="6572910">(</span><span class="op" id="6572911">)</span><span class="op" id="6572912">.</span><span class="ident" id="6572913">String</span><span class="op" id="6572919">(</span><span class="op" id="6572920">)</span><span class="op" id="6572921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6572924">if</span>&nbsp;<span class="ident" id="6572927">err</span>&nbsp;<span class="op" id="6572931">!=</span>&nbsp;<span class="builtintype" id="6572934">nil</span>&nbsp;<span class="op" id="6572938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6572942">t</span><span class="op" id="6572943">.</span><span class="ident" id="6572944">Fatalf</span><span class="op" id="6572950">(</span><span class="string" id="6572951">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="6572961">,</span>&nbsp;<span class="ident" id="6572963">err</span><span class="op" id="6572966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6572969">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6572972">defer</span>&nbsp;<span class="ident" id="6572978">c</span><span class="op" id="6572979">.</span><span class="ident" id="6572980">Close</span><span class="op" id="6572985">(</span><span class="op" id="6572986">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6572990">start</span>&nbsp;<span class="op" id="6572996">:=</span>&nbsp;<span class="ident" id="6572999">time</span><span class="op" id="6573003">.</span><span class="ident" id="6573004">Now</span><span class="op" id="6573007">(</span><span class="op" id="6573008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6573011">err</span>&nbsp;<span class="op" id="6573015">=</span>&nbsp;<span class="ident" id="6573017">c</span><span class="op" id="6573018">.</span><span class="ident" id="6573019">SetReadDeadline</span><span class="op" id="6573034">(</span><span class="ident" id="6573035">start</span><span class="op" id="6573040">.</span><span class="ident" id="6573041">Add</span><span class="op" id="6573044">(</span><span class="ident" id="6573045">readTimeout</span><span class="op" id="6573056">)</span><span class="op" id="6573057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6573060">if</span>&nbsp;<span class="ident" id="6573063">err</span>&nbsp;<span class="op" id="6573067">!=</span>&nbsp;<span class="builtintype" id="6573070">nil</span>&nbsp;<span class="op" id="6573074">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6573078">t</span><span class="op" id="6573079">.</span><span class="ident" id="6573080">Fatalf</span><span class="op" id="6573086">(</span><span class="string" id="6573087">&#34;SetReadDeadline:&nbsp;%v&#34;</span><span class="op" id="6573108">,</span>&nbsp;<span class="ident" id="6573110">err</span><span class="op" id="6573113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6573116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6573119">err</span>&nbsp;<span class="op" id="6573123">=</span>&nbsp;<span class="ident" id="6573125">c</span><span class="op" id="6573126">.</span><span class="ident" id="6573127">SetWriteDeadline</span><span class="op" id="6573143">(</span><span class="ident" id="6573144">start</span><span class="op" id="6573149">.</span><span class="ident" id="6573150">Add</span><span class="op" id="6573153">(</span><span class="ident" id="6573154">writeTimeout</span><span class="op" id="6573166">)</span><span class="op" id="6573167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6573170">if</span>&nbsp;<span class="ident" id="6573173">err</span>&nbsp;<span class="op" id="6573177">!=</span>&nbsp;<span class="builtintype" id="6573180">nil</span>&nbsp;<span class="op" id="6573184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6573188">t</span><span class="op" id="6573189">.</span><span class="ident" id="6573190">Fatalf</span><span class="op" id="6573196">(</span><span class="string" id="6573197">&#34;SetWriteDeadline:&nbsp;%v&#34;</span><span class="op" id="6573219">,</span>&nbsp;<span class="ident" id="6573221">err</span><span class="op" id="6573224">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6573227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6573231">quit</span>&nbsp;<span class="op" id="6573236">:=</span>&nbsp;<span class="builtinfunc" id="6573239">make</span><span class="op" id="6573243">(</span><span class="keyword" id="6573244">chan</span>&nbsp;<span class="builtintype" id="6573249">bool</span><span class="op" id="6573253">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6573257">go</span>&nbsp;<span class="keyword" id="6573260">func</span><span class="op" id="6573264">(</span><span class="op" id="6573265">)</span>&nbsp;<span class="op" id="6573267">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6573271">var</span>&nbsp;<span class="ident" id="6573275">buf</span>&nbsp;<span class="op" id="6573279">[</span><span class="num" id="6573280">10</span><span class="op" id="6573282">]</span><span class="builtintype" id="6573283">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6573290">_</span><span class="op" id="6573291">,</span>&nbsp;<span class="ident" id="6573293">err</span>&nbsp;<span class="op" id="6573297">:=</span>&nbsp;<span class="ident" id="6573300">c</span><span class="op" id="6573301">.</span><span class="ident" id="6573302">Read</span><span class="op" id="6573306">(</span><span class="ident" id="6573307">buf</span><span class="op" id="6573310">[</span><span class="op" id="6573311">:</span><span class="op" id="6573312">]</span><span class="op" id="6573313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6573317">if</span>&nbsp;<span class="ident" id="6573320">err</span>&nbsp;<span class="op" id="6573324">==</span>&nbsp;<span class="builtintype" id="6573327">nil</span>&nbsp;<span class="op" id="6573331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6573336">t</span><span class="op" id="6573337">.</span><span class="ident" id="6573338">Errorf</span><span class="op" id="6573344">(</span><span class="string" id="6573345">&#34;Read&nbsp;should&nbsp;not&nbsp;succeed&#34;</span><span class="op" id="6573370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6573374">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6573378">checkTimeout</span><span class="op" id="6573390">(</span><span class="string" id="6573391">&#34;Read&#34;</span><span class="op" id="6573397">,</span>&nbsp;<span class="ident" id="6573399">start</span><span class="op" id="6573404">,</span>&nbsp;<span class="ident" id="6573406">readTimeout</span><span class="op" id="6573417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6573421">quit</span>&nbsp;<span class="op" id="6573426">&lt;-</span>&nbsp;<span class="builtintype" id="6573429">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6573435">}</span><span class="op" id="6573436">(</span><span class="op" id="6573437">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6573441">go</span>&nbsp;<span class="keyword" id="6573444">func</span><span class="op" id="6573448">(</span><span class="op" id="6573449">)</span>&nbsp;<span class="op" id="6573451">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6573455">var</span>&nbsp;<span class="ident" id="6573459">buf</span>&nbsp;<span class="op" id="6573463">[</span><span class="num" id="6573464">10000</span><span class="op" id="6573469">]</span><span class="builtintype" id="6573470">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6573477">for</span>&nbsp;<span class="op" id="6573481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6573486">_</span><span class="op" id="6573487">,</span>&nbsp;<span class="ident" id="6573489">err</span>&nbsp;<span class="op" id="6573493">:=</span>&nbsp;<span class="ident" id="6573496">c</span><span class="op" id="6573497">.</span><span class="ident" id="6573498">Write</span><span class="op" id="6573503">(</span><span class="ident" id="6573504">buf</span><span class="op" id="6573507">[</span><span class="op" id="6573508">:</span><span class="op" id="6573509">]</span><span class="op" id="6573510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6573515">if</span>&nbsp;<span class="ident" id="6573518">err</span>&nbsp;<span class="op" id="6573522">!=</span>&nbsp;<span class="builtintype" id="6573525">nil</span>&nbsp;<span class="op" id="6573529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6573535">break</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6573544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6573548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6573552">checkTimeout</span><span class="op" id="6573564">(</span><span class="string" id="6573565">&#34;Write&#34;</span><span class="op" id="6573572">,</span>&nbsp;<span class="ident" id="6573574">start</span><span class="op" id="6573579">,</span>&nbsp;<span class="ident" id="6573581">writeTimeout</span><span class="op" id="6573593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6573597">quit</span>&nbsp;<span class="op" id="6573602">&lt;-</span>&nbsp;<span class="builtintype" id="6573605">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6573611">}</span><span class="op" id="6573612">(</span><span class="op" id="6573613">)</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6573617">&lt;-</span><span class="ident" id="6573619">quit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6573625">&lt;-</span><span class="ident" id="6573627">quit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6573633">&lt;-</span><span class="ident" id="6573635">lnquit</span><br>
<span class="lineno"></span><span class="op" id="6573642">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="6573645">type</span>&nbsp;<span class="ident" id="6573650">neverEnding</span>&nbsp;<span class="builtintype" id="6573662">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6573668">func</span>&nbsp;<span class="op" id="6573673">(</span><span class="ident" id="6573674">b</span>&nbsp;<span class="ident" id="6573676">neverEnding</span><span class="op" id="6573687">)</span>&nbsp;<span class="ident" id="6573689">Read</span><span class="op" id="6573693">(</span><span class="ident" id="6573694">p</span>&nbsp;<span class="op" id="6573696">[</span><span class="op" id="6573697">]</span><span class="builtintype" id="6573698">byte</span><span class="op" id="6573702">)</span>&nbsp;<span class="op" id="6573704">(</span><span class="ident" id="6573705">n</span>&nbsp;<span class="builtintype" id="6573707">int</span><span class="op" id="6573710">,</span>&nbsp;<span class="ident" id="6573712">err</span>&nbsp;<span class="builtintype" id="6573716">error</span><span class="op" id="6573721">)</span>&nbsp;<span class="op" id="6573723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6573726">for</span>&nbsp;<span class="ident" id="6573730">i</span>&nbsp;<span class="op" id="6573732">:=</span>&nbsp;<span class="keyword" id="6573735">range</span>&nbsp;<span class="ident" id="6573741">p</span>&nbsp;<span class="op" id="6573743">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6573747">p</span><span class="op" id="6573748">[</span><span class="ident" id="6573749">i</span><span class="op" id="6573750">]</span>&nbsp;<span class="op" id="6573752">=</span>&nbsp;<span class="builtintype" id="6573754">byte</span><span class="op" id="6573758">(</span><span class="ident" id="6573759">b</span><span class="op" id="6573760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6573763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6573766">return</span>&nbsp;<span class="builtinfunc" id="6573773">len</span><span class="op" id="6573776">(</span><span class="ident" id="6573777">p</span><span class="op" id="6573778">)</span><span class="op" id="6573779">,</span>&nbsp;<span class="builtintype" id="6573781">nil</span><br>
<span class="lineno"></span><span class="op" id="6573785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="keyword" id="6573788">func</span>&nbsp;<span class="ident" id="6573793">TestVariousDeadlines1Proc</span><span class="op" id="6573818">(</span><span class="ident" id="6573819">t</span>&nbsp;<span class="op" id="6573821">*</span><span class="ident" id="6573822">testing</span><span class="op" id="6573829">.</span><span class="ident" id="6573830">T</span><span class="op" id="6573831">)</span>&nbsp;<span class="op" id="6573833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6573836">testVariousDeadlines</span><span class="op" id="6573856">(</span><span class="ident" id="6573857">t</span><span class="op" id="6573858">,</span>&nbsp;<span class="num" id="6573860">1</span><span class="op" id="6573861">)</span><br>
<span class="lineno"></span><span class="op" id="6573863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6573866">func</span>&nbsp;<span class="ident" id="6573871">TestVariousDeadlines4Proc</span><span class="op" id="6573896">(</span><span class="ident" id="6573897">t</span>&nbsp;<span class="op" id="6573899">*</span><span class="ident" id="6573900">testing</span><span class="op" id="6573907">.</span><span class="ident" id="6573908">T</span><span class="op" id="6573909">)</span>&nbsp;<span class="op" id="6573911">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6573914">testVariousDeadlines</span><span class="op" id="6573934">(</span><span class="ident" id="6573935">t</span><span class="op" id="6573936">,</span>&nbsp;<span class="num" id="6573938">4</span><span class="op" id="6573939">)</span><br>
<span class="lineno"></span><span class="op" id="6573941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6573944">func</span>&nbsp;<span class="ident" id="6573949">testVariousDeadlines</span><span class="op" id="6573969">(</span><span class="ident" id="6573970">t</span>&nbsp;<span class="op" id="6573972">*</span><span class="ident" id="6573973">testing</span><span class="op" id="6573980">.</span><span class="ident" id="6573981">T</span><span class="op" id="6573982">,</span>&nbsp;<span class="ident" id="6573984">maxProcs</span>&nbsp;<span class="builtintype" id="6573993">int</span><span class="op" id="6573996">)</span>&nbsp;<span class="op" id="6573998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6574001">switch</span>&nbsp;<span class="ident" id="6574008">runtime</span><span class="op" id="6574015">.</span><span class="ident" id="6574016">GOOS</span>&nbsp;<span class="op" id="6574021">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6574024">case</span>&nbsp;<span class="string" id="6574029">&#34;plan9&#34;</span><span class="op" id="6574036">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6574040">t</span><span class="op" id="6574041">.</span><span class="ident" id="6574042">Skipf</span><span class="op" id="6574047">(</span><span class="string" id="6574048">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6574069">,</span>&nbsp;<span class="ident" id="6574071">runtime</span><span class="op" id="6574078">.</span><span class="ident" id="6574079">GOOS</span><span class="op" id="6574083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6574086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6574090">defer</span>&nbsp;<span class="ident" id="6574096">runtime</span><span class="op" id="6574103">.</span><span class="ident" id="6574104">GOMAXPROCS</span><span class="op" id="6574114">(</span><span class="ident" id="6574115">runtime</span><span class="op" id="6574122">.</span><span class="ident" id="6574123">GOMAXPROCS</span><span class="op" id="6574133">(</span><span class="ident" id="6574134">maxProcs</span><span class="op" id="6574142">)</span><span class="op" id="6574143">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6574146">ln</span>&nbsp;<span class="op" id="6574149">:=</span>&nbsp;<span class="ident" id="6574152">newLocalListener</span><span class="op" id="6574168">(</span><span class="ident" id="6574169">t</span><span class="op" id="6574170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6574173">defer</span>&nbsp;<span class="ident" id="6574179">ln</span><span class="op" id="6574181">.</span><span class="ident" id="6574182">Close</span><span class="op" id="6574187">(</span><span class="op" id="6574188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6574191">acceptc</span>&nbsp;<span class="op" id="6574199">:=</span>&nbsp;<span class="builtinfunc" id="6574202">make</span><span class="op" id="6574206">(</span><span class="keyword" id="6574207">chan</span>&nbsp;<span class="builtintype" id="6574212">error</span><span class="op" id="6574217">,</span>&nbsp;<span class="num" id="6574219">1</span><span class="op" id="6574220">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6574224">//&nbsp;The&nbsp;server,&nbsp;with&nbsp;no&nbsp;timeouts&nbsp;of&nbsp;its&nbsp;own,&nbsp;sending&nbsp;bytes&nbsp;to&nbsp;clients</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6574294">//&nbsp;as&nbsp;fast&nbsp;as&nbsp;it&nbsp;can.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6574317">servec</span>&nbsp;<span class="op" id="6574324">:=</span>&nbsp;<span class="builtinfunc" id="6574327">make</span><span class="op" id="6574331">(</span><span class="keyword" id="6574332">chan</span>&nbsp;<span class="ident" id="6574337">copyRes</span><span class="op" id="6574344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6574347">go</span>&nbsp;<span class="keyword" id="6574350">func</span><span class="op" id="6574354">(</span><span class="op" id="6574355">)</span>&nbsp;<span class="op" id="6574357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6574361">for</span>&nbsp;<span class="op" id="6574365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6574370">c</span><span class="op" id="6574371">,</span>&nbsp;<span class="ident" id="6574373">err</span>&nbsp;<span class="op" id="6574377">:=</span>&nbsp;<span class="ident" id="6574380">ln</span><span class="op" id="6574382">.</span><span class="ident" id="6574383">Accept</span><span class="op" id="6574389">(</span><span class="op" id="6574390">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6574395">if</span>&nbsp;<span class="ident" id="6574398">err</span>&nbsp;<span class="op" id="6574402">!=</span>&nbsp;<span class="builtintype" id="6574405">nil</span>&nbsp;<span class="op" id="6574409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6574415">acceptc</span>&nbsp;<span class="op" id="6574423">&lt;-</span>&nbsp;<span class="ident" id="6574426">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6574434">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6574444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6574449">go</span>&nbsp;<span class="keyword" id="6574452">func</span><span class="op" id="6574456">(</span><span class="op" id="6574457">)</span>&nbsp;<span class="op" id="6574459">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6574465">t0</span>&nbsp;<span class="op" id="6574468">:=</span>&nbsp;<span class="ident" id="6574471">time</span><span class="op" id="6574475">.</span><span class="ident" id="6574476">Now</span><span class="op" id="6574479">(</span><span class="op" id="6574480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6574486">n</span><span class="op" id="6574487">,</span>&nbsp;<span class="ident" id="6574489">err</span>&nbsp;<span class="op" id="6574493">:=</span>&nbsp;<span class="ident" id="6574496">io</span><span class="op" id="6574498">.</span><span class="ident" id="6574499">Copy</span><span class="op" id="6574503">(</span><span class="ident" id="6574504">c</span><span class="op" id="6574505">,</span>&nbsp;<span class="ident" id="6574507">neverEnding</span><span class="op" id="6574518">(</span><span class="string" id="6574519">&#39;a&#39;</span><span class="op" id="6574522">)</span><span class="op" id="6574523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6574529">d</span>&nbsp;<span class="op" id="6574531">:=</span>&nbsp;<span class="ident" id="6574534">time</span><span class="op" id="6574538">.</span><span class="ident" id="6574539">Since</span><span class="op" id="6574544">(</span><span class="ident" id="6574545">t0</span><span class="op" id="6574547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6574553">c</span><span class="op" id="6574554">.</span><span class="ident" id="6574555">Close</span><span class="op" id="6574560">(</span><span class="op" id="6574561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6574567">servec</span>&nbsp;<span class="op" id="6574574">&lt;-</span>&nbsp;<span class="ident" id="6574577">copyRes</span><span class="op" id="6574584">{</span><span class="ident" id="6574585">n</span><span class="op" id="6574586">,</span>&nbsp;<span class="ident" id="6574588">err</span><span class="op" id="6574591">,</span>&nbsp;<span class="ident" id="6574593">d</span><span class="op" id="6574594">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6574599">}</span><span class="op" id="6574600">(</span><span class="op" id="6574601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6574605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6574608">}</span><span class="op" id="6574609">(</span><span class="op" id="6574610">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6574614">for</span>&nbsp;<span class="ident" id="6574618">_</span><span class="op" id="6574619">,</span>&nbsp;<span class="ident" id="6574621">timeout</span>&nbsp;<span class="op" id="6574629">:=</span>&nbsp;<span class="keyword" id="6574632">range</span>&nbsp;<span class="op" id="6574638">[</span><span class="op" id="6574639">]</span><span class="ident" id="6574640">time</span><span class="op" id="6574644">.</span><span class="ident" id="6574645">Duration</span><span class="op" id="6574653">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6574657">1</span>&nbsp;<span class="op" id="6574659">*</span>&nbsp;<span class="ident" id="6574661">time</span><span class="op" id="6574665">.</span><span class="ident" id="6574666">Nanosecond</span><span class="op" id="6574676">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6574680">2</span>&nbsp;<span class="op" id="6574682">*</span>&nbsp;<span class="ident" id="6574684">time</span><span class="op" id="6574688">.</span><span class="ident" id="6574689">Nanosecond</span><span class="op" id="6574699">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6574703">5</span>&nbsp;<span class="op" id="6574705">*</span>&nbsp;<span class="ident" id="6574707">time</span><span class="op" id="6574711">.</span><span class="ident" id="6574712">Nanosecond</span><span class="op" id="6574722">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6574726">50</span>&nbsp;<span class="op" id="6574729">*</span>&nbsp;<span class="ident" id="6574731">time</span><span class="op" id="6574735">.</span><span class="ident" id="6574736">Nanosecond</span><span class="op" id="6574746">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6574750">100</span>&nbsp;<span class="op" id="6574754">*</span>&nbsp;<span class="ident" id="6574756">time</span><span class="op" id="6574760">.</span><span class="ident" id="6574761">Nanosecond</span><span class="op" id="6574771">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6574775">200</span>&nbsp;<span class="op" id="6574779">*</span>&nbsp;<span class="ident" id="6574781">time</span><span class="op" id="6574785">.</span><span class="ident" id="6574786">Nanosecond</span><span class="op" id="6574796">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6574800">500</span>&nbsp;<span class="op" id="6574804">*</span>&nbsp;<span class="ident" id="6574806">time</span><span class="op" id="6574810">.</span><span class="ident" id="6574811">Nanosecond</span><span class="op" id="6574821">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6574825">750</span>&nbsp;<span class="op" id="6574829">*</span>&nbsp;<span class="ident" id="6574831">time</span><span class="op" id="6574835">.</span><span class="ident" id="6574836">Nanosecond</span><span class="op" id="6574846">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6574850">1</span>&nbsp;<span class="op" id="6574852">*</span>&nbsp;<span class="ident" id="6574854">time</span><span class="op" id="6574858">.</span><span class="ident" id="6574859">Microsecond</span><span class="op" id="6574870">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6574874">5</span>&nbsp;<span class="op" id="6574876">*</span>&nbsp;<span class="ident" id="6574878">time</span><span class="op" id="6574882">.</span><span class="ident" id="6574883">Microsecond</span><span class="op" id="6574894">,</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6574898">25</span>&nbsp;<span class="op" id="6574901">*</span>&nbsp;<span class="ident" id="6574903">time</span><span class="op" id="6574907">.</span><span class="ident" id="6574908">Microsecond</span><span class="op" id="6574919">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6574923">250</span>&nbsp;<span class="op" id="6574927">*</span>&nbsp;<span class="ident" id="6574929">time</span><span class="op" id="6574933">.</span><span class="ident" id="6574934">Microsecond</span><span class="op" id="6574945">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6574949">500</span>&nbsp;<span class="op" id="6574953">*</span>&nbsp;<span class="ident" id="6574955">time</span><span class="op" id="6574959">.</span><span class="ident" id="6574960">Microsecond</span><span class="op" id="6574971">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6574975">1</span>&nbsp;<span class="op" id="6574977">*</span>&nbsp;<span class="ident" id="6574979">time</span><span class="op" id="6574983">.</span><span class="ident" id="6574984">Millisecond</span><span class="op" id="6574995">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6574999">5</span>&nbsp;<span class="op" id="6575001">*</span>&nbsp;<span class="ident" id="6575003">time</span><span class="op" id="6575007">.</span><span class="ident" id="6575008">Millisecond</span><span class="op" id="6575019">,</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6575023">100</span>&nbsp;<span class="op" id="6575027">*</span>&nbsp;<span class="ident" id="6575029">time</span><span class="op" id="6575033">.</span><span class="ident" id="6575034">Millisecond</span><span class="op" id="6575045">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6575049">250</span>&nbsp;<span class="op" id="6575053">*</span>&nbsp;<span class="ident" id="6575055">time</span><span class="op" id="6575059">.</span><span class="ident" id="6575060">Millisecond</span><span class="op" id="6575071">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6575075">500</span>&nbsp;<span class="op" id="6575079">*</span>&nbsp;<span class="ident" id="6575081">time</span><span class="op" id="6575085">.</span><span class="ident" id="6575086">Millisecond</span><span class="op" id="6575097">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6575101">1</span>&nbsp;<span class="op" id="6575103">*</span>&nbsp;<span class="ident" id="6575105">time</span><span class="op" id="6575109">.</span><span class="ident" id="6575110">Second</span><span class="op" id="6575116">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6575119">}</span>&nbsp;<span class="op" id="6575121">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6575125">numRuns</span>&nbsp;<span class="op" id="6575133">:=</span>&nbsp;<span class="num" id="6575136">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6575140">if</span>&nbsp;<span class="ident" id="6575143">testing</span><span class="op" id="6575150">.</span><span class="ident" id="6575151">Short</span><span class="op" id="6575156">(</span><span class="op" id="6575157">)</span>&nbsp;<span class="op" id="6575159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6575164">numRuns</span>&nbsp;<span class="op" id="6575172">=</span>&nbsp;<span class="num" id="6575174">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6575179">if</span>&nbsp;<span class="ident" id="6575182">timeout</span>&nbsp;<span class="op" id="6575190">&gt;</span>&nbsp;<span class="num" id="6575192">500</span><span class="op" id="6575195">*</span><span class="ident" id="6575196">time</span><span class="op" id="6575200">.</span><span class="ident" id="6575201">Microsecond</span>&nbsp;<span class="op" id="6575213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6575219">continue</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6575231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6575235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6575239">for</span>&nbsp;<span class="ident" id="6575243">run</span>&nbsp;<span class="op" id="6575247">:=</span>&nbsp;<span class="num" id="6575250">0</span><span class="op" id="6575251">;</span>&nbsp;<span class="ident" id="6575253">run</span>&nbsp;<span class="op" id="6575257">&lt;</span>&nbsp;<span class="ident" id="6575259">numRuns</span><span class="op" id="6575266">;</span>&nbsp;<span class="ident" id="6575268">run</span><span class="op" id="6575271">++</span>&nbsp;<span class="op" id="6575274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6575279">name</span>&nbsp;<span class="op" id="6575284">:=</span>&nbsp;<span class="ident" id="6575287">fmt</span><span class="op" id="6575290">.</span><span class="ident" id="6575291">Sprintf</span><span class="op" id="6575298">(</span><span class="string" id="6575299">&#34;%v&nbsp;run&nbsp;%d/%d&#34;</span><span class="op" id="6575313">,</span>&nbsp;<span class="ident" id="6575315">timeout</span><span class="op" id="6575322">,</span>&nbsp;<span class="ident" id="6575324">run</span><span class="op" id="6575327">+</span><span class="num" id="6575328">1</span><span class="op" id="6575329">,</span>&nbsp;<span class="ident" id="6575331">numRuns</span><span class="op" id="6575338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6575343">t</span><span class="op" id="6575344">.</span><span class="ident" id="6575345">Log</span><span class="op" id="6575348">(</span><span class="ident" id="6575349">name</span><span class="op" id="6575353">)</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6575359">c</span><span class="op" id="6575360">,</span>&nbsp;<span class="ident" id="6575362">err</span>&nbsp;<span class="op" id="6575366">:=</span>&nbsp;<span class="ident" id="6575369">Dial</span><span class="op" id="6575373">(</span><span class="string" id="6575374">&#34;tcp&#34;</span><span class="op" id="6575379">,</span>&nbsp;<span class="ident" id="6575381">ln</span><span class="op" id="6575383">.</span><span class="ident" id="6575384">Addr</span><span class="op" id="6575388">(</span><span class="op" id="6575389">)</span><span class="op" id="6575390">.</span><span class="ident" id="6575391">String</span><span class="op" id="6575397">(</span><span class="op" id="6575398">)</span><span class="op" id="6575399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6575404">if</span>&nbsp;<span class="ident" id="6575407">err</span>&nbsp;<span class="op" id="6575411">!=</span>&nbsp;<span class="builtintype" id="6575414">nil</span>&nbsp;<span class="op" id="6575418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6575424">t</span><span class="op" id="6575425">.</span><span class="ident" id="6575426">Fatalf</span><span class="op" id="6575432">(</span><span class="string" id="6575433">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="6575443">,</span>&nbsp;<span class="ident" id="6575445">err</span><span class="op" id="6575448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6575453">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6575458">clientc</span>&nbsp;<span class="op" id="6575466">:=</span>&nbsp;<span class="builtinfunc" id="6575469">make</span><span class="op" id="6575473">(</span><span class="keyword" id="6575474">chan</span>&nbsp;<span class="ident" id="6575479">copyRes</span><span class="op" id="6575486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6575491">go</span>&nbsp;<span class="keyword" id="6575494">func</span><span class="op" id="6575498">(</span><span class="op" id="6575499">)</span>&nbsp;<span class="op" id="6575501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6575507">t0</span>&nbsp;<span class="op" id="6575510">:=</span>&nbsp;<span class="ident" id="6575513">time</span><span class="op" id="6575517">.</span><span class="ident" id="6575518">Now</span><span class="op" id="6575521">(</span><span class="op" id="6575522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6575528">c</span><span class="op" id="6575529">.</span><span class="ident" id="6575530">SetDeadline</span><span class="op" id="6575541">(</span><span class="ident" id="6575542">t0</span><span class="op" id="6575544">.</span><span class="ident" id="6575545">Add</span><span class="op" id="6575548">(</span><span class="ident" id="6575549">timeout</span><span class="op" id="6575556">)</span><span class="op" id="6575557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6575563">n</span><span class="op" id="6575564">,</span>&nbsp;<span class="ident" id="6575566">err</span>&nbsp;<span class="op" id="6575570">:=</span>&nbsp;<span class="ident" id="6575573">io</span><span class="op" id="6575575">.</span><span class="ident" id="6575576">Copy</span><span class="op" id="6575580">(</span><span class="ident" id="6575581">ioutil</span><span class="op" id="6575587">.</span><span class="ident" id="6575588">Discard</span><span class="op" id="6575595">,</span>&nbsp;<span class="ident" id="6575597">c</span><span class="op" id="6575598">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6575604">d</span>&nbsp;<span class="op" id="6575606">:=</span>&nbsp;<span class="ident" id="6575609">time</span><span class="op" id="6575613">.</span><span class="ident" id="6575614">Since</span><span class="op" id="6575619">(</span><span class="ident" id="6575620">t0</span><span class="op" id="6575622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6575628">c</span><span class="op" id="6575629">.</span><span class="ident" id="6575630">Close</span><span class="op" id="6575635">(</span><span class="op" id="6575636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6575642">clientc</span>&nbsp;<span class="op" id="6575650">&lt;-</span>&nbsp;<span class="ident" id="6575653">copyRes</span><span class="op" id="6575660">{</span><span class="ident" id="6575661">n</span><span class="op" id="6575662">,</span>&nbsp;<span class="ident" id="6575664">err</span><span class="op" id="6575667">,</span>&nbsp;<span class="ident" id="6575669">d</span><span class="op" id="6575670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6575675">}</span><span class="op" id="6575676">(</span><span class="op" id="6575677">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6575683">tooLong</span>&nbsp;<span class="op" id="6575691">:=</span>&nbsp;<span class="num" id="6575694">5</span>&nbsp;<span class="op" id="6575696">*</span>&nbsp;<span class="ident" id="6575698">time</span><span class="op" id="6575702">.</span><span class="ident" id="6575703">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6575713">select</span>&nbsp;<span class="op" id="6575720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6575725">case</span>&nbsp;<span class="ident" id="6575730">res</span>&nbsp;<span class="op" id="6575734">:=</span>&nbsp;<span class="op" id="6575737">&lt;-</span><span class="ident" id="6575739">clientc</span><span class="op" id="6575746">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6575752">if</span>&nbsp;<span class="ident" id="6575755">isTimeout</span><span class="op" id="6575764">(</span><span class="ident" id="6575765">res</span><span class="op" id="6575768">.</span><span class="ident" id="6575769">err</span><span class="op" id="6575772">)</span>&nbsp;<span class="op" id="6575774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6575781">t</span><span class="op" id="6575782">.</span><span class="ident" id="6575783">Logf</span><span class="op" id="6575787">(</span><span class="string" id="6575788">&#34;for&nbsp;%v,&nbsp;good&nbsp;client&nbsp;timeout&nbsp;after&nbsp;%v,&nbsp;reading&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="6575844">,</span>&nbsp;<span class="ident" id="6575846">name</span><span class="op" id="6575850">,</span>&nbsp;<span class="ident" id="6575852">res</span><span class="op" id="6575855">.</span><span class="ident" id="6575856">d</span><span class="op" id="6575857">,</span>&nbsp;<span class="ident" id="6575859">res</span><span class="op" id="6575862">.</span><span class="ident" id="6575863">n</span><span class="op" id="6575864">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6575870">}</span>&nbsp;<span class="keyword" id="6575872">else</span>&nbsp;<span class="op" id="6575877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6575884">t</span><span class="op" id="6575885">.</span><span class="ident" id="6575886">Fatalf</span><span class="op" id="6575892">(</span><span class="string" id="6575893">&#34;for&nbsp;%v:&nbsp;client&nbsp;Copy&nbsp;=&nbsp;%d,&nbsp;%v&nbsp;(want&nbsp;timeout)&#34;</span><span class="op" id="6575938">,</span>&nbsp;<span class="ident" id="6575940">name</span><span class="op" id="6575944">,</span>&nbsp;<span class="ident" id="6575946">res</span><span class="op" id="6575949">.</span><span class="ident" id="6575950">n</span><span class="op" id="6575951">,</span>&nbsp;<span class="ident" id="6575953">res</span><span class="op" id="6575956">.</span><span class="ident" id="6575957">err</span><span class="op" id="6575960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6575966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6575971">case</span>&nbsp;<span class="op" id="6575976">&lt;-</span><span class="ident" id="6575978">time</span><span class="op" id="6575982">.</span><span class="ident" id="6575983">After</span><span class="op" id="6575988">(</span><span class="ident" id="6575989">tooLong</span><span class="op" id="6575996">)</span><span class="op" id="6575997">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6576003">t</span><span class="op" id="6576004">.</span><span class="ident" id="6576005">Fatalf</span><span class="op" id="6576011">(</span><span class="string" id="6576012">&#34;for&nbsp;%v:&nbsp;timeout&nbsp;(%v)&nbsp;waiting&nbsp;for&nbsp;client&nbsp;to&nbsp;timeout&nbsp;(%v)&nbsp;reading&#34;</span><span class="op" id="6576077">,</span>&nbsp;<span class="ident" id="6576079">name</span><span class="op" id="6576083">,</span>&nbsp;<span class="ident" id="6576085">tooLong</span><span class="op" id="6576092">,</span>&nbsp;<span class="ident" id="6576094">timeout</span><span class="op" id="6576101">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6576106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6576112">select</span>&nbsp;<span class="op" id="6576119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6576124">case</span>&nbsp;<span class="ident" id="6576129">res</span>&nbsp;<span class="op" id="6576133">:=</span>&nbsp;<span class="op" id="6576136">&lt;-</span><span class="ident" id="6576138">servec</span><span class="op" id="6576144">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6576150">t</span><span class="op" id="6576151">.</span><span class="ident" id="6576152">Logf</span><span class="op" id="6576156">(</span><span class="string" id="6576157">&#34;for&nbsp;%v:&nbsp;server&nbsp;in&nbsp;%v&nbsp;wrote&nbsp;%d,&nbsp;%v&#34;</span><span class="op" id="6576192">,</span>&nbsp;<span class="ident" id="6576194">name</span><span class="op" id="6576198">,</span>&nbsp;<span class="ident" id="6576200">res</span><span class="op" id="6576203">.</span><span class="ident" id="6576204">d</span><span class="op" id="6576205">,</span>&nbsp;<span class="ident" id="6576207">res</span><span class="op" id="6576210">.</span><span class="ident" id="6576211">n</span><span class="op" id="6576212">,</span>&nbsp;<span class="ident" id="6576214">res</span><span class="op" id="6576217">.</span><span class="ident" id="6576218">err</span><span class="op" id="6576221">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6576226">case</span>&nbsp;<span class="ident" id="6576231">err</span>&nbsp;<span class="op" id="6576235">:=</span>&nbsp;<span class="op" id="6576238">&lt;-</span><span class="ident" id="6576240">acceptc</span><span class="op" id="6576247">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6576253">t</span><span class="op" id="6576254">.</span><span class="ident" id="6576255">Fatalf</span><span class="op" id="6576261">(</span><span class="string" id="6576262">&#34;for&nbsp;%v:&nbsp;server&nbsp;Accept&nbsp;=&nbsp;%v&#34;</span><span class="op" id="6576290">,</span>&nbsp;<span class="ident" id="6576292">name</span><span class="op" id="6576296">,</span>&nbsp;<span class="ident" id="6576298">err</span><span class="op" id="6576301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6576306">case</span>&nbsp;<span class="op" id="6576311">&lt;-</span><span class="ident" id="6576313">time</span><span class="op" id="6576317">.</span><span class="ident" id="6576318">After</span><span class="op" id="6576323">(</span><span class="ident" id="6576324">tooLong</span><span class="op" id="6576331">)</span><span class="op" id="6576332">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6576338">t</span><span class="op" id="6576339">.</span><span class="ident" id="6576340">Fatalf</span><span class="op" id="6576346">(</span><span class="string" id="6576347">&#34;for&nbsp;%v,&nbsp;timeout&nbsp;waiting&nbsp;for&nbsp;server&nbsp;to&nbsp;finish&nbsp;writing&#34;</span><span class="op" id="6576401">,</span>&nbsp;<span class="ident" id="6576403">name</span><span class="op" id="6576407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6576412">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6576416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6576419">}</span><br>
<span class="lineno"></span><span class="op" id="6576421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6576424">//&nbsp;TestReadDeadlineDataAvailable&nbsp;tests&nbsp;that&nbsp;read&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">525</span><span class="comment" id="6576494">//&nbsp;if&nbsp;there&#39;s&nbsp;data&nbsp;ready&nbsp;to&nbsp;be&nbsp;read.</span><br>
<span class="lineno"></span><span class="keyword" id="6576531">func</span>&nbsp;<span class="ident" id="6576536">TestReadDeadlineDataAvailable</span><span class="op" id="6576565">(</span><span class="ident" id="6576566">t</span>&nbsp;<span class="op" id="6576568">*</span><span class="ident" id="6576569">testing</span><span class="op" id="6576576">.</span><span class="ident" id="6576577">T</span><span class="op" id="6576578">)</span>&nbsp;<span class="op" id="6576580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6576583">switch</span>&nbsp;<span class="ident" id="6576590">runtime</span><span class="op" id="6576597">.</span><span class="ident" id="6576598">GOOS</span>&nbsp;<span class="op" id="6576603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6576606">case</span>&nbsp;<span class="string" id="6576611">&#34;plan9&#34;</span><span class="op" id="6576618">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6576622">t</span><span class="op" id="6576623">.</span><span class="ident" id="6576624">Skipf</span><span class="op" id="6576629">(</span><span class="string" id="6576630">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6576651">,</span>&nbsp;<span class="ident" id="6576653">runtime</span><span class="op" id="6576660">.</span><span class="ident" id="6576661">GOOS</span><span class="op" id="6576665">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6576668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6576672">ln</span>&nbsp;<span class="op" id="6576675">:=</span>&nbsp;<span class="ident" id="6576678">newLocalListener</span><span class="op" id="6576694">(</span><span class="ident" id="6576695">t</span><span class="op" id="6576696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6576699">defer</span>&nbsp;<span class="ident" id="6576705">ln</span><span class="op" id="6576707">.</span><span class="ident" id="6576708">Close</span><span class="op" id="6576713">(</span><span class="op" id="6576714">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6576718">servec</span>&nbsp;<span class="op" id="6576725">:=</span>&nbsp;<span class="builtinfunc" id="6576728">make</span><span class="op" id="6576732">(</span><span class="keyword" id="6576733">chan</span>&nbsp;<span class="ident" id="6576738">copyRes</span><span class="op" id="6576745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6576748">const</span>&nbsp;<span class="ident" id="6576754">msg</span>&nbsp;<span class="op" id="6576758">=</span>&nbsp;<span class="string" id="6576760">&#34;data&nbsp;client&nbsp;shouldn&#39;t&nbsp;read,&nbsp;even&nbsp;though&nbsp;it&#39;ll&nbsp;be&nbsp;waiting&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6576820">go</span>&nbsp;<span class="keyword" id="6576823">func</span><span class="op" id="6576827">(</span><span class="op" id="6576828">)</span>&nbsp;<span class="op" id="6576830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6576834">c</span><span class="op" id="6576835">,</span>&nbsp;<span class="ident" id="6576837">err</span>&nbsp;<span class="op" id="6576841">:=</span>&nbsp;<span class="ident" id="6576844">ln</span><span class="op" id="6576846">.</span><span class="ident" id="6576847">Accept</span><span class="op" id="6576853">(</span><span class="op" id="6576854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6576858">if</span>&nbsp;<span class="ident" id="6576861">err</span>&nbsp;<span class="op" id="6576865">!=</span>&nbsp;<span class="builtintype" id="6576868">nil</span>&nbsp;<span class="op" id="6576872">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6576877">t</span><span class="op" id="6576878">.</span><span class="ident" id="6576879">Errorf</span><span class="op" id="6576885">(</span><span class="string" id="6576886">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="6576898">,</span>&nbsp;<span class="ident" id="6576900">err</span><span class="op" id="6576903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6576908">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6576917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6576921">defer</span>&nbsp;<span class="ident" id="6576927">c</span><span class="op" id="6576928">.</span><span class="ident" id="6576929">Close</span><span class="op" id="6576934">(</span><span class="op" id="6576935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6576939">n</span><span class="op" id="6576940">,</span>&nbsp;<span class="ident" id="6576942">err</span>&nbsp;<span class="op" id="6576946">:=</span>&nbsp;<span class="ident" id="6576949">c</span><span class="op" id="6576950">.</span><span class="ident" id="6576951">Write</span><span class="op" id="6576956">(</span><span class="op" id="6576957">[</span><span class="op" id="6576958">]</span><span class="builtintype" id="6576959">byte</span><span class="op" id="6576963">(</span><span class="ident" id="6576964">msg</span><span class="op" id="6576967">)</span><span class="op" id="6576968">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6576972">servec</span>&nbsp;<span class="op" id="6576979">&lt;-</span>&nbsp;<span class="ident" id="6576982">copyRes</span><span class="op" id="6576989">{</span><span class="ident" id="6576990">n</span><span class="op" id="6576991">:</span>&nbsp;<span class="ident" id="6576993">int64</span><span class="op" id="6576998">(</span><span class="ident" id="6576999">n</span><span class="op" id="6577000">)</span><span class="op" id="6577001">,</span>&nbsp;<span class="ident" id="6577003">err</span><span class="op" id="6577006">:</span>&nbsp;<span class="ident" id="6577008">err</span><span class="op" id="6577011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6577014">}</span><span class="op" id="6577015">(</span><span class="op" id="6577016">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6577020">c</span><span class="op" id="6577021">,</span>&nbsp;<span class="ident" id="6577023">err</span>&nbsp;<span class="op" id="6577027">:=</span>&nbsp;<span class="ident" id="6577030">Dial</span><span class="op" id="6577034">(</span><span class="string" id="6577035">&#34;tcp&#34;</span><span class="op" id="6577040">,</span>&nbsp;<span class="ident" id="6577042">ln</span><span class="op" id="6577044">.</span><span class="ident" id="6577045">Addr</span><span class="op" id="6577049">(</span><span class="op" id="6577050">)</span><span class="op" id="6577051">.</span><span class="ident" id="6577052">String</span><span class="op" id="6577058">(</span><span class="op" id="6577059">)</span><span class="op" id="6577060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6577063">if</span>&nbsp;<span class="ident" id="6577066">err</span>&nbsp;<span class="op" id="6577070">!=</span>&nbsp;<span class="builtintype" id="6577073">nil</span>&nbsp;<span class="op" id="6577077">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6577081">t</span><span class="op" id="6577082">.</span><span class="ident" id="6577083">Fatalf</span><span class="op" id="6577089">(</span><span class="string" id="6577090">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="6577100">,</span>&nbsp;<span class="ident" id="6577102">err</span><span class="op" id="6577105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6577108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6577111">defer</span>&nbsp;<span class="ident" id="6577117">c</span><span class="op" id="6577118">.</span><span class="ident" id="6577119">Close</span><span class="op" id="6577124">(</span><span class="op" id="6577125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6577128">if</span>&nbsp;<span class="ident" id="6577131">res</span>&nbsp;<span class="op" id="6577135">:=</span>&nbsp;<span class="op" id="6577138">&lt;-</span><span class="ident" id="6577140">servec</span><span class="op" id="6577146">;</span>&nbsp;<span class="ident" id="6577148">res</span><span class="op" id="6577151">.</span><span class="ident" id="6577152">err</span>&nbsp;<span class="op" id="6577156">!=</span>&nbsp;<span class="builtintype" id="6577159">nil</span>&nbsp;<span class="op" id="6577163">||</span>&nbsp;<span class="ident" id="6577166">res</span><span class="op" id="6577169">.</span><span class="ident" id="6577170">n</span>&nbsp;<span class="op" id="6577172">!=</span>&nbsp;<span class="ident" id="6577175">int64</span><span class="op" id="6577180">(</span><span class="builtinfunc" id="6577181">len</span><span class="op" id="6577184">(</span><span class="ident" id="6577185">msg</span><span class="op" id="6577188">)</span><span class="op" id="6577189">)</span>&nbsp;<span class="op" id="6577191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6577195">t</span><span class="op" id="6577196">.</span><span class="ident" id="6577197">Fatalf</span><span class="op" id="6577203">(</span><span class="string" id="6577204">&#34;unexpected&nbsp;server&nbsp;Write:&nbsp;n=%d,&nbsp;err=%v;&nbsp;want&nbsp;n=%d,&nbsp;err=nil&#34;</span><span class="op" id="6577263">,</span>&nbsp;<span class="ident" id="6577265">res</span><span class="op" id="6577268">.</span><span class="ident" id="6577269">n</span><span class="op" id="6577270">,</span>&nbsp;<span class="ident" id="6577272">res</span><span class="op" id="6577275">.</span><span class="ident" id="6577276">err</span><span class="op" id="6577279">,</span>&nbsp;<span class="builtinfunc" id="6577281">len</span><span class="op" id="6577284">(</span><span class="ident" id="6577285">msg</span><span class="op" id="6577288">)</span><span class="op" id="6577289">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6577292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6577295">c</span><span class="op" id="6577296">.</span><span class="ident" id="6577297">SetReadDeadline</span><span class="op" id="6577312">(</span><span class="ident" id="6577313">time</span><span class="op" id="6577317">.</span><span class="ident" id="6577318">Now</span><span class="op" id="6577321">(</span><span class="op" id="6577322">)</span><span class="op" id="6577323">.</span><span class="ident" id="6577324">Add</span><span class="op" id="6577327">(</span><span class="op" id="6577328">-</span><span class="num" id="6577329">5</span>&nbsp;<span class="op" id="6577331">*</span>&nbsp;<span class="ident" id="6577333">time</span><span class="op" id="6577337">.</span><span class="ident" id="6577338">Second</span><span class="op" id="6577344">)</span><span class="op" id="6577345">)</span>&nbsp;<span class="comment" id="6577347">//&nbsp;in&nbsp;the&nbsp;psat.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6577364">buf</span>&nbsp;<span class="op" id="6577368">:=</span>&nbsp;<span class="builtinfunc" id="6577371">make</span><span class="op" id="6577375">(</span><span class="op" id="6577376">[</span><span class="op" id="6577377">]</span><span class="builtintype" id="6577378">byte</span><span class="op" id="6577382">,</span>&nbsp;<span class="builtinfunc" id="6577384">len</span><span class="op" id="6577387">(</span><span class="ident" id="6577388">msg</span><span class="op" id="6577391">)</span><span class="op" id="6577392">/</span><span class="num" id="6577393">2</span><span class="op" id="6577394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6577397">n</span><span class="op" id="6577398">,</span>&nbsp;<span class="ident" id="6577400">err</span>&nbsp;<span class="op" id="6577404">:=</span>&nbsp;<span class="ident" id="6577407">c</span><span class="op" id="6577408">.</span><span class="ident" id="6577409">Read</span><span class="op" id="6577413">(</span><span class="ident" id="6577414">buf</span><span class="op" id="6577417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6577420">if</span>&nbsp;<span class="ident" id="6577423">n</span>&nbsp;<span class="op" id="6577425">&gt;</span>&nbsp;<span class="num" id="6577427">0</span>&nbsp;<span class="op" id="6577429">||</span>&nbsp;<span class="op" id="6577432">!</span><span class="ident" id="6577433">isTimeout</span><span class="op" id="6577442">(</span><span class="ident" id="6577443">err</span><span class="op" id="6577446">)</span>&nbsp;<span class="op" id="6577448">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6577452">t</span><span class="op" id="6577453">.</span><span class="ident" id="6577454">Fatalf</span><span class="op" id="6577460">(</span><span class="string" id="6577461">&#34;client&nbsp;read&nbsp;=&nbsp;%d&nbsp;(%q)&nbsp;err=%v;&nbsp;want&nbsp;0,&nbsp;timeout&#34;</span><span class="op" id="6577508">,</span>&nbsp;<span class="ident" id="6577510">n</span><span class="op" id="6577511">,</span>&nbsp;<span class="ident" id="6577513">buf</span><span class="op" id="6577516">[</span><span class="op" id="6577517">:</span><span class="ident" id="6577518">n</span><span class="op" id="6577519">]</span><span class="op" id="6577520">,</span>&nbsp;<span class="ident" id="6577522">err</span><span class="op" id="6577525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6577528">}</span><br>
<span class="lineno"></span><span class="op" id="6577530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6577533">//&nbsp;TestWriteDeadlineBufferAvailable&nbsp;tests&nbsp;that&nbsp;write&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">565</span><span class="comment" id="6577607">//&nbsp;if&nbsp;there&#39;s&nbsp;buffer&nbsp;space&nbsp;available&nbsp;to&nbsp;write.</span><br>
<span class="lineno"></span><span class="keyword" id="6577654">func</span>&nbsp;<span class="ident" id="6577659">TestWriteDeadlineBufferAvailable</span><span class="op" id="6577691">(</span><span class="ident" id="6577692">t</span>&nbsp;<span class="op" id="6577694">*</span><span class="ident" id="6577695">testing</span><span class="op" id="6577702">.</span><span class="ident" id="6577703">T</span><span class="op" id="6577704">)</span>&nbsp;<span class="op" id="6577706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6577709">switch</span>&nbsp;<span class="ident" id="6577716">runtime</span><span class="op" id="6577723">.</span><span class="ident" id="6577724">GOOS</span>&nbsp;<span class="op" id="6577729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6577732">case</span>&nbsp;<span class="string" id="6577737">&#34;plan9&#34;</span><span class="op" id="6577744">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6577748">t</span><span class="op" id="6577749">.</span><span class="ident" id="6577750">Skipf</span><span class="op" id="6577755">(</span><span class="string" id="6577756">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6577777">,</span>&nbsp;<span class="ident" id="6577779">runtime</span><span class="op" id="6577786">.</span><span class="ident" id="6577787">GOOS</span><span class="op" id="6577791">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6577794">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6577798">ln</span>&nbsp;<span class="op" id="6577801">:=</span>&nbsp;<span class="ident" id="6577804">newLocalListener</span><span class="op" id="6577820">(</span><span class="ident" id="6577821">t</span><span class="op" id="6577822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6577825">defer</span>&nbsp;<span class="ident" id="6577831">ln</span><span class="op" id="6577833">.</span><span class="ident" id="6577834">Close</span><span class="op" id="6577839">(</span><span class="op" id="6577840">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6577844">servec</span>&nbsp;<span class="op" id="6577851">:=</span>&nbsp;<span class="builtinfunc" id="6577854">make</span><span class="op" id="6577858">(</span><span class="keyword" id="6577859">chan</span>&nbsp;<span class="ident" id="6577864">copyRes</span><span class="op" id="6577871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6577874">go</span>&nbsp;<span class="keyword" id="6577877">func</span><span class="op" id="6577881">(</span><span class="op" id="6577882">)</span>&nbsp;<span class="op" id="6577884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6577888">c</span><span class="op" id="6577889">,</span>&nbsp;<span class="ident" id="6577891">err</span>&nbsp;<span class="op" id="6577895">:=</span>&nbsp;<span class="ident" id="6577898">ln</span><span class="op" id="6577900">.</span><span class="ident" id="6577901">Accept</span><span class="op" id="6577907">(</span><span class="op" id="6577908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6577912">if</span>&nbsp;<span class="ident" id="6577915">err</span>&nbsp;<span class="op" id="6577919">!=</span>&nbsp;<span class="builtintype" id="6577922">nil</span>&nbsp;<span class="op" id="6577926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6577931">t</span><span class="op" id="6577932">.</span><span class="ident" id="6577933">Errorf</span><span class="op" id="6577939">(</span><span class="string" id="6577940">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="6577952">,</span>&nbsp;<span class="ident" id="6577954">err</span><span class="op" id="6577957">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6577962">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6577971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6577975">defer</span>&nbsp;<span class="ident" id="6577981">c</span><span class="op" id="6577982">.</span><span class="ident" id="6577983">Close</span><span class="op" id="6577988">(</span><span class="op" id="6577989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6577993">c</span><span class="op" id="6577994">.</span><span class="ident" id="6577995">SetWriteDeadline</span><span class="op" id="6578011">(</span><span class="ident" id="6578012">time</span><span class="op" id="6578016">.</span><span class="ident" id="6578017">Now</span><span class="op" id="6578020">(</span><span class="op" id="6578021">)</span><span class="op" id="6578022">.</span><span class="ident" id="6578023">Add</span><span class="op" id="6578026">(</span><span class="op" id="6578027">-</span><span class="num" id="6578028">5</span>&nbsp;<span class="op" id="6578030">*</span>&nbsp;<span class="ident" id="6578032">time</span><span class="op" id="6578036">.</span><span class="ident" id="6578037">Second</span><span class="op" id="6578043">)</span><span class="op" id="6578044">)</span>&nbsp;<span class="comment" id="6578046">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6578063">n</span><span class="op" id="6578064">,</span>&nbsp;<span class="ident" id="6578066">err</span>&nbsp;<span class="op" id="6578070">:=</span>&nbsp;<span class="ident" id="6578073">c</span><span class="op" id="6578074">.</span><span class="ident" id="6578075">Write</span><span class="op" id="6578080">(</span><span class="op" id="6578081">[</span><span class="op" id="6578082">]</span><span class="builtintype" id="6578083">byte</span><span class="op" id="6578087">{</span><span class="string" id="6578088">&#39;x&#39;</span><span class="op" id="6578091">}</span><span class="op" id="6578092">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6578096">servec</span>&nbsp;<span class="op" id="6578103">&lt;-</span>&nbsp;<span class="ident" id="6578106">copyRes</span><span class="op" id="6578113">{</span><span class="ident" id="6578114">n</span><span class="op" id="6578115">:</span>&nbsp;<span class="ident" id="6578117">int64</span><span class="op" id="6578122">(</span><span class="ident" id="6578123">n</span><span class="op" id="6578124">)</span><span class="op" id="6578125">,</span>&nbsp;<span class="ident" id="6578127">err</span><span class="op" id="6578130">:</span>&nbsp;<span class="ident" id="6578132">err</span><span class="op" id="6578135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6578138">}</span><span class="op" id="6578139">(</span><span class="op" id="6578140">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6578144">c</span><span class="op" id="6578145">,</span>&nbsp;<span class="ident" id="6578147">err</span>&nbsp;<span class="op" id="6578151">:=</span>&nbsp;<span class="ident" id="6578154">Dial</span><span class="op" id="6578158">(</span><span class="string" id="6578159">&#34;tcp&#34;</span><span class="op" id="6578164">,</span>&nbsp;<span class="ident" id="6578166">ln</span><span class="op" id="6578168">.</span><span class="ident" id="6578169">Addr</span><span class="op" id="6578173">(</span><span class="op" id="6578174">)</span><span class="op" id="6578175">.</span><span class="ident" id="6578176">String</span><span class="op" id="6578182">(</span><span class="op" id="6578183">)</span><span class="op" id="6578184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6578187">if</span>&nbsp;<span class="ident" id="6578190">err</span>&nbsp;<span class="op" id="6578194">!=</span>&nbsp;<span class="builtintype" id="6578197">nil</span>&nbsp;<span class="op" id="6578201">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6578205">t</span><span class="op" id="6578206">.</span><span class="ident" id="6578207">Fatalf</span><span class="op" id="6578213">(</span><span class="string" id="6578214">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="6578224">,</span>&nbsp;<span class="ident" id="6578226">err</span><span class="op" id="6578229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6578232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6578235">defer</span>&nbsp;<span class="ident" id="6578241">c</span><span class="op" id="6578242">.</span><span class="ident" id="6578243">Close</span><span class="op" id="6578248">(</span><span class="op" id="6578249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6578252">res</span>&nbsp;<span class="op" id="6578256">:=</span>&nbsp;<span class="op" id="6578259">&lt;-</span><span class="ident" id="6578261">servec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6578269">if</span>&nbsp;<span class="ident" id="6578272">res</span><span class="op" id="6578275">.</span><span class="ident" id="6578276">n</span>&nbsp;<span class="op" id="6578278">!=</span>&nbsp;<span class="num" id="6578281">0</span>&nbsp;<span class="op" id="6578283">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6578287">t</span><span class="op" id="6578288">.</span><span class="ident" id="6578289">Errorf</span><span class="op" id="6578295">(</span><span class="string" id="6578296">&#34;Write&nbsp;=&nbsp;%d;&nbsp;want&nbsp;0&#34;</span><span class="op" id="6578316">,</span>&nbsp;<span class="ident" id="6578318">res</span><span class="op" id="6578321">.</span><span class="ident" id="6578322">n</span><span class="op" id="6578323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6578326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6578329">if</span>&nbsp;<span class="op" id="6578332">!</span><span class="ident" id="6578333">isTimeout</span><span class="op" id="6578342">(</span><span class="ident" id="6578343">res</span><span class="op" id="6578346">.</span><span class="ident" id="6578347">err</span><span class="op" id="6578350">)</span>&nbsp;<span class="op" id="6578352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6578356">t</span><span class="op" id="6578357">.</span><span class="ident" id="6578358">Errorf</span><span class="op" id="6578364">(</span><span class="string" id="6578365">&#34;Write&nbsp;error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="6578397">,</span>&nbsp;<span class="ident" id="6578399">res</span><span class="op" id="6578402">.</span><span class="ident" id="6578403">err</span><span class="op" id="6578406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6578409">}</span><br>
<span class="lineno">600</span><span class="op" id="6578411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6578414">//&nbsp;TestAcceptDeadlineConnectionAvailable&nbsp;tests&nbsp;that&nbsp;accept&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno"></span><span class="comment" id="6578494">//&nbsp;if&nbsp;there&#39;s&nbsp;incoming&nbsp;connections&nbsp;available.</span><br>
<span class="lineno"></span><span class="keyword" id="6578540">func</span>&nbsp;<span class="ident" id="6578545">TestAcceptDeadlineConnectionAvailable</span><span class="op" id="6578582">(</span><span class="ident" id="6578583">t</span>&nbsp;<span class="op" id="6578585">*</span><span class="ident" id="6578586">testing</span><span class="op" id="6578593">.</span><span class="ident" id="6578594">T</span><span class="op" id="6578595">)</span>&nbsp;<span class="op" id="6578597">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6578600">switch</span>&nbsp;<span class="ident" id="6578607">runtime</span><span class="op" id="6578614">.</span><span class="ident" id="6578615">GOOS</span>&nbsp;<span class="op" id="6578620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6578623">case</span>&nbsp;<span class="string" id="6578628">&#34;plan9&#34;</span><span class="op" id="6578635">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6578639">t</span><span class="op" id="6578640">.</span><span class="ident" id="6578641">Skipf</span><span class="op" id="6578646">(</span><span class="string" id="6578647">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6578668">,</span>&nbsp;<span class="ident" id="6578670">runtime</span><span class="op" id="6578677">.</span><span class="ident" id="6578678">GOOS</span><span class="op" id="6578682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6578685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6578689">ln</span>&nbsp;<span class="op" id="6578692">:=</span>&nbsp;<span class="ident" id="6578695">newLocalListener</span><span class="op" id="6578711">(</span><span class="ident" id="6578712">t</span><span class="op" id="6578713">)</span><span class="op" id="6578714">.</span><span class="op" id="6578715">(</span><span class="op" id="6578716">*</span><span class="ident" id="6578717">TCPListener</span><span class="op" id="6578728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6578731">defer</span>&nbsp;<span class="ident" id="6578737">ln</span><span class="op" id="6578739">.</span><span class="ident" id="6578740">Close</span><span class="op" id="6578745">(</span><span class="op" id="6578746">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6578750">go</span>&nbsp;<span class="keyword" id="6578753">func</span><span class="op" id="6578757">(</span><span class="op" id="6578758">)</span>&nbsp;<span class="op" id="6578760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6578764">c</span><span class="op" id="6578765">,</span>&nbsp;<span class="ident" id="6578767">err</span>&nbsp;<span class="op" id="6578771">:=</span>&nbsp;<span class="ident" id="6578774">Dial</span><span class="op" id="6578778">(</span><span class="string" id="6578779">&#34;tcp&#34;</span><span class="op" id="6578784">,</span>&nbsp;<span class="ident" id="6578786">ln</span><span class="op" id="6578788">.</span><span class="ident" id="6578789">Addr</span><span class="op" id="6578793">(</span><span class="op" id="6578794">)</span><span class="op" id="6578795">.</span><span class="ident" id="6578796">String</span><span class="op" id="6578802">(</span><span class="op" id="6578803">)</span><span class="op" id="6578804">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6578808">if</span>&nbsp;<span class="ident" id="6578811">err</span>&nbsp;<span class="op" id="6578815">!=</span>&nbsp;<span class="builtintype" id="6578818">nil</span>&nbsp;<span class="op" id="6578822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6578827">t</span><span class="op" id="6578828">.</span><span class="ident" id="6578829">Errorf</span><span class="op" id="6578835">(</span><span class="string" id="6578836">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="6578846">,</span>&nbsp;<span class="ident" id="6578848">err</span><span class="op" id="6578851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6578856">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6578865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6578869">defer</span>&nbsp;<span class="ident" id="6578875">c</span><span class="op" id="6578876">.</span><span class="ident" id="6578877">Close</span><span class="op" id="6578882">(</span><span class="op" id="6578883">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6578887">var</span>&nbsp;<span class="ident" id="6578891">buf</span>&nbsp;<span class="op" id="6578895">[</span><span class="num" id="6578896">1</span><span class="op" id="6578897">]</span><span class="builtintype" id="6578898">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6578905">c</span><span class="op" id="6578906">.</span><span class="ident" id="6578907">Read</span><span class="op" id="6578911">(</span><span class="ident" id="6578912">buf</span><span class="op" id="6578915">[</span><span class="op" id="6578916">:</span><span class="op" id="6578917">]</span><span class="op" id="6578918">)</span>&nbsp;<span class="comment" id="6578920">//&nbsp;block&nbsp;until&nbsp;the&nbsp;connection&nbsp;or&nbsp;listener&nbsp;is&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6578973">}</span><span class="op" id="6578974">(</span><span class="op" id="6578975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6578978">time</span><span class="op" id="6578982">.</span><span class="ident" id="6578983">Sleep</span><span class="op" id="6578988">(</span><span class="num" id="6578989">10</span>&nbsp;<span class="op" id="6578992">*</span>&nbsp;<span class="ident" id="6578994">time</span><span class="op" id="6578998">.</span><span class="ident" id="6578999">Millisecond</span><span class="op" id="6579010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6579013">ln</span><span class="op" id="6579015">.</span><span class="ident" id="6579016">SetDeadline</span><span class="op" id="6579027">(</span><span class="ident" id="6579028">time</span><span class="op" id="6579032">.</span><span class="ident" id="6579033">Now</span><span class="op" id="6579036">(</span><span class="op" id="6579037">)</span><span class="op" id="6579038">.</span><span class="ident" id="6579039">Add</span><span class="op" id="6579042">(</span><span class="op" id="6579043">-</span><span class="num" id="6579044">5</span>&nbsp;<span class="op" id="6579046">*</span>&nbsp;<span class="ident" id="6579048">time</span><span class="op" id="6579052">.</span><span class="ident" id="6579053">Second</span><span class="op" id="6579059">)</span><span class="op" id="6579060">)</span>&nbsp;<span class="comment" id="6579062">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6579078">c</span><span class="op" id="6579079">,</span>&nbsp;<span class="ident" id="6579081">err</span>&nbsp;<span class="op" id="6579085">:=</span>&nbsp;<span class="ident" id="6579088">ln</span><span class="op" id="6579090">.</span><span class="ident" id="6579091">Accept</span><span class="op" id="6579097">(</span><span class="op" id="6579098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6579101">if</span>&nbsp;<span class="ident" id="6579104">err</span>&nbsp;<span class="op" id="6579108">==</span>&nbsp;<span class="builtintype" id="6579111">nil</span>&nbsp;<span class="op" id="6579115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6579119">defer</span>&nbsp;<span class="ident" id="6579125">c</span><span class="op" id="6579126">.</span><span class="ident" id="6579127">Close</span><span class="op" id="6579132">(</span><span class="op" id="6579133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6579136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6579139">if</span>&nbsp;<span class="op" id="6579142">!</span><span class="ident" id="6579143">isTimeout</span><span class="op" id="6579152">(</span><span class="ident" id="6579153">err</span><span class="op" id="6579156">)</span>&nbsp;<span class="op" id="6579158">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6579162">t</span><span class="op" id="6579163">.</span><span class="ident" id="6579164">Fatalf</span><span class="op" id="6579170">(</span><span class="string" id="6579171">&#34;Accept:&nbsp;got&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="6579201">,</span>&nbsp;<span class="ident" id="6579203">err</span><span class="op" id="6579206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6579209">}</span><br>
<span class="lineno"></span><span class="op" id="6579211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6579214">//&nbsp;TestConnectDeadlineInThePast&nbsp;tests&nbsp;that&nbsp;connect&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">635</span><span class="comment" id="6579286">//&nbsp;if&nbsp;the&nbsp;connection&nbsp;can&nbsp;be&nbsp;established&nbsp;w/o&nbsp;blocking.</span><br>
<span class="lineno"></span><span class="keyword" id="6579340">func</span>&nbsp;<span class="ident" id="6579345">TestConnectDeadlineInThePast</span><span class="op" id="6579373">(</span><span class="ident" id="6579374">t</span>&nbsp;<span class="op" id="6579376">*</span><span class="ident" id="6579377">testing</span><span class="op" id="6579384">.</span><span class="ident" id="6579385">T</span><span class="op" id="6579386">)</span>&nbsp;<span class="op" id="6579388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6579391">switch</span>&nbsp;<span class="ident" id="6579398">runtime</span><span class="op" id="6579405">.</span><span class="ident" id="6579406">GOOS</span>&nbsp;<span class="op" id="6579411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6579414">case</span>&nbsp;<span class="string" id="6579419">&#34;plan9&#34;</span><span class="op" id="6579426">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6579430">t</span><span class="op" id="6579431">.</span><span class="ident" id="6579432">Skipf</span><span class="op" id="6579437">(</span><span class="string" id="6579438">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6579459">,</span>&nbsp;<span class="ident" id="6579461">runtime</span><span class="op" id="6579468">.</span><span class="ident" id="6579469">GOOS</span><span class="op" id="6579473">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6579476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6579480">ln</span>&nbsp;<span class="op" id="6579483">:=</span>&nbsp;<span class="ident" id="6579486">newLocalListener</span><span class="op" id="6579502">(</span><span class="ident" id="6579503">t</span><span class="op" id="6579504">)</span><span class="op" id="6579505">.</span><span class="op" id="6579506">(</span><span class="op" id="6579507">*</span><span class="ident" id="6579508">TCPListener</span><span class="op" id="6579519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6579522">defer</span>&nbsp;<span class="ident" id="6579528">ln</span><span class="op" id="6579530">.</span><span class="ident" id="6579531">Close</span><span class="op" id="6579536">(</span><span class="op" id="6579537">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6579541">go</span>&nbsp;<span class="keyword" id="6579544">func</span><span class="op" id="6579548">(</span><span class="op" id="6579549">)</span>&nbsp;<span class="op" id="6579551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6579555">c</span><span class="op" id="6579556">,</span>&nbsp;<span class="ident" id="6579558">err</span>&nbsp;<span class="op" id="6579562">:=</span>&nbsp;<span class="ident" id="6579565">ln</span><span class="op" id="6579567">.</span><span class="ident" id="6579568">Accept</span><span class="op" id="6579574">(</span><span class="op" id="6579575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6579579">if</span>&nbsp;<span class="ident" id="6579582">err</span>&nbsp;<span class="op" id="6579586">==</span>&nbsp;<span class="builtintype" id="6579589">nil</span>&nbsp;<span class="op" id="6579593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6579598">defer</span>&nbsp;<span class="ident" id="6579604">c</span><span class="op" id="6579605">.</span><span class="ident" id="6579606">Close</span><span class="op" id="6579611">(</span><span class="op" id="6579612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6579616">}</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6579619">}</span><span class="op" id="6579620">(</span><span class="op" id="6579621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6579624">time</span><span class="op" id="6579628">.</span><span class="ident" id="6579629">Sleep</span><span class="op" id="6579634">(</span><span class="num" id="6579635">10</span>&nbsp;<span class="op" id="6579638">*</span>&nbsp;<span class="ident" id="6579640">time</span><span class="op" id="6579644">.</span><span class="ident" id="6579645">Millisecond</span><span class="op" id="6579656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6579659">c</span><span class="op" id="6579660">,</span>&nbsp;<span class="ident" id="6579662">err</span>&nbsp;<span class="op" id="6579666">:=</span>&nbsp;<span class="ident" id="6579669">DialTimeout</span><span class="op" id="6579680">(</span><span class="string" id="6579681">&#34;tcp&#34;</span><span class="op" id="6579686">,</span>&nbsp;<span class="ident" id="6579688">ln</span><span class="op" id="6579690">.</span><span class="ident" id="6579691">Addr</span><span class="op" id="6579695">(</span><span class="op" id="6579696">)</span><span class="op" id="6579697">.</span><span class="ident" id="6579698">String</span><span class="op" id="6579704">(</span><span class="op" id="6579705">)</span><span class="op" id="6579706">,</span>&nbsp;<span class="op" id="6579708">-</span><span class="num" id="6579709">5</span><span class="op" id="6579710">*</span><span class="ident" id="6579711">time</span><span class="op" id="6579715">.</span><span class="ident" id="6579716">Second</span><span class="op" id="6579722">)</span>&nbsp;<span class="comment" id="6579724">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6579740">if</span>&nbsp;<span class="ident" id="6579743">err</span>&nbsp;<span class="op" id="6579747">==</span>&nbsp;<span class="builtintype" id="6579750">nil</span>&nbsp;<span class="op" id="6579754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6579758">defer</span>&nbsp;<span class="ident" id="6579764">c</span><span class="op" id="6579765">.</span><span class="ident" id="6579766">Close</span><span class="op" id="6579771">(</span><span class="op" id="6579772">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6579775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6579778">if</span>&nbsp;<span class="op" id="6579781">!</span><span class="ident" id="6579782">isTimeout</span><span class="op" id="6579791">(</span><span class="ident" id="6579792">err</span><span class="op" id="6579795">)</span>&nbsp;<span class="op" id="6579797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6579801">t</span><span class="op" id="6579802">.</span><span class="ident" id="6579803">Fatalf</span><span class="op" id="6579809">(</span><span class="string" id="6579810">&#34;DialTimeout:&nbsp;got&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="6579845">,</span>&nbsp;<span class="ident" id="6579847">err</span><span class="op" id="6579850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6579853">}</span><br>
<span class="lineno"></span><span class="op" id="6579855">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="comment" id="6579858">//&nbsp;TestProlongTimeout&nbsp;tests&nbsp;concurrent&nbsp;deadline&nbsp;modification.</span><br>
<span class="lineno"></span><span class="comment" id="6579920">//&nbsp;Known&nbsp;to&nbsp;cause&nbsp;data&nbsp;races&nbsp;in&nbsp;the&nbsp;past.</span><br>
<span class="lineno"></span><span class="keyword" id="6579962">func</span>&nbsp;<span class="ident" id="6579967">TestProlongTimeout</span><span class="op" id="6579985">(</span><span class="ident" id="6579986">t</span>&nbsp;<span class="op" id="6579988">*</span><span class="ident" id="6579989">testing</span><span class="op" id="6579996">.</span><span class="ident" id="6579997">T</span><span class="op" id="6579998">)</span>&nbsp;<span class="op" id="6580000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6580003">switch</span>&nbsp;<span class="ident" id="6580010">runtime</span><span class="op" id="6580017">.</span><span class="ident" id="6580018">GOOS</span>&nbsp;<span class="op" id="6580023">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6580026">case</span>&nbsp;<span class="string" id="6580031">&#34;plan9&#34;</span><span class="op" id="6580038">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6580042">t</span><span class="op" id="6580043">.</span><span class="ident" id="6580044">Skipf</span><span class="op" id="6580049">(</span><span class="string" id="6580050">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6580071">,</span>&nbsp;<span class="ident" id="6580073">runtime</span><span class="op" id="6580080">.</span><span class="ident" id="6580081">GOOS</span><span class="op" id="6580085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6580088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6580092">ln</span>&nbsp;<span class="op" id="6580095">:=</span>&nbsp;<span class="ident" id="6580098">newLocalListener</span><span class="op" id="6580114">(</span><span class="ident" id="6580115">t</span><span class="op" id="6580116">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6580119">defer</span>&nbsp;<span class="ident" id="6580125">ln</span><span class="op" id="6580127">.</span><span class="ident" id="6580128">Close</span><span class="op" id="6580133">(</span><span class="op" id="6580134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6580137">connected</span>&nbsp;<span class="op" id="6580147">:=</span>&nbsp;<span class="builtinfunc" id="6580150">make</span><span class="op" id="6580154">(</span><span class="keyword" id="6580155">chan</span>&nbsp;<span class="builtintype" id="6580160">bool</span><span class="op" id="6580164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6580167">go</span>&nbsp;<span class="keyword" id="6580170">func</span><span class="op" id="6580174">(</span><span class="op" id="6580175">)</span>&nbsp;<span class="op" id="6580177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6580181">s</span><span class="op" id="6580182">,</span>&nbsp;<span class="ident" id="6580184">err</span>&nbsp;<span class="op" id="6580188">:=</span>&nbsp;<span class="ident" id="6580191">ln</span><span class="op" id="6580193">.</span><span class="ident" id="6580194">Accept</span><span class="op" id="6580200">(</span><span class="op" id="6580201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6580205">connected</span>&nbsp;<span class="op" id="6580215">&lt;-</span>&nbsp;<span class="builtintype" id="6580218">true</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6580225">if</span>&nbsp;<span class="ident" id="6580228">err</span>&nbsp;<span class="op" id="6580232">!=</span>&nbsp;<span class="builtintype" id="6580235">nil</span>&nbsp;<span class="op" id="6580239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6580244">t</span><span class="op" id="6580245">.</span><span class="ident" id="6580246">Errorf</span><span class="op" id="6580252">(</span><span class="string" id="6580253">&#34;ln.Accept:&nbsp;%v&#34;</span><span class="op" id="6580268">,</span>&nbsp;<span class="ident" id="6580270">err</span><span class="op" id="6580273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6580278">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6580287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6580291">defer</span>&nbsp;<span class="ident" id="6580297">s</span><span class="op" id="6580298">.</span><span class="ident" id="6580299">Close</span><span class="op" id="6580304">(</span><span class="op" id="6580305">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6580309">s</span><span class="op" id="6580310">.</span><span class="ident" id="6580311">SetDeadline</span><span class="op" id="6580322">(</span><span class="ident" id="6580323">time</span><span class="op" id="6580327">.</span><span class="ident" id="6580328">Now</span><span class="op" id="6580331">(</span><span class="op" id="6580332">)</span><span class="op" id="6580333">.</span><span class="ident" id="6580334">Add</span><span class="op" id="6580337">(</span><span class="ident" id="6580338">time</span><span class="op" id="6580342">.</span><span class="ident" id="6580343">Hour</span><span class="op" id="6580347">)</span><span class="op" id="6580348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6580352">go</span>&nbsp;<span class="keyword" id="6580355">func</span><span class="op" id="6580359">(</span><span class="op" id="6580360">)</span>&nbsp;<span class="op" id="6580362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6580367">var</span>&nbsp;<span class="ident" id="6580371">buf</span>&nbsp;<span class="op" id="6580375">[</span><span class="num" id="6580376">4096</span><span class="op" id="6580380">]</span><span class="builtintype" id="6580381">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6580389">for</span>&nbsp;<span class="op" id="6580393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6580399">_</span><span class="op" id="6580400">,</span>&nbsp;<span class="ident" id="6580402">err</span>&nbsp;<span class="op" id="6580406">:=</span>&nbsp;<span class="ident" id="6580409">s</span><span class="op" id="6580410">.</span><span class="ident" id="6580411">Write</span><span class="op" id="6580416">(</span><span class="ident" id="6580417">buf</span><span class="op" id="6580420">[</span><span class="op" id="6580421">:</span><span class="op" id="6580422">]</span><span class="op" id="6580423">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6580429">if</span>&nbsp;<span class="ident" id="6580432">err</span>&nbsp;<span class="op" id="6580436">!=</span>&nbsp;<span class="builtintype" id="6580439">nil</span>&nbsp;<span class="op" id="6580443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6580450">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6580460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6580466">s</span><span class="op" id="6580467">.</span><span class="ident" id="6580468">SetDeadline</span><span class="op" id="6580479">(</span><span class="ident" id="6580480">time</span><span class="op" id="6580484">.</span><span class="ident" id="6580485">Now</span><span class="op" id="6580488">(</span><span class="op" id="6580489">)</span><span class="op" id="6580490">.</span><span class="ident" id="6580491">Add</span><span class="op" id="6580494">(</span><span class="ident" id="6580495">time</span><span class="op" id="6580499">.</span><span class="ident" id="6580500">Hour</span><span class="op" id="6580504">)</span><span class="op" id="6580505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6580510">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6580514">}</span><span class="op" id="6580515">(</span><span class="op" id="6580516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6580520">buf</span>&nbsp;<span class="op" id="6580524">:=</span>&nbsp;<span class="builtinfunc" id="6580527">make</span><span class="op" id="6580531">(</span><span class="op" id="6580532">[</span><span class="op" id="6580533">]</span><span class="builtintype" id="6580534">byte</span><span class="op" id="6580538">,</span>&nbsp;<span class="num" id="6580540">1</span><span class="op" id="6580541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6580545">for</span>&nbsp;<span class="op" id="6580549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6580554">_</span><span class="op" id="6580555">,</span>&nbsp;<span class="ident" id="6580557">err</span>&nbsp;<span class="op" id="6580561">:=</span>&nbsp;<span class="ident" id="6580564">s</span><span class="op" id="6580565">.</span><span class="ident" id="6580566">Read</span><span class="op" id="6580570">(</span><span class="ident" id="6580571">buf</span><span class="op" id="6580574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6580579">if</span>&nbsp;<span class="ident" id="6580582">err</span>&nbsp;<span class="op" id="6580586">!=</span>&nbsp;<span class="builtintype" id="6580589">nil</span>&nbsp;<span class="op" id="6580593">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6580599">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6580608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6580613">s</span><span class="op" id="6580614">.</span><span class="ident" id="6580615">SetDeadline</span><span class="op" id="6580626">(</span><span class="ident" id="6580627">time</span><span class="op" id="6580631">.</span><span class="ident" id="6580632">Now</span><span class="op" id="6580635">(</span><span class="op" id="6580636">)</span><span class="op" id="6580637">.</span><span class="ident" id="6580638">Add</span><span class="op" id="6580641">(</span><span class="ident" id="6580642">time</span><span class="op" id="6580646">.</span><span class="ident" id="6580647">Hour</span><span class="op" id="6580651">)</span><span class="op" id="6580652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6580656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6580659">}</span><span class="op" id="6580660">(</span><span class="op" id="6580661">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6580664">c</span><span class="op" id="6580665">,</span>&nbsp;<span class="ident" id="6580667">err</span>&nbsp;<span class="op" id="6580671">:=</span>&nbsp;<span class="ident" id="6580674">Dial</span><span class="op" id="6580678">(</span><span class="string" id="6580679">&#34;tcp&#34;</span><span class="op" id="6580684">,</span>&nbsp;<span class="ident" id="6580686">ln</span><span class="op" id="6580688">.</span><span class="ident" id="6580689">Addr</span><span class="op" id="6580693">(</span><span class="op" id="6580694">)</span><span class="op" id="6580695">.</span><span class="ident" id="6580696">String</span><span class="op" id="6580702">(</span><span class="op" id="6580703">)</span><span class="op" id="6580704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6580707">if</span>&nbsp;<span class="ident" id="6580710">err</span>&nbsp;<span class="op" id="6580714">!=</span>&nbsp;<span class="builtintype" id="6580717">nil</span>&nbsp;<span class="op" id="6580721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6580725">t</span><span class="op" id="6580726">.</span><span class="ident" id="6580727">Fatalf</span><span class="op" id="6580733">(</span><span class="string" id="6580734">&#34;DialTCP:&nbsp;%v&#34;</span><span class="op" id="6580747">,</span>&nbsp;<span class="ident" id="6580749">err</span><span class="op" id="6580752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6580755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6580758">defer</span>&nbsp;<span class="ident" id="6580764">c</span><span class="op" id="6580765">.</span><span class="ident" id="6580766">Close</span><span class="op" id="6580771">(</span><span class="op" id="6580772">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6580775">&lt;-</span><span class="ident" id="6580777">connected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6580788">for</span>&nbsp;<span class="ident" id="6580792">i</span>&nbsp;<span class="op" id="6580794">:=</span>&nbsp;<span class="num" id="6580797">0</span><span class="op" id="6580798">;</span>&nbsp;<span class="ident" id="6580800">i</span>&nbsp;<span class="op" id="6580802">&lt;</span>&nbsp;<span class="num" id="6580804">1024</span><span class="op" id="6580808">;</span>&nbsp;<span class="ident" id="6580810">i</span><span class="op" id="6580811">++</span>&nbsp;<span class="op" id="6580814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6580818">var</span>&nbsp;<span class="ident" id="6580822">buf</span>&nbsp;<span class="op" id="6580826">[</span><span class="num" id="6580827">1</span><span class="op" id="6580828">]</span><span class="builtintype" id="6580829">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6580836">c</span><span class="op" id="6580837">.</span><span class="ident" id="6580838">Write</span><span class="op" id="6580843">(</span><span class="ident" id="6580844">buf</span><span class="op" id="6580847">[</span><span class="op" id="6580848">:</span><span class="op" id="6580849">]</span><span class="op" id="6580850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6580853">}</span><br>
<span class="lineno">710</span><span class="op" id="6580855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6580858">func</span>&nbsp;<span class="ident" id="6580863">TestDeadlineRace</span><span class="op" id="6580879">(</span><span class="ident" id="6580880">t</span>&nbsp;<span class="op" id="6580882">*</span><span class="ident" id="6580883">testing</span><span class="op" id="6580890">.</span><span class="ident" id="6580891">T</span><span class="op" id="6580892">)</span>&nbsp;<span class="op" id="6580894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6580897">switch</span>&nbsp;<span class="ident" id="6580904">runtime</span><span class="op" id="6580911">.</span><span class="ident" id="6580912">GOOS</span>&nbsp;<span class="op" id="6580917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6580920">case</span>&nbsp;<span class="string" id="6580925">&#34;nacl&#34;</span><span class="op" id="6580931">,</span>&nbsp;<span class="string" id="6580933">&#34;plan9&#34;</span><span class="op" id="6580940">:</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6580944">t</span><span class="op" id="6580945">.</span><span class="ident" id="6580946">Skipf</span><span class="op" id="6580951">(</span><span class="string" id="6580952">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6580973">,</span>&nbsp;<span class="ident" id="6580975">runtime</span><span class="op" id="6580982">.</span><span class="ident" id="6580983">GOOS</span><span class="op" id="6580987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6580990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6580994">N</span>&nbsp;<span class="op" id="6580996">:=</span>&nbsp;<span class="num" id="6580999">1000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6581005">if</span>&nbsp;<span class="ident" id="6581008">testing</span><span class="op" id="6581015">.</span><span class="ident" id="6581016">Short</span><span class="op" id="6581021">(</span><span class="op" id="6581022">)</span>&nbsp;<span class="op" id="6581024">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6581028">N</span>&nbsp;<span class="op" id="6581030">=</span>&nbsp;<span class="num" id="6581032">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6581036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6581039">defer</span>&nbsp;<span class="ident" id="6581045">runtime</span><span class="op" id="6581052">.</span><span class="ident" id="6581053">GOMAXPROCS</span><span class="op" id="6581063">(</span><span class="ident" id="6581064">runtime</span><span class="op" id="6581071">.</span><span class="ident" id="6581072">GOMAXPROCS</span><span class="op" id="6581082">(</span><span class="num" id="6581083">4</span><span class="op" id="6581084">)</span><span class="op" id="6581085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6581088">ln</span>&nbsp;<span class="op" id="6581091">:=</span>&nbsp;<span class="ident" id="6581094">newLocalListener</span><span class="op" id="6581110">(</span><span class="ident" id="6581111">t</span><span class="op" id="6581112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6581115">defer</span>&nbsp;<span class="ident" id="6581121">ln</span><span class="op" id="6581123">.</span><span class="ident" id="6581124">Close</span><span class="op" id="6581129">(</span><span class="op" id="6581130">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6581133">c</span><span class="op" id="6581134">,</span>&nbsp;<span class="ident" id="6581136">err</span>&nbsp;<span class="op" id="6581140">:=</span>&nbsp;<span class="ident" id="6581143">Dial</span><span class="op" id="6581147">(</span><span class="string" id="6581148">&#34;tcp&#34;</span><span class="op" id="6581153">,</span>&nbsp;<span class="ident" id="6581155">ln</span><span class="op" id="6581157">.</span><span class="ident" id="6581158">Addr</span><span class="op" id="6581162">(</span><span class="op" id="6581163">)</span><span class="op" id="6581164">.</span><span class="ident" id="6581165">String</span><span class="op" id="6581171">(</span><span class="op" id="6581172">)</span><span class="op" id="6581173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6581176">if</span>&nbsp;<span class="ident" id="6581179">err</span>&nbsp;<span class="op" id="6581183">!=</span>&nbsp;<span class="builtintype" id="6581186">nil</span>&nbsp;<span class="op" id="6581190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6581194">t</span><span class="op" id="6581195">.</span><span class="ident" id="6581196">Fatalf</span><span class="op" id="6581202">(</span><span class="string" id="6581203">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="6581213">,</span>&nbsp;<span class="ident" id="6581215">err</span><span class="op" id="6581218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6581221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6581224">defer</span>&nbsp;<span class="ident" id="6581230">c</span><span class="op" id="6581231">.</span><span class="ident" id="6581232">Close</span><span class="op" id="6581237">(</span><span class="op" id="6581238">)</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6581241">done</span>&nbsp;<span class="op" id="6581246">:=</span>&nbsp;<span class="builtinfunc" id="6581249">make</span><span class="op" id="6581253">(</span><span class="keyword" id="6581254">chan</span>&nbsp;<span class="builtintype" id="6581259">bool</span><span class="op" id="6581263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6581266">go</span>&nbsp;<span class="keyword" id="6581269">func</span><span class="op" id="6581273">(</span><span class="op" id="6581274">)</span>&nbsp;<span class="op" id="6581276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6581280">t</span>&nbsp;<span class="op" id="6581282">:=</span>&nbsp;<span class="ident" id="6581285">time</span><span class="op" id="6581289">.</span><span class="ident" id="6581290">NewTicker</span><span class="op" id="6581299">(</span><span class="num" id="6581300">2</span>&nbsp;<span class="op" id="6581302">*</span>&nbsp;<span class="ident" id="6581304">time</span><span class="op" id="6581308">.</span><span class="ident" id="6581309">Microsecond</span><span class="op" id="6581320">)</span><span class="op" id="6581321">.</span><span class="ident" id="6581322">C</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6581326">for</span>&nbsp;<span class="ident" id="6581330">i</span>&nbsp;<span class="op" id="6581332">:=</span>&nbsp;<span class="num" id="6581335">0</span><span class="op" id="6581336">;</span>&nbsp;<span class="ident" id="6581338">i</span>&nbsp;<span class="op" id="6581340">&lt;</span>&nbsp;<span class="ident" id="6581342">N</span><span class="op" id="6581343">;</span>&nbsp;<span class="ident" id="6581345">i</span><span class="op" id="6581346">++</span>&nbsp;<span class="op" id="6581349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6581354">if</span>&nbsp;<span class="ident" id="6581357">err</span>&nbsp;<span class="op" id="6581361">:=</span>&nbsp;<span class="ident" id="6581364">c</span><span class="op" id="6581365">.</span><span class="ident" id="6581366">SetDeadline</span><span class="op" id="6581377">(</span><span class="ident" id="6581378">time</span><span class="op" id="6581382">.</span><span class="ident" id="6581383">Now</span><span class="op" id="6581386">(</span><span class="op" id="6581387">)</span><span class="op" id="6581388">.</span><span class="ident" id="6581389">Add</span><span class="op" id="6581392">(</span><span class="num" id="6581393">2</span>&nbsp;<span class="op" id="6581395">*</span>&nbsp;<span class="ident" id="6581397">time</span><span class="op" id="6581401">.</span><span class="ident" id="6581402">Microsecond</span><span class="op" id="6581413">)</span><span class="op" id="6581414">)</span><span class="op" id="6581415">;</span>&nbsp;<span class="ident" id="6581417">err</span>&nbsp;<span class="op" id="6581421">!=</span>&nbsp;<span class="builtintype" id="6581424">nil</span>&nbsp;<span class="op" id="6581428">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6581434">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6581443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6581448">&lt;-</span><span class="ident" id="6581450">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6581454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6581458">done</span>&nbsp;<span class="op" id="6581463">&lt;-</span>&nbsp;<span class="builtintype" id="6581466">true</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6581472">}</span><span class="op" id="6581473">(</span><span class="op" id="6581474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6581477">var</span>&nbsp;<span class="ident" id="6581481">buf</span>&nbsp;<span class="op" id="6581485">[</span><span class="num" id="6581486">1</span><span class="op" id="6581487">]</span><span class="builtintype" id="6581488">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6581494">for</span>&nbsp;<span class="ident" id="6581498">i</span>&nbsp;<span class="op" id="6581500">:=</span>&nbsp;<span class="num" id="6581503">0</span><span class="op" id="6581504">;</span>&nbsp;<span class="ident" id="6581506">i</span>&nbsp;<span class="op" id="6581508">&lt;</span>&nbsp;<span class="ident" id="6581510">N</span><span class="op" id="6581511">;</span>&nbsp;<span class="ident" id="6581513">i</span><span class="op" id="6581514">++</span>&nbsp;<span class="op" id="6581517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6581521">c</span><span class="op" id="6581522">.</span><span class="ident" id="6581523">Read</span><span class="op" id="6581527">(</span><span class="ident" id="6581528">buf</span><span class="op" id="6581531">[</span><span class="op" id="6581532">:</span><span class="op" id="6581533">]</span><span class="op" id="6581534">)</span>&nbsp;<span class="comment" id="6581536">//&nbsp;ignore&nbsp;possible&nbsp;timeout&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6581571">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6581574">c</span><span class="op" id="6581575">.</span><span class="ident" id="6581576">Close</span><span class="op" id="6581581">(</span><span class="op" id="6581582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6581585">&lt;-</span><span class="ident" id="6581587">done</span><br>
<span class="lineno"></span><span class="op" id="6581592">}</span>
</div>
</body>
</html>
