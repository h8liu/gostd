<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/tar</h2>
<ul>
<li><a href="/gostd/archive/tar/common.go.html">common.go</a></li>
<li><a href="/gostd/archive/tar/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/tar/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/tar/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/tar/stat_atim.go.html">stat_atim.go</a></li>
<li><a href="/gostd/archive/tar/stat_unix.go.html">stat_unix.go</a></li>
<li><a href="/gostd/archive/tar/tar_test.go.html">tar_test.go</a></li>
<li><a href="/gostd/archive/tar/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/tar/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5898634">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5898689">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5898743">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5898794">//&nbsp;Package&nbsp;tar&nbsp;implements&nbsp;access&nbsp;to&nbsp;tar&nbsp;archives.</span><br>
<span class="lineno"></span><span class="comment" id="5898844">//&nbsp;It&nbsp;aims&nbsp;to&nbsp;cover&nbsp;most&nbsp;of&nbsp;the&nbsp;variations,&nbsp;including&nbsp;those&nbsp;produced</span><br>
<span class="lineno"></span><span class="comment" id="5898913">//&nbsp;by&nbsp;GNU&nbsp;and&nbsp;BSD&nbsp;tars.</span><br>
<span class="lineno"></span><span class="comment" id="5898937">//</span><br>
<span class="lineno"></span><span class="comment" id="5898940">//&nbsp;References:</span><br>
<span class="lineno">10</span><span class="comment" id="5898955">//&nbsp;&nbsp;&nbsp;http://www.freebsd.org/cgi/man.cgi?query=tar&amp;sektion=5</span><br>
<span class="lineno"></span><span class="comment" id="5899015">//&nbsp;&nbsp;&nbsp;http://www.gnu.org/software/tar/manual/html_node/Standard.html</span><br>
<span class="lineno"></span><span class="comment" id="5899083">//&nbsp;&nbsp;&nbsp;http://pubs.opengroup.org/onlinepubs/9699919799/utilities/pax.html</span><br>
<span class="lineno"></span><span class="keyword" id="5899155">package</span>&nbsp;<span class="ident" id="5899163">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="5899168">import</span>&nbsp;<span class="op" id="5899175">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5899178">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5899187">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5899197">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5899204">&#34;os&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5899210">&#34;path&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5899218">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="5899225">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5899228">const</span>&nbsp;<span class="op" id="5899234">(</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5899237">blockSize</span>&nbsp;<span class="op" id="5899247">=</span>&nbsp;<span class="num" id="5899249">512</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5899255">//&nbsp;Types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5899265">TypeReg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5899283">=</span>&nbsp;<span class="string" id="5899285">&#39;0&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5899292">//&nbsp;regular&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5899309">TypeRegA</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5899327">=</span>&nbsp;<span class="string" id="5899329">&#39;\x00&#39;</span>&nbsp;<span class="comment" id="5899336">//&nbsp;regular&nbsp;file</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5899353">TypeLink</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5899371">=</span>&nbsp;<span class="string" id="5899373">&#39;1&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5899380">//&nbsp;hard&nbsp;link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5899394">TypeSymlink</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5899412">=</span>&nbsp;<span class="string" id="5899414">&#39;2&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5899421">//&nbsp;symbolic&nbsp;link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5899439">TypeChar</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5899457">=</span>&nbsp;<span class="string" id="5899459">&#39;3&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5899466">//&nbsp;character&nbsp;device&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5899492">TypeBlock</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5899510">=</span>&nbsp;<span class="string" id="5899512">&#39;4&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5899519">//&nbsp;block&nbsp;device&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5899541">TypeDir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5899559">=</span>&nbsp;<span class="string" id="5899561">&#39;5&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5899568">//&nbsp;directory</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5899582">TypeFifo</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5899600">=</span>&nbsp;<span class="string" id="5899602">&#39;6&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5899609">//&nbsp;fifo&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5899623">TypeCont</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5899641">=</span>&nbsp;<span class="string" id="5899643">&#39;7&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5899650">//&nbsp;reserved</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5899663">TypeXHeader</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5899681">=</span>&nbsp;<span class="string" id="5899683">&#39;x&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5899690">//&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5899710">TypeXGlobalHeader</span>&nbsp;<span class="op" id="5899728">=</span>&nbsp;<span class="string" id="5899730">&#39;g&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5899737">//&nbsp;global&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5899764">TypeGNULongName</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5899782">=</span>&nbsp;<span class="string" id="5899784">&#39;L&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5899791">//&nbsp;Next&nbsp;file&nbsp;has&nbsp;a&nbsp;long&nbsp;name</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5899821">TypeGNULongLink</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5899839">=</span>&nbsp;<span class="string" id="5899841">&#39;K&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5899848">//&nbsp;Next&nbsp;file&nbsp;symlinks&nbsp;to&nbsp;a&nbsp;file&nbsp;w/&nbsp;a&nbsp;long&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5899896">TypeGNUSparse</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5899914">=</span>&nbsp;<span class="string" id="5899916">&#39;S&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5899923">//&nbsp;sparse&nbsp;file</span><br>
<span class="lineno"></span><span class="op" id="5899938">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5899941">//&nbsp;A&nbsp;Header&nbsp;represents&nbsp;a&nbsp;single&nbsp;header&nbsp;in&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno">45</span><span class="comment" id="5899998">//&nbsp;Some&nbsp;fields&nbsp;may&nbsp;not&nbsp;be&nbsp;populated.</span><br>
<span class="lineno"></span><span class="keyword" id="5900035">type</span>&nbsp;<span class="ident" id="5900040">Header</span>&nbsp;<span class="keyword" id="5900047">struct</span>&nbsp;<span class="op" id="5900054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900057">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5900068">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5900078">//&nbsp;name&nbsp;of&nbsp;header&nbsp;file&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900108">Mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5900119">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5900129">//&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900158">Uid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5900169">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5900179">//&nbsp;user&nbsp;id&nbsp;of&nbsp;owner</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900200">Gid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5900211">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5900221">//&nbsp;group&nbsp;id&nbsp;of&nbsp;owner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900243">Size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5900254">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5900264">//&nbsp;length&nbsp;in&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900284">ModTime</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5900295">time</span><span class="op" id="5900299">.</span><span class="ident" id="5900300">Time</span>&nbsp;<span class="comment" id="5900305">//&nbsp;modified&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900323">Typeflag</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5900334">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5900344">//&nbsp;type&nbsp;of&nbsp;header&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900369">Linkname</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5900380">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5900390">//&nbsp;target&nbsp;name&nbsp;of&nbsp;link</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900414">Uname</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5900425">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5900435">//&nbsp;user&nbsp;name&nbsp;of&nbsp;owner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900458">Gname</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5900469">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5900479">//&nbsp;group&nbsp;name&nbsp;of&nbsp;owner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900503">Devmajor</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5900514">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5900524">//&nbsp;major&nbsp;number&nbsp;of&nbsp;character&nbsp;or&nbsp;block&nbsp;device</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900570">Devminor</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5900581">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5900591">//&nbsp;minor&nbsp;number&nbsp;of&nbsp;character&nbsp;or&nbsp;block&nbsp;device</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900637">AccessTime</span>&nbsp;<span class="ident" id="5900648">time</span><span class="op" id="5900652">.</span><span class="ident" id="5900653">Time</span>&nbsp;<span class="comment" id="5900658">//&nbsp;access&nbsp;time</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900674">ChangeTime</span>&nbsp;<span class="ident" id="5900685">time</span><span class="op" id="5900689">.</span><span class="ident" id="5900690">Time</span>&nbsp;<span class="comment" id="5900695">//&nbsp;status&nbsp;change&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900718">Xattrs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5900729">map</span><span class="op" id="5900732">[</span><span class="builtintype" id="5900733">string</span><span class="op" id="5900739">]</span><span class="builtintype" id="5900740">string</span><br>
<span class="lineno"></span><span class="op" id="5900747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5900750">//&nbsp;File&nbsp;name&nbsp;constants&nbsp;from&nbsp;the&nbsp;tar&nbsp;spec.</span><br>
<span class="lineno">65</span><span class="keyword" id="5900792">const</span>&nbsp;<span class="op" id="5900798">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900801">fileNameSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5900820">=</span>&nbsp;<span class="num" id="5900822">100</span>&nbsp;<span class="comment" id="5900826">//&nbsp;Maximum&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;a&nbsp;standard&nbsp;tar&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900878">fileNamePrefixSize</span>&nbsp;<span class="op" id="5900897">=</span>&nbsp;<span class="num" id="5900899">155</span>&nbsp;<span class="comment" id="5900903">//&nbsp;Maximum&nbsp;number&nbsp;of&nbsp;ustar&nbsp;extension&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="op" id="5900947">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="5900950">//&nbsp;FileInfo&nbsp;returns&nbsp;an&nbsp;os.FileInfo&nbsp;for&nbsp;the&nbsp;Header.</span><br>
<span class="lineno"></span><span class="keyword" id="5901001">func</span>&nbsp;<span class="op" id="5901006">(</span><span class="ident" id="5901007">h</span>&nbsp;<span class="op" id="5901009">*</span><span class="ident" id="5901010">Header</span><span class="op" id="5901016">)</span>&nbsp;<span class="ident" id="5901018">FileInfo</span><span class="op" id="5901026">(</span><span class="op" id="5901027">)</span>&nbsp;<span class="ident" id="5901029">os</span><span class="op" id="5901031">.</span><span class="ident" id="5901032">FileInfo</span>&nbsp;<span class="op" id="5901041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5901044">return</span>&nbsp;<span class="ident" id="5901051">headerFileInfo</span><span class="op" id="5901065">{</span><span class="ident" id="5901066">h</span><span class="op" id="5901067">}</span><br>
<span class="lineno"></span><span class="op" id="5901069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="5901072">//&nbsp;headerFileInfo&nbsp;implements&nbsp;os.FileInfo.</span><br>
<span class="lineno"></span><span class="keyword" id="5901114">type</span>&nbsp;<span class="ident" id="5901119">headerFileInfo</span>&nbsp;<span class="keyword" id="5901134">struct</span>&nbsp;<span class="op" id="5901141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901144">h</span>&nbsp;<span class="op" id="5901146">*</span><span class="ident" id="5901147">Header</span><br>
<span class="lineno"></span><span class="op" id="5901154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="5901157">func</span>&nbsp;<span class="op" id="5901162">(</span><span class="ident" id="5901163">fi</span>&nbsp;<span class="ident" id="5901166">headerFileInfo</span><span class="op" id="5901180">)</span>&nbsp;<span class="ident" id="5901182">Size</span><span class="op" id="5901186">(</span><span class="op" id="5901187">)</span>&nbsp;<span class="ident" id="5901189">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5901202">{</span>&nbsp;<span class="keyword" id="5901204">return</span>&nbsp;<span class="ident" id="5901211">fi</span><span class="op" id="5901213">.</span><span class="ident" id="5901214">h</span><span class="op" id="5901215">.</span><span class="ident" id="5901216">Size</span>&nbsp;<span class="op" id="5901221">}</span><br>
<span class="lineno"></span><span class="keyword" id="5901223">func</span>&nbsp;<span class="op" id="5901228">(</span><span class="ident" id="5901229">fi</span>&nbsp;<span class="ident" id="5901232">headerFileInfo</span><span class="op" id="5901246">)</span>&nbsp;<span class="ident" id="5901248">IsDir</span><span class="op" id="5901253">(</span><span class="op" id="5901254">)</span>&nbsp;<span class="builtintype" id="5901256">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5901268">{</span>&nbsp;<span class="keyword" id="5901270">return</span>&nbsp;<span class="ident" id="5901277">fi</span><span class="op" id="5901279">.</span><span class="ident" id="5901280">Mode</span><span class="op" id="5901284">(</span><span class="op" id="5901285">)</span><span class="op" id="5901286">.</span><span class="ident" id="5901287">IsDir</span><span class="op" id="5901292">(</span><span class="op" id="5901293">)</span>&nbsp;<span class="op" id="5901295">}</span><br>
<span class="lineno"></span><span class="keyword" id="5901297">func</span>&nbsp;<span class="op" id="5901302">(</span><span class="ident" id="5901303">fi</span>&nbsp;<span class="ident" id="5901306">headerFileInfo</span><span class="op" id="5901320">)</span>&nbsp;<span class="ident" id="5901322">ModTime</span><span class="op" id="5901329">(</span><span class="op" id="5901330">)</span>&nbsp;<span class="ident" id="5901332">time</span><span class="op" id="5901336">.</span><span class="ident" id="5901337">Time</span>&nbsp;<span class="op" id="5901342">{</span>&nbsp;<span class="keyword" id="5901344">return</span>&nbsp;<span class="ident" id="5901351">fi</span><span class="op" id="5901353">.</span><span class="ident" id="5901354">h</span><span class="op" id="5901355">.</span><span class="ident" id="5901356">ModTime</span>&nbsp;<span class="op" id="5901364">}</span><br>
<span class="lineno"></span><span class="keyword" id="5901366">func</span>&nbsp;<span class="op" id="5901371">(</span><span class="ident" id="5901372">fi</span>&nbsp;<span class="ident" id="5901375">headerFileInfo</span><span class="op" id="5901389">)</span>&nbsp;<span class="ident" id="5901391">Sys</span><span class="op" id="5901394">(</span><span class="op" id="5901395">)</span>&nbsp;<span class="keyword" id="5901397">interface</span><span class="op" id="5901406">{</span><span class="op" id="5901407">}</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5901411">{</span>&nbsp;<span class="keyword" id="5901413">return</span>&nbsp;<span class="ident" id="5901420">fi</span><span class="op" id="5901422">.</span><span class="ident" id="5901423">h</span>&nbsp;<span class="op" id="5901425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="5901428">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;base&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="5901471">func</span>&nbsp;<span class="op" id="5901476">(</span><span class="ident" id="5901477">fi</span>&nbsp;<span class="ident" id="5901480">headerFileInfo</span><span class="op" id="5901494">)</span>&nbsp;<span class="ident" id="5901496">Name</span><span class="op" id="5901500">(</span><span class="op" id="5901501">)</span>&nbsp;<span class="builtintype" id="5901503">string</span>&nbsp;<span class="op" id="5901510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5901513">if</span>&nbsp;<span class="ident" id="5901516">fi</span><span class="op" id="5901518">.</span><span class="ident" id="5901519">IsDir</span><span class="op" id="5901524">(</span><span class="op" id="5901525">)</span>&nbsp;<span class="op" id="5901527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5901531">return</span>&nbsp;<span class="ident" id="5901538">path</span><span class="op" id="5901542">.</span><span class="ident" id="5901543">Base</span><span class="op" id="5901547">(</span><span class="ident" id="5901548">path</span><span class="op" id="5901552">.</span><span class="ident" id="5901553">Clean</span><span class="op" id="5901558">(</span><span class="ident" id="5901559">fi</span><span class="op" id="5901561">.</span><span class="ident" id="5901562">h</span><span class="op" id="5901563">.</span><span class="ident" id="5901564">Name</span><span class="op" id="5901568">)</span><span class="op" id="5901569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5901572">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5901575">return</span>&nbsp;<span class="ident" id="5901582">path</span><span class="op" id="5901586">.</span><span class="ident" id="5901587">Base</span><span class="op" id="5901591">(</span><span class="ident" id="5901592">fi</span><span class="op" id="5901594">.</span><span class="ident" id="5901595">h</span><span class="op" id="5901596">.</span><span class="ident" id="5901597">Name</span><span class="op" id="5901601">)</span><br>
<span class="lineno"></span><span class="op" id="5901603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5901606">//&nbsp;Mode&nbsp;returns&nbsp;the&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits&nbsp;for&nbsp;the&nbsp;headerFileInfo.</span><br>
<span class="lineno"></span><span class="keyword" id="5901675">func</span>&nbsp;<span class="op" id="5901680">(</span><span class="ident" id="5901681">fi</span>&nbsp;<span class="ident" id="5901684">headerFileInfo</span><span class="op" id="5901698">)</span>&nbsp;<span class="ident" id="5901700">Mode</span><span class="op" id="5901704">(</span><span class="op" id="5901705">)</span>&nbsp;<span class="op" id="5901707">(</span><span class="ident" id="5901708">mode</span>&nbsp;<span class="ident" id="5901713">os</span><span class="op" id="5901715">.</span><span class="ident" id="5901716">FileMode</span><span class="op" id="5901724">)</span>&nbsp;<span class="op" id="5901726">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5901729">//&nbsp;Set&nbsp;file&nbsp;permission&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901759">mode</span>&nbsp;<span class="op" id="5901764">=</span>&nbsp;<span class="ident" id="5901766">os</span><span class="op" id="5901768">.</span><span class="ident" id="5901769">FileMode</span><span class="op" id="5901777">(</span><span class="ident" id="5901778">fi</span><span class="op" id="5901780">.</span><span class="ident" id="5901781">h</span><span class="op" id="5901782">.</span><span class="ident" id="5901783">Mode</span><span class="op" id="5901787">)</span><span class="op" id="5901788">.</span><span class="ident" id="5901789">Perm</span><span class="op" id="5901793">(</span><span class="op" id="5901794">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5901798">//&nbsp;Set&nbsp;setuid,&nbsp;setgid&nbsp;and&nbsp;sticky&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5901838">if</span>&nbsp;<span class="ident" id="5901841">fi</span><span class="op" id="5901843">.</span><span class="ident" id="5901844">h</span><span class="op" id="5901845">.</span><span class="ident" id="5901846">Mode</span><span class="op" id="5901850">&amp;</span><span class="ident" id="5901851">c_ISUID</span>&nbsp;<span class="op" id="5901859">!=</span>&nbsp;<span class="num" id="5901862">0</span>&nbsp;<span class="op" id="5901864">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5901868">//&nbsp;setuid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901880">mode</span>&nbsp;<span class="op" id="5901885">|=</span>&nbsp;<span class="ident" id="5901888">os</span><span class="op" id="5901890">.</span><span class="ident" id="5901891">ModeSetuid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5901903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5901906">if</span>&nbsp;<span class="ident" id="5901909">fi</span><span class="op" id="5901911">.</span><span class="ident" id="5901912">h</span><span class="op" id="5901913">.</span><span class="ident" id="5901914">Mode</span><span class="op" id="5901918">&amp;</span><span class="ident" id="5901919">c_ISGID</span>&nbsp;<span class="op" id="5901927">!=</span>&nbsp;<span class="num" id="5901930">0</span>&nbsp;<span class="op" id="5901932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5901936">//&nbsp;setgid</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901948">mode</span>&nbsp;<span class="op" id="5901953">|=</span>&nbsp;<span class="ident" id="5901956">os</span><span class="op" id="5901958">.</span><span class="ident" id="5901959">ModeSetgid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5901971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5901974">if</span>&nbsp;<span class="ident" id="5901977">fi</span><span class="op" id="5901979">.</span><span class="ident" id="5901980">h</span><span class="op" id="5901981">.</span><span class="ident" id="5901982">Mode</span><span class="op" id="5901986">&amp;</span><span class="ident" id="5901987">c_ISVTX</span>&nbsp;<span class="op" id="5901995">!=</span>&nbsp;<span class="num" id="5901998">0</span>&nbsp;<span class="op" id="5902000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5902004">//&nbsp;sticky</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902016">mode</span>&nbsp;<span class="op" id="5902021">|=</span>&nbsp;<span class="ident" id="5902024">os</span><span class="op" id="5902026">.</span><span class="ident" id="5902027">ModeSticky</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5902039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5902043">//&nbsp;Set&nbsp;file&nbsp;mode&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5902067">//&nbsp;clear&nbsp;perm,&nbsp;setuid,&nbsp;setgid&nbsp;and&nbsp;sticky&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902115">m</span>&nbsp;<span class="op" id="5902117">:=</span>&nbsp;<span class="ident" id="5902120">os</span><span class="op" id="5902122">.</span><span class="ident" id="5902123">FileMode</span><span class="op" id="5902131">(</span><span class="ident" id="5902132">fi</span><span class="op" id="5902134">.</span><span class="ident" id="5902135">h</span><span class="op" id="5902136">.</span><span class="ident" id="5902137">Mode</span><span class="op" id="5902141">)</span>&nbsp;<span class="op" id="5902143">&amp;^</span>&nbsp;<span class="num" id="5902146">07777</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902153">if</span>&nbsp;<span class="ident" id="5902156">m</span>&nbsp;<span class="op" id="5902158">==</span>&nbsp;<span class="ident" id="5902161">c_ISDIR</span>&nbsp;<span class="op" id="5902169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5902173">//&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902188">mode</span>&nbsp;<span class="op" id="5902193">|=</span>&nbsp;<span class="ident" id="5902196">os</span><span class="op" id="5902198">.</span><span class="ident" id="5902199">ModeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5902208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902211">if</span>&nbsp;<span class="ident" id="5902214">m</span>&nbsp;<span class="op" id="5902216">==</span>&nbsp;<span class="ident" id="5902219">c_ISFIFO</span>&nbsp;<span class="op" id="5902228">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5902232">//&nbsp;named&nbsp;pipe&nbsp;(FIFO)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902255">mode</span>&nbsp;<span class="op" id="5902260">|=</span>&nbsp;<span class="ident" id="5902263">os</span><span class="op" id="5902265">.</span><span class="ident" id="5902266">ModeNamedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5902281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902284">if</span>&nbsp;<span class="ident" id="5902287">m</span>&nbsp;<span class="op" id="5902289">==</span>&nbsp;<span class="ident" id="5902292">c_ISLNK</span>&nbsp;<span class="op" id="5902300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5902304">//&nbsp;symbolic&nbsp;link</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902323">mode</span>&nbsp;<span class="op" id="5902328">|=</span>&nbsp;<span class="ident" id="5902331">os</span><span class="op" id="5902333">.</span><span class="ident" id="5902334">ModeSymlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5902347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902350">if</span>&nbsp;<span class="ident" id="5902353">m</span>&nbsp;<span class="op" id="5902355">==</span>&nbsp;<span class="ident" id="5902358">c_ISBLK</span>&nbsp;<span class="op" id="5902366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5902370">//&nbsp;device&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902387">mode</span>&nbsp;<span class="op" id="5902392">|=</span>&nbsp;<span class="ident" id="5902395">os</span><span class="op" id="5902397">.</span><span class="ident" id="5902398">ModeDevice</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5902410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902413">if</span>&nbsp;<span class="ident" id="5902416">m</span>&nbsp;<span class="op" id="5902418">==</span>&nbsp;<span class="ident" id="5902421">c_ISCHR</span>&nbsp;<span class="op" id="5902429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5902433">//&nbsp;Unix&nbsp;character&nbsp;device</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902460">mode</span>&nbsp;<span class="op" id="5902465">|=</span>&nbsp;<span class="ident" id="5902468">os</span><span class="op" id="5902470">.</span><span class="ident" id="5902471">ModeDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902484">mode</span>&nbsp;<span class="op" id="5902489">|=</span>&nbsp;<span class="ident" id="5902492">os</span><span class="op" id="5902494">.</span><span class="ident" id="5902495">ModeCharDevice</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5902511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902514">if</span>&nbsp;<span class="ident" id="5902517">m</span>&nbsp;<span class="op" id="5902519">==</span>&nbsp;<span class="ident" id="5902522">c_ISSOCK</span>&nbsp;<span class="op" id="5902531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5902535">//&nbsp;Unix&nbsp;domain&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902559">mode</span>&nbsp;<span class="op" id="5902564">|=</span>&nbsp;<span class="ident" id="5902567">os</span><span class="op" id="5902569">.</span><span class="ident" id="5902570">ModeSocket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5902582">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902586">switch</span>&nbsp;<span class="ident" id="5902593">fi</span><span class="op" id="5902595">.</span><span class="ident" id="5902596">h</span><span class="op" id="5902597">.</span><span class="ident" id="5902598">Typeflag</span>&nbsp;<span class="op" id="5902607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902610">case</span>&nbsp;<span class="ident" id="5902615">TypeLink</span><span class="op" id="5902623">,</span>&nbsp;<span class="ident" id="5902625">TypeSymlink</span><span class="op" id="5902636">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5902640">//&nbsp;hard&nbsp;link,&nbsp;symbolic&nbsp;link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902670">mode</span>&nbsp;<span class="op" id="5902675">|=</span>&nbsp;<span class="ident" id="5902678">os</span><span class="op" id="5902680">.</span><span class="ident" id="5902681">ModeSymlink</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902694">case</span>&nbsp;<span class="ident" id="5902699">TypeChar</span><span class="op" id="5902707">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5902711">//&nbsp;character&nbsp;device&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902738">mode</span>&nbsp;<span class="op" id="5902743">|=</span>&nbsp;<span class="ident" id="5902746">os</span><span class="op" id="5902748">.</span><span class="ident" id="5902749">ModeDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902762">mode</span>&nbsp;<span class="op" id="5902767">|=</span>&nbsp;<span class="ident" id="5902770">os</span><span class="op" id="5902772">.</span><span class="ident" id="5902773">ModeCharDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902789">case</span>&nbsp;<span class="ident" id="5902794">TypeBlock</span><span class="op" id="5902803">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5902807">//&nbsp;block&nbsp;device&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902830">mode</span>&nbsp;<span class="op" id="5902835">|=</span>&nbsp;<span class="ident" id="5902838">os</span><span class="op" id="5902840">.</span><span class="ident" id="5902841">ModeDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902853">case</span>&nbsp;<span class="ident" id="5902858">TypeDir</span><span class="op" id="5902865">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5902869">//&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902884">mode</span>&nbsp;<span class="op" id="5902889">|=</span>&nbsp;<span class="ident" id="5902892">os</span><span class="op" id="5902894">.</span><span class="ident" id="5902895">ModeDir</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902904">case</span>&nbsp;<span class="ident" id="5902909">TypeFifo</span><span class="op" id="5902917">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5902921">//&nbsp;fifo&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902936">mode</span>&nbsp;<span class="op" id="5902941">|=</span>&nbsp;<span class="ident" id="5902944">os</span><span class="op" id="5902946">.</span><span class="ident" id="5902947">ModeNamedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5902962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902966">return</span>&nbsp;<span class="ident" id="5902973">mode</span><br>
<span class="lineno"></span><span class="op" id="5902978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5902981">//&nbsp;sysStat,&nbsp;if&nbsp;non-nil,&nbsp;populates&nbsp;h&nbsp;from&nbsp;system-dependent&nbsp;fields&nbsp;of&nbsp;fi.</span><br>
<span class="lineno"></span><span class="keyword" id="5903053">var</span>&nbsp;<span class="ident" id="5903057">sysStat</span>&nbsp;<span class="keyword" id="5903065">func</span><span class="op" id="5903069">(</span><span class="ident" id="5903070">fi</span>&nbsp;<span class="ident" id="5903073">os</span><span class="op" id="5903075">.</span><span class="ident" id="5903076">FileInfo</span><span class="op" id="5903084">,</span>&nbsp;<span class="ident" id="5903086">h</span>&nbsp;<span class="op" id="5903088">*</span><span class="ident" id="5903089">Header</span><span class="op" id="5903095">)</span>&nbsp;<span class="builtintype" id="5903097">error</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="comment" id="5903104">//&nbsp;Mode&nbsp;constants&nbsp;from&nbsp;the&nbsp;tar&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="5903141">const</span>&nbsp;<span class="op" id="5903147">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903150">c_ISUID</span>&nbsp;&nbsp;<span class="op" id="5903159">=</span>&nbsp;<span class="num" id="5903161">04000</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5903169">//&nbsp;Set&nbsp;uid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903181">c_ISGID</span>&nbsp;&nbsp;<span class="op" id="5903190">=</span>&nbsp;<span class="num" id="5903192">02000</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5903200">//&nbsp;Set&nbsp;gid</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903212">c_ISVTX</span>&nbsp;&nbsp;<span class="op" id="5903221">=</span>&nbsp;<span class="num" id="5903223">01000</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5903231">//&nbsp;Save&nbsp;text&nbsp;(sticky&nbsp;bit)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903258">c_ISDIR</span>&nbsp;&nbsp;<span class="op" id="5903267">=</span>&nbsp;<span class="num" id="5903269">040000</span>&nbsp;&nbsp;<span class="comment" id="5903277">//&nbsp;Directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903291">c_ISFIFO</span>&nbsp;<span class="op" id="5903300">=</span>&nbsp;<span class="num" id="5903302">010000</span>&nbsp;&nbsp;<span class="comment" id="5903310">//&nbsp;FIFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903319">c_ISREG</span>&nbsp;&nbsp;<span class="op" id="5903328">=</span>&nbsp;<span class="num" id="5903330">0100000</span>&nbsp;<span class="comment" id="5903338">//&nbsp;Regular&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903355">c_ISLNK</span>&nbsp;&nbsp;<span class="op" id="5903364">=</span>&nbsp;<span class="num" id="5903366">0120000</span>&nbsp;<span class="comment" id="5903374">//&nbsp;Symbolic&nbsp;link</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903392">c_ISBLK</span>&nbsp;&nbsp;<span class="op" id="5903401">=</span>&nbsp;<span class="num" id="5903403">060000</span>&nbsp;&nbsp;<span class="comment" id="5903411">//&nbsp;Block&nbsp;special&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903434">c_ISCHR</span>&nbsp;&nbsp;<span class="op" id="5903443">=</span>&nbsp;<span class="num" id="5903445">020000</span>&nbsp;&nbsp;<span class="comment" id="5903453">//&nbsp;Character&nbsp;special&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903480">c_ISSOCK</span>&nbsp;<span class="op" id="5903489">=</span>&nbsp;<span class="num" id="5903491">0140000</span>&nbsp;<span class="comment" id="5903499">//&nbsp;Socket</span><br>
<span class="lineno"></span><span class="op" id="5903509">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="5903512">//&nbsp;Keywords&nbsp;for&nbsp;the&nbsp;PAX&nbsp;Extended&nbsp;Header</span><br>
<span class="lineno"></span><span class="keyword" id="5903552">const</span>&nbsp;<span class="op" id="5903558">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903561">paxAtime</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5903573">=</span>&nbsp;<span class="string" id="5903575">&#34;atime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903584">paxCharset</span>&nbsp;&nbsp;<span class="op" id="5903596">=</span>&nbsp;<span class="string" id="5903598">&#34;charset&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903609">paxComment</span>&nbsp;&nbsp;<span class="op" id="5903621">=</span>&nbsp;<span class="string" id="5903623">&#34;comment&#34;</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903634">paxCtime</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5903646">=</span>&nbsp;<span class="string" id="5903648">&#34;ctime&#34;</span>&nbsp;<span class="comment" id="5903656">//&nbsp;please&nbsp;note&nbsp;that&nbsp;ctime&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;pax&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903710">paxGid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5903722">=</span>&nbsp;<span class="string" id="5903724">&#34;gid&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903731">paxGname</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5903743">=</span>&nbsp;<span class="string" id="5903745">&#34;gname&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903754">paxLinkpath</span>&nbsp;<span class="op" id="5903766">=</span>&nbsp;<span class="string" id="5903768">&#34;linkpath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903780">paxMtime</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5903792">=</span>&nbsp;<span class="string" id="5903794">&#34;mtime&#34;</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903803">paxPath</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5903815">=</span>&nbsp;<span class="string" id="5903817">&#34;path&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903825">paxSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5903837">=</span>&nbsp;<span class="string" id="5903839">&#34;size&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903847">paxUid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5903859">=</span>&nbsp;<span class="string" id="5903861">&#34;uid&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903868">paxUname</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5903880">=</span>&nbsp;<span class="string" id="5903882">&#34;uname&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903891">paxXattr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5903903">=</span>&nbsp;<span class="string" id="5903905">&#34;SCHILY.xattr.&#34;</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903922">paxNone</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5903934">=</span>&nbsp;<span class="string" id="5903936">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="5903939">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5903942">//&nbsp;FileInfoHeader&nbsp;creates&nbsp;a&nbsp;partially-populated&nbsp;Header&nbsp;from&nbsp;fi.</span><br>
<span class="lineno"></span><span class="comment" id="5904006">//&nbsp;If&nbsp;fi&nbsp;describes&nbsp;a&nbsp;symlink,&nbsp;FileInfoHeader&nbsp;records&nbsp;link&nbsp;as&nbsp;the&nbsp;link&nbsp;target.</span><br>
<span class="lineno">200</span><span class="comment" id="5904084">//&nbsp;If&nbsp;fi&nbsp;describes&nbsp;a&nbsp;directory,&nbsp;a&nbsp;slash&nbsp;is&nbsp;appended&nbsp;to&nbsp;the&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="5904149">//&nbsp;Because&nbsp;os.FileInfo&#39;s&nbsp;Name&nbsp;method&nbsp;returns&nbsp;only&nbsp;the&nbsp;base&nbsp;name&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5904216">//&nbsp;the&nbsp;file&nbsp;it&nbsp;describes,&nbsp;it&nbsp;may&nbsp;be&nbsp;necessary&nbsp;to&nbsp;modify&nbsp;the&nbsp;Name&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="5904287">//&nbsp;of&nbsp;the&nbsp;returned&nbsp;header&nbsp;to&nbsp;provide&nbsp;the&nbsp;full&nbsp;path&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="5904356">func</span>&nbsp;<span class="ident" id="5904361">FileInfoHeader</span><span class="op" id="5904375">(</span><span class="ident" id="5904376">fi</span>&nbsp;<span class="ident" id="5904379">os</span><span class="op" id="5904381">.</span><span class="ident" id="5904382">FileInfo</span><span class="op" id="5904390">,</span>&nbsp;<span class="ident" id="5904392">link</span>&nbsp;<span class="builtintype" id="5904397">string</span><span class="op" id="5904403">)</span>&nbsp;<span class="op" id="5904405">(</span><span class="op" id="5904406">*</span><span class="ident" id="5904407">Header</span><span class="op" id="5904413">,</span>&nbsp;<span class="builtintype" id="5904415">error</span><span class="op" id="5904420">)</span>&nbsp;<span class="op" id="5904422">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5904425">if</span>&nbsp;<span class="ident" id="5904428">fi</span>&nbsp;<span class="op" id="5904431">==</span>&nbsp;<span class="ident" id="5904434">nil</span>&nbsp;<span class="op" id="5904438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5904442">return</span>&nbsp;<span class="ident" id="5904449">nil</span><span class="op" id="5904452">,</span>&nbsp;<span class="ident" id="5904454">errors</span><span class="op" id="5904460">.</span><span class="ident" id="5904461">New</span><span class="op" id="5904464">(</span><span class="string" id="5904465">&#34;tar:&nbsp;FileInfo&nbsp;is&nbsp;nil&#34;</span><span class="op" id="5904487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5904490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904493">fm</span>&nbsp;<span class="op" id="5904496">:=</span>&nbsp;<span class="ident" id="5904499">fi</span><span class="op" id="5904501">.</span><span class="ident" id="5904502">Mode</span><span class="op" id="5904506">(</span><span class="op" id="5904507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904510">h</span>&nbsp;<span class="op" id="5904512">:=</span>&nbsp;<span class="op" id="5904515">&amp;</span><span class="ident" id="5904516">Header</span><span class="op" id="5904522">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904526">Name</span><span class="op" id="5904530">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5904535">fi</span><span class="op" id="5904537">.</span><span class="ident" id="5904538">Name</span><span class="op" id="5904542">(</span><span class="op" id="5904543">)</span><span class="op" id="5904544">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904548">ModTime</span><span class="op" id="5904555">:</span>&nbsp;<span class="ident" id="5904557">fi</span><span class="op" id="5904559">.</span><span class="ident" id="5904560">ModTime</span><span class="op" id="5904567">(</span><span class="op" id="5904568">)</span><span class="op" id="5904569">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904573">Mode</span><span class="op" id="5904577">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5904582">int64</span><span class="op" id="5904587">(</span><span class="ident" id="5904588">fm</span><span class="op" id="5904590">.</span><span class="ident" id="5904591">Perm</span><span class="op" id="5904595">(</span><span class="op" id="5904596">)</span><span class="op" id="5904597">)</span><span class="op" id="5904598">,</span>&nbsp;<span class="comment" id="5904600">//&nbsp;or&#39;d&nbsp;with&nbsp;c_IS*&nbsp;constants&nbsp;later</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5904636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5904639">switch</span>&nbsp;<span class="op" id="5904646">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5904649">case</span>&nbsp;<span class="ident" id="5904654">fm</span><span class="op" id="5904656">.</span><span class="ident" id="5904657">IsRegular</span><span class="op" id="5904666">(</span><span class="op" id="5904667">)</span><span class="op" id="5904668">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904672">h</span><span class="op" id="5904673">.</span><span class="ident" id="5904674">Mode</span>&nbsp;<span class="op" id="5904679">|=</span>&nbsp;<span class="ident" id="5904682">c_ISREG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904692">h</span><span class="op" id="5904693">.</span><span class="ident" id="5904694">Typeflag</span>&nbsp;<span class="op" id="5904703">=</span>&nbsp;<span class="ident" id="5904705">TypeReg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904715">h</span><span class="op" id="5904716">.</span><span class="ident" id="5904717">Size</span>&nbsp;<span class="op" id="5904722">=</span>&nbsp;<span class="ident" id="5904724">fi</span><span class="op" id="5904726">.</span><span class="ident" id="5904727">Size</span><span class="op" id="5904731">(</span><span class="op" id="5904732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5904735">case</span>&nbsp;<span class="ident" id="5904740">fi</span><span class="op" id="5904742">.</span><span class="ident" id="5904743">IsDir</span><span class="op" id="5904748">(</span><span class="op" id="5904749">)</span><span class="op" id="5904750">:</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904754">h</span><span class="op" id="5904755">.</span><span class="ident" id="5904756">Typeflag</span>&nbsp;<span class="op" id="5904765">=</span>&nbsp;<span class="ident" id="5904767">TypeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904777">h</span><span class="op" id="5904778">.</span><span class="ident" id="5904779">Mode</span>&nbsp;<span class="op" id="5904784">|=</span>&nbsp;<span class="ident" id="5904787">c_ISDIR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904797">h</span><span class="op" id="5904798">.</span><span class="ident" id="5904799">Name</span>&nbsp;<span class="op" id="5904804">+=</span>&nbsp;<span class="string" id="5904807">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5904812">case</span>&nbsp;<span class="ident" id="5904817">fm</span><span class="op" id="5904819">&amp;</span><span class="ident" id="5904820">os</span><span class="op" id="5904822">.</span><span class="ident" id="5904823">ModeSymlink</span>&nbsp;<span class="op" id="5904835">!=</span>&nbsp;<span class="num" id="5904838">0</span><span class="op" id="5904839">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904843">h</span><span class="op" id="5904844">.</span><span class="ident" id="5904845">Typeflag</span>&nbsp;<span class="op" id="5904854">=</span>&nbsp;<span class="ident" id="5904856">TypeSymlink</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904870">h</span><span class="op" id="5904871">.</span><span class="ident" id="5904872">Mode</span>&nbsp;<span class="op" id="5904877">|=</span>&nbsp;<span class="ident" id="5904880">c_ISLNK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904890">h</span><span class="op" id="5904891">.</span><span class="ident" id="5904892">Linkname</span>&nbsp;<span class="op" id="5904901">=</span>&nbsp;<span class="ident" id="5904903">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5904909">case</span>&nbsp;<span class="ident" id="5904914">fm</span><span class="op" id="5904916">&amp;</span><span class="ident" id="5904917">os</span><span class="op" id="5904919">.</span><span class="ident" id="5904920">ModeDevice</span>&nbsp;<span class="op" id="5904931">!=</span>&nbsp;<span class="num" id="5904934">0</span><span class="op" id="5904935">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5904939">if</span>&nbsp;<span class="ident" id="5904942">fm</span><span class="op" id="5904944">&amp;</span><span class="ident" id="5904945">os</span><span class="op" id="5904947">.</span><span class="ident" id="5904948">ModeCharDevice</span>&nbsp;<span class="op" id="5904963">!=</span>&nbsp;<span class="num" id="5904966">0</span>&nbsp;<span class="op" id="5904968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904973">h</span><span class="op" id="5904974">.</span><span class="ident" id="5904975">Mode</span>&nbsp;<span class="op" id="5904980">|=</span>&nbsp;<span class="ident" id="5904983">c_ISCHR</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904994">h</span><span class="op" id="5904995">.</span><span class="ident" id="5904996">Typeflag</span>&nbsp;<span class="op" id="5905005">=</span>&nbsp;<span class="ident" id="5905007">TypeChar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5905018">}</span>&nbsp;<span class="keyword" id="5905020">else</span>&nbsp;<span class="op" id="5905025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905030">h</span><span class="op" id="5905031">.</span><span class="ident" id="5905032">Mode</span>&nbsp;<span class="op" id="5905037">|=</span>&nbsp;<span class="ident" id="5905040">c_ISBLK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905051">h</span><span class="op" id="5905052">.</span><span class="ident" id="5905053">Typeflag</span>&nbsp;<span class="op" id="5905062">=</span>&nbsp;<span class="ident" id="5905064">TypeBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5905076">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5905079">case</span>&nbsp;<span class="ident" id="5905084">fm</span><span class="op" id="5905086">&amp;</span><span class="ident" id="5905087">os</span><span class="op" id="5905089">.</span><span class="ident" id="5905090">ModeNamedPipe</span>&nbsp;<span class="op" id="5905104">!=</span>&nbsp;<span class="num" id="5905107">0</span><span class="op" id="5905108">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905112">h</span><span class="op" id="5905113">.</span><span class="ident" id="5905114">Typeflag</span>&nbsp;<span class="op" id="5905123">=</span>&nbsp;<span class="ident" id="5905125">TypeFifo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905136">h</span><span class="op" id="5905137">.</span><span class="ident" id="5905138">Mode</span>&nbsp;<span class="op" id="5905143">|=</span>&nbsp;<span class="ident" id="5905146">c_ISFIFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5905156">case</span>&nbsp;<span class="ident" id="5905161">fm</span><span class="op" id="5905163">&amp;</span><span class="ident" id="5905164">os</span><span class="op" id="5905166">.</span><span class="ident" id="5905167">ModeSocket</span>&nbsp;<span class="op" id="5905178">!=</span>&nbsp;<span class="num" id="5905181">0</span><span class="op" id="5905182">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905186">h</span><span class="op" id="5905187">.</span><span class="ident" id="5905188">Mode</span>&nbsp;<span class="op" id="5905193">|=</span>&nbsp;<span class="ident" id="5905196">c_ISSOCK</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5905206">default</span><span class="op" id="5905213">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5905217">return</span>&nbsp;<span class="ident" id="5905224">nil</span><span class="op" id="5905227">,</span>&nbsp;<span class="ident" id="5905229">fmt</span><span class="op" id="5905232">.</span><span class="ident" id="5905233">Errorf</span><span class="op" id="5905239">(</span><span class="string" id="5905240">&#34;archive/tar:&nbsp;unknown&nbsp;file&nbsp;mode&nbsp;%v&#34;</span><span class="op" id="5905275">,</span>&nbsp;<span class="ident" id="5905277">fm</span><span class="op" id="5905279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5905282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5905285">if</span>&nbsp;<span class="ident" id="5905288">fm</span><span class="op" id="5905290">&amp;</span><span class="ident" id="5905291">os</span><span class="op" id="5905293">.</span><span class="ident" id="5905294">ModeSetuid</span>&nbsp;<span class="op" id="5905305">!=</span>&nbsp;<span class="num" id="5905308">0</span>&nbsp;<span class="op" id="5905310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905314">h</span><span class="op" id="5905315">.</span><span class="ident" id="5905316">Mode</span>&nbsp;<span class="op" id="5905321">|=</span>&nbsp;<span class="ident" id="5905324">c_ISUID</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5905333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5905336">if</span>&nbsp;<span class="ident" id="5905339">fm</span><span class="op" id="5905341">&amp;</span><span class="ident" id="5905342">os</span><span class="op" id="5905344">.</span><span class="ident" id="5905345">ModeSetgid</span>&nbsp;<span class="op" id="5905356">!=</span>&nbsp;<span class="num" id="5905359">0</span>&nbsp;<span class="op" id="5905361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905365">h</span><span class="op" id="5905366">.</span><span class="ident" id="5905367">Mode</span>&nbsp;<span class="op" id="5905372">|=</span>&nbsp;<span class="ident" id="5905375">c_ISGID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5905384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5905387">if</span>&nbsp;<span class="ident" id="5905390">fm</span><span class="op" id="5905392">&amp;</span><span class="ident" id="5905393">os</span><span class="op" id="5905395">.</span><span class="ident" id="5905396">ModeSticky</span>&nbsp;<span class="op" id="5905407">!=</span>&nbsp;<span class="num" id="5905410">0</span>&nbsp;<span class="op" id="5905412">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905416">h</span><span class="op" id="5905417">.</span><span class="ident" id="5905418">Mode</span>&nbsp;<span class="op" id="5905423">|=</span>&nbsp;<span class="ident" id="5905426">c_ISVTX</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5905435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5905438">if</span>&nbsp;<span class="ident" id="5905441">sysStat</span>&nbsp;<span class="op" id="5905449">!=</span>&nbsp;<span class="ident" id="5905452">nil</span>&nbsp;<span class="op" id="5905456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5905460">return</span>&nbsp;<span class="ident" id="5905467">h</span><span class="op" id="5905468">,</span>&nbsp;<span class="ident" id="5905470">sysStat</span><span class="op" id="5905477">(</span><span class="ident" id="5905478">fi</span><span class="op" id="5905480">,</span>&nbsp;<span class="ident" id="5905482">h</span><span class="op" id="5905483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5905486">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5905489">return</span>&nbsp;<span class="ident" id="5905496">h</span><span class="op" id="5905497">,</span>&nbsp;<span class="ident" id="5905499">nil</span><br>
<span class="lineno"></span><span class="op" id="5905503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5905506">var</span>&nbsp;<span class="ident" id="5905510">zeroBlock</span>&nbsp;<span class="op" id="5905520">=</span>&nbsp;<span class="builtinfunc" id="5905522">make</span><span class="op" id="5905526">(</span><span class="op" id="5905527">[</span><span class="op" id="5905528">]</span><span class="builtintype" id="5905529">byte</span><span class="op" id="5905533">,</span>&nbsp;<span class="ident" id="5905535">blockSize</span><span class="op" id="5905544">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="5905547">//&nbsp;POSIX&nbsp;specifies&nbsp;a&nbsp;sum&nbsp;of&nbsp;the&nbsp;unsigned&nbsp;byte&nbsp;values,&nbsp;but&nbsp;the&nbsp;Sun&nbsp;tar&nbsp;uses&nbsp;signed&nbsp;byte&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="5905642">//&nbsp;We&nbsp;compute&nbsp;and&nbsp;return&nbsp;both.</span><br>
<span class="lineno"></span><span class="keyword" id="5905673">func</span>&nbsp;<span class="ident" id="5905678">checksum</span><span class="op" id="5905686">(</span><span class="ident" id="5905687">header</span>&nbsp;<span class="op" id="5905694">[</span><span class="op" id="5905695">]</span><span class="builtintype" id="5905696">byte</span><span class="op" id="5905700">)</span>&nbsp;<span class="op" id="5905702">(</span><span class="ident" id="5905703">unsigned</span>&nbsp;<span class="ident" id="5905712">int64</span><span class="op" id="5905717">,</span>&nbsp;<span class="ident" id="5905719">signed</span>&nbsp;<span class="ident" id="5905726">int64</span><span class="op" id="5905731">)</span>&nbsp;<span class="op" id="5905733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5905736">for</span>&nbsp;<span class="ident" id="5905740">i</span>&nbsp;<span class="op" id="5905742">:=</span>&nbsp;<span class="num" id="5905745">0</span><span class="op" id="5905746">;</span>&nbsp;<span class="ident" id="5905748">i</span>&nbsp;<span class="op" id="5905750">&lt;</span>&nbsp;<span class="builtinfunc" id="5905752">len</span><span class="op" id="5905755">(</span><span class="ident" id="5905756">header</span><span class="op" id="5905762">)</span><span class="op" id="5905763">;</span>&nbsp;<span class="ident" id="5905765">i</span><span class="op" id="5905766">++</span>&nbsp;<span class="op" id="5905769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5905773">if</span>&nbsp;<span class="ident" id="5905776">i</span>&nbsp;<span class="op" id="5905778">==</span>&nbsp;<span class="num" id="5905781">148</span>&nbsp;<span class="op" id="5905785">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5905790">//&nbsp;The&nbsp;chksum&nbsp;field&nbsp;(header[148:156])&nbsp;is&nbsp;special:&nbsp;it&nbsp;should&nbsp;be&nbsp;treated&nbsp;as&nbsp;space&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905880">unsigned</span>&nbsp;<span class="op" id="5905889">+=</span>&nbsp;<span class="string" id="5905892">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5905896">*</span>&nbsp;<span class="num" id="5905898">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905903">signed</span>&nbsp;<span class="op" id="5905910">+=</span>&nbsp;<span class="string" id="5905913">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5905917">*</span>&nbsp;<span class="num" id="5905919">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905924">i</span>&nbsp;<span class="op" id="5905926">+=</span>&nbsp;<span class="num" id="5905929">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5905934">continue</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5905945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905949">unsigned</span>&nbsp;<span class="op" id="5905958">+=</span>&nbsp;<span class="ident" id="5905961">int64</span><span class="op" id="5905966">(</span><span class="ident" id="5905967">header</span><span class="op" id="5905973">[</span><span class="ident" id="5905974">i</span><span class="op" id="5905975">]</span><span class="op" id="5905976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905980">signed</span>&nbsp;<span class="op" id="5905987">+=</span>&nbsp;<span class="ident" id="5905990">int64</span><span class="op" id="5905995">(</span><span class="builtintype" id="5905996">int8</span><span class="op" id="5906000">(</span><span class="ident" id="5906001">header</span><span class="op" id="5906007">[</span><span class="ident" id="5906008">i</span><span class="op" id="5906009">]</span><span class="op" id="5906010">)</span><span class="op" id="5906011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5906014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906017">return</span><br>
<span class="lineno">275</span><span class="op" id="5906024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5906027">type</span>&nbsp;<span class="ident" id="5906032">slicer</span>&nbsp;<span class="op" id="5906039">[</span><span class="op" id="5906040">]</span><span class="builtintype" id="5906041">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5906047">func</span>&nbsp;<span class="op" id="5906052">(</span><span class="ident" id="5906053">sp</span>&nbsp;<span class="op" id="5906056">*</span><span class="ident" id="5906057">slicer</span><span class="op" id="5906063">)</span>&nbsp;<span class="ident" id="5906065">next</span><span class="op" id="5906069">(</span><span class="ident" id="5906070">n</span>&nbsp;<span class="builtintype" id="5906072">int</span><span class="op" id="5906075">)</span>&nbsp;<span class="op" id="5906077">(</span><span class="ident" id="5906078">b</span>&nbsp;<span class="op" id="5906080">[</span><span class="op" id="5906081">]</span><span class="builtintype" id="5906082">byte</span><span class="op" id="5906086">)</span>&nbsp;<span class="op" id="5906088">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906091">s</span>&nbsp;<span class="op" id="5906093">:=</span>&nbsp;<span class="op" id="5906096">*</span><span class="ident" id="5906097">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906101">b</span><span class="op" id="5906102">,</span>&nbsp;<span class="op" id="5906104">*</span><span class="ident" id="5906105">sp</span>&nbsp;<span class="op" id="5906108">=</span>&nbsp;<span class="ident" id="5906110">s</span><span class="op" id="5906111">[</span><span class="num" id="5906112">0</span><span class="op" id="5906113">:</span><span class="ident" id="5906114">n</span><span class="op" id="5906115">]</span><span class="op" id="5906116">,</span>&nbsp;<span class="ident" id="5906118">s</span><span class="op" id="5906119">[</span><span class="ident" id="5906120">n</span><span class="op" id="5906121">:</span><span class="op" id="5906122">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906125">return</span><br>
<span class="lineno"></span><span class="op" id="5906132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="5906135">func</span>&nbsp;<span class="ident" id="5906140">isASCII</span><span class="op" id="5906147">(</span><span class="ident" id="5906148">s</span>&nbsp;<span class="builtintype" id="5906150">string</span><span class="op" id="5906156">)</span>&nbsp;<span class="builtintype" id="5906158">bool</span>&nbsp;<span class="op" id="5906163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906166">for</span>&nbsp;<span class="ident" id="5906170">_</span><span class="op" id="5906171">,</span>&nbsp;<span class="ident" id="5906173">c</span>&nbsp;<span class="op" id="5906175">:=</span>&nbsp;<span class="keyword" id="5906178">range</span>&nbsp;<span class="ident" id="5906184">s</span>&nbsp;<span class="op" id="5906186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906190">if</span>&nbsp;<span class="ident" id="5906193">c</span>&nbsp;<span class="op" id="5906195">&gt;=</span>&nbsp;<span class="num" id="5906198">0x80</span>&nbsp;<span class="op" id="5906203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906208">return</span>&nbsp;<span class="builtintype" id="5906215">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5906223">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5906226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906229">return</span>&nbsp;<span class="builtintype" id="5906236">true</span><br>
<span class="lineno"></span><span class="op" id="5906241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5906244">func</span>&nbsp;<span class="ident" id="5906249">toASCII</span><span class="op" id="5906256">(</span><span class="ident" id="5906257">s</span>&nbsp;<span class="builtintype" id="5906259">string</span><span class="op" id="5906265">)</span>&nbsp;<span class="builtintype" id="5906267">string</span>&nbsp;<span class="op" id="5906274">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906277">if</span>&nbsp;<span class="ident" id="5906280">isASCII</span><span class="op" id="5906287">(</span><span class="ident" id="5906288">s</span><span class="op" id="5906289">)</span>&nbsp;<span class="op" id="5906291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906295">return</span>&nbsp;<span class="ident" id="5906302">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5906305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906308">var</span>&nbsp;<span class="ident" id="5906312">buf</span>&nbsp;<span class="ident" id="5906316">bytes</span><span class="op" id="5906321">.</span><span class="ident" id="5906322">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906330">for</span>&nbsp;<span class="ident" id="5906334">_</span><span class="op" id="5906335">,</span>&nbsp;<span class="ident" id="5906337">c</span>&nbsp;<span class="op" id="5906339">:=</span>&nbsp;<span class="keyword" id="5906342">range</span>&nbsp;<span class="ident" id="5906348">s</span>&nbsp;<span class="op" id="5906350">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906354">if</span>&nbsp;<span class="ident" id="5906357">c</span>&nbsp;<span class="op" id="5906359">&lt;</span>&nbsp;<span class="num" id="5906361">0x80</span>&nbsp;<span class="op" id="5906366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906371">buf</span><span class="op" id="5906374">.</span><span class="ident" id="5906375">WriteByte</span><span class="op" id="5906384">(</span><span class="builtintype" id="5906385">byte</span><span class="op" id="5906389">(</span><span class="ident" id="5906390">c</span><span class="op" id="5906391">)</span><span class="op" id="5906392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5906396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5906399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906402">return</span>&nbsp;<span class="ident" id="5906409">buf</span><span class="op" id="5906412">.</span><span class="ident" id="5906413">String</span><span class="op" id="5906419">(</span><span class="op" id="5906420">)</span><br>
<span class="lineno">305</span><span class="op" id="5906422">}</span>
</div>
</body>
</html>
