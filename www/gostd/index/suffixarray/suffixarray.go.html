<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>index/suffixarray</h2>
<ul>
<li><a href="/gostd/index/suffixarray/qsufsort.go.html">qsufsort.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray.go.html" class="current">suffixarray.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray_test.go.html">suffixarray_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5815997">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5816052">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5816106">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5816157">//&nbsp;Package&nbsp;suffixarray&nbsp;implements&nbsp;substring&nbsp;search&nbsp;in&nbsp;logarithmic&nbsp;time&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="5816234">//&nbsp;an&nbsp;in-memory&nbsp;suffix&nbsp;array.</span><br>
<span class="lineno"></span><span class="comment" id="5816264">//</span><br>
<span class="lineno"></span><span class="comment" id="5816267">//&nbsp;Example&nbsp;use:</span><br>
<span class="lineno"></span><span class="comment" id="5816283">//</span><br>
<span class="lineno">10</span><span class="comment" id="5816286">//&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;create&nbsp;index&nbsp;for&nbsp;some&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="5816319">//&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;:=&nbsp;suffixarray.New(data)</span><br>
<span class="lineno"></span><span class="comment" id="5816353">//</span><br>
<span class="lineno"></span><span class="comment" id="5816356">//&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;lookup&nbsp;byte&nbsp;slice&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="5816382">//&nbsp;&nbsp;&nbsp;&nbsp;offsets1&nbsp;:=&nbsp;index.Lookup(s,&nbsp;-1)&nbsp;//&nbsp;the&nbsp;list&nbsp;of&nbsp;all&nbsp;indices&nbsp;where&nbsp;s&nbsp;occurs&nbsp;in&nbsp;data</span><br>
<span class="lineno">15</span><span class="comment" id="5816467">//&nbsp;&nbsp;&nbsp;&nbsp;offsets2&nbsp;:=&nbsp;index.Lookup(s,&nbsp;3)&nbsp;&nbsp;//&nbsp;the&nbsp;list&nbsp;of&nbsp;at&nbsp;most&nbsp;3&nbsp;indices&nbsp;where&nbsp;s&nbsp;occurs&nbsp;in&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="5816558">//</span><br>
<span class="lineno"></span><span class="keyword" id="5816561">package</span>&nbsp;<span class="ident" id="5816569">suffixarray</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5816582">import</span>&nbsp;<span class="op" id="5816589">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5816592">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5816601">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5816620">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5816626">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5816636">&#34;sort&#34;</span><br>
<span class="lineno">25</span><span class="op" id="5816643">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5816646">//&nbsp;Index&nbsp;implements&nbsp;a&nbsp;suffix&nbsp;array&nbsp;for&nbsp;fast&nbsp;substring&nbsp;search.</span><br>
<span class="lineno"></span><span class="keyword" id="5816708">type</span>&nbsp;<span class="ident" id="5816713">Index</span>&nbsp;<span class="keyword" id="5816719">struct</span>&nbsp;<span class="op" id="5816726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5816729">data</span>&nbsp;<span class="op" id="5816734">[</span><span class="op" id="5816735">]</span><span class="builtintype" id="5816736">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5816742">sa</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5816747">[</span><span class="op" id="5816748">]</span><span class="builtintype" id="5816749">int</span>&nbsp;<span class="comment" id="5816753">//&nbsp;suffix&nbsp;array&nbsp;for&nbsp;data;&nbsp;len(sa)&nbsp;==&nbsp;len(data)</span><br>
<span class="lineno"></span><span class="op" id="5816800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5816803">//&nbsp;New&nbsp;creates&nbsp;a&nbsp;new&nbsp;Index&nbsp;for&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="5816840">//&nbsp;Index&nbsp;creation&nbsp;time&nbsp;is&nbsp;O(N*log(N))&nbsp;for&nbsp;N&nbsp;=&nbsp;len(data).</span><br>
<span class="lineno">35</span><span class="keyword" id="5816897">func</span>&nbsp;<span class="ident" id="5816902">New</span><span class="op" id="5816905">(</span><span class="ident" id="5816906">data</span>&nbsp;<span class="op" id="5816911">[</span><span class="op" id="5816912">]</span><span class="builtintype" id="5816913">byte</span><span class="op" id="5816917">)</span>&nbsp;<span class="op" id="5816919">*</span><span class="ident" id="5816920">Index</span>&nbsp;<span class="op" id="5816926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5816929">return</span>&nbsp;<span class="op" id="5816936">&amp;</span><span class="ident" id="5816937">Index</span><span class="op" id="5816942">{</span><span class="ident" id="5816943">data</span><span class="op" id="5816947">,</span>&nbsp;<span class="ident" id="5816949">qsufsort</span><span class="op" id="5816957">(</span><span class="ident" id="5816958">data</span><span class="op" id="5816962">)</span><span class="op" id="5816963">}</span><br>
<span class="lineno"></span><span class="op" id="5816965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5816968">//&nbsp;writeInt&nbsp;writes&nbsp;an&nbsp;int&nbsp;x&nbsp;to&nbsp;w&nbsp;using&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;write.</span><br>
<span class="lineno">40</span><span class="keyword" id="5817032">func</span>&nbsp;<span class="ident" id="5817037">writeInt</span><span class="op" id="5817045">(</span><span class="ident" id="5817046">w</span>&nbsp;<span class="ident" id="5817048">io</span><span class="op" id="5817050">.</span><span class="ident" id="5817051">Writer</span><span class="op" id="5817057">,</span>&nbsp;<span class="ident" id="5817059">buf</span>&nbsp;<span class="op" id="5817063">[</span><span class="op" id="5817064">]</span><span class="builtintype" id="5817065">byte</span><span class="op" id="5817069">,</span>&nbsp;<span class="ident" id="5817071">x</span>&nbsp;<span class="builtintype" id="5817073">int</span><span class="op" id="5817076">)</span>&nbsp;<span class="builtintype" id="5817078">error</span>&nbsp;<span class="op" id="5817084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5817087">binary</span><span class="op" id="5817093">.</span><span class="ident" id="5817094">PutVarint</span><span class="op" id="5817103">(</span><span class="ident" id="5817104">buf</span><span class="op" id="5817107">,</span>&nbsp;<span class="builtintype" id="5817109">int64</span><span class="op" id="5817114">(</span><span class="ident" id="5817115">x</span><span class="op" id="5817116">)</span><span class="op" id="5817117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5817120">_</span><span class="op" id="5817121">,</span>&nbsp;<span class="ident" id="5817123">err</span>&nbsp;<span class="op" id="5817127">:=</span>&nbsp;<span class="ident" id="5817130">w</span><span class="op" id="5817131">.</span><span class="ident" id="5817132">Write</span><span class="op" id="5817137">(</span><span class="ident" id="5817138">buf</span><span class="op" id="5817141">[</span><span class="num" id="5817142">0</span><span class="op" id="5817143">:</span><span class="ident" id="5817144">binary</span><span class="op" id="5817150">.</span><span class="ident" id="5817151">MaxVarintLen64</span><span class="op" id="5817165">]</span><span class="op" id="5817166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5817169">return</span>&nbsp;<span class="ident" id="5817176">err</span><br>
<span class="lineno"></span><span class="op" id="5817180">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5817183">//&nbsp;readInt&nbsp;reads&nbsp;an&nbsp;int&nbsp;x&nbsp;from&nbsp;r&nbsp;using&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;read&nbsp;and&nbsp;returns&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="5817260">func</span>&nbsp;<span class="ident" id="5817265">readInt</span><span class="op" id="5817272">(</span><span class="ident" id="5817273">r</span>&nbsp;<span class="ident" id="5817275">io</span><span class="op" id="5817277">.</span><span class="ident" id="5817278">Reader</span><span class="op" id="5817284">,</span>&nbsp;<span class="ident" id="5817286">buf</span>&nbsp;<span class="op" id="5817290">[</span><span class="op" id="5817291">]</span><span class="builtintype" id="5817292">byte</span><span class="op" id="5817296">)</span>&nbsp;<span class="op" id="5817298">(</span><span class="builtintype" id="5817299">int</span><span class="op" id="5817302">,</span>&nbsp;<span class="builtintype" id="5817304">error</span><span class="op" id="5817309">)</span>&nbsp;<span class="op" id="5817311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5817314">_</span><span class="op" id="5817315">,</span>&nbsp;<span class="ident" id="5817317">err</span>&nbsp;<span class="op" id="5817321">:=</span>&nbsp;<span class="ident" id="5817324">io</span><span class="op" id="5817326">.</span><span class="ident" id="5817327">ReadFull</span><span class="op" id="5817335">(</span><span class="ident" id="5817336">r</span><span class="op" id="5817337">,</span>&nbsp;<span class="ident" id="5817339">buf</span><span class="op" id="5817342">[</span><span class="num" id="5817343">0</span><span class="op" id="5817344">:</span><span class="ident" id="5817345">binary</span><span class="op" id="5817351">.</span><span class="ident" id="5817352">MaxVarintLen64</span><span class="op" id="5817366">]</span><span class="op" id="5817367">)</span>&nbsp;<span class="comment" id="5817369">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;with&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5817399">x</span><span class="op" id="5817400">,</span>&nbsp;<span class="ident" id="5817402">_</span>&nbsp;<span class="op" id="5817404">:=</span>&nbsp;<span class="ident" id="5817407">binary</span><span class="op" id="5817413">.</span><span class="ident" id="5817414">Varint</span><span class="op" id="5817420">(</span><span class="ident" id="5817421">buf</span><span class="op" id="5817424">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5817427">return</span>&nbsp;<span class="builtintype" id="5817434">int</span><span class="op" id="5817437">(</span><span class="ident" id="5817438">x</span><span class="op" id="5817439">)</span><span class="op" id="5817440">,</span>&nbsp;<span class="ident" id="5817442">err</span><br>
<span class="lineno"></span><span class="op" id="5817446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5817449">//&nbsp;writeSlice&nbsp;writes&nbsp;data[:n]&nbsp;to&nbsp;w&nbsp;and&nbsp;returns&nbsp;n.</span><br>
<span class="lineno"></span><span class="comment" id="5817499">//&nbsp;It&nbsp;uses&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;write.</span><br>
<span class="lineno">55</span><span class="keyword" id="5817535">func</span>&nbsp;<span class="ident" id="5817540">writeSlice</span><span class="op" id="5817550">(</span><span class="ident" id="5817551">w</span>&nbsp;<span class="ident" id="5817553">io</span><span class="op" id="5817555">.</span><span class="ident" id="5817556">Writer</span><span class="op" id="5817562">,</span>&nbsp;<span class="ident" id="5817564">buf</span>&nbsp;<span class="op" id="5817568">[</span><span class="op" id="5817569">]</span><span class="builtintype" id="5817570">byte</span><span class="op" id="5817574">,</span>&nbsp;<span class="ident" id="5817576">data</span>&nbsp;<span class="op" id="5817581">[</span><span class="op" id="5817582">]</span><span class="builtintype" id="5817583">int</span><span class="op" id="5817586">)</span>&nbsp;<span class="op" id="5817588">(</span><span class="ident" id="5817589">n</span>&nbsp;<span class="builtintype" id="5817591">int</span><span class="op" id="5817594">,</span>&nbsp;<span class="ident" id="5817596">err</span>&nbsp;<span class="builtintype" id="5817600">error</span><span class="op" id="5817605">)</span>&nbsp;<span class="op" id="5817607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5817610">//&nbsp;encode&nbsp;as&nbsp;many&nbsp;elements&nbsp;as&nbsp;fit&nbsp;into&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5817654">p</span>&nbsp;<span class="op" id="5817656">:=</span>&nbsp;<span class="ident" id="5817659">binary</span><span class="op" id="5817665">.</span><span class="ident" id="5817666">MaxVarintLen64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5817682">for</span>&nbsp;<span class="op" id="5817686">;</span>&nbsp;<span class="ident" id="5817688">n</span>&nbsp;<span class="op" id="5817690">&lt;</span>&nbsp;<span class="builtinfunc" id="5817692">len</span><span class="op" id="5817695">(</span><span class="ident" id="5817696">data</span><span class="op" id="5817700">)</span>&nbsp;<span class="op" id="5817702">&amp;&amp;</span>&nbsp;<span class="ident" id="5817705">p</span><span class="op" id="5817706">+</span><span class="ident" id="5817707">binary</span><span class="op" id="5817713">.</span><span class="ident" id="5817714">MaxVarintLen64</span>&nbsp;<span class="op" id="5817729">&lt;=</span>&nbsp;<span class="builtinfunc" id="5817732">len</span><span class="op" id="5817735">(</span><span class="ident" id="5817736">buf</span><span class="op" id="5817739">)</span><span class="op" id="5817740">;</span>&nbsp;<span class="ident" id="5817742">n</span><span class="op" id="5817743">++</span>&nbsp;<span class="op" id="5817746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5817750">p</span>&nbsp;<span class="op" id="5817752">+=</span>&nbsp;<span class="ident" id="5817755">binary</span><span class="op" id="5817761">.</span><span class="ident" id="5817762">PutUvarint</span><span class="op" id="5817772">(</span><span class="ident" id="5817773">buf</span><span class="op" id="5817776">[</span><span class="ident" id="5817777">p</span><span class="op" id="5817778">:</span><span class="op" id="5817779">]</span><span class="op" id="5817780">,</span>&nbsp;<span class="builtintype" id="5817782">uint64</span><span class="op" id="5817788">(</span><span class="ident" id="5817789">data</span><span class="op" id="5817793">[</span><span class="ident" id="5817794">n</span><span class="op" id="5817795">]</span><span class="op" id="5817796">)</span><span class="op" id="5817797">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5817800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5817804">//&nbsp;update&nbsp;buffer&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5817827">binary</span><span class="op" id="5817833">.</span><span class="ident" id="5817834">PutVarint</span><span class="op" id="5817843">(</span><span class="ident" id="5817844">buf</span><span class="op" id="5817847">,</span>&nbsp;<span class="builtintype" id="5817849">int64</span><span class="op" id="5817854">(</span><span class="ident" id="5817855">p</span><span class="op" id="5817856">)</span><span class="op" id="5817857">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5817861">//&nbsp;write&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5817878">_</span><span class="op" id="5817879">,</span>&nbsp;<span class="ident" id="5817881">err</span>&nbsp;<span class="op" id="5817885">=</span>&nbsp;<span class="ident" id="5817887">w</span><span class="op" id="5817888">.</span><span class="ident" id="5817889">Write</span><span class="op" id="5817894">(</span><span class="ident" id="5817895">buf</span><span class="op" id="5817898">[</span><span class="num" id="5817899">0</span><span class="op" id="5817900">:</span><span class="ident" id="5817901">p</span><span class="op" id="5817902">]</span><span class="op" id="5817903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5817906">return</span><br>
<span class="lineno"></span><span class="op" id="5817913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="5817916">//&nbsp;readSlice&nbsp;reads&nbsp;data[:n]&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;n.</span><br>
<span class="lineno"></span><span class="comment" id="5817966">//&nbsp;It&nbsp;uses&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;read.</span><br>
<span class="lineno"></span><span class="keyword" id="5818001">func</span>&nbsp;<span class="ident" id="5818006">readSlice</span><span class="op" id="5818015">(</span><span class="ident" id="5818016">r</span>&nbsp;<span class="ident" id="5818018">io</span><span class="op" id="5818020">.</span><span class="ident" id="5818021">Reader</span><span class="op" id="5818027">,</span>&nbsp;<span class="ident" id="5818029">buf</span>&nbsp;<span class="op" id="5818033">[</span><span class="op" id="5818034">]</span><span class="builtintype" id="5818035">byte</span><span class="op" id="5818039">,</span>&nbsp;<span class="ident" id="5818041">data</span>&nbsp;<span class="op" id="5818046">[</span><span class="op" id="5818047">]</span><span class="builtintype" id="5818048">int</span><span class="op" id="5818051">)</span>&nbsp;<span class="op" id="5818053">(</span><span class="ident" id="5818054">n</span>&nbsp;<span class="builtintype" id="5818056">int</span><span class="op" id="5818059">,</span>&nbsp;<span class="ident" id="5818061">err</span>&nbsp;<span class="builtintype" id="5818065">error</span><span class="op" id="5818070">)</span>&nbsp;<span class="op" id="5818072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5818075">//&nbsp;read&nbsp;buffer&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5818096">var</span>&nbsp;<span class="ident" id="5818100">size</span>&nbsp;<span class="builtintype" id="5818105">int</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5818110">size</span><span class="op" id="5818114">,</span>&nbsp;<span class="ident" id="5818116">err</span>&nbsp;<span class="op" id="5818120">=</span>&nbsp;<span class="ident" id="5818122">readInt</span><span class="op" id="5818129">(</span><span class="ident" id="5818130">r</span><span class="op" id="5818131">,</span>&nbsp;<span class="ident" id="5818133">buf</span><span class="op" id="5818136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5818139">if</span>&nbsp;<span class="ident" id="5818142">err</span>&nbsp;<span class="op" id="5818146">!=</span>&nbsp;<span class="builtintype" id="5818149">nil</span>&nbsp;<span class="op" id="5818153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5818157">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5818165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5818169">//&nbsp;read&nbsp;buffer&nbsp;w/o&nbsp;the&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5818198">if</span>&nbsp;<span class="ident" id="5818201">_</span><span class="op" id="5818202">,</span>&nbsp;<span class="ident" id="5818204">err</span>&nbsp;<span class="op" id="5818208">=</span>&nbsp;<span class="ident" id="5818210">io</span><span class="op" id="5818212">.</span><span class="ident" id="5818213">ReadFull</span><span class="op" id="5818221">(</span><span class="ident" id="5818222">r</span><span class="op" id="5818223">,</span>&nbsp;<span class="ident" id="5818225">buf</span><span class="op" id="5818228">[</span><span class="ident" id="5818229">binary</span><span class="op" id="5818235">.</span><span class="ident" id="5818236">MaxVarintLen64</span><span class="op" id="5818250">:</span><span class="ident" id="5818251">size</span><span class="op" id="5818255">]</span><span class="op" id="5818256">)</span><span class="op" id="5818257">;</span>&nbsp;<span class="ident" id="5818259">err</span>&nbsp;<span class="op" id="5818263">!=</span>&nbsp;<span class="builtintype" id="5818266">nil</span>&nbsp;<span class="op" id="5818270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5818274">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5818282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5818286">//&nbsp;decode&nbsp;as&nbsp;many&nbsp;elements&nbsp;as&nbsp;present&nbsp;in&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5818332">for</span>&nbsp;<span class="ident" id="5818336">p</span>&nbsp;<span class="op" id="5818338">:=</span>&nbsp;<span class="ident" id="5818341">binary</span><span class="op" id="5818347">.</span><span class="ident" id="5818348">MaxVarintLen64</span><span class="op" id="5818362">;</span>&nbsp;<span class="ident" id="5818364">p</span>&nbsp;<span class="op" id="5818366">&lt;</span>&nbsp;<span class="ident" id="5818368">size</span><span class="op" id="5818372">;</span>&nbsp;<span class="ident" id="5818374">n</span><span class="op" id="5818375">++</span>&nbsp;<span class="op" id="5818378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5818382">x</span><span class="op" id="5818383">,</span>&nbsp;<span class="ident" id="5818385">w</span>&nbsp;<span class="op" id="5818387">:=</span>&nbsp;<span class="ident" id="5818390">binary</span><span class="op" id="5818396">.</span><span class="ident" id="5818397">Uvarint</span><span class="op" id="5818404">(</span><span class="ident" id="5818405">buf</span><span class="op" id="5818408">[</span><span class="ident" id="5818409">p</span><span class="op" id="5818410">:</span><span class="op" id="5818411">]</span><span class="op" id="5818412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5818416">data</span><span class="op" id="5818420">[</span><span class="ident" id="5818421">n</span><span class="op" id="5818422">]</span>&nbsp;<span class="op" id="5818424">=</span>&nbsp;<span class="builtintype" id="5818426">int</span><span class="op" id="5818429">(</span><span class="ident" id="5818430">x</span><span class="op" id="5818431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5818435">p</span>&nbsp;<span class="op" id="5818437">+=</span>&nbsp;<span class="ident" id="5818440">w</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5818443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5818447">return</span><br>
<span class="lineno"></span><span class="op" id="5818454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5818457">const</span>&nbsp;<span class="ident" id="5818463">bufSize</span>&nbsp;<span class="op" id="5818471">=</span>&nbsp;<span class="num" id="5818473">16</span>&nbsp;<span class="op" id="5818476">&lt;&lt;</span>&nbsp;<span class="num" id="5818479">10</span>&nbsp;<span class="comment" id="5818482">//&nbsp;reasonable&nbsp;for&nbsp;BenchmarkSaveRestore</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5818522">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;index&nbsp;from&nbsp;r&nbsp;into&nbsp;x;&nbsp;x&nbsp;must&nbsp;not&nbsp;be&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="5818580">func</span>&nbsp;<span class="op" id="5818585">(</span><span class="ident" id="5818586">x</span>&nbsp;<span class="op" id="5818588">*</span><span class="ident" id="5818589">Index</span><span class="op" id="5818594">)</span>&nbsp;<span class="ident" id="5818596">Read</span><span class="op" id="5818600">(</span><span class="ident" id="5818601">r</span>&nbsp;<span class="ident" id="5818603">io</span><span class="op" id="5818605">.</span><span class="ident" id="5818606">Reader</span><span class="op" id="5818612">)</span>&nbsp;<span class="builtintype" id="5818614">error</span>&nbsp;<span class="op" id="5818620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5818623">//&nbsp;buffer&nbsp;for&nbsp;all&nbsp;reads</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5818648">buf</span>&nbsp;<span class="op" id="5818652">:=</span>&nbsp;<span class="builtinfunc" id="5818655">make</span><span class="op" id="5818659">(</span><span class="op" id="5818660">[</span><span class="op" id="5818661">]</span><span class="builtintype" id="5818662">byte</span><span class="op" id="5818666">,</span>&nbsp;<span class="ident" id="5818668">bufSize</span><span class="op" id="5818675">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5818679">//&nbsp;read&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5818695">n</span><span class="op" id="5818696">,</span>&nbsp;<span class="ident" id="5818698">err</span>&nbsp;<span class="op" id="5818702">:=</span>&nbsp;<span class="ident" id="5818705">readInt</span><span class="op" id="5818712">(</span><span class="ident" id="5818713">r</span><span class="op" id="5818714">,</span>&nbsp;<span class="ident" id="5818716">buf</span><span class="op" id="5818719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5818722">if</span>&nbsp;<span class="ident" id="5818725">err</span>&nbsp;<span class="op" id="5818729">!=</span>&nbsp;<span class="builtintype" id="5818732">nil</span>&nbsp;<span class="op" id="5818736">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5818740">return</span>&nbsp;<span class="ident" id="5818747">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5818752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5818756">//&nbsp;allocate&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5818775">if</span>&nbsp;<span class="num" id="5818778">2</span><span class="op" id="5818779">*</span><span class="ident" id="5818780">n</span>&nbsp;<span class="op" id="5818782">&lt;</span>&nbsp;<span class="builtinfunc" id="5818784">cap</span><span class="op" id="5818787">(</span><span class="ident" id="5818788">x</span><span class="op" id="5818789">.</span><span class="ident" id="5818790">data</span><span class="op" id="5818794">)</span>&nbsp;<span class="op" id="5818796">||</span>&nbsp;<span class="builtinfunc" id="5818799">cap</span><span class="op" id="5818802">(</span><span class="ident" id="5818803">x</span><span class="op" id="5818804">.</span><span class="ident" id="5818805">data</span><span class="op" id="5818809">)</span>&nbsp;<span class="op" id="5818811">&lt;</span>&nbsp;<span class="ident" id="5818813">n</span>&nbsp;<span class="op" id="5818815">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5818819">//&nbsp;new&nbsp;data&nbsp;is&nbsp;significantly&nbsp;smaller&nbsp;or&nbsp;larger&nbsp;then</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5818873">//&nbsp;existing&nbsp;buffers&nbsp;-&nbsp;allocate&nbsp;new&nbsp;ones</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5818915">x</span><span class="op" id="5818916">.</span><span class="ident" id="5818917">data</span>&nbsp;<span class="op" id="5818922">=</span>&nbsp;<span class="builtinfunc" id="5818924">make</span><span class="op" id="5818928">(</span><span class="op" id="5818929">[</span><span class="op" id="5818930">]</span><span class="builtintype" id="5818931">byte</span><span class="op" id="5818935">,</span>&nbsp;<span class="ident" id="5818937">n</span><span class="op" id="5818938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5818942">x</span><span class="op" id="5818943">.</span><span class="ident" id="5818944">sa</span>&nbsp;<span class="op" id="5818947">=</span>&nbsp;<span class="builtinfunc" id="5818949">make</span><span class="op" id="5818953">(</span><span class="op" id="5818954">[</span><span class="op" id="5818955">]</span><span class="builtintype" id="5818956">int</span><span class="op" id="5818959">,</span>&nbsp;<span class="ident" id="5818961">n</span><span class="op" id="5818962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5818965">}</span>&nbsp;<span class="keyword" id="5818967">else</span>&nbsp;<span class="op" id="5818972">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5818976">//&nbsp;re-use&nbsp;existing&nbsp;buffers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5819005">x</span><span class="op" id="5819006">.</span><span class="ident" id="5819007">data</span>&nbsp;<span class="op" id="5819012">=</span>&nbsp;<span class="ident" id="5819014">x</span><span class="op" id="5819015">.</span><span class="ident" id="5819016">data</span><span class="op" id="5819020">[</span><span class="num" id="5819021">0</span><span class="op" id="5819022">:</span><span class="ident" id="5819023">n</span><span class="op" id="5819024">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5819028">x</span><span class="op" id="5819029">.</span><span class="ident" id="5819030">sa</span>&nbsp;<span class="op" id="5819033">=</span>&nbsp;<span class="ident" id="5819035">x</span><span class="op" id="5819036">.</span><span class="ident" id="5819037">sa</span><span class="op" id="5819039">[</span><span class="num" id="5819040">0</span><span class="op" id="5819041">:</span><span class="ident" id="5819042">n</span><span class="op" id="5819043">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5819046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5819050">//&nbsp;read&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5819064">if</span>&nbsp;<span class="ident" id="5819067">_</span><span class="op" id="5819068">,</span>&nbsp;<span class="ident" id="5819070">err</span>&nbsp;<span class="op" id="5819074">:=</span>&nbsp;<span class="ident" id="5819077">io</span><span class="op" id="5819079">.</span><span class="ident" id="5819080">ReadFull</span><span class="op" id="5819088">(</span><span class="ident" id="5819089">r</span><span class="op" id="5819090">,</span>&nbsp;<span class="ident" id="5819092">x</span><span class="op" id="5819093">.</span><span class="ident" id="5819094">data</span><span class="op" id="5819098">)</span><span class="op" id="5819099">;</span>&nbsp;<span class="ident" id="5819101">err</span>&nbsp;<span class="op" id="5819105">!=</span>&nbsp;<span class="builtintype" id="5819108">nil</span>&nbsp;<span class="op" id="5819112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5819116">return</span>&nbsp;<span class="ident" id="5819123">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5819128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5819132">//&nbsp;read&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5819147">for</span>&nbsp;<span class="ident" id="5819151">sa</span>&nbsp;<span class="op" id="5819154">:=</span>&nbsp;<span class="ident" id="5819157">x</span><span class="op" id="5819158">.</span><span class="ident" id="5819159">sa</span><span class="op" id="5819161">;</span>&nbsp;<span class="builtinfunc" id="5819163">len</span><span class="op" id="5819166">(</span><span class="ident" id="5819167">sa</span><span class="op" id="5819169">)</span>&nbsp;<span class="op" id="5819171">&gt;</span>&nbsp;<span class="num" id="5819173">0</span><span class="op" id="5819174">;</span>&nbsp;<span class="op" id="5819176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5819180">n</span><span class="op" id="5819181">,</span>&nbsp;<span class="ident" id="5819183">err</span>&nbsp;<span class="op" id="5819187">:=</span>&nbsp;<span class="ident" id="5819190">readSlice</span><span class="op" id="5819199">(</span><span class="ident" id="5819200">r</span><span class="op" id="5819201">,</span>&nbsp;<span class="ident" id="5819203">buf</span><span class="op" id="5819206">,</span>&nbsp;<span class="ident" id="5819208">sa</span><span class="op" id="5819210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5819214">if</span>&nbsp;<span class="ident" id="5819217">err</span>&nbsp;<span class="op" id="5819221">!=</span>&nbsp;<span class="builtintype" id="5819224">nil</span>&nbsp;<span class="op" id="5819228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5819233">return</span>&nbsp;<span class="ident" id="5819240">err</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5819246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5819250">sa</span>&nbsp;<span class="op" id="5819253">=</span>&nbsp;<span class="ident" id="5819255">sa</span><span class="op" id="5819257">[</span><span class="ident" id="5819258">n</span><span class="op" id="5819259">:</span><span class="op" id="5819260">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5819263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5819266">return</span>&nbsp;<span class="builtintype" id="5819273">nil</span><br>
<span class="lineno"></span><span class="op" id="5819277">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="comment" id="5819280">//&nbsp;Write&nbsp;writes&nbsp;the&nbsp;index&nbsp;x&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5819314">func</span>&nbsp;<span class="op" id="5819319">(</span><span class="ident" id="5819320">x</span>&nbsp;<span class="op" id="5819322">*</span><span class="ident" id="5819323">Index</span><span class="op" id="5819328">)</span>&nbsp;<span class="ident" id="5819330">Write</span><span class="op" id="5819335">(</span><span class="ident" id="5819336">w</span>&nbsp;<span class="ident" id="5819338">io</span><span class="op" id="5819340">.</span><span class="ident" id="5819341">Writer</span><span class="op" id="5819347">)</span>&nbsp;<span class="builtintype" id="5819349">error</span>&nbsp;<span class="op" id="5819355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5819358">//&nbsp;buffer&nbsp;for&nbsp;all&nbsp;writes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5819384">buf</span>&nbsp;<span class="op" id="5819388">:=</span>&nbsp;<span class="builtinfunc" id="5819391">make</span><span class="op" id="5819395">(</span><span class="op" id="5819396">[</span><span class="op" id="5819397">]</span><span class="builtintype" id="5819398">byte</span><span class="op" id="5819402">,</span>&nbsp;<span class="ident" id="5819404">bufSize</span><span class="op" id="5819411">)</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5819415">//&nbsp;write&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5819432">if</span>&nbsp;<span class="ident" id="5819435">err</span>&nbsp;<span class="op" id="5819439">:=</span>&nbsp;<span class="ident" id="5819442">writeInt</span><span class="op" id="5819450">(</span><span class="ident" id="5819451">w</span><span class="op" id="5819452">,</span>&nbsp;<span class="ident" id="5819454">buf</span><span class="op" id="5819457">,</span>&nbsp;<span class="builtinfunc" id="5819459">len</span><span class="op" id="5819462">(</span><span class="ident" id="5819463">x</span><span class="op" id="5819464">.</span><span class="ident" id="5819465">data</span><span class="op" id="5819469">)</span><span class="op" id="5819470">)</span><span class="op" id="5819471">;</span>&nbsp;<span class="ident" id="5819473">err</span>&nbsp;<span class="op" id="5819477">!=</span>&nbsp;<span class="builtintype" id="5819480">nil</span>&nbsp;<span class="op" id="5819484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5819488">return</span>&nbsp;<span class="ident" id="5819495">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5819500">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5819504">//&nbsp;write&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5819519">if</span>&nbsp;<span class="ident" id="5819522">_</span><span class="op" id="5819523">,</span>&nbsp;<span class="ident" id="5819525">err</span>&nbsp;<span class="op" id="5819529">:=</span>&nbsp;<span class="ident" id="5819532">w</span><span class="op" id="5819533">.</span><span class="ident" id="5819534">Write</span><span class="op" id="5819539">(</span><span class="ident" id="5819540">x</span><span class="op" id="5819541">.</span><span class="ident" id="5819542">data</span><span class="op" id="5819546">)</span><span class="op" id="5819547">;</span>&nbsp;<span class="ident" id="5819549">err</span>&nbsp;<span class="op" id="5819553">!=</span>&nbsp;<span class="builtintype" id="5819556">nil</span>&nbsp;<span class="op" id="5819560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5819564">return</span>&nbsp;<span class="ident" id="5819571">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5819576">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5819580">//&nbsp;write&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5819596">for</span>&nbsp;<span class="ident" id="5819600">sa</span>&nbsp;<span class="op" id="5819603">:=</span>&nbsp;<span class="ident" id="5819606">x</span><span class="op" id="5819607">.</span><span class="ident" id="5819608">sa</span><span class="op" id="5819610">;</span>&nbsp;<span class="builtinfunc" id="5819612">len</span><span class="op" id="5819615">(</span><span class="ident" id="5819616">sa</span><span class="op" id="5819618">)</span>&nbsp;<span class="op" id="5819620">&gt;</span>&nbsp;<span class="num" id="5819622">0</span><span class="op" id="5819623">;</span>&nbsp;<span class="op" id="5819625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5819629">n</span><span class="op" id="5819630">,</span>&nbsp;<span class="ident" id="5819632">err</span>&nbsp;<span class="op" id="5819636">:=</span>&nbsp;<span class="ident" id="5819639">writeSlice</span><span class="op" id="5819649">(</span><span class="ident" id="5819650">w</span><span class="op" id="5819651">,</span>&nbsp;<span class="ident" id="5819653">buf</span><span class="op" id="5819656">,</span>&nbsp;<span class="ident" id="5819658">sa</span><span class="op" id="5819660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5819664">if</span>&nbsp;<span class="ident" id="5819667">err</span>&nbsp;<span class="op" id="5819671">!=</span>&nbsp;<span class="builtintype" id="5819674">nil</span>&nbsp;<span class="op" id="5819678">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5819683">return</span>&nbsp;<span class="ident" id="5819690">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5819696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5819700">sa</span>&nbsp;<span class="op" id="5819703">=</span>&nbsp;<span class="ident" id="5819705">sa</span><span class="op" id="5819707">[</span><span class="ident" id="5819708">n</span><span class="op" id="5819709">:</span><span class="op" id="5819710">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5819713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5819716">return</span>&nbsp;<span class="builtintype" id="5819723">nil</span><br>
<span class="lineno">160</span><span class="op" id="5819727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5819730">//&nbsp;Bytes&nbsp;returns&nbsp;the&nbsp;data&nbsp;over&nbsp;which&nbsp;the&nbsp;index&nbsp;was&nbsp;created.</span><br>
<span class="lineno"></span><span class="comment" id="5819790">//&nbsp;It&nbsp;must&nbsp;not&nbsp;be&nbsp;modified.</span><br>
<span class="lineno"></span><span class="comment" id="5819818">//</span><br>
<span class="lineno">165</span><span class="keyword" id="5819821">func</span>&nbsp;<span class="op" id="5819826">(</span><span class="ident" id="5819827">x</span>&nbsp;<span class="op" id="5819829">*</span><span class="ident" id="5819830">Index</span><span class="op" id="5819835">)</span>&nbsp;<span class="ident" id="5819837">Bytes</span><span class="op" id="5819842">(</span><span class="op" id="5819843">)</span>&nbsp;<span class="op" id="5819845">[</span><span class="op" id="5819846">]</span><span class="builtintype" id="5819847">byte</span>&nbsp;<span class="op" id="5819852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5819855">return</span>&nbsp;<span class="ident" id="5819862">x</span><span class="op" id="5819863">.</span><span class="ident" id="5819864">data</span><br>
<span class="lineno"></span><span class="op" id="5819869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5819872">func</span>&nbsp;<span class="op" id="5819877">(</span><span class="ident" id="5819878">x</span>&nbsp;<span class="op" id="5819880">*</span><span class="ident" id="5819881">Index</span><span class="op" id="5819886">)</span>&nbsp;<span class="ident" id="5819888">at</span><span class="op" id="5819890">(</span><span class="ident" id="5819891">i</span>&nbsp;<span class="builtintype" id="5819893">int</span><span class="op" id="5819896">)</span>&nbsp;<span class="op" id="5819898">[</span><span class="op" id="5819899">]</span><span class="builtintype" id="5819900">byte</span>&nbsp;<span class="op" id="5819905">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5819908">return</span>&nbsp;<span class="ident" id="5819915">x</span><span class="op" id="5819916">.</span><span class="ident" id="5819917">data</span><span class="op" id="5819921">[</span><span class="ident" id="5819922">x</span><span class="op" id="5819923">.</span><span class="ident" id="5819924">sa</span><span class="op" id="5819926">[</span><span class="ident" id="5819927">i</span><span class="op" id="5819928">]</span><span class="op" id="5819929">:</span><span class="op" id="5819930">]</span><br>
<span class="lineno"></span><span class="op" id="5819932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5819935">//&nbsp;lookupAll&nbsp;returns&nbsp;a&nbsp;slice&nbsp;into&nbsp;the&nbsp;matching&nbsp;region&nbsp;of&nbsp;the&nbsp;index.</span><br>
<span class="lineno"></span><span class="comment" id="5820003">//&nbsp;The&nbsp;runtime&nbsp;is&nbsp;O(log(N)*len(s)).</span><br>
<span class="lineno">175</span><span class="keyword" id="5820039">func</span>&nbsp;<span class="op" id="5820044">(</span><span class="ident" id="5820045">x</span>&nbsp;<span class="op" id="5820047">*</span><span class="ident" id="5820048">Index</span><span class="op" id="5820053">)</span>&nbsp;<span class="ident" id="5820055">lookupAll</span><span class="op" id="5820064">(</span><span class="ident" id="5820065">s</span>&nbsp;<span class="op" id="5820067">[</span><span class="op" id="5820068">]</span><span class="builtintype" id="5820069">byte</span><span class="op" id="5820073">)</span>&nbsp;<span class="op" id="5820075">[</span><span class="op" id="5820076">]</span><span class="builtintype" id="5820077">int</span>&nbsp;<span class="op" id="5820081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5820084">//&nbsp;find&nbsp;matching&nbsp;suffix&nbsp;index&nbsp;range&nbsp;[i:j]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5820127">//&nbsp;find&nbsp;the&nbsp;first&nbsp;index&nbsp;where&nbsp;s&nbsp;would&nbsp;be&nbsp;the&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5820180">i</span>&nbsp;<span class="op" id="5820182">:=</span>&nbsp;<span class="ident" id="5820185">sort</span><span class="op" id="5820189">.</span><span class="ident" id="5820190">Search</span><span class="op" id="5820196">(</span><span class="builtinfunc" id="5820197">len</span><span class="op" id="5820200">(</span><span class="ident" id="5820201">x</span><span class="op" id="5820202">.</span><span class="ident" id="5820203">sa</span><span class="op" id="5820205">)</span><span class="op" id="5820206">,</span>&nbsp;<span class="keyword" id="5820208">func</span><span class="op" id="5820212">(</span><span class="ident" id="5820213">i</span>&nbsp;<span class="builtintype" id="5820215">int</span><span class="op" id="5820218">)</span>&nbsp;<span class="builtintype" id="5820220">bool</span>&nbsp;<span class="op" id="5820225">{</span>&nbsp;<span class="keyword" id="5820227">return</span>&nbsp;<span class="ident" id="5820234">bytes</span><span class="op" id="5820239">.</span><span class="ident" id="5820240">Compare</span><span class="op" id="5820247">(</span><span class="ident" id="5820248">x</span><span class="op" id="5820249">.</span><span class="ident" id="5820250">at</span><span class="op" id="5820252">(</span><span class="ident" id="5820253">i</span><span class="op" id="5820254">)</span><span class="op" id="5820255">,</span>&nbsp;<span class="ident" id="5820257">s</span><span class="op" id="5820258">)</span>&nbsp;<span class="op" id="5820260">&gt;=</span>&nbsp;<span class="num" id="5820263">0</span>&nbsp;<span class="op" id="5820265">}</span><span class="op" id="5820266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5820269">//&nbsp;starting&nbsp;at&nbsp;i,&nbsp;find&nbsp;the&nbsp;first&nbsp;index&nbsp;at&nbsp;which&nbsp;s&nbsp;is&nbsp;not&nbsp;a&nbsp;prefix</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5820336">j</span>&nbsp;<span class="op" id="5820338">:=</span>&nbsp;<span class="ident" id="5820341">i</span>&nbsp;<span class="op" id="5820343">+</span>&nbsp;<span class="ident" id="5820345">sort</span><span class="op" id="5820349">.</span><span class="ident" id="5820350">Search</span><span class="op" id="5820356">(</span><span class="builtinfunc" id="5820357">len</span><span class="op" id="5820360">(</span><span class="ident" id="5820361">x</span><span class="op" id="5820362">.</span><span class="ident" id="5820363">sa</span><span class="op" id="5820365">)</span><span class="op" id="5820366">-</span><span class="ident" id="5820367">i</span><span class="op" id="5820368">,</span>&nbsp;<span class="keyword" id="5820370">func</span><span class="op" id="5820374">(</span><span class="ident" id="5820375">j</span>&nbsp;<span class="builtintype" id="5820377">int</span><span class="op" id="5820380">)</span>&nbsp;<span class="builtintype" id="5820382">bool</span>&nbsp;<span class="op" id="5820387">{</span>&nbsp;<span class="keyword" id="5820389">return</span>&nbsp;<span class="op" id="5820396">!</span><span class="ident" id="5820397">bytes</span><span class="op" id="5820402">.</span><span class="ident" id="5820403">HasPrefix</span><span class="op" id="5820412">(</span><span class="ident" id="5820413">x</span><span class="op" id="5820414">.</span><span class="ident" id="5820415">at</span><span class="op" id="5820417">(</span><span class="ident" id="5820418">j</span><span class="op" id="5820419">+</span><span class="ident" id="5820420">i</span><span class="op" id="5820421">)</span><span class="op" id="5820422">,</span>&nbsp;<span class="ident" id="5820424">s</span><span class="op" id="5820425">)</span>&nbsp;<span class="op" id="5820427">}</span><span class="op" id="5820428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5820431">return</span>&nbsp;<span class="ident" id="5820438">x</span><span class="op" id="5820439">.</span><span class="ident" id="5820440">sa</span><span class="op" id="5820442">[</span><span class="ident" id="5820443">i</span><span class="op" id="5820444">:</span><span class="ident" id="5820445">j</span><span class="op" id="5820446">]</span><br>
<span class="lineno"></span><span class="op" id="5820448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5820451">//&nbsp;Lookup&nbsp;returns&nbsp;an&nbsp;unsorted&nbsp;list&nbsp;of&nbsp;at&nbsp;most&nbsp;n&nbsp;indices&nbsp;where&nbsp;the&nbsp;byte&nbsp;string&nbsp;s</span><br>
<span class="lineno">185</span><span class="comment" id="5820531">//&nbsp;occurs&nbsp;in&nbsp;the&nbsp;indexed&nbsp;data.&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;all&nbsp;occurrences&nbsp;are&nbsp;returned.</span><br>
<span class="lineno"></span><span class="comment" id="5820602">//&nbsp;The&nbsp;result&nbsp;is&nbsp;nil&nbsp;if&nbsp;s&nbsp;is&nbsp;empty,&nbsp;s&nbsp;is&nbsp;not&nbsp;found,&nbsp;or&nbsp;n&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="5820665">//&nbsp;Lookup&nbsp;time&nbsp;is&nbsp;O(log(N)*len(s)&nbsp;+&nbsp;len(result))&nbsp;where&nbsp;N&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5820729">//&nbsp;size&nbsp;of&nbsp;the&nbsp;indexed&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="5820758">//</span><br>
<span class="lineno">190</span><span class="keyword" id="5820761">func</span>&nbsp;<span class="op" id="5820766">(</span><span class="ident" id="5820767">x</span>&nbsp;<span class="op" id="5820769">*</span><span class="ident" id="5820770">Index</span><span class="op" id="5820775">)</span>&nbsp;<span class="ident" id="5820777">Lookup</span><span class="op" id="5820783">(</span><span class="ident" id="5820784">s</span>&nbsp;<span class="op" id="5820786">[</span><span class="op" id="5820787">]</span><span class="builtintype" id="5820788">byte</span><span class="op" id="5820792">,</span>&nbsp;<span class="ident" id="5820794">n</span>&nbsp;<span class="builtintype" id="5820796">int</span><span class="op" id="5820799">)</span>&nbsp;<span class="op" id="5820801">(</span><span class="ident" id="5820802">result</span>&nbsp;<span class="op" id="5820809">[</span><span class="op" id="5820810">]</span><span class="builtintype" id="5820811">int</span><span class="op" id="5820814">)</span>&nbsp;<span class="op" id="5820816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5820819">if</span>&nbsp;<span class="builtinfunc" id="5820822">len</span><span class="op" id="5820825">(</span><span class="ident" id="5820826">s</span><span class="op" id="5820827">)</span>&nbsp;<span class="op" id="5820829">&gt;</span>&nbsp;<span class="num" id="5820831">0</span>&nbsp;<span class="op" id="5820833">&amp;&amp;</span>&nbsp;<span class="ident" id="5820836">n</span>&nbsp;<span class="op" id="5820838">!=</span>&nbsp;<span class="num" id="5820841">0</span>&nbsp;<span class="op" id="5820843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5820847">matches</span>&nbsp;<span class="op" id="5820855">:=</span>&nbsp;<span class="ident" id="5820858">x</span><span class="op" id="5820859">.</span><span class="ident" id="5820860">lookupAll</span><span class="op" id="5820869">(</span><span class="ident" id="5820870">s</span><span class="op" id="5820871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5820875">if</span>&nbsp;<span class="ident" id="5820878">n</span>&nbsp;<span class="op" id="5820880">&lt;</span>&nbsp;<span class="num" id="5820882">0</span>&nbsp;<span class="op" id="5820884">||</span>&nbsp;<span class="builtinfunc" id="5820887">len</span><span class="op" id="5820890">(</span><span class="ident" id="5820891">matches</span><span class="op" id="5820898">)</span>&nbsp;<span class="op" id="5820900">&lt;</span>&nbsp;<span class="ident" id="5820902">n</span>&nbsp;<span class="op" id="5820904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5820909">n</span>&nbsp;<span class="op" id="5820911">=</span>&nbsp;<span class="builtinfunc" id="5820913">len</span><span class="op" id="5820916">(</span><span class="ident" id="5820917">matches</span><span class="op" id="5820924">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5820928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5820932">//&nbsp;0&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;len(matches)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5820960">if</span>&nbsp;<span class="ident" id="5820963">n</span>&nbsp;<span class="op" id="5820965">&gt;</span>&nbsp;<span class="num" id="5820967">0</span>&nbsp;<span class="op" id="5820969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5820974">result</span>&nbsp;<span class="op" id="5820981">=</span>&nbsp;<span class="builtinfunc" id="5820983">make</span><span class="op" id="5820987">(</span><span class="op" id="5820988">[</span><span class="op" id="5820989">]</span><span class="builtintype" id="5820990">int</span><span class="op" id="5820993">,</span>&nbsp;<span class="ident" id="5820995">n</span><span class="op" id="5820996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5821001">copy</span><span class="op" id="5821005">(</span><span class="ident" id="5821006">result</span><span class="op" id="5821012">,</span>&nbsp;<span class="ident" id="5821014">matches</span><span class="op" id="5821021">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5821025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5821028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5821031">return</span><br>
<span class="lineno"></span><span class="op" id="5821038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="5821041">//&nbsp;FindAllIndex&nbsp;returns&nbsp;a&nbsp;sorted&nbsp;list&nbsp;of&nbsp;non-overlapping&nbsp;matches&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5821113">//&nbsp;regular&nbsp;expression&nbsp;r,&nbsp;where&nbsp;a&nbsp;match&nbsp;is&nbsp;a&nbsp;pair&nbsp;of&nbsp;indices&nbsp;specifying</span><br>
<span class="lineno"></span><span class="comment" id="5821184">//&nbsp;the&nbsp;matched&nbsp;slice&nbsp;of&nbsp;x.Bytes().&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;all&nbsp;matches&nbsp;are&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="5821254">//&nbsp;in&nbsp;successive&nbsp;order.&nbsp;Otherwise,&nbsp;at&nbsp;most&nbsp;n&nbsp;matches&nbsp;are&nbsp;returned&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5821324">//&nbsp;they&nbsp;may&nbsp;not&nbsp;be&nbsp;successive.&nbsp;The&nbsp;result&nbsp;is&nbsp;nil&nbsp;if&nbsp;there&nbsp;are&nbsp;no&nbsp;matches,</span><br>
<span class="lineno">210</span><span class="comment" id="5821398">//&nbsp;or&nbsp;if&nbsp;n&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="5821415">//</span><br>
<span class="lineno"></span><span class="keyword" id="5821418">func</span>&nbsp;<span class="op" id="5821423">(</span><span class="ident" id="5821424">x</span>&nbsp;<span class="op" id="5821426">*</span><span class="ident" id="5821427">Index</span><span class="op" id="5821432">)</span>&nbsp;<span class="ident" id="5821434">FindAllIndex</span><span class="op" id="5821446">(</span><span class="ident" id="5821447">r</span>&nbsp;<span class="op" id="5821449">*</span><span class="ident" id="5821450">regexp</span><span class="op" id="5821456">.</span><span class="ident" id="5821457">Regexp</span><span class="op" id="5821463">,</span>&nbsp;<span class="ident" id="5821465">n</span>&nbsp;<span class="builtintype" id="5821467">int</span><span class="op" id="5821470">)</span>&nbsp;<span class="op" id="5821472">(</span><span class="ident" id="5821473">result</span>&nbsp;<span class="op" id="5821480">[</span><span class="op" id="5821481">]</span><span class="op" id="5821482">[</span><span class="op" id="5821483">]</span><span class="builtintype" id="5821484">int</span><span class="op" id="5821487">)</span>&nbsp;<span class="op" id="5821489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5821492">//&nbsp;a&nbsp;non-empty&nbsp;literal&nbsp;prefix&nbsp;is&nbsp;used&nbsp;to&nbsp;determine&nbsp;possible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5821553">//&nbsp;match&nbsp;start&nbsp;indices&nbsp;with&nbsp;Lookup</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5821589">prefix</span><span class="op" id="5821595">,</span>&nbsp;<span class="ident" id="5821597">complete</span>&nbsp;<span class="op" id="5821606">:=</span>&nbsp;<span class="ident" id="5821609">r</span><span class="op" id="5821610">.</span><span class="ident" id="5821611">LiteralPrefix</span><span class="op" id="5821624">(</span><span class="op" id="5821625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5821628">lit</span>&nbsp;<span class="op" id="5821632">:=</span>&nbsp;<span class="op" id="5821635">[</span><span class="op" id="5821636">]</span><span class="builtintype" id="5821637">byte</span><span class="op" id="5821641">(</span><span class="ident" id="5821642">prefix</span><span class="op" id="5821648">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5821652">//&nbsp;worst-case&nbsp;scenario:&nbsp;no&nbsp;literal&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5821695">if</span>&nbsp;<span class="ident" id="5821698">prefix</span>&nbsp;<span class="op" id="5821705">==</span>&nbsp;<span class="string" id="5821708">&#34;&#34;</span>&nbsp;<span class="op" id="5821711">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5821715">return</span>&nbsp;<span class="ident" id="5821722">r</span><span class="op" id="5821723">.</span><span class="ident" id="5821724">FindAllIndex</span><span class="op" id="5821736">(</span><span class="ident" id="5821737">x</span><span class="op" id="5821738">.</span><span class="ident" id="5821739">data</span><span class="op" id="5821743">,</span>&nbsp;<span class="ident" id="5821745">n</span><span class="op" id="5821746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5821749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5821753">//&nbsp;if&nbsp;regexp&nbsp;is&nbsp;a&nbsp;literal&nbsp;just&nbsp;use&nbsp;Lookup&nbsp;and&nbsp;convert&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5821812">//&nbsp;result&nbsp;into&nbsp;match&nbsp;pairs</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5821840">if</span>&nbsp;<span class="ident" id="5821843">complete</span>&nbsp;<span class="op" id="5821852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5821856">//&nbsp;Lookup&nbsp;returns&nbsp;indices&nbsp;that&nbsp;may&nbsp;belong&nbsp;to&nbsp;overlapping&nbsp;matches.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5821924">//&nbsp;After&nbsp;eliminating&nbsp;them,&nbsp;we&nbsp;may&nbsp;end&nbsp;up&nbsp;with&nbsp;fewer&nbsp;than&nbsp;n&nbsp;matches.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5821994">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;enough&nbsp;at&nbsp;the&nbsp;end,&nbsp;redo&nbsp;the&nbsp;search&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5822059">//&nbsp;increased&nbsp;value&nbsp;n1,&nbsp;but&nbsp;only&nbsp;if&nbsp;Lookup&nbsp;returned&nbsp;all&nbsp;the&nbsp;requested</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5822130">//&nbsp;indices&nbsp;in&nbsp;the&nbsp;first&nbsp;place&nbsp;(if&nbsp;it&nbsp;returned&nbsp;fewer&nbsp;than&nbsp;that&nbsp;then</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5822199">//&nbsp;there&nbsp;cannot&nbsp;be&nbsp;more).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5822227">for</span>&nbsp;<span class="ident" id="5822231">n1</span>&nbsp;<span class="op" id="5822234">:=</span>&nbsp;<span class="ident" id="5822237">n</span><span class="op" id="5822238">;</span>&nbsp;<span class="op" id="5822240">;</span>&nbsp;<span class="ident" id="5822242">n1</span>&nbsp;<span class="op" id="5822245">+=</span>&nbsp;<span class="num" id="5822248">2</span>&nbsp;<span class="op" id="5822250">*</span>&nbsp;<span class="op" id="5822252">(</span><span class="ident" id="5822253">n</span>&nbsp;<span class="op" id="5822255">-</span>&nbsp;<span class="builtinfunc" id="5822257">len</span><span class="op" id="5822260">(</span><span class="ident" id="5822261">result</span><span class="op" id="5822267">)</span><span class="op" id="5822268">)</span>&nbsp;<span class="comment" id="5822270">/*&nbsp;overflow&nbsp;ok&nbsp;*/</span>&nbsp;<span class="op" id="5822288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5822293">indices</span>&nbsp;<span class="op" id="5822301">:=</span>&nbsp;<span class="ident" id="5822304">x</span><span class="op" id="5822305">.</span><span class="ident" id="5822306">Lookup</span><span class="op" id="5822312">(</span><span class="ident" id="5822313">lit</span><span class="op" id="5822316">,</span>&nbsp;<span class="ident" id="5822318">n1</span><span class="op" id="5822320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5822325">if</span>&nbsp;<span class="builtinfunc" id="5822328">len</span><span class="op" id="5822331">(</span><span class="ident" id="5822332">indices</span><span class="op" id="5822339">)</span>&nbsp;<span class="op" id="5822341">==</span>&nbsp;<span class="num" id="5822344">0</span>&nbsp;<span class="op" id="5822346">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5822352">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5822362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5822367">sort</span><span class="op" id="5822371">.</span><span class="ident" id="5822372">Ints</span><span class="op" id="5822376">(</span><span class="ident" id="5822377">indices</span><span class="op" id="5822384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5822389">pairs</span>&nbsp;<span class="op" id="5822395">:=</span>&nbsp;<span class="builtinfunc" id="5822398">make</span><span class="op" id="5822402">(</span><span class="op" id="5822403">[</span><span class="op" id="5822404">]</span><span class="builtintype" id="5822405">int</span><span class="op" id="5822408">,</span>&nbsp;<span class="num" id="5822410">2</span><span class="op" id="5822411">*</span><span class="builtinfunc" id="5822412">len</span><span class="op" id="5822415">(</span><span class="ident" id="5822416">indices</span><span class="op" id="5822423">)</span><span class="op" id="5822424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5822429">result</span>&nbsp;<span class="op" id="5822436">=</span>&nbsp;<span class="builtinfunc" id="5822438">make</span><span class="op" id="5822442">(</span><span class="op" id="5822443">[</span><span class="op" id="5822444">]</span><span class="op" id="5822445">[</span><span class="op" id="5822446">]</span><span class="builtintype" id="5822447">int</span><span class="op" id="5822450">,</span>&nbsp;<span class="builtinfunc" id="5822452">len</span><span class="op" id="5822455">(</span><span class="ident" id="5822456">indices</span><span class="op" id="5822463">)</span><span class="op" id="5822464">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5822469">count</span>&nbsp;<span class="op" id="5822475">:=</span>&nbsp;<span class="num" id="5822478">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5822483">prev</span>&nbsp;<span class="op" id="5822488">:=</span>&nbsp;<span class="num" id="5822491">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5822496">for</span>&nbsp;<span class="ident" id="5822500">_</span><span class="op" id="5822501">,</span>&nbsp;<span class="ident" id="5822503">i</span>&nbsp;<span class="op" id="5822505">:=</span>&nbsp;<span class="keyword" id="5822508">range</span>&nbsp;<span class="ident" id="5822514">indices</span>&nbsp;<span class="op" id="5822522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5822528">if</span>&nbsp;<span class="ident" id="5822531">count</span>&nbsp;<span class="op" id="5822537">==</span>&nbsp;<span class="ident" id="5822540">n</span>&nbsp;<span class="op" id="5822542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5822549">break</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5822559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5822565">//&nbsp;ignore&nbsp;indices&nbsp;leading&nbsp;to&nbsp;overlapping&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5822618">if</span>&nbsp;<span class="ident" id="5822621">prev</span>&nbsp;<span class="op" id="5822626">&lt;=</span>&nbsp;<span class="ident" id="5822629">i</span>&nbsp;<span class="op" id="5822631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5822638">j</span>&nbsp;<span class="op" id="5822640">:=</span>&nbsp;<span class="num" id="5822643">2</span>&nbsp;<span class="op" id="5822645">*</span>&nbsp;<span class="ident" id="5822647">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5822658">pairs</span><span class="op" id="5822663">[</span><span class="ident" id="5822664">j</span><span class="op" id="5822665">+</span><span class="num" id="5822666">0</span><span class="op" id="5822667">]</span>&nbsp;<span class="op" id="5822669">=</span>&nbsp;<span class="ident" id="5822671">i</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5822678">pairs</span><span class="op" id="5822683">[</span><span class="ident" id="5822684">j</span><span class="op" id="5822685">+</span><span class="num" id="5822686">1</span><span class="op" id="5822687">]</span>&nbsp;<span class="op" id="5822689">=</span>&nbsp;<span class="ident" id="5822691">i</span>&nbsp;<span class="op" id="5822693">+</span>&nbsp;<span class="builtinfunc" id="5822695">len</span><span class="op" id="5822698">(</span><span class="ident" id="5822699">lit</span><span class="op" id="5822702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5822709">result</span><span class="op" id="5822715">[</span><span class="ident" id="5822716">count</span><span class="op" id="5822721">]</span>&nbsp;<span class="op" id="5822723">=</span>&nbsp;<span class="ident" id="5822725">pairs</span><span class="op" id="5822730">[</span><span class="ident" id="5822731">j</span>&nbsp;<span class="op" id="5822733">:</span>&nbsp;<span class="ident" id="5822735">j</span><span class="op" id="5822736">+</span><span class="num" id="5822737">2</span><span class="op" id="5822738">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5822745">count</span><span class="op" id="5822750">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5822758">prev</span>&nbsp;<span class="op" id="5822763">=</span>&nbsp;<span class="ident" id="5822765">i</span>&nbsp;<span class="op" id="5822767">+</span>&nbsp;<span class="builtinfunc" id="5822769">len</span><span class="op" id="5822772">(</span><span class="ident" id="5822773">lit</span><span class="op" id="5822776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5822782">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5822787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5822792">result</span>&nbsp;<span class="op" id="5822799">=</span>&nbsp;<span class="ident" id="5822801">result</span><span class="op" id="5822807">[</span><span class="num" id="5822808">0</span><span class="op" id="5822809">:</span><span class="ident" id="5822810">count</span><span class="op" id="5822815">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5822820">if</span>&nbsp;<span class="builtinfunc" id="5822823">len</span><span class="op" id="5822826">(</span><span class="ident" id="5822827">result</span><span class="op" id="5822833">)</span>&nbsp;<span class="op" id="5822835">&gt;=</span>&nbsp;<span class="ident" id="5822838">n</span>&nbsp;<span class="op" id="5822840">||</span>&nbsp;<span class="builtinfunc" id="5822843">len</span><span class="op" id="5822846">(</span><span class="ident" id="5822847">indices</span><span class="op" id="5822854">)</span>&nbsp;<span class="op" id="5822856">!=</span>&nbsp;<span class="ident" id="5822859">n1</span>&nbsp;<span class="op" id="5822862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5822868">//&nbsp;found&nbsp;all&nbsp;matches&nbsp;or&nbsp;there&#39;s&nbsp;no&nbsp;chance&nbsp;to&nbsp;find&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5822927">//&nbsp;(n&nbsp;and&nbsp;n1&nbsp;can&nbsp;be&nbsp;negative)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5822961">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5822970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5822974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5822978">if</span>&nbsp;<span class="builtinfunc" id="5822981">len</span><span class="op" id="5822984">(</span><span class="ident" id="5822985">result</span><span class="op" id="5822991">)</span>&nbsp;<span class="op" id="5822993">==</span>&nbsp;<span class="num" id="5822996">0</span>&nbsp;<span class="op" id="5822998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5823003">result</span>&nbsp;<span class="op" id="5823010">=</span>&nbsp;<span class="builtintype" id="5823012">nil</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5823018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5823022">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5823030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5823034">//&nbsp;regexp&nbsp;has&nbsp;a&nbsp;non-empty&nbsp;literal&nbsp;prefix;&nbsp;Lookup(lit)&nbsp;computes</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5823098">//&nbsp;the&nbsp;indices&nbsp;of&nbsp;possible&nbsp;complete&nbsp;matches;&nbsp;use&nbsp;these&nbsp;as&nbsp;starting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5823166">//&nbsp;points&nbsp;for&nbsp;anchored&nbsp;searches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5823199">//&nbsp;(regexp&nbsp;&#34;^&#34;&nbsp;matches&nbsp;beginning&nbsp;of&nbsp;input,&nbsp;not&nbsp;beginning&nbsp;of&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5823266">r</span>&nbsp;<span class="op" id="5823268">=</span>&nbsp;<span class="ident" id="5823270">regexp</span><span class="op" id="5823276">.</span><span class="ident" id="5823277">MustCompile</span><span class="op" id="5823288">(</span><span class="string" id="5823289">&#34;^&#34;</span>&nbsp;<span class="op" id="5823293">+</span>&nbsp;<span class="ident" id="5823295">r</span><span class="op" id="5823296">.</span><span class="ident" id="5823297">String</span><span class="op" id="5823303">(</span><span class="op" id="5823304">)</span><span class="op" id="5823305">)</span>&nbsp;<span class="comment" id="5823307">//&nbsp;compiles&nbsp;because&nbsp;r&nbsp;compiled</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5823340">//&nbsp;same&nbsp;comment&nbsp;about&nbsp;Lookup&nbsp;applies&nbsp;here&nbsp;as&nbsp;in&nbsp;the&nbsp;loop&nbsp;above</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5823404">for</span>&nbsp;<span class="ident" id="5823408">n1</span>&nbsp;<span class="op" id="5823411">:=</span>&nbsp;<span class="ident" id="5823414">n</span><span class="op" id="5823415">;</span>&nbsp;<span class="op" id="5823417">;</span>&nbsp;<span class="ident" id="5823419">n1</span>&nbsp;<span class="op" id="5823422">+=</span>&nbsp;<span class="num" id="5823425">2</span>&nbsp;<span class="op" id="5823427">*</span>&nbsp;<span class="op" id="5823429">(</span><span class="ident" id="5823430">n</span>&nbsp;<span class="op" id="5823432">-</span>&nbsp;<span class="builtinfunc" id="5823434">len</span><span class="op" id="5823437">(</span><span class="ident" id="5823438">result</span><span class="op" id="5823444">)</span><span class="op" id="5823445">)</span>&nbsp;<span class="comment" id="5823447">/*&nbsp;overflow&nbsp;ok&nbsp;*/</span>&nbsp;<span class="op" id="5823465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5823469">indices</span>&nbsp;<span class="op" id="5823477">:=</span>&nbsp;<span class="ident" id="5823480">x</span><span class="op" id="5823481">.</span><span class="ident" id="5823482">Lookup</span><span class="op" id="5823488">(</span><span class="ident" id="5823489">lit</span><span class="op" id="5823492">,</span>&nbsp;<span class="ident" id="5823494">n1</span><span class="op" id="5823496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5823500">if</span>&nbsp;<span class="builtinfunc" id="5823503">len</span><span class="op" id="5823506">(</span><span class="ident" id="5823507">indices</span><span class="op" id="5823514">)</span>&nbsp;<span class="op" id="5823516">==</span>&nbsp;<span class="num" id="5823519">0</span>&nbsp;<span class="op" id="5823521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5823526">return</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5823535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5823539">sort</span><span class="op" id="5823543">.</span><span class="ident" id="5823544">Ints</span><span class="op" id="5823548">(</span><span class="ident" id="5823549">indices</span><span class="op" id="5823556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5823560">result</span>&nbsp;<span class="op" id="5823567">=</span>&nbsp;<span class="ident" id="5823569">result</span><span class="op" id="5823575">[</span><span class="num" id="5823576">0</span><span class="op" id="5823577">:</span><span class="num" id="5823578">0</span><span class="op" id="5823579">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5823583">prev</span>&nbsp;<span class="op" id="5823588">:=</span>&nbsp;<span class="num" id="5823591">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5823595">for</span>&nbsp;<span class="ident" id="5823599">_</span><span class="op" id="5823600">,</span>&nbsp;<span class="ident" id="5823602">i</span>&nbsp;<span class="op" id="5823604">:=</span>&nbsp;<span class="keyword" id="5823607">range</span>&nbsp;<span class="ident" id="5823613">indices</span>&nbsp;<span class="op" id="5823621">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5823626">if</span>&nbsp;<span class="builtinfunc" id="5823629">len</span><span class="op" id="5823632">(</span><span class="ident" id="5823633">result</span><span class="op" id="5823639">)</span>&nbsp;<span class="op" id="5823641">==</span>&nbsp;<span class="ident" id="5823644">n</span>&nbsp;<span class="op" id="5823646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5823652">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5823661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5823666">m</span>&nbsp;<span class="op" id="5823668">:=</span>&nbsp;<span class="ident" id="5823671">r</span><span class="op" id="5823672">.</span><span class="ident" id="5823673">FindIndex</span><span class="op" id="5823682">(</span><span class="ident" id="5823683">x</span><span class="op" id="5823684">.</span><span class="ident" id="5823685">data</span><span class="op" id="5823689">[</span><span class="ident" id="5823690">i</span><span class="op" id="5823691">:</span><span class="op" id="5823692">]</span><span class="op" id="5823693">)</span>&nbsp;<span class="comment" id="5823695">//&nbsp;anchored&nbsp;search&nbsp;-&nbsp;will&nbsp;not&nbsp;run&nbsp;off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5823736">//&nbsp;ignore&nbsp;indices&nbsp;leading&nbsp;to&nbsp;overlapping&nbsp;matches</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5823788">if</span>&nbsp;<span class="ident" id="5823791">m</span>&nbsp;<span class="op" id="5823793">!=</span>&nbsp;<span class="builtintype" id="5823796">nil</span>&nbsp;<span class="op" id="5823800">&amp;&amp;</span>&nbsp;<span class="ident" id="5823803">prev</span>&nbsp;<span class="op" id="5823808">&lt;=</span>&nbsp;<span class="ident" id="5823811">i</span>&nbsp;<span class="op" id="5823813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5823819">m</span><span class="op" id="5823820">[</span><span class="num" id="5823821">0</span><span class="op" id="5823822">]</span>&nbsp;<span class="op" id="5823824">=</span>&nbsp;<span class="ident" id="5823826">i</span>&nbsp;<span class="comment" id="5823828">//&nbsp;correct&nbsp;m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5823845">m</span><span class="op" id="5823846">[</span><span class="num" id="5823847">1</span><span class="op" id="5823848">]</span>&nbsp;<span class="op" id="5823850">+=</span>&nbsp;<span class="ident" id="5823853">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5823859">result</span>&nbsp;<span class="op" id="5823866">=</span>&nbsp;<span class="builtinfunc" id="5823868">append</span><span class="op" id="5823874">(</span><span class="ident" id="5823875">result</span><span class="op" id="5823881">,</span>&nbsp;<span class="ident" id="5823883">m</span><span class="op" id="5823884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5823890">prev</span>&nbsp;<span class="op" id="5823895">=</span>&nbsp;<span class="ident" id="5823897">m</span><span class="op" id="5823898">[</span><span class="num" id="5823899">1</span><span class="op" id="5823900">]</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5823905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5823909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5823913">if</span>&nbsp;<span class="builtinfunc" id="5823916">len</span><span class="op" id="5823919">(</span><span class="ident" id="5823920">result</span><span class="op" id="5823926">)</span>&nbsp;<span class="op" id="5823928">&gt;=</span>&nbsp;<span class="ident" id="5823931">n</span>&nbsp;<span class="op" id="5823933">||</span>&nbsp;<span class="builtinfunc" id="5823936">len</span><span class="op" id="5823939">(</span><span class="ident" id="5823940">indices</span><span class="op" id="5823947">)</span>&nbsp;<span class="op" id="5823949">!=</span>&nbsp;<span class="ident" id="5823952">n1</span>&nbsp;<span class="op" id="5823955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5823960">//&nbsp;found&nbsp;all&nbsp;matches&nbsp;or&nbsp;there&#39;s&nbsp;no&nbsp;chance&nbsp;to&nbsp;find&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5824018">//&nbsp;(n&nbsp;and&nbsp;n1&nbsp;can&nbsp;be&nbsp;negative)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5824051">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5824059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5824062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5824065">if</span>&nbsp;<span class="builtinfunc" id="5824068">len</span><span class="op" id="5824071">(</span><span class="ident" id="5824072">result</span><span class="op" id="5824078">)</span>&nbsp;<span class="op" id="5824080">==</span>&nbsp;<span class="num" id="5824083">0</span>&nbsp;<span class="op" id="5824085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5824089">result</span>&nbsp;<span class="op" id="5824096">=</span>&nbsp;<span class="builtintype" id="5824098">nil</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5824103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5824106">return</span><br>
<span class="lineno"></span><span class="op" id="5824113">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
