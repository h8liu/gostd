<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/fcgi</h2>
<ul>
<li><a href="/gostd/net/http/fcgi/child.go.html">child.go</a></li>
<li><a href="/gostd/net/http/fcgi/fcgi.go.html">fcgi.go</a></li>
<li><a href="/gostd/net/http/fcgi/fcgi_test.go.html" class="current">fcgi_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7913538">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7913593">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7913647">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7913698">package</span>&nbsp;<span class="ident" id="7913706">fcgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7913712">import</span>&nbsp;<span class="op" id="7913719">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7913722">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7913731">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7913741">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7913747">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7913757">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7913760">var</span>&nbsp;<span class="ident" id="7913764">sizeTests</span>&nbsp;<span class="op" id="7913774">=</span>&nbsp;<span class="op" id="7913776">[</span><span class="op" id="7913777">]</span><span class="keyword" id="7913778">struct</span>&nbsp;<span class="op" id="7913785">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913788">size</span>&nbsp;&nbsp;<span class="builtintype" id="7913794">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913802">bytes</span>&nbsp;<span class="op" id="7913808">[</span><span class="op" id="7913809">]</span><span class="builtintype" id="7913810">byte</span><br>
<span class="lineno"></span><span class="op" id="7913815">}</span><span class="op" id="7913816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7913819">{</span><span class="num" id="7913820">0</span><span class="op" id="7913821">,</span>&nbsp;<span class="op" id="7913823">[</span><span class="op" id="7913824">]</span><span class="builtintype" id="7913825">byte</span><span class="op" id="7913829">{</span><span class="num" id="7913830">0x00</span><span class="op" id="7913834">}</span><span class="op" id="7913835">}</span><span class="op" id="7913836">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7913839">{</span><span class="num" id="7913840">127</span><span class="op" id="7913843">,</span>&nbsp;<span class="op" id="7913845">[</span><span class="op" id="7913846">]</span><span class="builtintype" id="7913847">byte</span><span class="op" id="7913851">{</span><span class="num" id="7913852">0x7F</span><span class="op" id="7913856">}</span><span class="op" id="7913857">}</span><span class="op" id="7913858">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7913861">{</span><span class="num" id="7913862">128</span><span class="op" id="7913865">,</span>&nbsp;<span class="op" id="7913867">[</span><span class="op" id="7913868">]</span><span class="builtintype" id="7913869">byte</span><span class="op" id="7913873">{</span><span class="num" id="7913874">0x80</span><span class="op" id="7913878">,</span>&nbsp;<span class="num" id="7913880">0x00</span><span class="op" id="7913884">,</span>&nbsp;<span class="num" id="7913886">0x00</span><span class="op" id="7913890">,</span>&nbsp;<span class="num" id="7913892">0x80</span><span class="op" id="7913896">}</span><span class="op" id="7913897">}</span><span class="op" id="7913898">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7913901">{</span><span class="num" id="7913902">1000</span><span class="op" id="7913906">,</span>&nbsp;<span class="op" id="7913908">[</span><span class="op" id="7913909">]</span><span class="builtintype" id="7913910">byte</span><span class="op" id="7913914">{</span><span class="num" id="7913915">0x80</span><span class="op" id="7913919">,</span>&nbsp;<span class="num" id="7913921">0x00</span><span class="op" id="7913925">,</span>&nbsp;<span class="num" id="7913927">0x03</span><span class="op" id="7913931">,</span>&nbsp;<span class="num" id="7913933">0xE8</span><span class="op" id="7913937">}</span><span class="op" id="7913938">}</span><span class="op" id="7913939">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7913942">{</span><span class="num" id="7913943">33554431</span><span class="op" id="7913951">,</span>&nbsp;<span class="op" id="7913953">[</span><span class="op" id="7913954">]</span><span class="builtintype" id="7913955">byte</span><span class="op" id="7913959">{</span><span class="num" id="7913960">0x81</span><span class="op" id="7913964">,</span>&nbsp;<span class="num" id="7913966">0xFF</span><span class="op" id="7913970">,</span>&nbsp;<span class="num" id="7913972">0xFF</span><span class="op" id="7913976">,</span>&nbsp;<span class="num" id="7913978">0xFF</span><span class="op" id="7913982">}</span><span class="op" id="7913983">}</span><span class="op" id="7913984">,</span><br>
<span class="lineno"></span><span class="op" id="7913986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="7913989">func</span>&nbsp;<span class="ident" id="7913994">TestSize</span><span class="op" id="7914002">(</span><span class="ident" id="7914003">t</span>&nbsp;<span class="op" id="7914005">*</span><span class="ident" id="7914006">testing</span><span class="op" id="7914013">.</span><span class="ident" id="7914014">T</span><span class="op" id="7914015">)</span>&nbsp;<span class="op" id="7914017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914020">b</span>&nbsp;<span class="op" id="7914022">:=</span>&nbsp;<span class="builtinfunc" id="7914025">make</span><span class="op" id="7914029">(</span><span class="op" id="7914030">[</span><span class="op" id="7914031">]</span><span class="builtintype" id="7914032">byte</span><span class="op" id="7914036">,</span>&nbsp;<span class="num" id="7914038">4</span><span class="op" id="7914039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7914042">for</span>&nbsp;<span class="ident" id="7914046">i</span><span class="op" id="7914047">,</span>&nbsp;<span class="ident" id="7914049">test</span>&nbsp;<span class="op" id="7914054">:=</span>&nbsp;<span class="keyword" id="7914057">range</span>&nbsp;<span class="ident" id="7914063">sizeTests</span>&nbsp;<span class="op" id="7914073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914077">n</span>&nbsp;<span class="op" id="7914079">:=</span>&nbsp;<span class="ident" id="7914082">encodeSize</span><span class="op" id="7914092">(</span><span class="ident" id="7914093">b</span><span class="op" id="7914094">,</span>&nbsp;<span class="ident" id="7914096">test</span><span class="op" id="7914100">.</span><span class="ident" id="7914101">size</span><span class="op" id="7914105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7914109">if</span>&nbsp;<span class="op" id="7914112">!</span><span class="ident" id="7914113">bytes</span><span class="op" id="7914118">.</span><span class="ident" id="7914119">Equal</span><span class="op" id="7914124">(</span><span class="ident" id="7914125">b</span><span class="op" id="7914126">[</span><span class="op" id="7914127">:</span><span class="ident" id="7914128">n</span><span class="op" id="7914129">]</span><span class="op" id="7914130">,</span>&nbsp;<span class="ident" id="7914132">test</span><span class="op" id="7914136">.</span><span class="ident" id="7914137">bytes</span><span class="op" id="7914142">)</span>&nbsp;<span class="op" id="7914144">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914149">t</span><span class="op" id="7914150">.</span><span class="ident" id="7914151">Errorf</span><span class="op" id="7914157">(</span><span class="string" id="7914158">&#34;%d&nbsp;expected&nbsp;%x,&nbsp;encoded&nbsp;%x&#34;</span><span class="op" id="7914186">,</span>&nbsp;<span class="ident" id="7914188">i</span><span class="op" id="7914189">,</span>&nbsp;<span class="ident" id="7914191">test</span><span class="op" id="7914195">.</span><span class="ident" id="7914196">bytes</span><span class="op" id="7914201">,</span>&nbsp;<span class="ident" id="7914203">b</span><span class="op" id="7914204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7914208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914212">size</span><span class="op" id="7914216">,</span>&nbsp;<span class="ident" id="7914218">n</span>&nbsp;<span class="op" id="7914220">:=</span>&nbsp;<span class="ident" id="7914223">readSize</span><span class="op" id="7914231">(</span><span class="ident" id="7914232">test</span><span class="op" id="7914236">.</span><span class="ident" id="7914237">bytes</span><span class="op" id="7914242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7914246">if</span>&nbsp;<span class="ident" id="7914249">size</span>&nbsp;<span class="op" id="7914254">!=</span>&nbsp;<span class="ident" id="7914257">test</span><span class="op" id="7914261">.</span><span class="ident" id="7914262">size</span>&nbsp;<span class="op" id="7914267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914272">t</span><span class="op" id="7914273">.</span><span class="ident" id="7914274">Errorf</span><span class="op" id="7914280">(</span><span class="string" id="7914281">&#34;%d&nbsp;expected&nbsp;%d,&nbsp;read&nbsp;%d&#34;</span><span class="op" id="7914306">,</span>&nbsp;<span class="ident" id="7914308">i</span><span class="op" id="7914309">,</span>&nbsp;<span class="ident" id="7914311">test</span><span class="op" id="7914315">.</span><span class="ident" id="7914316">size</span><span class="op" id="7914320">,</span>&nbsp;<span class="ident" id="7914322">size</span><span class="op" id="7914326">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7914330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7914334">if</span>&nbsp;<span class="builtinfunc" id="7914337">len</span><span class="op" id="7914340">(</span><span class="ident" id="7914341">test</span><span class="op" id="7914345">.</span><span class="ident" id="7914346">bytes</span><span class="op" id="7914351">)</span>&nbsp;<span class="op" id="7914353">!=</span>&nbsp;<span class="ident" id="7914356">n</span>&nbsp;<span class="op" id="7914358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914363">t</span><span class="op" id="7914364">.</span><span class="ident" id="7914365">Errorf</span><span class="op" id="7914371">(</span><span class="string" id="7914372">&#34;%d&nbsp;did&nbsp;not&nbsp;consume&nbsp;all&nbsp;the&nbsp;bytes&#34;</span><span class="op" id="7914406">,</span>&nbsp;<span class="ident" id="7914408">i</span><span class="op" id="7914409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7914413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7914416">}</span><br>
<span class="lineno">40</span><span class="op" id="7914418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7914421">var</span>&nbsp;<span class="ident" id="7914425">streamTests</span>&nbsp;<span class="op" id="7914437">=</span>&nbsp;<span class="op" id="7914439">[</span><span class="op" id="7914440">]</span><span class="keyword" id="7914441">struct</span>&nbsp;<span class="op" id="7914448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914451">desc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7914459">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914467">recType</span>&nbsp;<span class="ident" id="7914475">recType</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914484">reqId</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7914492">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914500">content</span>&nbsp;<span class="op" id="7914508">[</span><span class="op" id="7914509">]</span><span class="builtintype" id="7914510">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914516">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7914524">[</span><span class="op" id="7914525">]</span><span class="builtintype" id="7914526">byte</span><br>
<span class="lineno"></span><span class="op" id="7914531">}</span><span class="op" id="7914532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7914535">{</span><span class="string" id="7914536">&#34;single&nbsp;record&#34;</span><span class="op" id="7914551">,</span>&nbsp;<span class="ident" id="7914553">typeStdout</span><span class="op" id="7914563">,</span>&nbsp;<span class="num" id="7914565">1</span><span class="op" id="7914566">,</span>&nbsp;<span class="ident" id="7914568">nil</span><span class="op" id="7914571">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7914575">[</span><span class="op" id="7914576">]</span><span class="builtintype" id="7914577">byte</span><span class="op" id="7914581">{</span><span class="num" id="7914582">1</span><span class="op" id="7914583">,</span>&nbsp;<span class="builtintype" id="7914585">byte</span><span class="op" id="7914589">(</span><span class="ident" id="7914590">typeStdout</span><span class="op" id="7914600">)</span><span class="op" id="7914601">,</span>&nbsp;<span class="num" id="7914603">0</span><span class="op" id="7914604">,</span>&nbsp;<span class="num" id="7914606">1</span><span class="op" id="7914607">,</span>&nbsp;<span class="num" id="7914609">0</span><span class="op" id="7914610">,</span>&nbsp;<span class="num" id="7914612">0</span><span class="op" id="7914613">,</span>&nbsp;<span class="num" id="7914615">0</span><span class="op" id="7914616">,</span>&nbsp;<span class="num" id="7914618">0</span><span class="op" id="7914619">}</span><span class="op" id="7914620">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7914623">}</span><span class="op" id="7914624">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7914627">//&nbsp;this&nbsp;data&nbsp;will&nbsp;have&nbsp;to&nbsp;be&nbsp;split&nbsp;into&nbsp;two&nbsp;records</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7914680">{</span><span class="string" id="7914681">&#34;two&nbsp;records&#34;</span><span class="op" id="7914694">,</span>&nbsp;<span class="ident" id="7914696">typeStdin</span><span class="op" id="7914705">,</span>&nbsp;<span class="num" id="7914707">300</span><span class="op" id="7914710">,</span>&nbsp;<span class="builtinfunc" id="7914712">make</span><span class="op" id="7914716">(</span><span class="op" id="7914717">[</span><span class="op" id="7914718">]</span><span class="builtintype" id="7914719">byte</span><span class="op" id="7914723">,</span>&nbsp;<span class="num" id="7914725">66000</span><span class="op" id="7914730">)</span><span class="op" id="7914731">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914735">bytes</span><span class="op" id="7914740">.</span><span class="ident" id="7914741">Join</span><span class="op" id="7914745">(</span><span class="op" id="7914746">[</span><span class="op" id="7914747">]</span><span class="op" id="7914748">[</span><span class="op" id="7914749">]</span><span class="builtintype" id="7914750">byte</span><span class="op" id="7914754">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7914759">//&nbsp;header&nbsp;for&nbsp;the&nbsp;first&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7914793">{</span><span class="num" id="7914794">1</span><span class="op" id="7914795">,</span>&nbsp;<span class="builtintype" id="7914797">byte</span><span class="op" id="7914801">(</span><span class="ident" id="7914802">typeStdin</span><span class="op" id="7914811">)</span><span class="op" id="7914812">,</span>&nbsp;<span class="num" id="7914814">0x01</span><span class="op" id="7914818">,</span>&nbsp;<span class="num" id="7914820">0x2C</span><span class="op" id="7914824">,</span>&nbsp;<span class="num" id="7914826">0xFF</span><span class="op" id="7914830">,</span>&nbsp;<span class="num" id="7914832">0xFF</span><span class="op" id="7914836">,</span>&nbsp;<span class="num" id="7914838">1</span><span class="op" id="7914839">,</span>&nbsp;<span class="num" id="7914841">0</span><span class="op" id="7914842">}</span><span class="op" id="7914843">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7914848">make</span><span class="op" id="7914852">(</span><span class="op" id="7914853">[</span><span class="op" id="7914854">]</span><span class="builtintype" id="7914855">byte</span><span class="op" id="7914859">,</span>&nbsp;<span class="num" id="7914861">65536</span><span class="op" id="7914866">)</span><span class="op" id="7914867">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7914872">//&nbsp;header&nbsp;for&nbsp;the&nbsp;second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7914900">{</span><span class="num" id="7914901">1</span><span class="op" id="7914902">,</span>&nbsp;<span class="builtintype" id="7914904">byte</span><span class="op" id="7914908">(</span><span class="ident" id="7914909">typeStdin</span><span class="op" id="7914918">)</span><span class="op" id="7914919">,</span>&nbsp;<span class="num" id="7914921">0x01</span><span class="op" id="7914925">,</span>&nbsp;<span class="num" id="7914927">0x2C</span><span class="op" id="7914931">,</span>&nbsp;<span class="num" id="7914933">0x01</span><span class="op" id="7914937">,</span>&nbsp;<span class="num" id="7914939">0xD1</span><span class="op" id="7914943">,</span>&nbsp;<span class="num" id="7914945">7</span><span class="op" id="7914946">,</span>&nbsp;<span class="num" id="7914948">0</span><span class="op" id="7914949">}</span><span class="op" id="7914950">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7914955">make</span><span class="op" id="7914959">(</span><span class="op" id="7914960">[</span><span class="op" id="7914961">]</span><span class="builtintype" id="7914962">byte</span><span class="op" id="7914966">,</span>&nbsp;<span class="num" id="7914968">472</span><span class="op" id="7914971">)</span><span class="op" id="7914972">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7914977">//&nbsp;header&nbsp;for&nbsp;the&nbsp;empty&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7915011">{</span><span class="num" id="7915012">1</span><span class="op" id="7915013">,</span>&nbsp;<span class="builtintype" id="7915015">byte</span><span class="op" id="7915019">(</span><span class="ident" id="7915020">typeStdin</span><span class="op" id="7915029">)</span><span class="op" id="7915030">,</span>&nbsp;<span class="num" id="7915032">0x01</span><span class="op" id="7915036">,</span>&nbsp;<span class="num" id="7915038">0x2C</span><span class="op" id="7915042">,</span>&nbsp;<span class="num" id="7915044">0</span><span class="op" id="7915045">,</span>&nbsp;<span class="num" id="7915047">0</span><span class="op" id="7915048">,</span>&nbsp;<span class="num" id="7915050">0</span><span class="op" id="7915051">,</span>&nbsp;<span class="num" id="7915053">0</span><span class="op" id="7915054">}</span><span class="op" id="7915055">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7915059">}</span><span class="op" id="7915060">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915065">nil</span><span class="op" id="7915068">)</span><span class="op" id="7915069">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7915072">}</span><span class="op" id="7915073">,</span><br>
<span class="lineno"></span><span class="op" id="7915075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7915078">type</span>&nbsp;<span class="ident" id="7915083">nilCloser</span>&nbsp;<span class="keyword" id="7915093">struct</span>&nbsp;<span class="op" id="7915100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915103">io</span><span class="op" id="7915105">.</span><span class="ident" id="7915106">ReadWriter</span><br>
<span class="lineno">70</span><span class="op" id="7915117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7915120">func</span>&nbsp;<span class="op" id="7915125">(</span><span class="ident" id="7915126">c</span>&nbsp;<span class="op" id="7915128">*</span><span class="ident" id="7915129">nilCloser</span><span class="op" id="7915138">)</span>&nbsp;<span class="ident" id="7915140">Close</span><span class="op" id="7915145">(</span><span class="op" id="7915146">)</span>&nbsp;<span class="builtintype" id="7915148">error</span>&nbsp;<span class="op" id="7915154">{</span>&nbsp;<span class="keyword" id="7915156">return</span>&nbsp;<span class="ident" id="7915163">nil</span>&nbsp;<span class="op" id="7915167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7915170">func</span>&nbsp;<span class="ident" id="7915175">TestStreams</span><span class="op" id="7915186">(</span><span class="ident" id="7915187">t</span>&nbsp;<span class="op" id="7915189">*</span><span class="ident" id="7915190">testing</span><span class="op" id="7915197">.</span><span class="ident" id="7915198">T</span><span class="op" id="7915199">)</span>&nbsp;<span class="op" id="7915201">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915204">var</span>&nbsp;<span class="ident" id="7915208">rec</span>&nbsp;<span class="ident" id="7915212">record</span><br>
<span class="lineno"></span><span class="ident" id="7915219">outer</span><span class="op" id="7915224">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915227">for</span>&nbsp;<span class="ident" id="7915231">_</span><span class="op" id="7915232">,</span>&nbsp;<span class="ident" id="7915234">test</span>&nbsp;<span class="op" id="7915239">:=</span>&nbsp;<span class="keyword" id="7915242">range</span>&nbsp;<span class="ident" id="7915248">streamTests</span>&nbsp;<span class="op" id="7915260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915264">buf</span>&nbsp;<span class="op" id="7915268">:=</span>&nbsp;<span class="ident" id="7915271">bytes</span><span class="op" id="7915276">.</span><span class="ident" id="7915277">NewBuffer</span><span class="op" id="7915286">(</span><span class="ident" id="7915287">test</span><span class="op" id="7915291">.</span><span class="ident" id="7915292">raw</span><span class="op" id="7915295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915299">var</span>&nbsp;<span class="ident" id="7915303">content</span>&nbsp;<span class="op" id="7915311">[</span><span class="op" id="7915312">]</span><span class="builtintype" id="7915313">byte</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915320">for</span>&nbsp;<span class="ident" id="7915324">buf</span><span class="op" id="7915327">.</span><span class="ident" id="7915328">Len</span><span class="op" id="7915331">(</span><span class="op" id="7915332">)</span>&nbsp;<span class="op" id="7915334">&gt;</span>&nbsp;<span class="num" id="7915336">0</span>&nbsp;<span class="op" id="7915338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915343">if</span>&nbsp;<span class="ident" id="7915346">err</span>&nbsp;<span class="op" id="7915350">:=</span>&nbsp;<span class="ident" id="7915353">rec</span><span class="op" id="7915356">.</span><span class="ident" id="7915357">read</span><span class="op" id="7915361">(</span><span class="ident" id="7915362">buf</span><span class="op" id="7915365">)</span><span class="op" id="7915366">;</span>&nbsp;<span class="ident" id="7915368">err</span>&nbsp;<span class="op" id="7915372">!=</span>&nbsp;<span class="ident" id="7915375">nil</span>&nbsp;<span class="op" id="7915379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915385">t</span><span class="op" id="7915386">.</span><span class="ident" id="7915387">Errorf</span><span class="op" id="7915393">(</span><span class="string" id="7915394">&#34;%s:&nbsp;error&nbsp;reading&nbsp;record:&nbsp;%v&#34;</span><span class="op" id="7915424">,</span>&nbsp;<span class="ident" id="7915426">test</span><span class="op" id="7915430">.</span><span class="ident" id="7915431">desc</span><span class="op" id="7915435">,</span>&nbsp;<span class="ident" id="7915437">err</span><span class="op" id="7915440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915446">continue</span>&nbsp;<span class="ident" id="7915455">outer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7915464">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915469">content</span>&nbsp;<span class="op" id="7915477">=</span>&nbsp;<span class="builtinfunc" id="7915479">append</span><span class="op" id="7915485">(</span><span class="ident" id="7915486">content</span><span class="op" id="7915493">,</span>&nbsp;<span class="ident" id="7915495">rec</span><span class="op" id="7915498">.</span><span class="ident" id="7915499">content</span><span class="op" id="7915506">(</span><span class="op" id="7915507">)</span><span class="op" id="7915508">...</span><span class="op" id="7915511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7915515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915519">if</span>&nbsp;<span class="ident" id="7915522">rec</span><span class="op" id="7915525">.</span><span class="ident" id="7915526">h</span><span class="op" id="7915527">.</span><span class="ident" id="7915528">Type</span>&nbsp;<span class="op" id="7915533">!=</span>&nbsp;<span class="ident" id="7915536">test</span><span class="op" id="7915540">.</span><span class="ident" id="7915541">recType</span>&nbsp;<span class="op" id="7915549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915554">t</span><span class="op" id="7915555">.</span><span class="ident" id="7915556">Errorf</span><span class="op" id="7915562">(</span><span class="string" id="7915563">&#34;%s:&nbsp;got&nbsp;type&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7915592">,</span>&nbsp;<span class="ident" id="7915594">test</span><span class="op" id="7915598">.</span><span class="ident" id="7915599">desc</span><span class="op" id="7915603">,</span>&nbsp;<span class="ident" id="7915605">rec</span><span class="op" id="7915608">.</span><span class="ident" id="7915609">h</span><span class="op" id="7915610">.</span><span class="ident" id="7915611">Type</span><span class="op" id="7915615">,</span>&nbsp;<span class="ident" id="7915617">test</span><span class="op" id="7915621">.</span><span class="ident" id="7915622">recType</span><span class="op" id="7915629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915634">continue</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7915645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915649">if</span>&nbsp;<span class="ident" id="7915652">rec</span><span class="op" id="7915655">.</span><span class="ident" id="7915656">h</span><span class="op" id="7915657">.</span><span class="ident" id="7915658">Id</span>&nbsp;<span class="op" id="7915661">!=</span>&nbsp;<span class="ident" id="7915664">test</span><span class="op" id="7915668">.</span><span class="ident" id="7915669">reqId</span>&nbsp;<span class="op" id="7915675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915680">t</span><span class="op" id="7915681">.</span><span class="ident" id="7915682">Errorf</span><span class="op" id="7915688">(</span><span class="string" id="7915689">&#34;%s:&nbsp;got&nbsp;request&nbsp;ID&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7915724">,</span>&nbsp;<span class="ident" id="7915726">test</span><span class="op" id="7915730">.</span><span class="ident" id="7915731">desc</span><span class="op" id="7915735">,</span>&nbsp;<span class="ident" id="7915737">rec</span><span class="op" id="7915740">.</span><span class="ident" id="7915741">h</span><span class="op" id="7915742">.</span><span class="ident" id="7915743">Id</span><span class="op" id="7915745">,</span>&nbsp;<span class="ident" id="7915747">test</span><span class="op" id="7915751">.</span><span class="ident" id="7915752">reqId</span><span class="op" id="7915757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915762">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7915773">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915777">if</span>&nbsp;<span class="op" id="7915780">!</span><span class="ident" id="7915781">bytes</span><span class="op" id="7915786">.</span><span class="ident" id="7915787">Equal</span><span class="op" id="7915792">(</span><span class="ident" id="7915793">content</span><span class="op" id="7915800">,</span>&nbsp;<span class="ident" id="7915802">test</span><span class="op" id="7915806">.</span><span class="ident" id="7915807">content</span><span class="op" id="7915814">)</span>&nbsp;<span class="op" id="7915816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915821">t</span><span class="op" id="7915822">.</span><span class="ident" id="7915823">Errorf</span><span class="op" id="7915829">(</span><span class="string" id="7915830">&#34;%s:&nbsp;read&nbsp;wrong&nbsp;content&#34;</span><span class="op" id="7915854">,</span>&nbsp;<span class="ident" id="7915856">test</span><span class="op" id="7915860">.</span><span class="ident" id="7915861">desc</span><span class="op" id="7915865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915870">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7915881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915885">buf</span><span class="op" id="7915888">.</span><span class="ident" id="7915889">Reset</span><span class="op" id="7915894">(</span><span class="op" id="7915895">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915899">c</span>&nbsp;<span class="op" id="7915901">:=</span>&nbsp;<span class="ident" id="7915904">newConn</span><span class="op" id="7915911">(</span><span class="op" id="7915912">&amp;</span><span class="ident" id="7915913">nilCloser</span><span class="op" id="7915922">{</span><span class="ident" id="7915923">buf</span><span class="op" id="7915926">}</span><span class="op" id="7915927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915931">w</span>&nbsp;<span class="op" id="7915933">:=</span>&nbsp;<span class="ident" id="7915936">newWriter</span><span class="op" id="7915945">(</span><span class="ident" id="7915946">c</span><span class="op" id="7915947">,</span>&nbsp;<span class="ident" id="7915949">test</span><span class="op" id="7915953">.</span><span class="ident" id="7915954">recType</span><span class="op" id="7915961">,</span>&nbsp;<span class="ident" id="7915963">test</span><span class="op" id="7915967">.</span><span class="ident" id="7915968">reqId</span><span class="op" id="7915973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915977">if</span>&nbsp;<span class="ident" id="7915980">_</span><span class="op" id="7915981">,</span>&nbsp;<span class="ident" id="7915983">err</span>&nbsp;<span class="op" id="7915987">:=</span>&nbsp;<span class="ident" id="7915990">w</span><span class="op" id="7915991">.</span><span class="ident" id="7915992">Write</span><span class="op" id="7915997">(</span><span class="ident" id="7915998">test</span><span class="op" id="7916002">.</span><span class="ident" id="7916003">content</span><span class="op" id="7916010">)</span><span class="op" id="7916011">;</span>&nbsp;<span class="ident" id="7916013">err</span>&nbsp;<span class="op" id="7916017">!=</span>&nbsp;<span class="ident" id="7916020">nil</span>&nbsp;<span class="op" id="7916024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916029">t</span><span class="op" id="7916030">.</span><span class="ident" id="7916031">Errorf</span><span class="op" id="7916037">(</span><span class="string" id="7916038">&#34;%s:&nbsp;error&nbsp;writing&nbsp;record:&nbsp;%v&#34;</span><span class="op" id="7916068">,</span>&nbsp;<span class="ident" id="7916070">test</span><span class="op" id="7916074">.</span><span class="ident" id="7916075">desc</span><span class="op" id="7916079">,</span>&nbsp;<span class="ident" id="7916081">err</span><span class="op" id="7916084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916089">continue</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7916100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916104">if</span>&nbsp;<span class="ident" id="7916107">err</span>&nbsp;<span class="op" id="7916111">:=</span>&nbsp;<span class="ident" id="7916114">w</span><span class="op" id="7916115">.</span><span class="ident" id="7916116">Close</span><span class="op" id="7916121">(</span><span class="op" id="7916122">)</span><span class="op" id="7916123">;</span>&nbsp;<span class="ident" id="7916125">err</span>&nbsp;<span class="op" id="7916129">!=</span>&nbsp;<span class="ident" id="7916132">nil</span>&nbsp;<span class="op" id="7916136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916141">t</span><span class="op" id="7916142">.</span><span class="ident" id="7916143">Errorf</span><span class="op" id="7916149">(</span><span class="string" id="7916150">&#34;%s:&nbsp;error&nbsp;closing&nbsp;stream:&nbsp;%v&#34;</span><span class="op" id="7916180">,</span>&nbsp;<span class="ident" id="7916182">test</span><span class="op" id="7916186">.</span><span class="ident" id="7916187">desc</span><span class="op" id="7916191">,</span>&nbsp;<span class="ident" id="7916193">err</span><span class="op" id="7916196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916201">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7916212">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916216">if</span>&nbsp;<span class="op" id="7916219">!</span><span class="ident" id="7916220">bytes</span><span class="op" id="7916225">.</span><span class="ident" id="7916226">Equal</span><span class="op" id="7916231">(</span><span class="ident" id="7916232">buf</span><span class="op" id="7916235">.</span><span class="ident" id="7916236">Bytes</span><span class="op" id="7916241">(</span><span class="op" id="7916242">)</span><span class="op" id="7916243">,</span>&nbsp;<span class="ident" id="7916245">test</span><span class="op" id="7916249">.</span><span class="ident" id="7916250">raw</span><span class="op" id="7916253">)</span>&nbsp;<span class="op" id="7916255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916260">t</span><span class="op" id="7916261">.</span><span class="ident" id="7916262">Errorf</span><span class="op" id="7916268">(</span><span class="string" id="7916269">&#34;%s:&nbsp;wrote&nbsp;wrong&nbsp;content&#34;</span><span class="op" id="7916294">,</span>&nbsp;<span class="ident" id="7916296">test</span><span class="op" id="7916300">.</span><span class="ident" id="7916301">desc</span><span class="op" id="7916305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7916309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7916312">}</span><br>
<span class="lineno"></span><span class="op" id="7916314">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="7916317">type</span>&nbsp;<span class="ident" id="7916322">writeOnlyConn</span>&nbsp;<span class="keyword" id="7916336">struct</span>&nbsp;<span class="op" id="7916343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916346">buf</span>&nbsp;<span class="op" id="7916350">[</span><span class="op" id="7916351">]</span><span class="builtintype" id="7916352">byte</span><br>
<span class="lineno"></span><span class="op" id="7916357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="7916360">func</span>&nbsp;<span class="op" id="7916365">(</span><span class="ident" id="7916366">c</span>&nbsp;<span class="op" id="7916368">*</span><span class="ident" id="7916369">writeOnlyConn</span><span class="op" id="7916382">)</span>&nbsp;<span class="ident" id="7916384">Write</span><span class="op" id="7916389">(</span><span class="ident" id="7916390">p</span>&nbsp;<span class="op" id="7916392">[</span><span class="op" id="7916393">]</span><span class="builtintype" id="7916394">byte</span><span class="op" id="7916398">)</span>&nbsp;<span class="op" id="7916400">(</span><span class="builtintype" id="7916401">int</span><span class="op" id="7916404">,</span>&nbsp;<span class="builtintype" id="7916406">error</span><span class="op" id="7916411">)</span>&nbsp;<span class="op" id="7916413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916416">c</span><span class="op" id="7916417">.</span><span class="ident" id="7916418">buf</span>&nbsp;<span class="op" id="7916422">=</span>&nbsp;<span class="builtinfunc" id="7916424">append</span><span class="op" id="7916430">(</span><span class="ident" id="7916431">c</span><span class="op" id="7916432">.</span><span class="ident" id="7916433">buf</span><span class="op" id="7916436">,</span>&nbsp;<span class="ident" id="7916438">p</span><span class="op" id="7916439">...</span><span class="op" id="7916442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916445">return</span>&nbsp;<span class="builtinfunc" id="7916452">len</span><span class="op" id="7916455">(</span><span class="ident" id="7916456">p</span><span class="op" id="7916457">)</span><span class="op" id="7916458">,</span>&nbsp;<span class="ident" id="7916460">nil</span><br>
<span class="lineno"></span><span class="op" id="7916464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="7916467">func</span>&nbsp;<span class="op" id="7916472">(</span><span class="ident" id="7916473">c</span>&nbsp;<span class="op" id="7916475">*</span><span class="ident" id="7916476">writeOnlyConn</span><span class="op" id="7916489">)</span>&nbsp;<span class="ident" id="7916491">Read</span><span class="op" id="7916495">(</span><span class="ident" id="7916496">p</span>&nbsp;<span class="op" id="7916498">[</span><span class="op" id="7916499">]</span><span class="builtintype" id="7916500">byte</span><span class="op" id="7916504">)</span>&nbsp;<span class="op" id="7916506">(</span><span class="builtintype" id="7916507">int</span><span class="op" id="7916510">,</span>&nbsp;<span class="builtintype" id="7916512">error</span><span class="op" id="7916517">)</span>&nbsp;<span class="op" id="7916519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916522">return</span>&nbsp;<span class="num" id="7916529">0</span><span class="op" id="7916530">,</span>&nbsp;<span class="ident" id="7916532">errors</span><span class="op" id="7916538">.</span><span class="ident" id="7916539">New</span><span class="op" id="7916542">(</span><span class="string" id="7916543">&#34;conn&nbsp;is&nbsp;write-only&#34;</span><span class="op" id="7916563">)</span><br>
<span class="lineno"></span><span class="op" id="7916565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7916568">func</span>&nbsp;<span class="op" id="7916573">(</span><span class="ident" id="7916574">c</span>&nbsp;<span class="op" id="7916576">*</span><span class="ident" id="7916577">writeOnlyConn</span><span class="op" id="7916590">)</span>&nbsp;<span class="ident" id="7916592">Close</span><span class="op" id="7916597">(</span><span class="op" id="7916598">)</span>&nbsp;<span class="builtintype" id="7916600">error</span>&nbsp;<span class="op" id="7916606">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916609">return</span>&nbsp;<span class="ident" id="7916616">nil</span><br>
<span class="lineno"></span><span class="op" id="7916620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7916623">func</span>&nbsp;<span class="ident" id="7916628">TestGetValues</span><span class="op" id="7916641">(</span><span class="ident" id="7916642">t</span>&nbsp;<span class="op" id="7916644">*</span><span class="ident" id="7916645">testing</span><span class="op" id="7916652">.</span><span class="ident" id="7916653">T</span><span class="op" id="7916654">)</span>&nbsp;<span class="op" id="7916656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916659">var</span>&nbsp;<span class="ident" id="7916663">rec</span>&nbsp;<span class="ident" id="7916667">record</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916675">rec</span><span class="op" id="7916678">.</span><span class="ident" id="7916679">h</span><span class="op" id="7916680">.</span><span class="ident" id="7916681">Type</span>&nbsp;<span class="op" id="7916686">=</span>&nbsp;<span class="ident" id="7916688">typeGetValues</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916704">wc</span>&nbsp;<span class="op" id="7916707">:=</span>&nbsp;<span class="builtinfunc" id="7916710">new</span><span class="op" id="7916713">(</span><span class="ident" id="7916714">writeOnlyConn</span><span class="op" id="7916727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916730">c</span>&nbsp;<span class="op" id="7916732">:=</span>&nbsp;<span class="ident" id="7916735">newChild</span><span class="op" id="7916743">(</span><span class="ident" id="7916744">wc</span><span class="op" id="7916746">,</span>&nbsp;<span class="ident" id="7916748">nil</span><span class="op" id="7916751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916754">err</span>&nbsp;<span class="op" id="7916758">:=</span>&nbsp;<span class="ident" id="7916761">c</span><span class="op" id="7916762">.</span><span class="ident" id="7916763">handleRecord</span><span class="op" id="7916775">(</span><span class="op" id="7916776">&amp;</span><span class="ident" id="7916777">rec</span><span class="op" id="7916780">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916783">if</span>&nbsp;<span class="ident" id="7916786">err</span>&nbsp;<span class="op" id="7916790">!=</span>&nbsp;<span class="ident" id="7916793">nil</span>&nbsp;<span class="op" id="7916797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916801">t</span><span class="op" id="7916802">.</span><span class="ident" id="7916803">Fatalf</span><span class="op" id="7916809">(</span><span class="string" id="7916810">&#34;handleRecord:&nbsp;%v&#34;</span><span class="op" id="7916828">,</span>&nbsp;<span class="ident" id="7916830">err</span><span class="op" id="7916833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7916836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916840">const</span>&nbsp;<span class="ident" id="7916846">want</span>&nbsp;<span class="op" id="7916851">=</span>&nbsp;<span class="string" id="7916853">&#34;\x01\n\x00\x00\x00\x12\x06\x00&#34;</span>&nbsp;<span class="op" id="7916886">+</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7916890">&#34;\x0f\x01FCGI_MPXS_CONNS1&#34;</span>&nbsp;<span class="op" id="7916917">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7916921">&#34;\x00\x00\x00\x00\x00\x00\x01\n\x00\x00\x00\x00\x00\x00&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916979">if</span>&nbsp;<span class="ident" id="7916982">got</span>&nbsp;<span class="op" id="7916986">:=</span>&nbsp;<span class="builtintype" id="7916989">string</span><span class="op" id="7916995">(</span><span class="ident" id="7916996">wc</span><span class="op" id="7916998">.</span><span class="ident" id="7916999">buf</span><span class="op" id="7917002">)</span><span class="op" id="7917003">;</span>&nbsp;<span class="ident" id="7917005">got</span>&nbsp;<span class="op" id="7917009">!=</span>&nbsp;<span class="ident" id="7917012">want</span>&nbsp;<span class="op" id="7917017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917021">t</span><span class="op" id="7917022">.</span><span class="ident" id="7917023">Errorf</span><span class="op" id="7917029">(</span><span class="string" id="7917030">&#34;&nbsp;got:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="7917052">,</span>&nbsp;<span class="ident" id="7917054">got</span><span class="op" id="7917057">,</span>&nbsp;<span class="ident" id="7917059">want</span><span class="op" id="7917063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7917066">}</span><br>
<span class="lineno">150</span><span class="op" id="7917068">}</span>
</div>
</body>
</html>
