<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/textproto</h2>
<ul>
<li><a href="/gostd/net/textproto/header.go.html">header.go</a></li>
<li><a href="/gostd/net/textproto/pipeline.go.html">pipeline.go</a></li>
<li><a href="/gostd/net/textproto/reader.go.html">reader.go</a></li>
<li><a href="/gostd/net/textproto/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/net/textproto/textproto.go.html">textproto.go</a></li>
<li><a href="/gostd/net/textproto/writer.go.html">writer.go</a></li>
<li><a href="/gostd/net/textproto/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3056813">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3056869">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3056923">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3056974">package</span>&nbsp;<span class="ident" id="3056982">textproto</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3056993">import</span>&nbsp;<span class="op" id="3057000">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3057003">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3057012">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3057021">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3057027">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3057040">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3057051">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3057061">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3057064">//&nbsp;BUG(rsc):&nbsp;To&nbsp;let&nbsp;callers&nbsp;manage&nbsp;exposure&nbsp;to&nbsp;denial&nbsp;of&nbsp;service</span><br>
<span class="lineno"></span><span class="comment" id="3057129">//&nbsp;attacks,&nbsp;Reader&nbsp;should&nbsp;allow&nbsp;them&nbsp;to&nbsp;set&nbsp;and&nbsp;reset&nbsp;a&nbsp;limit&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="3057194">//&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;from&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="3057244">//&nbsp;A&nbsp;Reader&nbsp;implements&nbsp;convenience&nbsp;methods&nbsp;for&nbsp;reading&nbsp;requests</span><br>
<span class="lineno"></span><span class="comment" id="3057308">//&nbsp;or&nbsp;responses&nbsp;from&nbsp;a&nbsp;text&nbsp;protocol&nbsp;network&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3057365">type</span>&nbsp;<span class="ident" id="3057370">Reader</span>&nbsp;<span class="keyword" id="3057377">struct</span>&nbsp;<span class="op" id="3057384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057387">R</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3057391">*</span><span class="ident" id="3057392">bufio</span><span class="op" id="3057397">.</span><span class="ident" id="3057398">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057406">dot</span>&nbsp;<span class="op" id="3057410">*</span><span class="ident" id="3057411">dotReader</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057422">buf</span>&nbsp;<span class="op" id="3057426">[</span><span class="op" id="3057427">]</span><span class="builtintype" id="3057428">byte</span>&nbsp;<span class="comment" id="3057433">//&nbsp;a&nbsp;re-usable&nbsp;buffer&nbsp;for&nbsp;readContinuedLineSlice</span><br>
<span class="lineno"></span><span class="op" id="3057482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3057485">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="3057535">func</span>&nbsp;<span class="ident" id="3057540">NewReader</span><span class="op" id="3057549">(</span><span class="ident" id="3057550">r</span>&nbsp;<span class="op" id="3057552">*</span><span class="ident" id="3057553">bufio</span><span class="op" id="3057558">.</span><span class="ident" id="3057559">Reader</span><span class="op" id="3057565">)</span>&nbsp;<span class="op" id="3057567">*</span><span class="ident" id="3057568">Reader</span>&nbsp;<span class="op" id="3057575">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057578">return</span>&nbsp;<span class="op" id="3057585">&amp;</span><span class="ident" id="3057586">Reader</span><span class="op" id="3057592">{</span><span class="ident" id="3057593">R</span><span class="op" id="3057594">:</span>&nbsp;<span class="ident" id="3057596">r</span><span class="op" id="3057597">}</span><br>
<span class="lineno"></span><span class="op" id="3057599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3057602">//&nbsp;ReadLine&nbsp;reads&nbsp;a&nbsp;single&nbsp;line&nbsp;from&nbsp;r,</span><br>
<span class="lineno"></span><span class="comment" id="3057642">//&nbsp;eliding&nbsp;the&nbsp;final&nbsp;\n&nbsp;or&nbsp;\r\n&nbsp;from&nbsp;the&nbsp;returned&nbsp;string.</span><br>
<span class="lineno">35</span><span class="keyword" id="3057700">func</span>&nbsp;<span class="op" id="3057705">(</span><span class="ident" id="3057706">r</span>&nbsp;<span class="op" id="3057708">*</span><span class="ident" id="3057709">Reader</span><span class="op" id="3057715">)</span>&nbsp;<span class="ident" id="3057717">ReadLine</span><span class="op" id="3057725">(</span><span class="op" id="3057726">)</span>&nbsp;<span class="op" id="3057728">(</span><span class="builtintype" id="3057729">string</span><span class="op" id="3057735">,</span>&nbsp;<span class="builtintype" id="3057737">error</span><span class="op" id="3057742">)</span>&nbsp;<span class="op" id="3057744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057747">line</span><span class="op" id="3057751">,</span>&nbsp;<span class="ident" id="3057753">err</span>&nbsp;<span class="op" id="3057757">:=</span>&nbsp;<span class="ident" id="3057760">r</span><span class="op" id="3057761">.</span><span class="ident" id="3057762">readLineSlice</span><span class="op" id="3057775">(</span><span class="op" id="3057776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057779">return</span>&nbsp;<span class="builtintype" id="3057786">string</span><span class="op" id="3057792">(</span><span class="ident" id="3057793">line</span><span class="op" id="3057797">)</span><span class="op" id="3057798">,</span>&nbsp;<span class="ident" id="3057800">err</span><br>
<span class="lineno"></span><span class="op" id="3057804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="3057807">//&nbsp;ReadLineBytes&nbsp;is&nbsp;like&nbsp;ReadLine&nbsp;but&nbsp;returns&nbsp;a&nbsp;[]byte&nbsp;instead&nbsp;of&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3057883">func</span>&nbsp;<span class="op" id="3057888">(</span><span class="ident" id="3057889">r</span>&nbsp;<span class="op" id="3057891">*</span><span class="ident" id="3057892">Reader</span><span class="op" id="3057898">)</span>&nbsp;<span class="ident" id="3057900">ReadLineBytes</span><span class="op" id="3057913">(</span><span class="op" id="3057914">)</span>&nbsp;<span class="op" id="3057916">(</span><span class="op" id="3057917">[</span><span class="op" id="3057918">]</span><span class="builtintype" id="3057919">byte</span><span class="op" id="3057923">,</span>&nbsp;<span class="builtintype" id="3057925">error</span><span class="op" id="3057930">)</span>&nbsp;<span class="op" id="3057932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057935">line</span><span class="op" id="3057939">,</span>&nbsp;<span class="ident" id="3057941">err</span>&nbsp;<span class="op" id="3057945">:=</span>&nbsp;<span class="ident" id="3057948">r</span><span class="op" id="3057949">.</span><span class="ident" id="3057950">readLineSlice</span><span class="op" id="3057963">(</span><span class="op" id="3057964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057967">if</span>&nbsp;<span class="ident" id="3057970">line</span>&nbsp;<span class="op" id="3057975">!=</span>&nbsp;<span class="ident" id="3057978">nil</span>&nbsp;<span class="op" id="3057982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057986">buf</span>&nbsp;<span class="op" id="3057990">:=</span>&nbsp;<span class="builtinfunc" id="3057993">make</span><span class="op" id="3057997">(</span><span class="op" id="3057998">[</span><span class="op" id="3057999">]</span><span class="builtintype" id="3058000">byte</span><span class="op" id="3058004">,</span>&nbsp;<span class="builtinfunc" id="3058006">len</span><span class="op" id="3058009">(</span><span class="ident" id="3058010">line</span><span class="op" id="3058014">)</span><span class="op" id="3058015">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3058019">copy</span><span class="op" id="3058023">(</span><span class="ident" id="3058024">buf</span><span class="op" id="3058027">,</span>&nbsp;<span class="ident" id="3058029">line</span><span class="op" id="3058033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3058037">line</span>&nbsp;<span class="op" id="3058042">=</span>&nbsp;<span class="ident" id="3058044">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3058049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058052">return</span>&nbsp;<span class="ident" id="3058059">line</span><span class="op" id="3058063">,</span>&nbsp;<span class="ident" id="3058065">err</span><br>
<span class="lineno"></span><span class="op" id="3058069">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="3058072">func</span>&nbsp;<span class="op" id="3058077">(</span><span class="ident" id="3058078">r</span>&nbsp;<span class="op" id="3058080">*</span><span class="ident" id="3058081">Reader</span><span class="op" id="3058087">)</span>&nbsp;<span class="ident" id="3058089">readLineSlice</span><span class="op" id="3058102">(</span><span class="op" id="3058103">)</span>&nbsp;<span class="op" id="3058105">(</span><span class="op" id="3058106">[</span><span class="op" id="3058107">]</span><span class="builtintype" id="3058108">byte</span><span class="op" id="3058112">,</span>&nbsp;<span class="builtintype" id="3058114">error</span><span class="op" id="3058119">)</span>&nbsp;<span class="op" id="3058121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3058124">r</span><span class="op" id="3058125">.</span><span class="ident" id="3058126">closeDot</span><span class="op" id="3058134">(</span><span class="op" id="3058135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058138">var</span>&nbsp;<span class="ident" id="3058142">line</span>&nbsp;<span class="op" id="3058147">[</span><span class="op" id="3058148">]</span><span class="builtintype" id="3058149">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058155">for</span>&nbsp;<span class="op" id="3058159">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3058163">l</span><span class="op" id="3058164">,</span>&nbsp;<span class="ident" id="3058166">more</span><span class="op" id="3058170">,</span>&nbsp;<span class="ident" id="3058172">err</span>&nbsp;<span class="op" id="3058176">:=</span>&nbsp;<span class="ident" id="3058179">r</span><span class="op" id="3058180">.</span><span class="ident" id="3058181">R</span><span class="op" id="3058182">.</span><span class="ident" id="3058183">ReadLine</span><span class="op" id="3058191">(</span><span class="op" id="3058192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058196">if</span>&nbsp;<span class="ident" id="3058199">err</span>&nbsp;<span class="op" id="3058203">!=</span>&nbsp;<span class="ident" id="3058206">nil</span>&nbsp;<span class="op" id="3058210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058215">return</span>&nbsp;<span class="ident" id="3058222">nil</span><span class="op" id="3058225">,</span>&nbsp;<span class="ident" id="3058227">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3058233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3058237">//&nbsp;Avoid&nbsp;the&nbsp;copy&nbsp;if&nbsp;the&nbsp;first&nbsp;call&nbsp;produced&nbsp;a&nbsp;full&nbsp;line.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058297">if</span>&nbsp;<span class="ident" id="3058300">line</span>&nbsp;<span class="op" id="3058305">==</span>&nbsp;<span class="ident" id="3058308">nil</span>&nbsp;<span class="op" id="3058312">&amp;&amp;</span>&nbsp;<span class="op" id="3058315">!</span><span class="ident" id="3058316">more</span>&nbsp;<span class="op" id="3058321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058326">return</span>&nbsp;<span class="ident" id="3058333">l</span><span class="op" id="3058334">,</span>&nbsp;<span class="ident" id="3058336">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3058342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3058346">line</span>&nbsp;<span class="op" id="3058351">=</span>&nbsp;<span class="builtinfunc" id="3058353">append</span><span class="op" id="3058359">(</span><span class="ident" id="3058360">line</span><span class="op" id="3058364">,</span>&nbsp;<span class="ident" id="3058366">l</span><span class="op" id="3058367">...</span><span class="op" id="3058370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058374">if</span>&nbsp;<span class="op" id="3058377">!</span><span class="ident" id="3058378">more</span>&nbsp;<span class="op" id="3058383">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058388">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3058396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3058399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058402">return</span>&nbsp;<span class="ident" id="3058409">line</span><span class="op" id="3058413">,</span>&nbsp;<span class="ident" id="3058415">nil</span><br>
<span class="lineno"></span><span class="op" id="3058419">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="3058422">//&nbsp;ReadContinuedLine&nbsp;reads&nbsp;a&nbsp;possibly&nbsp;continued&nbsp;line&nbsp;from&nbsp;r,</span><br>
<span class="lineno"></span><span class="comment" id="3058483">//&nbsp;eliding&nbsp;the&nbsp;final&nbsp;trailing&nbsp;ASCII&nbsp;white&nbsp;space.</span><br>
<span class="lineno"></span><span class="comment" id="3058532">//&nbsp;Lines&nbsp;after&nbsp;the&nbsp;first&nbsp;are&nbsp;considered&nbsp;continuations&nbsp;if&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="3058594">//&nbsp;begin&nbsp;with&nbsp;a&nbsp;space&nbsp;or&nbsp;tab&nbsp;character.&nbsp;&nbsp;In&nbsp;the&nbsp;returned&nbsp;data,</span><br>
<span class="lineno">75</span><span class="comment" id="3058657">//&nbsp;continuation&nbsp;lines&nbsp;are&nbsp;separated&nbsp;from&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="3058716">//&nbsp;only&nbsp;by&nbsp;a&nbsp;single&nbsp;space:&nbsp;the&nbsp;newline&nbsp;and&nbsp;leading&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="3058779">//&nbsp;are&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="3058795">//</span><br>
<span class="lineno"></span><span class="comment" id="3058798">//&nbsp;For&nbsp;example,&nbsp;consider&nbsp;this&nbsp;input:</span><br>
<span class="lineno">80</span><span class="comment" id="3058835">//</span><br>
<span class="lineno"></span><span class="comment" id="3058838">//&nbsp;&nbsp;&nbsp;&nbspLine&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="3058848">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;continued...</span><br>
<span class="lineno"></span><span class="comment" id="3058866">//&nbsp;&nbsp;&nbsp;&nbspLine&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="3058876">//</span><br>
<span class="lineno">85</span><span class="comment" id="3058879">//&nbsp;The&nbsp;first&nbsp;call&nbsp;to&nbsp;ReadContinuedLine&nbsp;will&nbsp;return&nbsp;&#34;Line&nbsp;1&nbsp;continued...&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3058952">//&nbsp;and&nbsp;the&nbsp;second&nbsp;will&nbsp;return&nbsp;&#34;Line&nbsp;2&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3058992">//</span><br>
<span class="lineno"></span><span class="comment" id="3058995">//&nbsp;A&nbsp;line&nbsp;consisting&nbsp;of&nbsp;only&nbsp;white&nbsp;space&nbsp;is&nbsp;never&nbsp;continued.</span><br>
<span class="lineno"></span><span class="comment" id="3059056">//</span><br>
<span class="lineno">90</span><span class="keyword" id="3059059">func</span>&nbsp;<span class="op" id="3059064">(</span><span class="ident" id="3059065">r</span>&nbsp;<span class="op" id="3059067">*</span><span class="ident" id="3059068">Reader</span><span class="op" id="3059074">)</span>&nbsp;<span class="ident" id="3059076">ReadContinuedLine</span><span class="op" id="3059093">(</span><span class="op" id="3059094">)</span>&nbsp;<span class="op" id="3059096">(</span><span class="builtintype" id="3059097">string</span><span class="op" id="3059103">,</span>&nbsp;<span class="builtintype" id="3059105">error</span><span class="op" id="3059110">)</span>&nbsp;<span class="op" id="3059112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3059115">line</span><span class="op" id="3059119">,</span>&nbsp;<span class="ident" id="3059121">err</span>&nbsp;<span class="op" id="3059125">:=</span>&nbsp;<span class="ident" id="3059128">r</span><span class="op" id="3059129">.</span><span class="ident" id="3059130">readContinuedLineSlice</span><span class="op" id="3059152">(</span><span class="op" id="3059153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3059156">return</span>&nbsp;<span class="builtintype" id="3059163">string</span><span class="op" id="3059169">(</span><span class="ident" id="3059170">line</span><span class="op" id="3059174">)</span><span class="op" id="3059175">,</span>&nbsp;<span class="ident" id="3059177">err</span><br>
<span class="lineno"></span><span class="op" id="3059181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="3059184">//&nbsp;trim&nbsp;returns&nbsp;s&nbsp;with&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;spaces&nbsp;and&nbsp;tabs&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="3059253">//&nbsp;It&nbsp;does&nbsp;not&nbsp;assume&nbsp;Unicode&nbsp;or&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="keyword" id="3059293">func</span>&nbsp;<span class="ident" id="3059298">trim</span><span class="op" id="3059302">(</span><span class="ident" id="3059303">s</span>&nbsp;<span class="op" id="3059305">[</span><span class="op" id="3059306">]</span><span class="builtintype" id="3059307">byte</span><span class="op" id="3059311">)</span>&nbsp;<span class="op" id="3059313">[</span><span class="op" id="3059314">]</span><span class="builtintype" id="3059315">byte</span>&nbsp;<span class="op" id="3059320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3059323">i</span>&nbsp;<span class="op" id="3059325">:=</span>&nbsp;<span class="num" id="3059328">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3059331">for</span>&nbsp;<span class="ident" id="3059335">i</span>&nbsp;<span class="op" id="3059337">&lt;</span>&nbsp;<span class="builtinfunc" id="3059339">len</span><span class="op" id="3059342">(</span><span class="ident" id="3059343">s</span><span class="op" id="3059344">)</span>&nbsp;<span class="op" id="3059346">&amp;&amp;</span>&nbsp;<span class="op" id="3059349">(</span><span class="ident" id="3059350">s</span><span class="op" id="3059351">[</span><span class="ident" id="3059352">i</span><span class="op" id="3059353">]</span>&nbsp;<span class="op" id="3059355">==</span>&nbsp;<span class="string" id="3059358">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3059362">||</span>&nbsp;<span class="ident" id="3059365">s</span><span class="op" id="3059366">[</span><span class="ident" id="3059367">i</span><span class="op" id="3059368">]</span>&nbsp;<span class="op" id="3059370">==</span>&nbsp;<span class="string" id="3059373">&#39;\t&#39;</span><span class="op" id="3059377">)</span>&nbsp;<span class="op" id="3059379">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3059383">i</span><span class="op" id="3059384">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3059388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3059391">n</span>&nbsp;<span class="op" id="3059393">:=</span>&nbsp;<span class="builtinfunc" id="3059396">len</span><span class="op" id="3059399">(</span><span class="ident" id="3059400">s</span><span class="op" id="3059401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3059404">for</span>&nbsp;<span class="ident" id="3059408">n</span>&nbsp;<span class="op" id="3059410">&gt;</span>&nbsp;<span class="ident" id="3059412">i</span>&nbsp;<span class="op" id="3059414">&amp;&amp;</span>&nbsp;<span class="op" id="3059417">(</span><span class="ident" id="3059418">s</span><span class="op" id="3059419">[</span><span class="ident" id="3059420">n</span><span class="op" id="3059421">-</span><span class="num" id="3059422">1</span><span class="op" id="3059423">]</span>&nbsp;<span class="op" id="3059425">==</span>&nbsp;<span class="string" id="3059428">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3059432">||</span>&nbsp;<span class="ident" id="3059435">s</span><span class="op" id="3059436">[</span><span class="ident" id="3059437">n</span><span class="op" id="3059438">-</span><span class="num" id="3059439">1</span><span class="op" id="3059440">]</span>&nbsp;<span class="op" id="3059442">==</span>&nbsp;<span class="string" id="3059445">&#39;\t&#39;</span><span class="op" id="3059449">)</span>&nbsp;<span class="op" id="3059451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3059455">n</span><span class="op" id="3059456">--</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3059460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3059463">return</span>&nbsp;<span class="ident" id="3059470">s</span><span class="op" id="3059471">[</span><span class="ident" id="3059472">i</span><span class="op" id="3059473">:</span><span class="ident" id="3059474">n</span><span class="op" id="3059475">]</span><br>
<span class="lineno"></span><span class="op" id="3059477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3059480">//&nbsp;ReadContinuedLineBytes&nbsp;is&nbsp;like&nbsp;ReadContinuedLine&nbsp;but</span><br>
<span class="lineno">110</span><span class="comment" id="3059536">//&nbsp;returns&nbsp;a&nbsp;[]byte&nbsp;instead&nbsp;of&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3059577">func</span>&nbsp;<span class="op" id="3059582">(</span><span class="ident" id="3059583">r</span>&nbsp;<span class="op" id="3059585">*</span><span class="ident" id="3059586">Reader</span><span class="op" id="3059592">)</span>&nbsp;<span class="ident" id="3059594">ReadContinuedLineBytes</span><span class="op" id="3059616">(</span><span class="op" id="3059617">)</span>&nbsp;<span class="op" id="3059619">(</span><span class="op" id="3059620">[</span><span class="op" id="3059621">]</span><span class="builtintype" id="3059622">byte</span><span class="op" id="3059626">,</span>&nbsp;<span class="builtintype" id="3059628">error</span><span class="op" id="3059633">)</span>&nbsp;<span class="op" id="3059635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3059638">line</span><span class="op" id="3059642">,</span>&nbsp;<span class="ident" id="3059644">err</span>&nbsp;<span class="op" id="3059648">:=</span>&nbsp;<span class="ident" id="3059651">r</span><span class="op" id="3059652">.</span><span class="ident" id="3059653">readContinuedLineSlice</span><span class="op" id="3059675">(</span><span class="op" id="3059676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3059679">if</span>&nbsp;<span class="ident" id="3059682">line</span>&nbsp;<span class="op" id="3059687">!=</span>&nbsp;<span class="ident" id="3059690">nil</span>&nbsp;<span class="op" id="3059694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3059698">buf</span>&nbsp;<span class="op" id="3059702">:=</span>&nbsp;<span class="builtinfunc" id="3059705">make</span><span class="op" id="3059709">(</span><span class="op" id="3059710">[</span><span class="op" id="3059711">]</span><span class="builtintype" id="3059712">byte</span><span class="op" id="3059716">,</span>&nbsp;<span class="builtinfunc" id="3059718">len</span><span class="op" id="3059721">(</span><span class="ident" id="3059722">line</span><span class="op" id="3059726">)</span><span class="op" id="3059727">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3059731">copy</span><span class="op" id="3059735">(</span><span class="ident" id="3059736">buf</span><span class="op" id="3059739">,</span>&nbsp;<span class="ident" id="3059741">line</span><span class="op" id="3059745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3059749">line</span>&nbsp;<span class="op" id="3059754">=</span>&nbsp;<span class="ident" id="3059756">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3059761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3059764">return</span>&nbsp;<span class="ident" id="3059771">line</span><span class="op" id="3059775">,</span>&nbsp;<span class="ident" id="3059777">err</span><br>
<span class="lineno"></span><span class="op" id="3059781">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="3059784">func</span>&nbsp;<span class="op" id="3059789">(</span><span class="ident" id="3059790">r</span>&nbsp;<span class="op" id="3059792">*</span><span class="ident" id="3059793">Reader</span><span class="op" id="3059799">)</span>&nbsp;<span class="ident" id="3059801">readContinuedLineSlice</span><span class="op" id="3059823">(</span><span class="op" id="3059824">)</span>&nbsp;<span class="op" id="3059826">(</span><span class="op" id="3059827">[</span><span class="op" id="3059828">]</span><span class="builtintype" id="3059829">byte</span><span class="op" id="3059833">,</span>&nbsp;<span class="builtintype" id="3059835">error</span><span class="op" id="3059840">)</span>&nbsp;<span class="op" id="3059842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3059845">//&nbsp;Read&nbsp;the&nbsp;first&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3059870">line</span><span class="op" id="3059874">,</span>&nbsp;<span class="ident" id="3059876">err</span>&nbsp;<span class="op" id="3059880">:=</span>&nbsp;<span class="ident" id="3059883">r</span><span class="op" id="3059884">.</span><span class="ident" id="3059885">readLineSlice</span><span class="op" id="3059898">(</span><span class="op" id="3059899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3059902">if</span>&nbsp;<span class="ident" id="3059905">err</span>&nbsp;<span class="op" id="3059909">!=</span>&nbsp;<span class="ident" id="3059912">nil</span>&nbsp;<span class="op" id="3059916">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3059920">return</span>&nbsp;<span class="ident" id="3059927">nil</span><span class="op" id="3059930">,</span>&nbsp;<span class="ident" id="3059932">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3059937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3059940">if</span>&nbsp;<span class="builtinfunc" id="3059943">len</span><span class="op" id="3059946">(</span><span class="ident" id="3059947">line</span><span class="op" id="3059951">)</span>&nbsp;<span class="op" id="3059953">==</span>&nbsp;<span class="num" id="3059956">0</span>&nbsp;<span class="op" id="3059958">{</span>&nbsp;<span class="comment" id="3059960">//&nbsp;blank&nbsp;line&nbsp;-&nbsp;no&nbsp;continuation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3059994">return</span>&nbsp;<span class="ident" id="3060001">line</span><span class="op" id="3060005">,</span>&nbsp;<span class="ident" id="3060007">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3060012">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3060016">//&nbsp;Optimistically&nbsp;assume&nbsp;that&nbsp;we&nbsp;have&nbsp;started&nbsp;to&nbsp;buffer&nbsp;the&nbsp;next&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3060087">//&nbsp;and&nbsp;it&nbsp;starts&nbsp;with&nbsp;an&nbsp;ASCII&nbsp;letter&nbsp;(the&nbsp;next&nbsp;header&nbsp;key),&nbsp;so&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3060159">//&nbsp;avoid&nbsp;copying&nbsp;that&nbsp;buffered&nbsp;data&nbsp;around&nbsp;in&nbsp;memory&nbsp;and&nbsp;skipping&nbsp;over</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3060231">//&nbsp;non-existent&nbsp;whitespace.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060260">if</span>&nbsp;<span class="ident" id="3060263">r</span><span class="op" id="3060264">.</span><span class="ident" id="3060265">R</span><span class="op" id="3060266">.</span><span class="ident" id="3060267">Buffered</span><span class="op" id="3060275">(</span><span class="op" id="3060276">)</span>&nbsp;<span class="op" id="3060278">&gt;</span>&nbsp;<span class="num" id="3060280">1</span>&nbsp;<span class="op" id="3060282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060286">peek</span><span class="op" id="3060290">,</span>&nbsp;<span class="ident" id="3060292">err</span>&nbsp;<span class="op" id="3060296">:=</span>&nbsp;<span class="ident" id="3060299">r</span><span class="op" id="3060300">.</span><span class="ident" id="3060301">R</span><span class="op" id="3060302">.</span><span class="ident" id="3060303">Peek</span><span class="op" id="3060307">(</span><span class="num" id="3060308">1</span><span class="op" id="3060309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060313">if</span>&nbsp;<span class="ident" id="3060316">err</span>&nbsp;<span class="op" id="3060320">==</span>&nbsp;<span class="ident" id="3060323">nil</span>&nbsp;<span class="op" id="3060327">&amp;&amp;</span>&nbsp;<span class="ident" id="3060330">isASCIILetter</span><span class="op" id="3060343">(</span><span class="ident" id="3060344">peek</span><span class="op" id="3060348">[</span><span class="num" id="3060349">0</span><span class="op" id="3060350">]</span><span class="op" id="3060351">)</span>&nbsp;<span class="op" id="3060353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060358">return</span>&nbsp;<span class="ident" id="3060365">trim</span><span class="op" id="3060369">(</span><span class="ident" id="3060370">line</span><span class="op" id="3060374">)</span><span class="op" id="3060375">,</span>&nbsp;<span class="ident" id="3060377">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3060383">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3060386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3060390">//&nbsp;ReadByte&nbsp;or&nbsp;the&nbsp;next&nbsp;readLineSlice&nbsp;will&nbsp;flush&nbsp;the&nbsp;read&nbsp;buffer;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3060457">//&nbsp;copy&nbsp;the&nbsp;slice&nbsp;into&nbsp;buf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060486">r</span><span class="op" id="3060487">.</span><span class="ident" id="3060488">buf</span>&nbsp;<span class="op" id="3060492">=</span>&nbsp;<span class="builtinfunc" id="3060494">append</span><span class="op" id="3060500">(</span><span class="ident" id="3060501">r</span><span class="op" id="3060502">.</span><span class="ident" id="3060503">buf</span><span class="op" id="3060506">[</span><span class="op" id="3060507">:</span><span class="num" id="3060508">0</span><span class="op" id="3060509">]</span><span class="op" id="3060510">,</span>&nbsp;<span class="ident" id="3060512">trim</span><span class="op" id="3060516">(</span><span class="ident" id="3060517">line</span><span class="op" id="3060521">)</span><span class="op" id="3060522">...</span><span class="op" id="3060525">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3060529">//&nbsp;Read&nbsp;continuation&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060558">for</span>&nbsp;<span class="ident" id="3060562">r</span><span class="op" id="3060563">.</span><span class="ident" id="3060564">skipSpace</span><span class="op" id="3060573">(</span><span class="op" id="3060574">)</span>&nbsp;<span class="op" id="3060576">&gt;</span>&nbsp;<span class="num" id="3060578">0</span>&nbsp;<span class="op" id="3060580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060584">line</span><span class="op" id="3060588">,</span>&nbsp;<span class="ident" id="3060590">err</span>&nbsp;<span class="op" id="3060594">:=</span>&nbsp;<span class="ident" id="3060597">r</span><span class="op" id="3060598">.</span><span class="ident" id="3060599">readLineSlice</span><span class="op" id="3060612">(</span><span class="op" id="3060613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060617">if</span>&nbsp;<span class="ident" id="3060620">err</span>&nbsp;<span class="op" id="3060624">!=</span>&nbsp;<span class="ident" id="3060627">nil</span>&nbsp;<span class="op" id="3060631">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060636">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3060644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060648">r</span><span class="op" id="3060649">.</span><span class="ident" id="3060650">buf</span>&nbsp;<span class="op" id="3060654">=</span>&nbsp;<span class="builtinfunc" id="3060656">append</span><span class="op" id="3060662">(</span><span class="ident" id="3060663">r</span><span class="op" id="3060664">.</span><span class="ident" id="3060665">buf</span><span class="op" id="3060668">,</span>&nbsp;<span class="string" id="3060670">&#39;&nbsp;&#39;</span><span class="op" id="3060673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060677">r</span><span class="op" id="3060678">.</span><span class="ident" id="3060679">buf</span>&nbsp;<span class="op" id="3060683">=</span>&nbsp;<span class="builtinfunc" id="3060685">append</span><span class="op" id="3060691">(</span><span class="ident" id="3060692">r</span><span class="op" id="3060693">.</span><span class="ident" id="3060694">buf</span><span class="op" id="3060697">,</span>&nbsp;<span class="ident" id="3060699">line</span><span class="op" id="3060703">...</span><span class="op" id="3060706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3060709">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060712">return</span>&nbsp;<span class="ident" id="3060719">r</span><span class="op" id="3060720">.</span><span class="ident" id="3060721">buf</span><span class="op" id="3060724">,</span>&nbsp;<span class="ident" id="3060726">nil</span><br>
<span class="lineno"></span><span class="op" id="3060730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3060733">//&nbsp;skipSpace&nbsp;skips&nbsp;R&nbsp;over&nbsp;all&nbsp;spaces&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="3060811">func</span>&nbsp;<span class="op" id="3060816">(</span><span class="ident" id="3060817">r</span>&nbsp;<span class="op" id="3060819">*</span><span class="ident" id="3060820">Reader</span><span class="op" id="3060826">)</span>&nbsp;<span class="ident" id="3060828">skipSpace</span><span class="op" id="3060837">(</span><span class="op" id="3060838">)</span>&nbsp;<span class="builtintype" id="3060840">int</span>&nbsp;<span class="op" id="3060844">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060847">n</span>&nbsp;<span class="op" id="3060849">:=</span>&nbsp;<span class="num" id="3060852">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060855">for</span>&nbsp;<span class="op" id="3060859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060863">c</span><span class="op" id="3060864">,</span>&nbsp;<span class="ident" id="3060866">err</span>&nbsp;<span class="op" id="3060870">:=</span>&nbsp;<span class="ident" id="3060873">r</span><span class="op" id="3060874">.</span><span class="ident" id="3060875">R</span><span class="op" id="3060876">.</span><span class="ident" id="3060877">ReadByte</span><span class="op" id="3060885">(</span><span class="op" id="3060886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060890">if</span>&nbsp;<span class="ident" id="3060893">err</span>&nbsp;<span class="op" id="3060897">!=</span>&nbsp;<span class="ident" id="3060900">nil</span>&nbsp;<span class="op" id="3060904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3060909">//&nbsp;Bufio&nbsp;will&nbsp;keep&nbsp;err&nbsp;until&nbsp;next&nbsp;read.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060952">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3060960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060964">if</span>&nbsp;<span class="ident" id="3060967">c</span>&nbsp;<span class="op" id="3060969">!=</span>&nbsp;<span class="string" id="3060972">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3060976">&amp;&amp;</span>&nbsp;<span class="ident" id="3060979">c</span>&nbsp;<span class="op" id="3060981">!=</span>&nbsp;<span class="string" id="3060984">&#39;\t&#39;</span>&nbsp;<span class="op" id="3060989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060994">r</span><span class="op" id="3060995">.</span><span class="ident" id="3060996">R</span><span class="op" id="3060997">.</span><span class="ident" id="3060998">UnreadByte</span><span class="op" id="3061008">(</span><span class="op" id="3061009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061014">break</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3061022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061026">n</span><span class="op" id="3061027">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3061031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061034">return</span>&nbsp;<span class="ident" id="3061041">n</span><br>
<span class="lineno"></span><span class="op" id="3061043">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="keyword" id="3061046">func</span>&nbsp;<span class="op" id="3061051">(</span><span class="ident" id="3061052">r</span>&nbsp;<span class="op" id="3061054">*</span><span class="ident" id="3061055">Reader</span><span class="op" id="3061061">)</span>&nbsp;<span class="ident" id="3061063">readCodeLine</span><span class="op" id="3061075">(</span><span class="ident" id="3061076">expectCode</span>&nbsp;<span class="builtintype" id="3061087">int</span><span class="op" id="3061090">)</span>&nbsp;<span class="op" id="3061092">(</span><span class="ident" id="3061093">code</span>&nbsp;<span class="builtintype" id="3061098">int</span><span class="op" id="3061101">,</span>&nbsp;<span class="ident" id="3061103">continued</span>&nbsp;<span class="builtintype" id="3061113">bool</span><span class="op" id="3061117">,</span>&nbsp;<span class="ident" id="3061119">message</span>&nbsp;<span class="builtintype" id="3061127">string</span><span class="op" id="3061133">,</span>&nbsp;<span class="ident" id="3061135">err</span>&nbsp;<span class="builtintype" id="3061139">error</span><span class="op" id="3061144">)</span>&nbsp;<span class="op" id="3061146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061149">line</span><span class="op" id="3061153">,</span>&nbsp;<span class="ident" id="3061155">err</span>&nbsp;<span class="op" id="3061159">:=</span>&nbsp;<span class="ident" id="3061162">r</span><span class="op" id="3061163">.</span><span class="ident" id="3061164">ReadLine</span><span class="op" id="3061172">(</span><span class="op" id="3061173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061176">if</span>&nbsp;<span class="ident" id="3061179">err</span>&nbsp;<span class="op" id="3061183">!=</span>&nbsp;<span class="ident" id="3061186">nil</span>&nbsp;<span class="op" id="3061190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061194">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3061202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061205">return</span>&nbsp;<span class="ident" id="3061212">parseCodeLine</span><span class="op" id="3061225">(</span><span class="ident" id="3061226">line</span><span class="op" id="3061230">,</span>&nbsp;<span class="ident" id="3061232">expectCode</span><span class="op" id="3061242">)</span><br>
<span class="lineno"></span><span class="op" id="3061244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3061247">func</span>&nbsp;<span class="ident" id="3061252">parseCodeLine</span><span class="op" id="3061265">(</span><span class="ident" id="3061266">line</span>&nbsp;<span class="builtintype" id="3061271">string</span><span class="op" id="3061277">,</span>&nbsp;<span class="ident" id="3061279">expectCode</span>&nbsp;<span class="builtintype" id="3061290">int</span><span class="op" id="3061293">)</span>&nbsp;<span class="op" id="3061295">(</span><span class="ident" id="3061296">code</span>&nbsp;<span class="builtintype" id="3061301">int</span><span class="op" id="3061304">,</span>&nbsp;<span class="ident" id="3061306">continued</span>&nbsp;<span class="builtintype" id="3061316">bool</span><span class="op" id="3061320">,</span>&nbsp;<span class="ident" id="3061322">message</span>&nbsp;<span class="builtintype" id="3061330">string</span><span class="op" id="3061336">,</span>&nbsp;<span class="ident" id="3061338">err</span>&nbsp;<span class="builtintype" id="3061342">error</span><span class="op" id="3061347">)</span>&nbsp;<span class="op" id="3061349">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061352">if</span>&nbsp;<span class="builtinfunc" id="3061355">len</span><span class="op" id="3061358">(</span><span class="ident" id="3061359">line</span><span class="op" id="3061363">)</span>&nbsp;<span class="op" id="3061365">&lt;</span>&nbsp;<span class="num" id="3061367">4</span>&nbsp;<span class="op" id="3061369">||</span>&nbsp;<span class="ident" id="3061372">line</span><span class="op" id="3061376">[</span><span class="num" id="3061377">3</span><span class="op" id="3061378">]</span>&nbsp;<span class="op" id="3061380">!=</span>&nbsp;<span class="string" id="3061383">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3061387">&amp;&amp;</span>&nbsp;<span class="ident" id="3061390">line</span><span class="op" id="3061394">[</span><span class="num" id="3061395">3</span><span class="op" id="3061396">]</span>&nbsp;<span class="op" id="3061398">!=</span>&nbsp;<span class="string" id="3061401">&#39;-&#39;</span>&nbsp;<span class="op" id="3061405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061409">err</span>&nbsp;<span class="op" id="3061413">=</span>&nbsp;<span class="ident" id="3061415">ProtocolError</span><span class="op" id="3061428">(</span><span class="string" id="3061429">&#34;short&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="3061448">+</span>&nbsp;<span class="ident" id="3061450">line</span><span class="op" id="3061454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061458">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3061466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061469">continued</span>&nbsp;<span class="op" id="3061479">=</span>&nbsp;<span class="ident" id="3061481">line</span><span class="op" id="3061485">[</span><span class="num" id="3061486">3</span><span class="op" id="3061487">]</span>&nbsp;<span class="op" id="3061489">==</span>&nbsp;<span class="string" id="3061492">&#39;-&#39;</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061497">code</span><span class="op" id="3061501">,</span>&nbsp;<span class="ident" id="3061503">err</span>&nbsp;<span class="op" id="3061507">=</span>&nbsp;<span class="ident" id="3061509">strconv</span><span class="op" id="3061516">.</span><span class="ident" id="3061517">Atoi</span><span class="op" id="3061521">(</span><span class="ident" id="3061522">line</span><span class="op" id="3061526">[</span><span class="num" id="3061527">0</span><span class="op" id="3061528">:</span><span class="num" id="3061529">3</span><span class="op" id="3061530">]</span><span class="op" id="3061531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061534">if</span>&nbsp;<span class="ident" id="3061537">err</span>&nbsp;<span class="op" id="3061541">!=</span>&nbsp;<span class="ident" id="3061544">nil</span>&nbsp;<span class="op" id="3061548">||</span>&nbsp;<span class="ident" id="3061551">code</span>&nbsp;<span class="op" id="3061556">&lt;</span>&nbsp;<span class="num" id="3061558">100</span>&nbsp;<span class="op" id="3061562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061566">err</span>&nbsp;<span class="op" id="3061570">=</span>&nbsp;<span class="ident" id="3061572">ProtocolError</span><span class="op" id="3061585">(</span><span class="string" id="3061586">&#34;invalid&nbsp;response&nbsp;code:&nbsp;&#34;</span>&nbsp;<span class="op" id="3061612">+</span>&nbsp;<span class="ident" id="3061614">line</span><span class="op" id="3061618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061622">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3061630">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061633">message</span>&nbsp;<span class="op" id="3061641">=</span>&nbsp;<span class="ident" id="3061643">line</span><span class="op" id="3061647">[</span><span class="num" id="3061648">4</span><span class="op" id="3061649">:</span><span class="op" id="3061650">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061653">if</span>&nbsp;<span class="num" id="3061656">1</span>&nbsp;<span class="op" id="3061658">&lt;=</span>&nbsp;<span class="ident" id="3061661">expectCode</span>&nbsp;<span class="op" id="3061672">&amp;&amp;</span>&nbsp;<span class="ident" id="3061675">expectCode</span>&nbsp;<span class="op" id="3061686">&lt;</span>&nbsp;<span class="num" id="3061688">10</span>&nbsp;<span class="op" id="3061691">&amp;&amp;</span>&nbsp;<span class="ident" id="3061694">code</span><span class="op" id="3061698">/</span><span class="num" id="3061699">100</span>&nbsp;<span class="op" id="3061703">!=</span>&nbsp;<span class="ident" id="3061706">expectCode</span>&nbsp;<span class="op" id="3061717">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3061722">10</span>&nbsp;<span class="op" id="3061725">&lt;=</span>&nbsp;<span class="ident" id="3061728">expectCode</span>&nbsp;<span class="op" id="3061739">&amp;&amp;</span>&nbsp;<span class="ident" id="3061742">expectCode</span>&nbsp;<span class="op" id="3061753">&lt;</span>&nbsp;<span class="num" id="3061755">100</span>&nbsp;<span class="op" id="3061759">&amp;&amp;</span>&nbsp;<span class="ident" id="3061762">code</span><span class="op" id="3061766">/</span><span class="num" id="3061767">10</span>&nbsp;<span class="op" id="3061770">!=</span>&nbsp;<span class="ident" id="3061773">expectCode</span>&nbsp;<span class="op" id="3061784">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3061789">100</span>&nbsp;<span class="op" id="3061793">&lt;=</span>&nbsp;<span class="ident" id="3061796">expectCode</span>&nbsp;<span class="op" id="3061807">&amp;&amp;</span>&nbsp;<span class="ident" id="3061810">expectCode</span>&nbsp;<span class="op" id="3061821">&lt;</span>&nbsp;<span class="num" id="3061823">1000</span>&nbsp;<span class="op" id="3061828">&amp;&amp;</span>&nbsp;<span class="ident" id="3061831">code</span>&nbsp;<span class="op" id="3061836">!=</span>&nbsp;<span class="ident" id="3061839">expectCode</span>&nbsp;<span class="op" id="3061850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061854">err</span>&nbsp;<span class="op" id="3061858">=</span>&nbsp;<span class="op" id="3061860">&amp;</span><span class="ident" id="3061861">Error</span><span class="op" id="3061866">{</span><span class="ident" id="3061867">code</span><span class="op" id="3061871">,</span>&nbsp;<span class="ident" id="3061873">message</span><span class="op" id="3061880">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3061883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061886">return</span><br>
<span class="lineno"></span><span class="op" id="3061893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3061896">//&nbsp;ReadCodeLine&nbsp;reads&nbsp;a&nbsp;response&nbsp;code&nbsp;line&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno">205</span><span class="comment" id="3061951">//&nbsp;&nbsp;&nbsp;&nbspcode&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="3061967">//&nbsp;where&nbsp;code&nbsp;is&nbsp;a&nbsp;three-digit&nbsp;status&nbsp;code&nbsp;and&nbsp;the&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="3062026">//&nbsp;extends&nbsp;to&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;line.&nbsp;&nbsp;An&nbsp;example&nbsp;of&nbsp;such&nbsp;a&nbsp;line&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="3062093">//&nbsp;&nbsp;&nbsp;&nbsp220&nbsp;plan9.bell-labs.com&nbsp;ESMTP</span><br>
<span class="lineno"></span><span class="comment" id="3062126">//</span><br>
<span class="lineno">210</span><span class="comment" id="3062129">//&nbsp;If&nbsp;the&nbsp;prefix&nbsp;of&nbsp;the&nbsp;status&nbsp;does&nbsp;not&nbsp;match&nbsp;the&nbsp;digits&nbsp;in&nbsp;expectCode,</span><br>
<span class="lineno"></span><span class="comment" id="3062201">//&nbsp;ReadCodeLine&nbsp;returns&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;&amp;Error{code,&nbsp;message}.</span><br>
<span class="lineno"></span><span class="comment" id="3062264">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;expectCode&nbsp;is&nbsp;31,&nbsp;an&nbsp;error&nbsp;will&nbsp;be&nbsp;returned&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3062330">//&nbsp;the&nbsp;status&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;range&nbsp;[310,319].</span><br>
<span class="lineno"></span><span class="comment" id="3062375">//</span><br>
<span class="lineno">215</span><span class="comment" id="3062378">//&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;multi-line,&nbsp;ReadCodeLine&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3062443">//</span><br>
<span class="lineno"></span><span class="comment" id="3062446">//&nbsp;An&nbsp;expectCode&nbsp;&lt;=&nbsp;0&nbsp;disables&nbsp;the&nbsp;check&nbsp;of&nbsp;the&nbsp;status&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="3062507">//</span><br>
<span class="lineno"></span><span class="keyword" id="3062510">func</span>&nbsp;<span class="op" id="3062515">(</span><span class="ident" id="3062516">r</span>&nbsp;<span class="op" id="3062518">*</span><span class="ident" id="3062519">Reader</span><span class="op" id="3062525">)</span>&nbsp;<span class="ident" id="3062527">ReadCodeLine</span><span class="op" id="3062539">(</span><span class="ident" id="3062540">expectCode</span>&nbsp;<span class="builtintype" id="3062551">int</span><span class="op" id="3062554">)</span>&nbsp;<span class="op" id="3062556">(</span><span class="ident" id="3062557">code</span>&nbsp;<span class="builtintype" id="3062562">int</span><span class="op" id="3062565">,</span>&nbsp;<span class="ident" id="3062567">message</span>&nbsp;<span class="builtintype" id="3062575">string</span><span class="op" id="3062581">,</span>&nbsp;<span class="ident" id="3062583">err</span>&nbsp;<span class="builtintype" id="3062587">error</span><span class="op" id="3062592">)</span>&nbsp;<span class="op" id="3062594">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3062597">code</span><span class="op" id="3062601">,</span>&nbsp;<span class="ident" id="3062603">continued</span><span class="op" id="3062612">,</span>&nbsp;<span class="ident" id="3062614">message</span><span class="op" id="3062621">,</span>&nbsp;<span class="ident" id="3062623">err</span>&nbsp;<span class="op" id="3062627">:=</span>&nbsp;<span class="ident" id="3062630">r</span><span class="op" id="3062631">.</span><span class="ident" id="3062632">readCodeLine</span><span class="op" id="3062644">(</span><span class="ident" id="3062645">expectCode</span><span class="op" id="3062655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062658">if</span>&nbsp;<span class="ident" id="3062661">err</span>&nbsp;<span class="op" id="3062665">==</span>&nbsp;<span class="ident" id="3062668">nil</span>&nbsp;<span class="op" id="3062672">&amp;&amp;</span>&nbsp;<span class="ident" id="3062675">continued</span>&nbsp;<span class="op" id="3062685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3062689">err</span>&nbsp;<span class="op" id="3062693">=</span>&nbsp;<span class="ident" id="3062695">ProtocolError</span><span class="op" id="3062708">(</span><span class="string" id="3062709">&#34;unexpected&nbsp;multi-line&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="3062744">+</span>&nbsp;<span class="ident" id="3062746">message</span><span class="op" id="3062753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3062756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062759">return</span><br>
<span class="lineno">225</span><span class="op" id="3062766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3062769">//&nbsp;ReadResponse&nbsp;reads&nbsp;a&nbsp;multi-line&nbsp;response&nbsp;of&nbsp;the&nbsp;form:</span><br>
<span class="lineno"></span><span class="comment" id="3062826">//</span><br>
<span class="lineno"></span><span class="comment" id="3062829">//&nbsp;&nbsp;&nbsp;&nbspcode-message&nbsp;line&nbsp;1</span><br>
<span class="lineno">230</span><span class="comment" id="3062852">//&nbsp;&nbsp;&nbsp;&nbspcode-message&nbsp;line&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="3062875">//&nbsp;&nbsp;&nbsp;&nbsp...</span><br>
<span class="lineno"></span><span class="comment" id="3062882">//&nbsp;&nbsp;&nbsp;&nbspcode&nbsp;message&nbsp;line&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="3062905">//</span><br>
<span class="lineno"></span><span class="comment" id="3062908">//&nbsp;where&nbsp;code&nbsp;is&nbsp;a&nbsp;three-digit&nbsp;status&nbsp;code.&nbsp;The&nbsp;first&nbsp;line&nbsp;starts&nbsp;with&nbsp;the</span><br>
<span class="lineno">235</span><span class="comment" id="3062983">//&nbsp;code&nbsp;and&nbsp;a&nbsp;hyphen.&nbsp;The&nbsp;response&nbsp;is&nbsp;terminated&nbsp;by&nbsp;a&nbsp;line&nbsp;that&nbsp;starts</span><br>
<span class="lineno"></span><span class="comment" id="3063054">//&nbsp;with&nbsp;the&nbsp;same&nbsp;code&nbsp;followed&nbsp;by&nbsp;a&nbsp;space.&nbsp;Each&nbsp;line&nbsp;in&nbsp;message&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3063121">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;newline&nbsp;(\n).</span><br>
<span class="lineno"></span><span class="comment" id="3063153">//</span><br>
<span class="lineno"></span><span class="comment" id="3063156">//&nbsp;See&nbsp;page&nbsp;36&nbsp;of&nbsp;RFC&nbsp;959&nbsp;(http://www.ietf.org/rfc/rfc959.txt)&nbsp;for</span><br>
<span class="lineno">240</span><span class="comment" id="3063223">//&nbsp;details.</span><br>
<span class="lineno"></span><span class="comment" id="3063235">//</span><br>
<span class="lineno"></span><span class="comment" id="3063238">//&nbsp;If&nbsp;the&nbsp;prefix&nbsp;of&nbsp;the&nbsp;status&nbsp;does&nbsp;not&nbsp;match&nbsp;the&nbsp;digits&nbsp;in&nbsp;expectCode,</span><br>
<span class="lineno"></span><span class="comment" id="3063310">//&nbsp;ReadResponse&nbsp;returns&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;&amp;Error{code,&nbsp;message}.</span><br>
<span class="lineno"></span><span class="comment" id="3063373">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;expectCode&nbsp;is&nbsp;31,&nbsp;an&nbsp;error&nbsp;will&nbsp;be&nbsp;returned&nbsp;if</span><br>
<span class="lineno">245</span><span class="comment" id="3063439">//&nbsp;the&nbsp;status&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;range&nbsp;[310,319].</span><br>
<span class="lineno"></span><span class="comment" id="3063484">//</span><br>
<span class="lineno"></span><span class="comment" id="3063487">//&nbsp;An&nbsp;expectCode&nbsp;&lt;=&nbsp;0&nbsp;disables&nbsp;the&nbsp;check&nbsp;of&nbsp;the&nbsp;status&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="3063548">//</span><br>
<span class="lineno"></span><span class="keyword" id="3063551">func</span>&nbsp;<span class="op" id="3063556">(</span><span class="ident" id="3063557">r</span>&nbsp;<span class="op" id="3063559">*</span><span class="ident" id="3063560">Reader</span><span class="op" id="3063566">)</span>&nbsp;<span class="ident" id="3063568">ReadResponse</span><span class="op" id="3063580">(</span><span class="ident" id="3063581">expectCode</span>&nbsp;<span class="builtintype" id="3063592">int</span><span class="op" id="3063595">)</span>&nbsp;<span class="op" id="3063597">(</span><span class="ident" id="3063598">code</span>&nbsp;<span class="builtintype" id="3063603">int</span><span class="op" id="3063606">,</span>&nbsp;<span class="ident" id="3063608">message</span>&nbsp;<span class="builtintype" id="3063616">string</span><span class="op" id="3063622">,</span>&nbsp;<span class="ident" id="3063624">err</span>&nbsp;<span class="builtintype" id="3063628">error</span><span class="op" id="3063633">)</span>&nbsp;<span class="op" id="3063635">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063638">code</span><span class="op" id="3063642">,</span>&nbsp;<span class="ident" id="3063644">continued</span><span class="op" id="3063653">,</span>&nbsp;<span class="ident" id="3063655">message</span><span class="op" id="3063662">,</span>&nbsp;<span class="ident" id="3063664">err</span>&nbsp;<span class="op" id="3063668">:=</span>&nbsp;<span class="ident" id="3063671">r</span><span class="op" id="3063672">.</span><span class="ident" id="3063673">readCodeLine</span><span class="op" id="3063685">(</span><span class="ident" id="3063686">expectCode</span><span class="op" id="3063696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3063699">for</span>&nbsp;<span class="ident" id="3063703">err</span>&nbsp;<span class="op" id="3063707">==</span>&nbsp;<span class="ident" id="3063710">nil</span>&nbsp;<span class="op" id="3063714">&amp;&amp;</span>&nbsp;<span class="ident" id="3063717">continued</span>&nbsp;<span class="op" id="3063727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063731">line</span><span class="op" id="3063735">,</span>&nbsp;<span class="ident" id="3063737">err</span>&nbsp;<span class="op" id="3063741">:=</span>&nbsp;<span class="ident" id="3063744">r</span><span class="op" id="3063745">.</span><span class="ident" id="3063746">ReadLine</span><span class="op" id="3063754">(</span><span class="op" id="3063755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3063759">if</span>&nbsp;<span class="ident" id="3063762">err</span>&nbsp;<span class="op" id="3063766">!=</span>&nbsp;<span class="ident" id="3063769">nil</span>&nbsp;<span class="op" id="3063773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3063778">return</span>&nbsp;<span class="num" id="3063785">0</span><span class="op" id="3063786">,</span>&nbsp;<span class="string" id="3063788">&#34;&#34;</span><span class="op" id="3063790">,</span>&nbsp;<span class="ident" id="3063792">err</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3063798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3063803">var</span>&nbsp;<span class="ident" id="3063807">code2</span>&nbsp;<span class="builtintype" id="3063813">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3063819">var</span>&nbsp;<span class="ident" id="3063823">moreMessage</span>&nbsp;<span class="builtintype" id="3063835">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063844">code2</span><span class="op" id="3063849">,</span>&nbsp;<span class="ident" id="3063851">continued</span><span class="op" id="3063860">,</span>&nbsp;<span class="ident" id="3063862">moreMessage</span><span class="op" id="3063873">,</span>&nbsp;<span class="ident" id="3063875">err</span>&nbsp;<span class="op" id="3063879">=</span>&nbsp;<span class="ident" id="3063881">parseCodeLine</span><span class="op" id="3063894">(</span><span class="ident" id="3063895">line</span><span class="op" id="3063899">,</span>&nbsp;<span class="ident" id="3063901">expectCode</span><span class="op" id="3063911">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3063915">if</span>&nbsp;<span class="ident" id="3063918">err</span>&nbsp;<span class="op" id="3063922">!=</span>&nbsp;<span class="ident" id="3063925">nil</span>&nbsp;<span class="op" id="3063929">||</span>&nbsp;<span class="ident" id="3063932">code2</span>&nbsp;<span class="op" id="3063938">!=</span>&nbsp;<span class="ident" id="3063941">code</span>&nbsp;<span class="op" id="3063946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063951">message</span>&nbsp;<span class="op" id="3063959">+=</span>&nbsp;<span class="string" id="3063962">&#34;\n&#34;</span>&nbsp;<span class="op" id="3063967">+</span>&nbsp;<span class="ident" id="3063969">strings</span><span class="op" id="3063976">.</span><span class="ident" id="3063977">TrimRight</span><span class="op" id="3063986">(</span><span class="ident" id="3063987">line</span><span class="op" id="3063991">,</span>&nbsp;<span class="string" id="3063993">&#34;\r\n&#34;</span><span class="op" id="3063999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064004">continued</span>&nbsp;<span class="op" id="3064014">=</span>&nbsp;<span class="builtintype" id="3064016">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064024">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3064035">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064039">message</span>&nbsp;<span class="op" id="3064047">+=</span>&nbsp;<span class="string" id="3064050">&#34;\n&#34;</span>&nbsp;<span class="op" id="3064055">+</span>&nbsp;<span class="ident" id="3064057">moreMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3064070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064073">return</span><br>
<span class="lineno"></span><span class="op" id="3064080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="3064083">//&nbsp;DotReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;that&nbsp;satisfies&nbsp;Reads&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3064148">//&nbsp;decoded&nbsp;text&nbsp;of&nbsp;a&nbsp;dot-encoded&nbsp;block&nbsp;read&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3064200">//&nbsp;The&nbsp;returned&nbsp;Reader&nbsp;is&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="3064257">//&nbsp;to&nbsp;a&nbsp;method&nbsp;on&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3064278">//</span><br>
<span class="lineno">275</span><span class="comment" id="3064281">//&nbsp;Dot&nbsp;encoding&nbsp;is&nbsp;a&nbsp;common&nbsp;framing&nbsp;used&nbsp;for&nbsp;data&nbsp;blocks</span><br>
<span class="lineno"></span><span class="comment" id="3064338">//&nbsp;in&nbsp;text&nbsp;protocols&nbsp;such&nbsp;as&nbsp;SMTP.&nbsp;&nbsp;The&nbsp;data&nbsp;consists&nbsp;of&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="3064406">//&nbsp;of&nbsp;lines,&nbsp;each&nbsp;of&nbsp;which&nbsp;ends&nbsp;in&nbsp;&#34;\r\n&#34;.&nbsp;&nbsp;The&nbsp;sequence&nbsp;itself</span><br>
<span class="lineno"></span><span class="comment" id="3064470">//&nbsp;ends&nbsp;at&nbsp;a&nbsp;line&nbsp;containing&nbsp;just&nbsp;a&nbsp;dot:&nbsp;&#34;.\r\n&#34;.&nbsp;&nbsp;Lines&nbsp;beginning</span><br>
<span class="lineno"></span><span class="comment" id="3064537">//&nbsp;with&nbsp;a&nbsp;dot&nbsp;are&nbsp;escaped&nbsp;with&nbsp;an&nbsp;additional&nbsp;dot&nbsp;to&nbsp;avoid</span><br>
<span class="lineno">280</span><span class="comment" id="3064595">//&nbsp;looking&nbsp;like&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="3064636">//</span><br>
<span class="lineno"></span><span class="comment" id="3064639">//&nbsp;The&nbsp;decoded&nbsp;form&nbsp;returned&nbsp;by&nbsp;the&nbsp;Reader&#39;s&nbsp;Read&nbsp;method</span><br>
<span class="lineno"></span><span class="comment" id="3064696">//&nbsp;rewrites&nbsp;the&nbsp;&#34;\r\n&#34;&nbsp;line&nbsp;endings&nbsp;into&nbsp;the&nbsp;simpler&nbsp;&#34;\n&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3064755">//&nbsp;removes&nbsp;leading&nbsp;dot&nbsp;escapes&nbsp;if&nbsp;present,&nbsp;and&nbsp;stops&nbsp;with&nbsp;error&nbsp;io.EOF</span><br>
<span class="lineno">285</span><span class="comment" id="3064826">//&nbsp;after&nbsp;consuming&nbsp;(and&nbsp;discarding)&nbsp;the&nbsp;end-of-sequence&nbsp;line.</span><br>
<span class="lineno"></span><span class="keyword" id="3064888">func</span>&nbsp;<span class="op" id="3064893">(</span><span class="ident" id="3064894">r</span>&nbsp;<span class="op" id="3064896">*</span><span class="ident" id="3064897">Reader</span><span class="op" id="3064903">)</span>&nbsp;<span class="ident" id="3064905">DotReader</span><span class="op" id="3064914">(</span><span class="op" id="3064915">)</span>&nbsp;<span class="ident" id="3064917">io</span><span class="op" id="3064919">.</span><span class="ident" id="3064920">Reader</span>&nbsp;<span class="op" id="3064927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064930">r</span><span class="op" id="3064931">.</span><span class="ident" id="3064932">closeDot</span><span class="op" id="3064940">(</span><span class="op" id="3064941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064944">r</span><span class="op" id="3064945">.</span><span class="ident" id="3064946">dot</span>&nbsp;<span class="op" id="3064950">=</span>&nbsp;<span class="op" id="3064952">&amp;</span><span class="ident" id="3064953">dotReader</span><span class="op" id="3064962">{</span><span class="ident" id="3064963">r</span><span class="op" id="3064964">:</span>&nbsp;<span class="ident" id="3064966">r</span><span class="op" id="3064967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064970">return</span>&nbsp;<span class="ident" id="3064977">r</span><span class="op" id="3064978">.</span><span class="ident" id="3064979">dot</span><br>
<span class="lineno">290</span><span class="op" id="3064983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3064986">type</span>&nbsp;<span class="ident" id="3064991">dotReader</span>&nbsp;<span class="keyword" id="3065001">struct</span>&nbsp;<span class="op" id="3065008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3065011">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3065017">*</span><span class="ident" id="3065018">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3065026">state</span>&nbsp;<span class="builtintype" id="3065032">int</span><br>
<span class="lineno">295</span><span class="op" id="3065036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3065039">//&nbsp;Read&nbsp;satisfies&nbsp;reads&nbsp;by&nbsp;decoding&nbsp;dot-encoded&nbsp;data&nbsp;read&nbsp;from&nbsp;d.r.</span><br>
<span class="lineno"></span><span class="keyword" id="3065107">func</span>&nbsp;<span class="op" id="3065112">(</span><span class="ident" id="3065113">d</span>&nbsp;<span class="op" id="3065115">*</span><span class="ident" id="3065116">dotReader</span><span class="op" id="3065125">)</span>&nbsp;<span class="ident" id="3065127">Read</span><span class="op" id="3065131">(</span><span class="ident" id="3065132">b</span>&nbsp;<span class="op" id="3065134">[</span><span class="op" id="3065135">]</span><span class="builtintype" id="3065136">byte</span><span class="op" id="3065140">)</span>&nbsp;<span class="op" id="3065142">(</span><span class="ident" id="3065143">n</span>&nbsp;<span class="builtintype" id="3065145">int</span><span class="op" id="3065148">,</span>&nbsp;<span class="ident" id="3065150">err</span>&nbsp;<span class="builtintype" id="3065154">error</span><span class="op" id="3065159">)</span>&nbsp;<span class="op" id="3065161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3065164">//&nbsp;Run&nbsp;data&nbsp;through&nbsp;a&nbsp;simple&nbsp;state&nbsp;machine&nbsp;to</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3065211">//&nbsp;elide&nbsp;leading&nbsp;dots,&nbsp;rewrite&nbsp;trailing&nbsp;\r\n&nbsp;into&nbsp;\n,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3065266">//&nbsp;and&nbsp;detect&nbsp;ending&nbsp;.\r\n&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3065300">const</span>&nbsp;<span class="op" id="3065306">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3065310">stateBeginLine</span>&nbsp;<span class="op" id="3065325">=</span>&nbsp;<span class="ident" id="3065327">iota</span>&nbsp;<span class="comment" id="3065332">//&nbsp;beginning&nbsp;of&nbsp;line;&nbsp;initial&nbsp;state;&nbsp;must&nbsp;be&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3065384">stateDot</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3065406">//&nbsp;read&nbsp;.&nbsp;at&nbsp;beginning&nbsp;of&nbsp;line</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3065439">stateDotCR</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3065461">//&nbsp;read&nbsp;.\r&nbsp;at&nbsp;beginning&nbsp;of&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3065496">stateCR</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3065518">//&nbsp;read&nbsp;\r&nbsp;(possibly&nbsp;at&nbsp;end&nbsp;of&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3065557">stateData</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3065579">//&nbsp;reading&nbsp;data&nbsp;in&nbsp;middle&nbsp;of&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3065615">stateEOF</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3065637">//&nbsp;reached&nbsp;.\r\n&nbsp;end&nbsp;marker&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3065671">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3065674">br</span>&nbsp;<span class="op" id="3065677">:=</span>&nbsp;<span class="ident" id="3065680">d</span><span class="op" id="3065681">.</span><span class="ident" id="3065682">r</span><span class="op" id="3065683">.</span><span class="ident" id="3065684">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3065687">for</span>&nbsp;<span class="ident" id="3065691">n</span>&nbsp;<span class="op" id="3065693">&lt;</span>&nbsp;<span class="builtinfunc" id="3065695">len</span><span class="op" id="3065698">(</span><span class="ident" id="3065699">b</span><span class="op" id="3065700">)</span>&nbsp;<span class="op" id="3065702">&amp;&amp;</span>&nbsp;<span class="ident" id="3065705">d</span><span class="op" id="3065706">.</span><span class="ident" id="3065707">state</span>&nbsp;<span class="op" id="3065713">!=</span>&nbsp;<span class="ident" id="3065716">stateEOF</span>&nbsp;<span class="op" id="3065725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3065729">var</span>&nbsp;<span class="ident" id="3065733">c</span>&nbsp;<span class="builtintype" id="3065735">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3065742">c</span><span class="op" id="3065743">,</span>&nbsp;<span class="ident" id="3065745">err</span>&nbsp;<span class="op" id="3065749">=</span>&nbsp;<span class="ident" id="3065751">br</span><span class="op" id="3065753">.</span><span class="ident" id="3065754">ReadByte</span><span class="op" id="3065762">(</span><span class="op" id="3065763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3065767">if</span>&nbsp;<span class="ident" id="3065770">err</span>&nbsp;<span class="op" id="3065774">!=</span>&nbsp;<span class="ident" id="3065777">nil</span>&nbsp;<span class="op" id="3065781">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3065786">if</span>&nbsp;<span class="ident" id="3065789">err</span>&nbsp;<span class="op" id="3065793">==</span>&nbsp;<span class="ident" id="3065796">io</span><span class="op" id="3065798">.</span><span class="ident" id="3065799">EOF</span>&nbsp;<span class="op" id="3065803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3065809">err</span>&nbsp;<span class="op" id="3065813">=</span>&nbsp;<span class="ident" id="3065815">io</span><span class="op" id="3065817">.</span><span class="ident" id="3065818">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3065838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3065843">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3065851">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3065855">switch</span>&nbsp;<span class="ident" id="3065862">d</span><span class="op" id="3065863">.</span><span class="ident" id="3065864">state</span>&nbsp;<span class="op" id="3065870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3065874">case</span>&nbsp;<span class="ident" id="3065879">stateBeginLine</span><span class="op" id="3065893">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3065898">if</span>&nbsp;<span class="ident" id="3065901">c</span>&nbsp;<span class="op" id="3065903">==</span>&nbsp;<span class="string" id="3065906">&#39;.&#39;</span>&nbsp;<span class="op" id="3065910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3065916">d</span><span class="op" id="3065917">.</span><span class="ident" id="3065918">state</span>&nbsp;<span class="op" id="3065924">=</span>&nbsp;<span class="ident" id="3065926">stateDot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3065939">continue</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3065951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3065956">if</span>&nbsp;<span class="ident" id="3065959">c</span>&nbsp;<span class="op" id="3065961">==</span>&nbsp;<span class="string" id="3065964">&#39;\r&#39;</span>&nbsp;<span class="op" id="3065969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3065975">d</span><span class="op" id="3065976">.</span><span class="ident" id="3065977">state</span>&nbsp;<span class="op" id="3065983">=</span>&nbsp;<span class="ident" id="3065985">stateCR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3065997">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3066009">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066014">d</span><span class="op" id="3066015">.</span><span class="ident" id="3066016">state</span>&nbsp;<span class="op" id="3066022">=</span>&nbsp;<span class="ident" id="3066024">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066037">case</span>&nbsp;<span class="ident" id="3066042">stateDot</span><span class="op" id="3066050">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066055">if</span>&nbsp;<span class="ident" id="3066058">c</span>&nbsp;<span class="op" id="3066060">==</span>&nbsp;<span class="string" id="3066063">&#39;\r&#39;</span>&nbsp;<span class="op" id="3066068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066074">d</span><span class="op" id="3066075">.</span><span class="ident" id="3066076">state</span>&nbsp;<span class="op" id="3066082">=</span>&nbsp;<span class="ident" id="3066084">stateDotCR</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066099">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3066111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066116">if</span>&nbsp;<span class="ident" id="3066119">c</span>&nbsp;<span class="op" id="3066121">==</span>&nbsp;<span class="string" id="3066124">&#39;\n&#39;</span>&nbsp;<span class="op" id="3066129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066135">d</span><span class="op" id="3066136">.</span><span class="ident" id="3066137">state</span>&nbsp;<span class="op" id="3066143">=</span>&nbsp;<span class="ident" id="3066145">stateEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066158">continue</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3066170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066175">d</span><span class="op" id="3066176">.</span><span class="ident" id="3066177">state</span>&nbsp;<span class="op" id="3066183">=</span>&nbsp;<span class="ident" id="3066185">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066198">case</span>&nbsp;<span class="ident" id="3066203">stateDotCR</span><span class="op" id="3066213">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066218">if</span>&nbsp;<span class="ident" id="3066221">c</span>&nbsp;<span class="op" id="3066223">==</span>&nbsp;<span class="string" id="3066226">&#39;\n&#39;</span>&nbsp;<span class="op" id="3066231">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066237">d</span><span class="op" id="3066238">.</span><span class="ident" id="3066239">state</span>&nbsp;<span class="op" id="3066245">=</span>&nbsp;<span class="ident" id="3066247">stateEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066260">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3066272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3066277">//&nbsp;Not&nbsp;part&nbsp;of&nbsp;.\r\n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3066302">//&nbsp;Consume&nbsp;leading&nbsp;dot&nbsp;and&nbsp;emit&nbsp;saved&nbsp;\r.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066347">br</span><span class="op" id="3066349">.</span><span class="ident" id="3066350">UnreadByte</span><span class="op" id="3066360">(</span><span class="op" id="3066361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066366">c</span>&nbsp;<span class="op" id="3066368">=</span>&nbsp;<span class="string" id="3066370">&#39;\r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066378">d</span><span class="op" id="3066379">.</span><span class="ident" id="3066380">state</span>&nbsp;<span class="op" id="3066386">=</span>&nbsp;<span class="ident" id="3066388">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066401">case</span>&nbsp;<span class="ident" id="3066406">stateCR</span><span class="op" id="3066413">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066418">if</span>&nbsp;<span class="ident" id="3066421">c</span>&nbsp;<span class="op" id="3066423">==</span>&nbsp;<span class="string" id="3066426">&#39;\n&#39;</span>&nbsp;<span class="op" id="3066431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066437">d</span><span class="op" id="3066438">.</span><span class="ident" id="3066439">state</span>&nbsp;<span class="op" id="3066445">=</span>&nbsp;<span class="ident" id="3066447">stateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066466">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3066475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3066480">//&nbsp;Not&nbsp;part&nbsp;of&nbsp;\r\n.&nbsp;&nbsp;Emit&nbsp;saved&nbsp;\r</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066519">br</span><span class="op" id="3066521">.</span><span class="ident" id="3066522">UnreadByte</span><span class="op" id="3066532">(</span><span class="op" id="3066533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066538">c</span>&nbsp;<span class="op" id="3066540">=</span>&nbsp;<span class="string" id="3066542">&#39;\r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066550">d</span><span class="op" id="3066551">.</span><span class="ident" id="3066552">state</span>&nbsp;<span class="op" id="3066558">=</span>&nbsp;<span class="ident" id="3066560">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066573">case</span>&nbsp;<span class="ident" id="3066578">stateData</span><span class="op" id="3066587">:</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066592">if</span>&nbsp;<span class="ident" id="3066595">c</span>&nbsp;<span class="op" id="3066597">==</span>&nbsp;<span class="string" id="3066600">&#39;\r&#39;</span>&nbsp;<span class="op" id="3066605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066611">d</span><span class="op" id="3066612">.</span><span class="ident" id="3066613">state</span>&nbsp;<span class="op" id="3066619">=</span>&nbsp;<span class="ident" id="3066621">stateCR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066633">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3066645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066650">if</span>&nbsp;<span class="ident" id="3066653">c</span>&nbsp;<span class="op" id="3066655">==</span>&nbsp;<span class="string" id="3066658">&#39;\n&#39;</span>&nbsp;<span class="op" id="3066663">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066669">d</span><span class="op" id="3066670">.</span><span class="ident" id="3066671">state</span>&nbsp;<span class="op" id="3066677">=</span>&nbsp;<span class="ident" id="3066679">stateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3066697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3066701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066705">b</span><span class="op" id="3066706">[</span><span class="ident" id="3066707">n</span><span class="op" id="3066708">]</span>&nbsp;<span class="op" id="3066710">=</span>&nbsp;<span class="ident" id="3066712">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066716">n</span><span class="op" id="3066717">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3066721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066724">if</span>&nbsp;<span class="ident" id="3066727">err</span>&nbsp;<span class="op" id="3066731">==</span>&nbsp;<span class="ident" id="3066734">nil</span>&nbsp;<span class="op" id="3066738">&amp;&amp;</span>&nbsp;<span class="ident" id="3066741">d</span><span class="op" id="3066742">.</span><span class="ident" id="3066743">state</span>&nbsp;<span class="op" id="3066749">==</span>&nbsp;<span class="ident" id="3066752">stateEOF</span>&nbsp;<span class="op" id="3066761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066765">err</span>&nbsp;<span class="op" id="3066769">=</span>&nbsp;<span class="ident" id="3066771">io</span><span class="op" id="3066773">.</span><span class="ident" id="3066774">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3066779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066782">if</span>&nbsp;<span class="ident" id="3066785">err</span>&nbsp;<span class="op" id="3066789">!=</span>&nbsp;<span class="ident" id="3066792">nil</span>&nbsp;<span class="op" id="3066796">&amp;&amp;</span>&nbsp;<span class="ident" id="3066799">d</span><span class="op" id="3066800">.</span><span class="ident" id="3066801">r</span><span class="op" id="3066802">.</span><span class="ident" id="3066803">dot</span>&nbsp;<span class="op" id="3066807">==</span>&nbsp;<span class="ident" id="3066810">d</span>&nbsp;<span class="op" id="3066812">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066816">d</span><span class="op" id="3066817">.</span><span class="ident" id="3066818">r</span><span class="op" id="3066819">.</span><span class="ident" id="3066820">dot</span>&nbsp;<span class="op" id="3066824">=</span>&nbsp;<span class="ident" id="3066826">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3066831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066834">return</span><br>
<span class="lineno"></span><span class="op" id="3066841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="3066844">//&nbsp;closeDot&nbsp;drains&nbsp;the&nbsp;current&nbsp;DotReader&nbsp;if&nbsp;any,</span><br>
<span class="lineno"></span><span class="comment" id="3066893">//&nbsp;making&nbsp;sure&nbsp;that&nbsp;it&nbsp;reads&nbsp;until&nbsp;the&nbsp;ending&nbsp;dot&nbsp;line.</span><br>
<span class="lineno"></span><span class="keyword" id="3066949">func</span>&nbsp;<span class="op" id="3066954">(</span><span class="ident" id="3066955">r</span>&nbsp;<span class="op" id="3066957">*</span><span class="ident" id="3066958">Reader</span><span class="op" id="3066964">)</span>&nbsp;<span class="ident" id="3066966">closeDot</span><span class="op" id="3066974">(</span><span class="op" id="3066975">)</span>&nbsp;<span class="op" id="3066977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066980">if</span>&nbsp;<span class="ident" id="3066983">r</span><span class="op" id="3066984">.</span><span class="ident" id="3066985">dot</span>&nbsp;<span class="op" id="3066989">==</span>&nbsp;<span class="ident" id="3066992">nil</span>&nbsp;<span class="op" id="3066996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067000">return</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3067008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067011">buf</span>&nbsp;<span class="op" id="3067015">:=</span>&nbsp;<span class="builtinfunc" id="3067018">make</span><span class="op" id="3067022">(</span><span class="op" id="3067023">[</span><span class="op" id="3067024">]</span><span class="builtintype" id="3067025">byte</span><span class="op" id="3067029">,</span>&nbsp;<span class="num" id="3067031">128</span><span class="op" id="3067034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067037">for</span>&nbsp;<span class="ident" id="3067041">r</span><span class="op" id="3067042">.</span><span class="ident" id="3067043">dot</span>&nbsp;<span class="op" id="3067047">!=</span>&nbsp;<span class="ident" id="3067050">nil</span>&nbsp;<span class="op" id="3067054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3067058">//&nbsp;When&nbsp;Read&nbsp;reaches&nbsp;EOF&nbsp;or&nbsp;an&nbsp;error,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3067098">//&nbsp;it&nbsp;will&nbsp;set&nbsp;r.dot&nbsp;==&nbsp;nil.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067129">r</span><span class="op" id="3067130">.</span><span class="ident" id="3067131">dot</span><span class="op" id="3067134">.</span><span class="ident" id="3067135">Read</span><span class="op" id="3067139">(</span><span class="ident" id="3067140">buf</span><span class="op" id="3067143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3067146">}</span><br>
<span class="lineno"></span><span class="op" id="3067148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3067151">//&nbsp;ReadDotBytes&nbsp;reads&nbsp;a&nbsp;dot-encoding&nbsp;and&nbsp;returns&nbsp;the&nbsp;decoded&nbsp;data.</span><br>
<span class="lineno">400</span><span class="comment" id="3067218">//</span><br>
<span class="lineno"></span><span class="comment" id="3067221">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;DotReader&nbsp;method&nbsp;for&nbsp;details&nbsp;about&nbsp;dot-encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="3067303">func</span>&nbsp;<span class="op" id="3067308">(</span><span class="ident" id="3067309">r</span>&nbsp;<span class="op" id="3067311">*</span><span class="ident" id="3067312">Reader</span><span class="op" id="3067318">)</span>&nbsp;<span class="ident" id="3067320">ReadDotBytes</span><span class="op" id="3067332">(</span><span class="op" id="3067333">)</span>&nbsp;<span class="op" id="3067335">(</span><span class="op" id="3067336">[</span><span class="op" id="3067337">]</span><span class="builtintype" id="3067338">byte</span><span class="op" id="3067342">,</span>&nbsp;<span class="builtintype" id="3067344">error</span><span class="op" id="3067349">)</span>&nbsp;<span class="op" id="3067351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067354">return</span>&nbsp;<span class="ident" id="3067361">ioutil</span><span class="op" id="3067367">.</span><span class="ident" id="3067368">ReadAll</span><span class="op" id="3067375">(</span><span class="ident" id="3067376">r</span><span class="op" id="3067377">.</span><span class="ident" id="3067378">DotReader</span><span class="op" id="3067387">(</span><span class="op" id="3067388">)</span><span class="op" id="3067389">)</span><br>
<span class="lineno"></span><span class="op" id="3067391">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="3067394">//&nbsp;ReadDotLines&nbsp;reads&nbsp;a&nbsp;dot-encoding&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="3067451">//&nbsp;containing&nbsp;the&nbsp;decoded&nbsp;lines,&nbsp;with&nbsp;the&nbsp;final&nbsp;\r\n&nbsp;or&nbsp;\n&nbsp;elided&nbsp;from&nbsp;each.</span><br>
<span class="lineno"></span><span class="comment" id="3067528">//</span><br>
<span class="lineno"></span><span class="comment" id="3067531">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;DotReader&nbsp;method&nbsp;for&nbsp;details&nbsp;about&nbsp;dot-encoding.</span><br>
<span class="lineno">410</span><span class="keyword" id="3067613">func</span>&nbsp;<span class="op" id="3067618">(</span><span class="ident" id="3067619">r</span>&nbsp;<span class="op" id="3067621">*</span><span class="ident" id="3067622">Reader</span><span class="op" id="3067628">)</span>&nbsp;<span class="ident" id="3067630">ReadDotLines</span><span class="op" id="3067642">(</span><span class="op" id="3067643">)</span>&nbsp;<span class="op" id="3067645">(</span><span class="op" id="3067646">[</span><span class="op" id="3067647">]</span><span class="builtintype" id="3067648">string</span><span class="op" id="3067654">,</span>&nbsp;<span class="builtintype" id="3067656">error</span><span class="op" id="3067661">)</span>&nbsp;<span class="op" id="3067663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3067666">//&nbsp;We&nbsp;could&nbsp;use&nbsp;ReadDotBytes&nbsp;and&nbsp;then&nbsp;Split&nbsp;it,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3067715">//&nbsp;but&nbsp;reading&nbsp;a&nbsp;line&nbsp;at&nbsp;a&nbsp;time&nbsp;avoids&nbsp;needing&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3067765">//&nbsp;large&nbsp;contiguous&nbsp;block&nbsp;of&nbsp;memory&nbsp;and&nbsp;is&nbsp;simpler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067818">var</span>&nbsp;<span class="ident" id="3067822">v</span>&nbsp;<span class="op" id="3067824">[</span><span class="op" id="3067825">]</span><span class="builtintype" id="3067826">string</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067834">var</span>&nbsp;<span class="ident" id="3067838">err</span>&nbsp;<span class="builtintype" id="3067842">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067849">for</span>&nbsp;<span class="op" id="3067853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067857">var</span>&nbsp;<span class="ident" id="3067861">line</span>&nbsp;<span class="builtintype" id="3067866">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067875">line</span><span class="op" id="3067879">,</span>&nbsp;<span class="ident" id="3067881">err</span>&nbsp;<span class="op" id="3067885">=</span>&nbsp;<span class="ident" id="3067887">r</span><span class="op" id="3067888">.</span><span class="ident" id="3067889">ReadLine</span><span class="op" id="3067897">(</span><span class="op" id="3067898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067902">if</span>&nbsp;<span class="ident" id="3067905">err</span>&nbsp;<span class="op" id="3067909">!=</span>&nbsp;<span class="ident" id="3067912">nil</span>&nbsp;<span class="op" id="3067916">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067921">if</span>&nbsp;<span class="ident" id="3067924">err</span>&nbsp;<span class="op" id="3067928">==</span>&nbsp;<span class="ident" id="3067931">io</span><span class="op" id="3067933">.</span><span class="ident" id="3067934">EOF</span>&nbsp;<span class="op" id="3067938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067944">err</span>&nbsp;<span class="op" id="3067948">=</span>&nbsp;<span class="ident" id="3067950">io</span><span class="op" id="3067952">.</span><span class="ident" id="3067953">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3067973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067978">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3067986">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3067991">//&nbsp;Dot&nbsp;by&nbsp;itself&nbsp;marks&nbsp;end;&nbsp;otherwise&nbsp;cut&nbsp;one&nbsp;dot.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3068044">if</span>&nbsp;<span class="builtinfunc" id="3068047">len</span><span class="op" id="3068050">(</span><span class="ident" id="3068051">line</span><span class="op" id="3068055">)</span>&nbsp;<span class="op" id="3068057">&gt;</span>&nbsp;<span class="num" id="3068059">0</span>&nbsp;<span class="op" id="3068061">&amp;&amp;</span>&nbsp;<span class="ident" id="3068064">line</span><span class="op" id="3068068">[</span><span class="num" id="3068069">0</span><span class="op" id="3068070">]</span>&nbsp;<span class="op" id="3068072">==</span>&nbsp;<span class="string" id="3068075">&#39;.&#39;</span>&nbsp;<span class="op" id="3068079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3068084">if</span>&nbsp;<span class="builtinfunc" id="3068087">len</span><span class="op" id="3068090">(</span><span class="ident" id="3068091">line</span><span class="op" id="3068095">)</span>&nbsp;<span class="op" id="3068097">==</span>&nbsp;<span class="num" id="3068100">1</span>&nbsp;<span class="op" id="3068102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3068108">break</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3068117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3068122">line</span>&nbsp;<span class="op" id="3068127">=</span>&nbsp;<span class="ident" id="3068129">line</span><span class="op" id="3068133">[</span><span class="num" id="3068134">1</span><span class="op" id="3068135">:</span><span class="op" id="3068136">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3068140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3068144">v</span>&nbsp;<span class="op" id="3068146">=</span>&nbsp;<span class="builtinfunc" id="3068148">append</span><span class="op" id="3068154">(</span><span class="ident" id="3068155">v</span><span class="op" id="3068156">,</span>&nbsp;<span class="ident" id="3068158">line</span><span class="op" id="3068162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3068165">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3068168">return</span>&nbsp;<span class="ident" id="3068175">v</span><span class="op" id="3068176">,</span>&nbsp;<span class="ident" id="3068178">err</span><br>
<span class="lineno"></span><span class="op" id="3068182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3068185">//&nbsp;ReadMIMEHeader&nbsp;reads&nbsp;a&nbsp;MIME-style&nbsp;header&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3068237">//&nbsp;The&nbsp;header&nbsp;is&nbsp;a&nbsp;sequence&nbsp;of&nbsp;possibly&nbsp;continued&nbsp;Key:&nbsp;Value&nbsp;lines</span><br>
<span class="lineno">440</span><span class="comment" id="3068304">//&nbsp;ending&nbsp;in&nbsp;a&nbsp;blank&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="3068331">//&nbsp;The&nbsp;returned&nbsp;map&nbsp;m&nbsp;maps&nbsp;CanonicalMIMEHeaderKey(key)&nbsp;to&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3068391">//&nbsp;sequence&nbsp;of&nbsp;values&nbsp;in&nbsp;the&nbsp;same&nbsp;order&nbsp;encountered&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="3068457">//</span><br>
<span class="lineno"></span><span class="comment" id="3068460">//&nbsp;For&nbsp;example,&nbsp;consider&nbsp;this&nbsp;input:</span><br>
<span class="lineno">445</span><span class="comment" id="3068497">//</span><br>
<span class="lineno"></span><span class="comment" id="3068500">//&nbsp;&nbsp;&nbsp;&nbspMy-Key:&nbsp;Value&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="3068519">//&nbsp;&nbsp;&nbsp;&nbspLong-Key:&nbsp;Even</span><br>
<span class="lineno"></span><span class="comment" id="3068537">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Longer&nbsp;Value</span><br>
<span class="lineno"></span><span class="comment" id="3068560">//&nbsp;&nbsp;&nbsp;&nbspMy-Key:&nbsp;Value&nbsp;2</span><br>
<span class="lineno">450</span><span class="comment" id="3068579">//</span><br>
<span class="lineno"></span><span class="comment" id="3068582">//&nbsp;Given&nbsp;that&nbsp;input,&nbsp;ReadMIMEHeader&nbsp;returns&nbsp;the&nbsp;map:</span><br>
<span class="lineno"></span><span class="comment" id="3068635">//</span><br>
<span class="lineno"></span><span class="comment" id="3068638">//&nbsp;&nbsp;&nbsp;&nbspmap[string][]string{</span><br>
<span class="lineno"></span><span class="comment" id="3068662">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;My-Key&#34;:&nbsp;{&#34;Value&nbsp;1&#34;,&nbsp;&#34;Value&nbsp;2&#34;},</span><br>
<span class="lineno">455</span><span class="comment" id="3068700">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;Long-Key&#34;:&nbsp;{&#34;Even&nbsp;Longer&nbsp;Value&#34;},</span><br>
<span class="lineno"></span><span class="comment" id="3068739">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="comment" id="3068744">//</span><br>
<span class="lineno"></span><span class="keyword" id="3068747">func</span>&nbsp;<span class="op" id="3068752">(</span><span class="ident" id="3068753">r</span>&nbsp;<span class="op" id="3068755">*</span><span class="ident" id="3068756">Reader</span><span class="op" id="3068762">)</span>&nbsp;<span class="ident" id="3068764">ReadMIMEHeader</span><span class="op" id="3068778">(</span><span class="op" id="3068779">)</span>&nbsp;<span class="op" id="3068781">(</span><span class="ident" id="3068782">MIMEHeader</span><span class="op" id="3068792">,</span>&nbsp;<span class="builtintype" id="3068794">error</span><span class="op" id="3068799">)</span>&nbsp;<span class="op" id="3068801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3068804">//&nbsp;Avoid&nbsp;lots&nbsp;of&nbsp;small&nbsp;slice&nbsp;allocations&nbsp;later&nbsp;by&nbsp;allocating&nbsp;one</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3068870">//&nbsp;large&nbsp;one&nbsp;ahead&nbsp;of&nbsp;time&nbsp;which&nbsp;we&#39;ll&nbsp;cut&nbsp;up&nbsp;into&nbsp;smaller</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3068930">//&nbsp;slices.&nbsp;If&nbsp;this&nbsp;isn&#39;t&nbsp;big&nbsp;enough&nbsp;later,&nbsp;we&nbsp;allocate&nbsp;small&nbsp;ones.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3068998">var</span>&nbsp;<span class="ident" id="3069002">strs</span>&nbsp;<span class="op" id="3069007">[</span><span class="op" id="3069008">]</span><span class="builtintype" id="3069009">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3069017">hint</span>&nbsp;<span class="op" id="3069022">:=</span>&nbsp;<span class="ident" id="3069025">r</span><span class="op" id="3069026">.</span><span class="ident" id="3069027">upcomingHeaderNewlines</span><span class="op" id="3069049">(</span><span class="op" id="3069050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3069053">if</span>&nbsp;<span class="ident" id="3069056">hint</span>&nbsp;<span class="op" id="3069061">&gt;</span>&nbsp;<span class="num" id="3069063">0</span>&nbsp;<span class="op" id="3069065">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3069069">strs</span>&nbsp;<span class="op" id="3069074">=</span>&nbsp;<span class="builtinfunc" id="3069076">make</span><span class="op" id="3069080">(</span><span class="op" id="3069081">[</span><span class="op" id="3069082">]</span><span class="builtintype" id="3069083">string</span><span class="op" id="3069089">,</span>&nbsp;<span class="ident" id="3069091">hint</span><span class="op" id="3069095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3069098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3069102">m</span>&nbsp;<span class="op" id="3069104">:=</span>&nbsp;<span class="builtinfunc" id="3069107">make</span><span class="op" id="3069111">(</span><span class="ident" id="3069112">MIMEHeader</span><span class="op" id="3069122">,</span>&nbsp;<span class="ident" id="3069124">hint</span><span class="op" id="3069128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3069131">for</span>&nbsp;<span class="op" id="3069135">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3069139">kv</span><span class="op" id="3069141">,</span>&nbsp;<span class="ident" id="3069143">err</span>&nbsp;<span class="op" id="3069147">:=</span>&nbsp;<span class="ident" id="3069150">r</span><span class="op" id="3069151">.</span><span class="ident" id="3069152">readContinuedLineSlice</span><span class="op" id="3069174">(</span><span class="op" id="3069175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3069179">if</span>&nbsp;<span class="builtinfunc" id="3069182">len</span><span class="op" id="3069185">(</span><span class="ident" id="3069186">kv</span><span class="op" id="3069188">)</span>&nbsp;<span class="op" id="3069190">==</span>&nbsp;<span class="num" id="3069193">0</span>&nbsp;<span class="op" id="3069195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3069200">return</span>&nbsp;<span class="ident" id="3069207">m</span><span class="op" id="3069208">,</span>&nbsp;<span class="ident" id="3069210">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3069216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3069221">//&nbsp;Key&nbsp;ends&nbsp;at&nbsp;first&nbsp;colon;&nbsp;should&nbsp;not&nbsp;have&nbsp;spaces&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3069278">//&nbsp;they&nbsp;appear&nbsp;in&nbsp;the&nbsp;wild,&nbsp;violating&nbsp;specs,&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3069331">//&nbsp;remove&nbsp;them&nbsp;if&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3069360">i</span>&nbsp;<span class="op" id="3069362">:=</span>&nbsp;<span class="ident" id="3069365">bytes</span><span class="op" id="3069370">.</span><span class="ident" id="3069371">IndexByte</span><span class="op" id="3069380">(</span><span class="ident" id="3069381">kv</span><span class="op" id="3069383">,</span>&nbsp;<span class="string" id="3069385">&#39;:&#39;</span><span class="op" id="3069388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3069392">if</span>&nbsp;<span class="ident" id="3069395">i</span>&nbsp;<span class="op" id="3069397">&lt;</span>&nbsp;<span class="num" id="3069399">0</span>&nbsp;<span class="op" id="3069401">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3069406">return</span>&nbsp;<span class="ident" id="3069413">m</span><span class="op" id="3069414">,</span>&nbsp;<span class="ident" id="3069416">ProtocolError</span><span class="op" id="3069429">(</span><span class="string" id="3069430">&#34;malformed&nbsp;MIME&nbsp;header&nbsp;line:&nbsp;&#34;</span>&nbsp;<span class="op" id="3069461">+</span>&nbsp;<span class="builtintype" id="3069463">string</span><span class="op" id="3069469">(</span><span class="ident" id="3069470">kv</span><span class="op" id="3069472">)</span><span class="op" id="3069473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3069477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3069481">endKey</span>&nbsp;<span class="op" id="3069488">:=</span>&nbsp;<span class="ident" id="3069491">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3069495">for</span>&nbsp;<span class="ident" id="3069499">endKey</span>&nbsp;<span class="op" id="3069506">&gt;</span>&nbsp;<span class="num" id="3069508">0</span>&nbsp;<span class="op" id="3069510">&amp;&amp;</span>&nbsp;<span class="ident" id="3069513">kv</span><span class="op" id="3069515">[</span><span class="ident" id="3069516">endKey</span><span class="op" id="3069522">-</span><span class="num" id="3069523">1</span><span class="op" id="3069524">]</span>&nbsp;<span class="op" id="3069526">==</span>&nbsp;<span class="string" id="3069529">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3069533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3069538">endKey</span><span class="op" id="3069544">--</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3069549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3069553">key</span>&nbsp;<span class="op" id="3069557">:=</span>&nbsp;<span class="ident" id="3069560">canonicalMIMEHeaderKey</span><span class="op" id="3069582">(</span><span class="ident" id="3069583">kv</span><span class="op" id="3069585">[</span><span class="op" id="3069586">:</span><span class="ident" id="3069587">endKey</span><span class="op" id="3069593">]</span><span class="op" id="3069594">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3069599">//&nbsp;Skip&nbsp;initial&nbsp;spaces&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3069634">i</span><span class="op" id="3069635">++</span>&nbsp;<span class="comment" id="3069638">//&nbsp;skip&nbsp;colon</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3069654">for</span>&nbsp;<span class="ident" id="3069658">i</span>&nbsp;<span class="op" id="3069660">&lt;</span>&nbsp;<span class="builtinfunc" id="3069662">len</span><span class="op" id="3069665">(</span><span class="ident" id="3069666">kv</span><span class="op" id="3069668">)</span>&nbsp;<span class="op" id="3069670">&amp;&amp;</span>&nbsp;<span class="op" id="3069673">(</span><span class="ident" id="3069674">kv</span><span class="op" id="3069676">[</span><span class="ident" id="3069677">i</span><span class="op" id="3069678">]</span>&nbsp;<span class="op" id="3069680">==</span>&nbsp;<span class="string" id="3069683">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3069687">||</span>&nbsp;<span class="ident" id="3069690">kv</span><span class="op" id="3069692">[</span><span class="ident" id="3069693">i</span><span class="op" id="3069694">]</span>&nbsp;<span class="op" id="3069696">==</span>&nbsp;<span class="string" id="3069699">&#39;\t&#39;</span><span class="op" id="3069703">)</span>&nbsp;<span class="op" id="3069705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3069710">i</span><span class="op" id="3069711">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3069716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3069720">value</span>&nbsp;<span class="op" id="3069726">:=</span>&nbsp;<span class="builtintype" id="3069729">string</span><span class="op" id="3069735">(</span><span class="ident" id="3069736">kv</span><span class="op" id="3069738">[</span><span class="ident" id="3069739">i</span><span class="op" id="3069740">:</span><span class="op" id="3069741">]</span><span class="op" id="3069742">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3069747">vv</span>&nbsp;<span class="op" id="3069750">:=</span>&nbsp;<span class="ident" id="3069753">m</span><span class="op" id="3069754">[</span><span class="ident" id="3069755">key</span><span class="op" id="3069758">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3069762">if</span>&nbsp;<span class="ident" id="3069765">vv</span>&nbsp;<span class="op" id="3069768">==</span>&nbsp;<span class="ident" id="3069771">nil</span>&nbsp;<span class="op" id="3069775">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3069778">len</span><span class="op" id="3069781">(</span><span class="ident" id="3069782">strs</span><span class="op" id="3069786">)</span>&nbsp;<span class="op" id="3069788">&gt;</span>&nbsp;<span class="num" id="3069790">0</span>&nbsp;<span class="op" id="3069792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3069797">//&nbsp;More&nbsp;than&nbsp;likely&nbsp;this&nbsp;will&nbsp;be&nbsp;a&nbsp;single-element&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3069855">//&nbsp;Most&nbsp;headers&nbsp;aren&#39;t&nbsp;multi-valued.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3069895">//&nbsp;Set&nbsp;the&nbsp;capacity&nbsp;on&nbsp;strs[0]&nbsp;to&nbsp;1,&nbsp;so&nbsp;any&nbsp;future&nbsp;append</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3069956">//&nbsp;won&#39;t&nbsp;extend&nbsp;the&nbsp;slice&nbsp;into&nbsp;the&nbsp;other&nbsp;strings.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3070009">vv</span><span class="op" id="3070011">,</span>&nbsp;<span class="ident" id="3070013">strs</span>&nbsp;<span class="op" id="3070018">=</span>&nbsp;<span class="ident" id="3070020">strs</span><span class="op" id="3070024">[</span><span class="op" id="3070025">:</span><span class="num" id="3070026">1</span><span class="op" id="3070027">:</span><span class="num" id="3070028">1</span><span class="op" id="3070029">]</span><span class="op" id="3070030">,</span>&nbsp;<span class="ident" id="3070032">strs</span><span class="op" id="3070036">[</span><span class="num" id="3070037">1</span><span class="op" id="3070038">:</span><span class="op" id="3070039">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3070044">vv</span><span class="op" id="3070046">[</span><span class="num" id="3070047">0</span><span class="op" id="3070048">]</span>&nbsp;<span class="op" id="3070050">=</span>&nbsp;<span class="ident" id="3070052">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3070061">m</span><span class="op" id="3070062">[</span><span class="ident" id="3070063">key</span><span class="op" id="3070066">]</span>&nbsp;<span class="op" id="3070068">=</span>&nbsp;<span class="ident" id="3070070">vv</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3070075">}</span>&nbsp;<span class="keyword" id="3070077">else</span>&nbsp;<span class="op" id="3070082">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3070087">m</span><span class="op" id="3070088">[</span><span class="ident" id="3070089">key</span><span class="op" id="3070092">]</span>&nbsp;<span class="op" id="3070094">=</span>&nbsp;<span class="builtinfunc" id="3070096">append</span><span class="op" id="3070102">(</span><span class="ident" id="3070103">vv</span><span class="op" id="3070105">,</span>&nbsp;<span class="ident" id="3070107">value</span><span class="op" id="3070112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3070116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3070121">if</span>&nbsp;<span class="ident" id="3070124">err</span>&nbsp;<span class="op" id="3070128">!=</span>&nbsp;<span class="ident" id="3070131">nil</span>&nbsp;<span class="op" id="3070135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3070140">return</span>&nbsp;<span class="ident" id="3070147">m</span><span class="op" id="3070148">,</span>&nbsp;<span class="ident" id="3070150">err</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3070156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3070159">}</span><br>
<span class="lineno"></span><span class="op" id="3070161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3070164">//&nbsp;upcomingHeaderNewlines&nbsp;returns&nbsp;an&nbsp;approximation&nbsp;of&nbsp;the&nbsp;number&nbsp;of&nbsp;newlines</span><br>
<span class="lineno">515</span><span class="comment" id="3070241">//&nbsp;that&nbsp;will&nbsp;be&nbsp;in&nbsp;this&nbsp;header.&nbsp;If&nbsp;it&nbsp;gets&nbsp;confused,&nbsp;it&nbsp;returns&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="3070308">func</span>&nbsp;<span class="op" id="3070313">(</span><span class="ident" id="3070314">r</span>&nbsp;<span class="op" id="3070316">*</span><span class="ident" id="3070317">Reader</span><span class="op" id="3070323">)</span>&nbsp;<span class="ident" id="3070325">upcomingHeaderNewlines</span><span class="op" id="3070347">(</span><span class="op" id="3070348">)</span>&nbsp;<span class="op" id="3070350">(</span><span class="ident" id="3070351">n</span>&nbsp;<span class="builtintype" id="3070353">int</span><span class="op" id="3070356">)</span>&nbsp;<span class="op" id="3070358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3070361">//&nbsp;Try&nbsp;to&nbsp;determine&nbsp;the&nbsp;&#39;hint&#39;&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3070399">r</span><span class="op" id="3070400">.</span><span class="ident" id="3070401">R</span><span class="op" id="3070402">.</span><span class="ident" id="3070403">Peek</span><span class="op" id="3070407">(</span><span class="num" id="3070408">1</span><span class="op" id="3070409">)</span>&nbsp;<span class="comment" id="3070411">//&nbsp;force&nbsp;a&nbsp;buffer&nbsp;load&nbsp;if&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3070444">s</span>&nbsp;<span class="op" id="3070446">:=</span>&nbsp;<span class="ident" id="3070449">r</span><span class="op" id="3070450">.</span><span class="ident" id="3070451">R</span><span class="op" id="3070452">.</span><span class="ident" id="3070453">Buffered</span><span class="op" id="3070461">(</span><span class="op" id="3070462">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3070465">if</span>&nbsp;<span class="ident" id="3070468">s</span>&nbsp;<span class="op" id="3070470">==</span>&nbsp;<span class="num" id="3070473">0</span>&nbsp;<span class="op" id="3070475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3070479">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3070487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3070490">peek</span><span class="op" id="3070494">,</span>&nbsp;<span class="ident" id="3070496">_</span>&nbsp;<span class="op" id="3070498">:=</span>&nbsp;<span class="ident" id="3070501">r</span><span class="op" id="3070502">.</span><span class="ident" id="3070503">R</span><span class="op" id="3070504">.</span><span class="ident" id="3070505">Peek</span><span class="op" id="3070509">(</span><span class="ident" id="3070510">s</span><span class="op" id="3070511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3070514">for</span>&nbsp;<span class="builtinfunc" id="3070518">len</span><span class="op" id="3070521">(</span><span class="ident" id="3070522">peek</span><span class="op" id="3070526">)</span>&nbsp;<span class="op" id="3070528">&gt;</span>&nbsp;<span class="num" id="3070530">0</span>&nbsp;<span class="op" id="3070532">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3070536">i</span>&nbsp;<span class="op" id="3070538">:=</span>&nbsp;<span class="ident" id="3070541">bytes</span><span class="op" id="3070546">.</span><span class="ident" id="3070547">IndexByte</span><span class="op" id="3070556">(</span><span class="ident" id="3070557">peek</span><span class="op" id="3070561">,</span>&nbsp;<span class="string" id="3070563">&#39;\n&#39;</span><span class="op" id="3070567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3070571">if</span>&nbsp;<span class="ident" id="3070574">i</span>&nbsp;<span class="op" id="3070576">&lt;</span>&nbsp;<span class="num" id="3070578">3</span>&nbsp;<span class="op" id="3070580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3070585">//&nbsp;Not&nbsp;present&nbsp;(-1)&nbsp;or&nbsp;found&nbsp;within&nbsp;the&nbsp;next&nbsp;few&nbsp;bytes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3070644">//&nbsp;implying&nbsp;we&#39;re&nbsp;at&nbsp;the&nbsp;end&nbsp;(&#34;\r\n\r\n&#34;&nbsp;or&nbsp;&#34;\n\n&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3070699">return</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3070708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3070712">n</span><span class="op" id="3070713">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3070718">peek</span>&nbsp;<span class="op" id="3070723">=</span>&nbsp;<span class="ident" id="3070725">peek</span><span class="op" id="3070729">[</span><span class="ident" id="3070730">i</span><span class="op" id="3070731">+</span><span class="num" id="3070732">1</span><span class="op" id="3070733">:</span><span class="op" id="3070734">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3070737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3070740">return</span><br>
<span class="lineno">535</span><span class="op" id="3070747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3070750">//&nbsp;CanonicalMIMEHeaderKey&nbsp;returns&nbsp;the&nbsp;canonical&nbsp;format&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3070812">//&nbsp;MIME&nbsp;header&nbsp;key&nbsp;s.&nbsp;&nbsp;The&nbsp;canonicalization&nbsp;converts&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="3070875">//&nbsp;letter&nbsp;and&nbsp;any&nbsp;letter&nbsp;following&nbsp;a&nbsp;hyphen&nbsp;to&nbsp;upper&nbsp;case;</span><br>
<span class="lineno">540</span><span class="comment" id="3070934">//&nbsp;the&nbsp;rest&nbsp;are&nbsp;converted&nbsp;to&nbsp;lowercase.&nbsp;&nbsp;For&nbsp;example,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3070992">//&nbsp;canonical&nbsp;key&nbsp;for&nbsp;&#34;accept-encoding&#34;&nbsp;is&nbsp;&#34;Accept-Encoding&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3071053">//&nbsp;MIME&nbsp;header&nbsp;keys&nbsp;are&nbsp;assumed&nbsp;to&nbsp;be&nbsp;ASCII&nbsp;only.</span><br>
<span class="lineno"></span><span class="keyword" id="3071103">func</span>&nbsp;<span class="ident" id="3071108">CanonicalMIMEHeaderKey</span><span class="op" id="3071130">(</span><span class="ident" id="3071131">s</span>&nbsp;<span class="builtintype" id="3071133">string</span><span class="op" id="3071139">)</span>&nbsp;<span class="builtintype" id="3071141">string</span>&nbsp;<span class="op" id="3071148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3071151">//&nbsp;Quick&nbsp;check&nbsp;for&nbsp;canonical&nbsp;encoding.</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3071191">upper</span>&nbsp;<span class="op" id="3071197">:=</span>&nbsp;<span class="builtintype" id="3071200">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3071206">for</span>&nbsp;<span class="ident" id="3071210">i</span>&nbsp;<span class="op" id="3071212">:=</span>&nbsp;<span class="num" id="3071215">0</span><span class="op" id="3071216">;</span>&nbsp;<span class="ident" id="3071218">i</span>&nbsp;<span class="op" id="3071220">&lt;</span>&nbsp;<span class="builtinfunc" id="3071222">len</span><span class="op" id="3071225">(</span><span class="ident" id="3071226">s</span><span class="op" id="3071227">)</span><span class="op" id="3071228">;</span>&nbsp;<span class="ident" id="3071230">i</span><span class="op" id="3071231">++</span>&nbsp;<span class="op" id="3071234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3071238">c</span>&nbsp;<span class="op" id="3071240">:=</span>&nbsp;<span class="ident" id="3071243">s</span><span class="op" id="3071244">[</span><span class="ident" id="3071245">i</span><span class="op" id="3071246">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3071250">if</span>&nbsp;<span class="ident" id="3071253">upper</span>&nbsp;<span class="op" id="3071259">&amp;&amp;</span>&nbsp;<span class="string" id="3071262">&#39;a&#39;</span>&nbsp;<span class="op" id="3071266">&lt;=</span>&nbsp;<span class="ident" id="3071269">c</span>&nbsp;<span class="op" id="3071271">&amp;&amp;</span>&nbsp;<span class="ident" id="3071274">c</span>&nbsp;<span class="op" id="3071276">&lt;=</span>&nbsp;<span class="string" id="3071279">&#39;z&#39;</span>&nbsp;<span class="op" id="3071283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3071288">return</span>&nbsp;<span class="ident" id="3071295">canonicalMIMEHeaderKey</span><span class="op" id="3071317">(</span><span class="op" id="3071318">[</span><span class="op" id="3071319">]</span><span class="builtintype" id="3071320">byte</span><span class="op" id="3071324">(</span><span class="ident" id="3071325">s</span><span class="op" id="3071326">)</span><span class="op" id="3071327">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3071331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3071335">if</span>&nbsp;<span class="op" id="3071338">!</span><span class="ident" id="3071339">upper</span>&nbsp;<span class="op" id="3071345">&amp;&amp;</span>&nbsp;<span class="string" id="3071348">&#39;A&#39;</span>&nbsp;<span class="op" id="3071352">&lt;=</span>&nbsp;<span class="ident" id="3071355">c</span>&nbsp;<span class="op" id="3071357">&amp;&amp;</span>&nbsp;<span class="ident" id="3071360">c</span>&nbsp;<span class="op" id="3071362">&lt;=</span>&nbsp;<span class="string" id="3071365">&#39;Z&#39;</span>&nbsp;<span class="op" id="3071369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3071374">return</span>&nbsp;<span class="ident" id="3071381">canonicalMIMEHeaderKey</span><span class="op" id="3071403">(</span><span class="op" id="3071404">[</span><span class="op" id="3071405">]</span><span class="builtintype" id="3071406">byte</span><span class="op" id="3071410">(</span><span class="ident" id="3071411">s</span><span class="op" id="3071412">)</span><span class="op" id="3071413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3071417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3071421">upper</span>&nbsp;<span class="op" id="3071427">=</span>&nbsp;<span class="ident" id="3071429">c</span>&nbsp;<span class="op" id="3071431">==</span>&nbsp;<span class="string" id="3071434">&#39;-&#39;</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3071439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3071442">return</span>&nbsp;<span class="ident" id="3071449">s</span><br>
<span class="lineno"></span><span class="op" id="3071451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3071454">const</span>&nbsp;<span class="ident" id="3071460">toLower</span>&nbsp;<span class="op" id="3071468">=</span>&nbsp;<span class="string" id="3071470">&#39;a&#39;</span>&nbsp;<span class="op" id="3071474">-</span>&nbsp;<span class="string" id="3071476">&#39;A&#39;</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span><span class="comment" id="3071481">//&nbsp;canonicalMIMEHeaderKey&nbsp;is&nbsp;like&nbsp;CanonicalMIMEHeaderKey&nbsp;but&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3071545">//&nbsp;allowed&nbsp;to&nbsp;mutate&nbsp;the&nbsp;provided&nbsp;byte&nbsp;slice&nbsp;before&nbsp;returning&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3071611">//&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3071622">func</span>&nbsp;<span class="ident" id="3071627">canonicalMIMEHeaderKey</span><span class="op" id="3071649">(</span><span class="ident" id="3071650">a</span>&nbsp;<span class="op" id="3071652">[</span><span class="op" id="3071653">]</span><span class="builtintype" id="3071654">byte</span><span class="op" id="3071658">)</span>&nbsp;<span class="builtintype" id="3071660">string</span>&nbsp;<span class="op" id="3071667">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3071670">upper</span>&nbsp;<span class="op" id="3071676">:=</span>&nbsp;<span class="builtintype" id="3071679">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3071685">for</span>&nbsp;<span class="ident" id="3071689">i</span><span class="op" id="3071690">,</span>&nbsp;<span class="ident" id="3071692">c</span>&nbsp;<span class="op" id="3071694">:=</span>&nbsp;<span class="keyword" id="3071697">range</span>&nbsp;<span class="ident" id="3071703">a</span>&nbsp;<span class="op" id="3071705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3071709">//&nbsp;Canonicalize:&nbsp;first&nbsp;letter&nbsp;upper&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3071752">//&nbsp;and&nbsp;upper&nbsp;case&nbsp;after&nbsp;each&nbsp;dash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3071789">//&nbsp;(Host,&nbsp;User-Agent,&nbsp;If-Modified-Since).</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3071833">//&nbsp;MIME&nbsp;headers&nbsp;are&nbsp;ASCII&nbsp;only,&nbsp;so&nbsp;no&nbsp;Unicode&nbsp;issues.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3071889">if</span>&nbsp;<span class="ident" id="3071892">c</span>&nbsp;<span class="op" id="3071894">==</span>&nbsp;<span class="string" id="3071897">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3071901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3071906">c</span>&nbsp;<span class="op" id="3071908">=</span>&nbsp;<span class="string" id="3071910">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3071916">}</span>&nbsp;<span class="keyword" id="3071918">else</span>&nbsp;<span class="keyword" id="3071923">if</span>&nbsp;<span class="ident" id="3071926">upper</span>&nbsp;<span class="op" id="3071932">&amp;&amp;</span>&nbsp;<span class="string" id="3071935">&#39;a&#39;</span>&nbsp;<span class="op" id="3071939">&lt;=</span>&nbsp;<span class="ident" id="3071942">c</span>&nbsp;<span class="op" id="3071944">&amp;&amp;</span>&nbsp;<span class="ident" id="3071947">c</span>&nbsp;<span class="op" id="3071949">&lt;=</span>&nbsp;<span class="string" id="3071952">&#39;z&#39;</span>&nbsp;<span class="op" id="3071956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3071961">c</span>&nbsp;<span class="op" id="3071963">-=</span>&nbsp;<span class="ident" id="3071966">toLower</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3071976">}</span>&nbsp;<span class="keyword" id="3071978">else</span>&nbsp;<span class="keyword" id="3071983">if</span>&nbsp;<span class="op" id="3071986">!</span><span class="ident" id="3071987">upper</span>&nbsp;<span class="op" id="3071993">&amp;&amp;</span>&nbsp;<span class="string" id="3071996">&#39;A&#39;</span>&nbsp;<span class="op" id="3072000">&lt;=</span>&nbsp;<span class="ident" id="3072003">c</span>&nbsp;<span class="op" id="3072005">&amp;&amp;</span>&nbsp;<span class="ident" id="3072008">c</span>&nbsp;<span class="op" id="3072010">&lt;=</span>&nbsp;<span class="string" id="3072013">&#39;Z&#39;</span>&nbsp;<span class="op" id="3072017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3072022">c</span>&nbsp;<span class="op" id="3072024">+=</span>&nbsp;<span class="ident" id="3072027">toLower</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3072037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3072041">a</span><span class="op" id="3072042">[</span><span class="ident" id="3072043">i</span><span class="op" id="3072044">]</span>&nbsp;<span class="op" id="3072046">=</span>&nbsp;<span class="ident" id="3072048">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3072052">upper</span>&nbsp;<span class="op" id="3072058">=</span>&nbsp;<span class="ident" id="3072060">c</span>&nbsp;<span class="op" id="3072062">==</span>&nbsp;<span class="string" id="3072065">&#39;-&#39;</span>&nbsp;<span class="comment" id="3072069">//&nbsp;for&nbsp;next&nbsp;time</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3072087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3072090">//&nbsp;The&nbsp;compiler&nbsp;recognizes&nbsp;m[string(byteSlice)]&nbsp;as&nbsp;a&nbsp;special</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3072152">//&nbsp;case,&nbsp;so&nbsp;a&nbsp;copy&nbsp;of&nbsp;a&#39;s&nbsp;bytes&nbsp;into&nbsp;a&nbsp;new&nbsp;string&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3072212">//&nbsp;happen&nbsp;in&nbsp;this&nbsp;map&nbsp;lookup:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3072243">if</span>&nbsp;<span class="ident" id="3072246">v</span>&nbsp;<span class="op" id="3072248">:=</span>&nbsp;<span class="ident" id="3072251">commonHeader</span><span class="op" id="3072263">[</span><span class="builtintype" id="3072264">string</span><span class="op" id="3072270">(</span><span class="ident" id="3072271">a</span><span class="op" id="3072272">)</span><span class="op" id="3072273">]</span><span class="op" id="3072274">;</span>&nbsp;<span class="ident" id="3072276">v</span>&nbsp;<span class="op" id="3072278">!=</span>&nbsp;<span class="string" id="3072281">&#34;&#34;</span>&nbsp;<span class="op" id="3072284">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3072288">return</span>&nbsp;<span class="ident" id="3072295">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3072298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3072301">return</span>&nbsp;<span class="builtintype" id="3072308">string</span><span class="op" id="3072314">(</span><span class="ident" id="3072315">a</span><span class="op" id="3072316">)</span><br>
<span class="lineno"></span><span class="op" id="3072318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="3072321">//&nbsp;commonHeader&nbsp;interns&nbsp;common&nbsp;header&nbsp;strings.</span><br>
<span class="lineno"></span><span class="keyword" id="3072368">var</span>&nbsp;<span class="ident" id="3072372">commonHeader</span>&nbsp;<span class="op" id="3072385">=</span>&nbsp;<span class="builtinfunc" id="3072387">make</span><span class="op" id="3072391">(</span><span class="keyword" id="3072392">map</span><span class="op" id="3072395">[</span><span class="builtintype" id="3072396">string</span><span class="op" id="3072402">]</span><span class="builtintype" id="3072403">string</span><span class="op" id="3072409">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3072412">func</span>&nbsp;<span class="ident" id="3072417">init</span><span class="op" id="3072421">(</span><span class="op" id="3072422">)</span>&nbsp;<span class="op" id="3072424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3072427">for</span>&nbsp;<span class="ident" id="3072431">_</span><span class="op" id="3072432">,</span>&nbsp;<span class="ident" id="3072434">v</span>&nbsp;<span class="op" id="3072436">:=</span>&nbsp;<span class="keyword" id="3072439">range</span>&nbsp;<span class="op" id="3072445">[</span><span class="op" id="3072446">]</span><span class="builtintype" id="3072447">string</span><span class="op" id="3072453">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3072457">&#34;Accept&#34;</span><span class="op" id="3072465">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3072469">&#34;Accept-Charset&#34;</span><span class="op" id="3072485">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3072489">&#34;Accept-Encoding&#34;</span><span class="op" id="3072506">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3072510">&#34;Accept-Language&#34;</span><span class="op" id="3072527">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3072531">&#34;Accept-Ranges&#34;</span><span class="op" id="3072546">,</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3072550">&#34;Cache-Control&#34;</span><span class="op" id="3072565">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3072569">&#34;Cc&#34;</span><span class="op" id="3072573">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3072577">&#34;Connection&#34;</span><span class="op" id="3072589">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3072593">&#34;Content-Id&#34;</span><span class="op" id="3072605">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3072609">&#34;Content-Language&#34;</span><span class="op" id="3072627">,</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3072631">&#34;Content-Length&#34;</span><span class="op" id="3072647">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3072651">&#34;Content-Transfer-Encoding&#34;</span><span class="op" id="3072678">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3072682">&#34;Content-Type&#34;</span><span class="op" id="3072696">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3072700">&#34;Cookie&#34;</span><span class="op" id="3072708">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3072712">&#34;Date&#34;</span><span class="op" id="3072718">,</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3072722">&#34;Dkim-Signature&#34;</span><span class="op" id="3072738">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3072742">&#34;Etag&#34;</span><span class="op" id="3072748">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3072752">&#34;Expires&#34;</span><span class="op" id="3072761">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3072765">&#34;From&#34;</span><span class="op" id="3072771">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3072775">&#34;Host&#34;</span><span class="op" id="3072781">,</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3072785">&#34;If-Modified-Since&#34;</span><span class="op" id="3072804">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3072808">&#34;If-None-Match&#34;</span><span class="op" id="3072823">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3072827">&#34;In-Reply-To&#34;</span><span class="op" id="3072840">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3072844">&#34;Last-Modified&#34;</span><span class="op" id="3072859">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3072863">&#34;Location&#34;</span><span class="op" id="3072873">,</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3072877">&#34;Message-Id&#34;</span><span class="op" id="3072889">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3072893">&#34;Mime-Version&#34;</span><span class="op" id="3072907">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3072911">&#34;Pragma&#34;</span><span class="op" id="3072919">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3072923">&#34;Received&#34;</span><span class="op" id="3072933">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3072937">&#34;Return-Path&#34;</span><span class="op" id="3072950">,</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3072954">&#34;Server&#34;</span><span class="op" id="3072962">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3072966">&#34;Set-Cookie&#34;</span><span class="op" id="3072978">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3072982">&#34;Subject&#34;</span><span class="op" id="3072991">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3072995">&#34;To&#34;</span><span class="op" id="3072999">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3073003">&#34;User-Agent&#34;</span><span class="op" id="3073015">,</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3073019">&#34;Via&#34;</span><span class="op" id="3073024">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3073028">&#34;X-Forwarded-For&#34;</span><span class="op" id="3073045">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3073049">&#34;X-Imforwards&#34;</span><span class="op" id="3073063">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3073067">&#34;X-Powered-By&#34;</span><span class="op" id="3073081">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3073084">}</span>&nbsp;<span class="op" id="3073086">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3073090">commonHeader</span><span class="op" id="3073102">[</span><span class="ident" id="3073103">v</span><span class="op" id="3073104">]</span>&nbsp;<span class="op" id="3073106">=</span>&nbsp;<span class="ident" id="3073108">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3073111">}</span><br>
<span class="lineno"></span><span class="op" id="3073113">}</span>
</div>
</body>
</html>
