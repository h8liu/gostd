<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8147905">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8147960">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8148014">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8148065">package</span>&nbsp;<span class="ident" id="8148073">subtle</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8148081">import</span>&nbsp;<span class="op" id="8148088">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8148091">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8148102">&#34;testing/quick&#34;</span><br>
<span class="lineno">10</span><span class="op" id="8148118">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8148121">type</span>&nbsp;<span class="ident" id="8148126">TestConstantTimeCompareStruct</span>&nbsp;<span class="keyword" id="8148156">struct</span>&nbsp;<span class="op" id="8148163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8148166">a</span><span class="op" id="8148167">,</span>&nbsp;<span class="ident" id="8148169">b</span>&nbsp;<span class="op" id="8148171">[</span><span class="op" id="8148172">]</span><span class="builtintype" id="8148173">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8148179">out</span>&nbsp;&nbsp;<span class="builtintype" id="8148184">int</span><br>
<span class="lineno">15</span><span class="op" id="8148188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8148191">var</span>&nbsp;<span class="ident" id="8148195">testConstantTimeCompareData</span>&nbsp;<span class="op" id="8148223">=</span>&nbsp;<span class="op" id="8148225">[</span><span class="op" id="8148226">]</span><span class="ident" id="8148227">TestConstantTimeCompareStruct</span><span class="op" id="8148256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8148259">{</span><span class="op" id="8148260">[</span><span class="op" id="8148261">]</span><span class="builtintype" id="8148262">byte</span><span class="op" id="8148266">{</span><span class="op" id="8148267">}</span><span class="op" id="8148268">,</span>&nbsp;<span class="op" id="8148270">[</span><span class="op" id="8148271">]</span><span class="builtintype" id="8148272">byte</span><span class="op" id="8148276">{</span><span class="op" id="8148277">}</span><span class="op" id="8148278">,</span>&nbsp;<span class="num" id="8148280">1</span><span class="op" id="8148281">}</span><span class="op" id="8148282">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8148285">{</span><span class="op" id="8148286">[</span><span class="op" id="8148287">]</span><span class="builtintype" id="8148288">byte</span><span class="op" id="8148292">{</span><span class="num" id="8148293">0x11</span><span class="op" id="8148297">}</span><span class="op" id="8148298">,</span>&nbsp;<span class="op" id="8148300">[</span><span class="op" id="8148301">]</span><span class="builtintype" id="8148302">byte</span><span class="op" id="8148306">{</span><span class="num" id="8148307">0x11</span><span class="op" id="8148311">}</span><span class="op" id="8148312">,</span>&nbsp;<span class="num" id="8148314">1</span><span class="op" id="8148315">}</span><span class="op" id="8148316">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8148319">{</span><span class="op" id="8148320">[</span><span class="op" id="8148321">]</span><span class="builtintype" id="8148322">byte</span><span class="op" id="8148326">{</span><span class="num" id="8148327">0x12</span><span class="op" id="8148331">}</span><span class="op" id="8148332">,</span>&nbsp;<span class="op" id="8148334">[</span><span class="op" id="8148335">]</span><span class="builtintype" id="8148336">byte</span><span class="op" id="8148340">{</span><span class="num" id="8148341">0x11</span><span class="op" id="8148345">}</span><span class="op" id="8148346">,</span>&nbsp;<span class="num" id="8148348">0</span><span class="op" id="8148349">}</span><span class="op" id="8148350">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8148353">{</span><span class="op" id="8148354">[</span><span class="op" id="8148355">]</span><span class="builtintype" id="8148356">byte</span><span class="op" id="8148360">{</span><span class="num" id="8148361">0x11</span><span class="op" id="8148365">}</span><span class="op" id="8148366">,</span>&nbsp;<span class="op" id="8148368">[</span><span class="op" id="8148369">]</span><span class="builtintype" id="8148370">byte</span><span class="op" id="8148374">{</span><span class="num" id="8148375">0x11</span><span class="op" id="8148379">,</span>&nbsp;<span class="num" id="8148381">0x12</span><span class="op" id="8148385">}</span><span class="op" id="8148386">,</span>&nbsp;<span class="num" id="8148388">0</span><span class="op" id="8148389">}</span><span class="op" id="8148390">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8148393">{</span><span class="op" id="8148394">[</span><span class="op" id="8148395">]</span><span class="builtintype" id="8148396">byte</span><span class="op" id="8148400">{</span><span class="num" id="8148401">0x11</span><span class="op" id="8148405">,</span>&nbsp;<span class="num" id="8148407">0x12</span><span class="op" id="8148411">}</span><span class="op" id="8148412">,</span>&nbsp;<span class="op" id="8148414">[</span><span class="op" id="8148415">]</span><span class="builtintype" id="8148416">byte</span><span class="op" id="8148420">{</span><span class="num" id="8148421">0x11</span><span class="op" id="8148425">}</span><span class="op" id="8148426">,</span>&nbsp;<span class="num" id="8148428">0</span><span class="op" id="8148429">}</span><span class="op" id="8148430">,</span><br>
<span class="lineno"></span><span class="op" id="8148432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="8148435">func</span>&nbsp;<span class="ident" id="8148440">TestConstantTimeCompare</span><span class="op" id="8148463">(</span><span class="ident" id="8148464">t</span>&nbsp;<span class="op" id="8148466">*</span><span class="ident" id="8148467">testing</span><span class="op" id="8148474">.</span><span class="ident" id="8148475">T</span><span class="op" id="8148476">)</span>&nbsp;<span class="op" id="8148478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8148481">for</span>&nbsp;<span class="ident" id="8148485">i</span><span class="op" id="8148486">,</span>&nbsp;<span class="ident" id="8148488">test</span>&nbsp;<span class="op" id="8148493">:=</span>&nbsp;<span class="keyword" id="8148496">range</span>&nbsp;<span class="ident" id="8148502">testConstantTimeCompareData</span>&nbsp;<span class="op" id="8148530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8148534">if</span>&nbsp;<span class="ident" id="8148537">r</span>&nbsp;<span class="op" id="8148539">:=</span>&nbsp;<span class="ident" id="8148542">ConstantTimeCompare</span><span class="op" id="8148561">(</span><span class="ident" id="8148562">test</span><span class="op" id="8148566">.</span><span class="ident" id="8148567">a</span><span class="op" id="8148568">,</span>&nbsp;<span class="ident" id="8148570">test</span><span class="op" id="8148574">.</span><span class="ident" id="8148575">b</span><span class="op" id="8148576">)</span><span class="op" id="8148577">;</span>&nbsp;<span class="ident" id="8148579">r</span>&nbsp;<span class="op" id="8148581">!=</span>&nbsp;<span class="ident" id="8148584">test</span><span class="op" id="8148588">.</span><span class="ident" id="8148589">out</span>&nbsp;<span class="op" id="8148593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8148598">t</span><span class="op" id="8148599">.</span><span class="ident" id="8148600">Errorf</span><span class="op" id="8148606">(</span><span class="string" id="8148607">&#34;#%d&nbsp;bad&nbsp;result&nbsp;(got&nbsp;%x,&nbsp;want&nbsp;%x)&#34;</span><span class="op" id="8148641">,</span>&nbsp;<span class="ident" id="8148643">i</span><span class="op" id="8148644">,</span>&nbsp;<span class="ident" id="8148646">r</span><span class="op" id="8148647">,</span>&nbsp;<span class="ident" id="8148649">test</span><span class="op" id="8148653">.</span><span class="ident" id="8148654">out</span><span class="op" id="8148657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8148661">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8148664">}</span><br>
<span class="lineno"></span><span class="op" id="8148666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8148669">type</span>&nbsp;<span class="ident" id="8148674">TestConstantTimeByteEqStruct</span>&nbsp;<span class="keyword" id="8148703">struct</span>&nbsp;<span class="op" id="8148710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8148713">a</span><span class="op" id="8148714">,</span>&nbsp;<span class="ident" id="8148716">b</span>&nbsp;<span class="builtintype" id="8148718">uint8</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8148725">out</span>&nbsp;&nbsp;<span class="builtintype" id="8148730">int</span><br>
<span class="lineno"></span><span class="op" id="8148734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8148737">var</span>&nbsp;<span class="ident" id="8148741">testConstandTimeByteEqData</span>&nbsp;<span class="op" id="8148768">=</span>&nbsp;<span class="op" id="8148770">[</span><span class="op" id="8148771">]</span><span class="ident" id="8148772">TestConstantTimeByteEqStruct</span><span class="op" id="8148800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8148803">{</span><span class="num" id="8148804">0</span><span class="op" id="8148805">,</span>&nbsp;<span class="num" id="8148807">0</span><span class="op" id="8148808">,</span>&nbsp;<span class="num" id="8148810">1</span><span class="op" id="8148811">}</span><span class="op" id="8148812">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8148815">{</span><span class="num" id="8148816">0</span><span class="op" id="8148817">,</span>&nbsp;<span class="num" id="8148819">1</span><span class="op" id="8148820">,</span>&nbsp;<span class="num" id="8148822">0</span><span class="op" id="8148823">}</span><span class="op" id="8148824">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8148827">{</span><span class="num" id="8148828">1</span><span class="op" id="8148829">,</span>&nbsp;<span class="num" id="8148831">0</span><span class="op" id="8148832">,</span>&nbsp;<span class="num" id="8148834">0</span><span class="op" id="8148835">}</span><span class="op" id="8148836">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8148839">{</span><span class="num" id="8148840">0xff</span><span class="op" id="8148844">,</span>&nbsp;<span class="num" id="8148846">0xff</span><span class="op" id="8148850">,</span>&nbsp;<span class="num" id="8148852">1</span><span class="op" id="8148853">}</span><span class="op" id="8148854">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8148857">{</span><span class="num" id="8148858">0xff</span><span class="op" id="8148862">,</span>&nbsp;<span class="num" id="8148864">0xfe</span><span class="op" id="8148868">,</span>&nbsp;<span class="num" id="8148870">0</span><span class="op" id="8148871">}</span><span class="op" id="8148872">,</span><br>
<span class="lineno"></span><span class="op" id="8148874">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="8148877">func</span>&nbsp;<span class="ident" id="8148882">byteEq</span><span class="op" id="8148888">(</span><span class="ident" id="8148889">a</span><span class="op" id="8148890">,</span>&nbsp;<span class="ident" id="8148892">b</span>&nbsp;<span class="builtintype" id="8148894">uint8</span><span class="op" id="8148899">)</span>&nbsp;<span class="builtintype" id="8148901">int</span>&nbsp;<span class="op" id="8148905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8148908">if</span>&nbsp;<span class="ident" id="8148911">a</span>&nbsp;<span class="op" id="8148913">==</span>&nbsp;<span class="ident" id="8148916">b</span>&nbsp;<span class="op" id="8148918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8148922">return</span>&nbsp;<span class="num" id="8148929">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8148932">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8148935">return</span>&nbsp;<span class="num" id="8148942">0</span><br>
<span class="lineno"></span><span class="op" id="8148944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8148947">func</span>&nbsp;<span class="ident" id="8148952">TestConstantTimeByteEq</span><span class="op" id="8148974">(</span><span class="ident" id="8148975">t</span>&nbsp;<span class="op" id="8148977">*</span><span class="ident" id="8148978">testing</span><span class="op" id="8148985">.</span><span class="ident" id="8148986">T</span><span class="op" id="8148987">)</span>&nbsp;<span class="op" id="8148989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8148992">for</span>&nbsp;<span class="ident" id="8148996">i</span><span class="op" id="8148997">,</span>&nbsp;<span class="ident" id="8148999">test</span>&nbsp;<span class="op" id="8149004">:=</span>&nbsp;<span class="keyword" id="8149007">range</span>&nbsp;<span class="ident" id="8149013">testConstandTimeByteEqData</span>&nbsp;<span class="op" id="8149040">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8149044">if</span>&nbsp;<span class="ident" id="8149047">r</span>&nbsp;<span class="op" id="8149049">:=</span>&nbsp;<span class="ident" id="8149052">ConstantTimeByteEq</span><span class="op" id="8149070">(</span><span class="ident" id="8149071">test</span><span class="op" id="8149075">.</span><span class="ident" id="8149076">a</span><span class="op" id="8149077">,</span>&nbsp;<span class="ident" id="8149079">test</span><span class="op" id="8149083">.</span><span class="ident" id="8149084">b</span><span class="op" id="8149085">)</span><span class="op" id="8149086">;</span>&nbsp;<span class="ident" id="8149088">r</span>&nbsp;<span class="op" id="8149090">!=</span>&nbsp;<span class="ident" id="8149093">test</span><span class="op" id="8149097">.</span><span class="ident" id="8149098">out</span>&nbsp;<span class="op" id="8149102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149107">t</span><span class="op" id="8149108">.</span><span class="ident" id="8149109">Errorf</span><span class="op" id="8149115">(</span><span class="string" id="8149116">&#34;#%d&nbsp;bad&nbsp;result&nbsp;(got&nbsp;%x,&nbsp;want&nbsp;%x)&#34;</span><span class="op" id="8149150">,</span>&nbsp;<span class="ident" id="8149152">i</span><span class="op" id="8149153">,</span>&nbsp;<span class="ident" id="8149155">r</span><span class="op" id="8149156">,</span>&nbsp;<span class="ident" id="8149158">test</span><span class="op" id="8149162">.</span><span class="ident" id="8149163">out</span><span class="op" id="8149166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8149170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8149173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149176">err</span>&nbsp;<span class="op" id="8149180">:=</span>&nbsp;<span class="ident" id="8149183">quick</span><span class="op" id="8149188">.</span><span class="ident" id="8149189">CheckEqual</span><span class="op" id="8149199">(</span><span class="ident" id="8149200">ConstantTimeByteEq</span><span class="op" id="8149218">,</span>&nbsp;<span class="ident" id="8149220">byteEq</span><span class="op" id="8149226">,</span>&nbsp;<span class="ident" id="8149228">nil</span><span class="op" id="8149231">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8149234">if</span>&nbsp;<span class="ident" id="8149237">err</span>&nbsp;<span class="op" id="8149241">!=</span>&nbsp;<span class="ident" id="8149244">nil</span>&nbsp;<span class="op" id="8149248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149252">t</span><span class="op" id="8149253">.</span><span class="ident" id="8149254">Error</span><span class="op" id="8149259">(</span><span class="ident" id="8149260">err</span><span class="op" id="8149263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8149266">}</span><br>
<span class="lineno"></span><span class="op" id="8149268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="8149271">func</span>&nbsp;<span class="ident" id="8149276">eq</span><span class="op" id="8149278">(</span><span class="ident" id="8149279">a</span><span class="op" id="8149280">,</span>&nbsp;<span class="ident" id="8149282">b</span>&nbsp;<span class="builtintype" id="8149284">int32</span><span class="op" id="8149289">)</span>&nbsp;<span class="builtintype" id="8149291">int</span>&nbsp;<span class="op" id="8149295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8149298">if</span>&nbsp;<span class="ident" id="8149301">a</span>&nbsp;<span class="op" id="8149303">==</span>&nbsp;<span class="ident" id="8149306">b</span>&nbsp;<span class="op" id="8149308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8149312">return</span>&nbsp;<span class="num" id="8149319">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8149322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8149325">return</span>&nbsp;<span class="num" id="8149332">0</span><br>
<span class="lineno">70</span><span class="op" id="8149334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8149337">func</span>&nbsp;<span class="ident" id="8149342">TestConstantTimeEq</span><span class="op" id="8149360">(</span><span class="ident" id="8149361">t</span>&nbsp;<span class="op" id="8149363">*</span><span class="ident" id="8149364">testing</span><span class="op" id="8149371">.</span><span class="ident" id="8149372">T</span><span class="op" id="8149373">)</span>&nbsp;<span class="op" id="8149375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149378">err</span>&nbsp;<span class="op" id="8149382">:=</span>&nbsp;<span class="ident" id="8149385">quick</span><span class="op" id="8149390">.</span><span class="ident" id="8149391">CheckEqual</span><span class="op" id="8149401">(</span><span class="ident" id="8149402">ConstantTimeEq</span><span class="op" id="8149416">,</span>&nbsp;<span class="ident" id="8149418">eq</span><span class="op" id="8149420">,</span>&nbsp;<span class="ident" id="8149422">nil</span><span class="op" id="8149425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8149428">if</span>&nbsp;<span class="ident" id="8149431">err</span>&nbsp;<span class="op" id="8149435">!=</span>&nbsp;<span class="ident" id="8149438">nil</span>&nbsp;<span class="op" id="8149442">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149446">t</span><span class="op" id="8149447">.</span><span class="ident" id="8149448">Error</span><span class="op" id="8149453">(</span><span class="ident" id="8149454">err</span><span class="op" id="8149457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8149460">}</span><br>
<span class="lineno"></span><span class="op" id="8149462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8149465">func</span>&nbsp;<span class="ident" id="8149470">makeCopy</span><span class="op" id="8149478">(</span><span class="ident" id="8149479">v</span>&nbsp;<span class="builtintype" id="8149481">int</span><span class="op" id="8149484">,</span>&nbsp;<span class="ident" id="8149486">x</span><span class="op" id="8149487">,</span>&nbsp;<span class="ident" id="8149489">y</span>&nbsp;<span class="op" id="8149491">[</span><span class="op" id="8149492">]</span><span class="builtintype" id="8149493">byte</span><span class="op" id="8149497">)</span>&nbsp;<span class="op" id="8149499">[</span><span class="op" id="8149500">]</span><span class="builtintype" id="8149501">byte</span>&nbsp;<span class="op" id="8149506">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8149509">if</span>&nbsp;<span class="builtinfunc" id="8149512">len</span><span class="op" id="8149515">(</span><span class="ident" id="8149516">x</span><span class="op" id="8149517">)</span>&nbsp;<span class="op" id="8149519">&gt;</span>&nbsp;<span class="builtinfunc" id="8149521">len</span><span class="op" id="8149524">(</span><span class="ident" id="8149525">y</span><span class="op" id="8149526">)</span>&nbsp;<span class="op" id="8149528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149532">x</span>&nbsp;<span class="op" id="8149534">=</span>&nbsp;<span class="ident" id="8149536">x</span><span class="op" id="8149537">[</span><span class="num" id="8149538">0</span><span class="op" id="8149539">:</span><span class="builtinfunc" id="8149540">len</span><span class="op" id="8149543">(</span><span class="ident" id="8149544">y</span><span class="op" id="8149545">)</span><span class="op" id="8149546">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8149549">}</span>&nbsp;<span class="keyword" id="8149551">else</span>&nbsp;<span class="op" id="8149556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149560">y</span>&nbsp;<span class="op" id="8149562">=</span>&nbsp;<span class="ident" id="8149564">y</span><span class="op" id="8149565">[</span><span class="num" id="8149566">0</span><span class="op" id="8149567">:</span><span class="builtinfunc" id="8149568">len</span><span class="op" id="8149571">(</span><span class="ident" id="8149572">x</span><span class="op" id="8149573">)</span><span class="op" id="8149574">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8149577">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8149580">if</span>&nbsp;<span class="ident" id="8149583">v</span>&nbsp;<span class="op" id="8149585">==</span>&nbsp;<span class="num" id="8149588">1</span>&nbsp;<span class="op" id="8149590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8149594">copy</span><span class="op" id="8149598">(</span><span class="ident" id="8149599">x</span><span class="op" id="8149600">,</span>&nbsp;<span class="ident" id="8149602">y</span><span class="op" id="8149603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8149606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8149609">return</span>&nbsp;<span class="ident" id="8149616">x</span><br>
<span class="lineno"></span><span class="op" id="8149618">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="8149621">func</span>&nbsp;<span class="ident" id="8149626">constantTimeCopyWrapper</span><span class="op" id="8149649">(</span><span class="ident" id="8149650">v</span>&nbsp;<span class="builtintype" id="8149652">int</span><span class="op" id="8149655">,</span>&nbsp;<span class="ident" id="8149657">x</span><span class="op" id="8149658">,</span>&nbsp;<span class="ident" id="8149660">y</span>&nbsp;<span class="op" id="8149662">[</span><span class="op" id="8149663">]</span><span class="builtintype" id="8149664">byte</span><span class="op" id="8149668">)</span>&nbsp;<span class="op" id="8149670">[</span><span class="op" id="8149671">]</span><span class="builtintype" id="8149672">byte</span>&nbsp;<span class="op" id="8149677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8149680">if</span>&nbsp;<span class="builtinfunc" id="8149683">len</span><span class="op" id="8149686">(</span><span class="ident" id="8149687">x</span><span class="op" id="8149688">)</span>&nbsp;<span class="op" id="8149690">&gt;</span>&nbsp;<span class="builtinfunc" id="8149692">len</span><span class="op" id="8149695">(</span><span class="ident" id="8149696">y</span><span class="op" id="8149697">)</span>&nbsp;<span class="op" id="8149699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149703">x</span>&nbsp;<span class="op" id="8149705">=</span>&nbsp;<span class="ident" id="8149707">x</span><span class="op" id="8149708">[</span><span class="num" id="8149709">0</span><span class="op" id="8149710">:</span><span class="builtinfunc" id="8149711">len</span><span class="op" id="8149714">(</span><span class="ident" id="8149715">y</span><span class="op" id="8149716">)</span><span class="op" id="8149717">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8149720">}</span>&nbsp;<span class="keyword" id="8149722">else</span>&nbsp;<span class="op" id="8149727">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149731">y</span>&nbsp;<span class="op" id="8149733">=</span>&nbsp;<span class="ident" id="8149735">y</span><span class="op" id="8149736">[</span><span class="num" id="8149737">0</span><span class="op" id="8149738">:</span><span class="builtinfunc" id="8149739">len</span><span class="op" id="8149742">(</span><span class="ident" id="8149743">x</span><span class="op" id="8149744">)</span><span class="op" id="8149745">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8149748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149751">v</span>&nbsp;<span class="op" id="8149753">&amp;=</span>&nbsp;<span class="num" id="8149756">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149759">ConstantTimeCopy</span><span class="op" id="8149775">(</span><span class="ident" id="8149776">v</span><span class="op" id="8149777">,</span>&nbsp;<span class="ident" id="8149779">x</span><span class="op" id="8149780">,</span>&nbsp;<span class="ident" id="8149782">y</span><span class="op" id="8149783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8149786">return</span>&nbsp;<span class="ident" id="8149793">x</span><br>
<span class="lineno">100</span><span class="op" id="8149795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8149798">func</span>&nbsp;<span class="ident" id="8149803">TestConstantTimeCopy</span><span class="op" id="8149823">(</span><span class="ident" id="8149824">t</span>&nbsp;<span class="op" id="8149826">*</span><span class="ident" id="8149827">testing</span><span class="op" id="8149834">.</span><span class="ident" id="8149835">T</span><span class="op" id="8149836">)</span>&nbsp;<span class="op" id="8149838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149841">err</span>&nbsp;<span class="op" id="8149845">:=</span>&nbsp;<span class="ident" id="8149848">quick</span><span class="op" id="8149853">.</span><span class="ident" id="8149854">CheckEqual</span><span class="op" id="8149864">(</span><span class="ident" id="8149865">constantTimeCopyWrapper</span><span class="op" id="8149888">,</span>&nbsp;<span class="ident" id="8149890">makeCopy</span><span class="op" id="8149898">,</span>&nbsp;<span class="ident" id="8149900">nil</span><span class="op" id="8149903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8149906">if</span>&nbsp;<span class="ident" id="8149909">err</span>&nbsp;<span class="op" id="8149913">!=</span>&nbsp;<span class="ident" id="8149916">nil</span>&nbsp;<span class="op" id="8149920">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149924">t</span><span class="op" id="8149925">.</span><span class="ident" id="8149926">Error</span><span class="op" id="8149931">(</span><span class="ident" id="8149932">err</span><span class="op" id="8149935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8149938">}</span><br>
<span class="lineno"></span><span class="op" id="8149940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8149943">var</span>&nbsp;<span class="ident" id="8149947">lessOrEqTests</span>&nbsp;<span class="op" id="8149961">=</span>&nbsp;<span class="op" id="8149963">[</span><span class="op" id="8149964">]</span><span class="keyword" id="8149965">struct</span>&nbsp;<span class="op" id="8149972">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149975">x</span><span class="op" id="8149976">,</span>&nbsp;<span class="ident" id="8149978">y</span><span class="op" id="8149979">,</span>&nbsp;<span class="ident" id="8149981">result</span>&nbsp;<span class="builtintype" id="8149988">int</span><br>
<span class="lineno"></span><span class="op" id="8149992">}</span><span class="op" id="8149993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8149996">{</span><span class="num" id="8149997">0</span><span class="op" id="8149998">,</span>&nbsp;<span class="num" id="8150000">0</span><span class="op" id="8150001">,</span>&nbsp;<span class="num" id="8150003">1</span><span class="op" id="8150004">}</span><span class="op" id="8150005">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8150008">{</span><span class="num" id="8150009">1</span><span class="op" id="8150010">,</span>&nbsp;<span class="num" id="8150012">0</span><span class="op" id="8150013">,</span>&nbsp;<span class="num" id="8150015">0</span><span class="op" id="8150016">}</span><span class="op" id="8150017">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8150020">{</span><span class="num" id="8150021">0</span><span class="op" id="8150022">,</span>&nbsp;<span class="num" id="8150024">1</span><span class="op" id="8150025">,</span>&nbsp;<span class="num" id="8150027">1</span><span class="op" id="8150028">}</span><span class="op" id="8150029">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8150032">{</span><span class="num" id="8150033">10</span><span class="op" id="8150035">,</span>&nbsp;<span class="num" id="8150037">20</span><span class="op" id="8150039">,</span>&nbsp;<span class="num" id="8150041">1</span><span class="op" id="8150042">}</span><span class="op" id="8150043">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8150046">{</span><span class="num" id="8150047">20</span><span class="op" id="8150049">,</span>&nbsp;<span class="num" id="8150051">10</span><span class="op" id="8150053">,</span>&nbsp;<span class="num" id="8150055">0</span><span class="op" id="8150056">}</span><span class="op" id="8150057">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8150060">{</span><span class="num" id="8150061">10</span><span class="op" id="8150063">,</span>&nbsp;<span class="num" id="8150065">10</span><span class="op" id="8150067">,</span>&nbsp;<span class="num" id="8150069">1</span><span class="op" id="8150070">}</span><span class="op" id="8150071">,</span><br>
<span class="lineno"></span><span class="op" id="8150073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="8150076">func</span>&nbsp;<span class="ident" id="8150081">TestConstantTimeLessOrEq</span><span class="op" id="8150105">(</span><span class="ident" id="8150106">t</span>&nbsp;<span class="op" id="8150108">*</span><span class="ident" id="8150109">testing</span><span class="op" id="8150116">.</span><span class="ident" id="8150117">T</span><span class="op" id="8150118">)</span>&nbsp;<span class="op" id="8150120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8150123">for</span>&nbsp;<span class="ident" id="8150127">i</span><span class="op" id="8150128">,</span>&nbsp;<span class="ident" id="8150130">test</span>&nbsp;<span class="op" id="8150135">:=</span>&nbsp;<span class="keyword" id="8150138">range</span>&nbsp;<span class="ident" id="8150144">lessOrEqTests</span>&nbsp;<span class="op" id="8150158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8150162">result</span>&nbsp;<span class="op" id="8150169">:=</span>&nbsp;<span class="ident" id="8150172">ConstantTimeLessOrEq</span><span class="op" id="8150192">(</span><span class="ident" id="8150193">test</span><span class="op" id="8150197">.</span><span class="ident" id="8150198">x</span><span class="op" id="8150199">,</span>&nbsp;<span class="ident" id="8150201">test</span><span class="op" id="8150205">.</span><span class="ident" id="8150206">y</span><span class="op" id="8150207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8150211">if</span>&nbsp;<span class="ident" id="8150214">result</span>&nbsp;<span class="op" id="8150221">!=</span>&nbsp;<span class="ident" id="8150224">test</span><span class="op" id="8150228">.</span><span class="ident" id="8150229">result</span>&nbsp;<span class="op" id="8150236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8150241">t</span><span class="op" id="8150242">.</span><span class="ident" id="8150243">Errorf</span><span class="op" id="8150249">(</span><span class="string" id="8150250">&#34;#%d:&nbsp;%d&nbsp;&lt;=&nbsp;%d&nbsp;gave&nbsp;%d,&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8150286">,</span>&nbsp;<span class="ident" id="8150288">i</span><span class="op" id="8150289">,</span>&nbsp;<span class="ident" id="8150291">test</span><span class="op" id="8150295">.</span><span class="ident" id="8150296">x</span><span class="op" id="8150297">,</span>&nbsp;<span class="ident" id="8150299">test</span><span class="op" id="8150303">.</span><span class="ident" id="8150304">y</span><span class="op" id="8150305">,</span>&nbsp;<span class="ident" id="8150307">result</span><span class="op" id="8150313">,</span>&nbsp;<span class="ident" id="8150315">test</span><span class="op" id="8150319">.</span><span class="ident" id="8150320">result</span><span class="op" id="8150326">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8150330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8150333">}</span><br>
<span class="lineno"></span><span class="op" id="8150335">}</span>
</div>
</body>
</html>
