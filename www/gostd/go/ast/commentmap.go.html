<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/ast</h2>
<ul>
<li><a href="/gostd/go/ast/ast.go.html">ast.go</a></li>
<li><a href="/gostd/go/ast/ast_test.go.html">ast_test.go</a></li>
<li><a href="/gostd/go/ast/commentmap.go.html">commentmap.go</a></li>
<li><a href="/gostd/go/ast/commentmap_test.go.html">commentmap_test.go</a></li>
<li><a href="/gostd/go/ast/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/ast/filter.go.html">filter.go</a></li>
<li><a href="/gostd/go/ast/filter_test.go.html">filter_test.go</a></li>
<li><a href="/gostd/go/ast/import.go.html">import.go</a></li>
<li><a href="/gostd/go/ast/print.go.html">print.go</a></li>
<li><a href="/gostd/go/ast/print_test.go.html">print_test.go</a></li>
<li><a href="/gostd/go/ast/resolve.go.html">resolve.go</a></li>
<li><a href="/gostd/go/ast/scope.go.html">scope.go</a></li>
<li><a href="/gostd/go/ast/walk.go.html">walk.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2297384">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2297439">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2297493">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2297544">package</span>&nbsp;<span class="ident" id="2297552">ast</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2297557">import</span>&nbsp;<span class="op" id="2297564">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2297567">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2297576">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2297583">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2297595">&#34;sort&#34;</span><br>
<span class="lineno"></span><span class="op" id="2297602">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2297605">type</span>&nbsp;<span class="ident" id="2297610">byPos</span>&nbsp;<span class="op" id="2297616">[</span><span class="op" id="2297617">]</span><span class="op" id="2297618">*</span><span class="ident" id="2297619">CommentGroup</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="2297633">func</span>&nbsp;<span class="op" id="2297638">(</span><span class="ident" id="2297639">a</span>&nbsp;<span class="ident" id="2297641">byPos</span><span class="op" id="2297646">)</span>&nbsp;<span class="ident" id="2297648">Len</span><span class="op" id="2297651">(</span><span class="op" id="2297652">)</span>&nbsp;<span class="builtintype" id="2297654">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2297668">{</span>&nbsp;<span class="keyword" id="2297670">return</span>&nbsp;<span class="builtinfunc" id="2297677">len</span><span class="op" id="2297680">(</span><span class="ident" id="2297681">a</span><span class="op" id="2297682">)</span>&nbsp;<span class="op" id="2297684">}</span><br>
<span class="lineno"></span><span class="keyword" id="2297686">func</span>&nbsp;<span class="op" id="2297691">(</span><span class="ident" id="2297692">a</span>&nbsp;<span class="ident" id="2297694">byPos</span><span class="op" id="2297699">)</span>&nbsp;<span class="ident" id="2297701">Less</span><span class="op" id="2297705">(</span><span class="ident" id="2297706">i</span><span class="op" id="2297707">,</span>&nbsp;<span class="ident" id="2297709">j</span>&nbsp;<span class="builtintype" id="2297711">int</span><span class="op" id="2297714">)</span>&nbsp;<span class="builtintype" id="2297716">bool</span>&nbsp;<span class="op" id="2297721">{</span>&nbsp;<span class="keyword" id="2297723">return</span>&nbsp;<span class="ident" id="2297730">a</span><span class="op" id="2297731">[</span><span class="ident" id="2297732">i</span><span class="op" id="2297733">]</span><span class="op" id="2297734">.</span><span class="ident" id="2297735">Pos</span><span class="op" id="2297738">(</span><span class="op" id="2297739">)</span>&nbsp;<span class="op" id="2297741">&lt;</span>&nbsp;<span class="ident" id="2297743">a</span><span class="op" id="2297744">[</span><span class="ident" id="2297745">j</span><span class="op" id="2297746">]</span><span class="op" id="2297747">.</span><span class="ident" id="2297748">Pos</span><span class="op" id="2297751">(</span><span class="op" id="2297752">)</span>&nbsp;<span class="op" id="2297754">}</span><br>
<span class="lineno"></span><span class="keyword" id="2297756">func</span>&nbsp;<span class="op" id="2297761">(</span><span class="ident" id="2297762">a</span>&nbsp;<span class="ident" id="2297764">byPos</span><span class="op" id="2297769">)</span>&nbsp;<span class="ident" id="2297771">Swap</span><span class="op" id="2297775">(</span><span class="ident" id="2297776">i</span><span class="op" id="2297777">,</span>&nbsp;<span class="ident" id="2297779">j</span>&nbsp;<span class="builtintype" id="2297781">int</span><span class="op" id="2297784">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2297791">{</span>&nbsp;<span class="ident" id="2297793">a</span><span class="op" id="2297794">[</span><span class="ident" id="2297795">i</span><span class="op" id="2297796">]</span><span class="op" id="2297797">,</span>&nbsp;<span class="ident" id="2297799">a</span><span class="op" id="2297800">[</span><span class="ident" id="2297801">j</span><span class="op" id="2297802">]</span>&nbsp;<span class="op" id="2297804">=</span>&nbsp;<span class="ident" id="2297806">a</span><span class="op" id="2297807">[</span><span class="ident" id="2297808">j</span><span class="op" id="2297809">]</span><span class="op" id="2297810">,</span>&nbsp;<span class="ident" id="2297812">a</span><span class="op" id="2297813">[</span><span class="ident" id="2297814">i</span><span class="op" id="2297815">]</span>&nbsp;<span class="op" id="2297817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="2297820">//&nbsp;sortComments&nbsp;sorts&nbsp;the&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups&nbsp;in&nbsp;source&nbsp;order.</span><br>
<span class="lineno"></span><span class="comment" id="2297886">//</span><br>
<span class="lineno"></span><span class="keyword" id="2297889">func</span>&nbsp;<span class="ident" id="2297894">sortComments</span><span class="op" id="2297906">(</span><span class="ident" id="2297907">list</span>&nbsp;<span class="op" id="2297912">[</span><span class="op" id="2297913">]</span><span class="op" id="2297914">*</span><span class="ident" id="2297915">CommentGroup</span><span class="op" id="2297927">)</span>&nbsp;<span class="op" id="2297929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2297932">//&nbsp;TODO(gri):&nbsp;Does&nbsp;it&nbsp;make&nbsp;sense&nbsp;to&nbsp;check&nbsp;for&nbsp;sorted-ness</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2297991">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;first&nbsp;(because&nbsp;we&nbsp;know&nbsp;that&nbsp;sorted-ness&nbsp;is</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2298049">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;very&nbsp;likely)?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2298078">if</span>&nbsp;<span class="ident" id="2298081">orderedList</span>&nbsp;<span class="op" id="2298093">:=</span>&nbsp;<span class="ident" id="2298096">byPos</span><span class="op" id="2298101">(</span><span class="ident" id="2298102">list</span><span class="op" id="2298106">)</span><span class="op" id="2298107">;</span>&nbsp;<span class="op" id="2298109">!</span><span class="ident" id="2298110">sort</span><span class="op" id="2298114">.</span><span class="ident" id="2298115">IsSorted</span><span class="op" id="2298123">(</span><span class="ident" id="2298124">orderedList</span><span class="op" id="2298135">)</span>&nbsp;<span class="op" id="2298137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2298141">sort</span><span class="op" id="2298145">.</span><span class="ident" id="2298146">Sort</span><span class="op" id="2298150">(</span><span class="ident" id="2298151">orderedList</span><span class="op" id="2298162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2298165">}</span><br>
<span class="lineno"></span><span class="op" id="2298167">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="2298170">//&nbsp;A&nbsp;CommentMap&nbsp;maps&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;a&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups</span><br>
<span class="lineno"></span><span class="comment" id="2298231">//&nbsp;associated&nbsp;with&nbsp;it.&nbsp;See&nbsp;NewCommentMap&nbsp;for&nbsp;a&nbsp;description&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2298293">//&nbsp;the&nbsp;association.</span><br>
<span class="lineno"></span><span class="comment" id="2298313">//</span><br>
<span class="lineno">35</span><span class="keyword" id="2298316">type</span>&nbsp;<span class="ident" id="2298321">CommentMap</span>&nbsp;<span class="keyword" id="2298332">map</span><span class="op" id="2298335">[</span><span class="ident" id="2298336">Node</span><span class="op" id="2298340">]</span><span class="op" id="2298341">[</span><span class="op" id="2298342">]</span><span class="op" id="2298343">*</span><span class="ident" id="2298344">CommentGroup</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2298358">func</span>&nbsp;<span class="op" id="2298363">(</span><span class="ident" id="2298364">cmap</span>&nbsp;<span class="ident" id="2298369">CommentMap</span><span class="op" id="2298379">)</span>&nbsp;<span class="ident" id="2298381">addComment</span><span class="op" id="2298391">(</span><span class="ident" id="2298392">n</span>&nbsp;<span class="ident" id="2298394">Node</span><span class="op" id="2298398">,</span>&nbsp;<span class="ident" id="2298400">c</span>&nbsp;<span class="op" id="2298402">*</span><span class="ident" id="2298403">CommentGroup</span><span class="op" id="2298415">)</span>&nbsp;<span class="op" id="2298417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2298420">list</span>&nbsp;<span class="op" id="2298425">:=</span>&nbsp;<span class="ident" id="2298428">cmap</span><span class="op" id="2298432">[</span><span class="ident" id="2298433">n</span><span class="op" id="2298434">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2298437">if</span>&nbsp;<span class="builtinfunc" id="2298440">len</span><span class="op" id="2298443">(</span><span class="ident" id="2298444">list</span><span class="op" id="2298448">)</span>&nbsp;<span class="op" id="2298450">==</span>&nbsp;<span class="num" id="2298453">0</span>&nbsp;<span class="op" id="2298455">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2298459">list</span>&nbsp;<span class="op" id="2298464">=</span>&nbsp;<span class="op" id="2298466">[</span><span class="op" id="2298467">]</span><span class="op" id="2298468">*</span><span class="ident" id="2298469">CommentGroup</span><span class="op" id="2298481">{</span><span class="ident" id="2298482">c</span><span class="op" id="2298483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2298486">}</span>&nbsp;<span class="keyword" id="2298488">else</span>&nbsp;<span class="op" id="2298493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2298497">list</span>&nbsp;<span class="op" id="2298502">=</span>&nbsp;<span class="builtinfunc" id="2298504">append</span><span class="op" id="2298510">(</span><span class="ident" id="2298511">list</span><span class="op" id="2298515">,</span>&nbsp;<span class="ident" id="2298517">c</span><span class="op" id="2298518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2298521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2298524">cmap</span><span class="op" id="2298528">[</span><span class="ident" id="2298529">n</span><span class="op" id="2298530">]</span>&nbsp;<span class="op" id="2298532">=</span>&nbsp;<span class="ident" id="2298534">list</span><br>
<span class="lineno">45</span><span class="op" id="2298539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2298542">type</span>&nbsp;<span class="ident" id="2298547">byInterval</span>&nbsp;<span class="op" id="2298558">[</span><span class="op" id="2298559">]</span><span class="ident" id="2298560">Node</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2298566">func</span>&nbsp;<span class="op" id="2298571">(</span><span class="ident" id="2298572">a</span>&nbsp;<span class="ident" id="2298574">byInterval</span><span class="op" id="2298584">)</span>&nbsp;<span class="ident" id="2298586">Len</span><span class="op" id="2298589">(</span><span class="op" id="2298590">)</span>&nbsp;<span class="builtintype" id="2298592">int</span>&nbsp;<span class="op" id="2298596">{</span>&nbsp;<span class="keyword" id="2298598">return</span>&nbsp;<span class="builtinfunc" id="2298605">len</span><span class="op" id="2298608">(</span><span class="ident" id="2298609">a</span><span class="op" id="2298610">)</span>&nbsp;<span class="op" id="2298612">}</span><br>
<span class="lineno">50</span><span class="keyword" id="2298614">func</span>&nbsp;<span class="op" id="2298619">(</span><span class="ident" id="2298620">a</span>&nbsp;<span class="ident" id="2298622">byInterval</span><span class="op" id="2298632">)</span>&nbsp;<span class="ident" id="2298634">Less</span><span class="op" id="2298638">(</span><span class="ident" id="2298639">i</span><span class="op" id="2298640">,</span>&nbsp;<span class="ident" id="2298642">j</span>&nbsp;<span class="builtintype" id="2298644">int</span><span class="op" id="2298647">)</span>&nbsp;<span class="builtintype" id="2298649">bool</span>&nbsp;<span class="op" id="2298654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2298657">pi</span><span class="op" id="2298659">,</span>&nbsp;<span class="ident" id="2298661">pj</span>&nbsp;<span class="op" id="2298664">:=</span>&nbsp;<span class="ident" id="2298667">a</span><span class="op" id="2298668">[</span><span class="ident" id="2298669">i</span><span class="op" id="2298670">]</span><span class="op" id="2298671">.</span><span class="ident" id="2298672">Pos</span><span class="op" id="2298675">(</span><span class="op" id="2298676">)</span><span class="op" id="2298677">,</span>&nbsp;<span class="ident" id="2298679">a</span><span class="op" id="2298680">[</span><span class="ident" id="2298681">j</span><span class="op" id="2298682">]</span><span class="op" id="2298683">.</span><span class="ident" id="2298684">Pos</span><span class="op" id="2298687">(</span><span class="op" id="2298688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2298691">return</span>&nbsp;<span class="ident" id="2298698">pi</span>&nbsp;<span class="op" id="2298701">&lt;</span>&nbsp;<span class="ident" id="2298703">pj</span>&nbsp;<span class="op" id="2298706">||</span>&nbsp;<span class="ident" id="2298709">pi</span>&nbsp;<span class="op" id="2298712">==</span>&nbsp;<span class="ident" id="2298715">pj</span>&nbsp;<span class="op" id="2298718">&amp;&amp;</span>&nbsp;<span class="ident" id="2298721">a</span><span class="op" id="2298722">[</span><span class="ident" id="2298723">i</span><span class="op" id="2298724">]</span><span class="op" id="2298725">.</span><span class="ident" id="2298726">End</span><span class="op" id="2298729">(</span><span class="op" id="2298730">)</span>&nbsp;<span class="op" id="2298732">&gt;</span>&nbsp;<span class="ident" id="2298734">a</span><span class="op" id="2298735">[</span><span class="ident" id="2298736">j</span><span class="op" id="2298737">]</span><span class="op" id="2298738">.</span><span class="ident" id="2298739">End</span><span class="op" id="2298742">(</span><span class="op" id="2298743">)</span><br>
<span class="lineno"></span><span class="op" id="2298745">}</span><br>
<span class="lineno"></span><span class="keyword" id="2298747">func</span>&nbsp;<span class="op" id="2298752">(</span><span class="ident" id="2298753">a</span>&nbsp;<span class="ident" id="2298755">byInterval</span><span class="op" id="2298765">)</span>&nbsp;<span class="ident" id="2298767">Swap</span><span class="op" id="2298771">(</span><span class="ident" id="2298772">i</span><span class="op" id="2298773">,</span>&nbsp;<span class="ident" id="2298775">j</span>&nbsp;<span class="builtintype" id="2298777">int</span><span class="op" id="2298780">)</span>&nbsp;<span class="op" id="2298782">{</span>&nbsp;<span class="ident" id="2298784">a</span><span class="op" id="2298785">[</span><span class="ident" id="2298786">i</span><span class="op" id="2298787">]</span><span class="op" id="2298788">,</span>&nbsp;<span class="ident" id="2298790">a</span><span class="op" id="2298791">[</span><span class="ident" id="2298792">j</span><span class="op" id="2298793">]</span>&nbsp;<span class="op" id="2298795">=</span>&nbsp;<span class="ident" id="2298797">a</span><span class="op" id="2298798">[</span><span class="ident" id="2298799">j</span><span class="op" id="2298800">]</span><span class="op" id="2298801">,</span>&nbsp;<span class="ident" id="2298803">a</span><span class="op" id="2298804">[</span><span class="ident" id="2298805">i</span><span class="op" id="2298806">]</span>&nbsp;<span class="op" id="2298808">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="2298811">//&nbsp;nodeList&nbsp;returns&nbsp;the&nbsp;list&nbsp;of&nbsp;nodes&nbsp;of&nbsp;the&nbsp;AST&nbsp;n&nbsp;in&nbsp;source&nbsp;order.</span><br>
<span class="lineno"></span><span class="comment" id="2298879">//</span><br>
<span class="lineno"></span><span class="keyword" id="2298882">func</span>&nbsp;<span class="ident" id="2298887">nodeList</span><span class="op" id="2298895">(</span><span class="ident" id="2298896">n</span>&nbsp;<span class="ident" id="2298898">Node</span><span class="op" id="2298902">)</span>&nbsp;<span class="op" id="2298904">[</span><span class="op" id="2298905">]</span><span class="ident" id="2298906">Node</span>&nbsp;<span class="op" id="2298911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2298914">var</span>&nbsp;<span class="ident" id="2298918">list</span>&nbsp;<span class="op" id="2298923">[</span><span class="op" id="2298924">]</span><span class="ident" id="2298925">Node</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2298931">Inspect</span><span class="op" id="2298938">(</span><span class="ident" id="2298939">n</span><span class="op" id="2298940">,</span>&nbsp;<span class="keyword" id="2298942">func</span><span class="op" id="2298946">(</span><span class="ident" id="2298947">n</span>&nbsp;<span class="ident" id="2298949">Node</span><span class="op" id="2298953">)</span>&nbsp;<span class="builtintype" id="2298955">bool</span>&nbsp;<span class="op" id="2298960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2298964">//&nbsp;don&#39;t&nbsp;collect&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2298992">switch</span>&nbsp;<span class="ident" id="2298999">n</span><span class="op" id="2299000">.</span><span class="op" id="2299001">(</span><span class="keyword" id="2299002">type</span><span class="op" id="2299006">)</span>&nbsp;<span class="op" id="2299008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2299012">case</span>&nbsp;<span class="ident" id="2299017">nil</span><span class="op" id="2299020">,</span>&nbsp;<span class="op" id="2299022">*</span><span class="ident" id="2299023">CommentGroup</span><span class="op" id="2299035">,</span>&nbsp;<span class="op" id="2299037">*</span><span class="ident" id="2299038">Comment</span><span class="op" id="2299045">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2299050">return</span>&nbsp;<span class="builtintype" id="2299057">false</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2299065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2299069">list</span>&nbsp;<span class="op" id="2299074">=</span>&nbsp;<span class="builtinfunc" id="2299076">append</span><span class="op" id="2299082">(</span><span class="ident" id="2299083">list</span><span class="op" id="2299087">,</span>&nbsp;<span class="ident" id="2299089">n</span><span class="op" id="2299090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2299094">return</span>&nbsp;<span class="builtintype" id="2299101">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2299107">}</span><span class="op" id="2299108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2299111">//&nbsp;Note:&nbsp;The&nbsp;current&nbsp;implementation&nbsp;assumes&nbsp;that&nbsp;Inspect&nbsp;traverses&nbsp;the</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2299183">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AST&nbsp;in&nbsp;depth-first&nbsp;and&nbsp;thus&nbsp;_source_&nbsp;order.&nbsp;If&nbsp;AST&nbsp;traversal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2299254">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;does&nbsp;not&nbsp;follow&nbsp;source&nbsp;order,&nbsp;the&nbsp;sorting&nbsp;call&nbsp;below&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2299325">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2299345">//&nbsp;sort.Sort(byInterval(list))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2299377">return</span>&nbsp;<span class="ident" id="2299384">list</span><br>
<span class="lineno">75</span><span class="op" id="2299389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2299392">//&nbsp;A&nbsp;commentListReader&nbsp;helps&nbsp;iterating&nbsp;through&nbsp;a&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups.</span><br>
<span class="lineno"></span><span class="comment" id="2299465">//</span><br>
<span class="lineno"></span><span class="keyword" id="2299468">type</span>&nbsp;<span class="ident" id="2299473">commentListReader</span>&nbsp;<span class="keyword" id="2299491">struct</span>&nbsp;<span class="op" id="2299498">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2299501">fset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2299510">*</span><span class="ident" id="2299511">token</span><span class="op" id="2299516">.</span><span class="ident" id="2299517">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2299526">list</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2299535">[</span><span class="op" id="2299536">]</span><span class="op" id="2299537">*</span><span class="ident" id="2299538">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2299552">index</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2299561">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2299566">comment</span>&nbsp;&nbsp;<span class="op" id="2299575">*</span><span class="ident" id="2299576">CommentGroup</span>&nbsp;&nbsp;<span class="comment" id="2299590">//&nbsp;comment&nbsp;group&nbsp;at&nbsp;current&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2299625">pos</span><span class="op" id="2299628">,</span>&nbsp;<span class="ident" id="2299630">end</span>&nbsp;<span class="ident" id="2299634">token</span><span class="op" id="2299639">.</span><span class="ident" id="2299640">Position</span>&nbsp;<span class="comment" id="2299649">//&nbsp;source&nbsp;interval&nbsp;of&nbsp;comment&nbsp;group&nbsp;at&nbsp;current&nbsp;index</span><br>
<span class="lineno">85</span><span class="op" id="2299702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2299705">func</span>&nbsp;<span class="op" id="2299710">(</span><span class="ident" id="2299711">r</span>&nbsp;<span class="op" id="2299713">*</span><span class="ident" id="2299714">commentListReader</span><span class="op" id="2299731">)</span>&nbsp;<span class="ident" id="2299733">eol</span><span class="op" id="2299736">(</span><span class="op" id="2299737">)</span>&nbsp;<span class="builtintype" id="2299739">bool</span>&nbsp;<span class="op" id="2299744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2299747">return</span>&nbsp;<span class="ident" id="2299754">r</span><span class="op" id="2299755">.</span><span class="ident" id="2299756">index</span>&nbsp;<span class="op" id="2299762">&gt;=</span>&nbsp;<span class="builtinfunc" id="2299765">len</span><span class="op" id="2299768">(</span><span class="ident" id="2299769">r</span><span class="op" id="2299770">.</span><span class="ident" id="2299771">list</span><span class="op" id="2299775">)</span><br>
<span class="lineno"></span><span class="op" id="2299777">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="2299780">func</span>&nbsp;<span class="op" id="2299785">(</span><span class="ident" id="2299786">r</span>&nbsp;<span class="op" id="2299788">*</span><span class="ident" id="2299789">commentListReader</span><span class="op" id="2299806">)</span>&nbsp;<span class="ident" id="2299808">next</span><span class="op" id="2299812">(</span><span class="op" id="2299813">)</span>&nbsp;<span class="op" id="2299815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2299818">if</span>&nbsp;<span class="op" id="2299821">!</span><span class="ident" id="2299822">r</span><span class="op" id="2299823">.</span><span class="ident" id="2299824">eol</span><span class="op" id="2299827">(</span><span class="op" id="2299828">)</span>&nbsp;<span class="op" id="2299830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2299834">r</span><span class="op" id="2299835">.</span><span class="ident" id="2299836">comment</span>&nbsp;<span class="op" id="2299844">=</span>&nbsp;<span class="ident" id="2299846">r</span><span class="op" id="2299847">.</span><span class="ident" id="2299848">list</span><span class="op" id="2299852">[</span><span class="ident" id="2299853">r</span><span class="op" id="2299854">.</span><span class="ident" id="2299855">index</span><span class="op" id="2299860">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2299864">r</span><span class="op" id="2299865">.</span><span class="ident" id="2299866">pos</span>&nbsp;<span class="op" id="2299870">=</span>&nbsp;<span class="ident" id="2299872">r</span><span class="op" id="2299873">.</span><span class="ident" id="2299874">fset</span><span class="op" id="2299878">.</span><span class="ident" id="2299879">Position</span><span class="op" id="2299887">(</span><span class="ident" id="2299888">r</span><span class="op" id="2299889">.</span><span class="ident" id="2299890">comment</span><span class="op" id="2299897">.</span><span class="ident" id="2299898">Pos</span><span class="op" id="2299901">(</span><span class="op" id="2299902">)</span><span class="op" id="2299903">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2299907">r</span><span class="op" id="2299908">.</span><span class="ident" id="2299909">end</span>&nbsp;<span class="op" id="2299913">=</span>&nbsp;<span class="ident" id="2299915">r</span><span class="op" id="2299916">.</span><span class="ident" id="2299917">fset</span><span class="op" id="2299921">.</span><span class="ident" id="2299922">Position</span><span class="op" id="2299930">(</span><span class="ident" id="2299931">r</span><span class="op" id="2299932">.</span><span class="ident" id="2299933">comment</span><span class="op" id="2299940">.</span><span class="ident" id="2299941">End</span><span class="op" id="2299944">(</span><span class="op" id="2299945">)</span><span class="op" id="2299946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2299950">r</span><span class="op" id="2299951">.</span><span class="ident" id="2299952">index</span><span class="op" id="2299957">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2299961">}</span><br>
<span class="lineno"></span><span class="op" id="2299963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="2299966">//&nbsp;A&nbsp;nodeStack&nbsp;keeps&nbsp;track&nbsp;of&nbsp;nested&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="comment" id="2300010">//&nbsp;A&nbsp;node&nbsp;lower&nbsp;on&nbsp;the&nbsp;stack&nbsp;lexically&nbsp;contains&nbsp;the&nbsp;nodes&nbsp;higher&nbsp;on&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="2300089">//</span><br>
<span class="lineno"></span><span class="keyword" id="2300092">type</span>&nbsp;<span class="ident" id="2300097">nodeStack</span>&nbsp;<span class="op" id="2300107">[</span><span class="op" id="2300108">]</span><span class="ident" id="2300109">Node</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="2300115">//&nbsp;push&nbsp;pops&nbsp;all&nbsp;nodes&nbsp;that&nbsp;appear&nbsp;lexically&nbsp;before&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="2300169">//&nbsp;and&nbsp;then&nbsp;pushes&nbsp;n&nbsp;on&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="2300204">//</span><br>
<span class="lineno"></span><span class="keyword" id="2300207">func</span>&nbsp;<span class="op" id="2300212">(</span><span class="ident" id="2300213">s</span>&nbsp;<span class="op" id="2300215">*</span><span class="ident" id="2300216">nodeStack</span><span class="op" id="2300225">)</span>&nbsp;<span class="ident" id="2300227">push</span><span class="op" id="2300231">(</span><span class="ident" id="2300232">n</span>&nbsp;<span class="ident" id="2300234">Node</span><span class="op" id="2300238">)</span>&nbsp;<span class="op" id="2300240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2300243">s</span><span class="op" id="2300244">.</span><span class="ident" id="2300245">pop</span><span class="op" id="2300248">(</span><span class="ident" id="2300249">n</span><span class="op" id="2300250">.</span><span class="ident" id="2300251">Pos</span><span class="op" id="2300254">(</span><span class="op" id="2300255">)</span><span class="op" id="2300256">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2300259">*</span><span class="ident" id="2300260">s</span>&nbsp;<span class="op" id="2300262">=</span>&nbsp;<span class="builtinfunc" id="2300264">append</span><span class="op" id="2300270">(</span><span class="op" id="2300271">(</span><span class="op" id="2300272">*</span><span class="ident" id="2300273">s</span><span class="op" id="2300274">)</span><span class="op" id="2300275">,</span>&nbsp;<span class="ident" id="2300277">n</span><span class="op" id="2300278">)</span><br>
<span class="lineno"></span><span class="op" id="2300280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2300283">//&nbsp;pop&nbsp;pops&nbsp;all&nbsp;nodes&nbsp;that&nbsp;appear&nbsp;lexically&nbsp;before&nbsp;pos</span><br>
<span class="lineno"></span><span class="comment" id="2300338">//&nbsp;(i.e.,&nbsp;whose&nbsp;lexical&nbsp;extent&nbsp;has&nbsp;ended&nbsp;before&nbsp;or&nbsp;at&nbsp;pos).</span><br>
<span class="lineno">115</span><span class="comment" id="2300398">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;last&nbsp;node&nbsp;popped.</span><br>
<span class="lineno"></span><span class="comment" id="2300434">//</span><br>
<span class="lineno"></span><span class="keyword" id="2300437">func</span>&nbsp;<span class="op" id="2300442">(</span><span class="ident" id="2300443">s</span>&nbsp;<span class="op" id="2300445">*</span><span class="ident" id="2300446">nodeStack</span><span class="op" id="2300455">)</span>&nbsp;<span class="ident" id="2300457">pop</span><span class="op" id="2300460">(</span><span class="ident" id="2300461">pos</span>&nbsp;<span class="ident" id="2300465">token</span><span class="op" id="2300470">.</span><span class="ident" id="2300471">Pos</span><span class="op" id="2300474">)</span>&nbsp;<span class="op" id="2300476">(</span><span class="ident" id="2300477">top</span>&nbsp;<span class="ident" id="2300481">Node</span><span class="op" id="2300485">)</span>&nbsp;<span class="op" id="2300487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2300490">i</span>&nbsp;<span class="op" id="2300492">:=</span>&nbsp;<span class="builtinfunc" id="2300495">len</span><span class="op" id="2300498">(</span><span class="op" id="2300499">*</span><span class="ident" id="2300500">s</span><span class="op" id="2300501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2300504">for</span>&nbsp;<span class="ident" id="2300508">i</span>&nbsp;<span class="op" id="2300510">&gt;</span>&nbsp;<span class="num" id="2300512">0</span>&nbsp;<span class="op" id="2300514">&amp;&amp;</span>&nbsp;<span class="op" id="2300517">(</span><span class="op" id="2300518">*</span><span class="ident" id="2300519">s</span><span class="op" id="2300520">)</span><span class="op" id="2300521">[</span><span class="ident" id="2300522">i</span><span class="op" id="2300523">-</span><span class="num" id="2300524">1</span><span class="op" id="2300525">]</span><span class="op" id="2300526">.</span><span class="ident" id="2300527">End</span><span class="op" id="2300530">(</span><span class="op" id="2300531">)</span>&nbsp;<span class="op" id="2300533">&lt;=</span>&nbsp;<span class="ident" id="2300536">pos</span>&nbsp;<span class="op" id="2300540">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2300544">top</span>&nbsp;<span class="op" id="2300548">=</span>&nbsp;<span class="op" id="2300550">(</span><span class="op" id="2300551">*</span><span class="ident" id="2300552">s</span><span class="op" id="2300553">)</span><span class="op" id="2300554">[</span><span class="ident" id="2300555">i</span><span class="op" id="2300556">-</span><span class="num" id="2300557">1</span><span class="op" id="2300558">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2300562">i</span><span class="op" id="2300563">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2300567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2300570">*</span><span class="ident" id="2300571">s</span>&nbsp;<span class="op" id="2300573">=</span>&nbsp;<span class="op" id="2300575">(</span><span class="op" id="2300576">*</span><span class="ident" id="2300577">s</span><span class="op" id="2300578">)</span><span class="op" id="2300579">[</span><span class="num" id="2300580">0</span><span class="op" id="2300581">:</span><span class="ident" id="2300582">i</span><span class="op" id="2300583">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2300586">return</span>&nbsp;<span class="ident" id="2300593">top</span><br>
<span class="lineno">125</span><span class="op" id="2300597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2300600">//&nbsp;NewCommentMap&nbsp;creates&nbsp;a&nbsp;new&nbsp;comment&nbsp;map&nbsp;by&nbsp;associating&nbsp;comment&nbsp;groups</span><br>
<span class="lineno"></span><span class="comment" id="2300673">//&nbsp;of&nbsp;the&nbsp;comments&nbsp;list&nbsp;with&nbsp;the&nbsp;nodes&nbsp;of&nbsp;the&nbsp;AST&nbsp;specified&nbsp;by&nbsp;node.</span><br>
<span class="lineno"></span><span class="comment" id="2300742">//</span><br>
<span class="lineno">130</span><span class="comment" id="2300745">//&nbsp;A&nbsp;comment&nbsp;group&nbsp;g&nbsp;is&nbsp;associated&nbsp;with&nbsp;a&nbsp;node&nbsp;n&nbsp;if:</span><br>
<span class="lineno"></span><span class="comment" id="2300798">//</span><br>
<span class="lineno"></span><span class="comment" id="2300801">//&nbsp;&nbsp;&nbsp;-&nbsp;g&nbsp;starts&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;n&nbsp;ends</span><br>
<span class="lineno"></span><span class="comment" id="2300844">//&nbsp;&nbsp;&nbsp;-&nbsp;g&nbsp;starts&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;following&nbsp;n,&nbsp;and&nbsp;there&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2300910">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;least&nbsp;one&nbsp;empty&nbsp;line&nbsp;after&nbsp;g&nbsp;and&nbsp;before&nbsp;the&nbsp;next&nbsp;node</span><br>
<span class="lineno">135</span><span class="comment" id="2300974">//&nbsp;&nbsp;&nbsp;-&nbsp;g&nbsp;starts&nbsp;before&nbsp;n&nbsp;and&nbsp;is&nbsp;not&nbsp;associated&nbsp;to&nbsp;the&nbsp;node&nbsp;before&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="2301042">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;via&nbsp;the&nbsp;previous&nbsp;rules</span><br>
<span class="lineno"></span><span class="comment" id="2301072">//</span><br>
<span class="lineno"></span><span class="comment" id="2301075">//&nbsp;NewCommentMap&nbsp;tries&nbsp;to&nbsp;associate&nbsp;a&nbsp;comment&nbsp;group&nbsp;to&nbsp;the&nbsp;&#34;largest&#34;</span><br>
<span class="lineno"></span><span class="comment" id="2301144">//&nbsp;node&nbsp;possible:&nbsp;For&nbsp;instance,&nbsp;if&nbsp;the&nbsp;comment&nbsp;is&nbsp;a&nbsp;line&nbsp;comment</span><br>
<span class="lineno">140</span><span class="comment" id="2301209">//&nbsp;trailing&nbsp;an&nbsp;assignment,&nbsp;the&nbsp;comment&nbsp;is&nbsp;associated&nbsp;with&nbsp;the&nbsp;entire</span><br>
<span class="lineno"></span><span class="comment" id="2301278">//&nbsp;assignment&nbsp;rather&nbsp;than&nbsp;just&nbsp;the&nbsp;last&nbsp;operand&nbsp;in&nbsp;the&nbsp;assignment.</span><br>
<span class="lineno"></span><span class="comment" id="2301345">//</span><br>
<span class="lineno"></span><span class="keyword" id="2301348">func</span>&nbsp;<span class="ident" id="2301353">NewCommentMap</span><span class="op" id="2301366">(</span><span class="ident" id="2301367">fset</span>&nbsp;<span class="op" id="2301372">*</span><span class="ident" id="2301373">token</span><span class="op" id="2301378">.</span><span class="ident" id="2301379">FileSet</span><span class="op" id="2301386">,</span>&nbsp;<span class="ident" id="2301388">node</span>&nbsp;<span class="ident" id="2301393">Node</span><span class="op" id="2301397">,</span>&nbsp;<span class="ident" id="2301399">comments</span>&nbsp;<span class="op" id="2301408">[</span><span class="op" id="2301409">]</span><span class="op" id="2301410">*</span><span class="ident" id="2301411">CommentGroup</span><span class="op" id="2301423">)</span>&nbsp;<span class="ident" id="2301425">CommentMap</span>&nbsp;<span class="op" id="2301436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2301439">if</span>&nbsp;<span class="builtinfunc" id="2301442">len</span><span class="op" id="2301445">(</span><span class="ident" id="2301446">comments</span><span class="op" id="2301454">)</span>&nbsp;<span class="op" id="2301456">==</span>&nbsp;<span class="num" id="2301459">0</span>&nbsp;<span class="op" id="2301461">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2301465">return</span>&nbsp;<span class="ident" id="2301472">nil</span>&nbsp;<span class="comment" id="2301476">//&nbsp;no&nbsp;comments&nbsp;to&nbsp;map</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2301499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2301503">cmap</span>&nbsp;<span class="op" id="2301508">:=</span>&nbsp;<span class="builtinfunc" id="2301511">make</span><span class="op" id="2301515">(</span><span class="ident" id="2301516">CommentMap</span><span class="op" id="2301526">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2301530">//&nbsp;set&nbsp;up&nbsp;comment&nbsp;reader&nbsp;r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2301558">tmp</span>&nbsp;<span class="op" id="2301562">:=</span>&nbsp;<span class="builtinfunc" id="2301565">make</span><span class="op" id="2301569">(</span><span class="op" id="2301570">[</span><span class="op" id="2301571">]</span><span class="op" id="2301572">*</span><span class="ident" id="2301573">CommentGroup</span><span class="op" id="2301585">,</span>&nbsp;<span class="builtinfunc" id="2301587">len</span><span class="op" id="2301590">(</span><span class="ident" id="2301591">comments</span><span class="op" id="2301599">)</span><span class="op" id="2301600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2301603">copy</span><span class="op" id="2301607">(</span><span class="ident" id="2301608">tmp</span><span class="op" id="2301611">,</span>&nbsp;<span class="ident" id="2301613">comments</span><span class="op" id="2301621">)</span>&nbsp;<span class="comment" id="2301623">//&nbsp;don&#39;t&nbsp;change&nbsp;incoming&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2301658">sortComments</span><span class="op" id="2301670">(</span><span class="ident" id="2301671">tmp</span><span class="op" id="2301674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2301677">r</span>&nbsp;<span class="op" id="2301679">:=</span>&nbsp;<span class="ident" id="2301682">commentListReader</span><span class="op" id="2301699">{</span><span class="ident" id="2301700">fset</span><span class="op" id="2301704">:</span>&nbsp;<span class="ident" id="2301706">fset</span><span class="op" id="2301710">,</span>&nbsp;<span class="ident" id="2301712">list</span><span class="op" id="2301716">:</span>&nbsp;<span class="ident" id="2301718">tmp</span><span class="op" id="2301721">}</span>&nbsp;<span class="comment" id="2301723">//&nbsp;!r.eol()&nbsp;because&nbsp;len(comments)&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2301762">r</span><span class="op" id="2301763">.</span><span class="ident" id="2301764">next</span><span class="op" id="2301768">(</span><span class="op" id="2301769">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2301773">//&nbsp;create&nbsp;node&nbsp;list&nbsp;in&nbsp;lexical&nbsp;order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2301811">nodes</span>&nbsp;<span class="op" id="2301817">:=</span>&nbsp;<span class="ident" id="2301820">nodeList</span><span class="op" id="2301828">(</span><span class="ident" id="2301829">node</span><span class="op" id="2301833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2301836">nodes</span>&nbsp;<span class="op" id="2301842">=</span>&nbsp;<span class="builtinfunc" id="2301844">append</span><span class="op" id="2301850">(</span><span class="ident" id="2301851">nodes</span><span class="op" id="2301856">,</span>&nbsp;<span class="ident" id="2301858">nil</span><span class="op" id="2301861">)</span>&nbsp;<span class="comment" id="2301863">//&nbsp;append&nbsp;sentinel</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2301884">//&nbsp;set&nbsp;up&nbsp;iteration&nbsp;variables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2301915">var</span>&nbsp;<span class="op" id="2301919">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2301923">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2301929">Node</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2301944">//&nbsp;previous&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2301963">pend</span>&nbsp;&nbsp;<span class="ident" id="2301969">token</span><span class="op" id="2301974">.</span><span class="ident" id="2301975">Position</span>&nbsp;<span class="comment" id="2301984">//&nbsp;end&nbsp;of&nbsp;p</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2301998">pg</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2302004">Node</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2302019">//&nbsp;previous&nbsp;node&nbsp;group&nbsp;(enclosing&nbsp;nodes&nbsp;of&nbsp;&#34;importance&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2302078">pgend</span>&nbsp;<span class="ident" id="2302084">token</span><span class="op" id="2302089">.</span><span class="ident" id="2302090">Position</span>&nbsp;<span class="comment" id="2302099">//&nbsp;end&nbsp;of&nbsp;pg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2302114">stack</span>&nbsp;<span class="ident" id="2302120">nodeStack</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2302135">//&nbsp;stack&nbsp;of&nbsp;node&nbsp;groups</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2302160">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2302164">for</span>&nbsp;<span class="ident" id="2302168">_</span><span class="op" id="2302169">,</span>&nbsp;<span class="ident" id="2302171">q</span>&nbsp;<span class="op" id="2302173">:=</span>&nbsp;<span class="keyword" id="2302176">range</span>&nbsp;<span class="ident" id="2302182">nodes</span>&nbsp;<span class="op" id="2302188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2302192">var</span>&nbsp;<span class="ident" id="2302196">qpos</span>&nbsp;<span class="ident" id="2302201">token</span><span class="op" id="2302206">.</span><span class="ident" id="2302207">Position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2302218">if</span>&nbsp;<span class="ident" id="2302221">q</span>&nbsp;<span class="op" id="2302223">!=</span>&nbsp;<span class="ident" id="2302226">nil</span>&nbsp;<span class="op" id="2302230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2302235">qpos</span>&nbsp;<span class="op" id="2302240">=</span>&nbsp;<span class="ident" id="2302242">fset</span><span class="op" id="2302246">.</span><span class="ident" id="2302247">Position</span><span class="op" id="2302255">(</span><span class="ident" id="2302256">q</span><span class="op" id="2302257">.</span><span class="ident" id="2302258">Pos</span><span class="op" id="2302261">(</span><span class="op" id="2302262">)</span><span class="op" id="2302263">)</span>&nbsp;<span class="comment" id="2302265">//&nbsp;current&nbsp;node&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2302292">}</span>&nbsp;<span class="keyword" id="2302294">else</span>&nbsp;<span class="op" id="2302299">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2302304">//&nbsp;set&nbsp;fake&nbsp;sentinel&nbsp;position&nbsp;to&nbsp;infinity&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2302357">//&nbsp;all&nbsp;comments&nbsp;get&nbsp;processed&nbsp;before&nbsp;the&nbsp;sentinel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2302410">const</span>&nbsp;<span class="ident" id="2302416">infinity</span>&nbsp;<span class="op" id="2302425">=</span>&nbsp;<span class="num" id="2302427">1</span>&nbsp;<span class="op" id="2302429">&lt;&lt;</span>&nbsp;<span class="num" id="2302432">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2302438">qpos</span><span class="op" id="2302442">.</span><span class="ident" id="2302443">Offset</span>&nbsp;<span class="op" id="2302450">=</span>&nbsp;<span class="ident" id="2302452">infinity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2302464">qpos</span><span class="op" id="2302468">.</span><span class="ident" id="2302469">Line</span>&nbsp;<span class="op" id="2302474">=</span>&nbsp;<span class="ident" id="2302476">infinity</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2302487">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2302492">//&nbsp;process&nbsp;comments&nbsp;before&nbsp;current&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2302534">for</span>&nbsp;<span class="ident" id="2302538">r</span><span class="op" id="2302539">.</span><span class="ident" id="2302540">end</span><span class="op" id="2302543">.</span><span class="ident" id="2302544">Offset</span>&nbsp;<span class="op" id="2302551">&lt;=</span>&nbsp;<span class="ident" id="2302554">qpos</span><span class="op" id="2302558">.</span><span class="ident" id="2302559">Offset</span>&nbsp;<span class="op" id="2302566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2302571">//&nbsp;determine&nbsp;recent&nbsp;node&nbsp;group</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2302605">if</span>&nbsp;<span class="ident" id="2302608">top</span>&nbsp;<span class="op" id="2302612">:=</span>&nbsp;<span class="ident" id="2302615">stack</span><span class="op" id="2302620">.</span><span class="ident" id="2302621">pop</span><span class="op" id="2302624">(</span><span class="ident" id="2302625">r</span><span class="op" id="2302626">.</span><span class="ident" id="2302627">comment</span><span class="op" id="2302634">.</span><span class="ident" id="2302635">Pos</span><span class="op" id="2302638">(</span><span class="op" id="2302639">)</span><span class="op" id="2302640">)</span><span class="op" id="2302641">;</span>&nbsp;<span class="ident" id="2302643">top</span>&nbsp;<span class="op" id="2302647">!=</span>&nbsp;<span class="ident" id="2302650">nil</span>&nbsp;<span class="op" id="2302654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2302660">pg</span>&nbsp;<span class="op" id="2302663">=</span>&nbsp;<span class="ident" id="2302665">top</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2302673">pgend</span>&nbsp;<span class="op" id="2302679">=</span>&nbsp;<span class="ident" id="2302681">fset</span><span class="op" id="2302685">.</span><span class="ident" id="2302686">Position</span><span class="op" id="2302694">(</span><span class="ident" id="2302695">pg</span><span class="op" id="2302697">.</span><span class="ident" id="2302698">End</span><span class="op" id="2302701">(</span><span class="op" id="2302702">)</span><span class="op" id="2302703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2302708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2302713">//&nbsp;Try&nbsp;to&nbsp;associate&nbsp;a&nbsp;comment&nbsp;first&nbsp;with&nbsp;a&nbsp;node&nbsp;group</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2302770">//&nbsp;(i.e.,&nbsp;a&nbsp;node&nbsp;of&nbsp;&#34;importance&#34;&nbsp;such&nbsp;as&nbsp;a&nbsp;declaration);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2302830">//&nbsp;if&nbsp;that&nbsp;fails,&nbsp;try&nbsp;to&nbsp;associate&nbsp;it&nbsp;with&nbsp;the&nbsp;most&nbsp;recent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2302892">//&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2302904">//&nbsp;TODO(gri)&nbsp;try&nbsp;to&nbsp;simplify&nbsp;the&nbsp;logic&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2302952">var</span>&nbsp;<span class="ident" id="2302956">assoc</span>&nbsp;<span class="ident" id="2302962">Node</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2302970">switch</span>&nbsp;<span class="op" id="2302977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2302982">case</span>&nbsp;<span class="ident" id="2302987">pg</span>&nbsp;<span class="op" id="2302990">!=</span>&nbsp;<span class="ident" id="2302993">nil</span>&nbsp;<span class="op" id="2302997">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2303004">(</span><span class="ident" id="2303005">pgend</span><span class="op" id="2303010">.</span><span class="ident" id="2303011">Line</span>&nbsp;<span class="op" id="2303016">==</span>&nbsp;<span class="ident" id="2303019">r</span><span class="op" id="2303020">.</span><span class="ident" id="2303021">pos</span><span class="op" id="2303024">.</span><span class="ident" id="2303025">Line</span>&nbsp;<span class="op" id="2303030">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2303038">pgend</span><span class="op" id="2303043">.</span><span class="ident" id="2303044">Line</span><span class="op" id="2303048">+</span><span class="num" id="2303049">1</span>&nbsp;<span class="op" id="2303051">==</span>&nbsp;<span class="ident" id="2303054">r</span><span class="op" id="2303055">.</span><span class="ident" id="2303056">pos</span><span class="op" id="2303059">.</span><span class="ident" id="2303060">Line</span>&nbsp;<span class="op" id="2303065">&amp;&amp;</span>&nbsp;<span class="ident" id="2303068">r</span><span class="op" id="2303069">.</span><span class="ident" id="2303070">end</span><span class="op" id="2303073">.</span><span class="ident" id="2303074">Line</span><span class="op" id="2303078">+</span><span class="num" id="2303079">1</span>&nbsp;<span class="op" id="2303081">&lt;</span>&nbsp;<span class="ident" id="2303083">qpos</span><span class="op" id="2303087">.</span><span class="ident" id="2303088">Line</span><span class="op" id="2303092">)</span><span class="op" id="2303093">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2303099">//&nbsp;1)&nbsp;comment&nbsp;starts&nbsp;on&nbsp;same&nbsp;line&nbsp;as&nbsp;previous&nbsp;node&nbsp;group&nbsp;ends,&nbsp;or</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2303169">//&nbsp;2)&nbsp;comment&nbsp;starts&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2303228">//&nbsp;&nbsp;&nbsp;&nbsp;previous&nbsp;node&nbsp;group&nbsp;and&nbsp;there&nbsp;is&nbsp;an&nbsp;empty&nbsp;line&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2303292">//&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;current&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2303319">//&nbsp;=&gt;&nbsp;associate&nbsp;comment&nbsp;with&nbsp;previous&nbsp;node&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2303372">assoc</span>&nbsp;<span class="op" id="2303378">=</span>&nbsp;<span class="ident" id="2303380">pg</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2303386">case</span>&nbsp;<span class="ident" id="2303391">p</span>&nbsp;<span class="op" id="2303393">!=</span>&nbsp;<span class="ident" id="2303396">nil</span>&nbsp;<span class="op" id="2303400">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2303407">(</span><span class="ident" id="2303408">pend</span><span class="op" id="2303412">.</span><span class="ident" id="2303413">Line</span>&nbsp;<span class="op" id="2303418">==</span>&nbsp;<span class="ident" id="2303421">r</span><span class="op" id="2303422">.</span><span class="ident" id="2303423">pos</span><span class="op" id="2303426">.</span><span class="ident" id="2303427">Line</span>&nbsp;<span class="op" id="2303432">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2303440">pend</span><span class="op" id="2303444">.</span><span class="ident" id="2303445">Line</span><span class="op" id="2303449">+</span><span class="num" id="2303450">1</span>&nbsp;<span class="op" id="2303452">==</span>&nbsp;<span class="ident" id="2303455">r</span><span class="op" id="2303456">.</span><span class="ident" id="2303457">pos</span><span class="op" id="2303460">.</span><span class="ident" id="2303461">Line</span>&nbsp;<span class="op" id="2303466">&amp;&amp;</span>&nbsp;<span class="ident" id="2303469">r</span><span class="op" id="2303470">.</span><span class="ident" id="2303471">end</span><span class="op" id="2303474">.</span><span class="ident" id="2303475">Line</span><span class="op" id="2303479">+</span><span class="num" id="2303480">1</span>&nbsp;<span class="op" id="2303482">&lt;</span>&nbsp;<span class="ident" id="2303484">qpos</span><span class="op" id="2303488">.</span><span class="ident" id="2303489">Line</span>&nbsp;<span class="op" id="2303494">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2303502">q</span>&nbsp;<span class="op" id="2303504">==</span>&nbsp;<span class="ident" id="2303507">nil</span><span class="op" id="2303510">)</span><span class="op" id="2303511">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2303517">//&nbsp;same&nbsp;rules&nbsp;apply&nbsp;as&nbsp;above&nbsp;for&nbsp;p&nbsp;rather&nbsp;than&nbsp;pg,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2303572">//&nbsp;but&nbsp;also&nbsp;associate&nbsp;with&nbsp;p&nbsp;if&nbsp;we&nbsp;are&nbsp;at&nbsp;the&nbsp;end&nbsp;(q&nbsp;==&nbsp;nil)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2303637">assoc</span>&nbsp;<span class="op" id="2303643">=</span>&nbsp;<span class="ident" id="2303645">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2303650">default</span><span class="op" id="2303657">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2303663">//&nbsp;otherwise,&nbsp;associate&nbsp;comment&nbsp;with&nbsp;current&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2303717">if</span>&nbsp;<span class="ident" id="2303720">q</span>&nbsp;<span class="op" id="2303722">==</span>&nbsp;<span class="ident" id="2303725">nil</span>&nbsp;<span class="op" id="2303729">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2303736">//&nbsp;we&nbsp;can&nbsp;only&nbsp;reach&nbsp;here&nbsp;if&nbsp;there&nbsp;was&nbsp;no&nbsp;p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2303785">//&nbsp;which&nbsp;would&nbsp;imply&nbsp;that&nbsp;there&nbsp;were&nbsp;no&nbsp;nodes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2303836">panic</span><span class="op" id="2303841">(</span><span class="string" id="2303842">&#34;internal&nbsp;error:&nbsp;no&nbsp;comments&nbsp;should&nbsp;be&nbsp;associated&nbsp;with&nbsp;sentinel&#34;</span><span class="op" id="2303906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2303912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2303918">assoc</span>&nbsp;<span class="op" id="2303924">=</span>&nbsp;<span class="ident" id="2303926">q</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2303931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2303936">cmap</span><span class="op" id="2303940">.</span><span class="ident" id="2303941">addComment</span><span class="op" id="2303951">(</span><span class="ident" id="2303952">assoc</span><span class="op" id="2303957">,</span>&nbsp;<span class="ident" id="2303959">r</span><span class="op" id="2303960">.</span><span class="ident" id="2303961">comment</span><span class="op" id="2303968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2303973">if</span>&nbsp;<span class="ident" id="2303976">r</span><span class="op" id="2303977">.</span><span class="ident" id="2303978">eol</span><span class="op" id="2303981">(</span><span class="op" id="2303982">)</span>&nbsp;<span class="op" id="2303984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2303990">return</span>&nbsp;<span class="ident" id="2303997">cmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2304005">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2304010">r</span><span class="op" id="2304011">.</span><span class="ident" id="2304012">next</span><span class="op" id="2304016">(</span><span class="op" id="2304017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2304021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2304026">//&nbsp;update&nbsp;previous&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2304052">p</span>&nbsp;<span class="op" id="2304054">=</span>&nbsp;<span class="ident" id="2304056">q</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2304060">pend</span>&nbsp;<span class="op" id="2304065">=</span>&nbsp;<span class="ident" id="2304067">fset</span><span class="op" id="2304071">.</span><span class="ident" id="2304072">Position</span><span class="op" id="2304080">(</span><span class="ident" id="2304081">p</span><span class="op" id="2304082">.</span><span class="ident" id="2304083">End</span><span class="op" id="2304086">(</span><span class="op" id="2304087">)</span><span class="op" id="2304088">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2304093">//&nbsp;update&nbsp;previous&nbsp;node&nbsp;group&nbsp;if&nbsp;we&nbsp;see&nbsp;an&nbsp;&#34;important&#34;&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2304155">switch</span>&nbsp;<span class="ident" id="2304162">q</span><span class="op" id="2304163">.</span><span class="op" id="2304164">(</span><span class="keyword" id="2304165">type</span><span class="op" id="2304169">)</span>&nbsp;<span class="op" id="2304171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2304175">case</span>&nbsp;<span class="op" id="2304180">*</span><span class="ident" id="2304181">File</span><span class="op" id="2304185">,</span>&nbsp;<span class="op" id="2304187">*</span><span class="ident" id="2304188">Field</span><span class="op" id="2304193">,</span>&nbsp;<span class="ident" id="2304195">Decl</span><span class="op" id="2304199">,</span>&nbsp;<span class="ident" id="2304201">Spec</span><span class="op" id="2304205">,</span>&nbsp;<span class="ident" id="2304207">Stmt</span><span class="op" id="2304211">:</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2304216">stack</span><span class="op" id="2304221">.</span><span class="ident" id="2304222">push</span><span class="op" id="2304226">(</span><span class="ident" id="2304227">q</span><span class="op" id="2304228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2304232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2304235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2304239">return</span>&nbsp;<span class="ident" id="2304246">cmap</span><br>
<span class="lineno">240</span><span class="op" id="2304251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2304254">//&nbsp;Update&nbsp;replaces&nbsp;an&nbsp;old&nbsp;node&nbsp;in&nbsp;the&nbsp;comment&nbsp;map&nbsp;with&nbsp;the&nbsp;new&nbsp;node</span><br>
<span class="lineno"></span><span class="comment" id="2304322">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;node.&nbsp;Comments&nbsp;that&nbsp;were&nbsp;associated&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2304390">//&nbsp;old&nbsp;node&nbsp;are&nbsp;associated&nbsp;with&nbsp;the&nbsp;new&nbsp;node.</span><br>
<span class="lineno">245</span><span class="comment" id="2304436">//</span><br>
<span class="lineno"></span><span class="keyword" id="2304439">func</span>&nbsp;<span class="op" id="2304444">(</span><span class="ident" id="2304445">cmap</span>&nbsp;<span class="ident" id="2304450">CommentMap</span><span class="op" id="2304460">)</span>&nbsp;<span class="ident" id="2304462">Update</span><span class="op" id="2304468">(</span><span class="ident" id="2304469">old</span><span class="op" id="2304472">,</span>&nbsp;<span class="builtinfunc" id="2304474">new</span>&nbsp;<span class="ident" id="2304478">Node</span><span class="op" id="2304482">)</span>&nbsp;<span class="ident" id="2304484">Node</span>&nbsp;<span class="op" id="2304489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2304492">if</span>&nbsp;<span class="ident" id="2304495">list</span>&nbsp;<span class="op" id="2304500">:=</span>&nbsp;<span class="ident" id="2304503">cmap</span><span class="op" id="2304507">[</span><span class="ident" id="2304508">old</span><span class="op" id="2304511">]</span><span class="op" id="2304512">;</span>&nbsp;<span class="builtinfunc" id="2304514">len</span><span class="op" id="2304517">(</span><span class="ident" id="2304518">list</span><span class="op" id="2304522">)</span>&nbsp;<span class="op" id="2304524">&gt;</span>&nbsp;<span class="num" id="2304526">0</span>&nbsp;<span class="op" id="2304528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2304532">delete</span><span class="op" id="2304538">(</span><span class="ident" id="2304539">cmap</span><span class="op" id="2304543">,</span>&nbsp;<span class="ident" id="2304545">old</span><span class="op" id="2304548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2304552">cmap</span><span class="op" id="2304556">[</span><span class="builtinfunc" id="2304557">new</span><span class="op" id="2304560">]</span>&nbsp;<span class="op" id="2304562">=</span>&nbsp;<span class="builtinfunc" id="2304564">append</span><span class="op" id="2304570">(</span><span class="ident" id="2304571">cmap</span><span class="op" id="2304575">[</span><span class="builtinfunc" id="2304576">new</span><span class="op" id="2304579">]</span><span class="op" id="2304580">,</span>&nbsp;<span class="ident" id="2304582">list</span><span class="op" id="2304586">...</span><span class="op" id="2304589">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2304592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2304595">return</span>&nbsp;<span class="builtinfunc" id="2304602">new</span><br>
<span class="lineno"></span><span class="op" id="2304606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2304609">//&nbsp;Filter&nbsp;returns&nbsp;a&nbsp;new&nbsp;comment&nbsp;map&nbsp;consisting&nbsp;of&nbsp;only&nbsp;those</span><br>
<span class="lineno">255</span><span class="comment" id="2304670">//&nbsp;entries&nbsp;of&nbsp;cmap&nbsp;for&nbsp;which&nbsp;a&nbsp;corresponding&nbsp;node&nbsp;exists&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="2304730">//&nbsp;the&nbsp;AST&nbsp;specified&nbsp;by&nbsp;node.</span><br>
<span class="lineno"></span><span class="comment" id="2304760">//</span><br>
<span class="lineno"></span><span class="keyword" id="2304763">func</span>&nbsp;<span class="op" id="2304768">(</span><span class="ident" id="2304769">cmap</span>&nbsp;<span class="ident" id="2304774">CommentMap</span><span class="op" id="2304784">)</span>&nbsp;<span class="ident" id="2304786">Filter</span><span class="op" id="2304792">(</span><span class="ident" id="2304793">node</span>&nbsp;<span class="ident" id="2304798">Node</span><span class="op" id="2304802">)</span>&nbsp;<span class="ident" id="2304804">CommentMap</span>&nbsp;<span class="op" id="2304815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2304818">umap</span>&nbsp;<span class="op" id="2304823">:=</span>&nbsp;<span class="builtinfunc" id="2304826">make</span><span class="op" id="2304830">(</span><span class="ident" id="2304831">CommentMap</span><span class="op" id="2304841">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2304844">Inspect</span><span class="op" id="2304851">(</span><span class="ident" id="2304852">node</span><span class="op" id="2304856">,</span>&nbsp;<span class="keyword" id="2304858">func</span><span class="op" id="2304862">(</span><span class="ident" id="2304863">n</span>&nbsp;<span class="ident" id="2304865">Node</span><span class="op" id="2304869">)</span>&nbsp;<span class="builtintype" id="2304871">bool</span>&nbsp;<span class="op" id="2304876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2304880">if</span>&nbsp;<span class="ident" id="2304883">g</span>&nbsp;<span class="op" id="2304885">:=</span>&nbsp;<span class="ident" id="2304888">cmap</span><span class="op" id="2304892">[</span><span class="ident" id="2304893">n</span><span class="op" id="2304894">]</span><span class="op" id="2304895">;</span>&nbsp;<span class="builtinfunc" id="2304897">len</span><span class="op" id="2304900">(</span><span class="ident" id="2304901">g</span><span class="op" id="2304902">)</span>&nbsp;<span class="op" id="2304904">&gt;</span>&nbsp;<span class="num" id="2304906">0</span>&nbsp;<span class="op" id="2304908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2304913">umap</span><span class="op" id="2304917">[</span><span class="ident" id="2304918">n</span><span class="op" id="2304919">]</span>&nbsp;<span class="op" id="2304921">=</span>&nbsp;<span class="ident" id="2304923">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2304927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2304931">return</span>&nbsp;<span class="builtintype" id="2304938">true</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2304944">}</span><span class="op" id="2304945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2304948">return</span>&nbsp;<span class="ident" id="2304955">umap</span><br>
<span class="lineno"></span><span class="op" id="2304960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2304963">//&nbsp;Comments&nbsp;returns&nbsp;the&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups&nbsp;in&nbsp;the&nbsp;comment&nbsp;map.</span><br>
<span class="lineno">270</span><span class="comment" id="2305030">//&nbsp;The&nbsp;result&nbsp;is&nbsp;sorted&nbsp;is&nbsp;source&nbsp;order.</span><br>
<span class="lineno"></span><span class="comment" id="2305071">//</span><br>
<span class="lineno"></span><span class="keyword" id="2305074">func</span>&nbsp;<span class="op" id="2305079">(</span><span class="ident" id="2305080">cmap</span>&nbsp;<span class="ident" id="2305085">CommentMap</span><span class="op" id="2305095">)</span>&nbsp;<span class="ident" id="2305097">Comments</span><span class="op" id="2305105">(</span><span class="op" id="2305106">)</span>&nbsp;<span class="op" id="2305108">[</span><span class="op" id="2305109">]</span><span class="op" id="2305110">*</span><span class="ident" id="2305111">CommentGroup</span>&nbsp;<span class="op" id="2305124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2305127">list</span>&nbsp;<span class="op" id="2305132">:=</span>&nbsp;<span class="builtinfunc" id="2305135">make</span><span class="op" id="2305139">(</span><span class="op" id="2305140">[</span><span class="op" id="2305141">]</span><span class="op" id="2305142">*</span><span class="ident" id="2305143">CommentGroup</span><span class="op" id="2305155">,</span>&nbsp;<span class="num" id="2305157">0</span><span class="op" id="2305158">,</span>&nbsp;<span class="builtinfunc" id="2305160">len</span><span class="op" id="2305163">(</span><span class="ident" id="2305164">cmap</span><span class="op" id="2305168">)</span><span class="op" id="2305169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2305172">for</span>&nbsp;<span class="ident" id="2305176">_</span><span class="op" id="2305177">,</span>&nbsp;<span class="ident" id="2305179">e</span>&nbsp;<span class="op" id="2305181">:=</span>&nbsp;<span class="keyword" id="2305184">range</span>&nbsp;<span class="ident" id="2305190">cmap</span>&nbsp;<span class="op" id="2305195">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2305199">list</span>&nbsp;<span class="op" id="2305204">=</span>&nbsp;<span class="builtinfunc" id="2305206">append</span><span class="op" id="2305212">(</span><span class="ident" id="2305213">list</span><span class="op" id="2305217">,</span>&nbsp;<span class="ident" id="2305219">e</span><span class="op" id="2305220">...</span><span class="op" id="2305223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2305226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2305229">sortComments</span><span class="op" id="2305241">(</span><span class="ident" id="2305242">list</span><span class="op" id="2305246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2305249">return</span>&nbsp;<span class="ident" id="2305256">list</span><br>
<span class="lineno"></span><span class="op" id="2305261">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="2305264">func</span>&nbsp;<span class="ident" id="2305269">summary</span><span class="op" id="2305276">(</span><span class="ident" id="2305277">list</span>&nbsp;<span class="op" id="2305282">[</span><span class="op" id="2305283">]</span><span class="op" id="2305284">*</span><span class="ident" id="2305285">CommentGroup</span><span class="op" id="2305297">)</span>&nbsp;<span class="builtintype" id="2305299">string</span>&nbsp;<span class="op" id="2305306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2305309">const</span>&nbsp;<span class="ident" id="2305315">maxLen</span>&nbsp;<span class="op" id="2305322">=</span>&nbsp;<span class="num" id="2305324">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2305328">var</span>&nbsp;<span class="ident" id="2305332">buf</span>&nbsp;<span class="ident" id="2305336">bytes</span><span class="op" id="2305341">.</span><span class="ident" id="2305342">Buffer</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2305351">//&nbsp;collect&nbsp;comments&nbsp;text</span><br>
<span class="lineno"></span><span class="ident" id="2305376">loop</span><span class="op" id="2305380">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2305383">for</span>&nbsp;<span class="ident" id="2305387">_</span><span class="op" id="2305388">,</span>&nbsp;<span class="ident" id="2305390">group</span>&nbsp;<span class="op" id="2305396">:=</span>&nbsp;<span class="keyword" id="2305399">range</span>&nbsp;<span class="ident" id="2305405">list</span>&nbsp;<span class="op" id="2305410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2305414">//&nbsp;Note:&nbsp;CommentGroup.Text()&nbsp;does&nbsp;too&nbsp;much&nbsp;work&nbsp;for&nbsp;what&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2305476">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;need&nbsp;and&nbsp;would&nbsp;only&nbsp;replace&nbsp;this&nbsp;innermost&nbsp;loop.</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2305536">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Just&nbsp;do&nbsp;it&nbsp;explicitly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2305570">for</span>&nbsp;<span class="ident" id="2305574">_</span><span class="op" id="2305575">,</span>&nbsp;<span class="ident" id="2305577">comment</span>&nbsp;<span class="op" id="2305585">:=</span>&nbsp;<span class="keyword" id="2305588">range</span>&nbsp;<span class="ident" id="2305594">group</span><span class="op" id="2305599">.</span><span class="ident" id="2305600">List</span>&nbsp;<span class="op" id="2305605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2305610">if</span>&nbsp;<span class="ident" id="2305613">buf</span><span class="op" id="2305616">.</span><span class="ident" id="2305617">Len</span><span class="op" id="2305620">(</span><span class="op" id="2305621">)</span>&nbsp;<span class="op" id="2305623">&gt;=</span>&nbsp;<span class="ident" id="2305626">maxLen</span>&nbsp;<span class="op" id="2305633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2305639">break</span>&nbsp;<span class="ident" id="2305645">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2305653">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2305658">buf</span><span class="op" id="2305661">.</span><span class="ident" id="2305662">WriteString</span><span class="op" id="2305673">(</span><span class="ident" id="2305674">comment</span><span class="op" id="2305681">.</span><span class="ident" id="2305682">Text</span><span class="op" id="2305686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2305690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2305693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2305697">//&nbsp;truncate&nbsp;if&nbsp;too&nbsp;long</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2305722">if</span>&nbsp;<span class="ident" id="2305725">buf</span><span class="op" id="2305728">.</span><span class="ident" id="2305729">Len</span><span class="op" id="2305732">(</span><span class="op" id="2305733">)</span>&nbsp;<span class="op" id="2305735">&gt;</span>&nbsp;<span class="ident" id="2305737">maxLen</span>&nbsp;<span class="op" id="2305744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2305748">buf</span><span class="op" id="2305751">.</span><span class="ident" id="2305752">Truncate</span><span class="op" id="2305760">(</span><span class="ident" id="2305761">maxLen</span>&nbsp;<span class="op" id="2305768">-</span>&nbsp;<span class="num" id="2305770">3</span><span class="op" id="2305771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2305775">buf</span><span class="op" id="2305778">.</span><span class="ident" id="2305779">WriteString</span><span class="op" id="2305790">(</span><span class="string" id="2305791">&#34;...&#34;</span><span class="op" id="2305796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2305799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2305803">//&nbsp;replace&nbsp;any&nbsp;invisibles&nbsp;with&nbsp;blanks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2305842">bytes</span>&nbsp;<span class="op" id="2305848">:=</span>&nbsp;<span class="ident" id="2305851">buf</span><span class="op" id="2305854">.</span><span class="ident" id="2305855">Bytes</span><span class="op" id="2305860">(</span><span class="op" id="2305861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2305864">for</span>&nbsp;<span class="ident" id="2305868">i</span><span class="op" id="2305869">,</span>&nbsp;<span class="ident" id="2305871">b</span>&nbsp;<span class="op" id="2305873">:=</span>&nbsp;<span class="keyword" id="2305876">range</span>&nbsp;<span class="ident" id="2305882">bytes</span>&nbsp;<span class="op" id="2305888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2305892">switch</span>&nbsp;<span class="ident" id="2305899">b</span>&nbsp;<span class="op" id="2305901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2305905">case</span>&nbsp;<span class="string" id="2305910">&#39;\t&#39;</span><span class="op" id="2305914">,</span>&nbsp;<span class="string" id="2305916">&#39;\n&#39;</span><span class="op" id="2305920">,</span>&nbsp;<span class="string" id="2305922">&#39;\r&#39;</span><span class="op" id="2305926">:</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2305931">bytes</span><span class="op" id="2305936">[</span><span class="ident" id="2305937">i</span><span class="op" id="2305938">]</span>&nbsp;<span class="op" id="2305940">=</span>&nbsp;<span class="string" id="2305942">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2305948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2305951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2305955">return</span>&nbsp;<span class="builtintype" id="2305962">string</span><span class="op" id="2305968">(</span><span class="ident" id="2305969">bytes</span><span class="op" id="2305974">)</span><br>
<span class="lineno">315</span><span class="op" id="2305976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2305979">func</span>&nbsp;<span class="op" id="2305984">(</span><span class="ident" id="2305985">cmap</span>&nbsp;<span class="ident" id="2305990">CommentMap</span><span class="op" id="2306000">)</span>&nbsp;<span class="ident" id="2306002">String</span><span class="op" id="2306008">(</span><span class="op" id="2306009">)</span>&nbsp;<span class="builtintype" id="2306011">string</span>&nbsp;<span class="op" id="2306018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2306021">var</span>&nbsp;<span class="ident" id="2306025">buf</span>&nbsp;<span class="ident" id="2306029">bytes</span><span class="op" id="2306034">.</span><span class="ident" id="2306035">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2306043">fmt</span><span class="op" id="2306046">.</span><span class="ident" id="2306047">Fprintln</span><span class="op" id="2306055">(</span><span class="op" id="2306056">&amp;</span><span class="ident" id="2306057">buf</span><span class="op" id="2306060">,</span>&nbsp;<span class="string" id="2306062">&#34;CommentMap&nbsp;{&#34;</span><span class="op" id="2306076">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2306079">for</span>&nbsp;<span class="ident" id="2306083">node</span><span class="op" id="2306087">,</span>&nbsp;<span class="ident" id="2306089">comment</span>&nbsp;<span class="op" id="2306097">:=</span>&nbsp;<span class="keyword" id="2306100">range</span>&nbsp;<span class="ident" id="2306106">cmap</span>&nbsp;<span class="op" id="2306111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2306115">//&nbsp;print&nbsp;name&nbsp;of&nbsp;identifiers;&nbsp;print&nbsp;node&nbsp;type&nbsp;for&nbsp;other&nbsp;nodes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2306179">var</span>&nbsp;<span class="ident" id="2306183">s</span>&nbsp;<span class="builtintype" id="2306185">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2306194">if</span>&nbsp;<span class="ident" id="2306197">ident</span><span class="op" id="2306202">,</span>&nbsp;<span class="ident" id="2306204">ok</span>&nbsp;<span class="op" id="2306207">:=</span>&nbsp;<span class="ident" id="2306210">node</span><span class="op" id="2306214">.</span><span class="op" id="2306215">(</span><span class="op" id="2306216">*</span><span class="ident" id="2306217">Ident</span><span class="op" id="2306222">)</span><span class="op" id="2306223">;</span>&nbsp;<span class="ident" id="2306225">ok</span>&nbsp;<span class="op" id="2306228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2306233">s</span>&nbsp;<span class="op" id="2306235">=</span>&nbsp;<span class="ident" id="2306237">ident</span><span class="op" id="2306242">.</span><span class="ident" id="2306243">Name</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2306250">}</span>&nbsp;<span class="keyword" id="2306252">else</span>&nbsp;<span class="op" id="2306257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2306262">s</span>&nbsp;<span class="op" id="2306264">=</span>&nbsp;<span class="ident" id="2306266">fmt</span><span class="op" id="2306269">.</span><span class="ident" id="2306270">Sprintf</span><span class="op" id="2306277">(</span><span class="string" id="2306278">&#34;%T&#34;</span><span class="op" id="2306282">,</span>&nbsp;<span class="ident" id="2306284">node</span><span class="op" id="2306288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2306292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2306296">fmt</span><span class="op" id="2306299">.</span><span class="ident" id="2306300">Fprintf</span><span class="op" id="2306307">(</span><span class="op" id="2306308">&amp;</span><span class="ident" id="2306309">buf</span><span class="op" id="2306312">,</span>&nbsp;<span class="string" id="2306314">&#34;\t%p&nbsp;&nbsp;%20s:&nbsp;&nbsp;%s\n&#34;</span><span class="op" id="2306333">,</span>&nbsp;<span class="ident" id="2306335">node</span><span class="op" id="2306339">,</span>&nbsp;<span class="ident" id="2306341">s</span><span class="op" id="2306342">,</span>&nbsp;<span class="ident" id="2306344">summary</span><span class="op" id="2306351">(</span><span class="ident" id="2306352">comment</span><span class="op" id="2306359">)</span><span class="op" id="2306360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2306363">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2306366">fmt</span><span class="op" id="2306369">.</span><span class="ident" id="2306370">Fprintln</span><span class="op" id="2306378">(</span><span class="op" id="2306379">&amp;</span><span class="ident" id="2306380">buf</span><span class="op" id="2306383">,</span>&nbsp;<span class="string" id="2306385">&#34;}&#34;</span><span class="op" id="2306388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2306391">return</span>&nbsp;<span class="ident" id="2306398">buf</span><span class="op" id="2306401">.</span><span class="ident" id="2306402">String</span><span class="op" id="2306408">(</span><span class="op" id="2306409">)</span><br>
<span class="lineno"></span><span class="op" id="2306411">}</span>
</div>
</body>
</html>
