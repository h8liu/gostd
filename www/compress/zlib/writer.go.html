<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5699942">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5699997">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5700051">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5700102">package</span>&nbsp;<span class="ident" id="5700110">zlib</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5700116">import</span>&nbsp;<span class="op" id="5700123">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5700126">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5700144">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5700151">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5700159">&#34;hash/adler32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5700175">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5700180">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="5700183">//&nbsp;These&nbsp;constants&nbsp;are&nbsp;copied&nbsp;from&nbsp;the&nbsp;flate&nbsp;package,&nbsp;so&nbsp;that&nbsp;code&nbsp;that&nbsp;imports</span><br>
<span class="lineno"></span><span class="comment" id="5700263">//&nbsp;&#34;compress/zlib&#34;&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;to&nbsp;import&nbsp;&#34;compress/flate&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="5700329">const</span>&nbsp;<span class="op" id="5700335">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700338">NoCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5700357">=</span>&nbsp;<span class="ident" id="5700359">flate</span><span class="op" id="5700364">.</span><span class="ident" id="5700365">NoCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700380">BestSpeed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5700399">=</span>&nbsp;<span class="ident" id="5700401">flate</span><span class="op" id="5700406">.</span><span class="ident" id="5700407">BestSpeed</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700418">BestCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5700437">=</span>&nbsp;<span class="ident" id="5700439">flate</span><span class="op" id="5700444">.</span><span class="ident" id="5700445">BestCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700462">DefaultCompression</span>&nbsp;<span class="op" id="5700481">=</span>&nbsp;<span class="ident" id="5700483">flate</span><span class="op" id="5700488">.</span><span class="ident" id="5700489">DefaultCompression</span><br>
<span class="lineno"></span><span class="op" id="5700508">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5700511">//&nbsp;A&nbsp;Writer&nbsp;takes&nbsp;data&nbsp;written&nbsp;to&nbsp;it&nbsp;and&nbsp;writes&nbsp;the&nbsp;compressed</span><br>
<span class="lineno">25</span><span class="comment" id="5700574">//&nbsp;form&nbsp;of&nbsp;that&nbsp;data&nbsp;to&nbsp;an&nbsp;underlying&nbsp;writer&nbsp;(see&nbsp;NewWriter).</span><br>
<span class="lineno"></span><span class="keyword" id="5700636">type</span>&nbsp;<span class="ident" id="5700641">Writer</span>&nbsp;<span class="keyword" id="5700648">struct</span>&nbsp;<span class="op" id="5700655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700658">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5700670">io</span><span class="op" id="5700672">.</span><span class="ident" id="5700673">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700681">level</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5700693">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700698">dict</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5700710">[</span><span class="op" id="5700711">]</span><span class="builtintype" id="5700712">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700718">compressor</span>&nbsp;&nbsp;<span class="op" id="5700730">*</span><span class="ident" id="5700731">flate</span><span class="op" id="5700736">.</span><span class="ident" id="5700737">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700745">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5700757">hash</span><span class="op" id="5700761">.</span><span class="ident" id="5700762">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700770">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5700782">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700789">scratch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5700801">[</span><span class="num" id="5700802">4</span><span class="op" id="5700803">]</span><span class="builtintype" id="5700804">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700810">wroteHeader</span>&nbsp;<span class="builtintype" id="5700822">bool</span><br>
<span class="lineno">35</span><span class="op" id="5700827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5700830">//&nbsp;NewWriter&nbsp;creates&nbsp;a&nbsp;new&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="comment" id="5700865">//&nbsp;Writes&nbsp;to&nbsp;the&nbsp;returned&nbsp;Writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="5700931">//</span><br>
<span class="lineno">40</span><span class="comment" id="5700934">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;WriteCloser&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="comment" id="5701015">//&nbsp;Writes&nbsp;may&nbsp;be&nbsp;buffered&nbsp;and&nbsp;not&nbsp;flushed&nbsp;until&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="5701070">func</span>&nbsp;<span class="ident" id="5701075">NewWriter</span><span class="op" id="5701084">(</span><span class="ident" id="5701085">w</span>&nbsp;<span class="ident" id="5701087">io</span><span class="op" id="5701089">.</span><span class="ident" id="5701090">Writer</span><span class="op" id="5701096">)</span>&nbsp;<span class="op" id="5701098">*</span><span class="ident" id="5701099">Writer</span>&nbsp;<span class="op" id="5701106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701109">z</span><span class="op" id="5701110">,</span>&nbsp;<span class="ident" id="5701112">_</span>&nbsp;<span class="op" id="5701114">:=</span>&nbsp;<span class="ident" id="5701117">NewWriterLevelDict</span><span class="op" id="5701135">(</span><span class="ident" id="5701136">w</span><span class="op" id="5701137">,</span>&nbsp;<span class="ident" id="5701139">DefaultCompression</span><span class="op" id="5701157">,</span>&nbsp;<span class="ident" id="5701159">nil</span><span class="op" id="5701162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5701165">return</span>&nbsp;<span class="ident" id="5701172">z</span><br>
<span class="lineno">45</span><span class="op" id="5701174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5701177">//&nbsp;NewWriterLevel&nbsp;is&nbsp;like&nbsp;NewWriter&nbsp;but&nbsp;specifies&nbsp;the&nbsp;compression&nbsp;level&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="5701257">//&nbsp;of&nbsp;assuming&nbsp;DefaultCompression.</span><br>
<span class="lineno"></span><span class="comment" id="5701292">//</span><br>
<span class="lineno">50</span><span class="comment" id="5701295">//&nbsp;The&nbsp;compression&nbsp;level&nbsp;can&nbsp;be&nbsp;DefaultCompression,&nbsp;NoCompression,&nbsp;or&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="5701369">//&nbsp;integer&nbsp;value&nbsp;between&nbsp;BestSpeed&nbsp;and&nbsp;BestCompression&nbsp;inclusive.&nbsp;The&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="5701445">//&nbsp;returned&nbsp;will&nbsp;be&nbsp;nil&nbsp;if&nbsp;the&nbsp;level&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="5701492">func</span>&nbsp;<span class="ident" id="5701497">NewWriterLevel</span><span class="op" id="5701511">(</span><span class="ident" id="5701512">w</span>&nbsp;<span class="ident" id="5701514">io</span><span class="op" id="5701516">.</span><span class="ident" id="5701517">Writer</span><span class="op" id="5701523">,</span>&nbsp;<span class="ident" id="5701525">level</span>&nbsp;<span class="builtintype" id="5701531">int</span><span class="op" id="5701534">)</span>&nbsp;<span class="op" id="5701536">(</span><span class="op" id="5701537">*</span><span class="ident" id="5701538">Writer</span><span class="op" id="5701544">,</span>&nbsp;<span class="builtintype" id="5701546">error</span><span class="op" id="5701551">)</span>&nbsp;<span class="op" id="5701553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5701556">return</span>&nbsp;<span class="ident" id="5701563">NewWriterLevelDict</span><span class="op" id="5701581">(</span><span class="ident" id="5701582">w</span><span class="op" id="5701583">,</span>&nbsp;<span class="ident" id="5701585">level</span><span class="op" id="5701590">,</span>&nbsp;<span class="ident" id="5701592">nil</span><span class="op" id="5701595">)</span><br>
<span class="lineno">55</span><span class="op" id="5701597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5701600">//&nbsp;NewWriterLevelDict&nbsp;is&nbsp;like&nbsp;NewWriterLevel&nbsp;but&nbsp;specifies&nbsp;a&nbsp;dictionary&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5701675">//&nbsp;compress&nbsp;with.</span><br>
<span class="lineno"></span><span class="comment" id="5701693">//</span><br>
<span class="lineno">60</span><span class="comment" id="5701696">//&nbsp;The&nbsp;dictionary&nbsp;may&nbsp;be&nbsp;nil.&nbsp;If&nbsp;not,&nbsp;its&nbsp;contents&nbsp;should&nbsp;not&nbsp;be&nbsp;modified&nbsp;until</span><br>
<span class="lineno"></span><span class="comment" id="5701776">//&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="5701801">func</span>&nbsp;<span class="ident" id="5701806">NewWriterLevelDict</span><span class="op" id="5701824">(</span><span class="ident" id="5701825">w</span>&nbsp;<span class="ident" id="5701827">io</span><span class="op" id="5701829">.</span><span class="ident" id="5701830">Writer</span><span class="op" id="5701836">,</span>&nbsp;<span class="ident" id="5701838">level</span>&nbsp;<span class="builtintype" id="5701844">int</span><span class="op" id="5701847">,</span>&nbsp;<span class="ident" id="5701849">dict</span>&nbsp;<span class="op" id="5701854">[</span><span class="op" id="5701855">]</span><span class="builtintype" id="5701856">byte</span><span class="op" id="5701860">)</span>&nbsp;<span class="op" id="5701862">(</span><span class="op" id="5701863">*</span><span class="ident" id="5701864">Writer</span><span class="op" id="5701870">,</span>&nbsp;<span class="builtintype" id="5701872">error</span><span class="op" id="5701877">)</span>&nbsp;<span class="op" id="5701879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5701882">if</span>&nbsp;<span class="ident" id="5701885">level</span>&nbsp;<span class="op" id="5701891">&lt;</span>&nbsp;<span class="ident" id="5701893">DefaultCompression</span>&nbsp;<span class="op" id="5701912">||</span>&nbsp;<span class="ident" id="5701915">level</span>&nbsp;<span class="op" id="5701921">&gt;</span>&nbsp;<span class="ident" id="5701923">BestCompression</span>&nbsp;<span class="op" id="5701939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5701943">return</span>&nbsp;<span class="ident" id="5701950">nil</span><span class="op" id="5701953">,</span>&nbsp;<span class="ident" id="5701955">fmt</span><span class="op" id="5701958">.</span><span class="ident" id="5701959">Errorf</span><span class="op" id="5701965">(</span><span class="string" id="5701966">&#34;zlib:&nbsp;invalid&nbsp;compression&nbsp;level:&nbsp;%d&#34;</span><span class="op" id="5702003">,</span>&nbsp;<span class="ident" id="5702005">level</span><span class="op" id="5702010">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5702013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5702016">return</span>&nbsp;<span class="op" id="5702023">&amp;</span><span class="ident" id="5702024">Writer</span><span class="op" id="5702030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5702034">w</span><span class="op" id="5702035">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5702041">w</span><span class="op" id="5702042">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5702046">level</span><span class="op" id="5702051">:</span>&nbsp;<span class="ident" id="5702053">level</span><span class="op" id="5702058">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5702062">dict</span><span class="op" id="5702066">:</span>&nbsp;&nbsp;<span class="ident" id="5702069">dict</span><span class="op" id="5702073">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5702076">}</span><span class="op" id="5702077">,</span>&nbsp;<span class="ident" id="5702079">nil</span><br>
<span class="lineno"></span><span class="op" id="5702083">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5702086">//&nbsp;Reset&nbsp;clears&nbsp;the&nbsp;state&nbsp;of&nbsp;the&nbsp;Writer&nbsp;z&nbsp;such&nbsp;that&nbsp;it&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5702162">//&nbsp;initial&nbsp;state&nbsp;from&nbsp;NewWriterLevel&nbsp;or&nbsp;NewWriterLevelDict,&nbsp;but&nbsp;instead&nbsp;writing</span><br>
<span class="lineno">75</span><span class="comment" id="5702242">//&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5702251">func</span>&nbsp;<span class="op" id="5702256">(</span><span class="ident" id="5702257">z</span>&nbsp;<span class="op" id="5702259">*</span><span class="ident" id="5702260">Writer</span><span class="op" id="5702266">)</span>&nbsp;<span class="ident" id="5702268">Reset</span><span class="op" id="5702273">(</span><span class="ident" id="5702274">w</span>&nbsp;<span class="ident" id="5702276">io</span><span class="op" id="5702278">.</span><span class="ident" id="5702279">Writer</span><span class="op" id="5702285">)</span>&nbsp;<span class="op" id="5702287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5702290">z</span><span class="op" id="5702291">.</span><span class="ident" id="5702292">w</span>&nbsp;<span class="op" id="5702294">=</span>&nbsp;<span class="ident" id="5702296">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5702299">//&nbsp;z.level&nbsp;and&nbsp;z.dict&nbsp;left&nbsp;unchanged.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5702338">if</span>&nbsp;<span class="ident" id="5702341">z</span><span class="op" id="5702342">.</span><span class="ident" id="5702343">compressor</span>&nbsp;<span class="op" id="5702354">!=</span>&nbsp;<span class="ident" id="5702357">nil</span>&nbsp;<span class="op" id="5702361">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5702365">z</span><span class="op" id="5702366">.</span><span class="ident" id="5702367">compressor</span><span class="op" id="5702377">.</span><span class="ident" id="5702378">Reset</span><span class="op" id="5702383">(</span><span class="ident" id="5702384">w</span><span class="op" id="5702385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5702388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5702391">if</span>&nbsp;<span class="ident" id="5702394">z</span><span class="op" id="5702395">.</span><span class="ident" id="5702396">digest</span>&nbsp;<span class="op" id="5702403">!=</span>&nbsp;<span class="ident" id="5702406">nil</span>&nbsp;<span class="op" id="5702410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5702414">z</span><span class="op" id="5702415">.</span><span class="ident" id="5702416">digest</span><span class="op" id="5702422">.</span><span class="ident" id="5702423">Reset</span><span class="op" id="5702428">(</span><span class="op" id="5702429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5702432">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5702435">z</span><span class="op" id="5702436">.</span><span class="ident" id="5702437">err</span>&nbsp;<span class="op" id="5702441">=</span>&nbsp;<span class="ident" id="5702443">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5702448">z</span><span class="op" id="5702449">.</span><span class="ident" id="5702450">scratch</span>&nbsp;<span class="op" id="5702458">=</span>&nbsp;<span class="op" id="5702460">[</span><span class="num" id="5702461">4</span><span class="op" id="5702462">]</span><span class="builtintype" id="5702463">byte</span><span class="op" id="5702467">{</span><span class="op" id="5702468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5702471">z</span><span class="op" id="5702472">.</span><span class="ident" id="5702473">wroteHeader</span>&nbsp;<span class="op" id="5702485">=</span>&nbsp;<span class="ident" id="5702487">false</span><br>
<span class="lineno"></span><span class="op" id="5702493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="5702496">//&nbsp;writeHeader&nbsp;writes&nbsp;the&nbsp;ZLIB&nbsp;header.</span><br>
<span class="lineno"></span><span class="keyword" id="5702535">func</span>&nbsp;<span class="op" id="5702540">(</span><span class="ident" id="5702541">z</span>&nbsp;<span class="op" id="5702543">*</span><span class="ident" id="5702544">Writer</span><span class="op" id="5702550">)</span>&nbsp;<span class="ident" id="5702552">writeHeader</span><span class="op" id="5702563">(</span><span class="op" id="5702564">)</span>&nbsp;<span class="op" id="5702566">(</span><span class="ident" id="5702567">err</span>&nbsp;<span class="builtintype" id="5702571">error</span><span class="op" id="5702576">)</span>&nbsp;<span class="op" id="5702578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5702581">z</span><span class="op" id="5702582">.</span><span class="ident" id="5702583">wroteHeader</span>&nbsp;<span class="op" id="5702595">=</span>&nbsp;<span class="ident" id="5702597">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5702603">//&nbsp;ZLIB&nbsp;has&nbsp;a&nbsp;two-byte&nbsp;header&nbsp;(as&nbsp;documented&nbsp;in&nbsp;RFC&nbsp;1950).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5702663">//&nbsp;The&nbsp;first&nbsp;four&nbsp;bits&nbsp;is&nbsp;the&nbsp;CINFO&nbsp;(compression&nbsp;info),&nbsp;which&nbsp;is&nbsp;7&nbsp;for&nbsp;the&nbsp;default&nbsp;deflate&nbsp;window&nbsp;size.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5702768">//&nbsp;The&nbsp;next&nbsp;four&nbsp;bits&nbsp;is&nbsp;the&nbsp;CM&nbsp;(compression&nbsp;method),&nbsp;which&nbsp;is&nbsp;8&nbsp;for&nbsp;deflate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5702847">z</span><span class="op" id="5702848">.</span><span class="ident" id="5702849">scratch</span><span class="op" id="5702856">[</span><span class="num" id="5702857">0</span><span class="op" id="5702858">]</span>&nbsp;<span class="op" id="5702860">=</span>&nbsp;<span class="num" id="5702862">0x78</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5702868">//&nbsp;The&nbsp;next&nbsp;two&nbsp;bits&nbsp;is&nbsp;the&nbsp;FLEVEL&nbsp;(compression&nbsp;level).&nbsp;The&nbsp;four&nbsp;values&nbsp;are:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5702946">//&nbsp;0=fastest,&nbsp;1=fast,&nbsp;2=default,&nbsp;3=best.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5702988">//&nbsp;The&nbsp;next&nbsp;bit,&nbsp;FDICT,&nbsp;is&nbsp;set&nbsp;if&nbsp;a&nbsp;dictionary&nbsp;is&nbsp;given.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5703046">//&nbsp;The&nbsp;final&nbsp;five&nbsp;FCHECK&nbsp;bits&nbsp;form&nbsp;a&nbsp;mod-31&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703101">switch</span>&nbsp;<span class="ident" id="5703108">z</span><span class="op" id="5703109">.</span><span class="ident" id="5703110">level</span>&nbsp;<span class="op" id="5703116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703119">case</span>&nbsp;<span class="num" id="5703124">0</span><span class="op" id="5703125">,</span>&nbsp;<span class="num" id="5703127">1</span><span class="op" id="5703128">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703132">z</span><span class="op" id="5703133">.</span><span class="ident" id="5703134">scratch</span><span class="op" id="5703141">[</span><span class="num" id="5703142">1</span><span class="op" id="5703143">]</span>&nbsp;<span class="op" id="5703145">=</span>&nbsp;<span class="num" id="5703147">0</span>&nbsp;<span class="op" id="5703149">&lt;&lt;</span>&nbsp;<span class="num" id="5703152">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703155">case</span>&nbsp;<span class="num" id="5703160">2</span><span class="op" id="5703161">,</span>&nbsp;<span class="num" id="5703163">3</span><span class="op" id="5703164">,</span>&nbsp;<span class="num" id="5703166">4</span><span class="op" id="5703167">,</span>&nbsp;<span class="num" id="5703169">5</span><span class="op" id="5703170">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703174">z</span><span class="op" id="5703175">.</span><span class="ident" id="5703176">scratch</span><span class="op" id="5703183">[</span><span class="num" id="5703184">1</span><span class="op" id="5703185">]</span>&nbsp;<span class="op" id="5703187">=</span>&nbsp;<span class="num" id="5703189">1</span>&nbsp;<span class="op" id="5703191">&lt;&lt;</span>&nbsp;<span class="num" id="5703194">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703197">case</span>&nbsp;<span class="num" id="5703202">6</span><span class="op" id="5703203">,</span>&nbsp;<span class="op" id="5703205">-</span><span class="num" id="5703206">1</span><span class="op" id="5703207">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703211">z</span><span class="op" id="5703212">.</span><span class="ident" id="5703213">scratch</span><span class="op" id="5703220">[</span><span class="num" id="5703221">1</span><span class="op" id="5703222">]</span>&nbsp;<span class="op" id="5703224">=</span>&nbsp;<span class="num" id="5703226">2</span>&nbsp;<span class="op" id="5703228">&lt;&lt;</span>&nbsp;<span class="num" id="5703231">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703234">case</span>&nbsp;<span class="num" id="5703239">7</span><span class="op" id="5703240">,</span>&nbsp;<span class="num" id="5703242">8</span><span class="op" id="5703243">,</span>&nbsp;<span class="num" id="5703245">9</span><span class="op" id="5703246">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703250">z</span><span class="op" id="5703251">.</span><span class="ident" id="5703252">scratch</span><span class="op" id="5703259">[</span><span class="num" id="5703260">1</span><span class="op" id="5703261">]</span>&nbsp;<span class="op" id="5703263">=</span>&nbsp;<span class="num" id="5703265">3</span>&nbsp;<span class="op" id="5703267">&lt;&lt;</span>&nbsp;<span class="num" id="5703270">6</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703273">default</span><span class="op" id="5703280">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5703284">panic</span><span class="op" id="5703289">(</span><span class="string" id="5703290">&#34;unreachable&#34;</span><span class="op" id="5703303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5703306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703309">if</span>&nbsp;<span class="ident" id="5703312">z</span><span class="op" id="5703313">.</span><span class="ident" id="5703314">dict</span>&nbsp;<span class="op" id="5703319">!=</span>&nbsp;<span class="ident" id="5703322">nil</span>&nbsp;<span class="op" id="5703326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703330">z</span><span class="op" id="5703331">.</span><span class="ident" id="5703332">scratch</span><span class="op" id="5703339">[</span><span class="num" id="5703340">1</span><span class="op" id="5703341">]</span>&nbsp;<span class="op" id="5703343">|=</span>&nbsp;<span class="num" id="5703346">1</span>&nbsp;<span class="op" id="5703348">&lt;&lt;</span>&nbsp;<span class="num" id="5703351">5</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5703354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703357">z</span><span class="op" id="5703358">.</span><span class="ident" id="5703359">scratch</span><span class="op" id="5703366">[</span><span class="num" id="5703367">1</span><span class="op" id="5703368">]</span>&nbsp;<span class="op" id="5703370">+=</span>&nbsp;<span class="builtintype" id="5703373">uint8</span><span class="op" id="5703378">(</span><span class="num" id="5703379">31</span>&nbsp;<span class="op" id="5703382">-</span>&nbsp;<span class="op" id="5703384">(</span><span class="builtintype" id="5703385">uint16</span><span class="op" id="5703391">(</span><span class="ident" id="5703392">z</span><span class="op" id="5703393">.</span><span class="ident" id="5703394">scratch</span><span class="op" id="5703401">[</span><span class="num" id="5703402">0</span><span class="op" id="5703403">]</span><span class="op" id="5703404">)</span><span class="op" id="5703405">&lt;&lt;</span><span class="num" id="5703407">8</span><span class="op" id="5703408">+</span><span class="builtintype" id="5703409">uint16</span><span class="op" id="5703415">(</span><span class="ident" id="5703416">z</span><span class="op" id="5703417">.</span><span class="ident" id="5703418">scratch</span><span class="op" id="5703425">[</span><span class="num" id="5703426">1</span><span class="op" id="5703427">]</span><span class="op" id="5703428">)</span><span class="op" id="5703429">)</span><span class="op" id="5703430">%</span><span class="num" id="5703431">31</span><span class="op" id="5703433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703436">if</span>&nbsp;<span class="ident" id="5703439">_</span><span class="op" id="5703440">,</span>&nbsp;<span class="ident" id="5703442">err</span>&nbsp;<span class="op" id="5703446">=</span>&nbsp;<span class="ident" id="5703448">z</span><span class="op" id="5703449">.</span><span class="ident" id="5703450">w</span><span class="op" id="5703451">.</span><span class="ident" id="5703452">Write</span><span class="op" id="5703457">(</span><span class="ident" id="5703458">z</span><span class="op" id="5703459">.</span><span class="ident" id="5703460">scratch</span><span class="op" id="5703467">[</span><span class="num" id="5703468">0</span><span class="op" id="5703469">:</span><span class="num" id="5703470">2</span><span class="op" id="5703471">]</span><span class="op" id="5703472">)</span><span class="op" id="5703473">;</span>&nbsp;<span class="ident" id="5703475">err</span>&nbsp;<span class="op" id="5703479">!=</span>&nbsp;<span class="ident" id="5703482">nil</span>&nbsp;<span class="op" id="5703486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703490">return</span>&nbsp;<span class="ident" id="5703497">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5703502">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703505">if</span>&nbsp;<span class="ident" id="5703508">z</span><span class="op" id="5703509">.</span><span class="ident" id="5703510">dict</span>&nbsp;<span class="op" id="5703515">!=</span>&nbsp;<span class="ident" id="5703518">nil</span>&nbsp;<span class="op" id="5703522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5703526">//&nbsp;The&nbsp;next&nbsp;four&nbsp;bytes&nbsp;are&nbsp;the&nbsp;Adler-32&nbsp;checksum&nbsp;of&nbsp;the&nbsp;dictionary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703596">checksum</span>&nbsp;<span class="op" id="5703605">:=</span>&nbsp;<span class="ident" id="5703608">adler32</span><span class="op" id="5703615">.</span><span class="ident" id="5703616">Checksum</span><span class="op" id="5703624">(</span><span class="ident" id="5703625">z</span><span class="op" id="5703626">.</span><span class="ident" id="5703627">dict</span><span class="op" id="5703631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703635">z</span><span class="op" id="5703636">.</span><span class="ident" id="5703637">scratch</span><span class="op" id="5703644">[</span><span class="num" id="5703645">0</span><span class="op" id="5703646">]</span>&nbsp;<span class="op" id="5703648">=</span>&nbsp;<span class="builtintype" id="5703650">uint8</span><span class="op" id="5703655">(</span><span class="ident" id="5703656">checksum</span>&nbsp;<span class="op" id="5703665">&gt;&gt;</span>&nbsp;<span class="num" id="5703668">24</span><span class="op" id="5703670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703674">z</span><span class="op" id="5703675">.</span><span class="ident" id="5703676">scratch</span><span class="op" id="5703683">[</span><span class="num" id="5703684">1</span><span class="op" id="5703685">]</span>&nbsp;<span class="op" id="5703687">=</span>&nbsp;<span class="builtintype" id="5703689">uint8</span><span class="op" id="5703694">(</span><span class="ident" id="5703695">checksum</span>&nbsp;<span class="op" id="5703704">&gt;&gt;</span>&nbsp;<span class="num" id="5703707">16</span><span class="op" id="5703709">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703713">z</span><span class="op" id="5703714">.</span><span class="ident" id="5703715">scratch</span><span class="op" id="5703722">[</span><span class="num" id="5703723">2</span><span class="op" id="5703724">]</span>&nbsp;<span class="op" id="5703726">=</span>&nbsp;<span class="builtintype" id="5703728">uint8</span><span class="op" id="5703733">(</span><span class="ident" id="5703734">checksum</span>&nbsp;<span class="op" id="5703743">&gt;&gt;</span>&nbsp;<span class="num" id="5703746">8</span><span class="op" id="5703747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703751">z</span><span class="op" id="5703752">.</span><span class="ident" id="5703753">scratch</span><span class="op" id="5703760">[</span><span class="num" id="5703761">3</span><span class="op" id="5703762">]</span>&nbsp;<span class="op" id="5703764">=</span>&nbsp;<span class="builtintype" id="5703766">uint8</span><span class="op" id="5703771">(</span><span class="ident" id="5703772">checksum</span>&nbsp;<span class="op" id="5703781">&gt;&gt;</span>&nbsp;<span class="num" id="5703784">0</span><span class="op" id="5703785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703789">if</span>&nbsp;<span class="ident" id="5703792">_</span><span class="op" id="5703793">,</span>&nbsp;<span class="ident" id="5703795">err</span>&nbsp;<span class="op" id="5703799">=</span>&nbsp;<span class="ident" id="5703801">z</span><span class="op" id="5703802">.</span><span class="ident" id="5703803">w</span><span class="op" id="5703804">.</span><span class="ident" id="5703805">Write</span><span class="op" id="5703810">(</span><span class="ident" id="5703811">z</span><span class="op" id="5703812">.</span><span class="ident" id="5703813">scratch</span><span class="op" id="5703820">[</span><span class="num" id="5703821">0</span><span class="op" id="5703822">:</span><span class="num" id="5703823">4</span><span class="op" id="5703824">]</span><span class="op" id="5703825">)</span><span class="op" id="5703826">;</span>&nbsp;<span class="ident" id="5703828">err</span>&nbsp;<span class="op" id="5703832">!=</span>&nbsp;<span class="ident" id="5703835">nil</span>&nbsp;<span class="op" id="5703839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703844">return</span>&nbsp;<span class="ident" id="5703851">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5703857">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5703860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703863">if</span>&nbsp;<span class="ident" id="5703866">z</span><span class="op" id="5703867">.</span><span class="ident" id="5703868">compressor</span>&nbsp;<span class="op" id="5703879">==</span>&nbsp;<span class="ident" id="5703882">nil</span>&nbsp;<span class="op" id="5703886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5703890">//&nbsp;Initialize&nbsp;deflater&nbsp;unless&nbsp;the&nbsp;Writer&nbsp;is&nbsp;being&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5703949">//&nbsp;after&nbsp;a&nbsp;Reset&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703974">z</span><span class="op" id="5703975">.</span><span class="ident" id="5703976">compressor</span><span class="op" id="5703986">,</span>&nbsp;<span class="ident" id="5703988">err</span>&nbsp;<span class="op" id="5703992">=</span>&nbsp;<span class="ident" id="5703994">flate</span><span class="op" id="5703999">.</span><span class="ident" id="5704000">NewWriterDict</span><span class="op" id="5704013">(</span><span class="ident" id="5704014">z</span><span class="op" id="5704015">.</span><span class="ident" id="5704016">w</span><span class="op" id="5704017">,</span>&nbsp;<span class="ident" id="5704019">z</span><span class="op" id="5704020">.</span><span class="ident" id="5704021">level</span><span class="op" id="5704026">,</span>&nbsp;<span class="ident" id="5704028">z</span><span class="op" id="5704029">.</span><span class="ident" id="5704030">dict</span><span class="op" id="5704034">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704038">if</span>&nbsp;<span class="ident" id="5704041">err</span>&nbsp;<span class="op" id="5704045">!=</span>&nbsp;<span class="ident" id="5704048">nil</span>&nbsp;<span class="op" id="5704052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704057">return</span>&nbsp;<span class="ident" id="5704064">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5704070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704074">z</span><span class="op" id="5704075">.</span><span class="ident" id="5704076">digest</span>&nbsp;<span class="op" id="5704083">=</span>&nbsp;<span class="ident" id="5704085">adler32</span><span class="op" id="5704092">.</span><span class="ident" id="5704093">New</span><span class="op" id="5704096">(</span><span class="op" id="5704097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5704100">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704103">return</span>&nbsp;<span class="ident" id="5704110">nil</span><br>
<span class="lineno"></span><span class="op" id="5704114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5704117">//&nbsp;Write&nbsp;writes&nbsp;a&nbsp;compressed&nbsp;form&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="5704189">//&nbsp;compressed&nbsp;bytes&nbsp;are&nbsp;not&nbsp;necessarily&nbsp;flushed&nbsp;until&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed&nbsp;or</span><br>
<span class="lineno">145</span><span class="comment" id="5704267">//&nbsp;explicitly&nbsp;flushed.</span><br>
<span class="lineno"></span><span class="keyword" id="5704290">func</span>&nbsp;<span class="op" id="5704295">(</span><span class="ident" id="5704296">z</span>&nbsp;<span class="op" id="5704298">*</span><span class="ident" id="5704299">Writer</span><span class="op" id="5704305">)</span>&nbsp;<span class="ident" id="5704307">Write</span><span class="op" id="5704312">(</span><span class="ident" id="5704313">p</span>&nbsp;<span class="op" id="5704315">[</span><span class="op" id="5704316">]</span><span class="builtintype" id="5704317">byte</span><span class="op" id="5704321">)</span>&nbsp;<span class="op" id="5704323">(</span><span class="ident" id="5704324">n</span>&nbsp;<span class="builtintype" id="5704326">int</span><span class="op" id="5704329">,</span>&nbsp;<span class="ident" id="5704331">err</span>&nbsp;<span class="builtintype" id="5704335">error</span><span class="op" id="5704340">)</span>&nbsp;<span class="op" id="5704342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704345">if</span>&nbsp;<span class="op" id="5704348">!</span><span class="ident" id="5704349">z</span><span class="op" id="5704350">.</span><span class="ident" id="5704351">wroteHeader</span>&nbsp;<span class="op" id="5704363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704367">z</span><span class="op" id="5704368">.</span><span class="ident" id="5704369">err</span>&nbsp;<span class="op" id="5704373">=</span>&nbsp;<span class="ident" id="5704375">z</span><span class="op" id="5704376">.</span><span class="ident" id="5704377">writeHeader</span><span class="op" id="5704388">(</span><span class="op" id="5704389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5704392">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704395">if</span>&nbsp;<span class="ident" id="5704398">z</span><span class="op" id="5704399">.</span><span class="ident" id="5704400">err</span>&nbsp;<span class="op" id="5704404">!=</span>&nbsp;<span class="ident" id="5704407">nil</span>&nbsp;<span class="op" id="5704411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704415">return</span>&nbsp;<span class="num" id="5704422">0</span><span class="op" id="5704423">,</span>&nbsp;<span class="ident" id="5704425">z</span><span class="op" id="5704426">.</span><span class="ident" id="5704427">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5704432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704435">if</span>&nbsp;<span class="builtinfunc" id="5704438">len</span><span class="op" id="5704441">(</span><span class="ident" id="5704442">p</span><span class="op" id="5704443">)</span>&nbsp;<span class="op" id="5704445">==</span>&nbsp;<span class="num" id="5704448">0</span>&nbsp;<span class="op" id="5704450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704454">return</span>&nbsp;<span class="num" id="5704461">0</span><span class="op" id="5704462">,</span>&nbsp;<span class="ident" id="5704464">nil</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5704469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704472">n</span><span class="op" id="5704473">,</span>&nbsp;<span class="ident" id="5704475">err</span>&nbsp;<span class="op" id="5704479">=</span>&nbsp;<span class="ident" id="5704481">z</span><span class="op" id="5704482">.</span><span class="ident" id="5704483">compressor</span><span class="op" id="5704493">.</span><span class="ident" id="5704494">Write</span><span class="op" id="5704499">(</span><span class="ident" id="5704500">p</span><span class="op" id="5704501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704504">if</span>&nbsp;<span class="ident" id="5704507">err</span>&nbsp;<span class="op" id="5704511">!=</span>&nbsp;<span class="ident" id="5704514">nil</span>&nbsp;<span class="op" id="5704518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704522">z</span><span class="op" id="5704523">.</span><span class="ident" id="5704524">err</span>&nbsp;<span class="op" id="5704528">=</span>&nbsp;<span class="ident" id="5704530">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704536">return</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5704544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704547">z</span><span class="op" id="5704548">.</span><span class="ident" id="5704549">digest</span><span class="op" id="5704555">.</span><span class="ident" id="5704556">Write</span><span class="op" id="5704561">(</span><span class="ident" id="5704562">p</span><span class="op" id="5704563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704566">return</span><br>
<span class="lineno"></span><span class="op" id="5704573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="5704576">//&nbsp;Flush&nbsp;flushes&nbsp;the&nbsp;Writer&nbsp;to&nbsp;its&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5704633">func</span>&nbsp;<span class="op" id="5704638">(</span><span class="ident" id="5704639">z</span>&nbsp;<span class="op" id="5704641">*</span><span class="ident" id="5704642">Writer</span><span class="op" id="5704648">)</span>&nbsp;<span class="ident" id="5704650">Flush</span><span class="op" id="5704655">(</span><span class="op" id="5704656">)</span>&nbsp;<span class="builtintype" id="5704658">error</span>&nbsp;<span class="op" id="5704664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704667">if</span>&nbsp;<span class="op" id="5704670">!</span><span class="ident" id="5704671">z</span><span class="op" id="5704672">.</span><span class="ident" id="5704673">wroteHeader</span>&nbsp;<span class="op" id="5704685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704689">z</span><span class="op" id="5704690">.</span><span class="ident" id="5704691">err</span>&nbsp;<span class="op" id="5704695">=</span>&nbsp;<span class="ident" id="5704697">z</span><span class="op" id="5704698">.</span><span class="ident" id="5704699">writeHeader</span><span class="op" id="5704710">(</span><span class="op" id="5704711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5704714">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704717">if</span>&nbsp;<span class="ident" id="5704720">z</span><span class="op" id="5704721">.</span><span class="ident" id="5704722">err</span>&nbsp;<span class="op" id="5704726">!=</span>&nbsp;<span class="ident" id="5704729">nil</span>&nbsp;<span class="op" id="5704733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704737">return</span>&nbsp;<span class="ident" id="5704744">z</span><span class="op" id="5704745">.</span><span class="ident" id="5704746">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5704751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704754">z</span><span class="op" id="5704755">.</span><span class="ident" id="5704756">err</span>&nbsp;<span class="op" id="5704760">=</span>&nbsp;<span class="ident" id="5704762">z</span><span class="op" id="5704763">.</span><span class="ident" id="5704764">compressor</span><span class="op" id="5704774">.</span><span class="ident" id="5704775">Flush</span><span class="op" id="5704780">(</span><span class="op" id="5704781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704784">return</span>&nbsp;<span class="ident" id="5704791">z</span><span class="op" id="5704792">.</span><span class="ident" id="5704793">err</span><br>
<span class="lineno">175</span><span class="op" id="5704797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5704800">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Writer,&nbsp;flushing&nbsp;any&nbsp;unwritten&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="5704874">//&nbsp;io.Writer,&nbsp;but&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5704933">func</span>&nbsp;<span class="op" id="5704938">(</span><span class="ident" id="5704939">z</span>&nbsp;<span class="op" id="5704941">*</span><span class="ident" id="5704942">Writer</span><span class="op" id="5704948">)</span>&nbsp;<span class="ident" id="5704950">Close</span><span class="op" id="5704955">(</span><span class="op" id="5704956">)</span>&nbsp;<span class="builtintype" id="5704958">error</span>&nbsp;<span class="op" id="5704964">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704967">if</span>&nbsp;<span class="op" id="5704970">!</span><span class="ident" id="5704971">z</span><span class="op" id="5704972">.</span><span class="ident" id="5704973">wroteHeader</span>&nbsp;<span class="op" id="5704985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704989">z</span><span class="op" id="5704990">.</span><span class="ident" id="5704991">err</span>&nbsp;<span class="op" id="5704995">=</span>&nbsp;<span class="ident" id="5704997">z</span><span class="op" id="5704998">.</span><span class="ident" id="5704999">writeHeader</span><span class="op" id="5705010">(</span><span class="op" id="5705011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5705014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5705017">if</span>&nbsp;<span class="ident" id="5705020">z</span><span class="op" id="5705021">.</span><span class="ident" id="5705022">err</span>&nbsp;<span class="op" id="5705026">!=</span>&nbsp;<span class="ident" id="5705029">nil</span>&nbsp;<span class="op" id="5705033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5705037">return</span>&nbsp;<span class="ident" id="5705044">z</span><span class="op" id="5705045">.</span><span class="ident" id="5705046">err</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5705051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705054">z</span><span class="op" id="5705055">.</span><span class="ident" id="5705056">err</span>&nbsp;<span class="op" id="5705060">=</span>&nbsp;<span class="ident" id="5705062">z</span><span class="op" id="5705063">.</span><span class="ident" id="5705064">compressor</span><span class="op" id="5705074">.</span><span class="ident" id="5705075">Close</span><span class="op" id="5705080">(</span><span class="op" id="5705081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5705084">if</span>&nbsp;<span class="ident" id="5705087">z</span><span class="op" id="5705088">.</span><span class="ident" id="5705089">err</span>&nbsp;<span class="op" id="5705093">!=</span>&nbsp;<span class="ident" id="5705096">nil</span>&nbsp;<span class="op" id="5705100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5705104">return</span>&nbsp;<span class="ident" id="5705111">z</span><span class="op" id="5705112">.</span><span class="ident" id="5705113">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5705118">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705121">checksum</span>&nbsp;<span class="op" id="5705130">:=</span>&nbsp;<span class="ident" id="5705133">z</span><span class="op" id="5705134">.</span><span class="ident" id="5705135">digest</span><span class="op" id="5705141">.</span><span class="ident" id="5705142">Sum32</span><span class="op" id="5705147">(</span><span class="op" id="5705148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5705151">//&nbsp;ZLIB&nbsp;(RFC&nbsp;1950)&nbsp;is&nbsp;big-endian,&nbsp;unlike&nbsp;GZIP&nbsp;(RFC&nbsp;1952).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705210">z</span><span class="op" id="5705211">.</span><span class="ident" id="5705212">scratch</span><span class="op" id="5705219">[</span><span class="num" id="5705220">0</span><span class="op" id="5705221">]</span>&nbsp;<span class="op" id="5705223">=</span>&nbsp;<span class="builtintype" id="5705225">uint8</span><span class="op" id="5705230">(</span><span class="ident" id="5705231">checksum</span>&nbsp;<span class="op" id="5705240">&gt;&gt;</span>&nbsp;<span class="num" id="5705243">24</span><span class="op" id="5705245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705248">z</span><span class="op" id="5705249">.</span><span class="ident" id="5705250">scratch</span><span class="op" id="5705257">[</span><span class="num" id="5705258">1</span><span class="op" id="5705259">]</span>&nbsp;<span class="op" id="5705261">=</span>&nbsp;<span class="builtintype" id="5705263">uint8</span><span class="op" id="5705268">(</span><span class="ident" id="5705269">checksum</span>&nbsp;<span class="op" id="5705278">&gt;&gt;</span>&nbsp;<span class="num" id="5705281">16</span><span class="op" id="5705283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705286">z</span><span class="op" id="5705287">.</span><span class="ident" id="5705288">scratch</span><span class="op" id="5705295">[</span><span class="num" id="5705296">2</span><span class="op" id="5705297">]</span>&nbsp;<span class="op" id="5705299">=</span>&nbsp;<span class="builtintype" id="5705301">uint8</span><span class="op" id="5705306">(</span><span class="ident" id="5705307">checksum</span>&nbsp;<span class="op" id="5705316">&gt;&gt;</span>&nbsp;<span class="num" id="5705319">8</span><span class="op" id="5705320">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705323">z</span><span class="op" id="5705324">.</span><span class="ident" id="5705325">scratch</span><span class="op" id="5705332">[</span><span class="num" id="5705333">3</span><span class="op" id="5705334">]</span>&nbsp;<span class="op" id="5705336">=</span>&nbsp;<span class="builtintype" id="5705338">uint8</span><span class="op" id="5705343">(</span><span class="ident" id="5705344">checksum</span>&nbsp;<span class="op" id="5705353">&gt;&gt;</span>&nbsp;<span class="num" id="5705356">0</span><span class="op" id="5705357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705360">_</span><span class="op" id="5705361">,</span>&nbsp;<span class="ident" id="5705363">z</span><span class="op" id="5705364">.</span><span class="ident" id="5705365">err</span>&nbsp;<span class="op" id="5705369">=</span>&nbsp;<span class="ident" id="5705371">z</span><span class="op" id="5705372">.</span><span class="ident" id="5705373">w</span><span class="op" id="5705374">.</span><span class="ident" id="5705375">Write</span><span class="op" id="5705380">(</span><span class="ident" id="5705381">z</span><span class="op" id="5705382">.</span><span class="ident" id="5705383">scratch</span><span class="op" id="5705390">[</span><span class="num" id="5705391">0</span><span class="op" id="5705392">:</span><span class="num" id="5705393">4</span><span class="op" id="5705394">]</span><span class="op" id="5705395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5705398">return</span>&nbsp;<span class="ident" id="5705405">z</span><span class="op" id="5705406">.</span><span class="ident" id="5705407">err</span><br>
<span class="lineno"></span><span class="op" id="5705411">}</span>
</div>
</body>
</html>
