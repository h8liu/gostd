<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/pprof</h2>
<ul>
<li><a href="/gostd/net/http/pprof/pprof.go.html" class="current">pprof.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6062141">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6062197">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6062251">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6062302">//&nbsp;Package&nbsp;pprof&nbsp;serves&nbsp;via&nbsp;its&nbsp;HTTP&nbsp;server&nbsp;runtime&nbsp;profiling&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="6062369">//&nbsp;in&nbsp;the&nbsp;format&nbsp;expected&nbsp;by&nbsp;the&nbsp;pprof&nbsp;visualization&nbsp;tool.</span><br>
<span class="lineno"></span><span class="comment" id="6062428">//&nbsp;For&nbsp;more&nbsp;information&nbsp;about&nbsp;pprof,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="6062469">//&nbsp;http://code.google.com/p/google-perftools/.</span><br>
<span class="lineno"></span><span class="comment" id="6062516">//</span><br>
<span class="lineno">10</span><span class="comment" id="6062519">//&nbsp;The&nbsp;package&nbsp;is&nbsp;typically&nbsp;only&nbsp;imported&nbsp;for&nbsp;the&nbsp;side&nbsp;effect&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="6062584">//&nbsp;registering&nbsp;its&nbsp;HTTP&nbsp;handlers.</span><br>
<span class="lineno"></span><span class="comment" id="6062618">//&nbsp;The&nbsp;handled&nbsp;paths&nbsp;all&nbsp;begin&nbsp;with&nbsp;/debug/pprof/.</span><br>
<span class="lineno"></span><span class="comment" id="6062669">//</span><br>
<span class="lineno"></span><span class="comment" id="6062672">//&nbsp;To&nbsp;use&nbsp;pprof,&nbsp;link&nbsp;this&nbsp;package&nbsp;into&nbsp;your&nbsp;program:</span><br>
<span class="lineno">15</span><span class="comment" id="6062726">//&nbsp;&nbsp;&nbsp;&nbsp;import&nbsp;_&nbsp;&#34;net/http/pprof&#34;</span><br>
<span class="lineno"></span><span class="comment" id="6062755">//</span><br>
<span class="lineno"></span><span class="comment" id="6062758">//&nbsp;If&nbsp;your&nbsp;application&nbsp;is&nbsp;not&nbsp;already&nbsp;running&nbsp;an&nbsp;http&nbsp;server,&nbsp;you</span><br>
<span class="lineno"></span><span class="comment" id="6062824">//&nbsp;need&nbsp;to&nbsp;start&nbsp;one.&nbsp;&nbsp;Add&nbsp;&#34;net/http&#34;&nbsp;and&nbsp;&#34;log&#34;&nbsp;to&nbsp;your&nbsp;imports&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6062892">//&nbsp;the&nbsp;following&nbsp;code&nbsp;to&nbsp;your&nbsp;main&nbsp;function:</span><br>
<span class="lineno">20</span><span class="comment" id="6062937">//</span><br>
<span class="lineno"></span><span class="comment" id="6062940">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;go&nbsp;func()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6062956">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.Println(http.ListenAndServe(&#34;localhost:6060&#34;,&nbsp;nil))</span><br>
<span class="lineno"></span><span class="comment" id="6063017">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}()</span><br>
<span class="lineno"></span><span class="comment" id="6063025">//</span><br>
<span class="lineno">25</span><span class="comment" id="6063028">//&nbsp;Then&nbsp;use&nbsp;the&nbsp;pprof&nbsp;tool&nbsp;to&nbsp;look&nbsp;at&nbsp;the&nbsp;heap&nbsp;profile:</span><br>
<span class="lineno"></span><span class="comment" id="6063084">//</span><br>
<span class="lineno"></span><span class="comment" id="6063087">//&nbsp;&nbsp;&nbsp;&nbsp;go&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/heap</span><br>
<span class="lineno"></span><span class="comment" id="6063143">//</span><br>
<span class="lineno"></span><span class="comment" id="6063146">//&nbsp;Or&nbsp;to&nbsp;look&nbsp;at&nbsp;a&nbsp;30-second&nbsp;CPU&nbsp;profile:</span><br>
<span class="lineno">30</span><span class="comment" id="6063188">//</span><br>
<span class="lineno"></span><span class="comment" id="6063191">//&nbsp;&nbsp;&nbsp;&nbsp;go&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/profile</span><br>
<span class="lineno"></span><span class="comment" id="6063250">//</span><br>
<span class="lineno"></span><span class="comment" id="6063253">//&nbsp;Or&nbsp;to&nbsp;look&nbsp;at&nbsp;the&nbsp;goroutine&nbsp;blocking&nbsp;profile:</span><br>
<span class="lineno"></span><span class="comment" id="6063302">//</span><br>
<span class="lineno">35</span><span class="comment" id="6063305">//&nbsp;&nbsp;&nbsp;&nbsp;go&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/block</span><br>
<span class="lineno"></span><span class="comment" id="6063362">//</span><br>
<span class="lineno"></span><span class="comment" id="6063365">//&nbsp;To&nbsp;view&nbsp;all&nbsp;available&nbsp;profiles,&nbsp;open&nbsp;http://localhost:6060/debug/pprof/</span><br>
<span class="lineno"></span><span class="comment" id="6063440">//&nbsp;in&nbsp;your&nbsp;browser.</span><br>
<span class="lineno"></span><span class="comment" id="6063460">//</span><br>
<span class="lineno">40</span><span class="comment" id="6063463">//&nbsp;For&nbsp;a&nbsp;study&nbsp;of&nbsp;the&nbsp;facility&nbsp;in&nbsp;action,&nbsp;visit</span><br>
<span class="lineno"></span><span class="comment" id="6063511">//</span><br>
<span class="lineno"></span><span class="comment" id="6063514">//&nbsp;&nbsp;&nbsp;&nbsp;http://blog.golang.org/2011/06/profiling-go-programs.html</span><br>
<span class="lineno"></span><span class="comment" id="6063575">//</span><br>
<span class="lineno"></span><span class="keyword" id="6063578">package</span>&nbsp;<span class="ident" id="6063586">pprof</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="6063593">import</span>&nbsp;<span class="op" id="6063600">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6063603">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6063612">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6063621">&#34;fmt&#34;</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6063628">&#34;html/template&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6063645">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6063651">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6063658">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6063670">&#34;os&#34;</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6063676">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6063687">&#34;runtime/pprof&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6063704">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6063715">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6063726">&#34;time&#34;</span><br>
<span class="lineno">60</span><span class="op" id="6063733">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6063736">func</span>&nbsp;<span class="ident" id="6063741">init</span><span class="op" id="6063745">(</span><span class="op" id="6063746">)</span>&nbsp;<span class="op" id="6063748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6063751">http</span><span class="op" id="6063755">.</span><span class="ident" id="6063756">Handle</span><span class="op" id="6063762">(</span><span class="string" id="6063763">&#34;/debug/pprof/&#34;</span><span class="op" id="6063778">,</span>&nbsp;<span class="ident" id="6063780">http</span><span class="op" id="6063784">.</span><span class="ident" id="6063785">HandlerFunc</span><span class="op" id="6063796">(</span><span class="ident" id="6063797">Index</span><span class="op" id="6063802">)</span><span class="op" id="6063803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6063806">http</span><span class="op" id="6063810">.</span><span class="ident" id="6063811">Handle</span><span class="op" id="6063817">(</span><span class="string" id="6063818">&#34;/debug/pprof/cmdline&#34;</span><span class="op" id="6063840">,</span>&nbsp;<span class="ident" id="6063842">http</span><span class="op" id="6063846">.</span><span class="ident" id="6063847">HandlerFunc</span><span class="op" id="6063858">(</span><span class="ident" id="6063859">Cmdline</span><span class="op" id="6063866">)</span><span class="op" id="6063867">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6063870">http</span><span class="op" id="6063874">.</span><span class="ident" id="6063875">Handle</span><span class="op" id="6063881">(</span><span class="string" id="6063882">&#34;/debug/pprof/profile&#34;</span><span class="op" id="6063904">,</span>&nbsp;<span class="ident" id="6063906">http</span><span class="op" id="6063910">.</span><span class="ident" id="6063911">HandlerFunc</span><span class="op" id="6063922">(</span><span class="ident" id="6063923">Profile</span><span class="op" id="6063930">)</span><span class="op" id="6063931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6063934">http</span><span class="op" id="6063938">.</span><span class="ident" id="6063939">Handle</span><span class="op" id="6063945">(</span><span class="string" id="6063946">&#34;/debug/pprof/symbol&#34;</span><span class="op" id="6063967">,</span>&nbsp;<span class="ident" id="6063969">http</span><span class="op" id="6063973">.</span><span class="ident" id="6063974">HandlerFunc</span><span class="op" id="6063985">(</span><span class="ident" id="6063986">Symbol</span><span class="op" id="6063992">)</span><span class="op" id="6063993">)</span><br>
<span class="lineno"></span><span class="op" id="6063995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6063998">//&nbsp;Cmdline&nbsp;responds&nbsp;with&nbsp;the&nbsp;running&nbsp;program&#39;s</span><br>
<span class="lineno">70</span><span class="comment" id="6064045">//&nbsp;command&nbsp;line,&nbsp;with&nbsp;arguments&nbsp;separated&nbsp;by&nbsp;NUL&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="6064101">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/cmdline.</span><br>
<span class="lineno"></span><span class="keyword" id="6064169">func</span>&nbsp;<span class="ident" id="6064174">Cmdline</span><span class="op" id="6064181">(</span><span class="ident" id="6064182">w</span>&nbsp;<span class="ident" id="6064184">http</span><span class="op" id="6064188">.</span><span class="ident" id="6064189">ResponseWriter</span><span class="op" id="6064203">,</span>&nbsp;<span class="ident" id="6064205">r</span>&nbsp;<span class="op" id="6064207">*</span><span class="ident" id="6064208">http</span><span class="op" id="6064212">.</span><span class="ident" id="6064213">Request</span><span class="op" id="6064220">)</span>&nbsp;<span class="op" id="6064222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6064225">w</span><span class="op" id="6064226">.</span><span class="ident" id="6064227">Header</span><span class="op" id="6064233">(</span><span class="op" id="6064234">)</span><span class="op" id="6064235">.</span><span class="ident" id="6064236">Set</span><span class="op" id="6064239">(</span><span class="string" id="6064240">&#34;Content-Type&#34;</span><span class="op" id="6064254">,</span>&nbsp;<span class="string" id="6064256">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="6064283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6064286">fmt</span><span class="op" id="6064289">.</span><span class="ident" id="6064290">Fprintf</span><span class="op" id="6064297">(</span><span class="ident" id="6064298">w</span><span class="op" id="6064299">,</span>&nbsp;<span class="ident" id="6064301">strings</span><span class="op" id="6064308">.</span><span class="ident" id="6064309">Join</span><span class="op" id="6064313">(</span><span class="ident" id="6064314">os</span><span class="op" id="6064316">.</span><span class="ident" id="6064317">Args</span><span class="op" id="6064321">,</span>&nbsp;<span class="string" id="6064323">&#34;\x00&#34;</span><span class="op" id="6064329">)</span><span class="op" id="6064330">)</span><br>
<span class="lineno">75</span><span class="op" id="6064332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6064335">//&nbsp;Profile&nbsp;responds&nbsp;with&nbsp;the&nbsp;pprof-formatted&nbsp;cpu&nbsp;profile.</span><br>
<span class="lineno"></span><span class="comment" id="6064393">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/profile.</span><br>
<span class="lineno"></span><span class="keyword" id="6064461">func</span>&nbsp;<span class="ident" id="6064466">Profile</span><span class="op" id="6064473">(</span><span class="ident" id="6064474">w</span>&nbsp;<span class="ident" id="6064476">http</span><span class="op" id="6064480">.</span><span class="ident" id="6064481">ResponseWriter</span><span class="op" id="6064495">,</span>&nbsp;<span class="ident" id="6064497">r</span>&nbsp;<span class="op" id="6064499">*</span><span class="ident" id="6064500">http</span><span class="op" id="6064504">.</span><span class="ident" id="6064505">Request</span><span class="op" id="6064512">)</span>&nbsp;<span class="op" id="6064514">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6064517">sec</span><span class="op" id="6064520">,</span>&nbsp;<span class="ident" id="6064522">_</span>&nbsp;<span class="op" id="6064524">:=</span>&nbsp;<span class="ident" id="6064527">strconv</span><span class="op" id="6064534">.</span><span class="ident" id="6064535">ParseInt</span><span class="op" id="6064543">(</span><span class="ident" id="6064544">r</span><span class="op" id="6064545">.</span><span class="ident" id="6064546">FormValue</span><span class="op" id="6064555">(</span><span class="string" id="6064556">&#34;seconds&#34;</span><span class="op" id="6064565">)</span><span class="op" id="6064566">,</span>&nbsp;<span class="num" id="6064568">10</span><span class="op" id="6064570">,</span>&nbsp;<span class="num" id="6064572">64</span><span class="op" id="6064574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6064577">if</span>&nbsp;<span class="ident" id="6064580">sec</span>&nbsp;<span class="op" id="6064584">==</span>&nbsp;<span class="num" id="6064587">0</span>&nbsp;<span class="op" id="6064589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6064593">sec</span>&nbsp;<span class="op" id="6064597">=</span>&nbsp;<span class="num" id="6064599">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6064603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6064607">//&nbsp;Set&nbsp;Content&nbsp;Type&nbsp;assuming&nbsp;StartCPUProfile&nbsp;will&nbsp;work,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6064664">//&nbsp;because&nbsp;if&nbsp;it&nbsp;does&nbsp;it&nbsp;starts&nbsp;writing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6064706">w</span><span class="op" id="6064707">.</span><span class="ident" id="6064708">Header</span><span class="op" id="6064714">(</span><span class="op" id="6064715">)</span><span class="op" id="6064716">.</span><span class="ident" id="6064717">Set</span><span class="op" id="6064720">(</span><span class="string" id="6064721">&#34;Content-Type&#34;</span><span class="op" id="6064735">,</span>&nbsp;<span class="string" id="6064737">&#34;application/octet-stream&#34;</span><span class="op" id="6064763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6064766">if</span>&nbsp;<span class="ident" id="6064769">err</span>&nbsp;<span class="op" id="6064773">:=</span>&nbsp;<span class="ident" id="6064776">pprof</span><span class="op" id="6064781">.</span><span class="ident" id="6064782">StartCPUProfile</span><span class="op" id="6064797">(</span><span class="ident" id="6064798">w</span><span class="op" id="6064799">)</span><span class="op" id="6064800">;</span>&nbsp;<span class="ident" id="6064802">err</span>&nbsp;<span class="op" id="6064806">!=</span>&nbsp;<span class="builtintype" id="6064809">nil</span>&nbsp;<span class="op" id="6064813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6064817">//&nbsp;StartCPUProfile&nbsp;failed,&nbsp;so&nbsp;no&nbsp;writes&nbsp;yet.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6064864">//&nbsp;Can&nbsp;change&nbsp;header&nbsp;back&nbsp;to&nbsp;text&nbsp;content</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6064908">//&nbsp;and&nbsp;send&nbsp;error&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6064934">w</span><span class="op" id="6064935">.</span><span class="ident" id="6064936">Header</span><span class="op" id="6064942">(</span><span class="op" id="6064943">)</span><span class="op" id="6064944">.</span><span class="ident" id="6064945">Set</span><span class="op" id="6064948">(</span><span class="string" id="6064949">&#34;Content-Type&#34;</span><span class="op" id="6064963">,</span>&nbsp;<span class="string" id="6064965">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="6064992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6064996">w</span><span class="op" id="6064997">.</span><span class="ident" id="6064998">WriteHeader</span><span class="op" id="6065009">(</span><span class="ident" id="6065010">http</span><span class="op" id="6065014">.</span><span class="ident" id="6065015">StatusInternalServerError</span><span class="op" id="6065040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6065044">fmt</span><span class="op" id="6065047">.</span><span class="ident" id="6065048">Fprintf</span><span class="op" id="6065055">(</span><span class="ident" id="6065056">w</span><span class="op" id="6065057">,</span>&nbsp;<span class="string" id="6065059">&#34;Could&nbsp;not&nbsp;enable&nbsp;CPU&nbsp;profiling:&nbsp;%s\n&#34;</span><span class="op" id="6065097">,</span>&nbsp;<span class="ident" id="6065099">err</span><span class="op" id="6065102">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6065106">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6065114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6065117">time</span><span class="op" id="6065121">.</span><span class="ident" id="6065122">Sleep</span><span class="op" id="6065127">(</span><span class="ident" id="6065128">time</span><span class="op" id="6065132">.</span><span class="ident" id="6065133">Duration</span><span class="op" id="6065141">(</span><span class="ident" id="6065142">sec</span><span class="op" id="6065145">)</span>&nbsp;<span class="op" id="6065147">*</span>&nbsp;<span class="ident" id="6065149">time</span><span class="op" id="6065153">.</span><span class="ident" id="6065154">Second</span><span class="op" id="6065160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6065163">pprof</span><span class="op" id="6065168">.</span><span class="ident" id="6065169">StopCPUProfile</span><span class="op" id="6065183">(</span><span class="op" id="6065184">)</span><br>
<span class="lineno"></span><span class="op" id="6065186">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="6065189">//&nbsp;Symbol&nbsp;looks&nbsp;up&nbsp;the&nbsp;program&nbsp;counters&nbsp;listed&nbsp;in&nbsp;the&nbsp;request,</span><br>
<span class="lineno"></span><span class="comment" id="6065252">//&nbsp;responding&nbsp;with&nbsp;a&nbsp;table&nbsp;mapping&nbsp;program&nbsp;counters&nbsp;to&nbsp;function&nbsp;names.</span><br>
<span class="lineno"></span><span class="comment" id="6065323">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/symbol.</span><br>
<span class="lineno"></span><span class="keyword" id="6065390">func</span>&nbsp;<span class="ident" id="6065395">Symbol</span><span class="op" id="6065401">(</span><span class="ident" id="6065402">w</span>&nbsp;<span class="ident" id="6065404">http</span><span class="op" id="6065408">.</span><span class="ident" id="6065409">ResponseWriter</span><span class="op" id="6065423">,</span>&nbsp;<span class="ident" id="6065425">r</span>&nbsp;<span class="op" id="6065427">*</span><span class="ident" id="6065428">http</span><span class="op" id="6065432">.</span><span class="ident" id="6065433">Request</span><span class="op" id="6065440">)</span>&nbsp;<span class="op" id="6065442">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6065445">w</span><span class="op" id="6065446">.</span><span class="ident" id="6065447">Header</span><span class="op" id="6065453">(</span><span class="op" id="6065454">)</span><span class="op" id="6065455">.</span><span class="ident" id="6065456">Set</span><span class="op" id="6065459">(</span><span class="string" id="6065460">&#34;Content-Type&#34;</span><span class="op" id="6065474">,</span>&nbsp;<span class="string" id="6065476">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="6065503">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6065507">//&nbsp;We&nbsp;have&nbsp;to&nbsp;read&nbsp;the&nbsp;whole&nbsp;POST&nbsp;body&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6065554">//&nbsp;writing&nbsp;any&nbsp;output.&nbsp;&nbsp;Buffer&nbsp;the&nbsp;output&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6065603">var</span>&nbsp;<span class="ident" id="6065607">buf</span>&nbsp;<span class="ident" id="6065611">bytes</span><span class="op" id="6065616">.</span><span class="ident" id="6065617">Buffer</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6065626">//&nbsp;We&nbsp;don&#39;t&nbsp;know&nbsp;how&nbsp;many&nbsp;symbols&nbsp;we&nbsp;have,&nbsp;but&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6065677">//&nbsp;do&nbsp;have&nbsp;symbol&nbsp;information.&nbsp;&nbsp;Pprof&nbsp;only&nbsp;cares&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6065735">//&nbsp;this&nbsp;number&nbsp;is&nbsp;0&nbsp;(no&nbsp;symbols&nbsp;available)&nbsp;or&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6065787">fmt</span><span class="op" id="6065790">.</span><span class="ident" id="6065791">Fprintf</span><span class="op" id="6065798">(</span><span class="op" id="6065799">&amp;</span><span class="ident" id="6065800">buf</span><span class="op" id="6065803">,</span>&nbsp;<span class="string" id="6065805">&#34;num_symbols:&nbsp;1\n&#34;</span><span class="op" id="6065823">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6065827">var</span>&nbsp;<span class="ident" id="6065831">b</span>&nbsp;<span class="op" id="6065833">*</span><span class="ident" id="6065834">bufio</span><span class="op" id="6065839">.</span><span class="ident" id="6065840">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6065848">if</span>&nbsp;<span class="ident" id="6065851">r</span><span class="op" id="6065852">.</span><span class="ident" id="6065853">Method</span>&nbsp;<span class="op" id="6065860">==</span>&nbsp;<span class="string" id="6065863">&#34;POST&#34;</span>&nbsp;<span class="op" id="6065870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6065874">b</span>&nbsp;<span class="op" id="6065876">=</span>&nbsp;<span class="ident" id="6065878">bufio</span><span class="op" id="6065883">.</span><span class="ident" id="6065884">NewReader</span><span class="op" id="6065893">(</span><span class="ident" id="6065894">r</span><span class="op" id="6065895">.</span><span class="ident" id="6065896">Body</span><span class="op" id="6065900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6065903">}</span>&nbsp;<span class="keyword" id="6065905">else</span>&nbsp;<span class="op" id="6065910">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6065914">b</span>&nbsp;<span class="op" id="6065916">=</span>&nbsp;<span class="ident" id="6065918">bufio</span><span class="op" id="6065923">.</span><span class="ident" id="6065924">NewReader</span><span class="op" id="6065933">(</span><span class="ident" id="6065934">strings</span><span class="op" id="6065941">.</span><span class="ident" id="6065942">NewReader</span><span class="op" id="6065951">(</span><span class="ident" id="6065952">r</span><span class="op" id="6065953">.</span><span class="ident" id="6065954">URL</span><span class="op" id="6065957">.</span><span class="ident" id="6065958">RawQuery</span><span class="op" id="6065966">)</span><span class="op" id="6065967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6065970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6065974">for</span>&nbsp;<span class="op" id="6065978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6065982">word</span><span class="op" id="6065986">,</span>&nbsp;<span class="ident" id="6065988">err</span>&nbsp;<span class="op" id="6065992">:=</span>&nbsp;<span class="ident" id="6065995">b</span><span class="op" id="6065996">.</span><span class="ident" id="6065997">ReadSlice</span><span class="op" id="6066006">(</span><span class="string" id="6066007">&#39;+&#39;</span><span class="op" id="6066010">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6066014">if</span>&nbsp;<span class="ident" id="6066017">err</span>&nbsp;<span class="op" id="6066021">==</span>&nbsp;<span class="builtintype" id="6066024">nil</span>&nbsp;<span class="op" id="6066028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6066033">word</span>&nbsp;<span class="op" id="6066038">=</span>&nbsp;<span class="ident" id="6066040">word</span><span class="op" id="6066044">[</span><span class="num" id="6066045">0</span>&nbsp;<span class="op" id="6066047">:</span>&nbsp;<span class="builtinfunc" id="6066049">len</span><span class="op" id="6066052">(</span><span class="ident" id="6066053">word</span><span class="op" id="6066057">)</span><span class="op" id="6066058">-</span><span class="num" id="6066059">1</span><span class="op" id="6066060">]</span>&nbsp;<span class="comment" id="6066062">//&nbsp;trim&nbsp;+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6066074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6066078">pc</span><span class="op" id="6066080">,</span>&nbsp;<span class="ident" id="6066082">_</span>&nbsp;<span class="op" id="6066084">:=</span>&nbsp;<span class="ident" id="6066087">strconv</span><span class="op" id="6066094">.</span><span class="ident" id="6066095">ParseUint</span><span class="op" id="6066104">(</span><span class="builtintype" id="6066105">string</span><span class="op" id="6066111">(</span><span class="ident" id="6066112">word</span><span class="op" id="6066116">)</span><span class="op" id="6066117">,</span>&nbsp;<span class="num" id="6066119">0</span><span class="op" id="6066120">,</span>&nbsp;<span class="num" id="6066122">64</span><span class="op" id="6066124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6066128">if</span>&nbsp;<span class="ident" id="6066131">pc</span>&nbsp;<span class="op" id="6066134">!=</span>&nbsp;<span class="num" id="6066137">0</span>&nbsp;<span class="op" id="6066139">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6066144">f</span>&nbsp;<span class="op" id="6066146">:=</span>&nbsp;<span class="ident" id="6066149">runtime</span><span class="op" id="6066156">.</span><span class="ident" id="6066157">FuncForPC</span><span class="op" id="6066166">(</span><span class="builtintype" id="6066167">uintptr</span><span class="op" id="6066174">(</span><span class="ident" id="6066175">pc</span><span class="op" id="6066177">)</span><span class="op" id="6066178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6066183">if</span>&nbsp;<span class="ident" id="6066186">f</span>&nbsp;<span class="op" id="6066188">!=</span>&nbsp;<span class="builtintype" id="6066191">nil</span>&nbsp;<span class="op" id="6066195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6066201">fmt</span><span class="op" id="6066204">.</span><span class="ident" id="6066205">Fprintf</span><span class="op" id="6066212">(</span><span class="op" id="6066213">&amp;</span><span class="ident" id="6066214">buf</span><span class="op" id="6066217">,</span>&nbsp;<span class="string" id="6066219">&#34;%#x&nbsp;%s\n&#34;</span><span class="op" id="6066229">,</span>&nbsp;<span class="ident" id="6066231">pc</span><span class="op" id="6066233">,</span>&nbsp;<span class="ident" id="6066235">f</span><span class="op" id="6066236">.</span><span class="ident" id="6066237">Name</span><span class="op" id="6066241">(</span><span class="op" id="6066242">)</span><span class="op" id="6066243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6066248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6066252">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6066257">//&nbsp;Wait&nbsp;until&nbsp;here&nbsp;to&nbsp;check&nbsp;for&nbsp;err;&nbsp;the&nbsp;last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6066305">//&nbsp;symbol&nbsp;will&nbsp;have&nbsp;an&nbsp;err&nbsp;because&nbsp;it&nbsp;doesn&#39;t&nbsp;end&nbsp;in&nbsp;+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6066363">if</span>&nbsp;<span class="ident" id="6066366">err</span>&nbsp;<span class="op" id="6066370">!=</span>&nbsp;<span class="builtintype" id="6066373">nil</span>&nbsp;<span class="op" id="6066377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6066382">if</span>&nbsp;<span class="ident" id="6066385">err</span>&nbsp;<span class="op" id="6066389">!=</span>&nbsp;<span class="ident" id="6066392">io</span><span class="op" id="6066394">.</span><span class="ident" id="6066395">EOF</span>&nbsp;<span class="op" id="6066399">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6066405">fmt</span><span class="op" id="6066408">.</span><span class="ident" id="6066409">Fprintf</span><span class="op" id="6066416">(</span><span class="op" id="6066417">&amp;</span><span class="ident" id="6066418">buf</span><span class="op" id="6066421">,</span>&nbsp;<span class="string" id="6066423">&#34;reading&nbsp;request:&nbsp;%v\n&#34;</span><span class="op" id="6066446">,</span>&nbsp;<span class="ident" id="6066448">err</span><span class="op" id="6066451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6066456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6066461">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6066469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6066472">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6066476">w</span><span class="op" id="6066477">.</span><span class="ident" id="6066478">Write</span><span class="op" id="6066483">(</span><span class="ident" id="6066484">buf</span><span class="op" id="6066487">.</span><span class="ident" id="6066488">Bytes</span><span class="op" id="6066493">(</span><span class="op" id="6066494">)</span><span class="op" id="6066495">)</span><br>
<span class="lineno"></span><span class="op" id="6066497">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6066500">//&nbsp;Handler&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;handler&nbsp;that&nbsp;serves&nbsp;the&nbsp;named&nbsp;profile.</span><br>
<span class="lineno">150</span><span class="keyword" id="6066566">func</span>&nbsp;<span class="ident" id="6066571">Handler</span><span class="op" id="6066578">(</span><span class="ident" id="6066579">name</span>&nbsp;<span class="builtintype" id="6066584">string</span><span class="op" id="6066590">)</span>&nbsp;<span class="ident" id="6066592">http</span><span class="op" id="6066596">.</span><span class="ident" id="6066597">Handler</span>&nbsp;<span class="op" id="6066605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6066608">return</span>&nbsp;<span class="ident" id="6066615">handler</span><span class="op" id="6066622">(</span><span class="ident" id="6066623">name</span><span class="op" id="6066627">)</span><br>
<span class="lineno"></span><span class="op" id="6066629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6066632">type</span>&nbsp;<span class="ident" id="6066637">handler</span>&nbsp;<span class="builtintype" id="6066645">string</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="6066653">func</span>&nbsp;<span class="op" id="6066658">(</span><span class="ident" id="6066659">name</span>&nbsp;<span class="ident" id="6066664">handler</span><span class="op" id="6066671">)</span>&nbsp;<span class="ident" id="6066673">ServeHTTP</span><span class="op" id="6066682">(</span><span class="ident" id="6066683">w</span>&nbsp;<span class="ident" id="6066685">http</span><span class="op" id="6066689">.</span><span class="ident" id="6066690">ResponseWriter</span><span class="op" id="6066704">,</span>&nbsp;<span class="ident" id="6066706">r</span>&nbsp;<span class="op" id="6066708">*</span><span class="ident" id="6066709">http</span><span class="op" id="6066713">.</span><span class="ident" id="6066714">Request</span><span class="op" id="6066721">)</span>&nbsp;<span class="op" id="6066723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6066726">w</span><span class="op" id="6066727">.</span><span class="ident" id="6066728">Header</span><span class="op" id="6066734">(</span><span class="op" id="6066735">)</span><span class="op" id="6066736">.</span><span class="ident" id="6066737">Set</span><span class="op" id="6066740">(</span><span class="string" id="6066741">&#34;Content-Type&#34;</span><span class="op" id="6066755">,</span>&nbsp;<span class="string" id="6066757">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="6066784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6066787">debug</span><span class="op" id="6066792">,</span>&nbsp;<span class="ident" id="6066794">_</span>&nbsp;<span class="op" id="6066796">:=</span>&nbsp;<span class="ident" id="6066799">strconv</span><span class="op" id="6066806">.</span><span class="ident" id="6066807">Atoi</span><span class="op" id="6066811">(</span><span class="ident" id="6066812">r</span><span class="op" id="6066813">.</span><span class="ident" id="6066814">FormValue</span><span class="op" id="6066823">(</span><span class="string" id="6066824">&#34;debug&#34;</span><span class="op" id="6066831">)</span><span class="op" id="6066832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6066835">p</span>&nbsp;<span class="op" id="6066837">:=</span>&nbsp;<span class="ident" id="6066840">pprof</span><span class="op" id="6066845">.</span><span class="ident" id="6066846">Lookup</span><span class="op" id="6066852">(</span><span class="builtintype" id="6066853">string</span><span class="op" id="6066859">(</span><span class="ident" id="6066860">name</span><span class="op" id="6066864">)</span><span class="op" id="6066865">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6066868">if</span>&nbsp;<span class="ident" id="6066871">p</span>&nbsp;<span class="op" id="6066873">==</span>&nbsp;<span class="builtintype" id="6066876">nil</span>&nbsp;<span class="op" id="6066880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6066884">w</span><span class="op" id="6066885">.</span><span class="ident" id="6066886">WriteHeader</span><span class="op" id="6066897">(</span><span class="num" id="6066898">404</span><span class="op" id="6066901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6066905">fmt</span><span class="op" id="6066908">.</span><span class="ident" id="6066909">Fprintf</span><span class="op" id="6066916">(</span><span class="ident" id="6066917">w</span><span class="op" id="6066918">,</span>&nbsp;<span class="string" id="6066920">&#34;Unknown&nbsp;profile:&nbsp;%s\n&#34;</span><span class="op" id="6066943">,</span>&nbsp;<span class="ident" id="6066945">name</span><span class="op" id="6066949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6066953">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6066961">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6066964">gc</span><span class="op" id="6066966">,</span>&nbsp;<span class="ident" id="6066968">_</span>&nbsp;<span class="op" id="6066970">:=</span>&nbsp;<span class="ident" id="6066973">strconv</span><span class="op" id="6066980">.</span><span class="ident" id="6066981">Atoi</span><span class="op" id="6066985">(</span><span class="ident" id="6066986">r</span><span class="op" id="6066987">.</span><span class="ident" id="6066988">FormValue</span><span class="op" id="6066997">(</span><span class="string" id="6066998">&#34;gc&#34;</span><span class="op" id="6067002">)</span><span class="op" id="6067003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6067006">if</span>&nbsp;<span class="ident" id="6067009">name</span>&nbsp;<span class="op" id="6067014">==</span>&nbsp;<span class="string" id="6067017">&#34;heap&#34;</span>&nbsp;<span class="op" id="6067024">&amp;&amp;</span>&nbsp;<span class="ident" id="6067027">gc</span>&nbsp;<span class="op" id="6067030">&gt;</span>&nbsp;<span class="num" id="6067032">0</span>&nbsp;<span class="op" id="6067034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6067038">runtime</span><span class="op" id="6067045">.</span><span class="ident" id="6067046">GC</span><span class="op" id="6067048">(</span><span class="op" id="6067049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6067052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6067055">p</span><span class="op" id="6067056">.</span><span class="ident" id="6067057">WriteTo</span><span class="op" id="6067064">(</span><span class="ident" id="6067065">w</span><span class="op" id="6067066">,</span>&nbsp;<span class="ident" id="6067068">debug</span><span class="op" id="6067073">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6067076">return</span><br>
<span class="lineno"></span><span class="op" id="6067083">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6067086">//&nbsp;Index&nbsp;responds&nbsp;with&nbsp;the&nbsp;pprof-formatted&nbsp;profile&nbsp;named&nbsp;by&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="6067159">//&nbsp;For&nbsp;example,&nbsp;&#34;/debug/pprof/heap&#34;&nbsp;serves&nbsp;the&nbsp;&#34;heap&#34;&nbsp;profile.</span><br>
<span class="lineno">175</span><span class="comment" id="6067222">//&nbsp;Index&nbsp;responds&nbsp;to&nbsp;a&nbsp;request&nbsp;for&nbsp;&#34;/debug/pprof/&#34;&nbsp;with&nbsp;an&nbsp;HTML&nbsp;page</span><br>
<span class="lineno"></span><span class="comment" id="6067291">//&nbsp;listing&nbsp;the&nbsp;available&nbsp;profiles.</span><br>
<span class="lineno"></span><span class="keyword" id="6067326">func</span>&nbsp;<span class="ident" id="6067331">Index</span><span class="op" id="6067336">(</span><span class="ident" id="6067337">w</span>&nbsp;<span class="ident" id="6067339">http</span><span class="op" id="6067343">.</span><span class="ident" id="6067344">ResponseWriter</span><span class="op" id="6067358">,</span>&nbsp;<span class="ident" id="6067360">r</span>&nbsp;<span class="op" id="6067362">*</span><span class="ident" id="6067363">http</span><span class="op" id="6067367">.</span><span class="ident" id="6067368">Request</span><span class="op" id="6067375">)</span>&nbsp;<span class="op" id="6067377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6067380">if</span>&nbsp;<span class="ident" id="6067383">strings</span><span class="op" id="6067390">.</span><span class="ident" id="6067391">HasPrefix</span><span class="op" id="6067400">(</span><span class="ident" id="6067401">r</span><span class="op" id="6067402">.</span><span class="ident" id="6067403">URL</span><span class="op" id="6067406">.</span><span class="ident" id="6067407">Path</span><span class="op" id="6067411">,</span>&nbsp;<span class="string" id="6067413">&#34;/debug/pprof/&#34;</span><span class="op" id="6067428">)</span>&nbsp;<span class="op" id="6067430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6067434">name</span>&nbsp;<span class="op" id="6067439">:=</span>&nbsp;<span class="ident" id="6067442">strings</span><span class="op" id="6067449">.</span><span class="ident" id="6067450">TrimPrefix</span><span class="op" id="6067460">(</span><span class="ident" id="6067461">r</span><span class="op" id="6067462">.</span><span class="ident" id="6067463">URL</span><span class="op" id="6067466">.</span><span class="ident" id="6067467">Path</span><span class="op" id="6067471">,</span>&nbsp;<span class="string" id="6067473">&#34;/debug/pprof/&#34;</span><span class="op" id="6067488">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6067492">if</span>&nbsp;<span class="ident" id="6067495">name</span>&nbsp;<span class="op" id="6067500">!=</span>&nbsp;<span class="string" id="6067503">&#34;&#34;</span>&nbsp;<span class="op" id="6067506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6067511">handler</span><span class="op" id="6067518">(</span><span class="ident" id="6067519">name</span><span class="op" id="6067523">)</span><span class="op" id="6067524">.</span><span class="ident" id="6067525">ServeHTTP</span><span class="op" id="6067534">(</span><span class="ident" id="6067535">w</span><span class="op" id="6067536">,</span>&nbsp;<span class="ident" id="6067538">r</span><span class="op" id="6067539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6067544">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6067553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6067556">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6067560">profiles</span>&nbsp;<span class="op" id="6067569">:=</span>&nbsp;<span class="ident" id="6067572">pprof</span><span class="op" id="6067577">.</span><span class="ident" id="6067578">Profiles</span><span class="op" id="6067586">(</span><span class="op" id="6067587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6067590">if</span>&nbsp;<span class="ident" id="6067593">err</span>&nbsp;<span class="op" id="6067597">:=</span>&nbsp;<span class="ident" id="6067600">indexTmpl</span><span class="op" id="6067609">.</span><span class="ident" id="6067610">Execute</span><span class="op" id="6067617">(</span><span class="ident" id="6067618">w</span><span class="op" id="6067619">,</span>&nbsp;<span class="ident" id="6067621">profiles</span><span class="op" id="6067629">)</span><span class="op" id="6067630">;</span>&nbsp;<span class="ident" id="6067632">err</span>&nbsp;<span class="op" id="6067636">!=</span>&nbsp;<span class="builtintype" id="6067639">nil</span>&nbsp;<span class="op" id="6067643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6067647">log</span><span class="op" id="6067650">.</span><span class="ident" id="6067651">Print</span><span class="op" id="6067656">(</span><span class="ident" id="6067657">err</span><span class="op" id="6067660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6067663">}</span><br>
<span class="lineno">190</span><span class="op" id="6067665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6067668">var</span>&nbsp;<span class="ident" id="6067672">indexTmpl</span>&nbsp;<span class="op" id="6067682">=</span>&nbsp;<span class="ident" id="6067684">template</span><span class="op" id="6067692">.</span><span class="ident" id="6067693">Must</span><span class="op" id="6067697">(</span><span class="ident" id="6067698">template</span><span class="op" id="6067706">.</span><span class="ident" id="6067707">New</span><span class="op" id="6067710">(</span><span class="string" id="6067711">&#34;index&#34;</span><span class="op" id="6067718">)</span><span class="op" id="6067719">.</span><span class="ident" id="6067720">Parse</span><span class="op" id="6067725">(</span><span class="string" id="6067726">`&lt;html&gt;<br>
<span class="lineno"></span>&lt;head&gt;<br>
<span class="lineno"></span>&lt;title&gt;/debug/pprof/&lt;/title&gt;<br>
<span class="lineno">195</span>&lt;/head&gt;<br>
<span class="lineno"></span>/debug/pprof/&lt;br&gt;<br>
<span class="lineno"></span>&lt;br&gt;<br>
<span class="lineno"></span>&lt;body&gt;<br>
<span class="lineno"></span>profiles:&lt;br&gt;<br>
<span class="lineno">200</span>&lt;table&gt;<br>
<span class="lineno"></span>{{range&nbsp;.}}<br>
<span class="lineno"></span>&lt;tr&gt;&lt;td&nbsp;align=right&gt;{{.Count}}&lt;td&gt;&lt;a&nbsp;href=&#34;/debug/pprof/{{.Name}}?debug=1&#34;&gt;{{.Name}}&lt;/a&gt;<br>
<span class="lineno"></span>{{end}}<br>
<span class="lineno"></span>&lt;/table&gt;<br>
<span class="lineno">205</span>&lt;br&gt;<br>
<span class="lineno"></span>&lt;a&nbsp;href=&#34;/debug/pprof/goroutine?debug=2&#34;&gt;full&nbsp;goroutine&nbsp;stack&nbsp;dump&lt;/a&gt;&lt;br&gt;<br>
<span class="lineno"></span>&lt;/body&gt;<br>
<span class="lineno"></span>&lt;/html&gt;<br>
<span class="lineno"></span>`</span><span class="op" id="6068045">)</span><span class="op" id="6068046">)</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
