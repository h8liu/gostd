<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/subtle</h2>
<ul>
<li><a href="/gostd/crypto/subtle/constant_time.go.html">constant_time.go</a></li>
<li><a href="/gostd/crypto/subtle/constant_time_test.go.html">constant_time_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8500478">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8500533">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8500587">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8500638">package</span>&nbsp;<span class="ident" id="8500646">subtle</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8500654">import</span>&nbsp;<span class="op" id="8500661">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8500664">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8500675">&#34;testing/quick&#34;</span><br>
<span class="lineno">10</span><span class="op" id="8500691">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8500694">type</span>&nbsp;<span class="ident" id="8500699">TestConstantTimeCompareStruct</span>&nbsp;<span class="keyword" id="8500729">struct</span>&nbsp;<span class="op" id="8500736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8500739">a</span><span class="op" id="8500740">,</span>&nbsp;<span class="ident" id="8500742">b</span>&nbsp;<span class="op" id="8500744">[</span><span class="op" id="8500745">]</span><span class="builtintype" id="8500746">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8500752">out</span>&nbsp;&nbsp;<span class="builtintype" id="8500757">int</span><br>
<span class="lineno">15</span><span class="op" id="8500761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8500764">var</span>&nbsp;<span class="ident" id="8500768">testConstantTimeCompareData</span>&nbsp;<span class="op" id="8500796">=</span>&nbsp;<span class="op" id="8500798">[</span><span class="op" id="8500799">]</span><span class="ident" id="8500800">TestConstantTimeCompareStruct</span><span class="op" id="8500829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8500832">{</span><span class="op" id="8500833">[</span><span class="op" id="8500834">]</span><span class="builtintype" id="8500835">byte</span><span class="op" id="8500839">{</span><span class="op" id="8500840">}</span><span class="op" id="8500841">,</span>&nbsp;<span class="op" id="8500843">[</span><span class="op" id="8500844">]</span><span class="builtintype" id="8500845">byte</span><span class="op" id="8500849">{</span><span class="op" id="8500850">}</span><span class="op" id="8500851">,</span>&nbsp;<span class="num" id="8500853">1</span><span class="op" id="8500854">}</span><span class="op" id="8500855">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8500858">{</span><span class="op" id="8500859">[</span><span class="op" id="8500860">]</span><span class="builtintype" id="8500861">byte</span><span class="op" id="8500865">{</span><span class="num" id="8500866">0x11</span><span class="op" id="8500870">}</span><span class="op" id="8500871">,</span>&nbsp;<span class="op" id="8500873">[</span><span class="op" id="8500874">]</span><span class="builtintype" id="8500875">byte</span><span class="op" id="8500879">{</span><span class="num" id="8500880">0x11</span><span class="op" id="8500884">}</span><span class="op" id="8500885">,</span>&nbsp;<span class="num" id="8500887">1</span><span class="op" id="8500888">}</span><span class="op" id="8500889">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8500892">{</span><span class="op" id="8500893">[</span><span class="op" id="8500894">]</span><span class="builtintype" id="8500895">byte</span><span class="op" id="8500899">{</span><span class="num" id="8500900">0x12</span><span class="op" id="8500904">}</span><span class="op" id="8500905">,</span>&nbsp;<span class="op" id="8500907">[</span><span class="op" id="8500908">]</span><span class="builtintype" id="8500909">byte</span><span class="op" id="8500913">{</span><span class="num" id="8500914">0x11</span><span class="op" id="8500918">}</span><span class="op" id="8500919">,</span>&nbsp;<span class="num" id="8500921">0</span><span class="op" id="8500922">}</span><span class="op" id="8500923">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8500926">{</span><span class="op" id="8500927">[</span><span class="op" id="8500928">]</span><span class="builtintype" id="8500929">byte</span><span class="op" id="8500933">{</span><span class="num" id="8500934">0x11</span><span class="op" id="8500938">}</span><span class="op" id="8500939">,</span>&nbsp;<span class="op" id="8500941">[</span><span class="op" id="8500942">]</span><span class="builtintype" id="8500943">byte</span><span class="op" id="8500947">{</span><span class="num" id="8500948">0x11</span><span class="op" id="8500952">,</span>&nbsp;<span class="num" id="8500954">0x12</span><span class="op" id="8500958">}</span><span class="op" id="8500959">,</span>&nbsp;<span class="num" id="8500961">0</span><span class="op" id="8500962">}</span><span class="op" id="8500963">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8500966">{</span><span class="op" id="8500967">[</span><span class="op" id="8500968">]</span><span class="builtintype" id="8500969">byte</span><span class="op" id="8500973">{</span><span class="num" id="8500974">0x11</span><span class="op" id="8500978">,</span>&nbsp;<span class="num" id="8500980">0x12</span><span class="op" id="8500984">}</span><span class="op" id="8500985">,</span>&nbsp;<span class="op" id="8500987">[</span><span class="op" id="8500988">]</span><span class="builtintype" id="8500989">byte</span><span class="op" id="8500993">{</span><span class="num" id="8500994">0x11</span><span class="op" id="8500998">}</span><span class="op" id="8500999">,</span>&nbsp;<span class="num" id="8501001">0</span><span class="op" id="8501002">}</span><span class="op" id="8501003">,</span><br>
<span class="lineno"></span><span class="op" id="8501005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="8501008">func</span>&nbsp;<span class="ident" id="8501013">TestConstantTimeCompare</span><span class="op" id="8501036">(</span><span class="ident" id="8501037">t</span>&nbsp;<span class="op" id="8501039">*</span><span class="ident" id="8501040">testing</span><span class="op" id="8501047">.</span><span class="ident" id="8501048">T</span><span class="op" id="8501049">)</span>&nbsp;<span class="op" id="8501051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8501054">for</span>&nbsp;<span class="ident" id="8501058">i</span><span class="op" id="8501059">,</span>&nbsp;<span class="ident" id="8501061">test</span>&nbsp;<span class="op" id="8501066">:=</span>&nbsp;<span class="keyword" id="8501069">range</span>&nbsp;<span class="ident" id="8501075">testConstantTimeCompareData</span>&nbsp;<span class="op" id="8501103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8501107">if</span>&nbsp;<span class="ident" id="8501110">r</span>&nbsp;<span class="op" id="8501112">:=</span>&nbsp;<span class="ident" id="8501115">ConstantTimeCompare</span><span class="op" id="8501134">(</span><span class="ident" id="8501135">test</span><span class="op" id="8501139">.</span><span class="ident" id="8501140">a</span><span class="op" id="8501141">,</span>&nbsp;<span class="ident" id="8501143">test</span><span class="op" id="8501147">.</span><span class="ident" id="8501148">b</span><span class="op" id="8501149">)</span><span class="op" id="8501150">;</span>&nbsp;<span class="ident" id="8501152">r</span>&nbsp;<span class="op" id="8501154">!=</span>&nbsp;<span class="ident" id="8501157">test</span><span class="op" id="8501161">.</span><span class="ident" id="8501162">out</span>&nbsp;<span class="op" id="8501166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8501171">t</span><span class="op" id="8501172">.</span><span class="ident" id="8501173">Errorf</span><span class="op" id="8501179">(</span><span class="string" id="8501180">&#34;#%d&nbsp;bad&nbsp;result&nbsp;(got&nbsp;%x,&nbsp;want&nbsp;%x)&#34;</span><span class="op" id="8501214">,</span>&nbsp;<span class="ident" id="8501216">i</span><span class="op" id="8501217">,</span>&nbsp;<span class="ident" id="8501219">r</span><span class="op" id="8501220">,</span>&nbsp;<span class="ident" id="8501222">test</span><span class="op" id="8501226">.</span><span class="ident" id="8501227">out</span><span class="op" id="8501230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8501234">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8501237">}</span><br>
<span class="lineno"></span><span class="op" id="8501239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8501242">type</span>&nbsp;<span class="ident" id="8501247">TestConstantTimeByteEqStruct</span>&nbsp;<span class="keyword" id="8501276">struct</span>&nbsp;<span class="op" id="8501283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8501286">a</span><span class="op" id="8501287">,</span>&nbsp;<span class="ident" id="8501289">b</span>&nbsp;<span class="builtintype" id="8501291">uint8</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8501298">out</span>&nbsp;&nbsp;<span class="builtintype" id="8501303">int</span><br>
<span class="lineno"></span><span class="op" id="8501307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8501310">var</span>&nbsp;<span class="ident" id="8501314">testConstandTimeByteEqData</span>&nbsp;<span class="op" id="8501341">=</span>&nbsp;<span class="op" id="8501343">[</span><span class="op" id="8501344">]</span><span class="ident" id="8501345">TestConstantTimeByteEqStruct</span><span class="op" id="8501373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8501376">{</span><span class="num" id="8501377">0</span><span class="op" id="8501378">,</span>&nbsp;<span class="num" id="8501380">0</span><span class="op" id="8501381">,</span>&nbsp;<span class="num" id="8501383">1</span><span class="op" id="8501384">}</span><span class="op" id="8501385">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8501388">{</span><span class="num" id="8501389">0</span><span class="op" id="8501390">,</span>&nbsp;<span class="num" id="8501392">1</span><span class="op" id="8501393">,</span>&nbsp;<span class="num" id="8501395">0</span><span class="op" id="8501396">}</span><span class="op" id="8501397">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8501400">{</span><span class="num" id="8501401">1</span><span class="op" id="8501402">,</span>&nbsp;<span class="num" id="8501404">0</span><span class="op" id="8501405">,</span>&nbsp;<span class="num" id="8501407">0</span><span class="op" id="8501408">}</span><span class="op" id="8501409">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8501412">{</span><span class="num" id="8501413">0xff</span><span class="op" id="8501417">,</span>&nbsp;<span class="num" id="8501419">0xff</span><span class="op" id="8501423">,</span>&nbsp;<span class="num" id="8501425">1</span><span class="op" id="8501426">}</span><span class="op" id="8501427">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8501430">{</span><span class="num" id="8501431">0xff</span><span class="op" id="8501435">,</span>&nbsp;<span class="num" id="8501437">0xfe</span><span class="op" id="8501441">,</span>&nbsp;<span class="num" id="8501443">0</span><span class="op" id="8501444">}</span><span class="op" id="8501445">,</span><br>
<span class="lineno"></span><span class="op" id="8501447">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="8501450">func</span>&nbsp;<span class="ident" id="8501455">byteEq</span><span class="op" id="8501461">(</span><span class="ident" id="8501462">a</span><span class="op" id="8501463">,</span>&nbsp;<span class="ident" id="8501465">b</span>&nbsp;<span class="builtintype" id="8501467">uint8</span><span class="op" id="8501472">)</span>&nbsp;<span class="builtintype" id="8501474">int</span>&nbsp;<span class="op" id="8501478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8501481">if</span>&nbsp;<span class="ident" id="8501484">a</span>&nbsp;<span class="op" id="8501486">==</span>&nbsp;<span class="ident" id="8501489">b</span>&nbsp;<span class="op" id="8501491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8501495">return</span>&nbsp;<span class="num" id="8501502">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8501505">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8501508">return</span>&nbsp;<span class="num" id="8501515">0</span><br>
<span class="lineno"></span><span class="op" id="8501517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8501520">func</span>&nbsp;<span class="ident" id="8501525">TestConstantTimeByteEq</span><span class="op" id="8501547">(</span><span class="ident" id="8501548">t</span>&nbsp;<span class="op" id="8501550">*</span><span class="ident" id="8501551">testing</span><span class="op" id="8501558">.</span><span class="ident" id="8501559">T</span><span class="op" id="8501560">)</span>&nbsp;<span class="op" id="8501562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8501565">for</span>&nbsp;<span class="ident" id="8501569">i</span><span class="op" id="8501570">,</span>&nbsp;<span class="ident" id="8501572">test</span>&nbsp;<span class="op" id="8501577">:=</span>&nbsp;<span class="keyword" id="8501580">range</span>&nbsp;<span class="ident" id="8501586">testConstandTimeByteEqData</span>&nbsp;<span class="op" id="8501613">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8501617">if</span>&nbsp;<span class="ident" id="8501620">r</span>&nbsp;<span class="op" id="8501622">:=</span>&nbsp;<span class="ident" id="8501625">ConstantTimeByteEq</span><span class="op" id="8501643">(</span><span class="ident" id="8501644">test</span><span class="op" id="8501648">.</span><span class="ident" id="8501649">a</span><span class="op" id="8501650">,</span>&nbsp;<span class="ident" id="8501652">test</span><span class="op" id="8501656">.</span><span class="ident" id="8501657">b</span><span class="op" id="8501658">)</span><span class="op" id="8501659">;</span>&nbsp;<span class="ident" id="8501661">r</span>&nbsp;<span class="op" id="8501663">!=</span>&nbsp;<span class="ident" id="8501666">test</span><span class="op" id="8501670">.</span><span class="ident" id="8501671">out</span>&nbsp;<span class="op" id="8501675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8501680">t</span><span class="op" id="8501681">.</span><span class="ident" id="8501682">Errorf</span><span class="op" id="8501688">(</span><span class="string" id="8501689">&#34;#%d&nbsp;bad&nbsp;result&nbsp;(got&nbsp;%x,&nbsp;want&nbsp;%x)&#34;</span><span class="op" id="8501723">,</span>&nbsp;<span class="ident" id="8501725">i</span><span class="op" id="8501726">,</span>&nbsp;<span class="ident" id="8501728">r</span><span class="op" id="8501729">,</span>&nbsp;<span class="ident" id="8501731">test</span><span class="op" id="8501735">.</span><span class="ident" id="8501736">out</span><span class="op" id="8501739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8501743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8501746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8501749">err</span>&nbsp;<span class="op" id="8501753">:=</span>&nbsp;<span class="ident" id="8501756">quick</span><span class="op" id="8501761">.</span><span class="ident" id="8501762">CheckEqual</span><span class="op" id="8501772">(</span><span class="ident" id="8501773">ConstantTimeByteEq</span><span class="op" id="8501791">,</span>&nbsp;<span class="ident" id="8501793">byteEq</span><span class="op" id="8501799">,</span>&nbsp;<span class="ident" id="8501801">nil</span><span class="op" id="8501804">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8501807">if</span>&nbsp;<span class="ident" id="8501810">err</span>&nbsp;<span class="op" id="8501814">!=</span>&nbsp;<span class="ident" id="8501817">nil</span>&nbsp;<span class="op" id="8501821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8501825">t</span><span class="op" id="8501826">.</span><span class="ident" id="8501827">Error</span><span class="op" id="8501832">(</span><span class="ident" id="8501833">err</span><span class="op" id="8501836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8501839">}</span><br>
<span class="lineno"></span><span class="op" id="8501841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="8501844">func</span>&nbsp;<span class="ident" id="8501849">eq</span><span class="op" id="8501851">(</span><span class="ident" id="8501852">a</span><span class="op" id="8501853">,</span>&nbsp;<span class="ident" id="8501855">b</span>&nbsp;<span class="builtintype" id="8501857">int32</span><span class="op" id="8501862">)</span>&nbsp;<span class="builtintype" id="8501864">int</span>&nbsp;<span class="op" id="8501868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8501871">if</span>&nbsp;<span class="ident" id="8501874">a</span>&nbsp;<span class="op" id="8501876">==</span>&nbsp;<span class="ident" id="8501879">b</span>&nbsp;<span class="op" id="8501881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8501885">return</span>&nbsp;<span class="num" id="8501892">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8501895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8501898">return</span>&nbsp;<span class="num" id="8501905">0</span><br>
<span class="lineno">70</span><span class="op" id="8501907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8501910">func</span>&nbsp;<span class="ident" id="8501915">TestConstantTimeEq</span><span class="op" id="8501933">(</span><span class="ident" id="8501934">t</span>&nbsp;<span class="op" id="8501936">*</span><span class="ident" id="8501937">testing</span><span class="op" id="8501944">.</span><span class="ident" id="8501945">T</span><span class="op" id="8501946">)</span>&nbsp;<span class="op" id="8501948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8501951">err</span>&nbsp;<span class="op" id="8501955">:=</span>&nbsp;<span class="ident" id="8501958">quick</span><span class="op" id="8501963">.</span><span class="ident" id="8501964">CheckEqual</span><span class="op" id="8501974">(</span><span class="ident" id="8501975">ConstantTimeEq</span><span class="op" id="8501989">,</span>&nbsp;<span class="ident" id="8501991">eq</span><span class="op" id="8501993">,</span>&nbsp;<span class="ident" id="8501995">nil</span><span class="op" id="8501998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8502001">if</span>&nbsp;<span class="ident" id="8502004">err</span>&nbsp;<span class="op" id="8502008">!=</span>&nbsp;<span class="ident" id="8502011">nil</span>&nbsp;<span class="op" id="8502015">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8502019">t</span><span class="op" id="8502020">.</span><span class="ident" id="8502021">Error</span><span class="op" id="8502026">(</span><span class="ident" id="8502027">err</span><span class="op" id="8502030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8502033">}</span><br>
<span class="lineno"></span><span class="op" id="8502035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8502038">func</span>&nbsp;<span class="ident" id="8502043">makeCopy</span><span class="op" id="8502051">(</span><span class="ident" id="8502052">v</span>&nbsp;<span class="builtintype" id="8502054">int</span><span class="op" id="8502057">,</span>&nbsp;<span class="ident" id="8502059">x</span><span class="op" id="8502060">,</span>&nbsp;<span class="ident" id="8502062">y</span>&nbsp;<span class="op" id="8502064">[</span><span class="op" id="8502065">]</span><span class="builtintype" id="8502066">byte</span><span class="op" id="8502070">)</span>&nbsp;<span class="op" id="8502072">[</span><span class="op" id="8502073">]</span><span class="builtintype" id="8502074">byte</span>&nbsp;<span class="op" id="8502079">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8502082">if</span>&nbsp;<span class="builtinfunc" id="8502085">len</span><span class="op" id="8502088">(</span><span class="ident" id="8502089">x</span><span class="op" id="8502090">)</span>&nbsp;<span class="op" id="8502092">&gt;</span>&nbsp;<span class="builtinfunc" id="8502094">len</span><span class="op" id="8502097">(</span><span class="ident" id="8502098">y</span><span class="op" id="8502099">)</span>&nbsp;<span class="op" id="8502101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8502105">x</span>&nbsp;<span class="op" id="8502107">=</span>&nbsp;<span class="ident" id="8502109">x</span><span class="op" id="8502110">[</span><span class="num" id="8502111">0</span><span class="op" id="8502112">:</span><span class="builtinfunc" id="8502113">len</span><span class="op" id="8502116">(</span><span class="ident" id="8502117">y</span><span class="op" id="8502118">)</span><span class="op" id="8502119">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8502122">}</span>&nbsp;<span class="keyword" id="8502124">else</span>&nbsp;<span class="op" id="8502129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8502133">y</span>&nbsp;<span class="op" id="8502135">=</span>&nbsp;<span class="ident" id="8502137">y</span><span class="op" id="8502138">[</span><span class="num" id="8502139">0</span><span class="op" id="8502140">:</span><span class="builtinfunc" id="8502141">len</span><span class="op" id="8502144">(</span><span class="ident" id="8502145">x</span><span class="op" id="8502146">)</span><span class="op" id="8502147">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8502150">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8502153">if</span>&nbsp;<span class="ident" id="8502156">v</span>&nbsp;<span class="op" id="8502158">==</span>&nbsp;<span class="num" id="8502161">1</span>&nbsp;<span class="op" id="8502163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8502167">copy</span><span class="op" id="8502171">(</span><span class="ident" id="8502172">x</span><span class="op" id="8502173">,</span>&nbsp;<span class="ident" id="8502175">y</span><span class="op" id="8502176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8502179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8502182">return</span>&nbsp;<span class="ident" id="8502189">x</span><br>
<span class="lineno"></span><span class="op" id="8502191">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="8502194">func</span>&nbsp;<span class="ident" id="8502199">constantTimeCopyWrapper</span><span class="op" id="8502222">(</span><span class="ident" id="8502223">v</span>&nbsp;<span class="builtintype" id="8502225">int</span><span class="op" id="8502228">,</span>&nbsp;<span class="ident" id="8502230">x</span><span class="op" id="8502231">,</span>&nbsp;<span class="ident" id="8502233">y</span>&nbsp;<span class="op" id="8502235">[</span><span class="op" id="8502236">]</span><span class="builtintype" id="8502237">byte</span><span class="op" id="8502241">)</span>&nbsp;<span class="op" id="8502243">[</span><span class="op" id="8502244">]</span><span class="builtintype" id="8502245">byte</span>&nbsp;<span class="op" id="8502250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8502253">if</span>&nbsp;<span class="builtinfunc" id="8502256">len</span><span class="op" id="8502259">(</span><span class="ident" id="8502260">x</span><span class="op" id="8502261">)</span>&nbsp;<span class="op" id="8502263">&gt;</span>&nbsp;<span class="builtinfunc" id="8502265">len</span><span class="op" id="8502268">(</span><span class="ident" id="8502269">y</span><span class="op" id="8502270">)</span>&nbsp;<span class="op" id="8502272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8502276">x</span>&nbsp;<span class="op" id="8502278">=</span>&nbsp;<span class="ident" id="8502280">x</span><span class="op" id="8502281">[</span><span class="num" id="8502282">0</span><span class="op" id="8502283">:</span><span class="builtinfunc" id="8502284">len</span><span class="op" id="8502287">(</span><span class="ident" id="8502288">y</span><span class="op" id="8502289">)</span><span class="op" id="8502290">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8502293">}</span>&nbsp;<span class="keyword" id="8502295">else</span>&nbsp;<span class="op" id="8502300">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8502304">y</span>&nbsp;<span class="op" id="8502306">=</span>&nbsp;<span class="ident" id="8502308">y</span><span class="op" id="8502309">[</span><span class="num" id="8502310">0</span><span class="op" id="8502311">:</span><span class="builtinfunc" id="8502312">len</span><span class="op" id="8502315">(</span><span class="ident" id="8502316">x</span><span class="op" id="8502317">)</span><span class="op" id="8502318">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8502321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8502324">v</span>&nbsp;<span class="op" id="8502326">&amp;=</span>&nbsp;<span class="num" id="8502329">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8502332">ConstantTimeCopy</span><span class="op" id="8502348">(</span><span class="ident" id="8502349">v</span><span class="op" id="8502350">,</span>&nbsp;<span class="ident" id="8502352">x</span><span class="op" id="8502353">,</span>&nbsp;<span class="ident" id="8502355">y</span><span class="op" id="8502356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8502359">return</span>&nbsp;<span class="ident" id="8502366">x</span><br>
<span class="lineno">100</span><span class="op" id="8502368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8502371">func</span>&nbsp;<span class="ident" id="8502376">TestConstantTimeCopy</span><span class="op" id="8502396">(</span><span class="ident" id="8502397">t</span>&nbsp;<span class="op" id="8502399">*</span><span class="ident" id="8502400">testing</span><span class="op" id="8502407">.</span><span class="ident" id="8502408">T</span><span class="op" id="8502409">)</span>&nbsp;<span class="op" id="8502411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8502414">err</span>&nbsp;<span class="op" id="8502418">:=</span>&nbsp;<span class="ident" id="8502421">quick</span><span class="op" id="8502426">.</span><span class="ident" id="8502427">CheckEqual</span><span class="op" id="8502437">(</span><span class="ident" id="8502438">constantTimeCopyWrapper</span><span class="op" id="8502461">,</span>&nbsp;<span class="ident" id="8502463">makeCopy</span><span class="op" id="8502471">,</span>&nbsp;<span class="ident" id="8502473">nil</span><span class="op" id="8502476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8502479">if</span>&nbsp;<span class="ident" id="8502482">err</span>&nbsp;<span class="op" id="8502486">!=</span>&nbsp;<span class="ident" id="8502489">nil</span>&nbsp;<span class="op" id="8502493">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8502497">t</span><span class="op" id="8502498">.</span><span class="ident" id="8502499">Error</span><span class="op" id="8502504">(</span><span class="ident" id="8502505">err</span><span class="op" id="8502508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8502511">}</span><br>
<span class="lineno"></span><span class="op" id="8502513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8502516">var</span>&nbsp;<span class="ident" id="8502520">lessOrEqTests</span>&nbsp;<span class="op" id="8502534">=</span>&nbsp;<span class="op" id="8502536">[</span><span class="op" id="8502537">]</span><span class="keyword" id="8502538">struct</span>&nbsp;<span class="op" id="8502545">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8502548">x</span><span class="op" id="8502549">,</span>&nbsp;<span class="ident" id="8502551">y</span><span class="op" id="8502552">,</span>&nbsp;<span class="ident" id="8502554">result</span>&nbsp;<span class="builtintype" id="8502561">int</span><br>
<span class="lineno"></span><span class="op" id="8502565">}</span><span class="op" id="8502566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8502569">{</span><span class="num" id="8502570">0</span><span class="op" id="8502571">,</span>&nbsp;<span class="num" id="8502573">0</span><span class="op" id="8502574">,</span>&nbsp;<span class="num" id="8502576">1</span><span class="op" id="8502577">}</span><span class="op" id="8502578">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8502581">{</span><span class="num" id="8502582">1</span><span class="op" id="8502583">,</span>&nbsp;<span class="num" id="8502585">0</span><span class="op" id="8502586">,</span>&nbsp;<span class="num" id="8502588">0</span><span class="op" id="8502589">}</span><span class="op" id="8502590">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8502593">{</span><span class="num" id="8502594">0</span><span class="op" id="8502595">,</span>&nbsp;<span class="num" id="8502597">1</span><span class="op" id="8502598">,</span>&nbsp;<span class="num" id="8502600">1</span><span class="op" id="8502601">}</span><span class="op" id="8502602">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8502605">{</span><span class="num" id="8502606">10</span><span class="op" id="8502608">,</span>&nbsp;<span class="num" id="8502610">20</span><span class="op" id="8502612">,</span>&nbsp;<span class="num" id="8502614">1</span><span class="op" id="8502615">}</span><span class="op" id="8502616">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8502619">{</span><span class="num" id="8502620">20</span><span class="op" id="8502622">,</span>&nbsp;<span class="num" id="8502624">10</span><span class="op" id="8502626">,</span>&nbsp;<span class="num" id="8502628">0</span><span class="op" id="8502629">}</span><span class="op" id="8502630">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8502633">{</span><span class="num" id="8502634">10</span><span class="op" id="8502636">,</span>&nbsp;<span class="num" id="8502638">10</span><span class="op" id="8502640">,</span>&nbsp;<span class="num" id="8502642">1</span><span class="op" id="8502643">}</span><span class="op" id="8502644">,</span><br>
<span class="lineno"></span><span class="op" id="8502646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="8502649">func</span>&nbsp;<span class="ident" id="8502654">TestConstantTimeLessOrEq</span><span class="op" id="8502678">(</span><span class="ident" id="8502679">t</span>&nbsp;<span class="op" id="8502681">*</span><span class="ident" id="8502682">testing</span><span class="op" id="8502689">.</span><span class="ident" id="8502690">T</span><span class="op" id="8502691">)</span>&nbsp;<span class="op" id="8502693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8502696">for</span>&nbsp;<span class="ident" id="8502700">i</span><span class="op" id="8502701">,</span>&nbsp;<span class="ident" id="8502703">test</span>&nbsp;<span class="op" id="8502708">:=</span>&nbsp;<span class="keyword" id="8502711">range</span>&nbsp;<span class="ident" id="8502717">lessOrEqTests</span>&nbsp;<span class="op" id="8502731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8502735">result</span>&nbsp;<span class="op" id="8502742">:=</span>&nbsp;<span class="ident" id="8502745">ConstantTimeLessOrEq</span><span class="op" id="8502765">(</span><span class="ident" id="8502766">test</span><span class="op" id="8502770">.</span><span class="ident" id="8502771">x</span><span class="op" id="8502772">,</span>&nbsp;<span class="ident" id="8502774">test</span><span class="op" id="8502778">.</span><span class="ident" id="8502779">y</span><span class="op" id="8502780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8502784">if</span>&nbsp;<span class="ident" id="8502787">result</span>&nbsp;<span class="op" id="8502794">!=</span>&nbsp;<span class="ident" id="8502797">test</span><span class="op" id="8502801">.</span><span class="ident" id="8502802">result</span>&nbsp;<span class="op" id="8502809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8502814">t</span><span class="op" id="8502815">.</span><span class="ident" id="8502816">Errorf</span><span class="op" id="8502822">(</span><span class="string" id="8502823">&#34;#%d:&nbsp;%d&nbsp;&lt;=&nbsp;%d&nbsp;gave&nbsp;%d,&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8502859">,</span>&nbsp;<span class="ident" id="8502861">i</span><span class="op" id="8502862">,</span>&nbsp;<span class="ident" id="8502864">test</span><span class="op" id="8502868">.</span><span class="ident" id="8502869">x</span><span class="op" id="8502870">,</span>&nbsp;<span class="ident" id="8502872">test</span><span class="op" id="8502876">.</span><span class="ident" id="8502877">y</span><span class="op" id="8502878">,</span>&nbsp;<span class="ident" id="8502880">result</span><span class="op" id="8502886">,</span>&nbsp;<span class="ident" id="8502888">test</span><span class="op" id="8502892">.</span><span class="ident" id="8502893">result</span><span class="op" id="8502899">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8502903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8502906">}</span><br>
<span class="lineno"></span><span class="op" id="8502908">}</span>
</div>
</body>
</html>
