<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1684358">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1684413">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1684467">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1684518">package</span>&nbsp;<span class="ident" id="1684526">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1684535">import</span>&nbsp;<span class="string" id="1684542">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1684552">//&nbsp;The&nbsp;code&nbsp;in&nbsp;this&nbsp;file&nbsp;implements&nbsp;stack&nbsp;trace&nbsp;walking&nbsp;for&nbsp;all&nbsp;architectures.</span><br>
<span class="lineno">10</span><span class="comment" id="1684631">//&nbsp;The&nbsp;most&nbsp;important&nbsp;fact&nbsp;about&nbsp;a&nbsp;given&nbsp;architecture&nbsp;is&nbsp;whether&nbsp;it&nbsp;uses&nbsp;a&nbsp;link&nbsp;register.</span><br>
<span class="lineno"></span><span class="comment" id="1684721">//&nbsp;On&nbsp;systems&nbsp;with&nbsp;link&nbsp;registers,&nbsp;the&nbsp;prologue&nbsp;for&nbsp;a&nbsp;non-leaf&nbsp;function&nbsp;stores&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1684804">//&nbsp;incoming&nbsp;value&nbsp;of&nbsp;LR&nbsp;at&nbsp;the&nbsp;bottom&nbsp;of&nbsp;the&nbsp;newly&nbsp;allocated&nbsp;stack&nbsp;frame.</span><br>
<span class="lineno"></span><span class="comment" id="1684878">//&nbsp;On&nbsp;systems&nbsp;without&nbsp;link&nbsp;registers,&nbsp;the&nbsp;architecture&nbsp;pushes&nbsp;a&nbsp;return&nbsp;PC&nbsp;during</span><br>
<span class="lineno"></span><span class="comment" id="1684959">//&nbsp;the&nbsp;call&nbsp;instruction,&nbsp;so&nbsp;the&nbsp;return&nbsp;PC&nbsp;ends&nbsp;up&nbsp;above&nbsp;the&nbsp;stack&nbsp;frame.</span><br>
<span class="lineno">15</span><span class="comment" id="1685032">//&nbsp;In&nbsp;this&nbsp;file,&nbsp;the&nbsp;return&nbsp;PC&nbsp;is&nbsp;always&nbsp;called&nbsp;LR,&nbsp;no&nbsp;matter&nbsp;how&nbsp;it&nbsp;was&nbsp;found.</span><br>
<span class="lineno"></span><span class="comment" id="1685112">//</span><br>
<span class="lineno"></span><span class="comment" id="1685115">//&nbsp;To&nbsp;date,&nbsp;the&nbsp;opposite&nbsp;of&nbsp;a&nbsp;link&nbsp;register&nbsp;architecture&nbsp;is&nbsp;an&nbsp;x86&nbsp;architecture.</span><br>
<span class="lineno"></span><span class="comment" id="1685196">//&nbsp;This&nbsp;code&nbsp;may&nbsp;need&nbsp;to&nbsp;change&nbsp;if&nbsp;some&nbsp;other&nbsp;kind&nbsp;of&nbsp;non-link-register</span><br>
<span class="lineno"></span><span class="comment" id="1685268">//&nbsp;architecture&nbsp;comes&nbsp;along.</span><br>
<span class="lineno">20</span><span class="comment" id="1685297">//</span><br>
<span class="lineno"></span><span class="comment" id="1685300">//&nbsp;The&nbsp;other&nbsp;important&nbsp;fact&nbsp;is&nbsp;the&nbsp;size&nbsp;of&nbsp;a&nbsp;pointer:&nbsp;on&nbsp;32-bit&nbsp;systems&nbsp;the&nbsp;LR</span><br>
<span class="lineno"></span><span class="comment" id="1685379">//&nbsp;takes&nbsp;up&nbsp;only&nbsp;4&nbsp;bytes&nbsp;on&nbsp;the&nbsp;stack,&nbsp;while&nbsp;on&nbsp;64-bit&nbsp;systems&nbsp;it&nbsp;takes&nbsp;up&nbsp;8&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="1685463">//&nbsp;Typically&nbsp;this&nbsp;is&nbsp;ptrSize.</span><br>
<span class="lineno"></span><span class="comment" id="1685493">//</span><br>
<span class="lineno">25</span><span class="comment" id="1685496">//&nbsp;As&nbsp;an&nbsp;exception,&nbsp;amd64p32&nbsp;has&nbsp;ptrSize&nbsp;==&nbsp;4&nbsp;but&nbsp;the&nbsp;CALL&nbsp;instruction&nbsp;still</span><br>
<span class="lineno"></span><span class="comment" id="1685573">//&nbsp;stores&nbsp;an&nbsp;8-byte&nbsp;return&nbsp;PC&nbsp;onto&nbsp;the&nbsp;stack.&nbsp;To&nbsp;accommodate&nbsp;this,&nbsp;we&nbsp;use&nbsp;regSize</span><br>
<span class="lineno"></span><span class="comment" id="1685655">//&nbsp;as&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;architecture-pushed&nbsp;return&nbsp;PC.</span><br>
<span class="lineno"></span><span class="comment" id="1685708">//</span><br>
<span class="lineno"></span><span class="comment" id="1685711">//&nbsp;usesLR&nbsp;is&nbsp;defined&nbsp;below.&nbsp;ptrSize&nbsp;and&nbsp;regSize&nbsp;are&nbsp;defined&nbsp;in&nbsp;stubs.go.</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="1685785">const</span>&nbsp;<span class="ident" id="1685791">usesLR</span>&nbsp;<span class="op" id="1685798">=</span>&nbsp;<span class="ident" id="1685800">GOARCH</span>&nbsp;<span class="op" id="1685807">!=</span>&nbsp;<span class="string" id="1685810">&#34;amd64&#34;</span>&nbsp;<span class="op" id="1685818">&amp;&amp;</span>&nbsp;<span class="ident" id="1685821">GOARCH</span>&nbsp;<span class="op" id="1685828">!=</span>&nbsp;<span class="string" id="1685831">&#34;amd64p32&#34;</span>&nbsp;<span class="op" id="1685842">&amp;&amp;</span>&nbsp;<span class="ident" id="1685845">GOARCH</span>&nbsp;<span class="op" id="1685852">!=</span>&nbsp;<span class="string" id="1685855">&#34;386&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1685862">var</span>&nbsp;<span class="op" id="1685866">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1685869">//&nbsp;initialized&nbsp;in&nbsp;tracebackinit</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1685902">deferprocPC</span>&nbsp;<span class="builtintype" id="1685914">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1685923">goexitPC</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1685935">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1685944">jmpdeferPC</span>&nbsp;&nbsp;<span class="builtintype" id="1685956">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1685965">mcallPC</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1685977">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1685986">morestackPC</span>&nbsp;<span class="builtintype" id="1685998">uintptr</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1686007">mstartPC</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1686019">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1686028">newprocPC</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1686040">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1686049">rt0_goPC</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1686061">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1686070">sigpanicPC</span>&nbsp;&nbsp;<span class="builtintype" id="1686082">uintptr</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1686092">externalthreadhandlerp</span>&nbsp;<span class="builtintype" id="1686115">uintptr</span>&nbsp;<span class="comment" id="1686123">//&nbsp;initialized&nbsp;elsewhere</span><br>
<span class="lineno"></span><span class="op" id="1686148">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1686151">func</span>&nbsp;<span class="ident" id="1686156">tracebackinit</span><span class="op" id="1686169">(</span><span class="op" id="1686170">)</span>&nbsp;<span class="op" id="1686172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1686175">//&nbsp;Go&nbsp;variable&nbsp;initialization&nbsp;happens&nbsp;late&nbsp;during&nbsp;runtime&nbsp;startup.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1686243">//&nbsp;Instead&nbsp;of&nbsp;initializing&nbsp;the&nbsp;variables&nbsp;above&nbsp;in&nbsp;the&nbsp;declarations,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1686312">//&nbsp;schedinit&nbsp;calls&nbsp;this&nbsp;function&nbsp;so&nbsp;that&nbsp;the&nbsp;variables&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1686372">//&nbsp;initialized&nbsp;and&nbsp;available&nbsp;earlier&nbsp;in&nbsp;the&nbsp;startup&nbsp;sequence.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1686435">deferprocPC</span>&nbsp;<span class="op" id="1686447">=</span>&nbsp;<span class="ident" id="1686449">funcPC</span><span class="op" id="1686455">(</span><span class="ident" id="1686456">deferproc</span><span class="op" id="1686465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1686468">goexitPC</span>&nbsp;<span class="op" id="1686477">=</span>&nbsp;<span class="ident" id="1686479">funcPC</span><span class="op" id="1686485">(</span><span class="ident" id="1686486">goexit</span><span class="op" id="1686492">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1686495">jmpdeferPC</span>&nbsp;<span class="op" id="1686506">=</span>&nbsp;<span class="ident" id="1686508">funcPC</span><span class="op" id="1686514">(</span><span class="ident" id="1686515">jmpdefer</span><span class="op" id="1686523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1686526">mcallPC</span>&nbsp;<span class="op" id="1686534">=</span>&nbsp;<span class="ident" id="1686536">funcPC</span><span class="op" id="1686542">(</span><span class="ident" id="1686543">mcall</span><span class="op" id="1686548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1686551">morestackPC</span>&nbsp;<span class="op" id="1686563">=</span>&nbsp;<span class="ident" id="1686565">funcPC</span><span class="op" id="1686571">(</span><span class="ident" id="1686572">morestack</span><span class="op" id="1686581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1686584">mstartPC</span>&nbsp;<span class="op" id="1686593">=</span>&nbsp;<span class="ident" id="1686595">funcPC</span><span class="op" id="1686601">(</span><span class="ident" id="1686602">mstart</span><span class="op" id="1686608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1686611">newprocPC</span>&nbsp;<span class="op" id="1686621">=</span>&nbsp;<span class="ident" id="1686623">funcPC</span><span class="op" id="1686629">(</span><span class="ident" id="1686630">newproc</span><span class="op" id="1686637">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1686640">rt0_goPC</span>&nbsp;<span class="op" id="1686649">=</span>&nbsp;<span class="ident" id="1686651">funcPC</span><span class="op" id="1686657">(</span><span class="ident" id="1686658">rt0_go</span><span class="op" id="1686664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1686667">sigpanicPC</span>&nbsp;<span class="op" id="1686678">=</span>&nbsp;<span class="ident" id="1686680">funcPC</span><span class="op" id="1686686">(</span><span class="ident" id="1686687">sigpanic</span><span class="op" id="1686695">)</span><br>
<span class="lineno"></span><span class="op" id="1686697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1686700">//&nbsp;Traceback&nbsp;over&nbsp;the&nbsp;deferred&nbsp;function&nbsp;calls.</span><br>
<span class="lineno">65</span><span class="comment" id="1686747">//&nbsp;Report&nbsp;them&nbsp;like&nbsp;calls&nbsp;that&nbsp;have&nbsp;been&nbsp;invoked&nbsp;but&nbsp;not&nbsp;started&nbsp;executing&nbsp;yet.</span><br>
<span class="lineno"></span><span class="keyword" id="1686827">func</span>&nbsp;<span class="ident" id="1686832">tracebackdefers</span><span class="op" id="1686847">(</span><span class="ident" id="1686848">gp</span>&nbsp;<span class="op" id="1686851">*</span><span class="ident" id="1686852">g</span><span class="op" id="1686853">,</span>&nbsp;<span class="ident" id="1686855">callback</span>&nbsp;<span class="keyword" id="1686864">func</span><span class="op" id="1686868">(</span><span class="op" id="1686869">*</span><span class="ident" id="1686870">stkframe</span><span class="op" id="1686878">,</span>&nbsp;<span class="ident" id="1686880">unsafe</span><span class="op" id="1686886">.</span><span class="ident" id="1686887">Pointer</span><span class="op" id="1686894">)</span>&nbsp;<span class="builtintype" id="1686896">bool</span><span class="op" id="1686900">,</span>&nbsp;<span class="ident" id="1686902">v</span>&nbsp;<span class="ident" id="1686904">unsafe</span><span class="op" id="1686910">.</span><span class="ident" id="1686911">Pointer</span><span class="op" id="1686918">)</span>&nbsp;<span class="op" id="1686920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1686923">var</span>&nbsp;<span class="ident" id="1686927">frame</span>&nbsp;<span class="ident" id="1686933">stkframe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1686943">for</span>&nbsp;<span class="ident" id="1686947">d</span>&nbsp;<span class="op" id="1686949">:=</span>&nbsp;<span class="ident" id="1686952">gp</span><span class="op" id="1686954">.</span><span class="ident" id="1686955">_defer</span><span class="op" id="1686961">;</span>&nbsp;<span class="ident" id="1686963">d</span>&nbsp;<span class="op" id="1686965">!=</span>&nbsp;<span class="ident" id="1686968">nil</span><span class="op" id="1686971">;</span>&nbsp;<span class="ident" id="1686973">d</span>&nbsp;<span class="op" id="1686975">=</span>&nbsp;<span class="ident" id="1686977">d</span><span class="op" id="1686978">.</span><span class="ident" id="1686979">link</span>&nbsp;<span class="op" id="1686984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1686988">fn</span>&nbsp;<span class="op" id="1686991">:=</span>&nbsp;<span class="ident" id="1686994">d</span><span class="op" id="1686995">.</span><span class="ident" id="1686996">fn</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1687001">if</span>&nbsp;<span class="ident" id="1687004">fn</span>&nbsp;<span class="op" id="1687007">==</span>&nbsp;<span class="ident" id="1687010">nil</span>&nbsp;<span class="op" id="1687014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1687019">//&nbsp;Defer&nbsp;of&nbsp;nil&nbsp;function.&nbsp;Args&nbsp;don&#39;t&nbsp;matter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1687067">frame</span><span class="op" id="1687072">.</span><span class="ident" id="1687073">pc</span>&nbsp;<span class="op" id="1687076">=</span>&nbsp;<span class="num" id="1687078">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1687083">frame</span><span class="op" id="1687088">.</span><span class="ident" id="1687089">fn</span>&nbsp;<span class="op" id="1687092">=</span>&nbsp;<span class="ident" id="1687094">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1687101">frame</span><span class="op" id="1687106">.</span><span class="ident" id="1687107">argp</span>&nbsp;<span class="op" id="1687112">=</span>&nbsp;<span class="num" id="1687114">0</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1687119">frame</span><span class="op" id="1687124">.</span><span class="ident" id="1687125">arglen</span>&nbsp;<span class="op" id="1687132">=</span>&nbsp;<span class="num" id="1687134">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1687139">frame</span><span class="op" id="1687144">.</span><span class="ident" id="1687145">argmap</span>&nbsp;<span class="op" id="1687152">=</span>&nbsp;<span class="ident" id="1687154">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1687160">}</span>&nbsp;<span class="keyword" id="1687162">else</span>&nbsp;<span class="op" id="1687167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1687172">frame</span><span class="op" id="1687177">.</span><span class="ident" id="1687178">pc</span>&nbsp;<span class="op" id="1687181">=</span>&nbsp;<span class="builtintype" id="1687183">uintptr</span><span class="op" id="1687190">(</span><span class="ident" id="1687191">fn</span><span class="op" id="1687193">.</span><span class="ident" id="1687194">fn</span><span class="op" id="1687196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1687201">f</span>&nbsp;<span class="op" id="1687203">:=</span>&nbsp;<span class="ident" id="1687206">findfunc</span><span class="op" id="1687214">(</span><span class="ident" id="1687215">frame</span><span class="op" id="1687220">.</span><span class="ident" id="1687221">pc</span><span class="op" id="1687223">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1687228">if</span>&nbsp;<span class="ident" id="1687231">f</span>&nbsp;<span class="op" id="1687233">==</span>&nbsp;<span class="ident" id="1687236">nil</span>&nbsp;<span class="op" id="1687240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1687246">print</span><span class="op" id="1687251">(</span><span class="string" id="1687252">&#34;runtime:&nbsp;unknown&nbsp;pc&nbsp;in&nbsp;defer&nbsp;&#34;</span><span class="op" id="1687283">,</span>&nbsp;<span class="ident" id="1687285">hex</span><span class="op" id="1687288">(</span><span class="ident" id="1687289">frame</span><span class="op" id="1687294">.</span><span class="ident" id="1687295">pc</span><span class="op" id="1687297">)</span><span class="op" id="1687298">,</span>&nbsp;<span class="string" id="1687300">&#34;\n&#34;</span><span class="op" id="1687304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1687310">gothrow</span><span class="op" id="1687317">(</span><span class="string" id="1687318">&#34;unknown&nbsp;pc&#34;</span><span class="op" id="1687330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1687335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1687340">frame</span><span class="op" id="1687345">.</span><span class="ident" id="1687346">fn</span>&nbsp;<span class="op" id="1687349">=</span>&nbsp;<span class="ident" id="1687351">f</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1687356">frame</span><span class="op" id="1687361">.</span><span class="ident" id="1687362">argp</span>&nbsp;<span class="op" id="1687367">=</span>&nbsp;<span class="builtintype" id="1687369">uintptr</span><span class="op" id="1687376">(</span><span class="ident" id="1687377">deferArgs</span><span class="op" id="1687386">(</span><span class="ident" id="1687387">d</span><span class="op" id="1687388">)</span><span class="op" id="1687389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1687394">setArgInfo</span><span class="op" id="1687404">(</span><span class="op" id="1687405">&amp;</span><span class="ident" id="1687406">frame</span><span class="op" id="1687411">,</span>&nbsp;<span class="ident" id="1687413">f</span><span class="op" id="1687414">,</span>&nbsp;<span class="builtintype" id="1687416">true</span><span class="op" id="1687420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1687424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1687428">frame</span><span class="op" id="1687433">.</span><span class="ident" id="1687434">continpc</span>&nbsp;<span class="op" id="1687443">=</span>&nbsp;<span class="ident" id="1687445">frame</span><span class="op" id="1687450">.</span><span class="ident" id="1687451">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1687456">if</span>&nbsp;<span class="op" id="1687459">!</span><span class="ident" id="1687460">callback</span><span class="op" id="1687468">(</span><span class="op" id="1687469">(</span><span class="op" id="1687470">*</span><span class="ident" id="1687471">stkframe</span><span class="op" id="1687479">)</span><span class="op" id="1687480">(</span><span class="ident" id="1687481">noescape</span><span class="op" id="1687489">(</span><span class="ident" id="1687490">unsafe</span><span class="op" id="1687496">.</span><span class="ident" id="1687497">Pointer</span><span class="op" id="1687504">(</span><span class="op" id="1687505">&amp;</span><span class="ident" id="1687506">frame</span><span class="op" id="1687511">)</span><span class="op" id="1687512">)</span><span class="op" id="1687513">)</span><span class="op" id="1687514">,</span>&nbsp;<span class="ident" id="1687516">v</span><span class="op" id="1687517">)</span>&nbsp;<span class="op" id="1687519">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1687524">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1687533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1687536">}</span><br>
<span class="lineno"></span><span class="op" id="1687538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="1687541">//&nbsp;Generic&nbsp;traceback.&nbsp;&nbsp;Handles&nbsp;runtime&nbsp;stack&nbsp;prints&nbsp;(pcbuf&nbsp;==&nbsp;nil),</span><br>
<span class="lineno"></span><span class="comment" id="1687609">//&nbsp;the&nbsp;runtime.Callers&nbsp;function&nbsp;(pcbuf&nbsp;!=&nbsp;nil),&nbsp;as&nbsp;well&nbsp;as&nbsp;the&nbsp;garbage</span><br>
<span class="lineno"></span><span class="comment" id="1687680">//&nbsp;collector&nbsp;(callback&nbsp;!=&nbsp;nil).&nbsp;&nbsp;A&nbsp;little&nbsp;clunky&nbsp;to&nbsp;merge&nbsp;these,&nbsp;but&nbsp;avoids</span><br>
<span class="lineno"></span><span class="comment" id="1687756">//&nbsp;duplicating&nbsp;the&nbsp;code&nbsp;and&nbsp;all&nbsp;its&nbsp;subtlety.</span><br>
<span class="lineno"></span><span class="keyword" id="1687802">func</span>&nbsp;<span class="ident" id="1687807">gentraceback</span><span class="op" id="1687819">(</span><span class="ident" id="1687820">pc0</span>&nbsp;<span class="builtintype" id="1687824">uintptr</span><span class="op" id="1687831">,</span>&nbsp;<span class="ident" id="1687833">sp0</span>&nbsp;<span class="builtintype" id="1687837">uintptr</span><span class="op" id="1687844">,</span>&nbsp;<span class="ident" id="1687846">lr0</span>&nbsp;<span class="builtintype" id="1687850">uintptr</span><span class="op" id="1687857">,</span>&nbsp;<span class="ident" id="1687859">gp</span>&nbsp;<span class="op" id="1687862">*</span><span class="ident" id="1687863">g</span><span class="op" id="1687864">,</span>&nbsp;<span class="ident" id="1687866">skip</span>&nbsp;<span class="builtintype" id="1687871">int</span><span class="op" id="1687874">,</span>&nbsp;<span class="ident" id="1687876">pcbuf</span>&nbsp;<span class="op" id="1687882">*</span><span class="builtintype" id="1687883">uintptr</span><span class="op" id="1687890">,</span>&nbsp;<span class="ident" id="1687892">max</span>&nbsp;<span class="builtintype" id="1687896">int</span><span class="op" id="1687899">,</span>&nbsp;<span class="ident" id="1687901">callback</span>&nbsp;<span class="keyword" id="1687910">func</span><span class="op" id="1687914">(</span><span class="op" id="1687915">*</span><span class="ident" id="1687916">stkframe</span><span class="op" id="1687924">,</span>&nbsp;<span class="ident" id="1687926">unsafe</span><span class="op" id="1687932">.</span><span class="ident" id="1687933">Pointer</span><span class="op" id="1687940">)</span>&nbsp;<span class="builtintype" id="1687942">bool</span><span class="op" id="1687946">,</span>&nbsp;<span class="ident" id="1687948">v</span>&nbsp;<span class="ident" id="1687950">unsafe</span><span class="op" id="1687956">.</span><span class="ident" id="1687957">Pointer</span><span class="op" id="1687964">,</span>&nbsp;<span class="ident" id="1687966">flags</span>&nbsp;<span class="builtintype" id="1687972">uint</span><span class="op" id="1687976">)</span>&nbsp;<span class="builtintype" id="1687978">int</span>&nbsp;<span class="op" id="1687982">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1687985">if</span>&nbsp;<span class="ident" id="1687988">goexitPC</span>&nbsp;<span class="op" id="1687997">==</span>&nbsp;<span class="num" id="1688000">0</span>&nbsp;<span class="op" id="1688002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1688006">gothrow</span><span class="op" id="1688013">(</span><span class="string" id="1688014">&#34;gentraceback&nbsp;before&nbsp;goexitPC&nbsp;initialization&#34;</span><span class="op" id="1688059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1688062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1688065">g</span>&nbsp;<span class="op" id="1688067">:=</span>&nbsp;<span class="ident" id="1688070">getg</span><span class="op" id="1688074">(</span><span class="op" id="1688075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1688078">if</span>&nbsp;<span class="ident" id="1688081">g</span>&nbsp;<span class="op" id="1688083">==</span>&nbsp;<span class="ident" id="1688086">gp</span>&nbsp;<span class="op" id="1688089">&amp;&amp;</span>&nbsp;<span class="ident" id="1688092">g</span>&nbsp;<span class="op" id="1688094">==</span>&nbsp;<span class="ident" id="1688097">g</span><span class="op" id="1688098">.</span><span class="ident" id="1688099">m</span><span class="op" id="1688100">.</span><span class="ident" id="1688101">curg</span>&nbsp;<span class="op" id="1688106">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1688110">//&nbsp;The&nbsp;starting&nbsp;sp&nbsp;has&nbsp;been&nbsp;passed&nbsp;in&nbsp;as&nbsp;a&nbsp;uintptr,&nbsp;and&nbsp;the&nbsp;caller&nbsp;may</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1688183">//&nbsp;have&nbsp;other&nbsp;uintptr-typed&nbsp;stack&nbsp;references&nbsp;as&nbsp;well.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1688239">//&nbsp;If&nbsp;during&nbsp;one&nbsp;of&nbsp;the&nbsp;calls&nbsp;that&nbsp;got&nbsp;us&nbsp;here&nbsp;or&nbsp;during&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1688309">//&nbsp;callbacks&nbsp;below&nbsp;the&nbsp;stack&nbsp;must&nbsp;be&nbsp;grown,&nbsp;all&nbsp;these&nbsp;uintptr&nbsp;references</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1688384">//&nbsp;to&nbsp;the&nbsp;stack&nbsp;will&nbsp;not&nbsp;be&nbsp;updated,&nbsp;and&nbsp;gentraceback&nbsp;will&nbsp;continue</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1688454">//&nbsp;to&nbsp;inspect&nbsp;the&nbsp;old&nbsp;stack&nbsp;memory,&nbsp;which&nbsp;may&nbsp;no&nbsp;longer&nbsp;be&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1688522">//&nbsp;Even&nbsp;if&nbsp;all&nbsp;the&nbsp;variables&nbsp;were&nbsp;updated&nbsp;correctly,&nbsp;it&nbsp;is&nbsp;not&nbsp;clear&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1688598">//&nbsp;we&nbsp;want&nbsp;to&nbsp;expose&nbsp;a&nbsp;traceback&nbsp;that&nbsp;begins&nbsp;on&nbsp;one&nbsp;stack&nbsp;and&nbsp;ends</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1688667">//&nbsp;on&nbsp;another&nbsp;stack.&nbsp;That&nbsp;could&nbsp;confuse&nbsp;callers&nbsp;quite&nbsp;a&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1688730">//&nbsp;Instead,&nbsp;we&nbsp;require&nbsp;that&nbsp;gentraceback&nbsp;and&nbsp;any&nbsp;other&nbsp;function&nbsp;that</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1688801">//&nbsp;accepts&nbsp;an&nbsp;sp&nbsp;for&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;(typically&nbsp;obtained&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1688869">//&nbsp;calling&nbsp;getcallersp)&nbsp;must&nbsp;not&nbsp;run&nbsp;on&nbsp;that&nbsp;goroutine&#39;s&nbsp;stack&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1688938">//&nbsp;instead&nbsp;on&nbsp;the&nbsp;g0&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1688968">gothrow</span><span class="op" id="1688975">(</span><span class="string" id="1688976">&#34;gentraceback&nbsp;cannot&nbsp;trace&nbsp;user&nbsp;goroutine&nbsp;on&nbsp;its&nbsp;own&nbsp;stack&#34;</span><span class="op" id="1689035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1689038">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1689041">gotraceback</span>&nbsp;<span class="op" id="1689053">:=</span>&nbsp;<span class="ident" id="1689056">gotraceback</span><span class="op" id="1689067">(</span><span class="ident" id="1689068">nil</span><span class="op" id="1689071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1689074">if</span>&nbsp;<span class="ident" id="1689077">pc0</span>&nbsp;<span class="op" id="1689081">==</span>&nbsp;<span class="op" id="1689084">^</span><span class="builtintype" id="1689085">uintptr</span><span class="op" id="1689092">(</span><span class="num" id="1689093">0</span><span class="op" id="1689094">)</span>&nbsp;<span class="op" id="1689096">&amp;&amp;</span>&nbsp;<span class="ident" id="1689099">sp0</span>&nbsp;<span class="op" id="1689103">==</span>&nbsp;<span class="op" id="1689106">^</span><span class="builtintype" id="1689107">uintptr</span><span class="op" id="1689114">(</span><span class="num" id="1689115">0</span><span class="op" id="1689116">)</span>&nbsp;<span class="op" id="1689118">{</span>&nbsp;<span class="comment" id="1689120">//&nbsp;Signal&nbsp;to&nbsp;fetch&nbsp;saved&nbsp;values&nbsp;from&nbsp;gp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1689163">if</span>&nbsp;<span class="ident" id="1689166">gp</span><span class="op" id="1689168">.</span><span class="ident" id="1689169">syscallsp</span>&nbsp;<span class="op" id="1689179">!=</span>&nbsp;<span class="num" id="1689182">0</span>&nbsp;<span class="op" id="1689184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1689189">pc0</span>&nbsp;<span class="op" id="1689193">=</span>&nbsp;<span class="ident" id="1689195">gp</span><span class="op" id="1689197">.</span><span class="ident" id="1689198">syscallpc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1689211">sp0</span>&nbsp;<span class="op" id="1689215">=</span>&nbsp;<span class="ident" id="1689217">gp</span><span class="op" id="1689219">.</span><span class="ident" id="1689220">syscallsp</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1689233">if</span>&nbsp;<span class="ident" id="1689236">usesLR</span>&nbsp;<span class="op" id="1689243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1689249">lr0</span>&nbsp;<span class="op" id="1689253">=</span>&nbsp;<span class="num" id="1689255">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1689260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1689264">}</span>&nbsp;<span class="keyword" id="1689266">else</span>&nbsp;<span class="op" id="1689271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1689276">pc0</span>&nbsp;<span class="op" id="1689280">=</span>&nbsp;<span class="ident" id="1689282">gp</span><span class="op" id="1689284">.</span><span class="ident" id="1689285">sched</span><span class="op" id="1689290">.</span><span class="ident" id="1689291">pc</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1689297">sp0</span>&nbsp;<span class="op" id="1689301">=</span>&nbsp;<span class="ident" id="1689303">gp</span><span class="op" id="1689305">.</span><span class="ident" id="1689306">sched</span><span class="op" id="1689311">.</span><span class="ident" id="1689312">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1689318">if</span>&nbsp;<span class="ident" id="1689321">usesLR</span>&nbsp;<span class="op" id="1689328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1689334">lr0</span>&nbsp;<span class="op" id="1689338">=</span>&nbsp;<span class="ident" id="1689340">gp</span><span class="op" id="1689342">.</span><span class="ident" id="1689343">sched</span><span class="op" id="1689348">.</span><span class="ident" id="1689349">lr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1689355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1689359">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1689362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1689366">nprint</span>&nbsp;<span class="op" id="1689373">:=</span>&nbsp;<span class="num" id="1689376">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1689379">var</span>&nbsp;<span class="ident" id="1689383">frame</span>&nbsp;<span class="ident" id="1689389">stkframe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1689399">frame</span><span class="op" id="1689404">.</span><span class="ident" id="1689405">pc</span>&nbsp;<span class="op" id="1689408">=</span>&nbsp;<span class="ident" id="1689410">pc0</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1689415">frame</span><span class="op" id="1689420">.</span><span class="ident" id="1689421">sp</span>&nbsp;<span class="op" id="1689424">=</span>&nbsp;<span class="ident" id="1689426">sp0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1689431">if</span>&nbsp;<span class="ident" id="1689434">usesLR</span>&nbsp;<span class="op" id="1689441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1689445">frame</span><span class="op" id="1689450">.</span><span class="ident" id="1689451">lr</span>&nbsp;<span class="op" id="1689454">=</span>&nbsp;<span class="ident" id="1689456">lr0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1689461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1689464">waspanic</span>&nbsp;<span class="op" id="1689473">:=</span>&nbsp;<span class="builtintype" id="1689476">false</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1689483">wasnewproc</span>&nbsp;<span class="op" id="1689494">:=</span>&nbsp;<span class="builtintype" id="1689497">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1689504">printing</span>&nbsp;<span class="op" id="1689513">:=</span>&nbsp;<span class="ident" id="1689516">pcbuf</span>&nbsp;<span class="op" id="1689522">==</span>&nbsp;<span class="ident" id="1689525">nil</span>&nbsp;<span class="op" id="1689529">&amp;&amp;</span>&nbsp;<span class="ident" id="1689532">callback</span>&nbsp;<span class="op" id="1689541">==</span>&nbsp;<span class="ident" id="1689544">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1689549">_defer</span>&nbsp;<span class="op" id="1689556">:=</span>&nbsp;<span class="ident" id="1689559">gp</span><span class="op" id="1689561">.</span><span class="ident" id="1689562">_defer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1689571">for</span>&nbsp;<span class="ident" id="1689575">_defer</span>&nbsp;<span class="op" id="1689582">!=</span>&nbsp;<span class="ident" id="1689585">nil</span>&nbsp;<span class="op" id="1689589">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1689592">uintptr</span><span class="op" id="1689599">(</span><span class="ident" id="1689600">_defer</span><span class="op" id="1689606">.</span><span class="ident" id="1689607">argp</span><span class="op" id="1689611">)</span>&nbsp;<span class="op" id="1689613">==</span>&nbsp;<span class="ident" id="1689616">_NoArgs</span>&nbsp;<span class="op" id="1689624">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1689628">_defer</span>&nbsp;<span class="op" id="1689635">=</span>&nbsp;<span class="ident" id="1689637">_defer</span><span class="op" id="1689643">.</span><span class="ident" id="1689644">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1689650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1689654">//&nbsp;If&nbsp;the&nbsp;PC&nbsp;is&nbsp;zero,&nbsp;it&#39;s&nbsp;likely&nbsp;a&nbsp;nil&nbsp;function&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1689710">//&nbsp;Start&nbsp;in&nbsp;the&nbsp;caller&#39;s&nbsp;frame.</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1689743">if</span>&nbsp;<span class="ident" id="1689746">frame</span><span class="op" id="1689751">.</span><span class="ident" id="1689752">pc</span>&nbsp;<span class="op" id="1689755">==</span>&nbsp;<span class="num" id="1689758">0</span>&nbsp;<span class="op" id="1689760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1689764">if</span>&nbsp;<span class="ident" id="1689767">usesLR</span>&nbsp;<span class="op" id="1689774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1689779">frame</span><span class="op" id="1689784">.</span><span class="ident" id="1689785">pc</span>&nbsp;<span class="op" id="1689788">=</span>&nbsp;<span class="op" id="1689790">*</span><span class="op" id="1689791">(</span><span class="op" id="1689792">*</span><span class="builtintype" id="1689793">uintptr</span><span class="op" id="1689800">)</span><span class="op" id="1689801">(</span><span class="ident" id="1689802">unsafe</span><span class="op" id="1689808">.</span><span class="ident" id="1689809">Pointer</span><span class="op" id="1689816">(</span><span class="ident" id="1689817">frame</span><span class="op" id="1689822">.</span><span class="ident" id="1689823">sp</span><span class="op" id="1689825">)</span><span class="op" id="1689826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1689831">frame</span><span class="op" id="1689836">.</span><span class="ident" id="1689837">lr</span>&nbsp;<span class="op" id="1689840">=</span>&nbsp;<span class="num" id="1689842">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1689846">}</span>&nbsp;<span class="keyword" id="1689848">else</span>&nbsp;<span class="op" id="1689853">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1689858">frame</span><span class="op" id="1689863">.</span><span class="ident" id="1689864">pc</span>&nbsp;<span class="op" id="1689867">=</span>&nbsp;<span class="builtintype" id="1689869">uintptr</span><span class="op" id="1689876">(</span><span class="op" id="1689877">*</span><span class="op" id="1689878">(</span><span class="op" id="1689879">*</span><span class="ident" id="1689880">uintreg</span><span class="op" id="1689887">)</span><span class="op" id="1689888">(</span><span class="ident" id="1689889">unsafe</span><span class="op" id="1689895">.</span><span class="ident" id="1689896">Pointer</span><span class="op" id="1689903">(</span><span class="ident" id="1689904">frame</span><span class="op" id="1689909">.</span><span class="ident" id="1689910">sp</span><span class="op" id="1689912">)</span><span class="op" id="1689913">)</span><span class="op" id="1689914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1689919">frame</span><span class="op" id="1689924">.</span><span class="ident" id="1689925">sp</span>&nbsp;<span class="op" id="1689928">+=</span>&nbsp;<span class="ident" id="1689931">regSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1689941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1689944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1689948">f</span>&nbsp;<span class="op" id="1689950">:=</span>&nbsp;<span class="ident" id="1689953">findfunc</span><span class="op" id="1689961">(</span><span class="ident" id="1689962">frame</span><span class="op" id="1689967">.</span><span class="ident" id="1689968">pc</span><span class="op" id="1689970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1689973">if</span>&nbsp;<span class="ident" id="1689976">f</span>&nbsp;<span class="op" id="1689978">==</span>&nbsp;<span class="ident" id="1689981">nil</span>&nbsp;<span class="op" id="1689985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1689989">if</span>&nbsp;<span class="ident" id="1689992">callback</span>&nbsp;<span class="op" id="1690001">!=</span>&nbsp;<span class="ident" id="1690004">nil</span>&nbsp;<span class="op" id="1690008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1690013">print</span><span class="op" id="1690018">(</span><span class="string" id="1690019">&#34;runtime:&nbsp;unknown&nbsp;pc&nbsp;&#34;</span><span class="op" id="1690041">,</span>&nbsp;<span class="ident" id="1690043">hex</span><span class="op" id="1690046">(</span><span class="ident" id="1690047">frame</span><span class="op" id="1690052">.</span><span class="ident" id="1690053">pc</span><span class="op" id="1690055">)</span><span class="op" id="1690056">,</span>&nbsp;<span class="string" id="1690058">&#34;\n&#34;</span><span class="op" id="1690062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1690067">gothrow</span><span class="op" id="1690074">(</span><span class="string" id="1690075">&#34;unknown&nbsp;pc&#34;</span><span class="op" id="1690087">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1690091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1690095">return</span>&nbsp;<span class="num" id="1690102">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1690105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1690108">frame</span><span class="op" id="1690113">.</span><span class="ident" id="1690114">fn</span>&nbsp;<span class="op" id="1690117">=</span>&nbsp;<span class="ident" id="1690119">f</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1690123">n</span>&nbsp;<span class="op" id="1690125">:=</span>&nbsp;<span class="num" id="1690128">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1690131">for</span>&nbsp;<span class="ident" id="1690135">n</span>&nbsp;<span class="op" id="1690137">&lt;</span>&nbsp;<span class="ident" id="1690139">max</span>&nbsp;<span class="op" id="1690143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1690147">//&nbsp;Typically:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1690163">//&nbsp;&nbsp;&nbsp;&nbsppc&nbsp;is&nbsp;the&nbsp;PC&nbsp;of&nbsp;the&nbsp;running&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1690206">//&nbsp;&nbsp;&nbsp;&nbspsp&nbsp;is&nbsp;the&nbsp;stack&nbsp;pointer&nbsp;at&nbsp;that&nbsp;program&nbsp;counter.</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1690260">//&nbsp;&nbsp;&nbsp;&nbspfp&nbsp;is&nbsp;the&nbsp;frame&nbsp;pointer&nbsp;(caller&#39;s&nbsp;stack&nbsp;pointer)&nbsp;at&nbsp;that&nbsp;program&nbsp;counter,&nbsp;or&nbsp;nil&nbsp;if&nbsp;unknown.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1690358">//&nbsp;&nbsp;&nbsp;&nbspstk&nbsp;is&nbsp;the&nbsp;stack&nbsp;containing&nbsp;sp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1690395">//&nbsp;&nbsp;&nbsp;&nbspThe&nbsp;caller&#39;s&nbsp;program&nbsp;counter&nbsp;is&nbsp;lr,&nbsp;unless&nbsp;lr&nbsp;is&nbsp;zero,&nbsp;in&nbsp;which&nbsp;case&nbsp;it&nbsp;is&nbsp;*(uintptr*)sp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1690490">f</span>&nbsp;<span class="op" id="1690492">=</span>&nbsp;<span class="ident" id="1690494">frame</span><span class="op" id="1690499">.</span><span class="ident" id="1690500">fn</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1690506">//&nbsp;Found&nbsp;an&nbsp;actual&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1690537">//&nbsp;Derive&nbsp;frame&nbsp;pointer&nbsp;and&nbsp;link&nbsp;register.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1690582">if</span>&nbsp;<span class="ident" id="1690585">frame</span><span class="op" id="1690590">.</span><span class="ident" id="1690591">fp</span>&nbsp;<span class="op" id="1690594">==</span>&nbsp;<span class="num" id="1690597">0</span>&nbsp;<span class="op" id="1690599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1690604">frame</span><span class="op" id="1690609">.</span><span class="ident" id="1690610">fp</span>&nbsp;<span class="op" id="1690613">=</span>&nbsp;<span class="ident" id="1690615">frame</span><span class="op" id="1690620">.</span><span class="ident" id="1690621">sp</span>&nbsp;<span class="op" id="1690624">+</span>&nbsp;<span class="builtintype" id="1690626">uintptr</span><span class="op" id="1690633">(</span><span class="ident" id="1690634">funcspdelta</span><span class="op" id="1690645">(</span><span class="ident" id="1690646">f</span><span class="op" id="1690647">,</span>&nbsp;<span class="ident" id="1690649">frame</span><span class="op" id="1690654">.</span><span class="ident" id="1690655">pc</span><span class="op" id="1690657">)</span><span class="op" id="1690658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1690663">if</span>&nbsp;<span class="op" id="1690666">!</span><span class="ident" id="1690667">usesLR</span>&nbsp;<span class="op" id="1690674">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1690680">//&nbsp;On&nbsp;x86,&nbsp;call&nbsp;instruction&nbsp;pushes&nbsp;return&nbsp;PC&nbsp;before&nbsp;entering&nbsp;new&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1690759">frame</span><span class="op" id="1690764">.</span><span class="ident" id="1690765">fp</span>&nbsp;<span class="op" id="1690768">+=</span>&nbsp;<span class="ident" id="1690771">regSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1690782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1690786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1690790">var</span>&nbsp;<span class="ident" id="1690794">flr</span>&nbsp;<span class="op" id="1690798">*</span><span class="ident" id="1690799">_func</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1690807">if</span>&nbsp;<span class="ident" id="1690810">topofstack</span><span class="op" id="1690820">(</span><span class="ident" id="1690821">f</span><span class="op" id="1690822">)</span>&nbsp;<span class="op" id="1690824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1690829">frame</span><span class="op" id="1690834">.</span><span class="ident" id="1690835">lr</span>&nbsp;<span class="op" id="1690838">=</span>&nbsp;<span class="num" id="1690840">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1690845">flr</span>&nbsp;<span class="op" id="1690849">=</span>&nbsp;<span class="ident" id="1690851">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1690857">}</span>&nbsp;<span class="keyword" id="1690859">else</span>&nbsp;<span class="keyword" id="1690864">if</span>&nbsp;<span class="ident" id="1690867">usesLR</span>&nbsp;<span class="op" id="1690874">&amp;&amp;</span>&nbsp;<span class="ident" id="1690877">f</span><span class="op" id="1690878">.</span><span class="ident" id="1690879">entry</span>&nbsp;<span class="op" id="1690885">==</span>&nbsp;<span class="ident" id="1690888">jmpdeferPC</span>&nbsp;<span class="op" id="1690899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1690904">//&nbsp;jmpdefer&nbsp;modifies&nbsp;SP/LR/PC&nbsp;non-atomically.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1690953">//&nbsp;If&nbsp;a&nbsp;profiling&nbsp;interrupt&nbsp;arrives&nbsp;during&nbsp;jmpdefer,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1691009">//&nbsp;the&nbsp;stack&nbsp;unwind&nbsp;may&nbsp;see&nbsp;a&nbsp;mismatched&nbsp;register&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1691066">//&nbsp;and&nbsp;get&nbsp;confused.&nbsp;Stop&nbsp;if&nbsp;we&nbsp;see&nbsp;PC&nbsp;within&nbsp;jmpdefer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1691124">//&nbsp;to&nbsp;avoid&nbsp;that&nbsp;confusion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1691155">//&nbsp;See&nbsp;golang.org/issue/8153.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1691188">if</span>&nbsp;<span class="ident" id="1691191">callback</span>&nbsp;<span class="op" id="1691200">!=</span>&nbsp;<span class="ident" id="1691203">nil</span>&nbsp;<span class="op" id="1691207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1691213">gothrow</span><span class="op" id="1691220">(</span><span class="string" id="1691221">&#34;traceback_arm:&nbsp;found&nbsp;jmpdefer&nbsp;when&nbsp;tracing&nbsp;with&nbsp;callback&#34;</span><span class="op" id="1691279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1691284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1691289">frame</span><span class="op" id="1691294">.</span><span class="ident" id="1691295">lr</span>&nbsp;<span class="op" id="1691298">=</span>&nbsp;<span class="num" id="1691300">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1691304">}</span>&nbsp;<span class="keyword" id="1691306">else</span>&nbsp;<span class="op" id="1691311">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1691316">if</span>&nbsp;<span class="ident" id="1691319">usesLR</span>&nbsp;<span class="op" id="1691326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1691332">if</span>&nbsp;<span class="ident" id="1691335">n</span>&nbsp;<span class="op" id="1691337">==</span>&nbsp;<span class="num" id="1691340">0</span>&nbsp;<span class="op" id="1691342">&amp;&amp;</span>&nbsp;<span class="ident" id="1691345">frame</span><span class="op" id="1691350">.</span><span class="ident" id="1691351">sp</span>&nbsp;<span class="op" id="1691354">&lt;</span>&nbsp;<span class="ident" id="1691356">frame</span><span class="op" id="1691361">.</span><span class="ident" id="1691362">fp</span>&nbsp;<span class="op" id="1691365">||</span>&nbsp;<span class="ident" id="1691368">frame</span><span class="op" id="1691373">.</span><span class="ident" id="1691374">lr</span>&nbsp;<span class="op" id="1691377">==</span>&nbsp;<span class="num" id="1691380">0</span>&nbsp;<span class="op" id="1691382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1691389">frame</span><span class="op" id="1691394">.</span><span class="ident" id="1691395">lr</span>&nbsp;<span class="op" id="1691398">=</span>&nbsp;<span class="op" id="1691400">*</span><span class="op" id="1691401">(</span><span class="op" id="1691402">*</span><span class="builtintype" id="1691403">uintptr</span><span class="op" id="1691410">)</span><span class="op" id="1691411">(</span><span class="ident" id="1691412">unsafe</span><span class="op" id="1691418">.</span><span class="ident" id="1691419">Pointer</span><span class="op" id="1691426">(</span><span class="ident" id="1691427">frame</span><span class="op" id="1691432">.</span><span class="ident" id="1691433">sp</span><span class="op" id="1691435">)</span><span class="op" id="1691436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1691442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1691447">}</span>&nbsp;<span class="keyword" id="1691449">else</span>&nbsp;<span class="op" id="1691454">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1691460">if</span>&nbsp;<span class="ident" id="1691463">frame</span><span class="op" id="1691468">.</span><span class="ident" id="1691469">lr</span>&nbsp;<span class="op" id="1691472">==</span>&nbsp;<span class="num" id="1691475">0</span>&nbsp;<span class="op" id="1691477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1691484">frame</span><span class="op" id="1691489">.</span><span class="ident" id="1691490">lr</span>&nbsp;<span class="op" id="1691493">=</span>&nbsp;<span class="builtintype" id="1691495">uintptr</span><span class="op" id="1691502">(</span><span class="op" id="1691503">*</span><span class="op" id="1691504">(</span><span class="op" id="1691505">*</span><span class="ident" id="1691506">uintreg</span><span class="op" id="1691513">)</span><span class="op" id="1691514">(</span><span class="ident" id="1691515">unsafe</span><span class="op" id="1691521">.</span><span class="ident" id="1691522">Pointer</span><span class="op" id="1691529">(</span><span class="ident" id="1691530">frame</span><span class="op" id="1691535">.</span><span class="ident" id="1691536">fp</span>&nbsp;<span class="op" id="1691539">-</span>&nbsp;<span class="ident" id="1691541">regSize</span><span class="op" id="1691548">)</span><span class="op" id="1691549">)</span><span class="op" id="1691550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1691556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1691561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1691566">flr</span>&nbsp;<span class="op" id="1691570">=</span>&nbsp;<span class="ident" id="1691572">findfunc</span><span class="op" id="1691580">(</span><span class="ident" id="1691581">frame</span><span class="op" id="1691586">.</span><span class="ident" id="1691587">lr</span><span class="op" id="1691589">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1691594">if</span>&nbsp;<span class="ident" id="1691597">flr</span>&nbsp;<span class="op" id="1691601">==</span>&nbsp;<span class="ident" id="1691604">nil</span>&nbsp;<span class="op" id="1691608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1691614">//&nbsp;This&nbsp;happens&nbsp;if&nbsp;you&nbsp;get&nbsp;a&nbsp;profiling&nbsp;interrupt&nbsp;at&nbsp;just&nbsp;the&nbsp;wrong&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1691691">//&nbsp;In&nbsp;that&nbsp;context&nbsp;it&nbsp;is&nbsp;okay&nbsp;to&nbsp;stop&nbsp;early.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1691740">//&nbsp;But&nbsp;if&nbsp;callback&nbsp;is&nbsp;set,&nbsp;we&#39;re&nbsp;doing&nbsp;a&nbsp;garbage&nbsp;collection&nbsp;and&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1691813">//&nbsp;get&nbsp;everything,&nbsp;so&nbsp;crash&nbsp;loudly.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1691853">if</span>&nbsp;<span class="ident" id="1691856">callback</span>&nbsp;<span class="op" id="1691865">!=</span>&nbsp;<span class="ident" id="1691868">nil</span>&nbsp;<span class="op" id="1691872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1691879">print</span><span class="op" id="1691884">(</span><span class="string" id="1691885">&#34;runtime:&nbsp;unexpected&nbsp;return&nbsp;pc&nbsp;for&nbsp;&#34;</span><span class="op" id="1691921">,</span>&nbsp;<span class="ident" id="1691923">gofuncname</span><span class="op" id="1691933">(</span><span class="ident" id="1691934">f</span><span class="op" id="1691935">)</span><span class="op" id="1691936">,</span>&nbsp;<span class="string" id="1691938">&#34;&nbsp;called&nbsp;from&nbsp;&#34;</span><span class="op" id="1691953">,</span>&nbsp;<span class="ident" id="1691955">hex</span><span class="op" id="1691958">(</span><span class="ident" id="1691959">frame</span><span class="op" id="1691964">.</span><span class="ident" id="1691965">lr</span><span class="op" id="1691967">)</span><span class="op" id="1691968">,</span>&nbsp;<span class="string" id="1691970">&#34;\n&#34;</span><span class="op" id="1691974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1691981">gothrow</span><span class="op" id="1691988">(</span><span class="string" id="1691989">&#34;unknown&nbsp;caller&nbsp;pc&#34;</span><span class="op" id="1692008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1692014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1692019">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1692023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1692028">frame</span><span class="op" id="1692033">.</span><span class="ident" id="1692034">varp</span>&nbsp;<span class="op" id="1692039">=</span>&nbsp;<span class="ident" id="1692041">frame</span><span class="op" id="1692046">.</span><span class="ident" id="1692047">fp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1692052">if</span>&nbsp;<span class="op" id="1692055">!</span><span class="ident" id="1692056">usesLR</span>&nbsp;<span class="op" id="1692063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1692068">//&nbsp;On&nbsp;x86,&nbsp;call&nbsp;instruction&nbsp;pushes&nbsp;return&nbsp;PC&nbsp;before&nbsp;entering&nbsp;new&nbsp;function.</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1692146">frame</span><span class="op" id="1692151">.</span><span class="ident" id="1692152">varp</span>&nbsp;<span class="op" id="1692157">-=</span>&nbsp;<span class="ident" id="1692160">regSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1692170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1692175">//&nbsp;Derive&nbsp;size&nbsp;of&nbsp;arguments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1692206">//&nbsp;Most&nbsp;functions&nbsp;have&nbsp;a&nbsp;fixed-size&nbsp;argument&nbsp;block,</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1692260">//&nbsp;so&nbsp;we&nbsp;can&nbsp;use&nbsp;metadata&nbsp;about&nbsp;the&nbsp;function&nbsp;f.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1692310">//&nbsp;Not&nbsp;all,&nbsp;though:&nbsp;there&nbsp;are&nbsp;some&nbsp;variadic&nbsp;functions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1692366">//&nbsp;in&nbsp;package&nbsp;runtime&nbsp;and&nbsp;reflect,&nbsp;and&nbsp;for&nbsp;those&nbsp;we&nbsp;use&nbsp;call-specific</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1692438">//&nbsp;metadata&nbsp;recorded&nbsp;by&nbsp;f&#39;s&nbsp;caller.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1692476">if</span>&nbsp;<span class="ident" id="1692479">callback</span>&nbsp;<span class="op" id="1692488">!=</span>&nbsp;<span class="ident" id="1692491">nil</span>&nbsp;<span class="op" id="1692495">||</span>&nbsp;<span class="ident" id="1692498">printing</span>&nbsp;<span class="op" id="1692507">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1692512">frame</span><span class="op" id="1692517">.</span><span class="ident" id="1692518">argp</span>&nbsp;<span class="op" id="1692523">=</span>&nbsp;<span class="ident" id="1692525">frame</span><span class="op" id="1692530">.</span><span class="ident" id="1692531">fp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1692537">if</span>&nbsp;<span class="ident" id="1692540">usesLR</span>&nbsp;<span class="op" id="1692547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1692553">frame</span><span class="op" id="1692558">.</span><span class="ident" id="1692559">argp</span>&nbsp;<span class="op" id="1692564">+=</span>&nbsp;<span class="ident" id="1692567">ptrSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1692578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1692583">setArgInfo</span><span class="op" id="1692593">(</span><span class="op" id="1692594">&amp;</span><span class="ident" id="1692595">frame</span><span class="op" id="1692600">,</span>&nbsp;<span class="ident" id="1692602">f</span><span class="op" id="1692603">,</span>&nbsp;<span class="ident" id="1692605">callback</span>&nbsp;<span class="op" id="1692614">!=</span>&nbsp;<span class="ident" id="1692617">nil</span><span class="op" id="1692620">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1692624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1692629">//&nbsp;Determine&nbsp;function&nbsp;SP&nbsp;where&nbsp;deferproc&nbsp;would&nbsp;find&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1692698">var</span>&nbsp;<span class="ident" id="1692702">sparg</span>&nbsp;<span class="builtintype" id="1692708">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1692718">if</span>&nbsp;<span class="ident" id="1692721">usesLR</span>&nbsp;<span class="op" id="1692728">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1692733">//&nbsp;On&nbsp;link&nbsp;register&nbsp;architectures,&nbsp;that&#39;s&nbsp;the&nbsp;standard&nbsp;bottom-of-stack&nbsp;plus&nbsp;1&nbsp;word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1692819">//&nbsp;for&nbsp;the&nbsp;saved&nbsp;LR.&nbsp;If&nbsp;the&nbsp;previous&nbsp;frame&nbsp;was&nbsp;a&nbsp;direct&nbsp;call&nbsp;to&nbsp;newproc/deferproc,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1692905">//&nbsp;however,&nbsp;the&nbsp;SP&nbsp;is&nbsp;three&nbsp;words&nbsp;lower&nbsp;than&nbsp;normal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1692961">//&nbsp;If&nbsp;the&nbsp;function&nbsp;has&nbsp;no&nbsp;frame&nbsp;at&nbsp;all&nbsp;-&nbsp;perhaps&nbsp;it&nbsp;just&nbsp;started,&nbsp;or&nbsp;perhaps</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1693041">//&nbsp;it&nbsp;is&nbsp;a&nbsp;leaf&nbsp;with&nbsp;no&nbsp;local&nbsp;variables&nbsp;-&nbsp;then&nbsp;we&nbsp;cannot&nbsp;possibly&nbsp;find&nbsp;its</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1693119">//&nbsp;SP&nbsp;in&nbsp;a&nbsp;defer,&nbsp;and&nbsp;we&nbsp;might&nbsp;confuse&nbsp;its&nbsp;SP&nbsp;for&nbsp;its&nbsp;caller&#39;s&nbsp;SP,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1693192">//&nbsp;leave&nbsp;sparg=0&nbsp;in&nbsp;that&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1693226">if</span>&nbsp;<span class="ident" id="1693229">frame</span><span class="op" id="1693234">.</span><span class="ident" id="1693235">fp</span>&nbsp;<span class="op" id="1693238">!=</span>&nbsp;<span class="ident" id="1693241">frame</span><span class="op" id="1693246">.</span><span class="ident" id="1693247">sp</span>&nbsp;<span class="op" id="1693250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1693256">sparg</span>&nbsp;<span class="op" id="1693262">=</span>&nbsp;<span class="ident" id="1693264">frame</span><span class="op" id="1693269">.</span><span class="ident" id="1693270">sp</span>&nbsp;<span class="op" id="1693273">+</span>&nbsp;<span class="ident" id="1693275">regSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1693287">if</span>&nbsp;<span class="ident" id="1693290">wasnewproc</span>&nbsp;<span class="op" id="1693301">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1693308">sparg</span>&nbsp;<span class="op" id="1693314">+=</span>&nbsp;<span class="num" id="1693317">3</span>&nbsp;<span class="op" id="1693319">*</span>&nbsp;<span class="ident" id="1693321">regSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1693333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1693338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1693342">}</span>&nbsp;<span class="keyword" id="1693344">else</span>&nbsp;<span class="op" id="1693349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1693354">//&nbsp;On&nbsp;x86&nbsp;that&#39;s&nbsp;the&nbsp;standard&nbsp;bottom-of-stack,&nbsp;so&nbsp;SP&nbsp;exactly.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1693419">//&nbsp;If&nbsp;the&nbsp;previous&nbsp;frame&nbsp;was&nbsp;a&nbsp;direct&nbsp;call&nbsp;to&nbsp;newproc/deferproc,&nbsp;however,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1693496">//&nbsp;the&nbsp;SP&nbsp;is&nbsp;two&nbsp;words&nbsp;lower&nbsp;than&nbsp;normal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1693541">sparg</span>&nbsp;<span class="op" id="1693547">=</span>&nbsp;<span class="ident" id="1693549">frame</span><span class="op" id="1693554">.</span><span class="ident" id="1693555">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1693561">if</span>&nbsp;<span class="ident" id="1693564">wasnewproc</span>&nbsp;<span class="op" id="1693575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1693581">sparg</span>&nbsp;<span class="op" id="1693587">+=</span>&nbsp;<span class="num" id="1693590">2</span>&nbsp;<span class="op" id="1693592">*</span>&nbsp;<span class="ident" id="1693594">ptrSize</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1693605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1693609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1693614">//&nbsp;Determine&nbsp;frame&#39;s&nbsp;&#39;continuation&nbsp;PC&#39;,&nbsp;where&nbsp;it&nbsp;can&nbsp;continue.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1693679">//&nbsp;Normally&nbsp;this&nbsp;is&nbsp;the&nbsp;return&nbsp;address&nbsp;on&nbsp;the&nbsp;stack,&nbsp;but&nbsp;if&nbsp;sigpanic</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1693750">//&nbsp;is&nbsp;immediately&nbsp;below&nbsp;this&nbsp;function&nbsp;on&nbsp;the&nbsp;stack,&nbsp;then&nbsp;the&nbsp;frame</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1693819">//&nbsp;stopped&nbsp;executing&nbsp;due&nbsp;to&nbsp;a&nbsp;trap,&nbsp;and&nbsp;frame.pc&nbsp;is&nbsp;probably&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1693886">//&nbsp;a&nbsp;safe&nbsp;point&nbsp;for&nbsp;looking&nbsp;up&nbsp;liveness&nbsp;information.&nbsp;In&nbsp;this&nbsp;panicking&nbsp;case,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1693965">//&nbsp;the&nbsp;function&nbsp;either&nbsp;doesn&#39;t&nbsp;return&nbsp;at&nbsp;all&nbsp;(if&nbsp;it&nbsp;has&nbsp;no&nbsp;defers&nbsp;or&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1694043">//&nbsp;defers&nbsp;do&nbsp;not&nbsp;recover)&nbsp;or&nbsp;it&nbsp;returns&nbsp;from&nbsp;one&nbsp;of&nbsp;the&nbsp;calls&nbsp;to</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1694110">//&nbsp;deferproc&nbsp;a&nbsp;second&nbsp;time&nbsp;(if&nbsp;the&nbsp;corresponding&nbsp;deferred&nbsp;func&nbsp;recovers).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1694186">//&nbsp;It&nbsp;suffices&nbsp;to&nbsp;assume&nbsp;that&nbsp;the&nbsp;most&nbsp;recent&nbsp;deferproc&nbsp;is&nbsp;the&nbsp;one&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1694260">//&nbsp;returns;&nbsp;everything&nbsp;live&nbsp;at&nbsp;earlier&nbsp;deferprocs&nbsp;is&nbsp;still&nbsp;live&nbsp;at&nbsp;that&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1694339">frame</span><span class="op" id="1694344">.</span><span class="ident" id="1694345">continpc</span>&nbsp;<span class="op" id="1694354">=</span>&nbsp;<span class="ident" id="1694356">frame</span><span class="op" id="1694361">.</span><span class="ident" id="1694362">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1694367">if</span>&nbsp;<span class="ident" id="1694370">waspanic</span>&nbsp;<span class="op" id="1694379">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1694384">if</span>&nbsp;<span class="ident" id="1694387">_defer</span>&nbsp;<span class="op" id="1694394">!=</span>&nbsp;<span class="ident" id="1694397">nil</span>&nbsp;<span class="op" id="1694401">&amp;&amp;</span>&nbsp;<span class="ident" id="1694404">_defer</span><span class="op" id="1694410">.</span><span class="ident" id="1694411">argp</span>&nbsp;<span class="op" id="1694416">==</span>&nbsp;<span class="ident" id="1694419">sparg</span>&nbsp;<span class="op" id="1694425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1694431">frame</span><span class="op" id="1694436">.</span><span class="ident" id="1694437">continpc</span>&nbsp;<span class="op" id="1694446">=</span>&nbsp;<span class="ident" id="1694448">_defer</span><span class="op" id="1694454">.</span><span class="ident" id="1694455">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1694461">}</span>&nbsp;<span class="keyword" id="1694463">else</span>&nbsp;<span class="op" id="1694468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1694474">frame</span><span class="op" id="1694479">.</span><span class="ident" id="1694480">continpc</span>&nbsp;<span class="op" id="1694489">=</span>&nbsp;<span class="num" id="1694491">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1694496">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1694500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1694505">//&nbsp;Unwind&nbsp;our&nbsp;local&nbsp;defer&nbsp;stack&nbsp;past&nbsp;this&nbsp;frame.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1694556">for</span>&nbsp;<span class="ident" id="1694560">_defer</span>&nbsp;<span class="op" id="1694567">!=</span>&nbsp;<span class="ident" id="1694570">nil</span>&nbsp;<span class="op" id="1694574">&amp;&amp;</span>&nbsp;<span class="op" id="1694577">(</span><span class="ident" id="1694578">_defer</span><span class="op" id="1694584">.</span><span class="ident" id="1694585">argp</span>&nbsp;<span class="op" id="1694590">==</span>&nbsp;<span class="ident" id="1694593">sparg</span>&nbsp;<span class="op" id="1694599">||</span>&nbsp;<span class="ident" id="1694602">_defer</span><span class="op" id="1694608">.</span><span class="ident" id="1694609">argp</span>&nbsp;<span class="op" id="1694614">==</span>&nbsp;<span class="ident" id="1694617">_NoArgs</span><span class="op" id="1694624">)</span>&nbsp;<span class="op" id="1694626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1694631">_defer</span>&nbsp;<span class="op" id="1694638">=</span>&nbsp;<span class="ident" id="1694640">_defer</span><span class="op" id="1694646">.</span><span class="ident" id="1694647">link</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1694654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1694659">if</span>&nbsp;<span class="ident" id="1694662">skip</span>&nbsp;<span class="op" id="1694667">&gt;</span>&nbsp;<span class="num" id="1694669">0</span>&nbsp;<span class="op" id="1694671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1694676">skip</span><span class="op" id="1694680">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1694686">goto</span>&nbsp;<span class="ident" id="1694691">skipped</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1694701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1694706">if</span>&nbsp;<span class="ident" id="1694709">pcbuf</span>&nbsp;<span class="op" id="1694715">!=</span>&nbsp;<span class="ident" id="1694718">nil</span>&nbsp;<span class="op" id="1694722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1694727">(</span><span class="op" id="1694728">*</span><span class="op" id="1694729">[</span><span class="num" id="1694730">1</span>&nbsp;<span class="op" id="1694732">&lt;&lt;</span>&nbsp;<span class="num" id="1694735">20</span><span class="op" id="1694737">]</span><span class="builtintype" id="1694738">uintptr</span><span class="op" id="1694745">)</span><span class="op" id="1694746">(</span><span class="ident" id="1694747">unsafe</span><span class="op" id="1694753">.</span><span class="ident" id="1694754">Pointer</span><span class="op" id="1694761">(</span><span class="ident" id="1694762">pcbuf</span><span class="op" id="1694767">)</span><span class="op" id="1694768">)</span><span class="op" id="1694769">[</span><span class="ident" id="1694770">n</span><span class="op" id="1694771">]</span>&nbsp;<span class="op" id="1694773">=</span>&nbsp;<span class="ident" id="1694775">frame</span><span class="op" id="1694780">.</span><span class="ident" id="1694781">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1694786">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1694790">if</span>&nbsp;<span class="ident" id="1694793">callback</span>&nbsp;<span class="op" id="1694802">!=</span>&nbsp;<span class="ident" id="1694805">nil</span>&nbsp;<span class="op" id="1694809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1694814">if</span>&nbsp;<span class="op" id="1694817">!</span><span class="ident" id="1694818">callback</span><span class="op" id="1694826">(</span><span class="op" id="1694827">(</span><span class="op" id="1694828">*</span><span class="ident" id="1694829">stkframe</span><span class="op" id="1694837">)</span><span class="op" id="1694838">(</span><span class="ident" id="1694839">noescape</span><span class="op" id="1694847">(</span><span class="ident" id="1694848">unsafe</span><span class="op" id="1694854">.</span><span class="ident" id="1694855">Pointer</span><span class="op" id="1694862">(</span><span class="op" id="1694863">&amp;</span><span class="ident" id="1694864">frame</span><span class="op" id="1694869">)</span><span class="op" id="1694870">)</span><span class="op" id="1694871">)</span><span class="op" id="1694872">,</span>&nbsp;<span class="ident" id="1694874">v</span><span class="op" id="1694875">)</span>&nbsp;<span class="op" id="1694877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1694883">return</span>&nbsp;<span class="ident" id="1694890">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1694895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1694899">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1694903">if</span>&nbsp;<span class="ident" id="1694906">printing</span>&nbsp;<span class="op" id="1694915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1694920">if</span>&nbsp;<span class="op" id="1694923">(</span><span class="ident" id="1694924">flags</span><span class="op" id="1694929">&amp;</span><span class="ident" id="1694930">_TraceRuntimeFrames</span><span class="op" id="1694949">)</span>&nbsp;<span class="op" id="1694951">!=</span>&nbsp;<span class="num" id="1694954">0</span>&nbsp;<span class="op" id="1694956">||</span>&nbsp;<span class="ident" id="1694959">showframe</span><span class="op" id="1694968">(</span><span class="ident" id="1694969">f</span><span class="op" id="1694970">,</span>&nbsp;<span class="ident" id="1694972">gp</span><span class="op" id="1694974">)</span>&nbsp;<span class="op" id="1694976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1694982">//&nbsp;Print&nbsp;during&nbsp;crash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1695009">//&nbsp;&nbsp;&nbsp;&nbspmain(0x1,&nbsp;0x2,&nbsp;0x3)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1695036">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/home/rsc/go/src/runtime/x.go:23&nbsp;+0xf</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1695082">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1695089">tracepc</span>&nbsp;<span class="op" id="1695097">:=</span>&nbsp;<span class="ident" id="1695100">frame</span><span class="op" id="1695105">.</span><span class="ident" id="1695106">pc</span>&nbsp;<span class="comment" id="1695109">//&nbsp;back&nbsp;up&nbsp;to&nbsp;CALL&nbsp;instruction&nbsp;for&nbsp;funcline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1695158">if</span>&nbsp;<span class="op" id="1695161">(</span><span class="ident" id="1695162">n</span>&nbsp;<span class="op" id="1695164">&gt;</span>&nbsp;<span class="num" id="1695166">0</span>&nbsp;<span class="op" id="1695168">||</span>&nbsp;<span class="ident" id="1695171">flags</span><span class="op" id="1695176">&amp;</span><span class="ident" id="1695177">_TraceTrap</span>&nbsp;<span class="op" id="1695188">==</span>&nbsp;<span class="num" id="1695191">0</span><span class="op" id="1695192">)</span>&nbsp;<span class="op" id="1695194">&amp;&amp;</span>&nbsp;<span class="ident" id="1695197">frame</span><span class="op" id="1695202">.</span><span class="ident" id="1695203">pc</span>&nbsp;<span class="op" id="1695206">&gt;</span>&nbsp;<span class="ident" id="1695208">f</span><span class="op" id="1695209">.</span><span class="ident" id="1695210">entry</span>&nbsp;<span class="op" id="1695216">&amp;&amp;</span>&nbsp;<span class="op" id="1695219">!</span><span class="ident" id="1695220">waspanic</span>&nbsp;<span class="op" id="1695229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1695236">tracepc</span><span class="op" id="1695243">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1695250">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1695256">print</span><span class="op" id="1695261">(</span><span class="ident" id="1695262">gofuncname</span><span class="op" id="1695272">(</span><span class="ident" id="1695273">f</span><span class="op" id="1695274">)</span><span class="op" id="1695275">,</span>&nbsp;<span class="string" id="1695277">&#34;(&#34;</span><span class="op" id="1695280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1695286">argp</span>&nbsp;<span class="op" id="1695291">:=</span>&nbsp;<span class="op" id="1695294">(</span><span class="op" id="1695295">*</span><span class="op" id="1695296">[</span><span class="num" id="1695297">100</span><span class="op" id="1695300">]</span><span class="builtintype" id="1695301">uintptr</span><span class="op" id="1695308">)</span><span class="op" id="1695309">(</span><span class="ident" id="1695310">unsafe</span><span class="op" id="1695316">.</span><span class="ident" id="1695317">Pointer</span><span class="op" id="1695324">(</span><span class="ident" id="1695325">frame</span><span class="op" id="1695330">.</span><span class="ident" id="1695331">argp</span><span class="op" id="1695335">)</span><span class="op" id="1695336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1695342">for</span>&nbsp;<span class="ident" id="1695346">i</span>&nbsp;<span class="op" id="1695348">:=</span>&nbsp;<span class="builtintype" id="1695351">uintptr</span><span class="op" id="1695358">(</span><span class="num" id="1695359">0</span><span class="op" id="1695360">)</span><span class="op" id="1695361">;</span>&nbsp;<span class="ident" id="1695363">i</span>&nbsp;<span class="op" id="1695365">&lt;</span>&nbsp;<span class="ident" id="1695367">frame</span><span class="op" id="1695372">.</span><span class="ident" id="1695373">arglen</span><span class="op" id="1695379">/</span><span class="ident" id="1695380">ptrSize</span><span class="op" id="1695387">;</span>&nbsp;<span class="ident" id="1695389">i</span><span class="op" id="1695390">++</span>&nbsp;<span class="op" id="1695393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1695400">if</span>&nbsp;<span class="ident" id="1695403">i</span>&nbsp;<span class="op" id="1695405">&gt;=</span>&nbsp;<span class="num" id="1695408">10</span>&nbsp;<span class="op" id="1695411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1695419">print</span><span class="op" id="1695424">(</span><span class="string" id="1695425">&#34;,&nbsp;...&#34;</span><span class="op" id="1695432">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1695440">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1695451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1695458">if</span>&nbsp;<span class="ident" id="1695461">i</span>&nbsp;<span class="op" id="1695463">!=</span>&nbsp;<span class="num" id="1695466">0</span>&nbsp;<span class="op" id="1695468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1695476">print</span><span class="op" id="1695481">(</span><span class="string" id="1695482">&#34;,&nbsp;&#34;</span><span class="op" id="1695486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1695493">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1695500">print</span><span class="op" id="1695505">(</span><span class="ident" id="1695506">hex</span><span class="op" id="1695509">(</span><span class="ident" id="1695510">argp</span><span class="op" id="1695514">[</span><span class="ident" id="1695515">i</span><span class="op" id="1695516">]</span><span class="op" id="1695517">)</span><span class="op" id="1695518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1695524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1695530">print</span><span class="op" id="1695535">(</span><span class="string" id="1695536">&#34;)\n&#34;</span><span class="op" id="1695541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1695547">var</span>&nbsp;<span class="ident" id="1695551">file</span>&nbsp;<span class="builtintype" id="1695556">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1695567">line</span>&nbsp;<span class="op" id="1695572">:=</span>&nbsp;<span class="ident" id="1695575">funcline</span><span class="op" id="1695583">(</span><span class="ident" id="1695584">f</span><span class="op" id="1695585">,</span>&nbsp;<span class="ident" id="1695587">tracepc</span><span class="op" id="1695594">,</span>&nbsp;<span class="op" id="1695596">&amp;</span><span class="ident" id="1695597">file</span><span class="op" id="1695601">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1695607">print</span><span class="op" id="1695612">(</span><span class="string" id="1695613">&#34;\t&#34;</span><span class="op" id="1695617">,</span>&nbsp;<span class="ident" id="1695619">file</span><span class="op" id="1695623">,</span>&nbsp;<span class="string" id="1695625">&#34;:&#34;</span><span class="op" id="1695628">,</span>&nbsp;<span class="ident" id="1695630">line</span><span class="op" id="1695634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1695640">if</span>&nbsp;<span class="ident" id="1695643">frame</span><span class="op" id="1695648">.</span><span class="ident" id="1695649">pc</span>&nbsp;<span class="op" id="1695652">&gt;</span>&nbsp;<span class="ident" id="1695654">f</span><span class="op" id="1695655">.</span><span class="ident" id="1695656">entry</span>&nbsp;<span class="op" id="1695662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1695669">print</span><span class="op" id="1695674">(</span><span class="string" id="1695675">&#34;&nbsp;+&#34;</span><span class="op" id="1695679">,</span>&nbsp;<span class="ident" id="1695681">hex</span><span class="op" id="1695684">(</span><span class="ident" id="1695685">frame</span><span class="op" id="1695690">.</span><span class="ident" id="1695691">pc</span><span class="op" id="1695693">-</span><span class="ident" id="1695694">f</span><span class="op" id="1695695">.</span><span class="ident" id="1695696">entry</span><span class="op" id="1695701">)</span><span class="op" id="1695702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1695708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1695714">if</span>&nbsp;<span class="ident" id="1695717">g</span><span class="op" id="1695718">.</span><span class="ident" id="1695719">m</span><span class="op" id="1695720">.</span><span class="ident" id="1695721">throwing</span>&nbsp;<span class="op" id="1695730">&gt;</span>&nbsp;<span class="num" id="1695732">0</span>&nbsp;<span class="op" id="1695734">&amp;&amp;</span>&nbsp;<span class="ident" id="1695737">gp</span>&nbsp;<span class="op" id="1695740">==</span>&nbsp;<span class="ident" id="1695743">g</span><span class="op" id="1695744">.</span><span class="ident" id="1695745">m</span><span class="op" id="1695746">.</span><span class="ident" id="1695747">curg</span>&nbsp;<span class="op" id="1695752">||</span>&nbsp;<span class="ident" id="1695755">gotraceback</span>&nbsp;<span class="op" id="1695767">&gt;=</span>&nbsp;<span class="num" id="1695770">2</span>&nbsp;<span class="op" id="1695772">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1695779">print</span><span class="op" id="1695784">(</span><span class="string" id="1695785">&#34;&nbsp;fp=&#34;</span><span class="op" id="1695791">,</span>&nbsp;<span class="ident" id="1695793">hex</span><span class="op" id="1695796">(</span><span class="ident" id="1695797">frame</span><span class="op" id="1695802">.</span><span class="ident" id="1695803">fp</span><span class="op" id="1695805">)</span><span class="op" id="1695806">,</span>&nbsp;<span class="string" id="1695808">&#34;&nbsp;sp=&#34;</span><span class="op" id="1695814">,</span>&nbsp;<span class="ident" id="1695816">hex</span><span class="op" id="1695819">(</span><span class="ident" id="1695820">frame</span><span class="op" id="1695825">.</span><span class="ident" id="1695826">sp</span><span class="op" id="1695828">)</span><span class="op" id="1695829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1695835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1695841">print</span><span class="op" id="1695846">(</span><span class="string" id="1695847">&#34;\n&#34;</span><span class="op" id="1695851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1695857">nprint</span><span class="op" id="1695863">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1695869">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1695873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1695877">n</span><span class="op" id="1695878">++</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1695883">skipped</span><span class="op" id="1695890">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1695894">waspanic</span>&nbsp;<span class="op" id="1695903">=</span>&nbsp;<span class="ident" id="1695905">f</span><span class="op" id="1695906">.</span><span class="ident" id="1695907">entry</span>&nbsp;<span class="op" id="1695913">==</span>&nbsp;<span class="ident" id="1695916">sigpanicPC</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1695929">wasnewproc</span>&nbsp;<span class="op" id="1695940">=</span>&nbsp;<span class="ident" id="1695942">f</span><span class="op" id="1695943">.</span><span class="ident" id="1695944">entry</span>&nbsp;<span class="op" id="1695950">==</span>&nbsp;<span class="ident" id="1695953">newprocPC</span>&nbsp;<span class="op" id="1695963">||</span>&nbsp;<span class="ident" id="1695966">f</span><span class="op" id="1695967">.</span><span class="ident" id="1695968">entry</span>&nbsp;<span class="op" id="1695974">==</span>&nbsp;<span class="ident" id="1695977">deferprocPC</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1695992">//&nbsp;Do&nbsp;not&nbsp;unwind&nbsp;past&nbsp;the&nbsp;bottom&nbsp;of&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1696041">if</span>&nbsp;<span class="ident" id="1696044">flr</span>&nbsp;<span class="op" id="1696048">==</span>&nbsp;<span class="ident" id="1696051">nil</span>&nbsp;<span class="op" id="1696055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1696060">break</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1696068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1696073">//&nbsp;Unwind&nbsp;to&nbsp;next&nbsp;frame.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1696100">frame</span><span class="op" id="1696105">.</span><span class="ident" id="1696106">fn</span>&nbsp;<span class="op" id="1696109">=</span>&nbsp;<span class="ident" id="1696111">flr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1696117">frame</span><span class="op" id="1696122">.</span><span class="ident" id="1696123">pc</span>&nbsp;<span class="op" id="1696126">=</span>&nbsp;<span class="ident" id="1696128">frame</span><span class="op" id="1696133">.</span><span class="ident" id="1696134">lr</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1696139">frame</span><span class="op" id="1696144">.</span><span class="ident" id="1696145">lr</span>&nbsp;<span class="op" id="1696148">=</span>&nbsp;<span class="num" id="1696150">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1696154">frame</span><span class="op" id="1696159">.</span><span class="ident" id="1696160">sp</span>&nbsp;<span class="op" id="1696163">=</span>&nbsp;<span class="ident" id="1696165">frame</span><span class="op" id="1696170">.</span><span class="ident" id="1696171">fp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1696176">frame</span><span class="op" id="1696181">.</span><span class="ident" id="1696182">fp</span>&nbsp;<span class="op" id="1696185">=</span>&nbsp;<span class="num" id="1696187">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1696191">frame</span><span class="op" id="1696196">.</span><span class="ident" id="1696197">argmap</span>&nbsp;<span class="op" id="1696204">=</span>&nbsp;<span class="ident" id="1696206">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1696213">//&nbsp;On&nbsp;link&nbsp;register&nbsp;architectures,&nbsp;sighandler&nbsp;saves&nbsp;the&nbsp;LR&nbsp;on&nbsp;stack</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1696283">//&nbsp;before&nbsp;faking&nbsp;a&nbsp;call&nbsp;to&nbsp;sigpanic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1696322">if</span>&nbsp;<span class="ident" id="1696325">usesLR</span>&nbsp;<span class="op" id="1696332">&amp;&amp;</span>&nbsp;<span class="ident" id="1696335">waspanic</span>&nbsp;<span class="op" id="1696344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1696349">x</span>&nbsp;<span class="op" id="1696351">:=</span>&nbsp;<span class="op" id="1696354">*</span><span class="op" id="1696355">(</span><span class="op" id="1696356">*</span><span class="builtintype" id="1696357">uintptr</span><span class="op" id="1696364">)</span><span class="op" id="1696365">(</span><span class="ident" id="1696366">unsafe</span><span class="op" id="1696372">.</span><span class="ident" id="1696373">Pointer</span><span class="op" id="1696380">(</span><span class="ident" id="1696381">frame</span><span class="op" id="1696386">.</span><span class="ident" id="1696387">sp</span><span class="op" id="1696389">)</span><span class="op" id="1696390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1696395">frame</span><span class="op" id="1696400">.</span><span class="ident" id="1696401">sp</span>&nbsp;<span class="op" id="1696404">+=</span>&nbsp;<span class="ident" id="1696407">ptrSize</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1696418">f</span>&nbsp;<span class="op" id="1696420">=</span>&nbsp;<span class="ident" id="1696422">findfunc</span><span class="op" id="1696430">(</span><span class="ident" id="1696431">frame</span><span class="op" id="1696436">.</span><span class="ident" id="1696437">pc</span><span class="op" id="1696439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1696444">frame</span><span class="op" id="1696449">.</span><span class="ident" id="1696450">fn</span>&nbsp;<span class="op" id="1696453">=</span>&nbsp;<span class="ident" id="1696455">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1696460">if</span>&nbsp;<span class="ident" id="1696463">f</span>&nbsp;<span class="op" id="1696465">==</span>&nbsp;<span class="ident" id="1696468">nil</span>&nbsp;<span class="op" id="1696472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1696478">frame</span><span class="op" id="1696483">.</span><span class="ident" id="1696484">pc</span>&nbsp;<span class="op" id="1696487">=</span>&nbsp;<span class="ident" id="1696489">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1696494">}</span>&nbsp;<span class="keyword" id="1696496">else</span>&nbsp;<span class="keyword" id="1696501">if</span>&nbsp;<span class="ident" id="1696504">f</span><span class="op" id="1696505">.</span><span class="ident" id="1696506">frame</span>&nbsp;<span class="op" id="1696512">==</span>&nbsp;<span class="num" id="1696515">0</span>&nbsp;<span class="op" id="1696517">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1696523">frame</span><span class="op" id="1696528">.</span><span class="ident" id="1696529">lr</span>&nbsp;<span class="op" id="1696532">=</span>&nbsp;<span class="ident" id="1696534">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1696539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1696543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1696546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1696550">if</span>&nbsp;<span class="ident" id="1696553">pcbuf</span>&nbsp;<span class="op" id="1696559">==</span>&nbsp;<span class="ident" id="1696562">nil</span>&nbsp;<span class="op" id="1696566">&amp;&amp;</span>&nbsp;<span class="ident" id="1696569">callback</span>&nbsp;<span class="op" id="1696578">==</span>&nbsp;<span class="ident" id="1696581">nil</span>&nbsp;<span class="op" id="1696585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1696589">n</span>&nbsp;<span class="op" id="1696591">=</span>&nbsp;<span class="ident" id="1696593">nprint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1696601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1696605">//&nbsp;If&nbsp;callback&nbsp;!=&nbsp;nil,&nbsp;we&#39;re&nbsp;being&nbsp;called&nbsp;to&nbsp;gather&nbsp;stack&nbsp;information&nbsp;during</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1696683">//&nbsp;garbage&nbsp;collection&nbsp;or&nbsp;stack&nbsp;growth.&nbsp;In&nbsp;that&nbsp;context,&nbsp;require&nbsp;that&nbsp;we&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1696761">//&nbsp;up&nbsp;the&nbsp;entire&nbsp;defer&nbsp;stack.&nbsp;If&nbsp;not,&nbsp;then&nbsp;there&nbsp;is&nbsp;a&nbsp;bug&nbsp;somewhere&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1696838">//&nbsp;garbage&nbsp;collection&nbsp;or&nbsp;stack&nbsp;growth&nbsp;may&nbsp;not&nbsp;have&nbsp;seen&nbsp;the&nbsp;correct&nbsp;picture</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1696915">//&nbsp;of&nbsp;the&nbsp;stack.&nbsp;Crash&nbsp;now&nbsp;instead&nbsp;of&nbsp;silently&nbsp;executing&nbsp;the&nbsp;garbage&nbsp;collection</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1696996">//&nbsp;or&nbsp;stack&nbsp;copy&nbsp;incorrectly&nbsp;and&nbsp;setting&nbsp;up&nbsp;for&nbsp;a&nbsp;mysterious&nbsp;crash&nbsp;later.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1697071">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1697075">//&nbsp;Note&nbsp;that&nbsp;panic&nbsp;!=&nbsp;nil&nbsp;is&nbsp;okay&nbsp;here:&nbsp;there&nbsp;can&nbsp;be&nbsp;leftover&nbsp;panics,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1697146">//&nbsp;because&nbsp;the&nbsp;defers&nbsp;on&nbsp;the&nbsp;panic&nbsp;stack&nbsp;do&nbsp;not&nbsp;nest&nbsp;in&nbsp;frame&nbsp;order&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1697218">//&nbsp;they&nbsp;do&nbsp;on&nbsp;the&nbsp;defer&nbsp;stack.&nbsp;If&nbsp;you&nbsp;have:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1697263">//</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1697267">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;1&nbsp;defers&nbsp;d1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1697289">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;2&nbsp;defers&nbsp;d2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1697311">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;3&nbsp;defers&nbsp;d3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1697333">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;4&nbsp;panics</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1697352">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;4&#39;s&nbsp;panic&nbsp;starts&nbsp;running&nbsp;defers</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1697394">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;5,&nbsp;running&nbsp;d3,&nbsp;defers&nbsp;d4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1697429">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;5&nbsp;panics</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1697448">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;5&#39;s&nbsp;panic&nbsp;starts&nbsp;running&nbsp;defers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1697490">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;6,&nbsp;running&nbsp;d4,&nbsp;garbage&nbsp;collects</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1697532">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;6,&nbsp;running&nbsp;d2,&nbsp;garbage&nbsp;collects</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1697574">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1697578">//&nbsp;During&nbsp;the&nbsp;execution&nbsp;of&nbsp;d4,&nbsp;the&nbsp;panic&nbsp;stack&nbsp;is&nbsp;d4&nbsp;-&gt;&nbsp;d3,&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1697645">//&nbsp;is&nbsp;nested&nbsp;properly,&nbsp;and&nbsp;we&#39;ll&nbsp;treat&nbsp;frame&nbsp;3&nbsp;as&nbsp;resumable,&nbsp;because&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1697718">//&nbsp;can&nbsp;find&nbsp;d3.&nbsp;(And&nbsp;in&nbsp;fact&nbsp;frame&nbsp;3&nbsp;is&nbsp;resumable.&nbsp;If&nbsp;d4&nbsp;recovers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1697785">//&nbsp;and&nbsp;frame&nbsp;5&nbsp;continues&nbsp;running,&nbsp;d3,&nbsp;d3&nbsp;can&nbsp;recover&nbsp;and&nbsp;we&#39;ll</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1697849">//&nbsp;resume&nbsp;execution&nbsp;in&nbsp;(returning&nbsp;from)&nbsp;frame&nbsp;3.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1697900">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1697904">//&nbsp;During&nbsp;the&nbsp;execution&nbsp;of&nbsp;d2,&nbsp;however,&nbsp;the&nbsp;panic&nbsp;stack&nbsp;is&nbsp;d2&nbsp;-&gt;&nbsp;d3,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1697974">//&nbsp;which&nbsp;is&nbsp;inverted.&nbsp;The&nbsp;scan&nbsp;will&nbsp;match&nbsp;d2&nbsp;to&nbsp;frame&nbsp;2&nbsp;but&nbsp;having</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1698042">//&nbsp;d2&nbsp;on&nbsp;the&nbsp;stack&nbsp;until&nbsp;then&nbsp;means&nbsp;it&nbsp;will&nbsp;not&nbsp;match&nbsp;d3&nbsp;to&nbsp;frame&nbsp;3.</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1698112">//&nbsp;This&nbsp;is&nbsp;okay:&nbsp;if&nbsp;we&#39;re&nbsp;running&nbsp;d2,&nbsp;then&nbsp;all&nbsp;the&nbsp;defers&nbsp;after&nbsp;d2&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1698185">//&nbsp;completed&nbsp;and&nbsp;their&nbsp;corresponding&nbsp;frames&nbsp;are&nbsp;dead.&nbsp;Not&nbsp;finding&nbsp;d3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1698255">//&nbsp;for&nbsp;frame&nbsp;3&nbsp;means&nbsp;we&#39;ll&nbsp;set&nbsp;frame&nbsp;3&#39;s&nbsp;continpc&nbsp;==&nbsp;0,&nbsp;which&nbsp;is&nbsp;correct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1698329">//&nbsp;(frame&nbsp;3&nbsp;is&nbsp;dead).&nbsp;At&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;walk&nbsp;the&nbsp;panic&nbsp;stack&nbsp;can&nbsp;thus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1698400">//&nbsp;contain&nbsp;defers&nbsp;(d3&nbsp;in&nbsp;this&nbsp;case)&nbsp;for&nbsp;dead&nbsp;frames.&nbsp;The&nbsp;inversion&nbsp;here</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1698473">//&nbsp;always&nbsp;indicates&nbsp;a&nbsp;dead&nbsp;frame,&nbsp;and&nbsp;the&nbsp;effect&nbsp;of&nbsp;the&nbsp;inversion&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1698547">//&nbsp;scan&nbsp;is&nbsp;to&nbsp;hide&nbsp;those&nbsp;dead&nbsp;frames,&nbsp;so&nbsp;the&nbsp;scan&nbsp;is&nbsp;still&nbsp;okay:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1698613">//&nbsp;what&#39;s&nbsp;left&nbsp;on&nbsp;the&nbsp;panic&nbsp;stack&nbsp;are&nbsp;exactly&nbsp;(and&nbsp;only)&nbsp;the&nbsp;dead&nbsp;frames.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1698688">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1698692">//&nbsp;We&nbsp;require&nbsp;callback&nbsp;!=&nbsp;nil&nbsp;here&nbsp;because&nbsp;only&nbsp;when&nbsp;callback&nbsp;!=&nbsp;nil</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1698762">//&nbsp;do&nbsp;we&nbsp;know&nbsp;that&nbsp;gentraceback&nbsp;is&nbsp;being&nbsp;called&nbsp;in&nbsp;a&nbsp;&#34;must&nbsp;be&nbsp;correct&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1698834">//&nbsp;context&nbsp;as&nbsp;opposed&nbsp;to&nbsp;a&nbsp;&#34;best&nbsp;effort&#34;&nbsp;context.&nbsp;The&nbsp;tracebacks&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1698905">//&nbsp;callbacks&nbsp;only&nbsp;happen&nbsp;when&nbsp;everything&nbsp;is&nbsp;stopped&nbsp;nicely.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1698966">//&nbsp;At&nbsp;other&nbsp;times,&nbsp;such&nbsp;as&nbsp;when&nbsp;gathering&nbsp;a&nbsp;stack&nbsp;for&nbsp;a&nbsp;profiling&nbsp;signal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1699040">//&nbsp;or&nbsp;when&nbsp;printing&nbsp;a&nbsp;traceback&nbsp;during&nbsp;a&nbsp;crash,&nbsp;everything&nbsp;may&nbsp;not&nbsp;be</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1699111">//&nbsp;stopped&nbsp;nicely,&nbsp;and&nbsp;the&nbsp;stack&nbsp;walk&nbsp;may&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;complete.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1699179">//&nbsp;It&#39;s&nbsp;okay&nbsp;in&nbsp;those&nbsp;situations&nbsp;not&nbsp;to&nbsp;use&nbsp;up&nbsp;the&nbsp;entire&nbsp;defer&nbsp;stack:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1699251">//&nbsp;incomplete&nbsp;information&nbsp;then&nbsp;is&nbsp;still&nbsp;better&nbsp;than&nbsp;nothing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1699313">if</span>&nbsp;<span class="ident" id="1699316">callback</span>&nbsp;<span class="op" id="1699325">!=</span>&nbsp;<span class="ident" id="1699328">nil</span>&nbsp;<span class="op" id="1699332">&amp;&amp;</span>&nbsp;<span class="ident" id="1699335">n</span>&nbsp;<span class="op" id="1699337">&lt;</span>&nbsp;<span class="ident" id="1699339">max</span>&nbsp;<span class="op" id="1699343">&amp;&amp;</span>&nbsp;<span class="ident" id="1699346">_defer</span>&nbsp;<span class="op" id="1699353">!=</span>&nbsp;<span class="ident" id="1699356">nil</span>&nbsp;<span class="op" id="1699360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1699364">if</span>&nbsp;<span class="ident" id="1699367">_defer</span>&nbsp;<span class="op" id="1699374">!=</span>&nbsp;<span class="ident" id="1699377">nil</span>&nbsp;<span class="op" id="1699381">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1699386">print</span><span class="op" id="1699391">(</span><span class="string" id="1699392">&#34;runtime:&nbsp;g&#34;</span><span class="op" id="1699404">,</span>&nbsp;<span class="ident" id="1699406">gp</span><span class="op" id="1699408">.</span><span class="ident" id="1699409">goid</span><span class="op" id="1699413">,</span>&nbsp;<span class="string" id="1699415">&#34;:&nbsp;leftover&nbsp;defer&nbsp;argp=&#34;</span><span class="op" id="1699439">,</span>&nbsp;<span class="ident" id="1699441">hex</span><span class="op" id="1699444">(</span><span class="ident" id="1699445">_defer</span><span class="op" id="1699451">.</span><span class="ident" id="1699452">argp</span><span class="op" id="1699456">)</span><span class="op" id="1699457">,</span>&nbsp;<span class="string" id="1699459">&#34;&nbsp;pc=&#34;</span><span class="op" id="1699465">,</span>&nbsp;<span class="ident" id="1699467">hex</span><span class="op" id="1699470">(</span><span class="ident" id="1699471">_defer</span><span class="op" id="1699477">.</span><span class="ident" id="1699478">pc</span><span class="op" id="1699480">)</span><span class="op" id="1699481">,</span>&nbsp;<span class="string" id="1699483">&#34;\n&#34;</span><span class="op" id="1699487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1699491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1699495">for</span>&nbsp;<span class="ident" id="1699499">_defer</span>&nbsp;<span class="op" id="1699506">=</span>&nbsp;<span class="ident" id="1699508">gp</span><span class="op" id="1699510">.</span><span class="ident" id="1699511">_defer</span><span class="op" id="1699517">;</span>&nbsp;<span class="ident" id="1699519">_defer</span>&nbsp;<span class="op" id="1699526">!=</span>&nbsp;<span class="ident" id="1699529">nil</span><span class="op" id="1699532">;</span>&nbsp;<span class="ident" id="1699534">_defer</span>&nbsp;<span class="op" id="1699541">=</span>&nbsp;<span class="ident" id="1699543">_defer</span><span class="op" id="1699549">.</span><span class="ident" id="1699550">link</span>&nbsp;<span class="op" id="1699555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1699560">print</span><span class="op" id="1699565">(</span><span class="string" id="1699566">&#34;\tdefer&nbsp;&#34;</span><span class="op" id="1699576">,</span>&nbsp;<span class="ident" id="1699578">_defer</span><span class="op" id="1699584">,</span>&nbsp;<span class="string" id="1699586">&#34;&nbsp;argp=&#34;</span><span class="op" id="1699594">,</span>&nbsp;<span class="ident" id="1699596">hex</span><span class="op" id="1699599">(</span><span class="ident" id="1699600">_defer</span><span class="op" id="1699606">.</span><span class="ident" id="1699607">argp</span><span class="op" id="1699611">)</span><span class="op" id="1699612">,</span>&nbsp;<span class="string" id="1699614">&#34;&nbsp;pc=&#34;</span><span class="op" id="1699620">,</span>&nbsp;<span class="ident" id="1699622">hex</span><span class="op" id="1699625">(</span><span class="ident" id="1699626">_defer</span><span class="op" id="1699632">.</span><span class="ident" id="1699633">pc</span><span class="op" id="1699635">)</span><span class="op" id="1699636">,</span>&nbsp;<span class="string" id="1699638">&#34;\n&#34;</span><span class="op" id="1699642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1699646">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1699650">gothrow</span><span class="op" id="1699657">(</span><span class="string" id="1699658">&#34;traceback&nbsp;has&nbsp;leftover&nbsp;defers&#34;</span><span class="op" id="1699689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1699692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1699696">return</span>&nbsp;<span class="ident" id="1699703">n</span><br>
<span class="lineno"></span><span class="op" id="1699705">}</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span><span class="keyword" id="1699708">func</span>&nbsp;<span class="ident" id="1699713">setArgInfo</span><span class="op" id="1699723">(</span><span class="ident" id="1699724">frame</span>&nbsp;<span class="op" id="1699730">*</span><span class="ident" id="1699731">stkframe</span><span class="op" id="1699739">,</span>&nbsp;<span class="ident" id="1699741">f</span>&nbsp;<span class="op" id="1699743">*</span><span class="ident" id="1699744">_func</span><span class="op" id="1699749">,</span>&nbsp;<span class="ident" id="1699751">needArgMap</span>&nbsp;<span class="builtintype" id="1699762">bool</span><span class="op" id="1699766">)</span>&nbsp;<span class="op" id="1699768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1699771">frame</span><span class="op" id="1699776">.</span><span class="ident" id="1699777">arglen</span>&nbsp;<span class="op" id="1699784">=</span>&nbsp;<span class="builtintype" id="1699786">uintptr</span><span class="op" id="1699793">(</span><span class="ident" id="1699794">f</span><span class="op" id="1699795">.</span><span class="ident" id="1699796">args</span><span class="op" id="1699800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1699803">if</span>&nbsp;<span class="ident" id="1699806">needArgMap</span>&nbsp;<span class="op" id="1699817">&amp;&amp;</span>&nbsp;<span class="ident" id="1699820">f</span><span class="op" id="1699821">.</span><span class="ident" id="1699822">args</span>&nbsp;<span class="op" id="1699827">==</span>&nbsp;<span class="ident" id="1699830">_ArgsSizeUnknown</span>&nbsp;<span class="op" id="1699847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1699851">//&nbsp;Extract&nbsp;argument&nbsp;bitmaps&nbsp;for&nbsp;reflect&nbsp;stubs&nbsp;from&nbsp;the&nbsp;calls&nbsp;they&nbsp;made&nbsp;to&nbsp;reflect.</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1699936">switch</span>&nbsp;<span class="ident" id="1699943">gofuncname</span><span class="op" id="1699953">(</span><span class="ident" id="1699954">f</span><span class="op" id="1699955">)</span>&nbsp;<span class="op" id="1699957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1699961">case</span>&nbsp;<span class="string" id="1699966">&#34;reflect.makeFuncStub&#34;</span><span class="op" id="1699988">,</span>&nbsp;<span class="string" id="1699990">&#34;reflect.methodValueCall&#34;</span><span class="op" id="1700015">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1700020">arg0</span>&nbsp;<span class="op" id="1700025">:=</span>&nbsp;<span class="ident" id="1700028">frame</span><span class="op" id="1700033">.</span><span class="ident" id="1700034">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1700040">if</span>&nbsp;<span class="ident" id="1700043">usesLR</span>&nbsp;<span class="op" id="1700050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1700056">arg0</span>&nbsp;<span class="op" id="1700061">+=</span>&nbsp;<span class="ident" id="1700064">ptrSize</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1700075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1700080">fn</span>&nbsp;<span class="op" id="1700083">:=</span>&nbsp;<span class="op" id="1700086">*</span><span class="op" id="1700087">(</span><span class="op" id="1700088">*</span><span class="op" id="1700089">*</span><span class="op" id="1700090">[</span><span class="num" id="1700091">2</span><span class="op" id="1700092">]</span><span class="builtintype" id="1700093">uintptr</span><span class="op" id="1700100">)</span><span class="op" id="1700101">(</span><span class="ident" id="1700102">unsafe</span><span class="op" id="1700108">.</span><span class="ident" id="1700109">Pointer</span><span class="op" id="1700116">(</span><span class="ident" id="1700117">arg0</span><span class="op" id="1700121">)</span><span class="op" id="1700122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1700127">if</span>&nbsp;<span class="ident" id="1700130">fn</span><span class="op" id="1700132">[</span><span class="num" id="1700133">0</span><span class="op" id="1700134">]</span>&nbsp;<span class="op" id="1700136">!=</span>&nbsp;<span class="ident" id="1700139">f</span><span class="op" id="1700140">.</span><span class="ident" id="1700141">entry</span>&nbsp;<span class="op" id="1700147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1700153">print</span><span class="op" id="1700158">(</span><span class="string" id="1700159">&#34;runtime:&nbsp;confused&nbsp;by&nbsp;&#34;</span><span class="op" id="1700182">,</span>&nbsp;<span class="ident" id="1700184">gofuncname</span><span class="op" id="1700194">(</span><span class="ident" id="1700195">f</span><span class="op" id="1700196">)</span><span class="op" id="1700197">,</span>&nbsp;<span class="string" id="1700199">&#34;\n&#34;</span><span class="op" id="1700203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1700209">gothrow</span><span class="op" id="1700216">(</span><span class="string" id="1700217">&#34;reflect&nbsp;mismatch&#34;</span><span class="op" id="1700235">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1700240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1700245">bv</span>&nbsp;<span class="op" id="1700248">:=</span>&nbsp;<span class="op" id="1700251">(</span><span class="op" id="1700252">*</span><span class="ident" id="1700253">bitvector</span><span class="op" id="1700262">)</span><span class="op" id="1700263">(</span><span class="ident" id="1700264">unsafe</span><span class="op" id="1700270">.</span><span class="ident" id="1700271">Pointer</span><span class="op" id="1700278">(</span><span class="ident" id="1700279">fn</span><span class="op" id="1700281">[</span><span class="num" id="1700282">1</span><span class="op" id="1700283">]</span><span class="op" id="1700284">)</span><span class="op" id="1700285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1700290">frame</span><span class="op" id="1700295">.</span><span class="ident" id="1700296">arglen</span>&nbsp;<span class="op" id="1700303">=</span>&nbsp;<span class="builtintype" id="1700305">uintptr</span><span class="op" id="1700312">(</span><span class="ident" id="1700313">bv</span><span class="op" id="1700315">.</span><span class="ident" id="1700316">n</span>&nbsp;<span class="op" id="1700318">/</span>&nbsp;<span class="num" id="1700320">2</span>&nbsp;<span class="op" id="1700322">*</span>&nbsp;<span class="ident" id="1700324">ptrSize</span><span class="op" id="1700331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1700336">frame</span><span class="op" id="1700341">.</span><span class="ident" id="1700342">argmap</span>&nbsp;<span class="op" id="1700349">=</span>&nbsp;<span class="ident" id="1700351">bv</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1700356">}</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1700359">}</span><br>
<span class="lineno"></span><span class="op" id="1700361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1700364">func</span>&nbsp;<span class="ident" id="1700369">printcreatedby</span><span class="op" id="1700383">(</span><span class="ident" id="1700384">gp</span>&nbsp;<span class="op" id="1700387">*</span><span class="ident" id="1700388">g</span><span class="op" id="1700389">)</span>&nbsp;<span class="op" id="1700391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1700394">//&nbsp;Show&nbsp;what&nbsp;created&nbsp;goroutine,&nbsp;except&nbsp;main&nbsp;goroutine&nbsp;(goid&nbsp;1).</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1700459">pc</span>&nbsp;<span class="op" id="1700462">:=</span>&nbsp;<span class="ident" id="1700465">gp</span><span class="op" id="1700467">.</span><span class="ident" id="1700468">gopc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1700474">f</span>&nbsp;<span class="op" id="1700476">:=</span>&nbsp;<span class="ident" id="1700479">findfunc</span><span class="op" id="1700487">(</span><span class="ident" id="1700488">pc</span><span class="op" id="1700490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1700493">if</span>&nbsp;<span class="ident" id="1700496">f</span>&nbsp;<span class="op" id="1700498">!=</span>&nbsp;<span class="ident" id="1700501">nil</span>&nbsp;<span class="op" id="1700505">&amp;&amp;</span>&nbsp;<span class="ident" id="1700508">showframe</span><span class="op" id="1700517">(</span><span class="ident" id="1700518">f</span><span class="op" id="1700519">,</span>&nbsp;<span class="ident" id="1700521">gp</span><span class="op" id="1700523">)</span>&nbsp;<span class="op" id="1700525">&amp;&amp;</span>&nbsp;<span class="ident" id="1700528">gp</span><span class="op" id="1700530">.</span><span class="ident" id="1700531">goid</span>&nbsp;<span class="op" id="1700536">!=</span>&nbsp;<span class="num" id="1700539">1</span>&nbsp;<span class="op" id="1700541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1700545">print</span><span class="op" id="1700550">(</span><span class="string" id="1700551">&#34;created&nbsp;by&nbsp;&#34;</span><span class="op" id="1700564">,</span>&nbsp;<span class="ident" id="1700566">gofuncname</span><span class="op" id="1700576">(</span><span class="ident" id="1700577">f</span><span class="op" id="1700578">)</span><span class="op" id="1700579">,</span>&nbsp;<span class="string" id="1700581">&#34;\n&#34;</span><span class="op" id="1700585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1700589">tracepc</span>&nbsp;<span class="op" id="1700597">:=</span>&nbsp;<span class="ident" id="1700600">pc</span>&nbsp;<span class="comment" id="1700603">//&nbsp;back&nbsp;up&nbsp;to&nbsp;CALL&nbsp;instruction&nbsp;for&nbsp;funcline.</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1700650">if</span>&nbsp;<span class="ident" id="1700653">pc</span>&nbsp;<span class="op" id="1700656">&gt;</span>&nbsp;<span class="ident" id="1700658">f</span><span class="op" id="1700659">.</span><span class="ident" id="1700660">entry</span>&nbsp;<span class="op" id="1700666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1700671">tracepc</span>&nbsp;<span class="op" id="1700679">-=</span>&nbsp;<span class="ident" id="1700682">_PCQuantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1700695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1700699">var</span>&nbsp;<span class="ident" id="1700703">file</span>&nbsp;<span class="builtintype" id="1700708">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1700717">line</span>&nbsp;<span class="op" id="1700722">:=</span>&nbsp;<span class="ident" id="1700725">funcline</span><span class="op" id="1700733">(</span><span class="ident" id="1700734">f</span><span class="op" id="1700735">,</span>&nbsp;<span class="ident" id="1700737">tracepc</span><span class="op" id="1700744">,</span>&nbsp;<span class="op" id="1700746">&amp;</span><span class="ident" id="1700747">file</span><span class="op" id="1700751">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1700755">print</span><span class="op" id="1700760">(</span><span class="string" id="1700761">&#34;\t&#34;</span><span class="op" id="1700765">,</span>&nbsp;<span class="ident" id="1700767">file</span><span class="op" id="1700771">,</span>&nbsp;<span class="string" id="1700773">&#34;:&#34;</span><span class="op" id="1700776">,</span>&nbsp;<span class="ident" id="1700778">line</span><span class="op" id="1700782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1700786">if</span>&nbsp;<span class="ident" id="1700789">pc</span>&nbsp;<span class="op" id="1700792">&gt;</span>&nbsp;<span class="ident" id="1700794">f</span><span class="op" id="1700795">.</span><span class="ident" id="1700796">entry</span>&nbsp;<span class="op" id="1700802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1700807">print</span><span class="op" id="1700812">(</span><span class="string" id="1700813">&#34;&nbsp;+&#34;</span><span class="op" id="1700817">,</span>&nbsp;<span class="ident" id="1700819">hex</span><span class="op" id="1700822">(</span><span class="ident" id="1700823">pc</span><span class="op" id="1700825">-</span><span class="ident" id="1700826">f</span><span class="op" id="1700827">.</span><span class="ident" id="1700828">entry</span><span class="op" id="1700833">)</span><span class="op" id="1700834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1700838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1700842">print</span><span class="op" id="1700847">(</span><span class="string" id="1700848">&#34;\n&#34;</span><span class="op" id="1700852">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1700855">}</span><br>
<span class="lineno"></span><span class="op" id="1700857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1700860">func</span>&nbsp;<span class="ident" id="1700865">traceback</span><span class="op" id="1700874">(</span><span class="ident" id="1700875">pc</span>&nbsp;<span class="builtintype" id="1700878">uintptr</span><span class="op" id="1700885">,</span>&nbsp;<span class="ident" id="1700887">sp</span>&nbsp;<span class="builtintype" id="1700890">uintptr</span><span class="op" id="1700897">,</span>&nbsp;<span class="ident" id="1700899">lr</span>&nbsp;<span class="builtintype" id="1700902">uintptr</span><span class="op" id="1700909">,</span>&nbsp;<span class="ident" id="1700911">gp</span>&nbsp;<span class="op" id="1700914">*</span><span class="ident" id="1700915">g</span><span class="op" id="1700916">)</span>&nbsp;<span class="op" id="1700918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1700921">traceback1</span><span class="op" id="1700931">(</span><span class="ident" id="1700932">pc</span><span class="op" id="1700934">,</span>&nbsp;<span class="ident" id="1700936">sp</span><span class="op" id="1700938">,</span>&nbsp;<span class="ident" id="1700940">lr</span><span class="op" id="1700942">,</span>&nbsp;<span class="ident" id="1700944">gp</span><span class="op" id="1700946">,</span>&nbsp;<span class="num" id="1700948">0</span><span class="op" id="1700949">)</span><br>
<span class="lineno">495</span><span class="op" id="1700951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1700954">//&nbsp;tracebacktrap&nbsp;is&nbsp;like&nbsp;traceback&nbsp;but&nbsp;expects&nbsp;that&nbsp;the&nbsp;PC&nbsp;and&nbsp;SP&nbsp;were&nbsp;obtained</span><br>
<span class="lineno"></span><span class="comment" id="1701034">//&nbsp;from&nbsp;a&nbsp;trap,&nbsp;not&nbsp;from&nbsp;gp-&gt;sched&nbsp;or&nbsp;gp-&gt;syscallpc/gp-&gt;syscallsp&nbsp;or&nbsp;getcallerpc/getcallersp.</span><br>
<span class="lineno"></span><span class="comment" id="1701128">//&nbsp;Because&nbsp;they&nbsp;are&nbsp;from&nbsp;a&nbsp;trap&nbsp;instead&nbsp;of&nbsp;from&nbsp;a&nbsp;saved&nbsp;pair,</span><br>
<span class="lineno">500</span><span class="comment" id="1701190">//&nbsp;the&nbsp;initial&nbsp;PC&nbsp;must&nbsp;not&nbsp;be&nbsp;rewound&nbsp;to&nbsp;the&nbsp;previous&nbsp;instruction.</span><br>
<span class="lineno"></span><span class="comment" id="1701257">//&nbsp;(All&nbsp;the&nbsp;saved&nbsp;pairs&nbsp;record&nbsp;a&nbsp;PC&nbsp;that&nbsp;is&nbsp;a&nbsp;return&nbsp;address,&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span><span class="comment" id="1701325">//&nbsp;rewind&nbsp;it&nbsp;into&nbsp;the&nbsp;CALL&nbsp;instruction.)</span><br>
<span class="lineno"></span><span class="keyword" id="1701366">func</span>&nbsp;<span class="ident" id="1701371">tracebacktrap</span><span class="op" id="1701384">(</span><span class="ident" id="1701385">pc</span>&nbsp;<span class="builtintype" id="1701388">uintptr</span><span class="op" id="1701395">,</span>&nbsp;<span class="ident" id="1701397">sp</span>&nbsp;<span class="builtintype" id="1701400">uintptr</span><span class="op" id="1701407">,</span>&nbsp;<span class="ident" id="1701409">lr</span>&nbsp;<span class="builtintype" id="1701412">uintptr</span><span class="op" id="1701419">,</span>&nbsp;<span class="ident" id="1701421">gp</span>&nbsp;<span class="op" id="1701424">*</span><span class="ident" id="1701425">g</span><span class="op" id="1701426">)</span>&nbsp;<span class="op" id="1701428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1701431">traceback1</span><span class="op" id="1701441">(</span><span class="ident" id="1701442">pc</span><span class="op" id="1701444">,</span>&nbsp;<span class="ident" id="1701446">sp</span><span class="op" id="1701448">,</span>&nbsp;<span class="ident" id="1701450">lr</span><span class="op" id="1701452">,</span>&nbsp;<span class="ident" id="1701454">gp</span><span class="op" id="1701456">,</span>&nbsp;<span class="ident" id="1701458">_TraceTrap</span><span class="op" id="1701468">)</span><br>
<span class="lineno">505</span><span class="op" id="1701470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1701473">func</span>&nbsp;<span class="ident" id="1701478">traceback1</span><span class="op" id="1701488">(</span><span class="ident" id="1701489">pc</span>&nbsp;<span class="builtintype" id="1701492">uintptr</span><span class="op" id="1701499">,</span>&nbsp;<span class="ident" id="1701501">sp</span>&nbsp;<span class="builtintype" id="1701504">uintptr</span><span class="op" id="1701511">,</span>&nbsp;<span class="ident" id="1701513">lr</span>&nbsp;<span class="builtintype" id="1701516">uintptr</span><span class="op" id="1701523">,</span>&nbsp;<span class="ident" id="1701525">gp</span>&nbsp;<span class="op" id="1701528">*</span><span class="ident" id="1701529">g</span><span class="op" id="1701530">,</span>&nbsp;<span class="ident" id="1701532">flags</span>&nbsp;<span class="builtintype" id="1701538">uint</span><span class="op" id="1701542">)</span>&nbsp;<span class="op" id="1701544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1701547">var</span>&nbsp;<span class="ident" id="1701551">n</span>&nbsp;<span class="builtintype" id="1701553">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1701558">if</span>&nbsp;<span class="ident" id="1701561">readgstatus</span><span class="op" id="1701572">(</span><span class="ident" id="1701573">gp</span><span class="op" id="1701575">)</span><span class="op" id="1701576">&amp;^</span><span class="ident" id="1701578">_Gscan</span>&nbsp;<span class="op" id="1701585">==</span>&nbsp;<span class="ident" id="1701588">_Gsyscall</span>&nbsp;<span class="op" id="1701598">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1701602">//&nbsp;Override&nbsp;registers&nbsp;if&nbsp;blocked&nbsp;in&nbsp;system&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1701653">pc</span>&nbsp;<span class="op" id="1701656">=</span>&nbsp;<span class="ident" id="1701658">gp</span><span class="op" id="1701660">.</span><span class="ident" id="1701661">syscallpc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1701673">sp</span>&nbsp;<span class="op" id="1701676">=</span>&nbsp;<span class="ident" id="1701678">gp</span><span class="op" id="1701680">.</span><span class="ident" id="1701681">syscallsp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1701693">flags</span>&nbsp;<span class="op" id="1701699">&amp;^=</span>&nbsp;<span class="ident" id="1701703">_TraceTrap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1701715">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1701718">//&nbsp;Print&nbsp;traceback.&nbsp;By&nbsp;default,&nbsp;omits&nbsp;runtime&nbsp;frames.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1701773">//&nbsp;If&nbsp;that&nbsp;means&nbsp;we&nbsp;print&nbsp;nothing&nbsp;at&nbsp;all,&nbsp;repeat&nbsp;forcing&nbsp;all&nbsp;frames&nbsp;printed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1701851">n</span>&nbsp;<span class="op" id="1701853">=</span>&nbsp;<span class="ident" id="1701855">gentraceback</span><span class="op" id="1701867">(</span><span class="ident" id="1701868">pc</span><span class="op" id="1701870">,</span>&nbsp;<span class="ident" id="1701872">sp</span><span class="op" id="1701874">,</span>&nbsp;<span class="ident" id="1701876">lr</span><span class="op" id="1701878">,</span>&nbsp;<span class="ident" id="1701880">gp</span><span class="op" id="1701882">,</span>&nbsp;<span class="num" id="1701884">0</span><span class="op" id="1701885">,</span>&nbsp;<span class="ident" id="1701887">nil</span><span class="op" id="1701890">,</span>&nbsp;<span class="ident" id="1701892">_TracebackMaxFrames</span><span class="op" id="1701911">,</span>&nbsp;<span class="ident" id="1701913">nil</span><span class="op" id="1701916">,</span>&nbsp;<span class="ident" id="1701918">nil</span><span class="op" id="1701921">,</span>&nbsp;<span class="ident" id="1701923">flags</span><span class="op" id="1701928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1701931">if</span>&nbsp;<span class="ident" id="1701934">n</span>&nbsp;<span class="op" id="1701936">==</span>&nbsp;<span class="num" id="1701939">0</span>&nbsp;<span class="op" id="1701941">&amp;&amp;</span>&nbsp;<span class="op" id="1701944">(</span><span class="ident" id="1701945">flags</span><span class="op" id="1701950">&amp;</span><span class="ident" id="1701951">_TraceRuntimeFrames</span><span class="op" id="1701970">)</span>&nbsp;<span class="op" id="1701972">==</span>&nbsp;<span class="num" id="1701975">0</span>&nbsp;<span class="op" id="1701977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1701981">n</span>&nbsp;<span class="op" id="1701983">=</span>&nbsp;<span class="ident" id="1701985">gentraceback</span><span class="op" id="1701997">(</span><span class="ident" id="1701998">pc</span><span class="op" id="1702000">,</span>&nbsp;<span class="ident" id="1702002">sp</span><span class="op" id="1702004">,</span>&nbsp;<span class="ident" id="1702006">lr</span><span class="op" id="1702008">,</span>&nbsp;<span class="ident" id="1702010">gp</span><span class="op" id="1702012">,</span>&nbsp;<span class="num" id="1702014">0</span><span class="op" id="1702015">,</span>&nbsp;<span class="ident" id="1702017">nil</span><span class="op" id="1702020">,</span>&nbsp;<span class="ident" id="1702022">_TracebackMaxFrames</span><span class="op" id="1702041">,</span>&nbsp;<span class="ident" id="1702043">nil</span><span class="op" id="1702046">,</span>&nbsp;<span class="ident" id="1702048">nil</span><span class="op" id="1702051">,</span>&nbsp;<span class="ident" id="1702053">flags</span><span class="op" id="1702058">|</span><span class="ident" id="1702059">_TraceRuntimeFrames</span><span class="op" id="1702078">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1702081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1702084">if</span>&nbsp;<span class="ident" id="1702087">n</span>&nbsp;<span class="op" id="1702089">==</span>&nbsp;<span class="ident" id="1702092">_TracebackMaxFrames</span>&nbsp;<span class="op" id="1702112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1702116">print</span><span class="op" id="1702121">(</span><span class="string" id="1702122">&#34;...additional&nbsp;frames&nbsp;elided...\n&#34;</span><span class="op" id="1702156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1702159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1702162">printcreatedby</span><span class="op" id="1702176">(</span><span class="ident" id="1702177">gp</span><span class="op" id="1702179">)</span><br>
<span class="lineno">525</span><span class="op" id="1702181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1702184">func</span>&nbsp;<span class="ident" id="1702189">callers</span><span class="op" id="1702196">(</span><span class="ident" id="1702197">skip</span>&nbsp;<span class="builtintype" id="1702202">int</span><span class="op" id="1702205">,</span>&nbsp;<span class="ident" id="1702207">pcbuf</span>&nbsp;<span class="op" id="1702213">*</span><span class="builtintype" id="1702214">uintptr</span><span class="op" id="1702221">,</span>&nbsp;<span class="ident" id="1702223">m</span>&nbsp;<span class="builtintype" id="1702225">int</span><span class="op" id="1702228">)</span>&nbsp;<span class="builtintype" id="1702230">int</span>&nbsp;<span class="op" id="1702234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1702237">sp</span>&nbsp;<span class="op" id="1702240">:=</span>&nbsp;<span class="ident" id="1702243">getcallersp</span><span class="op" id="1702254">(</span><span class="ident" id="1702255">unsafe</span><span class="op" id="1702261">.</span><span class="ident" id="1702262">Pointer</span><span class="op" id="1702269">(</span><span class="op" id="1702270">&amp;</span><span class="ident" id="1702271">skip</span><span class="op" id="1702275">)</span><span class="op" id="1702276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1702279">pc</span>&nbsp;<span class="op" id="1702282">:=</span>&nbsp;<span class="builtintype" id="1702285">uintptr</span><span class="op" id="1702292">(</span><span class="ident" id="1702293">getcallerpc</span><span class="op" id="1702304">(</span><span class="ident" id="1702305">unsafe</span><span class="op" id="1702311">.</span><span class="ident" id="1702312">Pointer</span><span class="op" id="1702319">(</span><span class="op" id="1702320">&amp;</span><span class="ident" id="1702321">skip</span><span class="op" id="1702325">)</span><span class="op" id="1702326">)</span><span class="op" id="1702327">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1702330">var</span>&nbsp;<span class="ident" id="1702334">n</span>&nbsp;<span class="builtintype" id="1702336">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1702341">onM</span><span class="op" id="1702344">(</span><span class="keyword" id="1702345">func</span><span class="op" id="1702349">(</span><span class="op" id="1702350">)</span>&nbsp;<span class="op" id="1702352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1702356">n</span>&nbsp;<span class="op" id="1702358">=</span>&nbsp;<span class="ident" id="1702360">gentraceback</span><span class="op" id="1702372">(</span><span class="ident" id="1702373">pc</span><span class="op" id="1702375">,</span>&nbsp;<span class="ident" id="1702377">sp</span><span class="op" id="1702379">,</span>&nbsp;<span class="num" id="1702381">0</span><span class="op" id="1702382">,</span>&nbsp;<span class="ident" id="1702384">getg</span><span class="op" id="1702388">(</span><span class="op" id="1702389">)</span><span class="op" id="1702390">,</span>&nbsp;<span class="ident" id="1702392">skip</span><span class="op" id="1702396">,</span>&nbsp;<span class="ident" id="1702398">pcbuf</span><span class="op" id="1702403">,</span>&nbsp;<span class="ident" id="1702405">m</span><span class="op" id="1702406">,</span>&nbsp;<span class="ident" id="1702408">nil</span><span class="op" id="1702411">,</span>&nbsp;<span class="ident" id="1702413">nil</span><span class="op" id="1702416">,</span>&nbsp;<span class="num" id="1702418">0</span><span class="op" id="1702419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1702422">}</span><span class="op" id="1702423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1702426">return</span>&nbsp;<span class="ident" id="1702433">n</span><br>
<span class="lineno">535</span><span class="op" id="1702435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1702438">func</span>&nbsp;<span class="ident" id="1702443">gcallers</span><span class="op" id="1702451">(</span><span class="ident" id="1702452">gp</span>&nbsp;<span class="op" id="1702455">*</span><span class="ident" id="1702456">g</span><span class="op" id="1702457">,</span>&nbsp;<span class="ident" id="1702459">skip</span>&nbsp;<span class="builtintype" id="1702464">int</span><span class="op" id="1702467">,</span>&nbsp;<span class="ident" id="1702469">pcbuf</span>&nbsp;<span class="op" id="1702475">*</span><span class="builtintype" id="1702476">uintptr</span><span class="op" id="1702483">,</span>&nbsp;<span class="ident" id="1702485">m</span>&nbsp;<span class="builtintype" id="1702487">int</span><span class="op" id="1702490">)</span>&nbsp;<span class="builtintype" id="1702492">int</span>&nbsp;<span class="op" id="1702496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1702499">return</span>&nbsp;<span class="ident" id="1702506">gentraceback</span><span class="op" id="1702518">(</span><span class="op" id="1702519">^</span><span class="builtintype" id="1702520">uintptr</span><span class="op" id="1702527">(</span><span class="num" id="1702528">0</span><span class="op" id="1702529">)</span><span class="op" id="1702530">,</span>&nbsp;<span class="op" id="1702532">^</span><span class="builtintype" id="1702533">uintptr</span><span class="op" id="1702540">(</span><span class="num" id="1702541">0</span><span class="op" id="1702542">)</span><span class="op" id="1702543">,</span>&nbsp;<span class="num" id="1702545">0</span><span class="op" id="1702546">,</span>&nbsp;<span class="ident" id="1702548">gp</span><span class="op" id="1702550">,</span>&nbsp;<span class="ident" id="1702552">skip</span><span class="op" id="1702556">,</span>&nbsp;<span class="ident" id="1702558">pcbuf</span><span class="op" id="1702563">,</span>&nbsp;<span class="ident" id="1702565">m</span><span class="op" id="1702566">,</span>&nbsp;<span class="ident" id="1702568">nil</span><span class="op" id="1702571">,</span>&nbsp;<span class="ident" id="1702573">nil</span><span class="op" id="1702576">,</span>&nbsp;<span class="num" id="1702578">0</span><span class="op" id="1702579">)</span><br>
<span class="lineno"></span><span class="op" id="1702581">}</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span><span class="keyword" id="1702584">func</span>&nbsp;<span class="ident" id="1702589">showframe</span><span class="op" id="1702598">(</span><span class="ident" id="1702599">f</span>&nbsp;<span class="op" id="1702601">*</span><span class="ident" id="1702602">_func</span><span class="op" id="1702607">,</span>&nbsp;<span class="ident" id="1702609">gp</span>&nbsp;<span class="op" id="1702612">*</span><span class="ident" id="1702613">g</span><span class="op" id="1702614">)</span>&nbsp;<span class="builtintype" id="1702616">bool</span>&nbsp;<span class="op" id="1702621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1702624">g</span>&nbsp;<span class="op" id="1702626">:=</span>&nbsp;<span class="ident" id="1702629">getg</span><span class="op" id="1702633">(</span><span class="op" id="1702634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1702637">if</span>&nbsp;<span class="ident" id="1702640">g</span><span class="op" id="1702641">.</span><span class="ident" id="1702642">m</span><span class="op" id="1702643">.</span><span class="ident" id="1702644">throwing</span>&nbsp;<span class="op" id="1702653">&gt;</span>&nbsp;<span class="num" id="1702655">0</span>&nbsp;<span class="op" id="1702657">&amp;&amp;</span>&nbsp;<span class="ident" id="1702660">gp</span>&nbsp;<span class="op" id="1702663">!=</span>&nbsp;<span class="ident" id="1702666">nil</span>&nbsp;<span class="op" id="1702670">&amp;&amp;</span>&nbsp;<span class="op" id="1702673">(</span><span class="ident" id="1702674">gp</span>&nbsp;<span class="op" id="1702677">==</span>&nbsp;<span class="ident" id="1702680">g</span><span class="op" id="1702681">.</span><span class="ident" id="1702682">m</span><span class="op" id="1702683">.</span><span class="ident" id="1702684">curg</span>&nbsp;<span class="op" id="1702689">||</span>&nbsp;<span class="ident" id="1702692">gp</span>&nbsp;<span class="op" id="1702695">==</span>&nbsp;<span class="ident" id="1702698">g</span><span class="op" id="1702699">.</span><span class="ident" id="1702700">m</span><span class="op" id="1702701">.</span><span class="ident" id="1702702">caughtsig</span><span class="op" id="1702711">)</span>&nbsp;<span class="op" id="1702713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1702717">return</span>&nbsp;<span class="builtintype" id="1702724">true</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1702730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1702733">traceback</span>&nbsp;<span class="op" id="1702743">:=</span>&nbsp;<span class="ident" id="1702746">gotraceback</span><span class="op" id="1702757">(</span><span class="ident" id="1702758">nil</span><span class="op" id="1702761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1702764">name</span>&nbsp;<span class="op" id="1702769">:=</span>&nbsp;<span class="ident" id="1702772">gostringnocopy</span><span class="op" id="1702786">(</span><span class="ident" id="1702787">funcname</span><span class="op" id="1702795">(</span><span class="ident" id="1702796">f</span><span class="op" id="1702797">)</span><span class="op" id="1702798">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1702802">//&nbsp;Special&nbsp;case:&nbsp;always&nbsp;show&nbsp;runtime.panic&nbsp;frame,&nbsp;so&nbsp;that&nbsp;we&nbsp;can</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1702868">//&nbsp;see&nbsp;where&nbsp;a&nbsp;panic&nbsp;started&nbsp;in&nbsp;the&nbsp;middle&nbsp;of&nbsp;a&nbsp;stack&nbsp;trace.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1702930">//&nbsp;See&nbsp;golang.org/issue/5832.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1702961">if</span>&nbsp;<span class="ident" id="1702964">name</span>&nbsp;<span class="op" id="1702969">==</span>&nbsp;<span class="string" id="1702972">&#34;runtime.panic&#34;</span>&nbsp;<span class="op" id="1702988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1702992">return</span>&nbsp;<span class="builtintype" id="1702999">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1703005">}</span><br>
<span class="lineno">555</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1703009">return</span>&nbsp;<span class="ident" id="1703016">traceback</span>&nbsp;<span class="op" id="1703026">&gt;</span>&nbsp;<span class="num" id="1703028">1</span>&nbsp;<span class="op" id="1703030">||</span>&nbsp;<span class="ident" id="1703033">f</span>&nbsp;<span class="op" id="1703035">!=</span>&nbsp;<span class="ident" id="1703038">nil</span>&nbsp;<span class="op" id="1703042">&amp;&amp;</span>&nbsp;<span class="ident" id="1703045">contains</span><span class="op" id="1703053">(</span><span class="ident" id="1703054">name</span><span class="op" id="1703058">,</span>&nbsp;<span class="string" id="1703060">&#34;.&#34;</span><span class="op" id="1703063">)</span>&nbsp;<span class="op" id="1703065">&amp;&amp;</span>&nbsp;<span class="op" id="1703068">(</span><span class="op" id="1703069">!</span><span class="ident" id="1703070">hasprefix</span><span class="op" id="1703079">(</span><span class="ident" id="1703080">name</span><span class="op" id="1703084">,</span>&nbsp;<span class="string" id="1703086">&#34;runtime.&#34;</span><span class="op" id="1703096">)</span>&nbsp;<span class="op" id="1703098">||</span>&nbsp;<span class="ident" id="1703101">isExportedRuntime</span><span class="op" id="1703118">(</span><span class="ident" id="1703119">name</span><span class="op" id="1703123">)</span><span class="op" id="1703124">)</span><br>
<span class="lineno"></span><span class="op" id="1703126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1703129">//&nbsp;isExportedRuntime&nbsp;reports&nbsp;whether&nbsp;name&nbsp;is&nbsp;an&nbsp;exported&nbsp;runtime&nbsp;function.</span><br>
<span class="lineno">560</span><span class="comment" id="1703204">//&nbsp;It&nbsp;is&nbsp;only&nbsp;for&nbsp;runtime&nbsp;functions,&nbsp;so&nbsp;ASCII&nbsp;A-Z&nbsp;is&nbsp;fine.</span><br>
<span class="lineno"></span><span class="keyword" id="1703263">func</span>&nbsp;<span class="ident" id="1703268">isExportedRuntime</span><span class="op" id="1703285">(</span><span class="ident" id="1703286">name</span>&nbsp;<span class="builtintype" id="1703291">string</span><span class="op" id="1703297">)</span>&nbsp;<span class="builtintype" id="1703299">bool</span>&nbsp;<span class="op" id="1703304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1703307">const</span>&nbsp;<span class="ident" id="1703313">n</span>&nbsp;<span class="op" id="1703315">=</span>&nbsp;<span class="builtinfunc" id="1703317">len</span><span class="op" id="1703320">(</span><span class="string" id="1703321">&#34;runtime.&#34;</span><span class="op" id="1703331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1703334">return</span>&nbsp;<span class="builtinfunc" id="1703341">len</span><span class="op" id="1703344">(</span><span class="ident" id="1703345">name</span><span class="op" id="1703349">)</span>&nbsp;<span class="op" id="1703351">&gt;</span>&nbsp;<span class="ident" id="1703353">n</span>&nbsp;<span class="op" id="1703355">&amp;&amp;</span>&nbsp;<span class="ident" id="1703358">name</span><span class="op" id="1703362">[</span><span class="op" id="1703363">:</span><span class="ident" id="1703364">n</span><span class="op" id="1703365">]</span>&nbsp;<span class="op" id="1703367">==</span>&nbsp;<span class="string" id="1703370">&#34;runtime.&#34;</span>&nbsp;<span class="op" id="1703381">&amp;&amp;</span>&nbsp;<span class="string" id="1703384">&#39;A&#39;</span>&nbsp;<span class="op" id="1703388">&lt;=</span>&nbsp;<span class="ident" id="1703391">name</span><span class="op" id="1703395">[</span><span class="ident" id="1703396">n</span><span class="op" id="1703397">]</span>&nbsp;<span class="op" id="1703399">&amp;&amp;</span>&nbsp;<span class="ident" id="1703402">name</span><span class="op" id="1703406">[</span><span class="ident" id="1703407">n</span><span class="op" id="1703408">]</span>&nbsp;<span class="op" id="1703410">&lt;=</span>&nbsp;<span class="string" id="1703413">&#39;Z&#39;</span><br>
<span class="lineno"></span><span class="op" id="1703417">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="keyword" id="1703420">var</span>&nbsp;<span class="ident" id="1703424">gStatusStrings</span>&nbsp;<span class="op" id="1703439">=</span>&nbsp;<span class="op" id="1703441">[</span><span class="op" id="1703442">...</span><span class="op" id="1703445">]</span><span class="builtintype" id="1703446">string</span><span class="op" id="1703452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1703455">_Gidle</span><span class="op" id="1703461">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1703468">&#34;idle&#34;</span><span class="op" id="1703474">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1703477">_Grunnable</span><span class="op" id="1703487">:</span>&nbsp;&nbsp;<span class="string" id="1703490">&#34;runnable&#34;</span><span class="op" id="1703500">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1703503">_Grunning</span><span class="op" id="1703512">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="1703516">&#34;running&#34;</span><span class="op" id="1703525">,</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1703528">_Gsyscall</span><span class="op" id="1703537">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="1703541">&#34;syscall&#34;</span><span class="op" id="1703550">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1703553">_Gwaiting</span><span class="op" id="1703562">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="1703566">&#34;waiting&#34;</span><span class="op" id="1703575">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1703578">_Gdead</span><span class="op" id="1703584">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1703591">&#34;dead&#34;</span><span class="op" id="1703597">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1703600">_Genqueue</span><span class="op" id="1703609">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="1703613">&#34;enqueue&#34;</span><span class="op" id="1703622">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1703625">_Gcopystack</span><span class="op" id="1703636">:</span>&nbsp;<span class="string" id="1703638">&#34;copystack&#34;</span><span class="op" id="1703649">,</span><br>
<span class="lineno">575</span><span class="op" id="1703651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1703654">var</span>&nbsp;<span class="ident" id="1703658">gScanStatusStrings</span>&nbsp;<span class="op" id="1703677">=</span>&nbsp;<span class="op" id="1703679">[</span><span class="op" id="1703680">...</span><span class="op" id="1703683">]</span><span class="builtintype" id="1703684">string</span><span class="op" id="1703690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="1703693">0</span><span class="op" id="1703694">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1703705">&#34;scan&#34;</span><span class="op" id="1703711">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1703714">_Grunnable</span><span class="op" id="1703724">:</span>&nbsp;<span class="string" id="1703726">&#34;scanrunnable&#34;</span><span class="op" id="1703740">,</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1703743">_Grunning</span><span class="op" id="1703752">:</span>&nbsp;&nbsp;<span class="string" id="1703755">&#34;scanrunning&#34;</span><span class="op" id="1703768">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1703771">_Gsyscall</span><span class="op" id="1703780">:</span>&nbsp;&nbsp;<span class="string" id="1703783">&#34;scansyscall&#34;</span><span class="op" id="1703796">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1703799">_Gwaiting</span><span class="op" id="1703808">:</span>&nbsp;&nbsp;<span class="string" id="1703811">&#34;scanwaiting&#34;</span><span class="op" id="1703824">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1703827">_Gdead</span><span class="op" id="1703833">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1703839">&#34;scandead&#34;</span><span class="op" id="1703849">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1703852">_Genqueue</span><span class="op" id="1703861">:</span>&nbsp;&nbsp;<span class="string" id="1703864">&#34;scanenqueue&#34;</span><span class="op" id="1703877">,</span><br>
<span class="lineno">585</span><span class="op" id="1703879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1703882">func</span>&nbsp;<span class="ident" id="1703887">goroutineheader</span><span class="op" id="1703902">(</span><span class="ident" id="1703903">gp</span>&nbsp;<span class="op" id="1703906">*</span><span class="ident" id="1703907">g</span><span class="op" id="1703908">)</span>&nbsp;<span class="op" id="1703910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1703913">gpstatus</span>&nbsp;<span class="op" id="1703922">:=</span>&nbsp;<span class="ident" id="1703925">readgstatus</span><span class="op" id="1703936">(</span><span class="ident" id="1703937">gp</span><span class="op" id="1703939">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1703943">//&nbsp;Basic&nbsp;string&nbsp;status</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1703967">var</span>&nbsp;<span class="ident" id="1703971">status</span>&nbsp;<span class="builtintype" id="1703978">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1703986">if</span>&nbsp;<span class="num" id="1703989">0</span>&nbsp;<span class="op" id="1703991">&lt;=</span>&nbsp;<span class="ident" id="1703994">gpstatus</span>&nbsp;<span class="op" id="1704003">&amp;&amp;</span>&nbsp;<span class="ident" id="1704006">gpstatus</span>&nbsp;<span class="op" id="1704015">&lt;</span>&nbsp;<span class="builtintype" id="1704017">uint32</span><span class="op" id="1704023">(</span><span class="builtinfunc" id="1704024">len</span><span class="op" id="1704027">(</span><span class="ident" id="1704028">gStatusStrings</span><span class="op" id="1704042">)</span><span class="op" id="1704043">)</span>&nbsp;<span class="op" id="1704045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1704049">status</span>&nbsp;<span class="op" id="1704056">=</span>&nbsp;<span class="ident" id="1704058">gStatusStrings</span><span class="op" id="1704072">[</span><span class="ident" id="1704073">gpstatus</span><span class="op" id="1704081">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1704084">}</span>&nbsp;<span class="keyword" id="1704086">else</span>&nbsp;<span class="keyword" id="1704091">if</span>&nbsp;<span class="ident" id="1704094">gpstatus</span><span class="op" id="1704102">&amp;</span><span class="ident" id="1704103">_Gscan</span>&nbsp;<span class="op" id="1704110">!=</span>&nbsp;<span class="num" id="1704113">0</span>&nbsp;<span class="op" id="1704115">&amp;&amp;</span>&nbsp;<span class="num" id="1704118">0</span>&nbsp;<span class="op" id="1704120">&lt;=</span>&nbsp;<span class="ident" id="1704123">gpstatus</span><span class="op" id="1704131">&amp;^</span><span class="ident" id="1704133">_Gscan</span>&nbsp;<span class="op" id="1704140">&amp;&amp;</span>&nbsp;<span class="ident" id="1704143">gpstatus</span><span class="op" id="1704151">&amp;^</span><span class="ident" id="1704153">_Gscan</span>&nbsp;<span class="op" id="1704160">&lt;</span>&nbsp;<span class="builtintype" id="1704162">uint32</span><span class="op" id="1704168">(</span><span class="builtinfunc" id="1704169">len</span><span class="op" id="1704172">(</span><span class="ident" id="1704173">gStatusStrings</span><span class="op" id="1704187">)</span><span class="op" id="1704188">)</span>&nbsp;<span class="op" id="1704190">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1704194">status</span>&nbsp;<span class="op" id="1704201">=</span>&nbsp;<span class="ident" id="1704203">gStatusStrings</span><span class="op" id="1704217">[</span><span class="ident" id="1704218">gpstatus</span><span class="op" id="1704226">&amp;^</span><span class="ident" id="1704228">_Gscan</span><span class="op" id="1704234">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1704237">}</span>&nbsp;<span class="keyword" id="1704239">else</span>&nbsp;<span class="op" id="1704244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1704248">status</span>&nbsp;<span class="op" id="1704255">=</span>&nbsp;<span class="string" id="1704257">&#34;???&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1704264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1704268">//&nbsp;Override.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1704282">if</span>&nbsp;<span class="op" id="1704285">(</span><span class="ident" id="1704286">gpstatus</span>&nbsp;<span class="op" id="1704295">==</span>&nbsp;<span class="ident" id="1704298">_Gwaiting</span>&nbsp;<span class="op" id="1704308">||</span>&nbsp;<span class="ident" id="1704311">gpstatus</span>&nbsp;<span class="op" id="1704320">==</span>&nbsp;<span class="ident" id="1704323">_Gscanwaiting</span><span class="op" id="1704336">)</span>&nbsp;<span class="op" id="1704338">&amp;&amp;</span>&nbsp;<span class="ident" id="1704341">gp</span><span class="op" id="1704343">.</span><span class="ident" id="1704344">waitreason</span>&nbsp;<span class="op" id="1704355">!=</span>&nbsp;<span class="string" id="1704358">&#34;&#34;</span>&nbsp;<span class="op" id="1704361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1704365">status</span>&nbsp;<span class="op" id="1704372">=</span>&nbsp;<span class="ident" id="1704374">gp</span><span class="op" id="1704376">.</span><span class="ident" id="1704377">waitreason</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1704389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1704393">//&nbsp;approx&nbsp;time&nbsp;the&nbsp;G&nbsp;is&nbsp;blocked,&nbsp;in&nbsp;minutes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1704438">var</span>&nbsp;<span class="ident" id="1704442">waitfor</span>&nbsp;<span class="ident" id="1704450">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1704457">gpstatus</span>&nbsp;<span class="op" id="1704466">&amp;^=</span>&nbsp;<span class="ident" id="1704470">_Gscan</span>&nbsp;<span class="comment" id="1704477">//&nbsp;drop&nbsp;the&nbsp;scan&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1704499">if</span>&nbsp;<span class="op" id="1704502">(</span><span class="ident" id="1704503">gpstatus</span>&nbsp;<span class="op" id="1704512">==</span>&nbsp;<span class="ident" id="1704515">_Gwaiting</span>&nbsp;<span class="op" id="1704525">||</span>&nbsp;<span class="ident" id="1704528">gpstatus</span>&nbsp;<span class="op" id="1704537">==</span>&nbsp;<span class="ident" id="1704540">_Gsyscall</span><span class="op" id="1704549">)</span>&nbsp;<span class="op" id="1704551">&amp;&amp;</span>&nbsp;<span class="ident" id="1704554">gp</span><span class="op" id="1704556">.</span><span class="ident" id="1704557">waitsince</span>&nbsp;<span class="op" id="1704567">!=</span>&nbsp;<span class="num" id="1704570">0</span>&nbsp;<span class="op" id="1704572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1704576">waitfor</span>&nbsp;<span class="op" id="1704584">=</span>&nbsp;<span class="op" id="1704586">(</span><span class="ident" id="1704587">nanotime</span><span class="op" id="1704595">(</span><span class="op" id="1704596">)</span>&nbsp;<span class="op" id="1704598">-</span>&nbsp;<span class="ident" id="1704600">gp</span><span class="op" id="1704602">.</span><span class="ident" id="1704603">waitsince</span><span class="op" id="1704612">)</span>&nbsp;<span class="op" id="1704614">/</span>&nbsp;<span class="num" id="1704616">60e9</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1704622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1704625">print</span><span class="op" id="1704630">(</span><span class="string" id="1704631">&#34;goroutine&nbsp;&#34;</span><span class="op" id="1704643">,</span>&nbsp;<span class="ident" id="1704645">gp</span><span class="op" id="1704647">.</span><span class="ident" id="1704648">goid</span><span class="op" id="1704652">,</span>&nbsp;<span class="string" id="1704654">&#34;&nbsp;[&#34;</span><span class="op" id="1704658">,</span>&nbsp;<span class="ident" id="1704660">status</span><span class="op" id="1704666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1704669">if</span>&nbsp;<span class="ident" id="1704672">waitfor</span>&nbsp;<span class="op" id="1704680">&gt;=</span>&nbsp;<span class="num" id="1704683">1</span>&nbsp;<span class="op" id="1704685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1704689">print</span><span class="op" id="1704694">(</span><span class="string" id="1704695">&#34;,&nbsp;&#34;</span><span class="op" id="1704699">,</span>&nbsp;<span class="ident" id="1704701">waitfor</span><span class="op" id="1704708">,</span>&nbsp;<span class="string" id="1704710">&#34;&nbsp;minutes&#34;</span><span class="op" id="1704720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1704723">}</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1704726">if</span>&nbsp;<span class="ident" id="1704729">gp</span><span class="op" id="1704731">.</span><span class="ident" id="1704732">lockedm</span>&nbsp;<span class="op" id="1704740">!=</span>&nbsp;<span class="ident" id="1704743">nil</span>&nbsp;<span class="op" id="1704747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1704751">print</span><span class="op" id="1704756">(</span><span class="string" id="1704757">&#34;,&nbsp;locked&nbsp;to&nbsp;thread&#34;</span><span class="op" id="1704777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1704780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1704783">print</span><span class="op" id="1704788">(</span><span class="string" id="1704789">&#34;]:\n&#34;</span><span class="op" id="1704795">)</span><br>
<span class="lineno"></span><span class="op" id="1704797">}</span><br>
<span class="lineno">620</span><br>
<span class="lineno"></span><span class="keyword" id="1704800">func</span>&nbsp;<span class="ident" id="1704805">tracebackothers</span><span class="op" id="1704820">(</span><span class="ident" id="1704821">me</span>&nbsp;<span class="op" id="1704824">*</span><span class="ident" id="1704825">g</span><span class="op" id="1704826">)</span>&nbsp;<span class="op" id="1704828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1704831">level</span>&nbsp;<span class="op" id="1704837">:=</span>&nbsp;<span class="ident" id="1704840">gotraceback</span><span class="op" id="1704851">(</span><span class="ident" id="1704852">nil</span><span class="op" id="1704855">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1704859">//&nbsp;Show&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;first,&nbsp;if&nbsp;we&nbsp;haven&#39;t&nbsp;already.</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1704920">g</span>&nbsp;<span class="op" id="1704922">:=</span>&nbsp;<span class="ident" id="1704925">getg</span><span class="op" id="1704929">(</span><span class="op" id="1704930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1704933">gp</span>&nbsp;<span class="op" id="1704936">:=</span>&nbsp;<span class="ident" id="1704939">g</span><span class="op" id="1704940">.</span><span class="ident" id="1704941">m</span><span class="op" id="1704942">.</span><span class="ident" id="1704943">curg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1704949">if</span>&nbsp;<span class="ident" id="1704952">gp</span>&nbsp;<span class="op" id="1704955">!=</span>&nbsp;<span class="ident" id="1704958">nil</span>&nbsp;<span class="op" id="1704962">&amp;&amp;</span>&nbsp;<span class="ident" id="1704965">gp</span>&nbsp;<span class="op" id="1704968">!=</span>&nbsp;<span class="ident" id="1704971">me</span>&nbsp;<span class="op" id="1704974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1704978">print</span><span class="op" id="1704983">(</span><span class="string" id="1704984">&#34;\n&#34;</span><span class="op" id="1704988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1704992">goroutineheader</span><span class="op" id="1705007">(</span><span class="ident" id="1705008">gp</span><span class="op" id="1705010">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1705014">traceback</span><span class="op" id="1705023">(</span><span class="op" id="1705024">^</span><span class="builtintype" id="1705025">uintptr</span><span class="op" id="1705032">(</span><span class="num" id="1705033">0</span><span class="op" id="1705034">)</span><span class="op" id="1705035">,</span>&nbsp;<span class="op" id="1705037">^</span><span class="builtintype" id="1705038">uintptr</span><span class="op" id="1705045">(</span><span class="num" id="1705046">0</span><span class="op" id="1705047">)</span><span class="op" id="1705048">,</span>&nbsp;<span class="num" id="1705050">0</span><span class="op" id="1705051">,</span>&nbsp;<span class="ident" id="1705053">gp</span><span class="op" id="1705055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1705058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1705062">lock</span><span class="op" id="1705066">(</span><span class="op" id="1705067">&amp;</span><span class="ident" id="1705068">allglock</span><span class="op" id="1705076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1705079">for</span>&nbsp;<span class="ident" id="1705083">_</span><span class="op" id="1705084">,</span>&nbsp;<span class="ident" id="1705086">gp</span>&nbsp;<span class="op" id="1705089">:=</span>&nbsp;<span class="keyword" id="1705092">range</span>&nbsp;<span class="ident" id="1705098">allgs</span>&nbsp;<span class="op" id="1705104">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1705108">if</span>&nbsp;<span class="ident" id="1705111">gp</span>&nbsp;<span class="op" id="1705114">==</span>&nbsp;<span class="ident" id="1705117">me</span>&nbsp;<span class="op" id="1705120">||</span>&nbsp;<span class="ident" id="1705123">gp</span>&nbsp;<span class="op" id="1705126">==</span>&nbsp;<span class="ident" id="1705129">g</span><span class="op" id="1705130">.</span><span class="ident" id="1705131">m</span><span class="op" id="1705132">.</span><span class="ident" id="1705133">curg</span>&nbsp;<span class="op" id="1705138">||</span>&nbsp;<span class="ident" id="1705141">readgstatus</span><span class="op" id="1705152">(</span><span class="ident" id="1705153">gp</span><span class="op" id="1705155">)</span>&nbsp;<span class="op" id="1705157">==</span>&nbsp;<span class="ident" id="1705160">_Gdead</span>&nbsp;<span class="op" id="1705167">||</span>&nbsp;<span class="ident" id="1705170">gp</span><span class="op" id="1705172">.</span><span class="ident" id="1705173">issystem</span>&nbsp;<span class="op" id="1705182">&amp;&amp;</span>&nbsp;<span class="ident" id="1705185">level</span>&nbsp;<span class="op" id="1705191">&lt;</span>&nbsp;<span class="num" id="1705193">2</span>&nbsp;<span class="op" id="1705195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1705200">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1705211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1705215">print</span><span class="op" id="1705220">(</span><span class="string" id="1705221">&#34;\n&#34;</span><span class="op" id="1705225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1705229">goroutineheader</span><span class="op" id="1705244">(</span><span class="ident" id="1705245">gp</span><span class="op" id="1705247">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1705251">if</span>&nbsp;<span class="ident" id="1705254">readgstatus</span><span class="op" id="1705265">(</span><span class="ident" id="1705266">gp</span><span class="op" id="1705268">)</span><span class="op" id="1705269">&amp;^</span><span class="ident" id="1705271">_Gscan</span>&nbsp;<span class="op" id="1705278">==</span>&nbsp;<span class="ident" id="1705281">_Grunning</span>&nbsp;<span class="op" id="1705291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1705296">print</span><span class="op" id="1705301">(</span><span class="string" id="1705302">&#34;\tgoroutine&nbsp;running&nbsp;on&nbsp;other&nbsp;thread;&nbsp;stack&nbsp;unavailable\n&#34;</span><span class="op" id="1705360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1705365">printcreatedby</span><span class="op" id="1705379">(</span><span class="ident" id="1705380">gp</span><span class="op" id="1705382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1705386">}</span>&nbsp;<span class="keyword" id="1705388">else</span>&nbsp;<span class="op" id="1705393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1705398">traceback</span><span class="op" id="1705407">(</span><span class="op" id="1705408">^</span><span class="builtintype" id="1705409">uintptr</span><span class="op" id="1705416">(</span><span class="num" id="1705417">0</span><span class="op" id="1705418">)</span><span class="op" id="1705419">,</span>&nbsp;<span class="op" id="1705421">^</span><span class="builtintype" id="1705422">uintptr</span><span class="op" id="1705429">(</span><span class="num" id="1705430">0</span><span class="op" id="1705431">)</span><span class="op" id="1705432">,</span>&nbsp;<span class="num" id="1705434">0</span><span class="op" id="1705435">,</span>&nbsp;<span class="ident" id="1705437">gp</span><span class="op" id="1705439">)</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1705443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1705446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1705449">unlock</span><span class="op" id="1705455">(</span><span class="op" id="1705456">&amp;</span><span class="ident" id="1705457">allglock</span><span class="op" id="1705465">)</span><br>
<span class="lineno"></span><span class="op" id="1705467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">650</span><span class="comment" id="1705470">//&nbsp;Does&nbsp;f&nbsp;mark&nbsp;the&nbsp;top&nbsp;of&nbsp;a&nbsp;goroutine&nbsp;stack?</span><br>
<span class="lineno"></span><span class="keyword" id="1705515">func</span>&nbsp;<span class="ident" id="1705520">topofstack</span><span class="op" id="1705530">(</span><span class="ident" id="1705531">f</span>&nbsp;<span class="op" id="1705533">*</span><span class="ident" id="1705534">_func</span><span class="op" id="1705539">)</span>&nbsp;<span class="builtintype" id="1705541">bool</span>&nbsp;<span class="op" id="1705546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1705549">pc</span>&nbsp;<span class="op" id="1705552">:=</span>&nbsp;<span class="ident" id="1705555">f</span><span class="op" id="1705556">.</span><span class="ident" id="1705557">entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1705564">return</span>&nbsp;<span class="ident" id="1705571">pc</span>&nbsp;<span class="op" id="1705574">==</span>&nbsp;<span class="ident" id="1705577">goexitPC</span>&nbsp;<span class="op" id="1705586">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1705591">pc</span>&nbsp;<span class="op" id="1705594">==</span>&nbsp;<span class="ident" id="1705597">mstartPC</span>&nbsp;<span class="op" id="1705606">||</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1705611">pc</span>&nbsp;<span class="op" id="1705614">==</span>&nbsp;<span class="ident" id="1705617">mcallPC</span>&nbsp;<span class="op" id="1705625">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1705630">pc</span>&nbsp;<span class="op" id="1705633">==</span>&nbsp;<span class="ident" id="1705636">morestackPC</span>&nbsp;<span class="op" id="1705648">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1705653">pc</span>&nbsp;<span class="op" id="1705656">==</span>&nbsp;<span class="ident" id="1705659">rt0_goPC</span>&nbsp;<span class="op" id="1705668">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1705673">externalthreadhandlerp</span>&nbsp;<span class="op" id="1705696">!=</span>&nbsp;<span class="num" id="1705699">0</span>&nbsp;<span class="op" id="1705701">&amp;&amp;</span>&nbsp;<span class="ident" id="1705704">pc</span>&nbsp;<span class="op" id="1705707">==</span>&nbsp;<span class="ident" id="1705710">externalthreadhandlerp</span><br>
<span class="lineno"></span><span class="op" id="1705733">}</span>
</div>
</body>
</html>
