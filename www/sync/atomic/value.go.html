<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1698994">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1699049">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1699103">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1699154">package</span>&nbsp;<span class="ident" id="1699162">atomic</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1699170">import</span>&nbsp;<span class="op" id="1699177">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1699180">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1699189">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="1699192">//&nbsp;A&nbsp;Value&nbsp;provides&nbsp;an&nbsp;atomic&nbsp;load&nbsp;and&nbsp;store&nbsp;of&nbsp;a&nbsp;consistently&nbsp;typed&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="1699268">//&nbsp;Values&nbsp;can&nbsp;be&nbsp;created&nbsp;as&nbsp;part&nbsp;of&nbsp;other&nbsp;data&nbsp;structures.</span><br>
<span class="lineno"></span><span class="comment" id="1699327">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;a&nbsp;Value&nbsp;returns&nbsp;nil&nbsp;from&nbsp;Load.</span><br>
<span class="lineno"></span><span class="comment" id="1699380">//&nbsp;Once&nbsp;Store&nbsp;has&nbsp;been&nbsp;called,&nbsp;a&nbsp;Value&nbsp;must&nbsp;not&nbsp;be&nbsp;copied.</span><br>
<span class="lineno">15</span><span class="keyword" id="1699439">type</span>&nbsp;<span class="ident" id="1699444">Value</span>&nbsp;<span class="keyword" id="1699450">struct</span>&nbsp;<span class="op" id="1699457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1699460">v</span>&nbsp;<span class="keyword" id="1699462">interface</span><span class="op" id="1699471">{</span><span class="op" id="1699472">}</span><br>
<span class="lineno"></span><span class="op" id="1699474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1699477">//&nbsp;ifaceWords&nbsp;is&nbsp;interface{}&nbsp;internal&nbsp;representation.</span><br>
<span class="lineno">20</span><span class="keyword" id="1699531">type</span>&nbsp;<span class="ident" id="1699536">ifaceWords</span>&nbsp;<span class="keyword" id="1699547">struct</span>&nbsp;<span class="op" id="1699554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1699557">typ</span>&nbsp;&nbsp;<span class="ident" id="1699562"><a href="/sync/atomic/value.go.html#1699180">unsafe</a></span><span class="op" id="1699568">.</span><span class="ident" id="1699569">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1699578">data</span>&nbsp;<span class="ident" id="1699583"><a href="/sync/atomic/value.go.html#1699180">unsafe</a></span><span class="op" id="1699589">.</span><span class="ident" id="1699590">Pointer</span><br>
<span class="lineno"></span><span class="op" id="1699598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="1699601">//&nbsp;Load&nbsp;returns&nbsp;the&nbsp;value&nbsp;set&nbsp;by&nbsp;the&nbsp;most&nbsp;recent&nbsp;Store.</span><br>
<span class="lineno"></span><span class="comment" id="1699657">//&nbsp;It&nbsp;returns&nbsp;nil&nbsp;if&nbsp;there&nbsp;has&nbsp;been&nbsp;no&nbsp;call&nbsp;to&nbsp;Store&nbsp;for&nbsp;this&nbsp;Value.</span><br>
<span class="lineno"></span><span class="keyword" id="1699726">func</span>&nbsp;<span class="op" id="1699731">(</span><span class="ident" id="1699732">v</span>&nbsp;<span class="op" id="1699734">*</span><span class="ident" id="1699735"><a href="/sync/atomic/value.go.html#1699444">Value</a></span><span class="op" id="1699740">)</span>&nbsp;<span class="ident" id="1699742">Load</span><span class="op" id="1699746">(</span><span class="op" id="1699747">)</span>&nbsp;<span class="op" id="1699749">(</span><span class="ident" id="1699750">x</span>&nbsp;<span class="keyword" id="1699752">interface</span><span class="op" id="1699761">{</span><span class="op" id="1699762">}</span><span class="op" id="1699763">)</span>&nbsp;<span class="op" id="1699765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1699768">vp</span>&nbsp;<span class="op" id="1699771">:=</span>&nbsp;<span class="op" id="1699774">(</span><span class="op" id="1699775">*</span><span class="ident" id="1699776"><a href="/sync/atomic/value.go.html#1699536">ifaceWords</a></span><span class="op" id="1699786">)</span><span class="op" id="1699787">(</span><span class="ident" id="1699788"><a href="/sync/atomic/value.go.html#1699180">unsafe</a></span><span class="op" id="1699794">.</span><span class="ident" id="1699795">Pointer</span><span class="op" id="1699802">(</span><span class="ident" id="1699803"><a href="/sync/atomic/value.go.html#1699732">v</a></span><span class="op" id="1699804">)</span><span class="op" id="1699805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1699808">typ</span>&nbsp;<span class="op" id="1699812">:=</span>&nbsp;<span class="ident" id="1699815"><a href="/sync/atomic/doc.go.html#1698221">LoadPointer</a></span><span class="op" id="1699826">(</span><span class="op" id="1699827">&amp;</span><span class="ident" id="1699828"><a href="/sync/atomic/value.go.html#1699768">vp</a></span><span class="op" id="1699830">.</span><span class="ident" id="1699831">typ</span><span class="op" id="1699834">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1699837">if</span>&nbsp;<span class="ident" id="1699840"><a href="/sync/atomic/value.go.html#1699808">typ</a></span>&nbsp;<span class="op" id="1699844">==</span>&nbsp;<span class="ident" id="1699847">nil</span>&nbsp;<span class="op" id="1699851">||</span>&nbsp;<span class="builtintype" id="1699854">uintptr</span><span class="op" id="1699861">(</span><span class="ident" id="1699862"><a href="/sync/atomic/value.go.html#1699808">typ</a></span><span class="op" id="1699865">)</span>&nbsp;<span class="op" id="1699867">==</span>&nbsp;<span class="op" id="1699870">^</span><span class="builtintype" id="1699871">uintptr</span><span class="op" id="1699878">(</span><span class="num" id="1699879">0</span><span class="op" id="1699880">)</span>&nbsp;<span class="op" id="1699882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1699886">//&nbsp;First&nbsp;store&nbsp;not&nbsp;yet&nbsp;completed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1699922">return</span>&nbsp;<span class="ident" id="1699929">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1699934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1699937">data</span>&nbsp;<span class="op" id="1699942">:=</span>&nbsp;<span class="ident" id="1699945"><a href="/sync/atomic/doc.go.html#1698221">LoadPointer</a></span><span class="op" id="1699956">(</span><span class="op" id="1699957">&amp;</span><span class="ident" id="1699958"><a href="/sync/atomic/value.go.html#1699768">vp</a></span><span class="op" id="1699960">.</span><span class="ident" id="1699961">data</span><span class="op" id="1699965">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1699968">xp</span>&nbsp;<span class="op" id="1699971">:=</span>&nbsp;<span class="op" id="1699974">(</span><span class="op" id="1699975">*</span><span class="ident" id="1699976"><a href="/sync/atomic/value.go.html#1699536">ifaceWords</a></span><span class="op" id="1699986">)</span><span class="op" id="1699987">(</span><span class="ident" id="1699988"><a href="/sync/atomic/value.go.html#1699180">unsafe</a></span><span class="op" id="1699994">.</span><span class="ident" id="1699995">Pointer</span><span class="op" id="1700002">(</span><span class="op" id="1700003">&amp;</span><span class="ident" id="1700004"><a href="/sync/atomic/value.go.html#1699750">x</a></span><span class="op" id="1700005">)</span><span class="op" id="1700006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1700009"><a href="/sync/atomic/value.go.html#1699968">xp</a></span><span class="op" id="1700011">.</span><span class="ident" id="1700012">typ</span>&nbsp;<span class="op" id="1700016">=</span>&nbsp;<span class="ident" id="1700018"><a href="/sync/atomic/value.go.html#1699808">typ</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1700023"><a href="/sync/atomic/value.go.html#1699968">xp</a></span><span class="op" id="1700025">.</span><span class="ident" id="1700026">data</span>&nbsp;<span class="op" id="1700031">=</span>&nbsp;<span class="ident" id="1700033"><a href="/sync/atomic/value.go.html#1699937">data</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1700039">return</span><br>
<span class="lineno"></span><span class="op" id="1700046">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="1700049">//&nbsp;Store&nbsp;sets&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;Value&nbsp;to&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="1700092">//&nbsp;All&nbsp;calls&nbsp;to&nbsp;Store&nbsp;for&nbsp;a&nbsp;given&nbsp;Value&nbsp;must&nbsp;use&nbsp;values&nbsp;of&nbsp;the&nbsp;same&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="1700175">//&nbsp;Store&nbsp;of&nbsp;an&nbsp;inconsistent&nbsp;type&nbsp;panics,&nbsp;as&nbsp;does&nbsp;Store(nil).</span><br>
<span class="lineno"></span><span class="keyword" id="1700236">func</span>&nbsp;<span class="op" id="1700241">(</span><span class="ident" id="1700242">v</span>&nbsp;<span class="op" id="1700244">*</span><span class="ident" id="1700245"><a href="/sync/atomic/value.go.html#1699444">Value</a></span><span class="op" id="1700250">)</span>&nbsp;<span class="ident" id="1700252">Store</span><span class="op" id="1700257">(</span><span class="ident" id="1700258">x</span>&nbsp;<span class="keyword" id="1700260">interface</span><span class="op" id="1700269">{</span><span class="op" id="1700270">}</span><span class="op" id="1700271">)</span>&nbsp;<span class="op" id="1700273">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1700276">if</span>&nbsp;<span class="ident" id="1700279"><a href="/sync/atomic/value.go.html#1700258">x</a></span>&nbsp;<span class="op" id="1700281">==</span>&nbsp;<span class="ident" id="1700284">nil</span>&nbsp;<span class="op" id="1700288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1700292">panic</span><span class="op" id="1700297">(</span><span class="string" id="1700298">&#34;sync/atomic:&nbsp;store&nbsp;of&nbsp;nil&nbsp;value&nbsp;into&nbsp;Value&#34;</span><span class="op" id="1700342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1700345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1700348">vp</span>&nbsp;<span class="op" id="1700351">:=</span>&nbsp;<span class="op" id="1700354">(</span><span class="op" id="1700355">*</span><span class="ident" id="1700356"><a href="/sync/atomic/value.go.html#1699536">ifaceWords</a></span><span class="op" id="1700366">)</span><span class="op" id="1700367">(</span><span class="ident" id="1700368"><a href="/sync/atomic/value.go.html#1699180">unsafe</a></span><span class="op" id="1700374">.</span><span class="ident" id="1700375">Pointer</span><span class="op" id="1700382">(</span><span class="ident" id="1700383"><a href="/sync/atomic/value.go.html#1700242">v</a></span><span class="op" id="1700384">)</span><span class="op" id="1700385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1700388">xp</span>&nbsp;<span class="op" id="1700391">:=</span>&nbsp;<span class="op" id="1700394">(</span><span class="op" id="1700395">*</span><span class="ident" id="1700396"><a href="/sync/atomic/value.go.html#1699536">ifaceWords</a></span><span class="op" id="1700406">)</span><span class="op" id="1700407">(</span><span class="ident" id="1700408"><a href="/sync/atomic/value.go.html#1699180">unsafe</a></span><span class="op" id="1700414">.</span><span class="ident" id="1700415">Pointer</span><span class="op" id="1700422">(</span><span class="op" id="1700423">&amp;</span><span class="ident" id="1700424"><a href="/sync/atomic/value.go.html#1700258">x</a></span><span class="op" id="1700425">)</span><span class="op" id="1700426">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1700429">for</span>&nbsp;<span class="op" id="1700433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1700437">typ</span>&nbsp;<span class="op" id="1700441">:=</span>&nbsp;<span class="ident" id="1700444"><a href="/sync/atomic/doc.go.html#1698221">LoadPointer</a></span><span class="op" id="1700455">(</span><span class="op" id="1700456">&amp;</span><span class="ident" id="1700457"><a href="/sync/atomic/value.go.html#1700348">vp</a></span><span class="op" id="1700459">.</span><span class="ident" id="1700460">typ</span><span class="op" id="1700463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1700467">if</span>&nbsp;<span class="ident" id="1700470"><a href="/sync/atomic/value.go.html#1700437">typ</a></span>&nbsp;<span class="op" id="1700474">==</span>&nbsp;<span class="ident" id="1700477">nil</span>&nbsp;<span class="op" id="1700481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1700486">//&nbsp;Attempt&nbsp;to&nbsp;start&nbsp;first&nbsp;store.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1700522">//&nbsp;Disable&nbsp;preemption&nbsp;so&nbsp;that&nbsp;other&nbsp;goroutines&nbsp;can&nbsp;use</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1700580">//&nbsp;active&nbsp;spin&nbsp;wait&nbsp;to&nbsp;wait&nbsp;for&nbsp;completion;&nbsp;and&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1700639">//&nbsp;GC&nbsp;does&nbsp;not&nbsp;see&nbsp;the&nbsp;fake&nbsp;type&nbsp;accidentally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1700689"><a href="/sync/atomic/value.go.html#1701406">runtime_procPin</a></span><span class="op" id="1700704">(</span><span class="op" id="1700705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1700710">if</span>&nbsp;<span class="op" id="1700713">!</span><span class="ident" id="1700714"><a href="/sync/atomic/doc.go.html#1696743">CompareAndSwapPointer</a></span><span class="op" id="1700735">(</span><span class="op" id="1700736">&amp;</span><span class="ident" id="1700737"><a href="/sync/atomic/value.go.html#1700348">vp</a></span><span class="op" id="1700739">.</span><span class="ident" id="1700740">typ</span><span class="op" id="1700743">,</span>&nbsp;<span class="ident" id="1700745">nil</span><span class="op" id="1700748">,</span>&nbsp;<span class="ident" id="1700750"><a href="/sync/atomic/value.go.html#1699180">unsafe</a></span><span class="op" id="1700756">.</span><span class="ident" id="1700757">Pointer</span><span class="op" id="1700764">(</span><span class="op" id="1700765">^</span><span class="builtintype" id="1700766">uintptr</span><span class="op" id="1700773">(</span><span class="num" id="1700774">0</span><span class="op" id="1700775">)</span><span class="op" id="1700776">)</span><span class="op" id="1700777">)</span>&nbsp;<span class="op" id="1700779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1700785"><a href="/sync/atomic/value.go.html#1701429">runtime_procUnpin</a></span><span class="op" id="1700802">(</span><span class="op" id="1700803">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1700809">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1700821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1700826">//&nbsp;Complete&nbsp;first&nbsp;store.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1700854"><a href="/sync/atomic/doc.go.html#1698793">StorePointer</a></span><span class="op" id="1700866">(</span><span class="op" id="1700867">&amp;</span><span class="ident" id="1700868"><a href="/sync/atomic/value.go.html#1700348">vp</a></span><span class="op" id="1700870">.</span><span class="ident" id="1700871">data</span><span class="op" id="1700875">,</span>&nbsp;<span class="ident" id="1700877"><a href="/sync/atomic/value.go.html#1700388">xp</a></span><span class="op" id="1700879">.</span><span class="ident" id="1700880">data</span><span class="op" id="1700884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1700889"><a href="/sync/atomic/doc.go.html#1698793">StorePointer</a></span><span class="op" id="1700901">(</span><span class="op" id="1700902">&amp;</span><span class="ident" id="1700903"><a href="/sync/atomic/value.go.html#1700348">vp</a></span><span class="op" id="1700905">.</span><span class="ident" id="1700906">typ</span><span class="op" id="1700909">,</span>&nbsp;<span class="ident" id="1700911"><a href="/sync/atomic/value.go.html#1700388">xp</a></span><span class="op" id="1700913">.</span><span class="ident" id="1700914">typ</span><span class="op" id="1700917">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1700922"><a href="/sync/atomic/value.go.html#1701429">runtime_procUnpin</a></span><span class="op" id="1700939">(</span><span class="op" id="1700940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1700945">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1700954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1700958">if</span>&nbsp;<span class="builtintype" id="1700961">uintptr</span><span class="op" id="1700968">(</span><span class="ident" id="1700969"><a href="/sync/atomic/value.go.html#1700437">typ</a></span><span class="op" id="1700972">)</span>&nbsp;<span class="op" id="1700974">==</span>&nbsp;<span class="op" id="1700977">^</span><span class="builtintype" id="1700978">uintptr</span><span class="op" id="1700985">(</span><span class="num" id="1700986">0</span><span class="op" id="1700987">)</span>&nbsp;<span class="op" id="1700989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1700994">//&nbsp;First&nbsp;store&nbsp;in&nbsp;progress.&nbsp;Wait.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1701031">//&nbsp;Since&nbsp;we&nbsp;disable&nbsp;preemption&nbsp;around&nbsp;the&nbsp;first&nbsp;store,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1701089">//&nbsp;we&nbsp;can&nbsp;wait&nbsp;with&nbsp;active&nbsp;spinning.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1701129">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1701140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1701144">//&nbsp;First&nbsp;store&nbsp;completed.&nbsp;Check&nbsp;type&nbsp;and&nbsp;overwrite&nbsp;data.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1701203">if</span>&nbsp;<span class="ident" id="1701206"><a href="/sync/atomic/value.go.html#1700437">typ</a></span>&nbsp;<span class="op" id="1701210">!=</span>&nbsp;<span class="ident" id="1701213"><a href="/sync/atomic/value.go.html#1700388">xp</a></span><span class="op" id="1701215">.</span><span class="ident" id="1701216">typ</span>&nbsp;<span class="op" id="1701220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1701225">panic</span><span class="op" id="1701230">(</span><span class="string" id="1701231">&#34;sync/atomic:&nbsp;store&nbsp;of&nbsp;inconsistently&nbsp;typed&nbsp;value&nbsp;into&nbsp;Value&#34;</span><span class="op" id="1701292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1701296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1701300"><a href="/sync/atomic/doc.go.html#1698793">StorePointer</a></span><span class="op" id="1701312">(</span><span class="op" id="1701313">&amp;</span><span class="ident" id="1701314"><a href="/sync/atomic/value.go.html#1700348">vp</a></span><span class="op" id="1701316">.</span><span class="ident" id="1701317">data</span><span class="op" id="1701321">,</span>&nbsp;<span class="ident" id="1701323"><a href="/sync/atomic/value.go.html#1700388">xp</a></span><span class="op" id="1701325">.</span><span class="ident" id="1701326">data</span><span class="op" id="1701330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1701334">return</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1701342">}</span><br>
<span class="lineno"></span><span class="op" id="1701344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1701347">//&nbsp;Disable/enable&nbsp;preemption,&nbsp;implemented&nbsp;in&nbsp;runtime.</span><br>
<span class="lineno"></span><span class="keyword" id="1701401">func</span>&nbsp;<span class="ident" id="1701406">runtime_procPin</span><span class="op" id="1701421">(</span><span class="op" id="1701422">)</span><br>
<span class="lineno">85</span><span class="keyword" id="1701424">func</span>&nbsp;<span class="ident" id="1701429">runtime_procUnpin</span><span class="op" id="1701446">(</span><span class="op" id="1701447">)</span>
</div>
</body>
</html>
