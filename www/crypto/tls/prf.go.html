<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4011233">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4011288">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4011342">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4011393">package</span>&nbsp;<span class="ident" id="4011401">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4011406">import</span>&nbsp;<span class="op" id="4011413">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4011416">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4011426">&#34;crypto/hmac&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4011441">&#34;crypto/md5&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4011455">&#34;crypto/sha1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4011470">&#34;crypto/sha256&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4011487">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="4011494">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4011497">//&nbsp;Split&nbsp;a&nbsp;premaster&nbsp;secret&nbsp;in&nbsp;two&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;4346,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="4011569">func</span>&nbsp;<span class="ident" id="4011574">splitPreMasterSecret</span><span class="op" id="4011594">(</span><span class="ident" id="4011595">secret</span>&nbsp;<span class="op" id="4011602">[</span><span class="op" id="4011603">]</span><span class="builtintype" id="4011604">byte</span><span class="op" id="4011608">)</span>&nbsp;<span class="op" id="4011610">(</span><span class="ident" id="4011611">s1</span><span class="op" id="4011613">,</span>&nbsp;<span class="ident" id="4011615">s2</span>&nbsp;<span class="op" id="4011618">[</span><span class="op" id="4011619">]</span><span class="builtintype" id="4011620">byte</span><span class="op" id="4011624">)</span>&nbsp;<span class="op" id="4011626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4011629">s1</span>&nbsp;<span class="op" id="4011632">=</span>&nbsp;<span class="ident" id="4011634">secret</span><span class="op" id="4011640">[</span><span class="num" id="4011641">0</span>&nbsp;<span class="op" id="4011643">:</span>&nbsp;<span class="op" id="4011645">(</span><span class="builtinfunc" id="4011646">len</span><span class="op" id="4011649">(</span><span class="ident" id="4011650">secret</span><span class="op" id="4011656">)</span><span class="op" id="4011657">+</span><span class="num" id="4011658">1</span><span class="op" id="4011659">)</span><span class="op" id="4011660">/</span><span class="num" id="4011661">2</span><span class="op" id="4011662">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4011665">s2</span>&nbsp;<span class="op" id="4011668">=</span>&nbsp;<span class="ident" id="4011670">secret</span><span class="op" id="4011676">[</span><span class="builtinfunc" id="4011677">len</span><span class="op" id="4011680">(</span><span class="ident" id="4011681">secret</span><span class="op" id="4011687">)</span><span class="op" id="4011688">/</span><span class="num" id="4011689">2</span><span class="op" id="4011690">:</span><span class="op" id="4011691">]</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4011694">return</span><br>
<span class="lineno"></span><span class="op" id="4011701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4011704">//&nbsp;pHash&nbsp;implements&nbsp;the&nbsp;P_hash&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4346,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="4011780">func</span>&nbsp;<span class="ident" id="4011785">pHash</span><span class="op" id="4011790">(</span><span class="ident" id="4011791">result</span><span class="op" id="4011797">,</span>&nbsp;<span class="ident" id="4011799">secret</span><span class="op" id="4011805">,</span>&nbsp;<span class="ident" id="4011807">seed</span>&nbsp;<span class="op" id="4011812">[</span><span class="op" id="4011813">]</span><span class="builtintype" id="4011814">byte</span><span class="op" id="4011818">,</span>&nbsp;<span class="ident" id="4011820">hash</span>&nbsp;<span class="keyword" id="4011825">func</span><span class="op" id="4011829">(</span><span class="op" id="4011830">)</span>&nbsp;<span class="ident" id="4011832">hash</span><span class="op" id="4011836">.</span><span class="ident" id="4011837">Hash</span><span class="op" id="4011841">)</span>&nbsp;<span class="op" id="4011843">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4011846">h</span>&nbsp;<span class="op" id="4011848">:=</span>&nbsp;<span class="ident" id="4011851">hmac</span><span class="op" id="4011855">.</span><span class="ident" id="4011856">New</span><span class="op" id="4011859">(</span><span class="ident" id="4011860">hash</span><span class="op" id="4011864">,</span>&nbsp;<span class="ident" id="4011866">secret</span><span class="op" id="4011872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4011875">h</span><span class="op" id="4011876">.</span><span class="ident" id="4011877">Write</span><span class="op" id="4011882">(</span><span class="ident" id="4011883">seed</span><span class="op" id="4011887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4011890">a</span>&nbsp;<span class="op" id="4011892">:=</span>&nbsp;<span class="ident" id="4011895">h</span><span class="op" id="4011896">.</span><span class="ident" id="4011897">Sum</span><span class="op" id="4011900">(</span><span class="ident" id="4011901">nil</span><span class="op" id="4011904">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4011908">j</span>&nbsp;<span class="op" id="4011910">:=</span>&nbsp;<span class="num" id="4011913">0</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4011916">for</span>&nbsp;<span class="ident" id="4011920">j</span>&nbsp;<span class="op" id="4011922">&lt;</span>&nbsp;<span class="builtinfunc" id="4011924">len</span><span class="op" id="4011927">(</span><span class="ident" id="4011928">result</span><span class="op" id="4011934">)</span>&nbsp;<span class="op" id="4011936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4011940">h</span><span class="op" id="4011941">.</span><span class="ident" id="4011942">Reset</span><span class="op" id="4011947">(</span><span class="op" id="4011948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4011952">h</span><span class="op" id="4011953">.</span><span class="ident" id="4011954">Write</span><span class="op" id="4011959">(</span><span class="ident" id="4011960">a</span><span class="op" id="4011961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4011965">h</span><span class="op" id="4011966">.</span><span class="ident" id="4011967">Write</span><span class="op" id="4011972">(</span><span class="ident" id="4011973">seed</span><span class="op" id="4011977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4011981">b</span>&nbsp;<span class="op" id="4011983">:=</span>&nbsp;<span class="ident" id="4011986">h</span><span class="op" id="4011987">.</span><span class="ident" id="4011988">Sum</span><span class="op" id="4011991">(</span><span class="ident" id="4011992">nil</span><span class="op" id="4011995">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4011999">todo</span>&nbsp;<span class="op" id="4012004">:=</span>&nbsp;<span class="builtinfunc" id="4012007">len</span><span class="op" id="4012010">(</span><span class="ident" id="4012011">b</span><span class="op" id="4012012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4012016">if</span>&nbsp;<span class="ident" id="4012019">j</span><span class="op" id="4012020">+</span><span class="ident" id="4012021">todo</span>&nbsp;<span class="op" id="4012026">&gt;</span>&nbsp;<span class="builtinfunc" id="4012028">len</span><span class="op" id="4012031">(</span><span class="ident" id="4012032">result</span><span class="op" id="4012038">)</span>&nbsp;<span class="op" id="4012040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012045">todo</span>&nbsp;<span class="op" id="4012050">=</span>&nbsp;<span class="builtinfunc" id="4012052">len</span><span class="op" id="4012055">(</span><span class="ident" id="4012056">result</span><span class="op" id="4012062">)</span>&nbsp;<span class="op" id="4012064">-</span>&nbsp;<span class="ident" id="4012066">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4012070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4012074">copy</span><span class="op" id="4012078">(</span><span class="ident" id="4012079">result</span><span class="op" id="4012085">[</span><span class="ident" id="4012086">j</span><span class="op" id="4012087">:</span><span class="ident" id="4012088">j</span><span class="op" id="4012089">+</span><span class="ident" id="4012090">todo</span><span class="op" id="4012094">]</span><span class="op" id="4012095">,</span>&nbsp;<span class="ident" id="4012097">b</span><span class="op" id="4012098">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012102">j</span>&nbsp;<span class="op" id="4012104">+=</span>&nbsp;<span class="ident" id="4012107">todo</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012115">h</span><span class="op" id="4012116">.</span><span class="ident" id="4012117">Reset</span><span class="op" id="4012122">(</span><span class="op" id="4012123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012127">h</span><span class="op" id="4012128">.</span><span class="ident" id="4012129">Write</span><span class="op" id="4012134">(</span><span class="ident" id="4012135">a</span><span class="op" id="4012136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012140">a</span>&nbsp;<span class="op" id="4012142">=</span>&nbsp;<span class="ident" id="4012144">h</span><span class="op" id="4012145">.</span><span class="ident" id="4012146">Sum</span><span class="op" id="4012149">(</span><span class="ident" id="4012150">nil</span><span class="op" id="4012153">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4012156">}</span><br>
<span class="lineno"></span><span class="op" id="4012158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4012161">//&nbsp;prf10&nbsp;implements&nbsp;the&nbsp;TLS&nbsp;1.0&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;2246,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="4012252">func</span>&nbsp;<span class="ident" id="4012257">prf10</span><span class="op" id="4012262">(</span><span class="ident" id="4012263">result</span><span class="op" id="4012269">,</span>&nbsp;<span class="ident" id="4012271">secret</span><span class="op" id="4012277">,</span>&nbsp;<span class="ident" id="4012279">label</span><span class="op" id="4012284">,</span>&nbsp;<span class="ident" id="4012286">seed</span>&nbsp;<span class="op" id="4012291">[</span><span class="op" id="4012292">]</span><span class="builtintype" id="4012293">byte</span><span class="op" id="4012297">)</span>&nbsp;<span class="op" id="4012299">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012302">hashSHA1</span>&nbsp;<span class="op" id="4012311">:=</span>&nbsp;<span class="ident" id="4012314">sha1</span><span class="op" id="4012318">.</span><span class="ident" id="4012319">New</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012324">hashMD5</span>&nbsp;<span class="op" id="4012332">:=</span>&nbsp;<span class="ident" id="4012335">md5</span><span class="op" id="4012338">.</span><span class="ident" id="4012339">New</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012345">labelAndSeed</span>&nbsp;<span class="op" id="4012358">:=</span>&nbsp;<span class="builtinfunc" id="4012361">make</span><span class="op" id="4012365">(</span><span class="op" id="4012366">[</span><span class="op" id="4012367">]</span><span class="builtintype" id="4012368">byte</span><span class="op" id="4012372">,</span>&nbsp;<span class="builtinfunc" id="4012374">len</span><span class="op" id="4012377">(</span><span class="ident" id="4012378">label</span><span class="op" id="4012383">)</span><span class="op" id="4012384">+</span><span class="builtinfunc" id="4012385">len</span><span class="op" id="4012388">(</span><span class="ident" id="4012389">seed</span><span class="op" id="4012393">)</span><span class="op" id="4012394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4012397">copy</span><span class="op" id="4012401">(</span><span class="ident" id="4012402">labelAndSeed</span><span class="op" id="4012414">,</span>&nbsp;<span class="ident" id="4012416">label</span><span class="op" id="4012421">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4012424">copy</span><span class="op" id="4012428">(</span><span class="ident" id="4012429">labelAndSeed</span><span class="op" id="4012441">[</span><span class="builtinfunc" id="4012442">len</span><span class="op" id="4012445">(</span><span class="ident" id="4012446">label</span><span class="op" id="4012451">)</span><span class="op" id="4012452">:</span><span class="op" id="4012453">]</span><span class="op" id="4012454">,</span>&nbsp;<span class="ident" id="4012456">seed</span><span class="op" id="4012460">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012464">s1</span><span class="op" id="4012466">,</span>&nbsp;<span class="ident" id="4012468">s2</span>&nbsp;<span class="op" id="4012471">:=</span>&nbsp;<span class="ident" id="4012474">splitPreMasterSecret</span><span class="op" id="4012494">(</span><span class="ident" id="4012495">secret</span><span class="op" id="4012501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012504">pHash</span><span class="op" id="4012509">(</span><span class="ident" id="4012510">result</span><span class="op" id="4012516">,</span>&nbsp;<span class="ident" id="4012518">s1</span><span class="op" id="4012520">,</span>&nbsp;<span class="ident" id="4012522">labelAndSeed</span><span class="op" id="4012534">,</span>&nbsp;<span class="ident" id="4012536">hashMD5</span><span class="op" id="4012543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012546">result2</span>&nbsp;<span class="op" id="4012554">:=</span>&nbsp;<span class="builtinfunc" id="4012557">make</span><span class="op" id="4012561">(</span><span class="op" id="4012562">[</span><span class="op" id="4012563">]</span><span class="builtintype" id="4012564">byte</span><span class="op" id="4012568">,</span>&nbsp;<span class="builtinfunc" id="4012570">len</span><span class="op" id="4012573">(</span><span class="ident" id="4012574">result</span><span class="op" id="4012580">)</span><span class="op" id="4012581">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012584">pHash</span><span class="op" id="4012589">(</span><span class="ident" id="4012590">result2</span><span class="op" id="4012597">,</span>&nbsp;<span class="ident" id="4012599">s2</span><span class="op" id="4012601">,</span>&nbsp;<span class="ident" id="4012603">labelAndSeed</span><span class="op" id="4012615">,</span>&nbsp;<span class="ident" id="4012617">hashSHA1</span><span class="op" id="4012625">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4012629">for</span>&nbsp;<span class="ident" id="4012633">i</span><span class="op" id="4012634">,</span>&nbsp;<span class="ident" id="4012636">b</span>&nbsp;<span class="op" id="4012638">:=</span>&nbsp;<span class="keyword" id="4012641">range</span>&nbsp;<span class="ident" id="4012647">result2</span>&nbsp;<span class="op" id="4012655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012659">result</span><span class="op" id="4012665">[</span><span class="ident" id="4012666">i</span><span class="op" id="4012667">]</span>&nbsp;<span class="op" id="4012669">^=</span>&nbsp;<span class="ident" id="4012672">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4012675">}</span><br>
<span class="lineno">65</span><span class="op" id="4012677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4012680">//&nbsp;prf12&nbsp;implements&nbsp;the&nbsp;TLS&nbsp;1.2&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="4012771">func</span>&nbsp;<span class="ident" id="4012776">prf12</span><span class="op" id="4012781">(</span><span class="ident" id="4012782">result</span><span class="op" id="4012788">,</span>&nbsp;<span class="ident" id="4012790">secret</span><span class="op" id="4012796">,</span>&nbsp;<span class="ident" id="4012798">label</span><span class="op" id="4012803">,</span>&nbsp;<span class="ident" id="4012805">seed</span>&nbsp;<span class="op" id="4012810">[</span><span class="op" id="4012811">]</span><span class="builtintype" id="4012812">byte</span><span class="op" id="4012816">)</span>&nbsp;<span class="op" id="4012818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012821">labelAndSeed</span>&nbsp;<span class="op" id="4012834">:=</span>&nbsp;<span class="builtinfunc" id="4012837">make</span><span class="op" id="4012841">(</span><span class="op" id="4012842">[</span><span class="op" id="4012843">]</span><span class="builtintype" id="4012844">byte</span><span class="op" id="4012848">,</span>&nbsp;<span class="builtinfunc" id="4012850">len</span><span class="op" id="4012853">(</span><span class="ident" id="4012854">label</span><span class="op" id="4012859">)</span><span class="op" id="4012860">+</span><span class="builtinfunc" id="4012861">len</span><span class="op" id="4012864">(</span><span class="ident" id="4012865">seed</span><span class="op" id="4012869">)</span><span class="op" id="4012870">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4012873">copy</span><span class="op" id="4012877">(</span><span class="ident" id="4012878">labelAndSeed</span><span class="op" id="4012890">,</span>&nbsp;<span class="ident" id="4012892">label</span><span class="op" id="4012897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4012900">copy</span><span class="op" id="4012904">(</span><span class="ident" id="4012905">labelAndSeed</span><span class="op" id="4012917">[</span><span class="builtinfunc" id="4012918">len</span><span class="op" id="4012921">(</span><span class="ident" id="4012922">label</span><span class="op" id="4012927">)</span><span class="op" id="4012928">:</span><span class="op" id="4012929">]</span><span class="op" id="4012930">,</span>&nbsp;<span class="ident" id="4012932">seed</span><span class="op" id="4012936">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012940">pHash</span><span class="op" id="4012945">(</span><span class="ident" id="4012946">result</span><span class="op" id="4012952">,</span>&nbsp;<span class="ident" id="4012954">secret</span><span class="op" id="4012960">,</span>&nbsp;<span class="ident" id="4012962">labelAndSeed</span><span class="op" id="4012974">,</span>&nbsp;<span class="ident" id="4012976">sha256</span><span class="op" id="4012982">.</span><span class="ident" id="4012983">New</span><span class="op" id="4012986">)</span><br>
<span class="lineno"></span><span class="op" id="4012988">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="4012991">//&nbsp;prf30&nbsp;implements&nbsp;the&nbsp;SSL&nbsp;3.0&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4013061">//&nbsp;www.mozilla.org/projects/security/pki/nss/ssl/draft302.txt&nbsp;section&nbsp;6.</span><br>
<span class="lineno"></span><span class="keyword" id="4013134">func</span>&nbsp;<span class="ident" id="4013139">prf30</span><span class="op" id="4013144">(</span><span class="ident" id="4013145">result</span><span class="op" id="4013151">,</span>&nbsp;<span class="ident" id="4013153">secret</span><span class="op" id="4013159">,</span>&nbsp;<span class="ident" id="4013161">label</span><span class="op" id="4013166">,</span>&nbsp;<span class="ident" id="4013168">seed</span>&nbsp;<span class="op" id="4013173">[</span><span class="op" id="4013174">]</span><span class="builtintype" id="4013175">byte</span><span class="op" id="4013179">)</span>&nbsp;<span class="op" id="4013181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013184">hashSHA1</span>&nbsp;<span class="op" id="4013193">:=</span>&nbsp;<span class="ident" id="4013196">sha1</span><span class="op" id="4013200">.</span><span class="ident" id="4013201">New</span><span class="op" id="4013204">(</span><span class="op" id="4013205">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013208">hashMD5</span>&nbsp;<span class="op" id="4013216">:=</span>&nbsp;<span class="ident" id="4013219">md5</span><span class="op" id="4013222">.</span><span class="ident" id="4013223">New</span><span class="op" id="4013226">(</span><span class="op" id="4013227">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013231">done</span>&nbsp;<span class="op" id="4013236">:=</span>&nbsp;<span class="num" id="4013239">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013242">i</span>&nbsp;<span class="op" id="4013244">:=</span>&nbsp;<span class="num" id="4013247">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4013250">//&nbsp;RFC5246&nbsp;section&nbsp;6.3&nbsp;says&nbsp;that&nbsp;the&nbsp;largest&nbsp;PRF&nbsp;output&nbsp;needed&nbsp;is&nbsp;128</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4013321">//&nbsp;bytes.&nbsp;Since&nbsp;no&nbsp;more&nbsp;ciphersuites&nbsp;will&nbsp;be&nbsp;added&nbsp;to&nbsp;SSLv3,&nbsp;this&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4013393">//&nbsp;remain&nbsp;true.&nbsp;Each&nbsp;iteration&nbsp;gives&nbsp;us&nbsp;16&nbsp;bytes&nbsp;so&nbsp;10&nbsp;iterations&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4013465">//&nbsp;be&nbsp;sufficient.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4013484">var</span>&nbsp;<span class="ident" id="4013488">b</span>&nbsp;<span class="op" id="4013490">[</span><span class="num" id="4013491">11</span><span class="op" id="4013493">]</span><span class="builtintype" id="4013494">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4013500">for</span>&nbsp;<span class="ident" id="4013504">done</span>&nbsp;<span class="op" id="4013509">&lt;</span>&nbsp;<span class="builtinfunc" id="4013511">len</span><span class="op" id="4013514">(</span><span class="ident" id="4013515">result</span><span class="op" id="4013521">)</span>&nbsp;<span class="op" id="4013523">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4013527">for</span>&nbsp;<span class="ident" id="4013531">j</span>&nbsp;<span class="op" id="4013533">:=</span>&nbsp;<span class="num" id="4013536">0</span><span class="op" id="4013537">;</span>&nbsp;<span class="ident" id="4013539">j</span>&nbsp;<span class="op" id="4013541">&lt;=</span>&nbsp;<span class="ident" id="4013544">i</span><span class="op" id="4013545">;</span>&nbsp;<span class="ident" id="4013547">j</span><span class="op" id="4013548">++</span>&nbsp;<span class="op" id="4013551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013556">b</span><span class="op" id="4013557">[</span><span class="ident" id="4013558">j</span><span class="op" id="4013559">]</span>&nbsp;<span class="op" id="4013561">=</span>&nbsp;<span class="string" id="4013563">&#39;A&#39;</span>&nbsp;<span class="op" id="4013567">+</span>&nbsp;<span class="builtintype" id="4013569">byte</span><span class="op" id="4013573">(</span><span class="ident" id="4013574">i</span><span class="op" id="4013575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4013579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013584">hashSHA1</span><span class="op" id="4013592">.</span><span class="ident" id="4013593">Reset</span><span class="op" id="4013598">(</span><span class="op" id="4013599">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013603">hashSHA1</span><span class="op" id="4013611">.</span><span class="ident" id="4013612">Write</span><span class="op" id="4013617">(</span><span class="ident" id="4013618">b</span><span class="op" id="4013619">[</span><span class="op" id="4013620">:</span><span class="ident" id="4013621">i</span><span class="op" id="4013622">+</span><span class="num" id="4013623">1</span><span class="op" id="4013624">]</span><span class="op" id="4013625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013629">hashSHA1</span><span class="op" id="4013637">.</span><span class="ident" id="4013638">Write</span><span class="op" id="4013643">(</span><span class="ident" id="4013644">secret</span><span class="op" id="4013650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013654">hashSHA1</span><span class="op" id="4013662">.</span><span class="ident" id="4013663">Write</span><span class="op" id="4013668">(</span><span class="ident" id="4013669">seed</span><span class="op" id="4013673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013677">digest</span>&nbsp;<span class="op" id="4013684">:=</span>&nbsp;<span class="ident" id="4013687">hashSHA1</span><span class="op" id="4013695">.</span><span class="ident" id="4013696">Sum</span><span class="op" id="4013699">(</span><span class="ident" id="4013700">nil</span><span class="op" id="4013703">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013708">hashMD5</span><span class="op" id="4013715">.</span><span class="ident" id="4013716">Reset</span><span class="op" id="4013721">(</span><span class="op" id="4013722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013726">hashMD5</span><span class="op" id="4013733">.</span><span class="ident" id="4013734">Write</span><span class="op" id="4013739">(</span><span class="ident" id="4013740">secret</span><span class="op" id="4013746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013750">hashMD5</span><span class="op" id="4013757">.</span><span class="ident" id="4013758">Write</span><span class="op" id="4013763">(</span><span class="ident" id="4013764">digest</span><span class="op" id="4013770">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013775">done</span>&nbsp;<span class="op" id="4013780">+=</span>&nbsp;<span class="builtinfunc" id="4013783">copy</span><span class="op" id="4013787">(</span><span class="ident" id="4013788">result</span><span class="op" id="4013794">[</span><span class="ident" id="4013795">done</span><span class="op" id="4013799">:</span><span class="op" id="4013800">]</span><span class="op" id="4013801">,</span>&nbsp;<span class="ident" id="4013803">hashMD5</span><span class="op" id="4013810">.</span><span class="ident" id="4013811">Sum</span><span class="op" id="4013814">(</span><span class="ident" id="4013815">nil</span><span class="op" id="4013818">)</span><span class="op" id="4013819">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013823">i</span><span class="op" id="4013824">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4013828">}</span><br>
<span class="lineno"></span><span class="op" id="4013830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4013833">const</span>&nbsp;<span class="op" id="4013839">(</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013842">tlsRandomLength</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4013863">=</span>&nbsp;<span class="num" id="4013865">32</span>&nbsp;<span class="comment" id="4013868">//&nbsp;Length&nbsp;of&nbsp;a&nbsp;random&nbsp;nonce&nbsp;in&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013909">masterSecretLength</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4013930">=</span>&nbsp;<span class="num" id="4013932">48</span>&nbsp;<span class="comment" id="4013935">//&nbsp;Length&nbsp;of&nbsp;a&nbsp;master&nbsp;secret&nbsp;in&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013977">finishedVerifyLength</span>&nbsp;<span class="op" id="4013998">=</span>&nbsp;<span class="num" id="4014000">12</span>&nbsp;<span class="comment" id="4014003">//&nbsp;Length&nbsp;of&nbsp;verify_data&nbsp;in&nbsp;a&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="op" id="4014051">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="4014054">var</span>&nbsp;<span class="ident" id="4014058">masterSecretLabel</span>&nbsp;<span class="op" id="4014076">=</span>&nbsp;<span class="op" id="4014078">[</span><span class="op" id="4014079">]</span><span class="builtintype" id="4014080">byte</span><span class="op" id="4014084">(</span><span class="string" id="4014085">&#34;master&nbsp;secret&#34;</span><span class="op" id="4014100">)</span><br>
<span class="lineno"></span><span class="keyword" id="4014102">var</span>&nbsp;<span class="ident" id="4014106">keyExpansionLabel</span>&nbsp;<span class="op" id="4014124">=</span>&nbsp;<span class="op" id="4014126">[</span><span class="op" id="4014127">]</span><span class="builtintype" id="4014128">byte</span><span class="op" id="4014132">(</span><span class="string" id="4014133">&#34;key&nbsp;expansion&#34;</span><span class="op" id="4014148">)</span><br>
<span class="lineno"></span><span class="keyword" id="4014150">var</span>&nbsp;<span class="ident" id="4014154">clientFinishedLabel</span>&nbsp;<span class="op" id="4014174">=</span>&nbsp;<span class="op" id="4014176">[</span><span class="op" id="4014177">]</span><span class="builtintype" id="4014178">byte</span><span class="op" id="4014182">(</span><span class="string" id="4014183">&#34;client&nbsp;finished&#34;</span><span class="op" id="4014200">)</span><br>
<span class="lineno"></span><span class="keyword" id="4014202">var</span>&nbsp;<span class="ident" id="4014206">serverFinishedLabel</span>&nbsp;<span class="op" id="4014226">=</span>&nbsp;<span class="op" id="4014228">[</span><span class="op" id="4014229">]</span><span class="builtintype" id="4014230">byte</span><span class="op" id="4014234">(</span><span class="string" id="4014235">&#34;server&nbsp;finished&#34;</span><span class="op" id="4014252">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="4014255">func</span>&nbsp;<span class="ident" id="4014260">prfForVersion</span><span class="op" id="4014273">(</span><span class="ident" id="4014274">version</span>&nbsp;<span class="builtintype" id="4014282">uint16</span><span class="op" id="4014288">)</span>&nbsp;<span class="keyword" id="4014290">func</span><span class="op" id="4014294">(</span><span class="ident" id="4014295">result</span><span class="op" id="4014301">,</span>&nbsp;<span class="ident" id="4014303">secret</span><span class="op" id="4014309">,</span>&nbsp;<span class="ident" id="4014311">label</span><span class="op" id="4014316">,</span>&nbsp;<span class="ident" id="4014318">seed</span>&nbsp;<span class="op" id="4014323">[</span><span class="op" id="4014324">]</span><span class="builtintype" id="4014325">byte</span><span class="op" id="4014329">)</span>&nbsp;<span class="op" id="4014331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4014334">switch</span>&nbsp;<span class="ident" id="4014341">version</span>&nbsp;<span class="op" id="4014349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4014352">case</span>&nbsp;<span class="ident" id="4014357">VersionSSL30</span><span class="op" id="4014369">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4014373">return</span>&nbsp;<span class="ident" id="4014380">prf30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4014387">case</span>&nbsp;<span class="ident" id="4014392">VersionTLS10</span><span class="op" id="4014404">,</span>&nbsp;<span class="ident" id="4014406">VersionTLS11</span><span class="op" id="4014418">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4014422">return</span>&nbsp;<span class="ident" id="4014429">prf10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4014436">case</span>&nbsp;<span class="ident" id="4014441">VersionTLS12</span><span class="op" id="4014453">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4014457">return</span>&nbsp;<span class="ident" id="4014464">prf12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4014471">default</span><span class="op" id="4014478">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4014482">panic</span><span class="op" id="4014487">(</span><span class="string" id="4014488">&#34;unknown&nbsp;version&#34;</span><span class="op" id="4014505">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4014508">}</span><br>
<span class="lineno"></span><span class="op" id="4014510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4014513">//&nbsp;masterFromPreMasterSecret&nbsp;generates&nbsp;the&nbsp;master&nbsp;secret&nbsp;from&nbsp;the&nbsp;pre-master</span><br>
<span class="lineno"></span><span class="comment" id="4014590">//&nbsp;secret.&nbsp;See&nbsp;http://tools.ietf.org/html/rfc5246#section-8.1</span><br>
<span class="lineno">135</span><span class="keyword" id="4014652">func</span>&nbsp;<span class="ident" id="4014657">masterFromPreMasterSecret</span><span class="op" id="4014682">(</span><span class="ident" id="4014683">version</span>&nbsp;<span class="builtintype" id="4014691">uint16</span><span class="op" id="4014697">,</span>&nbsp;<span class="ident" id="4014699">preMasterSecret</span><span class="op" id="4014714">,</span>&nbsp;<span class="ident" id="4014716">clientRandom</span><span class="op" id="4014728">,</span>&nbsp;<span class="ident" id="4014730">serverRandom</span>&nbsp;<span class="op" id="4014743">[</span><span class="op" id="4014744">]</span><span class="builtintype" id="4014745">byte</span><span class="op" id="4014749">)</span>&nbsp;<span class="op" id="4014751">[</span><span class="op" id="4014752">]</span><span class="builtintype" id="4014753">byte</span>&nbsp;<span class="op" id="4014758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4014761">var</span>&nbsp;<span class="ident" id="4014765">seed</span>&nbsp;<span class="op" id="4014770">[</span><span class="ident" id="4014771">tlsRandomLength</span>&nbsp;<span class="op" id="4014787">*</span>&nbsp;<span class="num" id="4014789">2</span><span class="op" id="4014790">]</span><span class="builtintype" id="4014791">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4014797">copy</span><span class="op" id="4014801">(</span><span class="ident" id="4014802">seed</span><span class="op" id="4014806">[</span><span class="num" id="4014807">0</span><span class="op" id="4014808">:</span><span class="builtinfunc" id="4014809">len</span><span class="op" id="4014812">(</span><span class="ident" id="4014813">clientRandom</span><span class="op" id="4014825">)</span><span class="op" id="4014826">]</span><span class="op" id="4014827">,</span>&nbsp;<span class="ident" id="4014829">clientRandom</span><span class="op" id="4014841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4014844">copy</span><span class="op" id="4014848">(</span><span class="ident" id="4014849">seed</span><span class="op" id="4014853">[</span><span class="builtinfunc" id="4014854">len</span><span class="op" id="4014857">(</span><span class="ident" id="4014858">clientRandom</span><span class="op" id="4014870">)</span><span class="op" id="4014871">:</span><span class="op" id="4014872">]</span><span class="op" id="4014873">,</span>&nbsp;<span class="ident" id="4014875">serverRandom</span><span class="op" id="4014887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4014890">masterSecret</span>&nbsp;<span class="op" id="4014903">:=</span>&nbsp;<span class="builtinfunc" id="4014906">make</span><span class="op" id="4014910">(</span><span class="op" id="4014911">[</span><span class="op" id="4014912">]</span><span class="builtintype" id="4014913">byte</span><span class="op" id="4014917">,</span>&nbsp;<span class="ident" id="4014919">masterSecretLength</span><span class="op" id="4014937">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4014940">prfForVersion</span><span class="op" id="4014953">(</span><span class="ident" id="4014954">version</span><span class="op" id="4014961">)</span><span class="op" id="4014962">(</span><span class="ident" id="4014963">masterSecret</span><span class="op" id="4014975">,</span>&nbsp;<span class="ident" id="4014977">preMasterSecret</span><span class="op" id="4014992">,</span>&nbsp;<span class="ident" id="4014994">masterSecretLabel</span><span class="op" id="4015011">,</span>&nbsp;<span class="ident" id="4015013">seed</span><span class="op" id="4015017">[</span><span class="num" id="4015018">0</span><span class="op" id="4015019">:</span><span class="op" id="4015020">]</span><span class="op" id="4015021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4015024">return</span>&nbsp;<span class="ident" id="4015031">masterSecret</span><br>
<span class="lineno"></span><span class="op" id="4015044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4015047">//&nbsp;keysFromMasterSecret&nbsp;generates&nbsp;the&nbsp;connection&nbsp;keys&nbsp;from&nbsp;the&nbsp;master</span><br>
<span class="lineno">145</span><span class="comment" id="4015117">//&nbsp;secret,&nbsp;given&nbsp;the&nbsp;lengths&nbsp;of&nbsp;the&nbsp;MAC&nbsp;key,&nbsp;cipher&nbsp;key&nbsp;and&nbsp;IV,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4015195">//&nbsp;RFC&nbsp;2246,&nbsp;section&nbsp;6.3.</span><br>
<span class="lineno"></span><span class="keyword" id="4015221">func</span>&nbsp;<span class="ident" id="4015226">keysFromMasterSecret</span><span class="op" id="4015246">(</span><span class="ident" id="4015247">version</span>&nbsp;<span class="builtintype" id="4015255">uint16</span><span class="op" id="4015261">,</span>&nbsp;<span class="ident" id="4015263">masterSecret</span><span class="op" id="4015275">,</span>&nbsp;<span class="ident" id="4015277">clientRandom</span><span class="op" id="4015289">,</span>&nbsp;<span class="ident" id="4015291">serverRandom</span>&nbsp;<span class="op" id="4015304">[</span><span class="op" id="4015305">]</span><span class="builtintype" id="4015306">byte</span><span class="op" id="4015310">,</span>&nbsp;<span class="ident" id="4015312">macLen</span><span class="op" id="4015318">,</span>&nbsp;<span class="ident" id="4015320">keyLen</span><span class="op" id="4015326">,</span>&nbsp;<span class="ident" id="4015328">ivLen</span>&nbsp;<span class="builtintype" id="4015334">int</span><span class="op" id="4015337">)</span>&nbsp;<span class="op" id="4015339">(</span><span class="ident" id="4015340">clientMAC</span><span class="op" id="4015349">,</span>&nbsp;<span class="ident" id="4015351">serverMAC</span><span class="op" id="4015360">,</span>&nbsp;<span class="ident" id="4015362">clientKey</span><span class="op" id="4015371">,</span>&nbsp;<span class="ident" id="4015373">serverKey</span><span class="op" id="4015382">,</span>&nbsp;<span class="ident" id="4015384">clientIV</span><span class="op" id="4015392">,</span>&nbsp;<span class="ident" id="4015394">serverIV</span>&nbsp;<span class="op" id="4015403">[</span><span class="op" id="4015404">]</span><span class="builtintype" id="4015405">byte</span><span class="op" id="4015409">)</span>&nbsp;<span class="op" id="4015411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4015414">var</span>&nbsp;<span class="ident" id="4015418">seed</span>&nbsp;<span class="op" id="4015423">[</span><span class="ident" id="4015424">tlsRandomLength</span>&nbsp;<span class="op" id="4015440">*</span>&nbsp;<span class="num" id="4015442">2</span><span class="op" id="4015443">]</span><span class="builtintype" id="4015444">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4015450">copy</span><span class="op" id="4015454">(</span><span class="ident" id="4015455">seed</span><span class="op" id="4015459">[</span><span class="num" id="4015460">0</span><span class="op" id="4015461">:</span><span class="builtinfunc" id="4015462">len</span><span class="op" id="4015465">(</span><span class="ident" id="4015466">clientRandom</span><span class="op" id="4015478">)</span><span class="op" id="4015479">]</span><span class="op" id="4015480">,</span>&nbsp;<span class="ident" id="4015482">serverRandom</span><span class="op" id="4015494">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4015497">copy</span><span class="op" id="4015501">(</span><span class="ident" id="4015502">seed</span><span class="op" id="4015506">[</span><span class="builtinfunc" id="4015507">len</span><span class="op" id="4015510">(</span><span class="ident" id="4015511">serverRandom</span><span class="op" id="4015523">)</span><span class="op" id="4015524">:</span><span class="op" id="4015525">]</span><span class="op" id="4015526">,</span>&nbsp;<span class="ident" id="4015528">clientRandom</span><span class="op" id="4015540">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4015544">n</span>&nbsp;<span class="op" id="4015546">:=</span>&nbsp;<span class="num" id="4015549">2</span><span class="op" id="4015550">*</span><span class="ident" id="4015551">macLen</span>&nbsp;<span class="op" id="4015558">+</span>&nbsp;<span class="num" id="4015560">2</span><span class="op" id="4015561">*</span><span class="ident" id="4015562">keyLen</span>&nbsp;<span class="op" id="4015569">+</span>&nbsp;<span class="num" id="4015571">2</span><span class="op" id="4015572">*</span><span class="ident" id="4015573">ivLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4015580">keyMaterial</span>&nbsp;<span class="op" id="4015592">:=</span>&nbsp;<span class="builtinfunc" id="4015595">make</span><span class="op" id="4015599">(</span><span class="op" id="4015600">[</span><span class="op" id="4015601">]</span><span class="builtintype" id="4015602">byte</span><span class="op" id="4015606">,</span>&nbsp;<span class="ident" id="4015608">n</span><span class="op" id="4015609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4015612">prfForVersion</span><span class="op" id="4015625">(</span><span class="ident" id="4015626">version</span><span class="op" id="4015633">)</span><span class="op" id="4015634">(</span><span class="ident" id="4015635">keyMaterial</span><span class="op" id="4015646">,</span>&nbsp;<span class="ident" id="4015648">masterSecret</span><span class="op" id="4015660">,</span>&nbsp;<span class="ident" id="4015662">keyExpansionLabel</span><span class="op" id="4015679">,</span>&nbsp;<span class="ident" id="4015681">seed</span><span class="op" id="4015685">[</span><span class="num" id="4015686">0</span><span class="op" id="4015687">:</span><span class="op" id="4015688">]</span><span class="op" id="4015689">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4015692">clientMAC</span>&nbsp;<span class="op" id="4015702">=</span>&nbsp;<span class="ident" id="4015704">keyMaterial</span><span class="op" id="4015715">[</span><span class="op" id="4015716">:</span><span class="ident" id="4015717">macLen</span><span class="op" id="4015723">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4015726">keyMaterial</span>&nbsp;<span class="op" id="4015738">=</span>&nbsp;<span class="ident" id="4015740">keyMaterial</span><span class="op" id="4015751">[</span><span class="ident" id="4015752">macLen</span><span class="op" id="4015758">:</span><span class="op" id="4015759">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4015762">serverMAC</span>&nbsp;<span class="op" id="4015772">=</span>&nbsp;<span class="ident" id="4015774">keyMaterial</span><span class="op" id="4015785">[</span><span class="op" id="4015786">:</span><span class="ident" id="4015787">macLen</span><span class="op" id="4015793">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4015796">keyMaterial</span>&nbsp;<span class="op" id="4015808">=</span>&nbsp;<span class="ident" id="4015810">keyMaterial</span><span class="op" id="4015821">[</span><span class="ident" id="4015822">macLen</span><span class="op" id="4015828">:</span><span class="op" id="4015829">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4015832">clientKey</span>&nbsp;<span class="op" id="4015842">=</span>&nbsp;<span class="ident" id="4015844">keyMaterial</span><span class="op" id="4015855">[</span><span class="op" id="4015856">:</span><span class="ident" id="4015857">keyLen</span><span class="op" id="4015863">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4015866">keyMaterial</span>&nbsp;<span class="op" id="4015878">=</span>&nbsp;<span class="ident" id="4015880">keyMaterial</span><span class="op" id="4015891">[</span><span class="ident" id="4015892">keyLen</span><span class="op" id="4015898">:</span><span class="op" id="4015899">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4015902">serverKey</span>&nbsp;<span class="op" id="4015912">=</span>&nbsp;<span class="ident" id="4015914">keyMaterial</span><span class="op" id="4015925">[</span><span class="op" id="4015926">:</span><span class="ident" id="4015927">keyLen</span><span class="op" id="4015933">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4015936">keyMaterial</span>&nbsp;<span class="op" id="4015948">=</span>&nbsp;<span class="ident" id="4015950">keyMaterial</span><span class="op" id="4015961">[</span><span class="ident" id="4015962">keyLen</span><span class="op" id="4015968">:</span><span class="op" id="4015969">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4015972">clientIV</span>&nbsp;<span class="op" id="4015981">=</span>&nbsp;<span class="ident" id="4015983">keyMaterial</span><span class="op" id="4015994">[</span><span class="op" id="4015995">:</span><span class="ident" id="4015996">ivLen</span><span class="op" id="4016001">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016004">keyMaterial</span>&nbsp;<span class="op" id="4016016">=</span>&nbsp;<span class="ident" id="4016018">keyMaterial</span><span class="op" id="4016029">[</span><span class="ident" id="4016030">ivLen</span><span class="op" id="4016035">:</span><span class="op" id="4016036">]</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016039">serverIV</span>&nbsp;<span class="op" id="4016048">=</span>&nbsp;<span class="ident" id="4016050">keyMaterial</span><span class="op" id="4016061">[</span><span class="op" id="4016062">:</span><span class="ident" id="4016063">ivLen</span><span class="op" id="4016068">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4016071">return</span><br>
<span class="lineno"></span><span class="op" id="4016078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4016081">func</span>&nbsp;<span class="ident" id="4016086">newFinishedHash</span><span class="op" id="4016101">(</span><span class="ident" id="4016102">version</span>&nbsp;<span class="builtintype" id="4016110">uint16</span><span class="op" id="4016116">)</span>&nbsp;<span class="ident" id="4016118">finishedHash</span>&nbsp;<span class="op" id="4016131">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4016134">if</span>&nbsp;<span class="ident" id="4016137">version</span>&nbsp;<span class="op" id="4016145">&gt;=</span>&nbsp;<span class="ident" id="4016148">VersionTLS12</span>&nbsp;<span class="op" id="4016161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4016165">return</span>&nbsp;<span class="ident" id="4016172">finishedHash</span><span class="op" id="4016184">{</span><span class="ident" id="4016185">sha256</span><span class="op" id="4016191">.</span><span class="ident" id="4016192">New</span><span class="op" id="4016195">(</span><span class="op" id="4016196">)</span><span class="op" id="4016197">,</span>&nbsp;<span class="ident" id="4016199">sha256</span><span class="op" id="4016205">.</span><span class="ident" id="4016206">New</span><span class="op" id="4016209">(</span><span class="op" id="4016210">)</span><span class="op" id="4016211">,</span>&nbsp;<span class="ident" id="4016213">nil</span><span class="op" id="4016216">,</span>&nbsp;<span class="ident" id="4016218">nil</span><span class="op" id="4016221">,</span>&nbsp;<span class="ident" id="4016223">version</span><span class="op" id="4016230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4016233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4016236">return</span>&nbsp;<span class="ident" id="4016243">finishedHash</span><span class="op" id="4016255">{</span><span class="ident" id="4016256">sha1</span><span class="op" id="4016260">.</span><span class="ident" id="4016261">New</span><span class="op" id="4016264">(</span><span class="op" id="4016265">)</span><span class="op" id="4016266">,</span>&nbsp;<span class="ident" id="4016268">sha1</span><span class="op" id="4016272">.</span><span class="ident" id="4016273">New</span><span class="op" id="4016276">(</span><span class="op" id="4016277">)</span><span class="op" id="4016278">,</span>&nbsp;<span class="ident" id="4016280">md5</span><span class="op" id="4016283">.</span><span class="ident" id="4016284">New</span><span class="op" id="4016287">(</span><span class="op" id="4016288">)</span><span class="op" id="4016289">,</span>&nbsp;<span class="ident" id="4016291">md5</span><span class="op" id="4016294">.</span><span class="ident" id="4016295">New</span><span class="op" id="4016298">(</span><span class="op" id="4016299">)</span><span class="op" id="4016300">,</span>&nbsp;<span class="ident" id="4016302">version</span><span class="op" id="4016309">}</span><br>
<span class="lineno"></span><span class="op" id="4016311">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="4016314">//&nbsp;A&nbsp;finishedHash&nbsp;calculates&nbsp;the&nbsp;hash&nbsp;of&nbsp;a&nbsp;set&nbsp;of&nbsp;handshake&nbsp;messages&nbsp;suitable</span><br>
<span class="lineno"></span><span class="comment" id="4016392">//&nbsp;for&nbsp;including&nbsp;in&nbsp;a&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="4016432">type</span>&nbsp;<span class="ident" id="4016437">finishedHash</span>&nbsp;<span class="keyword" id="4016450">struct</span>&nbsp;<span class="op" id="4016457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016460">client</span>&nbsp;<span class="ident" id="4016467">hash</span><span class="op" id="4016471">.</span><span class="ident" id="4016472">Hash</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016478">server</span>&nbsp;<span class="ident" id="4016485">hash</span><span class="op" id="4016489">.</span><span class="ident" id="4016490">Hash</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4016497">//&nbsp;Prior&nbsp;to&nbsp;TLS&nbsp;1.2,&nbsp;an&nbsp;additional&nbsp;MD5&nbsp;hash&nbsp;is&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016555">clientMD5</span>&nbsp;<span class="ident" id="4016565">hash</span><span class="op" id="4016569">.</span><span class="ident" id="4016570">Hash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016576">serverMD5</span>&nbsp;<span class="ident" id="4016586">hash</span><span class="op" id="4016590">.</span><span class="ident" id="4016591">Hash</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016598">version</span>&nbsp;<span class="builtintype" id="4016606">uint16</span><br>
<span class="lineno"></span><span class="op" id="4016613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4016616">func</span>&nbsp;<span class="op" id="4016621">(</span><span class="ident" id="4016622">h</span>&nbsp;<span class="ident" id="4016624">finishedHash</span><span class="op" id="4016636">)</span>&nbsp;<span class="ident" id="4016638">Write</span><span class="op" id="4016643">(</span><span class="ident" id="4016644">msg</span>&nbsp;<span class="op" id="4016648">[</span><span class="op" id="4016649">]</span><span class="builtintype" id="4016650">byte</span><span class="op" id="4016654">)</span>&nbsp;<span class="op" id="4016656">(</span><span class="ident" id="4016657">n</span>&nbsp;<span class="builtintype" id="4016659">int</span><span class="op" id="4016662">,</span>&nbsp;<span class="ident" id="4016664">err</span>&nbsp;<span class="builtintype" id="4016668">error</span><span class="op" id="4016673">)</span>&nbsp;<span class="op" id="4016675">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016678">h</span><span class="op" id="4016679">.</span><span class="ident" id="4016680">client</span><span class="op" id="4016686">.</span><span class="ident" id="4016687">Write</span><span class="op" id="4016692">(</span><span class="ident" id="4016693">msg</span><span class="op" id="4016696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016699">h</span><span class="op" id="4016700">.</span><span class="ident" id="4016701">server</span><span class="op" id="4016707">.</span><span class="ident" id="4016708">Write</span><span class="op" id="4016713">(</span><span class="ident" id="4016714">msg</span><span class="op" id="4016717">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4016721">if</span>&nbsp;<span class="ident" id="4016724">h</span><span class="op" id="4016725">.</span><span class="ident" id="4016726">version</span>&nbsp;<span class="op" id="4016734">&lt;</span>&nbsp;<span class="ident" id="4016736">VersionTLS12</span>&nbsp;<span class="op" id="4016749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016753">h</span><span class="op" id="4016754">.</span><span class="ident" id="4016755">clientMD5</span><span class="op" id="4016764">.</span><span class="ident" id="4016765">Write</span><span class="op" id="4016770">(</span><span class="ident" id="4016771">msg</span><span class="op" id="4016774">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016778">h</span><span class="op" id="4016779">.</span><span class="ident" id="4016780">serverMD5</span><span class="op" id="4016789">.</span><span class="ident" id="4016790">Write</span><span class="op" id="4016795">(</span><span class="ident" id="4016796">msg</span><span class="op" id="4016799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4016802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4016805">return</span>&nbsp;<span class="builtinfunc" id="4016812">len</span><span class="op" id="4016815">(</span><span class="ident" id="4016816">msg</span><span class="op" id="4016819">)</span><span class="op" id="4016820">,</span>&nbsp;<span class="ident" id="4016822">nil</span><br>
<span class="lineno"></span><span class="op" id="4016826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="4016829">//&nbsp;finishedSum30&nbsp;calculates&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;SSLv3</span><br>
<span class="lineno"></span><span class="comment" id="4016907">//&nbsp;Finished&nbsp;message&nbsp;given&nbsp;the&nbsp;MD5&nbsp;and&nbsp;SHA1&nbsp;hashes&nbsp;of&nbsp;a&nbsp;set&nbsp;of&nbsp;handshake</span><br>
<span class="lineno"></span><span class="comment" id="4016979">//&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="4016992">func</span>&nbsp;<span class="ident" id="4016997">finishedSum30</span><span class="op" id="4017010">(</span><span class="ident" id="4017011">md5</span><span class="op" id="4017014">,</span>&nbsp;<span class="ident" id="4017016">sha1</span>&nbsp;<span class="ident" id="4017021">hash</span><span class="op" id="4017025">.</span><span class="ident" id="4017026">Hash</span><span class="op" id="4017030">,</span>&nbsp;<span class="ident" id="4017032">masterSecret</span>&nbsp;<span class="op" id="4017045">[</span><span class="op" id="4017046">]</span><span class="builtintype" id="4017047">byte</span><span class="op" id="4017051">,</span>&nbsp;<span class="ident" id="4017053">magic</span>&nbsp;<span class="op" id="4017059">[</span><span class="num" id="4017060">4</span><span class="op" id="4017061">]</span><span class="builtintype" id="4017062">byte</span><span class="op" id="4017066">)</span>&nbsp;<span class="op" id="4017068">[</span><span class="op" id="4017069">]</span><span class="builtintype" id="4017070">byte</span>&nbsp;<span class="op" id="4017075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017078">md5</span><span class="op" id="4017081">.</span><span class="ident" id="4017082">Write</span><span class="op" id="4017087">(</span><span class="ident" id="4017088">magic</span><span class="op" id="4017093">[</span><span class="op" id="4017094">:</span><span class="op" id="4017095">]</span><span class="op" id="4017096">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017099">md5</span><span class="op" id="4017102">.</span><span class="ident" id="4017103">Write</span><span class="op" id="4017108">(</span><span class="ident" id="4017109">masterSecret</span><span class="op" id="4017121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017124">md5</span><span class="op" id="4017127">.</span><span class="ident" id="4017128">Write</span><span class="op" id="4017133">(</span><span class="ident" id="4017134">ssl30Pad1</span><span class="op" id="4017143">[</span><span class="op" id="4017144">:</span><span class="op" id="4017145">]</span><span class="op" id="4017146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017149">md5Digest</span>&nbsp;<span class="op" id="4017159">:=</span>&nbsp;<span class="ident" id="4017162">md5</span><span class="op" id="4017165">.</span><span class="ident" id="4017166">Sum</span><span class="op" id="4017169">(</span><span class="ident" id="4017170">nil</span><span class="op" id="4017173">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017177">md5</span><span class="op" id="4017180">.</span><span class="ident" id="4017181">Reset</span><span class="op" id="4017186">(</span><span class="op" id="4017187">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017190">md5</span><span class="op" id="4017193">.</span><span class="ident" id="4017194">Write</span><span class="op" id="4017199">(</span><span class="ident" id="4017200">masterSecret</span><span class="op" id="4017212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017215">md5</span><span class="op" id="4017218">.</span><span class="ident" id="4017219">Write</span><span class="op" id="4017224">(</span><span class="ident" id="4017225">ssl30Pad2</span><span class="op" id="4017234">[</span><span class="op" id="4017235">:</span><span class="op" id="4017236">]</span><span class="op" id="4017237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017240">md5</span><span class="op" id="4017243">.</span><span class="ident" id="4017244">Write</span><span class="op" id="4017249">(</span><span class="ident" id="4017250">md5Digest</span><span class="op" id="4017259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017262">md5Digest</span>&nbsp;<span class="op" id="4017272">=</span>&nbsp;<span class="ident" id="4017274">md5</span><span class="op" id="4017277">.</span><span class="ident" id="4017278">Sum</span><span class="op" id="4017281">(</span><span class="ident" id="4017282">nil</span><span class="op" id="4017285">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017289">sha1</span><span class="op" id="4017293">.</span><span class="ident" id="4017294">Write</span><span class="op" id="4017299">(</span><span class="ident" id="4017300">magic</span><span class="op" id="4017305">[</span><span class="op" id="4017306">:</span><span class="op" id="4017307">]</span><span class="op" id="4017308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017311">sha1</span><span class="op" id="4017315">.</span><span class="ident" id="4017316">Write</span><span class="op" id="4017321">(</span><span class="ident" id="4017322">masterSecret</span><span class="op" id="4017334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017337">sha1</span><span class="op" id="4017341">.</span><span class="ident" id="4017342">Write</span><span class="op" id="4017347">(</span><span class="ident" id="4017348">ssl30Pad1</span><span class="op" id="4017357">[</span><span class="op" id="4017358">:</span><span class="num" id="4017359">40</span><span class="op" id="4017361">]</span><span class="op" id="4017362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017365">sha1Digest</span>&nbsp;<span class="op" id="4017376">:=</span>&nbsp;<span class="ident" id="4017379">sha1</span><span class="op" id="4017383">.</span><span class="ident" id="4017384">Sum</span><span class="op" id="4017387">(</span><span class="ident" id="4017388">nil</span><span class="op" id="4017391">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017395">sha1</span><span class="op" id="4017399">.</span><span class="ident" id="4017400">Reset</span><span class="op" id="4017405">(</span><span class="op" id="4017406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017409">sha1</span><span class="op" id="4017413">.</span><span class="ident" id="4017414">Write</span><span class="op" id="4017419">(</span><span class="ident" id="4017420">masterSecret</span><span class="op" id="4017432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017435">sha1</span><span class="op" id="4017439">.</span><span class="ident" id="4017440">Write</span><span class="op" id="4017445">(</span><span class="ident" id="4017446">ssl30Pad2</span><span class="op" id="4017455">[</span><span class="op" id="4017456">:</span><span class="num" id="4017457">40</span><span class="op" id="4017459">]</span><span class="op" id="4017460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017463">sha1</span><span class="op" id="4017467">.</span><span class="ident" id="4017468">Write</span><span class="op" id="4017473">(</span><span class="ident" id="4017474">sha1Digest</span><span class="op" id="4017484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017487">sha1Digest</span>&nbsp;<span class="op" id="4017498">=</span>&nbsp;<span class="ident" id="4017500">sha1</span><span class="op" id="4017504">.</span><span class="ident" id="4017505">Sum</span><span class="op" id="4017508">(</span><span class="ident" id="4017509">nil</span><span class="op" id="4017512">)</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017516">ret</span>&nbsp;<span class="op" id="4017520">:=</span>&nbsp;<span class="builtinfunc" id="4017523">make</span><span class="op" id="4017527">(</span><span class="op" id="4017528">[</span><span class="op" id="4017529">]</span><span class="builtintype" id="4017530">byte</span><span class="op" id="4017534">,</span>&nbsp;<span class="builtinfunc" id="4017536">len</span><span class="op" id="4017539">(</span><span class="ident" id="4017540">md5Digest</span><span class="op" id="4017549">)</span><span class="op" id="4017550">+</span><span class="builtinfunc" id="4017551">len</span><span class="op" id="4017554">(</span><span class="ident" id="4017555">sha1Digest</span><span class="op" id="4017565">)</span><span class="op" id="4017566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4017569">copy</span><span class="op" id="4017573">(</span><span class="ident" id="4017574">ret</span><span class="op" id="4017577">,</span>&nbsp;<span class="ident" id="4017579">md5Digest</span><span class="op" id="4017588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4017591">copy</span><span class="op" id="4017595">(</span><span class="ident" id="4017596">ret</span><span class="op" id="4017599">[</span><span class="builtinfunc" id="4017600">len</span><span class="op" id="4017603">(</span><span class="ident" id="4017604">md5Digest</span><span class="op" id="4017613">)</span><span class="op" id="4017614">:</span><span class="op" id="4017615">]</span><span class="op" id="4017616">,</span>&nbsp;<span class="ident" id="4017618">sha1Digest</span><span class="op" id="4017628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4017631">return</span>&nbsp;<span class="ident" id="4017638">ret</span><br>
<span class="lineno">230</span><span class="op" id="4017642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4017645">var</span>&nbsp;<span class="ident" id="4017649">ssl3ClientFinishedMagic</span>&nbsp;<span class="op" id="4017673">=</span>&nbsp;<span class="op" id="4017675">[</span><span class="num" id="4017676">4</span><span class="op" id="4017677">]</span><span class="builtintype" id="4017678">byte</span><span class="op" id="4017682">{</span><span class="num" id="4017683">0x43</span><span class="op" id="4017687">,</span>&nbsp;<span class="num" id="4017689">0x4c</span><span class="op" id="4017693">,</span>&nbsp;<span class="num" id="4017695">0x4e</span><span class="op" id="4017699">,</span>&nbsp;<span class="num" id="4017701">0x54</span><span class="op" id="4017705">}</span><br>
<span class="lineno"></span><span class="keyword" id="4017707">var</span>&nbsp;<span class="ident" id="4017711">ssl3ServerFinishedMagic</span>&nbsp;<span class="op" id="4017735">=</span>&nbsp;<span class="op" id="4017737">[</span><span class="num" id="4017738">4</span><span class="op" id="4017739">]</span><span class="builtintype" id="4017740">byte</span><span class="op" id="4017744">{</span><span class="num" id="4017745">0x53</span><span class="op" id="4017749">,</span>&nbsp;<span class="num" id="4017751">0x52</span><span class="op" id="4017755">,</span>&nbsp;<span class="num" id="4017757">0x56</span><span class="op" id="4017761">,</span>&nbsp;<span class="num" id="4017763">0x52</span><span class="op" id="4017767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="comment" id="4017770">//&nbsp;clientSum&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;client&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4017844">//&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="4017865">func</span>&nbsp;<span class="op" id="4017870">(</span><span class="ident" id="4017871">h</span>&nbsp;<span class="ident" id="4017873">finishedHash</span><span class="op" id="4017885">)</span>&nbsp;<span class="ident" id="4017887">clientSum</span><span class="op" id="4017896">(</span><span class="ident" id="4017897">masterSecret</span>&nbsp;<span class="op" id="4017910">[</span><span class="op" id="4017911">]</span><span class="builtintype" id="4017912">byte</span><span class="op" id="4017916">)</span>&nbsp;<span class="op" id="4017918">[</span><span class="op" id="4017919">]</span><span class="builtintype" id="4017920">byte</span>&nbsp;<span class="op" id="4017925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4017928">if</span>&nbsp;<span class="ident" id="4017931">h</span><span class="op" id="4017932">.</span><span class="ident" id="4017933">version</span>&nbsp;<span class="op" id="4017941">==</span>&nbsp;<span class="ident" id="4017944">VersionSSL30</span>&nbsp;<span class="op" id="4017957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4017961">return</span>&nbsp;<span class="ident" id="4017968">finishedSum30</span><span class="op" id="4017981">(</span><span class="ident" id="4017982">h</span><span class="op" id="4017983">.</span><span class="ident" id="4017984">clientMD5</span><span class="op" id="4017993">,</span>&nbsp;<span class="ident" id="4017995">h</span><span class="op" id="4017996">.</span><span class="ident" id="4017997">client</span><span class="op" id="4018003">,</span>&nbsp;<span class="ident" id="4018005">masterSecret</span><span class="op" id="4018017">,</span>&nbsp;<span class="ident" id="4018019">ssl3ClientFinishedMagic</span><span class="op" id="4018042">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4018045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018049">out</span>&nbsp;<span class="op" id="4018053">:=</span>&nbsp;<span class="builtinfunc" id="4018056">make</span><span class="op" id="4018060">(</span><span class="op" id="4018061">[</span><span class="op" id="4018062">]</span><span class="builtintype" id="4018063">byte</span><span class="op" id="4018067">,</span>&nbsp;<span class="ident" id="4018069">finishedVerifyLength</span><span class="op" id="4018089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4018092">if</span>&nbsp;<span class="ident" id="4018095">h</span><span class="op" id="4018096">.</span><span class="ident" id="4018097">version</span>&nbsp;<span class="op" id="4018105">&gt;=</span>&nbsp;<span class="ident" id="4018108">VersionTLS12</span>&nbsp;<span class="op" id="4018121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018125">seed</span>&nbsp;<span class="op" id="4018130">:=</span>&nbsp;<span class="ident" id="4018133">h</span><span class="op" id="4018134">.</span><span class="ident" id="4018135">client</span><span class="op" id="4018141">.</span><span class="ident" id="4018142">Sum</span><span class="op" id="4018145">(</span><span class="ident" id="4018146">nil</span><span class="op" id="4018149">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018153">prf12</span><span class="op" id="4018158">(</span><span class="ident" id="4018159">out</span><span class="op" id="4018162">,</span>&nbsp;<span class="ident" id="4018164">masterSecret</span><span class="op" id="4018176">,</span>&nbsp;<span class="ident" id="4018178">clientFinishedLabel</span><span class="op" id="4018197">,</span>&nbsp;<span class="ident" id="4018199">seed</span><span class="op" id="4018203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4018206">}</span>&nbsp;<span class="keyword" id="4018208">else</span>&nbsp;<span class="op" id="4018213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018217">seed</span>&nbsp;<span class="op" id="4018222">:=</span>&nbsp;<span class="builtinfunc" id="4018225">make</span><span class="op" id="4018229">(</span><span class="op" id="4018230">[</span><span class="op" id="4018231">]</span><span class="builtintype" id="4018232">byte</span><span class="op" id="4018236">,</span>&nbsp;<span class="num" id="4018238">0</span><span class="op" id="4018239">,</span>&nbsp;<span class="ident" id="4018241">md5</span><span class="op" id="4018244">.</span><span class="ident" id="4018245">Size</span><span class="op" id="4018249">+</span><span class="ident" id="4018250">sha1</span><span class="op" id="4018254">.</span><span class="ident" id="4018255">Size</span><span class="op" id="4018259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018263">seed</span>&nbsp;<span class="op" id="4018268">=</span>&nbsp;<span class="ident" id="4018270">h</span><span class="op" id="4018271">.</span><span class="ident" id="4018272">clientMD5</span><span class="op" id="4018281">.</span><span class="ident" id="4018282">Sum</span><span class="op" id="4018285">(</span><span class="ident" id="4018286">seed</span><span class="op" id="4018290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018294">seed</span>&nbsp;<span class="op" id="4018299">=</span>&nbsp;<span class="ident" id="4018301">h</span><span class="op" id="4018302">.</span><span class="ident" id="4018303">client</span><span class="op" id="4018309">.</span><span class="ident" id="4018310">Sum</span><span class="op" id="4018313">(</span><span class="ident" id="4018314">seed</span><span class="op" id="4018318">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018322">prf10</span><span class="op" id="4018327">(</span><span class="ident" id="4018328">out</span><span class="op" id="4018331">,</span>&nbsp;<span class="ident" id="4018333">masterSecret</span><span class="op" id="4018345">,</span>&nbsp;<span class="ident" id="4018347">clientFinishedLabel</span><span class="op" id="4018366">,</span>&nbsp;<span class="ident" id="4018368">seed</span><span class="op" id="4018372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4018375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4018378">return</span>&nbsp;<span class="ident" id="4018385">out</span><br>
<span class="lineno"></span><span class="op" id="4018389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="4018392">//&nbsp;serverSum&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;server&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4018466">//&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="4018487">func</span>&nbsp;<span class="op" id="4018492">(</span><span class="ident" id="4018493">h</span>&nbsp;<span class="ident" id="4018495">finishedHash</span><span class="op" id="4018507">)</span>&nbsp;<span class="ident" id="4018509">serverSum</span><span class="op" id="4018518">(</span><span class="ident" id="4018519">masterSecret</span>&nbsp;<span class="op" id="4018532">[</span><span class="op" id="4018533">]</span><span class="builtintype" id="4018534">byte</span><span class="op" id="4018538">)</span>&nbsp;<span class="op" id="4018540">[</span><span class="op" id="4018541">]</span><span class="builtintype" id="4018542">byte</span>&nbsp;<span class="op" id="4018547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4018550">if</span>&nbsp;<span class="ident" id="4018553">h</span><span class="op" id="4018554">.</span><span class="ident" id="4018555">version</span>&nbsp;<span class="op" id="4018563">==</span>&nbsp;<span class="ident" id="4018566">VersionSSL30</span>&nbsp;<span class="op" id="4018579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4018583">return</span>&nbsp;<span class="ident" id="4018590">finishedSum30</span><span class="op" id="4018603">(</span><span class="ident" id="4018604">h</span><span class="op" id="4018605">.</span><span class="ident" id="4018606">serverMD5</span><span class="op" id="4018615">,</span>&nbsp;<span class="ident" id="4018617">h</span><span class="op" id="4018618">.</span><span class="ident" id="4018619">server</span><span class="op" id="4018625">,</span>&nbsp;<span class="ident" id="4018627">masterSecret</span><span class="op" id="4018639">,</span>&nbsp;<span class="ident" id="4018641">ssl3ServerFinishedMagic</span><span class="op" id="4018664">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4018667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018671">out</span>&nbsp;<span class="op" id="4018675">:=</span>&nbsp;<span class="builtinfunc" id="4018678">make</span><span class="op" id="4018682">(</span><span class="op" id="4018683">[</span><span class="op" id="4018684">]</span><span class="builtintype" id="4018685">byte</span><span class="op" id="4018689">,</span>&nbsp;<span class="ident" id="4018691">finishedVerifyLength</span><span class="op" id="4018711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4018714">if</span>&nbsp;<span class="ident" id="4018717">h</span><span class="op" id="4018718">.</span><span class="ident" id="4018719">version</span>&nbsp;<span class="op" id="4018727">&gt;=</span>&nbsp;<span class="ident" id="4018730">VersionTLS12</span>&nbsp;<span class="op" id="4018743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018747">seed</span>&nbsp;<span class="op" id="4018752">:=</span>&nbsp;<span class="ident" id="4018755">h</span><span class="op" id="4018756">.</span><span class="ident" id="4018757">server</span><span class="op" id="4018763">.</span><span class="ident" id="4018764">Sum</span><span class="op" id="4018767">(</span><span class="ident" id="4018768">nil</span><span class="op" id="4018771">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018775">prf12</span><span class="op" id="4018780">(</span><span class="ident" id="4018781">out</span><span class="op" id="4018784">,</span>&nbsp;<span class="ident" id="4018786">masterSecret</span><span class="op" id="4018798">,</span>&nbsp;<span class="ident" id="4018800">serverFinishedLabel</span><span class="op" id="4018819">,</span>&nbsp;<span class="ident" id="4018821">seed</span><span class="op" id="4018825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4018828">}</span>&nbsp;<span class="keyword" id="4018830">else</span>&nbsp;<span class="op" id="4018835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018839">seed</span>&nbsp;<span class="op" id="4018844">:=</span>&nbsp;<span class="builtinfunc" id="4018847">make</span><span class="op" id="4018851">(</span><span class="op" id="4018852">[</span><span class="op" id="4018853">]</span><span class="builtintype" id="4018854">byte</span><span class="op" id="4018858">,</span>&nbsp;<span class="num" id="4018860">0</span><span class="op" id="4018861">,</span>&nbsp;<span class="ident" id="4018863">md5</span><span class="op" id="4018866">.</span><span class="ident" id="4018867">Size</span><span class="op" id="4018871">+</span><span class="ident" id="4018872">sha1</span><span class="op" id="4018876">.</span><span class="ident" id="4018877">Size</span><span class="op" id="4018881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018885">seed</span>&nbsp;<span class="op" id="4018890">=</span>&nbsp;<span class="ident" id="4018892">h</span><span class="op" id="4018893">.</span><span class="ident" id="4018894">serverMD5</span><span class="op" id="4018903">.</span><span class="ident" id="4018904">Sum</span><span class="op" id="4018907">(</span><span class="ident" id="4018908">seed</span><span class="op" id="4018912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018916">seed</span>&nbsp;<span class="op" id="4018921">=</span>&nbsp;<span class="ident" id="4018923">h</span><span class="op" id="4018924">.</span><span class="ident" id="4018925">server</span><span class="op" id="4018931">.</span><span class="ident" id="4018932">Sum</span><span class="op" id="4018935">(</span><span class="ident" id="4018936">seed</span><span class="op" id="4018940">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018944">prf10</span><span class="op" id="4018949">(</span><span class="ident" id="4018950">out</span><span class="op" id="4018953">,</span>&nbsp;<span class="ident" id="4018955">masterSecret</span><span class="op" id="4018967">,</span>&nbsp;<span class="ident" id="4018969">serverFinishedLabel</span><span class="op" id="4018988">,</span>&nbsp;<span class="ident" id="4018990">seed</span><span class="op" id="4018994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4018997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4019000">return</span>&nbsp;<span class="ident" id="4019007">out</span><br>
<span class="lineno"></span><span class="op" id="4019011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="comment" id="4019014">//&nbsp;hashForClientCertificate&nbsp;returns&nbsp;a&nbsp;digest,&nbsp;hash&nbsp;function,&nbsp;and&nbsp;TLS&nbsp;1.2&nbsp;hash</span><br>
<span class="lineno"></span><span class="comment" id="4019092">//&nbsp;id&nbsp;suitable&nbsp;for&nbsp;signing&nbsp;by&nbsp;a&nbsp;TLS&nbsp;client&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="4019148">func</span>&nbsp;<span class="op" id="4019153">(</span><span class="ident" id="4019154">h</span>&nbsp;<span class="ident" id="4019156">finishedHash</span><span class="op" id="4019168">)</span>&nbsp;<span class="ident" id="4019170">hashForClientCertificate</span><span class="op" id="4019194">(</span><span class="ident" id="4019195">sigType</span>&nbsp;<span class="builtintype" id="4019203">uint8</span><span class="op" id="4019208">)</span>&nbsp;<span class="op" id="4019210">(</span><span class="op" id="4019211">[</span><span class="op" id="4019212">]</span><span class="builtintype" id="4019213">byte</span><span class="op" id="4019217">,</span>&nbsp;<span class="ident" id="4019219">crypto</span><span class="op" id="4019225">.</span><span class="ident" id="4019226">Hash</span><span class="op" id="4019230">,</span>&nbsp;<span class="builtintype" id="4019232">uint8</span><span class="op" id="4019237">)</span>&nbsp;<span class="op" id="4019239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4019242">if</span>&nbsp;<span class="ident" id="4019245">h</span><span class="op" id="4019246">.</span><span class="ident" id="4019247">version</span>&nbsp;<span class="op" id="4019255">&gt;=</span>&nbsp;<span class="ident" id="4019258">VersionTLS12</span>&nbsp;<span class="op" id="4019271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4019275">digest</span>&nbsp;<span class="op" id="4019282">:=</span>&nbsp;<span class="ident" id="4019285">h</span><span class="op" id="4019286">.</span><span class="ident" id="4019287">server</span><span class="op" id="4019293">.</span><span class="ident" id="4019294">Sum</span><span class="op" id="4019297">(</span><span class="ident" id="4019298">nil</span><span class="op" id="4019301">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4019305">return</span>&nbsp;<span class="ident" id="4019312">digest</span><span class="op" id="4019318">,</span>&nbsp;<span class="ident" id="4019320">crypto</span><span class="op" id="4019326">.</span><span class="ident" id="4019327">SHA256</span><span class="op" id="4019333">,</span>&nbsp;<span class="ident" id="4019335">hashSHA256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4019347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4019350">if</span>&nbsp;<span class="ident" id="4019353">sigType</span>&nbsp;<span class="op" id="4019361">==</span>&nbsp;<span class="ident" id="4019364">signatureECDSA</span>&nbsp;<span class="op" id="4019379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4019383">digest</span>&nbsp;<span class="op" id="4019390">:=</span>&nbsp;<span class="ident" id="4019393">h</span><span class="op" id="4019394">.</span><span class="ident" id="4019395">server</span><span class="op" id="4019401">.</span><span class="ident" id="4019402">Sum</span><span class="op" id="4019405">(</span><span class="ident" id="4019406">nil</span><span class="op" id="4019409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4019413">return</span>&nbsp;<span class="ident" id="4019420">digest</span><span class="op" id="4019426">,</span>&nbsp;<span class="ident" id="4019428">crypto</span><span class="op" id="4019434">.</span><span class="ident" id="4019435">SHA1</span><span class="op" id="4019439">,</span>&nbsp;<span class="ident" id="4019441">hashSHA1</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4019451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4019455">digest</span>&nbsp;<span class="op" id="4019462">:=</span>&nbsp;<span class="builtinfunc" id="4019465">make</span><span class="op" id="4019469">(</span><span class="op" id="4019470">[</span><span class="op" id="4019471">]</span><span class="builtintype" id="4019472">byte</span><span class="op" id="4019476">,</span>&nbsp;<span class="num" id="4019478">0</span><span class="op" id="4019479">,</span>&nbsp;<span class="num" id="4019481">36</span><span class="op" id="4019483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4019486">digest</span>&nbsp;<span class="op" id="4019493">=</span>&nbsp;<span class="ident" id="4019495">h</span><span class="op" id="4019496">.</span><span class="ident" id="4019497">serverMD5</span><span class="op" id="4019506">.</span><span class="ident" id="4019507">Sum</span><span class="op" id="4019510">(</span><span class="ident" id="4019511">digest</span><span class="op" id="4019517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4019520">digest</span>&nbsp;<span class="op" id="4019527">=</span>&nbsp;<span class="ident" id="4019529">h</span><span class="op" id="4019530">.</span><span class="ident" id="4019531">server</span><span class="op" id="4019537">.</span><span class="ident" id="4019538">Sum</span><span class="op" id="4019541">(</span><span class="ident" id="4019542">digest</span><span class="op" id="4019548">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4019551">return</span>&nbsp;<span class="ident" id="4019558">digest</span><span class="op" id="4019564">,</span>&nbsp;<span class="ident" id="4019566">crypto</span><span class="op" id="4019572">.</span><span class="ident" id="4019573">MD5SHA1</span><span class="op" id="4019580">,</span>&nbsp;<span class="num" id="4019582">0</span>&nbsp;<span class="comment" id="4019584">/*&nbsp;not&nbsp;specified&nbsp;in&nbsp;TLS&nbsp;1.2.&nbsp;*/</span><br>
<span class="lineno"></span><span class="op" id="4019616">}</span>
</div>
</body>
</html>
