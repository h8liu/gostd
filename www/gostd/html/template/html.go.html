<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5465830">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5465885">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5465939">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5465990">package</span>&nbsp;<span class="ident" id="5465998">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5466008">import</span>&nbsp;<span class="op" id="5466015">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5466018">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5466027">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5466034">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5466045">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5466060">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5466063">//&nbsp;htmlNospaceEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;unquoted&nbsp;attribute&nbsp;values.</span><br>
<span class="lineno">15</span><span class="keyword" id="5466137">func</span>&nbsp;<span class="ident" id="5466142">htmlNospaceEscaper</span><span class="op" id="5466160">(</span><span class="ident" id="5466161">args</span>&nbsp;<span class="op" id="5466166">...</span><span class="keyword" id="5466169">interface</span><span class="op" id="5466178">{</span><span class="op" id="5466179">}</span><span class="op" id="5466180">)</span>&nbsp;<span class="builtintype" id="5466182">string</span>&nbsp;<span class="op" id="5466189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5466192">s</span><span class="op" id="5466193">,</span>&nbsp;<span class="ident" id="5466195">t</span>&nbsp;<span class="op" id="5466197">:=</span>&nbsp;<span class="ident" id="5466200">stringify</span><span class="op" id="5466209">(</span><span class="ident" id="5466210">args</span><span class="op" id="5466214">...</span><span class="op" id="5466217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5466220">if</span>&nbsp;<span class="ident" id="5466223">t</span>&nbsp;<span class="op" id="5466225">==</span>&nbsp;<span class="ident" id="5466228">contentTypeHTML</span>&nbsp;<span class="op" id="5466244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5466248">return</span>&nbsp;<span class="ident" id="5466255">htmlReplacer</span><span class="op" id="5466267">(</span><span class="ident" id="5466268">stripTags</span><span class="op" id="5466277">(</span><span class="ident" id="5466278">s</span><span class="op" id="5466279">)</span><span class="op" id="5466280">,</span>&nbsp;<span class="ident" id="5466282">htmlNospaceNormReplacementTable</span><span class="op" id="5466313">,</span>&nbsp;<span class="builtintype" id="5466315">false</span><span class="op" id="5466320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5466323">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5466326">return</span>&nbsp;<span class="ident" id="5466333">htmlReplacer</span><span class="op" id="5466345">(</span><span class="ident" id="5466346">s</span><span class="op" id="5466347">,</span>&nbsp;<span class="ident" id="5466349">htmlNospaceReplacementTable</span><span class="op" id="5466376">,</span>&nbsp;<span class="builtintype" id="5466378">false</span><span class="op" id="5466383">)</span><br>
<span class="lineno"></span><span class="op" id="5466385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5466388">//&nbsp;attrEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;quoted&nbsp;attribute&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5466453">func</span>&nbsp;<span class="ident" id="5466458">attrEscaper</span><span class="op" id="5466469">(</span><span class="ident" id="5466470">args</span>&nbsp;<span class="op" id="5466475">...</span><span class="keyword" id="5466478">interface</span><span class="op" id="5466487">{</span><span class="op" id="5466488">}</span><span class="op" id="5466489">)</span>&nbsp;<span class="builtintype" id="5466491">string</span>&nbsp;<span class="op" id="5466498">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5466501">s</span><span class="op" id="5466502">,</span>&nbsp;<span class="ident" id="5466504">t</span>&nbsp;<span class="op" id="5466506">:=</span>&nbsp;<span class="ident" id="5466509">stringify</span><span class="op" id="5466518">(</span><span class="ident" id="5466519">args</span><span class="op" id="5466523">...</span><span class="op" id="5466526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5466529">if</span>&nbsp;<span class="ident" id="5466532">t</span>&nbsp;<span class="op" id="5466534">==</span>&nbsp;<span class="ident" id="5466537">contentTypeHTML</span>&nbsp;<span class="op" id="5466553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5466557">return</span>&nbsp;<span class="ident" id="5466564">htmlReplacer</span><span class="op" id="5466576">(</span><span class="ident" id="5466577">stripTags</span><span class="op" id="5466586">(</span><span class="ident" id="5466587">s</span><span class="op" id="5466588">)</span><span class="op" id="5466589">,</span>&nbsp;<span class="ident" id="5466591">htmlNormReplacementTable</span><span class="op" id="5466615">,</span>&nbsp;<span class="builtintype" id="5466617">true</span><span class="op" id="5466621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5466624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5466627">return</span>&nbsp;<span class="ident" id="5466634">htmlReplacer</span><span class="op" id="5466646">(</span><span class="ident" id="5466647">s</span><span class="op" id="5466648">,</span>&nbsp;<span class="ident" id="5466650">htmlReplacementTable</span><span class="op" id="5466670">,</span>&nbsp;<span class="builtintype" id="5466672">true</span><span class="op" id="5466676">)</span><br>
<span class="lineno">30</span><span class="op" id="5466678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5466681">//&nbsp;rcdataEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;an&nbsp;RCDATA&nbsp;element&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="5466747">func</span>&nbsp;<span class="ident" id="5466752">rcdataEscaper</span><span class="op" id="5466765">(</span><span class="ident" id="5466766">args</span>&nbsp;<span class="op" id="5466771">...</span><span class="keyword" id="5466774">interface</span><span class="op" id="5466783">{</span><span class="op" id="5466784">}</span><span class="op" id="5466785">)</span>&nbsp;<span class="builtintype" id="5466787">string</span>&nbsp;<span class="op" id="5466794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5466797">s</span><span class="op" id="5466798">,</span>&nbsp;<span class="ident" id="5466800">t</span>&nbsp;<span class="op" id="5466802">:=</span>&nbsp;<span class="ident" id="5466805">stringify</span><span class="op" id="5466814">(</span><span class="ident" id="5466815">args</span><span class="op" id="5466819">...</span><span class="op" id="5466822">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5466825">if</span>&nbsp;<span class="ident" id="5466828">t</span>&nbsp;<span class="op" id="5466830">==</span>&nbsp;<span class="ident" id="5466833">contentTypeHTML</span>&nbsp;<span class="op" id="5466849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5466853">return</span>&nbsp;<span class="ident" id="5466860">htmlReplacer</span><span class="op" id="5466872">(</span><span class="ident" id="5466873">s</span><span class="op" id="5466874">,</span>&nbsp;<span class="ident" id="5466876">htmlNormReplacementTable</span><span class="op" id="5466900">,</span>&nbsp;<span class="builtintype" id="5466902">true</span><span class="op" id="5466906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5466909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5466912">return</span>&nbsp;<span class="ident" id="5466919">htmlReplacer</span><span class="op" id="5466931">(</span><span class="ident" id="5466932">s</span><span class="op" id="5466933">,</span>&nbsp;<span class="ident" id="5466935">htmlReplacementTable</span><span class="op" id="5466955">,</span>&nbsp;<span class="builtintype" id="5466957">true</span><span class="op" id="5466961">)</span><br>
<span class="lineno"></span><span class="op" id="5466963">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="5466966">//&nbsp;htmlEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;HTML&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="5467017">func</span>&nbsp;<span class="ident" id="5467022">htmlEscaper</span><span class="op" id="5467033">(</span><span class="ident" id="5467034">args</span>&nbsp;<span class="op" id="5467039">...</span><span class="keyword" id="5467042">interface</span><span class="op" id="5467051">{</span><span class="op" id="5467052">}</span><span class="op" id="5467053">)</span>&nbsp;<span class="builtintype" id="5467055">string</span>&nbsp;<span class="op" id="5467062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467065">s</span><span class="op" id="5467066">,</span>&nbsp;<span class="ident" id="5467068">t</span>&nbsp;<span class="op" id="5467070">:=</span>&nbsp;<span class="ident" id="5467073">stringify</span><span class="op" id="5467082">(</span><span class="ident" id="5467083">args</span><span class="op" id="5467087">...</span><span class="op" id="5467090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467093">if</span>&nbsp;<span class="ident" id="5467096">t</span>&nbsp;<span class="op" id="5467098">==</span>&nbsp;<span class="ident" id="5467101">contentTypeHTML</span>&nbsp;<span class="op" id="5467117">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467121">return</span>&nbsp;<span class="ident" id="5467128">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5467131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467134">return</span>&nbsp;<span class="ident" id="5467141">htmlReplacer</span><span class="op" id="5467153">(</span><span class="ident" id="5467154">s</span><span class="op" id="5467155">,</span>&nbsp;<span class="ident" id="5467157">htmlReplacementTable</span><span class="op" id="5467177">,</span>&nbsp;<span class="builtintype" id="5467179">true</span><span class="op" id="5467183">)</span><br>
<span class="lineno"></span><span class="op" id="5467185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="5467188">//&nbsp;htmlReplacementTable&nbsp;contains&nbsp;the&nbsp;runes&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;escaped</span><br>
<span class="lineno"></span><span class="comment" id="5467255">//&nbsp;inside&nbsp;a&nbsp;quoted&nbsp;attribute&nbsp;value&nbsp;or&nbsp;in&nbsp;a&nbsp;text&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="5467309">var</span>&nbsp;<span class="ident" id="5467313">htmlReplacementTable</span>&nbsp;<span class="op" id="5467334">=</span>&nbsp;<span class="op" id="5467336">[</span><span class="op" id="5467337">]</span><span class="builtintype" id="5467338">string</span><span class="op" id="5467344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5467347">//&nbsp;http://www.w3.org/TR/html5/syntax.html#attribute-value-(unquoted)-state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5467423">//&nbsp;U+0000&nbsp;NULL&nbsp;Parse&nbsp;error.&nbsp;Append&nbsp;a&nbsp;U+FFFD&nbsp;REPLACEMENT</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5467480">//&nbsp;CHARACTER&nbsp;character&nbsp;to&nbsp;the&nbsp;current&nbsp;attribute&#39;s&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5467538">//&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5467544">//&nbsp;and&nbsp;similarly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5467562">//&nbsp;http://www.w3.org/TR/html5/syntax.html#before-attribute-value-state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5467634">0</span><span class="op" id="5467635">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5467640">&#34;\uFFFD&#34;</span><span class="op" id="5467648">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5467651">&#39;&#34;&#39;</span><span class="op" id="5467654">:</span>&nbsp;&nbsp;<span class="string" id="5467657">&#34;&amp;#34;&#34;</span><span class="op" id="5467664">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5467667">&#39;&amp;&#39;</span><span class="op" id="5467670">:</span>&nbsp;&nbsp;<span class="string" id="5467673">&#34;&amp;amp;&#34;</span><span class="op" id="5467680">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5467683">&#39;\&#39;&#39;</span><span class="op" id="5467687">:</span>&nbsp;<span class="string" id="5467689">&#34;&amp;#39;&#34;</span><span class="op" id="5467696">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5467699">&#39;+&#39;</span><span class="op" id="5467702">:</span>&nbsp;&nbsp;<span class="string" id="5467705">&#34;&amp;#43;&#34;</span><span class="op" id="5467712">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5467715">&#39;&lt;&#39;</span><span class="op" id="5467718">:</span>&nbsp;&nbsp;<span class="string" id="5467721">&#34;&amp;lt;&#34;</span><span class="op" id="5467727">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5467730">&#39;&gt;&#39;</span><span class="op" id="5467733">:</span>&nbsp;&nbsp;<span class="string" id="5467736">&#34;&amp;gt;&#34;</span><span class="op" id="5467742">,</span><br>
<span class="lineno"></span><span class="op" id="5467744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5467747">//&nbsp;htmlNormReplacementTable&nbsp;is&nbsp;like&nbsp;htmlReplacementTable&nbsp;but&nbsp;without&nbsp;&#39;&amp;&#39;&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5467823">//&nbsp;avoid&nbsp;over-encoding&nbsp;existing&nbsp;entities.</span><br>
<span class="lineno">70</span><span class="keyword" id="5467865">var</span>&nbsp;<span class="ident" id="5467869">htmlNormReplacementTable</span>&nbsp;<span class="op" id="5467894">=</span>&nbsp;<span class="op" id="5467896">[</span><span class="op" id="5467897">]</span><span class="builtintype" id="5467898">string</span><span class="op" id="5467904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5467907">0</span><span class="op" id="5467908">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5467913">&#34;\uFFFD&#34;</span><span class="op" id="5467921">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5467924">&#39;&#34;&#39;</span><span class="op" id="5467927">:</span>&nbsp;&nbsp;<span class="string" id="5467930">&#34;&amp;#34;&#34;</span><span class="op" id="5467937">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5467940">&#39;\&#39;&#39;</span><span class="op" id="5467944">:</span>&nbsp;<span class="string" id="5467946">&#34;&amp;#39;&#34;</span><span class="op" id="5467953">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5467956">&#39;+&#39;</span><span class="op" id="5467959">:</span>&nbsp;&nbsp;<span class="string" id="5467962">&#34;&amp;#43;&#34;</span><span class="op" id="5467969">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5467972">&#39;&lt;&#39;</span><span class="op" id="5467975">:</span>&nbsp;&nbsp;<span class="string" id="5467978">&#34;&amp;lt;&#34;</span><span class="op" id="5467984">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5467987">&#39;&gt;&#39;</span><span class="op" id="5467990">:</span>&nbsp;&nbsp;<span class="string" id="5467993">&#34;&amp;gt;&#34;</span><span class="op" id="5467999">,</span><br>
<span class="lineno"></span><span class="op" id="5468001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5468004">//&nbsp;htmlNospaceReplacementTable&nbsp;contains&nbsp;the&nbsp;runes&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;escaped</span><br>
<span class="lineno">80</span><span class="comment" id="5468078">//&nbsp;inside&nbsp;an&nbsp;unquoted&nbsp;attribute&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5468117">//&nbsp;The&nbsp;set&nbsp;of&nbsp;runes&nbsp;escaped&nbsp;is&nbsp;the&nbsp;union&nbsp;of&nbsp;the&nbsp;HTML&nbsp;specials&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5468183">//&nbsp;those&nbsp;determined&nbsp;by&nbsp;running&nbsp;the&nbsp;JS&nbsp;below&nbsp;in&nbsp;browsers:</span><br>
<span class="lineno"></span><span class="comment" id="5468240">//&nbsp;&lt;div&nbsp;id=d&gt;&lt;/div&gt;</span><br>
<span class="lineno"></span><span class="comment" id="5468260">//&nbsp;&lt;script&gt;(function&nbsp;()&nbsp;{</span><br>
<span class="lineno">85</span><span class="comment" id="5468286">//&nbsp;var&nbsp;a&nbsp;=&nbsp;[],&nbsp;d&nbsp;=&nbsp;document.getElementById(&#34;d&#34;),&nbsp;i,&nbsp;c,&nbsp;s;</span><br>
<span class="lineno"></span><span class="comment" id="5468344">//&nbsp;for&nbsp;(i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;0x10000;&nbsp;++i)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5468379">//&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;String.fromCharCode(i);</span><br>
<span class="lineno"></span><span class="comment" id="5468412">//&nbsp;&nbsp;&nbsp;d.innerHTML&nbsp;=&nbsp;&#34;&lt;span&nbsp;title=&#34;&nbsp;+&nbsp;c&nbsp;+&nbsp;&#34;lt&#34;&nbsp;+&nbsp;c&nbsp;+&nbsp;&#34;&gt;&lt;/span&gt;&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5468474">//&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;d.getElementsByTagName(&#34;SPAN&#34;)[0];</span><br>
<span class="lineno">90</span><span class="comment" id="5468518">//&nbsp;&nbsp;&nbsp;if&nbsp;(!s&nbsp;||&nbsp;s.title&nbsp;!==&nbsp;c&nbsp;+&nbsp;&#34;lt&#34;&nbsp;+&nbsp;c)&nbsp;{&nbsp;a.push(i.toString(16));&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5468587">//&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5468592">//&nbsp;document.write(a.join(&#34;,&nbsp;&#34;));</span><br>
<span class="lineno"></span><span class="comment" id="5468625">//&nbsp;})()&lt;/script&gt;</span><br>
<span class="lineno"></span><span class="keyword" id="5468642">var</span>&nbsp;<span class="ident" id="5468646">htmlNospaceReplacementTable</span>&nbsp;<span class="op" id="5468674">=</span>&nbsp;<span class="op" id="5468676">[</span><span class="op" id="5468677">]</span><span class="builtintype" id="5468678">string</span><span class="op" id="5468684">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5468687">0</span><span class="op" id="5468688">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5468693">&#34;&amp;#xfffd;&#34;</span><span class="op" id="5468703">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5468706">&#39;\t&#39;</span><span class="op" id="5468710">:</span>&nbsp;<span class="string" id="5468712">&#34;&amp;#9;&#34;</span><span class="op" id="5468718">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5468721">&#39;\n&#39;</span><span class="op" id="5468725">:</span>&nbsp;<span class="string" id="5468727">&#34;&amp;#10;&#34;</span><span class="op" id="5468734">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5468737">&#39;\v&#39;</span><span class="op" id="5468741">:</span>&nbsp;<span class="string" id="5468743">&#34;&amp;#11;&#34;</span><span class="op" id="5468750">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5468753">&#39;\f&#39;</span><span class="op" id="5468757">:</span>&nbsp;<span class="string" id="5468759">&#34;&amp;#12;&#34;</span><span class="op" id="5468766">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5468769">&#39;\r&#39;</span><span class="op" id="5468773">:</span>&nbsp;<span class="string" id="5468775">&#34;&amp;#13;&#34;</span><span class="op" id="5468782">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5468785">&#39;&nbsp;&#39;</span><span class="op" id="5468788">:</span>&nbsp;&nbsp;<span class="string" id="5468791">&#34;&amp;#32;&#34;</span><span class="op" id="5468798">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5468801">&#39;&#34;&#39;</span><span class="op" id="5468804">:</span>&nbsp;&nbsp;<span class="string" id="5468807">&#34;&amp;#34;&#34;</span><span class="op" id="5468814">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5468817">&#39;&amp;&#39;</span><span class="op" id="5468820">:</span>&nbsp;&nbsp;<span class="string" id="5468823">&#34;&amp;amp;&#34;</span><span class="op" id="5468830">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5468833">&#39;\&#39;&#39;</span><span class="op" id="5468837">:</span>&nbsp;<span class="string" id="5468839">&#34;&amp;#39;&#34;</span><span class="op" id="5468846">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5468849">&#39;+&#39;</span><span class="op" id="5468852">:</span>&nbsp;&nbsp;<span class="string" id="5468855">&#34;&amp;#43;&#34;</span><span class="op" id="5468862">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5468865">&#39;&lt;&#39;</span><span class="op" id="5468868">:</span>&nbsp;&nbsp;<span class="string" id="5468871">&#34;&amp;lt;&#34;</span><span class="op" id="5468877">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5468880">&#39;=&#39;</span><span class="op" id="5468883">:</span>&nbsp;&nbsp;<span class="string" id="5468886">&#34;&amp;#61;&#34;</span><span class="op" id="5468893">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5468896">&#39;&gt;&#39;</span><span class="op" id="5468899">:</span>&nbsp;&nbsp;<span class="string" id="5468902">&#34;&amp;gt;&#34;</span><span class="op" id="5468908">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5468911">//&nbsp;A&nbsp;parse&nbsp;error&nbsp;in&nbsp;the&nbsp;attribute&nbsp;value&nbsp;(unquoted)&nbsp;and</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5468967">//&nbsp;before&nbsp;attribute&nbsp;value&nbsp;states.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5469002">//&nbsp;Treated&nbsp;as&nbsp;a&nbsp;quoting&nbsp;character&nbsp;by&nbsp;IE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5469044">&#39;`&#39;</span><span class="op" id="5469047">:</span>&nbsp;<span class="string" id="5469049">&#34;&amp;#96;&#34;</span><span class="op" id="5469056">,</span><br>
<span class="lineno"></span><span class="op" id="5469058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="5469061">//&nbsp;htmlNospaceNormReplacementTable&nbsp;is&nbsp;like&nbsp;htmlNospaceReplacementTable&nbsp;but</span><br>
<span class="lineno"></span><span class="comment" id="5469136">//&nbsp;without&nbsp;&#39;&amp;&#39;&nbsp;to&nbsp;avoid&nbsp;over-encoding&nbsp;existing&nbsp;entities.</span><br>
<span class="lineno"></span><span class="keyword" id="5469193">var</span>&nbsp;<span class="ident" id="5469197">htmlNospaceNormReplacementTable</span>&nbsp;<span class="op" id="5469229">=</span>&nbsp;<span class="op" id="5469231">[</span><span class="op" id="5469232">]</span><span class="builtintype" id="5469233">string</span><span class="op" id="5469239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5469242">0</span><span class="op" id="5469243">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5469248">&#34;&amp;#xfffd;&#34;</span><span class="op" id="5469258">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5469261">&#39;\t&#39;</span><span class="op" id="5469265">:</span>&nbsp;<span class="string" id="5469267">&#34;&amp;#9;&#34;</span><span class="op" id="5469273">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5469276">&#39;\n&#39;</span><span class="op" id="5469280">:</span>&nbsp;<span class="string" id="5469282">&#34;&amp;#10;&#34;</span><span class="op" id="5469289">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5469292">&#39;\v&#39;</span><span class="op" id="5469296">:</span>&nbsp;<span class="string" id="5469298">&#34;&amp;#11;&#34;</span><span class="op" id="5469305">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5469308">&#39;\f&#39;</span><span class="op" id="5469312">:</span>&nbsp;<span class="string" id="5469314">&#34;&amp;#12;&#34;</span><span class="op" id="5469321">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5469324">&#39;\r&#39;</span><span class="op" id="5469328">:</span>&nbsp;<span class="string" id="5469330">&#34;&amp;#13;&#34;</span><span class="op" id="5469337">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5469340">&#39;&nbsp;&#39;</span><span class="op" id="5469343">:</span>&nbsp;&nbsp;<span class="string" id="5469346">&#34;&amp;#32;&#34;</span><span class="op" id="5469353">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5469356">&#39;&#34;&#39;</span><span class="op" id="5469359">:</span>&nbsp;&nbsp;<span class="string" id="5469362">&#34;&amp;#34;&#34;</span><span class="op" id="5469369">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5469372">&#39;\&#39;&#39;</span><span class="op" id="5469376">:</span>&nbsp;<span class="string" id="5469378">&#34;&amp;#39;&#34;</span><span class="op" id="5469385">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5469388">&#39;+&#39;</span><span class="op" id="5469391">:</span>&nbsp;&nbsp;<span class="string" id="5469394">&#34;&amp;#43;&#34;</span><span class="op" id="5469401">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5469404">&#39;&lt;&#39;</span><span class="op" id="5469407">:</span>&nbsp;&nbsp;<span class="string" id="5469410">&#34;&amp;lt;&#34;</span><span class="op" id="5469416">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5469419">&#39;=&#39;</span><span class="op" id="5469422">:</span>&nbsp;&nbsp;<span class="string" id="5469425">&#34;&amp;#61;&#34;</span><span class="op" id="5469432">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5469435">&#39;&gt;&#39;</span><span class="op" id="5469438">:</span>&nbsp;&nbsp;<span class="string" id="5469441">&#34;&amp;gt;&#34;</span><span class="op" id="5469447">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5469450">//&nbsp;A&nbsp;parse&nbsp;error&nbsp;in&nbsp;the&nbsp;attribute&nbsp;value&nbsp;(unquoted)&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5469506">//&nbsp;before&nbsp;attribute&nbsp;value&nbsp;states.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5469541">//&nbsp;Treated&nbsp;as&nbsp;a&nbsp;quoting&nbsp;character&nbsp;by&nbsp;IE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5469583">&#39;`&#39;</span><span class="op" id="5469586">:</span>&nbsp;<span class="string" id="5469588">&#34;&amp;#96;&#34;</span><span class="op" id="5469595">,</span><br>
<span class="lineno">135</span><span class="op" id="5469597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5469600">//&nbsp;htmlReplacer&nbsp;returns&nbsp;s&nbsp;with&nbsp;runes&nbsp;replaced&nbsp;according&nbsp;to&nbsp;replacementTable</span><br>
<span class="lineno"></span><span class="comment" id="5469676">//&nbsp;and&nbsp;when&nbsp;badRunes&nbsp;is&nbsp;true,&nbsp;certain&nbsp;bad&nbsp;runes&nbsp;are&nbsp;allowed&nbsp;through&nbsp;unescaped.</span><br>
<span class="lineno"></span><span class="keyword" id="5469755">func</span>&nbsp;<span class="ident" id="5469760">htmlReplacer</span><span class="op" id="5469772">(</span><span class="ident" id="5469773">s</span>&nbsp;<span class="builtintype" id="5469775">string</span><span class="op" id="5469781">,</span>&nbsp;<span class="ident" id="5469783">replacementTable</span>&nbsp;<span class="op" id="5469800">[</span><span class="op" id="5469801">]</span><span class="builtintype" id="5469802">string</span><span class="op" id="5469808">,</span>&nbsp;<span class="ident" id="5469810">badRunes</span>&nbsp;<span class="builtintype" id="5469819">bool</span><span class="op" id="5469823">)</span>&nbsp;<span class="builtintype" id="5469825">string</span>&nbsp;<span class="op" id="5469832">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469835">written</span><span class="op" id="5469842">,</span>&nbsp;<span class="ident" id="5469844">b</span>&nbsp;<span class="op" id="5469846">:=</span>&nbsp;<span class="num" id="5469849">0</span><span class="op" id="5469850">,</span>&nbsp;<span class="builtinfunc" id="5469852">new</span><span class="op" id="5469855">(</span><span class="ident" id="5469856">bytes</span><span class="op" id="5469861">.</span><span class="ident" id="5469862">Buffer</span><span class="op" id="5469868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469871">for</span>&nbsp;<span class="ident" id="5469875">i</span><span class="op" id="5469876">,</span>&nbsp;<span class="ident" id="5469878">r</span>&nbsp;<span class="op" id="5469880">:=</span>&nbsp;<span class="keyword" id="5469883">range</span>&nbsp;<span class="ident" id="5469889">s</span>&nbsp;<span class="op" id="5469891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469895">if</span>&nbsp;<span class="builtintype" id="5469898">int</span><span class="op" id="5469901">(</span><span class="ident" id="5469902">r</span><span class="op" id="5469903">)</span>&nbsp;<span class="op" id="5469905">&lt;</span>&nbsp;<span class="builtinfunc" id="5469907">len</span><span class="op" id="5469910">(</span><span class="ident" id="5469911">replacementTable</span><span class="op" id="5469927">)</span>&nbsp;<span class="op" id="5469929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469934">if</span>&nbsp;<span class="ident" id="5469937">repl</span>&nbsp;<span class="op" id="5469942">:=</span>&nbsp;<span class="ident" id="5469945">replacementTable</span><span class="op" id="5469961">[</span><span class="ident" id="5469962">r</span><span class="op" id="5469963">]</span><span class="op" id="5469964">;</span>&nbsp;<span class="builtinfunc" id="5469966">len</span><span class="op" id="5469969">(</span><span class="ident" id="5469970">repl</span><span class="op" id="5469974">)</span>&nbsp;<span class="op" id="5469976">!=</span>&nbsp;<span class="num" id="5469979">0</span>&nbsp;<span class="op" id="5469981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469987">b</span><span class="op" id="5469988">.</span><span class="ident" id="5469989">WriteString</span><span class="op" id="5470000">(</span><span class="ident" id="5470001">s</span><span class="op" id="5470002">[</span><span class="ident" id="5470003">written</span><span class="op" id="5470010">:</span><span class="ident" id="5470011">i</span><span class="op" id="5470012">]</span><span class="op" id="5470013">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470019">b</span><span class="op" id="5470020">.</span><span class="ident" id="5470021">WriteString</span><span class="op" id="5470032">(</span><span class="ident" id="5470033">repl</span><span class="op" id="5470037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5470043">//&nbsp;Valid&nbsp;as&nbsp;long&nbsp;as&nbsp;replacementTable&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5470092">//&nbsp;include&nbsp;anything&nbsp;above&nbsp;0x7f.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470128">written</span>&nbsp;<span class="op" id="5470136">=</span>&nbsp;<span class="ident" id="5470138">i</span>&nbsp;<span class="op" id="5470140">+</span>&nbsp;<span class="ident" id="5470142">utf8</span><span class="op" id="5470146">.</span><span class="ident" id="5470147">RuneLen</span><span class="op" id="5470154">(</span><span class="ident" id="5470155">r</span><span class="op" id="5470156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5470161">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5470165">}</span>&nbsp;<span class="keyword" id="5470167">else</span>&nbsp;<span class="keyword" id="5470172">if</span>&nbsp;<span class="ident" id="5470175">badRunes</span>&nbsp;<span class="op" id="5470184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5470189">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5470202">//&nbsp;IE&nbsp;does&nbsp;not&nbsp;allow&nbsp;these&nbsp;ranges&nbsp;in&nbsp;unquoted&nbsp;attrs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5470257">}</span>&nbsp;<span class="keyword" id="5470259">else</span>&nbsp;<span class="keyword" id="5470264">if</span>&nbsp;<span class="num" id="5470267">0xfdd0</span>&nbsp;<span class="op" id="5470274">&lt;=</span>&nbsp;<span class="ident" id="5470277">r</span>&nbsp;<span class="op" id="5470279">&amp;&amp;</span>&nbsp;<span class="ident" id="5470282">r</span>&nbsp;<span class="op" id="5470284">&lt;=</span>&nbsp;<span class="num" id="5470287">0xfdef</span>&nbsp;<span class="op" id="5470294">||</span>&nbsp;<span class="num" id="5470297">0xfff0</span>&nbsp;<span class="op" id="5470304">&lt;=</span>&nbsp;<span class="ident" id="5470307">r</span>&nbsp;<span class="op" id="5470309">&amp;&amp;</span>&nbsp;<span class="ident" id="5470312">r</span>&nbsp;<span class="op" id="5470314">&lt;=</span>&nbsp;<span class="num" id="5470317">0xffff</span>&nbsp;<span class="op" id="5470324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470329">fmt</span><span class="op" id="5470332">.</span><span class="ident" id="5470333">Fprintf</span><span class="op" id="5470340">(</span><span class="ident" id="5470341">b</span><span class="op" id="5470342">,</span>&nbsp;<span class="string" id="5470344">&#34;%s&amp;#x%x;&#34;</span><span class="op" id="5470354">,</span>&nbsp;<span class="ident" id="5470356">s</span><span class="op" id="5470357">[</span><span class="ident" id="5470358">written</span><span class="op" id="5470365">:</span><span class="ident" id="5470366">i</span><span class="op" id="5470367">]</span><span class="op" id="5470368">,</span>&nbsp;<span class="ident" id="5470370">r</span><span class="op" id="5470371">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470376">written</span>&nbsp;<span class="op" id="5470384">=</span>&nbsp;<span class="ident" id="5470386">i</span>&nbsp;<span class="op" id="5470388">+</span>&nbsp;<span class="ident" id="5470390">utf8</span><span class="op" id="5470394">.</span><span class="ident" id="5470395">RuneLen</span><span class="op" id="5470402">(</span><span class="ident" id="5470403">r</span><span class="op" id="5470404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5470408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5470411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470414">if</span>&nbsp;<span class="ident" id="5470417">written</span>&nbsp;<span class="op" id="5470425">==</span>&nbsp;<span class="num" id="5470428">0</span>&nbsp;<span class="op" id="5470430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470434">return</span>&nbsp;<span class="ident" id="5470441">s</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5470444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470447">b</span><span class="op" id="5470448">.</span><span class="ident" id="5470449">WriteString</span><span class="op" id="5470460">(</span><span class="ident" id="5470461">s</span><span class="op" id="5470462">[</span><span class="ident" id="5470463">written</span><span class="op" id="5470470">:</span><span class="op" id="5470471">]</span><span class="op" id="5470472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470475">return</span>&nbsp;<span class="ident" id="5470482">b</span><span class="op" id="5470483">.</span><span class="ident" id="5470484">String</span><span class="op" id="5470490">(</span><span class="op" id="5470491">)</span><br>
<span class="lineno"></span><span class="op" id="5470493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="5470496">//&nbsp;stripTags&nbsp;takes&nbsp;a&nbsp;snippet&nbsp;of&nbsp;HTML&nbsp;and&nbsp;returns&nbsp;only&nbsp;the&nbsp;text&nbsp;content.</span><br>
<span class="lineno"></span><span class="comment" id="5470568">//&nbsp;For&nbsp;example,&nbsp;`&lt;b&gt;&amp;iexcl;Hi!&lt;/b&gt;&nbsp;&lt;script&gt;...&lt;/script&gt;`&nbsp;-&gt;&nbsp;`&amp;iexcl;Hi!&nbsp;`.</span><br>
<span class="lineno"></span><span class="keyword" id="5470643">func</span>&nbsp;<span class="ident" id="5470648">stripTags</span><span class="op" id="5470657">(</span><span class="ident" id="5470658">html</span>&nbsp;<span class="builtintype" id="5470663">string</span><span class="op" id="5470669">)</span>&nbsp;<span class="builtintype" id="5470671">string</span>&nbsp;<span class="op" id="5470678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470681">var</span>&nbsp;<span class="ident" id="5470685">b</span>&nbsp;<span class="ident" id="5470687">bytes</span><span class="op" id="5470692">.</span><span class="ident" id="5470693">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470701">s</span><span class="op" id="5470702">,</span>&nbsp;<span class="ident" id="5470704">c</span><span class="op" id="5470705">,</span>&nbsp;<span class="ident" id="5470707">i</span><span class="op" id="5470708">,</span>&nbsp;<span class="ident" id="5470710">allText</span>&nbsp;<span class="op" id="5470718">:=</span>&nbsp;<span class="op" id="5470721">[</span><span class="op" id="5470722">]</span><span class="builtintype" id="5470723">byte</span><span class="op" id="5470727">(</span><span class="ident" id="5470728">html</span><span class="op" id="5470732">)</span><span class="op" id="5470733">,</span>&nbsp;<span class="ident" id="5470735">context</span><span class="op" id="5470742">{</span><span class="op" id="5470743">}</span><span class="op" id="5470744">,</span>&nbsp;<span class="num" id="5470746">0</span><span class="op" id="5470747">,</span>&nbsp;<span class="builtintype" id="5470749">true</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5470755">//&nbsp;Using&nbsp;the&nbsp;transition&nbsp;funcs&nbsp;helps&nbsp;us&nbsp;avoid&nbsp;mangling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5470810">//&nbsp;`&lt;div&nbsp;title=&#34;1&gt;2&#34;&gt;`&nbsp;or&nbsp;`I&nbsp;&lt;3&nbsp;Ponies!`.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470853">for</span>&nbsp;<span class="ident" id="5470857">i</span>&nbsp;<span class="op" id="5470859">!=</span>&nbsp;<span class="builtinfunc" id="5470862">len</span><span class="op" id="5470865">(</span><span class="ident" id="5470866">s</span><span class="op" id="5470867">)</span>&nbsp;<span class="op" id="5470869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470873">if</span>&nbsp;<span class="ident" id="5470876">c</span><span class="op" id="5470877">.</span><span class="ident" id="5470878">delim</span>&nbsp;<span class="op" id="5470884">==</span>&nbsp;<span class="ident" id="5470887">delimNone</span>&nbsp;<span class="op" id="5470897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470902">st</span>&nbsp;<span class="op" id="5470905">:=</span>&nbsp;<span class="ident" id="5470908">c</span><span class="op" id="5470909">.</span><span class="ident" id="5470910">state</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5470919">//&nbsp;Use&nbsp;RCDATA&nbsp;instead&nbsp;of&nbsp;parsing&nbsp;into&nbsp;JS&nbsp;or&nbsp;CSS&nbsp;styles.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470978">if</span>&nbsp;<span class="ident" id="5470981">c</span><span class="op" id="5470982">.</span><span class="ident" id="5470983">element</span>&nbsp;<span class="op" id="5470991">!=</span>&nbsp;<span class="ident" id="5470994">elementNone</span>&nbsp;<span class="op" id="5471006">&amp;&amp;</span>&nbsp;<span class="op" id="5471009">!</span><span class="ident" id="5471010">isInTag</span><span class="op" id="5471017">(</span><span class="ident" id="5471018">st</span><span class="op" id="5471020">)</span>&nbsp;<span class="op" id="5471022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471028">st</span>&nbsp;<span class="op" id="5471031">=</span>&nbsp;<span class="ident" id="5471033">stateRCDATA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471053">d</span><span class="op" id="5471054">,</span>&nbsp;<span class="ident" id="5471056">nread</span>&nbsp;<span class="op" id="5471062">:=</span>&nbsp;<span class="ident" id="5471065">transitionFunc</span><span class="op" id="5471079">[</span><span class="ident" id="5471080">st</span><span class="op" id="5471082">]</span><span class="op" id="5471083">(</span><span class="ident" id="5471084">c</span><span class="op" id="5471085">,</span>&nbsp;<span class="ident" id="5471087">s</span><span class="op" id="5471088">[</span><span class="ident" id="5471089">i</span><span class="op" id="5471090">:</span><span class="op" id="5471091">]</span><span class="op" id="5471092">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471097">i1</span>&nbsp;<span class="op" id="5471100">:=</span>&nbsp;<span class="ident" id="5471103">i</span>&nbsp;<span class="op" id="5471105">+</span>&nbsp;<span class="ident" id="5471107">nread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471116">if</span>&nbsp;<span class="ident" id="5471119">c</span><span class="op" id="5471120">.</span><span class="ident" id="5471121">state</span>&nbsp;<span class="op" id="5471127">==</span>&nbsp;<span class="ident" id="5471130">stateText</span>&nbsp;<span class="op" id="5471140">||</span>&nbsp;<span class="ident" id="5471143">c</span><span class="op" id="5471144">.</span><span class="ident" id="5471145">state</span>&nbsp;<span class="op" id="5471151">==</span>&nbsp;<span class="ident" id="5471154">stateRCDATA</span>&nbsp;<span class="op" id="5471166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5471172">//&nbsp;Emit&nbsp;text&nbsp;up&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;tag&nbsp;or&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471228">j</span>&nbsp;<span class="op" id="5471230">:=</span>&nbsp;<span class="ident" id="5471233">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471240">if</span>&nbsp;<span class="ident" id="5471243">d</span><span class="op" id="5471244">.</span><span class="ident" id="5471245">state</span>&nbsp;<span class="op" id="5471251">!=</span>&nbsp;<span class="ident" id="5471254">c</span><span class="op" id="5471255">.</span><span class="ident" id="5471256">state</span>&nbsp;<span class="op" id="5471262">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471269">for</span>&nbsp;<span class="ident" id="5471273">j1</span>&nbsp;<span class="op" id="5471276">:=</span>&nbsp;<span class="ident" id="5471279">j</span>&nbsp;<span class="op" id="5471281">-</span>&nbsp;<span class="num" id="5471283">1</span><span class="op" id="5471284">;</span>&nbsp;<span class="ident" id="5471286">j1</span>&nbsp;<span class="op" id="5471289">&gt;=</span>&nbsp;<span class="ident" id="5471292">i</span><span class="op" id="5471293">;</span>&nbsp;<span class="ident" id="5471295">j1</span><span class="op" id="5471297">--</span>&nbsp;<span class="op" id="5471300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471308">if</span>&nbsp;<span class="ident" id="5471311">s</span><span class="op" id="5471312">[</span><span class="ident" id="5471313">j1</span><span class="op" id="5471315">]</span>&nbsp;<span class="op" id="5471317">==</span>&nbsp;<span class="string" id="5471320">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="5471324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471333">j</span>&nbsp;<span class="op" id="5471335">=</span>&nbsp;<span class="ident" id="5471337">j1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471347">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471359">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471378">b</span><span class="op" id="5471379">.</span><span class="ident" id="5471380">Write</span><span class="op" id="5471385">(</span><span class="ident" id="5471386">s</span><span class="op" id="5471387">[</span><span class="ident" id="5471388">i</span><span class="op" id="5471389">:</span><span class="ident" id="5471390">j</span><span class="op" id="5471391">]</span><span class="op" id="5471392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471397">}</span>&nbsp;<span class="keyword" id="5471399">else</span>&nbsp;<span class="op" id="5471404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471410">allText</span>&nbsp;<span class="op" id="5471418">=</span>&nbsp;<span class="builtintype" id="5471420">false</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471434">c</span><span class="op" id="5471435">,</span>&nbsp;<span class="ident" id="5471437">i</span>&nbsp;<span class="op" id="5471439">=</span>&nbsp;<span class="ident" id="5471441">d</span><span class="op" id="5471442">,</span>&nbsp;<span class="ident" id="5471444">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471450">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471465">i1</span>&nbsp;<span class="op" id="5471468">:=</span>&nbsp;<span class="ident" id="5471471">i</span>&nbsp;<span class="op" id="5471473">+</span>&nbsp;<span class="ident" id="5471475">bytes</span><span class="op" id="5471480">.</span><span class="ident" id="5471481">IndexAny</span><span class="op" id="5471489">(</span><span class="ident" id="5471490">s</span><span class="op" id="5471491">[</span><span class="ident" id="5471492">i</span><span class="op" id="5471493">:</span><span class="op" id="5471494">]</span><span class="op" id="5471495">,</span>&nbsp;<span class="ident" id="5471497">delimEnds</span><span class="op" id="5471506">[</span><span class="ident" id="5471507">c</span><span class="op" id="5471508">.</span><span class="ident" id="5471509">delim</span><span class="op" id="5471514">]</span><span class="op" id="5471515">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471519">if</span>&nbsp;<span class="ident" id="5471522">i1</span>&nbsp;<span class="op" id="5471525">&lt;</span>&nbsp;<span class="ident" id="5471527">i</span>&nbsp;<span class="op" id="5471529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471534">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471546">if</span>&nbsp;<span class="ident" id="5471549">c</span><span class="op" id="5471550">.</span><span class="ident" id="5471551">delim</span>&nbsp;<span class="op" id="5471557">!=</span>&nbsp;<span class="ident" id="5471560">delimSpaceOrTagEnd</span>&nbsp;<span class="op" id="5471579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5471584">//&nbsp;Consume&nbsp;any&nbsp;quote.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471609">i1</span><span class="op" id="5471611">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471620">c</span><span class="op" id="5471621">,</span>&nbsp;<span class="ident" id="5471623">i</span>&nbsp;<span class="op" id="5471625">=</span>&nbsp;<span class="ident" id="5471627">context</span><span class="op" id="5471634">{</span><span class="ident" id="5471635">state</span><span class="op" id="5471640">:</span>&nbsp;<span class="ident" id="5471642">stateTag</span><span class="op" id="5471650">,</span>&nbsp;<span class="ident" id="5471652">element</span><span class="op" id="5471659">:</span>&nbsp;<span class="ident" id="5471661">c</span><span class="op" id="5471662">.</span><span class="ident" id="5471663">element</span><span class="op" id="5471670">}</span><span class="op" id="5471671">,</span>&nbsp;<span class="ident" id="5471673">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471680">if</span>&nbsp;<span class="ident" id="5471683">allText</span>&nbsp;<span class="op" id="5471691">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471695">return</span>&nbsp;<span class="ident" id="5471702">html</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471708">}</span>&nbsp;<span class="keyword" id="5471710">else</span>&nbsp;<span class="keyword" id="5471715">if</span>&nbsp;<span class="ident" id="5471718">c</span><span class="op" id="5471719">.</span><span class="ident" id="5471720">state</span>&nbsp;<span class="op" id="5471726">==</span>&nbsp;<span class="ident" id="5471729">stateText</span>&nbsp;<span class="op" id="5471739">||</span>&nbsp;<span class="ident" id="5471742">c</span><span class="op" id="5471743">.</span><span class="ident" id="5471744">state</span>&nbsp;<span class="op" id="5471750">==</span>&nbsp;<span class="ident" id="5471753">stateRCDATA</span>&nbsp;<span class="op" id="5471765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471769">b</span><span class="op" id="5471770">.</span><span class="ident" id="5471771">Write</span><span class="op" id="5471776">(</span><span class="ident" id="5471777">s</span><span class="op" id="5471778">[</span><span class="ident" id="5471779">i</span><span class="op" id="5471780">:</span><span class="op" id="5471781">]</span><span class="op" id="5471782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471788">return</span>&nbsp;<span class="ident" id="5471795">b</span><span class="op" id="5471796">.</span><span class="ident" id="5471797">String</span><span class="op" id="5471803">(</span><span class="op" id="5471804">)</span><br>
<span class="lineno">215</span><span class="op" id="5471806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5471809">//&nbsp;htmlNameFilter&nbsp;accepts&nbsp;valid&nbsp;parts&nbsp;of&nbsp;an&nbsp;HTML&nbsp;attribute&nbsp;or&nbsp;tag&nbsp;name&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="5471883">//&nbsp;a&nbsp;known-safe&nbsp;HTML&nbsp;attribute.</span><br>
<span class="lineno"></span><span class="keyword" id="5471915">func</span>&nbsp;<span class="ident" id="5471920">htmlNameFilter</span><span class="op" id="5471934">(</span><span class="ident" id="5471935">args</span>&nbsp;<span class="op" id="5471940">...</span><span class="keyword" id="5471943">interface</span><span class="op" id="5471952">{</span><span class="op" id="5471953">}</span><span class="op" id="5471954">)</span>&nbsp;<span class="builtintype" id="5471956">string</span>&nbsp;<span class="op" id="5471963">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471966">s</span><span class="op" id="5471967">,</span>&nbsp;<span class="ident" id="5471969">t</span>&nbsp;<span class="op" id="5471971">:=</span>&nbsp;<span class="ident" id="5471974">stringify</span><span class="op" id="5471983">(</span><span class="ident" id="5471984">args</span><span class="op" id="5471988">...</span><span class="op" id="5471991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471994">if</span>&nbsp;<span class="ident" id="5471997">t</span>&nbsp;<span class="op" id="5471999">==</span>&nbsp;<span class="ident" id="5472002">contentTypeHTMLAttr</span>&nbsp;<span class="op" id="5472022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472026">return</span>&nbsp;<span class="ident" id="5472033">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5472036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472039">if</span>&nbsp;<span class="builtinfunc" id="5472042">len</span><span class="op" id="5472045">(</span><span class="ident" id="5472046">s</span><span class="op" id="5472047">)</span>&nbsp;<span class="op" id="5472049">==</span>&nbsp;<span class="num" id="5472052">0</span>&nbsp;<span class="op" id="5472054">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472058">//&nbsp;Avoid&nbsp;violation&nbsp;of&nbsp;structure&nbsp;preservation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472106">//&nbsp;&lt;input&nbsp;checked&nbsp;{{.K}}={{.V}}&gt;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472142">//&nbsp;Without&nbsp;this,&nbsp;if&nbsp;.K&nbsp;is&nbsp;empty&nbsp;then&nbsp;.V&nbsp;is&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472200">//&nbsp;checked,&nbsp;but&nbsp;otherwise&nbsp;.V&nbsp;is&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;attribute</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472261">//&nbsp;named&nbsp;.K.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472276">return</span>&nbsp;<span class="ident" id="5472283">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5472299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5472302">s</span>&nbsp;<span class="op" id="5472304">=</span>&nbsp;<span class="ident" id="5472306">strings</span><span class="op" id="5472313">.</span><span class="ident" id="5472314">ToLower</span><span class="op" id="5472321">(</span><span class="ident" id="5472322">s</span><span class="op" id="5472323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472326">if</span>&nbsp;<span class="ident" id="5472329">t</span>&nbsp;<span class="op" id="5472331">:=</span>&nbsp;<span class="ident" id="5472334">attrType</span><span class="op" id="5472342">(</span><span class="ident" id="5472343">s</span><span class="op" id="5472344">)</span><span class="op" id="5472345">;</span>&nbsp;<span class="ident" id="5472347">t</span>&nbsp;<span class="op" id="5472349">!=</span>&nbsp;<span class="ident" id="5472352">contentTypePlain</span>&nbsp;<span class="op" id="5472369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472373">//&nbsp;TODO:&nbsp;Split&nbsp;attr&nbsp;and&nbsp;element&nbsp;name&nbsp;part&nbsp;filters&nbsp;so&nbsp;we&nbsp;can&nbsp;whitelist</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472445">//&nbsp;attributes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472462">return</span>&nbsp;<span class="ident" id="5472469">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5472485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472488">for</span>&nbsp;<span class="ident" id="5472492">_</span><span class="op" id="5472493">,</span>&nbsp;<span class="ident" id="5472495">r</span>&nbsp;<span class="op" id="5472497">:=</span>&nbsp;<span class="keyword" id="5472500">range</span>&nbsp;<span class="ident" id="5472506">s</span>&nbsp;<span class="op" id="5472508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472512">switch</span>&nbsp;<span class="op" id="5472519">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472523">case</span>&nbsp;<span class="string" id="5472528">&#39;0&#39;</span>&nbsp;<span class="op" id="5472532">&lt;=</span>&nbsp;<span class="ident" id="5472535">r</span>&nbsp;<span class="op" id="5472537">&amp;&amp;</span>&nbsp;<span class="ident" id="5472540">r</span>&nbsp;<span class="op" id="5472542">&lt;=</span>&nbsp;<span class="string" id="5472545">&#39;9&#39;</span><span class="op" id="5472548">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472552">case</span>&nbsp;<span class="string" id="5472557">&#39;a&#39;</span>&nbsp;<span class="op" id="5472561">&lt;=</span>&nbsp;<span class="ident" id="5472564">r</span>&nbsp;<span class="op" id="5472566">&amp;&amp;</span>&nbsp;<span class="ident" id="5472569">r</span>&nbsp;<span class="op" id="5472571">&lt;=</span>&nbsp;<span class="string" id="5472574">&#39;z&#39;</span><span class="op" id="5472577">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472581">default</span><span class="op" id="5472588">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472593">return</span>&nbsp;<span class="ident" id="5472600">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5472617">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5472620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472623">return</span>&nbsp;<span class="ident" id="5472630">s</span><br>
<span class="lineno"></span><span class="op" id="5472632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5472635">//&nbsp;commentEscaper&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string&nbsp;regardless&nbsp;of&nbsp;input.</span><br>
<span class="lineno">250</span><span class="comment" id="5472699">//&nbsp;Comment&nbsp;content&nbsp;does&nbsp;not&nbsp;correspond&nbsp;to&nbsp;any&nbsp;parsed&nbsp;structure&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="5472765">//&nbsp;human-readable&nbsp;content,&nbsp;so&nbsp;the&nbsp;simplest&nbsp;and&nbsp;most&nbsp;secure&nbsp;policy&nbsp;is&nbsp;to&nbsp;drop</span><br>
<span class="lineno"></span><span class="comment" id="5472842">//&nbsp;content&nbsp;interpolated&nbsp;into&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="5472881">//&nbsp;This&nbsp;approach&nbsp;is&nbsp;equally&nbsp;valid&nbsp;whether&nbsp;or&nbsp;not&nbsp;static&nbsp;comment&nbsp;content&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5472956">//&nbsp;removed&nbsp;from&nbsp;the&nbsp;template.</span><br>
<span class="lineno">255</span><span class="keyword" id="5472986">func</span>&nbsp;<span class="ident" id="5472991">commentEscaper</span><span class="op" id="5473005">(</span><span class="ident" id="5473006">args</span>&nbsp;<span class="op" id="5473011">...</span><span class="keyword" id="5473014">interface</span><span class="op" id="5473023">{</span><span class="op" id="5473024">}</span><span class="op" id="5473025">)</span>&nbsp;<span class="builtintype" id="5473027">string</span>&nbsp;<span class="op" id="5473034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473037">return</span>&nbsp;<span class="string" id="5473044">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="5473047">}</span>
</div>
</body>
</html>
