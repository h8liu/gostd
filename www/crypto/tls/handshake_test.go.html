<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7474807">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7474862">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7474916">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7474967">package</span>&nbsp;<span class="ident" id="7474975">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7474980">import</span>&nbsp;<span class="op" id="7474987">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7474990">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7474999">&#34;encoding/hex&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7475015">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7475025">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7475033">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7475040">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7475046">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7475059">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7475066">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7475077">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7475088">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="7475095">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="7475098">//&nbsp;TLS&nbsp;reference&nbsp;tests&nbsp;run&nbsp;a&nbsp;connection&nbsp;against&nbsp;a&nbsp;reference&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="7475173">//&nbsp;(OpenSSL)&nbsp;of&nbsp;TLS&nbsp;and&nbsp;record&nbsp;the&nbsp;bytes&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;The&nbsp;Go</span><br>
<span class="lineno"></span><span class="comment" id="7475250">//&nbsp;code,&nbsp;during&nbsp;a&nbsp;test,&nbsp;is&nbsp;configured&nbsp;with&nbsp;deterministic&nbsp;randomness&nbsp;and&nbsp;so&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7475329">//&nbsp;reference&nbsp;test&nbsp;can&nbsp;be&nbsp;reproduced&nbsp;exactly&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno">25</span><span class="comment" id="7475388">//</span><br>
<span class="lineno"></span><span class="comment" id="7475391">//&nbsp;In&nbsp;order&nbsp;to&nbsp;save&nbsp;everyone&nbsp;who&nbsp;wishes&nbsp;to&nbsp;run&nbsp;the&nbsp;tests&nbsp;from&nbsp;needing&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7475465">//&nbsp;reference&nbsp;implementation&nbsp;installed,&nbsp;the&nbsp;reference&nbsp;connections&nbsp;are&nbsp;saved&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="7475543">//&nbsp;files&nbsp;in&nbsp;the&nbsp;testdata&nbsp;directory.&nbsp;Thus&nbsp;running&nbsp;the&nbsp;tests&nbsp;involves&nbsp;nothing</span><br>
<span class="lineno"></span><span class="comment" id="7475619">//&nbsp;external,&nbsp;but&nbsp;creating&nbsp;and&nbsp;updating&nbsp;them&nbsp;requires&nbsp;the&nbsp;reference</span><br>
<span class="lineno">30</span><span class="comment" id="7475686">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="comment" id="7475705">//</span><br>
<span class="lineno"></span><span class="comment" id="7475708">//&nbsp;Tests&nbsp;can&nbsp;be&nbsp;updated&nbsp;by&nbsp;running&nbsp;them&nbsp;with&nbsp;the&nbsp;-update&nbsp;flag.&nbsp;This&nbsp;will&nbsp;cause</span><br>
<span class="lineno"></span><span class="comment" id="7475787">//&nbsp;the&nbsp;test&nbsp;files.&nbsp;Generally&nbsp;one&nbsp;should&nbsp;combine&nbsp;the&nbsp;-update&nbsp;flag&nbsp;with&nbsp;-test.run</span><br>
<span class="lineno"></span><span class="comment" id="7475867">//&nbsp;to&nbsp;updated&nbsp;a&nbsp;specific&nbsp;test.&nbsp;Since&nbsp;the&nbsp;reference&nbsp;implementation&nbsp;will&nbsp;always</span><br>
<span class="lineno">35</span><span class="comment" id="7475945">//&nbsp;generate&nbsp;fresh&nbsp;random&nbsp;numbers,&nbsp;large&nbsp;parts&nbsp;of&nbsp;the&nbsp;reference&nbsp;connection&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="7476024">//&nbsp;always&nbsp;change.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7476043">var</span>&nbsp;<span class="ident" id="7476047">update</span>&nbsp;<span class="op" id="7476054">=</span>&nbsp;<span class="ident" id="7476056"><a href="/crypto/tls/handshake_test.go.html#7475025">flag</a></span><span class="op" id="7476060">.</span><span class="ident" id="7476061">Bool</span><span class="op" id="7476065">(</span><span class="string" id="7476066">&#34;update&#34;</span><span class="op" id="7476074">,</span>&nbsp;<span class="builtintype" id="7476076">false</span><span class="op" id="7476081">,</span>&nbsp;<span class="string" id="7476083">&#34;update&nbsp;golden&nbsp;files&nbsp;on&nbsp;disk&#34;</span><span class="op" id="7476112">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="7476115">//&nbsp;recordingConn&nbsp;is&nbsp;a&nbsp;net.Conn&nbsp;that&nbsp;records&nbsp;the&nbsp;traffic&nbsp;that&nbsp;passes&nbsp;through&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="7476195">//&nbsp;WriteTo&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;produce&nbsp;output&nbsp;that&nbsp;can&nbsp;be&nbsp;later&nbsp;be&nbsp;loaded&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="7476269">//&nbsp;ParseTestData.</span><br>
<span class="lineno"></span><span class="keyword" id="7476287">type</span>&nbsp;<span class="ident" id="7476292">recordingConn</span>&nbsp;<span class="keyword" id="7476306">struct</span>&nbsp;<span class="op" id="7476313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7476316"><a href="/crypto/tls/handshake_test.go.html#7475059">net</a></span><span class="op" id="7476319">.</span><span class="ident" id="7476320">Conn</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7476326"><a href="/crypto/tls/handshake_test.go.html#7475088">sync</a></span><span class="op" id="7476330">.</span><span class="ident" id="7476331">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7476338">flows</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7476346">[</span><span class="op" id="7476347">]</span><span class="op" id="7476348">[</span><span class="op" id="7476349">]</span><span class="builtintype" id="7476350">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7476356">reading</span>&nbsp;<span class="builtintype" id="7476364">bool</span><br>
<span class="lineno"></span><span class="op" id="7476369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="7476372">func</span>&nbsp;<span class="op" id="7476377">(</span><span class="ident" id="7476378">r</span>&nbsp;<span class="op" id="7476380">*</span><span class="ident" id="7476381"><a href="/crypto/tls/handshake_test.go.html#7476292">recordingConn</a></span><span class="op" id="7476394">)</span>&nbsp;<span class="ident" id="7476396">Read</span><span class="op" id="7476400">(</span><span class="ident" id="7476401">b</span>&nbsp;<span class="op" id="7476403">[</span><span class="op" id="7476404">]</span><span class="builtintype" id="7476405">byte</span><span class="op" id="7476409">)</span>&nbsp;<span class="op" id="7476411">(</span><span class="ident" id="7476412">n</span>&nbsp;<span class="builtintype" id="7476414">int</span><span class="op" id="7476417">,</span>&nbsp;<span class="ident" id="7476419">err</span>&nbsp;<span class="builtintype" id="7476423">error</span><span class="op" id="7476428">)</span>&nbsp;<span class="op" id="7476430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7476433">if</span>&nbsp;<span class="ident" id="7476436"><a href="/crypto/tls/handshake_test.go.html#7476412">n</a></span><span class="op" id="7476437">,</span>&nbsp;<span class="ident" id="7476439"><a href="/crypto/tls/handshake_test.go.html#7476419">err</a></span>&nbsp;<span class="op" id="7476443">=</span>&nbsp;<span class="ident" id="7476445"><a href="/crypto/tls/handshake_test.go.html#7476378">r</a></span><span class="op" id="7476446">.</span><span class="ident" id="7476447">Conn</span><span class="op" id="7476451">.</span><span class="ident" id="7476452">Read</span><span class="op" id="7476456">(</span><span class="ident" id="7476457"><a href="/crypto/tls/handshake_test.go.html#7476401">b</a></span><span class="op" id="7476458">)</span><span class="op" id="7476459">;</span>&nbsp;<span class="ident" id="7476461"><a href="/crypto/tls/handshake_test.go.html#7476412">n</a></span>&nbsp;<span class="op" id="7476463">==</span>&nbsp;<span class="num" id="7476466">0</span>&nbsp;<span class="op" id="7476468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7476472">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7476480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7476483"><a href="/crypto/tls/handshake_test.go.html#7476401">b</a></span>&nbsp;<span class="op" id="7476485">=</span>&nbsp;<span class="ident" id="7476487"><a href="/crypto/tls/handshake_test.go.html#7476401">b</a></span><span class="op" id="7476488">[</span><span class="op" id="7476489">:</span><span class="ident" id="7476490"><a href="/crypto/tls/handshake_test.go.html#7476412">n</a></span><span class="op" id="7476491">]</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7476495"><a href="/crypto/tls/handshake_test.go.html#7476378">r</a></span><span class="op" id="7476496">.</span><span class="ident" id="7476497">Lock</span><span class="op" id="7476501">(</span><span class="op" id="7476502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7476505">defer</span>&nbsp;<span class="ident" id="7476511"><a href="/crypto/tls/handshake_test.go.html#7476378">r</a></span><span class="op" id="7476512">.</span><span class="ident" id="7476513">Unlock</span><span class="op" id="7476519">(</span><span class="op" id="7476520">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7476524">if</span>&nbsp;<span class="ident" id="7476527">l</span>&nbsp;<span class="op" id="7476529">:=</span>&nbsp;<span class="builtinfunc" id="7476532">len</span><span class="op" id="7476535">(</span><span class="ident" id="7476536"><a href="/crypto/tls/handshake_test.go.html#7476378">r</a></span><span class="op" id="7476537">.</span><span class="ident" id="7476538">flows</span><span class="op" id="7476543">)</span><span class="op" id="7476544">;</span>&nbsp;<span class="ident" id="7476546"><a href="/crypto/tls/handshake_test.go.html#7476527">l</a></span>&nbsp;<span class="op" id="7476548">==</span>&nbsp;<span class="num" id="7476551">0</span>&nbsp;<span class="op" id="7476553">||</span>&nbsp;<span class="op" id="7476556">!</span><span class="ident" id="7476557"><a href="/crypto/tls/handshake_test.go.html#7476378">r</a></span><span class="op" id="7476558">.</span><span class="ident" id="7476559">reading</span>&nbsp;<span class="op" id="7476567">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7476571">buf</span>&nbsp;<span class="op" id="7476575">:=</span>&nbsp;<span class="builtinfunc" id="7476578">make</span><span class="op" id="7476582">(</span><span class="op" id="7476583">[</span><span class="op" id="7476584">]</span><span class="builtintype" id="7476585">byte</span><span class="op" id="7476589">,</span>&nbsp;<span class="builtinfunc" id="7476591">len</span><span class="op" id="7476594">(</span><span class="ident" id="7476595"><a href="/crypto/tls/handshake_test.go.html#7476401">b</a></span><span class="op" id="7476596">)</span><span class="op" id="7476597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7476601">copy</span><span class="op" id="7476605">(</span><span class="ident" id="7476606"><a href="/crypto/tls/handshake_test.go.html#7476571">buf</a></span><span class="op" id="7476609">,</span>&nbsp;<span class="ident" id="7476611"><a href="/crypto/tls/handshake_test.go.html#7476401">b</a></span><span class="op" id="7476612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7476616"><a href="/crypto/tls/handshake_test.go.html#7476378">r</a></span><span class="op" id="7476617">.</span><span class="ident" id="7476618">flows</span>&nbsp;<span class="op" id="7476624">=</span>&nbsp;<span class="builtinfunc" id="7476626">append</span><span class="op" id="7476632">(</span><span class="ident" id="7476633"><a href="/crypto/tls/handshake_test.go.html#7476378">r</a></span><span class="op" id="7476634">.</span><span class="ident" id="7476635">flows</span><span class="op" id="7476640">,</span>&nbsp;<span class="ident" id="7476642"><a href="/crypto/tls/handshake_test.go.html#7476571">buf</a></span><span class="op" id="7476645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7476648">}</span>&nbsp;<span class="keyword" id="7476650">else</span>&nbsp;<span class="op" id="7476655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7476659"><a href="/crypto/tls/handshake_test.go.html#7476378">r</a></span><span class="op" id="7476660">.</span><span class="ident" id="7476661">flows</span><span class="op" id="7476666">[</span><span class="ident" id="7476667"><a href="/crypto/tls/handshake_test.go.html#7476527">l</a></span><span class="op" id="7476668">-</span><span class="num" id="7476669">1</span><span class="op" id="7476670">]</span>&nbsp;<span class="op" id="7476672">=</span>&nbsp;<span class="builtinfunc" id="7476674">append</span><span class="op" id="7476680">(</span><span class="ident" id="7476681"><a href="/crypto/tls/handshake_test.go.html#7476378">r</a></span><span class="op" id="7476682">.</span><span class="ident" id="7476683">flows</span><span class="op" id="7476688">[</span><span class="ident" id="7476689"><a href="/crypto/tls/handshake_test.go.html#7476527">l</a></span><span class="op" id="7476690">-</span><span class="num" id="7476691">1</span><span class="op" id="7476692">]</span><span class="op" id="7476693">,</span>&nbsp;<span class="ident" id="7476695"><a href="/crypto/tls/handshake_test.go.html#7476401">b</a></span><span class="op" id="7476696">[</span><span class="op" id="7476697">:</span><span class="ident" id="7476698"><a href="/crypto/tls/handshake_test.go.html#7476412">n</a></span><span class="op" id="7476699">]</span><span class="op" id="7476700">...</span><span class="op" id="7476703">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7476706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7476709"><a href="/crypto/tls/handshake_test.go.html#7476378">r</a></span><span class="op" id="7476710">.</span><span class="ident" id="7476711">reading</span>&nbsp;<span class="op" id="7476719">=</span>&nbsp;<span class="builtintype" id="7476721">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7476727">return</span><br>
<span class="lineno"></span><span class="op" id="7476734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="7476737">func</span>&nbsp;<span class="op" id="7476742">(</span><span class="ident" id="7476743">r</span>&nbsp;<span class="op" id="7476745">*</span><span class="ident" id="7476746"><a href="/crypto/tls/handshake_test.go.html#7476292">recordingConn</a></span><span class="op" id="7476759">)</span>&nbsp;<span class="ident" id="7476761">Write</span><span class="op" id="7476766">(</span><span class="ident" id="7476767">b</span>&nbsp;<span class="op" id="7476769">[</span><span class="op" id="7476770">]</span><span class="builtintype" id="7476771">byte</span><span class="op" id="7476775">)</span>&nbsp;<span class="op" id="7476777">(</span><span class="ident" id="7476778">n</span>&nbsp;<span class="builtintype" id="7476780">int</span><span class="op" id="7476783">,</span>&nbsp;<span class="ident" id="7476785">err</span>&nbsp;<span class="builtintype" id="7476789">error</span><span class="op" id="7476794">)</span>&nbsp;<span class="op" id="7476796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7476799">if</span>&nbsp;<span class="ident" id="7476802"><a href="/crypto/tls/handshake_test.go.html#7476778">n</a></span><span class="op" id="7476803">,</span>&nbsp;<span class="ident" id="7476805"><a href="/crypto/tls/handshake_test.go.html#7476785">err</a></span>&nbsp;<span class="op" id="7476809">=</span>&nbsp;<span class="ident" id="7476811"><a href="/crypto/tls/handshake_test.go.html#7476743">r</a></span><span class="op" id="7476812">.</span><span class="ident" id="7476813">Conn</span><span class="op" id="7476817">.</span><span class="ident" id="7476818">Write</span><span class="op" id="7476823">(</span><span class="ident" id="7476824"><a href="/crypto/tls/handshake_test.go.html#7476767">b</a></span><span class="op" id="7476825">)</span><span class="op" id="7476826">;</span>&nbsp;<span class="ident" id="7476828"><a href="/crypto/tls/handshake_test.go.html#7476778">n</a></span>&nbsp;<span class="op" id="7476830">==</span>&nbsp;<span class="num" id="7476833">0</span>&nbsp;<span class="op" id="7476835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7476839">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7476847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7476850"><a href="/crypto/tls/handshake_test.go.html#7476767">b</a></span>&nbsp;<span class="op" id="7476852">=</span>&nbsp;<span class="ident" id="7476854"><a href="/crypto/tls/handshake_test.go.html#7476767">b</a></span><span class="op" id="7476855">[</span><span class="op" id="7476856">:</span><span class="ident" id="7476857"><a href="/crypto/tls/handshake_test.go.html#7476778">n</a></span><span class="op" id="7476858">]</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7476862"><a href="/crypto/tls/handshake_test.go.html#7476743">r</a></span><span class="op" id="7476863">.</span><span class="ident" id="7476864">Lock</span><span class="op" id="7476868">(</span><span class="op" id="7476869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7476872">defer</span>&nbsp;<span class="ident" id="7476878"><a href="/crypto/tls/handshake_test.go.html#7476743">r</a></span><span class="op" id="7476879">.</span><span class="ident" id="7476880">Unlock</span><span class="op" id="7476886">(</span><span class="op" id="7476887">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7476891">if</span>&nbsp;<span class="ident" id="7476894">l</span>&nbsp;<span class="op" id="7476896">:=</span>&nbsp;<span class="builtinfunc" id="7476899">len</span><span class="op" id="7476902">(</span><span class="ident" id="7476903"><a href="/crypto/tls/handshake_test.go.html#7476743">r</a></span><span class="op" id="7476904">.</span><span class="ident" id="7476905">flows</span><span class="op" id="7476910">)</span><span class="op" id="7476911">;</span>&nbsp;<span class="ident" id="7476913"><a href="/crypto/tls/handshake_test.go.html#7476894">l</a></span>&nbsp;<span class="op" id="7476915">==</span>&nbsp;<span class="num" id="7476918">0</span>&nbsp;<span class="op" id="7476920">||</span>&nbsp;<span class="ident" id="7476923"><a href="/crypto/tls/handshake_test.go.html#7476743">r</a></span><span class="op" id="7476924">.</span><span class="ident" id="7476925">reading</span>&nbsp;<span class="op" id="7476933">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7476937">buf</span>&nbsp;<span class="op" id="7476941">:=</span>&nbsp;<span class="builtinfunc" id="7476944">make</span><span class="op" id="7476948">(</span><span class="op" id="7476949">[</span><span class="op" id="7476950">]</span><span class="builtintype" id="7476951">byte</span><span class="op" id="7476955">,</span>&nbsp;<span class="builtinfunc" id="7476957">len</span><span class="op" id="7476960">(</span><span class="ident" id="7476961"><a href="/crypto/tls/handshake_test.go.html#7476767">b</a></span><span class="op" id="7476962">)</span><span class="op" id="7476963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7476967">copy</span><span class="op" id="7476971">(</span><span class="ident" id="7476972"><a href="/crypto/tls/handshake_test.go.html#7476937">buf</a></span><span class="op" id="7476975">,</span>&nbsp;<span class="ident" id="7476977"><a href="/crypto/tls/handshake_test.go.html#7476767">b</a></span><span class="op" id="7476978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7476982"><a href="/crypto/tls/handshake_test.go.html#7476743">r</a></span><span class="op" id="7476983">.</span><span class="ident" id="7476984">flows</span>&nbsp;<span class="op" id="7476990">=</span>&nbsp;<span class="builtinfunc" id="7476992">append</span><span class="op" id="7476998">(</span><span class="ident" id="7476999"><a href="/crypto/tls/handshake_test.go.html#7476743">r</a></span><span class="op" id="7477000">.</span><span class="ident" id="7477001">flows</span><span class="op" id="7477006">,</span>&nbsp;<span class="ident" id="7477008"><a href="/crypto/tls/handshake_test.go.html#7476937">buf</a></span><span class="op" id="7477011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7477014">}</span>&nbsp;<span class="keyword" id="7477016">else</span>&nbsp;<span class="op" id="7477021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7477025"><a href="/crypto/tls/handshake_test.go.html#7476743">r</a></span><span class="op" id="7477026">.</span><span class="ident" id="7477027">flows</span><span class="op" id="7477032">[</span><span class="ident" id="7477033"><a href="/crypto/tls/handshake_test.go.html#7476894">l</a></span><span class="op" id="7477034">-</span><span class="num" id="7477035">1</span><span class="op" id="7477036">]</span>&nbsp;<span class="op" id="7477038">=</span>&nbsp;<span class="builtinfunc" id="7477040">append</span><span class="op" id="7477046">(</span><span class="ident" id="7477047"><a href="/crypto/tls/handshake_test.go.html#7476743">r</a></span><span class="op" id="7477048">.</span><span class="ident" id="7477049">flows</span><span class="op" id="7477054">[</span><span class="ident" id="7477055"><a href="/crypto/tls/handshake_test.go.html#7476894">l</a></span><span class="op" id="7477056">-</span><span class="num" id="7477057">1</span><span class="op" id="7477058">]</span><span class="op" id="7477059">,</span>&nbsp;<span class="ident" id="7477061"><a href="/crypto/tls/handshake_test.go.html#7476767">b</a></span><span class="op" id="7477062">[</span><span class="op" id="7477063">:</span><span class="ident" id="7477064"><a href="/crypto/tls/handshake_test.go.html#7476778">n</a></span><span class="op" id="7477065">]</span><span class="op" id="7477066">...</span><span class="op" id="7477069">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7477072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7477075"><a href="/crypto/tls/handshake_test.go.html#7476743">r</a></span><span class="op" id="7477076">.</span><span class="ident" id="7477077">reading</span>&nbsp;<span class="op" id="7477085">=</span>&nbsp;<span class="builtintype" id="7477087">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7477094">return</span><br>
<span class="lineno"></span><span class="op" id="7477101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="7477104">//&nbsp;WriteTo&nbsp;writes&nbsp;Go&nbsp;source&nbsp;code&nbsp;to&nbsp;w&nbsp;that&nbsp;contains&nbsp;the&nbsp;recorded&nbsp;traffic.</span><br>
<span class="lineno"></span><span class="keyword" id="7477178">func</span>&nbsp;<span class="op" id="7477183">(</span><span class="ident" id="7477184">r</span>&nbsp;<span class="op" id="7477186">*</span><span class="ident" id="7477187"><a href="/crypto/tls/handshake_test.go.html#7476292">recordingConn</a></span><span class="op" id="7477200">)</span>&nbsp;<span class="ident" id="7477202">WriteTo</span><span class="op" id="7477209">(</span><span class="ident" id="7477210">w</span>&nbsp;<span class="ident" id="7477212"><a href="/crypto/tls/handshake_test.go.html#7475040">io</a></span><span class="op" id="7477214">.</span><span class="ident" id="7477215">Writer</span><span class="op" id="7477221">)</span>&nbsp;<span class="op" id="7477223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7477226">//&nbsp;TLS&nbsp;always&nbsp;starts&nbsp;with&nbsp;a&nbsp;client&nbsp;to&nbsp;server&nbsp;flow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7477278">clientToServer</span>&nbsp;<span class="op" id="7477293">:=</span>&nbsp;<span class="builtintype" id="7477296">true</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7477303">for</span>&nbsp;<span class="ident" id="7477307">i</span><span class="op" id="7477308">,</span>&nbsp;<span class="ident" id="7477310">flow</span>&nbsp;<span class="op" id="7477315">:=</span>&nbsp;<span class="keyword" id="7477318">range</span>&nbsp;<span class="ident" id="7477324"><a href="/crypto/tls/handshake_test.go.html#7477184">r</a></span><span class="op" id="7477325">.</span><span class="ident" id="7477326">flows</span>&nbsp;<span class="op" id="7477332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7477336">source</span><span class="op" id="7477342">,</span>&nbsp;<span class="ident" id="7477344">dest</span>&nbsp;<span class="op" id="7477349">:=</span>&nbsp;<span class="string" id="7477352">&#34;client&#34;</span><span class="op" id="7477360">,</span>&nbsp;<span class="string" id="7477362">&#34;server&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7477373">if</span>&nbsp;<span class="op" id="7477376">!</span><span class="ident" id="7477377"><a href="/crypto/tls/handshake_test.go.html#7477278">clientToServer</a></span>&nbsp;<span class="op" id="7477392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7477397"><a href="/crypto/tls/handshake_test.go.html#7477336">source</a></span><span class="op" id="7477403">,</span>&nbsp;<span class="ident" id="7477405"><a href="/crypto/tls/handshake_test.go.html#7477344">dest</a></span>&nbsp;<span class="op" id="7477410">=</span>&nbsp;<span class="ident" id="7477412"><a href="/crypto/tls/handshake_test.go.html#7477344">dest</a></span><span class="op" id="7477416">,</span>&nbsp;<span class="ident" id="7477418"><a href="/crypto/tls/handshake_test.go.html#7477336">source</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7477427">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7477431"><a href="/crypto/tls/handshake_test.go.html#7475033">fmt</a></span><span class="op" id="7477434">.</span><span class="ident" id="7477435">Fprintf</span><span class="op" id="7477442">(</span><span class="ident" id="7477443"><a href="/crypto/tls/handshake_test.go.html#7477210">w</a></span><span class="op" id="7477444">,</span>&nbsp;<span class="string" id="7477446">&#34;&gt;&gt;&gt;&nbsp;Flow&nbsp;%d&nbsp;(%s&nbsp;to&nbsp;%s)\n&#34;</span><span class="op" id="7477472">,</span>&nbsp;<span class="ident" id="7477474"><a href="/crypto/tls/handshake_test.go.html#7477307">i</a></span><span class="op" id="7477475">+</span><span class="num" id="7477476">1</span><span class="op" id="7477477">,</span>&nbsp;<span class="ident" id="7477479"><a href="/crypto/tls/handshake_test.go.html#7477336">source</a></span><span class="op" id="7477485">,</span>&nbsp;<span class="ident" id="7477487"><a href="/crypto/tls/handshake_test.go.html#7477344">dest</a></span><span class="op" id="7477491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7477495">dumper</span>&nbsp;<span class="op" id="7477502">:=</span>&nbsp;<span class="ident" id="7477505"><a href="/crypto/tls/handshake_test.go.html#7474999">hex</a></span><span class="op" id="7477508">.</span><span class="ident" id="7477509">Dumper</span><span class="op" id="7477515">(</span><span class="ident" id="7477516"><a href="/crypto/tls/handshake_test.go.html#7477210">w</a></span><span class="op" id="7477517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7477521"><a href="/crypto/tls/handshake_test.go.html#7477495">dumper</a></span><span class="op" id="7477527">.</span><span class="ident" id="7477528">Write</span><span class="op" id="7477533">(</span><span class="ident" id="7477534"><a href="/crypto/tls/handshake_test.go.html#7477310">flow</a></span><span class="op" id="7477538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7477542"><a href="/crypto/tls/handshake_test.go.html#7477495">dumper</a></span><span class="op" id="7477548">.</span><span class="ident" id="7477549">Close</span><span class="op" id="7477554">(</span><span class="op" id="7477555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7477559"><a href="/crypto/tls/handshake_test.go.html#7477278">clientToServer</a></span>&nbsp;<span class="op" id="7477574">=</span>&nbsp;<span class="op" id="7477576">!</span><span class="ident" id="7477577"><a href="/crypto/tls/handshake_test.go.html#7477278">clientToServer</a></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7477593">}</span><br>
<span class="lineno"></span><span class="op" id="7477595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7477598">func</span>&nbsp;<span class="ident" id="7477603">parseTestData</span><span class="op" id="7477616">(</span><span class="ident" id="7477617">r</span>&nbsp;<span class="ident" id="7477619"><a href="/crypto/tls/handshake_test.go.html#7475040">io</a></span><span class="op" id="7477621">.</span><span class="ident" id="7477622">Reader</span><span class="op" id="7477628">)</span>&nbsp;<span class="op" id="7477630">(</span><span class="ident" id="7477631">flows</span>&nbsp;<span class="op" id="7477637">[</span><span class="op" id="7477638">]</span><span class="op" id="7477639">[</span><span class="op" id="7477640">]</span><span class="builtintype" id="7477641">byte</span><span class="op" id="7477645">,</span>&nbsp;<span class="ident" id="7477647">err</span>&nbsp;<span class="builtintype" id="7477651">error</span><span class="op" id="7477656">)</span>&nbsp;<span class="op" id="7477658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7477661">var</span>&nbsp;<span class="ident" id="7477665">currentFlow</span>&nbsp;<span class="op" id="7477677">[</span><span class="op" id="7477678">]</span><span class="builtintype" id="7477679">byte</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7477686">scanner</span>&nbsp;<span class="op" id="7477694">:=</span>&nbsp;<span class="ident" id="7477697"><a href="/crypto/tls/handshake_test.go.html#7474990">bufio</a></span><span class="op" id="7477702">.</span><span class="ident" id="7477703">NewScanner</span><span class="op" id="7477713">(</span><span class="ident" id="7477714"><a href="/crypto/tls/handshake_test.go.html#7477617">r</a></span><span class="op" id="7477715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7477718">for</span>&nbsp;<span class="ident" id="7477722"><a href="/crypto/tls/handshake_test.go.html#7477686">scanner</a></span><span class="op" id="7477729">.</span><span class="ident" id="7477730">Scan</span><span class="op" id="7477734">(</span><span class="op" id="7477735">)</span>&nbsp;<span class="op" id="7477737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7477741">line</span>&nbsp;<span class="op" id="7477746">:=</span>&nbsp;<span class="ident" id="7477749"><a href="/crypto/tls/handshake_test.go.html#7477686">scanner</a></span><span class="op" id="7477756">.</span><span class="ident" id="7477757">Text</span><span class="op" id="7477761">(</span><span class="op" id="7477762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7477766">//&nbsp;If&nbsp;the&nbsp;line&nbsp;starts&nbsp;with&nbsp;&#34;&gt;&gt;&gt;&nbsp;&#34;&nbsp;then&nbsp;it&nbsp;marks&nbsp;the&nbsp;beginning</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7477830">//&nbsp;of&nbsp;a&nbsp;new&nbsp;flow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7477850">if</span>&nbsp;<span class="ident" id="7477853"><a href="/crypto/tls/handshake_test.go.html#7475077">strings</a></span><span class="op" id="7477860">.</span><span class="ident" id="7477861">HasPrefix</span><span class="op" id="7477870">(</span><span class="ident" id="7477871"><a href="/crypto/tls/handshake_test.go.html#7477741">line</a></span><span class="op" id="7477875">,</span>&nbsp;<span class="string" id="7477877">&#34;&gt;&gt;&gt;&nbsp;&#34;</span><span class="op" id="7477883">)</span>&nbsp;<span class="op" id="7477885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7477890">if</span>&nbsp;<span class="builtinfunc" id="7477893">len</span><span class="op" id="7477896">(</span><span class="ident" id="7477897"><a href="/crypto/tls/handshake_test.go.html#7477665">currentFlow</a></span><span class="op" id="7477908">)</span>&nbsp;<span class="op" id="7477910">&gt;</span>&nbsp;<span class="num" id="7477912">0</span>&nbsp;<span class="op" id="7477914">||</span>&nbsp;<span class="builtinfunc" id="7477917">len</span><span class="op" id="7477920">(</span><span class="ident" id="7477921"><a href="/crypto/tls/handshake_test.go.html#7477631">flows</a></span><span class="op" id="7477926">)</span>&nbsp;<span class="op" id="7477928">&gt;</span>&nbsp;<span class="num" id="7477930">0</span>&nbsp;<span class="op" id="7477932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7477938"><a href="/crypto/tls/handshake_test.go.html#7477631">flows</a></span>&nbsp;<span class="op" id="7477944">=</span>&nbsp;<span class="builtinfunc" id="7477946">append</span><span class="op" id="7477952">(</span><span class="ident" id="7477953"><a href="/crypto/tls/handshake_test.go.html#7477631">flows</a></span><span class="op" id="7477958">,</span>&nbsp;<span class="ident" id="7477960"><a href="/crypto/tls/handshake_test.go.html#7477665">currentFlow</a></span><span class="op" id="7477971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7477977"><a href="/crypto/tls/handshake_test.go.html#7477665">currentFlow</a></span>&nbsp;<span class="op" id="7477989">=</span>&nbsp;<span class="ident" id="7477991">nil</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7477998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7478003">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7478014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7478019">//&nbsp;Otherwise&nbsp;the&nbsp;line&nbsp;is&nbsp;a&nbsp;line&nbsp;of&nbsp;hex&nbsp;dump&nbsp;that&nbsp;looks&nbsp;like:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7478082">//&nbsp;00000170&nbsp;&nbsp;fc&nbsp;f5&nbsp;06&nbsp;bf&nbsp;(...)&nbsp;&nbsp;|.....X{&amp;?......!|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7478135">//&nbsp;(Some&nbsp;bytes&nbsp;have&nbsp;been&nbsp;omitted&nbsp;from&nbsp;the&nbsp;middle&nbsp;section.)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7478197">if</span>&nbsp;<span class="ident" id="7478200">i</span>&nbsp;<span class="op" id="7478202">:=</span>&nbsp;<span class="ident" id="7478205"><a href="/crypto/tls/handshake_test.go.html#7475077">strings</a></span><span class="op" id="7478212">.</span><span class="ident" id="7478213">IndexByte</span><span class="op" id="7478222">(</span><span class="ident" id="7478223"><a href="/crypto/tls/handshake_test.go.html#7477741">line</a></span><span class="op" id="7478227">,</span>&nbsp;<span class="string" id="7478229">&#39;&nbsp;&#39;</span><span class="op" id="7478232">)</span><span class="op" id="7478233">;</span>&nbsp;<span class="ident" id="7478235"><a href="/crypto/tls/handshake_test.go.html#7478200">i</a></span>&nbsp;<span class="op" id="7478237">&gt;=</span>&nbsp;<span class="num" id="7478240">0</span>&nbsp;<span class="op" id="7478242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7478247"><a href="/crypto/tls/handshake_test.go.html#7477741">line</a></span>&nbsp;<span class="op" id="7478252">=</span>&nbsp;<span class="ident" id="7478254"><a href="/crypto/tls/handshake_test.go.html#7477741">line</a></span><span class="op" id="7478258">[</span><span class="ident" id="7478259"><a href="/crypto/tls/handshake_test.go.html#7478200">i</a></span><span class="op" id="7478260">:</span><span class="op" id="7478261">]</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7478265">}</span>&nbsp;<span class="keyword" id="7478267">else</span>&nbsp;<span class="op" id="7478272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7478277">return</span>&nbsp;<span class="ident" id="7478284">nil</span><span class="op" id="7478287">,</span>&nbsp;<span class="ident" id="7478289"><a href="/crypto/tls/handshake_test.go.html#7475015">errors</a></span><span class="op" id="7478295">.</span><span class="ident" id="7478296">New</span><span class="op" id="7478299">(</span><span class="string" id="7478300">&#34;invalid&nbsp;test&nbsp;data&#34;</span><span class="op" id="7478319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7478323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7478328">if</span>&nbsp;<span class="ident" id="7478331">i</span>&nbsp;<span class="op" id="7478333">:=</span>&nbsp;<span class="ident" id="7478336"><a href="/crypto/tls/handshake_test.go.html#7475077">strings</a></span><span class="op" id="7478343">.</span><span class="ident" id="7478344">IndexByte</span><span class="op" id="7478353">(</span><span class="ident" id="7478354"><a href="/crypto/tls/handshake_test.go.html#7477741">line</a></span><span class="op" id="7478358">,</span>&nbsp;<span class="string" id="7478360">&#39;|&#39;</span><span class="op" id="7478363">)</span><span class="op" id="7478364">;</span>&nbsp;<span class="ident" id="7478366"><a href="/crypto/tls/handshake_test.go.html#7478331">i</a></span>&nbsp;<span class="op" id="7478368">&gt;=</span>&nbsp;<span class="num" id="7478371">0</span>&nbsp;<span class="op" id="7478373">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7478378"><a href="/crypto/tls/handshake_test.go.html#7477741">line</a></span>&nbsp;<span class="op" id="7478383">=</span>&nbsp;<span class="ident" id="7478385"><a href="/crypto/tls/handshake_test.go.html#7477741">line</a></span><span class="op" id="7478389">[</span><span class="op" id="7478390">:</span><span class="ident" id="7478391"><a href="/crypto/tls/handshake_test.go.html#7478331">i</a></span><span class="op" id="7478392">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7478396">}</span>&nbsp;<span class="keyword" id="7478398">else</span>&nbsp;<span class="op" id="7478403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7478408">return</span>&nbsp;<span class="ident" id="7478415">nil</span><span class="op" id="7478418">,</span>&nbsp;<span class="ident" id="7478420"><a href="/crypto/tls/handshake_test.go.html#7475015">errors</a></span><span class="op" id="7478426">.</span><span class="ident" id="7478427">New</span><span class="op" id="7478430">(</span><span class="string" id="7478431">&#34;invalid&nbsp;test&nbsp;data&#34;</span><span class="op" id="7478450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7478454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7478459">hexBytes</span>&nbsp;<span class="op" id="7478468">:=</span>&nbsp;<span class="ident" id="7478471"><a href="/crypto/tls/handshake_test.go.html#7475077">strings</a></span><span class="op" id="7478478">.</span><span class="ident" id="7478479">Fields</span><span class="op" id="7478485">(</span><span class="ident" id="7478486"><a href="/crypto/tls/handshake_test.go.html#7477741">line</a></span><span class="op" id="7478490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7478494">for</span>&nbsp;<span class="ident" id="7478498">_</span><span class="op" id="7478499">,</span>&nbsp;<span class="ident" id="7478501">hexByte</span>&nbsp;<span class="op" id="7478509">:=</span>&nbsp;<span class="keyword" id="7478512">range</span>&nbsp;<span class="ident" id="7478518"><a href="/crypto/tls/handshake_test.go.html#7478459">hexBytes</a></span>&nbsp;<span class="op" id="7478527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7478532">val</span><span class="op" id="7478535">,</span>&nbsp;<span class="ident" id="7478537">err</span>&nbsp;<span class="op" id="7478541">:=</span>&nbsp;<span class="ident" id="7478544"><a href="/crypto/tls/handshake_test.go.html#7475066">strconv</a></span><span class="op" id="7478551">.</span><span class="ident" id="7478552">ParseUint</span><span class="op" id="7478561">(</span><span class="ident" id="7478562"><a href="/crypto/tls/handshake_test.go.html#7478501">hexByte</a></span><span class="op" id="7478569">,</span>&nbsp;<span class="num" id="7478571">16</span><span class="op" id="7478573">,</span>&nbsp;<span class="num" id="7478575">8</span><span class="op" id="7478576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7478581">if</span>&nbsp;<span class="ident" id="7478584"><a href="/crypto/tls/handshake_test.go.html#7478537">err</a></span>&nbsp;<span class="op" id="7478588">!=</span>&nbsp;<span class="ident" id="7478591">nil</span>&nbsp;<span class="op" id="7478595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7478601">return</span>&nbsp;<span class="ident" id="7478608">nil</span><span class="op" id="7478611">,</span>&nbsp;<span class="ident" id="7478613"><a href="/crypto/tls/handshake_test.go.html#7475015">errors</a></span><span class="op" id="7478619">.</span><span class="ident" id="7478620">New</span><span class="op" id="7478623">(</span><span class="string" id="7478624">&#34;invalid&nbsp;hex&nbsp;byte&nbsp;in&nbsp;test&nbsp;data:&nbsp;&#34;</span>&nbsp;<span class="op" id="7478658">+</span>&nbsp;<span class="ident" id="7478660"><a href="/crypto/tls/handshake_test.go.html#7478537">err</a></span><span class="op" id="7478663">.</span><span class="ident" id="7478664">Error</span><span class="op" id="7478669">(</span><span class="op" id="7478670">)</span><span class="op" id="7478671">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7478676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7478681"><a href="/crypto/tls/handshake_test.go.html#7477665">currentFlow</a></span>&nbsp;<span class="op" id="7478693">=</span>&nbsp;<span class="builtinfunc" id="7478695">append</span><span class="op" id="7478701">(</span><span class="ident" id="7478702"><a href="/crypto/tls/handshake_test.go.html#7477665">currentFlow</a></span><span class="op" id="7478713">,</span>&nbsp;<span class="builtintype" id="7478715">byte</span><span class="op" id="7478719">(</span><span class="ident" id="7478720"><a href="/crypto/tls/handshake_test.go.html#7478532">val</a></span><span class="op" id="7478723">)</span><span class="op" id="7478724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7478728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7478731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7478735">if</span>&nbsp;<span class="builtinfunc" id="7478738">len</span><span class="op" id="7478741">(</span><span class="ident" id="7478742"><a href="/crypto/tls/handshake_test.go.html#7477665">currentFlow</a></span><span class="op" id="7478753">)</span>&nbsp;<span class="op" id="7478755">&gt;</span>&nbsp;<span class="num" id="7478757">0</span>&nbsp;<span class="op" id="7478759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7478763"><a href="/crypto/tls/handshake_test.go.html#7477631">flows</a></span>&nbsp;<span class="op" id="7478769">=</span>&nbsp;<span class="builtinfunc" id="7478771">append</span><span class="op" id="7478777">(</span><span class="ident" id="7478778"><a href="/crypto/tls/handshake_test.go.html#7477631">flows</a></span><span class="op" id="7478783">,</span>&nbsp;<span class="ident" id="7478785"><a href="/crypto/tls/handshake_test.go.html#7477665">currentFlow</a></span><span class="op" id="7478796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7478799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7478803">return</span>&nbsp;<span class="ident" id="7478810"><a href="/crypto/tls/handshake_test.go.html#7477631">flows</a></span><span class="op" id="7478815">,</span>&nbsp;<span class="ident" id="7478817">nil</span><br>
<span class="lineno">155</span><span class="op" id="7478821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7478824">//&nbsp;tempFile&nbsp;creates&nbsp;a&nbsp;temp&nbsp;file&nbsp;containing&nbsp;contents&nbsp;and&nbsp;returns&nbsp;its&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="7478898">func</span>&nbsp;<span class="ident" id="7478903">tempFile</span><span class="op" id="7478911">(</span><span class="ident" id="7478912">contents</span>&nbsp;<span class="builtintype" id="7478921">string</span><span class="op" id="7478927">)</span>&nbsp;<span class="builtintype" id="7478929">string</span>&nbsp;<span class="op" id="7478936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7478939">file</span><span class="op" id="7478943">,</span>&nbsp;<span class="ident" id="7478945">err</span>&nbsp;<span class="op" id="7478949">:=</span>&nbsp;<span class="ident" id="7478952"><a href="/crypto/tls/handshake_test.go.html#7475046">ioutil</a></span><span class="op" id="7478958">.</span><span class="ident" id="7478959">TempFile</span><span class="op" id="7478967">(</span><span class="string" id="7478968">&#34;&#34;</span><span class="op" id="7478970">,</span>&nbsp;<span class="string" id="7478972">&#34;go-tls-test&#34;</span><span class="op" id="7478985">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7478988">if</span>&nbsp;<span class="ident" id="7478991"><a href="/crypto/tls/handshake_test.go.html#7478945">err</a></span>&nbsp;<span class="op" id="7478995">!=</span>&nbsp;<span class="ident" id="7478998">nil</span>&nbsp;<span class="op" id="7479002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7479006">panic</span><span class="op" id="7479011">(</span><span class="string" id="7479012">&#34;failed&nbsp;to&nbsp;create&nbsp;temp&nbsp;file:&nbsp;&#34;</span>&nbsp;<span class="op" id="7479043">+</span>&nbsp;<span class="ident" id="7479045"><a href="/crypto/tls/handshake_test.go.html#7478945">err</a></span><span class="op" id="7479048">.</span><span class="ident" id="7479049">Error</span><span class="op" id="7479054">(</span><span class="op" id="7479055">)</span><span class="op" id="7479056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7479059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7479062">path</span>&nbsp;<span class="op" id="7479067">:=</span>&nbsp;<span class="ident" id="7479070"><a href="/crypto/tls/handshake_test.go.html#7478939">file</a></span><span class="op" id="7479074">.</span><span class="ident" id="7479075">Name</span><span class="op" id="7479079">(</span><span class="op" id="7479080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7479083"><a href="/crypto/tls/handshake_test.go.html#7478939">file</a></span><span class="op" id="7479087">.</span><span class="ident" id="7479088">WriteString</span><span class="op" id="7479099">(</span><span class="ident" id="7479100"><a href="/crypto/tls/handshake_test.go.html#7478912">contents</a></span><span class="op" id="7479108">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7479111"><a href="/crypto/tls/handshake_test.go.html#7478939">file</a></span><span class="op" id="7479115">.</span><span class="ident" id="7479116">Close</span><span class="op" id="7479121">(</span><span class="op" id="7479122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7479125">return</span>&nbsp;<span class="ident" id="7479132"><a href="/crypto/tls/handshake_test.go.html#7479062">path</a></span><br>
<span class="lineno"></span><span class="op" id="7479137">}</span>
</div>
</body>
</html>
