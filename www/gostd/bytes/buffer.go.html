<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>bytes</h2>
<ul>
<li><a href="/gostd/bytes/buffer.go.html">buffer.go</a></li>
<li><a href="/gostd/bytes/buffer_test.go.html">buffer_test.go</a></li>
<li><a href="/gostd/bytes/bytes.go.html">bytes.go</a></li>
<li><a href="/gostd/bytes/bytes_decl.go.html">bytes_decl.go</a></li>
<li><a href="/gostd/bytes/bytes_test.go.html">bytes_test.go</a></li>
<li><a href="/gostd/bytes/compare_test.go.html">compare_test.go</a></li>
<li><a href="/gostd/bytes/equal_test.go.html">equal_test.go</a></li>
<li><a href="/gostd/bytes/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/bytes/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/bytes/reader.go.html">reader.go</a></li>
<li><a href="/gostd/bytes/reader_test.go.html">reader_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2039676">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2039731">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2039785">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2039836">package</span>&nbsp;<span class="ident" id="2039844">bytes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2039851">//&nbsp;Simple&nbsp;byte&nbsp;buffer&nbsp;for&nbsp;marshaling&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2039895">import</span>&nbsp;<span class="op" id="2039902">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2039905">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2039915">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2039921">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="2039936">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2039939">//&nbsp;A&nbsp;Buffer&nbsp;is&nbsp;a&nbsp;variable-sized&nbsp;buffer&nbsp;of&nbsp;bytes&nbsp;with&nbsp;Read&nbsp;and&nbsp;Write&nbsp;methods.</span><br>
<span class="lineno"></span><span class="comment" id="2040016">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;Buffer&nbsp;is&nbsp;an&nbsp;empty&nbsp;buffer&nbsp;ready&nbsp;to&nbsp;use.</span><br>
<span class="lineno"></span><span class="keyword" id="2040078">type</span>&nbsp;<span class="ident" id="2040083">Buffer</span>&nbsp;<span class="keyword" id="2040090">struct</span>&nbsp;<span class="op" id="2040097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2040100">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2040110">[</span><span class="op" id="2040111">]</span><span class="builtintype" id="2040112">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2040128">//&nbsp;contents&nbsp;are&nbsp;the&nbsp;bytes&nbsp;buf[off&nbsp;:&nbsp;len(buf)]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2040175">off</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2040185">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2040203">//&nbsp;read&nbsp;at&nbsp;&amp;buf[off],&nbsp;write&nbsp;at&nbsp;&amp;buf[len(buf)]</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2040250">runeBytes</span>&nbsp;<span class="op" id="2040260">[</span><span class="ident" id="2040261">utf8</span><span class="op" id="2040265">.</span><span class="ident" id="2040266">UTFMax</span><span class="op" id="2040272">]</span><span class="builtintype" id="2040273">byte</span>&nbsp;<span class="comment" id="2040278">//&nbsp;avoid&nbsp;allocation&nbsp;of&nbsp;slice&nbsp;on&nbsp;each&nbsp;WriteByte&nbsp;or&nbsp;Rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2040334">bootstrap</span>&nbsp;<span class="op" id="2040344">[</span><span class="num" id="2040345">64</span><span class="op" id="2040347">]</span><span class="builtintype" id="2040348">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2040362">//&nbsp;memory&nbsp;to&nbsp;hold&nbsp;first&nbsp;slice;&nbsp;helps&nbsp;small&nbsp;buffers&nbsp;(Printf)&nbsp;avoid&nbsp;allocation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2040441">lastRead</span>&nbsp;&nbsp;<span class="ident" id="2040451">readOp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2040469">//&nbsp;last&nbsp;read&nbsp;operation,&nbsp;so&nbsp;that&nbsp;Unread*&nbsp;can&nbsp;work&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="op" id="2040529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="2040532">//&nbsp;The&nbsp;readOp&nbsp;constants&nbsp;describe&nbsp;the&nbsp;last&nbsp;action&nbsp;performed&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="2040594">//&nbsp;the&nbsp;buffer,&nbsp;so&nbsp;that&nbsp;UnreadRune&nbsp;and&nbsp;UnreadByte&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="2040647">//&nbsp;check&nbsp;for&nbsp;invalid&nbsp;usage.</span><br>
<span class="lineno"></span><span class="keyword" id="2040675">type</span>&nbsp;<span class="ident" id="2040680">readOp</span>&nbsp;<span class="builtintype" id="2040687">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="2040692">const</span>&nbsp;<span class="op" id="2040698">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2040701">opInvalid</span>&nbsp;&nbsp;<span class="ident" id="2040712">readOp</span>&nbsp;<span class="op" id="2040719">=</span>&nbsp;<span class="ident" id="2040721">iota</span>&nbsp;<span class="comment" id="2040726">//&nbsp;Non-read&nbsp;operation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2040750">opReadRune</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2040775">//&nbsp;Read&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2040790">opRead</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2040815">//&nbsp;Any&nbsp;other&nbsp;read&nbsp;operation.</span><br>
<span class="lineno"></span><span class="op" id="2040844">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="2040847">//&nbsp;ErrTooLarge&nbsp;is&nbsp;passed&nbsp;to&nbsp;panic&nbsp;if&nbsp;memory&nbsp;cannot&nbsp;be&nbsp;allocated&nbsp;to&nbsp;store&nbsp;data&nbsp;in&nbsp;a&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="2040938">var</span>&nbsp;<span class="ident" id="2040942">ErrTooLarge</span>&nbsp;<span class="op" id="2040954">=</span>&nbsp;<span class="ident" id="2040956">errors</span><span class="op" id="2040962">.</span><span class="ident" id="2040963">New</span><span class="op" id="2040966">(</span><span class="string" id="2040967">&#34;bytes.Buffer:&nbsp;too&nbsp;large&#34;</span><span class="op" id="2040992">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2040995">//&nbsp;Bytes&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer;</span><br>
<span class="lineno">40</span><span class="comment" id="2041073">//&nbsp;len(b.Bytes())&nbsp;==&nbsp;b.Len().&nbsp;&nbsp;If&nbsp;the&nbsp;caller&nbsp;changes&nbsp;the&nbsp;contents&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2041146">//&nbsp;returned&nbsp;slice,&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;buffer&nbsp;will&nbsp;change&nbsp;provided&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="2041219">//&nbsp;are&nbsp;no&nbsp;intervening&nbsp;method&nbsp;calls&nbsp;on&nbsp;the&nbsp;Buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="2041269">func</span>&nbsp;<span class="op" id="2041274">(</span><span class="ident" id="2041275">b</span>&nbsp;<span class="op" id="2041277">*</span><span class="ident" id="2041278">Buffer</span><span class="op" id="2041284">)</span>&nbsp;<span class="ident" id="2041286">Bytes</span><span class="op" id="2041291">(</span><span class="op" id="2041292">)</span>&nbsp;<span class="op" id="2041294">[</span><span class="op" id="2041295">]</span><span class="builtintype" id="2041296">byte</span>&nbsp;<span class="op" id="2041301">{</span>&nbsp;<span class="keyword" id="2041303">return</span>&nbsp;<span class="ident" id="2041310">b</span><span class="op" id="2041311">.</span><span class="ident" id="2041312">buf</span><span class="op" id="2041315">[</span><span class="ident" id="2041316">b</span><span class="op" id="2041317">.</span><span class="ident" id="2041318">off</span><span class="op" id="2041321">:</span><span class="op" id="2041322">]</span>&nbsp;<span class="op" id="2041324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="2041327">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span><span class="comment" id="2041394">//&nbsp;as&nbsp;a&nbsp;string.&nbsp;&nbsp;If&nbsp;the&nbsp;Buffer&nbsp;is&nbsp;a&nbsp;nil&nbsp;pointer,&nbsp;it&nbsp;returns&nbsp;&#34;&lt;nil&gt;&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="2041463">func</span>&nbsp;<span class="op" id="2041468">(</span><span class="ident" id="2041469">b</span>&nbsp;<span class="op" id="2041471">*</span><span class="ident" id="2041472">Buffer</span><span class="op" id="2041478">)</span>&nbsp;<span class="ident" id="2041480">String</span><span class="op" id="2041486">(</span><span class="op" id="2041487">)</span>&nbsp;<span class="builtintype" id="2041489">string</span>&nbsp;<span class="op" id="2041496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2041499">if</span>&nbsp;<span class="ident" id="2041502">b</span>&nbsp;<span class="op" id="2041504">==</span>&nbsp;<span class="ident" id="2041507">nil</span>&nbsp;<span class="op" id="2041511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2041515">//&nbsp;Special&nbsp;case,&nbsp;useful&nbsp;in&nbsp;debugging.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2041555">return</span>&nbsp;<span class="string" id="2041562">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2041571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2041574">return</span>&nbsp;<span class="builtintype" id="2041581">string</span><span class="op" id="2041587">(</span><span class="ident" id="2041588">b</span><span class="op" id="2041589">.</span><span class="ident" id="2041590">buf</span><span class="op" id="2041593">[</span><span class="ident" id="2041594">b</span><span class="op" id="2041595">.</span><span class="ident" id="2041596">off</span><span class="op" id="2041599">:</span><span class="op" id="2041600">]</span><span class="op" id="2041601">)</span><br>
<span class="lineno"></span><span class="op" id="2041603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="2041606">//&nbsp;Len&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer;</span><br>
<span class="lineno"></span><span class="comment" id="2041678">//&nbsp;b.Len()&nbsp;==&nbsp;len(b.Bytes()).</span><br>
<span class="lineno"></span><span class="keyword" id="2041708">func</span>&nbsp;<span class="op" id="2041713">(</span><span class="ident" id="2041714">b</span>&nbsp;<span class="op" id="2041716">*</span><span class="ident" id="2041717">Buffer</span><span class="op" id="2041723">)</span>&nbsp;<span class="ident" id="2041725">Len</span><span class="op" id="2041728">(</span><span class="op" id="2041729">)</span>&nbsp;<span class="builtintype" id="2041731">int</span>&nbsp;<span class="op" id="2041735">{</span>&nbsp;<span class="keyword" id="2041737">return</span>&nbsp;<span class="builtinfunc" id="2041744">len</span><span class="op" id="2041747">(</span><span class="ident" id="2041748">b</span><span class="op" id="2041749">.</span><span class="ident" id="2041750">buf</span><span class="op" id="2041753">)</span>&nbsp;<span class="op" id="2041755">-</span>&nbsp;<span class="ident" id="2041757">b</span><span class="op" id="2041758">.</span><span class="ident" id="2041759">off</span>&nbsp;<span class="op" id="2041763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2041766">//&nbsp;Truncate&nbsp;discards&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;n&nbsp;unread&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">60</span><span class="comment" id="2041837">//&nbsp;It&nbsp;panics&nbsp;if&nbsp;n&nbsp;is&nbsp;negative&nbsp;or&nbsp;greater&nbsp;than&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="2041909">func</span>&nbsp;<span class="op" id="2041914">(</span><span class="ident" id="2041915">b</span>&nbsp;<span class="op" id="2041917">*</span><span class="ident" id="2041918">Buffer</span><span class="op" id="2041924">)</span>&nbsp;<span class="ident" id="2041926">Truncate</span><span class="op" id="2041934">(</span><span class="ident" id="2041935">n</span>&nbsp;<span class="builtintype" id="2041937">int</span><span class="op" id="2041940">)</span>&nbsp;<span class="op" id="2041942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2041945">b</span><span class="op" id="2041946">.</span><span class="ident" id="2041947">lastRead</span>&nbsp;<span class="op" id="2041956">=</span>&nbsp;<span class="ident" id="2041958">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2041969">switch</span>&nbsp;<span class="op" id="2041976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2041979">case</span>&nbsp;<span class="ident" id="2041984">n</span>&nbsp;<span class="op" id="2041986">&lt;</span>&nbsp;<span class="num" id="2041988">0</span>&nbsp;<span class="op" id="2041990">||</span>&nbsp;<span class="ident" id="2041993">n</span>&nbsp;<span class="op" id="2041995">&gt;</span>&nbsp;<span class="ident" id="2041997">b</span><span class="op" id="2041998">.</span><span class="ident" id="2041999">Len</span><span class="op" id="2042002">(</span><span class="op" id="2042003">)</span><span class="op" id="2042004">:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2042008">panic</span><span class="op" id="2042013">(</span><span class="string" id="2042014">&#34;bytes.Buffer:&nbsp;truncation&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="2042053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2042056">case</span>&nbsp;<span class="ident" id="2042061">n</span>&nbsp;<span class="op" id="2042063">==</span>&nbsp;<span class="num" id="2042066">0</span><span class="op" id="2042067">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2042071">//&nbsp;Reuse&nbsp;buffer&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2042096">b</span><span class="op" id="2042097">.</span><span class="ident" id="2042098">off</span>&nbsp;<span class="op" id="2042102">=</span>&nbsp;<span class="num" id="2042104">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2042107">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2042110">b</span><span class="op" id="2042111">.</span><span class="ident" id="2042112">buf</span>&nbsp;<span class="op" id="2042116">=</span>&nbsp;<span class="ident" id="2042118">b</span><span class="op" id="2042119">.</span><span class="ident" id="2042120">buf</span><span class="op" id="2042123">[</span><span class="num" id="2042124">0</span>&nbsp;<span class="op" id="2042126">:</span>&nbsp;<span class="ident" id="2042128">b</span><span class="op" id="2042129">.</span><span class="ident" id="2042130">off</span><span class="op" id="2042133">+</span><span class="ident" id="2042134">n</span><span class="op" id="2042135">]</span><br>
<span class="lineno"></span><span class="op" id="2042137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2042140">//&nbsp;Reset&nbsp;resets&nbsp;the&nbsp;buffer&nbsp;so&nbsp;it&nbsp;has&nbsp;no&nbsp;content.</span><br>
<span class="lineno"></span><span class="comment" id="2042189">//&nbsp;b.Reset()&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;b.Truncate(0).</span><br>
<span class="lineno">75</span><span class="keyword" id="2042232">func</span>&nbsp;<span class="op" id="2042237">(</span><span class="ident" id="2042238">b</span>&nbsp;<span class="op" id="2042240">*</span><span class="ident" id="2042241">Buffer</span><span class="op" id="2042247">)</span>&nbsp;<span class="ident" id="2042249">Reset</span><span class="op" id="2042254">(</span><span class="op" id="2042255">)</span>&nbsp;<span class="op" id="2042257">{</span>&nbsp;<span class="ident" id="2042259">b</span><span class="op" id="2042260">.</span><span class="ident" id="2042261">Truncate</span><span class="op" id="2042269">(</span><span class="num" id="2042270">0</span><span class="op" id="2042271">)</span>&nbsp;<span class="op" id="2042273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2042276">//&nbsp;grow&nbsp;grows&nbsp;the&nbsp;buffer&nbsp;to&nbsp;guarantee&nbsp;space&nbsp;for&nbsp;n&nbsp;more&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="2042338">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;index&nbsp;where&nbsp;bytes&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="2042393">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;can&#39;t&nbsp;grow&nbsp;it&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">80</span><span class="keyword" id="2042453">func</span>&nbsp;<span class="op" id="2042458">(</span><span class="ident" id="2042459">b</span>&nbsp;<span class="op" id="2042461">*</span><span class="ident" id="2042462">Buffer</span><span class="op" id="2042468">)</span>&nbsp;<span class="ident" id="2042470">grow</span><span class="op" id="2042474">(</span><span class="ident" id="2042475">n</span>&nbsp;<span class="builtintype" id="2042477">int</span><span class="op" id="2042480">)</span>&nbsp;<span class="builtintype" id="2042482">int</span>&nbsp;<span class="op" id="2042486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2042489">m</span>&nbsp;<span class="op" id="2042491">:=</span>&nbsp;<span class="ident" id="2042494">b</span><span class="op" id="2042495">.</span><span class="ident" id="2042496">Len</span><span class="op" id="2042499">(</span><span class="op" id="2042500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2042503">//&nbsp;If&nbsp;buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2042551">if</span>&nbsp;<span class="ident" id="2042554">m</span>&nbsp;<span class="op" id="2042556">==</span>&nbsp;<span class="num" id="2042559">0</span>&nbsp;<span class="op" id="2042561">&amp;&amp;</span>&nbsp;<span class="ident" id="2042564">b</span><span class="op" id="2042565">.</span><span class="ident" id="2042566">off</span>&nbsp;<span class="op" id="2042570">!=</span>&nbsp;<span class="num" id="2042573">0</span>&nbsp;<span class="op" id="2042575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2042579">b</span><span class="op" id="2042580">.</span><span class="ident" id="2042581">Truncate</span><span class="op" id="2042589">(</span><span class="num" id="2042590">0</span><span class="op" id="2042591">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2042594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2042597">if</span>&nbsp;<span class="builtinfunc" id="2042600">len</span><span class="op" id="2042603">(</span><span class="ident" id="2042604">b</span><span class="op" id="2042605">.</span><span class="ident" id="2042606">buf</span><span class="op" id="2042609">)</span><span class="op" id="2042610">+</span><span class="ident" id="2042611">n</span>&nbsp;<span class="op" id="2042613">&gt;</span>&nbsp;<span class="builtinfunc" id="2042615">cap</span><span class="op" id="2042618">(</span><span class="ident" id="2042619">b</span><span class="op" id="2042620">.</span><span class="ident" id="2042621">buf</span><span class="op" id="2042624">)</span>&nbsp;<span class="op" id="2042626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2042630">var</span>&nbsp;<span class="ident" id="2042634">buf</span>&nbsp;<span class="op" id="2042638">[</span><span class="op" id="2042639">]</span><span class="builtintype" id="2042640">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2042647">if</span>&nbsp;<span class="ident" id="2042650">b</span><span class="op" id="2042651">.</span><span class="ident" id="2042652">buf</span>&nbsp;<span class="op" id="2042656">==</span>&nbsp;<span class="ident" id="2042659">nil</span>&nbsp;<span class="op" id="2042663">&amp;&amp;</span>&nbsp;<span class="ident" id="2042666">n</span>&nbsp;<span class="op" id="2042668">&lt;=</span>&nbsp;<span class="builtinfunc" id="2042671">len</span><span class="op" id="2042674">(</span><span class="ident" id="2042675">b</span><span class="op" id="2042676">.</span><span class="ident" id="2042677">bootstrap</span><span class="op" id="2042686">)</span>&nbsp;<span class="op" id="2042688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2042693">buf</span>&nbsp;<span class="op" id="2042697">=</span>&nbsp;<span class="ident" id="2042699">b</span><span class="op" id="2042700">.</span><span class="ident" id="2042701">bootstrap</span><span class="op" id="2042710">[</span><span class="num" id="2042711">0</span><span class="op" id="2042712">:</span><span class="op" id="2042713">]</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2042717">}</span>&nbsp;<span class="keyword" id="2042719">else</span>&nbsp;<span class="keyword" id="2042724">if</span>&nbsp;<span class="ident" id="2042727">m</span><span class="op" id="2042728">+</span><span class="ident" id="2042729">n</span>&nbsp;<span class="op" id="2042731">&lt;=</span>&nbsp;<span class="builtinfunc" id="2042734">cap</span><span class="op" id="2042737">(</span><span class="ident" id="2042738">b</span><span class="op" id="2042739">.</span><span class="ident" id="2042740">buf</span><span class="op" id="2042743">)</span><span class="op" id="2042744">/</span><span class="num" id="2042745">2</span>&nbsp;<span class="op" id="2042747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2042752">//&nbsp;We&nbsp;can&nbsp;slide&nbsp;things&nbsp;down&nbsp;instead&nbsp;of&nbsp;allocating&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2042811">//&nbsp;slice.&nbsp;We&nbsp;only&nbsp;need&nbsp;m+n&nbsp;&lt;=&nbsp;cap(b.buf)&nbsp;to&nbsp;slide,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2042869">//&nbsp;we&nbsp;instead&nbsp;let&nbsp;capacity&nbsp;get&nbsp;twice&nbsp;as&nbsp;large&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2042924">//&nbsp;don&#39;t&nbsp;spend&nbsp;all&nbsp;our&nbsp;time&nbsp;copying.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2042964">copy</span><span class="op" id="2042968">(</span><span class="ident" id="2042969">b</span><span class="op" id="2042970">.</span><span class="ident" id="2042971">buf</span><span class="op" id="2042974">[</span><span class="op" id="2042975">:</span><span class="op" id="2042976">]</span><span class="op" id="2042977">,</span>&nbsp;<span class="ident" id="2042979">b</span><span class="op" id="2042980">.</span><span class="ident" id="2042981">buf</span><span class="op" id="2042984">[</span><span class="ident" id="2042985">b</span><span class="op" id="2042986">.</span><span class="ident" id="2042987">off</span><span class="op" id="2042990">:</span><span class="op" id="2042991">]</span><span class="op" id="2042992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2042997">buf</span>&nbsp;<span class="op" id="2043001">=</span>&nbsp;<span class="ident" id="2043003">b</span><span class="op" id="2043004">.</span><span class="ident" id="2043005">buf</span><span class="op" id="2043008">[</span><span class="op" id="2043009">:</span><span class="ident" id="2043010">m</span><span class="op" id="2043011">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2043015">}</span>&nbsp;<span class="keyword" id="2043017">else</span>&nbsp;<span class="op" id="2043022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2043027">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;anywhere</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2043059">buf</span>&nbsp;<span class="op" id="2043063">=</span>&nbsp;<span class="ident" id="2043065">makeSlice</span><span class="op" id="2043074">(</span><span class="num" id="2043075">2</span><span class="op" id="2043076">*</span><span class="builtinfunc" id="2043077">cap</span><span class="op" id="2043080">(</span><span class="ident" id="2043081">b</span><span class="op" id="2043082">.</span><span class="ident" id="2043083">buf</span><span class="op" id="2043086">)</span>&nbsp;<span class="op" id="2043088">+</span>&nbsp;<span class="ident" id="2043090">n</span><span class="op" id="2043091">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2043096">copy</span><span class="op" id="2043100">(</span><span class="ident" id="2043101">buf</span><span class="op" id="2043104">,</span>&nbsp;<span class="ident" id="2043106">b</span><span class="op" id="2043107">.</span><span class="ident" id="2043108">buf</span><span class="op" id="2043111">[</span><span class="ident" id="2043112">b</span><span class="op" id="2043113">.</span><span class="ident" id="2043114">off</span><span class="op" id="2043117">:</span><span class="op" id="2043118">]</span><span class="op" id="2043119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2043123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2043127">b</span><span class="op" id="2043128">.</span><span class="ident" id="2043129">buf</span>&nbsp;<span class="op" id="2043133">=</span>&nbsp;<span class="ident" id="2043135">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2043141">b</span><span class="op" id="2043142">.</span><span class="ident" id="2043143">off</span>&nbsp;<span class="op" id="2043147">=</span>&nbsp;<span class="num" id="2043149">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2043152">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2043155">b</span><span class="op" id="2043156">.</span><span class="ident" id="2043157">buf</span>&nbsp;<span class="op" id="2043161">=</span>&nbsp;<span class="ident" id="2043163">b</span><span class="op" id="2043164">.</span><span class="ident" id="2043165">buf</span><span class="op" id="2043168">[</span><span class="num" id="2043169">0</span>&nbsp;<span class="op" id="2043171">:</span>&nbsp;<span class="ident" id="2043173">b</span><span class="op" id="2043174">.</span><span class="ident" id="2043175">off</span><span class="op" id="2043178">+</span><span class="ident" id="2043179">m</span><span class="op" id="2043180">+</span><span class="ident" id="2043181">n</span><span class="op" id="2043182">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2043185">return</span>&nbsp;<span class="ident" id="2043192">b</span><span class="op" id="2043193">.</span><span class="ident" id="2043194">off</span>&nbsp;<span class="op" id="2043198">+</span>&nbsp;<span class="ident" id="2043200">m</span><br>
<span class="lineno"></span><span class="op" id="2043202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2043205">//&nbsp;Grow&nbsp;grows&nbsp;the&nbsp;buffer&#39;s&nbsp;capacity,&nbsp;if&nbsp;necessary,&nbsp;to&nbsp;guarantee&nbsp;space&nbsp;for</span><br>
<span class="lineno">110</span><span class="comment" id="2043279">//&nbsp;another&nbsp;n&nbsp;bytes.&nbsp;After&nbsp;Grow(n),&nbsp;at&nbsp;least&nbsp;n&nbsp;bytes&nbsp;can&nbsp;be&nbsp;written&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2043353">//&nbsp;buffer&nbsp;without&nbsp;another&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="comment" id="2043391">//&nbsp;If&nbsp;n&nbsp;is&nbsp;negative,&nbsp;Grow&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="comment" id="2043429">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;can&#39;t&nbsp;grow&nbsp;it&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="2043489">func</span>&nbsp;<span class="op" id="2043494">(</span><span class="ident" id="2043495">b</span>&nbsp;<span class="op" id="2043497">*</span><span class="ident" id="2043498">Buffer</span><span class="op" id="2043504">)</span>&nbsp;<span class="ident" id="2043506">Grow</span><span class="op" id="2043510">(</span><span class="ident" id="2043511">n</span>&nbsp;<span class="builtintype" id="2043513">int</span><span class="op" id="2043516">)</span>&nbsp;<span class="op" id="2043518">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2043521">if</span>&nbsp;<span class="ident" id="2043524">n</span>&nbsp;<span class="op" id="2043526">&lt;</span>&nbsp;<span class="num" id="2043528">0</span>&nbsp;<span class="op" id="2043530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2043534">panic</span><span class="op" id="2043539">(</span><span class="string" id="2043540">&#34;bytes.Buffer.Grow:&nbsp;negative&nbsp;count&#34;</span><span class="op" id="2043575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2043578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2043581">m</span>&nbsp;<span class="op" id="2043583">:=</span>&nbsp;<span class="ident" id="2043586">b</span><span class="op" id="2043587">.</span><span class="ident" id="2043588">grow</span><span class="op" id="2043592">(</span><span class="ident" id="2043593">n</span><span class="op" id="2043594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2043597">b</span><span class="op" id="2043598">.</span><span class="ident" id="2043599">buf</span>&nbsp;<span class="op" id="2043603">=</span>&nbsp;<span class="ident" id="2043605">b</span><span class="op" id="2043606">.</span><span class="ident" id="2043607">buf</span><span class="op" id="2043610">[</span><span class="num" id="2043611">0</span><span class="op" id="2043612">:</span><span class="ident" id="2043613">m</span><span class="op" id="2043614">]</span><br>
<span class="lineno">120</span><span class="op" id="2043616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2043619">//&nbsp;Write&nbsp;appends&nbsp;the&nbsp;contents&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="2043691">//&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;length&nbsp;of&nbsp;p;&nbsp;err&nbsp;is&nbsp;always&nbsp;nil.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2043767">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;Write&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">125</span><span class="keyword" id="2043831">func</span>&nbsp;<span class="op" id="2043836">(</span><span class="ident" id="2043837">b</span>&nbsp;<span class="op" id="2043839">*</span><span class="ident" id="2043840">Buffer</span><span class="op" id="2043846">)</span>&nbsp;<span class="ident" id="2043848">Write</span><span class="op" id="2043853">(</span><span class="ident" id="2043854">p</span>&nbsp;<span class="op" id="2043856">[</span><span class="op" id="2043857">]</span><span class="builtintype" id="2043858">byte</span><span class="op" id="2043862">)</span>&nbsp;<span class="op" id="2043864">(</span><span class="ident" id="2043865">n</span>&nbsp;<span class="builtintype" id="2043867">int</span><span class="op" id="2043870">,</span>&nbsp;<span class="ident" id="2043872">err</span>&nbsp;<span class="builtintype" id="2043876">error</span><span class="op" id="2043881">)</span>&nbsp;<span class="op" id="2043883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2043886">b</span><span class="op" id="2043887">.</span><span class="ident" id="2043888">lastRead</span>&nbsp;<span class="op" id="2043897">=</span>&nbsp;<span class="ident" id="2043899">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2043910">m</span>&nbsp;<span class="op" id="2043912">:=</span>&nbsp;<span class="ident" id="2043915">b</span><span class="op" id="2043916">.</span><span class="ident" id="2043917">grow</span><span class="op" id="2043921">(</span><span class="builtinfunc" id="2043922">len</span><span class="op" id="2043925">(</span><span class="ident" id="2043926">p</span><span class="op" id="2043927">)</span><span class="op" id="2043928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2043931">return</span>&nbsp;<span class="builtinfunc" id="2043938">copy</span><span class="op" id="2043942">(</span><span class="ident" id="2043943">b</span><span class="op" id="2043944">.</span><span class="ident" id="2043945">buf</span><span class="op" id="2043948">[</span><span class="ident" id="2043949">m</span><span class="op" id="2043950">:</span><span class="op" id="2043951">]</span><span class="op" id="2043952">,</span>&nbsp;<span class="ident" id="2043954">p</span><span class="op" id="2043955">)</span><span class="op" id="2043956">,</span>&nbsp;<span class="ident" id="2043958">nil</span><br>
<span class="lineno"></span><span class="op" id="2043962">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="2043965">//&nbsp;WriteString&nbsp;appends&nbsp;the&nbsp;contents&nbsp;of&nbsp;s&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="2044043">//&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;length&nbsp;of&nbsp;s;&nbsp;err&nbsp;is&nbsp;always&nbsp;nil.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2044119">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteString&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="2044189">func</span>&nbsp;<span class="op" id="2044194">(</span><span class="ident" id="2044195">b</span>&nbsp;<span class="op" id="2044197">*</span><span class="ident" id="2044198">Buffer</span><span class="op" id="2044204">)</span>&nbsp;<span class="ident" id="2044206">WriteString</span><span class="op" id="2044217">(</span><span class="ident" id="2044218">s</span>&nbsp;<span class="builtintype" id="2044220">string</span><span class="op" id="2044226">)</span>&nbsp;<span class="op" id="2044228">(</span><span class="ident" id="2044229">n</span>&nbsp;<span class="builtintype" id="2044231">int</span><span class="op" id="2044234">,</span>&nbsp;<span class="ident" id="2044236">err</span>&nbsp;<span class="builtintype" id="2044240">error</span><span class="op" id="2044245">)</span>&nbsp;<span class="op" id="2044247">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2044250">b</span><span class="op" id="2044251">.</span><span class="ident" id="2044252">lastRead</span>&nbsp;<span class="op" id="2044261">=</span>&nbsp;<span class="ident" id="2044263">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2044274">m</span>&nbsp;<span class="op" id="2044276">:=</span>&nbsp;<span class="ident" id="2044279">b</span><span class="op" id="2044280">.</span><span class="ident" id="2044281">grow</span><span class="op" id="2044285">(</span><span class="builtinfunc" id="2044286">len</span><span class="op" id="2044289">(</span><span class="ident" id="2044290">s</span><span class="op" id="2044291">)</span><span class="op" id="2044292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2044295">return</span>&nbsp;<span class="builtinfunc" id="2044302">copy</span><span class="op" id="2044306">(</span><span class="ident" id="2044307">b</span><span class="op" id="2044308">.</span><span class="ident" id="2044309">buf</span><span class="op" id="2044312">[</span><span class="ident" id="2044313">m</span><span class="op" id="2044314">:</span><span class="op" id="2044315">]</span><span class="op" id="2044316">,</span>&nbsp;<span class="ident" id="2044318">s</span><span class="op" id="2044319">)</span><span class="op" id="2044320">,</span>&nbsp;<span class="ident" id="2044322">nil</span><br>
<span class="lineno"></span><span class="op" id="2044326">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="2044329">//&nbsp;MinRead&nbsp;is&nbsp;the&nbsp;minimum&nbsp;slice&nbsp;size&nbsp;passed&nbsp;to&nbsp;a&nbsp;Read&nbsp;call&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="2044391">//&nbsp;Buffer.ReadFrom.&nbsp;&nbsp;As&nbsp;long&nbsp;as&nbsp;the&nbsp;Buffer&nbsp;has&nbsp;at&nbsp;least&nbsp;MinRead&nbsp;bytes&nbsp;beyond</span><br>
<span class="lineno"></span><span class="comment" id="2044468">//&nbsp;what&nbsp;is&nbsp;required&nbsp;to&nbsp;hold&nbsp;the&nbsp;contents&nbsp;of&nbsp;r,&nbsp;ReadFrom&nbsp;will&nbsp;not&nbsp;grow&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2044542">//&nbsp;underlying&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="2044564">const</span>&nbsp;<span class="ident" id="2044570">MinRead</span>&nbsp;<span class="op" id="2044578">=</span>&nbsp;<span class="num" id="2044580">512</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="2044585">//&nbsp;ReadFrom&nbsp;reads&nbsp;data&nbsp;from&nbsp;r&nbsp;until&nbsp;EOF&nbsp;and&nbsp;appends&nbsp;it&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing</span><br>
<span class="lineno"></span><span class="comment" id="2044663">//&nbsp;the&nbsp;buffer&nbsp;as&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="2044740">//&nbsp;error&nbsp;except&nbsp;io.EOF&nbsp;encountered&nbsp;during&nbsp;the&nbsp;read&nbsp;is&nbsp;also&nbsp;returned.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2044816">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;ReadFrom&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">150</span><span class="keyword" id="2044883">func</span>&nbsp;<span class="op" id="2044888">(</span><span class="ident" id="2044889">b</span>&nbsp;<span class="op" id="2044891">*</span><span class="ident" id="2044892">Buffer</span><span class="op" id="2044898">)</span>&nbsp;<span class="ident" id="2044900">ReadFrom</span><span class="op" id="2044908">(</span><span class="ident" id="2044909">r</span>&nbsp;<span class="ident" id="2044911">io</span><span class="op" id="2044913">.</span><span class="ident" id="2044914">Reader</span><span class="op" id="2044920">)</span>&nbsp;<span class="op" id="2044922">(</span><span class="ident" id="2044923">n</span>&nbsp;<span class="ident" id="2044925">int64</span><span class="op" id="2044930">,</span>&nbsp;<span class="ident" id="2044932">err</span>&nbsp;<span class="builtintype" id="2044936">error</span><span class="op" id="2044941">)</span>&nbsp;<span class="op" id="2044943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2044946">b</span><span class="op" id="2044947">.</span><span class="ident" id="2044948">lastRead</span>&nbsp;<span class="op" id="2044957">=</span>&nbsp;<span class="ident" id="2044959">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2044970">//&nbsp;If&nbsp;buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2045018">if</span>&nbsp;<span class="ident" id="2045021">b</span><span class="op" id="2045022">.</span><span class="ident" id="2045023">off</span>&nbsp;<span class="op" id="2045027">&gt;=</span>&nbsp;<span class="builtinfunc" id="2045030">len</span><span class="op" id="2045033">(</span><span class="ident" id="2045034">b</span><span class="op" id="2045035">.</span><span class="ident" id="2045036">buf</span><span class="op" id="2045039">)</span>&nbsp;<span class="op" id="2045041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2045045">b</span><span class="op" id="2045046">.</span><span class="ident" id="2045047">Truncate</span><span class="op" id="2045055">(</span><span class="num" id="2045056">0</span><span class="op" id="2045057">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2045060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2045063">for</span>&nbsp;<span class="op" id="2045067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2045071">if</span>&nbsp;<span class="ident" id="2045074">free</span>&nbsp;<span class="op" id="2045079">:=</span>&nbsp;<span class="builtinfunc" id="2045082">cap</span><span class="op" id="2045085">(</span><span class="ident" id="2045086">b</span><span class="op" id="2045087">.</span><span class="ident" id="2045088">buf</span><span class="op" id="2045091">)</span>&nbsp;<span class="op" id="2045093">-</span>&nbsp;<span class="builtinfunc" id="2045095">len</span><span class="op" id="2045098">(</span><span class="ident" id="2045099">b</span><span class="op" id="2045100">.</span><span class="ident" id="2045101">buf</span><span class="op" id="2045104">)</span><span class="op" id="2045105">;</span>&nbsp;<span class="ident" id="2045107">free</span>&nbsp;<span class="op" id="2045112">&lt;</span>&nbsp;<span class="ident" id="2045114">MinRead</span>&nbsp;<span class="op" id="2045122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2045127">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;at&nbsp;end</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2045157">newBuf</span>&nbsp;<span class="op" id="2045164">:=</span>&nbsp;<span class="ident" id="2045167">b</span><span class="op" id="2045168">.</span><span class="ident" id="2045169">buf</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2045176">if</span>&nbsp;<span class="ident" id="2045179">b</span><span class="op" id="2045180">.</span><span class="ident" id="2045181">off</span><span class="op" id="2045184">+</span><span class="ident" id="2045185">free</span>&nbsp;<span class="op" id="2045190">&lt;</span>&nbsp;<span class="ident" id="2045192">MinRead</span>&nbsp;<span class="op" id="2045200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2045206">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;using&nbsp;beginning&nbsp;of&nbsp;buffer;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2045257">//&nbsp;double&nbsp;buffer&nbsp;capacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2045287">newBuf</span>&nbsp;<span class="op" id="2045294">=</span>&nbsp;<span class="ident" id="2045296">makeSlice</span><span class="op" id="2045305">(</span><span class="num" id="2045306">2</span><span class="op" id="2045307">*</span><span class="builtinfunc" id="2045308">cap</span><span class="op" id="2045311">(</span><span class="ident" id="2045312">b</span><span class="op" id="2045313">.</span><span class="ident" id="2045314">buf</span><span class="op" id="2045317">)</span>&nbsp;<span class="op" id="2045319">+</span>&nbsp;<span class="ident" id="2045321">MinRead</span><span class="op" id="2045328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2045333">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2045338">copy</span><span class="op" id="2045342">(</span><span class="ident" id="2045343">newBuf</span><span class="op" id="2045349">,</span>&nbsp;<span class="ident" id="2045351">b</span><span class="op" id="2045352">.</span><span class="ident" id="2045353">buf</span><span class="op" id="2045356">[</span><span class="ident" id="2045357">b</span><span class="op" id="2045358">.</span><span class="ident" id="2045359">off</span><span class="op" id="2045362">:</span><span class="op" id="2045363">]</span><span class="op" id="2045364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2045369">b</span><span class="op" id="2045370">.</span><span class="ident" id="2045371">buf</span>&nbsp;<span class="op" id="2045375">=</span>&nbsp;<span class="ident" id="2045377">newBuf</span><span class="op" id="2045383">[</span><span class="op" id="2045384">:</span><span class="builtinfunc" id="2045385">len</span><span class="op" id="2045388">(</span><span class="ident" id="2045389">b</span><span class="op" id="2045390">.</span><span class="ident" id="2045391">buf</span><span class="op" id="2045394">)</span><span class="op" id="2045395">-</span><span class="ident" id="2045396">b</span><span class="op" id="2045397">.</span><span class="ident" id="2045398">off</span><span class="op" id="2045401">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2045406">b</span><span class="op" id="2045407">.</span><span class="ident" id="2045408">off</span>&nbsp;<span class="op" id="2045412">=</span>&nbsp;<span class="num" id="2045414">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2045418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2045422">m</span><span class="op" id="2045423">,</span>&nbsp;<span class="ident" id="2045425">e</span>&nbsp;<span class="op" id="2045427">:=</span>&nbsp;<span class="ident" id="2045430">r</span><span class="op" id="2045431">.</span><span class="ident" id="2045432">Read</span><span class="op" id="2045436">(</span><span class="ident" id="2045437">b</span><span class="op" id="2045438">.</span><span class="ident" id="2045439">buf</span><span class="op" id="2045442">[</span><span class="builtinfunc" id="2045443">len</span><span class="op" id="2045446">(</span><span class="ident" id="2045447">b</span><span class="op" id="2045448">.</span><span class="ident" id="2045449">buf</span><span class="op" id="2045452">)</span><span class="op" id="2045453">:</span><span class="builtinfunc" id="2045454">cap</span><span class="op" id="2045457">(</span><span class="ident" id="2045458">b</span><span class="op" id="2045459">.</span><span class="ident" id="2045460">buf</span><span class="op" id="2045463">)</span><span class="op" id="2045464">]</span><span class="op" id="2045465">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2045469">b</span><span class="op" id="2045470">.</span><span class="ident" id="2045471">buf</span>&nbsp;<span class="op" id="2045475">=</span>&nbsp;<span class="ident" id="2045477">b</span><span class="op" id="2045478">.</span><span class="ident" id="2045479">buf</span><span class="op" id="2045482">[</span><span class="num" id="2045483">0</span>&nbsp;<span class="op" id="2045485">:</span>&nbsp;<span class="builtinfunc" id="2045487">len</span><span class="op" id="2045490">(</span><span class="ident" id="2045491">b</span><span class="op" id="2045492">.</span><span class="ident" id="2045493">buf</span><span class="op" id="2045496">)</span><span class="op" id="2045497">+</span><span class="ident" id="2045498">m</span><span class="op" id="2045499">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2045503">n</span>&nbsp;<span class="op" id="2045505">+=</span>&nbsp;<span class="ident" id="2045508">int64</span><span class="op" id="2045513">(</span><span class="ident" id="2045514">m</span><span class="op" id="2045515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2045519">if</span>&nbsp;<span class="ident" id="2045522">e</span>&nbsp;<span class="op" id="2045524">==</span>&nbsp;<span class="ident" id="2045527">io</span><span class="op" id="2045529">.</span><span class="ident" id="2045530">EOF</span>&nbsp;<span class="op" id="2045534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2045539">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2045547">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2045551">if</span>&nbsp;<span class="ident" id="2045554">e</span>&nbsp;<span class="op" id="2045556">!=</span>&nbsp;<span class="ident" id="2045559">nil</span>&nbsp;<span class="op" id="2045563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2045568">return</span>&nbsp;<span class="ident" id="2045575">n</span><span class="op" id="2045576">,</span>&nbsp;<span class="ident" id="2045578">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2045582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2045585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2045588">return</span>&nbsp;<span class="ident" id="2045595">n</span><span class="op" id="2045596">,</span>&nbsp;<span class="ident" id="2045598">nil</span>&nbsp;<span class="comment" id="2045602">//&nbsp;err&nbsp;is&nbsp;EOF,&nbsp;so&nbsp;return&nbsp;nil&nbsp;explicitly</span><br>
<span class="lineno">180</span><span class="op" id="2045642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2045645">//&nbsp;makeSlice&nbsp;allocates&nbsp;a&nbsp;slice&nbsp;of&nbsp;size&nbsp;n.&nbsp;If&nbsp;the&nbsp;allocation&nbsp;fails,&nbsp;it&nbsp;panics</span><br>
<span class="lineno"></span><span class="comment" id="2045722">//&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="2045743">func</span>&nbsp;<span class="ident" id="2045748">makeSlice</span><span class="op" id="2045757">(</span><span class="ident" id="2045758">n</span>&nbsp;<span class="builtintype" id="2045760">int</span><span class="op" id="2045763">)</span>&nbsp;<span class="op" id="2045765">[</span><span class="op" id="2045766">]</span><span class="builtintype" id="2045767">byte</span>&nbsp;<span class="op" id="2045772">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2045775">//&nbsp;If&nbsp;the&nbsp;make&nbsp;fails,&nbsp;give&nbsp;a&nbsp;known&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2045818">defer</span>&nbsp;<span class="keyword" id="2045824">func</span><span class="op" id="2045828">(</span><span class="op" id="2045829">)</span>&nbsp;<span class="op" id="2045831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2045835">if</span>&nbsp;<span class="builtinfunc" id="2045838">recover</span><span class="op" id="2045845">(</span><span class="op" id="2045846">)</span>&nbsp;<span class="op" id="2045848">!=</span>&nbsp;<span class="ident" id="2045851">nil</span>&nbsp;<span class="op" id="2045855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2045860">panic</span><span class="op" id="2045865">(</span><span class="ident" id="2045866">ErrTooLarge</span><span class="op" id="2045877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2045881">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2045884">}</span><span class="op" id="2045885">(</span><span class="op" id="2045886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2045889">return</span>&nbsp;<span class="builtinfunc" id="2045896">make</span><span class="op" id="2045900">(</span><span class="op" id="2045901">[</span><span class="op" id="2045902">]</span><span class="builtintype" id="2045903">byte</span><span class="op" id="2045907">,</span>&nbsp;<span class="ident" id="2045909">n</span><span class="op" id="2045910">)</span><br>
<span class="lineno"></span><span class="op" id="2045912">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2045915">//&nbsp;WriteTo&nbsp;writes&nbsp;data&nbsp;to&nbsp;w&nbsp;until&nbsp;the&nbsp;buffer&nbsp;is&nbsp;drained&nbsp;or&nbsp;an&nbsp;error&nbsp;occurs.</span><br>
<span class="lineno">195</span><span class="comment" id="2045991">//&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written;&nbsp;it&nbsp;always&nbsp;fits&nbsp;into&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="2046068">//&nbsp;int,&nbsp;but&nbsp;it&nbsp;is&nbsp;int64&nbsp;to&nbsp;match&nbsp;the&nbsp;io.WriterTo&nbsp;interface.&nbsp;Any&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="2046138">//&nbsp;encountered&nbsp;during&nbsp;the&nbsp;write&nbsp;is&nbsp;also&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="2046188">func</span>&nbsp;<span class="op" id="2046193">(</span><span class="ident" id="2046194">b</span>&nbsp;<span class="op" id="2046196">*</span><span class="ident" id="2046197">Buffer</span><span class="op" id="2046203">)</span>&nbsp;<span class="ident" id="2046205">WriteTo</span><span class="op" id="2046212">(</span><span class="ident" id="2046213">w</span>&nbsp;<span class="ident" id="2046215">io</span><span class="op" id="2046217">.</span><span class="ident" id="2046218">Writer</span><span class="op" id="2046224">)</span>&nbsp;<span class="op" id="2046226">(</span><span class="ident" id="2046227">n</span>&nbsp;<span class="ident" id="2046229">int64</span><span class="op" id="2046234">,</span>&nbsp;<span class="ident" id="2046236">err</span>&nbsp;<span class="builtintype" id="2046240">error</span><span class="op" id="2046245">)</span>&nbsp;<span class="op" id="2046247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2046250">b</span><span class="op" id="2046251">.</span><span class="ident" id="2046252">lastRead</span>&nbsp;<span class="op" id="2046261">=</span>&nbsp;<span class="ident" id="2046263">opInvalid</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2046274">if</span>&nbsp;<span class="ident" id="2046277">b</span><span class="op" id="2046278">.</span><span class="ident" id="2046279">off</span>&nbsp;<span class="op" id="2046283">&lt;</span>&nbsp;<span class="builtinfunc" id="2046285">len</span><span class="op" id="2046288">(</span><span class="ident" id="2046289">b</span><span class="op" id="2046290">.</span><span class="ident" id="2046291">buf</span><span class="op" id="2046294">)</span>&nbsp;<span class="op" id="2046296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2046300">nBytes</span>&nbsp;<span class="op" id="2046307">:=</span>&nbsp;<span class="ident" id="2046310">b</span><span class="op" id="2046311">.</span><span class="ident" id="2046312">Len</span><span class="op" id="2046315">(</span><span class="op" id="2046316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2046320">m</span><span class="op" id="2046321">,</span>&nbsp;<span class="ident" id="2046323">e</span>&nbsp;<span class="op" id="2046325">:=</span>&nbsp;<span class="ident" id="2046328">w</span><span class="op" id="2046329">.</span><span class="ident" id="2046330">Write</span><span class="op" id="2046335">(</span><span class="ident" id="2046336">b</span><span class="op" id="2046337">.</span><span class="ident" id="2046338">buf</span><span class="op" id="2046341">[</span><span class="ident" id="2046342">b</span><span class="op" id="2046343">.</span><span class="ident" id="2046344">off</span><span class="op" id="2046347">:</span><span class="op" id="2046348">]</span><span class="op" id="2046349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2046353">if</span>&nbsp;<span class="ident" id="2046356">m</span>&nbsp;<span class="op" id="2046358">&gt;</span>&nbsp;<span class="ident" id="2046360">nBytes</span>&nbsp;<span class="op" id="2046367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2046372">panic</span><span class="op" id="2046377">(</span><span class="string" id="2046378">&#34;bytes.Buffer.WriteTo:&nbsp;invalid&nbsp;Write&nbsp;count&#34;</span><span class="op" id="2046421">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2046425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2046429">b</span><span class="op" id="2046430">.</span><span class="ident" id="2046431">off</span>&nbsp;<span class="op" id="2046435">+=</span>&nbsp;<span class="ident" id="2046438">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2046442">n</span>&nbsp;<span class="op" id="2046444">=</span>&nbsp;<span class="ident" id="2046446">int64</span><span class="op" id="2046451">(</span><span class="ident" id="2046452">m</span><span class="op" id="2046453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2046457">if</span>&nbsp;<span class="ident" id="2046460">e</span>&nbsp;<span class="op" id="2046462">!=</span>&nbsp;<span class="ident" id="2046465">nil</span>&nbsp;<span class="op" id="2046469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2046474">return</span>&nbsp;<span class="ident" id="2046481">n</span><span class="op" id="2046482">,</span>&nbsp;<span class="ident" id="2046484">e</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2046488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2046492">//&nbsp;all&nbsp;bytes&nbsp;should&nbsp;have&nbsp;been&nbsp;written,&nbsp;by&nbsp;definition&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2046550">//&nbsp;Write&nbsp;method&nbsp;in&nbsp;io.Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2046581">if</span>&nbsp;<span class="ident" id="2046584">m</span>&nbsp;<span class="op" id="2046586">!=</span>&nbsp;<span class="ident" id="2046589">nBytes</span>&nbsp;<span class="op" id="2046596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2046601">return</span>&nbsp;<span class="ident" id="2046608">n</span><span class="op" id="2046609">,</span>&nbsp;<span class="ident" id="2046611">io</span><span class="op" id="2046613">.</span><span class="ident" id="2046614">ErrShortWrite</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2046630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2046633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2046636">//&nbsp;Buffer&nbsp;is&nbsp;now&nbsp;empty;&nbsp;reset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2046668">b</span><span class="op" id="2046669">.</span><span class="ident" id="2046670">Truncate</span><span class="op" id="2046678">(</span><span class="num" id="2046679">0</span><span class="op" id="2046680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2046683">return</span><br>
<span class="lineno">220</span><span class="op" id="2046690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2046693">//&nbsp;WriteByte&nbsp;appends&nbsp;the&nbsp;byte&nbsp;c&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span><span class="comment" id="2046770">//&nbsp;The&nbsp;returned&nbsp;error&nbsp;is&nbsp;always&nbsp;nil,&nbsp;but&nbsp;is&nbsp;included&nbsp;to&nbsp;match&nbsp;bufio.Writer&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="2046847">//&nbsp;WriteByte.&nbsp;If&nbsp;the&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteByte&nbsp;will&nbsp;panic&nbsp;with</span><br>
<span class="lineno">225</span><span class="comment" id="2046920">//&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="2046936">func</span>&nbsp;<span class="op" id="2046941">(</span><span class="ident" id="2046942">b</span>&nbsp;<span class="op" id="2046944">*</span><span class="ident" id="2046945">Buffer</span><span class="op" id="2046951">)</span>&nbsp;<span class="ident" id="2046953">WriteByte</span><span class="op" id="2046962">(</span><span class="ident" id="2046963">c</span>&nbsp;<span class="builtintype" id="2046965">byte</span><span class="op" id="2046969">)</span>&nbsp;<span class="builtintype" id="2046971">error</span>&nbsp;<span class="op" id="2046977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2046980">b</span><span class="op" id="2046981">.</span><span class="ident" id="2046982">lastRead</span>&nbsp;<span class="op" id="2046991">=</span>&nbsp;<span class="ident" id="2046993">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2047004">m</span>&nbsp;<span class="op" id="2047006">:=</span>&nbsp;<span class="ident" id="2047009">b</span><span class="op" id="2047010">.</span><span class="ident" id="2047011">grow</span><span class="op" id="2047015">(</span><span class="num" id="2047016">1</span><span class="op" id="2047017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2047020">b</span><span class="op" id="2047021">.</span><span class="ident" id="2047022">buf</span><span class="op" id="2047025">[</span><span class="ident" id="2047026">m</span><span class="op" id="2047027">]</span>&nbsp;<span class="op" id="2047029">=</span>&nbsp;<span class="ident" id="2047031">c</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2047034">return</span>&nbsp;<span class="ident" id="2047041">nil</span><br>
<span class="lineno"></span><span class="op" id="2047045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2047048">//&nbsp;WriteRune&nbsp;appends&nbsp;the&nbsp;UTF-8&nbsp;encoding&nbsp;of&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;r&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2047119">//&nbsp;buffer,&nbsp;returning&nbsp;its&nbsp;length&nbsp;and&nbsp;an&nbsp;error,&nbsp;which&nbsp;is&nbsp;always&nbsp;nil&nbsp;but&nbsp;is</span><br>
<span class="lineno">235</span><span class="comment" id="2047192">//&nbsp;included&nbsp;to&nbsp;match&nbsp;bufio.Writer&#39;s&nbsp;WriteRune.&nbsp;The&nbsp;buffer&nbsp;is&nbsp;grown&nbsp;as&nbsp;needed;</span><br>
<span class="lineno"></span><span class="comment" id="2047270">//&nbsp;if&nbsp;it&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteRune&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="2047337">func</span>&nbsp;<span class="op" id="2047342">(</span><span class="ident" id="2047343">b</span>&nbsp;<span class="op" id="2047345">*</span><span class="ident" id="2047346">Buffer</span><span class="op" id="2047352">)</span>&nbsp;<span class="ident" id="2047354">WriteRune</span><span class="op" id="2047363">(</span><span class="ident" id="2047364">r</span>&nbsp;<span class="builtintype" id="2047366">rune</span><span class="op" id="2047370">)</span>&nbsp;<span class="op" id="2047372">(</span><span class="ident" id="2047373">n</span>&nbsp;<span class="builtintype" id="2047375">int</span><span class="op" id="2047378">,</span>&nbsp;<span class="ident" id="2047380">err</span>&nbsp;<span class="builtintype" id="2047384">error</span><span class="op" id="2047389">)</span>&nbsp;<span class="op" id="2047391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2047394">if</span>&nbsp;<span class="ident" id="2047397">r</span>&nbsp;<span class="op" id="2047399">&lt;</span>&nbsp;<span class="ident" id="2047401">utf8</span><span class="op" id="2047405">.</span><span class="ident" id="2047406">RuneSelf</span>&nbsp;<span class="op" id="2047415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2047419">b</span><span class="op" id="2047420">.</span><span class="ident" id="2047421">WriteByte</span><span class="op" id="2047430">(</span><span class="builtintype" id="2047431">byte</span><span class="op" id="2047435">(</span><span class="ident" id="2047436">r</span><span class="op" id="2047437">)</span><span class="op" id="2047438">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2047442">return</span>&nbsp;<span class="num" id="2047449">1</span><span class="op" id="2047450">,</span>&nbsp;<span class="ident" id="2047452">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2047457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2047460">n</span>&nbsp;<span class="op" id="2047462">=</span>&nbsp;<span class="ident" id="2047464">utf8</span><span class="op" id="2047468">.</span><span class="ident" id="2047469">EncodeRune</span><span class="op" id="2047479">(</span><span class="ident" id="2047480">b</span><span class="op" id="2047481">.</span><span class="ident" id="2047482">runeBytes</span><span class="op" id="2047491">[</span><span class="num" id="2047492">0</span><span class="op" id="2047493">:</span><span class="op" id="2047494">]</span><span class="op" id="2047495">,</span>&nbsp;<span class="ident" id="2047497">r</span><span class="op" id="2047498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2047501">b</span><span class="op" id="2047502">.</span><span class="ident" id="2047503">Write</span><span class="op" id="2047508">(</span><span class="ident" id="2047509">b</span><span class="op" id="2047510">.</span><span class="ident" id="2047511">runeBytes</span><span class="op" id="2047520">[</span><span class="num" id="2047521">0</span><span class="op" id="2047522">:</span><span class="ident" id="2047523">n</span><span class="op" id="2047524">]</span><span class="op" id="2047525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2047528">return</span>&nbsp;<span class="ident" id="2047535">n</span><span class="op" id="2047536">,</span>&nbsp;<span class="ident" id="2047538">nil</span><br>
<span class="lineno">245</span><span class="op" id="2047542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2047545">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;next&nbsp;len(p)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer&nbsp;or&nbsp;until&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span><span class="comment" id="2047617">//&nbsp;is&nbsp;drained.&nbsp;&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read.&nbsp;&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2047689">//&nbsp;buffer&nbsp;has&nbsp;no&nbsp;data&nbsp;to&nbsp;return,&nbsp;err&nbsp;is&nbsp;io.EOF&nbsp;(unless&nbsp;len(p)&nbsp;is&nbsp;zero);</span><br>
<span class="lineno">250</span><span class="comment" id="2047761">//&nbsp;otherwise&nbsp;it&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="2047785">func</span>&nbsp;<span class="op" id="2047790">(</span><span class="ident" id="2047791">b</span>&nbsp;<span class="op" id="2047793">*</span><span class="ident" id="2047794">Buffer</span><span class="op" id="2047800">)</span>&nbsp;<span class="ident" id="2047802">Read</span><span class="op" id="2047806">(</span><span class="ident" id="2047807">p</span>&nbsp;<span class="op" id="2047809">[</span><span class="op" id="2047810">]</span><span class="builtintype" id="2047811">byte</span><span class="op" id="2047815">)</span>&nbsp;<span class="op" id="2047817">(</span><span class="ident" id="2047818">n</span>&nbsp;<span class="builtintype" id="2047820">int</span><span class="op" id="2047823">,</span>&nbsp;<span class="ident" id="2047825">err</span>&nbsp;<span class="builtintype" id="2047829">error</span><span class="op" id="2047834">)</span>&nbsp;<span class="op" id="2047836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2047839">b</span><span class="op" id="2047840">.</span><span class="ident" id="2047841">lastRead</span>&nbsp;<span class="op" id="2047850">=</span>&nbsp;<span class="ident" id="2047852">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2047863">if</span>&nbsp;<span class="ident" id="2047866">b</span><span class="op" id="2047867">.</span><span class="ident" id="2047868">off</span>&nbsp;<span class="op" id="2047872">&gt;=</span>&nbsp;<span class="builtinfunc" id="2047875">len</span><span class="op" id="2047878">(</span><span class="ident" id="2047879">b</span><span class="op" id="2047880">.</span><span class="ident" id="2047881">buf</span><span class="op" id="2047884">)</span>&nbsp;<span class="op" id="2047886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2047890">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2047936">b</span><span class="op" id="2047937">.</span><span class="ident" id="2047938">Truncate</span><span class="op" id="2047946">(</span><span class="num" id="2047947">0</span><span class="op" id="2047948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2047952">if</span>&nbsp;<span class="builtinfunc" id="2047955">len</span><span class="op" id="2047958">(</span><span class="ident" id="2047959">p</span><span class="op" id="2047960">)</span>&nbsp;<span class="op" id="2047962">==</span>&nbsp;<span class="num" id="2047965">0</span>&nbsp;<span class="op" id="2047967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2047972">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2047981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2047985">return</span>&nbsp;<span class="num" id="2047992">0</span><span class="op" id="2047993">,</span>&nbsp;<span class="ident" id="2047995">io</span><span class="op" id="2047997">.</span><span class="ident" id="2047998">EOF</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2048003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2048006">n</span>&nbsp;<span class="op" id="2048008">=</span>&nbsp;<span class="builtinfunc" id="2048010">copy</span><span class="op" id="2048014">(</span><span class="ident" id="2048015">p</span><span class="op" id="2048016">,</span>&nbsp;<span class="ident" id="2048018">b</span><span class="op" id="2048019">.</span><span class="ident" id="2048020">buf</span><span class="op" id="2048023">[</span><span class="ident" id="2048024">b</span><span class="op" id="2048025">.</span><span class="ident" id="2048026">off</span><span class="op" id="2048029">:</span><span class="op" id="2048030">]</span><span class="op" id="2048031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2048034">b</span><span class="op" id="2048035">.</span><span class="ident" id="2048036">off</span>&nbsp;<span class="op" id="2048040">+=</span>&nbsp;<span class="ident" id="2048043">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2048046">if</span>&nbsp;<span class="ident" id="2048049">n</span>&nbsp;<span class="op" id="2048051">&gt;</span>&nbsp;<span class="num" id="2048053">0</span>&nbsp;<span class="op" id="2048055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2048059">b</span><span class="op" id="2048060">.</span><span class="ident" id="2048061">lastRead</span>&nbsp;<span class="op" id="2048070">=</span>&nbsp;<span class="ident" id="2048072">opRead</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2048080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2048083">return</span><br>
<span class="lineno"></span><span class="op" id="2048090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2048093">//&nbsp;Next&nbsp;returns&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;next&nbsp;n&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer,</span><br>
<span class="lineno">270</span><span class="comment" id="2048162">//&nbsp;advancing&nbsp;the&nbsp;buffer&nbsp;as&nbsp;if&nbsp;the&nbsp;bytes&nbsp;had&nbsp;been&nbsp;returned&nbsp;by&nbsp;Read.</span><br>
<span class="lineno"></span><span class="comment" id="2048229">//&nbsp;If&nbsp;there&nbsp;are&nbsp;fewer&nbsp;than&nbsp;n&nbsp;bytes&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;Next&nbsp;returns&nbsp;the&nbsp;entire&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="2048311">//&nbsp;The&nbsp;slice&nbsp;is&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;a&nbsp;read&nbsp;or&nbsp;write&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="2048385">func</span>&nbsp;<span class="op" id="2048390">(</span><span class="ident" id="2048391">b</span>&nbsp;<span class="op" id="2048393">*</span><span class="ident" id="2048394">Buffer</span><span class="op" id="2048400">)</span>&nbsp;<span class="ident" id="2048402">Next</span><span class="op" id="2048406">(</span><span class="ident" id="2048407">n</span>&nbsp;<span class="builtintype" id="2048409">int</span><span class="op" id="2048412">)</span>&nbsp;<span class="op" id="2048414">[</span><span class="op" id="2048415">]</span><span class="builtintype" id="2048416">byte</span>&nbsp;<span class="op" id="2048421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2048424">b</span><span class="op" id="2048425">.</span><span class="ident" id="2048426">lastRead</span>&nbsp;<span class="op" id="2048435">=</span>&nbsp;<span class="ident" id="2048437">opInvalid</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2048448">m</span>&nbsp;<span class="op" id="2048450">:=</span>&nbsp;<span class="ident" id="2048453">b</span><span class="op" id="2048454">.</span><span class="ident" id="2048455">Len</span><span class="op" id="2048458">(</span><span class="op" id="2048459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2048462">if</span>&nbsp;<span class="ident" id="2048465">n</span>&nbsp;<span class="op" id="2048467">&gt;</span>&nbsp;<span class="ident" id="2048469">m</span>&nbsp;<span class="op" id="2048471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2048475">n</span>&nbsp;<span class="op" id="2048477">=</span>&nbsp;<span class="ident" id="2048479">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2048482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2048485">data</span>&nbsp;<span class="op" id="2048490">:=</span>&nbsp;<span class="ident" id="2048493">b</span><span class="op" id="2048494">.</span><span class="ident" id="2048495">buf</span><span class="op" id="2048498">[</span><span class="ident" id="2048499">b</span><span class="op" id="2048500">.</span><span class="ident" id="2048501">off</span>&nbsp;<span class="op" id="2048505">:</span>&nbsp;<span class="ident" id="2048507">b</span><span class="op" id="2048508">.</span><span class="ident" id="2048509">off</span><span class="op" id="2048512">+</span><span class="ident" id="2048513">n</span><span class="op" id="2048514">]</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2048517">b</span><span class="op" id="2048518">.</span><span class="ident" id="2048519">off</span>&nbsp;<span class="op" id="2048523">+=</span>&nbsp;<span class="ident" id="2048526">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2048529">if</span>&nbsp;<span class="ident" id="2048532">n</span>&nbsp;<span class="op" id="2048534">&gt;</span>&nbsp;<span class="num" id="2048536">0</span>&nbsp;<span class="op" id="2048538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2048542">b</span><span class="op" id="2048543">.</span><span class="ident" id="2048544">lastRead</span>&nbsp;<span class="op" id="2048553">=</span>&nbsp;<span class="ident" id="2048555">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2048563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2048566">return</span>&nbsp;<span class="ident" id="2048573">data</span><br>
<span class="lineno">285</span><span class="op" id="2048578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2048581">//&nbsp;ReadByte&nbsp;reads&nbsp;and&nbsp;returns&nbsp;the&nbsp;next&nbsp;byte&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="2048642">//&nbsp;If&nbsp;no&nbsp;byte&nbsp;is&nbsp;available,&nbsp;it&nbsp;returns&nbsp;error&nbsp;io.EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="2048695">func</span>&nbsp;<span class="op" id="2048700">(</span><span class="ident" id="2048701">b</span>&nbsp;<span class="op" id="2048703">*</span><span class="ident" id="2048704">Buffer</span><span class="op" id="2048710">)</span>&nbsp;<span class="ident" id="2048712">ReadByte</span><span class="op" id="2048720">(</span><span class="op" id="2048721">)</span>&nbsp;<span class="op" id="2048723">(</span><span class="ident" id="2048724">c</span>&nbsp;<span class="builtintype" id="2048726">byte</span><span class="op" id="2048730">,</span>&nbsp;<span class="ident" id="2048732">err</span>&nbsp;<span class="builtintype" id="2048736">error</span><span class="op" id="2048741">)</span>&nbsp;<span class="op" id="2048743">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2048746">b</span><span class="op" id="2048747">.</span><span class="ident" id="2048748">lastRead</span>&nbsp;<span class="op" id="2048757">=</span>&nbsp;<span class="ident" id="2048759">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2048770">if</span>&nbsp;<span class="ident" id="2048773">b</span><span class="op" id="2048774">.</span><span class="ident" id="2048775">off</span>&nbsp;<span class="op" id="2048779">&gt;=</span>&nbsp;<span class="builtinfunc" id="2048782">len</span><span class="op" id="2048785">(</span><span class="ident" id="2048786">b</span><span class="op" id="2048787">.</span><span class="ident" id="2048788">buf</span><span class="op" id="2048791">)</span>&nbsp;<span class="op" id="2048793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2048797">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2048843">b</span><span class="op" id="2048844">.</span><span class="ident" id="2048845">Truncate</span><span class="op" id="2048853">(</span><span class="num" id="2048854">0</span><span class="op" id="2048855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2048859">return</span>&nbsp;<span class="num" id="2048866">0</span><span class="op" id="2048867">,</span>&nbsp;<span class="ident" id="2048869">io</span><span class="op" id="2048871">.</span><span class="ident" id="2048872">EOF</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2048877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2048880">c</span>&nbsp;<span class="op" id="2048882">=</span>&nbsp;<span class="ident" id="2048884">b</span><span class="op" id="2048885">.</span><span class="ident" id="2048886">buf</span><span class="op" id="2048889">[</span><span class="ident" id="2048890">b</span><span class="op" id="2048891">.</span><span class="ident" id="2048892">off</span><span class="op" id="2048895">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2048898">b</span><span class="op" id="2048899">.</span><span class="ident" id="2048900">off</span><span class="op" id="2048903">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2048907">b</span><span class="op" id="2048908">.</span><span class="ident" id="2048909">lastRead</span>&nbsp;<span class="op" id="2048918">=</span>&nbsp;<span class="ident" id="2048920">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2048928">return</span>&nbsp;<span class="ident" id="2048935">c</span><span class="op" id="2048936">,</span>&nbsp;<span class="ident" id="2048938">nil</span><br>
<span class="lineno">300</span><span class="op" id="2048942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2048945">//&nbsp;ReadRune&nbsp;reads&nbsp;and&nbsp;returns&nbsp;the&nbsp;next&nbsp;UTF-8-encoded</span><br>
<span class="lineno"></span><span class="comment" id="2048998">//&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="2049037">//&nbsp;If&nbsp;no&nbsp;bytes&nbsp;are&nbsp;available,&nbsp;the&nbsp;error&nbsp;returned&nbsp;is&nbsp;io.EOF.</span><br>
<span class="lineno">305</span><span class="comment" id="2049097">//&nbsp;If&nbsp;the&nbsp;bytes&nbsp;are&nbsp;an&nbsp;erroneous&nbsp;UTF-8&nbsp;encoding,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="2049149">//&nbsp;consumes&nbsp;one&nbsp;byte&nbsp;and&nbsp;returns&nbsp;U+FFFD,&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="2049193">func</span>&nbsp;<span class="op" id="2049198">(</span><span class="ident" id="2049199">b</span>&nbsp;<span class="op" id="2049201">*</span><span class="ident" id="2049202">Buffer</span><span class="op" id="2049208">)</span>&nbsp;<span class="ident" id="2049210">ReadRune</span><span class="op" id="2049218">(</span><span class="op" id="2049219">)</span>&nbsp;<span class="op" id="2049221">(</span><span class="ident" id="2049222">r</span>&nbsp;<span class="builtintype" id="2049224">rune</span><span class="op" id="2049228">,</span>&nbsp;<span class="ident" id="2049230">size</span>&nbsp;<span class="builtintype" id="2049235">int</span><span class="op" id="2049238">,</span>&nbsp;<span class="ident" id="2049240">err</span>&nbsp;<span class="builtintype" id="2049244">error</span><span class="op" id="2049249">)</span>&nbsp;<span class="op" id="2049251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2049254">b</span><span class="op" id="2049255">.</span><span class="ident" id="2049256">lastRead</span>&nbsp;<span class="op" id="2049265">=</span>&nbsp;<span class="ident" id="2049267">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2049278">if</span>&nbsp;<span class="ident" id="2049281">b</span><span class="op" id="2049282">.</span><span class="ident" id="2049283">off</span>&nbsp;<span class="op" id="2049287">&gt;=</span>&nbsp;<span class="builtinfunc" id="2049290">len</span><span class="op" id="2049293">(</span><span class="ident" id="2049294">b</span><span class="op" id="2049295">.</span><span class="ident" id="2049296">buf</span><span class="op" id="2049299">)</span>&nbsp;<span class="op" id="2049301">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2049305">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2049351">b</span><span class="op" id="2049352">.</span><span class="ident" id="2049353">Truncate</span><span class="op" id="2049361">(</span><span class="num" id="2049362">0</span><span class="op" id="2049363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2049367">return</span>&nbsp;<span class="num" id="2049374">0</span><span class="op" id="2049375">,</span>&nbsp;<span class="num" id="2049377">0</span><span class="op" id="2049378">,</span>&nbsp;<span class="ident" id="2049380">io</span><span class="op" id="2049382">.</span><span class="ident" id="2049383">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2049388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2049391">b</span><span class="op" id="2049392">.</span><span class="ident" id="2049393">lastRead</span>&nbsp;<span class="op" id="2049402">=</span>&nbsp;<span class="ident" id="2049404">opReadRune</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2049416">c</span>&nbsp;<span class="op" id="2049418">:=</span>&nbsp;<span class="ident" id="2049421">b</span><span class="op" id="2049422">.</span><span class="ident" id="2049423">buf</span><span class="op" id="2049426">[</span><span class="ident" id="2049427">b</span><span class="op" id="2049428">.</span><span class="ident" id="2049429">off</span><span class="op" id="2049432">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2049435">if</span>&nbsp;<span class="ident" id="2049438">c</span>&nbsp;<span class="op" id="2049440">&lt;</span>&nbsp;<span class="ident" id="2049442">utf8</span><span class="op" id="2049446">.</span><span class="ident" id="2049447">RuneSelf</span>&nbsp;<span class="op" id="2049456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2049460">b</span><span class="op" id="2049461">.</span><span class="ident" id="2049462">off</span><span class="op" id="2049465">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2049470">return</span>&nbsp;<span class="builtintype" id="2049477">rune</span><span class="op" id="2049481">(</span><span class="ident" id="2049482">c</span><span class="op" id="2049483">)</span><span class="op" id="2049484">,</span>&nbsp;<span class="num" id="2049486">1</span><span class="op" id="2049487">,</span>&nbsp;<span class="ident" id="2049489">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2049494">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2049497">r</span><span class="op" id="2049498">,</span>&nbsp;<span class="ident" id="2049500">n</span>&nbsp;<span class="op" id="2049502">:=</span>&nbsp;<span class="ident" id="2049505">utf8</span><span class="op" id="2049509">.</span><span class="ident" id="2049510">DecodeRune</span><span class="op" id="2049520">(</span><span class="ident" id="2049521">b</span><span class="op" id="2049522">.</span><span class="ident" id="2049523">buf</span><span class="op" id="2049526">[</span><span class="ident" id="2049527">b</span><span class="op" id="2049528">.</span><span class="ident" id="2049529">off</span><span class="op" id="2049532">:</span><span class="op" id="2049533">]</span><span class="op" id="2049534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2049537">b</span><span class="op" id="2049538">.</span><span class="ident" id="2049539">off</span>&nbsp;<span class="op" id="2049543">+=</span>&nbsp;<span class="ident" id="2049546">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2049549">return</span>&nbsp;<span class="ident" id="2049556">r</span><span class="op" id="2049557">,</span>&nbsp;<span class="ident" id="2049559">n</span><span class="op" id="2049560">,</span>&nbsp;<span class="ident" id="2049562">nil</span><br>
<span class="lineno"></span><span class="op" id="2049566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="comment" id="2049569">//&nbsp;UnreadRune&nbsp;unreads&nbsp;the&nbsp;last&nbsp;rune&nbsp;returned&nbsp;by&nbsp;ReadRune.</span><br>
<span class="lineno"></span><span class="comment" id="2049627">//&nbsp;If&nbsp;the&nbsp;most&nbsp;recent&nbsp;read&nbsp;or&nbsp;write&nbsp;operation&nbsp;on&nbsp;the&nbsp;buffer&nbsp;was</span><br>
<span class="lineno"></span><span class="comment" id="2049691">//&nbsp;not&nbsp;a&nbsp;ReadRune,&nbsp;UnreadRune&nbsp;returns&nbsp;an&nbsp;error.&nbsp;&nbsp;(In&nbsp;this&nbsp;regard</span><br>
<span class="lineno"></span><span class="comment" id="2049756">//&nbsp;it&nbsp;is&nbsp;stricter&nbsp;than&nbsp;UnreadByte,&nbsp;which&nbsp;will&nbsp;unread&nbsp;the&nbsp;last&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="2049823">//&nbsp;from&nbsp;any&nbsp;read&nbsp;operation.)</span><br>
<span class="lineno">330</span><span class="keyword" id="2049852">func</span>&nbsp;<span class="op" id="2049857">(</span><span class="ident" id="2049858">b</span>&nbsp;<span class="op" id="2049860">*</span><span class="ident" id="2049861">Buffer</span><span class="op" id="2049867">)</span>&nbsp;<span class="ident" id="2049869">UnreadRune</span><span class="op" id="2049879">(</span><span class="op" id="2049880">)</span>&nbsp;<span class="builtintype" id="2049882">error</span>&nbsp;<span class="op" id="2049888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2049891">if</span>&nbsp;<span class="ident" id="2049894">b</span><span class="op" id="2049895">.</span><span class="ident" id="2049896">lastRead</span>&nbsp;<span class="op" id="2049905">!=</span>&nbsp;<span class="ident" id="2049908">opReadRune</span>&nbsp;<span class="op" id="2049919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2049923">return</span>&nbsp;<span class="ident" id="2049930">errors</span><span class="op" id="2049936">.</span><span class="ident" id="2049937">New</span><span class="op" id="2049940">(</span><span class="string" id="2049941">&#34;bytes.Buffer:&nbsp;UnreadRune:&nbsp;previous&nbsp;operation&nbsp;was&nbsp;not&nbsp;ReadRune&#34;</span><span class="op" id="2050004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2050007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2050010">b</span><span class="op" id="2050011">.</span><span class="ident" id="2050012">lastRead</span>&nbsp;<span class="op" id="2050021">=</span>&nbsp;<span class="ident" id="2050023">opInvalid</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2050034">if</span>&nbsp;<span class="ident" id="2050037">b</span><span class="op" id="2050038">.</span><span class="ident" id="2050039">off</span>&nbsp;<span class="op" id="2050043">&gt;</span>&nbsp;<span class="num" id="2050045">0</span>&nbsp;<span class="op" id="2050047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2050051">_</span><span class="op" id="2050052">,</span>&nbsp;<span class="ident" id="2050054">n</span>&nbsp;<span class="op" id="2050056">:=</span>&nbsp;<span class="ident" id="2050059">utf8</span><span class="op" id="2050063">.</span><span class="ident" id="2050064">DecodeLastRune</span><span class="op" id="2050078">(</span><span class="ident" id="2050079">b</span><span class="op" id="2050080">.</span><span class="ident" id="2050081">buf</span><span class="op" id="2050084">[</span><span class="num" id="2050085">0</span><span class="op" id="2050086">:</span><span class="ident" id="2050087">b</span><span class="op" id="2050088">.</span><span class="ident" id="2050089">off</span><span class="op" id="2050092">]</span><span class="op" id="2050093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2050097">b</span><span class="op" id="2050098">.</span><span class="ident" id="2050099">off</span>&nbsp;<span class="op" id="2050103">-=</span>&nbsp;<span class="ident" id="2050106">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2050109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2050112">return</span>&nbsp;<span class="ident" id="2050119">nil</span><br>
<span class="lineno">340</span><span class="op" id="2050123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2050126">//&nbsp;UnreadByte&nbsp;unreads&nbsp;the&nbsp;last&nbsp;byte&nbsp;returned&nbsp;by&nbsp;the&nbsp;most&nbsp;recent</span><br>
<span class="lineno"></span><span class="comment" id="2050190">//&nbsp;read&nbsp;operation.&nbsp;&nbsp;If&nbsp;write&nbsp;has&nbsp;happened&nbsp;since&nbsp;the&nbsp;last&nbsp;read,&nbsp;UnreadByte</span><br>
<span class="lineno"></span><span class="comment" id="2050264">//&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno">345</span><span class="keyword" id="2050285">func</span>&nbsp;<span class="op" id="2050290">(</span><span class="ident" id="2050291">b</span>&nbsp;<span class="op" id="2050293">*</span><span class="ident" id="2050294">Buffer</span><span class="op" id="2050300">)</span>&nbsp;<span class="ident" id="2050302">UnreadByte</span><span class="op" id="2050312">(</span><span class="op" id="2050313">)</span>&nbsp;<span class="builtintype" id="2050315">error</span>&nbsp;<span class="op" id="2050321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2050324">if</span>&nbsp;<span class="ident" id="2050327">b</span><span class="op" id="2050328">.</span><span class="ident" id="2050329">lastRead</span>&nbsp;<span class="op" id="2050338">!=</span>&nbsp;<span class="ident" id="2050341">opReadRune</span>&nbsp;<span class="op" id="2050352">&amp;&amp;</span>&nbsp;<span class="ident" id="2050355">b</span><span class="op" id="2050356">.</span><span class="ident" id="2050357">lastRead</span>&nbsp;<span class="op" id="2050366">!=</span>&nbsp;<span class="ident" id="2050369">opRead</span>&nbsp;<span class="op" id="2050376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2050380">return</span>&nbsp;<span class="ident" id="2050387">errors</span><span class="op" id="2050393">.</span><span class="ident" id="2050394">New</span><span class="op" id="2050397">(</span><span class="string" id="2050398">&#34;bytes.Buffer:&nbsp;UnreadByte:&nbsp;previous&nbsp;operation&nbsp;was&nbsp;not&nbsp;a&nbsp;read&#34;</span><span class="op" id="2050459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2050462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2050465">b</span><span class="op" id="2050466">.</span><span class="ident" id="2050467">lastRead</span>&nbsp;<span class="op" id="2050476">=</span>&nbsp;<span class="ident" id="2050478">opInvalid</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2050489">if</span>&nbsp;<span class="ident" id="2050492">b</span><span class="op" id="2050493">.</span><span class="ident" id="2050494">off</span>&nbsp;<span class="op" id="2050498">&gt;</span>&nbsp;<span class="num" id="2050500">0</span>&nbsp;<span class="op" id="2050502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2050506">b</span><span class="op" id="2050507">.</span><span class="ident" id="2050508">off</span><span class="op" id="2050511">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2050515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2050518">return</span>&nbsp;<span class="ident" id="2050525">nil</span><br>
<span class="lineno"></span><span class="op" id="2050529">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="comment" id="2050532">//&nbsp;ReadBytes&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="2050601">//&nbsp;returning&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="2050677">//&nbsp;If&nbsp;ReadBytes&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="2050741">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno">360</span><span class="comment" id="2050823">//&nbsp;ReadBytes&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="2050904">//&nbsp;delim.</span><br>
<span class="lineno"></span><span class="keyword" id="2050914">func</span>&nbsp;<span class="op" id="2050919">(</span><span class="ident" id="2050920">b</span>&nbsp;<span class="op" id="2050922">*</span><span class="ident" id="2050923">Buffer</span><span class="op" id="2050929">)</span>&nbsp;<span class="ident" id="2050931">ReadBytes</span><span class="op" id="2050940">(</span><span class="ident" id="2050941">delim</span>&nbsp;<span class="builtintype" id="2050947">byte</span><span class="op" id="2050951">)</span>&nbsp;<span class="op" id="2050953">(</span><span class="ident" id="2050954">line</span>&nbsp;<span class="op" id="2050959">[</span><span class="op" id="2050960">]</span><span class="builtintype" id="2050961">byte</span><span class="op" id="2050965">,</span>&nbsp;<span class="ident" id="2050967">err</span>&nbsp;<span class="builtintype" id="2050971">error</span><span class="op" id="2050976">)</span>&nbsp;<span class="op" id="2050978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2050981">slice</span><span class="op" id="2050986">,</span>&nbsp;<span class="ident" id="2050988">err</span>&nbsp;<span class="op" id="2050992">:=</span>&nbsp;<span class="ident" id="2050995">b</span><span class="op" id="2050996">.</span><span class="ident" id="2050997">readSlice</span><span class="op" id="2051006">(</span><span class="ident" id="2051007">delim</span><span class="op" id="2051012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2051015">//&nbsp;return&nbsp;a&nbsp;copy&nbsp;of&nbsp;slice.&nbsp;The&nbsp;buffer&#39;s&nbsp;backing&nbsp;array&nbsp;may</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2051074">//&nbsp;be&nbsp;overwritten&nbsp;by&nbsp;later&nbsp;calls.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2051109">line</span>&nbsp;<span class="op" id="2051114">=</span>&nbsp;<span class="builtinfunc" id="2051116">append</span><span class="op" id="2051122">(</span><span class="ident" id="2051123">line</span><span class="op" id="2051127">,</span>&nbsp;<span class="ident" id="2051129">slice</span><span class="op" id="2051134">...</span><span class="op" id="2051137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2051140">return</span><br>
<span class="lineno"></span><span class="op" id="2051147">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span><span class="comment" id="2051150">//&nbsp;readSlice&nbsp;is&nbsp;like&nbsp;ReadBytes&nbsp;but&nbsp;returns&nbsp;a&nbsp;reference&nbsp;to&nbsp;internal&nbsp;buffer&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="2051230">func</span>&nbsp;<span class="op" id="2051235">(</span><span class="ident" id="2051236">b</span>&nbsp;<span class="op" id="2051238">*</span><span class="ident" id="2051239">Buffer</span><span class="op" id="2051245">)</span>&nbsp;<span class="ident" id="2051247">readSlice</span><span class="op" id="2051256">(</span><span class="ident" id="2051257">delim</span>&nbsp;<span class="builtintype" id="2051263">byte</span><span class="op" id="2051267">)</span>&nbsp;<span class="op" id="2051269">(</span><span class="ident" id="2051270">line</span>&nbsp;<span class="op" id="2051275">[</span><span class="op" id="2051276">]</span><span class="builtintype" id="2051277">byte</span><span class="op" id="2051281">,</span>&nbsp;<span class="ident" id="2051283">err</span>&nbsp;<span class="builtintype" id="2051287">error</span><span class="op" id="2051292">)</span>&nbsp;<span class="op" id="2051294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2051297">i</span>&nbsp;<span class="op" id="2051299">:=</span>&nbsp;<span class="ident" id="2051302">IndexByte</span><span class="op" id="2051311">(</span><span class="ident" id="2051312">b</span><span class="op" id="2051313">.</span><span class="ident" id="2051314">buf</span><span class="op" id="2051317">[</span><span class="ident" id="2051318">b</span><span class="op" id="2051319">.</span><span class="ident" id="2051320">off</span><span class="op" id="2051323">:</span><span class="op" id="2051324">]</span><span class="op" id="2051325">,</span>&nbsp;<span class="ident" id="2051327">delim</span><span class="op" id="2051332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2051335">end</span>&nbsp;<span class="op" id="2051339">:=</span>&nbsp;<span class="ident" id="2051342">b</span><span class="op" id="2051343">.</span><span class="ident" id="2051344">off</span>&nbsp;<span class="op" id="2051348">+</span>&nbsp;<span class="ident" id="2051350">i</span>&nbsp;<span class="op" id="2051352">+</span>&nbsp;<span class="num" id="2051354">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2051357">if</span>&nbsp;<span class="ident" id="2051360">i</span>&nbsp;<span class="op" id="2051362">&lt;</span>&nbsp;<span class="num" id="2051364">0</span>&nbsp;<span class="op" id="2051366">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2051370">end</span>&nbsp;<span class="op" id="2051374">=</span>&nbsp;<span class="builtinfunc" id="2051376">len</span><span class="op" id="2051379">(</span><span class="ident" id="2051380">b</span><span class="op" id="2051381">.</span><span class="ident" id="2051382">buf</span><span class="op" id="2051385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2051389">err</span>&nbsp;<span class="op" id="2051393">=</span>&nbsp;<span class="ident" id="2051395">io</span><span class="op" id="2051397">.</span><span class="ident" id="2051398">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2051403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2051406">line</span>&nbsp;<span class="op" id="2051411">=</span>&nbsp;<span class="ident" id="2051413">b</span><span class="op" id="2051414">.</span><span class="ident" id="2051415">buf</span><span class="op" id="2051418">[</span><span class="ident" id="2051419">b</span><span class="op" id="2051420">.</span><span class="ident" id="2051421">off</span><span class="op" id="2051424">:</span><span class="ident" id="2051425">end</span><span class="op" id="2051428">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2051431">b</span><span class="op" id="2051432">.</span><span class="ident" id="2051433">off</span>&nbsp;<span class="op" id="2051437">=</span>&nbsp;<span class="ident" id="2051439">end</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2051444">b</span><span class="op" id="2051445">.</span><span class="ident" id="2051446">lastRead</span>&nbsp;<span class="op" id="2051455">=</span>&nbsp;<span class="ident" id="2051457">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2051465">return</span>&nbsp;<span class="ident" id="2051472">line</span><span class="op" id="2051476">,</span>&nbsp;<span class="ident" id="2051478">err</span><br>
<span class="lineno"></span><span class="op" id="2051482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2051485">//&nbsp;ReadString&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno">385</span><span class="comment" id="2051555">//&nbsp;returning&nbsp;a&nbsp;string&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="2051632">//&nbsp;If&nbsp;ReadString&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="2051697">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno"></span><span class="comment" id="2051779">//&nbsp;ReadString&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end</span><br>
<span class="lineno"></span><span class="comment" id="2051858">//&nbsp;in&nbsp;delim.</span><br>
<span class="lineno">390</span><span class="keyword" id="2051871">func</span>&nbsp;<span class="op" id="2051876">(</span><span class="ident" id="2051877">b</span>&nbsp;<span class="op" id="2051879">*</span><span class="ident" id="2051880">Buffer</span><span class="op" id="2051886">)</span>&nbsp;<span class="ident" id="2051888">ReadString</span><span class="op" id="2051898">(</span><span class="ident" id="2051899">delim</span>&nbsp;<span class="builtintype" id="2051905">byte</span><span class="op" id="2051909">)</span>&nbsp;<span class="op" id="2051911">(</span><span class="ident" id="2051912">line</span>&nbsp;<span class="builtintype" id="2051917">string</span><span class="op" id="2051923">,</span>&nbsp;<span class="ident" id="2051925">err</span>&nbsp;<span class="builtintype" id="2051929">error</span><span class="op" id="2051934">)</span>&nbsp;<span class="op" id="2051936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2051939">slice</span><span class="op" id="2051944">,</span>&nbsp;<span class="ident" id="2051946">err</span>&nbsp;<span class="op" id="2051950">:=</span>&nbsp;<span class="ident" id="2051953">b</span><span class="op" id="2051954">.</span><span class="ident" id="2051955">readSlice</span><span class="op" id="2051964">(</span><span class="ident" id="2051965">delim</span><span class="op" id="2051970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2051973">return</span>&nbsp;<span class="builtintype" id="2051980">string</span><span class="op" id="2051986">(</span><span class="ident" id="2051987">slice</span><span class="op" id="2051992">)</span><span class="op" id="2051993">,</span>&nbsp;<span class="ident" id="2051995">err</span><br>
<span class="lineno"></span><span class="op" id="2051999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span><span class="comment" id="2052002">//&nbsp;NewBuffer&nbsp;creates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;Buffer&nbsp;using&nbsp;buf&nbsp;as&nbsp;its&nbsp;initial</span><br>
<span class="lineno"></span><span class="comment" id="2052077">//&nbsp;contents.&nbsp;&nbsp;It&nbsp;is&nbsp;intended&nbsp;to&nbsp;prepare&nbsp;a&nbsp;Buffer&nbsp;to&nbsp;read&nbsp;existing&nbsp;data.&nbsp;&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="2052153">//&nbsp;can&nbsp;also&nbsp;be&nbsp;used&nbsp;to&nbsp;size&nbsp;the&nbsp;internal&nbsp;buffer&nbsp;for&nbsp;writing.&nbsp;To&nbsp;do&nbsp;that,</span><br>
<span class="lineno"></span><span class="comment" id="2052226">//&nbsp;buf&nbsp;should&nbsp;have&nbsp;the&nbsp;desired&nbsp;capacity&nbsp;but&nbsp;a&nbsp;length&nbsp;of&nbsp;zero.</span><br>
<span class="lineno"></span><span class="comment" id="2052288">//</span><br>
<span class="lineno">400</span><span class="comment" id="2052291">//&nbsp;In&nbsp;most&nbsp;cases,&nbsp;new(Buffer)&nbsp;(or&nbsp;just&nbsp;declaring&nbsp;a&nbsp;Buffer&nbsp;variable)&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2052362">//&nbsp;sufficient&nbsp;to&nbsp;initialize&nbsp;a&nbsp;Buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="2052400">func</span>&nbsp;<span class="ident" id="2052405">NewBuffer</span><span class="op" id="2052414">(</span><span class="ident" id="2052415">buf</span>&nbsp;<span class="op" id="2052419">[</span><span class="op" id="2052420">]</span><span class="builtintype" id="2052421">byte</span><span class="op" id="2052425">)</span>&nbsp;<span class="op" id="2052427">*</span><span class="ident" id="2052428">Buffer</span>&nbsp;<span class="op" id="2052435">{</span>&nbsp;<span class="keyword" id="2052437">return</span>&nbsp;<span class="op" id="2052444">&amp;</span><span class="ident" id="2052445">Buffer</span><span class="op" id="2052451">{</span><span class="ident" id="2052452">buf</span><span class="op" id="2052455">:</span>&nbsp;<span class="ident" id="2052457">buf</span><span class="op" id="2052460">}</span>&nbsp;<span class="op" id="2052462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2052465">//&nbsp;NewBufferString&nbsp;creates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;Buffer&nbsp;using&nbsp;string&nbsp;s&nbsp;as&nbsp;its</span><br>
<span class="lineno">405</span><span class="comment" id="2052543">//&nbsp;initial&nbsp;contents.&nbsp;It&nbsp;is&nbsp;intended&nbsp;to&nbsp;prepare&nbsp;a&nbsp;buffer&nbsp;to&nbsp;read&nbsp;an&nbsp;existing</span><br>
<span class="lineno"></span><span class="comment" id="2052619">//&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2052630">//</span><br>
<span class="lineno"></span><span class="comment" id="2052633">//&nbsp;In&nbsp;most&nbsp;cases,&nbsp;new(Buffer)&nbsp;(or&nbsp;just&nbsp;declaring&nbsp;a&nbsp;Buffer&nbsp;variable)&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2052704">//&nbsp;sufficient&nbsp;to&nbsp;initialize&nbsp;a&nbsp;Buffer.</span><br>
<span class="lineno">410</span><span class="keyword" id="2052742">func</span>&nbsp;<span class="ident" id="2052747">NewBufferString</span><span class="op" id="2052762">(</span><span class="ident" id="2052763">s</span>&nbsp;<span class="builtintype" id="2052765">string</span><span class="op" id="2052771">)</span>&nbsp;<span class="op" id="2052773">*</span><span class="ident" id="2052774">Buffer</span>&nbsp;<span class="op" id="2052781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2052784">return</span>&nbsp;<span class="op" id="2052791">&amp;</span><span class="ident" id="2052792">Buffer</span><span class="op" id="2052798">{</span><span class="ident" id="2052799">buf</span><span class="op" id="2052802">:</span>&nbsp;<span class="op" id="2052804">[</span><span class="op" id="2052805">]</span><span class="builtintype" id="2052806">byte</span><span class="op" id="2052810">(</span><span class="ident" id="2052811">s</span><span class="op" id="2052812">)</span><span class="op" id="2052813">}</span><br>
<span class="lineno"></span><span class="op" id="2052815">}</span>
</div>
</body>
</html>
