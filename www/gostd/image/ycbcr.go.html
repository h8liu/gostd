<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image</h2>
<ul>
<li><a href="/gostd/image/decode_example_test.go.html">decode_example_test.go</a></li>
<li><a href="/gostd/image/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/image/format.go.html">format.go</a></li>
<li><a href="/gostd/image/geom.go.html">geom.go</a></li>
<li><a href="/gostd/image/image.go.html">image.go</a></li>
<li><a href="/gostd/image/image_test.go.html">image_test.go</a></li>
<li><a href="/gostd/image/names.go.html">names.go</a></li>
<li><a href="/gostd/image/ycbcr.go.html" class="current">ycbcr.go</a></li>
<li><a href="/gostd/image/ycbcr_test.go.html">ycbcr_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5660407">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5660462">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5660516">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5660567">package</span>&nbsp;<span class="ident" id="5660575">image</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5660582">import</span>&nbsp;<span class="op" id="5660589">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5660592">&#34;image/color&#34;</span><br>
<span class="lineno"></span><span class="op" id="5660606">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="5660609">//&nbsp;YCbCrSubsampleRatio&nbsp;is&nbsp;the&nbsp;chroma&nbsp;subsample&nbsp;ratio&nbsp;used&nbsp;in&nbsp;a&nbsp;YCbCr&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5660685">type</span>&nbsp;<span class="ident" id="5660690">YCbCrSubsampleRatio</span>&nbsp;<span class="builtintype" id="5660710">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5660715">const</span>&nbsp;<span class="op" id="5660721">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5660724">YCbCrSubsampleRatio444</span>&nbsp;<span class="ident" id="5660747">YCbCrSubsampleRatio</span>&nbsp;<span class="op" id="5660767">=</span>&nbsp;<span class="ident" id="5660769">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5660775">YCbCrSubsampleRatio422</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5660799">YCbCrSubsampleRatio420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5660823">YCbCrSubsampleRatio440</span><br>
<span class="lineno"></span><span class="op" id="5660846">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5660849">func</span>&nbsp;<span class="op" id="5660854">(</span><span class="ident" id="5660855">s</span>&nbsp;<span class="ident" id="5660857">YCbCrSubsampleRatio</span><span class="op" id="5660876">)</span>&nbsp;<span class="ident" id="5660878">String</span><span class="op" id="5660884">(</span><span class="op" id="5660885">)</span>&nbsp;<span class="builtintype" id="5660887">string</span>&nbsp;<span class="op" id="5660894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5660897">switch</span>&nbsp;<span class="ident" id="5660904">s</span>&nbsp;<span class="op" id="5660906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5660909">case</span>&nbsp;<span class="ident" id="5660914">YCbCrSubsampleRatio444</span><span class="op" id="5660936">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5660940">return</span>&nbsp;<span class="string" id="5660947">&#34;YCbCrSubsampleRatio444&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5660973">case</span>&nbsp;<span class="ident" id="5660978">YCbCrSubsampleRatio422</span><span class="op" id="5661000">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5661004">return</span>&nbsp;<span class="string" id="5661011">&#34;YCbCrSubsampleRatio422&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5661037">case</span>&nbsp;<span class="ident" id="5661042">YCbCrSubsampleRatio420</span><span class="op" id="5661064">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5661068">return</span>&nbsp;<span class="string" id="5661075">&#34;YCbCrSubsampleRatio420&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5661101">case</span>&nbsp;<span class="ident" id="5661106">YCbCrSubsampleRatio440</span><span class="op" id="5661128">:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5661132">return</span>&nbsp;<span class="string" id="5661139">&#34;YCbCrSubsampleRatio440&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5661165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5661168">return</span>&nbsp;<span class="string" id="5661175">&#34;YCbCrSubsampleRatioUnknown&#34;</span><br>
<span class="lineno"></span><span class="op" id="5661204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="5661207">//&nbsp;YCbCr&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;of&nbsp;Y&#39;CbCr&nbsp;colors.&nbsp;There&nbsp;is&nbsp;one&nbsp;Y&nbsp;sample&nbsp;per</span><br>
<span class="lineno"></span><span class="comment" id="5661282">//&nbsp;pixel,&nbsp;but&nbsp;each&nbsp;Cb&nbsp;and&nbsp;Cr&nbsp;sample&nbsp;can&nbsp;span&nbsp;one&nbsp;or&nbsp;more&nbsp;pixels.</span><br>
<span class="lineno"></span><span class="comment" id="5661347">//&nbsp;YStride&nbsp;is&nbsp;the&nbsp;Y&nbsp;slice&nbsp;index&nbsp;delta&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span><span class="comment" id="5661421">//&nbsp;CStride&nbsp;is&nbsp;the&nbsp;Cb&nbsp;and&nbsp;Cr&nbsp;slice&nbsp;index&nbsp;delta&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels</span><br>
<span class="lineno"></span><span class="comment" id="5661502">//&nbsp;that&nbsp;map&nbsp;to&nbsp;separate&nbsp;chroma&nbsp;samples.</span><br>
<span class="lineno">40</span><span class="comment" id="5661542">//&nbsp;It&nbsp;is&nbsp;not&nbsp;an&nbsp;absolute&nbsp;requirement,&nbsp;but&nbsp;YStride&nbsp;and&nbsp;len(Y)&nbsp;are&nbsp;typically</span><br>
<span class="lineno"></span><span class="comment" id="5661617">//&nbsp;multiples&nbsp;of&nbsp;8,&nbsp;and:</span><br>
<span class="lineno"></span><span class="comment" id="5661641">//&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;4:4:4,&nbsp;CStride&nbsp;==&nbsp;YStride/1&nbsp;&amp;&amp;&nbsp;len(Cb)&nbsp;==&nbsp;len(Cr)&nbsp;==&nbsp;len(Y)/1.</span><br>
<span class="lineno"></span><span class="comment" id="5661711">//&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;4:2:2,&nbsp;CStride&nbsp;==&nbsp;YStride/2&nbsp;&amp;&amp;&nbsp;len(Cb)&nbsp;==&nbsp;len(Cr)&nbsp;==&nbsp;len(Y)/2.</span><br>
<span class="lineno"></span><span class="comment" id="5661781">//&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;4:2:0,&nbsp;CStride&nbsp;==&nbsp;YStride/2&nbsp;&amp;&amp;&nbsp;len(Cb)&nbsp;==&nbsp;len(Cr)&nbsp;==&nbsp;len(Y)/4.</span><br>
<span class="lineno">45</span><span class="comment" id="5661851">//&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;4:4:0,&nbsp;CStride&nbsp;==&nbsp;YStride/1&nbsp;&amp;&amp;&nbsp;len(Cb)&nbsp;==&nbsp;len(Cr)&nbsp;==&nbsp;len(Y)/2.</span><br>
<span class="lineno"></span><span class="keyword" id="5661921">type</span>&nbsp;<span class="ident" id="5661926">YCbCr</span>&nbsp;<span class="keyword" id="5661932">struct</span>&nbsp;<span class="op" id="5661939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5661942">Y</span><span class="op" id="5661943">,</span>&nbsp;<span class="ident" id="5661945">Cb</span><span class="op" id="5661947">,</span>&nbsp;<span class="ident" id="5661949">Cr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5661957">[</span><span class="op" id="5661958">]</span><span class="builtintype" id="5661959">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5661966">YStride</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5661981">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5661986">CStride</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5662001">int</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5662006">SubsampleRatio</span>&nbsp;<span class="ident" id="5662021">YCbCrSubsampleRatio</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5662042">Rect</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5662057">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5662067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5662070">func</span>&nbsp;<span class="op" id="5662075">(</span><span class="ident" id="5662076">p</span>&nbsp;<span class="op" id="5662078">*</span><span class="ident" id="5662079">YCbCr</span><span class="op" id="5662084">)</span>&nbsp;<span class="ident" id="5662086">ColorModel</span><span class="op" id="5662096">(</span><span class="op" id="5662097">)</span>&nbsp;<span class="ident" id="5662099">color</span><span class="op" id="5662104">.</span><span class="ident" id="5662105">Model</span>&nbsp;<span class="op" id="5662111">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5662114">return</span>&nbsp;<span class="ident" id="5662121">color</span><span class="op" id="5662126">.</span><span class="ident" id="5662127">YCbCrModel</span><br>
<span class="lineno"></span><span class="op" id="5662138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5662141">func</span>&nbsp;<span class="op" id="5662146">(</span><span class="ident" id="5662147">p</span>&nbsp;<span class="op" id="5662149">*</span><span class="ident" id="5662150">YCbCr</span><span class="op" id="5662155">)</span>&nbsp;<span class="ident" id="5662157">Bounds</span><span class="op" id="5662163">(</span><span class="op" id="5662164">)</span>&nbsp;<span class="ident" id="5662166">Rectangle</span>&nbsp;<span class="op" id="5662176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5662179">return</span>&nbsp;<span class="ident" id="5662186">p</span><span class="op" id="5662187">.</span><span class="ident" id="5662188">Rect</span><br>
<span class="lineno">60</span><span class="op" id="5662193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5662196">func</span>&nbsp;<span class="op" id="5662201">(</span><span class="ident" id="5662202">p</span>&nbsp;<span class="op" id="5662204">*</span><span class="ident" id="5662205">YCbCr</span><span class="op" id="5662210">)</span>&nbsp;<span class="ident" id="5662212">At</span><span class="op" id="5662214">(</span><span class="ident" id="5662215">x</span><span class="op" id="5662216">,</span>&nbsp;<span class="ident" id="5662218">y</span>&nbsp;<span class="builtintype" id="5662220">int</span><span class="op" id="5662223">)</span>&nbsp;<span class="ident" id="5662225">color</span><span class="op" id="5662230">.</span><span class="ident" id="5662231">Color</span>&nbsp;<span class="op" id="5662237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5662240">return</span>&nbsp;<span class="ident" id="5662247">p</span><span class="op" id="5662248">.</span><span class="ident" id="5662249">YCbCrAt</span><span class="op" id="5662256">(</span><span class="ident" id="5662257">x</span><span class="op" id="5662258">,</span>&nbsp;<span class="ident" id="5662260">y</span><span class="op" id="5662261">)</span><br>
<span class="lineno"></span><span class="op" id="5662263">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="5662266">func</span>&nbsp;<span class="op" id="5662271">(</span><span class="ident" id="5662272">p</span>&nbsp;<span class="op" id="5662274">*</span><span class="ident" id="5662275">YCbCr</span><span class="op" id="5662280">)</span>&nbsp;<span class="ident" id="5662282">YCbCrAt</span><span class="op" id="5662289">(</span><span class="ident" id="5662290">x</span><span class="op" id="5662291">,</span>&nbsp;<span class="ident" id="5662293">y</span>&nbsp;<span class="builtintype" id="5662295">int</span><span class="op" id="5662298">)</span>&nbsp;<span class="ident" id="5662300">color</span><span class="op" id="5662305">.</span><span class="ident" id="5662306">YCbCr</span>&nbsp;<span class="op" id="5662312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5662315">if</span>&nbsp;<span class="op" id="5662318">!</span><span class="op" id="5662319">(</span><span class="ident" id="5662320">Point</span><span class="op" id="5662325">{</span><span class="ident" id="5662326">x</span><span class="op" id="5662327">,</span>&nbsp;<span class="ident" id="5662329">y</span><span class="op" id="5662330">}</span><span class="op" id="5662331">.</span><span class="ident" id="5662332">In</span><span class="op" id="5662334">(</span><span class="ident" id="5662335">p</span><span class="op" id="5662336">.</span><span class="ident" id="5662337">Rect</span><span class="op" id="5662341">)</span><span class="op" id="5662342">)</span>&nbsp;<span class="op" id="5662344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5662348">return</span>&nbsp;<span class="ident" id="5662355">color</span><span class="op" id="5662360">.</span><span class="ident" id="5662361">YCbCr</span><span class="op" id="5662366">{</span><span class="op" id="5662367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5662370">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5662373">yi</span>&nbsp;<span class="op" id="5662376">:=</span>&nbsp;<span class="ident" id="5662379">p</span><span class="op" id="5662380">.</span><span class="ident" id="5662381">YOffset</span><span class="op" id="5662388">(</span><span class="ident" id="5662389">x</span><span class="op" id="5662390">,</span>&nbsp;<span class="ident" id="5662392">y</span><span class="op" id="5662393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5662396">ci</span>&nbsp;<span class="op" id="5662399">:=</span>&nbsp;<span class="ident" id="5662402">p</span><span class="op" id="5662403">.</span><span class="ident" id="5662404">COffset</span><span class="op" id="5662411">(</span><span class="ident" id="5662412">x</span><span class="op" id="5662413">,</span>&nbsp;<span class="ident" id="5662415">y</span><span class="op" id="5662416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5662419">return</span>&nbsp;<span class="ident" id="5662426">color</span><span class="op" id="5662431">.</span><span class="ident" id="5662432">YCbCr</span><span class="op" id="5662437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5662441">p</span><span class="op" id="5662442">.</span><span class="ident" id="5662443">Y</span><span class="op" id="5662444">[</span><span class="ident" id="5662445">yi</span><span class="op" id="5662447">]</span><span class="op" id="5662448">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5662452">p</span><span class="op" id="5662453">.</span><span class="ident" id="5662454">Cb</span><span class="op" id="5662456">[</span><span class="ident" id="5662457">ci</span><span class="op" id="5662459">]</span><span class="op" id="5662460">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5662464">p</span><span class="op" id="5662465">.</span><span class="ident" id="5662466">Cr</span><span class="op" id="5662468">[</span><span class="ident" id="5662469">ci</span><span class="op" id="5662471">]</span><span class="op" id="5662472">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5662475">}</span><br>
<span class="lineno"></span><span class="op" id="5662477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5662480">//&nbsp;YOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Y&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno">80</span><span class="comment" id="5662555">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5662579">func</span>&nbsp;<span class="op" id="5662584">(</span><span class="ident" id="5662585">p</span>&nbsp;<span class="op" id="5662587">*</span><span class="ident" id="5662588">YCbCr</span><span class="op" id="5662593">)</span>&nbsp;<span class="ident" id="5662595">YOffset</span><span class="op" id="5662602">(</span><span class="ident" id="5662603">x</span><span class="op" id="5662604">,</span>&nbsp;<span class="ident" id="5662606">y</span>&nbsp;<span class="builtintype" id="5662608">int</span><span class="op" id="5662611">)</span>&nbsp;<span class="builtintype" id="5662613">int</span>&nbsp;<span class="op" id="5662617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5662620">return</span>&nbsp;<span class="op" id="5662627">(</span><span class="ident" id="5662628">y</span><span class="op" id="5662629">-</span><span class="ident" id="5662630">p</span><span class="op" id="5662631">.</span><span class="ident" id="5662632">Rect</span><span class="op" id="5662636">.</span><span class="ident" id="5662637">Min</span><span class="op" id="5662640">.</span><span class="ident" id="5662641">Y</span><span class="op" id="5662642">)</span><span class="op" id="5662643">*</span><span class="ident" id="5662644">p</span><span class="op" id="5662645">.</span><span class="ident" id="5662646">YStride</span>&nbsp;<span class="op" id="5662654">+</span>&nbsp;<span class="op" id="5662656">(</span><span class="ident" id="5662657">x</span>&nbsp;<span class="op" id="5662659">-</span>&nbsp;<span class="ident" id="5662661">p</span><span class="op" id="5662662">.</span><span class="ident" id="5662663">Rect</span><span class="op" id="5662667">.</span><span class="ident" id="5662668">Min</span><span class="op" id="5662671">.</span><span class="ident" id="5662672">X</span><span class="op" id="5662673">)</span><br>
<span class="lineno"></span><span class="op" id="5662675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="5662678">//&nbsp;COffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Cb&nbsp;or&nbsp;Cr&nbsp;that&nbsp;corresponds</span><br>
<span class="lineno"></span><span class="comment" id="5662757">//&nbsp;to&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5662784">func</span>&nbsp;<span class="op" id="5662789">(</span><span class="ident" id="5662790">p</span>&nbsp;<span class="op" id="5662792">*</span><span class="ident" id="5662793">YCbCr</span><span class="op" id="5662798">)</span>&nbsp;<span class="ident" id="5662800">COffset</span><span class="op" id="5662807">(</span><span class="ident" id="5662808">x</span><span class="op" id="5662809">,</span>&nbsp;<span class="ident" id="5662811">y</span>&nbsp;<span class="builtintype" id="5662813">int</span><span class="op" id="5662816">)</span>&nbsp;<span class="builtintype" id="5662818">int</span>&nbsp;<span class="op" id="5662822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5662825">switch</span>&nbsp;<span class="ident" id="5662832">p</span><span class="op" id="5662833">.</span><span class="ident" id="5662834">SubsampleRatio</span>&nbsp;<span class="op" id="5662849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5662852">case</span>&nbsp;<span class="ident" id="5662857">YCbCrSubsampleRatio422</span><span class="op" id="5662879">:</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5662883">return</span>&nbsp;<span class="op" id="5662890">(</span><span class="ident" id="5662891">y</span><span class="op" id="5662892">-</span><span class="ident" id="5662893">p</span><span class="op" id="5662894">.</span><span class="ident" id="5662895">Rect</span><span class="op" id="5662899">.</span><span class="ident" id="5662900">Min</span><span class="op" id="5662903">.</span><span class="ident" id="5662904">Y</span><span class="op" id="5662905">)</span><span class="op" id="5662906">*</span><span class="ident" id="5662907">p</span><span class="op" id="5662908">.</span><span class="ident" id="5662909">CStride</span>&nbsp;<span class="op" id="5662917">+</span>&nbsp;<span class="op" id="5662919">(</span><span class="ident" id="5662920">x</span><span class="op" id="5662921">/</span><span class="num" id="5662922">2</span>&nbsp;<span class="op" id="5662924">-</span>&nbsp;<span class="ident" id="5662926">p</span><span class="op" id="5662927">.</span><span class="ident" id="5662928">Rect</span><span class="op" id="5662932">.</span><span class="ident" id="5662933">Min</span><span class="op" id="5662936">.</span><span class="ident" id="5662937">X</span><span class="op" id="5662938">/</span><span class="num" id="5662939">2</span><span class="op" id="5662940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5662943">case</span>&nbsp;<span class="ident" id="5662948">YCbCrSubsampleRatio420</span><span class="op" id="5662970">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5662974">return</span>&nbsp;<span class="op" id="5662981">(</span><span class="ident" id="5662982">y</span><span class="op" id="5662983">/</span><span class="num" id="5662984">2</span><span class="op" id="5662985">-</span><span class="ident" id="5662986">p</span><span class="op" id="5662987">.</span><span class="ident" id="5662988">Rect</span><span class="op" id="5662992">.</span><span class="ident" id="5662993">Min</span><span class="op" id="5662996">.</span><span class="ident" id="5662997">Y</span><span class="op" id="5662998">/</span><span class="num" id="5662999">2</span><span class="op" id="5663000">)</span><span class="op" id="5663001">*</span><span class="ident" id="5663002">p</span><span class="op" id="5663003">.</span><span class="ident" id="5663004">CStride</span>&nbsp;<span class="op" id="5663012">+</span>&nbsp;<span class="op" id="5663014">(</span><span class="ident" id="5663015">x</span><span class="op" id="5663016">/</span><span class="num" id="5663017">2</span>&nbsp;<span class="op" id="5663019">-</span>&nbsp;<span class="ident" id="5663021">p</span><span class="op" id="5663022">.</span><span class="ident" id="5663023">Rect</span><span class="op" id="5663027">.</span><span class="ident" id="5663028">Min</span><span class="op" id="5663031">.</span><span class="ident" id="5663032">X</span><span class="op" id="5663033">/</span><span class="num" id="5663034">2</span><span class="op" id="5663035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5663038">case</span>&nbsp;<span class="ident" id="5663043">YCbCrSubsampleRatio440</span><span class="op" id="5663065">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5663069">return</span>&nbsp;<span class="op" id="5663076">(</span><span class="ident" id="5663077">y</span><span class="op" id="5663078">/</span><span class="num" id="5663079">2</span><span class="op" id="5663080">-</span><span class="ident" id="5663081">p</span><span class="op" id="5663082">.</span><span class="ident" id="5663083">Rect</span><span class="op" id="5663087">.</span><span class="ident" id="5663088">Min</span><span class="op" id="5663091">.</span><span class="ident" id="5663092">Y</span><span class="op" id="5663093">/</span><span class="num" id="5663094">2</span><span class="op" id="5663095">)</span><span class="op" id="5663096">*</span><span class="ident" id="5663097">p</span><span class="op" id="5663098">.</span><span class="ident" id="5663099">CStride</span>&nbsp;<span class="op" id="5663107">+</span>&nbsp;<span class="op" id="5663109">(</span><span class="ident" id="5663110">x</span>&nbsp;<span class="op" id="5663112">-</span>&nbsp;<span class="ident" id="5663114">p</span><span class="op" id="5663115">.</span><span class="ident" id="5663116">Rect</span><span class="op" id="5663120">.</span><span class="ident" id="5663121">Min</span><span class="op" id="5663124">.</span><span class="ident" id="5663125">X</span><span class="op" id="5663126">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5663129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5663132">//&nbsp;Default&nbsp;to&nbsp;4:4:4&nbsp;subsampling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5663166">return</span>&nbsp;<span class="op" id="5663173">(</span><span class="ident" id="5663174">y</span><span class="op" id="5663175">-</span><span class="ident" id="5663176">p</span><span class="op" id="5663177">.</span><span class="ident" id="5663178">Rect</span><span class="op" id="5663182">.</span><span class="ident" id="5663183">Min</span><span class="op" id="5663186">.</span><span class="ident" id="5663187">Y</span><span class="op" id="5663188">)</span><span class="op" id="5663189">*</span><span class="ident" id="5663190">p</span><span class="op" id="5663191">.</span><span class="ident" id="5663192">CStride</span>&nbsp;<span class="op" id="5663200">+</span>&nbsp;<span class="op" id="5663202">(</span><span class="ident" id="5663203">x</span>&nbsp;<span class="op" id="5663205">-</span>&nbsp;<span class="ident" id="5663207">p</span><span class="op" id="5663208">.</span><span class="ident" id="5663209">Rect</span><span class="op" id="5663213">.</span><span class="ident" id="5663214">Min</span><span class="op" id="5663217">.</span><span class="ident" id="5663218">X</span><span class="op" id="5663219">)</span><br>
<span class="lineno"></span><span class="op" id="5663221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="5663224">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5663301">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5663373">func</span>&nbsp;<span class="op" id="5663378">(</span><span class="ident" id="5663379">p</span>&nbsp;<span class="op" id="5663381">*</span><span class="ident" id="5663382">YCbCr</span><span class="op" id="5663387">)</span>&nbsp;<span class="ident" id="5663389">SubImage</span><span class="op" id="5663397">(</span><span class="ident" id="5663398">r</span>&nbsp;<span class="ident" id="5663400">Rectangle</span><span class="op" id="5663409">)</span>&nbsp;<span class="ident" id="5663411">Image</span>&nbsp;<span class="op" id="5663417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5663420">r</span>&nbsp;<span class="op" id="5663422">=</span>&nbsp;<span class="ident" id="5663424">r</span><span class="op" id="5663425">.</span><span class="ident" id="5663426">Intersect</span><span class="op" id="5663435">(</span><span class="ident" id="5663436">p</span><span class="op" id="5663437">.</span><span class="ident" id="5663438">Rect</span><span class="op" id="5663442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5663445">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5663526">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5663608">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5663658">if</span>&nbsp;<span class="ident" id="5663661">r</span><span class="op" id="5663662">.</span><span class="ident" id="5663663">Empty</span><span class="op" id="5663668">(</span><span class="op" id="5663669">)</span>&nbsp;<span class="op" id="5663671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5663675">return</span>&nbsp;<span class="op" id="5663682">&amp;</span><span class="ident" id="5663683">YCbCr</span><span class="op" id="5663688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5663693">SubsampleRatio</span><span class="op" id="5663707">:</span>&nbsp;<span class="ident" id="5663709">p</span><span class="op" id="5663710">.</span><span class="ident" id="5663711">SubsampleRatio</span><span class="op" id="5663725">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5663729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5663732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5663735">yi</span>&nbsp;<span class="op" id="5663738">:=</span>&nbsp;<span class="ident" id="5663741">p</span><span class="op" id="5663742">.</span><span class="ident" id="5663743">YOffset</span><span class="op" id="5663750">(</span><span class="ident" id="5663751">r</span><span class="op" id="5663752">.</span><span class="ident" id="5663753">Min</span><span class="op" id="5663756">.</span><span class="ident" id="5663757">X</span><span class="op" id="5663758">,</span>&nbsp;<span class="ident" id="5663760">r</span><span class="op" id="5663761">.</span><span class="ident" id="5663762">Min</span><span class="op" id="5663765">.</span><span class="ident" id="5663766">Y</span><span class="op" id="5663767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5663770">ci</span>&nbsp;<span class="op" id="5663773">:=</span>&nbsp;<span class="ident" id="5663776">p</span><span class="op" id="5663777">.</span><span class="ident" id="5663778">COffset</span><span class="op" id="5663785">(</span><span class="ident" id="5663786">r</span><span class="op" id="5663787">.</span><span class="ident" id="5663788">Min</span><span class="op" id="5663791">.</span><span class="ident" id="5663792">X</span><span class="op" id="5663793">,</span>&nbsp;<span class="ident" id="5663795">r</span><span class="op" id="5663796">.</span><span class="ident" id="5663797">Min</span><span class="op" id="5663800">.</span><span class="ident" id="5663801">Y</span><span class="op" id="5663802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5663805">return</span>&nbsp;<span class="op" id="5663812">&amp;</span><span class="ident" id="5663813">YCbCr</span><span class="op" id="5663818">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5663822">Y</span><span class="op" id="5663823">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5663838">p</span><span class="op" id="5663839">.</span><span class="ident" id="5663840">Y</span><span class="op" id="5663841">[</span><span class="ident" id="5663842">yi</span><span class="op" id="5663844">:</span><span class="op" id="5663845">]</span><span class="op" id="5663846">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5663850">Cb</span><span class="op" id="5663852">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5663866">p</span><span class="op" id="5663867">.</span><span class="ident" id="5663868">Cb</span><span class="op" id="5663870">[</span><span class="ident" id="5663871">ci</span><span class="op" id="5663873">:</span><span class="op" id="5663874">]</span><span class="op" id="5663875">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5663879">Cr</span><span class="op" id="5663881">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5663895">p</span><span class="op" id="5663896">.</span><span class="ident" id="5663897">Cr</span><span class="op" id="5663899">[</span><span class="ident" id="5663900">ci</span><span class="op" id="5663902">:</span><span class="op" id="5663903">]</span><span class="op" id="5663904">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5663908">SubsampleRatio</span><span class="op" id="5663922">:</span>&nbsp;<span class="ident" id="5663924">p</span><span class="op" id="5663925">.</span><span class="ident" id="5663926">SubsampleRatio</span><span class="op" id="5663940">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5663944">YStride</span><span class="op" id="5663951">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5663960">p</span><span class="op" id="5663961">.</span><span class="ident" id="5663962">YStride</span><span class="op" id="5663969">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5663973">CStride</span><span class="op" id="5663980">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5663989">p</span><span class="op" id="5663990">.</span><span class="ident" id="5663991">CStride</span><span class="op" id="5663998">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664002">Rect</span><span class="op" id="5664006">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664018">r</span><span class="op" id="5664019">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5664022">}</span><br>
<span class="lineno"></span><span class="op" id="5664024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="5664027">func</span>&nbsp;<span class="op" id="5664032">(</span><span class="ident" id="5664033">p</span>&nbsp;<span class="op" id="5664035">*</span><span class="ident" id="5664036">YCbCr</span><span class="op" id="5664041">)</span>&nbsp;<span class="ident" id="5664043">Opaque</span><span class="op" id="5664049">(</span><span class="op" id="5664050">)</span>&nbsp;<span class="builtintype" id="5664052">bool</span>&nbsp;<span class="op" id="5664057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5664060">return</span>&nbsp;<span class="builtintype" id="5664067">true</span><br>
<span class="lineno"></span><span class="op" id="5664072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5664075">//&nbsp;NewYCbCr&nbsp;returns&nbsp;a&nbsp;new&nbsp;YCbCr&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds&nbsp;and&nbsp;subsample&nbsp;ratio.</span><br>
<span class="lineno">130</span><span class="keyword" id="5664150">func</span>&nbsp;<span class="ident" id="5664155">NewYCbCr</span><span class="op" id="5664163">(</span><span class="ident" id="5664164">r</span>&nbsp;<span class="ident" id="5664166">Rectangle</span><span class="op" id="5664175">,</span>&nbsp;<span class="ident" id="5664177">subsampleRatio</span>&nbsp;<span class="ident" id="5664192">YCbCrSubsampleRatio</span><span class="op" id="5664211">)</span>&nbsp;<span class="op" id="5664213">*</span><span class="ident" id="5664214">YCbCr</span>&nbsp;<span class="op" id="5664220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664223">w</span><span class="op" id="5664224">,</span>&nbsp;<span class="ident" id="5664226">h</span><span class="op" id="5664227">,</span>&nbsp;<span class="ident" id="5664229">cw</span><span class="op" id="5664231">,</span>&nbsp;<span class="ident" id="5664233">ch</span>&nbsp;<span class="op" id="5664236">:=</span>&nbsp;<span class="ident" id="5664239">r</span><span class="op" id="5664240">.</span><span class="ident" id="5664241">Dx</span><span class="op" id="5664243">(</span><span class="op" id="5664244">)</span><span class="op" id="5664245">,</span>&nbsp;<span class="ident" id="5664247">r</span><span class="op" id="5664248">.</span><span class="ident" id="5664249">Dy</span><span class="op" id="5664251">(</span><span class="op" id="5664252">)</span><span class="op" id="5664253">,</span>&nbsp;<span class="num" id="5664255">0</span><span class="op" id="5664256">,</span>&nbsp;<span class="num" id="5664258">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5664261">switch</span>&nbsp;<span class="ident" id="5664268">subsampleRatio</span>&nbsp;<span class="op" id="5664283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5664286">case</span>&nbsp;<span class="ident" id="5664291">YCbCrSubsampleRatio422</span><span class="op" id="5664313">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664317">cw</span>&nbsp;<span class="op" id="5664320">=</span>&nbsp;<span class="op" id="5664322">(</span><span class="ident" id="5664323">r</span><span class="op" id="5664324">.</span><span class="ident" id="5664325">Max</span><span class="op" id="5664328">.</span><span class="ident" id="5664329">X</span><span class="op" id="5664330">+</span><span class="num" id="5664331">1</span><span class="op" id="5664332">)</span><span class="op" id="5664333">/</span><span class="num" id="5664334">2</span>&nbsp;<span class="op" id="5664336">-</span>&nbsp;<span class="ident" id="5664338">r</span><span class="op" id="5664339">.</span><span class="ident" id="5664340">Min</span><span class="op" id="5664343">.</span><span class="ident" id="5664344">X</span><span class="op" id="5664345">/</span><span class="num" id="5664346">2</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664350">ch</span>&nbsp;<span class="op" id="5664353">=</span>&nbsp;<span class="ident" id="5664355">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5664358">case</span>&nbsp;<span class="ident" id="5664363">YCbCrSubsampleRatio420</span><span class="op" id="5664385">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664389">cw</span>&nbsp;<span class="op" id="5664392">=</span>&nbsp;<span class="op" id="5664394">(</span><span class="ident" id="5664395">r</span><span class="op" id="5664396">.</span><span class="ident" id="5664397">Max</span><span class="op" id="5664400">.</span><span class="ident" id="5664401">X</span><span class="op" id="5664402">+</span><span class="num" id="5664403">1</span><span class="op" id="5664404">)</span><span class="op" id="5664405">/</span><span class="num" id="5664406">2</span>&nbsp;<span class="op" id="5664408">-</span>&nbsp;<span class="ident" id="5664410">r</span><span class="op" id="5664411">.</span><span class="ident" id="5664412">Min</span><span class="op" id="5664415">.</span><span class="ident" id="5664416">X</span><span class="op" id="5664417">/</span><span class="num" id="5664418">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664422">ch</span>&nbsp;<span class="op" id="5664425">=</span>&nbsp;<span class="op" id="5664427">(</span><span class="ident" id="5664428">r</span><span class="op" id="5664429">.</span><span class="ident" id="5664430">Max</span><span class="op" id="5664433">.</span><span class="ident" id="5664434">Y</span><span class="op" id="5664435">+</span><span class="num" id="5664436">1</span><span class="op" id="5664437">)</span><span class="op" id="5664438">/</span><span class="num" id="5664439">2</span>&nbsp;<span class="op" id="5664441">-</span>&nbsp;<span class="ident" id="5664443">r</span><span class="op" id="5664444">.</span><span class="ident" id="5664445">Min</span><span class="op" id="5664448">.</span><span class="ident" id="5664449">Y</span><span class="op" id="5664450">/</span><span class="num" id="5664451">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5664454">case</span>&nbsp;<span class="ident" id="5664459">YCbCrSubsampleRatio440</span><span class="op" id="5664481">:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664485">cw</span>&nbsp;<span class="op" id="5664488">=</span>&nbsp;<span class="ident" id="5664490">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664494">ch</span>&nbsp;<span class="op" id="5664497">=</span>&nbsp;<span class="op" id="5664499">(</span><span class="ident" id="5664500">r</span><span class="op" id="5664501">.</span><span class="ident" id="5664502">Max</span><span class="op" id="5664505">.</span><span class="ident" id="5664506">Y</span><span class="op" id="5664507">+</span><span class="num" id="5664508">1</span><span class="op" id="5664509">)</span><span class="op" id="5664510">/</span><span class="num" id="5664511">2</span>&nbsp;<span class="op" id="5664513">-</span>&nbsp;<span class="ident" id="5664515">r</span><span class="op" id="5664516">.</span><span class="ident" id="5664517">Min</span><span class="op" id="5664520">.</span><span class="ident" id="5664521">Y</span><span class="op" id="5664522">/</span><span class="num" id="5664523">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5664526">default</span><span class="op" id="5664533">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5664537">//&nbsp;Default&nbsp;to&nbsp;4:4:4&nbsp;subsampling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664572">cw</span>&nbsp;<span class="op" id="5664575">=</span>&nbsp;<span class="ident" id="5664577">w</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664581">ch</span>&nbsp;<span class="op" id="5664584">=</span>&nbsp;<span class="ident" id="5664586">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5664589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664592">b</span>&nbsp;<span class="op" id="5664594">:=</span>&nbsp;<span class="builtinfunc" id="5664597">make</span><span class="op" id="5664601">(</span><span class="op" id="5664602">[</span><span class="op" id="5664603">]</span><span class="builtintype" id="5664604">byte</span><span class="op" id="5664608">,</span>&nbsp;<span class="ident" id="5664610">w</span><span class="op" id="5664611">*</span><span class="ident" id="5664612">h</span><span class="op" id="5664613">+</span><span class="num" id="5664614">2</span><span class="op" id="5664615">*</span><span class="ident" id="5664616">cw</span><span class="op" id="5664618">*</span><span class="ident" id="5664619">ch</span><span class="op" id="5664621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5664624">return</span>&nbsp;<span class="op" id="5664631">&amp;</span><span class="ident" id="5664632">YCbCr</span><span class="op" id="5664637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664641">Y</span><span class="op" id="5664642">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664657">b</span><span class="op" id="5664658">[</span><span class="op" id="5664659">:</span><span class="ident" id="5664660">w</span><span class="op" id="5664661">*</span><span class="ident" id="5664662">h</span><span class="op" id="5664663">]</span><span class="op" id="5664664">,</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664668">Cb</span><span class="op" id="5664670">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664684">b</span><span class="op" id="5664685">[</span><span class="ident" id="5664686">w</span><span class="op" id="5664687">*</span><span class="ident" id="5664688">h</span><span class="op" id="5664689">+</span><span class="num" id="5664690">0</span><span class="op" id="5664691">*</span><span class="ident" id="5664692">cw</span><span class="op" id="5664694">*</span><span class="ident" id="5664695">ch</span>&nbsp;<span class="op" id="5664698">:</span>&nbsp;<span class="ident" id="5664700">w</span><span class="op" id="5664701">*</span><span class="ident" id="5664702">h</span><span class="op" id="5664703">+</span><span class="num" id="5664704">1</span><span class="op" id="5664705">*</span><span class="ident" id="5664706">cw</span><span class="op" id="5664708">*</span><span class="ident" id="5664709">ch</span><span class="op" id="5664711">]</span><span class="op" id="5664712">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664716">Cr</span><span class="op" id="5664718">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664732">b</span><span class="op" id="5664733">[</span><span class="ident" id="5664734">w</span><span class="op" id="5664735">*</span><span class="ident" id="5664736">h</span><span class="op" id="5664737">+</span><span class="num" id="5664738">1</span><span class="op" id="5664739">*</span><span class="ident" id="5664740">cw</span><span class="op" id="5664742">*</span><span class="ident" id="5664743">ch</span>&nbsp;<span class="op" id="5664746">:</span>&nbsp;<span class="ident" id="5664748">w</span><span class="op" id="5664749">*</span><span class="ident" id="5664750">h</span><span class="op" id="5664751">+</span><span class="num" id="5664752">2</span><span class="op" id="5664753">*</span><span class="ident" id="5664754">cw</span><span class="op" id="5664756">*</span><span class="ident" id="5664757">ch</span><span class="op" id="5664759">]</span><span class="op" id="5664760">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664764">SubsampleRatio</span><span class="op" id="5664778">:</span>&nbsp;<span class="ident" id="5664780">subsampleRatio</span><span class="op" id="5664794">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664798">YStride</span><span class="op" id="5664805">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664814">w</span><span class="op" id="5664815">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664819">CStride</span><span class="op" id="5664826">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664835">cw</span><span class="op" id="5664837">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664841">Rect</span><span class="op" id="5664845">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664857">r</span><span class="op" id="5664858">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5664861">}</span><br>
<span class="lineno"></span><span class="op" id="5664863">}</span>
</div>
</body>
</html>
