<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6143588">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6143643">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6143697">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6143748">//&nbsp;Package&nbsp;ascii85&nbsp;implements&nbsp;the&nbsp;ascii85&nbsp;data&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="6143804">//&nbsp;as&nbsp;used&nbsp;in&nbsp;the&nbsp;btoa&nbsp;tool&nbsp;and&nbsp;Adobe&#39;s&nbsp;PostScript&nbsp;and&nbsp;PDF&nbsp;document&nbsp;formats.</span><br>
<span class="lineno"></span><span class="keyword" id="6143881">package</span>&nbsp;<span class="ident" id="6143889">ascii85</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6143898">import</span>&nbsp;<span class="op" id="6143905">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6143908">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6143914">&#34;strconv&#34;</span><br>
<span class="lineno"></span><span class="op" id="6143924">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6143927">/*<br>
<span class="lineno">15</span>&nbsp;*&nbsp;Encoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6143946">//&nbsp;Encode&nbsp;encodes&nbsp;src&nbsp;into&nbsp;at&nbsp;most&nbsp;MaxEncodedLen(len(src))</span><br>
<span class="lineno"></span><span class="comment" id="6144005">//&nbsp;bytes&nbsp;of&nbsp;dst,&nbsp;returning&nbsp;the&nbsp;actual&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">20</span><span class="comment" id="6144068">//</span><br>
<span class="lineno"></span><span class="comment" id="6144071">//&nbsp;The&nbsp;encoding&nbsp;handles&nbsp;4-byte&nbsp;chunks,&nbsp;using&nbsp;a&nbsp;special&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="6144135">//&nbsp;for&nbsp;the&nbsp;last&nbsp;fragment,&nbsp;so&nbsp;Encode&nbsp;is&nbsp;not&nbsp;appropriate&nbsp;for&nbsp;use&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="6144201">//&nbsp;individual&nbsp;blocks&nbsp;of&nbsp;a&nbsp;large&nbsp;data&nbsp;stream.&nbsp;&nbsp;Use&nbsp;NewEncoder()&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="6144273">//</span><br>
<span class="lineno">25</span><span class="comment" id="6144276">//&nbsp;Often,&nbsp;ascii85-encoded&nbsp;data&nbsp;is&nbsp;wrapped&nbsp;in&nbsp;&lt;~&nbsp;and&nbsp;~&gt;&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="comment" id="6144340">//&nbsp;Encode&nbsp;does&nbsp;not&nbsp;add&nbsp;these.</span><br>
<span class="lineno"></span><span class="keyword" id="6144370">func</span>&nbsp;<span class="ident" id="6144375">Encode</span><span class="op" id="6144381">(</span><span class="ident" id="6144382">dst</span><span class="op" id="6144385">,</span>&nbsp;<span class="ident" id="6144387">src</span>&nbsp;<span class="op" id="6144391">[</span><span class="op" id="6144392">]</span><span class="builtintype" id="6144393">byte</span><span class="op" id="6144397">)</span>&nbsp;<span class="builtintype" id="6144399">int</span>&nbsp;<span class="op" id="6144403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6144406">if</span>&nbsp;<span class="builtinfunc" id="6144409">len</span><span class="op" id="6144412">(</span><span class="ident" id="6144413">src</span><span class="op" id="6144416">)</span>&nbsp;<span class="op" id="6144418">==</span>&nbsp;<span class="num" id="6144421">0</span>&nbsp;<span class="op" id="6144423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6144427">return</span>&nbsp;<span class="num" id="6144434">0</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6144437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6144441">n</span>&nbsp;<span class="op" id="6144443">:=</span>&nbsp;<span class="num" id="6144446">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6144449">for</span>&nbsp;<span class="builtinfunc" id="6144453">len</span><span class="op" id="6144456">(</span><span class="ident" id="6144457">src</span><span class="op" id="6144460">)</span>&nbsp;<span class="op" id="6144462">&gt;</span>&nbsp;<span class="num" id="6144464">0</span>&nbsp;<span class="op" id="6144466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6144470">dst</span><span class="op" id="6144473">[</span><span class="num" id="6144474">0</span><span class="op" id="6144475">]</span>&nbsp;<span class="op" id="6144477">=</span>&nbsp;<span class="num" id="6144479">0</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6144483">dst</span><span class="op" id="6144486">[</span><span class="num" id="6144487">1</span><span class="op" id="6144488">]</span>&nbsp;<span class="op" id="6144490">=</span>&nbsp;<span class="num" id="6144492">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6144496">dst</span><span class="op" id="6144499">[</span><span class="num" id="6144500">2</span><span class="op" id="6144501">]</span>&nbsp;<span class="op" id="6144503">=</span>&nbsp;<span class="num" id="6144505">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6144509">dst</span><span class="op" id="6144512">[</span><span class="num" id="6144513">3</span><span class="op" id="6144514">]</span>&nbsp;<span class="op" id="6144516">=</span>&nbsp;<span class="num" id="6144518">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6144522">dst</span><span class="op" id="6144525">[</span><span class="num" id="6144526">4</span><span class="op" id="6144527">]</span>&nbsp;<span class="op" id="6144529">=</span>&nbsp;<span class="num" id="6144531">0</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6144536">//&nbsp;Unpack&nbsp;4&nbsp;bytes&nbsp;into&nbsp;uint32&nbsp;to&nbsp;repack&nbsp;into&nbsp;base&nbsp;85&nbsp;5-byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6144599">var</span>&nbsp;<span class="ident" id="6144603">v</span>&nbsp;<span class="builtintype" id="6144605">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6144614">switch</span>&nbsp;<span class="builtinfunc" id="6144621">len</span><span class="op" id="6144624">(</span><span class="ident" id="6144625">src</span><span class="op" id="6144628">)</span>&nbsp;<span class="op" id="6144630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6144634">default</span><span class="op" id="6144641">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6144646">v</span>&nbsp;<span class="op" id="6144648">|=</span>&nbsp;<span class="builtintype" id="6144651">uint32</span><span class="op" id="6144657">(</span><span class="ident" id="6144658">src</span><span class="op" id="6144661">[</span><span class="num" id="6144662">3</span><span class="op" id="6144663">]</span><span class="op" id="6144664">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6144669">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6144683">case</span>&nbsp;<span class="num" id="6144688">3</span><span class="op" id="6144689">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6144694">v</span>&nbsp;<span class="op" id="6144696">|=</span>&nbsp;<span class="builtintype" id="6144699">uint32</span><span class="op" id="6144705">(</span><span class="ident" id="6144706">src</span><span class="op" id="6144709">[</span><span class="num" id="6144710">2</span><span class="op" id="6144711">]</span><span class="op" id="6144712">)</span>&nbsp;<span class="op" id="6144714">&lt;&lt;</span>&nbsp;<span class="num" id="6144717">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6144722">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6144736">case</span>&nbsp;<span class="num" id="6144741">2</span><span class="op" id="6144742">:</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6144747">v</span>&nbsp;<span class="op" id="6144749">|=</span>&nbsp;<span class="builtintype" id="6144752">uint32</span><span class="op" id="6144758">(</span><span class="ident" id="6144759">src</span><span class="op" id="6144762">[</span><span class="num" id="6144763">1</span><span class="op" id="6144764">]</span><span class="op" id="6144765">)</span>&nbsp;<span class="op" id="6144767">&lt;&lt;</span>&nbsp;<span class="num" id="6144770">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6144776">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6144790">case</span>&nbsp;<span class="num" id="6144795">1</span><span class="op" id="6144796">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6144801">v</span>&nbsp;<span class="op" id="6144803">|=</span>&nbsp;<span class="builtintype" id="6144806">uint32</span><span class="op" id="6144812">(</span><span class="ident" id="6144813">src</span><span class="op" id="6144816">[</span><span class="num" id="6144817">0</span><span class="op" id="6144818">]</span><span class="op" id="6144819">)</span>&nbsp;<span class="op" id="6144821">&lt;&lt;</span>&nbsp;<span class="num" id="6144824">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6144829">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6144834">//&nbsp;Special&nbsp;case:&nbsp;zero&nbsp;(!!!!!)&nbsp;shortens&nbsp;to&nbsp;z.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6144881">if</span>&nbsp;<span class="ident" id="6144884">v</span>&nbsp;<span class="op" id="6144886">==</span>&nbsp;<span class="num" id="6144889">0</span>&nbsp;<span class="op" id="6144891">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="6144894">len</span><span class="op" id="6144897">(</span><span class="ident" id="6144898">src</span><span class="op" id="6144901">)</span>&nbsp;<span class="op" id="6144903">&gt;=</span>&nbsp;<span class="num" id="6144906">4</span>&nbsp;<span class="op" id="6144908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6144913">dst</span><span class="op" id="6144916">[</span><span class="num" id="6144917">0</span><span class="op" id="6144918">]</span>&nbsp;<span class="op" id="6144920">=</span>&nbsp;<span class="string" id="6144922">&#39;z&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6144929">dst</span>&nbsp;<span class="op" id="6144933">=</span>&nbsp;<span class="ident" id="6144935">dst</span><span class="op" id="6144938">[</span><span class="num" id="6144939">1</span><span class="op" id="6144940">:</span><span class="op" id="6144941">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6144946">src</span>&nbsp;<span class="op" id="6144950">=</span>&nbsp;<span class="ident" id="6144952">src</span><span class="op" id="6144955">[</span><span class="num" id="6144956">4</span><span class="op" id="6144957">:</span><span class="op" id="6144958">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6144963">n</span><span class="op" id="6144964">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6144970">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6144981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6144986">//&nbsp;Otherwise,&nbsp;5&nbsp;base&nbsp;85&nbsp;digits&nbsp;starting&nbsp;at&nbsp;!.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6145034">for</span>&nbsp;<span class="ident" id="6145038">i</span>&nbsp;<span class="op" id="6145040">:=</span>&nbsp;<span class="num" id="6145043">4</span><span class="op" id="6145044">;</span>&nbsp;<span class="ident" id="6145046">i</span>&nbsp;<span class="op" id="6145048">&gt;=</span>&nbsp;<span class="num" id="6145051">0</span><span class="op" id="6145052">;</span>&nbsp;<span class="ident" id="6145054">i</span><span class="op" id="6145055">--</span>&nbsp;<span class="op" id="6145058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6145063">dst</span><span class="op" id="6145066">[</span><span class="ident" id="6145067">i</span><span class="op" id="6145068">]</span>&nbsp;<span class="op" id="6145070">=</span>&nbsp;<span class="string" id="6145072">&#39;!&#39;</span>&nbsp;<span class="op" id="6145076">+</span>&nbsp;<span class="builtintype" id="6145078">byte</span><span class="op" id="6145082">(</span><span class="ident" id="6145083">v</span><span class="op" id="6145084">%</span><span class="num" id="6145085">85</span><span class="op" id="6145087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6145092">v</span>&nbsp;<span class="op" id="6145094">/=</span>&nbsp;<span class="num" id="6145097">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6145102">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6145107">//&nbsp;If&nbsp;src&nbsp;was&nbsp;short,&nbsp;discard&nbsp;the&nbsp;low&nbsp;destination&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6145165">m</span>&nbsp;<span class="op" id="6145167">:=</span>&nbsp;<span class="num" id="6145170">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6145174">if</span>&nbsp;<span class="builtinfunc" id="6145177">len</span><span class="op" id="6145180">(</span><span class="ident" id="6145181">src</span><span class="op" id="6145184">)</span>&nbsp;<span class="op" id="6145186">&lt;</span>&nbsp;<span class="num" id="6145188">4</span>&nbsp;<span class="op" id="6145190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6145195">m</span>&nbsp;<span class="op" id="6145197">-=</span>&nbsp;<span class="num" id="6145200">4</span>&nbsp;<span class="op" id="6145202">-</span>&nbsp;<span class="builtinfunc" id="6145204">len</span><span class="op" id="6145207">(</span><span class="ident" id="6145208">src</span><span class="op" id="6145211">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6145216">src</span>&nbsp;<span class="op" id="6145220">=</span>&nbsp;<span class="ident" id="6145222">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6145228">}</span>&nbsp;<span class="keyword" id="6145230">else</span>&nbsp;<span class="op" id="6145235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6145240">src</span>&nbsp;<span class="op" id="6145244">=</span>&nbsp;<span class="ident" id="6145246">src</span><span class="op" id="6145249">[</span><span class="num" id="6145250">4</span><span class="op" id="6145251">:</span><span class="op" id="6145252">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6145256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6145260">dst</span>&nbsp;<span class="op" id="6145264">=</span>&nbsp;<span class="ident" id="6145266">dst</span><span class="op" id="6145269">[</span><span class="ident" id="6145270">m</span><span class="op" id="6145271">:</span><span class="op" id="6145272">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6145276">n</span>&nbsp;<span class="op" id="6145278">+=</span>&nbsp;<span class="ident" id="6145281">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6145284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6145287">return</span>&nbsp;<span class="ident" id="6145294">n</span><br>
<span class="lineno"></span><span class="op" id="6145296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="6145299">//&nbsp;MaxEncodedLen&nbsp;returns&nbsp;the&nbsp;maximum&nbsp;length&nbsp;of&nbsp;an&nbsp;encoding&nbsp;of&nbsp;n&nbsp;source&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="6145377">func</span>&nbsp;<span class="ident" id="6145382">MaxEncodedLen</span><span class="op" id="6145395">(</span><span class="ident" id="6145396">n</span>&nbsp;<span class="builtintype" id="6145398">int</span><span class="op" id="6145401">)</span>&nbsp;<span class="builtintype" id="6145403">int</span>&nbsp;<span class="op" id="6145407">{</span>&nbsp;<span class="keyword" id="6145409">return</span>&nbsp;<span class="op" id="6145416">(</span><span class="ident" id="6145417">n</span>&nbsp;<span class="op" id="6145419">+</span>&nbsp;<span class="num" id="6145421">3</span><span class="op" id="6145422">)</span>&nbsp;<span class="op" id="6145424">/</span>&nbsp;<span class="num" id="6145426">4</span>&nbsp;<span class="op" id="6145428">*</span>&nbsp;<span class="num" id="6145430">5</span>&nbsp;<span class="op" id="6145432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6145435">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;ascii85&nbsp;stream&nbsp;encoder.&nbsp;&nbsp;Data&nbsp;written&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6145504">//&nbsp;the&nbsp;returned&nbsp;writer&nbsp;will&nbsp;be&nbsp;encoded&nbsp;and&nbsp;then&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno">90</span><span class="comment" id="6145566">//&nbsp;Ascii85&nbsp;encodings&nbsp;operate&nbsp;in&nbsp;32-bit&nbsp;blocks;&nbsp;when&nbsp;finished</span><br>
<span class="lineno"></span><span class="comment" id="6145627">//&nbsp;writing,&nbsp;the&nbsp;caller&nbsp;must&nbsp;Close&nbsp;the&nbsp;returned&nbsp;encoder&nbsp;to&nbsp;flush&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="6145695">//&nbsp;trailing&nbsp;partial&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="6145722">func</span>&nbsp;<span class="ident" id="6145727">NewEncoder</span><span class="op" id="6145737">(</span><span class="ident" id="6145738">w</span>&nbsp;<span class="ident" id="6145740">io</span><span class="op" id="6145742">.</span><span class="ident" id="6145743">Writer</span><span class="op" id="6145749">)</span>&nbsp;<span class="ident" id="6145751">io</span><span class="op" id="6145753">.</span><span class="ident" id="6145754">WriteCloser</span>&nbsp;<span class="op" id="6145766">{</span>&nbsp;<span class="keyword" id="6145768">return</span>&nbsp;<span class="op" id="6145775">&amp;</span><span class="ident" id="6145776">encoder</span><span class="op" id="6145783">{</span><span class="ident" id="6145784">w</span><span class="op" id="6145785">:</span>&nbsp;<span class="ident" id="6145787">w</span><span class="op" id="6145788">}</span>&nbsp;<span class="op" id="6145790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6145793">type</span>&nbsp;<span class="ident" id="6145798">encoder</span>&nbsp;<span class="keyword" id="6145806">struct</span>&nbsp;<span class="op" id="6145813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6145816">err</span>&nbsp;&nbsp;<span class="builtintype" id="6145821">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6145828">w</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6145833">io</span><span class="op" id="6145835">.</span><span class="ident" id="6145836">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6145844">buf</span>&nbsp;&nbsp;<span class="op" id="6145849">[</span><span class="num" id="6145850">4</span><span class="op" id="6145851">]</span><span class="builtintype" id="6145852">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6145860">//&nbsp;buffered&nbsp;data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;encoded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6145900">nbuf</span>&nbsp;<span class="builtintype" id="6145905">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6145916">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;buf</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6145943">out</span>&nbsp;&nbsp;<span class="op" id="6145948">[</span><span class="num" id="6145949">1024</span><span class="op" id="6145953">]</span><span class="builtintype" id="6145954">byte</span>&nbsp;<span class="comment" id="6145959">//&nbsp;output&nbsp;buffer</span><br>
<span class="lineno"></span><span class="op" id="6145976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6145979">func</span>&nbsp;<span class="op" id="6145984">(</span><span class="ident" id="6145985">e</span>&nbsp;<span class="op" id="6145987">*</span><span class="ident" id="6145988">encoder</span><span class="op" id="6145995">)</span>&nbsp;<span class="ident" id="6145997">Write</span><span class="op" id="6146002">(</span><span class="ident" id="6146003">p</span>&nbsp;<span class="op" id="6146005">[</span><span class="op" id="6146006">]</span><span class="builtintype" id="6146007">byte</span><span class="op" id="6146011">)</span>&nbsp;<span class="op" id="6146013">(</span><span class="ident" id="6146014">n</span>&nbsp;<span class="builtintype" id="6146016">int</span><span class="op" id="6146019">,</span>&nbsp;<span class="ident" id="6146021">err</span>&nbsp;<span class="builtintype" id="6146025">error</span><span class="op" id="6146030">)</span>&nbsp;<span class="op" id="6146032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6146035">if</span>&nbsp;<span class="ident" id="6146038">e</span><span class="op" id="6146039">.</span><span class="ident" id="6146040">err</span>&nbsp;<span class="op" id="6146044">!=</span>&nbsp;<span class="ident" id="6146047">nil</span>&nbsp;<span class="op" id="6146051">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6146055">return</span>&nbsp;<span class="num" id="6146062">0</span><span class="op" id="6146063">,</span>&nbsp;<span class="ident" id="6146065">e</span><span class="op" id="6146066">.</span><span class="ident" id="6146067">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6146072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6146076">//&nbsp;Leading&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6146096">if</span>&nbsp;<span class="ident" id="6146099">e</span><span class="op" id="6146100">.</span><span class="ident" id="6146101">nbuf</span>&nbsp;<span class="op" id="6146106">&gt;</span>&nbsp;<span class="num" id="6146108">0</span>&nbsp;<span class="op" id="6146110">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6146114">var</span>&nbsp;<span class="ident" id="6146118">i</span>&nbsp;<span class="builtintype" id="6146120">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6146126">for</span>&nbsp;<span class="ident" id="6146130">i</span>&nbsp;<span class="op" id="6146132">=</span>&nbsp;<span class="num" id="6146134">0</span><span class="op" id="6146135">;</span>&nbsp;<span class="ident" id="6146137">i</span>&nbsp;<span class="op" id="6146139">&lt;</span>&nbsp;<span class="builtinfunc" id="6146141">len</span><span class="op" id="6146144">(</span><span class="ident" id="6146145">p</span><span class="op" id="6146146">)</span>&nbsp;<span class="op" id="6146148">&amp;&amp;</span>&nbsp;<span class="ident" id="6146151">e</span><span class="op" id="6146152">.</span><span class="ident" id="6146153">nbuf</span>&nbsp;<span class="op" id="6146158">&lt;</span>&nbsp;<span class="num" id="6146160">4</span><span class="op" id="6146161">;</span>&nbsp;<span class="ident" id="6146163">i</span><span class="op" id="6146164">++</span>&nbsp;<span class="op" id="6146167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6146172">e</span><span class="op" id="6146173">.</span><span class="ident" id="6146174">buf</span><span class="op" id="6146177">[</span><span class="ident" id="6146178">e</span><span class="op" id="6146179">.</span><span class="ident" id="6146180">nbuf</span><span class="op" id="6146184">]</span>&nbsp;<span class="op" id="6146186">=</span>&nbsp;<span class="ident" id="6146188">p</span><span class="op" id="6146189">[</span><span class="ident" id="6146190">i</span><span class="op" id="6146191">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6146196">e</span><span class="op" id="6146197">.</span><span class="ident" id="6146198">nbuf</span><span class="op" id="6146202">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6146207">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6146211">n</span>&nbsp;<span class="op" id="6146213">+=</span>&nbsp;<span class="ident" id="6146216">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6146220">p</span>&nbsp;<span class="op" id="6146222">=</span>&nbsp;<span class="ident" id="6146224">p</span><span class="op" id="6146225">[</span><span class="ident" id="6146226">i</span><span class="op" id="6146227">:</span><span class="op" id="6146228">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6146232">if</span>&nbsp;<span class="ident" id="6146235">e</span><span class="op" id="6146236">.</span><span class="ident" id="6146237">nbuf</span>&nbsp;<span class="op" id="6146242">&lt;</span>&nbsp;<span class="num" id="6146244">4</span>&nbsp;<span class="op" id="6146246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6146251">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6146260">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6146264">nout</span>&nbsp;<span class="op" id="6146269">:=</span>&nbsp;<span class="ident" id="6146272">Encode</span><span class="op" id="6146278">(</span><span class="ident" id="6146279">e</span><span class="op" id="6146280">.</span><span class="ident" id="6146281">out</span><span class="op" id="6146284">[</span><span class="num" id="6146285">0</span><span class="op" id="6146286">:</span><span class="op" id="6146287">]</span><span class="op" id="6146288">,</span>&nbsp;<span class="ident" id="6146290">e</span><span class="op" id="6146291">.</span><span class="ident" id="6146292">buf</span><span class="op" id="6146295">[</span><span class="num" id="6146296">0</span><span class="op" id="6146297">:</span><span class="op" id="6146298">]</span><span class="op" id="6146299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6146303">if</span>&nbsp;<span class="ident" id="6146306">_</span><span class="op" id="6146307">,</span>&nbsp;<span class="ident" id="6146309">e</span><span class="op" id="6146310">.</span><span class="ident" id="6146311">err</span>&nbsp;<span class="op" id="6146315">=</span>&nbsp;<span class="ident" id="6146317">e</span><span class="op" id="6146318">.</span><span class="ident" id="6146319">w</span><span class="op" id="6146320">.</span><span class="ident" id="6146321">Write</span><span class="op" id="6146326">(</span><span class="ident" id="6146327">e</span><span class="op" id="6146328">.</span><span class="ident" id="6146329">out</span><span class="op" id="6146332">[</span><span class="num" id="6146333">0</span><span class="op" id="6146334">:</span><span class="ident" id="6146335">nout</span><span class="op" id="6146339">]</span><span class="op" id="6146340">)</span><span class="op" id="6146341">;</span>&nbsp;<span class="ident" id="6146343">e</span><span class="op" id="6146344">.</span><span class="ident" id="6146345">err</span>&nbsp;<span class="op" id="6146349">!=</span>&nbsp;<span class="ident" id="6146352">nil</span>&nbsp;<span class="op" id="6146356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6146361">return</span>&nbsp;<span class="ident" id="6146368">n</span><span class="op" id="6146369">,</span>&nbsp;<span class="ident" id="6146371">e</span><span class="op" id="6146372">.</span><span class="ident" id="6146373">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6146379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6146383">e</span><span class="op" id="6146384">.</span><span class="ident" id="6146385">nbuf</span>&nbsp;<span class="op" id="6146390">=</span>&nbsp;<span class="num" id="6146392">0</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6146395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6146399">//&nbsp;Large&nbsp;interior&nbsp;chunks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6146426">for</span>&nbsp;<span class="builtinfunc" id="6146430">len</span><span class="op" id="6146433">(</span><span class="ident" id="6146434">p</span><span class="op" id="6146435">)</span>&nbsp;<span class="op" id="6146437">&gt;=</span>&nbsp;<span class="num" id="6146440">4</span>&nbsp;<span class="op" id="6146442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6146446">nn</span>&nbsp;<span class="op" id="6146449">:=</span>&nbsp;<span class="builtinfunc" id="6146452">len</span><span class="op" id="6146455">(</span><span class="ident" id="6146456">e</span><span class="op" id="6146457">.</span><span class="ident" id="6146458">out</span><span class="op" id="6146461">)</span>&nbsp;<span class="op" id="6146463">/</span>&nbsp;<span class="num" id="6146465">5</span>&nbsp;<span class="op" id="6146467">*</span>&nbsp;<span class="num" id="6146469">4</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6146473">if</span>&nbsp;<span class="ident" id="6146476">nn</span>&nbsp;<span class="op" id="6146479">&gt;</span>&nbsp;<span class="builtinfunc" id="6146481">len</span><span class="op" id="6146484">(</span><span class="ident" id="6146485">p</span><span class="op" id="6146486">)</span>&nbsp;<span class="op" id="6146488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6146493">nn</span>&nbsp;<span class="op" id="6146496">=</span>&nbsp;<span class="builtinfunc" id="6146498">len</span><span class="op" id="6146501">(</span><span class="ident" id="6146502">p</span><span class="op" id="6146503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6146507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6146511">nn</span>&nbsp;<span class="op" id="6146514">-=</span>&nbsp;<span class="ident" id="6146517">nn</span>&nbsp;<span class="op" id="6146520">%</span>&nbsp;<span class="num" id="6146522">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6146526">if</span>&nbsp;<span class="ident" id="6146529">nn</span>&nbsp;<span class="op" id="6146532">&gt;</span>&nbsp;<span class="num" id="6146534">0</span>&nbsp;<span class="op" id="6146536">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6146541">nout</span>&nbsp;<span class="op" id="6146546">:=</span>&nbsp;<span class="ident" id="6146549">Encode</span><span class="op" id="6146555">(</span><span class="ident" id="6146556">e</span><span class="op" id="6146557">.</span><span class="ident" id="6146558">out</span><span class="op" id="6146561">[</span><span class="num" id="6146562">0</span><span class="op" id="6146563">:</span><span class="op" id="6146564">]</span><span class="op" id="6146565">,</span>&nbsp;<span class="ident" id="6146567">p</span><span class="op" id="6146568">[</span><span class="num" id="6146569">0</span><span class="op" id="6146570">:</span><span class="ident" id="6146571">nn</span><span class="op" id="6146573">]</span><span class="op" id="6146574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6146579">if</span>&nbsp;<span class="ident" id="6146582">_</span><span class="op" id="6146583">,</span>&nbsp;<span class="ident" id="6146585">e</span><span class="op" id="6146586">.</span><span class="ident" id="6146587">err</span>&nbsp;<span class="op" id="6146591">=</span>&nbsp;<span class="ident" id="6146593">e</span><span class="op" id="6146594">.</span><span class="ident" id="6146595">w</span><span class="op" id="6146596">.</span><span class="ident" id="6146597">Write</span><span class="op" id="6146602">(</span><span class="ident" id="6146603">e</span><span class="op" id="6146604">.</span><span class="ident" id="6146605">out</span><span class="op" id="6146608">[</span><span class="num" id="6146609">0</span><span class="op" id="6146610">:</span><span class="ident" id="6146611">nout</span><span class="op" id="6146615">]</span><span class="op" id="6146616">)</span><span class="op" id="6146617">;</span>&nbsp;<span class="ident" id="6146619">e</span><span class="op" id="6146620">.</span><span class="ident" id="6146621">err</span>&nbsp;<span class="op" id="6146625">!=</span>&nbsp;<span class="ident" id="6146628">nil</span>&nbsp;<span class="op" id="6146632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6146638">return</span>&nbsp;<span class="ident" id="6146645">n</span><span class="op" id="6146646">,</span>&nbsp;<span class="ident" id="6146648">e</span><span class="op" id="6146649">.</span><span class="ident" id="6146650">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6146657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6146661">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6146665">n</span>&nbsp;<span class="op" id="6146667">+=</span>&nbsp;<span class="ident" id="6146670">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6146675">p</span>&nbsp;<span class="op" id="6146677">=</span>&nbsp;<span class="ident" id="6146679">p</span><span class="op" id="6146680">[</span><span class="ident" id="6146681">nn</span><span class="op" id="6146683">:</span><span class="op" id="6146684">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6146687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6146691">//&nbsp;Trailing&nbsp;fringe.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6146712">for</span>&nbsp;<span class="ident" id="6146716">i</span>&nbsp;<span class="op" id="6146718">:=</span>&nbsp;<span class="num" id="6146721">0</span><span class="op" id="6146722">;</span>&nbsp;<span class="ident" id="6146724">i</span>&nbsp;<span class="op" id="6146726">&lt;</span>&nbsp;<span class="builtinfunc" id="6146728">len</span><span class="op" id="6146731">(</span><span class="ident" id="6146732">p</span><span class="op" id="6146733">)</span><span class="op" id="6146734">;</span>&nbsp;<span class="ident" id="6146736">i</span><span class="op" id="6146737">++</span>&nbsp;<span class="op" id="6146740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6146744">e</span><span class="op" id="6146745">.</span><span class="ident" id="6146746">buf</span><span class="op" id="6146749">[</span><span class="ident" id="6146750">i</span><span class="op" id="6146751">]</span>&nbsp;<span class="op" id="6146753">=</span>&nbsp;<span class="ident" id="6146755">p</span><span class="op" id="6146756">[</span><span class="ident" id="6146757">i</span><span class="op" id="6146758">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6146761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6146764">e</span><span class="op" id="6146765">.</span><span class="ident" id="6146766">nbuf</span>&nbsp;<span class="op" id="6146771">=</span>&nbsp;<span class="builtinfunc" id="6146773">len</span><span class="op" id="6146776">(</span><span class="ident" id="6146777">p</span><span class="op" id="6146778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6146781">n</span>&nbsp;<span class="op" id="6146783">+=</span>&nbsp;<span class="builtinfunc" id="6146786">len</span><span class="op" id="6146789">(</span><span class="ident" id="6146790">p</span><span class="op" id="6146791">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6146794">return</span><br>
<span class="lineno"></span><span class="op" id="6146801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6146804">//&nbsp;Close&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;output&nbsp;from&nbsp;the&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="6146858">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;call&nbsp;Write&nbsp;after&nbsp;calling&nbsp;Close.</span><br>
<span class="lineno">155</span><span class="keyword" id="6146911">func</span>&nbsp;<span class="op" id="6146916">(</span><span class="ident" id="6146917">e</span>&nbsp;<span class="op" id="6146919">*</span><span class="ident" id="6146920">encoder</span><span class="op" id="6146927">)</span>&nbsp;<span class="ident" id="6146929">Close</span><span class="op" id="6146934">(</span><span class="op" id="6146935">)</span>&nbsp;<span class="builtintype" id="6146937">error</span>&nbsp;<span class="op" id="6146943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6146946">//&nbsp;If&nbsp;there&#39;s&nbsp;anything&nbsp;left&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;flush&nbsp;it&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6147003">if</span>&nbsp;<span class="ident" id="6147006">e</span><span class="op" id="6147007">.</span><span class="ident" id="6147008">err</span>&nbsp;<span class="op" id="6147012">==</span>&nbsp;<span class="ident" id="6147015">nil</span>&nbsp;<span class="op" id="6147019">&amp;&amp;</span>&nbsp;<span class="ident" id="6147022">e</span><span class="op" id="6147023">.</span><span class="ident" id="6147024">nbuf</span>&nbsp;<span class="op" id="6147029">&gt;</span>&nbsp;<span class="num" id="6147031">0</span>&nbsp;<span class="op" id="6147033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6147037">nout</span>&nbsp;<span class="op" id="6147042">:=</span>&nbsp;<span class="ident" id="6147045">Encode</span><span class="op" id="6147051">(</span><span class="ident" id="6147052">e</span><span class="op" id="6147053">.</span><span class="ident" id="6147054">out</span><span class="op" id="6147057">[</span><span class="num" id="6147058">0</span><span class="op" id="6147059">:</span><span class="op" id="6147060">]</span><span class="op" id="6147061">,</span>&nbsp;<span class="ident" id="6147063">e</span><span class="op" id="6147064">.</span><span class="ident" id="6147065">buf</span><span class="op" id="6147068">[</span><span class="num" id="6147069">0</span><span class="op" id="6147070">:</span><span class="ident" id="6147071">e</span><span class="op" id="6147072">.</span><span class="ident" id="6147073">nbuf</span><span class="op" id="6147077">]</span><span class="op" id="6147078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6147082">e</span><span class="op" id="6147083">.</span><span class="ident" id="6147084">nbuf</span>&nbsp;<span class="op" id="6147089">=</span>&nbsp;<span class="num" id="6147091">0</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6147095">_</span><span class="op" id="6147096">,</span>&nbsp;<span class="ident" id="6147098">e</span><span class="op" id="6147099">.</span><span class="ident" id="6147100">err</span>&nbsp;<span class="op" id="6147104">=</span>&nbsp;<span class="ident" id="6147106">e</span><span class="op" id="6147107">.</span><span class="ident" id="6147108">w</span><span class="op" id="6147109">.</span><span class="ident" id="6147110">Write</span><span class="op" id="6147115">(</span><span class="ident" id="6147116">e</span><span class="op" id="6147117">.</span><span class="ident" id="6147118">out</span><span class="op" id="6147121">[</span><span class="num" id="6147122">0</span><span class="op" id="6147123">:</span><span class="ident" id="6147124">nout</span><span class="op" id="6147128">]</span><span class="op" id="6147129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6147132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6147135">return</span>&nbsp;<span class="ident" id="6147142">e</span><span class="op" id="6147143">.</span><span class="ident" id="6147144">err</span><br>
<span class="lineno"></span><span class="op" id="6147148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="6147151">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Decoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6147170">type</span>&nbsp;<span class="ident" id="6147175">CorruptInputError</span>&nbsp;<span class="ident" id="6147193">int64</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="6147200">func</span>&nbsp;<span class="op" id="6147205">(</span><span class="ident" id="6147206">e</span>&nbsp;<span class="ident" id="6147208">CorruptInputError</span><span class="op" id="6147225">)</span>&nbsp;<span class="ident" id="6147227">Error</span><span class="op" id="6147232">(</span><span class="op" id="6147233">)</span>&nbsp;<span class="builtintype" id="6147235">string</span>&nbsp;<span class="op" id="6147242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6147245">return</span>&nbsp;<span class="string" id="6147252">&#34;illegal&nbsp;ascii85&nbsp;data&nbsp;at&nbsp;input&nbsp;byte&nbsp;&#34;</span>&nbsp;<span class="op" id="6147290">+</span>&nbsp;<span class="ident" id="6147292">strconv</span><span class="op" id="6147299">.</span><span class="ident" id="6147300">FormatInt</span><span class="op" id="6147309">(</span><span class="ident" id="6147310">int64</span><span class="op" id="6147315">(</span><span class="ident" id="6147316">e</span><span class="op" id="6147317">)</span><span class="op" id="6147318">,</span>&nbsp;<span class="num" id="6147320">10</span><span class="op" id="6147322">)</span><br>
<span class="lineno"></span><span class="op" id="6147324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="6147327">//&nbsp;Decode&nbsp;decodes&nbsp;src&nbsp;into&nbsp;dst,&nbsp;returning&nbsp;both&nbsp;the&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="6147385">//&nbsp;of&nbsp;bytes&nbsp;written&nbsp;to&nbsp;dst&nbsp;and&nbsp;the&nbsp;number&nbsp;consumed&nbsp;from&nbsp;src.</span><br>
<span class="lineno"></span><span class="comment" id="6147446">//&nbsp;If&nbsp;src&nbsp;contains&nbsp;invalid&nbsp;ascii85&nbsp;data,&nbsp;Decode&nbsp;will&nbsp;return&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6147510">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;successfully&nbsp;written&nbsp;and&nbsp;a&nbsp;CorruptInputError.</span><br>
<span class="lineno"></span><span class="comment" id="6147575">//&nbsp;Decode&nbsp;ignores&nbsp;space&nbsp;and&nbsp;control&nbsp;characters&nbsp;in&nbsp;src.</span><br>
<span class="lineno">180</span><span class="comment" id="6147630">//&nbsp;Often,&nbsp;ascii85-encoded&nbsp;data&nbsp;is&nbsp;wrapped&nbsp;in&nbsp;&lt;~&nbsp;and&nbsp;~&gt;&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="comment" id="6147694">//&nbsp;Decode&nbsp;expects&nbsp;these&nbsp;to&nbsp;have&nbsp;been&nbsp;stripped&nbsp;by&nbsp;the&nbsp;caller.</span><br>
<span class="lineno"></span><span class="comment" id="6147755">//</span><br>
<span class="lineno"></span><span class="comment" id="6147758">//&nbsp;If&nbsp;flush&nbsp;is&nbsp;true,&nbsp;Decode&nbsp;assumes&nbsp;that&nbsp;src&nbsp;represents&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6147818">//&nbsp;end&nbsp;of&nbsp;the&nbsp;input&nbsp;stream&nbsp;and&nbsp;processes&nbsp;it&nbsp;completely&nbsp;rather</span><br>
<span class="lineno">185</span><span class="comment" id="6147880">//&nbsp;than&nbsp;wait&nbsp;for&nbsp;the&nbsp;completion&nbsp;of&nbsp;another&nbsp;32-bit&nbsp;block.</span><br>
<span class="lineno"></span><span class="comment" id="6147937">//</span><br>
<span class="lineno"></span><span class="comment" id="6147940">//&nbsp;NewDecoder&nbsp;wraps&nbsp;an&nbsp;io.Reader&nbsp;interface&nbsp;around&nbsp;Decode.</span><br>
<span class="lineno"></span><span class="comment" id="6147998">//</span><br>
<span class="lineno"></span><span class="keyword" id="6148001">func</span>&nbsp;<span class="ident" id="6148006">Decode</span><span class="op" id="6148012">(</span><span class="ident" id="6148013">dst</span><span class="op" id="6148016">,</span>&nbsp;<span class="ident" id="6148018">src</span>&nbsp;<span class="op" id="6148022">[</span><span class="op" id="6148023">]</span><span class="builtintype" id="6148024">byte</span><span class="op" id="6148028">,</span>&nbsp;<span class="ident" id="6148030">flush</span>&nbsp;<span class="builtintype" id="6148036">bool</span><span class="op" id="6148040">)</span>&nbsp;<span class="op" id="6148042">(</span><span class="ident" id="6148043">ndst</span><span class="op" id="6148047">,</span>&nbsp;<span class="ident" id="6148049">nsrc</span>&nbsp;<span class="builtintype" id="6148054">int</span><span class="op" id="6148057">,</span>&nbsp;<span class="ident" id="6148059">err</span>&nbsp;<span class="builtintype" id="6148063">error</span><span class="op" id="6148068">)</span>&nbsp;<span class="op" id="6148070">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148073">var</span>&nbsp;<span class="ident" id="6148077">v</span>&nbsp;<span class="builtintype" id="6148079">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148087">var</span>&nbsp;<span class="ident" id="6148091">nb</span>&nbsp;<span class="builtintype" id="6148094">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148099">for</span>&nbsp;<span class="ident" id="6148103">i</span><span class="op" id="6148104">,</span>&nbsp;<span class="ident" id="6148106">b</span>&nbsp;<span class="op" id="6148108">:=</span>&nbsp;<span class="keyword" id="6148111">range</span>&nbsp;<span class="ident" id="6148117">src</span>&nbsp;<span class="op" id="6148121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148125">if</span>&nbsp;<span class="builtinfunc" id="6148128">len</span><span class="op" id="6148131">(</span><span class="ident" id="6148132">dst</span><span class="op" id="6148135">)</span><span class="op" id="6148136">-</span><span class="ident" id="6148137">ndst</span>&nbsp;<span class="op" id="6148142">&lt;</span>&nbsp;<span class="num" id="6148144">4</span>&nbsp;<span class="op" id="6148146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148151">return</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6148160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148164">switch</span>&nbsp;<span class="op" id="6148171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148175">case</span>&nbsp;<span class="ident" id="6148180">b</span>&nbsp;<span class="op" id="6148182">&lt;=</span>&nbsp;<span class="string" id="6148185">&#39;&nbsp;&#39;</span><span class="op" id="6148188">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148193">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148204">case</span>&nbsp;<span class="ident" id="6148209">b</span>&nbsp;<span class="op" id="6148211">==</span>&nbsp;<span class="string" id="6148214">&#39;z&#39;</span>&nbsp;<span class="op" id="6148218">&amp;&amp;</span>&nbsp;<span class="ident" id="6148221">nb</span>&nbsp;<span class="op" id="6148224">==</span>&nbsp;<span class="num" id="6148227">0</span><span class="op" id="6148228">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148233">nb</span>&nbsp;<span class="op" id="6148236">=</span>&nbsp;<span class="num" id="6148238">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148243">v</span>&nbsp;<span class="op" id="6148245">=</span>&nbsp;<span class="num" id="6148247">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148251">case</span>&nbsp;<span class="string" id="6148256">&#39;!&#39;</span>&nbsp;<span class="op" id="6148260">&lt;=</span>&nbsp;<span class="ident" id="6148263">b</span>&nbsp;<span class="op" id="6148265">&amp;&amp;</span>&nbsp;<span class="ident" id="6148268">b</span>&nbsp;<span class="op" id="6148270">&lt;=</span>&nbsp;<span class="string" id="6148273">&#39;u&#39;</span><span class="op" id="6148276">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148281">v</span>&nbsp;<span class="op" id="6148283">=</span>&nbsp;<span class="ident" id="6148285">v</span><span class="op" id="6148286">*</span><span class="num" id="6148287">85</span>&nbsp;<span class="op" id="6148290">+</span>&nbsp;<span class="builtintype" id="6148292">uint32</span><span class="op" id="6148298">(</span><span class="ident" id="6148299">b</span><span class="op" id="6148300">-</span><span class="string" id="6148301">&#39;!&#39;</span><span class="op" id="6148304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148309">nb</span><span class="op" id="6148311">++</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148316">default</span><span class="op" id="6148323">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148328">return</span>&nbsp;<span class="num" id="6148335">0</span><span class="op" id="6148336">,</span>&nbsp;<span class="num" id="6148338">0</span><span class="op" id="6148339">,</span>&nbsp;<span class="ident" id="6148341">CorruptInputError</span><span class="op" id="6148358">(</span><span class="ident" id="6148359">i</span><span class="op" id="6148360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6148364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148368">if</span>&nbsp;<span class="ident" id="6148371">nb</span>&nbsp;<span class="op" id="6148374">==</span>&nbsp;<span class="num" id="6148377">5</span>&nbsp;<span class="op" id="6148379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148384">nsrc</span>&nbsp;<span class="op" id="6148389">=</span>&nbsp;<span class="ident" id="6148391">i</span>&nbsp;<span class="op" id="6148393">+</span>&nbsp;<span class="num" id="6148395">1</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148400">dst</span><span class="op" id="6148403">[</span><span class="ident" id="6148404">ndst</span><span class="op" id="6148408">]</span>&nbsp;<span class="op" id="6148410">=</span>&nbsp;<span class="builtintype" id="6148412">byte</span><span class="op" id="6148416">(</span><span class="ident" id="6148417">v</span>&nbsp;<span class="op" id="6148419">&gt;&gt;</span>&nbsp;<span class="num" id="6148422">24</span><span class="op" id="6148424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148429">dst</span><span class="op" id="6148432">[</span><span class="ident" id="6148433">ndst</span><span class="op" id="6148437">+</span><span class="num" id="6148438">1</span><span class="op" id="6148439">]</span>&nbsp;<span class="op" id="6148441">=</span>&nbsp;<span class="builtintype" id="6148443">byte</span><span class="op" id="6148447">(</span><span class="ident" id="6148448">v</span>&nbsp;<span class="op" id="6148450">&gt;&gt;</span>&nbsp;<span class="num" id="6148453">16</span><span class="op" id="6148455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148460">dst</span><span class="op" id="6148463">[</span><span class="ident" id="6148464">ndst</span><span class="op" id="6148468">+</span><span class="num" id="6148469">2</span><span class="op" id="6148470">]</span>&nbsp;<span class="op" id="6148472">=</span>&nbsp;<span class="builtintype" id="6148474">byte</span><span class="op" id="6148478">(</span><span class="ident" id="6148479">v</span>&nbsp;<span class="op" id="6148481">&gt;&gt;</span>&nbsp;<span class="num" id="6148484">8</span><span class="op" id="6148485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148490">dst</span><span class="op" id="6148493">[</span><span class="ident" id="6148494">ndst</span><span class="op" id="6148498">+</span><span class="num" id="6148499">3</span><span class="op" id="6148500">]</span>&nbsp;<span class="op" id="6148502">=</span>&nbsp;<span class="builtintype" id="6148504">byte</span><span class="op" id="6148508">(</span><span class="ident" id="6148509">v</span><span class="op" id="6148510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148515">ndst</span>&nbsp;<span class="op" id="6148520">+=</span>&nbsp;<span class="num" id="6148523">4</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148528">nb</span>&nbsp;<span class="op" id="6148531">=</span>&nbsp;<span class="num" id="6148533">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148538">v</span>&nbsp;<span class="op" id="6148540">=</span>&nbsp;<span class="num" id="6148542">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6148546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6148549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148552">if</span>&nbsp;<span class="ident" id="6148555">flush</span>&nbsp;<span class="op" id="6148561">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148565">nsrc</span>&nbsp;<span class="op" id="6148570">=</span>&nbsp;<span class="builtinfunc" id="6148572">len</span><span class="op" id="6148575">(</span><span class="ident" id="6148576">src</span><span class="op" id="6148579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148583">if</span>&nbsp;<span class="ident" id="6148586">nb</span>&nbsp;<span class="op" id="6148589">&gt;</span>&nbsp;<span class="num" id="6148591">0</span>&nbsp;<span class="op" id="6148593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6148598">//&nbsp;The&nbsp;number&nbsp;of&nbsp;output&nbsp;bytes&nbsp;in&nbsp;the&nbsp;last&nbsp;fragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6148652">//&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;leftover&nbsp;input&nbsp;bytes&nbsp;-&nbsp;1:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6148701">//&nbsp;the&nbsp;extra&nbsp;byte&nbsp;provides&nbsp;enough&nbsp;bits&nbsp;to&nbsp;cover</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6148752">//&nbsp;the&nbsp;inefficiency&nbsp;of&nbsp;the&nbsp;encoding&nbsp;for&nbsp;the&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148806">if</span>&nbsp;<span class="ident" id="6148809">nb</span>&nbsp;<span class="op" id="6148812">==</span>&nbsp;<span class="num" id="6148815">1</span>&nbsp;<span class="op" id="6148817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148823">return</span>&nbsp;<span class="num" id="6148830">0</span><span class="op" id="6148831">,</span>&nbsp;<span class="num" id="6148833">0</span><span class="op" id="6148834">,</span>&nbsp;<span class="ident" id="6148836">CorruptInputError</span><span class="op" id="6148853">(</span><span class="builtinfunc" id="6148854">len</span><span class="op" id="6148857">(</span><span class="ident" id="6148858">src</span><span class="op" id="6148861">)</span><span class="op" id="6148862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6148867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148872">for</span>&nbsp;<span class="ident" id="6148876">i</span>&nbsp;<span class="op" id="6148878">:=</span>&nbsp;<span class="ident" id="6148881">nb</span><span class="op" id="6148883">;</span>&nbsp;<span class="ident" id="6148885">i</span>&nbsp;<span class="op" id="6148887">&lt;</span>&nbsp;<span class="num" id="6148889">5</span><span class="op" id="6148890">;</span>&nbsp;<span class="ident" id="6148892">i</span><span class="op" id="6148893">++</span>&nbsp;<span class="op" id="6148896">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6148902">//&nbsp;The&nbsp;short&nbsp;encoding&nbsp;truncated&nbsp;the&nbsp;output&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6148956">//&nbsp;We&nbsp;have&nbsp;to&nbsp;assume&nbsp;the&nbsp;worst&nbsp;case&nbsp;values&nbsp;(digit&nbsp;84)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6149014">//&nbsp;in&nbsp;order&nbsp;to&nbsp;ensure&nbsp;that&nbsp;the&nbsp;top&nbsp;bits&nbsp;are&nbsp;correct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149071">v</span>&nbsp;<span class="op" id="6149073">=</span>&nbsp;<span class="ident" id="6149075">v</span><span class="op" id="6149076">*</span><span class="num" id="6149077">85</span>&nbsp;<span class="op" id="6149080">+</span>&nbsp;<span class="num" id="6149082">84</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6149088">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149093">for</span>&nbsp;<span class="ident" id="6149097">i</span>&nbsp;<span class="op" id="6149099">:=</span>&nbsp;<span class="num" id="6149102">0</span><span class="op" id="6149103">;</span>&nbsp;<span class="ident" id="6149105">i</span>&nbsp;<span class="op" id="6149107">&lt;</span>&nbsp;<span class="ident" id="6149109">nb</span><span class="op" id="6149111">-</span><span class="num" id="6149112">1</span><span class="op" id="6149113">;</span>&nbsp;<span class="ident" id="6149115">i</span><span class="op" id="6149116">++</span>&nbsp;<span class="op" id="6149119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149125">dst</span><span class="op" id="6149128">[</span><span class="ident" id="6149129">ndst</span><span class="op" id="6149133">]</span>&nbsp;<span class="op" id="6149135">=</span>&nbsp;<span class="builtintype" id="6149137">byte</span><span class="op" id="6149141">(</span><span class="ident" id="6149142">v</span>&nbsp;<span class="op" id="6149144">&gt;&gt;</span>&nbsp;<span class="num" id="6149147">24</span><span class="op" id="6149149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149155">v</span>&nbsp;<span class="op" id="6149157">&lt;&lt;=</span>&nbsp;<span class="num" id="6149161">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149167">ndst</span><span class="op" id="6149171">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6149177">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6149181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6149184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149187">return</span><br>
<span class="lineno"></span><span class="op" id="6149194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="6149197">//&nbsp;NewDecoder&nbsp;constructs&nbsp;a&nbsp;new&nbsp;ascii85&nbsp;stream&nbsp;decoder.</span><br>
<span class="lineno"></span><span class="keyword" id="6149252">func</span>&nbsp;<span class="ident" id="6149257">NewDecoder</span><span class="op" id="6149267">(</span><span class="ident" id="6149268">r</span>&nbsp;<span class="ident" id="6149270">io</span><span class="op" id="6149272">.</span><span class="ident" id="6149273">Reader</span><span class="op" id="6149279">)</span>&nbsp;<span class="ident" id="6149281">io</span><span class="op" id="6149283">.</span><span class="ident" id="6149284">Reader</span>&nbsp;<span class="op" id="6149291">{</span>&nbsp;<span class="keyword" id="6149293">return</span>&nbsp;<span class="op" id="6149300">&amp;</span><span class="ident" id="6149301">decoder</span><span class="op" id="6149308">{</span><span class="ident" id="6149309">r</span><span class="op" id="6149310">:</span>&nbsp;<span class="ident" id="6149312">r</span><span class="op" id="6149313">}</span>&nbsp;<span class="op" id="6149315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6149318">type</span>&nbsp;<span class="ident" id="6149323">decoder</span>&nbsp;<span class="keyword" id="6149331">struct</span>&nbsp;<span class="op" id="6149338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149341">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6149349">error</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149356">readErr</span>&nbsp;<span class="builtintype" id="6149364">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149371">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6149379">io</span><span class="op" id="6149381">.</span><span class="ident" id="6149382">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149390">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6149398">[</span><span class="num" id="6149399">1024</span><span class="op" id="6149403">]</span><span class="builtintype" id="6149404">byte</span>&nbsp;<span class="comment" id="6149409">//&nbsp;leftover&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149428">nbuf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6149436">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149441">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6149449">[</span><span class="op" id="6149450">]</span><span class="builtintype" id="6149451">byte</span>&nbsp;<span class="comment" id="6149456">//&nbsp;leftover&nbsp;decoded&nbsp;output</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149484">outbuf</span>&nbsp;&nbsp;<span class="op" id="6149492">[</span><span class="num" id="6149493">1024</span><span class="op" id="6149497">]</span><span class="builtintype" id="6149498">byte</span><br>
<span class="lineno"></span><span class="op" id="6149503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6149506">func</span>&nbsp;<span class="op" id="6149511">(</span><span class="ident" id="6149512">d</span>&nbsp;<span class="op" id="6149514">*</span><span class="ident" id="6149515">decoder</span><span class="op" id="6149522">)</span>&nbsp;<span class="ident" id="6149524">Read</span><span class="op" id="6149528">(</span><span class="ident" id="6149529">p</span>&nbsp;<span class="op" id="6149531">[</span><span class="op" id="6149532">]</span><span class="builtintype" id="6149533">byte</span><span class="op" id="6149537">)</span>&nbsp;<span class="op" id="6149539">(</span><span class="ident" id="6149540">n</span>&nbsp;<span class="builtintype" id="6149542">int</span><span class="op" id="6149545">,</span>&nbsp;<span class="ident" id="6149547">err</span>&nbsp;<span class="builtintype" id="6149551">error</span><span class="op" id="6149556">)</span>&nbsp;<span class="op" id="6149558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149561">if</span>&nbsp;<span class="builtinfunc" id="6149564">len</span><span class="op" id="6149567">(</span><span class="ident" id="6149568">p</span><span class="op" id="6149569">)</span>&nbsp;<span class="op" id="6149571">==</span>&nbsp;<span class="num" id="6149574">0</span>&nbsp;<span class="op" id="6149576">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149580">return</span>&nbsp;<span class="num" id="6149587">0</span><span class="op" id="6149588">,</span>&nbsp;<span class="ident" id="6149590">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6149595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149598">if</span>&nbsp;<span class="ident" id="6149601">d</span><span class="op" id="6149602">.</span><span class="ident" id="6149603">err</span>&nbsp;<span class="op" id="6149607">!=</span>&nbsp;<span class="ident" id="6149610">nil</span>&nbsp;<span class="op" id="6149614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149618">return</span>&nbsp;<span class="num" id="6149625">0</span><span class="op" id="6149626">,</span>&nbsp;<span class="ident" id="6149628">d</span><span class="op" id="6149629">.</span><span class="ident" id="6149630">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6149635">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149639">for</span>&nbsp;<span class="op" id="6149643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6149647">//&nbsp;Copy&nbsp;leftover&nbsp;output&nbsp;from&nbsp;last&nbsp;decode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149691">if</span>&nbsp;<span class="builtinfunc" id="6149694">len</span><span class="op" id="6149697">(</span><span class="ident" id="6149698">d</span><span class="op" id="6149699">.</span><span class="ident" id="6149700">out</span><span class="op" id="6149703">)</span>&nbsp;<span class="op" id="6149705">&gt;</span>&nbsp;<span class="num" id="6149707">0</span>&nbsp;<span class="op" id="6149709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149714">n</span>&nbsp;<span class="op" id="6149716">=</span>&nbsp;<span class="builtinfunc" id="6149718">copy</span><span class="op" id="6149722">(</span><span class="ident" id="6149723">p</span><span class="op" id="6149724">,</span>&nbsp;<span class="ident" id="6149726">d</span><span class="op" id="6149727">.</span><span class="ident" id="6149728">out</span><span class="op" id="6149731">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149736">d</span><span class="op" id="6149737">.</span><span class="ident" id="6149738">out</span>&nbsp;<span class="op" id="6149742">=</span>&nbsp;<span class="ident" id="6149744">d</span><span class="op" id="6149745">.</span><span class="ident" id="6149746">out</span><span class="op" id="6149749">[</span><span class="ident" id="6149750">n</span><span class="op" id="6149751">:</span><span class="op" id="6149752">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149757">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6149766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6149771">//&nbsp;Decode&nbsp;leftover&nbsp;input&nbsp;from&nbsp;last&nbsp;read.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149814">var</span>&nbsp;<span class="ident" id="6149818">nn</span><span class="op" id="6149820">,</span>&nbsp;<span class="ident" id="6149822">nsrc</span><span class="op" id="6149826">,</span>&nbsp;<span class="ident" id="6149828">ndst</span>&nbsp;<span class="builtintype" id="6149833">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149839">if</span>&nbsp;<span class="ident" id="6149842">d</span><span class="op" id="6149843">.</span><span class="ident" id="6149844">nbuf</span>&nbsp;<span class="op" id="6149849">&gt;</span>&nbsp;<span class="num" id="6149851">0</span>&nbsp;<span class="op" id="6149853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149858">ndst</span><span class="op" id="6149862">,</span>&nbsp;<span class="ident" id="6149864">nsrc</span><span class="op" id="6149868">,</span>&nbsp;<span class="ident" id="6149870">d</span><span class="op" id="6149871">.</span><span class="ident" id="6149872">err</span>&nbsp;<span class="op" id="6149876">=</span>&nbsp;<span class="ident" id="6149878">Decode</span><span class="op" id="6149884">(</span><span class="ident" id="6149885">d</span><span class="op" id="6149886">.</span><span class="ident" id="6149887">outbuf</span><span class="op" id="6149893">[</span><span class="num" id="6149894">0</span><span class="op" id="6149895">:</span><span class="op" id="6149896">]</span><span class="op" id="6149897">,</span>&nbsp;<span class="ident" id="6149899">d</span><span class="op" id="6149900">.</span><span class="ident" id="6149901">buf</span><span class="op" id="6149904">[</span><span class="num" id="6149905">0</span><span class="op" id="6149906">:</span><span class="ident" id="6149907">d</span><span class="op" id="6149908">.</span><span class="ident" id="6149909">nbuf</span><span class="op" id="6149913">]</span><span class="op" id="6149914">,</span>&nbsp;<span class="ident" id="6149916">d</span><span class="op" id="6149917">.</span><span class="ident" id="6149918">readErr</span>&nbsp;<span class="op" id="6149926">!=</span>&nbsp;<span class="ident" id="6149929">nil</span><span class="op" id="6149932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149937">if</span>&nbsp;<span class="ident" id="6149940">ndst</span>&nbsp;<span class="op" id="6149945">&gt;</span>&nbsp;<span class="num" id="6149947">0</span>&nbsp;<span class="op" id="6149949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149955">d</span><span class="op" id="6149956">.</span><span class="ident" id="6149957">out</span>&nbsp;<span class="op" id="6149961">=</span>&nbsp;<span class="ident" id="6149963">d</span><span class="op" id="6149964">.</span><span class="ident" id="6149965">outbuf</span><span class="op" id="6149971">[</span><span class="num" id="6149972">0</span><span class="op" id="6149973">:</span><span class="ident" id="6149974">ndst</span><span class="op" id="6149978">]</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149984">d</span><span class="op" id="6149985">.</span><span class="ident" id="6149986">nbuf</span>&nbsp;<span class="op" id="6149991">=</span>&nbsp;<span class="builtinfunc" id="6149993">copy</span><span class="op" id="6149997">(</span><span class="ident" id="6149998">d</span><span class="op" id="6149999">.</span><span class="ident" id="6150000">buf</span><span class="op" id="6150003">[</span><span class="num" id="6150004">0</span><span class="op" id="6150005">:</span><span class="op" id="6150006">]</span><span class="op" id="6150007">,</span>&nbsp;<span class="ident" id="6150009">d</span><span class="op" id="6150010">.</span><span class="ident" id="6150011">buf</span><span class="op" id="6150014">[</span><span class="ident" id="6150015">nsrc</span><span class="op" id="6150019">:</span><span class="ident" id="6150020">d</span><span class="op" id="6150021">.</span><span class="ident" id="6150022">nbuf</span><span class="op" id="6150026">]</span><span class="op" id="6150027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6150033">continue</span>&nbsp;<span class="comment" id="6150042">//&nbsp;copy&nbsp;out&nbsp;and&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6150068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6150073">if</span>&nbsp;<span class="ident" id="6150076">ndst</span>&nbsp;<span class="op" id="6150081">==</span>&nbsp;<span class="num" id="6150084">0</span>&nbsp;<span class="op" id="6150086">&amp;&amp;</span>&nbsp;<span class="ident" id="6150089">d</span><span class="op" id="6150090">.</span><span class="ident" id="6150091">err</span>&nbsp;<span class="op" id="6150095">==</span>&nbsp;<span class="ident" id="6150098">nil</span>&nbsp;<span class="op" id="6150102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6150108">//&nbsp;Special&nbsp;case:&nbsp;input&nbsp;buffer&nbsp;is&nbsp;mostly&nbsp;filled&nbsp;with&nbsp;non-data&nbsp;bytes.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6150180">//&nbsp;Filter&nbsp;out&nbsp;such&nbsp;bytes&nbsp;to&nbsp;make&nbsp;room&nbsp;for&nbsp;more&nbsp;input.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150238">off</span>&nbsp;<span class="op" id="6150242">:=</span>&nbsp;<span class="num" id="6150245">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6150251">for</span>&nbsp;<span class="ident" id="6150255">i</span>&nbsp;<span class="op" id="6150257">:=</span>&nbsp;<span class="num" id="6150260">0</span><span class="op" id="6150261">;</span>&nbsp;<span class="ident" id="6150263">i</span>&nbsp;<span class="op" id="6150265">&lt;</span>&nbsp;<span class="ident" id="6150267">d</span><span class="op" id="6150268">.</span><span class="ident" id="6150269">nbuf</span><span class="op" id="6150273">;</span>&nbsp;<span class="ident" id="6150275">i</span><span class="op" id="6150276">++</span>&nbsp;<span class="op" id="6150279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6150286">if</span>&nbsp;<span class="ident" id="6150289">d</span><span class="op" id="6150290">.</span><span class="ident" id="6150291">buf</span><span class="op" id="6150294">[</span><span class="ident" id="6150295">i</span><span class="op" id="6150296">]</span>&nbsp;<span class="op" id="6150298">&gt;</span>&nbsp;<span class="string" id="6150300">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="6150304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150312">d</span><span class="op" id="6150313">.</span><span class="ident" id="6150314">buf</span><span class="op" id="6150317">[</span><span class="ident" id="6150318">off</span><span class="op" id="6150321">]</span>&nbsp;<span class="op" id="6150323">=</span>&nbsp;<span class="ident" id="6150325">d</span><span class="op" id="6150326">.</span><span class="ident" id="6150327">buf</span><span class="op" id="6150330">[</span><span class="ident" id="6150331">i</span><span class="op" id="6150332">]</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150340">off</span><span class="op" id="6150343">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6150351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6150357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150363">d</span><span class="op" id="6150364">.</span><span class="ident" id="6150365">nbuf</span>&nbsp;<span class="op" id="6150370">=</span>&nbsp;<span class="ident" id="6150372">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6150379">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6150383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6150388">//&nbsp;Out&nbsp;of&nbsp;input,&nbsp;out&nbsp;of&nbsp;decoded&nbsp;output.&nbsp;&nbsp;Check&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6150445">if</span>&nbsp;<span class="ident" id="6150448">d</span><span class="op" id="6150449">.</span><span class="ident" id="6150450">err</span>&nbsp;<span class="op" id="6150454">!=</span>&nbsp;<span class="ident" id="6150457">nil</span>&nbsp;<span class="op" id="6150461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6150466">return</span>&nbsp;<span class="num" id="6150473">0</span><span class="op" id="6150474">,</span>&nbsp;<span class="ident" id="6150476">d</span><span class="op" id="6150477">.</span><span class="ident" id="6150478">err</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6150484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6150488">if</span>&nbsp;<span class="ident" id="6150491">d</span><span class="op" id="6150492">.</span><span class="ident" id="6150493">readErr</span>&nbsp;<span class="op" id="6150501">!=</span>&nbsp;<span class="ident" id="6150504">nil</span>&nbsp;<span class="op" id="6150508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150513">d</span><span class="op" id="6150514">.</span><span class="ident" id="6150515">err</span>&nbsp;<span class="op" id="6150519">=</span>&nbsp;<span class="ident" id="6150521">d</span><span class="op" id="6150522">.</span><span class="ident" id="6150523">readErr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6150534">return</span>&nbsp;<span class="num" id="6150541">0</span><span class="op" id="6150542">,</span>&nbsp;<span class="ident" id="6150544">d</span><span class="op" id="6150545">.</span><span class="ident" id="6150546">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6150552">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6150557">//&nbsp;Read&nbsp;more&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150578">nn</span><span class="op" id="6150580">,</span>&nbsp;<span class="ident" id="6150582">d</span><span class="op" id="6150583">.</span><span class="ident" id="6150584">readErr</span>&nbsp;<span class="op" id="6150592">=</span>&nbsp;<span class="ident" id="6150594">d</span><span class="op" id="6150595">.</span><span class="ident" id="6150596">r</span><span class="op" id="6150597">.</span><span class="ident" id="6150598">Read</span><span class="op" id="6150602">(</span><span class="ident" id="6150603">d</span><span class="op" id="6150604">.</span><span class="ident" id="6150605">buf</span><span class="op" id="6150608">[</span><span class="ident" id="6150609">d</span><span class="op" id="6150610">.</span><span class="ident" id="6150611">nbuf</span><span class="op" id="6150615">:</span><span class="op" id="6150616">]</span><span class="op" id="6150617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150621">d</span><span class="op" id="6150622">.</span><span class="ident" id="6150623">nbuf</span>&nbsp;<span class="op" id="6150628">+=</span>&nbsp;<span class="ident" id="6150631">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6150635">}</span><br>
<span class="lineno">310</span><span class="op" id="6150637">}</span>
</div>
</body>
</html>
