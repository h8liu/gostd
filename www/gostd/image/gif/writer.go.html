<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6079935">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6079990">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6080044">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6080095">package</span>&nbsp;<span class="ident" id="6080103">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6080108">import</span>&nbsp;<span class="op" id="6080115">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6080118">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6080127">&#34;compress/lzw&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6080143">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6080153">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6080162">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6080177">&#34;image/color/palette&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6080200">&#34;image/draw&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6080214">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="6080219">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6080222">//&nbsp;Graphic&nbsp;control&nbsp;extension&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="6080259">const</span>&nbsp;<span class="op" id="6080265">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6080268">gcLabel</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6080280">=</span>&nbsp;<span class="num" id="6080282">0xF9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6080288">gcBlockSize</span>&nbsp;<span class="op" id="6080300">=</span>&nbsp;<span class="num" id="6080302">0x04</span><br>
<span class="lineno"></span><span class="op" id="6080307">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6080310">var</span>&nbsp;<span class="ident" id="6080314">log2Lookup</span>&nbsp;<span class="op" id="6080325">=</span>&nbsp;<span class="op" id="6080327">[</span><span class="num" id="6080328">8</span><span class="op" id="6080329">]</span><span class="builtintype" id="6080330">int</span><span class="op" id="6080333">{</span><span class="num" id="6080334">2</span><span class="op" id="6080335">,</span>&nbsp;<span class="num" id="6080337">4</span><span class="op" id="6080338">,</span>&nbsp;<span class="num" id="6080340">8</span><span class="op" id="6080341">,</span>&nbsp;<span class="num" id="6080343">16</span><span class="op" id="6080345">,</span>&nbsp;<span class="num" id="6080347">32</span><span class="op" id="6080349">,</span>&nbsp;<span class="num" id="6080351">64</span><span class="op" id="6080353">,</span>&nbsp;<span class="num" id="6080355">128</span><span class="op" id="6080358">,</span>&nbsp;<span class="num" id="6080360">256</span><span class="op" id="6080363">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="6080366">func</span>&nbsp;<span class="ident" id="6080371">log2</span><span class="op" id="6080375">(</span><span class="ident" id="6080376">x</span>&nbsp;<span class="builtintype" id="6080378">int</span><span class="op" id="6080381">)</span>&nbsp;<span class="builtintype" id="6080383">int</span>&nbsp;<span class="op" id="6080387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6080390">for</span>&nbsp;<span class="ident" id="6080394">i</span><span class="op" id="6080395">,</span>&nbsp;<span class="ident" id="6080397">v</span>&nbsp;<span class="op" id="6080399">:=</span>&nbsp;<span class="keyword" id="6080402">range</span>&nbsp;<span class="ident" id="6080408">log2Lookup</span>&nbsp;<span class="op" id="6080419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6080423">if</span>&nbsp;<span class="ident" id="6080426">x</span>&nbsp;<span class="op" id="6080428">&lt;=</span>&nbsp;<span class="ident" id="6080431">v</span>&nbsp;<span class="op" id="6080433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6080438">return</span>&nbsp;<span class="ident" id="6080445">i</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6080449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6080452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6080455">return</span>&nbsp;<span class="op" id="6080462">-</span><span class="num" id="6080463">1</span><br>
<span class="lineno"></span><span class="op" id="6080465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="6080468">//&nbsp;Little-endian.</span><br>
<span class="lineno"></span><span class="keyword" id="6080486">func</span>&nbsp;<span class="ident" id="6080491">writeUint16</span><span class="op" id="6080502">(</span><span class="ident" id="6080503">b</span>&nbsp;<span class="op" id="6080505">[</span><span class="op" id="6080506">]</span><span class="builtintype" id="6080507">uint8</span><span class="op" id="6080512">,</span>&nbsp;<span class="ident" id="6080514">u</span>&nbsp;<span class="builtintype" id="6080516">uint16</span><span class="op" id="6080522">)</span>&nbsp;<span class="op" id="6080524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6080527">b</span><span class="op" id="6080528">[</span><span class="num" id="6080529">0</span><span class="op" id="6080530">]</span>&nbsp;<span class="op" id="6080532">=</span>&nbsp;<span class="builtintype" id="6080534">uint8</span><span class="op" id="6080539">(</span><span class="ident" id="6080540">u</span><span class="op" id="6080541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6080544">b</span><span class="op" id="6080545">[</span><span class="num" id="6080546">1</span><span class="op" id="6080547">]</span>&nbsp;<span class="op" id="6080549">=</span>&nbsp;<span class="builtintype" id="6080551">uint8</span><span class="op" id="6080556">(</span><span class="ident" id="6080557">u</span>&nbsp;<span class="op" id="6080559">&gt;&gt;</span>&nbsp;<span class="num" id="6080562">8</span><span class="op" id="6080563">)</span><br>
<span class="lineno"></span><span class="op" id="6080565">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="6080568">//&nbsp;writer&nbsp;is&nbsp;a&nbsp;buffered&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="6080600">type</span>&nbsp;<span class="ident" id="6080605">writer</span>&nbsp;<span class="keyword" id="6080612">interface</span>&nbsp;<span class="op" id="6080622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6080625">Flush</span><span class="op" id="6080630">(</span><span class="op" id="6080631">)</span>&nbsp;<span class="builtintype" id="6080633">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6080640">io</span><span class="op" id="6080642">.</span><span class="ident" id="6080643">Writer</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6080651">io</span><span class="op" id="6080653">.</span><span class="ident" id="6080654">ByteWriter</span><br>
<span class="lineno"></span><span class="op" id="6080665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6080668">//&nbsp;encoder&nbsp;encodes&nbsp;an&nbsp;image&nbsp;to&nbsp;the&nbsp;GIF&nbsp;format.</span><br>
<span class="lineno"></span><span class="keyword" id="6080715">type</span>&nbsp;<span class="ident" id="6080720">encoder</span>&nbsp;<span class="keyword" id="6080728">struct</span>&nbsp;<span class="op" id="6080735">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6080738">//&nbsp;w&nbsp;is&nbsp;the&nbsp;writer&nbsp;to&nbsp;write&nbsp;to.&nbsp;err&nbsp;is&nbsp;the&nbsp;first&nbsp;error&nbsp;encountered&nbsp;during</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6080813">//&nbsp;writing.&nbsp;All&nbsp;attempted&nbsp;writes&nbsp;after&nbsp;the&nbsp;first&nbsp;error&nbsp;become&nbsp;no-ops.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6080884">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6080888">writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6080896">err</span>&nbsp;<span class="builtintype" id="6080900">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6080907">//&nbsp;g&nbsp;is&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;data&nbsp;that&nbsp;is&nbsp;being&nbsp;encoded.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6080963">g</span>&nbsp;<span class="op" id="6080965">*</span><span class="ident" id="6080966">GIF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6080971">//&nbsp;buf&nbsp;is&nbsp;a&nbsp;scratch&nbsp;buffer.&nbsp;It&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;768&nbsp;so&nbsp;we&nbsp;can&nbsp;write&nbsp;the&nbsp;color&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6081055">buf</span>&nbsp;<span class="op" id="6081059">[</span><span class="num" id="6081060">1024</span><span class="op" id="6081064">]</span><span class="builtintype" id="6081065">byte</span><br>
<span class="lineno"></span><span class="op" id="6081070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="6081073">//&nbsp;blockWriter&nbsp;writes&nbsp;the&nbsp;block&nbsp;structure&nbsp;of&nbsp;GIF&nbsp;image&nbsp;data,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="6081140">//&nbsp;comprises&nbsp;(n,&nbsp;(n&nbsp;bytes))&nbsp;blocks,&nbsp;with&nbsp;1&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;255.&nbsp;It&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6081206">//&nbsp;writer&nbsp;given&nbsp;to&nbsp;the&nbsp;LZW&nbsp;encoder,&nbsp;which&nbsp;is&nbsp;thus&nbsp;immune&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6081270">//&nbsp;blocking.</span><br>
<span class="lineno"></span><span class="keyword" id="6081283">type</span>&nbsp;<span class="ident" id="6081288">blockWriter</span>&nbsp;<span class="keyword" id="6081300">struct</span>&nbsp;<span class="op" id="6081307">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6081310">e</span>&nbsp;<span class="op" id="6081312">*</span><span class="ident" id="6081313">encoder</span><br>
<span class="lineno"></span><span class="op" id="6081321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6081324">func</span>&nbsp;<span class="op" id="6081329">(</span><span class="ident" id="6081330">b</span>&nbsp;<span class="ident" id="6081332">blockWriter</span><span class="op" id="6081343">)</span>&nbsp;<span class="ident" id="6081345">Write</span><span class="op" id="6081350">(</span><span class="ident" id="6081351">data</span>&nbsp;<span class="op" id="6081356">[</span><span class="op" id="6081357">]</span><span class="builtintype" id="6081358">byte</span><span class="op" id="6081362">)</span>&nbsp;<span class="op" id="6081364">(</span><span class="builtintype" id="6081365">int</span><span class="op" id="6081368">,</span>&nbsp;<span class="builtintype" id="6081370">error</span><span class="op" id="6081375">)</span>&nbsp;<span class="op" id="6081377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6081380">if</span>&nbsp;<span class="ident" id="6081383">b</span><span class="op" id="6081384">.</span><span class="ident" id="6081385">e</span><span class="op" id="6081386">.</span><span class="ident" id="6081387">err</span>&nbsp;<span class="op" id="6081391">!=</span>&nbsp;<span class="builtintype" id="6081394">nil</span>&nbsp;<span class="op" id="6081398">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6081402">return</span>&nbsp;<span class="num" id="6081409">0</span><span class="op" id="6081410">,</span>&nbsp;<span class="ident" id="6081412">b</span><span class="op" id="6081413">.</span><span class="ident" id="6081414">e</span><span class="op" id="6081415">.</span><span class="ident" id="6081416">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6081421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6081424">if</span>&nbsp;<span class="builtinfunc" id="6081427">len</span><span class="op" id="6081430">(</span><span class="ident" id="6081431">data</span><span class="op" id="6081435">)</span>&nbsp;<span class="op" id="6081437">==</span>&nbsp;<span class="num" id="6081440">0</span>&nbsp;<span class="op" id="6081442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6081446">return</span>&nbsp;<span class="num" id="6081453">0</span><span class="op" id="6081454">,</span>&nbsp;<span class="builtintype" id="6081456">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6081461">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6081464">total</span>&nbsp;<span class="op" id="6081470">:=</span>&nbsp;<span class="num" id="6081473">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6081476">for</span>&nbsp;<span class="ident" id="6081480">total</span>&nbsp;<span class="op" id="6081486">&lt;</span>&nbsp;<span class="builtinfunc" id="6081488">len</span><span class="op" id="6081491">(</span><span class="ident" id="6081492">data</span><span class="op" id="6081496">)</span>&nbsp;<span class="op" id="6081498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6081502">n</span>&nbsp;<span class="op" id="6081504">:=</span>&nbsp;<span class="builtinfunc" id="6081507">copy</span><span class="op" id="6081511">(</span><span class="ident" id="6081512">b</span><span class="op" id="6081513">.</span><span class="ident" id="6081514">e</span><span class="op" id="6081515">.</span><span class="ident" id="6081516">buf</span><span class="op" id="6081519">[</span><span class="num" id="6081520">1</span><span class="op" id="6081521">:</span><span class="num" id="6081522">256</span><span class="op" id="6081525">]</span><span class="op" id="6081526">,</span>&nbsp;<span class="ident" id="6081528">data</span><span class="op" id="6081532">[</span><span class="ident" id="6081533">total</span><span class="op" id="6081538">:</span><span class="op" id="6081539">]</span><span class="op" id="6081540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6081544">total</span>&nbsp;<span class="op" id="6081550">+=</span>&nbsp;<span class="ident" id="6081553">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6081557">b</span><span class="op" id="6081558">.</span><span class="ident" id="6081559">e</span><span class="op" id="6081560">.</span><span class="ident" id="6081561">buf</span><span class="op" id="6081564">[</span><span class="num" id="6081565">0</span><span class="op" id="6081566">]</span>&nbsp;<span class="op" id="6081568">=</span>&nbsp;<span class="builtintype" id="6081570">uint8</span><span class="op" id="6081575">(</span><span class="ident" id="6081576">n</span><span class="op" id="6081577">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6081582">n</span><span class="op" id="6081583">,</span>&nbsp;<span class="ident" id="6081585">b</span><span class="op" id="6081586">.</span><span class="ident" id="6081587">e</span><span class="op" id="6081588">.</span><span class="ident" id="6081589">err</span>&nbsp;<span class="op" id="6081593">=</span>&nbsp;<span class="ident" id="6081595">b</span><span class="op" id="6081596">.</span><span class="ident" id="6081597">e</span><span class="op" id="6081598">.</span><span class="ident" id="6081599">w</span><span class="op" id="6081600">.</span><span class="ident" id="6081601">Write</span><span class="op" id="6081606">(</span><span class="ident" id="6081607">b</span><span class="op" id="6081608">.</span><span class="ident" id="6081609">e</span><span class="op" id="6081610">.</span><span class="ident" id="6081611">buf</span><span class="op" id="6081614">[</span><span class="op" id="6081615">:</span><span class="ident" id="6081616">n</span><span class="op" id="6081617">+</span><span class="num" id="6081618">1</span><span class="op" id="6081619">]</span><span class="op" id="6081620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6081624">if</span>&nbsp;<span class="ident" id="6081627">b</span><span class="op" id="6081628">.</span><span class="ident" id="6081629">e</span><span class="op" id="6081630">.</span><span class="ident" id="6081631">err</span>&nbsp;<span class="op" id="6081635">!=</span>&nbsp;<span class="builtintype" id="6081638">nil</span>&nbsp;<span class="op" id="6081642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6081647">return</span>&nbsp;<span class="num" id="6081654">0</span><span class="op" id="6081655">,</span>&nbsp;<span class="ident" id="6081657">b</span><span class="op" id="6081658">.</span><span class="ident" id="6081659">e</span><span class="op" id="6081660">.</span><span class="ident" id="6081661">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6081667">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6081670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6081673">return</span>&nbsp;<span class="ident" id="6081680">total</span><span class="op" id="6081685">,</span>&nbsp;<span class="ident" id="6081687">b</span><span class="op" id="6081688">.</span><span class="ident" id="6081689">e</span><span class="op" id="6081690">.</span><span class="ident" id="6081691">err</span><br>
<span class="lineno"></span><span class="op" id="6081695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6081698">func</span>&nbsp;<span class="op" id="6081703">(</span><span class="ident" id="6081704">e</span>&nbsp;<span class="op" id="6081706">*</span><span class="ident" id="6081707">encoder</span><span class="op" id="6081714">)</span>&nbsp;<span class="ident" id="6081716">flush</span><span class="op" id="6081721">(</span><span class="op" id="6081722">)</span>&nbsp;<span class="op" id="6081724">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6081727">if</span>&nbsp;<span class="ident" id="6081730">e</span><span class="op" id="6081731">.</span><span class="ident" id="6081732">err</span>&nbsp;<span class="op" id="6081736">!=</span>&nbsp;<span class="builtintype" id="6081739">nil</span>&nbsp;<span class="op" id="6081743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6081747">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6081755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6081758">e</span><span class="op" id="6081759">.</span><span class="ident" id="6081760">err</span>&nbsp;<span class="op" id="6081764">=</span>&nbsp;<span class="ident" id="6081766">e</span><span class="op" id="6081767">.</span><span class="ident" id="6081768">w</span><span class="op" id="6081769">.</span><span class="ident" id="6081770">Flush</span><span class="op" id="6081775">(</span><span class="op" id="6081776">)</span><br>
<span class="lineno"></span><span class="op" id="6081778">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="6081781">func</span>&nbsp;<span class="op" id="6081786">(</span><span class="ident" id="6081787">e</span>&nbsp;<span class="op" id="6081789">*</span><span class="ident" id="6081790">encoder</span><span class="op" id="6081797">)</span>&nbsp;<span class="ident" id="6081799">write</span><span class="op" id="6081804">(</span><span class="ident" id="6081805">p</span>&nbsp;<span class="op" id="6081807">[</span><span class="op" id="6081808">]</span><span class="builtintype" id="6081809">byte</span><span class="op" id="6081813">)</span>&nbsp;<span class="op" id="6081815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6081818">if</span>&nbsp;<span class="ident" id="6081821">e</span><span class="op" id="6081822">.</span><span class="ident" id="6081823">err</span>&nbsp;<span class="op" id="6081827">!=</span>&nbsp;<span class="builtintype" id="6081830">nil</span>&nbsp;<span class="op" id="6081834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6081838">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6081846">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6081849">_</span><span class="op" id="6081850">,</span>&nbsp;<span class="ident" id="6081852">e</span><span class="op" id="6081853">.</span><span class="ident" id="6081854">err</span>&nbsp;<span class="op" id="6081858">=</span>&nbsp;<span class="ident" id="6081860">e</span><span class="op" id="6081861">.</span><span class="ident" id="6081862">w</span><span class="op" id="6081863">.</span><span class="ident" id="6081864">Write</span><span class="op" id="6081869">(</span><span class="ident" id="6081870">p</span><span class="op" id="6081871">)</span><br>
<span class="lineno"></span><span class="op" id="6081873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6081876">func</span>&nbsp;<span class="op" id="6081881">(</span><span class="ident" id="6081882">e</span>&nbsp;<span class="op" id="6081884">*</span><span class="ident" id="6081885">encoder</span><span class="op" id="6081892">)</span>&nbsp;<span class="ident" id="6081894">writeByte</span><span class="op" id="6081903">(</span><span class="ident" id="6081904">b</span>&nbsp;<span class="builtintype" id="6081906">byte</span><span class="op" id="6081910">)</span>&nbsp;<span class="op" id="6081912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6081915">if</span>&nbsp;<span class="ident" id="6081918">e</span><span class="op" id="6081919">.</span><span class="ident" id="6081920">err</span>&nbsp;<span class="op" id="6081924">!=</span>&nbsp;<span class="builtintype" id="6081927">nil</span>&nbsp;<span class="op" id="6081931">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6081935">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6081943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6081946">e</span><span class="op" id="6081947">.</span><span class="ident" id="6081948">err</span>&nbsp;<span class="op" id="6081952">=</span>&nbsp;<span class="ident" id="6081954">e</span><span class="op" id="6081955">.</span><span class="ident" id="6081956">w</span><span class="op" id="6081957">.</span><span class="ident" id="6081958">WriteByte</span><span class="op" id="6081967">(</span><span class="ident" id="6081968">b</span><span class="op" id="6081969">)</span><br>
<span class="lineno"></span><span class="op" id="6081971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="6081974">func</span>&nbsp;<span class="op" id="6081979">(</span><span class="ident" id="6081980">e</span>&nbsp;<span class="op" id="6081982">*</span><span class="ident" id="6081983">encoder</span><span class="op" id="6081990">)</span>&nbsp;<span class="ident" id="6081992">writeHeader</span><span class="op" id="6082003">(</span><span class="op" id="6082004">)</span>&nbsp;<span class="op" id="6082006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6082009">if</span>&nbsp;<span class="ident" id="6082012">e</span><span class="op" id="6082013">.</span><span class="ident" id="6082014">err</span>&nbsp;<span class="op" id="6082018">!=</span>&nbsp;<span class="builtintype" id="6082021">nil</span>&nbsp;<span class="op" id="6082025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6082029">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6082037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6082040">_</span><span class="op" id="6082041">,</span>&nbsp;<span class="ident" id="6082043">e</span><span class="op" id="6082044">.</span><span class="ident" id="6082045">err</span>&nbsp;<span class="op" id="6082049">=</span>&nbsp;<span class="ident" id="6082051">io</span><span class="op" id="6082053">.</span><span class="ident" id="6082054">WriteString</span><span class="op" id="6082065">(</span><span class="ident" id="6082066">e</span><span class="op" id="6082067">.</span><span class="ident" id="6082068">w</span><span class="op" id="6082069">,</span>&nbsp;<span class="string" id="6082071">&#34;GIF89a&#34;</span><span class="op" id="6082079">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6082082">if</span>&nbsp;<span class="ident" id="6082085">e</span><span class="op" id="6082086">.</span><span class="ident" id="6082087">err</span>&nbsp;<span class="op" id="6082091">!=</span>&nbsp;<span class="builtintype" id="6082094">nil</span>&nbsp;<span class="op" id="6082098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6082102">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6082110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6082114">pm</span>&nbsp;<span class="op" id="6082117">:=</span>&nbsp;<span class="ident" id="6082120">e</span><span class="op" id="6082121">.</span><span class="ident" id="6082122">g</span><span class="op" id="6082123">.</span><span class="ident" id="6082124">Image</span><span class="op" id="6082129">[</span><span class="num" id="6082130">0</span><span class="op" id="6082131">]</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6082134">//&nbsp;Logical&nbsp;screen&nbsp;width&nbsp;and&nbsp;height.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6082171">writeUint16</span><span class="op" id="6082182">(</span><span class="ident" id="6082183">e</span><span class="op" id="6082184">.</span><span class="ident" id="6082185">buf</span><span class="op" id="6082188">[</span><span class="num" id="6082189">0</span><span class="op" id="6082190">:</span><span class="num" id="6082191">2</span><span class="op" id="6082192">]</span><span class="op" id="6082193">,</span>&nbsp;<span class="builtintype" id="6082195">uint16</span><span class="op" id="6082201">(</span><span class="ident" id="6082202">pm</span><span class="op" id="6082204">.</span><span class="ident" id="6082205">Bounds</span><span class="op" id="6082211">(</span><span class="op" id="6082212">)</span><span class="op" id="6082213">.</span><span class="ident" id="6082214">Dx</span><span class="op" id="6082216">(</span><span class="op" id="6082217">)</span><span class="op" id="6082218">)</span><span class="op" id="6082219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6082222">writeUint16</span><span class="op" id="6082233">(</span><span class="ident" id="6082234">e</span><span class="op" id="6082235">.</span><span class="ident" id="6082236">buf</span><span class="op" id="6082239">[</span><span class="num" id="6082240">2</span><span class="op" id="6082241">:</span><span class="num" id="6082242">4</span><span class="op" id="6082243">]</span><span class="op" id="6082244">,</span>&nbsp;<span class="builtintype" id="6082246">uint16</span><span class="op" id="6082252">(</span><span class="ident" id="6082253">pm</span><span class="op" id="6082255">.</span><span class="ident" id="6082256">Bounds</span><span class="op" id="6082262">(</span><span class="op" id="6082263">)</span><span class="op" id="6082264">.</span><span class="ident" id="6082265">Dy</span><span class="op" id="6082267">(</span><span class="op" id="6082268">)</span><span class="op" id="6082269">)</span><span class="op" id="6082270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6082273">e</span><span class="op" id="6082274">.</span><span class="ident" id="6082275">write</span><span class="op" id="6082280">(</span><span class="ident" id="6082281">e</span><span class="op" id="6082282">.</span><span class="ident" id="6082283">buf</span><span class="op" id="6082286">[</span><span class="op" id="6082287">:</span><span class="num" id="6082288">4</span><span class="op" id="6082289">]</span><span class="op" id="6082290">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6082294">//&nbsp;All&nbsp;frames&nbsp;have&nbsp;a&nbsp;local&nbsp;color&nbsp;table,&nbsp;so&nbsp;a&nbsp;global&nbsp;color&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6082359">//&nbsp;is&nbsp;not&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6082378">e</span><span class="op" id="6082379">.</span><span class="ident" id="6082380">buf</span><span class="op" id="6082383">[</span><span class="num" id="6082384">0</span><span class="op" id="6082385">]</span>&nbsp;<span class="op" id="6082387">=</span>&nbsp;<span class="num" id="6082389">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6082395">e</span><span class="op" id="6082396">.</span><span class="ident" id="6082397">buf</span><span class="op" id="6082400">[</span><span class="num" id="6082401">1</span><span class="op" id="6082402">]</span>&nbsp;<span class="op" id="6082404">=</span>&nbsp;<span class="num" id="6082406">0x00</span>&nbsp;<span class="comment" id="6082411">//&nbsp;Background&nbsp;Color&nbsp;Index.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6082439">e</span><span class="op" id="6082440">.</span><span class="ident" id="6082441">buf</span><span class="op" id="6082444">[</span><span class="num" id="6082445">2</span><span class="op" id="6082446">]</span>&nbsp;<span class="op" id="6082448">=</span>&nbsp;<span class="num" id="6082450">0x00</span>&nbsp;<span class="comment" id="6082455">//&nbsp;Pixel&nbsp;Aspect&nbsp;Ratio.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6082479">e</span><span class="op" id="6082480">.</span><span class="ident" id="6082481">write</span><span class="op" id="6082486">(</span><span class="ident" id="6082487">e</span><span class="op" id="6082488">.</span><span class="ident" id="6082489">buf</span><span class="op" id="6082492">[</span><span class="op" id="6082493">:</span><span class="num" id="6082494">3</span><span class="op" id="6082495">]</span><span class="op" id="6082496">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6082500">//&nbsp;Add&nbsp;animation&nbsp;info&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6082537">if</span>&nbsp;<span class="builtinfunc" id="6082540">len</span><span class="op" id="6082543">(</span><span class="ident" id="6082544">e</span><span class="op" id="6082545">.</span><span class="ident" id="6082546">g</span><span class="op" id="6082547">.</span><span class="ident" id="6082548">Image</span><span class="op" id="6082553">)</span>&nbsp;<span class="op" id="6082555">&gt;</span>&nbsp;<span class="num" id="6082557">1</span>&nbsp;<span class="op" id="6082559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6082563">e</span><span class="op" id="6082564">.</span><span class="ident" id="6082565">buf</span><span class="op" id="6082568">[</span><span class="num" id="6082569">0</span><span class="op" id="6082570">]</span>&nbsp;<span class="op" id="6082572">=</span>&nbsp;<span class="num" id="6082574">0x21</span>&nbsp;<span class="comment" id="6082579">//&nbsp;Extension&nbsp;Introducer.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6082606">e</span><span class="op" id="6082607">.</span><span class="ident" id="6082608">buf</span><span class="op" id="6082611">[</span><span class="num" id="6082612">1</span><span class="op" id="6082613">]</span>&nbsp;<span class="op" id="6082615">=</span>&nbsp;<span class="num" id="6082617">0xff</span>&nbsp;<span class="comment" id="6082622">//&nbsp;Application&nbsp;Label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6082646">e</span><span class="op" id="6082647">.</span><span class="ident" id="6082648">buf</span><span class="op" id="6082651">[</span><span class="num" id="6082652">2</span><span class="op" id="6082653">]</span>&nbsp;<span class="op" id="6082655">=</span>&nbsp;<span class="num" id="6082657">0x0b</span>&nbsp;<span class="comment" id="6082662">//&nbsp;Block&nbsp;Size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6082679">e</span><span class="op" id="6082680">.</span><span class="ident" id="6082681">write</span><span class="op" id="6082686">(</span><span class="ident" id="6082687">e</span><span class="op" id="6082688">.</span><span class="ident" id="6082689">buf</span><span class="op" id="6082692">[</span><span class="op" id="6082693">:</span><span class="num" id="6082694">3</span><span class="op" id="6082695">]</span><span class="op" id="6082696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6082700">_</span><span class="op" id="6082701">,</span>&nbsp;<span class="ident" id="6082703">e</span><span class="op" id="6082704">.</span><span class="ident" id="6082705">err</span>&nbsp;<span class="op" id="6082709">=</span>&nbsp;<span class="ident" id="6082711">io</span><span class="op" id="6082713">.</span><span class="ident" id="6082714">WriteString</span><span class="op" id="6082725">(</span><span class="ident" id="6082726">e</span><span class="op" id="6082727">.</span><span class="ident" id="6082728">w</span><span class="op" id="6082729">,</span>&nbsp;<span class="string" id="6082731">&#34;NETSCAPE2.0&#34;</span><span class="op" id="6082744">)</span>&nbsp;<span class="comment" id="6082746">//&nbsp;Application&nbsp;Identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6082775">if</span>&nbsp;<span class="ident" id="6082778">e</span><span class="op" id="6082779">.</span><span class="ident" id="6082780">err</span>&nbsp;<span class="op" id="6082784">!=</span>&nbsp;<span class="builtintype" id="6082787">nil</span>&nbsp;<span class="op" id="6082791">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6082796">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6082805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6082809">e</span><span class="op" id="6082810">.</span><span class="ident" id="6082811">buf</span><span class="op" id="6082814">[</span><span class="num" id="6082815">0</span><span class="op" id="6082816">]</span>&nbsp;<span class="op" id="6082818">=</span>&nbsp;<span class="num" id="6082820">0x03</span>&nbsp;<span class="comment" id="6082825">//&nbsp;Block&nbsp;Size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6082842">e</span><span class="op" id="6082843">.</span><span class="ident" id="6082844">buf</span><span class="op" id="6082847">[</span><span class="num" id="6082848">1</span><span class="op" id="6082849">]</span>&nbsp;<span class="op" id="6082851">=</span>&nbsp;<span class="num" id="6082853">0x01</span>&nbsp;<span class="comment" id="6082858">//&nbsp;Sub-block&nbsp;Index.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6082880">writeUint16</span><span class="op" id="6082891">(</span><span class="ident" id="6082892">e</span><span class="op" id="6082893">.</span><span class="ident" id="6082894">buf</span><span class="op" id="6082897">[</span><span class="num" id="6082898">2</span><span class="op" id="6082899">:</span><span class="num" id="6082900">4</span><span class="op" id="6082901">]</span><span class="op" id="6082902">,</span>&nbsp;<span class="builtintype" id="6082904">uint16</span><span class="op" id="6082910">(</span><span class="ident" id="6082911">e</span><span class="op" id="6082912">.</span><span class="ident" id="6082913">g</span><span class="op" id="6082914">.</span><span class="ident" id="6082915">LoopCount</span><span class="op" id="6082924">)</span><span class="op" id="6082925">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6082929">e</span><span class="op" id="6082930">.</span><span class="ident" id="6082931">buf</span><span class="op" id="6082934">[</span><span class="num" id="6082935">4</span><span class="op" id="6082936">]</span>&nbsp;<span class="op" id="6082938">=</span>&nbsp;<span class="num" id="6082940">0x00</span>&nbsp;<span class="comment" id="6082945">//&nbsp;Block&nbsp;Terminator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6082968">e</span><span class="op" id="6082969">.</span><span class="ident" id="6082970">write</span><span class="op" id="6082975">(</span><span class="ident" id="6082976">e</span><span class="op" id="6082977">.</span><span class="ident" id="6082978">buf</span><span class="op" id="6082981">[</span><span class="op" id="6082982">:</span><span class="num" id="6082983">5</span><span class="op" id="6082984">]</span><span class="op" id="6082985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6082988">}</span><br>
<span class="lineno"></span><span class="op" id="6082990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="keyword" id="6082993">func</span>&nbsp;<span class="op" id="6082998">(</span><span class="ident" id="6082999">e</span>&nbsp;<span class="op" id="6083001">*</span><span class="ident" id="6083002">encoder</span><span class="op" id="6083009">)</span>&nbsp;<span class="ident" id="6083011">writeColorTable</span><span class="op" id="6083026">(</span><span class="ident" id="6083027">p</span>&nbsp;<span class="ident" id="6083029">color</span><span class="op" id="6083034">.</span><span class="ident" id="6083035">Palette</span><span class="op" id="6083042">,</span>&nbsp;<span class="ident" id="6083044">size</span>&nbsp;<span class="builtintype" id="6083049">int</span><span class="op" id="6083052">)</span>&nbsp;<span class="op" id="6083054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083057">if</span>&nbsp;<span class="ident" id="6083060">e</span><span class="op" id="6083061">.</span><span class="ident" id="6083062">err</span>&nbsp;<span class="op" id="6083066">!=</span>&nbsp;<span class="builtintype" id="6083069">nil</span>&nbsp;<span class="op" id="6083073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083077">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6083085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083089">for</span>&nbsp;<span class="ident" id="6083093">i</span>&nbsp;<span class="op" id="6083095">:=</span>&nbsp;<span class="num" id="6083098">0</span><span class="op" id="6083099">;</span>&nbsp;<span class="ident" id="6083101">i</span>&nbsp;<span class="op" id="6083103">&lt;</span>&nbsp;<span class="ident" id="6083105">log2Lookup</span><span class="op" id="6083115">[</span><span class="ident" id="6083116">size</span><span class="op" id="6083120">]</span><span class="op" id="6083121">;</span>&nbsp;<span class="ident" id="6083123">i</span><span class="op" id="6083124">++</span>&nbsp;<span class="op" id="6083127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083131">if</span>&nbsp;<span class="ident" id="6083134">i</span>&nbsp;<span class="op" id="6083136">&lt;</span>&nbsp;<span class="builtinfunc" id="6083138">len</span><span class="op" id="6083141">(</span><span class="ident" id="6083142">p</span><span class="op" id="6083143">)</span>&nbsp;<span class="op" id="6083145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083150">r</span><span class="op" id="6083151">,</span>&nbsp;<span class="ident" id="6083153">g</span><span class="op" id="6083154">,</span>&nbsp;<span class="ident" id="6083156">b</span><span class="op" id="6083157">,</span>&nbsp;<span class="ident" id="6083159">_</span>&nbsp;<span class="op" id="6083161">:=</span>&nbsp;<span class="ident" id="6083164">p</span><span class="op" id="6083165">[</span><span class="ident" id="6083166">i</span><span class="op" id="6083167">]</span><span class="op" id="6083168">.</span><span class="ident" id="6083169">RGBA</span><span class="op" id="6083173">(</span><span class="op" id="6083174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083179">e</span><span class="op" id="6083180">.</span><span class="ident" id="6083181">buf</span><span class="op" id="6083184">[</span><span class="num" id="6083185">3</span><span class="op" id="6083186">*</span><span class="ident" id="6083187">i</span><span class="op" id="6083188">+</span><span class="num" id="6083189">0</span><span class="op" id="6083190">]</span>&nbsp;<span class="op" id="6083192">=</span>&nbsp;<span class="builtintype" id="6083194">uint8</span><span class="op" id="6083199">(</span><span class="ident" id="6083200">r</span>&nbsp;<span class="op" id="6083202">&gt;&gt;</span>&nbsp;<span class="num" id="6083205">8</span><span class="op" id="6083206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083211">e</span><span class="op" id="6083212">.</span><span class="ident" id="6083213">buf</span><span class="op" id="6083216">[</span><span class="num" id="6083217">3</span><span class="op" id="6083218">*</span><span class="ident" id="6083219">i</span><span class="op" id="6083220">+</span><span class="num" id="6083221">1</span><span class="op" id="6083222">]</span>&nbsp;<span class="op" id="6083224">=</span>&nbsp;<span class="builtintype" id="6083226">uint8</span><span class="op" id="6083231">(</span><span class="ident" id="6083232">g</span>&nbsp;<span class="op" id="6083234">&gt;&gt;</span>&nbsp;<span class="num" id="6083237">8</span><span class="op" id="6083238">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083243">e</span><span class="op" id="6083244">.</span><span class="ident" id="6083245">buf</span><span class="op" id="6083248">[</span><span class="num" id="6083249">3</span><span class="op" id="6083250">*</span><span class="ident" id="6083251">i</span><span class="op" id="6083252">+</span><span class="num" id="6083253">2</span><span class="op" id="6083254">]</span>&nbsp;<span class="op" id="6083256">=</span>&nbsp;<span class="builtintype" id="6083258">uint8</span><span class="op" id="6083263">(</span><span class="ident" id="6083264">b</span>&nbsp;<span class="op" id="6083266">&gt;&gt;</span>&nbsp;<span class="num" id="6083269">8</span><span class="op" id="6083270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6083274">}</span>&nbsp;<span class="keyword" id="6083276">else</span>&nbsp;<span class="op" id="6083281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6083286">//&nbsp;Pad&nbsp;with&nbsp;black.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083308">e</span><span class="op" id="6083309">.</span><span class="ident" id="6083310">buf</span><span class="op" id="6083313">[</span><span class="num" id="6083314">3</span><span class="op" id="6083315">*</span><span class="ident" id="6083316">i</span><span class="op" id="6083317">+</span><span class="num" id="6083318">0</span><span class="op" id="6083319">]</span>&nbsp;<span class="op" id="6083321">=</span>&nbsp;<span class="num" id="6083323">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083331">e</span><span class="op" id="6083332">.</span><span class="ident" id="6083333">buf</span><span class="op" id="6083336">[</span><span class="num" id="6083337">3</span><span class="op" id="6083338">*</span><span class="ident" id="6083339">i</span><span class="op" id="6083340">+</span><span class="num" id="6083341">1</span><span class="op" id="6083342">]</span>&nbsp;<span class="op" id="6083344">=</span>&nbsp;<span class="num" id="6083346">0x00</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083354">e</span><span class="op" id="6083355">.</span><span class="ident" id="6083356">buf</span><span class="op" id="6083359">[</span><span class="num" id="6083360">3</span><span class="op" id="6083361">*</span><span class="ident" id="6083362">i</span><span class="op" id="6083363">+</span><span class="num" id="6083364">2</span><span class="op" id="6083365">]</span>&nbsp;<span class="op" id="6083367">=</span>&nbsp;<span class="num" id="6083369">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6083376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6083379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083382">e</span><span class="op" id="6083383">.</span><span class="ident" id="6083384">write</span><span class="op" id="6083389">(</span><span class="ident" id="6083390">e</span><span class="op" id="6083391">.</span><span class="ident" id="6083392">buf</span><span class="op" id="6083395">[</span><span class="op" id="6083396">:</span><span class="num" id="6083397">3</span><span class="op" id="6083398">*</span><span class="ident" id="6083399">log2Lookup</span><span class="op" id="6083409">[</span><span class="ident" id="6083410">size</span><span class="op" id="6083414">]</span><span class="op" id="6083415">]</span><span class="op" id="6083416">)</span><br>
<span class="lineno"></span><span class="op" id="6083418">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="6083421">func</span>&nbsp;<span class="op" id="6083426">(</span><span class="ident" id="6083427">e</span>&nbsp;<span class="op" id="6083429">*</span><span class="ident" id="6083430">encoder</span><span class="op" id="6083437">)</span>&nbsp;<span class="ident" id="6083439">writeImageBlock</span><span class="op" id="6083454">(</span><span class="ident" id="6083455">pm</span>&nbsp;<span class="op" id="6083458">*</span><span class="ident" id="6083459">image</span><span class="op" id="6083464">.</span><span class="ident" id="6083465">Paletted</span><span class="op" id="6083473">,</span>&nbsp;<span class="ident" id="6083475">delay</span>&nbsp;<span class="builtintype" id="6083481">int</span><span class="op" id="6083484">)</span>&nbsp;<span class="op" id="6083486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083489">if</span>&nbsp;<span class="ident" id="6083492">e</span><span class="op" id="6083493">.</span><span class="ident" id="6083494">err</span>&nbsp;<span class="op" id="6083498">!=</span>&nbsp;<span class="builtintype" id="6083501">nil</span>&nbsp;<span class="op" id="6083505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083509">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6083517">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083521">if</span>&nbsp;<span class="builtinfunc" id="6083524">len</span><span class="op" id="6083527">(</span><span class="ident" id="6083528">pm</span><span class="op" id="6083530">.</span><span class="ident" id="6083531">Palette</span><span class="op" id="6083538">)</span>&nbsp;<span class="op" id="6083540">==</span>&nbsp;<span class="num" id="6083543">0</span>&nbsp;<span class="op" id="6083545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083549">e</span><span class="op" id="6083550">.</span><span class="ident" id="6083551">err</span>&nbsp;<span class="op" id="6083555">=</span>&nbsp;<span class="ident" id="6083557">errors</span><span class="op" id="6083563">.</span><span class="ident" id="6083564">New</span><span class="op" id="6083567">(</span><span class="string" id="6083568">&#34;gif:&nbsp;cannot&nbsp;encode&nbsp;image&nbsp;block&nbsp;with&nbsp;empty&nbsp;palette&#34;</span><span class="op" id="6083619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083623">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6083631">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083635">b</span>&nbsp;<span class="op" id="6083637">:=</span>&nbsp;<span class="ident" id="6083640">pm</span><span class="op" id="6083642">.</span><span class="ident" id="6083643">Bounds</span><span class="op" id="6083649">(</span><span class="op" id="6083650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083653">if</span>&nbsp;<span class="ident" id="6083656">b</span><span class="op" id="6083657">.</span><span class="ident" id="6083658">Dx</span><span class="op" id="6083660">(</span><span class="op" id="6083661">)</span>&nbsp;<span class="op" id="6083663">&gt;=</span>&nbsp;<span class="num" id="6083666">1</span><span class="op" id="6083667">&lt;&lt;</span><span class="num" id="6083669">16</span>&nbsp;<span class="op" id="6083672">||</span>&nbsp;<span class="ident" id="6083675">b</span><span class="op" id="6083676">.</span><span class="ident" id="6083677">Dy</span><span class="op" id="6083679">(</span><span class="op" id="6083680">)</span>&nbsp;<span class="op" id="6083682">&gt;=</span>&nbsp;<span class="num" id="6083685">1</span><span class="op" id="6083686">&lt;&lt;</span><span class="num" id="6083688">16</span>&nbsp;<span class="op" id="6083691">||</span>&nbsp;<span class="ident" id="6083694">b</span><span class="op" id="6083695">.</span><span class="ident" id="6083696">Min</span><span class="op" id="6083699">.</span><span class="ident" id="6083700">X</span>&nbsp;<span class="op" id="6083702">&lt;</span>&nbsp;<span class="num" id="6083704">0</span>&nbsp;<span class="op" id="6083706">||</span>&nbsp;<span class="ident" id="6083709">b</span><span class="op" id="6083710">.</span><span class="ident" id="6083711">Min</span><span class="op" id="6083714">.</span><span class="ident" id="6083715">X</span>&nbsp;<span class="op" id="6083717">&gt;=</span>&nbsp;<span class="num" id="6083720">1</span><span class="op" id="6083721">&lt;&lt;</span><span class="num" id="6083723">16</span>&nbsp;<span class="op" id="6083726">||</span>&nbsp;<span class="ident" id="6083729">b</span><span class="op" id="6083730">.</span><span class="ident" id="6083731">Min</span><span class="op" id="6083734">.</span><span class="ident" id="6083735">Y</span>&nbsp;<span class="op" id="6083737">&lt;</span>&nbsp;<span class="num" id="6083739">0</span>&nbsp;<span class="op" id="6083741">||</span>&nbsp;<span class="ident" id="6083744">b</span><span class="op" id="6083745">.</span><span class="ident" id="6083746">Min</span><span class="op" id="6083749">.</span><span class="ident" id="6083750">Y</span>&nbsp;<span class="op" id="6083752">&gt;=</span>&nbsp;<span class="num" id="6083755">1</span><span class="op" id="6083756">&lt;&lt;</span><span class="num" id="6083758">16</span>&nbsp;<span class="op" id="6083761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083765">e</span><span class="op" id="6083766">.</span><span class="ident" id="6083767">err</span>&nbsp;<span class="op" id="6083771">=</span>&nbsp;<span class="ident" id="6083773">errors</span><span class="op" id="6083779">.</span><span class="ident" id="6083780">New</span><span class="op" id="6083783">(</span><span class="string" id="6083784">&#34;gif:&nbsp;image&nbsp;block&nbsp;is&nbsp;too&nbsp;large&nbsp;to&nbsp;encode&#34;</span><span class="op" id="6083825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083829">return</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6083837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083841">transparentIndex</span>&nbsp;<span class="op" id="6083858">:=</span>&nbsp;<span class="op" id="6083861">-</span><span class="num" id="6083862">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083865">for</span>&nbsp;<span class="ident" id="6083869">i</span><span class="op" id="6083870">,</span>&nbsp;<span class="ident" id="6083872">c</span>&nbsp;<span class="op" id="6083874">:=</span>&nbsp;<span class="keyword" id="6083877">range</span>&nbsp;<span class="ident" id="6083883">pm</span><span class="op" id="6083885">.</span><span class="ident" id="6083886">Palette</span>&nbsp;<span class="op" id="6083894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083898">if</span>&nbsp;<span class="ident" id="6083901">_</span><span class="op" id="6083902">,</span>&nbsp;<span class="ident" id="6083904">_</span><span class="op" id="6083905">,</span>&nbsp;<span class="ident" id="6083907">_</span><span class="op" id="6083908">,</span>&nbsp;<span class="ident" id="6083910">a</span>&nbsp;<span class="op" id="6083912">:=</span>&nbsp;<span class="ident" id="6083915">c</span><span class="op" id="6083916">.</span><span class="ident" id="6083917">RGBA</span><span class="op" id="6083921">(</span><span class="op" id="6083922">)</span><span class="op" id="6083923">;</span>&nbsp;<span class="ident" id="6083925">a</span>&nbsp;<span class="op" id="6083927">==</span>&nbsp;<span class="num" id="6083930">0</span>&nbsp;<span class="op" id="6083932">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083937">transparentIndex</span>&nbsp;<span class="op" id="6083954">=</span>&nbsp;<span class="ident" id="6083956">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083961">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6083969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6083972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083976">if</span>&nbsp;<span class="ident" id="6083979">delay</span>&nbsp;<span class="op" id="6083985">&gt;</span>&nbsp;<span class="num" id="6083987">0</span>&nbsp;<span class="op" id="6083989">||</span>&nbsp;<span class="ident" id="6083992">transparentIndex</span>&nbsp;<span class="op" id="6084009">!=</span>&nbsp;<span class="op" id="6084012">-</span><span class="num" id="6084013">1</span>&nbsp;<span class="op" id="6084015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084019">e</span><span class="op" id="6084020">.</span><span class="ident" id="6084021">buf</span><span class="op" id="6084024">[</span><span class="num" id="6084025">0</span><span class="op" id="6084026">]</span>&nbsp;<span class="op" id="6084028">=</span>&nbsp;<span class="ident" id="6084030">sExtension</span>&nbsp;&nbsp;<span class="comment" id="6084042">//&nbsp;Extension&nbsp;Introducer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084069">e</span><span class="op" id="6084070">.</span><span class="ident" id="6084071">buf</span><span class="op" id="6084074">[</span><span class="num" id="6084075">1</span><span class="op" id="6084076">]</span>&nbsp;<span class="op" id="6084078">=</span>&nbsp;<span class="ident" id="6084080">gcLabel</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6084092">//&nbsp;Graphic&nbsp;Control&nbsp;Label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084120">e</span><span class="op" id="6084121">.</span><span class="ident" id="6084122">buf</span><span class="op" id="6084125">[</span><span class="num" id="6084126">2</span><span class="op" id="6084127">]</span>&nbsp;<span class="op" id="6084129">=</span>&nbsp;<span class="ident" id="6084131">gcBlockSize</span>&nbsp;<span class="comment" id="6084143">//&nbsp;Block&nbsp;Size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6084160">if</span>&nbsp;<span class="ident" id="6084163">transparentIndex</span>&nbsp;<span class="op" id="6084180">!=</span>&nbsp;<span class="op" id="6084183">-</span><span class="num" id="6084184">1</span>&nbsp;<span class="op" id="6084186">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084191">e</span><span class="op" id="6084192">.</span><span class="ident" id="6084193">buf</span><span class="op" id="6084196">[</span><span class="num" id="6084197">3</span><span class="op" id="6084198">]</span>&nbsp;<span class="op" id="6084200">=</span>&nbsp;<span class="num" id="6084202">0x01</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6084209">}</span>&nbsp;<span class="keyword" id="6084211">else</span>&nbsp;<span class="op" id="6084216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084221">e</span><span class="op" id="6084222">.</span><span class="ident" id="6084223">buf</span><span class="op" id="6084226">[</span><span class="num" id="6084227">3</span><span class="op" id="6084228">]</span>&nbsp;<span class="op" id="6084230">=</span>&nbsp;<span class="num" id="6084232">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6084239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084243">writeUint16</span><span class="op" id="6084254">(</span><span class="ident" id="6084255">e</span><span class="op" id="6084256">.</span><span class="ident" id="6084257">buf</span><span class="op" id="6084260">[</span><span class="num" id="6084261">4</span><span class="op" id="6084262">:</span><span class="num" id="6084263">6</span><span class="op" id="6084264">]</span><span class="op" id="6084265">,</span>&nbsp;<span class="builtintype" id="6084267">uint16</span><span class="op" id="6084273">(</span><span class="ident" id="6084274">delay</span><span class="op" id="6084279">)</span><span class="op" id="6084280">)</span>&nbsp;<span class="comment" id="6084282">//&nbsp;Delay&nbsp;Time&nbsp;(1/100ths&nbsp;of&nbsp;a&nbsp;second)</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6084322">//&nbsp;Transparent&nbsp;color&nbsp;index.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6084352">if</span>&nbsp;<span class="ident" id="6084355">transparentIndex</span>&nbsp;<span class="op" id="6084372">!=</span>&nbsp;<span class="op" id="6084375">-</span><span class="num" id="6084376">1</span>&nbsp;<span class="op" id="6084378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084383">e</span><span class="op" id="6084384">.</span><span class="ident" id="6084385">buf</span><span class="op" id="6084388">[</span><span class="num" id="6084389">6</span><span class="op" id="6084390">]</span>&nbsp;<span class="op" id="6084392">=</span>&nbsp;<span class="builtintype" id="6084394">uint8</span><span class="op" id="6084399">(</span><span class="ident" id="6084400">transparentIndex</span><span class="op" id="6084416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6084420">}</span>&nbsp;<span class="keyword" id="6084422">else</span>&nbsp;<span class="op" id="6084427">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084432">e</span><span class="op" id="6084433">.</span><span class="ident" id="6084434">buf</span><span class="op" id="6084437">[</span><span class="num" id="6084438">6</span><span class="op" id="6084439">]</span>&nbsp;<span class="op" id="6084441">=</span>&nbsp;<span class="num" id="6084443">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6084450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084454">e</span><span class="op" id="6084455">.</span><span class="ident" id="6084456">buf</span><span class="op" id="6084459">[</span><span class="num" id="6084460">7</span><span class="op" id="6084461">]</span>&nbsp;<span class="op" id="6084463">=</span>&nbsp;<span class="num" id="6084465">0x00</span>&nbsp;<span class="comment" id="6084470">//&nbsp;Block&nbsp;Terminator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084493">e</span><span class="op" id="6084494">.</span><span class="ident" id="6084495">write</span><span class="op" id="6084500">(</span><span class="ident" id="6084501">e</span><span class="op" id="6084502">.</span><span class="ident" id="6084503">buf</span><span class="op" id="6084506">[</span><span class="op" id="6084507">:</span><span class="num" id="6084508">8</span><span class="op" id="6084509">]</span><span class="op" id="6084510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6084513">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084516">e</span><span class="op" id="6084517">.</span><span class="ident" id="6084518">buf</span><span class="op" id="6084521">[</span><span class="num" id="6084522">0</span><span class="op" id="6084523">]</span>&nbsp;<span class="op" id="6084525">=</span>&nbsp;<span class="ident" id="6084527">sImageDescriptor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084545">writeUint16</span><span class="op" id="6084556">(</span><span class="ident" id="6084557">e</span><span class="op" id="6084558">.</span><span class="ident" id="6084559">buf</span><span class="op" id="6084562">[</span><span class="num" id="6084563">1</span><span class="op" id="6084564">:</span><span class="num" id="6084565">3</span><span class="op" id="6084566">]</span><span class="op" id="6084567">,</span>&nbsp;<span class="builtintype" id="6084569">uint16</span><span class="op" id="6084575">(</span><span class="ident" id="6084576">b</span><span class="op" id="6084577">.</span><span class="ident" id="6084578">Min</span><span class="op" id="6084581">.</span><span class="ident" id="6084582">X</span><span class="op" id="6084583">)</span><span class="op" id="6084584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084587">writeUint16</span><span class="op" id="6084598">(</span><span class="ident" id="6084599">e</span><span class="op" id="6084600">.</span><span class="ident" id="6084601">buf</span><span class="op" id="6084604">[</span><span class="num" id="6084605">3</span><span class="op" id="6084606">:</span><span class="num" id="6084607">5</span><span class="op" id="6084608">]</span><span class="op" id="6084609">,</span>&nbsp;<span class="builtintype" id="6084611">uint16</span><span class="op" id="6084617">(</span><span class="ident" id="6084618">b</span><span class="op" id="6084619">.</span><span class="ident" id="6084620">Min</span><span class="op" id="6084623">.</span><span class="ident" id="6084624">Y</span><span class="op" id="6084625">)</span><span class="op" id="6084626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084629">writeUint16</span><span class="op" id="6084640">(</span><span class="ident" id="6084641">e</span><span class="op" id="6084642">.</span><span class="ident" id="6084643">buf</span><span class="op" id="6084646">[</span><span class="num" id="6084647">5</span><span class="op" id="6084648">:</span><span class="num" id="6084649">7</span><span class="op" id="6084650">]</span><span class="op" id="6084651">,</span>&nbsp;<span class="builtintype" id="6084653">uint16</span><span class="op" id="6084659">(</span><span class="ident" id="6084660">b</span><span class="op" id="6084661">.</span><span class="ident" id="6084662">Dx</span><span class="op" id="6084664">(</span><span class="op" id="6084665">)</span><span class="op" id="6084666">)</span><span class="op" id="6084667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084670">writeUint16</span><span class="op" id="6084681">(</span><span class="ident" id="6084682">e</span><span class="op" id="6084683">.</span><span class="ident" id="6084684">buf</span><span class="op" id="6084687">[</span><span class="num" id="6084688">7</span><span class="op" id="6084689">:</span><span class="num" id="6084690">9</span><span class="op" id="6084691">]</span><span class="op" id="6084692">,</span>&nbsp;<span class="builtintype" id="6084694">uint16</span><span class="op" id="6084700">(</span><span class="ident" id="6084701">b</span><span class="op" id="6084702">.</span><span class="ident" id="6084703">Dy</span><span class="op" id="6084705">(</span><span class="op" id="6084706">)</span><span class="op" id="6084707">)</span><span class="op" id="6084708">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084711">e</span><span class="op" id="6084712">.</span><span class="ident" id="6084713">write</span><span class="op" id="6084718">(</span><span class="ident" id="6084719">e</span><span class="op" id="6084720">.</span><span class="ident" id="6084721">buf</span><span class="op" id="6084724">[</span><span class="op" id="6084725">:</span><span class="num" id="6084726">9</span><span class="op" id="6084727">]</span><span class="op" id="6084728">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084732">paddedSize</span>&nbsp;<span class="op" id="6084743">:=</span>&nbsp;<span class="ident" id="6084746">log2</span><span class="op" id="6084750">(</span><span class="builtinfunc" id="6084751">len</span><span class="op" id="6084754">(</span><span class="ident" id="6084755">pm</span><span class="op" id="6084757">.</span><span class="ident" id="6084758">Palette</span><span class="op" id="6084765">)</span><span class="op" id="6084766">)</span>&nbsp;<span class="comment" id="6084768">//&nbsp;Size&nbsp;of&nbsp;Local&nbsp;Color&nbsp;Table:&nbsp;2^(1+n).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6084808">//&nbsp;Interlacing&nbsp;is&nbsp;not&nbsp;supported.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084842">e</span><span class="op" id="6084843">.</span><span class="ident" id="6084844">writeByte</span><span class="op" id="6084853">(</span><span class="num" id="6084854">0x80</span>&nbsp;<span class="op" id="6084859">|</span>&nbsp;<span class="builtintype" id="6084861">uint8</span><span class="op" id="6084866">(</span><span class="ident" id="6084867">paddedSize</span><span class="op" id="6084877">)</span><span class="op" id="6084878">)</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6084882">//&nbsp;Local&nbsp;Color&nbsp;Table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084905">e</span><span class="op" id="6084906">.</span><span class="ident" id="6084907">writeColorTable</span><span class="op" id="6084922">(</span><span class="ident" id="6084923">pm</span><span class="op" id="6084925">.</span><span class="ident" id="6084926">Palette</span><span class="op" id="6084933">,</span>&nbsp;<span class="ident" id="6084935">paddedSize</span><span class="op" id="6084945">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084949">litWidth</span>&nbsp;<span class="op" id="6084958">:=</span>&nbsp;<span class="ident" id="6084961">paddedSize</span>&nbsp;<span class="op" id="6084972">+</span>&nbsp;<span class="num" id="6084974">1</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6084977">if</span>&nbsp;<span class="ident" id="6084980">litWidth</span>&nbsp;<span class="op" id="6084989">&lt;</span>&nbsp;<span class="num" id="6084991">2</span>&nbsp;<span class="op" id="6084993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084997">litWidth</span>&nbsp;<span class="op" id="6085006">=</span>&nbsp;<span class="num" id="6085008">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6085011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6085014">e</span><span class="op" id="6085015">.</span><span class="ident" id="6085016">writeByte</span><span class="op" id="6085025">(</span><span class="builtintype" id="6085026">uint8</span><span class="op" id="6085031">(</span><span class="ident" id="6085032">litWidth</span><span class="op" id="6085040">)</span><span class="op" id="6085041">)</span>&nbsp;<span class="comment" id="6085043">//&nbsp;LZW&nbsp;Minimum&nbsp;Code&nbsp;Size.</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6085071">lzww</span>&nbsp;<span class="op" id="6085076">:=</span>&nbsp;<span class="ident" id="6085079">lzw</span><span class="op" id="6085082">.</span><span class="ident" id="6085083">NewWriter</span><span class="op" id="6085092">(</span><span class="ident" id="6085093">blockWriter</span><span class="op" id="6085104">{</span><span class="ident" id="6085105">e</span><span class="op" id="6085106">:</span>&nbsp;<span class="ident" id="6085108">e</span><span class="op" id="6085109">}</span><span class="op" id="6085110">,</span>&nbsp;<span class="ident" id="6085112">lzw</span><span class="op" id="6085115">.</span><span class="ident" id="6085116">LSB</span><span class="op" id="6085119">,</span>&nbsp;<span class="ident" id="6085121">litWidth</span><span class="op" id="6085129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6085132">if</span>&nbsp;<span class="ident" id="6085135">dx</span>&nbsp;<span class="op" id="6085138">:=</span>&nbsp;<span class="ident" id="6085141">b</span><span class="op" id="6085142">.</span><span class="ident" id="6085143">Dx</span><span class="op" id="6085145">(</span><span class="op" id="6085146">)</span><span class="op" id="6085147">;</span>&nbsp;<span class="ident" id="6085149">dx</span>&nbsp;<span class="op" id="6085152">==</span>&nbsp;<span class="ident" id="6085155">pm</span><span class="op" id="6085157">.</span><span class="ident" id="6085158">Stride</span>&nbsp;<span class="op" id="6085165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6085169">_</span><span class="op" id="6085170">,</span>&nbsp;<span class="ident" id="6085172">e</span><span class="op" id="6085173">.</span><span class="ident" id="6085174">err</span>&nbsp;<span class="op" id="6085178">=</span>&nbsp;<span class="ident" id="6085180">lzww</span><span class="op" id="6085184">.</span><span class="ident" id="6085185">Write</span><span class="op" id="6085190">(</span><span class="ident" id="6085191">pm</span><span class="op" id="6085193">.</span><span class="ident" id="6085194">Pix</span><span class="op" id="6085197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6085201">if</span>&nbsp;<span class="ident" id="6085204">e</span><span class="op" id="6085205">.</span><span class="ident" id="6085206">err</span>&nbsp;<span class="op" id="6085210">!=</span>&nbsp;<span class="builtintype" id="6085213">nil</span>&nbsp;<span class="op" id="6085217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6085222">lzww</span><span class="op" id="6085226">.</span><span class="ident" id="6085227">Close</span><span class="op" id="6085232">(</span><span class="op" id="6085233">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6085238">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6085247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6085250">}</span>&nbsp;<span class="keyword" id="6085252">else</span>&nbsp;<span class="op" id="6085257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6085261">for</span>&nbsp;<span class="ident" id="6085265">i</span><span class="op" id="6085266">,</span>&nbsp;<span class="ident" id="6085268">y</span>&nbsp;<span class="op" id="6085270">:=</span>&nbsp;<span class="num" id="6085273">0</span><span class="op" id="6085274">,</span>&nbsp;<span class="ident" id="6085276">b</span><span class="op" id="6085277">.</span><span class="ident" id="6085278">Min</span><span class="op" id="6085281">.</span><span class="ident" id="6085282">Y</span><span class="op" id="6085283">;</span>&nbsp;<span class="ident" id="6085285">y</span>&nbsp;<span class="op" id="6085287">&lt;</span>&nbsp;<span class="ident" id="6085289">b</span><span class="op" id="6085290">.</span><span class="ident" id="6085291">Max</span><span class="op" id="6085294">.</span><span class="ident" id="6085295">Y</span><span class="op" id="6085296">;</span>&nbsp;<span class="ident" id="6085298">i</span><span class="op" id="6085299">,</span>&nbsp;<span class="ident" id="6085301">y</span>&nbsp;<span class="op" id="6085303">=</span>&nbsp;<span class="ident" id="6085305">i</span><span class="op" id="6085306">+</span><span class="ident" id="6085307">pm</span><span class="op" id="6085309">.</span><span class="ident" id="6085310">Stride</span><span class="op" id="6085316">,</span>&nbsp;<span class="ident" id="6085318">y</span><span class="op" id="6085319">+</span><span class="num" id="6085320">1</span>&nbsp;<span class="op" id="6085322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6085327">_</span><span class="op" id="6085328">,</span>&nbsp;<span class="ident" id="6085330">e</span><span class="op" id="6085331">.</span><span class="ident" id="6085332">err</span>&nbsp;<span class="op" id="6085336">=</span>&nbsp;<span class="ident" id="6085338">lzww</span><span class="op" id="6085342">.</span><span class="ident" id="6085343">Write</span><span class="op" id="6085348">(</span><span class="ident" id="6085349">pm</span><span class="op" id="6085351">.</span><span class="ident" id="6085352">Pix</span><span class="op" id="6085355">[</span><span class="ident" id="6085356">i</span>&nbsp;<span class="op" id="6085358">:</span>&nbsp;<span class="ident" id="6085360">i</span><span class="op" id="6085361">+</span><span class="ident" id="6085362">dx</span><span class="op" id="6085364">]</span><span class="op" id="6085365">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6085370">if</span>&nbsp;<span class="ident" id="6085373">e</span><span class="op" id="6085374">.</span><span class="ident" id="6085375">err</span>&nbsp;<span class="op" id="6085379">!=</span>&nbsp;<span class="builtintype" id="6085382">nil</span>&nbsp;<span class="op" id="6085386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6085392">lzww</span><span class="op" id="6085396">.</span><span class="ident" id="6085397">Close</span><span class="op" id="6085402">(</span><span class="op" id="6085403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6085409">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6085419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6085423">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6085426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6085429">lzww</span><span class="op" id="6085433">.</span><span class="ident" id="6085434">Close</span><span class="op" id="6085439">(</span><span class="op" id="6085440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6085443">e</span><span class="op" id="6085444">.</span><span class="ident" id="6085445">writeByte</span><span class="op" id="6085454">(</span><span class="num" id="6085455">0x00</span><span class="op" id="6085459">)</span>&nbsp;<span class="comment" id="6085461">//&nbsp;Block&nbsp;Terminator.</span><br>
<span class="lineno"></span><span class="op" id="6085482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="6085485">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;encoding&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="keyword" id="6085525">type</span>&nbsp;<span class="ident" id="6085530">Options</span>&nbsp;<span class="keyword" id="6085538">struct</span>&nbsp;<span class="op" id="6085545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6085548">//&nbsp;NumColors&nbsp;is&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;colors&nbsp;used&nbsp;in&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6085613">//&nbsp;It&nbsp;ranges&nbsp;from&nbsp;1&nbsp;to&nbsp;256.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6085642">NumColors</span>&nbsp;<span class="builtintype" id="6085652">int</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6085658">//&nbsp;Quantizer&nbsp;is&nbsp;used&nbsp;to&nbsp;produce&nbsp;a&nbsp;palette&nbsp;with&nbsp;size&nbsp;NumColors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6085722">//&nbsp;palette.Plan9&nbsp;is&nbsp;used&nbsp;in&nbsp;place&nbsp;of&nbsp;a&nbsp;nil&nbsp;Quantizer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6085777">Quantizer</span>&nbsp;<span class="ident" id="6085787">draw</span><span class="op" id="6085791">.</span><span class="ident" id="6085792">Quantizer</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6085804">//&nbsp;Drawer&nbsp;is&nbsp;used&nbsp;to&nbsp;convert&nbsp;the&nbsp;source&nbsp;image&nbsp;to&nbsp;the&nbsp;desired&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6085875">//&nbsp;draw.FloydSteinberg&nbsp;is&nbsp;used&nbsp;in&nbsp;place&nbsp;of&nbsp;a&nbsp;nil&nbsp;Drawer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6085933">Drawer</span>&nbsp;<span class="ident" id="6085940">draw</span><span class="op" id="6085944">.</span><span class="ident" id="6085945">Drawer</span><br>
<span class="lineno"></span><span class="op" id="6085952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="6085955">//&nbsp;EncodeAll&nbsp;writes&nbsp;the&nbsp;images&nbsp;in&nbsp;g&nbsp;to&nbsp;w&nbsp;in&nbsp;GIF&nbsp;format&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6086019">//&nbsp;given&nbsp;loop&nbsp;count&nbsp;and&nbsp;delay&nbsp;between&nbsp;frames.</span><br>
<span class="lineno"></span><span class="keyword" id="6086065">func</span>&nbsp;<span class="ident" id="6086070">EncodeAll</span><span class="op" id="6086079">(</span><span class="ident" id="6086080">w</span>&nbsp;<span class="ident" id="6086082">io</span><span class="op" id="6086084">.</span><span class="ident" id="6086085">Writer</span><span class="op" id="6086091">,</span>&nbsp;<span class="ident" id="6086093">g</span>&nbsp;<span class="op" id="6086095">*</span><span class="ident" id="6086096">GIF</span><span class="op" id="6086099">)</span>&nbsp;<span class="builtintype" id="6086101">error</span>&nbsp;<span class="op" id="6086107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086110">if</span>&nbsp;<span class="builtinfunc" id="6086113">len</span><span class="op" id="6086116">(</span><span class="ident" id="6086117">g</span><span class="op" id="6086118">.</span><span class="ident" id="6086119">Image</span><span class="op" id="6086124">)</span>&nbsp;<span class="op" id="6086126">==</span>&nbsp;<span class="num" id="6086129">0</span>&nbsp;<span class="op" id="6086131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086135">return</span>&nbsp;<span class="ident" id="6086142">errors</span><span class="op" id="6086148">.</span><span class="ident" id="6086149">New</span><span class="op" id="6086152">(</span><span class="string" id="6086153">&#34;gif:&nbsp;must&nbsp;provide&nbsp;at&nbsp;least&nbsp;one&nbsp;image&#34;</span><span class="op" id="6086191">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6086194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086198">if</span>&nbsp;<span class="builtinfunc" id="6086201">len</span><span class="op" id="6086204">(</span><span class="ident" id="6086205">g</span><span class="op" id="6086206">.</span><span class="ident" id="6086207">Image</span><span class="op" id="6086212">)</span>&nbsp;<span class="op" id="6086214">!=</span>&nbsp;<span class="builtinfunc" id="6086217">len</span><span class="op" id="6086220">(</span><span class="ident" id="6086221">g</span><span class="op" id="6086222">.</span><span class="ident" id="6086223">Delay</span><span class="op" id="6086228">)</span>&nbsp;<span class="op" id="6086230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086234">return</span>&nbsp;<span class="ident" id="6086241">errors</span><span class="op" id="6086247">.</span><span class="ident" id="6086248">New</span><span class="op" id="6086251">(</span><span class="string" id="6086252">&#34;gif:&nbsp;mismatched&nbsp;image&nbsp;and&nbsp;delay&nbsp;lengths&#34;</span><span class="op" id="6086293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6086296">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086299">if</span>&nbsp;<span class="ident" id="6086302">g</span><span class="op" id="6086303">.</span><span class="ident" id="6086304">LoopCount</span>&nbsp;<span class="op" id="6086314">&lt;</span>&nbsp;<span class="num" id="6086316">0</span>&nbsp;<span class="op" id="6086318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086322">g</span><span class="op" id="6086323">.</span><span class="ident" id="6086324">LoopCount</span>&nbsp;<span class="op" id="6086334">=</span>&nbsp;<span class="num" id="6086336">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6086339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086343">e</span>&nbsp;<span class="op" id="6086345">:=</span>&nbsp;<span class="ident" id="6086348">encoder</span><span class="op" id="6086355">{</span><span class="ident" id="6086356">g</span><span class="op" id="6086357">:</span>&nbsp;<span class="ident" id="6086359">g</span><span class="op" id="6086360">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086363">if</span>&nbsp;<span class="ident" id="6086366">ww</span><span class="op" id="6086368">,</span>&nbsp;<span class="ident" id="6086370">ok</span>&nbsp;<span class="op" id="6086373">:=</span>&nbsp;<span class="ident" id="6086376">w</span><span class="op" id="6086377">.</span><span class="op" id="6086378">(</span><span class="ident" id="6086379">writer</span><span class="op" id="6086385">)</span><span class="op" id="6086386">;</span>&nbsp;<span class="ident" id="6086388">ok</span>&nbsp;<span class="op" id="6086391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086395">e</span><span class="op" id="6086396">.</span><span class="ident" id="6086397">w</span>&nbsp;<span class="op" id="6086399">=</span>&nbsp;<span class="ident" id="6086401">ww</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6086405">}</span>&nbsp;<span class="keyword" id="6086407">else</span>&nbsp;<span class="op" id="6086412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086416">e</span><span class="op" id="6086417">.</span><span class="ident" id="6086418">w</span>&nbsp;<span class="op" id="6086420">=</span>&nbsp;<span class="ident" id="6086422">bufio</span><span class="op" id="6086427">.</span><span class="ident" id="6086428">NewWriter</span><span class="op" id="6086437">(</span><span class="ident" id="6086438">w</span><span class="op" id="6086439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6086442">}</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086446">e</span><span class="op" id="6086447">.</span><span class="ident" id="6086448">writeHeader</span><span class="op" id="6086459">(</span><span class="op" id="6086460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086463">for</span>&nbsp;<span class="ident" id="6086467">i</span><span class="op" id="6086468">,</span>&nbsp;<span class="ident" id="6086470">pm</span>&nbsp;<span class="op" id="6086473">:=</span>&nbsp;<span class="keyword" id="6086476">range</span>&nbsp;<span class="ident" id="6086482">g</span><span class="op" id="6086483">.</span><span class="ident" id="6086484">Image</span>&nbsp;<span class="op" id="6086490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086494">e</span><span class="op" id="6086495">.</span><span class="ident" id="6086496">writeImageBlock</span><span class="op" id="6086511">(</span><span class="ident" id="6086512">pm</span><span class="op" id="6086514">,</span>&nbsp;<span class="ident" id="6086516">g</span><span class="op" id="6086517">.</span><span class="ident" id="6086518">Delay</span><span class="op" id="6086523">[</span><span class="ident" id="6086524">i</span><span class="op" id="6086525">]</span><span class="op" id="6086526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6086529">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086532">e</span><span class="op" id="6086533">.</span><span class="ident" id="6086534">writeByte</span><span class="op" id="6086543">(</span><span class="ident" id="6086544">sTrailer</span><span class="op" id="6086552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086555">e</span><span class="op" id="6086556">.</span><span class="ident" id="6086557">flush</span><span class="op" id="6086562">(</span><span class="op" id="6086563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086566">return</span>&nbsp;<span class="ident" id="6086573">e</span><span class="op" id="6086574">.</span><span class="ident" id="6086575">err</span><br>
<span class="lineno"></span><span class="op" id="6086579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="6086582">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;Image&nbsp;m&nbsp;to&nbsp;w&nbsp;in&nbsp;GIF&nbsp;format.</span><br>
<span class="lineno"></span><span class="keyword" id="6086631">func</span>&nbsp;<span class="ident" id="6086636">Encode</span><span class="op" id="6086642">(</span><span class="ident" id="6086643">w</span>&nbsp;<span class="ident" id="6086645">io</span><span class="op" id="6086647">.</span><span class="ident" id="6086648">Writer</span><span class="op" id="6086654">,</span>&nbsp;<span class="ident" id="6086656">m</span>&nbsp;<span class="ident" id="6086658">image</span><span class="op" id="6086663">.</span><span class="ident" id="6086664">Image</span><span class="op" id="6086669">,</span>&nbsp;<span class="ident" id="6086671">o</span>&nbsp;<span class="op" id="6086673">*</span><span class="ident" id="6086674">Options</span><span class="op" id="6086681">)</span>&nbsp;<span class="builtintype" id="6086683">error</span>&nbsp;<span class="op" id="6086689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6086692">//&nbsp;Check&nbsp;for&nbsp;bounds&nbsp;and&nbsp;size&nbsp;restrictions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086736">b</span>&nbsp;<span class="op" id="6086738">:=</span>&nbsp;<span class="ident" id="6086741">m</span><span class="op" id="6086742">.</span><span class="ident" id="6086743">Bounds</span><span class="op" id="6086749">(</span><span class="op" id="6086750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086753">if</span>&nbsp;<span class="ident" id="6086756">b</span><span class="op" id="6086757">.</span><span class="ident" id="6086758">Dx</span><span class="op" id="6086760">(</span><span class="op" id="6086761">)</span>&nbsp;<span class="op" id="6086763">&gt;=</span>&nbsp;<span class="num" id="6086766">1</span><span class="op" id="6086767">&lt;&lt;</span><span class="num" id="6086769">16</span>&nbsp;<span class="op" id="6086772">||</span>&nbsp;<span class="ident" id="6086775">b</span><span class="op" id="6086776">.</span><span class="ident" id="6086777">Dy</span><span class="op" id="6086779">(</span><span class="op" id="6086780">)</span>&nbsp;<span class="op" id="6086782">&gt;=</span>&nbsp;<span class="num" id="6086785">1</span><span class="op" id="6086786">&lt;&lt;</span><span class="num" id="6086788">16</span>&nbsp;<span class="op" id="6086791">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086795">return</span>&nbsp;<span class="ident" id="6086802">errors</span><span class="op" id="6086808">.</span><span class="ident" id="6086809">New</span><span class="op" id="6086812">(</span><span class="string" id="6086813">&#34;gif:&nbsp;image&nbsp;is&nbsp;too&nbsp;large&nbsp;to&nbsp;encode&#34;</span><span class="op" id="6086848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6086851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086855">opts</span>&nbsp;<span class="op" id="6086860">:=</span>&nbsp;<span class="ident" id="6086863">Options</span><span class="op" id="6086870">{</span><span class="op" id="6086871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086874">if</span>&nbsp;<span class="ident" id="6086877">o</span>&nbsp;<span class="op" id="6086879">!=</span>&nbsp;<span class="builtintype" id="6086882">nil</span>&nbsp;<span class="op" id="6086886">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086890">opts</span>&nbsp;<span class="op" id="6086895">=</span>&nbsp;<span class="op" id="6086897">*</span><span class="ident" id="6086898">o</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6086901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086904">if</span>&nbsp;<span class="ident" id="6086907">opts</span><span class="op" id="6086911">.</span><span class="ident" id="6086912">NumColors</span>&nbsp;<span class="op" id="6086922">&lt;</span>&nbsp;<span class="num" id="6086924">1</span>&nbsp;<span class="op" id="6086926">||</span>&nbsp;<span class="num" id="6086929">256</span>&nbsp;<span class="op" id="6086933">&lt;</span>&nbsp;<span class="ident" id="6086935">opts</span><span class="op" id="6086939">.</span><span class="ident" id="6086940">NumColors</span>&nbsp;<span class="op" id="6086950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086954">opts</span><span class="op" id="6086958">.</span><span class="ident" id="6086959">NumColors</span>&nbsp;<span class="op" id="6086969">=</span>&nbsp;<span class="num" id="6086971">256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6086976">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086979">if</span>&nbsp;<span class="ident" id="6086982">opts</span><span class="op" id="6086986">.</span><span class="ident" id="6086987">Drawer</span>&nbsp;<span class="op" id="6086994">==</span>&nbsp;<span class="builtintype" id="6086997">nil</span>&nbsp;<span class="op" id="6087001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6087005">opts</span><span class="op" id="6087009">.</span><span class="ident" id="6087010">Drawer</span>&nbsp;<span class="op" id="6087017">=</span>&nbsp;<span class="ident" id="6087019">draw</span><span class="op" id="6087023">.</span><span class="ident" id="6087024">FloydSteinberg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6087040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6087044">pm</span><span class="op" id="6087046">,</span>&nbsp;<span class="ident" id="6087048">ok</span>&nbsp;<span class="op" id="6087051">:=</span>&nbsp;<span class="ident" id="6087054">m</span><span class="op" id="6087055">.</span><span class="op" id="6087056">(</span><span class="op" id="6087057">*</span><span class="ident" id="6087058">image</span><span class="op" id="6087063">.</span><span class="ident" id="6087064">Paletted</span><span class="op" id="6087072">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6087075">if</span>&nbsp;<span class="op" id="6087078">!</span><span class="ident" id="6087079">ok</span>&nbsp;<span class="op" id="6087082">||</span>&nbsp;<span class="builtinfunc" id="6087085">len</span><span class="op" id="6087088">(</span><span class="ident" id="6087089">pm</span><span class="op" id="6087091">.</span><span class="ident" id="6087092">Palette</span><span class="op" id="6087099">)</span>&nbsp;<span class="op" id="6087101">&gt;</span>&nbsp;<span class="ident" id="6087103">opts</span><span class="op" id="6087107">.</span><span class="ident" id="6087108">NumColors</span>&nbsp;<span class="op" id="6087118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6087122">//&nbsp;TODO:&nbsp;Pick&nbsp;a&nbsp;better&nbsp;sub-sample&nbsp;of&nbsp;the&nbsp;Plan&nbsp;9&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6087181">pm</span>&nbsp;<span class="op" id="6087184">=</span>&nbsp;<span class="ident" id="6087186">image</span><span class="op" id="6087191">.</span><span class="ident" id="6087192">NewPaletted</span><span class="op" id="6087203">(</span><span class="ident" id="6087204">b</span><span class="op" id="6087205">,</span>&nbsp;<span class="ident" id="6087207">palette</span><span class="op" id="6087214">.</span><span class="ident" id="6087215">Plan9</span><span class="op" id="6087220">[</span><span class="op" id="6087221">:</span><span class="ident" id="6087222">opts</span><span class="op" id="6087226">.</span><span class="ident" id="6087227">NumColors</span><span class="op" id="6087236">]</span><span class="op" id="6087237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6087241">if</span>&nbsp;<span class="ident" id="6087244">opts</span><span class="op" id="6087248">.</span><span class="ident" id="6087249">Quantizer</span>&nbsp;<span class="op" id="6087259">!=</span>&nbsp;<span class="builtintype" id="6087262">nil</span>&nbsp;<span class="op" id="6087266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6087271">pm</span><span class="op" id="6087273">.</span><span class="ident" id="6087274">Palette</span>&nbsp;<span class="op" id="6087282">=</span>&nbsp;<span class="ident" id="6087284">opts</span><span class="op" id="6087288">.</span><span class="ident" id="6087289">Quantizer</span><span class="op" id="6087298">.</span><span class="ident" id="6087299">Quantize</span><span class="op" id="6087307">(</span><span class="builtinfunc" id="6087308">make</span><span class="op" id="6087312">(</span><span class="ident" id="6087313">color</span><span class="op" id="6087318">.</span><span class="ident" id="6087319">Palette</span><span class="op" id="6087326">,</span>&nbsp;<span class="num" id="6087328">0</span><span class="op" id="6087329">,</span>&nbsp;<span class="ident" id="6087331">opts</span><span class="op" id="6087335">.</span><span class="ident" id="6087336">NumColors</span><span class="op" id="6087345">)</span><span class="op" id="6087346">,</span>&nbsp;<span class="ident" id="6087348">m</span><span class="op" id="6087349">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6087353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6087357">opts</span><span class="op" id="6087361">.</span><span class="ident" id="6087362">Drawer</span><span class="op" id="6087368">.</span><span class="ident" id="6087369">Draw</span><span class="op" id="6087373">(</span><span class="ident" id="6087374">pm</span><span class="op" id="6087376">,</span>&nbsp;<span class="ident" id="6087378">b</span><span class="op" id="6087379">,</span>&nbsp;<span class="ident" id="6087381">m</span><span class="op" id="6087382">,</span>&nbsp;<span class="ident" id="6087384">image</span><span class="op" id="6087389">.</span><span class="ident" id="6087390">ZP</span><span class="op" id="6087392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6087395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6087399">return</span>&nbsp;<span class="ident" id="6087406">EncodeAll</span><span class="op" id="6087415">(</span><span class="ident" id="6087416">w</span><span class="op" id="6087417">,</span>&nbsp;<span class="op" id="6087419">&amp;</span><span class="ident" id="6087420">GIF</span><span class="op" id="6087423">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6087427">Image</span><span class="op" id="6087432">:</span>&nbsp;<span class="op" id="6087434">[</span><span class="op" id="6087435">]</span><span class="op" id="6087436">*</span><span class="ident" id="6087437">image</span><span class="op" id="6087442">.</span><span class="ident" id="6087443">Paletted</span><span class="op" id="6087451">{</span><span class="ident" id="6087452">pm</span><span class="op" id="6087454">}</span><span class="op" id="6087455">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6087459">Delay</span><span class="op" id="6087464">:</span>&nbsp;<span class="op" id="6087466">[</span><span class="op" id="6087467">]</span><span class="builtintype" id="6087468">int</span><span class="op" id="6087471">{</span><span class="num" id="6087472">0</span><span class="op" id="6087473">}</span><span class="op" id="6087474">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6087477">}</span><span class="op" id="6087478">)</span><br>
<span class="lineno"></span><span class="op" id="6087480">}</span>
</div>
</body>
</html>
