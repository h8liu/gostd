<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp</h2>
<ul>
<li><a href="/gostd/regexp/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/regexp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/regexp/exec.go.html" class="current">exec.go</a></li>
<li><a href="/gostd/regexp/exec2_test.go.html">exec2_test.go</a></li>
<li><a href="/gostd/regexp/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/regexp/find_test.go.html">find_test.go</a></li>
<li><a href="/gostd/regexp/onepass.go.html">onepass.go</a></li>
<li><a href="/gostd/regexp/onepass_test.go.html">onepass_test.go</a></li>
<li><a href="/gostd/regexp/regexp.go.html">regexp.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3053124">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3053179">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3053233">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3053284">package</span>&nbsp;<span class="ident" id="3053292">regexp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3053300">import</span>&nbsp;<span class="op" id="3053307">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3053310">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3053316">&#34;regexp/syntax&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3053332">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3053335">//&nbsp;A&nbsp;queue&nbsp;is&nbsp;a&nbsp;&#39;sparse&nbsp;array&#39;&nbsp;holding&nbsp;pending&nbsp;threads&nbsp;of&nbsp;execution.</span><br>
<span class="lineno"></span><span class="comment" id="3053404">//&nbsp;See&nbsp;http://research.swtch.com/2008/03/using-uninitialized-memory-for-fun-and.html</span><br>
<span class="lineno"></span><span class="keyword" id="3053489">type</span>&nbsp;<span class="ident" id="3053494">queue</span>&nbsp;<span class="keyword" id="3053500">struct</span>&nbsp;<span class="op" id="3053507">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3053510">sparse</span>&nbsp;<span class="op" id="3053517">[</span><span class="op" id="3053518">]</span><span class="builtintype" id="3053519">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3053527">dense</span>&nbsp;&nbsp;<span class="op" id="3053534">[</span><span class="op" id="3053535">]</span><span class="ident" id="3053536">entry</span><br>
<span class="lineno"></span><span class="op" id="3053542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3053545">//&nbsp;A&nbsp;entry&nbsp;is&nbsp;an&nbsp;entry&nbsp;on&nbsp;a&nbsp;queue.</span><br>
<span class="lineno">20</span><span class="comment" id="3053580">//&nbsp;It&nbsp;holds&nbsp;both&nbsp;the&nbsp;instruction&nbsp;pc&nbsp;and&nbsp;the&nbsp;actual&nbsp;thread.</span><br>
<span class="lineno"></span><span class="comment" id="3053639">//&nbsp;Some&nbsp;queue&nbsp;entries&nbsp;are&nbsp;just&nbsp;place&nbsp;holders&nbsp;so&nbsp;that&nbsp;the&nbsp;machine</span><br>
<span class="lineno"></span><span class="comment" id="3053704">//&nbsp;knows&nbsp;it&nbsp;has&nbsp;considered&nbsp;that&nbsp;pc.&nbsp;&nbsp;Such&nbsp;entries&nbsp;have&nbsp;t&nbsp;==&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3053769">type</span>&nbsp;<span class="ident" id="3053774">entry</span>&nbsp;<span class="keyword" id="3053780">struct</span>&nbsp;<span class="op" id="3053787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3053790">pc</span>&nbsp;<span class="builtintype" id="3053793">uint32</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3053801">t</span>&nbsp;&nbsp;<span class="op" id="3053804">*</span><span class="ident" id="3053805">thread</span><br>
<span class="lineno"></span><span class="op" id="3053812">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3053815">//&nbsp;A&nbsp;thread&nbsp;is&nbsp;the&nbsp;state&nbsp;of&nbsp;a&nbsp;single&nbsp;path&nbsp;through&nbsp;the&nbsp;machine:</span><br>
<span class="lineno"></span><span class="comment" id="3053878">//&nbsp;an&nbsp;instruction&nbsp;and&nbsp;a&nbsp;corresponding&nbsp;capture&nbsp;array.</span><br>
<span class="lineno">30</span><span class="comment" id="3053931">//&nbsp;See&nbsp;http://swtch.com/~rsc/regexp/regexp2.html</span><br>
<span class="lineno"></span><span class="keyword" id="3053980">type</span>&nbsp;<span class="ident" id="3053985">thread</span>&nbsp;<span class="keyword" id="3053992">struct</span>&nbsp;<span class="op" id="3053999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3054002">inst</span>&nbsp;<span class="op" id="3054007">*</span><span class="ident" id="3054008">syntax</span><span class="op" id="3054014">.</span><span class="ident" id="3054015">Inst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3054021">cap</span>&nbsp;&nbsp;<span class="op" id="3054026">[</span><span class="op" id="3054027">]</span><span class="builtintype" id="3054028">int</span><br>
<span class="lineno"></span><span class="op" id="3054032">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="3054035">//&nbsp;A&nbsp;machine&nbsp;holds&nbsp;all&nbsp;the&nbsp;state&nbsp;during&nbsp;an&nbsp;NFA&nbsp;simulation&nbsp;for&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword" id="3054100">type</span>&nbsp;<span class="ident" id="3054105">machine</span>&nbsp;<span class="keyword" id="3054113">struct</span>&nbsp;<span class="op" id="3054120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3054123">re</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3054132">*</span><span class="ident" id="3054133">Regexp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3054145">//&nbsp;corresponding&nbsp;Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3054170">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3054179">*</span><span class="ident" id="3054180">syntax</span><span class="op" id="3054186">.</span><span class="ident" id="3054187">Prog</span>&nbsp;<span class="comment" id="3054192">//&nbsp;compiled&nbsp;program</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3054213">op</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3054222">*</span><span class="ident" id="3054223">onePassProg</span>&nbsp;<span class="comment" id="3054235">//&nbsp;compiled&nbsp;onepass&nbsp;program,&nbsp;or&nbsp;notOnePass</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3054279">q0</span><span class="op" id="3054281">,</span>&nbsp;<span class="ident" id="3054283">q1</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3054288">queue</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3054301">//&nbsp;two&nbsp;queues&nbsp;for&nbsp;runq,&nbsp;nextq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3054332">pool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3054341">[</span><span class="op" id="3054342">]</span><span class="op" id="3054343">*</span><span class="ident" id="3054344">thread</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3054354">//&nbsp;pool&nbsp;of&nbsp;available&nbsp;threads</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3054384">matched</span>&nbsp;&nbsp;<span class="builtintype" id="3054393">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3054406">//&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3054436">matchcap</span>&nbsp;<span class="op" id="3054445">[</span><span class="op" id="3054446">]</span><span class="builtintype" id="3054447">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3054458">//&nbsp;capture&nbsp;information&nbsp;for&nbsp;the&nbsp;match</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3054497">//&nbsp;cached&nbsp;inputs,&nbsp;to&nbsp;avoid&nbsp;allocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3054536">inputBytes</span>&nbsp;&nbsp;<span class="ident" id="3054548">inputBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3054560">inputString</span>&nbsp;<span class="ident" id="3054572">inputString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3054585">inputReader</span>&nbsp;<span class="ident" id="3054597">inputReader</span><br>
<span class="lineno">50</span><span class="op" id="3054609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3054612">func</span>&nbsp;<span class="op" id="3054617">(</span><span class="ident" id="3054618">m</span>&nbsp;<span class="op" id="3054620">*</span><span class="ident" id="3054621">machine</span><span class="op" id="3054628">)</span>&nbsp;<span class="ident" id="3054630">newInputBytes</span><span class="op" id="3054643">(</span><span class="ident" id="3054644">b</span>&nbsp;<span class="op" id="3054646">[</span><span class="op" id="3054647">]</span><span class="builtintype" id="3054648">byte</span><span class="op" id="3054652">)</span>&nbsp;<span class="ident" id="3054654">input</span>&nbsp;<span class="op" id="3054660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3054663">m</span><span class="op" id="3054664">.</span><span class="ident" id="3054665">inputBytes</span><span class="op" id="3054675">.</span><span class="ident" id="3054676">str</span>&nbsp;<span class="op" id="3054680">=</span>&nbsp;<span class="ident" id="3054682">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3054685">return</span>&nbsp;<span class="op" id="3054692">&amp;</span><span class="ident" id="3054693">m</span><span class="op" id="3054694">.</span><span class="ident" id="3054695">inputBytes</span><br>
<span class="lineno">55</span><span class="op" id="3054706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3054709">func</span>&nbsp;<span class="op" id="3054714">(</span><span class="ident" id="3054715">m</span>&nbsp;<span class="op" id="3054717">*</span><span class="ident" id="3054718">machine</span><span class="op" id="3054725">)</span>&nbsp;<span class="ident" id="3054727">newInputString</span><span class="op" id="3054741">(</span><span class="ident" id="3054742">s</span>&nbsp;<span class="builtintype" id="3054744">string</span><span class="op" id="3054750">)</span>&nbsp;<span class="ident" id="3054752">input</span>&nbsp;<span class="op" id="3054758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3054761">m</span><span class="op" id="3054762">.</span><span class="ident" id="3054763">inputString</span><span class="op" id="3054774">.</span><span class="ident" id="3054775">str</span>&nbsp;<span class="op" id="3054779">=</span>&nbsp;<span class="ident" id="3054781">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3054784">return</span>&nbsp;<span class="op" id="3054791">&amp;</span><span class="ident" id="3054792">m</span><span class="op" id="3054793">.</span><span class="ident" id="3054794">inputString</span><br>
<span class="lineno">60</span><span class="op" id="3054806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3054809">func</span>&nbsp;<span class="op" id="3054814">(</span><span class="ident" id="3054815">m</span>&nbsp;<span class="op" id="3054817">*</span><span class="ident" id="3054818">machine</span><span class="op" id="3054825">)</span>&nbsp;<span class="ident" id="3054827">newInputReader</span><span class="op" id="3054841">(</span><span class="ident" id="3054842">r</span>&nbsp;<span class="ident" id="3054844">io</span><span class="op" id="3054846">.</span><span class="ident" id="3054847">RuneReader</span><span class="op" id="3054857">)</span>&nbsp;<span class="ident" id="3054859">input</span>&nbsp;<span class="op" id="3054865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3054868">m</span><span class="op" id="3054869">.</span><span class="ident" id="3054870">inputReader</span><span class="op" id="3054881">.</span><span class="ident" id="3054882">r</span>&nbsp;<span class="op" id="3054884">=</span>&nbsp;<span class="ident" id="3054886">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3054889">m</span><span class="op" id="3054890">.</span><span class="ident" id="3054891">inputReader</span><span class="op" id="3054902">.</span><span class="ident" id="3054903">atEOT</span>&nbsp;<span class="op" id="3054909">=</span>&nbsp;<span class="builtintype" id="3054911">false</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3054918">m</span><span class="op" id="3054919">.</span><span class="ident" id="3054920">inputReader</span><span class="op" id="3054931">.</span><span class="ident" id="3054932">pos</span>&nbsp;<span class="op" id="3054936">=</span>&nbsp;<span class="num" id="3054938">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3054941">return</span>&nbsp;<span class="op" id="3054948">&amp;</span><span class="ident" id="3054949">m</span><span class="op" id="3054950">.</span><span class="ident" id="3054951">inputReader</span><br>
<span class="lineno"></span><span class="op" id="3054963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3054966">//&nbsp;progMachine&nbsp;returns&nbsp;a&nbsp;new&nbsp;machine&nbsp;running&nbsp;the&nbsp;prog&nbsp;p.</span><br>
<span class="lineno">70</span><span class="keyword" id="3055023">func</span>&nbsp;<span class="ident" id="3055028">progMachine</span><span class="op" id="3055039">(</span><span class="ident" id="3055040">p</span>&nbsp;<span class="op" id="3055042">*</span><span class="ident" id="3055043">syntax</span><span class="op" id="3055049">.</span><span class="ident" id="3055050">Prog</span><span class="op" id="3055054">,</span>&nbsp;<span class="ident" id="3055056">op</span>&nbsp;<span class="op" id="3055059">*</span><span class="ident" id="3055060">onePassProg</span><span class="op" id="3055071">)</span>&nbsp;<span class="op" id="3055073">*</span><span class="ident" id="3055074">machine</span>&nbsp;<span class="op" id="3055082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055085">m</span>&nbsp;<span class="op" id="3055087">:=</span>&nbsp;<span class="op" id="3055090">&amp;</span><span class="ident" id="3055091">machine</span><span class="op" id="3055098">{</span><span class="ident" id="3055099">p</span><span class="op" id="3055100">:</span>&nbsp;<span class="ident" id="3055102">p</span><span class="op" id="3055103">,</span>&nbsp;<span class="ident" id="3055105">op</span><span class="op" id="3055107">:</span>&nbsp;<span class="ident" id="3055109">op</span><span class="op" id="3055111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055114">n</span>&nbsp;<span class="op" id="3055116">:=</span>&nbsp;<span class="builtinfunc" id="3055119">len</span><span class="op" id="3055122">(</span><span class="ident" id="3055123">m</span><span class="op" id="3055124">.</span><span class="ident" id="3055125">p</span><span class="op" id="3055126">.</span><span class="ident" id="3055127">Inst</span><span class="op" id="3055131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055134">m</span><span class="op" id="3055135">.</span><span class="ident" id="3055136">q0</span>&nbsp;<span class="op" id="3055139">=</span>&nbsp;<span class="ident" id="3055141">queue</span><span class="op" id="3055146">{</span><span class="builtinfunc" id="3055147">make</span><span class="op" id="3055151">(</span><span class="op" id="3055152">[</span><span class="op" id="3055153">]</span><span class="builtintype" id="3055154">uint32</span><span class="op" id="3055160">,</span>&nbsp;<span class="ident" id="3055162">n</span><span class="op" id="3055163">)</span><span class="op" id="3055164">,</span>&nbsp;<span class="builtinfunc" id="3055166">make</span><span class="op" id="3055170">(</span><span class="op" id="3055171">[</span><span class="op" id="3055172">]</span><span class="ident" id="3055173">entry</span><span class="op" id="3055178">,</span>&nbsp;<span class="num" id="3055180">0</span><span class="op" id="3055181">,</span>&nbsp;<span class="ident" id="3055183">n</span><span class="op" id="3055184">)</span><span class="op" id="3055185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055188">m</span><span class="op" id="3055189">.</span><span class="ident" id="3055190">q1</span>&nbsp;<span class="op" id="3055193">=</span>&nbsp;<span class="ident" id="3055195">queue</span><span class="op" id="3055200">{</span><span class="builtinfunc" id="3055201">make</span><span class="op" id="3055205">(</span><span class="op" id="3055206">[</span><span class="op" id="3055207">]</span><span class="builtintype" id="3055208">uint32</span><span class="op" id="3055214">,</span>&nbsp;<span class="ident" id="3055216">n</span><span class="op" id="3055217">)</span><span class="op" id="3055218">,</span>&nbsp;<span class="builtinfunc" id="3055220">make</span><span class="op" id="3055224">(</span><span class="op" id="3055225">[</span><span class="op" id="3055226">]</span><span class="ident" id="3055227">entry</span><span class="op" id="3055232">,</span>&nbsp;<span class="num" id="3055234">0</span><span class="op" id="3055235">,</span>&nbsp;<span class="ident" id="3055237">n</span><span class="op" id="3055238">)</span><span class="op" id="3055239">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055242">ncap</span>&nbsp;<span class="op" id="3055247">:=</span>&nbsp;<span class="ident" id="3055250">p</span><span class="op" id="3055251">.</span><span class="ident" id="3055252">NumCap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055260">if</span>&nbsp;<span class="ident" id="3055263">ncap</span>&nbsp;<span class="op" id="3055268">&lt;</span>&nbsp;<span class="num" id="3055270">2</span>&nbsp;<span class="op" id="3055272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055276">ncap</span>&nbsp;<span class="op" id="3055281">=</span>&nbsp;<span class="num" id="3055283">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3055286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055289">m</span><span class="op" id="3055290">.</span><span class="ident" id="3055291">matchcap</span>&nbsp;<span class="op" id="3055300">=</span>&nbsp;<span class="builtinfunc" id="3055302">make</span><span class="op" id="3055306">(</span><span class="op" id="3055307">[</span><span class="op" id="3055308">]</span><span class="builtintype" id="3055309">int</span><span class="op" id="3055312">,</span>&nbsp;<span class="ident" id="3055314">ncap</span><span class="op" id="3055318">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055321">return</span>&nbsp;<span class="ident" id="3055328">m</span><br>
<span class="lineno"></span><span class="op" id="3055330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3055333">func</span>&nbsp;<span class="op" id="3055338">(</span><span class="ident" id="3055339">m</span>&nbsp;<span class="op" id="3055341">*</span><span class="ident" id="3055342">machine</span><span class="op" id="3055349">)</span>&nbsp;<span class="ident" id="3055351">init</span><span class="op" id="3055355">(</span><span class="ident" id="3055356">ncap</span>&nbsp;<span class="builtintype" id="3055361">int</span><span class="op" id="3055364">)</span>&nbsp;<span class="op" id="3055366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055369">for</span>&nbsp;<span class="ident" id="3055373">_</span><span class="op" id="3055374">,</span>&nbsp;<span class="ident" id="3055376">t</span>&nbsp;<span class="op" id="3055378">:=</span>&nbsp;<span class="keyword" id="3055381">range</span>&nbsp;<span class="ident" id="3055387">m</span><span class="op" id="3055388">.</span><span class="ident" id="3055389">pool</span>&nbsp;<span class="op" id="3055394">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055398">t</span><span class="op" id="3055399">.</span><span class="builtinfunc" id="3055400">cap</span>&nbsp;<span class="op" id="3055404">=</span>&nbsp;<span class="ident" id="3055406">t</span><span class="op" id="3055407">.</span><span class="builtinfunc" id="3055408">cap</span><span class="op" id="3055411">[</span><span class="op" id="3055412">:</span><span class="ident" id="3055413">ncap</span><span class="op" id="3055417">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3055420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055423">m</span><span class="op" id="3055424">.</span><span class="ident" id="3055425">matchcap</span>&nbsp;<span class="op" id="3055434">=</span>&nbsp;<span class="ident" id="3055436">m</span><span class="op" id="3055437">.</span><span class="ident" id="3055438">matchcap</span><span class="op" id="3055446">[</span><span class="op" id="3055447">:</span><span class="ident" id="3055448">ncap</span><span class="op" id="3055452">]</span><br>
<span class="lineno"></span><span class="op" id="3055454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="3055457">//&nbsp;alloc&nbsp;allocates&nbsp;a&nbsp;new&nbsp;thread&nbsp;with&nbsp;the&nbsp;given&nbsp;instruction.</span><br>
<span class="lineno"></span><span class="comment" id="3055517">//&nbsp;It&nbsp;uses&nbsp;the&nbsp;free&nbsp;pool&nbsp;if&nbsp;possible.</span><br>
<span class="lineno"></span><span class="keyword" id="3055555">func</span>&nbsp;<span class="op" id="3055560">(</span><span class="ident" id="3055561">m</span>&nbsp;<span class="op" id="3055563">*</span><span class="ident" id="3055564">machine</span><span class="op" id="3055571">)</span>&nbsp;<span class="ident" id="3055573">alloc</span><span class="op" id="3055578">(</span><span class="ident" id="3055579">i</span>&nbsp;<span class="op" id="3055581">*</span><span class="ident" id="3055582">syntax</span><span class="op" id="3055588">.</span><span class="ident" id="3055589">Inst</span><span class="op" id="3055593">)</span>&nbsp;<span class="op" id="3055595">*</span><span class="ident" id="3055596">thread</span>&nbsp;<span class="op" id="3055603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055606">var</span>&nbsp;<span class="ident" id="3055610">t</span>&nbsp;<span class="op" id="3055612">*</span><span class="ident" id="3055613">thread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055621">if</span>&nbsp;<span class="ident" id="3055624">n</span>&nbsp;<span class="op" id="3055626">:=</span>&nbsp;<span class="builtinfunc" id="3055629">len</span><span class="op" id="3055632">(</span><span class="ident" id="3055633">m</span><span class="op" id="3055634">.</span><span class="ident" id="3055635">pool</span><span class="op" id="3055639">)</span><span class="op" id="3055640">;</span>&nbsp;<span class="ident" id="3055642">n</span>&nbsp;<span class="op" id="3055644">&gt;</span>&nbsp;<span class="num" id="3055646">0</span>&nbsp;<span class="op" id="3055648">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055652">t</span>&nbsp;<span class="op" id="3055654">=</span>&nbsp;<span class="ident" id="3055656">m</span><span class="op" id="3055657">.</span><span class="ident" id="3055658">pool</span><span class="op" id="3055662">[</span><span class="ident" id="3055663">n</span><span class="op" id="3055664">-</span><span class="num" id="3055665">1</span><span class="op" id="3055666">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055670">m</span><span class="op" id="3055671">.</span><span class="ident" id="3055672">pool</span>&nbsp;<span class="op" id="3055677">=</span>&nbsp;<span class="ident" id="3055679">m</span><span class="op" id="3055680">.</span><span class="ident" id="3055681">pool</span><span class="op" id="3055685">[</span><span class="op" id="3055686">:</span><span class="ident" id="3055687">n</span><span class="op" id="3055688">-</span><span class="num" id="3055689">1</span><span class="op" id="3055690">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3055693">}</span>&nbsp;<span class="keyword" id="3055695">else</span>&nbsp;<span class="op" id="3055700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055704">t</span>&nbsp;<span class="op" id="3055706">=</span>&nbsp;<span class="builtinfunc" id="3055708">new</span><span class="op" id="3055711">(</span><span class="ident" id="3055712">thread</span><span class="op" id="3055718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055722">t</span><span class="op" id="3055723">.</span><span class="builtinfunc" id="3055724">cap</span>&nbsp;<span class="op" id="3055728">=</span>&nbsp;<span class="builtinfunc" id="3055730">make</span><span class="op" id="3055734">(</span><span class="op" id="3055735">[</span><span class="op" id="3055736">]</span><span class="builtintype" id="3055737">int</span><span class="op" id="3055740">,</span>&nbsp;<span class="builtinfunc" id="3055742">len</span><span class="op" id="3055745">(</span><span class="ident" id="3055746">m</span><span class="op" id="3055747">.</span><span class="ident" id="3055748">matchcap</span><span class="op" id="3055756">)</span><span class="op" id="3055757">,</span>&nbsp;<span class="builtinfunc" id="3055759">cap</span><span class="op" id="3055762">(</span><span class="ident" id="3055763">m</span><span class="op" id="3055764">.</span><span class="ident" id="3055765">matchcap</span><span class="op" id="3055773">)</span><span class="op" id="3055774">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3055777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055780">t</span><span class="op" id="3055781">.</span><span class="ident" id="3055782">inst</span>&nbsp;<span class="op" id="3055787">=</span>&nbsp;<span class="ident" id="3055789">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055792">return</span>&nbsp;<span class="ident" id="3055799">t</span><br>
<span class="lineno"></span><span class="op" id="3055801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="3055804">//&nbsp;free&nbsp;returns&nbsp;t&nbsp;to&nbsp;the&nbsp;free&nbsp;pool.</span><br>
<span class="lineno"></span><span class="keyword" id="3055840">func</span>&nbsp;<span class="op" id="3055845">(</span><span class="ident" id="3055846">m</span>&nbsp;<span class="op" id="3055848">*</span><span class="ident" id="3055849">machine</span><span class="op" id="3055856">)</span>&nbsp;<span class="ident" id="3055858">free</span><span class="op" id="3055862">(</span><span class="ident" id="3055863">t</span>&nbsp;<span class="op" id="3055865">*</span><span class="ident" id="3055866">thread</span><span class="op" id="3055872">)</span>&nbsp;<span class="op" id="3055874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055877">m</span><span class="op" id="3055878">.</span><span class="ident" id="3055879">inputBytes</span><span class="op" id="3055889">.</span><span class="ident" id="3055890">str</span>&nbsp;<span class="op" id="3055894">=</span>&nbsp;<span class="ident" id="3055896">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055901">m</span><span class="op" id="3055902">.</span><span class="ident" id="3055903">inputString</span><span class="op" id="3055914">.</span><span class="ident" id="3055915">str</span>&nbsp;<span class="op" id="3055919">=</span>&nbsp;<span class="string" id="3055921">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055925">m</span><span class="op" id="3055926">.</span><span class="ident" id="3055927">inputReader</span><span class="op" id="3055938">.</span><span class="ident" id="3055939">r</span>&nbsp;<span class="op" id="3055941">=</span>&nbsp;<span class="ident" id="3055943">nil</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055948">m</span><span class="op" id="3055949">.</span><span class="ident" id="3055950">pool</span>&nbsp;<span class="op" id="3055955">=</span>&nbsp;<span class="builtinfunc" id="3055957">append</span><span class="op" id="3055963">(</span><span class="ident" id="3055964">m</span><span class="op" id="3055965">.</span><span class="ident" id="3055966">pool</span><span class="op" id="3055970">,</span>&nbsp;<span class="ident" id="3055972">t</span><span class="op" id="3055973">)</span><br>
<span class="lineno"></span><span class="op" id="3055975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3055978">//&nbsp;match&nbsp;runs&nbsp;the&nbsp;machine&nbsp;over&nbsp;the&nbsp;input&nbsp;starting&nbsp;at&nbsp;pos.</span><br>
<span class="lineno"></span><span class="comment" id="3056036">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found.</span><br>
<span class="lineno">115</span><span class="comment" id="3056077">//&nbsp;If&nbsp;so,&nbsp;m.matchcap&nbsp;holds&nbsp;the&nbsp;submatch&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="3056130">func</span>&nbsp;<span class="op" id="3056135">(</span><span class="ident" id="3056136">m</span>&nbsp;<span class="op" id="3056138">*</span><span class="ident" id="3056139">machine</span><span class="op" id="3056146">)</span>&nbsp;<span class="ident" id="3056148">match</span><span class="op" id="3056153">(</span><span class="ident" id="3056154">i</span>&nbsp;<span class="ident" id="3056156">input</span><span class="op" id="3056161">,</span>&nbsp;<span class="ident" id="3056163">pos</span>&nbsp;<span class="builtintype" id="3056167">int</span><span class="op" id="3056170">)</span>&nbsp;<span class="builtintype" id="3056172">bool</span>&nbsp;<span class="op" id="3056177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3056180">startCond</span>&nbsp;<span class="op" id="3056190">:=</span>&nbsp;<span class="ident" id="3056193">m</span><span class="op" id="3056194">.</span><span class="ident" id="3056195">re</span><span class="op" id="3056197">.</span><span class="ident" id="3056198">cond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056204">if</span>&nbsp;<span class="ident" id="3056207">startCond</span>&nbsp;<span class="op" id="3056217">==</span>&nbsp;<span class="op" id="3056220">^</span><span class="ident" id="3056221">syntax</span><span class="op" id="3056227">.</span><span class="ident" id="3056228">EmptyOp</span><span class="op" id="3056235">(</span><span class="num" id="3056236">0</span><span class="op" id="3056237">)</span>&nbsp;<span class="op" id="3056239">{</span>&nbsp;<span class="comment" id="3056241">//&nbsp;impossible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056257">return</span>&nbsp;<span class="builtintype" id="3056264">false</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3056271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3056274">m</span><span class="op" id="3056275">.</span><span class="ident" id="3056276">matched</span>&nbsp;<span class="op" id="3056284">=</span>&nbsp;<span class="builtintype" id="3056286">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056293">for</span>&nbsp;<span class="ident" id="3056297">i</span>&nbsp;<span class="op" id="3056299">:=</span>&nbsp;<span class="keyword" id="3056302">range</span>&nbsp;<span class="ident" id="3056308">m</span><span class="op" id="3056309">.</span><span class="ident" id="3056310">matchcap</span>&nbsp;<span class="op" id="3056319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3056323">m</span><span class="op" id="3056324">.</span><span class="ident" id="3056325">matchcap</span><span class="op" id="3056333">[</span><span class="ident" id="3056334">i</span><span class="op" id="3056335">]</span>&nbsp;<span class="op" id="3056337">=</span>&nbsp;<span class="op" id="3056339">-</span><span class="num" id="3056340">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3056343">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3056346">runq</span><span class="op" id="3056350">,</span>&nbsp;<span class="ident" id="3056352">nextq</span>&nbsp;<span class="op" id="3056358">:=</span>&nbsp;<span class="op" id="3056361">&amp;</span><span class="ident" id="3056362">m</span><span class="op" id="3056363">.</span><span class="ident" id="3056364">q0</span><span class="op" id="3056366">,</span>&nbsp;<span class="op" id="3056368">&amp;</span><span class="ident" id="3056369">m</span><span class="op" id="3056370">.</span><span class="ident" id="3056371">q1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3056375">r</span><span class="op" id="3056376">,</span>&nbsp;<span class="ident" id="3056378">r1</span>&nbsp;<span class="op" id="3056381">:=</span>&nbsp;<span class="ident" id="3056384">endOfText</span><span class="op" id="3056393">,</span>&nbsp;<span class="ident" id="3056395">endOfText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3056406">width</span><span class="op" id="3056411">,</span>&nbsp;<span class="ident" id="3056413">width1</span>&nbsp;<span class="op" id="3056420">:=</span>&nbsp;<span class="num" id="3056423">0</span><span class="op" id="3056424">,</span>&nbsp;<span class="num" id="3056426">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3056429">r</span><span class="op" id="3056430">,</span>&nbsp;<span class="ident" id="3056432">width</span>&nbsp;<span class="op" id="3056438">=</span>&nbsp;<span class="ident" id="3056440">i</span><span class="op" id="3056441">.</span><span class="ident" id="3056442">step</span><span class="op" id="3056446">(</span><span class="ident" id="3056447">pos</span><span class="op" id="3056450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056453">if</span>&nbsp;<span class="ident" id="3056456">r</span>&nbsp;<span class="op" id="3056458">!=</span>&nbsp;<span class="ident" id="3056461">endOfText</span>&nbsp;<span class="op" id="3056471">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3056475">r1</span><span class="op" id="3056477">,</span>&nbsp;<span class="ident" id="3056479">width1</span>&nbsp;<span class="op" id="3056486">=</span>&nbsp;<span class="ident" id="3056488">i</span><span class="op" id="3056489">.</span><span class="ident" id="3056490">step</span><span class="op" id="3056494">(</span><span class="ident" id="3056495">pos</span>&nbsp;<span class="op" id="3056499">+</span>&nbsp;<span class="ident" id="3056501">width</span><span class="op" id="3056506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3056509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056512">var</span>&nbsp;<span class="ident" id="3056516">flag</span>&nbsp;<span class="ident" id="3056521">syntax</span><span class="op" id="3056527">.</span><span class="ident" id="3056528">EmptyOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056537">if</span>&nbsp;<span class="ident" id="3056540">pos</span>&nbsp;<span class="op" id="3056544">==</span>&nbsp;<span class="num" id="3056547">0</span>&nbsp;<span class="op" id="3056549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3056553">flag</span>&nbsp;<span class="op" id="3056558">=</span>&nbsp;<span class="ident" id="3056560">syntax</span><span class="op" id="3056566">.</span><span class="ident" id="3056567">EmptyOpContext</span><span class="op" id="3056581">(</span><span class="op" id="3056582">-</span><span class="num" id="3056583">1</span><span class="op" id="3056584">,</span>&nbsp;<span class="ident" id="3056586">r</span><span class="op" id="3056587">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3056590">}</span>&nbsp;<span class="keyword" id="3056592">else</span>&nbsp;<span class="op" id="3056597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3056601">flag</span>&nbsp;<span class="op" id="3056606">=</span>&nbsp;<span class="ident" id="3056608">i</span><span class="op" id="3056609">.</span><span class="ident" id="3056610">context</span><span class="op" id="3056617">(</span><span class="ident" id="3056618">pos</span><span class="op" id="3056621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3056624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056627">for</span>&nbsp;<span class="op" id="3056631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056635">if</span>&nbsp;<span class="builtinfunc" id="3056638">len</span><span class="op" id="3056641">(</span><span class="ident" id="3056642">runq</span><span class="op" id="3056646">.</span><span class="ident" id="3056647">dense</span><span class="op" id="3056652">)</span>&nbsp;<span class="op" id="3056654">==</span>&nbsp;<span class="num" id="3056657">0</span>&nbsp;<span class="op" id="3056659">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056664">if</span>&nbsp;<span class="ident" id="3056667">startCond</span><span class="op" id="3056676">&amp;</span><span class="ident" id="3056677">syntax</span><span class="op" id="3056683">.</span><span class="ident" id="3056684">EmptyBeginText</span>&nbsp;<span class="op" id="3056699">!=</span>&nbsp;<span class="num" id="3056702">0</span>&nbsp;<span class="op" id="3056704">&amp;&amp;</span>&nbsp;<span class="ident" id="3056707">pos</span>&nbsp;<span class="op" id="3056711">!=</span>&nbsp;<span class="num" id="3056714">0</span>&nbsp;<span class="op" id="3056716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3056722">//&nbsp;Anchored&nbsp;match,&nbsp;past&nbsp;beginning&nbsp;of&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056769">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3056778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056783">if</span>&nbsp;<span class="ident" id="3056786">m</span><span class="op" id="3056787">.</span><span class="ident" id="3056788">matched</span>&nbsp;<span class="op" id="3056796">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3056802">//&nbsp;Have&nbsp;match;&nbsp;finished&nbsp;exploring&nbsp;alternatives.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056854">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3056863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056868">if</span>&nbsp;<span class="builtinfunc" id="3056871">len</span><span class="op" id="3056874">(</span><span class="ident" id="3056875">m</span><span class="op" id="3056876">.</span><span class="ident" id="3056877">re</span><span class="op" id="3056879">.</span><span class="ident" id="3056880">prefix</span><span class="op" id="3056886">)</span>&nbsp;<span class="op" id="3056888">&gt;</span>&nbsp;<span class="num" id="3056890">0</span>&nbsp;<span class="op" id="3056892">&amp;&amp;</span>&nbsp;<span class="ident" id="3056895">r1</span>&nbsp;<span class="op" id="3056898">!=</span>&nbsp;<span class="ident" id="3056901">m</span><span class="op" id="3056902">.</span><span class="ident" id="3056903">re</span><span class="op" id="3056905">.</span><span class="ident" id="3056906">prefixRune</span>&nbsp;<span class="op" id="3056917">&amp;&amp;</span>&nbsp;<span class="ident" id="3056920">i</span><span class="op" id="3056921">.</span><span class="ident" id="3056922">canCheckPrefix</span><span class="op" id="3056936">(</span><span class="op" id="3056937">)</span>&nbsp;<span class="op" id="3056939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3056945">//&nbsp;Match&nbsp;requires&nbsp;literal&nbsp;prefix;&nbsp;fast&nbsp;search&nbsp;for&nbsp;it.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057003">advance</span>&nbsp;<span class="op" id="3057011">:=</span>&nbsp;<span class="ident" id="3057014">i</span><span class="op" id="3057015">.</span><span class="ident" id="3057016">index</span><span class="op" id="3057021">(</span><span class="ident" id="3057022">m</span><span class="op" id="3057023">.</span><span class="ident" id="3057024">re</span><span class="op" id="3057026">,</span>&nbsp;<span class="ident" id="3057028">pos</span><span class="op" id="3057031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057037">if</span>&nbsp;<span class="ident" id="3057040">advance</span>&nbsp;<span class="op" id="3057048">&lt;</span>&nbsp;<span class="num" id="3057050">0</span>&nbsp;<span class="op" id="3057052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057059">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3057069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057075">pos</span>&nbsp;<span class="op" id="3057079">+=</span>&nbsp;<span class="ident" id="3057082">advance</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057094">r</span><span class="op" id="3057095">,</span>&nbsp;<span class="ident" id="3057097">width</span>&nbsp;<span class="op" id="3057103">=</span>&nbsp;<span class="ident" id="3057105">i</span><span class="op" id="3057106">.</span><span class="ident" id="3057107">step</span><span class="op" id="3057111">(</span><span class="ident" id="3057112">pos</span><span class="op" id="3057115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057121">r1</span><span class="op" id="3057123">,</span>&nbsp;<span class="ident" id="3057125">width1</span>&nbsp;<span class="op" id="3057132">=</span>&nbsp;<span class="ident" id="3057134">i</span><span class="op" id="3057135">.</span><span class="ident" id="3057136">step</span><span class="op" id="3057140">(</span><span class="ident" id="3057141">pos</span>&nbsp;<span class="op" id="3057145">+</span>&nbsp;<span class="ident" id="3057147">width</span><span class="op" id="3057152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3057157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3057161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057165">if</span>&nbsp;<span class="op" id="3057168">!</span><span class="ident" id="3057169">m</span><span class="op" id="3057170">.</span><span class="ident" id="3057171">matched</span>&nbsp;<span class="op" id="3057179">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057184">if</span>&nbsp;<span class="builtinfunc" id="3057187">len</span><span class="op" id="3057190">(</span><span class="ident" id="3057191">m</span><span class="op" id="3057192">.</span><span class="ident" id="3057193">matchcap</span><span class="op" id="3057201">)</span>&nbsp;<span class="op" id="3057203">&gt;</span>&nbsp;<span class="num" id="3057205">0</span>&nbsp;<span class="op" id="3057207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057213">m</span><span class="op" id="3057214">.</span><span class="ident" id="3057215">matchcap</span><span class="op" id="3057223">[</span><span class="num" id="3057224">0</span><span class="op" id="3057225">]</span>&nbsp;<span class="op" id="3057227">=</span>&nbsp;<span class="ident" id="3057229">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3057236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057241">m</span><span class="op" id="3057242">.</span><span class="ident" id="3057243">add</span><span class="op" id="3057246">(</span><span class="ident" id="3057247">runq</span><span class="op" id="3057251">,</span>&nbsp;<span class="builtintype" id="3057253">uint32</span><span class="op" id="3057259">(</span><span class="ident" id="3057260">m</span><span class="op" id="3057261">.</span><span class="ident" id="3057262">p</span><span class="op" id="3057263">.</span><span class="ident" id="3057264">Start</span><span class="op" id="3057269">)</span><span class="op" id="3057270">,</span>&nbsp;<span class="ident" id="3057272">pos</span><span class="op" id="3057275">,</span>&nbsp;<span class="ident" id="3057277">m</span><span class="op" id="3057278">.</span><span class="ident" id="3057279">matchcap</span><span class="op" id="3057287">,</span>&nbsp;<span class="ident" id="3057289">flag</span><span class="op" id="3057293">,</span>&nbsp;<span class="ident" id="3057295">nil</span><span class="op" id="3057298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3057302">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057306">flag</span>&nbsp;<span class="op" id="3057311">=</span>&nbsp;<span class="ident" id="3057313">syntax</span><span class="op" id="3057319">.</span><span class="ident" id="3057320">EmptyOpContext</span><span class="op" id="3057334">(</span><span class="ident" id="3057335">r</span><span class="op" id="3057336">,</span>&nbsp;<span class="ident" id="3057338">r1</span><span class="op" id="3057340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057344">m</span><span class="op" id="3057345">.</span><span class="ident" id="3057346">step</span><span class="op" id="3057350">(</span><span class="ident" id="3057351">runq</span><span class="op" id="3057355">,</span>&nbsp;<span class="ident" id="3057357">nextq</span><span class="op" id="3057362">,</span>&nbsp;<span class="ident" id="3057364">pos</span><span class="op" id="3057367">,</span>&nbsp;<span class="ident" id="3057369">pos</span><span class="op" id="3057372">+</span><span class="ident" id="3057373">width</span><span class="op" id="3057378">,</span>&nbsp;<span class="ident" id="3057380">r</span><span class="op" id="3057381">,</span>&nbsp;<span class="ident" id="3057383">flag</span><span class="op" id="3057387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057391">if</span>&nbsp;<span class="ident" id="3057394">width</span>&nbsp;<span class="op" id="3057400">==</span>&nbsp;<span class="num" id="3057403">0</span>&nbsp;<span class="op" id="3057405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057410">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3057418">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057422">if</span>&nbsp;<span class="builtinfunc" id="3057425">len</span><span class="op" id="3057428">(</span><span class="ident" id="3057429">m</span><span class="op" id="3057430">.</span><span class="ident" id="3057431">matchcap</span><span class="op" id="3057439">)</span>&nbsp;<span class="op" id="3057441">==</span>&nbsp;<span class="num" id="3057444">0</span>&nbsp;<span class="op" id="3057446">&amp;&amp;</span>&nbsp;<span class="ident" id="3057449">m</span><span class="op" id="3057450">.</span><span class="ident" id="3057451">matched</span>&nbsp;<span class="op" id="3057459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3057464">//&nbsp;Found&nbsp;a&nbsp;match&nbsp;and&nbsp;not&nbsp;paying&nbsp;attention</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3057509">//&nbsp;to&nbsp;where&nbsp;it&nbsp;is,&nbsp;so&nbsp;any&nbsp;match&nbsp;will&nbsp;do.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057553">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3057561">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057565">pos</span>&nbsp;<span class="op" id="3057569">+=</span>&nbsp;<span class="ident" id="3057572">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057580">r</span><span class="op" id="3057581">,</span>&nbsp;<span class="ident" id="3057583">width</span>&nbsp;<span class="op" id="3057589">=</span>&nbsp;<span class="ident" id="3057591">r1</span><span class="op" id="3057593">,</span>&nbsp;<span class="ident" id="3057595">width1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057604">if</span>&nbsp;<span class="ident" id="3057607">r</span>&nbsp;<span class="op" id="3057609">!=</span>&nbsp;<span class="ident" id="3057612">endOfText</span>&nbsp;<span class="op" id="3057622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057627">r1</span><span class="op" id="3057629">,</span>&nbsp;<span class="ident" id="3057631">width1</span>&nbsp;<span class="op" id="3057638">=</span>&nbsp;<span class="ident" id="3057640">i</span><span class="op" id="3057641">.</span><span class="ident" id="3057642">step</span><span class="op" id="3057646">(</span><span class="ident" id="3057647">pos</span>&nbsp;<span class="op" id="3057651">+</span>&nbsp;<span class="ident" id="3057653">width</span><span class="op" id="3057658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3057662">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057666">runq</span><span class="op" id="3057670">,</span>&nbsp;<span class="ident" id="3057672">nextq</span>&nbsp;<span class="op" id="3057678">=</span>&nbsp;<span class="ident" id="3057680">nextq</span><span class="op" id="3057685">,</span>&nbsp;<span class="ident" id="3057687">runq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3057693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057696">m</span><span class="op" id="3057697">.</span><span class="ident" id="3057698">clear</span><span class="op" id="3057703">(</span><span class="ident" id="3057704">nextq</span><span class="op" id="3057709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057712">return</span>&nbsp;<span class="ident" id="3057719">m</span><span class="op" id="3057720">.</span><span class="ident" id="3057721">matched</span><br>
<span class="lineno"></span><span class="op" id="3057729">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="comment" id="3057732">//&nbsp;clear&nbsp;frees&nbsp;all&nbsp;threads&nbsp;on&nbsp;the&nbsp;thread&nbsp;queue.</span><br>
<span class="lineno"></span><span class="keyword" id="3057780">func</span>&nbsp;<span class="op" id="3057785">(</span><span class="ident" id="3057786">m</span>&nbsp;<span class="op" id="3057788">*</span><span class="ident" id="3057789">machine</span><span class="op" id="3057796">)</span>&nbsp;<span class="ident" id="3057798">clear</span><span class="op" id="3057803">(</span><span class="ident" id="3057804">q</span>&nbsp;<span class="op" id="3057806">*</span><span class="ident" id="3057807">queue</span><span class="op" id="3057812">)</span>&nbsp;<span class="op" id="3057814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057817">for</span>&nbsp;<span class="ident" id="3057821">_</span><span class="op" id="3057822">,</span>&nbsp;<span class="ident" id="3057824">d</span>&nbsp;<span class="op" id="3057826">:=</span>&nbsp;<span class="keyword" id="3057829">range</span>&nbsp;<span class="ident" id="3057835">q</span><span class="op" id="3057836">.</span><span class="ident" id="3057837">dense</span>&nbsp;<span class="op" id="3057843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057847">if</span>&nbsp;<span class="ident" id="3057850">d</span><span class="op" id="3057851">.</span><span class="ident" id="3057852">t</span>&nbsp;<span class="op" id="3057854">!=</span>&nbsp;<span class="ident" id="3057857">nil</span>&nbsp;<span class="op" id="3057861">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3057866">//&nbsp;m.free(d.t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057884">m</span><span class="op" id="3057885">.</span><span class="ident" id="3057886">pool</span>&nbsp;<span class="op" id="3057891">=</span>&nbsp;<span class="builtinfunc" id="3057893">append</span><span class="op" id="3057899">(</span><span class="ident" id="3057900">m</span><span class="op" id="3057901">.</span><span class="ident" id="3057902">pool</span><span class="op" id="3057906">,</span>&nbsp;<span class="ident" id="3057908">d</span><span class="op" id="3057909">.</span><span class="ident" id="3057910">t</span><span class="op" id="3057911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3057915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3057918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057921">q</span><span class="op" id="3057922">.</span><span class="ident" id="3057923">dense</span>&nbsp;<span class="op" id="3057929">=</span>&nbsp;<span class="ident" id="3057931">q</span><span class="op" id="3057932">.</span><span class="ident" id="3057933">dense</span><span class="op" id="3057938">[</span><span class="op" id="3057939">:</span><span class="num" id="3057940">0</span><span class="op" id="3057941">]</span><br>
<span class="lineno">195</span><span class="op" id="3057943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3057946">//&nbsp;step&nbsp;executes&nbsp;one&nbsp;step&nbsp;of&nbsp;the&nbsp;machine,&nbsp;running&nbsp;each&nbsp;of&nbsp;the&nbsp;threads</span><br>
<span class="lineno"></span><span class="comment" id="3058016">//&nbsp;on&nbsp;runq&nbsp;and&nbsp;appending&nbsp;new&nbsp;threads&nbsp;to&nbsp;nextq.</span><br>
<span class="lineno"></span><span class="comment" id="3058063">//&nbsp;The&nbsp;step&nbsp;processes&nbsp;the&nbsp;rune&nbsp;c&nbsp;(which&nbsp;may&nbsp;be&nbsp;endOfText),</span><br>
<span class="lineno">200</span><span class="comment" id="3058122">//&nbsp;which&nbsp;starts&nbsp;at&nbsp;position&nbsp;pos&nbsp;and&nbsp;ends&nbsp;at&nbsp;nextPos.</span><br>
<span class="lineno"></span><span class="comment" id="3058175">//&nbsp;nextCond&nbsp;gives&nbsp;the&nbsp;setting&nbsp;for&nbsp;the&nbsp;empty-width&nbsp;flags&nbsp;after&nbsp;c.</span><br>
<span class="lineno"></span><span class="keyword" id="3058240">func</span>&nbsp;<span class="op" id="3058245">(</span><span class="ident" id="3058246">m</span>&nbsp;<span class="op" id="3058248">*</span><span class="ident" id="3058249">machine</span><span class="op" id="3058256">)</span>&nbsp;<span class="ident" id="3058258">step</span><span class="op" id="3058262">(</span><span class="ident" id="3058263">runq</span><span class="op" id="3058267">,</span>&nbsp;<span class="ident" id="3058269">nextq</span>&nbsp;<span class="op" id="3058275">*</span><span class="ident" id="3058276">queue</span><span class="op" id="3058281">,</span>&nbsp;<span class="ident" id="3058283">pos</span><span class="op" id="3058286">,</span>&nbsp;<span class="ident" id="3058288">nextPos</span>&nbsp;<span class="builtintype" id="3058296">int</span><span class="op" id="3058299">,</span>&nbsp;<span class="ident" id="3058301">c</span>&nbsp;<span class="builtintype" id="3058303">rune</span><span class="op" id="3058307">,</span>&nbsp;<span class="ident" id="3058309">nextCond</span>&nbsp;<span class="ident" id="3058318">syntax</span><span class="op" id="3058324">.</span><span class="ident" id="3058325">EmptyOp</span><span class="op" id="3058332">)</span>&nbsp;<span class="op" id="3058334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3058337">longest</span>&nbsp;<span class="op" id="3058345">:=</span>&nbsp;<span class="ident" id="3058348">m</span><span class="op" id="3058349">.</span><span class="ident" id="3058350">re</span><span class="op" id="3058352">.</span><span class="ident" id="3058353">longest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058362">for</span>&nbsp;<span class="ident" id="3058366">j</span>&nbsp;<span class="op" id="3058368">:=</span>&nbsp;<span class="num" id="3058371">0</span><span class="op" id="3058372">;</span>&nbsp;<span class="ident" id="3058374">j</span>&nbsp;<span class="op" id="3058376">&lt;</span>&nbsp;<span class="builtinfunc" id="3058378">len</span><span class="op" id="3058381">(</span><span class="ident" id="3058382">runq</span><span class="op" id="3058386">.</span><span class="ident" id="3058387">dense</span><span class="op" id="3058392">)</span><span class="op" id="3058393">;</span>&nbsp;<span class="ident" id="3058395">j</span><span class="op" id="3058396">++</span>&nbsp;<span class="op" id="3058399">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3058403">d</span>&nbsp;<span class="op" id="3058405">:=</span>&nbsp;<span class="op" id="3058408">&amp;</span><span class="ident" id="3058409">runq</span><span class="op" id="3058413">.</span><span class="ident" id="3058414">dense</span><span class="op" id="3058419">[</span><span class="ident" id="3058420">j</span><span class="op" id="3058421">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3058425">t</span>&nbsp;<span class="op" id="3058427">:=</span>&nbsp;<span class="ident" id="3058430">d</span><span class="op" id="3058431">.</span><span class="ident" id="3058432">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058436">if</span>&nbsp;<span class="ident" id="3058439">t</span>&nbsp;<span class="op" id="3058441">==</span>&nbsp;<span class="ident" id="3058444">nil</span>&nbsp;<span class="op" id="3058448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058453">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3058464">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058468">if</span>&nbsp;<span class="ident" id="3058471">longest</span>&nbsp;<span class="op" id="3058479">&amp;&amp;</span>&nbsp;<span class="ident" id="3058482">m</span><span class="op" id="3058483">.</span><span class="ident" id="3058484">matched</span>&nbsp;<span class="op" id="3058492">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3058495">len</span><span class="op" id="3058498">(</span><span class="ident" id="3058499">t</span><span class="op" id="3058500">.</span><span class="builtinfunc" id="3058501">cap</span><span class="op" id="3058504">)</span>&nbsp;<span class="op" id="3058506">&gt;</span>&nbsp;<span class="num" id="3058508">0</span>&nbsp;<span class="op" id="3058510">&amp;&amp;</span>&nbsp;<span class="ident" id="3058513">m</span><span class="op" id="3058514">.</span><span class="ident" id="3058515">matchcap</span><span class="op" id="3058523">[</span><span class="num" id="3058524">0</span><span class="op" id="3058525">]</span>&nbsp;<span class="op" id="3058527">&lt;</span>&nbsp;<span class="ident" id="3058529">t</span><span class="op" id="3058530">.</span><span class="builtinfunc" id="3058531">cap</span><span class="op" id="3058534">[</span><span class="num" id="3058535">0</span><span class="op" id="3058536">]</span>&nbsp;<span class="op" id="3058538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3058543">//&nbsp;m.free(t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3058559">m</span><span class="op" id="3058560">.</span><span class="ident" id="3058561">pool</span>&nbsp;<span class="op" id="3058566">=</span>&nbsp;<span class="builtinfunc" id="3058568">append</span><span class="op" id="3058574">(</span><span class="ident" id="3058575">m</span><span class="op" id="3058576">.</span><span class="ident" id="3058577">pool</span><span class="op" id="3058581">,</span>&nbsp;<span class="ident" id="3058583">t</span><span class="op" id="3058584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058589">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3058600">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3058604">i</span>&nbsp;<span class="op" id="3058606">:=</span>&nbsp;<span class="ident" id="3058609">t</span><span class="op" id="3058610">.</span><span class="ident" id="3058611">inst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3058618">add</span>&nbsp;<span class="op" id="3058622">:=</span>&nbsp;<span class="builtintype" id="3058625">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058633">switch</span>&nbsp;<span class="ident" id="3058640">i</span><span class="op" id="3058641">.</span><span class="ident" id="3058642">Op</span>&nbsp;<span class="op" id="3058645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058649">default</span><span class="op" id="3058656">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3058661">panic</span><span class="op" id="3058666">(</span><span class="string" id="3058667">&#34;bad&nbsp;inst&#34;</span><span class="op" id="3058677">)</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058682">case</span>&nbsp;<span class="ident" id="3058687">syntax</span><span class="op" id="3058693">.</span><span class="ident" id="3058694">InstMatch</span><span class="op" id="3058703">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058708">if</span>&nbsp;<span class="builtinfunc" id="3058711">len</span><span class="op" id="3058714">(</span><span class="ident" id="3058715">t</span><span class="op" id="3058716">.</span><span class="builtinfunc" id="3058717">cap</span><span class="op" id="3058720">)</span>&nbsp;<span class="op" id="3058722">&gt;</span>&nbsp;<span class="num" id="3058724">0</span>&nbsp;<span class="op" id="3058726">&amp;&amp;</span>&nbsp;<span class="op" id="3058729">(</span><span class="op" id="3058730">!</span><span class="ident" id="3058731">longest</span>&nbsp;<span class="op" id="3058739">||</span>&nbsp;<span class="op" id="3058742">!</span><span class="ident" id="3058743">m</span><span class="op" id="3058744">.</span><span class="ident" id="3058745">matched</span>&nbsp;<span class="op" id="3058753">||</span>&nbsp;<span class="ident" id="3058756">m</span><span class="op" id="3058757">.</span><span class="ident" id="3058758">matchcap</span><span class="op" id="3058766">[</span><span class="num" id="3058767">1</span><span class="op" id="3058768">]</span>&nbsp;<span class="op" id="3058770">&lt;</span>&nbsp;<span class="ident" id="3058772">pos</span><span class="op" id="3058775">)</span>&nbsp;<span class="op" id="3058777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3058783">t</span><span class="op" id="3058784">.</span><span class="builtinfunc" id="3058785">cap</span><span class="op" id="3058788">[</span><span class="num" id="3058789">1</span><span class="op" id="3058790">]</span>&nbsp;<span class="op" id="3058792">=</span>&nbsp;<span class="ident" id="3058794">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3058802">copy</span><span class="op" id="3058806">(</span><span class="ident" id="3058807">m</span><span class="op" id="3058808">.</span><span class="ident" id="3058809">matchcap</span><span class="op" id="3058817">,</span>&nbsp;<span class="ident" id="3058819">t</span><span class="op" id="3058820">.</span><span class="builtinfunc" id="3058821">cap</span><span class="op" id="3058824">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3058829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058834">if</span>&nbsp;<span class="op" id="3058837">!</span><span class="ident" id="3058838">longest</span>&nbsp;<span class="op" id="3058846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3058852">//&nbsp;First-match&nbsp;mode:&nbsp;cut&nbsp;off&nbsp;all&nbsp;lower-priority&nbsp;threads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058913">for</span>&nbsp;<span class="ident" id="3058917">_</span><span class="op" id="3058918">,</span>&nbsp;<span class="ident" id="3058920">d</span>&nbsp;<span class="op" id="3058922">:=</span>&nbsp;<span class="keyword" id="3058925">range</span>&nbsp;<span class="ident" id="3058931">runq</span><span class="op" id="3058935">.</span><span class="ident" id="3058936">dense</span><span class="op" id="3058941">[</span><span class="ident" id="3058942">j</span><span class="op" id="3058943">+</span><span class="num" id="3058944">1</span><span class="op" id="3058945">:</span><span class="op" id="3058946">]</span>&nbsp;<span class="op" id="3058948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058955">if</span>&nbsp;<span class="ident" id="3058958">d</span><span class="op" id="3058959">.</span><span class="ident" id="3058960">t</span>&nbsp;<span class="op" id="3058962">!=</span>&nbsp;<span class="ident" id="3058965">nil</span>&nbsp;<span class="op" id="3058969">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3058977">//&nbsp;m.free(d.t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3058998">m</span><span class="op" id="3058999">.</span><span class="ident" id="3059000">pool</span>&nbsp;<span class="op" id="3059005">=</span>&nbsp;<span class="builtinfunc" id="3059007">append</span><span class="op" id="3059013">(</span><span class="ident" id="3059014">m</span><span class="op" id="3059015">.</span><span class="ident" id="3059016">pool</span><span class="op" id="3059020">,</span>&nbsp;<span class="ident" id="3059022">d</span><span class="op" id="3059023">.</span><span class="ident" id="3059024">t</span><span class="op" id="3059025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3059032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3059038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3059044">runq</span><span class="op" id="3059048">.</span><span class="ident" id="3059049">dense</span>&nbsp;<span class="op" id="3059055">=</span>&nbsp;<span class="ident" id="3059057">runq</span><span class="op" id="3059061">.</span><span class="ident" id="3059062">dense</span><span class="op" id="3059067">[</span><span class="op" id="3059068">:</span><span class="num" id="3059069">0</span><span class="op" id="3059070">]</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3059075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3059080">m</span><span class="op" id="3059081">.</span><span class="ident" id="3059082">matched</span>&nbsp;<span class="op" id="3059090">=</span>&nbsp;<span class="builtintype" id="3059092">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3059100">case</span>&nbsp;<span class="ident" id="3059105">syntax</span><span class="op" id="3059111">.</span><span class="ident" id="3059112">InstRune</span><span class="op" id="3059120">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3059125">add</span>&nbsp;<span class="op" id="3059129">=</span>&nbsp;<span class="ident" id="3059131">i</span><span class="op" id="3059132">.</span><span class="ident" id="3059133">MatchRune</span><span class="op" id="3059142">(</span><span class="ident" id="3059143">c</span><span class="op" id="3059144">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3059148">case</span>&nbsp;<span class="ident" id="3059153">syntax</span><span class="op" id="3059159">.</span><span class="ident" id="3059160">InstRune1</span><span class="op" id="3059169">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3059174">add</span>&nbsp;<span class="op" id="3059178">=</span>&nbsp;<span class="ident" id="3059180">c</span>&nbsp;<span class="op" id="3059182">==</span>&nbsp;<span class="ident" id="3059185">i</span><span class="op" id="3059186">.</span><span class="ident" id="3059187">Rune</span><span class="op" id="3059191">[</span><span class="num" id="3059192">0</span><span class="op" id="3059193">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3059197">case</span>&nbsp;<span class="ident" id="3059202">syntax</span><span class="op" id="3059208">.</span><span class="ident" id="3059209">InstRuneAny</span><span class="op" id="3059220">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3059225">add</span>&nbsp;<span class="op" id="3059229">=</span>&nbsp;<span class="builtintype" id="3059231">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3059238">case</span>&nbsp;<span class="ident" id="3059243">syntax</span><span class="op" id="3059249">.</span><span class="ident" id="3059250">InstRuneAnyNotNL</span><span class="op" id="3059266">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3059271">add</span>&nbsp;<span class="op" id="3059275">=</span>&nbsp;<span class="ident" id="3059277">c</span>&nbsp;<span class="op" id="3059279">!=</span>&nbsp;<span class="string" id="3059282">&#39;\n&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3059289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3059293">if</span>&nbsp;<span class="ident" id="3059296">add</span>&nbsp;<span class="op" id="3059300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3059305">t</span>&nbsp;<span class="op" id="3059307">=</span>&nbsp;<span class="ident" id="3059309">m</span><span class="op" id="3059310">.</span><span class="ident" id="3059311">add</span><span class="op" id="3059314">(</span><span class="ident" id="3059315">nextq</span><span class="op" id="3059320">,</span>&nbsp;<span class="ident" id="3059322">i</span><span class="op" id="3059323">.</span><span class="ident" id="3059324">Out</span><span class="op" id="3059327">,</span>&nbsp;<span class="ident" id="3059329">nextPos</span><span class="op" id="3059336">,</span>&nbsp;<span class="ident" id="3059338">t</span><span class="op" id="3059339">.</span><span class="builtinfunc" id="3059340">cap</span><span class="op" id="3059343">,</span>&nbsp;<span class="ident" id="3059345">nextCond</span><span class="op" id="3059353">,</span>&nbsp;<span class="ident" id="3059355">t</span><span class="op" id="3059356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3059360">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3059364">if</span>&nbsp;<span class="ident" id="3059367">t</span>&nbsp;<span class="op" id="3059369">!=</span>&nbsp;<span class="ident" id="3059372">nil</span>&nbsp;<span class="op" id="3059376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3059381">//&nbsp;m.free(t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3059397">m</span><span class="op" id="3059398">.</span><span class="ident" id="3059399">pool</span>&nbsp;<span class="op" id="3059404">=</span>&nbsp;<span class="builtinfunc" id="3059406">append</span><span class="op" id="3059412">(</span><span class="ident" id="3059413">m</span><span class="op" id="3059414">.</span><span class="ident" id="3059415">pool</span><span class="op" id="3059419">,</span>&nbsp;<span class="ident" id="3059421">t</span><span class="op" id="3059422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3059426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3059429">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3059432">runq</span><span class="op" id="3059436">.</span><span class="ident" id="3059437">dense</span>&nbsp;<span class="op" id="3059443">=</span>&nbsp;<span class="ident" id="3059445">runq</span><span class="op" id="3059449">.</span><span class="ident" id="3059450">dense</span><span class="op" id="3059455">[</span><span class="op" id="3059456">:</span><span class="num" id="3059457">0</span><span class="op" id="3059458">]</span><br>
<span class="lineno"></span><span class="op" id="3059460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3059463">//&nbsp;add&nbsp;adds&nbsp;an&nbsp;entry&nbsp;to&nbsp;q&nbsp;for&nbsp;pc,&nbsp;unless&nbsp;the&nbsp;q&nbsp;already&nbsp;has&nbsp;such&nbsp;an&nbsp;entry.</span><br>
<span class="lineno"></span><span class="comment" id="3059537">//&nbsp;It&nbsp;also&nbsp;recursively&nbsp;adds&nbsp;an&nbsp;entry&nbsp;for&nbsp;all&nbsp;instructions&nbsp;reachable&nbsp;from&nbsp;pc&nbsp;by&nbsp;following</span><br>
<span class="lineno">260</span><span class="comment" id="3059626">//&nbsp;empty-width&nbsp;conditions&nbsp;satisfied&nbsp;by&nbsp;cond.&nbsp;&nbsp;pos&nbsp;gives&nbsp;the&nbsp;current&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="3059703">//&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="3059720">func</span>&nbsp;<span class="op" id="3059725">(</span><span class="ident" id="3059726">m</span>&nbsp;<span class="op" id="3059728">*</span><span class="ident" id="3059729">machine</span><span class="op" id="3059736">)</span>&nbsp;<span class="ident" id="3059738">add</span><span class="op" id="3059741">(</span><span class="ident" id="3059742">q</span>&nbsp;<span class="op" id="3059744">*</span><span class="ident" id="3059745">queue</span><span class="op" id="3059750">,</span>&nbsp;<span class="ident" id="3059752">pc</span>&nbsp;<span class="builtintype" id="3059755">uint32</span><span class="op" id="3059761">,</span>&nbsp;<span class="ident" id="3059763">pos</span>&nbsp;<span class="builtintype" id="3059767">int</span><span class="op" id="3059770">,</span>&nbsp;<span class="builtinfunc" id="3059772">cap</span>&nbsp;<span class="op" id="3059776">[</span><span class="op" id="3059777">]</span><span class="builtintype" id="3059778">int</span><span class="op" id="3059781">,</span>&nbsp;<span class="ident" id="3059783">cond</span>&nbsp;<span class="ident" id="3059788">syntax</span><span class="op" id="3059794">.</span><span class="ident" id="3059795">EmptyOp</span><span class="op" id="3059802">,</span>&nbsp;<span class="ident" id="3059804">t</span>&nbsp;<span class="op" id="3059806">*</span><span class="ident" id="3059807">thread</span><span class="op" id="3059813">)</span>&nbsp;<span class="op" id="3059815">*</span><span class="ident" id="3059816">thread</span>&nbsp;<span class="op" id="3059823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3059826">if</span>&nbsp;<span class="ident" id="3059829">pc</span>&nbsp;<span class="op" id="3059832">==</span>&nbsp;<span class="num" id="3059835">0</span>&nbsp;<span class="op" id="3059837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3059841">return</span>&nbsp;<span class="ident" id="3059848">t</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3059851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3059854">if</span>&nbsp;<span class="ident" id="3059857">j</span>&nbsp;<span class="op" id="3059859">:=</span>&nbsp;<span class="ident" id="3059862">q</span><span class="op" id="3059863">.</span><span class="ident" id="3059864">sparse</span><span class="op" id="3059870">[</span><span class="ident" id="3059871">pc</span><span class="op" id="3059873">]</span><span class="op" id="3059874">;</span>&nbsp;<span class="ident" id="3059876">j</span>&nbsp;<span class="op" id="3059878">&lt;</span>&nbsp;<span class="builtintype" id="3059880">uint32</span><span class="op" id="3059886">(</span><span class="builtinfunc" id="3059887">len</span><span class="op" id="3059890">(</span><span class="ident" id="3059891">q</span><span class="op" id="3059892">.</span><span class="ident" id="3059893">dense</span><span class="op" id="3059898">)</span><span class="op" id="3059899">)</span>&nbsp;<span class="op" id="3059901">&amp;&amp;</span>&nbsp;<span class="ident" id="3059904">q</span><span class="op" id="3059905">.</span><span class="ident" id="3059906">dense</span><span class="op" id="3059911">[</span><span class="ident" id="3059912">j</span><span class="op" id="3059913">]</span><span class="op" id="3059914">.</span><span class="ident" id="3059915">pc</span>&nbsp;<span class="op" id="3059918">==</span>&nbsp;<span class="ident" id="3059921">pc</span>&nbsp;<span class="op" id="3059924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3059928">return</span>&nbsp;<span class="ident" id="3059935">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3059938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3059942">j</span>&nbsp;<span class="op" id="3059944">:=</span>&nbsp;<span class="builtinfunc" id="3059947">len</span><span class="op" id="3059950">(</span><span class="ident" id="3059951">q</span><span class="op" id="3059952">.</span><span class="ident" id="3059953">dense</span><span class="op" id="3059958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3059961">q</span><span class="op" id="3059962">.</span><span class="ident" id="3059963">dense</span>&nbsp;<span class="op" id="3059969">=</span>&nbsp;<span class="ident" id="3059971">q</span><span class="op" id="3059972">.</span><span class="ident" id="3059973">dense</span><span class="op" id="3059978">[</span><span class="op" id="3059979">:</span><span class="ident" id="3059980">j</span><span class="op" id="3059981">+</span><span class="num" id="3059982">1</span><span class="op" id="3059983">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3059986">d</span>&nbsp;<span class="op" id="3059988">:=</span>&nbsp;<span class="op" id="3059991">&amp;</span><span class="ident" id="3059992">q</span><span class="op" id="3059993">.</span><span class="ident" id="3059994">dense</span><span class="op" id="3059999">[</span><span class="ident" id="3060000">j</span><span class="op" id="3060001">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060004">d</span><span class="op" id="3060005">.</span><span class="ident" id="3060006">t</span>&nbsp;<span class="op" id="3060008">=</span>&nbsp;<span class="ident" id="3060010">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060015">d</span><span class="op" id="3060016">.</span><span class="ident" id="3060017">pc</span>&nbsp;<span class="op" id="3060020">=</span>&nbsp;<span class="ident" id="3060022">pc</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060026">q</span><span class="op" id="3060027">.</span><span class="ident" id="3060028">sparse</span><span class="op" id="3060034">[</span><span class="ident" id="3060035">pc</span><span class="op" id="3060037">]</span>&nbsp;<span class="op" id="3060039">=</span>&nbsp;<span class="builtintype" id="3060041">uint32</span><span class="op" id="3060047">(</span><span class="ident" id="3060048">j</span><span class="op" id="3060049">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060053">i</span>&nbsp;<span class="op" id="3060055">:=</span>&nbsp;<span class="op" id="3060058">&amp;</span><span class="ident" id="3060059">m</span><span class="op" id="3060060">.</span><span class="ident" id="3060061">p</span><span class="op" id="3060062">.</span><span class="ident" id="3060063">Inst</span><span class="op" id="3060067">[</span><span class="ident" id="3060068">pc</span><span class="op" id="3060070">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060073">switch</span>&nbsp;<span class="ident" id="3060080">i</span><span class="op" id="3060081">.</span><span class="ident" id="3060082">Op</span>&nbsp;<span class="op" id="3060085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060088">default</span><span class="op" id="3060095">:</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3060099">panic</span><span class="op" id="3060104">(</span><span class="string" id="3060105">&#34;unhandled&#34;</span><span class="op" id="3060116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060119">case</span>&nbsp;<span class="ident" id="3060124">syntax</span><span class="op" id="3060130">.</span><span class="ident" id="3060131">InstFail</span><span class="op" id="3060139">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3060143">//&nbsp;nothing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060155">case</span>&nbsp;<span class="ident" id="3060160">syntax</span><span class="op" id="3060166">.</span><span class="ident" id="3060167">InstAlt</span><span class="op" id="3060174">,</span>&nbsp;<span class="ident" id="3060176">syntax</span><span class="op" id="3060182">.</span><span class="ident" id="3060183">InstAltMatch</span><span class="op" id="3060195">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060199">t</span>&nbsp;<span class="op" id="3060201">=</span>&nbsp;<span class="ident" id="3060203">m</span><span class="op" id="3060204">.</span><span class="ident" id="3060205">add</span><span class="op" id="3060208">(</span><span class="ident" id="3060209">q</span><span class="op" id="3060210">,</span>&nbsp;<span class="ident" id="3060212">i</span><span class="op" id="3060213">.</span><span class="ident" id="3060214">Out</span><span class="op" id="3060217">,</span>&nbsp;<span class="ident" id="3060219">pos</span><span class="op" id="3060222">,</span>&nbsp;<span class="builtinfunc" id="3060224">cap</span><span class="op" id="3060227">,</span>&nbsp;<span class="ident" id="3060229">cond</span><span class="op" id="3060233">,</span>&nbsp;<span class="ident" id="3060235">t</span><span class="op" id="3060236">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060240">t</span>&nbsp;<span class="op" id="3060242">=</span>&nbsp;<span class="ident" id="3060244">m</span><span class="op" id="3060245">.</span><span class="ident" id="3060246">add</span><span class="op" id="3060249">(</span><span class="ident" id="3060250">q</span><span class="op" id="3060251">,</span>&nbsp;<span class="ident" id="3060253">i</span><span class="op" id="3060254">.</span><span class="ident" id="3060255">Arg</span><span class="op" id="3060258">,</span>&nbsp;<span class="ident" id="3060260">pos</span><span class="op" id="3060263">,</span>&nbsp;<span class="builtinfunc" id="3060265">cap</span><span class="op" id="3060268">,</span>&nbsp;<span class="ident" id="3060270">cond</span><span class="op" id="3060274">,</span>&nbsp;<span class="ident" id="3060276">t</span><span class="op" id="3060277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060280">case</span>&nbsp;<span class="ident" id="3060285">syntax</span><span class="op" id="3060291">.</span><span class="ident" id="3060292">InstEmptyWidth</span><span class="op" id="3060306">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060310">if</span>&nbsp;<span class="ident" id="3060313">syntax</span><span class="op" id="3060319">.</span><span class="ident" id="3060320">EmptyOp</span><span class="op" id="3060327">(</span><span class="ident" id="3060328">i</span><span class="op" id="3060329">.</span><span class="ident" id="3060330">Arg</span><span class="op" id="3060333">)</span><span class="op" id="3060334">&amp;^</span><span class="ident" id="3060336">cond</span>&nbsp;<span class="op" id="3060341">==</span>&nbsp;<span class="num" id="3060344">0</span>&nbsp;<span class="op" id="3060346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060351">t</span>&nbsp;<span class="op" id="3060353">=</span>&nbsp;<span class="ident" id="3060355">m</span><span class="op" id="3060356">.</span><span class="ident" id="3060357">add</span><span class="op" id="3060360">(</span><span class="ident" id="3060361">q</span><span class="op" id="3060362">,</span>&nbsp;<span class="ident" id="3060364">i</span><span class="op" id="3060365">.</span><span class="ident" id="3060366">Out</span><span class="op" id="3060369">,</span>&nbsp;<span class="ident" id="3060371">pos</span><span class="op" id="3060374">,</span>&nbsp;<span class="builtinfunc" id="3060376">cap</span><span class="op" id="3060379">,</span>&nbsp;<span class="ident" id="3060381">cond</span><span class="op" id="3060385">,</span>&nbsp;<span class="ident" id="3060387">t</span><span class="op" id="3060388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3060392">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060395">case</span>&nbsp;<span class="ident" id="3060400">syntax</span><span class="op" id="3060406">.</span><span class="ident" id="3060407">InstNop</span><span class="op" id="3060414">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060418">t</span>&nbsp;<span class="op" id="3060420">=</span>&nbsp;<span class="ident" id="3060422">m</span><span class="op" id="3060423">.</span><span class="ident" id="3060424">add</span><span class="op" id="3060427">(</span><span class="ident" id="3060428">q</span><span class="op" id="3060429">,</span>&nbsp;<span class="ident" id="3060431">i</span><span class="op" id="3060432">.</span><span class="ident" id="3060433">Out</span><span class="op" id="3060436">,</span>&nbsp;<span class="ident" id="3060438">pos</span><span class="op" id="3060441">,</span>&nbsp;<span class="builtinfunc" id="3060443">cap</span><span class="op" id="3060446">,</span>&nbsp;<span class="ident" id="3060448">cond</span><span class="op" id="3060452">,</span>&nbsp;<span class="ident" id="3060454">t</span><span class="op" id="3060455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060458">case</span>&nbsp;<span class="ident" id="3060463">syntax</span><span class="op" id="3060469">.</span><span class="ident" id="3060470">InstCapture</span><span class="op" id="3060481">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060485">if</span>&nbsp;<span class="builtintype" id="3060488">int</span><span class="op" id="3060491">(</span><span class="ident" id="3060492">i</span><span class="op" id="3060493">.</span><span class="ident" id="3060494">Arg</span><span class="op" id="3060497">)</span>&nbsp;<span class="op" id="3060499">&lt;</span>&nbsp;<span class="builtinfunc" id="3060501">len</span><span class="op" id="3060504">(</span><span class="builtinfunc" id="3060505">cap</span><span class="op" id="3060508">)</span>&nbsp;<span class="op" id="3060510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060515">opos</span>&nbsp;<span class="op" id="3060520">:=</span>&nbsp;<span class="builtinfunc" id="3060523">cap</span><span class="op" id="3060526">[</span><span class="ident" id="3060527">i</span><span class="op" id="3060528">.</span><span class="ident" id="3060529">Arg</span><span class="op" id="3060532">]</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3060537">cap</span><span class="op" id="3060540">[</span><span class="ident" id="3060541">i</span><span class="op" id="3060542">.</span><span class="ident" id="3060543">Arg</span><span class="op" id="3060546">]</span>&nbsp;<span class="op" id="3060548">=</span>&nbsp;<span class="ident" id="3060550">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060557">m</span><span class="op" id="3060558">.</span><span class="ident" id="3060559">add</span><span class="op" id="3060562">(</span><span class="ident" id="3060563">q</span><span class="op" id="3060564">,</span>&nbsp;<span class="ident" id="3060566">i</span><span class="op" id="3060567">.</span><span class="ident" id="3060568">Out</span><span class="op" id="3060571">,</span>&nbsp;<span class="ident" id="3060573">pos</span><span class="op" id="3060576">,</span>&nbsp;<span class="builtinfunc" id="3060578">cap</span><span class="op" id="3060581">,</span>&nbsp;<span class="ident" id="3060583">cond</span><span class="op" id="3060587">,</span>&nbsp;<span class="ident" id="3060589">nil</span><span class="op" id="3060592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3060597">cap</span><span class="op" id="3060600">[</span><span class="ident" id="3060601">i</span><span class="op" id="3060602">.</span><span class="ident" id="3060603">Arg</span><span class="op" id="3060606">]</span>&nbsp;<span class="op" id="3060608">=</span>&nbsp;<span class="ident" id="3060610">opos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3060617">}</span>&nbsp;<span class="keyword" id="3060619">else</span>&nbsp;<span class="op" id="3060624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060629">t</span>&nbsp;<span class="op" id="3060631">=</span>&nbsp;<span class="ident" id="3060633">m</span><span class="op" id="3060634">.</span><span class="ident" id="3060635">add</span><span class="op" id="3060638">(</span><span class="ident" id="3060639">q</span><span class="op" id="3060640">,</span>&nbsp;<span class="ident" id="3060642">i</span><span class="op" id="3060643">.</span><span class="ident" id="3060644">Out</span><span class="op" id="3060647">,</span>&nbsp;<span class="ident" id="3060649">pos</span><span class="op" id="3060652">,</span>&nbsp;<span class="builtinfunc" id="3060654">cap</span><span class="op" id="3060657">,</span>&nbsp;<span class="ident" id="3060659">cond</span><span class="op" id="3060663">,</span>&nbsp;<span class="ident" id="3060665">t</span><span class="op" id="3060666">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3060670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060673">case</span>&nbsp;<span class="ident" id="3060678">syntax</span><span class="op" id="3060684">.</span><span class="ident" id="3060685">InstMatch</span><span class="op" id="3060694">,</span>&nbsp;<span class="ident" id="3060696">syntax</span><span class="op" id="3060702">.</span><span class="ident" id="3060703">InstRune</span><span class="op" id="3060711">,</span>&nbsp;<span class="ident" id="3060713">syntax</span><span class="op" id="3060719">.</span><span class="ident" id="3060720">InstRune1</span><span class="op" id="3060729">,</span>&nbsp;<span class="ident" id="3060731">syntax</span><span class="op" id="3060737">.</span><span class="ident" id="3060738">InstRuneAny</span><span class="op" id="3060749">,</span>&nbsp;<span class="ident" id="3060751">syntax</span><span class="op" id="3060757">.</span><span class="ident" id="3060758">InstRuneAnyNotNL</span><span class="op" id="3060774">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060778">if</span>&nbsp;<span class="ident" id="3060781">t</span>&nbsp;<span class="op" id="3060783">==</span>&nbsp;<span class="ident" id="3060786">nil</span>&nbsp;<span class="op" id="3060790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060795">t</span>&nbsp;<span class="op" id="3060797">=</span>&nbsp;<span class="ident" id="3060799">m</span><span class="op" id="3060800">.</span><span class="ident" id="3060801">alloc</span><span class="op" id="3060806">(</span><span class="ident" id="3060807">i</span><span class="op" id="3060808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3060812">}</span>&nbsp;<span class="keyword" id="3060814">else</span>&nbsp;<span class="op" id="3060819">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060824">t</span><span class="op" id="3060825">.</span><span class="ident" id="3060826">inst</span>&nbsp;<span class="op" id="3060831">=</span>&nbsp;<span class="ident" id="3060833">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3060837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060841">if</span>&nbsp;<span class="builtinfunc" id="3060844">len</span><span class="op" id="3060847">(</span><span class="builtinfunc" id="3060848">cap</span><span class="op" id="3060851">)</span>&nbsp;<span class="op" id="3060853">&gt;</span>&nbsp;<span class="num" id="3060855">0</span>&nbsp;<span class="op" id="3060857">&amp;&amp;</span>&nbsp;<span class="op" id="3060860">&amp;</span><span class="ident" id="3060861">t</span><span class="op" id="3060862">.</span><span class="builtinfunc" id="3060863">cap</span><span class="op" id="3060866">[</span><span class="num" id="3060867">0</span><span class="op" id="3060868">]</span>&nbsp;<span class="op" id="3060870">!=</span>&nbsp;<span class="op" id="3060873">&amp;</span><span class="builtinfunc" id="3060874">cap</span><span class="op" id="3060877">[</span><span class="num" id="3060878">0</span><span class="op" id="3060879">]</span>&nbsp;<span class="op" id="3060881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3060886">copy</span><span class="op" id="3060890">(</span><span class="ident" id="3060891">t</span><span class="op" id="3060892">.</span><span class="builtinfunc" id="3060893">cap</span><span class="op" id="3060896">,</span>&nbsp;<span class="builtinfunc" id="3060898">cap</span><span class="op" id="3060901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3060905">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060909">d</span><span class="op" id="3060910">.</span><span class="ident" id="3060911">t</span>&nbsp;<span class="op" id="3060913">=</span>&nbsp;<span class="ident" id="3060915">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060919">t</span>&nbsp;<span class="op" id="3060921">=</span>&nbsp;<span class="ident" id="3060923">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3060928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060931">return</span>&nbsp;<span class="ident" id="3060938">t</span><br>
<span class="lineno"></span><span class="op" id="3060940">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="comment" id="3060943">//&nbsp;onepass&nbsp;runs&nbsp;the&nbsp;machine&nbsp;over&nbsp;the&nbsp;input&nbsp;starting&nbsp;at&nbsp;pos.</span><br>
<span class="lineno"></span><span class="comment" id="3061003">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found.</span><br>
<span class="lineno"></span><span class="comment" id="3061044">//&nbsp;If&nbsp;so,&nbsp;m.matchcap&nbsp;holds&nbsp;the&nbsp;submatch&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="3061097">func</span>&nbsp;<span class="op" id="3061102">(</span><span class="ident" id="3061103">m</span>&nbsp;<span class="op" id="3061105">*</span><span class="ident" id="3061106">machine</span><span class="op" id="3061113">)</span>&nbsp;<span class="ident" id="3061115">onepass</span><span class="op" id="3061122">(</span><span class="ident" id="3061123">i</span>&nbsp;<span class="ident" id="3061125">input</span><span class="op" id="3061130">,</span>&nbsp;<span class="ident" id="3061132">pos</span>&nbsp;<span class="builtintype" id="3061136">int</span><span class="op" id="3061139">)</span>&nbsp;<span class="builtintype" id="3061141">bool</span>&nbsp;<span class="op" id="3061146">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061149">startCond</span>&nbsp;<span class="op" id="3061159">:=</span>&nbsp;<span class="ident" id="3061162">m</span><span class="op" id="3061163">.</span><span class="ident" id="3061164">re</span><span class="op" id="3061166">.</span><span class="ident" id="3061167">cond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061173">if</span>&nbsp;<span class="ident" id="3061176">startCond</span>&nbsp;<span class="op" id="3061186">==</span>&nbsp;<span class="op" id="3061189">^</span><span class="ident" id="3061190">syntax</span><span class="op" id="3061196">.</span><span class="ident" id="3061197">EmptyOp</span><span class="op" id="3061204">(</span><span class="num" id="3061205">0</span><span class="op" id="3061206">)</span>&nbsp;<span class="op" id="3061208">{</span>&nbsp;<span class="comment" id="3061210">//&nbsp;impossible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061226">return</span>&nbsp;<span class="builtintype" id="3061233">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3061240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061243">m</span><span class="op" id="3061244">.</span><span class="ident" id="3061245">matched</span>&nbsp;<span class="op" id="3061253">=</span>&nbsp;<span class="builtintype" id="3061255">false</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061262">for</span>&nbsp;<span class="ident" id="3061266">i</span>&nbsp;<span class="op" id="3061268">:=</span>&nbsp;<span class="keyword" id="3061271">range</span>&nbsp;<span class="ident" id="3061277">m</span><span class="op" id="3061278">.</span><span class="ident" id="3061279">matchcap</span>&nbsp;<span class="op" id="3061288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061292">m</span><span class="op" id="3061293">.</span><span class="ident" id="3061294">matchcap</span><span class="op" id="3061302">[</span><span class="ident" id="3061303">i</span><span class="op" id="3061304">]</span>&nbsp;<span class="op" id="3061306">=</span>&nbsp;<span class="op" id="3061308">-</span><span class="num" id="3061309">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3061312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061315">r</span><span class="op" id="3061316">,</span>&nbsp;<span class="ident" id="3061318">r1</span>&nbsp;<span class="op" id="3061321">:=</span>&nbsp;<span class="ident" id="3061324">endOfText</span><span class="op" id="3061333">,</span>&nbsp;<span class="ident" id="3061335">endOfText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061346">width</span><span class="op" id="3061351">,</span>&nbsp;<span class="ident" id="3061353">width1</span>&nbsp;<span class="op" id="3061360">:=</span>&nbsp;<span class="num" id="3061363">0</span><span class="op" id="3061364">,</span>&nbsp;<span class="num" id="3061366">0</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061369">r</span><span class="op" id="3061370">,</span>&nbsp;<span class="ident" id="3061372">width</span>&nbsp;<span class="op" id="3061378">=</span>&nbsp;<span class="ident" id="3061380">i</span><span class="op" id="3061381">.</span><span class="ident" id="3061382">step</span><span class="op" id="3061386">(</span><span class="ident" id="3061387">pos</span><span class="op" id="3061390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061393">if</span>&nbsp;<span class="ident" id="3061396">r</span>&nbsp;<span class="op" id="3061398">!=</span>&nbsp;<span class="ident" id="3061401">endOfText</span>&nbsp;<span class="op" id="3061411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061415">r1</span><span class="op" id="3061417">,</span>&nbsp;<span class="ident" id="3061419">width1</span>&nbsp;<span class="op" id="3061426">=</span>&nbsp;<span class="ident" id="3061428">i</span><span class="op" id="3061429">.</span><span class="ident" id="3061430">step</span><span class="op" id="3061434">(</span><span class="ident" id="3061435">pos</span>&nbsp;<span class="op" id="3061439">+</span>&nbsp;<span class="ident" id="3061441">width</span><span class="op" id="3061446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3061449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061452">var</span>&nbsp;<span class="ident" id="3061456">flag</span>&nbsp;<span class="ident" id="3061461">syntax</span><span class="op" id="3061467">.</span><span class="ident" id="3061468">EmptyOp</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061477">if</span>&nbsp;<span class="ident" id="3061480">pos</span>&nbsp;<span class="op" id="3061484">==</span>&nbsp;<span class="num" id="3061487">0</span>&nbsp;<span class="op" id="3061489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061493">flag</span>&nbsp;<span class="op" id="3061498">=</span>&nbsp;<span class="ident" id="3061500">syntax</span><span class="op" id="3061506">.</span><span class="ident" id="3061507">EmptyOpContext</span><span class="op" id="3061521">(</span><span class="op" id="3061522">-</span><span class="num" id="3061523">1</span><span class="op" id="3061524">,</span>&nbsp;<span class="ident" id="3061526">r</span><span class="op" id="3061527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3061530">}</span>&nbsp;<span class="keyword" id="3061532">else</span>&nbsp;<span class="op" id="3061537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061541">flag</span>&nbsp;<span class="op" id="3061546">=</span>&nbsp;<span class="ident" id="3061548">i</span><span class="op" id="3061549">.</span><span class="ident" id="3061550">context</span><span class="op" id="3061557">(</span><span class="ident" id="3061558">pos</span><span class="op" id="3061561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3061564">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061567">pc</span>&nbsp;<span class="op" id="3061570">:=</span>&nbsp;<span class="ident" id="3061573">m</span><span class="op" id="3061574">.</span><span class="ident" id="3061575">op</span><span class="op" id="3061577">.</span><span class="ident" id="3061578">Start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061585">inst</span>&nbsp;<span class="op" id="3061590">:=</span>&nbsp;<span class="ident" id="3061593">m</span><span class="op" id="3061594">.</span><span class="ident" id="3061595">op</span><span class="op" id="3061597">.</span><span class="ident" id="3061598">Inst</span><span class="op" id="3061602">[</span><span class="ident" id="3061603">pc</span><span class="op" id="3061605">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3061608">//&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;simple&nbsp;literal&nbsp;prefix,&nbsp;skip&nbsp;over&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061663">if</span>&nbsp;<span class="ident" id="3061666">pos</span>&nbsp;<span class="op" id="3061670">==</span>&nbsp;<span class="num" id="3061673">0</span>&nbsp;<span class="op" id="3061675">&amp;&amp;</span>&nbsp;<span class="ident" id="3061678">syntax</span><span class="op" id="3061684">.</span><span class="ident" id="3061685">EmptyOp</span><span class="op" id="3061692">(</span><span class="ident" id="3061693">inst</span><span class="op" id="3061697">.</span><span class="ident" id="3061698">Arg</span><span class="op" id="3061701">)</span><span class="op" id="3061702">&amp;^</span><span class="ident" id="3061704">flag</span>&nbsp;<span class="op" id="3061709">==</span>&nbsp;<span class="num" id="3061712">0</span>&nbsp;<span class="op" id="3061714">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3061719">len</span><span class="op" id="3061722">(</span><span class="ident" id="3061723">m</span><span class="op" id="3061724">.</span><span class="ident" id="3061725">re</span><span class="op" id="3061727">.</span><span class="ident" id="3061728">prefix</span><span class="op" id="3061734">)</span>&nbsp;<span class="op" id="3061736">&gt;</span>&nbsp;<span class="num" id="3061738">0</span>&nbsp;<span class="op" id="3061740">&amp;&amp;</span>&nbsp;<span class="ident" id="3061743">i</span><span class="op" id="3061744">.</span><span class="ident" id="3061745">canCheckPrefix</span><span class="op" id="3061759">(</span><span class="op" id="3061760">)</span>&nbsp;<span class="op" id="3061762">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3061766">//&nbsp;Match&nbsp;requires&nbsp;literal&nbsp;prefix;&nbsp;fast&nbsp;search&nbsp;for&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061822">if</span>&nbsp;<span class="ident" id="3061825">i</span><span class="op" id="3061826">.</span><span class="ident" id="3061827">hasPrefix</span><span class="op" id="3061836">(</span><span class="ident" id="3061837">m</span><span class="op" id="3061838">.</span><span class="ident" id="3061839">re</span><span class="op" id="3061841">)</span>&nbsp;<span class="op" id="3061843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061848">pos</span>&nbsp;<span class="op" id="3061852">+=</span>&nbsp;<span class="builtinfunc" id="3061855">len</span><span class="op" id="3061858">(</span><span class="ident" id="3061859">m</span><span class="op" id="3061860">.</span><span class="ident" id="3061861">re</span><span class="op" id="3061863">.</span><span class="ident" id="3061864">prefix</span><span class="op" id="3061870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061875">r</span><span class="op" id="3061876">,</span>&nbsp;<span class="ident" id="3061878">width</span>&nbsp;<span class="op" id="3061884">=</span>&nbsp;<span class="ident" id="3061886">i</span><span class="op" id="3061887">.</span><span class="ident" id="3061888">step</span><span class="op" id="3061892">(</span><span class="ident" id="3061893">pos</span><span class="op" id="3061896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061901">r1</span><span class="op" id="3061903">,</span>&nbsp;<span class="ident" id="3061905">width1</span>&nbsp;<span class="op" id="3061912">=</span>&nbsp;<span class="ident" id="3061914">i</span><span class="op" id="3061915">.</span><span class="ident" id="3061916">step</span><span class="op" id="3061920">(</span><span class="ident" id="3061921">pos</span>&nbsp;<span class="op" id="3061925">+</span>&nbsp;<span class="ident" id="3061927">width</span><span class="op" id="3061932">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061937">flag</span>&nbsp;<span class="op" id="3061942">=</span>&nbsp;<span class="ident" id="3061944">i</span><span class="op" id="3061945">.</span><span class="ident" id="3061946">context</span><span class="op" id="3061953">(</span><span class="ident" id="3061954">pos</span><span class="op" id="3061957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061962">pc</span>&nbsp;<span class="op" id="3061965">=</span>&nbsp;<span class="builtintype" id="3061967">int</span><span class="op" id="3061970">(</span><span class="ident" id="3061971">m</span><span class="op" id="3061972">.</span><span class="ident" id="3061973">re</span><span class="op" id="3061975">.</span><span class="ident" id="3061976">prefixEnd</span><span class="op" id="3061985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3061989">}</span>&nbsp;<span class="keyword" id="3061991">else</span>&nbsp;<span class="op" id="3061996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062001">return</span>&nbsp;<span class="ident" id="3062008">m</span><span class="op" id="3062009">.</span><span class="ident" id="3062010">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3062020">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3062023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062026">for</span>&nbsp;<span class="op" id="3062030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3062034">inst</span>&nbsp;<span class="op" id="3062039">=</span>&nbsp;<span class="ident" id="3062041">m</span><span class="op" id="3062042">.</span><span class="ident" id="3062043">op</span><span class="op" id="3062045">.</span><span class="ident" id="3062046">Inst</span><span class="op" id="3062050">[</span><span class="ident" id="3062051">pc</span><span class="op" id="3062053">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3062057">pc</span>&nbsp;<span class="op" id="3062060">=</span>&nbsp;<span class="builtintype" id="3062062">int</span><span class="op" id="3062065">(</span><span class="ident" id="3062066">inst</span><span class="op" id="3062070">.</span><span class="ident" id="3062071">Out</span><span class="op" id="3062074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062078">switch</span>&nbsp;<span class="ident" id="3062085">inst</span><span class="op" id="3062089">.</span><span class="ident" id="3062090">Op</span>&nbsp;<span class="op" id="3062093">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062097">default</span><span class="op" id="3062104">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3062109">panic</span><span class="op" id="3062114">(</span><span class="string" id="3062115">&#34;bad&nbsp;inst&#34;</span><span class="op" id="3062125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062129">case</span>&nbsp;<span class="ident" id="3062134">syntax</span><span class="op" id="3062140">.</span><span class="ident" id="3062141">InstMatch</span><span class="op" id="3062150">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3062155">m</span><span class="op" id="3062156">.</span><span class="ident" id="3062157">matched</span>&nbsp;<span class="op" id="3062165">=</span>&nbsp;<span class="builtintype" id="3062167">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062175">if</span>&nbsp;<span class="builtinfunc" id="3062178">len</span><span class="op" id="3062181">(</span><span class="ident" id="3062182">m</span><span class="op" id="3062183">.</span><span class="ident" id="3062184">matchcap</span><span class="op" id="3062192">)</span>&nbsp;<span class="op" id="3062194">&gt;</span>&nbsp;<span class="num" id="3062196">0</span>&nbsp;<span class="op" id="3062198">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3062204">m</span><span class="op" id="3062205">.</span><span class="ident" id="3062206">matchcap</span><span class="op" id="3062214">[</span><span class="num" id="3062215">0</span><span class="op" id="3062216">]</span>&nbsp;<span class="op" id="3062218">=</span>&nbsp;<span class="num" id="3062220">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3062226">m</span><span class="op" id="3062227">.</span><span class="ident" id="3062228">matchcap</span><span class="op" id="3062236">[</span><span class="num" id="3062237">1</span><span class="op" id="3062238">]</span>&nbsp;<span class="op" id="3062240">=</span>&nbsp;<span class="ident" id="3062242">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3062249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062254">return</span>&nbsp;<span class="ident" id="3062261">m</span><span class="op" id="3062262">.</span><span class="ident" id="3062263">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062273">case</span>&nbsp;<span class="ident" id="3062278">syntax</span><span class="op" id="3062284">.</span><span class="ident" id="3062285">InstRune</span><span class="op" id="3062293">:</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062298">if</span>&nbsp;<span class="op" id="3062301">!</span><span class="ident" id="3062302">inst</span><span class="op" id="3062306">.</span><span class="ident" id="3062307">MatchRune</span><span class="op" id="3062316">(</span><span class="ident" id="3062317">r</span><span class="op" id="3062318">)</span>&nbsp;<span class="op" id="3062320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062326">return</span>&nbsp;<span class="ident" id="3062333">m</span><span class="op" id="3062334">.</span><span class="ident" id="3062335">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3062346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062350">case</span>&nbsp;<span class="ident" id="3062355">syntax</span><span class="op" id="3062361">.</span><span class="ident" id="3062362">InstRune1</span><span class="op" id="3062371">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062376">if</span>&nbsp;<span class="ident" id="3062379">r</span>&nbsp;<span class="op" id="3062381">!=</span>&nbsp;<span class="ident" id="3062384">inst</span><span class="op" id="3062388">.</span><span class="ident" id="3062389">Rune</span><span class="op" id="3062393">[</span><span class="num" id="3062394">0</span><span class="op" id="3062395">]</span>&nbsp;<span class="op" id="3062397">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062403">return</span>&nbsp;<span class="ident" id="3062410">m</span><span class="op" id="3062411">.</span><span class="ident" id="3062412">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3062423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062427">case</span>&nbsp;<span class="ident" id="3062432">syntax</span><span class="op" id="3062438">.</span><span class="ident" id="3062439">InstRuneAny</span><span class="op" id="3062450">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3062455">//&nbsp;Nothing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062468">case</span>&nbsp;<span class="ident" id="3062473">syntax</span><span class="op" id="3062479">.</span><span class="ident" id="3062480">InstRuneAnyNotNL</span><span class="op" id="3062496">:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062501">if</span>&nbsp;<span class="ident" id="3062504">r</span>&nbsp;<span class="op" id="3062506">==</span>&nbsp;<span class="string" id="3062509">&#39;\n&#39;</span>&nbsp;<span class="op" id="3062514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062520">return</span>&nbsp;<span class="ident" id="3062527">m</span><span class="op" id="3062528">.</span><span class="ident" id="3062529">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3062540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3062544">//&nbsp;peek&nbsp;at&nbsp;the&nbsp;input&nbsp;rune&nbsp;to&nbsp;see&nbsp;which&nbsp;branch&nbsp;of&nbsp;the&nbsp;Alt&nbsp;to&nbsp;take</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062611">case</span>&nbsp;<span class="ident" id="3062616">syntax</span><span class="op" id="3062622">.</span><span class="ident" id="3062623">InstAlt</span><span class="op" id="3062630">,</span>&nbsp;<span class="ident" id="3062632">syntax</span><span class="op" id="3062638">.</span><span class="ident" id="3062639">InstAltMatch</span><span class="op" id="3062651">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3062656">pc</span>&nbsp;<span class="op" id="3062659">=</span>&nbsp;<span class="builtintype" id="3062661">int</span><span class="op" id="3062664">(</span><span class="ident" id="3062665">onePassNext</span><span class="op" id="3062676">(</span><span class="op" id="3062677">&amp;</span><span class="ident" id="3062678">inst</span><span class="op" id="3062682">,</span>&nbsp;<span class="ident" id="3062684">r</span><span class="op" id="3062685">)</span><span class="op" id="3062686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062691">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062702">case</span>&nbsp;<span class="ident" id="3062707">syntax</span><span class="op" id="3062713">.</span><span class="ident" id="3062714">InstFail</span><span class="op" id="3062722">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062727">return</span>&nbsp;<span class="ident" id="3062734">m</span><span class="op" id="3062735">.</span><span class="ident" id="3062736">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062746">case</span>&nbsp;<span class="ident" id="3062751">syntax</span><span class="op" id="3062757">.</span><span class="ident" id="3062758">InstNop</span><span class="op" id="3062765">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062770">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062781">case</span>&nbsp;<span class="ident" id="3062786">syntax</span><span class="op" id="3062792">.</span><span class="ident" id="3062793">InstEmptyWidth</span><span class="op" id="3062807">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062812">if</span>&nbsp;<span class="ident" id="3062815">syntax</span><span class="op" id="3062821">.</span><span class="ident" id="3062822">EmptyOp</span><span class="op" id="3062829">(</span><span class="ident" id="3062830">inst</span><span class="op" id="3062834">.</span><span class="ident" id="3062835">Arg</span><span class="op" id="3062838">)</span><span class="op" id="3062839">&amp;^</span><span class="ident" id="3062841">flag</span>&nbsp;<span class="op" id="3062846">!=</span>&nbsp;<span class="num" id="3062849">0</span>&nbsp;<span class="op" id="3062851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062857">return</span>&nbsp;<span class="ident" id="3062864">m</span><span class="op" id="3062865">.</span><span class="ident" id="3062866">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3062877">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062882">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062893">case</span>&nbsp;<span class="ident" id="3062898">syntax</span><span class="op" id="3062904">.</span><span class="ident" id="3062905">InstCapture</span><span class="op" id="3062916">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062921">if</span>&nbsp;<span class="builtintype" id="3062924">int</span><span class="op" id="3062927">(</span><span class="ident" id="3062928">inst</span><span class="op" id="3062932">.</span><span class="ident" id="3062933">Arg</span><span class="op" id="3062936">)</span>&nbsp;<span class="op" id="3062938">&lt;</span>&nbsp;<span class="builtinfunc" id="3062940">len</span><span class="op" id="3062943">(</span><span class="ident" id="3062944">m</span><span class="op" id="3062945">.</span><span class="ident" id="3062946">matchcap</span><span class="op" id="3062954">)</span>&nbsp;<span class="op" id="3062956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3062962">m</span><span class="op" id="3062963">.</span><span class="ident" id="3062964">matchcap</span><span class="op" id="3062972">[</span><span class="ident" id="3062973">inst</span><span class="op" id="3062977">.</span><span class="ident" id="3062978">Arg</span><span class="op" id="3062981">]</span>&nbsp;<span class="op" id="3062983">=</span>&nbsp;<span class="ident" id="3062985">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3062992">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062997">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3063008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3063012">if</span>&nbsp;<span class="ident" id="3063015">width</span>&nbsp;<span class="op" id="3063021">==</span>&nbsp;<span class="num" id="3063024">0</span>&nbsp;<span class="op" id="3063026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3063031">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3063039">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063043">flag</span>&nbsp;<span class="op" id="3063048">=</span>&nbsp;<span class="ident" id="3063050">syntax</span><span class="op" id="3063056">.</span><span class="ident" id="3063057">EmptyOpContext</span><span class="op" id="3063071">(</span><span class="ident" id="3063072">r</span><span class="op" id="3063073">,</span>&nbsp;<span class="ident" id="3063075">r1</span><span class="op" id="3063077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063081">pos</span>&nbsp;<span class="op" id="3063085">+=</span>&nbsp;<span class="ident" id="3063088">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063096">r</span><span class="op" id="3063097">,</span>&nbsp;<span class="ident" id="3063099">width</span>&nbsp;<span class="op" id="3063105">=</span>&nbsp;<span class="ident" id="3063107">r1</span><span class="op" id="3063109">,</span>&nbsp;<span class="ident" id="3063111">width1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3063120">if</span>&nbsp;<span class="ident" id="3063123">r</span>&nbsp;<span class="op" id="3063125">!=</span>&nbsp;<span class="ident" id="3063128">endOfText</span>&nbsp;<span class="op" id="3063138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063143">r1</span><span class="op" id="3063145">,</span>&nbsp;<span class="ident" id="3063147">width1</span>&nbsp;<span class="op" id="3063154">=</span>&nbsp;<span class="ident" id="3063156">i</span><span class="op" id="3063157">.</span><span class="ident" id="3063158">step</span><span class="op" id="3063162">(</span><span class="ident" id="3063163">pos</span>&nbsp;<span class="op" id="3063167">+</span>&nbsp;<span class="ident" id="3063169">width</span><span class="op" id="3063174">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3063178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3063181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3063184">return</span>&nbsp;<span class="ident" id="3063191">m</span><span class="op" id="3063192">.</span><span class="ident" id="3063193">matched</span><br>
<span class="lineno"></span><span class="op" id="3063201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="comment" id="3063204">//&nbsp;empty&nbsp;is&nbsp;a&nbsp;non-nil&nbsp;0-element&nbsp;slice,</span><br>
<span class="lineno"></span><span class="comment" id="3063243">//&nbsp;so&nbsp;doExecute&nbsp;can&nbsp;avoid&nbsp;an&nbsp;allocation</span><br>
<span class="lineno"></span><span class="comment" id="3063283">//&nbsp;when&nbsp;0&nbsp;captures&nbsp;are&nbsp;requested&nbsp;from&nbsp;a&nbsp;successful&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3063341">var</span>&nbsp;<span class="ident" id="3063345">empty</span>&nbsp;<span class="op" id="3063351">=</span>&nbsp;<span class="builtinfunc" id="3063353">make</span><span class="op" id="3063357">(</span><span class="op" id="3063358">[</span><span class="op" id="3063359">]</span><span class="builtintype" id="3063360">int</span><span class="op" id="3063363">,</span>&nbsp;<span class="num" id="3063365">0</span><span class="op" id="3063366">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span><span class="comment" id="3063369">//&nbsp;doExecute&nbsp;finds&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;the&nbsp;input&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3063432">//&nbsp;the&nbsp;position&nbsp;of&nbsp;its&nbsp;subexpressions.</span><br>
<span class="lineno"></span><span class="keyword" id="3063471">func</span>&nbsp;<span class="op" id="3063476">(</span><span class="ident" id="3063477">re</span>&nbsp;<span class="op" id="3063480">*</span><span class="ident" id="3063481">Regexp</span><span class="op" id="3063487">)</span>&nbsp;<span class="ident" id="3063489">doExecute</span><span class="op" id="3063498">(</span><span class="ident" id="3063499">r</span>&nbsp;<span class="ident" id="3063501">io</span><span class="op" id="3063503">.</span><span class="ident" id="3063504">RuneReader</span><span class="op" id="3063514">,</span>&nbsp;<span class="ident" id="3063516">b</span>&nbsp;<span class="op" id="3063518">[</span><span class="op" id="3063519">]</span><span class="builtintype" id="3063520">byte</span><span class="op" id="3063524">,</span>&nbsp;<span class="ident" id="3063526">s</span>&nbsp;<span class="builtintype" id="3063528">string</span><span class="op" id="3063534">,</span>&nbsp;<span class="ident" id="3063536">pos</span>&nbsp;<span class="builtintype" id="3063540">int</span><span class="op" id="3063543">,</span>&nbsp;<span class="ident" id="3063545">ncap</span>&nbsp;<span class="builtintype" id="3063550">int</span><span class="op" id="3063553">)</span>&nbsp;<span class="op" id="3063555">[</span><span class="op" id="3063556">]</span><span class="builtintype" id="3063557">int</span>&nbsp;<span class="op" id="3063561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063564">m</span>&nbsp;<span class="op" id="3063566">:=</span>&nbsp;<span class="ident" id="3063569">re</span><span class="op" id="3063571">.</span><span class="ident" id="3063572">get</span><span class="op" id="3063575">(</span><span class="op" id="3063576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3063579">var</span>&nbsp;<span class="ident" id="3063583">i</span>&nbsp;<span class="ident" id="3063585">input</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3063592">if</span>&nbsp;<span class="ident" id="3063595">r</span>&nbsp;<span class="op" id="3063597">!=</span>&nbsp;<span class="ident" id="3063600">nil</span>&nbsp;<span class="op" id="3063604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063608">i</span>&nbsp;<span class="op" id="3063610">=</span>&nbsp;<span class="ident" id="3063612">m</span><span class="op" id="3063613">.</span><span class="ident" id="3063614">newInputReader</span><span class="op" id="3063628">(</span><span class="ident" id="3063629">r</span><span class="op" id="3063630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3063633">}</span>&nbsp;<span class="keyword" id="3063635">else</span>&nbsp;<span class="keyword" id="3063640">if</span>&nbsp;<span class="ident" id="3063643">b</span>&nbsp;<span class="op" id="3063645">!=</span>&nbsp;<span class="ident" id="3063648">nil</span>&nbsp;<span class="op" id="3063652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063656">i</span>&nbsp;<span class="op" id="3063658">=</span>&nbsp;<span class="ident" id="3063660">m</span><span class="op" id="3063661">.</span><span class="ident" id="3063662">newInputBytes</span><span class="op" id="3063675">(</span><span class="ident" id="3063676">b</span><span class="op" id="3063677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3063680">}</span>&nbsp;<span class="keyword" id="3063682">else</span>&nbsp;<span class="op" id="3063687">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063691">i</span>&nbsp;<span class="op" id="3063693">=</span>&nbsp;<span class="ident" id="3063695">m</span><span class="op" id="3063696">.</span><span class="ident" id="3063697">newInputString</span><span class="op" id="3063711">(</span><span class="ident" id="3063712">s</span><span class="op" id="3063713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3063716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3063719">if</span>&nbsp;<span class="ident" id="3063722">m</span><span class="op" id="3063723">.</span><span class="ident" id="3063724">op</span>&nbsp;<span class="op" id="3063727">!=</span>&nbsp;<span class="ident" id="3063730">notOnePass</span>&nbsp;<span class="op" id="3063741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3063745">if</span>&nbsp;<span class="op" id="3063748">!</span><span class="ident" id="3063749">m</span><span class="op" id="3063750">.</span><span class="ident" id="3063751">onepass</span><span class="op" id="3063758">(</span><span class="ident" id="3063759">i</span><span class="op" id="3063760">,</span>&nbsp;<span class="ident" id="3063762">pos</span><span class="op" id="3063765">)</span>&nbsp;<span class="op" id="3063767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063772">re</span><span class="op" id="3063774">.</span><span class="ident" id="3063775">put</span><span class="op" id="3063778">(</span><span class="ident" id="3063779">m</span><span class="op" id="3063780">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3063785">return</span>&nbsp;<span class="ident" id="3063792">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3063798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3063801">}</span>&nbsp;<span class="keyword" id="3063803">else</span>&nbsp;<span class="op" id="3063808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063812">m</span><span class="op" id="3063813">.</span><span class="ident" id="3063814">init</span><span class="op" id="3063818">(</span><span class="ident" id="3063819">ncap</span><span class="op" id="3063823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3063827">if</span>&nbsp;<span class="op" id="3063830">!</span><span class="ident" id="3063831">m</span><span class="op" id="3063832">.</span><span class="ident" id="3063833">match</span><span class="op" id="3063838">(</span><span class="ident" id="3063839">i</span><span class="op" id="3063840">,</span>&nbsp;<span class="ident" id="3063842">pos</span><span class="op" id="3063845">)</span>&nbsp;<span class="op" id="3063847">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063852">re</span><span class="op" id="3063854">.</span><span class="ident" id="3063855">put</span><span class="op" id="3063858">(</span><span class="ident" id="3063859">m</span><span class="op" id="3063860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3063865">return</span>&nbsp;<span class="ident" id="3063872">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3063878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3063881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3063884">if</span>&nbsp;<span class="ident" id="3063887">ncap</span>&nbsp;<span class="op" id="3063892">==</span>&nbsp;<span class="num" id="3063895">0</span>&nbsp;<span class="op" id="3063897">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063901">re</span><span class="op" id="3063903">.</span><span class="ident" id="3063904">put</span><span class="op" id="3063907">(</span><span class="ident" id="3063908">m</span><span class="op" id="3063909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3063913">return</span>&nbsp;<span class="ident" id="3063920">empty</span>&nbsp;<span class="comment" id="3063926">//&nbsp;empty&nbsp;but&nbsp;not&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3063948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3063951">cap</span>&nbsp;<span class="op" id="3063955">:=</span>&nbsp;<span class="builtinfunc" id="3063958">make</span><span class="op" id="3063962">(</span><span class="op" id="3063963">[</span><span class="op" id="3063964">]</span><span class="builtintype" id="3063965">int</span><span class="op" id="3063968">,</span>&nbsp;<span class="builtinfunc" id="3063970">len</span><span class="op" id="3063973">(</span><span class="ident" id="3063974">m</span><span class="op" id="3063975">.</span><span class="ident" id="3063976">matchcap</span><span class="op" id="3063984">)</span><span class="op" id="3063985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3063988">copy</span><span class="op" id="3063992">(</span><span class="builtinfunc" id="3063993">cap</span><span class="op" id="3063996">,</span>&nbsp;<span class="ident" id="3063998">m</span><span class="op" id="3063999">.</span><span class="ident" id="3064000">matchcap</span><span class="op" id="3064008">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064011">re</span><span class="op" id="3064013">.</span><span class="ident" id="3064014">put</span><span class="op" id="3064017">(</span><span class="ident" id="3064018">m</span><span class="op" id="3064019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064022">return</span>&nbsp;<span class="builtinfunc" id="3064029">cap</span><br>
<span class="lineno"></span><span class="op" id="3064033">}</span>
</div>
</body>
</html>
