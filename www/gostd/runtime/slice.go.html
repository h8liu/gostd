<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1634749">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1634804">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1634858">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1634909">package</span>&nbsp;<span class="ident" id="1634917">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1634926">import</span>&nbsp;<span class="op" id="1634933">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1634936">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1634945">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1634948">type</span>&nbsp;<span class="ident" id="1634953">sliceStruct</span>&nbsp;<span class="keyword" id="1634965">struct</span>&nbsp;<span class="op" id="1634972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1634975">array</span>&nbsp;<span class="ident" id="1634981">unsafe</span><span class="op" id="1634987">.</span><span class="ident" id="1634988">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1634997">len</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1635003">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1635008">cap</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1635014">int</span><br>
<span class="lineno">15</span><span class="op" id="1635018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1635021">//&nbsp;TODO:&nbsp;take&nbsp;uintptrs&nbsp;instead&nbsp;of&nbsp;int64s?</span><br>
<span class="lineno"></span><span class="keyword" id="1635063">func</span>&nbsp;<span class="ident" id="1635068">makeslice</span><span class="op" id="1635077">(</span><span class="ident" id="1635078">t</span>&nbsp;<span class="op" id="1635080">*</span><span class="ident" id="1635081">slicetype</span><span class="op" id="1635090">,</span>&nbsp;<span class="ident" id="1635092">len64</span>&nbsp;<span class="ident" id="1635098">int64</span><span class="op" id="1635103">,</span>&nbsp;<span class="ident" id="1635105">cap64</span>&nbsp;<span class="ident" id="1635111">int64</span><span class="op" id="1635116">)</span>&nbsp;<span class="ident" id="1635118">sliceStruct</span>&nbsp;<span class="op" id="1635130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1635133">//&nbsp;NOTE:&nbsp;The&nbsp;len&nbsp;&gt;&nbsp;MaxMem/elemsize&nbsp;check&nbsp;here&nbsp;is&nbsp;not&nbsp;strictly&nbsp;necessary,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1635207">//&nbsp;but&nbsp;it&nbsp;produces&nbsp;a&nbsp;&#39;len&nbsp;out&nbsp;of&nbsp;range&#39;&nbsp;error&nbsp;instead&nbsp;of&nbsp;a&nbsp;&#39;cap&nbsp;out&nbsp;of&nbsp;range&#39;&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1635292">//&nbsp;when&nbsp;someone&nbsp;does&nbsp;make([]T,&nbsp;bignumber).&nbsp;&#39;cap&nbsp;out&nbsp;of&nbsp;range&#39;&nbsp;is&nbsp;true&nbsp;too,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1635368">//&nbsp;but&nbsp;since&nbsp;the&nbsp;cap&nbsp;is&nbsp;only&nbsp;being&nbsp;supplied&nbsp;implicitly,&nbsp;saying&nbsp;len&nbsp;is&nbsp;clearer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1635448">//&nbsp;See&nbsp;issue&nbsp;4085.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1635468">len</span>&nbsp;<span class="op" id="1635472">:=</span>&nbsp;<span class="builtintype" id="1635475">int</span><span class="op" id="1635478">(</span><span class="ident" id="1635479">len64</span><span class="op" id="1635484">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1635487">if</span>&nbsp;<span class="ident" id="1635490">len64</span>&nbsp;<span class="op" id="1635496">&lt;</span>&nbsp;<span class="num" id="1635498">0</span>&nbsp;<span class="op" id="1635500">||</span>&nbsp;<span class="ident" id="1635503">int64</span><span class="op" id="1635508">(</span><span class="builtinfunc" id="1635509">len</span><span class="op" id="1635512">)</span>&nbsp;<span class="op" id="1635514">!=</span>&nbsp;<span class="ident" id="1635517">len64</span>&nbsp;<span class="op" id="1635523">||</span>&nbsp;<span class="ident" id="1635526">t</span><span class="op" id="1635527">.</span><span class="ident" id="1635528">elem</span><span class="op" id="1635532">.</span><span class="ident" id="1635533">size</span>&nbsp;<span class="op" id="1635538">&gt;</span>&nbsp;<span class="num" id="1635540">0</span>&nbsp;<span class="op" id="1635542">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1635545">uintptr</span><span class="op" id="1635552">(</span><span class="builtinfunc" id="1635553">len</span><span class="op" id="1635556">)</span>&nbsp;<span class="op" id="1635558">&gt;</span>&nbsp;<span class="ident" id="1635560">maxmem</span><span class="op" id="1635566">/</span><span class="builtintype" id="1635567">uintptr</span><span class="op" id="1635574">(</span><span class="ident" id="1635575">t</span><span class="op" id="1635576">.</span><span class="ident" id="1635577">elem</span><span class="op" id="1635581">.</span><span class="ident" id="1635582">size</span><span class="op" id="1635586">)</span>&nbsp;<span class="op" id="1635588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1635592">panic</span><span class="op" id="1635597">(</span><span class="ident" id="1635598">errorString</span><span class="op" id="1635609">(</span><span class="string" id="1635610">&#34;makeslice:&nbsp;len&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1635639">)</span><span class="op" id="1635640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1635643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1635646">cap</span>&nbsp;<span class="op" id="1635650">:=</span>&nbsp;<span class="builtintype" id="1635653">int</span><span class="op" id="1635656">(</span><span class="ident" id="1635657">cap64</span><span class="op" id="1635662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1635665">if</span>&nbsp;<span class="builtinfunc" id="1635668">cap</span>&nbsp;<span class="op" id="1635672">&lt;</span>&nbsp;<span class="builtinfunc" id="1635674">len</span>&nbsp;<span class="op" id="1635678">||</span>&nbsp;<span class="ident" id="1635681">int64</span><span class="op" id="1635686">(</span><span class="builtinfunc" id="1635687">cap</span><span class="op" id="1635690">)</span>&nbsp;<span class="op" id="1635692">!=</span>&nbsp;<span class="ident" id="1635695">cap64</span>&nbsp;<span class="op" id="1635701">||</span>&nbsp;<span class="ident" id="1635704">t</span><span class="op" id="1635705">.</span><span class="ident" id="1635706">elem</span><span class="op" id="1635710">.</span><span class="ident" id="1635711">size</span>&nbsp;<span class="op" id="1635716">&gt;</span>&nbsp;<span class="num" id="1635718">0</span>&nbsp;<span class="op" id="1635720">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1635723">uintptr</span><span class="op" id="1635730">(</span><span class="builtinfunc" id="1635731">cap</span><span class="op" id="1635734">)</span>&nbsp;<span class="op" id="1635736">&gt;</span>&nbsp;<span class="ident" id="1635738">maxmem</span><span class="op" id="1635744">/</span><span class="builtintype" id="1635745">uintptr</span><span class="op" id="1635752">(</span><span class="ident" id="1635753">t</span><span class="op" id="1635754">.</span><span class="ident" id="1635755">elem</span><span class="op" id="1635759">.</span><span class="ident" id="1635760">size</span><span class="op" id="1635764">)</span>&nbsp;<span class="op" id="1635766">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1635770">panic</span><span class="op" id="1635775">(</span><span class="ident" id="1635776">errorString</span><span class="op" id="1635787">(</span><span class="string" id="1635788">&#34;makeslice:&nbsp;cap&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1635817">)</span><span class="op" id="1635818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1635821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1635824">p</span>&nbsp;<span class="op" id="1635826">:=</span>&nbsp;<span class="ident" id="1635829">newarray</span><span class="op" id="1635837">(</span><span class="ident" id="1635838">t</span><span class="op" id="1635839">.</span><span class="ident" id="1635840">elem</span><span class="op" id="1635844">,</span>&nbsp;<span class="builtintype" id="1635846">uintptr</span><span class="op" id="1635853">(</span><span class="builtinfunc" id="1635854">cap</span><span class="op" id="1635857">)</span><span class="op" id="1635858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1635861">return</span>&nbsp;<span class="ident" id="1635868">sliceStruct</span><span class="op" id="1635879">{</span><span class="ident" id="1635880">p</span><span class="op" id="1635881">,</span>&nbsp;<span class="builtinfunc" id="1635883">len</span><span class="op" id="1635886">,</span>&nbsp;<span class="builtinfunc" id="1635888">cap</span><span class="op" id="1635891">}</span><br>
<span class="lineno"></span><span class="op" id="1635893">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="1635896">//&nbsp;TODO:&nbsp;take&nbsp;uintptr&nbsp;instead&nbsp;of&nbsp;int64?</span><br>
<span class="lineno"></span><span class="keyword" id="1635936">func</span>&nbsp;<span class="ident" id="1635941">growslice</span><span class="op" id="1635950">(</span><span class="ident" id="1635951">t</span>&nbsp;<span class="op" id="1635953">*</span><span class="ident" id="1635954">slicetype</span><span class="op" id="1635963">,</span>&nbsp;<span class="ident" id="1635965">old</span>&nbsp;<span class="ident" id="1635969">sliceStruct</span><span class="op" id="1635980">,</span>&nbsp;<span class="ident" id="1635982">n</span>&nbsp;<span class="ident" id="1635984">int64</span><span class="op" id="1635989">)</span>&nbsp;<span class="ident" id="1635991">sliceStruct</span>&nbsp;<span class="op" id="1636003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1636006">if</span>&nbsp;<span class="ident" id="1636009">n</span>&nbsp;<span class="op" id="1636011">&lt;</span>&nbsp;<span class="num" id="1636013">1</span>&nbsp;<span class="op" id="1636015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1636019">panic</span><span class="op" id="1636024">(</span><span class="ident" id="1636025">errorString</span><span class="op" id="1636036">(</span><span class="string" id="1636037">&#34;growslice:&nbsp;invalid&nbsp;n&#34;</span><span class="op" id="1636059">)</span><span class="op" id="1636060">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1636063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1636067">cap64</span>&nbsp;<span class="op" id="1636073">:=</span>&nbsp;<span class="ident" id="1636076">int64</span><span class="op" id="1636081">(</span><span class="ident" id="1636082">old</span><span class="op" id="1636085">.</span><span class="builtinfunc" id="1636086">cap</span><span class="op" id="1636089">)</span>&nbsp;<span class="op" id="1636091">+</span>&nbsp;<span class="ident" id="1636093">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1636096">cap</span>&nbsp;<span class="op" id="1636100">:=</span>&nbsp;<span class="builtintype" id="1636103">int</span><span class="op" id="1636106">(</span><span class="ident" id="1636107">cap64</span><span class="op" id="1636112">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1636116">if</span>&nbsp;<span class="ident" id="1636119">int64</span><span class="op" id="1636124">(</span><span class="builtinfunc" id="1636125">cap</span><span class="op" id="1636128">)</span>&nbsp;<span class="op" id="1636130">!=</span>&nbsp;<span class="ident" id="1636133">cap64</span>&nbsp;<span class="op" id="1636139">||</span>&nbsp;<span class="builtinfunc" id="1636142">cap</span>&nbsp;<span class="op" id="1636146">&lt;</span>&nbsp;<span class="ident" id="1636148">old</span><span class="op" id="1636151">.</span><span class="builtinfunc" id="1636152">cap</span>&nbsp;<span class="op" id="1636156">||</span>&nbsp;<span class="ident" id="1636159">t</span><span class="op" id="1636160">.</span><span class="ident" id="1636161">elem</span><span class="op" id="1636165">.</span><span class="ident" id="1636166">size</span>&nbsp;<span class="op" id="1636171">&gt;</span>&nbsp;<span class="num" id="1636173">0</span>&nbsp;<span class="op" id="1636175">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1636178">uintptr</span><span class="op" id="1636185">(</span><span class="builtinfunc" id="1636186">cap</span><span class="op" id="1636189">)</span>&nbsp;<span class="op" id="1636191">&gt;</span>&nbsp;<span class="ident" id="1636193">maxmem</span><span class="op" id="1636199">/</span><span class="builtintype" id="1636200">uintptr</span><span class="op" id="1636207">(</span><span class="ident" id="1636208">t</span><span class="op" id="1636209">.</span><span class="ident" id="1636210">elem</span><span class="op" id="1636214">.</span><span class="ident" id="1636215">size</span><span class="op" id="1636219">)</span>&nbsp;<span class="op" id="1636221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1636225">panic</span><span class="op" id="1636230">(</span><span class="ident" id="1636231">errorString</span><span class="op" id="1636242">(</span><span class="string" id="1636243">&#34;growslice:&nbsp;cap&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1636272">)</span><span class="op" id="1636273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1636276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1636280">if</span>&nbsp;<span class="ident" id="1636283">raceenabled</span>&nbsp;<span class="op" id="1636295">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1636299">callerpc</span>&nbsp;<span class="op" id="1636308">:=</span>&nbsp;<span class="ident" id="1636311">getcallerpc</span><span class="op" id="1636322">(</span><span class="ident" id="1636323">unsafe</span><span class="op" id="1636329">.</span><span class="ident" id="1636330">Pointer</span><span class="op" id="1636337">(</span><span class="op" id="1636338">&amp;</span><span class="ident" id="1636339">t</span><span class="op" id="1636340">)</span><span class="op" id="1636341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1636345">racereadrangepc</span><span class="op" id="1636360">(</span><span class="ident" id="1636361">old</span><span class="op" id="1636364">.</span><span class="ident" id="1636365">array</span><span class="op" id="1636370">,</span>&nbsp;<span class="builtintype" id="1636372">uintptr</span><span class="op" id="1636379">(</span><span class="ident" id="1636380">old</span><span class="op" id="1636383">.</span><span class="builtinfunc" id="1636384">len</span><span class="op" id="1636387">*</span><span class="builtintype" id="1636388">int</span><span class="op" id="1636391">(</span><span class="ident" id="1636392">t</span><span class="op" id="1636393">.</span><span class="ident" id="1636394">elem</span><span class="op" id="1636398">.</span><span class="ident" id="1636399">size</span><span class="op" id="1636403">)</span><span class="op" id="1636404">)</span><span class="op" id="1636405">,</span>&nbsp;<span class="ident" id="1636407">callerpc</span><span class="op" id="1636415">,</span>&nbsp;<span class="ident" id="1636417">funcPC</span><span class="op" id="1636423">(</span><span class="ident" id="1636424">growslice</span><span class="op" id="1636433">)</span><span class="op" id="1636434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1636437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1636441">et</span>&nbsp;<span class="op" id="1636444">:=</span>&nbsp;<span class="ident" id="1636447">t</span><span class="op" id="1636448">.</span><span class="ident" id="1636449">elem</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1636455">if</span>&nbsp;<span class="ident" id="1636458">et</span><span class="op" id="1636460">.</span><span class="ident" id="1636461">size</span>&nbsp;<span class="op" id="1636466">==</span>&nbsp;<span class="num" id="1636469">0</span>&nbsp;<span class="op" id="1636471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1636475">return</span>&nbsp;<span class="ident" id="1636482">sliceStruct</span><span class="op" id="1636493">{</span><span class="ident" id="1636494">old</span><span class="op" id="1636497">.</span><span class="ident" id="1636498">array</span><span class="op" id="1636503">,</span>&nbsp;<span class="ident" id="1636505">old</span><span class="op" id="1636508">.</span><span class="builtinfunc" id="1636509">len</span><span class="op" id="1636512">,</span>&nbsp;<span class="builtinfunc" id="1636514">cap</span><span class="op" id="1636517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1636520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1636524">newcap</span>&nbsp;<span class="op" id="1636531">:=</span>&nbsp;<span class="ident" id="1636534">old</span><span class="op" id="1636537">.</span><span class="builtinfunc" id="1636538">cap</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1636543">if</span>&nbsp;<span class="ident" id="1636546">newcap</span><span class="op" id="1636552">+</span><span class="ident" id="1636553">newcap</span>&nbsp;<span class="op" id="1636560">&lt;</span>&nbsp;<span class="builtinfunc" id="1636562">cap</span>&nbsp;<span class="op" id="1636566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1636570">newcap</span>&nbsp;<span class="op" id="1636577">=</span>&nbsp;<span class="builtinfunc" id="1636579">cap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1636584">}</span>&nbsp;<span class="keyword" id="1636586">else</span>&nbsp;<span class="op" id="1636591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1636595">for</span>&nbsp;<span class="op" id="1636599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1636604">if</span>&nbsp;<span class="ident" id="1636607">old</span><span class="op" id="1636610">.</span><span class="builtinfunc" id="1636611">len</span>&nbsp;<span class="op" id="1636615">&lt;</span>&nbsp;<span class="num" id="1636617">1024</span>&nbsp;<span class="op" id="1636622">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1636628">newcap</span>&nbsp;<span class="op" id="1636635">+=</span>&nbsp;<span class="ident" id="1636638">newcap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1636648">}</span>&nbsp;<span class="keyword" id="1636650">else</span>&nbsp;<span class="op" id="1636655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1636661">newcap</span>&nbsp;<span class="op" id="1636668">+=</span>&nbsp;<span class="ident" id="1636671">newcap</span>&nbsp;<span class="op" id="1636678">/</span>&nbsp;<span class="num" id="1636680">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1636685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1636690">if</span>&nbsp;<span class="ident" id="1636693">newcap</span>&nbsp;<span class="op" id="1636700">&gt;=</span>&nbsp;<span class="builtinfunc" id="1636703">cap</span>&nbsp;<span class="op" id="1636707">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1636713">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1636722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1636726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1636729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1636733">if</span>&nbsp;<span class="builtintype" id="1636736">uintptr</span><span class="op" id="1636743">(</span><span class="ident" id="1636744">newcap</span><span class="op" id="1636750">)</span>&nbsp;<span class="op" id="1636752">&gt;=</span>&nbsp;<span class="ident" id="1636755">maxmem</span><span class="op" id="1636761">/</span><span class="builtintype" id="1636762">uintptr</span><span class="op" id="1636769">(</span><span class="ident" id="1636770">et</span><span class="op" id="1636772">.</span><span class="ident" id="1636773">size</span><span class="op" id="1636777">)</span>&nbsp;<span class="op" id="1636779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1636783">panic</span><span class="op" id="1636788">(</span><span class="ident" id="1636789">errorString</span><span class="op" id="1636800">(</span><span class="string" id="1636801">&#34;growslice:&nbsp;cap&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1636830">)</span><span class="op" id="1636831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1636834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1636837">lenmem</span>&nbsp;<span class="op" id="1636844">:=</span>&nbsp;<span class="builtintype" id="1636847">uintptr</span><span class="op" id="1636854">(</span><span class="ident" id="1636855">old</span><span class="op" id="1636858">.</span><span class="builtinfunc" id="1636859">len</span><span class="op" id="1636862">)</span>&nbsp;<span class="op" id="1636864">*</span>&nbsp;<span class="builtintype" id="1636866">uintptr</span><span class="op" id="1636873">(</span><span class="ident" id="1636874">et</span><span class="op" id="1636876">.</span><span class="ident" id="1636877">size</span><span class="op" id="1636881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1636884">capmem</span>&nbsp;<span class="op" id="1636891">:=</span>&nbsp;<span class="ident" id="1636894">goroundupsize</span><span class="op" id="1636907">(</span><span class="builtintype" id="1636908">uintptr</span><span class="op" id="1636915">(</span><span class="ident" id="1636916">newcap</span><span class="op" id="1636922">)</span>&nbsp;<span class="op" id="1636924">*</span>&nbsp;<span class="builtintype" id="1636926">uintptr</span><span class="op" id="1636933">(</span><span class="ident" id="1636934">et</span><span class="op" id="1636936">.</span><span class="ident" id="1636937">size</span><span class="op" id="1636941">)</span><span class="op" id="1636942">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1636945">newcap</span>&nbsp;<span class="op" id="1636952">=</span>&nbsp;<span class="builtintype" id="1636954">int</span><span class="op" id="1636957">(</span><span class="ident" id="1636958">capmem</span>&nbsp;<span class="op" id="1636965">/</span>&nbsp;<span class="builtintype" id="1636967">uintptr</span><span class="op" id="1636974">(</span><span class="ident" id="1636975">et</span><span class="op" id="1636977">.</span><span class="ident" id="1636978">size</span><span class="op" id="1636982">)</span><span class="op" id="1636983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1636986">var</span>&nbsp;<span class="ident" id="1636990">p</span>&nbsp;<span class="ident" id="1636992">unsafe</span><span class="op" id="1636998">.</span><span class="ident" id="1636999">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1637008">if</span>&nbsp;<span class="ident" id="1637011">et</span><span class="op" id="1637013">.</span><span class="ident" id="1637014">kind</span><span class="op" id="1637018">&amp;</span><span class="ident" id="1637019">kindNoPointers</span>&nbsp;<span class="op" id="1637034">!=</span>&nbsp;<span class="num" id="1637037">0</span>&nbsp;<span class="op" id="1637039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1637043">p</span>&nbsp;<span class="op" id="1637045">=</span>&nbsp;<span class="ident" id="1637047">rawmem</span><span class="op" id="1637053">(</span><span class="ident" id="1637054">capmem</span><span class="op" id="1637060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1637064">memclr</span><span class="op" id="1637070">(</span><span class="ident" id="1637071">add</span><span class="op" id="1637074">(</span><span class="ident" id="1637075">p</span><span class="op" id="1637076">,</span>&nbsp;<span class="ident" id="1637078">lenmem</span><span class="op" id="1637084">)</span><span class="op" id="1637085">,</span>&nbsp;<span class="ident" id="1637087">capmem</span><span class="op" id="1637093">-</span><span class="ident" id="1637094">lenmem</span><span class="op" id="1637100">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1637103">}</span>&nbsp;<span class="keyword" id="1637105">else</span>&nbsp;<span class="op" id="1637110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1637114">//&nbsp;Note:&nbsp;can&#39;t&nbsp;use&nbsp;rawmem&nbsp;(which&nbsp;avoids&nbsp;zeroing&nbsp;of&nbsp;memory),&nbsp;because&nbsp;then&nbsp;GC&nbsp;can&nbsp;scan&nbsp;unitialized&nbsp;memory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1637220">p</span>&nbsp;<span class="op" id="1637222">=</span>&nbsp;<span class="ident" id="1637224">newarray</span><span class="op" id="1637232">(</span><span class="ident" id="1637233">et</span><span class="op" id="1637235">,</span>&nbsp;<span class="builtintype" id="1637237">uintptr</span><span class="op" id="1637244">(</span><span class="ident" id="1637245">newcap</span><span class="op" id="1637251">)</span><span class="op" id="1637252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1637255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1637258">memmove</span><span class="op" id="1637265">(</span><span class="ident" id="1637266">p</span><span class="op" id="1637267">,</span>&nbsp;<span class="ident" id="1637269">old</span><span class="op" id="1637272">.</span><span class="ident" id="1637273">array</span><span class="op" id="1637278">,</span>&nbsp;<span class="ident" id="1637280">lenmem</span><span class="op" id="1637286">)</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1637290">return</span>&nbsp;<span class="ident" id="1637297">sliceStruct</span><span class="op" id="1637308">{</span><span class="ident" id="1637309">p</span><span class="op" id="1637310">,</span>&nbsp;<span class="ident" id="1637312">old</span><span class="op" id="1637315">.</span><span class="builtinfunc" id="1637316">len</span><span class="op" id="1637319">,</span>&nbsp;<span class="ident" id="1637321">newcap</span><span class="op" id="1637327">}</span><br>
<span class="lineno"></span><span class="op" id="1637329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1637332">func</span>&nbsp;<span class="ident" id="1637337">slicecopy</span><span class="op" id="1637346">(</span><span class="ident" id="1637347">to</span>&nbsp;<span class="ident" id="1637350">sliceStruct</span><span class="op" id="1637361">,</span>&nbsp;<span class="ident" id="1637363">fm</span>&nbsp;<span class="ident" id="1637366">sliceStruct</span><span class="op" id="1637377">,</span>&nbsp;<span class="ident" id="1637379">width</span>&nbsp;<span class="builtintype" id="1637385">uintptr</span><span class="op" id="1637392">)</span>&nbsp;<span class="builtintype" id="1637394">int</span>&nbsp;<span class="op" id="1637398">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1637401">if</span>&nbsp;<span class="ident" id="1637404">fm</span><span class="op" id="1637406">.</span><span class="builtinfunc" id="1637407">len</span>&nbsp;<span class="op" id="1637411">==</span>&nbsp;<span class="num" id="1637414">0</span>&nbsp;<span class="op" id="1637416">||</span>&nbsp;<span class="ident" id="1637419">to</span><span class="op" id="1637421">.</span><span class="builtinfunc" id="1637422">len</span>&nbsp;<span class="op" id="1637426">==</span>&nbsp;<span class="num" id="1637429">0</span>&nbsp;<span class="op" id="1637431">||</span>&nbsp;<span class="ident" id="1637434">width</span>&nbsp;<span class="op" id="1637440">==</span>&nbsp;<span class="num" id="1637443">0</span>&nbsp;<span class="op" id="1637445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1637449">return</span>&nbsp;<span class="num" id="1637456">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1637459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1637463">n</span>&nbsp;<span class="op" id="1637465">:=</span>&nbsp;<span class="ident" id="1637468">fm</span><span class="op" id="1637470">.</span><span class="builtinfunc" id="1637471">len</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1637476">if</span>&nbsp;<span class="ident" id="1637479">to</span><span class="op" id="1637481">.</span><span class="builtinfunc" id="1637482">len</span>&nbsp;<span class="op" id="1637486">&lt;</span>&nbsp;<span class="ident" id="1637488">n</span>&nbsp;<span class="op" id="1637490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1637494">n</span>&nbsp;<span class="op" id="1637496">=</span>&nbsp;<span class="ident" id="1637498">to</span><span class="op" id="1637500">.</span><span class="builtinfunc" id="1637501">len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1637506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1637510">if</span>&nbsp;<span class="ident" id="1637513">raceenabled</span>&nbsp;<span class="op" id="1637525">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1637529">callerpc</span>&nbsp;<span class="op" id="1637538">:=</span>&nbsp;<span class="ident" id="1637541">getcallerpc</span><span class="op" id="1637552">(</span><span class="ident" id="1637553">unsafe</span><span class="op" id="1637559">.</span><span class="ident" id="1637560">Pointer</span><span class="op" id="1637567">(</span><span class="op" id="1637568">&amp;</span><span class="ident" id="1637569">to</span><span class="op" id="1637571">)</span><span class="op" id="1637572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1637576">pc</span>&nbsp;<span class="op" id="1637579">:=</span>&nbsp;<span class="ident" id="1637582">funcPC</span><span class="op" id="1637588">(</span><span class="ident" id="1637589">slicecopy</span><span class="op" id="1637598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1637602">racewriterangepc</span><span class="op" id="1637618">(</span><span class="ident" id="1637619">to</span><span class="op" id="1637621">.</span><span class="ident" id="1637622">array</span><span class="op" id="1637627">,</span>&nbsp;<span class="builtintype" id="1637629">uintptr</span><span class="op" id="1637636">(</span><span class="ident" id="1637637">n</span><span class="op" id="1637638">*</span><span class="builtintype" id="1637639">int</span><span class="op" id="1637642">(</span><span class="ident" id="1637643">width</span><span class="op" id="1637648">)</span><span class="op" id="1637649">)</span><span class="op" id="1637650">,</span>&nbsp;<span class="ident" id="1637652">callerpc</span><span class="op" id="1637660">,</span>&nbsp;<span class="ident" id="1637662">pc</span><span class="op" id="1637664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1637668">racereadrangepc</span><span class="op" id="1637683">(</span><span class="ident" id="1637684">fm</span><span class="op" id="1637686">.</span><span class="ident" id="1637687">array</span><span class="op" id="1637692">,</span>&nbsp;<span class="builtintype" id="1637694">uintptr</span><span class="op" id="1637701">(</span><span class="ident" id="1637702">n</span><span class="op" id="1637703">*</span><span class="builtintype" id="1637704">int</span><span class="op" id="1637707">(</span><span class="ident" id="1637708">width</span><span class="op" id="1637713">)</span><span class="op" id="1637714">)</span><span class="op" id="1637715">,</span>&nbsp;<span class="ident" id="1637717">callerpc</span><span class="op" id="1637725">,</span>&nbsp;<span class="ident" id="1637727">pc</span><span class="op" id="1637729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1637732">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1637736">size</span>&nbsp;<span class="op" id="1637741">:=</span>&nbsp;<span class="builtintype" id="1637744">uintptr</span><span class="op" id="1637751">(</span><span class="ident" id="1637752">n</span><span class="op" id="1637753">)</span>&nbsp;<span class="op" id="1637755">*</span>&nbsp;<span class="ident" id="1637757">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1637764">if</span>&nbsp;<span class="ident" id="1637767">size</span>&nbsp;<span class="op" id="1637772">==</span>&nbsp;<span class="num" id="1637775">1</span>&nbsp;<span class="op" id="1637777">{</span>&nbsp;<span class="comment" id="1637779">//&nbsp;common&nbsp;case&nbsp;worth&nbsp;about&nbsp;2x&nbsp;to&nbsp;do&nbsp;here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1637822">//&nbsp;TODO:&nbsp;is&nbsp;this&nbsp;still&nbsp;worth&nbsp;it&nbsp;with&nbsp;new&nbsp;memmove&nbsp;impl?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1637879">*</span><span class="op" id="1637880">(</span><span class="op" id="1637881">*</span><span class="builtintype" id="1637882">byte</span><span class="op" id="1637886">)</span><span class="op" id="1637887">(</span><span class="ident" id="1637888">to</span><span class="op" id="1637890">.</span><span class="ident" id="1637891">array</span><span class="op" id="1637896">)</span>&nbsp;<span class="op" id="1637898">=</span>&nbsp;<span class="op" id="1637900">*</span><span class="op" id="1637901">(</span><span class="op" id="1637902">*</span><span class="builtintype" id="1637903">byte</span><span class="op" id="1637907">)</span><span class="op" id="1637908">(</span><span class="ident" id="1637909">fm</span><span class="op" id="1637911">.</span><span class="ident" id="1637912">array</span><span class="op" id="1637917">)</span>&nbsp;<span class="comment" id="1637919">//&nbsp;known&nbsp;to&nbsp;be&nbsp;a&nbsp;byte&nbsp;pointer</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1637950">}</span>&nbsp;<span class="keyword" id="1637952">else</span>&nbsp;<span class="op" id="1637957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1637961">memmove</span><span class="op" id="1637968">(</span><span class="ident" id="1637969">to</span><span class="op" id="1637971">.</span><span class="ident" id="1637972">array</span><span class="op" id="1637977">,</span>&nbsp;<span class="ident" id="1637979">fm</span><span class="op" id="1637981">.</span><span class="ident" id="1637982">array</span><span class="op" id="1637987">,</span>&nbsp;<span class="ident" id="1637989">size</span><span class="op" id="1637993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1637996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1637999">return</span>&nbsp;<span class="builtintype" id="1638006">int</span><span class="op" id="1638009">(</span><span class="ident" id="1638010">n</span><span class="op" id="1638011">)</span><br>
<span class="lineno"></span><span class="op" id="1638013">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="1638016">func</span>&nbsp;<span class="ident" id="1638021">slicestringcopy</span><span class="op" id="1638036">(</span><span class="ident" id="1638037">to</span>&nbsp;<span class="op" id="1638040">[</span><span class="op" id="1638041">]</span><span class="builtintype" id="1638042">byte</span><span class="op" id="1638046">,</span>&nbsp;<span class="ident" id="1638048">fm</span>&nbsp;<span class="builtintype" id="1638051">string</span><span class="op" id="1638057">)</span>&nbsp;<span class="builtintype" id="1638059">int</span>&nbsp;<span class="op" id="1638063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1638066">if</span>&nbsp;<span class="builtinfunc" id="1638069">len</span><span class="op" id="1638072">(</span><span class="ident" id="1638073">fm</span><span class="op" id="1638075">)</span>&nbsp;<span class="op" id="1638077">==</span>&nbsp;<span class="num" id="1638080">0</span>&nbsp;<span class="op" id="1638082">||</span>&nbsp;<span class="builtinfunc" id="1638085">len</span><span class="op" id="1638088">(</span><span class="ident" id="1638089">to</span><span class="op" id="1638091">)</span>&nbsp;<span class="op" id="1638093">==</span>&nbsp;<span class="num" id="1638096">0</span>&nbsp;<span class="op" id="1638098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1638102">return</span>&nbsp;<span class="num" id="1638109">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1638112">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1638116">n</span>&nbsp;<span class="op" id="1638118">:=</span>&nbsp;<span class="builtinfunc" id="1638121">len</span><span class="op" id="1638124">(</span><span class="ident" id="1638125">fm</span><span class="op" id="1638127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1638130">if</span>&nbsp;<span class="builtinfunc" id="1638133">len</span><span class="op" id="1638136">(</span><span class="ident" id="1638137">to</span><span class="op" id="1638139">)</span>&nbsp;<span class="op" id="1638141">&lt;</span>&nbsp;<span class="ident" id="1638143">n</span>&nbsp;<span class="op" id="1638145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1638149">n</span>&nbsp;<span class="op" id="1638151">=</span>&nbsp;<span class="builtinfunc" id="1638153">len</span><span class="op" id="1638156">(</span><span class="ident" id="1638157">to</span><span class="op" id="1638159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1638162">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1638166">if</span>&nbsp;<span class="ident" id="1638169">raceenabled</span>&nbsp;<span class="op" id="1638181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1638185">callerpc</span>&nbsp;<span class="op" id="1638194">:=</span>&nbsp;<span class="ident" id="1638197">getcallerpc</span><span class="op" id="1638208">(</span><span class="ident" id="1638209">unsafe</span><span class="op" id="1638215">.</span><span class="ident" id="1638216">Pointer</span><span class="op" id="1638223">(</span><span class="op" id="1638224">&amp;</span><span class="ident" id="1638225">to</span><span class="op" id="1638227">)</span><span class="op" id="1638228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1638232">pc</span>&nbsp;<span class="op" id="1638235">:=</span>&nbsp;<span class="ident" id="1638238">funcPC</span><span class="op" id="1638244">(</span><span class="ident" id="1638245">slicestringcopy</span><span class="op" id="1638260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1638264">racewriterangepc</span><span class="op" id="1638280">(</span><span class="ident" id="1638281">unsafe</span><span class="op" id="1638287">.</span><span class="ident" id="1638288">Pointer</span><span class="op" id="1638295">(</span><span class="op" id="1638296">&amp;</span><span class="ident" id="1638297">to</span><span class="op" id="1638299">[</span><span class="num" id="1638300">0</span><span class="op" id="1638301">]</span><span class="op" id="1638302">)</span><span class="op" id="1638303">,</span>&nbsp;<span class="builtintype" id="1638305">uintptr</span><span class="op" id="1638312">(</span><span class="ident" id="1638313">n</span><span class="op" id="1638314">)</span><span class="op" id="1638315">,</span>&nbsp;<span class="ident" id="1638317">callerpc</span><span class="op" id="1638325">,</span>&nbsp;<span class="ident" id="1638327">pc</span><span class="op" id="1638329">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1638332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1638336">memmove</span><span class="op" id="1638343">(</span><span class="ident" id="1638344">unsafe</span><span class="op" id="1638350">.</span><span class="ident" id="1638351">Pointer</span><span class="op" id="1638358">(</span><span class="op" id="1638359">&amp;</span><span class="ident" id="1638360">to</span><span class="op" id="1638362">[</span><span class="num" id="1638363">0</span><span class="op" id="1638364">]</span><span class="op" id="1638365">)</span><span class="op" id="1638366">,</span>&nbsp;<span class="ident" id="1638368">unsafe</span><span class="op" id="1638374">.</span><span class="ident" id="1638375">Pointer</span><span class="op" id="1638382">(</span><span class="op" id="1638383">(</span><span class="op" id="1638384">*</span><span class="ident" id="1638385">stringStruct</span><span class="op" id="1638397">)</span><span class="op" id="1638398">(</span><span class="ident" id="1638399">unsafe</span><span class="op" id="1638405">.</span><span class="ident" id="1638406">Pointer</span><span class="op" id="1638413">(</span><span class="op" id="1638414">&amp;</span><span class="ident" id="1638415">fm</span><span class="op" id="1638417">)</span><span class="op" id="1638418">)</span><span class="op" id="1638419">.</span><span class="ident" id="1638420">str</span><span class="op" id="1638423">)</span><span class="op" id="1638424">,</span>&nbsp;<span class="builtintype" id="1638426">uintptr</span><span class="op" id="1638433">(</span><span class="ident" id="1638434">n</span><span class="op" id="1638435">)</span><span class="op" id="1638436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1638439">return</span>&nbsp;<span class="ident" id="1638446">n</span><br>
<span class="lineno"></span><span class="op" id="1638448">}</span>
</div>
</body>
</html>
