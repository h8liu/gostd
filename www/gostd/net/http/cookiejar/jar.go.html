<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/cookiejar</h2>
<ul>
<li><a href="/gostd/net/http/cookiejar/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/cookiejar/jar_test.go.html">jar_test.go</a></li>
<li><a href="/gostd/net/http/cookiejar/punycode.go.html">punycode.go</a></li>
<li><a href="/gostd/net/http/cookiejar/punycode_test.go.html">punycode_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6148818">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6148873">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6148927">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6148978">//&nbsp;Package&nbsp;cookiejar&nbsp;implements&nbsp;an&nbsp;in-memory&nbsp;RFC&nbsp;6265-compliant&nbsp;http.CookieJar.</span><br>
<span class="lineno"></span><span class="keyword" id="6149058">package</span>&nbsp;<span class="ident" id="6149066">cookiejar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6149077">import</span>&nbsp;<span class="op" id="6149084">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6149087">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6149097">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6149104">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6149111">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6149123">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6149134">&#34;sort&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6149142">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6149153">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6149161">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6149168">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="6149171">//&nbsp;PublicSuffixList&nbsp;provides&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;a&nbsp;domain.&nbsp;For&nbsp;example:</span><br>
<span class="lineno"></span><span class="comment" id="6149244">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;example.com&#34;&nbsp;is&nbsp;&#34;com&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6149299">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;foo1.foo2.foo3.co.uk&#34;&nbsp;is&nbsp;&#34;co.uk&#34;,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6149369">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;bar.pvt.k12.ma.us&#34;&nbsp;is&nbsp;&#34;pvt.k12.ma.us&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="6149440">//</span><br>
<span class="lineno">25</span><span class="comment" id="6149443">//&nbsp;Implementations&nbsp;of&nbsp;PublicSuffixList&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="6149517">//&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="comment" id="6149541">//</span><br>
<span class="lineno"></span><span class="comment" id="6149544">//&nbsp;An&nbsp;implementation&nbsp;that&nbsp;always&nbsp;returns&nbsp;&#34;&#34;&nbsp;is&nbsp;valid&nbsp;and&nbsp;may&nbsp;be&nbsp;useful&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6149619">//&nbsp;testing&nbsp;but&nbsp;it&nbsp;is&nbsp;not&nbsp;secure:&nbsp;it&nbsp;means&nbsp;that&nbsp;the&nbsp;HTTP&nbsp;server&nbsp;for&nbsp;foo.com&nbsp;can</span><br>
<span class="lineno">30</span><span class="comment" id="6149698">//&nbsp;set&nbsp;a&nbsp;cookie&nbsp;for&nbsp;bar.com.</span><br>
<span class="lineno"></span><span class="comment" id="6149727">//</span><br>
<span class="lineno"></span><span class="comment" id="6149730">//&nbsp;A&nbsp;public&nbsp;suffix&nbsp;list&nbsp;implementation&nbsp;is&nbsp;in&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="6149787">//&nbsp;golang.org/x/net/publicsuffix.</span><br>
<span class="lineno"></span><span class="keyword" id="6149821">type</span>&nbsp;<span class="ident" id="6149826">PublicSuffixList</span>&nbsp;<span class="keyword" id="6149843">interface</span>&nbsp;<span class="op" id="6149853">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6149856">//&nbsp;PublicSuffix&nbsp;returns&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;domain.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6149910">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6149914">//&nbsp;TODO:&nbsp;specify&nbsp;which&nbsp;of&nbsp;the&nbsp;caller&nbsp;and&nbsp;callee&nbsp;is&nbsp;responsible&nbsp;for&nbsp;IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6149985">//&nbsp;addresses,&nbsp;for&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;dots,&nbsp;for&nbsp;case&nbsp;sensitivity,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6150057">//&nbsp;for&nbsp;IDN/Punycode.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150079">PublicSuffix</span><span class="op" id="6150091">(</span><span class="ident" id="6150092">domain</span>&nbsp;<span class="builtintype" id="6150099">string</span><span class="op" id="6150105">)</span>&nbsp;<span class="builtintype" id="6150107">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6150116">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;source&nbsp;of&nbsp;this&nbsp;public&nbsp;suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6150185">//&nbsp;list.&nbsp;The&nbsp;description&nbsp;will&nbsp;typically&nbsp;contain&nbsp;something&nbsp;like&nbsp;a&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6150256">//&nbsp;stamp&nbsp;or&nbsp;version&nbsp;number.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150285">String</span><span class="op" id="6150291">(</span><span class="op" id="6150292">)</span>&nbsp;<span class="builtintype" id="6150294">string</span><br>
<span class="lineno"></span><span class="op" id="6150301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6150304">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;options&nbsp;for&nbsp;creating&nbsp;a&nbsp;new&nbsp;Jar.</span><br>
<span class="lineno"></span><span class="keyword" id="6150355">type</span>&nbsp;<span class="ident" id="6150360">Options</span>&nbsp;<span class="keyword" id="6150368">struct</span>&nbsp;<span class="op" id="6150375">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6150378">//&nbsp;PublicSuffixList&nbsp;is&nbsp;the&nbsp;public&nbsp;suffix&nbsp;list&nbsp;that&nbsp;determines&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6150449">//&nbsp;an&nbsp;HTTP&nbsp;server&nbsp;can&nbsp;set&nbsp;a&nbsp;cookie&nbsp;for&nbsp;a&nbsp;domain.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6150499">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6150503">//&nbsp;A&nbsp;nil&nbsp;value&nbsp;is&nbsp;valid&nbsp;and&nbsp;may&nbsp;be&nbsp;useful&nbsp;for&nbsp;testing&nbsp;but&nbsp;it&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6150572">//&nbsp;secure:&nbsp;it&nbsp;means&nbsp;that&nbsp;the&nbsp;HTTP&nbsp;server&nbsp;for&nbsp;foo.co.uk&nbsp;can&nbsp;set&nbsp;a&nbsp;cookie</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6150645">//&nbsp;for&nbsp;bar.co.uk.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150664">PublicSuffixList</span>&nbsp;<span class="ident" id="6150681">PublicSuffixList</span><br>
<span class="lineno"></span><span class="op" id="6150698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6150701">//&nbsp;Jar&nbsp;implements&nbsp;the&nbsp;http.CookieJar&nbsp;interface&nbsp;from&nbsp;the&nbsp;net/http&nbsp;package.</span><br>
<span class="lineno">60</span><span class="keyword" id="6150775">type</span>&nbsp;<span class="ident" id="6150780">Jar</span>&nbsp;<span class="keyword" id="6150784">struct</span>&nbsp;<span class="op" id="6150791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150794">psList</span>&nbsp;<span class="ident" id="6150801">PublicSuffixList</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6150820">//&nbsp;mu&nbsp;locks&nbsp;the&nbsp;remaining&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150855">mu</span>&nbsp;<span class="ident" id="6150858">sync</span><span class="op" id="6150862">.</span><span class="ident" id="6150863">Mutex</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6150871">//&nbsp;entries&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;entries,&nbsp;keyed&nbsp;by&nbsp;their&nbsp;eTLD+1&nbsp;and&nbsp;subkeyed&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6150942">//&nbsp;their&nbsp;name/domain/path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150970">entries</span>&nbsp;<span class="keyword" id="6150978">map</span><span class="op" id="6150981">[</span><span class="builtintype" id="6150982">string</span><span class="op" id="6150988">]</span><span class="keyword" id="6150989">map</span><span class="op" id="6150992">[</span><span class="builtintype" id="6150993">string</span><span class="op" id="6150999">]</span><span class="ident" id="6151000">entry</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6151008">//&nbsp;nextSeqNum&nbsp;is&nbsp;the&nbsp;next&nbsp;sequence&nbsp;number&nbsp;assigned&nbsp;to&nbsp;a&nbsp;new&nbsp;cookie</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6151076">//&nbsp;created&nbsp;SetCookies.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6151100">nextSeqNum</span>&nbsp;<span class="ident" id="6151111">uint64</span><br>
<span class="lineno"></span><span class="op" id="6151118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="6151121">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;cookie&nbsp;jar.&nbsp;A&nbsp;nil&nbsp;*Options&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;a&nbsp;zero</span><br>
<span class="lineno"></span><span class="comment" id="6151193">//&nbsp;Options.</span><br>
<span class="lineno"></span><span class="keyword" id="6151205">func</span>&nbsp;<span class="ident" id="6151210">New</span><span class="op" id="6151213">(</span><span class="ident" id="6151214">o</span>&nbsp;<span class="op" id="6151216">*</span><span class="ident" id="6151217">Options</span><span class="op" id="6151224">)</span>&nbsp;<span class="op" id="6151226">(</span><span class="op" id="6151227">*</span><span class="ident" id="6151228">Jar</span><span class="op" id="6151231">,</span>&nbsp;<span class="builtintype" id="6151233">error</span><span class="op" id="6151238">)</span>&nbsp;<span class="op" id="6151240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6151243">jar</span>&nbsp;<span class="op" id="6151247">:=</span>&nbsp;<span class="op" id="6151250">&amp;</span><span class="ident" id="6151251">Jar</span><span class="op" id="6151254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6151258">entries</span><span class="op" id="6151265">:</span>&nbsp;<span class="builtinfunc" id="6151267">make</span><span class="op" id="6151271">(</span><span class="keyword" id="6151272">map</span><span class="op" id="6151275">[</span><span class="builtintype" id="6151276">string</span><span class="op" id="6151282">]</span><span class="keyword" id="6151283">map</span><span class="op" id="6151286">[</span><span class="builtintype" id="6151287">string</span><span class="op" id="6151293">]</span><span class="ident" id="6151294">entry</span><span class="op" id="6151299">)</span><span class="op" id="6151300">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6151303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151306">if</span>&nbsp;<span class="ident" id="6151309">o</span>&nbsp;<span class="op" id="6151311">!=</span>&nbsp;<span class="ident" id="6151314">nil</span>&nbsp;<span class="op" id="6151318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6151322">jar</span><span class="op" id="6151325">.</span><span class="ident" id="6151326">psList</span>&nbsp;<span class="op" id="6151333">=</span>&nbsp;<span class="ident" id="6151335">o</span><span class="op" id="6151336">.</span><span class="ident" id="6151337">PublicSuffixList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6151355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151358">return</span>&nbsp;<span class="ident" id="6151365">jar</span><span class="op" id="6151368">,</span>&nbsp;<span class="ident" id="6151370">nil</span><br>
<span class="lineno">85</span><span class="op" id="6151374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6151377">//&nbsp;entry&nbsp;is&nbsp;the&nbsp;internal&nbsp;representation&nbsp;of&nbsp;a&nbsp;cookie.</span><br>
<span class="lineno"></span><span class="comment" id="6151430">//</span><br>
<span class="lineno"></span><span class="comment" id="6151433">//&nbsp;This&nbsp;struct&nbsp;type&nbsp;is&nbsp;not&nbsp;used&nbsp;outside&nbsp;of&nbsp;this&nbsp;package&nbsp;per&nbsp;se,&nbsp;but&nbsp;the&nbsp;exported</span><br>
<span class="lineno">90</span><span class="comment" id="6151514">//&nbsp;fields&nbsp;are&nbsp;those&nbsp;of&nbsp;RFC&nbsp;6265.</span><br>
<span class="lineno"></span><span class="keyword" id="6151547">type</span>&nbsp;<span class="ident" id="6151552">entry</span>&nbsp;<span class="keyword" id="6151558">struct</span>&nbsp;<span class="op" id="6151565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6151568">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6151579">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6151587">Value</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6151598">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6151606">Domain</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6151617">string</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6151625">Path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6151636">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6151644">Secure</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6151655">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6151661">HttpOnly</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6151672">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6151678">Persistent</span>&nbsp;<span class="builtintype" id="6151689">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6151695">HostOnly</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6151706">bool</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6151712">Expires</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6151723">time</span><span class="op" id="6151727">.</span><span class="ident" id="6151728">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6151734">Creation</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6151745">time</span><span class="op" id="6151749">.</span><span class="ident" id="6151750">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6151756">LastAccess</span>&nbsp;<span class="ident" id="6151767">time</span><span class="op" id="6151771">.</span><span class="ident" id="6151772">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6151779">//&nbsp;seqNum&nbsp;is&nbsp;a&nbsp;sequence&nbsp;number&nbsp;so&nbsp;that&nbsp;Cookies&nbsp;returns&nbsp;cookies&nbsp;in&nbsp;a</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6151848">//&nbsp;deterministic&nbsp;order,&nbsp;even&nbsp;for&nbsp;cookies&nbsp;that&nbsp;have&nbsp;equal&nbsp;Path&nbsp;length&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6151922">//&nbsp;equal&nbsp;Creation&nbsp;time.&nbsp;This&nbsp;simplifies&nbsp;testing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6151972">seqNum</span>&nbsp;<span class="ident" id="6151979">uint64</span><br>
<span class="lineno"></span><span class="op" id="6151986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="6151989">//&nbsp;Id&nbsp;returns&nbsp;the&nbsp;domain;path;name&nbsp;triple&nbsp;of&nbsp;e&nbsp;as&nbsp;an&nbsp;id.</span><br>
<span class="lineno"></span><span class="keyword" id="6152046">func</span>&nbsp;<span class="op" id="6152051">(</span><span class="ident" id="6152052">e</span>&nbsp;<span class="op" id="6152054">*</span><span class="ident" id="6152055">entry</span><span class="op" id="6152060">)</span>&nbsp;<span class="ident" id="6152062">id</span><span class="op" id="6152064">(</span><span class="op" id="6152065">)</span>&nbsp;<span class="builtintype" id="6152067">string</span>&nbsp;<span class="op" id="6152074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152077">return</span>&nbsp;<span class="ident" id="6152084">fmt</span><span class="op" id="6152087">.</span><span class="ident" id="6152088">Sprintf</span><span class="op" id="6152095">(</span><span class="string" id="6152096">&#34;%s;%s;%s&#34;</span><span class="op" id="6152106">,</span>&nbsp;<span class="ident" id="6152108">e</span><span class="op" id="6152109">.</span><span class="ident" id="6152110">Domain</span><span class="op" id="6152116">,</span>&nbsp;<span class="ident" id="6152118">e</span><span class="op" id="6152119">.</span><span class="ident" id="6152120">Path</span><span class="op" id="6152124">,</span>&nbsp;<span class="ident" id="6152126">e</span><span class="op" id="6152127">.</span><span class="ident" id="6152128">Name</span><span class="op" id="6152132">)</span><br>
<span class="lineno"></span><span class="op" id="6152134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="6152137">//&nbsp;shouldSend&nbsp;determines&nbsp;whether&nbsp;e&#39;s&nbsp;cookie&nbsp;qualifies&nbsp;to&nbsp;be&nbsp;included&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="6152211">//&nbsp;request&nbsp;to&nbsp;host/path.&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;check&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6152286">//&nbsp;cookie&nbsp;is&nbsp;expired.</span><br>
<span class="lineno"></span><span class="keyword" id="6152308">func</span>&nbsp;<span class="op" id="6152313">(</span><span class="ident" id="6152314">e</span>&nbsp;<span class="op" id="6152316">*</span><span class="ident" id="6152317">entry</span><span class="op" id="6152322">)</span>&nbsp;<span class="ident" id="6152324">shouldSend</span><span class="op" id="6152334">(</span><span class="ident" id="6152335">https</span>&nbsp;<span class="builtintype" id="6152341">bool</span><span class="op" id="6152345">,</span>&nbsp;<span class="ident" id="6152347">host</span><span class="op" id="6152351">,</span>&nbsp;<span class="ident" id="6152353">path</span>&nbsp;<span class="builtintype" id="6152358">string</span><span class="op" id="6152364">)</span>&nbsp;<span class="builtintype" id="6152366">bool</span>&nbsp;<span class="op" id="6152371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152374">return</span>&nbsp;<span class="ident" id="6152381">e</span><span class="op" id="6152382">.</span><span class="ident" id="6152383">domainMatch</span><span class="op" id="6152394">(</span><span class="ident" id="6152395">host</span><span class="op" id="6152399">)</span>&nbsp;<span class="op" id="6152401">&amp;&amp;</span>&nbsp;<span class="ident" id="6152404">e</span><span class="op" id="6152405">.</span><span class="ident" id="6152406">pathMatch</span><span class="op" id="6152415">(</span><span class="ident" id="6152416">path</span><span class="op" id="6152420">)</span>&nbsp;<span class="op" id="6152422">&amp;&amp;</span>&nbsp;<span class="op" id="6152425">(</span><span class="ident" id="6152426">https</span>&nbsp;<span class="op" id="6152432">||</span>&nbsp;<span class="op" id="6152435">!</span><span class="ident" id="6152436">e</span><span class="op" id="6152437">.</span><span class="ident" id="6152438">Secure</span><span class="op" id="6152444">)</span><br>
<span class="lineno">120</span><span class="op" id="6152446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6152449">//&nbsp;domainMatch&nbsp;implements&nbsp;&#34;domain-match&#34;&nbsp;of&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.3.</span><br>
<span class="lineno"></span><span class="keyword" id="6152517">func</span>&nbsp;<span class="op" id="6152522">(</span><span class="ident" id="6152523">e</span>&nbsp;<span class="op" id="6152525">*</span><span class="ident" id="6152526">entry</span><span class="op" id="6152531">)</span>&nbsp;<span class="ident" id="6152533">domainMatch</span><span class="op" id="6152544">(</span><span class="ident" id="6152545">host</span>&nbsp;<span class="builtintype" id="6152550">string</span><span class="op" id="6152556">)</span>&nbsp;<span class="builtintype" id="6152558">bool</span>&nbsp;<span class="op" id="6152563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152566">if</span>&nbsp;<span class="ident" id="6152569">e</span><span class="op" id="6152570">.</span><span class="ident" id="6152571">Domain</span>&nbsp;<span class="op" id="6152578">==</span>&nbsp;<span class="ident" id="6152581">host</span>&nbsp;<span class="op" id="6152586">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152590">return</span>&nbsp;<span class="builtintype" id="6152597">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6152603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152606">return</span>&nbsp;<span class="op" id="6152613">!</span><span class="ident" id="6152614">e</span><span class="op" id="6152615">.</span><span class="ident" id="6152616">HostOnly</span>&nbsp;<span class="op" id="6152625">&amp;&amp;</span>&nbsp;<span class="ident" id="6152628">hasDotSuffix</span><span class="op" id="6152640">(</span><span class="ident" id="6152641">host</span><span class="op" id="6152645">,</span>&nbsp;<span class="ident" id="6152647">e</span><span class="op" id="6152648">.</span><span class="ident" id="6152649">Domain</span><span class="op" id="6152655">)</span><br>
<span class="lineno"></span><span class="op" id="6152657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="6152660">//&nbsp;pathMatch&nbsp;implements&nbsp;&#34;path-match&#34;&nbsp;according&nbsp;to&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.4.</span><br>
<span class="lineno"></span><span class="keyword" id="6152734">func</span>&nbsp;<span class="op" id="6152739">(</span><span class="ident" id="6152740">e</span>&nbsp;<span class="op" id="6152742">*</span><span class="ident" id="6152743">entry</span><span class="op" id="6152748">)</span>&nbsp;<span class="ident" id="6152750">pathMatch</span><span class="op" id="6152759">(</span><span class="ident" id="6152760">requestPath</span>&nbsp;<span class="builtintype" id="6152772">string</span><span class="op" id="6152778">)</span>&nbsp;<span class="builtintype" id="6152780">bool</span>&nbsp;<span class="op" id="6152785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152788">if</span>&nbsp;<span class="ident" id="6152791">requestPath</span>&nbsp;<span class="op" id="6152803">==</span>&nbsp;<span class="ident" id="6152806">e</span><span class="op" id="6152807">.</span><span class="ident" id="6152808">Path</span>&nbsp;<span class="op" id="6152813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152817">return</span>&nbsp;<span class="builtintype" id="6152824">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6152830">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152833">if</span>&nbsp;<span class="ident" id="6152836">strings</span><span class="op" id="6152843">.</span><span class="ident" id="6152844">HasPrefix</span><span class="op" id="6152853">(</span><span class="ident" id="6152854">requestPath</span><span class="op" id="6152865">,</span>&nbsp;<span class="ident" id="6152867">e</span><span class="op" id="6152868">.</span><span class="ident" id="6152869">Path</span><span class="op" id="6152873">)</span>&nbsp;<span class="op" id="6152875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152879">if</span>&nbsp;<span class="ident" id="6152882">e</span><span class="op" id="6152883">.</span><span class="ident" id="6152884">Path</span><span class="op" id="6152888">[</span><span class="builtinfunc" id="6152889">len</span><span class="op" id="6152892">(</span><span class="ident" id="6152893">e</span><span class="op" id="6152894">.</span><span class="ident" id="6152895">Path</span><span class="op" id="6152899">)</span><span class="op" id="6152900">-</span><span class="num" id="6152901">1</span><span class="op" id="6152902">]</span>&nbsp;<span class="op" id="6152904">==</span>&nbsp;<span class="string" id="6152907">&#39;/&#39;</span>&nbsp;<span class="op" id="6152911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152916">return</span>&nbsp;<span class="builtintype" id="6152923">true</span>&nbsp;<span class="comment" id="6152928">//&nbsp;The&nbsp;&#34;/any/&#34;&nbsp;matches&nbsp;&#34;/any/path&#34;&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6152971">}</span>&nbsp;<span class="keyword" id="6152973">else</span>&nbsp;<span class="keyword" id="6152978">if</span>&nbsp;<span class="ident" id="6152981">requestPath</span><span class="op" id="6152992">[</span><span class="builtinfunc" id="6152993">len</span><span class="op" id="6152996">(</span><span class="ident" id="6152997">e</span><span class="op" id="6152998">.</span><span class="ident" id="6152999">Path</span><span class="op" id="6153003">)</span><span class="op" id="6153004">]</span>&nbsp;<span class="op" id="6153006">==</span>&nbsp;<span class="string" id="6153009">&#39;/&#39;</span>&nbsp;<span class="op" id="6153013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153018">return</span>&nbsp;<span class="builtintype" id="6153025">true</span>&nbsp;<span class="comment" id="6153030">//&nbsp;The&nbsp;&#34;/any&#34;&nbsp;matches&nbsp;&#34;/any/path&#34;&nbsp;case.</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6153072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6153075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153078">return</span>&nbsp;<span class="builtintype" id="6153085">false</span><br>
<span class="lineno"></span><span class="op" id="6153091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="6153094">//&nbsp;hasDotSuffix&nbsp;reports&nbsp;whether&nbsp;s&nbsp;ends&nbsp;in&nbsp;&#34;.&#34;+suffix.</span><br>
<span class="lineno"></span><span class="keyword" id="6153148">func</span>&nbsp;<span class="ident" id="6153153">hasDotSuffix</span><span class="op" id="6153165">(</span><span class="ident" id="6153166">s</span><span class="op" id="6153167">,</span>&nbsp;<span class="ident" id="6153169">suffix</span>&nbsp;<span class="builtintype" id="6153176">string</span><span class="op" id="6153182">)</span>&nbsp;<span class="builtintype" id="6153184">bool</span>&nbsp;<span class="op" id="6153189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153192">return</span>&nbsp;<span class="builtinfunc" id="6153199">len</span><span class="op" id="6153202">(</span><span class="ident" id="6153203">s</span><span class="op" id="6153204">)</span>&nbsp;<span class="op" id="6153206">&gt;</span>&nbsp;<span class="builtinfunc" id="6153208">len</span><span class="op" id="6153211">(</span><span class="ident" id="6153212">suffix</span><span class="op" id="6153218">)</span>&nbsp;<span class="op" id="6153220">&amp;&amp;</span>&nbsp;<span class="ident" id="6153223">s</span><span class="op" id="6153224">[</span><span class="builtinfunc" id="6153225">len</span><span class="op" id="6153228">(</span><span class="ident" id="6153229">s</span><span class="op" id="6153230">)</span><span class="op" id="6153231">-</span><span class="builtinfunc" id="6153232">len</span><span class="op" id="6153235">(</span><span class="ident" id="6153236">suffix</span><span class="op" id="6153242">)</span><span class="op" id="6153243">-</span><span class="num" id="6153244">1</span><span class="op" id="6153245">]</span>&nbsp;<span class="op" id="6153247">==</span>&nbsp;<span class="string" id="6153250">&#39;.&#39;</span>&nbsp;<span class="op" id="6153254">&amp;&amp;</span>&nbsp;<span class="ident" id="6153257">s</span><span class="op" id="6153258">[</span><span class="builtinfunc" id="6153259">len</span><span class="op" id="6153262">(</span><span class="ident" id="6153263">s</span><span class="op" id="6153264">)</span><span class="op" id="6153265">-</span><span class="builtinfunc" id="6153266">len</span><span class="op" id="6153269">(</span><span class="ident" id="6153270">suffix</span><span class="op" id="6153276">)</span><span class="op" id="6153277">:</span><span class="op" id="6153278">]</span>&nbsp;<span class="op" id="6153280">==</span>&nbsp;<span class="ident" id="6153283">suffix</span><br>
<span class="lineno"></span><span class="op" id="6153290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="6153293">//&nbsp;byPathLength&nbsp;is&nbsp;a&nbsp;[]entry&nbsp;sort.Interface&nbsp;that&nbsp;sorts&nbsp;according&nbsp;to&nbsp;RFC&nbsp;6265</span><br>
<span class="lineno"></span><span class="comment" id="6153370">//&nbsp;section&nbsp;5.4&nbsp;point&nbsp;2:&nbsp;by&nbsp;longest&nbsp;path&nbsp;and&nbsp;then&nbsp;by&nbsp;earliest&nbsp;creation&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="6153446">type</span>&nbsp;<span class="ident" id="6153451">byPathLength</span>&nbsp;<span class="op" id="6153464">[</span><span class="op" id="6153465">]</span><span class="ident" id="6153466">entry</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6153473">func</span>&nbsp;<span class="op" id="6153478">(</span><span class="ident" id="6153479">s</span>&nbsp;<span class="ident" id="6153481">byPathLength</span><span class="op" id="6153493">)</span>&nbsp;<span class="ident" id="6153495">Len</span><span class="op" id="6153498">(</span><span class="op" id="6153499">)</span>&nbsp;<span class="builtintype" id="6153501">int</span>&nbsp;<span class="op" id="6153505">{</span>&nbsp;<span class="keyword" id="6153507">return</span>&nbsp;<span class="builtinfunc" id="6153514">len</span><span class="op" id="6153517">(</span><span class="ident" id="6153518">s</span><span class="op" id="6153519">)</span>&nbsp;<span class="op" id="6153521">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="6153524">func</span>&nbsp;<span class="op" id="6153529">(</span><span class="ident" id="6153530">s</span>&nbsp;<span class="ident" id="6153532">byPathLength</span><span class="op" id="6153544">)</span>&nbsp;<span class="ident" id="6153546">Less</span><span class="op" id="6153550">(</span><span class="ident" id="6153551">i</span><span class="op" id="6153552">,</span>&nbsp;<span class="ident" id="6153554">j</span>&nbsp;<span class="builtintype" id="6153556">int</span><span class="op" id="6153559">)</span>&nbsp;<span class="builtintype" id="6153561">bool</span>&nbsp;<span class="op" id="6153566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153569">if</span>&nbsp;<span class="builtinfunc" id="6153572">len</span><span class="op" id="6153575">(</span><span class="ident" id="6153576">s</span><span class="op" id="6153577">[</span><span class="ident" id="6153578">i</span><span class="op" id="6153579">]</span><span class="op" id="6153580">.</span><span class="ident" id="6153581">Path</span><span class="op" id="6153585">)</span>&nbsp;<span class="op" id="6153587">!=</span>&nbsp;<span class="builtinfunc" id="6153590">len</span><span class="op" id="6153593">(</span><span class="ident" id="6153594">s</span><span class="op" id="6153595">[</span><span class="ident" id="6153596">j</span><span class="op" id="6153597">]</span><span class="op" id="6153598">.</span><span class="ident" id="6153599">Path</span><span class="op" id="6153603">)</span>&nbsp;<span class="op" id="6153605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153609">return</span>&nbsp;<span class="builtinfunc" id="6153616">len</span><span class="op" id="6153619">(</span><span class="ident" id="6153620">s</span><span class="op" id="6153621">[</span><span class="ident" id="6153622">i</span><span class="op" id="6153623">]</span><span class="op" id="6153624">.</span><span class="ident" id="6153625">Path</span><span class="op" id="6153629">)</span>&nbsp;<span class="op" id="6153631">&gt;</span>&nbsp;<span class="builtinfunc" id="6153633">len</span><span class="op" id="6153636">(</span><span class="ident" id="6153637">s</span><span class="op" id="6153638">[</span><span class="ident" id="6153639">j</span><span class="op" id="6153640">]</span><span class="op" id="6153641">.</span><span class="ident" id="6153642">Path</span><span class="op" id="6153646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6153649">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153652">if</span>&nbsp;<span class="op" id="6153655">!</span><span class="ident" id="6153656">s</span><span class="op" id="6153657">[</span><span class="ident" id="6153658">i</span><span class="op" id="6153659">]</span><span class="op" id="6153660">.</span><span class="ident" id="6153661">Creation</span><span class="op" id="6153669">.</span><span class="ident" id="6153670">Equal</span><span class="op" id="6153675">(</span><span class="ident" id="6153676">s</span><span class="op" id="6153677">[</span><span class="ident" id="6153678">j</span><span class="op" id="6153679">]</span><span class="op" id="6153680">.</span><span class="ident" id="6153681">Creation</span><span class="op" id="6153689">)</span>&nbsp;<span class="op" id="6153691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153695">return</span>&nbsp;<span class="ident" id="6153702">s</span><span class="op" id="6153703">[</span><span class="ident" id="6153704">i</span><span class="op" id="6153705">]</span><span class="op" id="6153706">.</span><span class="ident" id="6153707">Creation</span><span class="op" id="6153715">.</span><span class="ident" id="6153716">Before</span><span class="op" id="6153722">(</span><span class="ident" id="6153723">s</span><span class="op" id="6153724">[</span><span class="ident" id="6153725">j</span><span class="op" id="6153726">]</span><span class="op" id="6153727">.</span><span class="ident" id="6153728">Creation</span><span class="op" id="6153736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6153739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153742">return</span>&nbsp;<span class="ident" id="6153749">s</span><span class="op" id="6153750">[</span><span class="ident" id="6153751">i</span><span class="op" id="6153752">]</span><span class="op" id="6153753">.</span><span class="ident" id="6153754">seqNum</span>&nbsp;<span class="op" id="6153761">&lt;</span>&nbsp;<span class="ident" id="6153763">s</span><span class="op" id="6153764">[</span><span class="ident" id="6153765">j</span><span class="op" id="6153766">]</span><span class="op" id="6153767">.</span><span class="ident" id="6153768">seqNum</span><br>
<span class="lineno"></span><span class="op" id="6153775">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="6153778">func</span>&nbsp;<span class="op" id="6153783">(</span><span class="ident" id="6153784">s</span>&nbsp;<span class="ident" id="6153786">byPathLength</span><span class="op" id="6153798">)</span>&nbsp;<span class="ident" id="6153800">Swap</span><span class="op" id="6153804">(</span><span class="ident" id="6153805">i</span><span class="op" id="6153806">,</span>&nbsp;<span class="ident" id="6153808">j</span>&nbsp;<span class="builtintype" id="6153810">int</span><span class="op" id="6153813">)</span>&nbsp;<span class="op" id="6153815">{</span>&nbsp;<span class="ident" id="6153817">s</span><span class="op" id="6153818">[</span><span class="ident" id="6153819">i</span><span class="op" id="6153820">]</span><span class="op" id="6153821">,</span>&nbsp;<span class="ident" id="6153823">s</span><span class="op" id="6153824">[</span><span class="ident" id="6153825">j</span><span class="op" id="6153826">]</span>&nbsp;<span class="op" id="6153828">=</span>&nbsp;<span class="ident" id="6153830">s</span><span class="op" id="6153831">[</span><span class="ident" id="6153832">j</span><span class="op" id="6153833">]</span><span class="op" id="6153834">,</span>&nbsp;<span class="ident" id="6153836">s</span><span class="op" id="6153837">[</span><span class="ident" id="6153838">i</span><span class="op" id="6153839">]</span>&nbsp;<span class="op" id="6153841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6153844">//&nbsp;Cookies&nbsp;implements&nbsp;the&nbsp;Cookies&nbsp;method&nbsp;of&nbsp;the&nbsp;http.CookieJar&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="6153918">//</span><br>
<span class="lineno">170</span><span class="comment" id="6153921">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;empty&nbsp;slice&nbsp;if&nbsp;the&nbsp;URL&#39;s&nbsp;scheme&nbsp;is&nbsp;not&nbsp;HTTP&nbsp;or&nbsp;HTTPS.</span><br>
<span class="lineno"></span><span class="keyword" id="6153992">func</span>&nbsp;<span class="op" id="6153997">(</span><span class="ident" id="6153998">j</span>&nbsp;<span class="op" id="6154000">*</span><span class="ident" id="6154001">Jar</span><span class="op" id="6154004">)</span>&nbsp;<span class="ident" id="6154006">Cookies</span><span class="op" id="6154013">(</span><span class="ident" id="6154014">u</span>&nbsp;<span class="op" id="6154016">*</span><span class="ident" id="6154017">url</span><span class="op" id="6154020">.</span><span class="ident" id="6154021">URL</span><span class="op" id="6154024">)</span>&nbsp;<span class="op" id="6154026">(</span><span class="ident" id="6154027">cookies</span>&nbsp;<span class="op" id="6154035">[</span><span class="op" id="6154036">]</span><span class="op" id="6154037">*</span><span class="ident" id="6154038">http</span><span class="op" id="6154042">.</span><span class="ident" id="6154043">Cookie</span><span class="op" id="6154049">)</span>&nbsp;<span class="op" id="6154051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154054">return</span>&nbsp;<span class="ident" id="6154061">j</span><span class="op" id="6154062">.</span><span class="ident" id="6154063">cookies</span><span class="op" id="6154070">(</span><span class="ident" id="6154071">u</span><span class="op" id="6154072">,</span>&nbsp;<span class="ident" id="6154074">time</span><span class="op" id="6154078">.</span><span class="ident" id="6154079">Now</span><span class="op" id="6154082">(</span><span class="op" id="6154083">)</span><span class="op" id="6154084">)</span><br>
<span class="lineno"></span><span class="op" id="6154086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="6154089">//&nbsp;cookies&nbsp;is&nbsp;like&nbsp;Cookies&nbsp;but&nbsp;takes&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;a&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="keyword" id="6154159">func</span>&nbsp;<span class="op" id="6154164">(</span><span class="ident" id="6154165">j</span>&nbsp;<span class="op" id="6154167">*</span><span class="ident" id="6154168">Jar</span><span class="op" id="6154171">)</span>&nbsp;<span class="ident" id="6154173">cookies</span><span class="op" id="6154180">(</span><span class="ident" id="6154181">u</span>&nbsp;<span class="op" id="6154183">*</span><span class="ident" id="6154184">url</span><span class="op" id="6154187">.</span><span class="ident" id="6154188">URL</span><span class="op" id="6154191">,</span>&nbsp;<span class="ident" id="6154193">now</span>&nbsp;<span class="ident" id="6154197">time</span><span class="op" id="6154201">.</span><span class="ident" id="6154202">Time</span><span class="op" id="6154206">)</span>&nbsp;<span class="op" id="6154208">(</span><span class="ident" id="6154209">cookies</span>&nbsp;<span class="op" id="6154217">[</span><span class="op" id="6154218">]</span><span class="op" id="6154219">*</span><span class="ident" id="6154220">http</span><span class="op" id="6154224">.</span><span class="ident" id="6154225">Cookie</span><span class="op" id="6154231">)</span>&nbsp;<span class="op" id="6154233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154236">if</span>&nbsp;<span class="ident" id="6154239">u</span><span class="op" id="6154240">.</span><span class="ident" id="6154241">Scheme</span>&nbsp;<span class="op" id="6154248">!=</span>&nbsp;<span class="string" id="6154251">&#34;http&#34;</span>&nbsp;<span class="op" id="6154258">&amp;&amp;</span>&nbsp;<span class="ident" id="6154261">u</span><span class="op" id="6154262">.</span><span class="ident" id="6154263">Scheme</span>&nbsp;<span class="op" id="6154270">!=</span>&nbsp;<span class="string" id="6154273">&#34;https&#34;</span>&nbsp;<span class="op" id="6154281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154285">return</span>&nbsp;<span class="ident" id="6154292">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6154301">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154304">host</span><span class="op" id="6154308">,</span>&nbsp;<span class="ident" id="6154310">err</span>&nbsp;<span class="op" id="6154314">:=</span>&nbsp;<span class="ident" id="6154317">canonicalHost</span><span class="op" id="6154330">(</span><span class="ident" id="6154331">u</span><span class="op" id="6154332">.</span><span class="ident" id="6154333">Host</span><span class="op" id="6154337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154340">if</span>&nbsp;<span class="ident" id="6154343">err</span>&nbsp;<span class="op" id="6154347">!=</span>&nbsp;<span class="ident" id="6154350">nil</span>&nbsp;<span class="op" id="6154354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154358">return</span>&nbsp;<span class="ident" id="6154365">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6154374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154377">key</span>&nbsp;<span class="op" id="6154381">:=</span>&nbsp;<span class="ident" id="6154384">jarKey</span><span class="op" id="6154390">(</span><span class="ident" id="6154391">host</span><span class="op" id="6154395">,</span>&nbsp;<span class="ident" id="6154397">j</span><span class="op" id="6154398">.</span><span class="ident" id="6154399">psList</span><span class="op" id="6154405">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154409">j</span><span class="op" id="6154410">.</span><span class="ident" id="6154411">mu</span><span class="op" id="6154413">.</span><span class="ident" id="6154414">Lock</span><span class="op" id="6154418">(</span><span class="op" id="6154419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154422">defer</span>&nbsp;<span class="ident" id="6154428">j</span><span class="op" id="6154429">.</span><span class="ident" id="6154430">mu</span><span class="op" id="6154432">.</span><span class="ident" id="6154433">Unlock</span><span class="op" id="6154439">(</span><span class="op" id="6154440">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154444">submap</span>&nbsp;<span class="op" id="6154451">:=</span>&nbsp;<span class="ident" id="6154454">j</span><span class="op" id="6154455">.</span><span class="ident" id="6154456">entries</span><span class="op" id="6154463">[</span><span class="ident" id="6154464">key</span><span class="op" id="6154467">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154470">if</span>&nbsp;<span class="ident" id="6154473">submap</span>&nbsp;<span class="op" id="6154480">==</span>&nbsp;<span class="ident" id="6154483">nil</span>&nbsp;<span class="op" id="6154487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154491">return</span>&nbsp;<span class="ident" id="6154498">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6154507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154511">https</span>&nbsp;<span class="op" id="6154517">:=</span>&nbsp;<span class="ident" id="6154520">u</span><span class="op" id="6154521">.</span><span class="ident" id="6154522">Scheme</span>&nbsp;<span class="op" id="6154529">==</span>&nbsp;<span class="string" id="6154532">&#34;https&#34;</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154541">path</span>&nbsp;<span class="op" id="6154546">:=</span>&nbsp;<span class="ident" id="6154549">u</span><span class="op" id="6154550">.</span><span class="ident" id="6154551">Path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154557">if</span>&nbsp;<span class="ident" id="6154560">path</span>&nbsp;<span class="op" id="6154565">==</span>&nbsp;<span class="string" id="6154568">&#34;&#34;</span>&nbsp;<span class="op" id="6154571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154575">path</span>&nbsp;<span class="op" id="6154580">=</span>&nbsp;<span class="string" id="6154582">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6154587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154591">modified</span>&nbsp;<span class="op" id="6154600">:=</span>&nbsp;<span class="builtintype" id="6154603">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154610">var</span>&nbsp;<span class="ident" id="6154614">selected</span>&nbsp;<span class="op" id="6154623">[</span><span class="op" id="6154624">]</span><span class="ident" id="6154625">entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154632">for</span>&nbsp;<span class="ident" id="6154636">id</span><span class="op" id="6154638">,</span>&nbsp;<span class="ident" id="6154640">e</span>&nbsp;<span class="op" id="6154642">:=</span>&nbsp;<span class="keyword" id="6154645">range</span>&nbsp;<span class="ident" id="6154651">submap</span>&nbsp;<span class="op" id="6154658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154662">if</span>&nbsp;<span class="ident" id="6154665">e</span><span class="op" id="6154666">.</span><span class="ident" id="6154667">Persistent</span>&nbsp;<span class="op" id="6154678">&amp;&amp;</span>&nbsp;<span class="op" id="6154681">!</span><span class="ident" id="6154682">e</span><span class="op" id="6154683">.</span><span class="ident" id="6154684">Expires</span><span class="op" id="6154691">.</span><span class="ident" id="6154692">After</span><span class="op" id="6154697">(</span><span class="ident" id="6154698">now</span><span class="op" id="6154701">)</span>&nbsp;<span class="op" id="6154703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6154708">delete</span><span class="op" id="6154714">(</span><span class="ident" id="6154715">submap</span><span class="op" id="6154721">,</span>&nbsp;<span class="ident" id="6154723">id</span><span class="op" id="6154725">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154730">modified</span>&nbsp;<span class="op" id="6154739">=</span>&nbsp;<span class="builtintype" id="6154741">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154749">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6154760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154764">if</span>&nbsp;<span class="op" id="6154767">!</span><span class="ident" id="6154768">e</span><span class="op" id="6154769">.</span><span class="ident" id="6154770">shouldSend</span><span class="op" id="6154780">(</span><span class="ident" id="6154781">https</span><span class="op" id="6154786">,</span>&nbsp;<span class="ident" id="6154788">host</span><span class="op" id="6154792">,</span>&nbsp;<span class="ident" id="6154794">path</span><span class="op" id="6154798">)</span>&nbsp;<span class="op" id="6154800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154805">continue</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6154816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154820">e</span><span class="op" id="6154821">.</span><span class="ident" id="6154822">LastAccess</span>&nbsp;<span class="op" id="6154833">=</span>&nbsp;<span class="ident" id="6154835">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154841">submap</span><span class="op" id="6154847">[</span><span class="ident" id="6154848">id</span><span class="op" id="6154850">]</span>&nbsp;<span class="op" id="6154852">=</span>&nbsp;<span class="ident" id="6154854">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154858">selected</span>&nbsp;<span class="op" id="6154867">=</span>&nbsp;<span class="builtinfunc" id="6154869">append</span><span class="op" id="6154875">(</span><span class="ident" id="6154876">selected</span><span class="op" id="6154884">,</span>&nbsp;<span class="ident" id="6154886">e</span><span class="op" id="6154887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154891">modified</span>&nbsp;<span class="op" id="6154900">=</span>&nbsp;<span class="builtintype" id="6154902">true</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6154908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154911">if</span>&nbsp;<span class="ident" id="6154914">modified</span>&nbsp;<span class="op" id="6154923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154927">if</span>&nbsp;<span class="builtinfunc" id="6154930">len</span><span class="op" id="6154933">(</span><span class="ident" id="6154934">submap</span><span class="op" id="6154940">)</span>&nbsp;<span class="op" id="6154942">==</span>&nbsp;<span class="num" id="6154945">0</span>&nbsp;<span class="op" id="6154947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6154952">delete</span><span class="op" id="6154958">(</span><span class="ident" id="6154959">j</span><span class="op" id="6154960">.</span><span class="ident" id="6154961">entries</span><span class="op" id="6154968">,</span>&nbsp;<span class="ident" id="6154970">key</span><span class="op" id="6154973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6154977">}</span>&nbsp;<span class="keyword" id="6154979">else</span>&nbsp;<span class="op" id="6154984">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154989">j</span><span class="op" id="6154990">.</span><span class="ident" id="6154991">entries</span><span class="op" id="6154998">[</span><span class="ident" id="6154999">key</span><span class="op" id="6155002">]</span>&nbsp;<span class="op" id="6155004">=</span>&nbsp;<span class="ident" id="6155006">submap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6155015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6155018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155022">sort</span><span class="op" id="6155026">.</span><span class="ident" id="6155027">Sort</span><span class="op" id="6155031">(</span><span class="ident" id="6155032">byPathLength</span><span class="op" id="6155044">(</span><span class="ident" id="6155045">selected</span><span class="op" id="6155053">)</span><span class="op" id="6155054">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155057">for</span>&nbsp;<span class="ident" id="6155061">_</span><span class="op" id="6155062">,</span>&nbsp;<span class="ident" id="6155064">e</span>&nbsp;<span class="op" id="6155066">:=</span>&nbsp;<span class="keyword" id="6155069">range</span>&nbsp;<span class="ident" id="6155075">selected</span>&nbsp;<span class="op" id="6155084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155088">cookies</span>&nbsp;<span class="op" id="6155096">=</span>&nbsp;<span class="builtinfunc" id="6155098">append</span><span class="op" id="6155104">(</span><span class="ident" id="6155105">cookies</span><span class="op" id="6155112">,</span>&nbsp;<span class="op" id="6155114">&amp;</span><span class="ident" id="6155115">http</span><span class="op" id="6155119">.</span><span class="ident" id="6155120">Cookie</span><span class="op" id="6155126">{</span><span class="ident" id="6155127">Name</span><span class="op" id="6155131">:</span>&nbsp;<span class="ident" id="6155133">e</span><span class="op" id="6155134">.</span><span class="ident" id="6155135">Name</span><span class="op" id="6155139">,</span>&nbsp;<span class="ident" id="6155141">Value</span><span class="op" id="6155146">:</span>&nbsp;<span class="ident" id="6155148">e</span><span class="op" id="6155149">.</span><span class="ident" id="6155150">Value</span><span class="op" id="6155155">}</span><span class="op" id="6155156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6155159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155163">return</span>&nbsp;<span class="ident" id="6155170">cookies</span><br>
<span class="lineno">230</span><span class="op" id="6155178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6155181">//&nbsp;SetCookies&nbsp;implements&nbsp;the&nbsp;SetCookies&nbsp;method&nbsp;of&nbsp;the&nbsp;http.CookieJar&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="6155261">//</span><br>
<span class="lineno"></span><span class="comment" id="6155264">//&nbsp;It&nbsp;does&nbsp;nothing&nbsp;if&nbsp;the&nbsp;URL&#39;s&nbsp;scheme&nbsp;is&nbsp;not&nbsp;HTTP&nbsp;or&nbsp;HTTPS.</span><br>
<span class="lineno">235</span><span class="keyword" id="6155325">func</span>&nbsp;<span class="op" id="6155330">(</span><span class="ident" id="6155331">j</span>&nbsp;<span class="op" id="6155333">*</span><span class="ident" id="6155334">Jar</span><span class="op" id="6155337">)</span>&nbsp;<span class="ident" id="6155339">SetCookies</span><span class="op" id="6155349">(</span><span class="ident" id="6155350">u</span>&nbsp;<span class="op" id="6155352">*</span><span class="ident" id="6155353">url</span><span class="op" id="6155356">.</span><span class="ident" id="6155357">URL</span><span class="op" id="6155360">,</span>&nbsp;<span class="ident" id="6155362">cookies</span>&nbsp;<span class="op" id="6155370">[</span><span class="op" id="6155371">]</span><span class="op" id="6155372">*</span><span class="ident" id="6155373">http</span><span class="op" id="6155377">.</span><span class="ident" id="6155378">Cookie</span><span class="op" id="6155384">)</span>&nbsp;<span class="op" id="6155386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155389">j</span><span class="op" id="6155390">.</span><span class="ident" id="6155391">setCookies</span><span class="op" id="6155401">(</span><span class="ident" id="6155402">u</span><span class="op" id="6155403">,</span>&nbsp;<span class="ident" id="6155405">cookies</span><span class="op" id="6155412">,</span>&nbsp;<span class="ident" id="6155414">time</span><span class="op" id="6155418">.</span><span class="ident" id="6155419">Now</span><span class="op" id="6155422">(</span><span class="op" id="6155423">)</span><span class="op" id="6155424">)</span><br>
<span class="lineno"></span><span class="op" id="6155426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6155429">//&nbsp;setCookies&nbsp;is&nbsp;like&nbsp;SetCookies&nbsp;but&nbsp;takes&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;parameter.</span><br>
<span class="lineno">240</span><span class="keyword" id="6155503">func</span>&nbsp;<span class="op" id="6155508">(</span><span class="ident" id="6155509">j</span>&nbsp;<span class="op" id="6155511">*</span><span class="ident" id="6155512">Jar</span><span class="op" id="6155515">)</span>&nbsp;<span class="ident" id="6155517">setCookies</span><span class="op" id="6155527">(</span><span class="ident" id="6155528">u</span>&nbsp;<span class="op" id="6155530">*</span><span class="ident" id="6155531">url</span><span class="op" id="6155534">.</span><span class="ident" id="6155535">URL</span><span class="op" id="6155538">,</span>&nbsp;<span class="ident" id="6155540">cookies</span>&nbsp;<span class="op" id="6155548">[</span><span class="op" id="6155549">]</span><span class="op" id="6155550">*</span><span class="ident" id="6155551">http</span><span class="op" id="6155555">.</span><span class="ident" id="6155556">Cookie</span><span class="op" id="6155562">,</span>&nbsp;<span class="ident" id="6155564">now</span>&nbsp;<span class="ident" id="6155568">time</span><span class="op" id="6155572">.</span><span class="ident" id="6155573">Time</span><span class="op" id="6155577">)</span>&nbsp;<span class="op" id="6155579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155582">if</span>&nbsp;<span class="builtinfunc" id="6155585">len</span><span class="op" id="6155588">(</span><span class="ident" id="6155589">cookies</span><span class="op" id="6155596">)</span>&nbsp;<span class="op" id="6155598">==</span>&nbsp;<span class="num" id="6155601">0</span>&nbsp;<span class="op" id="6155603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155607">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6155615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155618">if</span>&nbsp;<span class="ident" id="6155621">u</span><span class="op" id="6155622">.</span><span class="ident" id="6155623">Scheme</span>&nbsp;<span class="op" id="6155630">!=</span>&nbsp;<span class="string" id="6155633">&#34;http&#34;</span>&nbsp;<span class="op" id="6155640">&amp;&amp;</span>&nbsp;<span class="ident" id="6155643">u</span><span class="op" id="6155644">.</span><span class="ident" id="6155645">Scheme</span>&nbsp;<span class="op" id="6155652">!=</span>&nbsp;<span class="string" id="6155655">&#34;https&#34;</span>&nbsp;<span class="op" id="6155663">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155667">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6155675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155678">host</span><span class="op" id="6155682">,</span>&nbsp;<span class="ident" id="6155684">err</span>&nbsp;<span class="op" id="6155688">:=</span>&nbsp;<span class="ident" id="6155691">canonicalHost</span><span class="op" id="6155704">(</span><span class="ident" id="6155705">u</span><span class="op" id="6155706">.</span><span class="ident" id="6155707">Host</span><span class="op" id="6155711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155714">if</span>&nbsp;<span class="ident" id="6155717">err</span>&nbsp;<span class="op" id="6155721">!=</span>&nbsp;<span class="ident" id="6155724">nil</span>&nbsp;<span class="op" id="6155728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155732">return</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6155740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155743">key</span>&nbsp;<span class="op" id="6155747">:=</span>&nbsp;<span class="ident" id="6155750">jarKey</span><span class="op" id="6155756">(</span><span class="ident" id="6155757">host</span><span class="op" id="6155761">,</span>&nbsp;<span class="ident" id="6155763">j</span><span class="op" id="6155764">.</span><span class="ident" id="6155765">psList</span><span class="op" id="6155771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155774">defPath</span>&nbsp;<span class="op" id="6155782">:=</span>&nbsp;<span class="ident" id="6155785">defaultPath</span><span class="op" id="6155796">(</span><span class="ident" id="6155797">u</span><span class="op" id="6155798">.</span><span class="ident" id="6155799">Path</span><span class="op" id="6155803">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155807">j</span><span class="op" id="6155808">.</span><span class="ident" id="6155809">mu</span><span class="op" id="6155811">.</span><span class="ident" id="6155812">Lock</span><span class="op" id="6155816">(</span><span class="op" id="6155817">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155820">defer</span>&nbsp;<span class="ident" id="6155826">j</span><span class="op" id="6155827">.</span><span class="ident" id="6155828">mu</span><span class="op" id="6155830">.</span><span class="ident" id="6155831">Unlock</span><span class="op" id="6155837">(</span><span class="op" id="6155838">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155842">submap</span>&nbsp;<span class="op" id="6155849">:=</span>&nbsp;<span class="ident" id="6155852">j</span><span class="op" id="6155853">.</span><span class="ident" id="6155854">entries</span><span class="op" id="6155861">[</span><span class="ident" id="6155862">key</span><span class="op" id="6155865">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155869">modified</span>&nbsp;<span class="op" id="6155878">:=</span>&nbsp;<span class="builtintype" id="6155881">false</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155888">for</span>&nbsp;<span class="ident" id="6155892">_</span><span class="op" id="6155893">,</span>&nbsp;<span class="ident" id="6155895">cookie</span>&nbsp;<span class="op" id="6155902">:=</span>&nbsp;<span class="keyword" id="6155905">range</span>&nbsp;<span class="ident" id="6155911">cookies</span>&nbsp;<span class="op" id="6155919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155923">e</span><span class="op" id="6155924">,</span>&nbsp;<span class="ident" id="6155926">remove</span><span class="op" id="6155932">,</span>&nbsp;<span class="ident" id="6155934">err</span>&nbsp;<span class="op" id="6155938">:=</span>&nbsp;<span class="ident" id="6155941">j</span><span class="op" id="6155942">.</span><span class="ident" id="6155943">newEntry</span><span class="op" id="6155951">(</span><span class="ident" id="6155952">cookie</span><span class="op" id="6155958">,</span>&nbsp;<span class="ident" id="6155960">now</span><span class="op" id="6155963">,</span>&nbsp;<span class="ident" id="6155965">defPath</span><span class="op" id="6155972">,</span>&nbsp;<span class="ident" id="6155974">host</span><span class="op" id="6155978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155982">if</span>&nbsp;<span class="ident" id="6155985">err</span>&nbsp;<span class="op" id="6155989">!=</span>&nbsp;<span class="ident" id="6155992">nil</span>&nbsp;<span class="op" id="6155996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6156001">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6156012">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156016">id</span>&nbsp;<span class="op" id="6156019">:=</span>&nbsp;<span class="ident" id="6156022">e</span><span class="op" id="6156023">.</span><span class="ident" id="6156024">id</span><span class="op" id="6156026">(</span><span class="op" id="6156027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6156031">if</span>&nbsp;<span class="ident" id="6156034">remove</span>&nbsp;<span class="op" id="6156041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6156046">if</span>&nbsp;<span class="ident" id="6156049">submap</span>&nbsp;<span class="op" id="6156056">!=</span>&nbsp;<span class="ident" id="6156059">nil</span>&nbsp;<span class="op" id="6156063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6156069">if</span>&nbsp;<span class="ident" id="6156072">_</span><span class="op" id="6156073">,</span>&nbsp;<span class="ident" id="6156075">ok</span>&nbsp;<span class="op" id="6156078">:=</span>&nbsp;<span class="ident" id="6156081">submap</span><span class="op" id="6156087">[</span><span class="ident" id="6156088">id</span><span class="op" id="6156090">]</span><span class="op" id="6156091">;</span>&nbsp;<span class="ident" id="6156093">ok</span>&nbsp;<span class="op" id="6156096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6156103">delete</span><span class="op" id="6156109">(</span><span class="ident" id="6156110">submap</span><span class="op" id="6156116">,</span>&nbsp;<span class="ident" id="6156118">id</span><span class="op" id="6156120">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156127">modified</span>&nbsp;<span class="op" id="6156136">=</span>&nbsp;<span class="builtintype" id="6156138">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6156147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6156152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6156157">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6156168">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6156172">if</span>&nbsp;<span class="ident" id="6156175">submap</span>&nbsp;<span class="op" id="6156182">==</span>&nbsp;<span class="ident" id="6156185">nil</span>&nbsp;<span class="op" id="6156189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156194">submap</span>&nbsp;<span class="op" id="6156201">=</span>&nbsp;<span class="builtinfunc" id="6156203">make</span><span class="op" id="6156207">(</span><span class="keyword" id="6156208">map</span><span class="op" id="6156211">[</span><span class="builtintype" id="6156212">string</span><span class="op" id="6156218">]</span><span class="ident" id="6156219">entry</span><span class="op" id="6156224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6156228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6156233">if</span>&nbsp;<span class="ident" id="6156236">old</span><span class="op" id="6156239">,</span>&nbsp;<span class="ident" id="6156241">ok</span>&nbsp;<span class="op" id="6156244">:=</span>&nbsp;<span class="ident" id="6156247">submap</span><span class="op" id="6156253">[</span><span class="ident" id="6156254">id</span><span class="op" id="6156256">]</span><span class="op" id="6156257">;</span>&nbsp;<span class="ident" id="6156259">ok</span>&nbsp;<span class="op" id="6156262">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156267">e</span><span class="op" id="6156268">.</span><span class="ident" id="6156269">Creation</span>&nbsp;<span class="op" id="6156278">=</span>&nbsp;<span class="ident" id="6156280">old</span><span class="op" id="6156283">.</span><span class="ident" id="6156284">Creation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156296">e</span><span class="op" id="6156297">.</span><span class="ident" id="6156298">seqNum</span>&nbsp;<span class="op" id="6156305">=</span>&nbsp;<span class="ident" id="6156307">old</span><span class="op" id="6156310">.</span><span class="ident" id="6156311">seqNum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6156320">}</span>&nbsp;<span class="keyword" id="6156322">else</span>&nbsp;<span class="op" id="6156327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156332">e</span><span class="op" id="6156333">.</span><span class="ident" id="6156334">Creation</span>&nbsp;<span class="op" id="6156343">=</span>&nbsp;<span class="ident" id="6156345">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156352">e</span><span class="op" id="6156353">.</span><span class="ident" id="6156354">seqNum</span>&nbsp;<span class="op" id="6156361">=</span>&nbsp;<span class="ident" id="6156363">j</span><span class="op" id="6156364">.</span><span class="ident" id="6156365">nextSeqNum</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156379">j</span><span class="op" id="6156380">.</span><span class="ident" id="6156381">nextSeqNum</span><span class="op" id="6156391">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6156396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156400">e</span><span class="op" id="6156401">.</span><span class="ident" id="6156402">LastAccess</span>&nbsp;<span class="op" id="6156413">=</span>&nbsp;<span class="ident" id="6156415">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156421">submap</span><span class="op" id="6156427">[</span><span class="ident" id="6156428">id</span><span class="op" id="6156430">]</span>&nbsp;<span class="op" id="6156432">=</span>&nbsp;<span class="ident" id="6156434">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156438">modified</span>&nbsp;<span class="op" id="6156447">=</span>&nbsp;<span class="builtintype" id="6156449">true</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6156455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6156459">if</span>&nbsp;<span class="ident" id="6156462">modified</span>&nbsp;<span class="op" id="6156471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6156475">if</span>&nbsp;<span class="builtinfunc" id="6156478">len</span><span class="op" id="6156481">(</span><span class="ident" id="6156482">submap</span><span class="op" id="6156488">)</span>&nbsp;<span class="op" id="6156490">==</span>&nbsp;<span class="num" id="6156493">0</span>&nbsp;<span class="op" id="6156495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6156500">delete</span><span class="op" id="6156506">(</span><span class="ident" id="6156507">j</span><span class="op" id="6156508">.</span><span class="ident" id="6156509">entries</span><span class="op" id="6156516">,</span>&nbsp;<span class="ident" id="6156518">key</span><span class="op" id="6156521">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6156525">}</span>&nbsp;<span class="keyword" id="6156527">else</span>&nbsp;<span class="op" id="6156532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156537">j</span><span class="op" id="6156538">.</span><span class="ident" id="6156539">entries</span><span class="op" id="6156546">[</span><span class="ident" id="6156547">key</span><span class="op" id="6156550">]</span>&nbsp;<span class="op" id="6156552">=</span>&nbsp;<span class="ident" id="6156554">submap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6156563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6156566">}</span><br>
<span class="lineno"></span><span class="op" id="6156568">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="comment" id="6156571">//&nbsp;canonicalHost&nbsp;strips&nbsp;port&nbsp;from&nbsp;host&nbsp;if&nbsp;present&nbsp;and&nbsp;returns&nbsp;the&nbsp;canonicalized</span><br>
<span class="lineno"></span><span class="comment" id="6156651">//&nbsp;host&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="6156665">func</span>&nbsp;<span class="ident" id="6156670">canonicalHost</span><span class="op" id="6156683">(</span><span class="ident" id="6156684">host</span>&nbsp;<span class="builtintype" id="6156689">string</span><span class="op" id="6156695">)</span>&nbsp;<span class="op" id="6156697">(</span><span class="builtintype" id="6156698">string</span><span class="op" id="6156704">,</span>&nbsp;<span class="builtintype" id="6156706">error</span><span class="op" id="6156711">)</span>&nbsp;<span class="op" id="6156713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6156716">var</span>&nbsp;<span class="ident" id="6156720">err</span>&nbsp;<span class="builtintype" id="6156724">error</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156731">host</span>&nbsp;<span class="op" id="6156736">=</span>&nbsp;<span class="ident" id="6156738">strings</span><span class="op" id="6156745">.</span><span class="ident" id="6156746">ToLower</span><span class="op" id="6156753">(</span><span class="ident" id="6156754">host</span><span class="op" id="6156758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6156761">if</span>&nbsp;<span class="ident" id="6156764">hasPort</span><span class="op" id="6156771">(</span><span class="ident" id="6156772">host</span><span class="op" id="6156776">)</span>&nbsp;<span class="op" id="6156778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156782">host</span><span class="op" id="6156786">,</span>&nbsp;<span class="ident" id="6156788">_</span><span class="op" id="6156789">,</span>&nbsp;<span class="ident" id="6156791">err</span>&nbsp;<span class="op" id="6156795">=</span>&nbsp;<span class="ident" id="6156797">net</span><span class="op" id="6156800">.</span><span class="ident" id="6156801">SplitHostPort</span><span class="op" id="6156814">(</span><span class="ident" id="6156815">host</span><span class="op" id="6156819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6156823">if</span>&nbsp;<span class="ident" id="6156826">err</span>&nbsp;<span class="op" id="6156830">!=</span>&nbsp;<span class="ident" id="6156833">nil</span>&nbsp;<span class="op" id="6156837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6156842">return</span>&nbsp;<span class="string" id="6156849">&#34;&#34;</span><span class="op" id="6156851">,</span>&nbsp;<span class="ident" id="6156853">err</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6156859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6156862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6156865">if</span>&nbsp;<span class="ident" id="6156868">strings</span><span class="op" id="6156875">.</span><span class="ident" id="6156876">HasSuffix</span><span class="op" id="6156885">(</span><span class="ident" id="6156886">host</span><span class="op" id="6156890">,</span>&nbsp;<span class="string" id="6156892">&#34;.&#34;</span><span class="op" id="6156895">)</span>&nbsp;<span class="op" id="6156897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6156901">//&nbsp;Strip&nbsp;trailing&nbsp;dot&nbsp;from&nbsp;fully&nbsp;qualified&nbsp;domain&nbsp;names.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156960">host</span>&nbsp;<span class="op" id="6156965">=</span>&nbsp;<span class="ident" id="6156967">host</span><span class="op" id="6156971">[</span><span class="op" id="6156972">:</span><span class="builtinfunc" id="6156973">len</span><span class="op" id="6156976">(</span><span class="ident" id="6156977">host</span><span class="op" id="6156981">)</span><span class="op" id="6156982">-</span><span class="num" id="6156983">1</span><span class="op" id="6156984">]</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6156987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6156990">return</span>&nbsp;<span class="ident" id="6156997">toASCII</span><span class="op" id="6157004">(</span><span class="ident" id="6157005">host</span><span class="op" id="6157009">)</span><br>
<span class="lineno"></span><span class="op" id="6157011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6157014">//&nbsp;hasPort&nbsp;reports&nbsp;whether&nbsp;host&nbsp;contains&nbsp;a&nbsp;port&nbsp;number.&nbsp;host&nbsp;may&nbsp;be&nbsp;a&nbsp;host</span><br>
<span class="lineno">320</span><span class="comment" id="6157089">//&nbsp;name,&nbsp;an&nbsp;IPv4&nbsp;or&nbsp;an&nbsp;IPv6&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="6157126">func</span>&nbsp;<span class="ident" id="6157131">hasPort</span><span class="op" id="6157138">(</span><span class="ident" id="6157139">host</span>&nbsp;<span class="builtintype" id="6157144">string</span><span class="op" id="6157150">)</span>&nbsp;<span class="builtintype" id="6157152">bool</span>&nbsp;<span class="op" id="6157157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157160">colons</span>&nbsp;<span class="op" id="6157167">:=</span>&nbsp;<span class="ident" id="6157170">strings</span><span class="op" id="6157177">.</span><span class="ident" id="6157178">Count</span><span class="op" id="6157183">(</span><span class="ident" id="6157184">host</span><span class="op" id="6157188">,</span>&nbsp;<span class="string" id="6157190">&#34;:&#34;</span><span class="op" id="6157193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157196">if</span>&nbsp;<span class="ident" id="6157199">colons</span>&nbsp;<span class="op" id="6157206">==</span>&nbsp;<span class="num" id="6157209">0</span>&nbsp;<span class="op" id="6157211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157215">return</span>&nbsp;<span class="builtintype" id="6157222">false</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6157229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157232">if</span>&nbsp;<span class="ident" id="6157235">colons</span>&nbsp;<span class="op" id="6157242">==</span>&nbsp;<span class="num" id="6157245">1</span>&nbsp;<span class="op" id="6157247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157251">return</span>&nbsp;<span class="builtintype" id="6157258">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6157264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157267">return</span>&nbsp;<span class="ident" id="6157274">host</span><span class="op" id="6157278">[</span><span class="num" id="6157279">0</span><span class="op" id="6157280">]</span>&nbsp;<span class="op" id="6157282">==</span>&nbsp;<span class="string" id="6157285">&#39;[&#39;</span>&nbsp;<span class="op" id="6157289">&amp;&amp;</span>&nbsp;<span class="ident" id="6157292">strings</span><span class="op" id="6157299">.</span><span class="ident" id="6157300">Contains</span><span class="op" id="6157308">(</span><span class="ident" id="6157309">host</span><span class="op" id="6157313">,</span>&nbsp;<span class="string" id="6157315">&#34;]:&#34;</span><span class="op" id="6157319">)</span><br>
<span class="lineno">330</span><span class="op" id="6157321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6157324">//&nbsp;jarKey&nbsp;returns&nbsp;the&nbsp;key&nbsp;to&nbsp;use&nbsp;for&nbsp;a&nbsp;jar.</span><br>
<span class="lineno"></span><span class="keyword" id="6157368">func</span>&nbsp;<span class="ident" id="6157373">jarKey</span><span class="op" id="6157379">(</span><span class="ident" id="6157380">host</span>&nbsp;<span class="builtintype" id="6157385">string</span><span class="op" id="6157391">,</span>&nbsp;<span class="ident" id="6157393">psl</span>&nbsp;<span class="ident" id="6157397">PublicSuffixList</span><span class="op" id="6157413">)</span>&nbsp;<span class="builtintype" id="6157415">string</span>&nbsp;<span class="op" id="6157422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157425">if</span>&nbsp;<span class="ident" id="6157428">isIP</span><span class="op" id="6157432">(</span><span class="ident" id="6157433">host</span><span class="op" id="6157437">)</span>&nbsp;<span class="op" id="6157439">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157443">return</span>&nbsp;<span class="ident" id="6157450">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6157456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157460">var</span>&nbsp;<span class="ident" id="6157464">i</span>&nbsp;<span class="builtintype" id="6157466">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157471">if</span>&nbsp;<span class="ident" id="6157474">psl</span>&nbsp;<span class="op" id="6157478">==</span>&nbsp;<span class="ident" id="6157481">nil</span>&nbsp;<span class="op" id="6157485">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157489">i</span>&nbsp;<span class="op" id="6157491">=</span>&nbsp;<span class="ident" id="6157493">strings</span><span class="op" id="6157500">.</span><span class="ident" id="6157501">LastIndex</span><span class="op" id="6157510">(</span><span class="ident" id="6157511">host</span><span class="op" id="6157515">,</span>&nbsp;<span class="string" id="6157517">&#34;.&#34;</span><span class="op" id="6157520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157524">if</span>&nbsp;<span class="ident" id="6157527">i</span>&nbsp;<span class="op" id="6157529">==</span>&nbsp;<span class="op" id="6157532">-</span><span class="num" id="6157533">1</span>&nbsp;<span class="op" id="6157535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157540">return</span>&nbsp;<span class="ident" id="6157547">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6157554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6157557">}</span>&nbsp;<span class="keyword" id="6157559">else</span>&nbsp;<span class="op" id="6157564">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157568">suffix</span>&nbsp;<span class="op" id="6157575">:=</span>&nbsp;<span class="ident" id="6157578">psl</span><span class="op" id="6157581">.</span><span class="ident" id="6157582">PublicSuffix</span><span class="op" id="6157594">(</span><span class="ident" id="6157595">host</span><span class="op" id="6157599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157603">if</span>&nbsp;<span class="ident" id="6157606">suffix</span>&nbsp;<span class="op" id="6157613">==</span>&nbsp;<span class="ident" id="6157616">host</span>&nbsp;<span class="op" id="6157621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157626">return</span>&nbsp;<span class="ident" id="6157633">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6157640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157644">i</span>&nbsp;<span class="op" id="6157646">=</span>&nbsp;<span class="builtinfunc" id="6157648">len</span><span class="op" id="6157651">(</span><span class="ident" id="6157652">host</span><span class="op" id="6157656">)</span>&nbsp;<span class="op" id="6157658">-</span>&nbsp;<span class="builtinfunc" id="6157660">len</span><span class="op" id="6157663">(</span><span class="ident" id="6157664">suffix</span><span class="op" id="6157670">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157674">if</span>&nbsp;<span class="ident" id="6157677">i</span>&nbsp;<span class="op" id="6157679">&lt;=</span>&nbsp;<span class="num" id="6157682">0</span>&nbsp;<span class="op" id="6157684">||</span>&nbsp;<span class="ident" id="6157687">host</span><span class="op" id="6157691">[</span><span class="ident" id="6157692">i</span><span class="op" id="6157693">-</span><span class="num" id="6157694">1</span><span class="op" id="6157695">]</span>&nbsp;<span class="op" id="6157697">!=</span>&nbsp;<span class="string" id="6157700">&#39;.&#39;</span>&nbsp;<span class="op" id="6157704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6157709">//&nbsp;The&nbsp;provided&nbsp;public&nbsp;suffix&nbsp;list&nbsp;psl&nbsp;is&nbsp;broken.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6157762">//&nbsp;Storing&nbsp;cookies&nbsp;under&nbsp;host&nbsp;is&nbsp;a&nbsp;safe&nbsp;stopgap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157814">return</span>&nbsp;<span class="ident" id="6157821">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6157828">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6157831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157834">prevDot</span>&nbsp;<span class="op" id="6157842">:=</span>&nbsp;<span class="ident" id="6157845">strings</span><span class="op" id="6157852">.</span><span class="ident" id="6157853">LastIndex</span><span class="op" id="6157862">(</span><span class="ident" id="6157863">host</span><span class="op" id="6157867">[</span><span class="op" id="6157868">:</span><span class="ident" id="6157869">i</span><span class="op" id="6157870">-</span><span class="num" id="6157871">1</span><span class="op" id="6157872">]</span><span class="op" id="6157873">,</span>&nbsp;<span class="string" id="6157875">&#34;.&#34;</span><span class="op" id="6157878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157881">return</span>&nbsp;<span class="ident" id="6157888">host</span><span class="op" id="6157892">[</span><span class="ident" id="6157893">prevDot</span><span class="op" id="6157900">+</span><span class="num" id="6157901">1</span><span class="op" id="6157902">:</span><span class="op" id="6157903">]</span><br>
<span class="lineno"></span><span class="op" id="6157905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="comment" id="6157908">//&nbsp;isIP&nbsp;reports&nbsp;whether&nbsp;host&nbsp;is&nbsp;an&nbsp;IP&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="6157955">func</span>&nbsp;<span class="ident" id="6157960">isIP</span><span class="op" id="6157964">(</span><span class="ident" id="6157965">host</span>&nbsp;<span class="builtintype" id="6157970">string</span><span class="op" id="6157976">)</span>&nbsp;<span class="builtintype" id="6157978">bool</span>&nbsp;<span class="op" id="6157983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157986">return</span>&nbsp;<span class="ident" id="6157993">net</span><span class="op" id="6157996">.</span><span class="ident" id="6157997">ParseIP</span><span class="op" id="6158004">(</span><span class="ident" id="6158005">host</span><span class="op" id="6158009">)</span>&nbsp;<span class="op" id="6158011">!=</span>&nbsp;<span class="ident" id="6158014">nil</span><br>
<span class="lineno"></span><span class="op" id="6158018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="6158021">//&nbsp;defaultPath&nbsp;returns&nbsp;the&nbsp;directory&nbsp;part&nbsp;of&nbsp;an&nbsp;URL&#39;s&nbsp;path&nbsp;according&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6158093">//&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.4.</span><br>
<span class="lineno"></span><span class="keyword" id="6158120">func</span>&nbsp;<span class="ident" id="6158125">defaultPath</span><span class="op" id="6158136">(</span><span class="ident" id="6158137">path</span>&nbsp;<span class="builtintype" id="6158142">string</span><span class="op" id="6158148">)</span>&nbsp;<span class="builtintype" id="6158150">string</span>&nbsp;<span class="op" id="6158157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6158160">if</span>&nbsp;<span class="builtinfunc" id="6158163">len</span><span class="op" id="6158166">(</span><span class="ident" id="6158167">path</span><span class="op" id="6158171">)</span>&nbsp;<span class="op" id="6158173">==</span>&nbsp;<span class="num" id="6158176">0</span>&nbsp;<span class="op" id="6158178">||</span>&nbsp;<span class="ident" id="6158181">path</span><span class="op" id="6158185">[</span><span class="num" id="6158186">0</span><span class="op" id="6158187">]</span>&nbsp;<span class="op" id="6158189">!=</span>&nbsp;<span class="string" id="6158192">&#39;/&#39;</span>&nbsp;<span class="op" id="6158196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6158200">return</span>&nbsp;<span class="string" id="6158207">&#34;/&#34;</span>&nbsp;<span class="comment" id="6158211">//&nbsp;Path&nbsp;is&nbsp;empty&nbsp;or&nbsp;malformed.</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6158243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6158247">i</span>&nbsp;<span class="op" id="6158249">:=</span>&nbsp;<span class="ident" id="6158252">strings</span><span class="op" id="6158259">.</span><span class="ident" id="6158260">LastIndex</span><span class="op" id="6158269">(</span><span class="ident" id="6158270">path</span><span class="op" id="6158274">,</span>&nbsp;<span class="string" id="6158276">&#34;/&#34;</span><span class="op" id="6158279">)</span>&nbsp;<span class="comment" id="6158281">//&nbsp;Path&nbsp;starts&nbsp;with&nbsp;&#34;/&#34;,&nbsp;so&nbsp;i&nbsp;!=&nbsp;-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6158319">if</span>&nbsp;<span class="ident" id="6158322">i</span>&nbsp;<span class="op" id="6158324">==</span>&nbsp;<span class="num" id="6158327">0</span>&nbsp;<span class="op" id="6158329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6158333">return</span>&nbsp;<span class="string" id="6158340">&#34;/&#34;</span>&nbsp;<span class="comment" id="6158344">//&nbsp;Path&nbsp;has&nbsp;the&nbsp;form&nbsp;&#34;/abc&#34;.</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6158374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6158377">return</span>&nbsp;<span class="ident" id="6158384">path</span><span class="op" id="6158388">[</span><span class="op" id="6158389">:</span><span class="ident" id="6158390">i</span><span class="op" id="6158391">]</span>&nbsp;<span class="comment" id="6158393">//&nbsp;Path&nbsp;is&nbsp;either&nbsp;of&nbsp;form&nbsp;&#34;/abc/xyz&#34;&nbsp;or&nbsp;&#34;/abc/xyz/&#34;.</span><br>
<span class="lineno"></span><span class="op" id="6158446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6158449">//&nbsp;newEntry&nbsp;creates&nbsp;an&nbsp;entry&nbsp;from&nbsp;a&nbsp;http.Cookie&nbsp;c.&nbsp;now&nbsp;is&nbsp;the&nbsp;current&nbsp;time&nbsp;and</span><br>
<span class="lineno">380</span><span class="comment" id="6158528">//&nbsp;is&nbsp;compared&nbsp;to&nbsp;c.Expires&nbsp;to&nbsp;determine&nbsp;deletion&nbsp;of&nbsp;c.&nbsp;defPath&nbsp;and&nbsp;host&nbsp;are&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6158609">//&nbsp;default-path&nbsp;and&nbsp;the&nbsp;canonical&nbsp;host&nbsp;name&nbsp;of&nbsp;the&nbsp;URL&nbsp;c&nbsp;was&nbsp;received&nbsp;from.</span><br>
<span class="lineno"></span><span class="comment" id="6158685">//</span><br>
<span class="lineno"></span><span class="comment" id="6158688">//&nbsp;remove&nbsp;records&nbsp;whether&nbsp;the&nbsp;jar&nbsp;should&nbsp;delete&nbsp;this&nbsp;cookie,&nbsp;as&nbsp;it&nbsp;has&nbsp;already</span><br>
<span class="lineno"></span><span class="comment" id="6158767">//&nbsp;expired&nbsp;with&nbsp;respect&nbsp;to&nbsp;now.&nbsp;In&nbsp;this&nbsp;case,&nbsp;e&nbsp;may&nbsp;be&nbsp;incomplete,&nbsp;but&nbsp;it&nbsp;will</span><br>
<span class="lineno">385</span><span class="comment" id="6158846">//&nbsp;be&nbsp;valid&nbsp;to&nbsp;call&nbsp;e.id&nbsp;(which&nbsp;depends&nbsp;on&nbsp;e&#39;s&nbsp;Name,&nbsp;Domain&nbsp;and&nbsp;Path).</span><br>
<span class="lineno"></span><span class="comment" id="6158917">//</span><br>
<span class="lineno"></span><span class="comment" id="6158920">//&nbsp;A&nbsp;malformed&nbsp;c.Domain&nbsp;will&nbsp;result&nbsp;in&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="6158969">func</span>&nbsp;<span class="op" id="6158974">(</span><span class="ident" id="6158975">j</span>&nbsp;<span class="op" id="6158977">*</span><span class="ident" id="6158978">Jar</span><span class="op" id="6158981">)</span>&nbsp;<span class="ident" id="6158983">newEntry</span><span class="op" id="6158991">(</span><span class="ident" id="6158992">c</span>&nbsp;<span class="op" id="6158994">*</span><span class="ident" id="6158995">http</span><span class="op" id="6158999">.</span><span class="ident" id="6159000">Cookie</span><span class="op" id="6159006">,</span>&nbsp;<span class="ident" id="6159008">now</span>&nbsp;<span class="ident" id="6159012">time</span><span class="op" id="6159016">.</span><span class="ident" id="6159017">Time</span><span class="op" id="6159021">,</span>&nbsp;<span class="ident" id="6159023">defPath</span><span class="op" id="6159030">,</span>&nbsp;<span class="ident" id="6159032">host</span>&nbsp;<span class="builtintype" id="6159037">string</span><span class="op" id="6159043">)</span>&nbsp;<span class="op" id="6159045">(</span><span class="ident" id="6159046">e</span>&nbsp;<span class="ident" id="6159048">entry</span><span class="op" id="6159053">,</span>&nbsp;<span class="ident" id="6159055">remove</span>&nbsp;<span class="builtintype" id="6159062">bool</span><span class="op" id="6159066">,</span>&nbsp;<span class="ident" id="6159068">err</span>&nbsp;<span class="builtintype" id="6159072">error</span><span class="op" id="6159077">)</span>&nbsp;<span class="op" id="6159079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6159082">e</span><span class="op" id="6159083">.</span><span class="ident" id="6159084">Name</span>&nbsp;<span class="op" id="6159089">=</span>&nbsp;<span class="ident" id="6159091">c</span><span class="op" id="6159092">.</span><span class="ident" id="6159093">Name</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6159100">if</span>&nbsp;<span class="ident" id="6159103">c</span><span class="op" id="6159104">.</span><span class="ident" id="6159105">Path</span>&nbsp;<span class="op" id="6159110">==</span>&nbsp;<span class="string" id="6159113">&#34;&#34;</span>&nbsp;<span class="op" id="6159116">||</span>&nbsp;<span class="ident" id="6159119">c</span><span class="op" id="6159120">.</span><span class="ident" id="6159121">Path</span><span class="op" id="6159125">[</span><span class="num" id="6159126">0</span><span class="op" id="6159127">]</span>&nbsp;<span class="op" id="6159129">!=</span>&nbsp;<span class="string" id="6159132">&#39;/&#39;</span>&nbsp;<span class="op" id="6159136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6159140">e</span><span class="op" id="6159141">.</span><span class="ident" id="6159142">Path</span>&nbsp;<span class="op" id="6159147">=</span>&nbsp;<span class="ident" id="6159149">defPath</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6159158">}</span>&nbsp;<span class="keyword" id="6159160">else</span>&nbsp;<span class="op" id="6159165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6159169">e</span><span class="op" id="6159170">.</span><span class="ident" id="6159171">Path</span>&nbsp;<span class="op" id="6159176">=</span>&nbsp;<span class="ident" id="6159178">c</span><span class="op" id="6159179">.</span><span class="ident" id="6159180">Path</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6159186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6159190">e</span><span class="op" id="6159191">.</span><span class="ident" id="6159192">Domain</span><span class="op" id="6159198">,</span>&nbsp;<span class="ident" id="6159200">e</span><span class="op" id="6159201">.</span><span class="ident" id="6159202">HostOnly</span><span class="op" id="6159210">,</span>&nbsp;<span class="ident" id="6159212">err</span>&nbsp;<span class="op" id="6159216">=</span>&nbsp;<span class="ident" id="6159218">j</span><span class="op" id="6159219">.</span><span class="ident" id="6159220">domainAndType</span><span class="op" id="6159233">(</span><span class="ident" id="6159234">host</span><span class="op" id="6159238">,</span>&nbsp;<span class="ident" id="6159240">c</span><span class="op" id="6159241">.</span><span class="ident" id="6159242">Domain</span><span class="op" id="6159248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6159251">if</span>&nbsp;<span class="ident" id="6159254">err</span>&nbsp;<span class="op" id="6159258">!=</span>&nbsp;<span class="ident" id="6159261">nil</span>&nbsp;<span class="op" id="6159265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6159269">return</span>&nbsp;<span class="ident" id="6159276">e</span><span class="op" id="6159277">,</span>&nbsp;<span class="builtintype" id="6159279">false</span><span class="op" id="6159284">,</span>&nbsp;<span class="ident" id="6159286">err</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6159291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6159295">//&nbsp;MaxAge&nbsp;takes&nbsp;precedence&nbsp;over&nbsp;Expires.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6159337">if</span>&nbsp;<span class="ident" id="6159340">c</span><span class="op" id="6159341">.</span><span class="ident" id="6159342">MaxAge</span>&nbsp;<span class="op" id="6159349">&lt;</span>&nbsp;<span class="num" id="6159351">0</span>&nbsp;<span class="op" id="6159353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6159357">return</span>&nbsp;<span class="ident" id="6159364">e</span><span class="op" id="6159365">,</span>&nbsp;<span class="builtintype" id="6159367">true</span><span class="op" id="6159371">,</span>&nbsp;<span class="ident" id="6159373">nil</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6159378">}</span>&nbsp;<span class="keyword" id="6159380">else</span>&nbsp;<span class="keyword" id="6159385">if</span>&nbsp;<span class="ident" id="6159388">c</span><span class="op" id="6159389">.</span><span class="ident" id="6159390">MaxAge</span>&nbsp;<span class="op" id="6159397">&gt;</span>&nbsp;<span class="num" id="6159399">0</span>&nbsp;<span class="op" id="6159401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6159405">e</span><span class="op" id="6159406">.</span><span class="ident" id="6159407">Expires</span>&nbsp;<span class="op" id="6159415">=</span>&nbsp;<span class="ident" id="6159417">now</span><span class="op" id="6159420">.</span><span class="ident" id="6159421">Add</span><span class="op" id="6159424">(</span><span class="ident" id="6159425">time</span><span class="op" id="6159429">.</span><span class="ident" id="6159430">Duration</span><span class="op" id="6159438">(</span><span class="ident" id="6159439">c</span><span class="op" id="6159440">.</span><span class="ident" id="6159441">MaxAge</span><span class="op" id="6159447">)</span>&nbsp;<span class="op" id="6159449">*</span>&nbsp;<span class="ident" id="6159451">time</span><span class="op" id="6159455">.</span><span class="ident" id="6159456">Second</span><span class="op" id="6159462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6159466">e</span><span class="op" id="6159467">.</span><span class="ident" id="6159468">Persistent</span>&nbsp;<span class="op" id="6159479">=</span>&nbsp;<span class="builtintype" id="6159481">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6159487">}</span>&nbsp;<span class="keyword" id="6159489">else</span>&nbsp;<span class="op" id="6159494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6159498">if</span>&nbsp;<span class="ident" id="6159501">c</span><span class="op" id="6159502">.</span><span class="ident" id="6159503">Expires</span><span class="op" id="6159510">.</span><span class="ident" id="6159511">IsZero</span><span class="op" id="6159517">(</span><span class="op" id="6159518">)</span>&nbsp;<span class="op" id="6159520">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6159525">e</span><span class="op" id="6159526">.</span><span class="ident" id="6159527">Expires</span>&nbsp;<span class="op" id="6159535">=</span>&nbsp;<span class="ident" id="6159537">endOfTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6159550">e</span><span class="op" id="6159551">.</span><span class="ident" id="6159552">Persistent</span>&nbsp;<span class="op" id="6159563">=</span>&nbsp;<span class="builtintype" id="6159565">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6159573">}</span>&nbsp;<span class="keyword" id="6159575">else</span>&nbsp;<span class="op" id="6159580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6159585">if</span>&nbsp;<span class="op" id="6159588">!</span><span class="ident" id="6159589">c</span><span class="op" id="6159590">.</span><span class="ident" id="6159591">Expires</span><span class="op" id="6159598">.</span><span class="ident" id="6159599">After</span><span class="op" id="6159604">(</span><span class="ident" id="6159605">now</span><span class="op" id="6159608">)</span>&nbsp;<span class="op" id="6159610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6159616">return</span>&nbsp;<span class="ident" id="6159623">e</span><span class="op" id="6159624">,</span>&nbsp;<span class="builtintype" id="6159626">true</span><span class="op" id="6159630">,</span>&nbsp;<span class="ident" id="6159632">nil</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6159639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6159644">e</span><span class="op" id="6159645">.</span><span class="ident" id="6159646">Expires</span>&nbsp;<span class="op" id="6159654">=</span>&nbsp;<span class="ident" id="6159656">c</span><span class="op" id="6159657">.</span><span class="ident" id="6159658">Expires</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6159669">e</span><span class="op" id="6159670">.</span><span class="ident" id="6159671">Persistent</span>&nbsp;<span class="op" id="6159682">=</span>&nbsp;<span class="builtintype" id="6159684">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6159691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6159694">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6159698">e</span><span class="op" id="6159699">.</span><span class="ident" id="6159700">Value</span>&nbsp;<span class="op" id="6159706">=</span>&nbsp;<span class="ident" id="6159708">c</span><span class="op" id="6159709">.</span><span class="ident" id="6159710">Value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6159717">e</span><span class="op" id="6159718">.</span><span class="ident" id="6159719">Secure</span>&nbsp;<span class="op" id="6159726">=</span>&nbsp;<span class="ident" id="6159728">c</span><span class="op" id="6159729">.</span><span class="ident" id="6159730">Secure</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6159738">e</span><span class="op" id="6159739">.</span><span class="ident" id="6159740">HttpOnly</span>&nbsp;<span class="op" id="6159749">=</span>&nbsp;<span class="ident" id="6159751">c</span><span class="op" id="6159752">.</span><span class="ident" id="6159753">HttpOnly</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6159764">return</span>&nbsp;<span class="ident" id="6159771">e</span><span class="op" id="6159772">,</span>&nbsp;<span class="builtintype" id="6159774">false</span><span class="op" id="6159779">,</span>&nbsp;<span class="ident" id="6159781">nil</span><br>
<span class="lineno"></span><span class="op" id="6159785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6159788">var</span>&nbsp;<span class="op" id="6159792">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6159795">errIllegalDomain</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6159814">=</span>&nbsp;<span class="ident" id="6159816">errors</span><span class="op" id="6159822">.</span><span class="ident" id="6159823">New</span><span class="op" id="6159826">(</span><span class="string" id="6159827">&#34;cookiejar:&nbsp;illegal&nbsp;cookie&nbsp;domain&nbsp;attribute&#34;</span><span class="op" id="6159871">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6159874">errMalformedDomain</span>&nbsp;<span class="op" id="6159893">=</span>&nbsp;<span class="ident" id="6159895">errors</span><span class="op" id="6159901">.</span><span class="ident" id="6159902">New</span><span class="op" id="6159905">(</span><span class="string" id="6159906">&#34;cookiejar:&nbsp;malformed&nbsp;cookie&nbsp;domain&nbsp;attribute&#34;</span><span class="op" id="6159952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6159955">errNoHostname</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6159974">=</span>&nbsp;<span class="ident" id="6159976">errors</span><span class="op" id="6159982">.</span><span class="ident" id="6159983">New</span><span class="op" id="6159986">(</span><span class="string" id="6159987">&#34;cookiejar:&nbsp;no&nbsp;host&nbsp;name&nbsp;available&nbsp;(IP&nbsp;only)&#34;</span><span class="op" id="6160032">)</span><br>
<span class="lineno"></span><span class="op" id="6160034">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6160037">//&nbsp;endOfTime&nbsp;is&nbsp;the&nbsp;time&nbsp;when&nbsp;session&nbsp;(non-persistent)&nbsp;cookies&nbsp;expire.</span><br>
<span class="lineno">435</span><span class="comment" id="6160108">//&nbsp;This&nbsp;instant&nbsp;is&nbsp;representable&nbsp;in&nbsp;most&nbsp;date/time&nbsp;formats&nbsp;(not&nbsp;just</span><br>
<span class="lineno"></span><span class="comment" id="6160177">//&nbsp;Go&#39;s&nbsp;time.Time)&nbsp;and&nbsp;should&nbsp;be&nbsp;far&nbsp;enough&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno"></span><span class="keyword" id="6160236">var</span>&nbsp;<span class="ident" id="6160240">endOfTime</span>&nbsp;<span class="op" id="6160250">=</span>&nbsp;<span class="ident" id="6160252">time</span><span class="op" id="6160256">.</span><span class="ident" id="6160257">Date</span><span class="op" id="6160261">(</span><span class="num" id="6160262">9999</span><span class="op" id="6160266">,</span>&nbsp;<span class="num" id="6160268">12</span><span class="op" id="6160270">,</span>&nbsp;<span class="num" id="6160272">31</span><span class="op" id="6160274">,</span>&nbsp;<span class="num" id="6160276">23</span><span class="op" id="6160278">,</span>&nbsp;<span class="num" id="6160280">59</span><span class="op" id="6160282">,</span>&nbsp;<span class="num" id="6160284">59</span><span class="op" id="6160286">,</span>&nbsp;<span class="num" id="6160288">0</span><span class="op" id="6160289">,</span>&nbsp;<span class="ident" id="6160291">time</span><span class="op" id="6160295">.</span><span class="ident" id="6160296">UTC</span><span class="op" id="6160299">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6160302">//&nbsp;domainAndType&nbsp;determines&nbsp;the&nbsp;cookie&#39;s&nbsp;domain&nbsp;and&nbsp;hostOnly&nbsp;attribute.</span><br>
<span class="lineno">440</span><span class="keyword" id="6160374">func</span>&nbsp;<span class="op" id="6160379">(</span><span class="ident" id="6160380">j</span>&nbsp;<span class="op" id="6160382">*</span><span class="ident" id="6160383">Jar</span><span class="op" id="6160386">)</span>&nbsp;<span class="ident" id="6160388">domainAndType</span><span class="op" id="6160401">(</span><span class="ident" id="6160402">host</span><span class="op" id="6160406">,</span>&nbsp;<span class="ident" id="6160408">domain</span>&nbsp;<span class="builtintype" id="6160415">string</span><span class="op" id="6160421">)</span>&nbsp;<span class="op" id="6160423">(</span><span class="builtintype" id="6160424">string</span><span class="op" id="6160430">,</span>&nbsp;<span class="builtintype" id="6160432">bool</span><span class="op" id="6160436">,</span>&nbsp;<span class="builtintype" id="6160438">error</span><span class="op" id="6160443">)</span>&nbsp;<span class="op" id="6160445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6160448">if</span>&nbsp;<span class="ident" id="6160451">domain</span>&nbsp;<span class="op" id="6160458">==</span>&nbsp;<span class="string" id="6160461">&#34;&#34;</span>&nbsp;<span class="op" id="6160464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6160468">//&nbsp;No&nbsp;domain&nbsp;attribute&nbsp;in&nbsp;the&nbsp;SetCookie&nbsp;header&nbsp;indicates&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6160529">//&nbsp;host&nbsp;cookie.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6160547">return</span>&nbsp;<span class="ident" id="6160554">host</span><span class="op" id="6160558">,</span>&nbsp;<span class="builtintype" id="6160560">true</span><span class="op" id="6160564">,</span>&nbsp;<span class="ident" id="6160566">nil</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6160571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6160575">if</span>&nbsp;<span class="ident" id="6160578">isIP</span><span class="op" id="6160582">(</span><span class="ident" id="6160583">host</span><span class="op" id="6160587">)</span>&nbsp;<span class="op" id="6160589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6160593">//&nbsp;According&nbsp;to&nbsp;RFC&nbsp;6265&nbsp;domain-matching&nbsp;includes&nbsp;not&nbsp;being</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6160655">//&nbsp;an&nbsp;IP&nbsp;address.</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6160675">//&nbsp;TODO:&nbsp;This&nbsp;might&nbsp;be&nbsp;relaxed&nbsp;as&nbsp;in&nbsp;common&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6160731">return</span>&nbsp;<span class="string" id="6160738">&#34;&#34;</span><span class="op" id="6160740">,</span>&nbsp;<span class="builtintype" id="6160742">false</span><span class="op" id="6160747">,</span>&nbsp;<span class="ident" id="6160749">errNoHostname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6160764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6160768">//&nbsp;From&nbsp;here&nbsp;on:&nbsp;If&nbsp;the&nbsp;cookie&nbsp;is&nbsp;valid,&nbsp;it&nbsp;is&nbsp;a&nbsp;domain&nbsp;cookie&nbsp;(with</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6160838">//&nbsp;the&nbsp;one&nbsp;exception&nbsp;of&nbsp;a&nbsp;public&nbsp;suffix&nbsp;below).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6160887">//&nbsp;See&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.2.3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6160919">if</span>&nbsp;<span class="ident" id="6160922">domain</span><span class="op" id="6160928">[</span><span class="num" id="6160929">0</span><span class="op" id="6160930">]</span>&nbsp;<span class="op" id="6160932">==</span>&nbsp;<span class="string" id="6160935">&#39;.&#39;</span>&nbsp;<span class="op" id="6160939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6160943">domain</span>&nbsp;<span class="op" id="6160950">=</span>&nbsp;<span class="ident" id="6160952">domain</span><span class="op" id="6160958">[</span><span class="num" id="6160959">1</span><span class="op" id="6160960">:</span><span class="op" id="6160961">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6160964">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6160968">if</span>&nbsp;<span class="builtinfunc" id="6160971">len</span><span class="op" id="6160974">(</span><span class="ident" id="6160975">domain</span><span class="op" id="6160981">)</span>&nbsp;<span class="op" id="6160983">==</span>&nbsp;<span class="num" id="6160986">0</span>&nbsp;<span class="op" id="6160988">||</span>&nbsp;<span class="ident" id="6160991">domain</span><span class="op" id="6160997">[</span><span class="num" id="6160998">0</span><span class="op" id="6160999">]</span>&nbsp;<span class="op" id="6161001">==</span>&nbsp;<span class="string" id="6161004">&#39;.&#39;</span>&nbsp;<span class="op" id="6161008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6161012">//&nbsp;Received&nbsp;either&nbsp;&#34;Domain=.&#34;&nbsp;or&nbsp;&#34;Domain=..some.thing&#34;,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6161070">//&nbsp;both&nbsp;are&nbsp;illegal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6161093">return</span>&nbsp;<span class="string" id="6161100">&#34;&#34;</span><span class="op" id="6161102">,</span>&nbsp;<span class="builtintype" id="6161104">false</span><span class="op" id="6161109">,</span>&nbsp;<span class="ident" id="6161111">errMalformedDomain</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6161131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6161134">domain</span>&nbsp;<span class="op" id="6161141">=</span>&nbsp;<span class="ident" id="6161143">strings</span><span class="op" id="6161150">.</span><span class="ident" id="6161151">ToLower</span><span class="op" id="6161158">(</span><span class="ident" id="6161159">domain</span><span class="op" id="6161165">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6161169">if</span>&nbsp;<span class="ident" id="6161172">domain</span><span class="op" id="6161178">[</span><span class="builtinfunc" id="6161179">len</span><span class="op" id="6161182">(</span><span class="ident" id="6161183">domain</span><span class="op" id="6161189">)</span><span class="op" id="6161190">-</span><span class="num" id="6161191">1</span><span class="op" id="6161192">]</span>&nbsp;<span class="op" id="6161194">==</span>&nbsp;<span class="string" id="6161197">&#39;.&#39;</span>&nbsp;<span class="op" id="6161201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6161205">//&nbsp;We&nbsp;received&nbsp;stuff&nbsp;like&nbsp;&#34;Domain=www.example.com.&#34;.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6161260">//&nbsp;Browsers&nbsp;do&nbsp;handle&nbsp;such&nbsp;stuff&nbsp;(actually&nbsp;differently)&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6161322">//&nbsp;RFC&nbsp;6265&nbsp;seems&nbsp;to&nbsp;be&nbsp;clear&nbsp;here&nbsp;(e.g.&nbsp;section&nbsp;4.1.2.3)&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6161385">//&nbsp;requiring&nbsp;a&nbsp;reject.&nbsp;&nbsp;4.1.2.3&nbsp;is&nbsp;not&nbsp;normative,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6161441">//&nbsp;&#34;Domain&nbsp;Matching&#34;&nbsp;(5.1.3)&nbsp;and&nbsp;&#34;Canonicalized&nbsp;Host&nbsp;Names&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6161503">//&nbsp;(5.1.2)&nbsp;are.</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6161521">return</span>&nbsp;<span class="string" id="6161528">&#34;&#34;</span><span class="op" id="6161530">,</span>&nbsp;<span class="builtintype" id="6161532">false</span><span class="op" id="6161537">,</span>&nbsp;<span class="ident" id="6161539">errMalformedDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6161559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6161563">//&nbsp;See&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.3&nbsp;#5.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6161596">if</span>&nbsp;<span class="ident" id="6161599">j</span><span class="op" id="6161600">.</span><span class="ident" id="6161601">psList</span>&nbsp;<span class="op" id="6161608">!=</span>&nbsp;<span class="ident" id="6161611">nil</span>&nbsp;<span class="op" id="6161615">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6161619">if</span>&nbsp;<span class="ident" id="6161622">ps</span>&nbsp;<span class="op" id="6161625">:=</span>&nbsp;<span class="ident" id="6161628">j</span><span class="op" id="6161629">.</span><span class="ident" id="6161630">psList</span><span class="op" id="6161636">.</span><span class="ident" id="6161637">PublicSuffix</span><span class="op" id="6161649">(</span><span class="ident" id="6161650">domain</span><span class="op" id="6161656">)</span><span class="op" id="6161657">;</span>&nbsp;<span class="ident" id="6161659">ps</span>&nbsp;<span class="op" id="6161662">!=</span>&nbsp;<span class="string" id="6161665">&#34;&#34;</span>&nbsp;<span class="op" id="6161668">&amp;&amp;</span>&nbsp;<span class="op" id="6161671">!</span><span class="ident" id="6161672">hasDotSuffix</span><span class="op" id="6161684">(</span><span class="ident" id="6161685">domain</span><span class="op" id="6161691">,</span>&nbsp;<span class="ident" id="6161693">ps</span><span class="op" id="6161695">)</span>&nbsp;<span class="op" id="6161697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6161702">if</span>&nbsp;<span class="ident" id="6161705">host</span>&nbsp;<span class="op" id="6161710">==</span>&nbsp;<span class="ident" id="6161713">domain</span>&nbsp;<span class="op" id="6161720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6161726">//&nbsp;This&nbsp;is&nbsp;the&nbsp;one&nbsp;exception&nbsp;in&nbsp;which&nbsp;a&nbsp;cookie</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6161777">//&nbsp;with&nbsp;a&nbsp;domain&nbsp;attribute&nbsp;is&nbsp;a&nbsp;host&nbsp;cookie.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6161826">return</span>&nbsp;<span class="ident" id="6161833">host</span><span class="op" id="6161837">,</span>&nbsp;<span class="builtintype" id="6161839">true</span><span class="op" id="6161843">,</span>&nbsp;<span class="ident" id="6161845">nil</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6161852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6161857">return</span>&nbsp;<span class="string" id="6161864">&#34;&#34;</span><span class="op" id="6161866">,</span>&nbsp;<span class="builtintype" id="6161868">false</span><span class="op" id="6161873">,</span>&nbsp;<span class="ident" id="6161875">errIllegalDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6161894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6161897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6161901">//&nbsp;The&nbsp;domain&nbsp;must&nbsp;domain-match&nbsp;host:&nbsp;www.mycompany.com&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6161965">//&nbsp;set&nbsp;cookies&nbsp;for&nbsp;.ourcompetitors.com.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6162006">if</span>&nbsp;<span class="ident" id="6162009">host</span>&nbsp;<span class="op" id="6162014">!=</span>&nbsp;<span class="ident" id="6162017">domain</span>&nbsp;<span class="op" id="6162024">&amp;&amp;</span>&nbsp;<span class="op" id="6162027">!</span><span class="ident" id="6162028">hasDotSuffix</span><span class="op" id="6162040">(</span><span class="ident" id="6162041">host</span><span class="op" id="6162045">,</span>&nbsp;<span class="ident" id="6162047">domain</span><span class="op" id="6162053">)</span>&nbsp;<span class="op" id="6162055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6162059">return</span>&nbsp;<span class="string" id="6162066">&#34;&#34;</span><span class="op" id="6162068">,</span>&nbsp;<span class="builtintype" id="6162070">false</span><span class="op" id="6162075">,</span>&nbsp;<span class="ident" id="6162077">errIllegalDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6162095">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6162099">return</span>&nbsp;<span class="ident" id="6162106">domain</span><span class="op" id="6162112">,</span>&nbsp;<span class="builtintype" id="6162114">false</span><span class="op" id="6162119">,</span>&nbsp;<span class="ident" id="6162121">nil</span><br>
<span class="lineno"></span><span class="op" id="6162125">}</span>
</div>
</body>
</html>
