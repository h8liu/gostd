<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/parser</h2>
<ul>
<li><a href="/gostd/go/parser/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/go/parser/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/parser/interface.go.html">interface.go</a></li>
<li><a href="/gostd/go/parser/parser.go.html">parser.go</a></li>
<li><a href="/gostd/go/parser/parser_test.go.html">parser_test.go</a></li>
<li><a href="/gostd/go/parser/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/parser/short_test.go.html">short_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4353875">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4353930">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4353984">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4354035">//&nbsp;Package&nbsp;parser&nbsp;implements&nbsp;a&nbsp;parser&nbsp;for&nbsp;Go&nbsp;source&nbsp;files.&nbsp;Input&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4354107">//&nbsp;provided&nbsp;in&nbsp;a&nbsp;variety&nbsp;of&nbsp;forms&nbsp;(see&nbsp;the&nbsp;various&nbsp;Parse*&nbsp;functions);&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4354181">//&nbsp;output&nbsp;is&nbsp;an&nbsp;abstract&nbsp;syntax&nbsp;tree&nbsp;(AST)&nbsp;representing&nbsp;the&nbsp;Go&nbsp;source.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="4354256">//&nbsp;parser&nbsp;is&nbsp;invoked&nbsp;through&nbsp;one&nbsp;of&nbsp;the&nbsp;Parse*&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="4354314">//</span><br>
<span class="lineno">10</span><span class="keyword" id="4354317">package</span>&nbsp;<span class="ident" id="4354325">parser</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4354333">import</span>&nbsp;<span class="op" id="4354340">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4354343">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4354350">&#34;go/ast&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4354360">&#34;go/scanner&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4354374">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4354386">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4354397">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4354408">&#34;unicode&#34;</span><br>
<span class="lineno">20</span><span class="op" id="4354418">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4354421">//&nbsp;The&nbsp;parser&nbsp;structure&nbsp;holds&nbsp;the&nbsp;parser&#39;s&nbsp;internal&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="4354480">type</span>&nbsp;<span class="ident" id="4354485">parser</span>&nbsp;<span class="keyword" id="4354492">struct</span>&nbsp;<span class="op" id="4354499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4354502">file</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4354510">*</span><span class="ident" id="4354511">token</span><span class="op" id="4354516">.</span><span class="ident" id="4354517">File</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4354523">errors</span>&nbsp;&nbsp;<span class="ident" id="4354531">scanner</span><span class="op" id="4354538">.</span><span class="ident" id="4354539">ErrorList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4354550">scanner</span>&nbsp;<span class="ident" id="4354558">scanner</span><span class="op" id="4354565">.</span><span class="ident" id="4354566">Scanner</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4354576">//&nbsp;Tracing/debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4354598">mode</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4354605">Mode</span>&nbsp;<span class="comment" id="4354610">//&nbsp;parsing&nbsp;mode</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4354627">trace</span>&nbsp;&nbsp;<span class="builtintype" id="4354634">bool</span>&nbsp;<span class="comment" id="4354639">//&nbsp;==&nbsp;(mode&nbsp;&amp;&nbsp;Trace&nbsp;!=&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4354666">indent</span>&nbsp;<span class="builtintype" id="4354673">int</span>&nbsp;&nbsp;<span class="comment" id="4354678">//&nbsp;indentation&nbsp;used&nbsp;for&nbsp;tracing&nbsp;output</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4354719">//&nbsp;Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4354732">comments</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4354744">[</span><span class="op" id="4354745">]</span><span class="op" id="4354746">*</span><span class="ident" id="4354747">ast</span><span class="op" id="4354750">.</span><span class="ident" id="4354751">CommentGroup</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4354765">leadComment</span>&nbsp;<span class="op" id="4354777">*</span><span class="ident" id="4354778">ast</span><span class="op" id="4354781">.</span><span class="ident" id="4354782">CommentGroup</span>&nbsp;<span class="comment" id="4354795">//&nbsp;last&nbsp;lead&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4354817">lineComment</span>&nbsp;<span class="op" id="4354829">*</span><span class="ident" id="4354830">ast</span><span class="op" id="4354833">.</span><span class="ident" id="4354834">CommentGroup</span>&nbsp;<span class="comment" id="4354847">//&nbsp;last&nbsp;line&nbsp;comment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4354870">//&nbsp;Next&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4354885">pos</span>&nbsp;<span class="ident" id="4354889">token</span><span class="op" id="4354894">.</span><span class="ident" id="4354895">Pos</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4354901">//&nbsp;token&nbsp;position</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4354920">tok</span>&nbsp;<span class="ident" id="4354924">token</span><span class="op" id="4354929">.</span><span class="ident" id="4354930">Token</span>&nbsp;<span class="comment" id="4354936">//&nbsp;one&nbsp;token&nbsp;look-ahead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4354961">lit</span>&nbsp;<span class="builtintype" id="4354965">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4354977">//&nbsp;token&nbsp;literal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4354996">//&nbsp;Error&nbsp;recovery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4355015">//&nbsp;(used&nbsp;to&nbsp;limit&nbsp;the&nbsp;number&nbsp;of&nbsp;calls&nbsp;to&nbsp;syncXXX&nbsp;functions</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4355075">//&nbsp;w/o&nbsp;making&nbsp;scanning&nbsp;progress&nbsp;-&nbsp;avoids&nbsp;potential&nbsp;endless</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4355135">//&nbsp;loops&nbsp;across&nbsp;multiple&nbsp;parser&nbsp;functions&nbsp;during&nbsp;error&nbsp;recovery)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4355201">syncPos</span>&nbsp;<span class="ident" id="4355209">token</span><span class="op" id="4355214">.</span><span class="ident" id="4355215">Pos</span>&nbsp;<span class="comment" id="4355219">//&nbsp;last&nbsp;synchronization&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4355253">syncCnt</span>&nbsp;<span class="builtintype" id="4355261">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4355271">//&nbsp;number&nbsp;of&nbsp;calls&nbsp;to&nbsp;syncXXX&nbsp;without&nbsp;progress</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4355320">//&nbsp;Non-syntactic&nbsp;parser&nbsp;control</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4355353">exprLev</span>&nbsp;<span class="builtintype" id="4355361">int</span>&nbsp;&nbsp;<span class="comment" id="4355366">//&nbsp;&lt;&nbsp;0:&nbsp;in&nbsp;control&nbsp;clause,&nbsp;&gt;=&nbsp;0:&nbsp;in&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4355414">inRhs</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4355422">bool</span>&nbsp;<span class="comment" id="4355427">//&nbsp;if&nbsp;set,&nbsp;the&nbsp;parser&nbsp;is&nbsp;parsing&nbsp;a&nbsp;rhs&nbsp;expression</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4355479">//&nbsp;Ordinary&nbsp;identifier&nbsp;scopes</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4355510">pkgScope</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4355521">*</span><span class="ident" id="4355522">ast</span><span class="op" id="4355525">.</span><span class="ident" id="4355526">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4355539">//&nbsp;pkgScope.Outer&nbsp;==&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4355565">topScope</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4355576">*</span><span class="ident" id="4355577">ast</span><span class="op" id="4355580">.</span><span class="ident" id="4355581">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4355594">//&nbsp;top-most&nbsp;scope;&nbsp;may&nbsp;be&nbsp;pkgScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4355630">unresolved</span>&nbsp;<span class="op" id="4355641">[</span><span class="op" id="4355642">]</span><span class="op" id="4355643">*</span><span class="ident" id="4355644">ast</span><span class="op" id="4355647">.</span><span class="ident" id="4355648">Ident</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4355659">//&nbsp;unresolved&nbsp;identifiers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4355686">imports</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4355697">[</span><span class="op" id="4355698">]</span><span class="op" id="4355699">*</span><span class="ident" id="4355700">ast</span><span class="op" id="4355703">.</span><span class="ident" id="4355704">ImportSpec</span>&nbsp;<span class="comment" id="4355715">//&nbsp;list&nbsp;of&nbsp;imports</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4355736">//&nbsp;Label&nbsp;scopes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4355753">//&nbsp;(maintained&nbsp;by&nbsp;open/close&nbsp;LabelScope)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4355795">labelScope</span>&nbsp;&nbsp;<span class="op" id="4355807">*</span><span class="ident" id="4355808">ast</span><span class="op" id="4355811">.</span><span class="ident" id="4355812">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4355822">//&nbsp;label&nbsp;scope&nbsp;for&nbsp;current&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4355859">targetStack</span>&nbsp;<span class="op" id="4355871">[</span><span class="op" id="4355872">]</span><span class="op" id="4355873">[</span><span class="op" id="4355874">]</span><span class="op" id="4355875">*</span><span class="ident" id="4355876">ast</span><span class="op" id="4355879">.</span><span class="ident" id="4355880">Ident</span>&nbsp;<span class="comment" id="4355886">//&nbsp;stack&nbsp;of&nbsp;unresolved&nbsp;labels</span><br>
<span class="lineno"></span><span class="op" id="4355916">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="4355919">func</span>&nbsp;<span class="op" id="4355924">(</span><span class="ident" id="4355925">p</span>&nbsp;<span class="op" id="4355927">*</span><span class="ident" id="4355928">parser</span><span class="op" id="4355934">)</span>&nbsp;<span class="ident" id="4355936">init</span><span class="op" id="4355940">(</span><span class="ident" id="4355941">fset</span>&nbsp;<span class="op" id="4355946">*</span><span class="ident" id="4355947">token</span><span class="op" id="4355952">.</span><span class="ident" id="4355953">FileSet</span><span class="op" id="4355960">,</span>&nbsp;<span class="ident" id="4355962">filename</span>&nbsp;<span class="builtintype" id="4355971">string</span><span class="op" id="4355977">,</span>&nbsp;<span class="ident" id="4355979">src</span>&nbsp;<span class="op" id="4355983">[</span><span class="op" id="4355984">]</span><span class="builtintype" id="4355985">byte</span><span class="op" id="4355989">,</span>&nbsp;<span class="ident" id="4355991">mode</span>&nbsp;<span class="ident" id="4355996">Mode</span><span class="op" id="4356000">)</span>&nbsp;<span class="op" id="4356002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356005">p</span><span class="op" id="4356006">.</span><span class="ident" id="4356007">file</span>&nbsp;<span class="op" id="4356012">=</span>&nbsp;<span class="ident" id="4356014">fset</span><span class="op" id="4356018">.</span><span class="ident" id="4356019">AddFile</span><span class="op" id="4356026">(</span><span class="ident" id="4356027">filename</span><span class="op" id="4356035">,</span>&nbsp;<span class="op" id="4356037">-</span><span class="num" id="4356038">1</span><span class="op" id="4356039">,</span>&nbsp;<span class="builtinfunc" id="4356041">len</span><span class="op" id="4356044">(</span><span class="ident" id="4356045">src</span><span class="op" id="4356048">)</span><span class="op" id="4356049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4356052">var</span>&nbsp;<span class="ident" id="4356056">m</span>&nbsp;<span class="ident" id="4356058">scanner</span><span class="op" id="4356065">.</span><span class="ident" id="4356066">Mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4356072">if</span>&nbsp;<span class="ident" id="4356075">mode</span><span class="op" id="4356079">&amp;</span><span class="ident" id="4356080">ParseComments</span>&nbsp;<span class="op" id="4356094">!=</span>&nbsp;<span class="num" id="4356097">0</span>&nbsp;<span class="op" id="4356099">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356103">m</span>&nbsp;<span class="op" id="4356105">=</span>&nbsp;<span class="ident" id="4356107">scanner</span><span class="op" id="4356114">.</span><span class="ident" id="4356115">ScanComments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4356129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356132">eh</span>&nbsp;<span class="op" id="4356135">:=</span>&nbsp;<span class="keyword" id="4356138">func</span><span class="op" id="4356142">(</span><span class="ident" id="4356143">pos</span>&nbsp;<span class="ident" id="4356147">token</span><span class="op" id="4356152">.</span><span class="ident" id="4356153">Position</span><span class="op" id="4356161">,</span>&nbsp;<span class="ident" id="4356163">msg</span>&nbsp;<span class="builtintype" id="4356167">string</span><span class="op" id="4356173">)</span>&nbsp;<span class="op" id="4356175">{</span>&nbsp;<span class="ident" id="4356177">p</span><span class="op" id="4356178">.</span><span class="ident" id="4356179">errors</span><span class="op" id="4356185">.</span><span class="ident" id="4356186">Add</span><span class="op" id="4356189">(</span><span class="ident" id="4356190">pos</span><span class="op" id="4356193">,</span>&nbsp;<span class="ident" id="4356195">msg</span><span class="op" id="4356198">)</span>&nbsp;<span class="op" id="4356200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356203">p</span><span class="op" id="4356204">.</span><span class="ident" id="4356205">scanner</span><span class="op" id="4356212">.</span><span class="ident" id="4356213">Init</span><span class="op" id="4356217">(</span><span class="ident" id="4356218">p</span><span class="op" id="4356219">.</span><span class="ident" id="4356220">file</span><span class="op" id="4356224">,</span>&nbsp;<span class="ident" id="4356226">src</span><span class="op" id="4356229">,</span>&nbsp;<span class="ident" id="4356231">eh</span><span class="op" id="4356233">,</span>&nbsp;<span class="ident" id="4356235">m</span><span class="op" id="4356236">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356240">p</span><span class="op" id="4356241">.</span><span class="ident" id="4356242">mode</span>&nbsp;<span class="op" id="4356247">=</span>&nbsp;<span class="ident" id="4356249">mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356255">p</span><span class="op" id="4356256">.</span><span class="ident" id="4356257">trace</span>&nbsp;<span class="op" id="4356263">=</span>&nbsp;<span class="ident" id="4356265">mode</span><span class="op" id="4356269">&amp;</span><span class="ident" id="4356270">Trace</span>&nbsp;<span class="op" id="4356276">!=</span>&nbsp;<span class="num" id="4356279">0</span>&nbsp;<span class="comment" id="4356281">//&nbsp;for&nbsp;convenience&nbsp;(p.trace&nbsp;is&nbsp;used&nbsp;frequently)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356331">p</span><span class="op" id="4356332">.</span><span class="ident" id="4356333">next</span><span class="op" id="4356337">(</span><span class="op" id="4356338">)</span><br>
<span class="lineno"></span><span class="op" id="4356340">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="4356343">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4356423">//&nbsp;Scoping&nbsp;support</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4356443">func</span>&nbsp;<span class="op" id="4356448">(</span><span class="ident" id="4356449">p</span>&nbsp;<span class="op" id="4356451">*</span><span class="ident" id="4356452">parser</span><span class="op" id="4356458">)</span>&nbsp;<span class="ident" id="4356460">openScope</span><span class="op" id="4356469">(</span><span class="op" id="4356470">)</span>&nbsp;<span class="op" id="4356472">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356475">p</span><span class="op" id="4356476">.</span><span class="ident" id="4356477">topScope</span>&nbsp;<span class="op" id="4356486">=</span>&nbsp;<span class="ident" id="4356488">ast</span><span class="op" id="4356491">.</span><span class="ident" id="4356492">NewScope</span><span class="op" id="4356500">(</span><span class="ident" id="4356501">p</span><span class="op" id="4356502">.</span><span class="ident" id="4356503">topScope</span><span class="op" id="4356511">)</span><br>
<span class="lineno"></span><span class="op" id="4356513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4356516">func</span>&nbsp;<span class="op" id="4356521">(</span><span class="ident" id="4356522">p</span>&nbsp;<span class="op" id="4356524">*</span><span class="ident" id="4356525">parser</span><span class="op" id="4356531">)</span>&nbsp;<span class="ident" id="4356533">closeScope</span><span class="op" id="4356543">(</span><span class="op" id="4356544">)</span>&nbsp;<span class="op" id="4356546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356549">p</span><span class="op" id="4356550">.</span><span class="ident" id="4356551">topScope</span>&nbsp;<span class="op" id="4356560">=</span>&nbsp;<span class="ident" id="4356562">p</span><span class="op" id="4356563">.</span><span class="ident" id="4356564">topScope</span><span class="op" id="4356572">.</span><span class="ident" id="4356573">Outer</span><br>
<span class="lineno">90</span><span class="op" id="4356579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4356582">func</span>&nbsp;<span class="op" id="4356587">(</span><span class="ident" id="4356588">p</span>&nbsp;<span class="op" id="4356590">*</span><span class="ident" id="4356591">parser</span><span class="op" id="4356597">)</span>&nbsp;<span class="ident" id="4356599">openLabelScope</span><span class="op" id="4356613">(</span><span class="op" id="4356614">)</span>&nbsp;<span class="op" id="4356616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356619">p</span><span class="op" id="4356620">.</span><span class="ident" id="4356621">labelScope</span>&nbsp;<span class="op" id="4356632">=</span>&nbsp;<span class="ident" id="4356634">ast</span><span class="op" id="4356637">.</span><span class="ident" id="4356638">NewScope</span><span class="op" id="4356646">(</span><span class="ident" id="4356647">p</span><span class="op" id="4356648">.</span><span class="ident" id="4356649">labelScope</span><span class="op" id="4356659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356662">p</span><span class="op" id="4356663">.</span><span class="ident" id="4356664">targetStack</span>&nbsp;<span class="op" id="4356676">=</span>&nbsp;<span class="builtinfunc" id="4356678">append</span><span class="op" id="4356684">(</span><span class="ident" id="4356685">p</span><span class="op" id="4356686">.</span><span class="ident" id="4356687">targetStack</span><span class="op" id="4356698">,</span>&nbsp;<span class="ident" id="4356700">nil</span><span class="op" id="4356703">)</span><br>
<span class="lineno">95</span><span class="op" id="4356705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4356708">func</span>&nbsp;<span class="op" id="4356713">(</span><span class="ident" id="4356714">p</span>&nbsp;<span class="op" id="4356716">*</span><span class="ident" id="4356717">parser</span><span class="op" id="4356723">)</span>&nbsp;<span class="ident" id="4356725">closeLabelScope</span><span class="op" id="4356740">(</span><span class="op" id="4356741">)</span>&nbsp;<span class="op" id="4356743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4356746">//&nbsp;resolve&nbsp;labels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356765">n</span>&nbsp;<span class="op" id="4356767">:=</span>&nbsp;<span class="builtinfunc" id="4356770">len</span><span class="op" id="4356773">(</span><span class="ident" id="4356774">p</span><span class="op" id="4356775">.</span><span class="ident" id="4356776">targetStack</span><span class="op" id="4356787">)</span>&nbsp;<span class="op" id="4356789">-</span>&nbsp;<span class="num" id="4356791">1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356794">scope</span>&nbsp;<span class="op" id="4356800">:=</span>&nbsp;<span class="ident" id="4356803">p</span><span class="op" id="4356804">.</span><span class="ident" id="4356805">labelScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4356817">for</span>&nbsp;<span class="ident" id="4356821">_</span><span class="op" id="4356822">,</span>&nbsp;<span class="ident" id="4356824">ident</span>&nbsp;<span class="op" id="4356830">:=</span>&nbsp;<span class="keyword" id="4356833">range</span>&nbsp;<span class="ident" id="4356839">p</span><span class="op" id="4356840">.</span><span class="ident" id="4356841">targetStack</span><span class="op" id="4356852">[</span><span class="ident" id="4356853">n</span><span class="op" id="4356854">]</span>&nbsp;<span class="op" id="4356856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356860">ident</span><span class="op" id="4356865">.</span><span class="ident" id="4356866">Obj</span>&nbsp;<span class="op" id="4356870">=</span>&nbsp;<span class="ident" id="4356872">scope</span><span class="op" id="4356877">.</span><span class="ident" id="4356878">Lookup</span><span class="op" id="4356884">(</span><span class="ident" id="4356885">ident</span><span class="op" id="4356890">.</span><span class="ident" id="4356891">Name</span><span class="op" id="4356895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4356899">if</span>&nbsp;<span class="ident" id="4356902">ident</span><span class="op" id="4356907">.</span><span class="ident" id="4356908">Obj</span>&nbsp;<span class="op" id="4356912">==</span>&nbsp;<span class="ident" id="4356915">nil</span>&nbsp;<span class="op" id="4356919">&amp;&amp;</span>&nbsp;<span class="ident" id="4356922">p</span><span class="op" id="4356923">.</span><span class="ident" id="4356924">mode</span><span class="op" id="4356928">&amp;</span><span class="ident" id="4356929">DeclarationErrors</span>&nbsp;<span class="op" id="4356947">!=</span>&nbsp;<span class="num" id="4356950">0</span>&nbsp;<span class="op" id="4356952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356957">p</span><span class="op" id="4356958">.</span><span class="builtintype" id="4356959">error</span><span class="op" id="4356964">(</span><span class="ident" id="4356965">ident</span><span class="op" id="4356970">.</span><span class="ident" id="4356971">Pos</span><span class="op" id="4356974">(</span><span class="op" id="4356975">)</span><span class="op" id="4356976">,</span>&nbsp;<span class="ident" id="4356978">fmt</span><span class="op" id="4356981">.</span><span class="ident" id="4356982">Sprintf</span><span class="op" id="4356989">(</span><span class="string" id="4356990">&#34;label&nbsp;%s&nbsp;undefined&#34;</span><span class="op" id="4357010">,</span>&nbsp;<span class="ident" id="4357012">ident</span><span class="op" id="4357017">.</span><span class="ident" id="4357018">Name</span><span class="op" id="4357022">)</span><span class="op" id="4357023">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4357027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4357030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4357033">//&nbsp;pop&nbsp;label&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357053">p</span><span class="op" id="4357054">.</span><span class="ident" id="4357055">targetStack</span>&nbsp;<span class="op" id="4357067">=</span>&nbsp;<span class="ident" id="4357069">p</span><span class="op" id="4357070">.</span><span class="ident" id="4357071">targetStack</span><span class="op" id="4357082">[</span><span class="num" id="4357083">0</span><span class="op" id="4357084">:</span><span class="ident" id="4357085">n</span><span class="op" id="4357086">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357089">p</span><span class="op" id="4357090">.</span><span class="ident" id="4357091">labelScope</span>&nbsp;<span class="op" id="4357102">=</span>&nbsp;<span class="ident" id="4357104">p</span><span class="op" id="4357105">.</span><span class="ident" id="4357106">labelScope</span><span class="op" id="4357116">.</span><span class="ident" id="4357117">Outer</span><br>
<span class="lineno">110</span><span class="op" id="4357123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4357126">func</span>&nbsp;<span class="op" id="4357131">(</span><span class="ident" id="4357132">p</span>&nbsp;<span class="op" id="4357134">*</span><span class="ident" id="4357135">parser</span><span class="op" id="4357141">)</span>&nbsp;<span class="ident" id="4357143">declare</span><span class="op" id="4357150">(</span><span class="ident" id="4357151">decl</span><span class="op" id="4357155">,</span>&nbsp;<span class="ident" id="4357157">data</span>&nbsp;<span class="keyword" id="4357162">interface</span><span class="op" id="4357171">{</span><span class="op" id="4357172">}</span><span class="op" id="4357173">,</span>&nbsp;<span class="ident" id="4357175">scope</span>&nbsp;<span class="op" id="4357181">*</span><span class="ident" id="4357182">ast</span><span class="op" id="4357185">.</span><span class="ident" id="4357186">Scope</span><span class="op" id="4357191">,</span>&nbsp;<span class="ident" id="4357193">kind</span>&nbsp;<span class="ident" id="4357198">ast</span><span class="op" id="4357201">.</span><span class="ident" id="4357202">ObjKind</span><span class="op" id="4357209">,</span>&nbsp;<span class="ident" id="4357211">idents</span>&nbsp;<span class="op" id="4357218">...</span><span class="op" id="4357221">*</span><span class="ident" id="4357222">ast</span><span class="op" id="4357225">.</span><span class="ident" id="4357226">Ident</span><span class="op" id="4357231">)</span>&nbsp;<span class="op" id="4357233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4357236">for</span>&nbsp;<span class="ident" id="4357240">_</span><span class="op" id="4357241">,</span>&nbsp;<span class="ident" id="4357243">ident</span>&nbsp;<span class="op" id="4357249">:=</span>&nbsp;<span class="keyword" id="4357252">range</span>&nbsp;<span class="ident" id="4357258">idents</span>&nbsp;<span class="op" id="4357265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357269">assert</span><span class="op" id="4357275">(</span><span class="ident" id="4357276">ident</span><span class="op" id="4357281">.</span><span class="ident" id="4357282">Obj</span>&nbsp;<span class="op" id="4357286">==</span>&nbsp;<span class="ident" id="4357289">nil</span><span class="op" id="4357292">,</span>&nbsp;<span class="string" id="4357294">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="4357335">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357339">obj</span>&nbsp;<span class="op" id="4357343">:=</span>&nbsp;<span class="ident" id="4357346">ast</span><span class="op" id="4357349">.</span><span class="ident" id="4357350">NewObj</span><span class="op" id="4357356">(</span><span class="ident" id="4357357">kind</span><span class="op" id="4357361">,</span>&nbsp;<span class="ident" id="4357363">ident</span><span class="op" id="4357368">.</span><span class="ident" id="4357369">Name</span><span class="op" id="4357373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4357377">//&nbsp;remember&nbsp;the&nbsp;corresponding&nbsp;declaration&nbsp;for&nbsp;redeclaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4357439">//&nbsp;errors&nbsp;and&nbsp;global&nbsp;variable&nbsp;resolution/typechecking&nbsp;phase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357501">obj</span><span class="op" id="4357504">.</span><span class="ident" id="4357505">Decl</span>&nbsp;<span class="op" id="4357510">=</span>&nbsp;<span class="ident" id="4357512">decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357519">obj</span><span class="op" id="4357522">.</span><span class="ident" id="4357523">Data</span>&nbsp;<span class="op" id="4357528">=</span>&nbsp;<span class="ident" id="4357530">data</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357537">ident</span><span class="op" id="4357542">.</span><span class="ident" id="4357543">Obj</span>&nbsp;<span class="op" id="4357547">=</span>&nbsp;<span class="ident" id="4357549">obj</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4357555">if</span>&nbsp;<span class="ident" id="4357558">ident</span><span class="op" id="4357563">.</span><span class="ident" id="4357564">Name</span>&nbsp;<span class="op" id="4357569">!=</span>&nbsp;<span class="string" id="4357572">&#34;_&#34;</span>&nbsp;<span class="op" id="4357576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4357581">if</span>&nbsp;<span class="ident" id="4357584">alt</span>&nbsp;<span class="op" id="4357588">:=</span>&nbsp;<span class="ident" id="4357591">scope</span><span class="op" id="4357596">.</span><span class="ident" id="4357597">Insert</span><span class="op" id="4357603">(</span><span class="ident" id="4357604">obj</span><span class="op" id="4357607">)</span><span class="op" id="4357608">;</span>&nbsp;<span class="ident" id="4357610">alt</span>&nbsp;<span class="op" id="4357614">!=</span>&nbsp;<span class="ident" id="4357617">nil</span>&nbsp;<span class="op" id="4357621">&amp;&amp;</span>&nbsp;<span class="ident" id="4357624">p</span><span class="op" id="4357625">.</span><span class="ident" id="4357626">mode</span><span class="op" id="4357630">&amp;</span><span class="ident" id="4357631">DeclarationErrors</span>&nbsp;<span class="op" id="4357649">!=</span>&nbsp;<span class="num" id="4357652">0</span>&nbsp;<span class="op" id="4357654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357660">prevDecl</span>&nbsp;<span class="op" id="4357669">:=</span>&nbsp;<span class="string" id="4357672">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4357679">if</span>&nbsp;<span class="ident" id="4357682">pos</span>&nbsp;<span class="op" id="4357686">:=</span>&nbsp;<span class="ident" id="4357689">alt</span><span class="op" id="4357692">.</span><span class="ident" id="4357693">Pos</span><span class="op" id="4357696">(</span><span class="op" id="4357697">)</span><span class="op" id="4357698">;</span>&nbsp;<span class="ident" id="4357700">pos</span><span class="op" id="4357703">.</span><span class="ident" id="4357704">IsValid</span><span class="op" id="4357711">(</span><span class="op" id="4357712">)</span>&nbsp;<span class="op" id="4357714">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357721">prevDecl</span>&nbsp;<span class="op" id="4357730">=</span>&nbsp;<span class="ident" id="4357732">fmt</span><span class="op" id="4357735">.</span><span class="ident" id="4357736">Sprintf</span><span class="op" id="4357743">(</span><span class="string" id="4357744">&#34;\n\tprevious&nbsp;declaration&nbsp;at&nbsp;%s&#34;</span><span class="op" id="4357776">,</span>&nbsp;<span class="ident" id="4357778">p</span><span class="op" id="4357779">.</span><span class="ident" id="4357780">file</span><span class="op" id="4357784">.</span><span class="ident" id="4357785">Position</span><span class="op" id="4357793">(</span><span class="ident" id="4357794">pos</span><span class="op" id="4357797">)</span><span class="op" id="4357798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4357804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357810">p</span><span class="op" id="4357811">.</span><span class="builtintype" id="4357812">error</span><span class="op" id="4357817">(</span><span class="ident" id="4357818">ident</span><span class="op" id="4357823">.</span><span class="ident" id="4357824">Pos</span><span class="op" id="4357827">(</span><span class="op" id="4357828">)</span><span class="op" id="4357829">,</span>&nbsp;<span class="ident" id="4357831">fmt</span><span class="op" id="4357834">.</span><span class="ident" id="4357835">Sprintf</span><span class="op" id="4357842">(</span><span class="string" id="4357843">&#34;%s&nbsp;redeclared&nbsp;in&nbsp;this&nbsp;block%s&#34;</span><span class="op" id="4357874">,</span>&nbsp;<span class="ident" id="4357876">ident</span><span class="op" id="4357881">.</span><span class="ident" id="4357882">Name</span><span class="op" id="4357886">,</span>&nbsp;<span class="ident" id="4357888">prevDecl</span><span class="op" id="4357896">)</span><span class="op" id="4357897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4357902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4357906">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4357909">}</span><br>
<span class="lineno"></span><span class="op" id="4357911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4357914">func</span>&nbsp;<span class="op" id="4357919">(</span><span class="ident" id="4357920">p</span>&nbsp;<span class="op" id="4357922">*</span><span class="ident" id="4357923">parser</span><span class="op" id="4357929">)</span>&nbsp;<span class="ident" id="4357931">shortVarDecl</span><span class="op" id="4357943">(</span><span class="ident" id="4357944">decl</span>&nbsp;<span class="op" id="4357949">*</span><span class="ident" id="4357950">ast</span><span class="op" id="4357953">.</span><span class="ident" id="4357954">AssignStmt</span><span class="op" id="4357964">,</span>&nbsp;<span class="ident" id="4357966">list</span>&nbsp;<span class="op" id="4357971">[</span><span class="op" id="4357972">]</span><span class="ident" id="4357973">ast</span><span class="op" id="4357976">.</span><span class="ident" id="4357977">Expr</span><span class="op" id="4357981">)</span>&nbsp;<span class="op" id="4357983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4357986">//&nbsp;Go&nbsp;spec:&nbsp;A&nbsp;short&nbsp;variable&nbsp;declaration&nbsp;may&nbsp;redeclare&nbsp;variables</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4358052">//&nbsp;provided&nbsp;they&nbsp;were&nbsp;originally&nbsp;declared&nbsp;in&nbsp;the&nbsp;same&nbsp;block&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4358118">//&nbsp;the&nbsp;same&nbsp;type,&nbsp;and&nbsp;at&nbsp;least&nbsp;one&nbsp;of&nbsp;the&nbsp;non-blank&nbsp;variables&nbsp;is&nbsp;new.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4358189">n</span>&nbsp;<span class="op" id="4358191">:=</span>&nbsp;<span class="num" id="4358194">0</span>&nbsp;<span class="comment" id="4358196">//&nbsp;number&nbsp;of&nbsp;new&nbsp;variables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4358224">for</span>&nbsp;<span class="ident" id="4358228">_</span><span class="op" id="4358229">,</span>&nbsp;<span class="ident" id="4358231">x</span>&nbsp;<span class="op" id="4358233">:=</span>&nbsp;<span class="keyword" id="4358236">range</span>&nbsp;<span class="ident" id="4358242">list</span>&nbsp;<span class="op" id="4358247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4358251">if</span>&nbsp;<span class="ident" id="4358254">ident</span><span class="op" id="4358259">,</span>&nbsp;<span class="ident" id="4358261">isIdent</span>&nbsp;<span class="op" id="4358269">:=</span>&nbsp;<span class="ident" id="4358272">x</span><span class="op" id="4358273">.</span><span class="op" id="4358274">(</span><span class="op" id="4358275">*</span><span class="ident" id="4358276">ast</span><span class="op" id="4358279">.</span><span class="ident" id="4358280">Ident</span><span class="op" id="4358285">)</span><span class="op" id="4358286">;</span>&nbsp;<span class="ident" id="4358288">isIdent</span>&nbsp;<span class="op" id="4358296">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4358301">assert</span><span class="op" id="4358307">(</span><span class="ident" id="4358308">ident</span><span class="op" id="4358313">.</span><span class="ident" id="4358314">Obj</span>&nbsp;<span class="op" id="4358318">==</span>&nbsp;<span class="ident" id="4358321">nil</span><span class="op" id="4358324">,</span>&nbsp;<span class="string" id="4358326">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="4358367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4358372">obj</span>&nbsp;<span class="op" id="4358376">:=</span>&nbsp;<span class="ident" id="4358379">ast</span><span class="op" id="4358382">.</span><span class="ident" id="4358383">NewObj</span><span class="op" id="4358389">(</span><span class="ident" id="4358390">ast</span><span class="op" id="4358393">.</span><span class="ident" id="4358394">Var</span><span class="op" id="4358397">,</span>&nbsp;<span class="ident" id="4358399">ident</span><span class="op" id="4358404">.</span><span class="ident" id="4358405">Name</span><span class="op" id="4358409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4358414">//&nbsp;remember&nbsp;corresponding&nbsp;assignment&nbsp;for&nbsp;other&nbsp;tools</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4358470">obj</span><span class="op" id="4358473">.</span><span class="ident" id="4358474">Decl</span>&nbsp;<span class="op" id="4358479">=</span>&nbsp;<span class="ident" id="4358481">decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4358489">ident</span><span class="op" id="4358494">.</span><span class="ident" id="4358495">Obj</span>&nbsp;<span class="op" id="4358499">=</span>&nbsp;<span class="ident" id="4358501">obj</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4358508">if</span>&nbsp;<span class="ident" id="4358511">ident</span><span class="op" id="4358516">.</span><span class="ident" id="4358517">Name</span>&nbsp;<span class="op" id="4358522">!=</span>&nbsp;<span class="string" id="4358525">&#34;_&#34;</span>&nbsp;<span class="op" id="4358529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4358535">if</span>&nbsp;<span class="ident" id="4358538">alt</span>&nbsp;<span class="op" id="4358542">:=</span>&nbsp;<span class="ident" id="4358545">p</span><span class="op" id="4358546">.</span><span class="ident" id="4358547">topScope</span><span class="op" id="4358555">.</span><span class="ident" id="4358556">Insert</span><span class="op" id="4358562">(</span><span class="ident" id="4358563">obj</span><span class="op" id="4358566">)</span><span class="op" id="4358567">;</span>&nbsp;<span class="ident" id="4358569">alt</span>&nbsp;<span class="op" id="4358573">!=</span>&nbsp;<span class="ident" id="4358576">nil</span>&nbsp;<span class="op" id="4358580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4358587">ident</span><span class="op" id="4358592">.</span><span class="ident" id="4358593">Obj</span>&nbsp;<span class="op" id="4358597">=</span>&nbsp;<span class="ident" id="4358599">alt</span>&nbsp;<span class="comment" id="4358603">//&nbsp;redeclaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4358624">}</span>&nbsp;<span class="keyword" id="4358626">else</span>&nbsp;<span class="op" id="4358631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4358638">n</span><span class="op" id="4358639">++</span>&nbsp;<span class="comment" id="4358642">//&nbsp;new&nbsp;declaration</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4358665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4358670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4358674">}</span>&nbsp;<span class="keyword" id="4358676">else</span>&nbsp;<span class="op" id="4358681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4358686">p</span><span class="op" id="4358687">.</span><span class="ident" id="4358688">errorExpected</span><span class="op" id="4358701">(</span><span class="ident" id="4358702">x</span><span class="op" id="4358703">.</span><span class="ident" id="4358704">Pos</span><span class="op" id="4358707">(</span><span class="op" id="4358708">)</span><span class="op" id="4358709">,</span>&nbsp;<span class="string" id="4358711">&#34;identifier&nbsp;on&nbsp;left&nbsp;side&nbsp;of&nbsp;:=&#34;</span><span class="op" id="4358742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4358746">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4358749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4358752">if</span>&nbsp;<span class="ident" id="4358755">n</span>&nbsp;<span class="op" id="4358757">==</span>&nbsp;<span class="num" id="4358760">0</span>&nbsp;<span class="op" id="4358762">&amp;&amp;</span>&nbsp;<span class="ident" id="4358765">p</span><span class="op" id="4358766">.</span><span class="ident" id="4358767">mode</span><span class="op" id="4358771">&amp;</span><span class="ident" id="4358772">DeclarationErrors</span>&nbsp;<span class="op" id="4358790">!=</span>&nbsp;<span class="num" id="4358793">0</span>&nbsp;<span class="op" id="4358795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4358799">p</span><span class="op" id="4358800">.</span><span class="builtintype" id="4358801">error</span><span class="op" id="4358806">(</span><span class="ident" id="4358807">list</span><span class="op" id="4358811">[</span><span class="num" id="4358812">0</span><span class="op" id="4358813">]</span><span class="op" id="4358814">.</span><span class="ident" id="4358815">Pos</span><span class="op" id="4358818">(</span><span class="op" id="4358819">)</span><span class="op" id="4358820">,</span>&nbsp;<span class="string" id="4358822">&#34;no&nbsp;new&nbsp;variables&nbsp;on&nbsp;left&nbsp;side&nbsp;of&nbsp;:=&#34;</span><span class="op" id="4358859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4358862">}</span><br>
<span class="lineno"></span><span class="op" id="4358864">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="comment" id="4358867">//&nbsp;The&nbsp;unresolved&nbsp;object&nbsp;is&nbsp;a&nbsp;sentinel&nbsp;to&nbsp;mark&nbsp;identifiers&nbsp;that&nbsp;have&nbsp;been&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="4358947">//&nbsp;to&nbsp;the&nbsp;list&nbsp;of&nbsp;unresolved&nbsp;identifiers.&nbsp;The&nbsp;sentinel&nbsp;is&nbsp;only&nbsp;used&nbsp;for&nbsp;verifying</span><br>
<span class="lineno"></span><span class="comment" id="4359029">//&nbsp;internal&nbsp;consistency.</span><br>
<span class="lineno"></span><span class="keyword" id="4359054">var</span>&nbsp;<span class="ident" id="4359058">unresolved</span>&nbsp;<span class="op" id="4359069">=</span>&nbsp;<span class="builtinfunc" id="4359071">new</span><span class="op" id="4359074">(</span><span class="ident" id="4359075">ast</span><span class="op" id="4359078">.</span><span class="ident" id="4359079">Object</span><span class="op" id="4359085">)</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="comment" id="4359088">//&nbsp;If&nbsp;x&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;tryResolve&nbsp;attempts&nbsp;to&nbsp;resolve&nbsp;x&nbsp;by&nbsp;looking&nbsp;up</span><br>
<span class="lineno"></span><span class="comment" id="4359161">//&nbsp;the&nbsp;object&nbsp;it&nbsp;denotes.&nbsp;If&nbsp;no&nbsp;object&nbsp;is&nbsp;found&nbsp;and&nbsp;collectUnresolved&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4359234">//&nbsp;set,&nbsp;x&nbsp;is&nbsp;marked&nbsp;as&nbsp;unresolved&nbsp;and&nbsp;collected&nbsp;in&nbsp;the&nbsp;list&nbsp;of&nbsp;unresolved</span><br>
<span class="lineno"></span><span class="comment" id="4359308">//&nbsp;identifiers.</span><br>
<span class="lineno">170</span><span class="comment" id="4359324">//</span><br>
<span class="lineno"></span><span class="keyword" id="4359327">func</span>&nbsp;<span class="op" id="4359332">(</span><span class="ident" id="4359333">p</span>&nbsp;<span class="op" id="4359335">*</span><span class="ident" id="4359336">parser</span><span class="op" id="4359342">)</span>&nbsp;<span class="ident" id="4359344">tryResolve</span><span class="op" id="4359354">(</span><span class="ident" id="4359355">x</span>&nbsp;<span class="ident" id="4359357">ast</span><span class="op" id="4359360">.</span><span class="ident" id="4359361">Expr</span><span class="op" id="4359365">,</span>&nbsp;<span class="ident" id="4359367">collectUnresolved</span>&nbsp;<span class="builtintype" id="4359385">bool</span><span class="op" id="4359389">)</span>&nbsp;<span class="op" id="4359391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4359394">//&nbsp;nothing&nbsp;to&nbsp;do&nbsp;if&nbsp;x&nbsp;is&nbsp;not&nbsp;an&nbsp;identifier&nbsp;or&nbsp;the&nbsp;blank&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4359462">ident</span><span class="op" id="4359467">,</span>&nbsp;<span class="ident" id="4359469">_</span>&nbsp;<span class="op" id="4359471">:=</span>&nbsp;<span class="ident" id="4359474">x</span><span class="op" id="4359475">.</span><span class="op" id="4359476">(</span><span class="op" id="4359477">*</span><span class="ident" id="4359478">ast</span><span class="op" id="4359481">.</span><span class="ident" id="4359482">Ident</span><span class="op" id="4359487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4359490">if</span>&nbsp;<span class="ident" id="4359493">ident</span>&nbsp;<span class="op" id="4359499">==</span>&nbsp;<span class="ident" id="4359502">nil</span>&nbsp;<span class="op" id="4359506">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4359510">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4359518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4359521">assert</span><span class="op" id="4359527">(</span><span class="ident" id="4359528">ident</span><span class="op" id="4359533">.</span><span class="ident" id="4359534">Obj</span>&nbsp;<span class="op" id="4359538">==</span>&nbsp;<span class="ident" id="4359541">nil</span><span class="op" id="4359544">,</span>&nbsp;<span class="string" id="4359546">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="4359587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4359590">if</span>&nbsp;<span class="ident" id="4359593">ident</span><span class="op" id="4359598">.</span><span class="ident" id="4359599">Name</span>&nbsp;<span class="op" id="4359604">==</span>&nbsp;<span class="string" id="4359607">&#34;_&#34;</span>&nbsp;<span class="op" id="4359611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4359615">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4359623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4359626">//&nbsp;try&nbsp;to&nbsp;resolve&nbsp;the&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4359660">for</span>&nbsp;<span class="ident" id="4359664">s</span>&nbsp;<span class="op" id="4359666">:=</span>&nbsp;<span class="ident" id="4359669">p</span><span class="op" id="4359670">.</span><span class="ident" id="4359671">topScope</span><span class="op" id="4359679">;</span>&nbsp;<span class="ident" id="4359681">s</span>&nbsp;<span class="op" id="4359683">!=</span>&nbsp;<span class="ident" id="4359686">nil</span><span class="op" id="4359689">;</span>&nbsp;<span class="ident" id="4359691">s</span>&nbsp;<span class="op" id="4359693">=</span>&nbsp;<span class="ident" id="4359695">s</span><span class="op" id="4359696">.</span><span class="ident" id="4359697">Outer</span>&nbsp;<span class="op" id="4359703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4359707">if</span>&nbsp;<span class="ident" id="4359710">obj</span>&nbsp;<span class="op" id="4359714">:=</span>&nbsp;<span class="ident" id="4359717">s</span><span class="op" id="4359718">.</span><span class="ident" id="4359719">Lookup</span><span class="op" id="4359725">(</span><span class="ident" id="4359726">ident</span><span class="op" id="4359731">.</span><span class="ident" id="4359732">Name</span><span class="op" id="4359736">)</span><span class="op" id="4359737">;</span>&nbsp;<span class="ident" id="4359739">obj</span>&nbsp;<span class="op" id="4359743">!=</span>&nbsp;<span class="ident" id="4359746">nil</span>&nbsp;<span class="op" id="4359750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4359755">ident</span><span class="op" id="4359760">.</span><span class="ident" id="4359761">Obj</span>&nbsp;<span class="op" id="4359765">=</span>&nbsp;<span class="ident" id="4359767">obj</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4359774">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4359783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4359786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4359789">//&nbsp;all&nbsp;local&nbsp;scopes&nbsp;are&nbsp;known,&nbsp;so&nbsp;any&nbsp;unresolved&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4359850">//&nbsp;must&nbsp;be&nbsp;found&nbsp;either&nbsp;in&nbsp;the&nbsp;file&nbsp;scope,&nbsp;package&nbsp;scope</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4359908">//&nbsp;(perhaps&nbsp;in&nbsp;another&nbsp;file),&nbsp;or&nbsp;universe&nbsp;scope&nbsp;---&nbsp;collect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4359969">//&nbsp;them&nbsp;so&nbsp;that&nbsp;they&nbsp;can&nbsp;be&nbsp;resolved&nbsp;later</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4360013">if</span>&nbsp;<span class="ident" id="4360016">collectUnresolved</span>&nbsp;<span class="op" id="4360034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4360038">ident</span><span class="op" id="4360043">.</span><span class="ident" id="4360044">Obj</span>&nbsp;<span class="op" id="4360048">=</span>&nbsp;<span class="ident" id="4360050">unresolved</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4360063">p</span><span class="op" id="4360064">.</span><span class="ident" id="4360065">unresolved</span>&nbsp;<span class="op" id="4360076">=</span>&nbsp;<span class="builtinfunc" id="4360078">append</span><span class="op" id="4360084">(</span><span class="ident" id="4360085">p</span><span class="op" id="4360086">.</span><span class="ident" id="4360087">unresolved</span><span class="op" id="4360097">,</span>&nbsp;<span class="ident" id="4360099">ident</span><span class="op" id="4360104">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4360107">}</span><br>
<span class="lineno"></span><span class="op" id="4360109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4360112">func</span>&nbsp;<span class="op" id="4360117">(</span><span class="ident" id="4360118">p</span>&nbsp;<span class="op" id="4360120">*</span><span class="ident" id="4360121">parser</span><span class="op" id="4360127">)</span>&nbsp;<span class="ident" id="4360129">resolve</span><span class="op" id="4360136">(</span><span class="ident" id="4360137">x</span>&nbsp;<span class="ident" id="4360139">ast</span><span class="op" id="4360142">.</span><span class="ident" id="4360143">Expr</span><span class="op" id="4360147">)</span>&nbsp;<span class="op" id="4360149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4360152">p</span><span class="op" id="4360153">.</span><span class="ident" id="4360154">tryResolve</span><span class="op" id="4360164">(</span><span class="ident" id="4360165">x</span><span class="op" id="4360166">,</span>&nbsp;<span class="builtintype" id="4360168">true</span><span class="op" id="4360172">)</span><br>
<span class="lineno">200</span><span class="op" id="4360174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4360177">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4360257">//&nbsp;Parsing&nbsp;support</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="keyword" id="4360277">func</span>&nbsp;<span class="op" id="4360282">(</span><span class="ident" id="4360283">p</span>&nbsp;<span class="op" id="4360285">*</span><span class="ident" id="4360286">parser</span><span class="op" id="4360292">)</span>&nbsp;<span class="ident" id="4360294">printTrace</span><span class="op" id="4360304">(</span><span class="ident" id="4360305">a</span>&nbsp;<span class="op" id="4360307">...</span><span class="keyword" id="4360310">interface</span><span class="op" id="4360319">{</span><span class="op" id="4360320">}</span><span class="op" id="4360321">)</span>&nbsp;<span class="op" id="4360323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4360326">const</span>&nbsp;<span class="ident" id="4360332">dots</span>&nbsp;<span class="op" id="4360337">=</span>&nbsp;<span class="string" id="4360339">&#34;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4360407">const</span>&nbsp;<span class="ident" id="4360413">n</span>&nbsp;<span class="op" id="4360415">=</span>&nbsp;<span class="builtinfunc" id="4360417">len</span><span class="op" id="4360420">(</span><span class="ident" id="4360421">dots</span><span class="op" id="4360425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4360428">pos</span>&nbsp;<span class="op" id="4360432">:=</span>&nbsp;<span class="ident" id="4360435">p</span><span class="op" id="4360436">.</span><span class="ident" id="4360437">file</span><span class="op" id="4360441">.</span><span class="ident" id="4360442">Position</span><span class="op" id="4360450">(</span><span class="ident" id="4360451">p</span><span class="op" id="4360452">.</span><span class="ident" id="4360453">pos</span><span class="op" id="4360456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4360459">fmt</span><span class="op" id="4360462">.</span><span class="ident" id="4360463">Printf</span><span class="op" id="4360469">(</span><span class="string" id="4360470">&#34;%5d:%3d:&nbsp;&#34;</span><span class="op" id="4360481">,</span>&nbsp;<span class="ident" id="4360483">pos</span><span class="op" id="4360486">.</span><span class="ident" id="4360487">Line</span><span class="op" id="4360491">,</span>&nbsp;<span class="ident" id="4360493">pos</span><span class="op" id="4360496">.</span><span class="ident" id="4360497">Column</span><span class="op" id="4360503">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4360506">i</span>&nbsp;<span class="op" id="4360508">:=</span>&nbsp;<span class="num" id="4360511">2</span>&nbsp;<span class="op" id="4360513">*</span>&nbsp;<span class="ident" id="4360515">p</span><span class="op" id="4360516">.</span><span class="ident" id="4360517">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4360525">for</span>&nbsp;<span class="ident" id="4360529">i</span>&nbsp;<span class="op" id="4360531">&gt;</span>&nbsp;<span class="ident" id="4360533">n</span>&nbsp;<span class="op" id="4360535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4360539">fmt</span><span class="op" id="4360542">.</span><span class="ident" id="4360543">Print</span><span class="op" id="4360548">(</span><span class="ident" id="4360549">dots</span><span class="op" id="4360553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4360557">i</span>&nbsp;<span class="op" id="4360559">-=</span>&nbsp;<span class="ident" id="4360562">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4360565">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4360568">//&nbsp;i&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4360579">fmt</span><span class="op" id="4360582">.</span><span class="ident" id="4360583">Print</span><span class="op" id="4360588">(</span><span class="ident" id="4360589">dots</span><span class="op" id="4360593">[</span><span class="num" id="4360594">0</span><span class="op" id="4360595">:</span><span class="ident" id="4360596">i</span><span class="op" id="4360597">]</span><span class="op" id="4360598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4360601">fmt</span><span class="op" id="4360604">.</span><span class="ident" id="4360605">Println</span><span class="op" id="4360612">(</span><span class="ident" id="4360613">a</span><span class="op" id="4360614">...</span><span class="op" id="4360617">)</span><br>
<span class="lineno"></span><span class="op" id="4360619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="keyword" id="4360622">func</span>&nbsp;<span class="ident" id="4360627">trace</span><span class="op" id="4360632">(</span><span class="ident" id="4360633">p</span>&nbsp;<span class="op" id="4360635">*</span><span class="ident" id="4360636">parser</span><span class="op" id="4360642">,</span>&nbsp;<span class="ident" id="4360644">msg</span>&nbsp;<span class="builtintype" id="4360648">string</span><span class="op" id="4360654">)</span>&nbsp;<span class="op" id="4360656">*</span><span class="ident" id="4360657">parser</span>&nbsp;<span class="op" id="4360664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4360667">p</span><span class="op" id="4360668">.</span><span class="ident" id="4360669">printTrace</span><span class="op" id="4360679">(</span><span class="ident" id="4360680">msg</span><span class="op" id="4360683">,</span>&nbsp;<span class="string" id="4360685">&#34;(&#34;</span><span class="op" id="4360688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4360691">p</span><span class="op" id="4360692">.</span><span class="ident" id="4360693">indent</span><span class="op" id="4360699">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4360703">return</span>&nbsp;<span class="ident" id="4360710">p</span><br>
<span class="lineno"></span><span class="op" id="4360712">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="4360715">//&nbsp;Usage&nbsp;pattern:&nbsp;defer&nbsp;un(trace(p,&nbsp;&#34;...&#34;))</span><br>
<span class="lineno"></span><span class="keyword" id="4360759">func</span>&nbsp;<span class="ident" id="4360764">un</span><span class="op" id="4360766">(</span><span class="ident" id="4360767">p</span>&nbsp;<span class="op" id="4360769">*</span><span class="ident" id="4360770">parser</span><span class="op" id="4360776">)</span>&nbsp;<span class="op" id="4360778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4360781">p</span><span class="op" id="4360782">.</span><span class="ident" id="4360783">indent</span><span class="op" id="4360789">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4360793">p</span><span class="op" id="4360794">.</span><span class="ident" id="4360795">printTrace</span><span class="op" id="4360805">(</span><span class="string" id="4360806">&#34;)&#34;</span><span class="op" id="4360809">)</span><br>
<span class="lineno">230</span><span class="op" id="4360811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4360814">//&nbsp;Advance&nbsp;to&nbsp;the&nbsp;next&nbsp;token.</span><br>
<span class="lineno"></span><span class="keyword" id="4360844">func</span>&nbsp;<span class="op" id="4360849">(</span><span class="ident" id="4360850">p</span>&nbsp;<span class="op" id="4360852">*</span><span class="ident" id="4360853">parser</span><span class="op" id="4360859">)</span>&nbsp;<span class="ident" id="4360861">next0</span><span class="op" id="4360866">(</span><span class="op" id="4360867">)</span>&nbsp;<span class="op" id="4360869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4360872">//&nbsp;Because&nbsp;of&nbsp;one-token&nbsp;look-ahead,&nbsp;print&nbsp;the&nbsp;previous&nbsp;token</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4360934">//&nbsp;when&nbsp;tracing&nbsp;as&nbsp;it&nbsp;provides&nbsp;a&nbsp;more&nbsp;readable&nbsp;output.&nbsp;The</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4360994">//&nbsp;very&nbsp;first&nbsp;token&nbsp;(!p.pos.IsValid())&nbsp;is&nbsp;not&nbsp;initialized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4361053">//&nbsp;(it&nbsp;is&nbsp;token.ILLEGAL),&nbsp;so&nbsp;don&#39;t&nbsp;print&nbsp;it&nbsp;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4361100">if</span>&nbsp;<span class="ident" id="4361103">p</span><span class="op" id="4361104">.</span><span class="ident" id="4361105">trace</span>&nbsp;<span class="op" id="4361111">&amp;&amp;</span>&nbsp;<span class="ident" id="4361114">p</span><span class="op" id="4361115">.</span><span class="ident" id="4361116">pos</span><span class="op" id="4361119">.</span><span class="ident" id="4361120">IsValid</span><span class="op" id="4361127">(</span><span class="op" id="4361128">)</span>&nbsp;<span class="op" id="4361130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4361134">s</span>&nbsp;<span class="op" id="4361136">:=</span>&nbsp;<span class="ident" id="4361139">p</span><span class="op" id="4361140">.</span><span class="ident" id="4361141">tok</span><span class="op" id="4361144">.</span><span class="ident" id="4361145">String</span><span class="op" id="4361151">(</span><span class="op" id="4361152">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4361156">switch</span>&nbsp;<span class="op" id="4361163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4361167">case</span>&nbsp;<span class="ident" id="4361172">p</span><span class="op" id="4361173">.</span><span class="ident" id="4361174">tok</span><span class="op" id="4361177">.</span><span class="ident" id="4361178">IsLiteral</span><span class="op" id="4361187">(</span><span class="op" id="4361188">)</span><span class="op" id="4361189">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4361194">p</span><span class="op" id="4361195">.</span><span class="ident" id="4361196">printTrace</span><span class="op" id="4361206">(</span><span class="ident" id="4361207">s</span><span class="op" id="4361208">,</span>&nbsp;<span class="ident" id="4361210">p</span><span class="op" id="4361211">.</span><span class="ident" id="4361212">lit</span><span class="op" id="4361215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4361219">case</span>&nbsp;<span class="ident" id="4361224">p</span><span class="op" id="4361225">.</span><span class="ident" id="4361226">tok</span><span class="op" id="4361229">.</span><span class="ident" id="4361230">IsOperator</span><span class="op" id="4361240">(</span><span class="op" id="4361241">)</span><span class="op" id="4361242">,</span>&nbsp;<span class="ident" id="4361244">p</span><span class="op" id="4361245">.</span><span class="ident" id="4361246">tok</span><span class="op" id="4361249">.</span><span class="ident" id="4361250">IsKeyword</span><span class="op" id="4361259">(</span><span class="op" id="4361260">)</span><span class="op" id="4361261">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4361266">p</span><span class="op" id="4361267">.</span><span class="ident" id="4361268">printTrace</span><span class="op" id="4361278">(</span><span class="string" id="4361279">&#34;\&#34;&#34;</span>&nbsp;<span class="op" id="4361284">+</span>&nbsp;<span class="ident" id="4361286">s</span>&nbsp;<span class="op" id="4361288">+</span>&nbsp;<span class="string" id="4361290">&#34;\&#34;&#34;</span><span class="op" id="4361294">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4361298">default</span><span class="op" id="4361305">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4361310">p</span><span class="op" id="4361311">.</span><span class="ident" id="4361312">printTrace</span><span class="op" id="4361322">(</span><span class="ident" id="4361323">s</span><span class="op" id="4361324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4361328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4361331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4361335">p</span><span class="op" id="4361336">.</span><span class="ident" id="4361337">pos</span><span class="op" id="4361340">,</span>&nbsp;<span class="ident" id="4361342">p</span><span class="op" id="4361343">.</span><span class="ident" id="4361344">tok</span><span class="op" id="4361347">,</span>&nbsp;<span class="ident" id="4361349">p</span><span class="op" id="4361350">.</span><span class="ident" id="4361351">lit</span>&nbsp;<span class="op" id="4361355">=</span>&nbsp;<span class="ident" id="4361357">p</span><span class="op" id="4361358">.</span><span class="ident" id="4361359">scanner</span><span class="op" id="4361366">.</span><span class="ident" id="4361367">Scan</span><span class="op" id="4361371">(</span><span class="op" id="4361372">)</span><br>
<span class="lineno"></span><span class="op" id="4361374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4361377">//&nbsp;Consume&nbsp;a&nbsp;comment&nbsp;and&nbsp;return&nbsp;it&nbsp;and&nbsp;the&nbsp;line&nbsp;on&nbsp;which&nbsp;it&nbsp;ends.</span><br>
<span class="lineno"></span><span class="keyword" id="4361443">func</span>&nbsp;<span class="op" id="4361448">(</span><span class="ident" id="4361449">p</span>&nbsp;<span class="op" id="4361451">*</span><span class="ident" id="4361452">parser</span><span class="op" id="4361458">)</span>&nbsp;<span class="ident" id="4361460">consumeComment</span><span class="op" id="4361474">(</span><span class="op" id="4361475">)</span>&nbsp;<span class="op" id="4361477">(</span><span class="ident" id="4361478">comment</span>&nbsp;<span class="op" id="4361486">*</span><span class="ident" id="4361487">ast</span><span class="op" id="4361490">.</span><span class="ident" id="4361491">Comment</span><span class="op" id="4361498">,</span>&nbsp;<span class="ident" id="4361500">endline</span>&nbsp;<span class="builtintype" id="4361508">int</span><span class="op" id="4361511">)</span>&nbsp;<span class="op" id="4361513">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4361516">//&nbsp;/*-style&nbsp;comments&nbsp;may&nbsp;end&nbsp;on&nbsp;a&nbsp;different&nbsp;line&nbsp;than&nbsp;where&nbsp;they&nbsp;start.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4361589">//&nbsp;Scan&nbsp;the&nbsp;comment&nbsp;for&nbsp;&#39;\n&#39;&nbsp;chars&nbsp;and&nbsp;adjust&nbsp;endline&nbsp;accordingly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4361657">endline</span>&nbsp;<span class="op" id="4361665">=</span>&nbsp;<span class="ident" id="4361667">p</span><span class="op" id="4361668">.</span><span class="ident" id="4361669">file</span><span class="op" id="4361673">.</span><span class="ident" id="4361674">Line</span><span class="op" id="4361678">(</span><span class="ident" id="4361679">p</span><span class="op" id="4361680">.</span><span class="ident" id="4361681">pos</span><span class="op" id="4361684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4361687">if</span>&nbsp;<span class="ident" id="4361690">p</span><span class="op" id="4361691">.</span><span class="ident" id="4361692">lit</span><span class="op" id="4361695">[</span><span class="num" id="4361696">1</span><span class="op" id="4361697">]</span>&nbsp;<span class="op" id="4361699">==</span>&nbsp;<span class="string" id="4361702">&#39;*&#39;</span>&nbsp;<span class="op" id="4361706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4361710">//&nbsp;don&#39;t&nbsp;use&nbsp;range&nbsp;here&nbsp;-&nbsp;no&nbsp;need&nbsp;to&nbsp;decode&nbsp;Unicode&nbsp;code&nbsp;points</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4361776">for</span>&nbsp;<span class="ident" id="4361780">i</span>&nbsp;<span class="op" id="4361782">:=</span>&nbsp;<span class="num" id="4361785">0</span><span class="op" id="4361786">;</span>&nbsp;<span class="ident" id="4361788">i</span>&nbsp;<span class="op" id="4361790">&lt;</span>&nbsp;<span class="builtinfunc" id="4361792">len</span><span class="op" id="4361795">(</span><span class="ident" id="4361796">p</span><span class="op" id="4361797">.</span><span class="ident" id="4361798">lit</span><span class="op" id="4361801">)</span><span class="op" id="4361802">;</span>&nbsp;<span class="ident" id="4361804">i</span><span class="op" id="4361805">++</span>&nbsp;<span class="op" id="4361808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4361813">if</span>&nbsp;<span class="ident" id="4361816">p</span><span class="op" id="4361817">.</span><span class="ident" id="4361818">lit</span><span class="op" id="4361821">[</span><span class="ident" id="4361822">i</span><span class="op" id="4361823">]</span>&nbsp;<span class="op" id="4361825">==</span>&nbsp;<span class="string" id="4361828">&#39;\n&#39;</span>&nbsp;<span class="op" id="4361833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4361839">endline</span><span class="op" id="4361846">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4361852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4361856">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4361859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4361863">comment</span>&nbsp;<span class="op" id="4361871">=</span>&nbsp;<span class="op" id="4361873">&amp;</span><span class="ident" id="4361874">ast</span><span class="op" id="4361877">.</span><span class="ident" id="4361878">Comment</span><span class="op" id="4361885">{</span><span class="ident" id="4361886">Slash</span><span class="op" id="4361891">:</span>&nbsp;<span class="ident" id="4361893">p</span><span class="op" id="4361894">.</span><span class="ident" id="4361895">pos</span><span class="op" id="4361898">,</span>&nbsp;<span class="ident" id="4361900">Text</span><span class="op" id="4361904">:</span>&nbsp;<span class="ident" id="4361906">p</span><span class="op" id="4361907">.</span><span class="ident" id="4361908">lit</span><span class="op" id="4361911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4361914">p</span><span class="op" id="4361915">.</span><span class="ident" id="4361916">next0</span><span class="op" id="4361921">(</span><span class="op" id="4361922">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4361926">return</span><br>
<span class="lineno"></span><span class="op" id="4361933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4361936">//&nbsp;Consume&nbsp;a&nbsp;group&nbsp;of&nbsp;adjacent&nbsp;comments,&nbsp;add&nbsp;it&nbsp;to&nbsp;the&nbsp;parser&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4362000">//&nbsp;comments&nbsp;list,&nbsp;and&nbsp;return&nbsp;it&nbsp;together&nbsp;with&nbsp;the&nbsp;line&nbsp;at&nbsp;which</span><br>
<span class="lineno">275</span><span class="comment" id="4362064">//&nbsp;the&nbsp;last&nbsp;comment&nbsp;in&nbsp;the&nbsp;group&nbsp;ends.&nbsp;A&nbsp;non-comment&nbsp;token&nbsp;or&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="4362128">//&nbsp;empty&nbsp;lines&nbsp;terminate&nbsp;a&nbsp;comment&nbsp;group.</span><br>
<span class="lineno"></span><span class="comment" id="4362170">//</span><br>
<span class="lineno"></span><span class="keyword" id="4362173">func</span>&nbsp;<span class="op" id="4362178">(</span><span class="ident" id="4362179">p</span>&nbsp;<span class="op" id="4362181">*</span><span class="ident" id="4362182">parser</span><span class="op" id="4362188">)</span>&nbsp;<span class="ident" id="4362190">consumeCommentGroup</span><span class="op" id="4362209">(</span><span class="ident" id="4362210">n</span>&nbsp;<span class="builtintype" id="4362212">int</span><span class="op" id="4362215">)</span>&nbsp;<span class="op" id="4362217">(</span><span class="ident" id="4362218">comments</span>&nbsp;<span class="op" id="4362227">*</span><span class="ident" id="4362228">ast</span><span class="op" id="4362231">.</span><span class="ident" id="4362232">CommentGroup</span><span class="op" id="4362244">,</span>&nbsp;<span class="ident" id="4362246">endline</span>&nbsp;<span class="builtintype" id="4362254">int</span><span class="op" id="4362257">)</span>&nbsp;<span class="op" id="4362259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4362262">var</span>&nbsp;<span class="ident" id="4362266">list</span>&nbsp;<span class="op" id="4362271">[</span><span class="op" id="4362272">]</span><span class="op" id="4362273">*</span><span class="ident" id="4362274">ast</span><span class="op" id="4362277">.</span><span class="ident" id="4362278">Comment</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4362287">endline</span>&nbsp;<span class="op" id="4362295">=</span>&nbsp;<span class="ident" id="4362297">p</span><span class="op" id="4362298">.</span><span class="ident" id="4362299">file</span><span class="op" id="4362303">.</span><span class="ident" id="4362304">Line</span><span class="op" id="4362308">(</span><span class="ident" id="4362309">p</span><span class="op" id="4362310">.</span><span class="ident" id="4362311">pos</span><span class="op" id="4362314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4362317">for</span>&nbsp;<span class="ident" id="4362321">p</span><span class="op" id="4362322">.</span><span class="ident" id="4362323">tok</span>&nbsp;<span class="op" id="4362327">==</span>&nbsp;<span class="ident" id="4362330">token</span><span class="op" id="4362335">.</span><span class="ident" id="4362336">COMMENT</span>&nbsp;<span class="op" id="4362344">&amp;&amp;</span>&nbsp;<span class="ident" id="4362347">p</span><span class="op" id="4362348">.</span><span class="ident" id="4362349">file</span><span class="op" id="4362353">.</span><span class="ident" id="4362354">Line</span><span class="op" id="4362358">(</span><span class="ident" id="4362359">p</span><span class="op" id="4362360">.</span><span class="ident" id="4362361">pos</span><span class="op" id="4362364">)</span>&nbsp;<span class="op" id="4362366">&lt;=</span>&nbsp;<span class="ident" id="4362369">endline</span><span class="op" id="4362376">+</span><span class="ident" id="4362377">n</span>&nbsp;<span class="op" id="4362379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4362383">var</span>&nbsp;<span class="ident" id="4362387">comment</span>&nbsp;<span class="op" id="4362395">*</span><span class="ident" id="4362396">ast</span><span class="op" id="4362399">.</span><span class="ident" id="4362400">Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4362410">comment</span><span class="op" id="4362417">,</span>&nbsp;<span class="ident" id="4362419">endline</span>&nbsp;<span class="op" id="4362427">=</span>&nbsp;<span class="ident" id="4362429">p</span><span class="op" id="4362430">.</span><span class="ident" id="4362431">consumeComment</span><span class="op" id="4362445">(</span><span class="op" id="4362446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4362450">list</span>&nbsp;<span class="op" id="4362455">=</span>&nbsp;<span class="builtinfunc" id="4362457">append</span><span class="op" id="4362463">(</span><span class="ident" id="4362464">list</span><span class="op" id="4362468">,</span>&nbsp;<span class="ident" id="4362470">comment</span><span class="op" id="4362477">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4362480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4362484">//&nbsp;add&nbsp;comment&nbsp;group&nbsp;to&nbsp;the&nbsp;comments&nbsp;list</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4362527">comments</span>&nbsp;<span class="op" id="4362536">=</span>&nbsp;<span class="op" id="4362538">&amp;</span><span class="ident" id="4362539">ast</span><span class="op" id="4362542">.</span><span class="ident" id="4362543">CommentGroup</span><span class="op" id="4362555">{</span><span class="ident" id="4362556">List</span><span class="op" id="4362560">:</span>&nbsp;<span class="ident" id="4362562">list</span><span class="op" id="4362566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4362569">p</span><span class="op" id="4362570">.</span><span class="ident" id="4362571">comments</span>&nbsp;<span class="op" id="4362580">=</span>&nbsp;<span class="builtinfunc" id="4362582">append</span><span class="op" id="4362588">(</span><span class="ident" id="4362589">p</span><span class="op" id="4362590">.</span><span class="ident" id="4362591">comments</span><span class="op" id="4362599">,</span>&nbsp;<span class="ident" id="4362601">comments</span><span class="op" id="4362609">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4362613">return</span><br>
<span class="lineno"></span><span class="op" id="4362620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4362623">//&nbsp;Advance&nbsp;to&nbsp;the&nbsp;next&nbsp;non-comment&nbsp;token.&nbsp;In&nbsp;the&nbsp;process,&nbsp;collect</span><br>
<span class="lineno">295</span><span class="comment" id="4362689">//&nbsp;any&nbsp;comment&nbsp;groups&nbsp;encountered,&nbsp;and&nbsp;remember&nbsp;the&nbsp;last&nbsp;lead&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4362755">//&nbsp;and&nbsp;line&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="4362777">//</span><br>
<span class="lineno"></span><span class="comment" id="4362780">//&nbsp;A&nbsp;lead&nbsp;comment&nbsp;is&nbsp;a&nbsp;comment&nbsp;group&nbsp;that&nbsp;starts&nbsp;and&nbsp;ends&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4362843">//&nbsp;line&nbsp;without&nbsp;any&nbsp;other&nbsp;tokens&nbsp;and&nbsp;that&nbsp;is&nbsp;followed&nbsp;by&nbsp;a&nbsp;non-comment</span><br>
<span class="lineno">300</span><span class="comment" id="4362914">//&nbsp;token&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;after&nbsp;the&nbsp;comment&nbsp;group.</span><br>
<span class="lineno"></span><span class="comment" id="4362972">//</span><br>
<span class="lineno"></span><span class="comment" id="4362975">//&nbsp;A&nbsp;line&nbsp;comment&nbsp;is&nbsp;a&nbsp;comment&nbsp;group&nbsp;that&nbsp;follows&nbsp;a&nbsp;non-comment</span><br>
<span class="lineno"></span><span class="comment" id="4363039">//&nbsp;token&nbsp;on&nbsp;the&nbsp;same&nbsp;line,&nbsp;and&nbsp;that&nbsp;has&nbsp;no&nbsp;tokens&nbsp;after&nbsp;it&nbsp;on&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4363110">//&nbsp;where&nbsp;it&nbsp;ends.</span><br>
<span class="lineno">305</span><span class="comment" id="4363128">//</span><br>
<span class="lineno"></span><span class="comment" id="4363131">//&nbsp;Lead&nbsp;and&nbsp;line&nbsp;comments&nbsp;may&nbsp;be&nbsp;considered&nbsp;documentation&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4363197">//&nbsp;stored&nbsp;in&nbsp;the&nbsp;AST.</span><br>
<span class="lineno"></span><span class="comment" id="4363219">//</span><br>
<span class="lineno"></span><span class="keyword" id="4363222">func</span>&nbsp;<span class="op" id="4363227">(</span><span class="ident" id="4363228">p</span>&nbsp;<span class="op" id="4363230">*</span><span class="ident" id="4363231">parser</span><span class="op" id="4363237">)</span>&nbsp;<span class="ident" id="4363239">next</span><span class="op" id="4363243">(</span><span class="op" id="4363244">)</span>&nbsp;<span class="op" id="4363246">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4363249">p</span><span class="op" id="4363250">.</span><span class="ident" id="4363251">leadComment</span>&nbsp;<span class="op" id="4363263">=</span>&nbsp;<span class="ident" id="4363265">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4363270">p</span><span class="op" id="4363271">.</span><span class="ident" id="4363272">lineComment</span>&nbsp;<span class="op" id="4363284">=</span>&nbsp;<span class="ident" id="4363286">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4363291">prev</span>&nbsp;<span class="op" id="4363296">:=</span>&nbsp;<span class="ident" id="4363299">p</span><span class="op" id="4363300">.</span><span class="ident" id="4363301">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4363306">p</span><span class="op" id="4363307">.</span><span class="ident" id="4363308">next0</span><span class="op" id="4363313">(</span><span class="op" id="4363314">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4363318">if</span>&nbsp;<span class="ident" id="4363321">p</span><span class="op" id="4363322">.</span><span class="ident" id="4363323">tok</span>&nbsp;<span class="op" id="4363327">==</span>&nbsp;<span class="ident" id="4363330">token</span><span class="op" id="4363335">.</span><span class="ident" id="4363336">COMMENT</span>&nbsp;<span class="op" id="4363344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4363348">var</span>&nbsp;<span class="ident" id="4363352">comment</span>&nbsp;<span class="op" id="4363360">*</span><span class="ident" id="4363361">ast</span><span class="op" id="4363364">.</span><span class="ident" id="4363365">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4363380">var</span>&nbsp;<span class="ident" id="4363384">endline</span>&nbsp;<span class="builtintype" id="4363392">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4363399">if</span>&nbsp;<span class="ident" id="4363402">p</span><span class="op" id="4363403">.</span><span class="ident" id="4363404">file</span><span class="op" id="4363408">.</span><span class="ident" id="4363409">Line</span><span class="op" id="4363413">(</span><span class="ident" id="4363414">p</span><span class="op" id="4363415">.</span><span class="ident" id="4363416">pos</span><span class="op" id="4363419">)</span>&nbsp;<span class="op" id="4363421">==</span>&nbsp;<span class="ident" id="4363424">p</span><span class="op" id="4363425">.</span><span class="ident" id="4363426">file</span><span class="op" id="4363430">.</span><span class="ident" id="4363431">Line</span><span class="op" id="4363435">(</span><span class="ident" id="4363436">prev</span><span class="op" id="4363440">)</span>&nbsp;<span class="op" id="4363442">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4363447">//&nbsp;The&nbsp;comment&nbsp;is&nbsp;on&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;previous&nbsp;token;&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4363507">//&nbsp;cannot&nbsp;be&nbsp;a&nbsp;lead&nbsp;comment&nbsp;but&nbsp;may&nbsp;be&nbsp;a&nbsp;line&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4363565">comment</span><span class="op" id="4363572">,</span>&nbsp;<span class="ident" id="4363574">endline</span>&nbsp;<span class="op" id="4363582">=</span>&nbsp;<span class="ident" id="4363584">p</span><span class="op" id="4363585">.</span><span class="ident" id="4363586">consumeCommentGroup</span><span class="op" id="4363605">(</span><span class="num" id="4363606">0</span><span class="op" id="4363607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4363612">if</span>&nbsp;<span class="ident" id="4363615">p</span><span class="op" id="4363616">.</span><span class="ident" id="4363617">file</span><span class="op" id="4363621">.</span><span class="ident" id="4363622">Line</span><span class="op" id="4363626">(</span><span class="ident" id="4363627">p</span><span class="op" id="4363628">.</span><span class="ident" id="4363629">pos</span><span class="op" id="4363632">)</span>&nbsp;<span class="op" id="4363634">!=</span>&nbsp;<span class="ident" id="4363637">endline</span>&nbsp;<span class="op" id="4363645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4363651">//&nbsp;The&nbsp;next&nbsp;token&nbsp;is&nbsp;on&nbsp;a&nbsp;different&nbsp;line,&nbsp;thus</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4363702">//&nbsp;the&nbsp;last&nbsp;comment&nbsp;group&nbsp;is&nbsp;a&nbsp;line&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4363751">p</span><span class="op" id="4363752">.</span><span class="ident" id="4363753">lineComment</span>&nbsp;<span class="op" id="4363765">=</span>&nbsp;<span class="ident" id="4363767">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4363778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4363782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4363787">//&nbsp;consume&nbsp;successor&nbsp;comments,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4363827">endline</span>&nbsp;<span class="op" id="4363835">=</span>&nbsp;<span class="op" id="4363837">-</span><span class="num" id="4363838">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4363842">for</span>&nbsp;<span class="ident" id="4363846">p</span><span class="op" id="4363847">.</span><span class="ident" id="4363848">tok</span>&nbsp;<span class="op" id="4363852">==</span>&nbsp;<span class="ident" id="4363855">token</span><span class="op" id="4363860">.</span><span class="ident" id="4363861">COMMENT</span>&nbsp;<span class="op" id="4363869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4363874">comment</span><span class="op" id="4363881">,</span>&nbsp;<span class="ident" id="4363883">endline</span>&nbsp;<span class="op" id="4363891">=</span>&nbsp;<span class="ident" id="4363893">p</span><span class="op" id="4363894">.</span><span class="ident" id="4363895">consumeCommentGroup</span><span class="op" id="4363914">(</span><span class="num" id="4363915">1</span><span class="op" id="4363916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4363920">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4363925">if</span>&nbsp;<span class="ident" id="4363928">endline</span><span class="op" id="4363935">+</span><span class="num" id="4363936">1</span>&nbsp;<span class="op" id="4363938">==</span>&nbsp;<span class="ident" id="4363941">p</span><span class="op" id="4363942">.</span><span class="ident" id="4363943">file</span><span class="op" id="4363947">.</span><span class="ident" id="4363948">Line</span><span class="op" id="4363952">(</span><span class="ident" id="4363953">p</span><span class="op" id="4363954">.</span><span class="ident" id="4363955">pos</span><span class="op" id="4363958">)</span>&nbsp;<span class="op" id="4363960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4363965">//&nbsp;The&nbsp;next&nbsp;token&nbsp;is&nbsp;following&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4364033">//&nbsp;comment&nbsp;group,&nbsp;thus&nbsp;the&nbsp;last&nbsp;comment&nbsp;group&nbsp;is&nbsp;a&nbsp;lead&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4364101">p</span><span class="op" id="4364102">.</span><span class="ident" id="4364103">leadComment</span>&nbsp;<span class="op" id="4364115">=</span>&nbsp;<span class="ident" id="4364117">comment</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4364127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4364130">}</span><br>
<span class="lineno"></span><span class="op" id="4364132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4364135">//&nbsp;A&nbsp;bailout&nbsp;panic&nbsp;is&nbsp;raised&nbsp;to&nbsp;indicate&nbsp;early&nbsp;termination.</span><br>
<span class="lineno">345</span><span class="keyword" id="4364195">type</span>&nbsp;<span class="ident" id="4364200">bailout</span>&nbsp;<span class="keyword" id="4364208">struct</span><span class="op" id="4364214">{</span><span class="op" id="4364215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4364218">func</span>&nbsp;<span class="op" id="4364223">(</span><span class="ident" id="4364224">p</span>&nbsp;<span class="op" id="4364226">*</span><span class="ident" id="4364227">parser</span><span class="op" id="4364233">)</span>&nbsp;<span class="builtintype" id="4364235">error</span><span class="op" id="4364240">(</span><span class="ident" id="4364241">pos</span>&nbsp;<span class="ident" id="4364245">token</span><span class="op" id="4364250">.</span><span class="ident" id="4364251">Pos</span><span class="op" id="4364254">,</span>&nbsp;<span class="ident" id="4364256">msg</span>&nbsp;<span class="builtintype" id="4364260">string</span><span class="op" id="4364266">)</span>&nbsp;<span class="op" id="4364268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4364271">epos</span>&nbsp;<span class="op" id="4364276">:=</span>&nbsp;<span class="ident" id="4364279">p</span><span class="op" id="4364280">.</span><span class="ident" id="4364281">file</span><span class="op" id="4364285">.</span><span class="ident" id="4364286">Position</span><span class="op" id="4364294">(</span><span class="ident" id="4364295">pos</span><span class="op" id="4364298">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4364302">//&nbsp;If&nbsp;AllErrors&nbsp;is&nbsp;not&nbsp;set,&nbsp;discard&nbsp;errors&nbsp;reported&nbsp;on&nbsp;the&nbsp;same&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4364372">//&nbsp;as&nbsp;the&nbsp;last&nbsp;recorded&nbsp;error&nbsp;and&nbsp;stop&nbsp;parsing&nbsp;if&nbsp;there&nbsp;are&nbsp;more&nbsp;than</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4364443">//&nbsp;10&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4364458">if</span>&nbsp;<span class="ident" id="4364461">p</span><span class="op" id="4364462">.</span><span class="ident" id="4364463">mode</span><span class="op" id="4364467">&amp;</span><span class="ident" id="4364468">AllErrors</span>&nbsp;<span class="op" id="4364478">==</span>&nbsp;<span class="num" id="4364481">0</span>&nbsp;<span class="op" id="4364483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4364487">n</span>&nbsp;<span class="op" id="4364489">:=</span>&nbsp;<span class="builtinfunc" id="4364492">len</span><span class="op" id="4364495">(</span><span class="ident" id="4364496">p</span><span class="op" id="4364497">.</span><span class="ident" id="4364498">errors</span><span class="op" id="4364504">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4364508">if</span>&nbsp;<span class="ident" id="4364511">n</span>&nbsp;<span class="op" id="4364513">&gt;</span>&nbsp;<span class="num" id="4364515">0</span>&nbsp;<span class="op" id="4364517">&amp;&amp;</span>&nbsp;<span class="ident" id="4364520">p</span><span class="op" id="4364521">.</span><span class="ident" id="4364522">errors</span><span class="op" id="4364528">[</span><span class="ident" id="4364529">n</span><span class="op" id="4364530">-</span><span class="num" id="4364531">1</span><span class="op" id="4364532">]</span><span class="op" id="4364533">.</span><span class="ident" id="4364534">Pos</span><span class="op" id="4364537">.</span><span class="ident" id="4364538">Line</span>&nbsp;<span class="op" id="4364543">==</span>&nbsp;<span class="ident" id="4364546">epos</span><span class="op" id="4364550">.</span><span class="ident" id="4364551">Line</span>&nbsp;<span class="op" id="4364556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4364561">return</span>&nbsp;<span class="comment" id="4364568">//&nbsp;discard&nbsp;-&nbsp;likely&nbsp;a&nbsp;spurious&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4364607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4364611">if</span>&nbsp;<span class="ident" id="4364614">n</span>&nbsp;<span class="op" id="4364616">&gt;</span>&nbsp;<span class="num" id="4364618">10</span>&nbsp;<span class="op" id="4364621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4364626">panic</span><span class="op" id="4364631">(</span><span class="ident" id="4364632">bailout</span><span class="op" id="4364639">{</span><span class="op" id="4364640">}</span><span class="op" id="4364641">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4364645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4364648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4364652">p</span><span class="op" id="4364653">.</span><span class="ident" id="4364654">errors</span><span class="op" id="4364660">.</span><span class="ident" id="4364661">Add</span><span class="op" id="4364664">(</span><span class="ident" id="4364665">epos</span><span class="op" id="4364669">,</span>&nbsp;<span class="ident" id="4364671">msg</span><span class="op" id="4364674">)</span><br>
<span class="lineno"></span><span class="op" id="4364676">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="4364679">func</span>&nbsp;<span class="op" id="4364684">(</span><span class="ident" id="4364685">p</span>&nbsp;<span class="op" id="4364687">*</span><span class="ident" id="4364688">parser</span><span class="op" id="4364694">)</span>&nbsp;<span class="ident" id="4364696">errorExpected</span><span class="op" id="4364709">(</span><span class="ident" id="4364710">pos</span>&nbsp;<span class="ident" id="4364714">token</span><span class="op" id="4364719">.</span><span class="ident" id="4364720">Pos</span><span class="op" id="4364723">,</span>&nbsp;<span class="ident" id="4364725">msg</span>&nbsp;<span class="builtintype" id="4364729">string</span><span class="op" id="4364735">)</span>&nbsp;<span class="op" id="4364737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4364740">msg</span>&nbsp;<span class="op" id="4364744">=</span>&nbsp;<span class="string" id="4364746">&#34;expected&nbsp;&#34;</span>&nbsp;<span class="op" id="4364758">+</span>&nbsp;<span class="ident" id="4364760">msg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4364765">if</span>&nbsp;<span class="ident" id="4364768">pos</span>&nbsp;<span class="op" id="4364772">==</span>&nbsp;<span class="ident" id="4364775">p</span><span class="op" id="4364776">.</span><span class="ident" id="4364777">pos</span>&nbsp;<span class="op" id="4364781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4364785">//&nbsp;the&nbsp;error&nbsp;happened&nbsp;at&nbsp;the&nbsp;current&nbsp;position;</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4364834">//&nbsp;make&nbsp;the&nbsp;error&nbsp;message&nbsp;more&nbsp;specific</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4364876">if</span>&nbsp;<span class="ident" id="4364879">p</span><span class="op" id="4364880">.</span><span class="ident" id="4364881">tok</span>&nbsp;<span class="op" id="4364885">==</span>&nbsp;<span class="ident" id="4364888">token</span><span class="op" id="4364893">.</span><span class="ident" id="4364894">SEMICOLON</span>&nbsp;<span class="op" id="4364904">&amp;&amp;</span>&nbsp;<span class="ident" id="4364907">p</span><span class="op" id="4364908">.</span><span class="ident" id="4364909">lit</span>&nbsp;<span class="op" id="4364913">==</span>&nbsp;<span class="string" id="4364916">&#34;\n&#34;</span>&nbsp;<span class="op" id="4364921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4364926">msg</span>&nbsp;<span class="op" id="4364930">+=</span>&nbsp;<span class="string" id="4364933">&#34;,&nbsp;found&nbsp;newline&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4364953">}</span>&nbsp;<span class="keyword" id="4364955">else</span>&nbsp;<span class="op" id="4364960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4364965">msg</span>&nbsp;<span class="op" id="4364969">+=</span>&nbsp;<span class="string" id="4364972">&#34;,&nbsp;found&nbsp;&#39;&#34;</span>&nbsp;<span class="op" id="4364984">+</span>&nbsp;<span class="ident" id="4364986">p</span><span class="op" id="4364987">.</span><span class="ident" id="4364988">tok</span><span class="op" id="4364991">.</span><span class="ident" id="4364992">String</span><span class="op" id="4364998">(</span><span class="op" id="4364999">)</span>&nbsp;<span class="op" id="4365001">+</span>&nbsp;<span class="string" id="4365003">&#34;&#39;&#34;</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4365010">if</span>&nbsp;<span class="ident" id="4365013">p</span><span class="op" id="4365014">.</span><span class="ident" id="4365015">tok</span><span class="op" id="4365018">.</span><span class="ident" id="4365019">IsLiteral</span><span class="op" id="4365028">(</span><span class="op" id="4365029">)</span>&nbsp;<span class="op" id="4365031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4365037">msg</span>&nbsp;<span class="op" id="4365041">+=</span>&nbsp;<span class="string" id="4365044">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="4365048">+</span>&nbsp;<span class="ident" id="4365050">p</span><span class="op" id="4365051">.</span><span class="ident" id="4365052">lit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4365059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4365063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4365066">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4365069">p</span><span class="op" id="4365070">.</span><span class="builtintype" id="4365071">error</span><span class="op" id="4365076">(</span><span class="ident" id="4365077">pos</span><span class="op" id="4365080">,</span>&nbsp;<span class="ident" id="4365082">msg</span><span class="op" id="4365085">)</span><br>
<span class="lineno"></span><span class="op" id="4365087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4365090">func</span>&nbsp;<span class="op" id="4365095">(</span><span class="ident" id="4365096">p</span>&nbsp;<span class="op" id="4365098">*</span><span class="ident" id="4365099">parser</span><span class="op" id="4365105">)</span>&nbsp;<span class="ident" id="4365107">expect</span><span class="op" id="4365113">(</span><span class="ident" id="4365114">tok</span>&nbsp;<span class="ident" id="4365118">token</span><span class="op" id="4365123">.</span><span class="ident" id="4365124">Token</span><span class="op" id="4365129">)</span>&nbsp;<span class="ident" id="4365131">token</span><span class="op" id="4365136">.</span><span class="ident" id="4365137">Pos</span>&nbsp;<span class="op" id="4365141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4365144">pos</span>&nbsp;<span class="op" id="4365148">:=</span>&nbsp;<span class="ident" id="4365151">p</span><span class="op" id="4365152">.</span><span class="ident" id="4365153">pos</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4365158">if</span>&nbsp;<span class="ident" id="4365161">p</span><span class="op" id="4365162">.</span><span class="ident" id="4365163">tok</span>&nbsp;<span class="op" id="4365167">!=</span>&nbsp;<span class="ident" id="4365170">tok</span>&nbsp;<span class="op" id="4365174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4365178">p</span><span class="op" id="4365179">.</span><span class="ident" id="4365180">errorExpected</span><span class="op" id="4365193">(</span><span class="ident" id="4365194">pos</span><span class="op" id="4365197">,</span>&nbsp;<span class="string" id="4365199">&#34;&#39;&#34;</span><span class="op" id="4365202">+</span><span class="ident" id="4365203">tok</span><span class="op" id="4365206">.</span><span class="ident" id="4365207">String</span><span class="op" id="4365213">(</span><span class="op" id="4365214">)</span><span class="op" id="4365215">+</span><span class="string" id="4365216">&#34;&#39;&#34;</span><span class="op" id="4365219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4365222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4365225">p</span><span class="op" id="4365226">.</span><span class="ident" id="4365227">next</span><span class="op" id="4365231">(</span><span class="op" id="4365232">)</span>&nbsp;<span class="comment" id="4365234">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4365252">return</span>&nbsp;<span class="ident" id="4365259">pos</span><br>
<span class="lineno">390</span><span class="op" id="4365263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4365266">//&nbsp;expectClosing&nbsp;is&nbsp;like&nbsp;expect&nbsp;but&nbsp;provides&nbsp;a&nbsp;better&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="4365334">//&nbsp;for&nbsp;the&nbsp;common&nbsp;case&nbsp;of&nbsp;a&nbsp;missing&nbsp;comma&nbsp;before&nbsp;a&nbsp;newline.</span><br>
<span class="lineno"></span><span class="comment" id="4365394">//</span><br>
<span class="lineno">395</span><span class="keyword" id="4365397">func</span>&nbsp;<span class="op" id="4365402">(</span><span class="ident" id="4365403">p</span>&nbsp;<span class="op" id="4365405">*</span><span class="ident" id="4365406">parser</span><span class="op" id="4365412">)</span>&nbsp;<span class="ident" id="4365414">expectClosing</span><span class="op" id="4365427">(</span><span class="ident" id="4365428">tok</span>&nbsp;<span class="ident" id="4365432">token</span><span class="op" id="4365437">.</span><span class="ident" id="4365438">Token</span><span class="op" id="4365443">,</span>&nbsp;<span class="ident" id="4365445">context</span>&nbsp;<span class="builtintype" id="4365453">string</span><span class="op" id="4365459">)</span>&nbsp;<span class="ident" id="4365461">token</span><span class="op" id="4365466">.</span><span class="ident" id="4365467">Pos</span>&nbsp;<span class="op" id="4365471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4365474">if</span>&nbsp;<span class="ident" id="4365477">p</span><span class="op" id="4365478">.</span><span class="ident" id="4365479">tok</span>&nbsp;<span class="op" id="4365483">!=</span>&nbsp;<span class="ident" id="4365486">tok</span>&nbsp;<span class="op" id="4365490">&amp;&amp;</span>&nbsp;<span class="ident" id="4365493">p</span><span class="op" id="4365494">.</span><span class="ident" id="4365495">tok</span>&nbsp;<span class="op" id="4365499">==</span>&nbsp;<span class="ident" id="4365502">token</span><span class="op" id="4365507">.</span><span class="ident" id="4365508">SEMICOLON</span>&nbsp;<span class="op" id="4365518">&amp;&amp;</span>&nbsp;<span class="ident" id="4365521">p</span><span class="op" id="4365522">.</span><span class="ident" id="4365523">lit</span>&nbsp;<span class="op" id="4365527">==</span>&nbsp;<span class="string" id="4365530">&#34;\n&#34;</span>&nbsp;<span class="op" id="4365535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4365539">p</span><span class="op" id="4365540">.</span><span class="builtintype" id="4365541">error</span><span class="op" id="4365546">(</span><span class="ident" id="4365547">p</span><span class="op" id="4365548">.</span><span class="ident" id="4365549">pos</span><span class="op" id="4365552">,</span>&nbsp;<span class="string" id="4365554">&#34;missing&nbsp;&#39;,&#39;&nbsp;before&nbsp;newline&nbsp;in&nbsp;&#34;</span><span class="op" id="4365586">+</span><span class="ident" id="4365587">context</span><span class="op" id="4365594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4365598">p</span><span class="op" id="4365599">.</span><span class="ident" id="4365600">next</span><span class="op" id="4365604">(</span><span class="op" id="4365605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4365608">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4365611">return</span>&nbsp;<span class="ident" id="4365618">p</span><span class="op" id="4365619">.</span><span class="ident" id="4365620">expect</span><span class="op" id="4365626">(</span><span class="ident" id="4365627">tok</span><span class="op" id="4365630">)</span><br>
<span class="lineno"></span><span class="op" id="4365632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4365635">func</span>&nbsp;<span class="op" id="4365640">(</span><span class="ident" id="4365641">p</span>&nbsp;<span class="op" id="4365643">*</span><span class="ident" id="4365644">parser</span><span class="op" id="4365650">)</span>&nbsp;<span class="ident" id="4365652">expectSemi</span><span class="op" id="4365662">(</span><span class="op" id="4365663">)</span>&nbsp;<span class="op" id="4365665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4365668">//&nbsp;semicolon&nbsp;is&nbsp;optional&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#39;)&#39;&nbsp;or&nbsp;&#39;}&#39;</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4365722">if</span>&nbsp;<span class="ident" id="4365725">p</span><span class="op" id="4365726">.</span><span class="ident" id="4365727">tok</span>&nbsp;<span class="op" id="4365731">!=</span>&nbsp;<span class="ident" id="4365734">token</span><span class="op" id="4365739">.</span><span class="ident" id="4365740">RPAREN</span>&nbsp;<span class="op" id="4365747">&amp;&amp;</span>&nbsp;<span class="ident" id="4365750">p</span><span class="op" id="4365751">.</span><span class="ident" id="4365752">tok</span>&nbsp;<span class="op" id="4365756">!=</span>&nbsp;<span class="ident" id="4365759">token</span><span class="op" id="4365764">.</span><span class="ident" id="4365765">RBRACE</span>&nbsp;<span class="op" id="4365772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4365776">if</span>&nbsp;<span class="ident" id="4365779">p</span><span class="op" id="4365780">.</span><span class="ident" id="4365781">tok</span>&nbsp;<span class="op" id="4365785">==</span>&nbsp;<span class="ident" id="4365788">token</span><span class="op" id="4365793">.</span><span class="ident" id="4365794">SEMICOLON</span>&nbsp;<span class="op" id="4365804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4365809">p</span><span class="op" id="4365810">.</span><span class="ident" id="4365811">next</span><span class="op" id="4365815">(</span><span class="op" id="4365816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4365820">}</span>&nbsp;<span class="keyword" id="4365822">else</span>&nbsp;<span class="op" id="4365827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4365832">p</span><span class="op" id="4365833">.</span><span class="ident" id="4365834">errorExpected</span><span class="op" id="4365847">(</span><span class="ident" id="4365848">p</span><span class="op" id="4365849">.</span><span class="ident" id="4365850">pos</span><span class="op" id="4365853">,</span>&nbsp;<span class="string" id="4365855">&#34;&#39;;&#39;&#34;</span><span class="op" id="4365860">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4365865">syncStmt</span><span class="op" id="4365873">(</span><span class="ident" id="4365874">p</span><span class="op" id="4365875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4365879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4365882">}</span><br>
<span class="lineno"></span><span class="op" id="4365884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="keyword" id="4365887">func</span>&nbsp;<span class="op" id="4365892">(</span><span class="ident" id="4365893">p</span>&nbsp;<span class="op" id="4365895">*</span><span class="ident" id="4365896">parser</span><span class="op" id="4365902">)</span>&nbsp;<span class="ident" id="4365904">atComma</span><span class="op" id="4365911">(</span><span class="ident" id="4365912">context</span>&nbsp;<span class="builtintype" id="4365920">string</span><span class="op" id="4365926">)</span>&nbsp;<span class="builtintype" id="4365928">bool</span>&nbsp;<span class="op" id="4365933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4365936">if</span>&nbsp;<span class="ident" id="4365939">p</span><span class="op" id="4365940">.</span><span class="ident" id="4365941">tok</span>&nbsp;<span class="op" id="4365945">==</span>&nbsp;<span class="ident" id="4365948">token</span><span class="op" id="4365953">.</span><span class="ident" id="4365954">COMMA</span>&nbsp;<span class="op" id="4365960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4365964">return</span>&nbsp;<span class="builtintype" id="4365971">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4365977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4365980">if</span>&nbsp;<span class="ident" id="4365983">p</span><span class="op" id="4365984">.</span><span class="ident" id="4365985">tok</span>&nbsp;<span class="op" id="4365989">==</span>&nbsp;<span class="ident" id="4365992">token</span><span class="op" id="4365997">.</span><span class="ident" id="4365998">SEMICOLON</span>&nbsp;<span class="op" id="4366008">&amp;&amp;</span>&nbsp;<span class="ident" id="4366011">p</span><span class="op" id="4366012">.</span><span class="ident" id="4366013">lit</span>&nbsp;<span class="op" id="4366017">==</span>&nbsp;<span class="string" id="4366020">&#34;\n&#34;</span>&nbsp;<span class="op" id="4366025">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4366029">p</span><span class="op" id="4366030">.</span><span class="builtintype" id="4366031">error</span><span class="op" id="4366036">(</span><span class="ident" id="4366037">p</span><span class="op" id="4366038">.</span><span class="ident" id="4366039">pos</span><span class="op" id="4366042">,</span>&nbsp;<span class="string" id="4366044">&#34;missing&nbsp;&#39;,&#39;&nbsp;before&nbsp;newline&nbsp;in&nbsp;&#34;</span><span class="op" id="4366076">+</span><span class="ident" id="4366077">context</span><span class="op" id="4366084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4366088">return</span>&nbsp;<span class="builtintype" id="4366095">true</span>&nbsp;<span class="comment" id="4366100">//&nbsp;&#34;insert&#34;&nbsp;the&nbsp;comma&nbsp;and&nbsp;continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4366137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4366140">return</span>&nbsp;<span class="builtintype" id="4366147">false</span><br>
<span class="lineno">425</span><span class="op" id="4366153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4366156">func</span>&nbsp;<span class="ident" id="4366161">assert</span><span class="op" id="4366167">(</span><span class="ident" id="4366168">cond</span>&nbsp;<span class="builtintype" id="4366173">bool</span><span class="op" id="4366177">,</span>&nbsp;<span class="ident" id="4366179">msg</span>&nbsp;<span class="builtintype" id="4366183">string</span><span class="op" id="4366189">)</span>&nbsp;<span class="op" id="4366191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4366194">if</span>&nbsp;<span class="op" id="4366197">!</span><span class="ident" id="4366198">cond</span>&nbsp;<span class="op" id="4366203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4366207">panic</span><span class="op" id="4366212">(</span><span class="string" id="4366213">&#34;go/parser&nbsp;internal&nbsp;error:&nbsp;&#34;</span>&nbsp;<span class="op" id="4366242">+</span>&nbsp;<span class="ident" id="4366244">msg</span><span class="op" id="4366247">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4366250">}</span><br>
<span class="lineno"></span><span class="op" id="4366252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4366255">//&nbsp;syncStmt&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;statement.</span><br>
<span class="lineno"></span><span class="comment" id="4366299">//&nbsp;Used&nbsp;for&nbsp;synchronization&nbsp;after&nbsp;an&nbsp;error.</span><br>
<span class="lineno">435</span><span class="comment" id="4366343">//</span><br>
<span class="lineno"></span><span class="keyword" id="4366346">func</span>&nbsp;<span class="ident" id="4366351">syncStmt</span><span class="op" id="4366359">(</span><span class="ident" id="4366360">p</span>&nbsp;<span class="op" id="4366362">*</span><span class="ident" id="4366363">parser</span><span class="op" id="4366369">)</span>&nbsp;<span class="op" id="4366371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4366374">for</span>&nbsp;<span class="op" id="4366378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4366382">switch</span>&nbsp;<span class="ident" id="4366389">p</span><span class="op" id="4366390">.</span><span class="ident" id="4366391">tok</span>&nbsp;<span class="op" id="4366395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4366399">case</span>&nbsp;<span class="ident" id="4366404">token</span><span class="op" id="4366409">.</span><span class="ident" id="4366410">BREAK</span><span class="op" id="4366415">,</span>&nbsp;<span class="ident" id="4366417">token</span><span class="op" id="4366422">.</span><span class="ident" id="4366423">CONST</span><span class="op" id="4366428">,</span>&nbsp;<span class="ident" id="4366430">token</span><span class="op" id="4366435">.</span><span class="ident" id="4366436">CONTINUE</span><span class="op" id="4366444">,</span>&nbsp;<span class="ident" id="4366446">token</span><span class="op" id="4366451">.</span><span class="ident" id="4366452">DEFER</span><span class="op" id="4366457">,</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4366462">token</span><span class="op" id="4366467">.</span><span class="ident" id="4366468">FALLTHROUGH</span><span class="op" id="4366479">,</span>&nbsp;<span class="ident" id="4366481">token</span><span class="op" id="4366486">.</span><span class="ident" id="4366487">FOR</span><span class="op" id="4366490">,</span>&nbsp;<span class="ident" id="4366492">token</span><span class="op" id="4366497">.</span><span class="ident" id="4366498">GO</span><span class="op" id="4366500">,</span>&nbsp;<span class="ident" id="4366502">token</span><span class="op" id="4366507">.</span><span class="ident" id="4366508">GOTO</span><span class="op" id="4366512">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4366517">token</span><span class="op" id="4366522">.</span><span class="ident" id="4366523">IF</span><span class="op" id="4366525">,</span>&nbsp;<span class="ident" id="4366527">token</span><span class="op" id="4366532">.</span><span class="ident" id="4366533">RETURN</span><span class="op" id="4366539">,</span>&nbsp;<span class="ident" id="4366541">token</span><span class="op" id="4366546">.</span><span class="ident" id="4366547">SELECT</span><span class="op" id="4366553">,</span>&nbsp;<span class="ident" id="4366555">token</span><span class="op" id="4366560">.</span><span class="ident" id="4366561">SWITCH</span><span class="op" id="4366567">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4366572">token</span><span class="op" id="4366577">.</span><span class="ident" id="4366578">TYPE</span><span class="op" id="4366582">,</span>&nbsp;<span class="ident" id="4366584">token</span><span class="op" id="4366589">.</span><span class="ident" id="4366590">VAR</span><span class="op" id="4366593">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4366598">//&nbsp;Return&nbsp;only&nbsp;if&nbsp;parser&nbsp;made&nbsp;some&nbsp;progress&nbsp;since&nbsp;last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4366656">//&nbsp;sync&nbsp;or&nbsp;if&nbsp;it&nbsp;has&nbsp;not&nbsp;reached&nbsp;10&nbsp;sync&nbsp;calls&nbsp;without</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4366714">//&nbsp;progress.&nbsp;Otherwise&nbsp;consume&nbsp;at&nbsp;least&nbsp;one&nbsp;token&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4366770">//&nbsp;avoid&nbsp;an&nbsp;endless&nbsp;parser&nbsp;loop&nbsp;(it&nbsp;is&nbsp;possible&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4366826">//&nbsp;both&nbsp;parseOperand&nbsp;and&nbsp;parseStmt&nbsp;call&nbsp;syncStmt&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4366882">//&nbsp;correctly&nbsp;do&nbsp;not&nbsp;advance,&nbsp;thus&nbsp;the&nbsp;need&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4366936">//&nbsp;invocation&nbsp;limit&nbsp;p.syncCnt).</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4366971">if</span>&nbsp;<span class="ident" id="4366974">p</span><span class="op" id="4366975">.</span><span class="ident" id="4366976">pos</span>&nbsp;<span class="op" id="4366980">==</span>&nbsp;<span class="ident" id="4366983">p</span><span class="op" id="4366984">.</span><span class="ident" id="4366985">syncPos</span>&nbsp;<span class="op" id="4366993">&amp;&amp;</span>&nbsp;<span class="ident" id="4366996">p</span><span class="op" id="4366997">.</span><span class="ident" id="4366998">syncCnt</span>&nbsp;<span class="op" id="4367006">&lt;</span>&nbsp;<span class="num" id="4367008">10</span>&nbsp;<span class="op" id="4367011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4367017">p</span><span class="op" id="4367018">.</span><span class="ident" id="4367019">syncCnt</span><span class="op" id="4367026">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4367033">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4367043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4367048">if</span>&nbsp;<span class="ident" id="4367051">p</span><span class="op" id="4367052">.</span><span class="ident" id="4367053">pos</span>&nbsp;<span class="op" id="4367057">&gt;</span>&nbsp;<span class="ident" id="4367059">p</span><span class="op" id="4367060">.</span><span class="ident" id="4367061">syncPos</span>&nbsp;<span class="op" id="4367069">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4367075">p</span><span class="op" id="4367076">.</span><span class="ident" id="4367077">syncPos</span>&nbsp;<span class="op" id="4367085">=</span>&nbsp;<span class="ident" id="4367087">p</span><span class="op" id="4367088">.</span><span class="ident" id="4367089">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4367097">p</span><span class="op" id="4367098">.</span><span class="ident" id="4367099">syncCnt</span>&nbsp;<span class="op" id="4367107">=</span>&nbsp;<span class="num" id="4367109">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4367115">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4367125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4367130">//&nbsp;Reaching&nbsp;here&nbsp;indicates&nbsp;a&nbsp;parser&nbsp;bug,&nbsp;likely&nbsp;an</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4367184">//&nbsp;incorrect&nbsp;token&nbsp;list&nbsp;in&nbsp;this&nbsp;function,&nbsp;but&nbsp;it&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4367241">//&nbsp;leads&nbsp;to&nbsp;skipping&nbsp;of&nbsp;possibly&nbsp;correct&nbsp;code&nbsp;if&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4367295">//&nbsp;previous&nbsp;error&nbsp;is&nbsp;present,&nbsp;and&nbsp;thus&nbsp;is&nbsp;preferred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4367350">//&nbsp;over&nbsp;a&nbsp;non-terminating&nbsp;parse.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4367385">case</span>&nbsp;<span class="ident" id="4367390">token</span><span class="op" id="4367395">.</span><span class="ident" id="4367396">EOF</span><span class="op" id="4367399">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4367404">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4367413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4367417">p</span><span class="op" id="4367418">.</span><span class="ident" id="4367419">next</span><span class="op" id="4367423">(</span><span class="op" id="4367424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4367427">}</span><br>
<span class="lineno"></span><span class="op" id="4367429">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="4367432">//&nbsp;syncDecl&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;declaration.</span><br>
<span class="lineno"></span><span class="comment" id="4367478">//&nbsp;Used&nbsp;for&nbsp;synchronization&nbsp;after&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="4367522">//</span><br>
<span class="lineno"></span><span class="keyword" id="4367525">func</span>&nbsp;<span class="ident" id="4367530">syncDecl</span><span class="op" id="4367538">(</span><span class="ident" id="4367539">p</span>&nbsp;<span class="op" id="4367541">*</span><span class="ident" id="4367542">parser</span><span class="op" id="4367548">)</span>&nbsp;<span class="op" id="4367550">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4367553">for</span>&nbsp;<span class="op" id="4367557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4367561">switch</span>&nbsp;<span class="ident" id="4367568">p</span><span class="op" id="4367569">.</span><span class="ident" id="4367570">tok</span>&nbsp;<span class="op" id="4367574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4367578">case</span>&nbsp;<span class="ident" id="4367583">token</span><span class="op" id="4367588">.</span><span class="ident" id="4367589">CONST</span><span class="op" id="4367594">,</span>&nbsp;<span class="ident" id="4367596">token</span><span class="op" id="4367601">.</span><span class="ident" id="4367602">TYPE</span><span class="op" id="4367606">,</span>&nbsp;<span class="ident" id="4367608">token</span><span class="op" id="4367613">.</span><span class="ident" id="4367614">VAR</span><span class="op" id="4367617">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4367622">//&nbsp;see&nbsp;comments&nbsp;in&nbsp;syncStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4367653">if</span>&nbsp;<span class="ident" id="4367656">p</span><span class="op" id="4367657">.</span><span class="ident" id="4367658">pos</span>&nbsp;<span class="op" id="4367662">==</span>&nbsp;<span class="ident" id="4367665">p</span><span class="op" id="4367666">.</span><span class="ident" id="4367667">syncPos</span>&nbsp;<span class="op" id="4367675">&amp;&amp;</span>&nbsp;<span class="ident" id="4367678">p</span><span class="op" id="4367679">.</span><span class="ident" id="4367680">syncCnt</span>&nbsp;<span class="op" id="4367688">&lt;</span>&nbsp;<span class="num" id="4367690">10</span>&nbsp;<span class="op" id="4367693">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4367699">p</span><span class="op" id="4367700">.</span><span class="ident" id="4367701">syncCnt</span><span class="op" id="4367708">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4367715">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4367725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4367730">if</span>&nbsp;<span class="ident" id="4367733">p</span><span class="op" id="4367734">.</span><span class="ident" id="4367735">pos</span>&nbsp;<span class="op" id="4367739">&gt;</span>&nbsp;<span class="ident" id="4367741">p</span><span class="op" id="4367742">.</span><span class="ident" id="4367743">syncPos</span>&nbsp;<span class="op" id="4367751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4367757">p</span><span class="op" id="4367758">.</span><span class="ident" id="4367759">syncPos</span>&nbsp;<span class="op" id="4367767">=</span>&nbsp;<span class="ident" id="4367769">p</span><span class="op" id="4367770">.</span><span class="ident" id="4367771">pos</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4367779">p</span><span class="op" id="4367780">.</span><span class="ident" id="4367781">syncCnt</span>&nbsp;<span class="op" id="4367789">=</span>&nbsp;<span class="num" id="4367791">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4367797">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4367807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4367811">case</span>&nbsp;<span class="ident" id="4367816">token</span><span class="op" id="4367821">.</span><span class="ident" id="4367822">EOF</span><span class="op" id="4367825">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4367830">return</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4367839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4367843">p</span><span class="op" id="4367844">.</span><span class="ident" id="4367845">next</span><span class="op" id="4367849">(</span><span class="op" id="4367850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4367853">}</span><br>
<span class="lineno"></span><span class="op" id="4367855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span><span class="comment" id="4367858">//&nbsp;safePos&nbsp;returns&nbsp;a&nbsp;valid&nbsp;file&nbsp;position&nbsp;for&nbsp;a&nbsp;given&nbsp;position:&nbsp;If&nbsp;pos</span><br>
<span class="lineno"></span><span class="comment" id="4367928">//&nbsp;is&nbsp;valid&nbsp;to&nbsp;begin&nbsp;with,&nbsp;safePos&nbsp;returns&nbsp;pos.&nbsp;If&nbsp;pos&nbsp;is&nbsp;out-of-range,</span><br>
<span class="lineno"></span><span class="comment" id="4368000">//&nbsp;safePos&nbsp;returns&nbsp;the&nbsp;EOF&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="4368037">//</span><br>
<span class="lineno"></span><span class="comment" id="4368040">//&nbsp;This&nbsp;is&nbsp;hack&nbsp;to&nbsp;work&nbsp;around&nbsp;&#34;artificial&#34;&nbsp;end&nbsp;positions&nbsp;in&nbsp;the&nbsp;AST&nbsp;which</span><br>
<span class="lineno">500</span><span class="comment" id="4368115">//&nbsp;are&nbsp;computed&nbsp;by&nbsp;adding&nbsp;1&nbsp;to&nbsp;(presumably&nbsp;valid)&nbsp;token&nbsp;positions.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4368189">//&nbsp;token&nbsp;positions&nbsp;are&nbsp;invalid&nbsp;due&nbsp;to&nbsp;parse&nbsp;errors,&nbsp;the&nbsp;resulting&nbsp;end&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="4368268">//&nbsp;may&nbsp;be&nbsp;past&nbsp;the&nbsp;file&#39;s&nbsp;EOF&nbsp;position,&nbsp;which&nbsp;would&nbsp;lead&nbsp;to&nbsp;panics&nbsp;if&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4368343">//&nbsp;later&nbsp;on.</span><br>
<span class="lineno"></span><span class="comment" id="4368356">//</span><br>
<span class="lineno">505</span><span class="keyword" id="4368359">func</span>&nbsp;<span class="op" id="4368364">(</span><span class="ident" id="4368365">p</span>&nbsp;<span class="op" id="4368367">*</span><span class="ident" id="4368368">parser</span><span class="op" id="4368374">)</span>&nbsp;<span class="ident" id="4368376">safePos</span><span class="op" id="4368383">(</span><span class="ident" id="4368384">pos</span>&nbsp;<span class="ident" id="4368388">token</span><span class="op" id="4368393">.</span><span class="ident" id="4368394">Pos</span><span class="op" id="4368397">)</span>&nbsp;<span class="op" id="4368399">(</span><span class="ident" id="4368400">res</span>&nbsp;<span class="ident" id="4368404">token</span><span class="op" id="4368409">.</span><span class="ident" id="4368410">Pos</span><span class="op" id="4368413">)</span>&nbsp;<span class="op" id="4368415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4368418">defer</span>&nbsp;<span class="keyword" id="4368424">func</span><span class="op" id="4368428">(</span><span class="op" id="4368429">)</span>&nbsp;<span class="op" id="4368431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4368435">if</span>&nbsp;<span class="builtinfunc" id="4368438">recover</span><span class="op" id="4368445">(</span><span class="op" id="4368446">)</span>&nbsp;<span class="op" id="4368448">!=</span>&nbsp;<span class="ident" id="4368451">nil</span>&nbsp;<span class="op" id="4368455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4368460">res</span>&nbsp;<span class="op" id="4368464">=</span>&nbsp;<span class="ident" id="4368466">token</span><span class="op" id="4368471">.</span><span class="ident" id="4368472">Pos</span><span class="op" id="4368475">(</span><span class="ident" id="4368476">p</span><span class="op" id="4368477">.</span><span class="ident" id="4368478">file</span><span class="op" id="4368482">.</span><span class="ident" id="4368483">Base</span><span class="op" id="4368487">(</span><span class="op" id="4368488">)</span>&nbsp;<span class="op" id="4368490">+</span>&nbsp;<span class="ident" id="4368492">p</span><span class="op" id="4368493">.</span><span class="ident" id="4368494">file</span><span class="op" id="4368498">.</span><span class="ident" id="4368499">Size</span><span class="op" id="4368503">(</span><span class="op" id="4368504">)</span><span class="op" id="4368505">)</span>&nbsp;<span class="comment" id="4368507">//&nbsp;EOF&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4368525">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4368528">}</span><span class="op" id="4368529">(</span><span class="op" id="4368530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4368533">_</span>&nbsp;<span class="op" id="4368535">=</span>&nbsp;<span class="ident" id="4368537">p</span><span class="op" id="4368538">.</span><span class="ident" id="4368539">file</span><span class="op" id="4368543">.</span><span class="ident" id="4368544">Offset</span><span class="op" id="4368550">(</span><span class="ident" id="4368551">pos</span><span class="op" id="4368554">)</span>&nbsp;<span class="comment" id="4368556">//&nbsp;trigger&nbsp;a&nbsp;panic&nbsp;if&nbsp;position&nbsp;is&nbsp;out-of-range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4368604">return</span>&nbsp;<span class="ident" id="4368611">pos</span><br>
<span class="lineno"></span><span class="op" id="4368615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="comment" id="4368618">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4368698">//&nbsp;Identifiers</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4368714">func</span>&nbsp;<span class="op" id="4368719">(</span><span class="ident" id="4368720">p</span>&nbsp;<span class="op" id="4368722">*</span><span class="ident" id="4368723">parser</span><span class="op" id="4368729">)</span>&nbsp;<span class="ident" id="4368731">parseIdent</span><span class="op" id="4368741">(</span><span class="op" id="4368742">)</span>&nbsp;<span class="op" id="4368744">*</span><span class="ident" id="4368745">ast</span><span class="op" id="4368748">.</span><span class="ident" id="4368749">Ident</span>&nbsp;<span class="op" id="4368755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4368758">pos</span>&nbsp;<span class="op" id="4368762">:=</span>&nbsp;<span class="ident" id="4368765">p</span><span class="op" id="4368766">.</span><span class="ident" id="4368767">pos</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4368772">name</span>&nbsp;<span class="op" id="4368777">:=</span>&nbsp;<span class="string" id="4368780">&#34;_&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4368785">if</span>&nbsp;<span class="ident" id="4368788">p</span><span class="op" id="4368789">.</span><span class="ident" id="4368790">tok</span>&nbsp;<span class="op" id="4368794">==</span>&nbsp;<span class="ident" id="4368797">token</span><span class="op" id="4368802">.</span><span class="ident" id="4368803">IDENT</span>&nbsp;<span class="op" id="4368809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4368813">name</span>&nbsp;<span class="op" id="4368818">=</span>&nbsp;<span class="ident" id="4368820">p</span><span class="op" id="4368821">.</span><span class="ident" id="4368822">lit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4368828">p</span><span class="op" id="4368829">.</span><span class="ident" id="4368830">next</span><span class="op" id="4368834">(</span><span class="op" id="4368835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4368838">}</span>&nbsp;<span class="keyword" id="4368840">else</span>&nbsp;<span class="op" id="4368845">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4368849">p</span><span class="op" id="4368850">.</span><span class="ident" id="4368851">expect</span><span class="op" id="4368857">(</span><span class="ident" id="4368858">token</span><span class="op" id="4368863">.</span><span class="ident" id="4368864">IDENT</span><span class="op" id="4368869">)</span>&nbsp;<span class="comment" id="4368871">//&nbsp;use&nbsp;expect()&nbsp;error&nbsp;handling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4368903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4368906">return</span>&nbsp;<span class="op" id="4368913">&amp;</span><span class="ident" id="4368914">ast</span><span class="op" id="4368917">.</span><span class="ident" id="4368918">Ident</span><span class="op" id="4368923">{</span><span class="ident" id="4368924">NamePos</span><span class="op" id="4368931">:</span>&nbsp;<span class="ident" id="4368933">pos</span><span class="op" id="4368936">,</span>&nbsp;<span class="ident" id="4368938">Name</span><span class="op" id="4368942">:</span>&nbsp;<span class="ident" id="4368944">name</span><span class="op" id="4368948">}</span><br>
<span class="lineno"></span><span class="op" id="4368950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="keyword" id="4368953">func</span>&nbsp;<span class="op" id="4368958">(</span><span class="ident" id="4368959">p</span>&nbsp;<span class="op" id="4368961">*</span><span class="ident" id="4368962">parser</span><span class="op" id="4368968">)</span>&nbsp;<span class="ident" id="4368970">parseIdentList</span><span class="op" id="4368984">(</span><span class="op" id="4368985">)</span>&nbsp;<span class="op" id="4368987">(</span><span class="ident" id="4368988">list</span>&nbsp;<span class="op" id="4368993">[</span><span class="op" id="4368994">]</span><span class="op" id="4368995">*</span><span class="ident" id="4368996">ast</span><span class="op" id="4368999">.</span><span class="ident" id="4369000">Ident</span><span class="op" id="4369005">)</span>&nbsp;<span class="op" id="4369007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4369010">if</span>&nbsp;<span class="ident" id="4369013">p</span><span class="op" id="4369014">.</span><span class="ident" id="4369015">trace</span>&nbsp;<span class="op" id="4369021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4369025">defer</span>&nbsp;<span class="ident" id="4369031">un</span><span class="op" id="4369033">(</span><span class="ident" id="4369034">trace</span><span class="op" id="4369039">(</span><span class="ident" id="4369040">p</span><span class="op" id="4369041">,</span>&nbsp;<span class="string" id="4369043">&#34;IdentList&#34;</span><span class="op" id="4369054">)</span><span class="op" id="4369055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4369058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4369062">list</span>&nbsp;<span class="op" id="4369067">=</span>&nbsp;<span class="builtinfunc" id="4369069">append</span><span class="op" id="4369075">(</span><span class="ident" id="4369076">list</span><span class="op" id="4369080">,</span>&nbsp;<span class="ident" id="4369082">p</span><span class="op" id="4369083">.</span><span class="ident" id="4369084">parseIdent</span><span class="op" id="4369094">(</span><span class="op" id="4369095">)</span><span class="op" id="4369096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4369099">for</span>&nbsp;<span class="ident" id="4369103">p</span><span class="op" id="4369104">.</span><span class="ident" id="4369105">tok</span>&nbsp;<span class="op" id="4369109">==</span>&nbsp;<span class="ident" id="4369112">token</span><span class="op" id="4369117">.</span><span class="ident" id="4369118">COMMA</span>&nbsp;<span class="op" id="4369124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4369128">p</span><span class="op" id="4369129">.</span><span class="ident" id="4369130">next</span><span class="op" id="4369134">(</span><span class="op" id="4369135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4369139">list</span>&nbsp;<span class="op" id="4369144">=</span>&nbsp;<span class="builtinfunc" id="4369146">append</span><span class="op" id="4369152">(</span><span class="ident" id="4369153">list</span><span class="op" id="4369157">,</span>&nbsp;<span class="ident" id="4369159">p</span><span class="op" id="4369160">.</span><span class="ident" id="4369161">parseIdent</span><span class="op" id="4369171">(</span><span class="op" id="4369172">)</span><span class="op" id="4369173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4369176">}</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4369180">return</span><br>
<span class="lineno"></span><span class="op" id="4369187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4369190">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">545</span><span class="comment" id="4369270">//&nbsp;Common&nbsp;productions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4369293">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set,&nbsp;result&nbsp;list&nbsp;elements&nbsp;which&nbsp;are&nbsp;identifiers&nbsp;are&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="4369372">func</span>&nbsp;<span class="op" id="4369377">(</span><span class="ident" id="4369378">p</span>&nbsp;<span class="op" id="4369380">*</span><span class="ident" id="4369381">parser</span><span class="op" id="4369387">)</span>&nbsp;<span class="ident" id="4369389">parseExprList</span><span class="op" id="4369402">(</span><span class="ident" id="4369403">lhs</span>&nbsp;<span class="builtintype" id="4369407">bool</span><span class="op" id="4369411">)</span>&nbsp;<span class="op" id="4369413">(</span><span class="ident" id="4369414">list</span>&nbsp;<span class="op" id="4369419">[</span><span class="op" id="4369420">]</span><span class="ident" id="4369421">ast</span><span class="op" id="4369424">.</span><span class="ident" id="4369425">Expr</span><span class="op" id="4369429">)</span>&nbsp;<span class="op" id="4369431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4369434">if</span>&nbsp;<span class="ident" id="4369437">p</span><span class="op" id="4369438">.</span><span class="ident" id="4369439">trace</span>&nbsp;<span class="op" id="4369445">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4369449">defer</span>&nbsp;<span class="ident" id="4369455">un</span><span class="op" id="4369457">(</span><span class="ident" id="4369458">trace</span><span class="op" id="4369463">(</span><span class="ident" id="4369464">p</span><span class="op" id="4369465">,</span>&nbsp;<span class="string" id="4369467">&#34;ExpressionList&#34;</span><span class="op" id="4369483">)</span><span class="op" id="4369484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4369487">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4369491">list</span>&nbsp;<span class="op" id="4369496">=</span>&nbsp;<span class="builtinfunc" id="4369498">append</span><span class="op" id="4369504">(</span><span class="ident" id="4369505">list</span><span class="op" id="4369509">,</span>&nbsp;<span class="ident" id="4369511">p</span><span class="op" id="4369512">.</span><span class="ident" id="4369513">checkExpr</span><span class="op" id="4369522">(</span><span class="ident" id="4369523">p</span><span class="op" id="4369524">.</span><span class="ident" id="4369525">parseExpr</span><span class="op" id="4369534">(</span><span class="ident" id="4369535">lhs</span><span class="op" id="4369538">)</span><span class="op" id="4369539">)</span><span class="op" id="4369540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4369543">for</span>&nbsp;<span class="ident" id="4369547">p</span><span class="op" id="4369548">.</span><span class="ident" id="4369549">tok</span>&nbsp;<span class="op" id="4369553">==</span>&nbsp;<span class="ident" id="4369556">token</span><span class="op" id="4369561">.</span><span class="ident" id="4369562">COMMA</span>&nbsp;<span class="op" id="4369568">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4369572">p</span><span class="op" id="4369573">.</span><span class="ident" id="4369574">next</span><span class="op" id="4369578">(</span><span class="op" id="4369579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4369583">list</span>&nbsp;<span class="op" id="4369588">=</span>&nbsp;<span class="builtinfunc" id="4369590">append</span><span class="op" id="4369596">(</span><span class="ident" id="4369597">list</span><span class="op" id="4369601">,</span>&nbsp;<span class="ident" id="4369603">p</span><span class="op" id="4369604">.</span><span class="ident" id="4369605">checkExpr</span><span class="op" id="4369614">(</span><span class="ident" id="4369615">p</span><span class="op" id="4369616">.</span><span class="ident" id="4369617">parseExpr</span><span class="op" id="4369626">(</span><span class="ident" id="4369627">lhs</span><span class="op" id="4369630">)</span><span class="op" id="4369631">)</span><span class="op" id="4369632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4369635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4369639">return</span><br>
<span class="lineno">560</span><span class="op" id="4369646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4369649">func</span>&nbsp;<span class="op" id="4369654">(</span><span class="ident" id="4369655">p</span>&nbsp;<span class="op" id="4369657">*</span><span class="ident" id="4369658">parser</span><span class="op" id="4369664">)</span>&nbsp;<span class="ident" id="4369666">parseLhsList</span><span class="op" id="4369678">(</span><span class="op" id="4369679">)</span>&nbsp;<span class="op" id="4369681">[</span><span class="op" id="4369682">]</span><span class="ident" id="4369683">ast</span><span class="op" id="4369686">.</span><span class="ident" id="4369687">Expr</span>&nbsp;<span class="op" id="4369692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4369695">old</span>&nbsp;<span class="op" id="4369699">:=</span>&nbsp;<span class="ident" id="4369702">p</span><span class="op" id="4369703">.</span><span class="ident" id="4369704">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4369711">p</span><span class="op" id="4369712">.</span><span class="ident" id="4369713">inRhs</span>&nbsp;<span class="op" id="4369719">=</span>&nbsp;<span class="builtintype" id="4369721">false</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4369728">list</span>&nbsp;<span class="op" id="4369733">:=</span>&nbsp;<span class="ident" id="4369736">p</span><span class="op" id="4369737">.</span><span class="ident" id="4369738">parseExprList</span><span class="op" id="4369751">(</span><span class="builtintype" id="4369752">true</span><span class="op" id="4369756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4369759">switch</span>&nbsp;<span class="ident" id="4369766">p</span><span class="op" id="4369767">.</span><span class="ident" id="4369768">tok</span>&nbsp;<span class="op" id="4369772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4369775">case</span>&nbsp;<span class="ident" id="4369780">token</span><span class="op" id="4369785">.</span><span class="ident" id="4369786">DEFINE</span><span class="op" id="4369792">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4369796">//&nbsp;lhs&nbsp;of&nbsp;a&nbsp;short&nbsp;variable&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4369837">//&nbsp;but&nbsp;doesn&#39;t&nbsp;enter&nbsp;scope&nbsp;until&nbsp;later:</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4369879">//&nbsp;caller&nbsp;must&nbsp;call&nbsp;p.shortVarDecl(p.makeIdentList(list))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4369939">//&nbsp;at&nbsp;appropriate&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4369964">case</span>&nbsp;<span class="ident" id="4369969">token</span><span class="op" id="4369974">.</span><span class="ident" id="4369975">COLON</span><span class="op" id="4369980">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4369984">//&nbsp;lhs&nbsp;of&nbsp;a&nbsp;label&nbsp;declaration&nbsp;or&nbsp;a&nbsp;communication&nbsp;clause&nbsp;of&nbsp;a&nbsp;select</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4370054">//&nbsp;statement&nbsp;(parseLhsList&nbsp;is&nbsp;not&nbsp;called&nbsp;when&nbsp;parsing&nbsp;the&nbsp;case&nbsp;clause</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4370126">//&nbsp;of&nbsp;a&nbsp;switch&nbsp;statement):</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4370155">//&nbsp;-&nbsp;labels&nbsp;are&nbsp;declared&nbsp;by&nbsp;the&nbsp;caller&nbsp;of&nbsp;parseLhsList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4370212">//&nbsp;-&nbsp;for&nbsp;communication&nbsp;clauses,&nbsp;if&nbsp;there&nbsp;is&nbsp;a&nbsp;stand-alone&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4370283">//&nbsp;&nbsp;&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon,&nbsp;we&nbsp;have&nbsp;a&nbsp;syntax&nbsp;error;&nbsp;there&nbsp;is&nbsp;no&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4370352">//&nbsp;&nbsp;&nbsp;to&nbsp;resolve&nbsp;the&nbsp;identifier&nbsp;in&nbsp;that&nbsp;case</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4370397">default</span><span class="op" id="4370404">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4370408">//&nbsp;identifiers&nbsp;must&nbsp;be&nbsp;declared&nbsp;elsewhere</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4370452">for</span>&nbsp;<span class="ident" id="4370456">_</span><span class="op" id="4370457">,</span>&nbsp;<span class="ident" id="4370459">x</span>&nbsp;<span class="op" id="4370461">:=</span>&nbsp;<span class="keyword" id="4370464">range</span>&nbsp;<span class="ident" id="4370470">list</span>&nbsp;<span class="op" id="4370475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4370480">p</span><span class="op" id="4370481">.</span><span class="ident" id="4370482">resolve</span><span class="op" id="4370489">(</span><span class="ident" id="4370490">x</span><span class="op" id="4370491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4370495">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4370498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4370501">p</span><span class="op" id="4370502">.</span><span class="ident" id="4370503">inRhs</span>&nbsp;<span class="op" id="4370509">=</span>&nbsp;<span class="ident" id="4370511">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4370516">return</span>&nbsp;<span class="ident" id="4370523">list</span><br>
<span class="lineno"></span><span class="op" id="4370528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="keyword" id="4370531">func</span>&nbsp;<span class="op" id="4370536">(</span><span class="ident" id="4370537">p</span>&nbsp;<span class="op" id="4370539">*</span><span class="ident" id="4370540">parser</span><span class="op" id="4370546">)</span>&nbsp;<span class="ident" id="4370548">parseRhsList</span><span class="op" id="4370560">(</span><span class="op" id="4370561">)</span>&nbsp;<span class="op" id="4370563">[</span><span class="op" id="4370564">]</span><span class="ident" id="4370565">ast</span><span class="op" id="4370568">.</span><span class="ident" id="4370569">Expr</span>&nbsp;<span class="op" id="4370574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4370577">old</span>&nbsp;<span class="op" id="4370581">:=</span>&nbsp;<span class="ident" id="4370584">p</span><span class="op" id="4370585">.</span><span class="ident" id="4370586">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4370593">p</span><span class="op" id="4370594">.</span><span class="ident" id="4370595">inRhs</span>&nbsp;<span class="op" id="4370601">=</span>&nbsp;<span class="builtintype" id="4370603">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4370609">list</span>&nbsp;<span class="op" id="4370614">:=</span>&nbsp;<span class="ident" id="4370617">p</span><span class="op" id="4370618">.</span><span class="ident" id="4370619">parseExprList</span><span class="op" id="4370632">(</span><span class="builtintype" id="4370633">false</span><span class="op" id="4370638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4370641">p</span><span class="op" id="4370642">.</span><span class="ident" id="4370643">inRhs</span>&nbsp;<span class="op" id="4370649">=</span>&nbsp;<span class="ident" id="4370651">old</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4370656">return</span>&nbsp;<span class="ident" id="4370663">list</span><br>
<span class="lineno"></span><span class="op" id="4370668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4370671">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4370751">//&nbsp;Types</span><br>
<span class="lineno">600</span><br>
<span class="lineno"></span><span class="keyword" id="4370761">func</span>&nbsp;<span class="op" id="4370766">(</span><span class="ident" id="4370767">p</span>&nbsp;<span class="op" id="4370769">*</span><span class="ident" id="4370770">parser</span><span class="op" id="4370776">)</span>&nbsp;<span class="ident" id="4370778">parseType</span><span class="op" id="4370787">(</span><span class="op" id="4370788">)</span>&nbsp;<span class="ident" id="4370790">ast</span><span class="op" id="4370793">.</span><span class="ident" id="4370794">Expr</span>&nbsp;<span class="op" id="4370799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4370802">if</span>&nbsp;<span class="ident" id="4370805">p</span><span class="op" id="4370806">.</span><span class="ident" id="4370807">trace</span>&nbsp;<span class="op" id="4370813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4370817">defer</span>&nbsp;<span class="ident" id="4370823">un</span><span class="op" id="4370825">(</span><span class="ident" id="4370826">trace</span><span class="op" id="4370831">(</span><span class="ident" id="4370832">p</span><span class="op" id="4370833">,</span>&nbsp;<span class="string" id="4370835">&#34;Type&#34;</span><span class="op" id="4370841">)</span><span class="op" id="4370842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4370845">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4370849">typ</span>&nbsp;<span class="op" id="4370853">:=</span>&nbsp;<span class="ident" id="4370856">p</span><span class="op" id="4370857">.</span><span class="ident" id="4370858">tryType</span><span class="op" id="4370865">(</span><span class="op" id="4370866">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4370870">if</span>&nbsp;<span class="ident" id="4370873">typ</span>&nbsp;<span class="op" id="4370877">==</span>&nbsp;<span class="ident" id="4370880">nil</span>&nbsp;<span class="op" id="4370884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4370888">pos</span>&nbsp;<span class="op" id="4370892">:=</span>&nbsp;<span class="ident" id="4370895">p</span><span class="op" id="4370896">.</span><span class="ident" id="4370897">pos</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4370903">p</span><span class="op" id="4370904">.</span><span class="ident" id="4370905">errorExpected</span><span class="op" id="4370918">(</span><span class="ident" id="4370919">pos</span><span class="op" id="4370922">,</span>&nbsp;<span class="string" id="4370924">&#34;type&#34;</span><span class="op" id="4370930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4370934">p</span><span class="op" id="4370935">.</span><span class="ident" id="4370936">next</span><span class="op" id="4370940">(</span><span class="op" id="4370941">)</span>&nbsp;<span class="comment" id="4370943">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4370962">return</span>&nbsp;<span class="op" id="4370969">&amp;</span><span class="ident" id="4370970">ast</span><span class="op" id="4370973">.</span><span class="ident" id="4370974">BadExpr</span><span class="op" id="4370981">{</span><span class="ident" id="4370982">From</span><span class="op" id="4370986">:</span>&nbsp;<span class="ident" id="4370988">pos</span><span class="op" id="4370991">,</span>&nbsp;<span class="ident" id="4370993">To</span><span class="op" id="4370995">:</span>&nbsp;<span class="ident" id="4370997">p</span><span class="op" id="4370998">.</span><span class="ident" id="4370999">pos</span><span class="op" id="4371002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4371005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4371009">return</span>&nbsp;<span class="ident" id="4371016">typ</span><br>
<span class="lineno"></span><span class="op" id="4371020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4371023">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="4371078">func</span>&nbsp;<span class="op" id="4371083">(</span><span class="ident" id="4371084">p</span>&nbsp;<span class="op" id="4371086">*</span><span class="ident" id="4371087">parser</span><span class="op" id="4371093">)</span>&nbsp;<span class="ident" id="4371095">parseTypeName</span><span class="op" id="4371108">(</span><span class="op" id="4371109">)</span>&nbsp;<span class="ident" id="4371111">ast</span><span class="op" id="4371114">.</span><span class="ident" id="4371115">Expr</span>&nbsp;<span class="op" id="4371120">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4371123">if</span>&nbsp;<span class="ident" id="4371126">p</span><span class="op" id="4371127">.</span><span class="ident" id="4371128">trace</span>&nbsp;<span class="op" id="4371134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4371138">defer</span>&nbsp;<span class="ident" id="4371144">un</span><span class="op" id="4371146">(</span><span class="ident" id="4371147">trace</span><span class="op" id="4371152">(</span><span class="ident" id="4371153">p</span><span class="op" id="4371154">,</span>&nbsp;<span class="string" id="4371156">&#34;TypeName&#34;</span><span class="op" id="4371166">)</span><span class="op" id="4371167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4371170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4371174">ident</span>&nbsp;<span class="op" id="4371180">:=</span>&nbsp;<span class="ident" id="4371183">p</span><span class="op" id="4371184">.</span><span class="ident" id="4371185">parseIdent</span><span class="op" id="4371195">(</span><span class="op" id="4371196">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4371199">//&nbsp;don&#39;t&nbsp;resolve&nbsp;ident&nbsp;yet&nbsp;-&nbsp;it&nbsp;may&nbsp;be&nbsp;a&nbsp;parameter&nbsp;or&nbsp;field&nbsp;name</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4371266">if</span>&nbsp;<span class="ident" id="4371269">p</span><span class="op" id="4371270">.</span><span class="ident" id="4371271">tok</span>&nbsp;<span class="op" id="4371275">==</span>&nbsp;<span class="ident" id="4371278">token</span><span class="op" id="4371283">.</span><span class="ident" id="4371284">PERIOD</span>&nbsp;<span class="op" id="4371291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4371295">//&nbsp;ident&nbsp;is&nbsp;a&nbsp;package&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4371324">p</span><span class="op" id="4371325">.</span><span class="ident" id="4371326">next</span><span class="op" id="4371330">(</span><span class="op" id="4371331">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4371335">p</span><span class="op" id="4371336">.</span><span class="ident" id="4371337">resolve</span><span class="op" id="4371344">(</span><span class="ident" id="4371345">ident</span><span class="op" id="4371350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4371354">sel</span>&nbsp;<span class="op" id="4371358">:=</span>&nbsp;<span class="ident" id="4371361">p</span><span class="op" id="4371362">.</span><span class="ident" id="4371363">parseIdent</span><span class="op" id="4371373">(</span><span class="op" id="4371374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4371378">return</span>&nbsp;<span class="op" id="4371385">&amp;</span><span class="ident" id="4371386">ast</span><span class="op" id="4371389">.</span><span class="ident" id="4371390">SelectorExpr</span><span class="op" id="4371402">{</span><span class="ident" id="4371403">X</span><span class="op" id="4371404">:</span>&nbsp;<span class="ident" id="4371406">ident</span><span class="op" id="4371411">,</span>&nbsp;<span class="ident" id="4371413">Sel</span><span class="op" id="4371416">:</span>&nbsp;<span class="ident" id="4371418">sel</span><span class="op" id="4371421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4371424">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4371428">return</span>&nbsp;<span class="ident" id="4371435">ident</span><br>
<span class="lineno"></span><span class="op" id="4371441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4371444">func</span>&nbsp;<span class="op" id="4371449">(</span><span class="ident" id="4371450">p</span>&nbsp;<span class="op" id="4371452">*</span><span class="ident" id="4371453">parser</span><span class="op" id="4371459">)</span>&nbsp;<span class="ident" id="4371461">parseArrayType</span><span class="op" id="4371475">(</span><span class="op" id="4371476">)</span>&nbsp;<span class="ident" id="4371478">ast</span><span class="op" id="4371481">.</span><span class="ident" id="4371482">Expr</span>&nbsp;<span class="op" id="4371487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4371490">if</span>&nbsp;<span class="ident" id="4371493">p</span><span class="op" id="4371494">.</span><span class="ident" id="4371495">trace</span>&nbsp;<span class="op" id="4371501">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4371505">defer</span>&nbsp;<span class="ident" id="4371511">un</span><span class="op" id="4371513">(</span><span class="ident" id="4371514">trace</span><span class="op" id="4371519">(</span><span class="ident" id="4371520">p</span><span class="op" id="4371521">,</span>&nbsp;<span class="string" id="4371523">&#34;ArrayType&#34;</span><span class="op" id="4371534">)</span><span class="op" id="4371535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4371538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4371542">lbrack</span>&nbsp;<span class="op" id="4371549">:=</span>&nbsp;<span class="ident" id="4371552">p</span><span class="op" id="4371553">.</span><span class="ident" id="4371554">expect</span><span class="op" id="4371560">(</span><span class="ident" id="4371561">token</span><span class="op" id="4371566">.</span><span class="ident" id="4371567">LBRACK</span><span class="op" id="4371573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4371576">p</span><span class="op" id="4371577">.</span><span class="ident" id="4371578">exprLev</span><span class="op" id="4371585">++</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4371589">var</span>&nbsp;<span class="builtinfunc" id="4371593">len</span>&nbsp;<span class="ident" id="4371597">ast</span><span class="op" id="4371600">.</span><span class="ident" id="4371601">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4371607">//&nbsp;always&nbsp;permit&nbsp;ellipsis&nbsp;for&nbsp;more&nbsp;fault-tolerant&nbsp;parsing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4371666">if</span>&nbsp;<span class="ident" id="4371669">p</span><span class="op" id="4371670">.</span><span class="ident" id="4371671">tok</span>&nbsp;<span class="op" id="4371675">==</span>&nbsp;<span class="ident" id="4371678">token</span><span class="op" id="4371683">.</span><span class="ident" id="4371684">ELLIPSIS</span>&nbsp;<span class="op" id="4371693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4371697">len</span>&nbsp;<span class="op" id="4371701">=</span>&nbsp;<span class="op" id="4371703">&amp;</span><span class="ident" id="4371704">ast</span><span class="op" id="4371707">.</span><span class="ident" id="4371708">Ellipsis</span><span class="op" id="4371716">{</span><span class="ident" id="4371717">Ellipsis</span><span class="op" id="4371725">:</span>&nbsp;<span class="ident" id="4371727">p</span><span class="op" id="4371728">.</span><span class="ident" id="4371729">pos</span><span class="op" id="4371732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4371736">p</span><span class="op" id="4371737">.</span><span class="ident" id="4371738">next</span><span class="op" id="4371742">(</span><span class="op" id="4371743">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4371746">}</span>&nbsp;<span class="keyword" id="4371748">else</span>&nbsp;<span class="keyword" id="4371753">if</span>&nbsp;<span class="ident" id="4371756">p</span><span class="op" id="4371757">.</span><span class="ident" id="4371758">tok</span>&nbsp;<span class="op" id="4371762">!=</span>&nbsp;<span class="ident" id="4371765">token</span><span class="op" id="4371770">.</span><span class="ident" id="4371771">RBRACK</span>&nbsp;<span class="op" id="4371778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4371782">len</span>&nbsp;<span class="op" id="4371786">=</span>&nbsp;<span class="ident" id="4371788">p</span><span class="op" id="4371789">.</span><span class="ident" id="4371790">parseRhs</span><span class="op" id="4371798">(</span><span class="op" id="4371799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4371802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4371805">p</span><span class="op" id="4371806">.</span><span class="ident" id="4371807">exprLev</span><span class="op" id="4371814">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4371818">p</span><span class="op" id="4371819">.</span><span class="ident" id="4371820">expect</span><span class="op" id="4371826">(</span><span class="ident" id="4371827">token</span><span class="op" id="4371832">.</span><span class="ident" id="4371833">RBRACK</span><span class="op" id="4371839">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4371842">elt</span>&nbsp;<span class="op" id="4371846">:=</span>&nbsp;<span class="ident" id="4371849">p</span><span class="op" id="4371850">.</span><span class="ident" id="4371851">parseType</span><span class="op" id="4371860">(</span><span class="op" id="4371861">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4371865">return</span>&nbsp;<span class="op" id="4371872">&amp;</span><span class="ident" id="4371873">ast</span><span class="op" id="4371876">.</span><span class="ident" id="4371877">ArrayType</span><span class="op" id="4371886">{</span><span class="ident" id="4371887">Lbrack</span><span class="op" id="4371893">:</span>&nbsp;<span class="ident" id="4371895">lbrack</span><span class="op" id="4371901">,</span>&nbsp;<span class="ident" id="4371903">Len</span><span class="op" id="4371906">:</span>&nbsp;<span class="builtinfunc" id="4371908">len</span><span class="op" id="4371911">,</span>&nbsp;<span class="ident" id="4371913">Elt</span><span class="op" id="4371916">:</span>&nbsp;<span class="ident" id="4371918">elt</span><span class="op" id="4371921">}</span><br>
<span class="lineno"></span><span class="op" id="4371923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="keyword" id="4371926">func</span>&nbsp;<span class="op" id="4371931">(</span><span class="ident" id="4371932">p</span>&nbsp;<span class="op" id="4371934">*</span><span class="ident" id="4371935">parser</span><span class="op" id="4371941">)</span>&nbsp;<span class="ident" id="4371943">makeIdentList</span><span class="op" id="4371956">(</span><span class="ident" id="4371957">list</span>&nbsp;<span class="op" id="4371962">[</span><span class="op" id="4371963">]</span><span class="ident" id="4371964">ast</span><span class="op" id="4371967">.</span><span class="ident" id="4371968">Expr</span><span class="op" id="4371972">)</span>&nbsp;<span class="op" id="4371974">[</span><span class="op" id="4371975">]</span><span class="op" id="4371976">*</span><span class="ident" id="4371977">ast</span><span class="op" id="4371980">.</span><span class="ident" id="4371981">Ident</span>&nbsp;<span class="op" id="4371987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4371990">idents</span>&nbsp;<span class="op" id="4371997">:=</span>&nbsp;<span class="builtinfunc" id="4372000">make</span><span class="op" id="4372004">(</span><span class="op" id="4372005">[</span><span class="op" id="4372006">]</span><span class="op" id="4372007">*</span><span class="ident" id="4372008">ast</span><span class="op" id="4372011">.</span><span class="ident" id="4372012">Ident</span><span class="op" id="4372017">,</span>&nbsp;<span class="builtinfunc" id="4372019">len</span><span class="op" id="4372022">(</span><span class="ident" id="4372023">list</span><span class="op" id="4372027">)</span><span class="op" id="4372028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4372031">for</span>&nbsp;<span class="ident" id="4372035">i</span><span class="op" id="4372036">,</span>&nbsp;<span class="ident" id="4372038">x</span>&nbsp;<span class="op" id="4372040">:=</span>&nbsp;<span class="keyword" id="4372043">range</span>&nbsp;<span class="ident" id="4372049">list</span>&nbsp;<span class="op" id="4372054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4372058">ident</span><span class="op" id="4372063">,</span>&nbsp;<span class="ident" id="4372065">isIdent</span>&nbsp;<span class="op" id="4372073">:=</span>&nbsp;<span class="ident" id="4372076">x</span><span class="op" id="4372077">.</span><span class="op" id="4372078">(</span><span class="op" id="4372079">*</span><span class="ident" id="4372080">ast</span><span class="op" id="4372083">.</span><span class="ident" id="4372084">Ident</span><span class="op" id="4372089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4372093">if</span>&nbsp;<span class="op" id="4372096">!</span><span class="ident" id="4372097">isIdent</span>&nbsp;<span class="op" id="4372105">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4372110">if</span>&nbsp;<span class="ident" id="4372113">_</span><span class="op" id="4372114">,</span>&nbsp;<span class="ident" id="4372116">isBad</span>&nbsp;<span class="op" id="4372122">:=</span>&nbsp;<span class="ident" id="4372125">x</span><span class="op" id="4372126">.</span><span class="op" id="4372127">(</span><span class="op" id="4372128">*</span><span class="ident" id="4372129">ast</span><span class="op" id="4372132">.</span><span class="ident" id="4372133">BadExpr</span><span class="op" id="4372140">)</span><span class="op" id="4372141">;</span>&nbsp;<span class="op" id="4372143">!</span><span class="ident" id="4372144">isBad</span>&nbsp;<span class="op" id="4372150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4372156">//&nbsp;only&nbsp;report&nbsp;error&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;new&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4372199">p</span><span class="op" id="4372200">.</span><span class="ident" id="4372201">errorExpected</span><span class="op" id="4372214">(</span><span class="ident" id="4372215">x</span><span class="op" id="4372216">.</span><span class="ident" id="4372217">Pos</span><span class="op" id="4372220">(</span><span class="op" id="4372221">)</span><span class="op" id="4372222">,</span>&nbsp;<span class="string" id="4372224">&#34;identifier&#34;</span><span class="op" id="4372236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4372241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4372246">ident</span>&nbsp;<span class="op" id="4372252">=</span>&nbsp;<span class="op" id="4372254">&amp;</span><span class="ident" id="4372255">ast</span><span class="op" id="4372258">.</span><span class="ident" id="4372259">Ident</span><span class="op" id="4372264">{</span><span class="ident" id="4372265">NamePos</span><span class="op" id="4372272">:</span>&nbsp;<span class="ident" id="4372274">x</span><span class="op" id="4372275">.</span><span class="ident" id="4372276">Pos</span><span class="op" id="4372279">(</span><span class="op" id="4372280">)</span><span class="op" id="4372281">,</span>&nbsp;<span class="ident" id="4372283">Name</span><span class="op" id="4372287">:</span>&nbsp;<span class="string" id="4372289">&#34;_&#34;</span><span class="op" id="4372292">}</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4372296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4372300">idents</span><span class="op" id="4372306">[</span><span class="ident" id="4372307">i</span><span class="op" id="4372308">]</span>&nbsp;<span class="op" id="4372310">=</span>&nbsp;<span class="ident" id="4372312">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4372319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4372322">return</span>&nbsp;<span class="ident" id="4372329">idents</span><br>
<span class="lineno"></span><span class="op" id="4372336">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span><span class="keyword" id="4372339">func</span>&nbsp;<span class="op" id="4372344">(</span><span class="ident" id="4372345">p</span>&nbsp;<span class="op" id="4372347">*</span><span class="ident" id="4372348">parser</span><span class="op" id="4372354">)</span>&nbsp;<span class="ident" id="4372356">parseFieldDecl</span><span class="op" id="4372370">(</span><span class="ident" id="4372371">scope</span>&nbsp;<span class="op" id="4372377">*</span><span class="ident" id="4372378">ast</span><span class="op" id="4372381">.</span><span class="ident" id="4372382">Scope</span><span class="op" id="4372387">)</span>&nbsp;<span class="op" id="4372389">*</span><span class="ident" id="4372390">ast</span><span class="op" id="4372393">.</span><span class="ident" id="4372394">Field</span>&nbsp;<span class="op" id="4372400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4372403">if</span>&nbsp;<span class="ident" id="4372406">p</span><span class="op" id="4372407">.</span><span class="ident" id="4372408">trace</span>&nbsp;<span class="op" id="4372414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4372418">defer</span>&nbsp;<span class="ident" id="4372424">un</span><span class="op" id="4372426">(</span><span class="ident" id="4372427">trace</span><span class="op" id="4372432">(</span><span class="ident" id="4372433">p</span><span class="op" id="4372434">,</span>&nbsp;<span class="string" id="4372436">&#34;FieldDecl&#34;</span><span class="op" id="4372447">)</span><span class="op" id="4372448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4372451">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4372455">doc</span>&nbsp;<span class="op" id="4372459">:=</span>&nbsp;<span class="ident" id="4372462">p</span><span class="op" id="4372463">.</span><span class="ident" id="4372464">leadComment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4372478">//&nbsp;FieldDecl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4372492">list</span><span class="op" id="4372496">,</span>&nbsp;<span class="ident" id="4372498">typ</span>&nbsp;<span class="op" id="4372502">:=</span>&nbsp;<span class="ident" id="4372505">p</span><span class="op" id="4372506">.</span><span class="ident" id="4372507">parseVarList</span><span class="op" id="4372519">(</span><span class="builtintype" id="4372520">false</span><span class="op" id="4372525">)</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4372529">//&nbsp;Tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4372537">var</span>&nbsp;<span class="ident" id="4372541">tag</span>&nbsp;<span class="op" id="4372545">*</span><span class="ident" id="4372546">ast</span><span class="op" id="4372549">.</span><span class="ident" id="4372550">BasicLit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4372560">if</span>&nbsp;<span class="ident" id="4372563">p</span><span class="op" id="4372564">.</span><span class="ident" id="4372565">tok</span>&nbsp;<span class="op" id="4372569">==</span>&nbsp;<span class="ident" id="4372572">token</span><span class="op" id="4372577">.</span><span class="ident" id="4372578">STRING</span>&nbsp;<span class="op" id="4372585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4372589">tag</span>&nbsp;<span class="op" id="4372593">=</span>&nbsp;<span class="op" id="4372595">&amp;</span><span class="ident" id="4372596">ast</span><span class="op" id="4372599">.</span><span class="ident" id="4372600">BasicLit</span><span class="op" id="4372608">{</span><span class="ident" id="4372609">ValuePos</span><span class="op" id="4372617">:</span>&nbsp;<span class="ident" id="4372619">p</span><span class="op" id="4372620">.</span><span class="ident" id="4372621">pos</span><span class="op" id="4372624">,</span>&nbsp;<span class="ident" id="4372626">Kind</span><span class="op" id="4372630">:</span>&nbsp;<span class="ident" id="4372632">p</span><span class="op" id="4372633">.</span><span class="ident" id="4372634">tok</span><span class="op" id="4372637">,</span>&nbsp;<span class="ident" id="4372639">Value</span><span class="op" id="4372644">:</span>&nbsp;<span class="ident" id="4372646">p</span><span class="op" id="4372647">.</span><span class="ident" id="4372648">lit</span><span class="op" id="4372651">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4372655">p</span><span class="op" id="4372656">.</span><span class="ident" id="4372657">next</span><span class="op" id="4372661">(</span><span class="op" id="4372662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4372665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4372669">//&nbsp;analyze&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4372686">var</span>&nbsp;<span class="ident" id="4372690">idents</span>&nbsp;<span class="op" id="4372697">[</span><span class="op" id="4372698">]</span><span class="op" id="4372699">*</span><span class="ident" id="4372700">ast</span><span class="op" id="4372703">.</span><span class="ident" id="4372704">Ident</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4372711">if</span>&nbsp;<span class="ident" id="4372714">typ</span>&nbsp;<span class="op" id="4372718">!=</span>&nbsp;<span class="ident" id="4372721">nil</span>&nbsp;<span class="op" id="4372725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4372729">//&nbsp;IdentifierList&nbsp;Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4372754">idents</span>&nbsp;<span class="op" id="4372761">=</span>&nbsp;<span class="ident" id="4372763">p</span><span class="op" id="4372764">.</span><span class="ident" id="4372765">makeIdentList</span><span class="op" id="4372778">(</span><span class="ident" id="4372779">list</span><span class="op" id="4372783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4372786">}</span>&nbsp;<span class="keyword" id="4372788">else</span>&nbsp;<span class="op" id="4372793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4372797">//&nbsp;[&#34;*&#34;]&nbsp;TypeName&nbsp;(AnonymousField)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4372834">typ</span>&nbsp;<span class="op" id="4372838">=</span>&nbsp;<span class="ident" id="4372840">list</span><span class="op" id="4372844">[</span><span class="num" id="4372845">0</span><span class="op" id="4372846">]</span>&nbsp;<span class="comment" id="4372848">//&nbsp;we&nbsp;always&nbsp;have&nbsp;at&nbsp;least&nbsp;one&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4372889">if</span>&nbsp;<span class="ident" id="4372892">n</span>&nbsp;<span class="op" id="4372894">:=</span>&nbsp;<span class="builtinfunc" id="4372897">len</span><span class="op" id="4372900">(</span><span class="ident" id="4372901">list</span><span class="op" id="4372905">)</span><span class="op" id="4372906">;</span>&nbsp;<span class="ident" id="4372908">n</span>&nbsp;<span class="op" id="4372910">&gt;</span>&nbsp;<span class="num" id="4372912">1</span>&nbsp;<span class="op" id="4372914">||</span>&nbsp;<span class="op" id="4372917">!</span><span class="ident" id="4372918">isTypeName</span><span class="op" id="4372928">(</span><span class="ident" id="4372929">deref</span><span class="op" id="4372934">(</span><span class="ident" id="4372935">typ</span><span class="op" id="4372938">)</span><span class="op" id="4372939">)</span>&nbsp;<span class="op" id="4372941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4372946">pos</span>&nbsp;<span class="op" id="4372950">:=</span>&nbsp;<span class="ident" id="4372953">typ</span><span class="op" id="4372956">.</span><span class="ident" id="4372957">Pos</span><span class="op" id="4372960">(</span><span class="op" id="4372961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4372966">p</span><span class="op" id="4372967">.</span><span class="ident" id="4372968">errorExpected</span><span class="op" id="4372981">(</span><span class="ident" id="4372982">pos</span><span class="op" id="4372985">,</span>&nbsp;<span class="string" id="4372987">&#34;anonymous&nbsp;field&#34;</span><span class="op" id="4373004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4373009">typ</span>&nbsp;<span class="op" id="4373013">=</span>&nbsp;<span class="op" id="4373015">&amp;</span><span class="ident" id="4373016">ast</span><span class="op" id="4373019">.</span><span class="ident" id="4373020">BadExpr</span><span class="op" id="4373027">{</span><span class="ident" id="4373028">From</span><span class="op" id="4373032">:</span>&nbsp;<span class="ident" id="4373034">pos</span><span class="op" id="4373037">,</span>&nbsp;<span class="ident" id="4373039">To</span><span class="op" id="4373041">:</span>&nbsp;<span class="ident" id="4373043">p</span><span class="op" id="4373044">.</span><span class="ident" id="4373045">safePos</span><span class="op" id="4373052">(</span><span class="ident" id="4373053">list</span><span class="op" id="4373057">[</span><span class="ident" id="4373058">n</span><span class="op" id="4373059">-</span><span class="num" id="4373060">1</span><span class="op" id="4373061">]</span><span class="op" id="4373062">.</span><span class="ident" id="4373063">End</span><span class="op" id="4373066">(</span><span class="op" id="4373067">)</span><span class="op" id="4373068">)</span><span class="op" id="4373069">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4373073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4373076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4373080">p</span><span class="op" id="4373081">.</span><span class="ident" id="4373082">expectSemi</span><span class="op" id="4373092">(</span><span class="op" id="4373093">)</span>&nbsp;<span class="comment" id="4373095">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4373136">field</span>&nbsp;<span class="op" id="4373142">:=</span>&nbsp;<span class="op" id="4373145">&amp;</span><span class="ident" id="4373146">ast</span><span class="op" id="4373149">.</span><span class="ident" id="4373150">Field</span><span class="op" id="4373155">{</span><span class="ident" id="4373156">Doc</span><span class="op" id="4373159">:</span>&nbsp;<span class="ident" id="4373161">doc</span><span class="op" id="4373164">,</span>&nbsp;<span class="ident" id="4373166">Names</span><span class="op" id="4373171">:</span>&nbsp;<span class="ident" id="4373173">idents</span><span class="op" id="4373179">,</span>&nbsp;<span class="ident" id="4373181">Type</span><span class="op" id="4373185">:</span>&nbsp;<span class="ident" id="4373187">typ</span><span class="op" id="4373190">,</span>&nbsp;<span class="ident" id="4373192">Tag</span><span class="op" id="4373195">:</span>&nbsp;<span class="ident" id="4373197">tag</span><span class="op" id="4373200">,</span>&nbsp;<span class="ident" id="4373202">Comment</span><span class="op" id="4373209">:</span>&nbsp;<span class="ident" id="4373211">p</span><span class="op" id="4373212">.</span><span class="ident" id="4373213">lineComment</span><span class="op" id="4373224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4373227">p</span><span class="op" id="4373228">.</span><span class="ident" id="4373229">declare</span><span class="op" id="4373236">(</span><span class="ident" id="4373237">field</span><span class="op" id="4373242">,</span>&nbsp;<span class="ident" id="4373244">nil</span><span class="op" id="4373247">,</span>&nbsp;<span class="ident" id="4373249">scope</span><span class="op" id="4373254">,</span>&nbsp;<span class="ident" id="4373256">ast</span><span class="op" id="4373259">.</span><span class="ident" id="4373260">Var</span><span class="op" id="4373263">,</span>&nbsp;<span class="ident" id="4373265">idents</span><span class="op" id="4373271">...</span><span class="op" id="4373274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4373277">p</span><span class="op" id="4373278">.</span><span class="ident" id="4373279">resolve</span><span class="op" id="4373286">(</span><span class="ident" id="4373287">typ</span><span class="op" id="4373290">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4373294">return</span>&nbsp;<span class="ident" id="4373301">field</span><br>
<span class="lineno">715</span><span class="op" id="4373307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4373310">func</span>&nbsp;<span class="op" id="4373315">(</span><span class="ident" id="4373316">p</span>&nbsp;<span class="op" id="4373318">*</span><span class="ident" id="4373319">parser</span><span class="op" id="4373325">)</span>&nbsp;<span class="ident" id="4373327">parseStructType</span><span class="op" id="4373342">(</span><span class="op" id="4373343">)</span>&nbsp;<span class="op" id="4373345">*</span><span class="ident" id="4373346">ast</span><span class="op" id="4373349">.</span><span class="ident" id="4373350">StructType</span>&nbsp;<span class="op" id="4373361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4373364">if</span>&nbsp;<span class="ident" id="4373367">p</span><span class="op" id="4373368">.</span><span class="ident" id="4373369">trace</span>&nbsp;<span class="op" id="4373375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4373379">defer</span>&nbsp;<span class="ident" id="4373385">un</span><span class="op" id="4373387">(</span><span class="ident" id="4373388">trace</span><span class="op" id="4373393">(</span><span class="ident" id="4373394">p</span><span class="op" id="4373395">,</span>&nbsp;<span class="string" id="4373397">&#34;StructType&#34;</span><span class="op" id="4373409">)</span><span class="op" id="4373410">)</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4373413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4373417">pos</span>&nbsp;<span class="op" id="4373421">:=</span>&nbsp;<span class="ident" id="4373424">p</span><span class="op" id="4373425">.</span><span class="ident" id="4373426">expect</span><span class="op" id="4373432">(</span><span class="ident" id="4373433">token</span><span class="op" id="4373438">.</span><span class="ident" id="4373439">STRUCT</span><span class="op" id="4373445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4373448">lbrace</span>&nbsp;<span class="op" id="4373455">:=</span>&nbsp;<span class="ident" id="4373458">p</span><span class="op" id="4373459">.</span><span class="ident" id="4373460">expect</span><span class="op" id="4373466">(</span><span class="ident" id="4373467">token</span><span class="op" id="4373472">.</span><span class="ident" id="4373473">LBRACE</span><span class="op" id="4373479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4373482">scope</span>&nbsp;<span class="op" id="4373488">:=</span>&nbsp;<span class="ident" id="4373491">ast</span><span class="op" id="4373494">.</span><span class="ident" id="4373495">NewScope</span><span class="op" id="4373503">(</span><span class="ident" id="4373504">nil</span><span class="op" id="4373507">)</span>&nbsp;<span class="comment" id="4373509">//&nbsp;struct&nbsp;scope</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4373526">var</span>&nbsp;<span class="ident" id="4373530">list</span>&nbsp;<span class="op" id="4373535">[</span><span class="op" id="4373536">]</span><span class="op" id="4373537">*</span><span class="ident" id="4373538">ast</span><span class="op" id="4373541">.</span><span class="ident" id="4373542">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4373549">for</span>&nbsp;<span class="ident" id="4373553">p</span><span class="op" id="4373554">.</span><span class="ident" id="4373555">tok</span>&nbsp;<span class="op" id="4373559">==</span>&nbsp;<span class="ident" id="4373562">token</span><span class="op" id="4373567">.</span><span class="ident" id="4373568">IDENT</span>&nbsp;<span class="op" id="4373574">||</span>&nbsp;<span class="ident" id="4373577">p</span><span class="op" id="4373578">.</span><span class="ident" id="4373579">tok</span>&nbsp;<span class="op" id="4373583">==</span>&nbsp;<span class="ident" id="4373586">token</span><span class="op" id="4373591">.</span><span class="ident" id="4373592">MUL</span>&nbsp;<span class="op" id="4373596">||</span>&nbsp;<span class="ident" id="4373599">p</span><span class="op" id="4373600">.</span><span class="ident" id="4373601">tok</span>&nbsp;<span class="op" id="4373605">==</span>&nbsp;<span class="ident" id="4373608">token</span><span class="op" id="4373613">.</span><span class="ident" id="4373614">LPAREN</span>&nbsp;<span class="op" id="4373621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4373625">//&nbsp;a&nbsp;field&nbsp;declaration&nbsp;cannot&nbsp;start&nbsp;with&nbsp;a&nbsp;&#39;(&#39;&nbsp;but&nbsp;we&nbsp;accept</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4373688">//&nbsp;it&nbsp;here&nbsp;for&nbsp;more&nbsp;robust&nbsp;parsing&nbsp;and&nbsp;better&nbsp;error&nbsp;messages</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4373751">//&nbsp;(parseFieldDecl&nbsp;will&nbsp;check&nbsp;and&nbsp;complain&nbsp;if&nbsp;necessary)</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4373810">list</span>&nbsp;<span class="op" id="4373815">=</span>&nbsp;<span class="builtinfunc" id="4373817">append</span><span class="op" id="4373823">(</span><span class="ident" id="4373824">list</span><span class="op" id="4373828">,</span>&nbsp;<span class="ident" id="4373830">p</span><span class="op" id="4373831">.</span><span class="ident" id="4373832">parseFieldDecl</span><span class="op" id="4373846">(</span><span class="ident" id="4373847">scope</span><span class="op" id="4373852">)</span><span class="op" id="4373853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4373856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4373859">rbrace</span>&nbsp;<span class="op" id="4373866">:=</span>&nbsp;<span class="ident" id="4373869">p</span><span class="op" id="4373870">.</span><span class="ident" id="4373871">expect</span><span class="op" id="4373877">(</span><span class="ident" id="4373878">token</span><span class="op" id="4373883">.</span><span class="ident" id="4373884">RBRACE</span><span class="op" id="4373890">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4373894">return</span>&nbsp;<span class="op" id="4373901">&amp;</span><span class="ident" id="4373902">ast</span><span class="op" id="4373905">.</span><span class="ident" id="4373906">StructType</span><span class="op" id="4373916">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4373920">Struct</span><span class="op" id="4373926">:</span>&nbsp;<span class="ident" id="4373928">pos</span><span class="op" id="4373931">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4373935">Fields</span><span class="op" id="4373941">:</span>&nbsp;<span class="op" id="4373943">&amp;</span><span class="ident" id="4373944">ast</span><span class="op" id="4373947">.</span><span class="ident" id="4373948">FieldList</span><span class="op" id="4373957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4373962">Opening</span><span class="op" id="4373969">:</span>&nbsp;<span class="ident" id="4373971">lbrace</span><span class="op" id="4373977">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4373982">List</span><span class="op" id="4373986">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4373991">list</span><span class="op" id="4373995">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374000">Closing</span><span class="op" id="4374007">:</span>&nbsp;<span class="ident" id="4374009">rbrace</span><span class="op" id="4374015">,</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4374019">}</span><span class="op" id="4374020">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4374023">}</span><br>
<span class="lineno"></span><span class="op" id="4374025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4374028">func</span>&nbsp;<span class="op" id="4374033">(</span><span class="ident" id="4374034">p</span>&nbsp;<span class="op" id="4374036">*</span><span class="ident" id="4374037">parser</span><span class="op" id="4374043">)</span>&nbsp;<span class="ident" id="4374045">parsePointerType</span><span class="op" id="4374061">(</span><span class="op" id="4374062">)</span>&nbsp;<span class="op" id="4374064">*</span><span class="ident" id="4374065">ast</span><span class="op" id="4374068">.</span><span class="ident" id="4374069">StarExpr</span>&nbsp;<span class="op" id="4374078">{</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4374081">if</span>&nbsp;<span class="ident" id="4374084">p</span><span class="op" id="4374085">.</span><span class="ident" id="4374086">trace</span>&nbsp;<span class="op" id="4374092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4374096">defer</span>&nbsp;<span class="ident" id="4374102">un</span><span class="op" id="4374104">(</span><span class="ident" id="4374105">trace</span><span class="op" id="4374110">(</span><span class="ident" id="4374111">p</span><span class="op" id="4374112">,</span>&nbsp;<span class="string" id="4374114">&#34;PointerType&#34;</span><span class="op" id="4374127">)</span><span class="op" id="4374128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4374131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374135">star</span>&nbsp;<span class="op" id="4374140">:=</span>&nbsp;<span class="ident" id="4374143">p</span><span class="op" id="4374144">.</span><span class="ident" id="4374145">expect</span><span class="op" id="4374151">(</span><span class="ident" id="4374152">token</span><span class="op" id="4374157">.</span><span class="ident" id="4374158">MUL</span><span class="op" id="4374161">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374164">base</span>&nbsp;<span class="op" id="4374169">:=</span>&nbsp;<span class="ident" id="4374172">p</span><span class="op" id="4374173">.</span><span class="ident" id="4374174">parseType</span><span class="op" id="4374183">(</span><span class="op" id="4374184">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4374188">return</span>&nbsp;<span class="op" id="4374195">&amp;</span><span class="ident" id="4374196">ast</span><span class="op" id="4374199">.</span><span class="ident" id="4374200">StarExpr</span><span class="op" id="4374208">{</span><span class="ident" id="4374209">Star</span><span class="op" id="4374213">:</span>&nbsp;<span class="ident" id="4374215">star</span><span class="op" id="4374219">,</span>&nbsp;<span class="ident" id="4374221">X</span><span class="op" id="4374222">:</span>&nbsp;<span class="ident" id="4374224">base</span><span class="op" id="4374228">}</span><br>
<span class="lineno"></span><span class="op" id="4374230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">755</span><span class="comment" id="4374233">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="4374288">func</span>&nbsp;<span class="op" id="4374293">(</span><span class="ident" id="4374294">p</span>&nbsp;<span class="op" id="4374296">*</span><span class="ident" id="4374297">parser</span><span class="op" id="4374303">)</span>&nbsp;<span class="ident" id="4374305">tryVarType</span><span class="op" id="4374315">(</span><span class="ident" id="4374316">isParam</span>&nbsp;<span class="builtintype" id="4374324">bool</span><span class="op" id="4374328">)</span>&nbsp;<span class="ident" id="4374330">ast</span><span class="op" id="4374333">.</span><span class="ident" id="4374334">Expr</span>&nbsp;<span class="op" id="4374339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4374342">if</span>&nbsp;<span class="ident" id="4374345">isParam</span>&nbsp;<span class="op" id="4374353">&amp;&amp;</span>&nbsp;<span class="ident" id="4374356">p</span><span class="op" id="4374357">.</span><span class="ident" id="4374358">tok</span>&nbsp;<span class="op" id="4374362">==</span>&nbsp;<span class="ident" id="4374365">token</span><span class="op" id="4374370">.</span><span class="ident" id="4374371">ELLIPSIS</span>&nbsp;<span class="op" id="4374380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374384">pos</span>&nbsp;<span class="op" id="4374388">:=</span>&nbsp;<span class="ident" id="4374391">p</span><span class="op" id="4374392">.</span><span class="ident" id="4374393">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374399">p</span><span class="op" id="4374400">.</span><span class="ident" id="4374401">next</span><span class="op" id="4374405">(</span><span class="op" id="4374406">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374410">typ</span>&nbsp;<span class="op" id="4374414">:=</span>&nbsp;<span class="ident" id="4374417">p</span><span class="op" id="4374418">.</span><span class="ident" id="4374419">tryIdentOrType</span><span class="op" id="4374433">(</span><span class="op" id="4374434">)</span>&nbsp;<span class="comment" id="4374436">//&nbsp;don&#39;t&nbsp;use&nbsp;parseType&nbsp;so&nbsp;we&nbsp;can&nbsp;provide&nbsp;better&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4374500">if</span>&nbsp;<span class="ident" id="4374503">typ</span>&nbsp;<span class="op" id="4374507">!=</span>&nbsp;<span class="ident" id="4374510">nil</span>&nbsp;<span class="op" id="4374514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374519">p</span><span class="op" id="4374520">.</span><span class="ident" id="4374521">resolve</span><span class="op" id="4374528">(</span><span class="ident" id="4374529">typ</span><span class="op" id="4374532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4374536">}</span>&nbsp;<span class="keyword" id="4374538">else</span>&nbsp;<span class="op" id="4374543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374548">p</span><span class="op" id="4374549">.</span><span class="builtintype" id="4374550">error</span><span class="op" id="4374555">(</span><span class="ident" id="4374556">pos</span><span class="op" id="4374559">,</span>&nbsp;<span class="string" id="4374561">&#34;&#39;...&#39;&nbsp;parameter&nbsp;is&nbsp;missing&nbsp;type&#34;</span><span class="op" id="4374594">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374599">typ</span>&nbsp;<span class="op" id="4374603">=</span>&nbsp;<span class="op" id="4374605">&amp;</span><span class="ident" id="4374606">ast</span><span class="op" id="4374609">.</span><span class="ident" id="4374610">BadExpr</span><span class="op" id="4374617">{</span><span class="ident" id="4374618">From</span><span class="op" id="4374622">:</span>&nbsp;<span class="ident" id="4374624">pos</span><span class="op" id="4374627">,</span>&nbsp;<span class="ident" id="4374629">To</span><span class="op" id="4374631">:</span>&nbsp;<span class="ident" id="4374633">p</span><span class="op" id="4374634">.</span><span class="ident" id="4374635">pos</span><span class="op" id="4374638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4374642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4374646">return</span>&nbsp;<span class="op" id="4374653">&amp;</span><span class="ident" id="4374654">ast</span><span class="op" id="4374657">.</span><span class="ident" id="4374658">Ellipsis</span><span class="op" id="4374666">{</span><span class="ident" id="4374667">Ellipsis</span><span class="op" id="4374675">:</span>&nbsp;<span class="ident" id="4374677">pos</span><span class="op" id="4374680">,</span>&nbsp;<span class="ident" id="4374682">Elt</span><span class="op" id="4374685">:</span>&nbsp;<span class="ident" id="4374687">typ</span><span class="op" id="4374690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4374693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4374696">return</span>&nbsp;<span class="ident" id="4374703">p</span><span class="op" id="4374704">.</span><span class="ident" id="4374705">tryIdentOrType</span><span class="op" id="4374719">(</span><span class="op" id="4374720">)</span><br>
<span class="lineno">770</span><span class="op" id="4374722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4374725">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="4374780">func</span>&nbsp;<span class="op" id="4374785">(</span><span class="ident" id="4374786">p</span>&nbsp;<span class="op" id="4374788">*</span><span class="ident" id="4374789">parser</span><span class="op" id="4374795">)</span>&nbsp;<span class="ident" id="4374797">parseVarType</span><span class="op" id="4374809">(</span><span class="ident" id="4374810">isParam</span>&nbsp;<span class="builtintype" id="4374818">bool</span><span class="op" id="4374822">)</span>&nbsp;<span class="ident" id="4374824">ast</span><span class="op" id="4374827">.</span><span class="ident" id="4374828">Expr</span>&nbsp;<span class="op" id="4374833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374836">typ</span>&nbsp;<span class="op" id="4374840">:=</span>&nbsp;<span class="ident" id="4374843">p</span><span class="op" id="4374844">.</span><span class="ident" id="4374845">tryVarType</span><span class="op" id="4374855">(</span><span class="ident" id="4374856">isParam</span><span class="op" id="4374863">)</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4374866">if</span>&nbsp;<span class="ident" id="4374869">typ</span>&nbsp;<span class="op" id="4374873">==</span>&nbsp;<span class="ident" id="4374876">nil</span>&nbsp;<span class="op" id="4374880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374884">pos</span>&nbsp;<span class="op" id="4374888">:=</span>&nbsp;<span class="ident" id="4374891">p</span><span class="op" id="4374892">.</span><span class="ident" id="4374893">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374899">p</span><span class="op" id="4374900">.</span><span class="ident" id="4374901">errorExpected</span><span class="op" id="4374914">(</span><span class="ident" id="4374915">pos</span><span class="op" id="4374918">,</span>&nbsp;<span class="string" id="4374920">&#34;type&#34;</span><span class="op" id="4374926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374930">p</span><span class="op" id="4374931">.</span><span class="ident" id="4374932">next</span><span class="op" id="4374936">(</span><span class="op" id="4374937">)</span>&nbsp;<span class="comment" id="4374939">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4374958">typ</span>&nbsp;<span class="op" id="4374962">=</span>&nbsp;<span class="op" id="4374964">&amp;</span><span class="ident" id="4374965">ast</span><span class="op" id="4374968">.</span><span class="ident" id="4374969">BadExpr</span><span class="op" id="4374976">{</span><span class="ident" id="4374977">From</span><span class="op" id="4374981">:</span>&nbsp;<span class="ident" id="4374983">pos</span><span class="op" id="4374986">,</span>&nbsp;<span class="ident" id="4374988">To</span><span class="op" id="4374990">:</span>&nbsp;<span class="ident" id="4374992">p</span><span class="op" id="4374993">.</span><span class="ident" id="4374994">pos</span><span class="op" id="4374997">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4375000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4375003">return</span>&nbsp;<span class="ident" id="4375010">typ</span><br>
<span class="lineno"></span><span class="op" id="4375014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4375017">//&nbsp;If&nbsp;any&nbsp;of&nbsp;the&nbsp;results&nbsp;are&nbsp;identifiers,&nbsp;they&nbsp;are&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">785</span><span class="keyword" id="4375082">func</span>&nbsp;<span class="op" id="4375087">(</span><span class="ident" id="4375088">p</span>&nbsp;<span class="op" id="4375090">*</span><span class="ident" id="4375091">parser</span><span class="op" id="4375097">)</span>&nbsp;<span class="ident" id="4375099">parseVarList</span><span class="op" id="4375111">(</span><span class="ident" id="4375112">isParam</span>&nbsp;<span class="builtintype" id="4375120">bool</span><span class="op" id="4375124">)</span>&nbsp;<span class="op" id="4375126">(</span><span class="ident" id="4375127">list</span>&nbsp;<span class="op" id="4375132">[</span><span class="op" id="4375133">]</span><span class="ident" id="4375134">ast</span><span class="op" id="4375137">.</span><span class="ident" id="4375138">Expr</span><span class="op" id="4375142">,</span>&nbsp;<span class="ident" id="4375144">typ</span>&nbsp;<span class="ident" id="4375148">ast</span><span class="op" id="4375151">.</span><span class="ident" id="4375152">Expr</span><span class="op" id="4375156">)</span>&nbsp;<span class="op" id="4375158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4375161">if</span>&nbsp;<span class="ident" id="4375164">p</span><span class="op" id="4375165">.</span><span class="ident" id="4375166">trace</span>&nbsp;<span class="op" id="4375172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4375176">defer</span>&nbsp;<span class="ident" id="4375182">un</span><span class="op" id="4375184">(</span><span class="ident" id="4375185">trace</span><span class="op" id="4375190">(</span><span class="ident" id="4375191">p</span><span class="op" id="4375192">,</span>&nbsp;<span class="string" id="4375194">&#34;VarList&#34;</span><span class="op" id="4375203">)</span><span class="op" id="4375204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4375207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4375211">//&nbsp;a&nbsp;list&nbsp;of&nbsp;identifiers&nbsp;looks&nbsp;like&nbsp;a&nbsp;list&nbsp;of&nbsp;type&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4375269">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4375273">//&nbsp;parse/tryVarType&nbsp;accepts&nbsp;any&nbsp;type&nbsp;(including&nbsp;parenthesized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4375336">//&nbsp;ones)&nbsp;even&nbsp;though&nbsp;the&nbsp;syntax&nbsp;does&nbsp;not&nbsp;permit&nbsp;them&nbsp;here:&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4375399">//&nbsp;accept&nbsp;them&nbsp;all&nbsp;for&nbsp;more&nbsp;robust&nbsp;parsing&nbsp;and&nbsp;complain&nbsp;later</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4375462">for</span>&nbsp;<span class="ident" id="4375466">typ</span>&nbsp;<span class="op" id="4375470">:=</span>&nbsp;<span class="ident" id="4375473">p</span><span class="op" id="4375474">.</span><span class="ident" id="4375475">parseVarType</span><span class="op" id="4375487">(</span><span class="ident" id="4375488">isParam</span><span class="op" id="4375495">)</span><span class="op" id="4375496">;</span>&nbsp;<span class="ident" id="4375498">typ</span>&nbsp;<span class="op" id="4375502">!=</span>&nbsp;<span class="ident" id="4375505">nil</span><span class="op" id="4375508">;</span>&nbsp;<span class="op" id="4375510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4375514">list</span>&nbsp;<span class="op" id="4375519">=</span>&nbsp;<span class="builtinfunc" id="4375521">append</span><span class="op" id="4375527">(</span><span class="ident" id="4375528">list</span><span class="op" id="4375532">,</span>&nbsp;<span class="ident" id="4375534">typ</span><span class="op" id="4375537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4375541">if</span>&nbsp;<span class="ident" id="4375544">p</span><span class="op" id="4375545">.</span><span class="ident" id="4375546">tok</span>&nbsp;<span class="op" id="4375550">!=</span>&nbsp;<span class="ident" id="4375553">token</span><span class="op" id="4375558">.</span><span class="ident" id="4375559">COMMA</span>&nbsp;<span class="op" id="4375565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4375570">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4375578">}</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4375582">p</span><span class="op" id="4375583">.</span><span class="ident" id="4375584">next</span><span class="op" id="4375588">(</span><span class="op" id="4375589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4375593">typ</span>&nbsp;<span class="op" id="4375597">=</span>&nbsp;<span class="ident" id="4375599">p</span><span class="op" id="4375600">.</span><span class="ident" id="4375601">tryVarType</span><span class="op" id="4375611">(</span><span class="ident" id="4375612">isParam</span><span class="op" id="4375619">)</span>&nbsp;<span class="comment" id="4375621">//&nbsp;maybe&nbsp;nil&nbsp;as&nbsp;in:&nbsp;func&nbsp;f(int,)&nbsp;{}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4375658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4375662">//&nbsp;if&nbsp;we&nbsp;had&nbsp;a&nbsp;list&nbsp;of&nbsp;identifiers,&nbsp;it&nbsp;must&nbsp;be&nbsp;followed&nbsp;by&nbsp;a&nbsp;type</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4375729">typ</span>&nbsp;<span class="op" id="4375733">=</span>&nbsp;<span class="ident" id="4375735">p</span><span class="op" id="4375736">.</span><span class="ident" id="4375737">tryVarType</span><span class="op" id="4375747">(</span><span class="ident" id="4375748">isParam</span><span class="op" id="4375755">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4375759">return</span><br>
<span class="lineno"></span><span class="op" id="4375766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">810</span><span class="keyword" id="4375769">func</span>&nbsp;<span class="op" id="4375774">(</span><span class="ident" id="4375775">p</span>&nbsp;<span class="op" id="4375777">*</span><span class="ident" id="4375778">parser</span><span class="op" id="4375784">)</span>&nbsp;<span class="ident" id="4375786">parseParameterList</span><span class="op" id="4375804">(</span><span class="ident" id="4375805">scope</span>&nbsp;<span class="op" id="4375811">*</span><span class="ident" id="4375812">ast</span><span class="op" id="4375815">.</span><span class="ident" id="4375816">Scope</span><span class="op" id="4375821">,</span>&nbsp;<span class="ident" id="4375823">ellipsisOk</span>&nbsp;<span class="builtintype" id="4375834">bool</span><span class="op" id="4375838">)</span>&nbsp;<span class="op" id="4375840">(</span><span class="ident" id="4375841">params</span>&nbsp;<span class="op" id="4375848">[</span><span class="op" id="4375849">]</span><span class="op" id="4375850">*</span><span class="ident" id="4375851">ast</span><span class="op" id="4375854">.</span><span class="ident" id="4375855">Field</span><span class="op" id="4375860">)</span>&nbsp;<span class="op" id="4375862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4375865">if</span>&nbsp;<span class="ident" id="4375868">p</span><span class="op" id="4375869">.</span><span class="ident" id="4375870">trace</span>&nbsp;<span class="op" id="4375876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4375880">defer</span>&nbsp;<span class="ident" id="4375886">un</span><span class="op" id="4375888">(</span><span class="ident" id="4375889">trace</span><span class="op" id="4375894">(</span><span class="ident" id="4375895">p</span><span class="op" id="4375896">,</span>&nbsp;<span class="string" id="4375898">&#34;ParameterList&#34;</span><span class="op" id="4375913">)</span><span class="op" id="4375914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4375917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4375921">//&nbsp;ParameterDecl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4375939">list</span><span class="op" id="4375943">,</span>&nbsp;<span class="ident" id="4375945">typ</span>&nbsp;<span class="op" id="4375949">:=</span>&nbsp;<span class="ident" id="4375952">p</span><span class="op" id="4375953">.</span><span class="ident" id="4375954">parseVarList</span><span class="op" id="4375966">(</span><span class="ident" id="4375967">ellipsisOk</span><span class="op" id="4375977">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4375981">//&nbsp;analyze&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4375998">if</span>&nbsp;<span class="ident" id="4376001">typ</span>&nbsp;<span class="op" id="4376005">!=</span>&nbsp;<span class="ident" id="4376008">nil</span>&nbsp;<span class="op" id="4376012">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4376016">//&nbsp;IdentifierList&nbsp;Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4376041">idents</span>&nbsp;<span class="op" id="4376048">:=</span>&nbsp;<span class="ident" id="4376051">p</span><span class="op" id="4376052">.</span><span class="ident" id="4376053">makeIdentList</span><span class="op" id="4376066">(</span><span class="ident" id="4376067">list</span><span class="op" id="4376071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4376075">field</span>&nbsp;<span class="op" id="4376081">:=</span>&nbsp;<span class="op" id="4376084">&amp;</span><span class="ident" id="4376085">ast</span><span class="op" id="4376088">.</span><span class="ident" id="4376089">Field</span><span class="op" id="4376094">{</span><span class="ident" id="4376095">Names</span><span class="op" id="4376100">:</span>&nbsp;<span class="ident" id="4376102">idents</span><span class="op" id="4376108">,</span>&nbsp;<span class="ident" id="4376110">Type</span><span class="op" id="4376114">:</span>&nbsp;<span class="ident" id="4376116">typ</span><span class="op" id="4376119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4376123">params</span>&nbsp;<span class="op" id="4376130">=</span>&nbsp;<span class="builtinfunc" id="4376132">append</span><span class="op" id="4376138">(</span><span class="ident" id="4376139">params</span><span class="op" id="4376145">,</span>&nbsp;<span class="ident" id="4376147">field</span><span class="op" id="4376152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4376156">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;function</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4376217">//&nbsp;parameter&nbsp;or&nbsp;result&nbsp;variable&nbsp;is&nbsp;the&nbsp;function&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4376273">p</span><span class="op" id="4376274">.</span><span class="ident" id="4376275">declare</span><span class="op" id="4376282">(</span><span class="ident" id="4376283">field</span><span class="op" id="4376288">,</span>&nbsp;<span class="ident" id="4376290">nil</span><span class="op" id="4376293">,</span>&nbsp;<span class="ident" id="4376295">scope</span><span class="op" id="4376300">,</span>&nbsp;<span class="ident" id="4376302">ast</span><span class="op" id="4376305">.</span><span class="ident" id="4376306">Var</span><span class="op" id="4376309">,</span>&nbsp;<span class="ident" id="4376311">idents</span><span class="op" id="4376317">...</span><span class="op" id="4376320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4376324">p</span><span class="op" id="4376325">.</span><span class="ident" id="4376326">resolve</span><span class="op" id="4376333">(</span><span class="ident" id="4376334">typ</span><span class="op" id="4376337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4376341">if</span>&nbsp;<span class="op" id="4376344">!</span><span class="ident" id="4376345">p</span><span class="op" id="4376346">.</span><span class="ident" id="4376347">atComma</span><span class="op" id="4376354">(</span><span class="string" id="4376355">&#34;parameter&nbsp;list&#34;</span><span class="op" id="4376371">)</span>&nbsp;<span class="op" id="4376373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4376378">return</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4376387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4376391">p</span><span class="op" id="4376392">.</span><span class="ident" id="4376393">next</span><span class="op" id="4376397">(</span><span class="op" id="4376398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4376402">for</span>&nbsp;<span class="ident" id="4376406">p</span><span class="op" id="4376407">.</span><span class="ident" id="4376408">tok</span>&nbsp;<span class="op" id="4376412">!=</span>&nbsp;<span class="ident" id="4376415">token</span><span class="op" id="4376420">.</span><span class="ident" id="4376421">RPAREN</span>&nbsp;<span class="op" id="4376428">&amp;&amp;</span>&nbsp;<span class="ident" id="4376431">p</span><span class="op" id="4376432">.</span><span class="ident" id="4376433">tok</span>&nbsp;<span class="op" id="4376437">!=</span>&nbsp;<span class="ident" id="4376440">token</span><span class="op" id="4376445">.</span><span class="ident" id="4376446">EOF</span>&nbsp;<span class="op" id="4376450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4376455">idents</span>&nbsp;<span class="op" id="4376462">:=</span>&nbsp;<span class="ident" id="4376465">p</span><span class="op" id="4376466">.</span><span class="ident" id="4376467">parseIdentList</span><span class="op" id="4376481">(</span><span class="op" id="4376482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4376487">typ</span>&nbsp;<span class="op" id="4376491">:=</span>&nbsp;<span class="ident" id="4376494">p</span><span class="op" id="4376495">.</span><span class="ident" id="4376496">parseVarType</span><span class="op" id="4376508">(</span><span class="ident" id="4376509">ellipsisOk</span><span class="op" id="4376519">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4376524">field</span>&nbsp;<span class="op" id="4376530">:=</span>&nbsp;<span class="op" id="4376533">&amp;</span><span class="ident" id="4376534">ast</span><span class="op" id="4376537">.</span><span class="ident" id="4376538">Field</span><span class="op" id="4376543">{</span><span class="ident" id="4376544">Names</span><span class="op" id="4376549">:</span>&nbsp;<span class="ident" id="4376551">idents</span><span class="op" id="4376557">,</span>&nbsp;<span class="ident" id="4376559">Type</span><span class="op" id="4376563">:</span>&nbsp;<span class="ident" id="4376565">typ</span><span class="op" id="4376568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4376573">params</span>&nbsp;<span class="op" id="4376580">=</span>&nbsp;<span class="builtinfunc" id="4376582">append</span><span class="op" id="4376588">(</span><span class="ident" id="4376589">params</span><span class="op" id="4376595">,</span>&nbsp;<span class="ident" id="4376597">field</span><span class="op" id="4376602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4376607">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4376669">//&nbsp;parameter&nbsp;or&nbsp;result&nbsp;variable&nbsp;is&nbsp;the&nbsp;function&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4376726">p</span><span class="op" id="4376727">.</span><span class="ident" id="4376728">declare</span><span class="op" id="4376735">(</span><span class="ident" id="4376736">field</span><span class="op" id="4376741">,</span>&nbsp;<span class="ident" id="4376743">nil</span><span class="op" id="4376746">,</span>&nbsp;<span class="ident" id="4376748">scope</span><span class="op" id="4376753">,</span>&nbsp;<span class="ident" id="4376755">ast</span><span class="op" id="4376758">.</span><span class="ident" id="4376759">Var</span><span class="op" id="4376762">,</span>&nbsp;<span class="ident" id="4376764">idents</span><span class="op" id="4376770">...</span><span class="op" id="4376773">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4376778">p</span><span class="op" id="4376779">.</span><span class="ident" id="4376780">resolve</span><span class="op" id="4376787">(</span><span class="ident" id="4376788">typ</span><span class="op" id="4376791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4376796">if</span>&nbsp;<span class="op" id="4376799">!</span><span class="ident" id="4376800">p</span><span class="op" id="4376801">.</span><span class="ident" id="4376802">atComma</span><span class="op" id="4376809">(</span><span class="string" id="4376810">&#34;parameter&nbsp;list&#34;</span><span class="op" id="4376826">)</span>&nbsp;<span class="op" id="4376828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4376834">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4376843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4376848">p</span><span class="op" id="4376849">.</span><span class="ident" id="4376850">next</span><span class="op" id="4376854">(</span><span class="op" id="4376855">)</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4376859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4376863">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4376871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4376875">//&nbsp;Type&nbsp;{&nbsp;&#34;,&#34;&nbsp;Type&nbsp;}&nbsp;(anonymous&nbsp;parameters)</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4376920">params</span>&nbsp;<span class="op" id="4376927">=</span>&nbsp;<span class="builtinfunc" id="4376929">make</span><span class="op" id="4376933">(</span><span class="op" id="4376934">[</span><span class="op" id="4376935">]</span><span class="op" id="4376936">*</span><span class="ident" id="4376937">ast</span><span class="op" id="4376940">.</span><span class="ident" id="4376941">Field</span><span class="op" id="4376946">,</span>&nbsp;<span class="builtinfunc" id="4376948">len</span><span class="op" id="4376951">(</span><span class="ident" id="4376952">list</span><span class="op" id="4376956">)</span><span class="op" id="4376957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4376960">for</span>&nbsp;<span class="ident" id="4376964">i</span><span class="op" id="4376965">,</span>&nbsp;<span class="ident" id="4376967">typ</span>&nbsp;<span class="op" id="4376971">:=</span>&nbsp;<span class="keyword" id="4376974">range</span>&nbsp;<span class="ident" id="4376980">list</span>&nbsp;<span class="op" id="4376985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4376989">p</span><span class="op" id="4376990">.</span><span class="ident" id="4376991">resolve</span><span class="op" id="4376998">(</span><span class="ident" id="4376999">typ</span><span class="op" id="4377002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377006">params</span><span class="op" id="4377012">[</span><span class="ident" id="4377013">i</span><span class="op" id="4377014">]</span>&nbsp;<span class="op" id="4377016">=</span>&nbsp;<span class="op" id="4377018">&amp;</span><span class="ident" id="4377019">ast</span><span class="op" id="4377022">.</span><span class="ident" id="4377023">Field</span><span class="op" id="4377028">{</span><span class="ident" id="4377029">Type</span><span class="op" id="4377033">:</span>&nbsp;<span class="ident" id="4377035">typ</span><span class="op" id="4377038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4377041">}</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4377044">return</span><br>
<span class="lineno"></span><span class="op" id="4377051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4377054">func</span>&nbsp;<span class="op" id="4377059">(</span><span class="ident" id="4377060">p</span>&nbsp;<span class="op" id="4377062">*</span><span class="ident" id="4377063">parser</span><span class="op" id="4377069">)</span>&nbsp;<span class="ident" id="4377071">parseParameters</span><span class="op" id="4377086">(</span><span class="ident" id="4377087">scope</span>&nbsp;<span class="op" id="4377093">*</span><span class="ident" id="4377094">ast</span><span class="op" id="4377097">.</span><span class="ident" id="4377098">Scope</span><span class="op" id="4377103">,</span>&nbsp;<span class="ident" id="4377105">ellipsisOk</span>&nbsp;<span class="builtintype" id="4377116">bool</span><span class="op" id="4377120">)</span>&nbsp;<span class="op" id="4377122">*</span><span class="ident" id="4377123">ast</span><span class="op" id="4377126">.</span><span class="ident" id="4377127">FieldList</span>&nbsp;<span class="op" id="4377137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4377140">if</span>&nbsp;<span class="ident" id="4377143">p</span><span class="op" id="4377144">.</span><span class="ident" id="4377145">trace</span>&nbsp;<span class="op" id="4377151">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4377155">defer</span>&nbsp;<span class="ident" id="4377161">un</span><span class="op" id="4377163">(</span><span class="ident" id="4377164">trace</span><span class="op" id="4377169">(</span><span class="ident" id="4377170">p</span><span class="op" id="4377171">,</span>&nbsp;<span class="string" id="4377173">&#34;Parameters&#34;</span><span class="op" id="4377185">)</span><span class="op" id="4377186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4377189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4377193">var</span>&nbsp;<span class="ident" id="4377197">params</span>&nbsp;<span class="op" id="4377204">[</span><span class="op" id="4377205">]</span><span class="op" id="4377206">*</span><span class="ident" id="4377207">ast</span><span class="op" id="4377210">.</span><span class="ident" id="4377211">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377218">lparen</span>&nbsp;<span class="op" id="4377225">:=</span>&nbsp;<span class="ident" id="4377228">p</span><span class="op" id="4377229">.</span><span class="ident" id="4377230">expect</span><span class="op" id="4377236">(</span><span class="ident" id="4377237">token</span><span class="op" id="4377242">.</span><span class="ident" id="4377243">LPAREN</span><span class="op" id="4377249">)</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4377252">if</span>&nbsp;<span class="ident" id="4377255">p</span><span class="op" id="4377256">.</span><span class="ident" id="4377257">tok</span>&nbsp;<span class="op" id="4377261">!=</span>&nbsp;<span class="ident" id="4377264">token</span><span class="op" id="4377269">.</span><span class="ident" id="4377270">RPAREN</span>&nbsp;<span class="op" id="4377277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377281">params</span>&nbsp;<span class="op" id="4377288">=</span>&nbsp;<span class="ident" id="4377290">p</span><span class="op" id="4377291">.</span><span class="ident" id="4377292">parseParameterList</span><span class="op" id="4377310">(</span><span class="ident" id="4377311">scope</span><span class="op" id="4377316">,</span>&nbsp;<span class="ident" id="4377318">ellipsisOk</span><span class="op" id="4377328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4377331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377334">rparen</span>&nbsp;<span class="op" id="4377341">:=</span>&nbsp;<span class="ident" id="4377344">p</span><span class="op" id="4377345">.</span><span class="ident" id="4377346">expect</span><span class="op" id="4377352">(</span><span class="ident" id="4377353">token</span><span class="op" id="4377358">.</span><span class="ident" id="4377359">RPAREN</span><span class="op" id="4377365">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4377369">return</span>&nbsp;<span class="op" id="4377376">&amp;</span><span class="ident" id="4377377">ast</span><span class="op" id="4377380">.</span><span class="ident" id="4377381">FieldList</span><span class="op" id="4377390">{</span><span class="ident" id="4377391">Opening</span><span class="op" id="4377398">:</span>&nbsp;<span class="ident" id="4377400">lparen</span><span class="op" id="4377406">,</span>&nbsp;<span class="ident" id="4377408">List</span><span class="op" id="4377412">:</span>&nbsp;<span class="ident" id="4377414">params</span><span class="op" id="4377420">,</span>&nbsp;<span class="ident" id="4377422">Closing</span><span class="op" id="4377429">:</span>&nbsp;<span class="ident" id="4377431">rparen</span><span class="op" id="4377437">}</span><br>
<span class="lineno"></span><span class="op" id="4377439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4377442">func</span>&nbsp;<span class="op" id="4377447">(</span><span class="ident" id="4377448">p</span>&nbsp;<span class="op" id="4377450">*</span><span class="ident" id="4377451">parser</span><span class="op" id="4377457">)</span>&nbsp;<span class="ident" id="4377459">parseResult</span><span class="op" id="4377470">(</span><span class="ident" id="4377471">scope</span>&nbsp;<span class="op" id="4377477">*</span><span class="ident" id="4377478">ast</span><span class="op" id="4377481">.</span><span class="ident" id="4377482">Scope</span><span class="op" id="4377487">)</span>&nbsp;<span class="op" id="4377489">*</span><span class="ident" id="4377490">ast</span><span class="op" id="4377493">.</span><span class="ident" id="4377494">FieldList</span>&nbsp;<span class="op" id="4377504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4377507">if</span>&nbsp;<span class="ident" id="4377510">p</span><span class="op" id="4377511">.</span><span class="ident" id="4377512">trace</span>&nbsp;<span class="op" id="4377518">{</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4377522">defer</span>&nbsp;<span class="ident" id="4377528">un</span><span class="op" id="4377530">(</span><span class="ident" id="4377531">trace</span><span class="op" id="4377536">(</span><span class="ident" id="4377537">p</span><span class="op" id="4377538">,</span>&nbsp;<span class="string" id="4377540">&#34;Result&#34;</span><span class="op" id="4377548">)</span><span class="op" id="4377549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4377552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4377556">if</span>&nbsp;<span class="ident" id="4377559">p</span><span class="op" id="4377560">.</span><span class="ident" id="4377561">tok</span>&nbsp;<span class="op" id="4377565">==</span>&nbsp;<span class="ident" id="4377568">token</span><span class="op" id="4377573">.</span><span class="ident" id="4377574">LPAREN</span>&nbsp;<span class="op" id="4377581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4377585">return</span>&nbsp;<span class="ident" id="4377592">p</span><span class="op" id="4377593">.</span><span class="ident" id="4377594">parseParameters</span><span class="op" id="4377609">(</span><span class="ident" id="4377610">scope</span><span class="op" id="4377615">,</span>&nbsp;<span class="builtintype" id="4377617">false</span><span class="op" id="4377622">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4377625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377629">typ</span>&nbsp;<span class="op" id="4377633">:=</span>&nbsp;<span class="ident" id="4377636">p</span><span class="op" id="4377637">.</span><span class="ident" id="4377638">tryType</span><span class="op" id="4377645">(</span><span class="op" id="4377646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4377649">if</span>&nbsp;<span class="ident" id="4377652">typ</span>&nbsp;<span class="op" id="4377656">!=</span>&nbsp;<span class="ident" id="4377659">nil</span>&nbsp;<span class="op" id="4377663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377667">list</span>&nbsp;<span class="op" id="4377672">:=</span>&nbsp;<span class="builtinfunc" id="4377675">make</span><span class="op" id="4377679">(</span><span class="op" id="4377680">[</span><span class="op" id="4377681">]</span><span class="op" id="4377682">*</span><span class="ident" id="4377683">ast</span><span class="op" id="4377686">.</span><span class="ident" id="4377687">Field</span><span class="op" id="4377692">,</span>&nbsp;<span class="num" id="4377694">1</span><span class="op" id="4377695">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377699">list</span><span class="op" id="4377703">[</span><span class="num" id="4377704">0</span><span class="op" id="4377705">]</span>&nbsp;<span class="op" id="4377707">=</span>&nbsp;<span class="op" id="4377709">&amp;</span><span class="ident" id="4377710">ast</span><span class="op" id="4377713">.</span><span class="ident" id="4377714">Field</span><span class="op" id="4377719">{</span><span class="ident" id="4377720">Type</span><span class="op" id="4377724">:</span>&nbsp;<span class="ident" id="4377726">typ</span><span class="op" id="4377729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4377733">return</span>&nbsp;<span class="op" id="4377740">&amp;</span><span class="ident" id="4377741">ast</span><span class="op" id="4377744">.</span><span class="ident" id="4377745">FieldList</span><span class="op" id="4377754">{</span><span class="ident" id="4377755">List</span><span class="op" id="4377759">:</span>&nbsp;<span class="ident" id="4377761">list</span><span class="op" id="4377765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4377768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4377772">return</span>&nbsp;<span class="ident" id="4377779">nil</span><br>
<span class="lineno">890</span><span class="op" id="4377783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4377786">func</span>&nbsp;<span class="op" id="4377791">(</span><span class="ident" id="4377792">p</span>&nbsp;<span class="op" id="4377794">*</span><span class="ident" id="4377795">parser</span><span class="op" id="4377801">)</span>&nbsp;<span class="ident" id="4377803">parseSignature</span><span class="op" id="4377817">(</span><span class="ident" id="4377818">scope</span>&nbsp;<span class="op" id="4377824">*</span><span class="ident" id="4377825">ast</span><span class="op" id="4377828">.</span><span class="ident" id="4377829">Scope</span><span class="op" id="4377834">)</span>&nbsp;<span class="op" id="4377836">(</span><span class="ident" id="4377837">params</span><span class="op" id="4377843">,</span>&nbsp;<span class="ident" id="4377845">results</span>&nbsp;<span class="op" id="4377853">*</span><span class="ident" id="4377854">ast</span><span class="op" id="4377857">.</span><span class="ident" id="4377858">FieldList</span><span class="op" id="4377867">)</span>&nbsp;<span class="op" id="4377869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4377872">if</span>&nbsp;<span class="ident" id="4377875">p</span><span class="op" id="4377876">.</span><span class="ident" id="4377877">trace</span>&nbsp;<span class="op" id="4377883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4377887">defer</span>&nbsp;<span class="ident" id="4377893">un</span><span class="op" id="4377895">(</span><span class="ident" id="4377896">trace</span><span class="op" id="4377901">(</span><span class="ident" id="4377902">p</span><span class="op" id="4377903">,</span>&nbsp;<span class="string" id="4377905">&#34;Signature&#34;</span><span class="op" id="4377916">)</span><span class="op" id="4377917">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4377920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377924">params</span>&nbsp;<span class="op" id="4377931">=</span>&nbsp;<span class="ident" id="4377933">p</span><span class="op" id="4377934">.</span><span class="ident" id="4377935">parseParameters</span><span class="op" id="4377950">(</span><span class="ident" id="4377951">scope</span><span class="op" id="4377956">,</span>&nbsp;<span class="builtintype" id="4377958">true</span><span class="op" id="4377962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4377965">results</span>&nbsp;<span class="op" id="4377973">=</span>&nbsp;<span class="ident" id="4377975">p</span><span class="op" id="4377976">.</span><span class="ident" id="4377977">parseResult</span><span class="op" id="4377988">(</span><span class="ident" id="4377989">scope</span><span class="op" id="4377994">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4377998">return</span><br>
<span class="lineno"></span><span class="op" id="4378005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4378008">func</span>&nbsp;<span class="op" id="4378013">(</span><span class="ident" id="4378014">p</span>&nbsp;<span class="op" id="4378016">*</span><span class="ident" id="4378017">parser</span><span class="op" id="4378023">)</span>&nbsp;<span class="ident" id="4378025">parseFuncType</span><span class="op" id="4378038">(</span><span class="op" id="4378039">)</span>&nbsp;<span class="op" id="4378041">(</span><span class="op" id="4378042">*</span><span class="ident" id="4378043">ast</span><span class="op" id="4378046">.</span><span class="ident" id="4378047">FuncType</span><span class="op" id="4378055">,</span>&nbsp;<span class="op" id="4378057">*</span><span class="ident" id="4378058">ast</span><span class="op" id="4378061">.</span><span class="ident" id="4378062">Scope</span><span class="op" id="4378067">)</span>&nbsp;<span class="op" id="4378069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4378072">if</span>&nbsp;<span class="ident" id="4378075">p</span><span class="op" id="4378076">.</span><span class="ident" id="4378077">trace</span>&nbsp;<span class="op" id="4378083">{</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4378087">defer</span>&nbsp;<span class="ident" id="4378093">un</span><span class="op" id="4378095">(</span><span class="ident" id="4378096">trace</span><span class="op" id="4378101">(</span><span class="ident" id="4378102">p</span><span class="op" id="4378103">,</span>&nbsp;<span class="string" id="4378105">&#34;FuncType&#34;</span><span class="op" id="4378115">)</span><span class="op" id="4378116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4378119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378123">pos</span>&nbsp;<span class="op" id="4378127">:=</span>&nbsp;<span class="ident" id="4378130">p</span><span class="op" id="4378131">.</span><span class="ident" id="4378132">expect</span><span class="op" id="4378138">(</span><span class="ident" id="4378139">token</span><span class="op" id="4378144">.</span><span class="ident" id="4378145">FUNC</span><span class="op" id="4378149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378152">scope</span>&nbsp;<span class="op" id="4378158">:=</span>&nbsp;<span class="ident" id="4378161">ast</span><span class="op" id="4378164">.</span><span class="ident" id="4378165">NewScope</span><span class="op" id="4378173">(</span><span class="ident" id="4378174">p</span><span class="op" id="4378175">.</span><span class="ident" id="4378176">topScope</span><span class="op" id="4378184">)</span>&nbsp;<span class="comment" id="4378186">//&nbsp;function&nbsp;scope</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378205">params</span><span class="op" id="4378211">,</span>&nbsp;<span class="ident" id="4378213">results</span>&nbsp;<span class="op" id="4378221">:=</span>&nbsp;<span class="ident" id="4378224">p</span><span class="op" id="4378225">.</span><span class="ident" id="4378226">parseSignature</span><span class="op" id="4378240">(</span><span class="ident" id="4378241">scope</span><span class="op" id="4378246">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4378250">return</span>&nbsp;<span class="op" id="4378257">&amp;</span><span class="ident" id="4378258">ast</span><span class="op" id="4378261">.</span><span class="ident" id="4378262">FuncType</span><span class="op" id="4378270">{</span><span class="ident" id="4378271">Func</span><span class="op" id="4378275">:</span>&nbsp;<span class="ident" id="4378277">pos</span><span class="op" id="4378280">,</span>&nbsp;<span class="ident" id="4378282">Params</span><span class="op" id="4378288">:</span>&nbsp;<span class="ident" id="4378290">params</span><span class="op" id="4378296">,</span>&nbsp;<span class="ident" id="4378298">Results</span><span class="op" id="4378305">:</span>&nbsp;<span class="ident" id="4378307">results</span><span class="op" id="4378314">}</span><span class="op" id="4378315">,</span>&nbsp;<span class="ident" id="4378317">scope</span><br>
<span class="lineno"></span><span class="op" id="4378323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">915</span><span class="keyword" id="4378326">func</span>&nbsp;<span class="op" id="4378331">(</span><span class="ident" id="4378332">p</span>&nbsp;<span class="op" id="4378334">*</span><span class="ident" id="4378335">parser</span><span class="op" id="4378341">)</span>&nbsp;<span class="ident" id="4378343">parseMethodSpec</span><span class="op" id="4378358">(</span><span class="ident" id="4378359">scope</span>&nbsp;<span class="op" id="4378365">*</span><span class="ident" id="4378366">ast</span><span class="op" id="4378369">.</span><span class="ident" id="4378370">Scope</span><span class="op" id="4378375">)</span>&nbsp;<span class="op" id="4378377">*</span><span class="ident" id="4378378">ast</span><span class="op" id="4378381">.</span><span class="ident" id="4378382">Field</span>&nbsp;<span class="op" id="4378388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4378391">if</span>&nbsp;<span class="ident" id="4378394">p</span><span class="op" id="4378395">.</span><span class="ident" id="4378396">trace</span>&nbsp;<span class="op" id="4378402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4378406">defer</span>&nbsp;<span class="ident" id="4378412">un</span><span class="op" id="4378414">(</span><span class="ident" id="4378415">trace</span><span class="op" id="4378420">(</span><span class="ident" id="4378421">p</span><span class="op" id="4378422">,</span>&nbsp;<span class="string" id="4378424">&#34;MethodSpec&#34;</span><span class="op" id="4378436">)</span><span class="op" id="4378437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4378440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378444">doc</span>&nbsp;<span class="op" id="4378448">:=</span>&nbsp;<span class="ident" id="4378451">p</span><span class="op" id="4378452">.</span><span class="ident" id="4378453">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4378466">var</span>&nbsp;<span class="ident" id="4378470">idents</span>&nbsp;<span class="op" id="4378477">[</span><span class="op" id="4378478">]</span><span class="op" id="4378479">*</span><span class="ident" id="4378480">ast</span><span class="op" id="4378483">.</span><span class="ident" id="4378484">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4378491">var</span>&nbsp;<span class="ident" id="4378495">typ</span>&nbsp;<span class="ident" id="4378499">ast</span><span class="op" id="4378502">.</span><span class="ident" id="4378503">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378509">x</span>&nbsp;<span class="op" id="4378511">:=</span>&nbsp;<span class="ident" id="4378514">p</span><span class="op" id="4378515">.</span><span class="ident" id="4378516">parseTypeName</span><span class="op" id="4378529">(</span><span class="op" id="4378530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4378533">if</span>&nbsp;<span class="ident" id="4378536">ident</span><span class="op" id="4378541">,</span>&nbsp;<span class="ident" id="4378543">isIdent</span>&nbsp;<span class="op" id="4378551">:=</span>&nbsp;<span class="ident" id="4378554">x</span><span class="op" id="4378555">.</span><span class="op" id="4378556">(</span><span class="op" id="4378557">*</span><span class="ident" id="4378558">ast</span><span class="op" id="4378561">.</span><span class="ident" id="4378562">Ident</span><span class="op" id="4378567">)</span><span class="op" id="4378568">;</span>&nbsp;<span class="ident" id="4378570">isIdent</span>&nbsp;<span class="op" id="4378578">&amp;&amp;</span>&nbsp;<span class="ident" id="4378581">p</span><span class="op" id="4378582">.</span><span class="ident" id="4378583">tok</span>&nbsp;<span class="op" id="4378587">==</span>&nbsp;<span class="ident" id="4378590">token</span><span class="op" id="4378595">.</span><span class="ident" id="4378596">LPAREN</span>&nbsp;<span class="op" id="4378603">{</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4378607">//&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378619">idents</span>&nbsp;<span class="op" id="4378626">=</span>&nbsp;<span class="op" id="4378628">[</span><span class="op" id="4378629">]</span><span class="op" id="4378630">*</span><span class="ident" id="4378631">ast</span><span class="op" id="4378634">.</span><span class="ident" id="4378635">Ident</span><span class="op" id="4378640">{</span><span class="ident" id="4378641">ident</span><span class="op" id="4378646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378650">scope</span>&nbsp;<span class="op" id="4378656">:=</span>&nbsp;<span class="ident" id="4378659">ast</span><span class="op" id="4378662">.</span><span class="ident" id="4378663">NewScope</span><span class="op" id="4378671">(</span><span class="ident" id="4378672">nil</span><span class="op" id="4378675">)</span>&nbsp;<span class="comment" id="4378677">//&nbsp;method&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378695">params</span><span class="op" id="4378701">,</span>&nbsp;<span class="ident" id="4378703">results</span>&nbsp;<span class="op" id="4378711">:=</span>&nbsp;<span class="ident" id="4378714">p</span><span class="op" id="4378715">.</span><span class="ident" id="4378716">parseSignature</span><span class="op" id="4378730">(</span><span class="ident" id="4378731">scope</span><span class="op" id="4378736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378740">typ</span>&nbsp;<span class="op" id="4378744">=</span>&nbsp;<span class="op" id="4378746">&amp;</span><span class="ident" id="4378747">ast</span><span class="op" id="4378750">.</span><span class="ident" id="4378751">FuncType</span><span class="op" id="4378759">{</span><span class="ident" id="4378760">Func</span><span class="op" id="4378764">:</span>&nbsp;<span class="ident" id="4378766">token</span><span class="op" id="4378771">.</span><span class="ident" id="4378772">NoPos</span><span class="op" id="4378777">,</span>&nbsp;<span class="ident" id="4378779">Params</span><span class="op" id="4378785">:</span>&nbsp;<span class="ident" id="4378787">params</span><span class="op" id="4378793">,</span>&nbsp;<span class="ident" id="4378795">Results</span><span class="op" id="4378802">:</span>&nbsp;<span class="ident" id="4378804">results</span><span class="op" id="4378811">}</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4378814">}</span>&nbsp;<span class="keyword" id="4378816">else</span>&nbsp;<span class="op" id="4378821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4378825">//&nbsp;embedded&nbsp;interface</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378849">typ</span>&nbsp;<span class="op" id="4378853">=</span>&nbsp;<span class="ident" id="4378855">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378859">p</span><span class="op" id="4378860">.</span><span class="ident" id="4378861">resolve</span><span class="op" id="4378868">(</span><span class="ident" id="4378869">typ</span><span class="op" id="4378872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4378875">}</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378878">p</span><span class="op" id="4378879">.</span><span class="ident" id="4378880">expectSemi</span><span class="op" id="4378890">(</span><span class="op" id="4378891">)</span>&nbsp;<span class="comment" id="4378893">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4378934">spec</span>&nbsp;<span class="op" id="4378939">:=</span>&nbsp;<span class="op" id="4378942">&amp;</span><span class="ident" id="4378943">ast</span><span class="op" id="4378946">.</span><span class="ident" id="4378947">Field</span><span class="op" id="4378952">{</span><span class="ident" id="4378953">Doc</span><span class="op" id="4378956">:</span>&nbsp;<span class="ident" id="4378958">doc</span><span class="op" id="4378961">,</span>&nbsp;<span class="ident" id="4378963">Names</span><span class="op" id="4378968">:</span>&nbsp;<span class="ident" id="4378970">idents</span><span class="op" id="4378976">,</span>&nbsp;<span class="ident" id="4378978">Type</span><span class="op" id="4378982">:</span>&nbsp;<span class="ident" id="4378984">typ</span><span class="op" id="4378987">,</span>&nbsp;<span class="ident" id="4378989">Comment</span><span class="op" id="4378996">:</span>&nbsp;<span class="ident" id="4378998">p</span><span class="op" id="4378999">.</span><span class="ident" id="4379000">lineComment</span><span class="op" id="4379011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379014">p</span><span class="op" id="4379015">.</span><span class="ident" id="4379016">declare</span><span class="op" id="4379023">(</span><span class="ident" id="4379024">spec</span><span class="op" id="4379028">,</span>&nbsp;<span class="ident" id="4379030">nil</span><span class="op" id="4379033">,</span>&nbsp;<span class="ident" id="4379035">scope</span><span class="op" id="4379040">,</span>&nbsp;<span class="ident" id="4379042">ast</span><span class="op" id="4379045">.</span><span class="ident" id="4379046">Fun</span><span class="op" id="4379049">,</span>&nbsp;<span class="ident" id="4379051">idents</span><span class="op" id="4379057">...</span><span class="op" id="4379060">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4379064">return</span>&nbsp;<span class="ident" id="4379071">spec</span><br>
<span class="lineno"></span><span class="op" id="4379076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4379079">func</span>&nbsp;<span class="op" id="4379084">(</span><span class="ident" id="4379085">p</span>&nbsp;<span class="op" id="4379087">*</span><span class="ident" id="4379088">parser</span><span class="op" id="4379094">)</span>&nbsp;<span class="ident" id="4379096">parseInterfaceType</span><span class="op" id="4379114">(</span><span class="op" id="4379115">)</span>&nbsp;<span class="op" id="4379117">*</span><span class="ident" id="4379118">ast</span><span class="op" id="4379121">.</span><span class="ident" id="4379122">InterfaceType</span>&nbsp;<span class="op" id="4379136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4379139">if</span>&nbsp;<span class="ident" id="4379142">p</span><span class="op" id="4379143">.</span><span class="ident" id="4379144">trace</span>&nbsp;<span class="op" id="4379150">{</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4379154">defer</span>&nbsp;<span class="ident" id="4379160">un</span><span class="op" id="4379162">(</span><span class="ident" id="4379163">trace</span><span class="op" id="4379168">(</span><span class="ident" id="4379169">p</span><span class="op" id="4379170">,</span>&nbsp;<span class="string" id="4379172">&#34;InterfaceType&#34;</span><span class="op" id="4379187">)</span><span class="op" id="4379188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4379191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379195">pos</span>&nbsp;<span class="op" id="4379199">:=</span>&nbsp;<span class="ident" id="4379202">p</span><span class="op" id="4379203">.</span><span class="ident" id="4379204">expect</span><span class="op" id="4379210">(</span><span class="ident" id="4379211">token</span><span class="op" id="4379216">.</span><span class="ident" id="4379217">INTERFACE</span><span class="op" id="4379226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379229">lbrace</span>&nbsp;<span class="op" id="4379236">:=</span>&nbsp;<span class="ident" id="4379239">p</span><span class="op" id="4379240">.</span><span class="ident" id="4379241">expect</span><span class="op" id="4379247">(</span><span class="ident" id="4379248">token</span><span class="op" id="4379253">.</span><span class="ident" id="4379254">LBRACE</span><span class="op" id="4379260">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379263">scope</span>&nbsp;<span class="op" id="4379269">:=</span>&nbsp;<span class="ident" id="4379272">ast</span><span class="op" id="4379275">.</span><span class="ident" id="4379276">NewScope</span><span class="op" id="4379284">(</span><span class="ident" id="4379285">nil</span><span class="op" id="4379288">)</span>&nbsp;<span class="comment" id="4379290">//&nbsp;interface&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4379310">var</span>&nbsp;<span class="ident" id="4379314">list</span>&nbsp;<span class="op" id="4379319">[</span><span class="op" id="4379320">]</span><span class="op" id="4379321">*</span><span class="ident" id="4379322">ast</span><span class="op" id="4379325">.</span><span class="ident" id="4379326">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4379333">for</span>&nbsp;<span class="ident" id="4379337">p</span><span class="op" id="4379338">.</span><span class="ident" id="4379339">tok</span>&nbsp;<span class="op" id="4379343">==</span>&nbsp;<span class="ident" id="4379346">token</span><span class="op" id="4379351">.</span><span class="ident" id="4379352">IDENT</span>&nbsp;<span class="op" id="4379358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379362">list</span>&nbsp;<span class="op" id="4379367">=</span>&nbsp;<span class="builtinfunc" id="4379369">append</span><span class="op" id="4379375">(</span><span class="ident" id="4379376">list</span><span class="op" id="4379380">,</span>&nbsp;<span class="ident" id="4379382">p</span><span class="op" id="4379383">.</span><span class="ident" id="4379384">parseMethodSpec</span><span class="op" id="4379399">(</span><span class="ident" id="4379400">scope</span><span class="op" id="4379405">)</span><span class="op" id="4379406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4379409">}</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379412">rbrace</span>&nbsp;<span class="op" id="4379419">:=</span>&nbsp;<span class="ident" id="4379422">p</span><span class="op" id="4379423">.</span><span class="ident" id="4379424">expect</span><span class="op" id="4379430">(</span><span class="ident" id="4379431">token</span><span class="op" id="4379436">.</span><span class="ident" id="4379437">RBRACE</span><span class="op" id="4379443">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4379447">return</span>&nbsp;<span class="op" id="4379454">&amp;</span><span class="ident" id="4379455">ast</span><span class="op" id="4379458">.</span><span class="ident" id="4379459">InterfaceType</span><span class="op" id="4379472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379476">Interface</span><span class="op" id="4379485">:</span>&nbsp;<span class="ident" id="4379487">pos</span><span class="op" id="4379490">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379494">Methods</span><span class="op" id="4379501">:</span>&nbsp;<span class="op" id="4379503">&amp;</span><span class="ident" id="4379504">ast</span><span class="op" id="4379507">.</span><span class="ident" id="4379508">FieldList</span><span class="op" id="4379517">{</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379522">Opening</span><span class="op" id="4379529">:</span>&nbsp;<span class="ident" id="4379531">lbrace</span><span class="op" id="4379537">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379542">List</span><span class="op" id="4379546">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4379551">list</span><span class="op" id="4379555">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379560">Closing</span><span class="op" id="4379567">:</span>&nbsp;<span class="ident" id="4379569">rbrace</span><span class="op" id="4379575">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4379579">}</span><span class="op" id="4379580">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4379583">}</span><br>
<span class="lineno">965</span><span class="op" id="4379585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4379588">func</span>&nbsp;<span class="op" id="4379593">(</span><span class="ident" id="4379594">p</span>&nbsp;<span class="op" id="4379596">*</span><span class="ident" id="4379597">parser</span><span class="op" id="4379603">)</span>&nbsp;<span class="ident" id="4379605">parseMapType</span><span class="op" id="4379617">(</span><span class="op" id="4379618">)</span>&nbsp;<span class="op" id="4379620">*</span><span class="ident" id="4379621">ast</span><span class="op" id="4379624">.</span><span class="ident" id="4379625">MapType</span>&nbsp;<span class="op" id="4379633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4379636">if</span>&nbsp;<span class="ident" id="4379639">p</span><span class="op" id="4379640">.</span><span class="ident" id="4379641">trace</span>&nbsp;<span class="op" id="4379647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4379651">defer</span>&nbsp;<span class="ident" id="4379657">un</span><span class="op" id="4379659">(</span><span class="ident" id="4379660">trace</span><span class="op" id="4379665">(</span><span class="ident" id="4379666">p</span><span class="op" id="4379667">,</span>&nbsp;<span class="string" id="4379669">&#34;MapType&#34;</span><span class="op" id="4379678">)</span><span class="op" id="4379679">)</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4379682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379686">pos</span>&nbsp;<span class="op" id="4379690">:=</span>&nbsp;<span class="ident" id="4379693">p</span><span class="op" id="4379694">.</span><span class="ident" id="4379695">expect</span><span class="op" id="4379701">(</span><span class="ident" id="4379702">token</span><span class="op" id="4379707">.</span><span class="ident" id="4379708">MAP</span><span class="op" id="4379711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379714">p</span><span class="op" id="4379715">.</span><span class="ident" id="4379716">expect</span><span class="op" id="4379722">(</span><span class="ident" id="4379723">token</span><span class="op" id="4379728">.</span><span class="ident" id="4379729">LBRACK</span><span class="op" id="4379735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379738">key</span>&nbsp;<span class="op" id="4379742">:=</span>&nbsp;<span class="ident" id="4379745">p</span><span class="op" id="4379746">.</span><span class="ident" id="4379747">parseType</span><span class="op" id="4379756">(</span><span class="op" id="4379757">)</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379760">p</span><span class="op" id="4379761">.</span><span class="ident" id="4379762">expect</span><span class="op" id="4379768">(</span><span class="ident" id="4379769">token</span><span class="op" id="4379774">.</span><span class="ident" id="4379775">RBRACK</span><span class="op" id="4379781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379784">value</span>&nbsp;<span class="op" id="4379790">:=</span>&nbsp;<span class="ident" id="4379793">p</span><span class="op" id="4379794">.</span><span class="ident" id="4379795">parseType</span><span class="op" id="4379804">(</span><span class="op" id="4379805">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4379809">return</span>&nbsp;<span class="op" id="4379816">&amp;</span><span class="ident" id="4379817">ast</span><span class="op" id="4379820">.</span><span class="ident" id="4379821">MapType</span><span class="op" id="4379828">{</span><span class="ident" id="4379829">Map</span><span class="op" id="4379832">:</span>&nbsp;<span class="ident" id="4379834">pos</span><span class="op" id="4379837">,</span>&nbsp;<span class="ident" id="4379839">Key</span><span class="op" id="4379842">:</span>&nbsp;<span class="ident" id="4379844">key</span><span class="op" id="4379847">,</span>&nbsp;<span class="ident" id="4379849">Value</span><span class="op" id="4379854">:</span>&nbsp;<span class="ident" id="4379856">value</span><span class="op" id="4379861">}</span><br>
<span class="lineno"></span><span class="op" id="4379863">}</span><br>
<span class="lineno">980</span><br>
<span class="lineno"></span><span class="keyword" id="4379866">func</span>&nbsp;<span class="op" id="4379871">(</span><span class="ident" id="4379872">p</span>&nbsp;<span class="op" id="4379874">*</span><span class="ident" id="4379875">parser</span><span class="op" id="4379881">)</span>&nbsp;<span class="ident" id="4379883">parseChanType</span><span class="op" id="4379896">(</span><span class="op" id="4379897">)</span>&nbsp;<span class="op" id="4379899">*</span><span class="ident" id="4379900">ast</span><span class="op" id="4379903">.</span><span class="ident" id="4379904">ChanType</span>&nbsp;<span class="op" id="4379913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4379916">if</span>&nbsp;<span class="ident" id="4379919">p</span><span class="op" id="4379920">.</span><span class="ident" id="4379921">trace</span>&nbsp;<span class="op" id="4379927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4379931">defer</span>&nbsp;<span class="ident" id="4379937">un</span><span class="op" id="4379939">(</span><span class="ident" id="4379940">trace</span><span class="op" id="4379945">(</span><span class="ident" id="4379946">p</span><span class="op" id="4379947">,</span>&nbsp;<span class="string" id="4379949">&#34;ChanType&#34;</span><span class="op" id="4379959">)</span><span class="op" id="4379960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4379963">}</span><br>
<span class="lineno">985</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379967">pos</span>&nbsp;<span class="op" id="4379971">:=</span>&nbsp;<span class="ident" id="4379974">p</span><span class="op" id="4379975">.</span><span class="ident" id="4379976">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4379981">dir</span>&nbsp;<span class="op" id="4379985">:=</span>&nbsp;<span class="ident" id="4379988">ast</span><span class="op" id="4379991">.</span><span class="ident" id="4379992">SEND</span>&nbsp;<span class="op" id="4379997">|</span>&nbsp;<span class="ident" id="4379999">ast</span><span class="op" id="4380002">.</span><span class="ident" id="4380003">RECV</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380009">var</span>&nbsp;<span class="ident" id="4380013">arrow</span>&nbsp;<span class="ident" id="4380019">token</span><span class="op" id="4380024">.</span><span class="ident" id="4380025">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380030">if</span>&nbsp;<span class="ident" id="4380033">p</span><span class="op" id="4380034">.</span><span class="ident" id="4380035">tok</span>&nbsp;<span class="op" id="4380039">==</span>&nbsp;<span class="ident" id="4380042">token</span><span class="op" id="4380047">.</span><span class="ident" id="4380048">CHAN</span>&nbsp;<span class="op" id="4380053">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4380057">p</span><span class="op" id="4380058">.</span><span class="ident" id="4380059">next</span><span class="op" id="4380063">(</span><span class="op" id="4380064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380068">if</span>&nbsp;<span class="ident" id="4380071">p</span><span class="op" id="4380072">.</span><span class="ident" id="4380073">tok</span>&nbsp;<span class="op" id="4380077">==</span>&nbsp;<span class="ident" id="4380080">token</span><span class="op" id="4380085">.</span><span class="ident" id="4380086">ARROW</span>&nbsp;<span class="op" id="4380092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4380097">arrow</span>&nbsp;<span class="op" id="4380103">=</span>&nbsp;<span class="ident" id="4380105">p</span><span class="op" id="4380106">.</span><span class="ident" id="4380107">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4380114">p</span><span class="op" id="4380115">.</span><span class="ident" id="4380116">next</span><span class="op" id="4380120">(</span><span class="op" id="4380121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4380126">dir</span>&nbsp;<span class="op" id="4380130">=</span>&nbsp;<span class="ident" id="4380132">ast</span><span class="op" id="4380135">.</span><span class="ident" id="4380136">SEND</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4380143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4380146">}</span>&nbsp;<span class="keyword" id="4380148">else</span>&nbsp;<span class="op" id="4380153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4380157">arrow</span>&nbsp;<span class="op" id="4380163">=</span>&nbsp;<span class="ident" id="4380165">p</span><span class="op" id="4380166">.</span><span class="ident" id="4380167">expect</span><span class="op" id="4380173">(</span><span class="ident" id="4380174">token</span><span class="op" id="4380179">.</span><span class="ident" id="4380180">ARROW</span><span class="op" id="4380185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4380189">p</span><span class="op" id="4380190">.</span><span class="ident" id="4380191">expect</span><span class="op" id="4380197">(</span><span class="ident" id="4380198">token</span><span class="op" id="4380203">.</span><span class="ident" id="4380204">CHAN</span><span class="op" id="4380208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4380212">dir</span>&nbsp;<span class="op" id="4380216">=</span>&nbsp;<span class="ident" id="4380218">ast</span><span class="op" id="4380221">.</span><span class="ident" id="4380222">RECV</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4380228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4380231">value</span>&nbsp;<span class="op" id="4380237">:=</span>&nbsp;<span class="ident" id="4380240">p</span><span class="op" id="4380241">.</span><span class="ident" id="4380242">parseType</span><span class="op" id="4380251">(</span><span class="op" id="4380252">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380256">return</span>&nbsp;<span class="op" id="4380263">&amp;</span><span class="ident" id="4380264">ast</span><span class="op" id="4380267">.</span><span class="ident" id="4380268">ChanType</span><span class="op" id="4380276">{</span><span class="ident" id="4380277">Begin</span><span class="op" id="4380282">:</span>&nbsp;<span class="ident" id="4380284">pos</span><span class="op" id="4380287">,</span>&nbsp;<span class="ident" id="4380289">Arrow</span><span class="op" id="4380294">:</span>&nbsp;<span class="ident" id="4380296">arrow</span><span class="op" id="4380301">,</span>&nbsp;<span class="ident" id="4380303">Dir</span><span class="op" id="4380306">:</span>&nbsp;<span class="ident" id="4380308">dir</span><span class="op" id="4380311">,</span>&nbsp;<span class="ident" id="4380313">Value</span><span class="op" id="4380318">:</span>&nbsp;<span class="ident" id="4380320">value</span><span class="op" id="4380325">}</span><br>
<span class="lineno"></span><span class="op" id="4380327">}</span><br>
<span class="lineno">1005</span><br>
<span class="lineno"></span><span class="comment" id="4380330">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="4380385">func</span>&nbsp;<span class="op" id="4380390">(</span><span class="ident" id="4380391">p</span>&nbsp;<span class="op" id="4380393">*</span><span class="ident" id="4380394">parser</span><span class="op" id="4380400">)</span>&nbsp;<span class="ident" id="4380402">tryIdentOrType</span><span class="op" id="4380416">(</span><span class="op" id="4380417">)</span>&nbsp;<span class="ident" id="4380419">ast</span><span class="op" id="4380422">.</span><span class="ident" id="4380423">Expr</span>&nbsp;<span class="op" id="4380428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380431">switch</span>&nbsp;<span class="ident" id="4380438">p</span><span class="op" id="4380439">.</span><span class="ident" id="4380440">tok</span>&nbsp;<span class="op" id="4380444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380447">case</span>&nbsp;<span class="ident" id="4380452">token</span><span class="op" id="4380457">.</span><span class="ident" id="4380458">IDENT</span><span class="op" id="4380463">:</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380467">return</span>&nbsp;<span class="ident" id="4380474">p</span><span class="op" id="4380475">.</span><span class="ident" id="4380476">parseTypeName</span><span class="op" id="4380489">(</span><span class="op" id="4380490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380493">case</span>&nbsp;<span class="ident" id="4380498">token</span><span class="op" id="4380503">.</span><span class="ident" id="4380504">LBRACK</span><span class="op" id="4380510">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380514">return</span>&nbsp;<span class="ident" id="4380521">p</span><span class="op" id="4380522">.</span><span class="ident" id="4380523">parseArrayType</span><span class="op" id="4380537">(</span><span class="op" id="4380538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380541">case</span>&nbsp;<span class="ident" id="4380546">token</span><span class="op" id="4380551">.</span><span class="ident" id="4380552">STRUCT</span><span class="op" id="4380558">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380562">return</span>&nbsp;<span class="ident" id="4380569">p</span><span class="op" id="4380570">.</span><span class="ident" id="4380571">parseStructType</span><span class="op" id="4380586">(</span><span class="op" id="4380587">)</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380590">case</span>&nbsp;<span class="ident" id="4380595">token</span><span class="op" id="4380600">.</span><span class="ident" id="4380601">MUL</span><span class="op" id="4380604">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380608">return</span>&nbsp;<span class="ident" id="4380615">p</span><span class="op" id="4380616">.</span><span class="ident" id="4380617">parsePointerType</span><span class="op" id="4380633">(</span><span class="op" id="4380634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380637">case</span>&nbsp;<span class="ident" id="4380642">token</span><span class="op" id="4380647">.</span><span class="ident" id="4380648">FUNC</span><span class="op" id="4380652">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4380656">typ</span><span class="op" id="4380659">,</span>&nbsp;<span class="ident" id="4380661">_</span>&nbsp;<span class="op" id="4380663">:=</span>&nbsp;<span class="ident" id="4380666">p</span><span class="op" id="4380667">.</span><span class="ident" id="4380668">parseFuncType</span><span class="op" id="4380681">(</span><span class="op" id="4380682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380686">return</span>&nbsp;<span class="ident" id="4380693">typ</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380698">case</span>&nbsp;<span class="ident" id="4380703">token</span><span class="op" id="4380708">.</span><span class="ident" id="4380709">INTERFACE</span><span class="op" id="4380718">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380722">return</span>&nbsp;<span class="ident" id="4380729">p</span><span class="op" id="4380730">.</span><span class="ident" id="4380731">parseInterfaceType</span><span class="op" id="4380749">(</span><span class="op" id="4380750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380753">case</span>&nbsp;<span class="ident" id="4380758">token</span><span class="op" id="4380763">.</span><span class="ident" id="4380764">MAP</span><span class="op" id="4380767">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380771">return</span>&nbsp;<span class="ident" id="4380778">p</span><span class="op" id="4380779">.</span><span class="ident" id="4380780">parseMapType</span><span class="op" id="4380792">(</span><span class="op" id="4380793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380796">case</span>&nbsp;<span class="ident" id="4380801">token</span><span class="op" id="4380806">.</span><span class="ident" id="4380807">CHAN</span><span class="op" id="4380811">,</span>&nbsp;<span class="ident" id="4380813">token</span><span class="op" id="4380818">.</span><span class="ident" id="4380819">ARROW</span><span class="op" id="4380824">:</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380828">return</span>&nbsp;<span class="ident" id="4380835">p</span><span class="op" id="4380836">.</span><span class="ident" id="4380837">parseChanType</span><span class="op" id="4380850">(</span><span class="op" id="4380851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380854">case</span>&nbsp;<span class="ident" id="4380859">token</span><span class="op" id="4380864">.</span><span class="ident" id="4380865">LPAREN</span><span class="op" id="4380871">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4380875">lparen</span>&nbsp;<span class="op" id="4380882">:=</span>&nbsp;<span class="ident" id="4380885">p</span><span class="op" id="4380886">.</span><span class="ident" id="4380887">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4380893">p</span><span class="op" id="4380894">.</span><span class="ident" id="4380895">next</span><span class="op" id="4380899">(</span><span class="op" id="4380900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4380904">typ</span>&nbsp;<span class="op" id="4380908">:=</span>&nbsp;<span class="ident" id="4380911">p</span><span class="op" id="4380912">.</span><span class="ident" id="4380913">parseType</span><span class="op" id="4380922">(</span><span class="op" id="4380923">)</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4380927">rparen</span>&nbsp;<span class="op" id="4380934">:=</span>&nbsp;<span class="ident" id="4380937">p</span><span class="op" id="4380938">.</span><span class="ident" id="4380939">expect</span><span class="op" id="4380945">(</span><span class="ident" id="4380946">token</span><span class="op" id="4380951">.</span><span class="ident" id="4380952">RPAREN</span><span class="op" id="4380958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4380962">return</span>&nbsp;<span class="op" id="4380969">&amp;</span><span class="ident" id="4380970">ast</span><span class="op" id="4380973">.</span><span class="ident" id="4380974">ParenExpr</span><span class="op" id="4380983">{</span><span class="ident" id="4380984">Lparen</span><span class="op" id="4380990">:</span>&nbsp;<span class="ident" id="4380992">lparen</span><span class="op" id="4380998">,</span>&nbsp;<span class="ident" id="4381000">X</span><span class="op" id="4381001">:</span>&nbsp;<span class="ident" id="4381003">typ</span><span class="op" id="4381006">,</span>&nbsp;<span class="ident" id="4381008">Rparen</span><span class="op" id="4381014">:</span>&nbsp;<span class="ident" id="4381016">rparen</span><span class="op" id="4381022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4381025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4381029">//&nbsp;no&nbsp;type&nbsp;found</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4381047">return</span>&nbsp;<span class="ident" id="4381054">nil</span><br>
<span class="lineno"></span><span class="op" id="4381058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4381061">func</span>&nbsp;<span class="op" id="4381066">(</span><span class="ident" id="4381067">p</span>&nbsp;<span class="op" id="4381069">*</span><span class="ident" id="4381070">parser</span><span class="op" id="4381076">)</span>&nbsp;<span class="ident" id="4381078">tryType</span><span class="op" id="4381085">(</span><span class="op" id="4381086">)</span>&nbsp;<span class="ident" id="4381088">ast</span><span class="op" id="4381091">.</span><span class="ident" id="4381092">Expr</span>&nbsp;<span class="op" id="4381097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4381100">typ</span>&nbsp;<span class="op" id="4381104">:=</span>&nbsp;<span class="ident" id="4381107">p</span><span class="op" id="4381108">.</span><span class="ident" id="4381109">tryIdentOrType</span><span class="op" id="4381123">(</span><span class="op" id="4381124">)</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4381127">if</span>&nbsp;<span class="ident" id="4381130">typ</span>&nbsp;<span class="op" id="4381134">!=</span>&nbsp;<span class="ident" id="4381137">nil</span>&nbsp;<span class="op" id="4381141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4381145">p</span><span class="op" id="4381146">.</span><span class="ident" id="4381147">resolve</span><span class="op" id="4381154">(</span><span class="ident" id="4381155">typ</span><span class="op" id="4381158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4381161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4381164">return</span>&nbsp;<span class="ident" id="4381171">typ</span><br>
<span class="lineno"></span><span class="op" id="4381175">}</span><br>
<span class="lineno">1045</span><br>
<span class="lineno"></span><span class="comment" id="4381178">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4381258">//&nbsp;Blocks</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4381269">func</span>&nbsp;<span class="op" id="4381274">(</span><span class="ident" id="4381275">p</span>&nbsp;<span class="op" id="4381277">*</span><span class="ident" id="4381278">parser</span><span class="op" id="4381284">)</span>&nbsp;<span class="ident" id="4381286">parseStmtList</span><span class="op" id="4381299">(</span><span class="op" id="4381300">)</span>&nbsp;<span class="op" id="4381302">(</span><span class="ident" id="4381303">list</span>&nbsp;<span class="op" id="4381308">[</span><span class="op" id="4381309">]</span><span class="ident" id="4381310">ast</span><span class="op" id="4381313">.</span><span class="ident" id="4381314">Stmt</span><span class="op" id="4381318">)</span>&nbsp;<span class="op" id="4381320">{</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4381323">if</span>&nbsp;<span class="ident" id="4381326">p</span><span class="op" id="4381327">.</span><span class="ident" id="4381328">trace</span>&nbsp;<span class="op" id="4381334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4381338">defer</span>&nbsp;<span class="ident" id="4381344">un</span><span class="op" id="4381346">(</span><span class="ident" id="4381347">trace</span><span class="op" id="4381352">(</span><span class="ident" id="4381353">p</span><span class="op" id="4381354">,</span>&nbsp;<span class="string" id="4381356">&#34;StatementList&#34;</span><span class="op" id="4381371">)</span><span class="op" id="4381372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4381375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4381379">for</span>&nbsp;<span class="ident" id="4381383">p</span><span class="op" id="4381384">.</span><span class="ident" id="4381385">tok</span>&nbsp;<span class="op" id="4381389">!=</span>&nbsp;<span class="ident" id="4381392">token</span><span class="op" id="4381397">.</span><span class="ident" id="4381398">CASE</span>&nbsp;<span class="op" id="4381403">&amp;&amp;</span>&nbsp;<span class="ident" id="4381406">p</span><span class="op" id="4381407">.</span><span class="ident" id="4381408">tok</span>&nbsp;<span class="op" id="4381412">!=</span>&nbsp;<span class="ident" id="4381415">token</span><span class="op" id="4381420">.</span><span class="ident" id="4381421">DEFAULT</span>&nbsp;<span class="op" id="4381429">&amp;&amp;</span>&nbsp;<span class="ident" id="4381432">p</span><span class="op" id="4381433">.</span><span class="ident" id="4381434">tok</span>&nbsp;<span class="op" id="4381438">!=</span>&nbsp;<span class="ident" id="4381441">token</span><span class="op" id="4381446">.</span><span class="ident" id="4381447">RBRACE</span>&nbsp;<span class="op" id="4381454">&amp;&amp;</span>&nbsp;<span class="ident" id="4381457">p</span><span class="op" id="4381458">.</span><span class="ident" id="4381459">tok</span>&nbsp;<span class="op" id="4381463">!=</span>&nbsp;<span class="ident" id="4381466">token</span><span class="op" id="4381471">.</span><span class="ident" id="4381472">EOF</span>&nbsp;<span class="op" id="4381476">{</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4381480">list</span>&nbsp;<span class="op" id="4381485">=</span>&nbsp;<span class="builtinfunc" id="4381487">append</span><span class="op" id="4381493">(</span><span class="ident" id="4381494">list</span><span class="op" id="4381498">,</span>&nbsp;<span class="ident" id="4381500">p</span><span class="op" id="4381501">.</span><span class="ident" id="4381502">parseStmt</span><span class="op" id="4381511">(</span><span class="op" id="4381512">)</span><span class="op" id="4381513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4381516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4381520">return</span><br>
<span class="lineno"></span><span class="op" id="4381527">}</span><br>
<span class="lineno">1060</span><br>
<span class="lineno"></span><span class="keyword" id="4381530">func</span>&nbsp;<span class="op" id="4381535">(</span><span class="ident" id="4381536">p</span>&nbsp;<span class="op" id="4381538">*</span><span class="ident" id="4381539">parser</span><span class="op" id="4381545">)</span>&nbsp;<span class="ident" id="4381547">parseBody</span><span class="op" id="4381556">(</span><span class="ident" id="4381557">scope</span>&nbsp;<span class="op" id="4381563">*</span><span class="ident" id="4381564">ast</span><span class="op" id="4381567">.</span><span class="ident" id="4381568">Scope</span><span class="op" id="4381573">)</span>&nbsp;<span class="op" id="4381575">*</span><span class="ident" id="4381576">ast</span><span class="op" id="4381579">.</span><span class="ident" id="4381580">BlockStmt</span>&nbsp;<span class="op" id="4381590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4381593">if</span>&nbsp;<span class="ident" id="4381596">p</span><span class="op" id="4381597">.</span><span class="ident" id="4381598">trace</span>&nbsp;<span class="op" id="4381604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4381608">defer</span>&nbsp;<span class="ident" id="4381614">un</span><span class="op" id="4381616">(</span><span class="ident" id="4381617">trace</span><span class="op" id="4381622">(</span><span class="ident" id="4381623">p</span><span class="op" id="4381624">,</span>&nbsp;<span class="string" id="4381626">&#34;Body&#34;</span><span class="op" id="4381632">)</span><span class="op" id="4381633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4381636">}</span><br>
<span class="lineno">1065</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4381640">lbrace</span>&nbsp;<span class="op" id="4381647">:=</span>&nbsp;<span class="ident" id="4381650">p</span><span class="op" id="4381651">.</span><span class="ident" id="4381652">expect</span><span class="op" id="4381658">(</span><span class="ident" id="4381659">token</span><span class="op" id="4381664">.</span><span class="ident" id="4381665">LBRACE</span><span class="op" id="4381671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4381674">p</span><span class="op" id="4381675">.</span><span class="ident" id="4381676">topScope</span>&nbsp;<span class="op" id="4381685">=</span>&nbsp;<span class="ident" id="4381687">scope</span>&nbsp;<span class="comment" id="4381693">//&nbsp;open&nbsp;function&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4381717">p</span><span class="op" id="4381718">.</span><span class="ident" id="4381719">openLabelScope</span><span class="op" id="4381733">(</span><span class="op" id="4381734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4381737">list</span>&nbsp;<span class="op" id="4381742">:=</span>&nbsp;<span class="ident" id="4381745">p</span><span class="op" id="4381746">.</span><span class="ident" id="4381747">parseStmtList</span><span class="op" id="4381760">(</span><span class="op" id="4381761">)</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4381764">p</span><span class="op" id="4381765">.</span><span class="ident" id="4381766">closeLabelScope</span><span class="op" id="4381781">(</span><span class="op" id="4381782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4381785">p</span><span class="op" id="4381786">.</span><span class="ident" id="4381787">closeScope</span><span class="op" id="4381797">(</span><span class="op" id="4381798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4381801">rbrace</span>&nbsp;<span class="op" id="4381808">:=</span>&nbsp;<span class="ident" id="4381811">p</span><span class="op" id="4381812">.</span><span class="ident" id="4381813">expect</span><span class="op" id="4381819">(</span><span class="ident" id="4381820">token</span><span class="op" id="4381825">.</span><span class="ident" id="4381826">RBRACE</span><span class="op" id="4381832">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4381836">return</span>&nbsp;<span class="op" id="4381843">&amp;</span><span class="ident" id="4381844">ast</span><span class="op" id="4381847">.</span><span class="ident" id="4381848">BlockStmt</span><span class="op" id="4381857">{</span><span class="ident" id="4381858">Lbrace</span><span class="op" id="4381864">:</span>&nbsp;<span class="ident" id="4381866">lbrace</span><span class="op" id="4381872">,</span>&nbsp;<span class="ident" id="4381874">List</span><span class="op" id="4381878">:</span>&nbsp;<span class="ident" id="4381880">list</span><span class="op" id="4381884">,</span>&nbsp;<span class="ident" id="4381886">Rbrace</span><span class="op" id="4381892">:</span>&nbsp;<span class="ident" id="4381894">rbrace</span><span class="op" id="4381900">}</span><br>
<span class="lineno">1075</span><span class="op" id="4381902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4381905">func</span>&nbsp;<span class="op" id="4381910">(</span><span class="ident" id="4381911">p</span>&nbsp;<span class="op" id="4381913">*</span><span class="ident" id="4381914">parser</span><span class="op" id="4381920">)</span>&nbsp;<span class="ident" id="4381922">parseBlockStmt</span><span class="op" id="4381936">(</span><span class="op" id="4381937">)</span>&nbsp;<span class="op" id="4381939">*</span><span class="ident" id="4381940">ast</span><span class="op" id="4381943">.</span><span class="ident" id="4381944">BlockStmt</span>&nbsp;<span class="op" id="4381954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4381957">if</span>&nbsp;<span class="ident" id="4381960">p</span><span class="op" id="4381961">.</span><span class="ident" id="4381962">trace</span>&nbsp;<span class="op" id="4381968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4381972">defer</span>&nbsp;<span class="ident" id="4381978">un</span><span class="op" id="4381980">(</span><span class="ident" id="4381981">trace</span><span class="op" id="4381986">(</span><span class="ident" id="4381987">p</span><span class="op" id="4381988">,</span>&nbsp;<span class="string" id="4381990">&#34;BlockStmt&#34;</span><span class="op" id="4382001">)</span><span class="op" id="4382002">)</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4382005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4382009">lbrace</span>&nbsp;<span class="op" id="4382016">:=</span>&nbsp;<span class="ident" id="4382019">p</span><span class="op" id="4382020">.</span><span class="ident" id="4382021">expect</span><span class="op" id="4382027">(</span><span class="ident" id="4382028">token</span><span class="op" id="4382033">.</span><span class="ident" id="4382034">LBRACE</span><span class="op" id="4382040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4382043">p</span><span class="op" id="4382044">.</span><span class="ident" id="4382045">openScope</span><span class="op" id="4382054">(</span><span class="op" id="4382055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4382058">list</span>&nbsp;<span class="op" id="4382063">:=</span>&nbsp;<span class="ident" id="4382066">p</span><span class="op" id="4382067">.</span><span class="ident" id="4382068">parseStmtList</span><span class="op" id="4382081">(</span><span class="op" id="4382082">)</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4382085">p</span><span class="op" id="4382086">.</span><span class="ident" id="4382087">closeScope</span><span class="op" id="4382097">(</span><span class="op" id="4382098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4382101">rbrace</span>&nbsp;<span class="op" id="4382108">:=</span>&nbsp;<span class="ident" id="4382111">p</span><span class="op" id="4382112">.</span><span class="ident" id="4382113">expect</span><span class="op" id="4382119">(</span><span class="ident" id="4382120">token</span><span class="op" id="4382125">.</span><span class="ident" id="4382126">RBRACE</span><span class="op" id="4382132">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4382136">return</span>&nbsp;<span class="op" id="4382143">&amp;</span><span class="ident" id="4382144">ast</span><span class="op" id="4382147">.</span><span class="ident" id="4382148">BlockStmt</span><span class="op" id="4382157">{</span><span class="ident" id="4382158">Lbrace</span><span class="op" id="4382164">:</span>&nbsp;<span class="ident" id="4382166">lbrace</span><span class="op" id="4382172">,</span>&nbsp;<span class="ident" id="4382174">List</span><span class="op" id="4382178">:</span>&nbsp;<span class="ident" id="4382180">list</span><span class="op" id="4382184">,</span>&nbsp;<span class="ident" id="4382186">Rbrace</span><span class="op" id="4382192">:</span>&nbsp;<span class="ident" id="4382194">rbrace</span><span class="op" id="4382200">}</span><br>
<span class="lineno"></span><span class="op" id="4382202">}</span><br>
<span class="lineno">1090</span><br>
<span class="lineno"></span><span class="comment" id="4382205">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4382285">//&nbsp;Expressions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4382301">func</span>&nbsp;<span class="op" id="4382306">(</span><span class="ident" id="4382307">p</span>&nbsp;<span class="op" id="4382309">*</span><span class="ident" id="4382310">parser</span><span class="op" id="4382316">)</span>&nbsp;<span class="ident" id="4382318">parseFuncTypeOrLit</span><span class="op" id="4382336">(</span><span class="op" id="4382337">)</span>&nbsp;<span class="ident" id="4382339">ast</span><span class="op" id="4382342">.</span><span class="ident" id="4382343">Expr</span>&nbsp;<span class="op" id="4382348">{</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4382351">if</span>&nbsp;<span class="ident" id="4382354">p</span><span class="op" id="4382355">.</span><span class="ident" id="4382356">trace</span>&nbsp;<span class="op" id="4382362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4382366">defer</span>&nbsp;<span class="ident" id="4382372">un</span><span class="op" id="4382374">(</span><span class="ident" id="4382375">trace</span><span class="op" id="4382380">(</span><span class="ident" id="4382381">p</span><span class="op" id="4382382">,</span>&nbsp;<span class="string" id="4382384">&#34;FuncTypeOrLit&#34;</span><span class="op" id="4382399">)</span><span class="op" id="4382400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4382403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4382407">typ</span><span class="op" id="4382410">,</span>&nbsp;<span class="ident" id="4382412">scope</span>&nbsp;<span class="op" id="4382418">:=</span>&nbsp;<span class="ident" id="4382421">p</span><span class="op" id="4382422">.</span><span class="ident" id="4382423">parseFuncType</span><span class="op" id="4382436">(</span><span class="op" id="4382437">)</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4382440">if</span>&nbsp;<span class="ident" id="4382443">p</span><span class="op" id="4382444">.</span><span class="ident" id="4382445">tok</span>&nbsp;<span class="op" id="4382449">!=</span>&nbsp;<span class="ident" id="4382452">token</span><span class="op" id="4382457">.</span><span class="ident" id="4382458">LBRACE</span>&nbsp;<span class="op" id="4382465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4382469">//&nbsp;function&nbsp;type&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4382493">return</span>&nbsp;<span class="ident" id="4382500">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4382505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4382509">p</span><span class="op" id="4382510">.</span><span class="ident" id="4382511">exprLev</span><span class="op" id="4382518">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4382522">body</span>&nbsp;<span class="op" id="4382527">:=</span>&nbsp;<span class="ident" id="4382530">p</span><span class="op" id="4382531">.</span><span class="ident" id="4382532">parseBody</span><span class="op" id="4382541">(</span><span class="ident" id="4382542">scope</span><span class="op" id="4382547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4382550">p</span><span class="op" id="4382551">.</span><span class="ident" id="4382552">exprLev</span><span class="op" id="4382559">--</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4382564">return</span>&nbsp;<span class="op" id="4382571">&amp;</span><span class="ident" id="4382572">ast</span><span class="op" id="4382575">.</span><span class="ident" id="4382576">FuncLit</span><span class="op" id="4382583">{</span><span class="ident" id="4382584">Type</span><span class="op" id="4382588">:</span>&nbsp;<span class="ident" id="4382590">typ</span><span class="op" id="4382593">,</span>&nbsp;<span class="ident" id="4382595">Body</span><span class="op" id="4382599">:</span>&nbsp;<span class="ident" id="4382601">body</span><span class="op" id="4382605">}</span><br>
<span class="lineno">1110</span><span class="op" id="4382607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4382610">//&nbsp;parseOperand&nbsp;may&nbsp;return&nbsp;an&nbsp;expression&nbsp;or&nbsp;a&nbsp;raw&nbsp;type&nbsp;(incl.&nbsp;array</span><br>
<span class="lineno"></span><span class="comment" id="4382678">//&nbsp;types&nbsp;of&nbsp;the&nbsp;form&nbsp;[...]T.&nbsp;Callers&nbsp;must&nbsp;verify&nbsp;the&nbsp;result.</span><br>
<span class="lineno"></span><span class="comment" id="4382739">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">1115</span><span class="comment" id="4382809">//</span><br>
<span class="lineno"></span><span class="keyword" id="4382812">func</span>&nbsp;<span class="op" id="4382817">(</span><span class="ident" id="4382818">p</span>&nbsp;<span class="op" id="4382820">*</span><span class="ident" id="4382821">parser</span><span class="op" id="4382827">)</span>&nbsp;<span class="ident" id="4382829">parseOperand</span><span class="op" id="4382841">(</span><span class="ident" id="4382842">lhs</span>&nbsp;<span class="builtintype" id="4382846">bool</span><span class="op" id="4382850">)</span>&nbsp;<span class="ident" id="4382852">ast</span><span class="op" id="4382855">.</span><span class="ident" id="4382856">Expr</span>&nbsp;<span class="op" id="4382861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4382864">if</span>&nbsp;<span class="ident" id="4382867">p</span><span class="op" id="4382868">.</span><span class="ident" id="4382869">trace</span>&nbsp;<span class="op" id="4382875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4382879">defer</span>&nbsp;<span class="ident" id="4382885">un</span><span class="op" id="4382887">(</span><span class="ident" id="4382888">trace</span><span class="op" id="4382893">(</span><span class="ident" id="4382894">p</span><span class="op" id="4382895">,</span>&nbsp;<span class="string" id="4382897">&#34;Operand&#34;</span><span class="op" id="4382906">)</span><span class="op" id="4382907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4382910">}</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4382914">switch</span>&nbsp;<span class="ident" id="4382921">p</span><span class="op" id="4382922">.</span><span class="ident" id="4382923">tok</span>&nbsp;<span class="op" id="4382927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4382930">case</span>&nbsp;<span class="ident" id="4382935">token</span><span class="op" id="4382940">.</span><span class="ident" id="4382941">IDENT</span><span class="op" id="4382946">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4382950">x</span>&nbsp;<span class="op" id="4382952">:=</span>&nbsp;<span class="ident" id="4382955">p</span><span class="op" id="4382956">.</span><span class="ident" id="4382957">parseIdent</span><span class="op" id="4382967">(</span><span class="op" id="4382968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4382972">if</span>&nbsp;<span class="op" id="4382975">!</span><span class="ident" id="4382976">lhs</span>&nbsp;<span class="op" id="4382980">{</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4382985">p</span><span class="op" id="4382986">.</span><span class="ident" id="4382987">resolve</span><span class="op" id="4382994">(</span><span class="ident" id="4382995">x</span><span class="op" id="4382996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4383000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4383004">return</span>&nbsp;<span class="ident" id="4383011">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4383015">case</span>&nbsp;<span class="ident" id="4383020">token</span><span class="op" id="4383025">.</span><span class="ident" id="4383026">INT</span><span class="op" id="4383029">,</span>&nbsp;<span class="ident" id="4383031">token</span><span class="op" id="4383036">.</span><span class="ident" id="4383037">FLOAT</span><span class="op" id="4383042">,</span>&nbsp;<span class="ident" id="4383044">token</span><span class="op" id="4383049">.</span><span class="ident" id="4383050">IMAG</span><span class="op" id="4383054">,</span>&nbsp;<span class="ident" id="4383056">token</span><span class="op" id="4383061">.</span><span class="ident" id="4383062">CHAR</span><span class="op" id="4383066">,</span>&nbsp;<span class="ident" id="4383068">token</span><span class="op" id="4383073">.</span><span class="ident" id="4383074">STRING</span><span class="op" id="4383080">:</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383084">x</span>&nbsp;<span class="op" id="4383086">:=</span>&nbsp;<span class="op" id="4383089">&amp;</span><span class="ident" id="4383090">ast</span><span class="op" id="4383093">.</span><span class="ident" id="4383094">BasicLit</span><span class="op" id="4383102">{</span><span class="ident" id="4383103">ValuePos</span><span class="op" id="4383111">:</span>&nbsp;<span class="ident" id="4383113">p</span><span class="op" id="4383114">.</span><span class="ident" id="4383115">pos</span><span class="op" id="4383118">,</span>&nbsp;<span class="ident" id="4383120">Kind</span><span class="op" id="4383124">:</span>&nbsp;<span class="ident" id="4383126">p</span><span class="op" id="4383127">.</span><span class="ident" id="4383128">tok</span><span class="op" id="4383131">,</span>&nbsp;<span class="ident" id="4383133">Value</span><span class="op" id="4383138">:</span>&nbsp;<span class="ident" id="4383140">p</span><span class="op" id="4383141">.</span><span class="ident" id="4383142">lit</span><span class="op" id="4383145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383149">p</span><span class="op" id="4383150">.</span><span class="ident" id="4383151">next</span><span class="op" id="4383155">(</span><span class="op" id="4383156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4383160">return</span>&nbsp;<span class="ident" id="4383167">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4383171">case</span>&nbsp;<span class="ident" id="4383176">token</span><span class="op" id="4383181">.</span><span class="ident" id="4383182">LPAREN</span><span class="op" id="4383188">:</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383192">lparen</span>&nbsp;<span class="op" id="4383199">:=</span>&nbsp;<span class="ident" id="4383202">p</span><span class="op" id="4383203">.</span><span class="ident" id="4383204">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383210">p</span><span class="op" id="4383211">.</span><span class="ident" id="4383212">next</span><span class="op" id="4383216">(</span><span class="op" id="4383217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383221">p</span><span class="op" id="4383222">.</span><span class="ident" id="4383223">exprLev</span><span class="op" id="4383230">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383235">x</span>&nbsp;<span class="op" id="4383237">:=</span>&nbsp;<span class="ident" id="4383240">p</span><span class="op" id="4383241">.</span><span class="ident" id="4383242">parseRhsOrType</span><span class="op" id="4383256">(</span><span class="op" id="4383257">)</span>&nbsp;<span class="comment" id="4383259">//&nbsp;types&nbsp;may&nbsp;be&nbsp;parenthesized:&nbsp;(some&nbsp;type)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383304">p</span><span class="op" id="4383305">.</span><span class="ident" id="4383306">exprLev</span><span class="op" id="4383313">--</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383318">rparen</span>&nbsp;<span class="op" id="4383325">:=</span>&nbsp;<span class="ident" id="4383328">p</span><span class="op" id="4383329">.</span><span class="ident" id="4383330">expect</span><span class="op" id="4383336">(</span><span class="ident" id="4383337">token</span><span class="op" id="4383342">.</span><span class="ident" id="4383343">RPAREN</span><span class="op" id="4383349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4383353">return</span>&nbsp;<span class="op" id="4383360">&amp;</span><span class="ident" id="4383361">ast</span><span class="op" id="4383364">.</span><span class="ident" id="4383365">ParenExpr</span><span class="op" id="4383374">{</span><span class="ident" id="4383375">Lparen</span><span class="op" id="4383381">:</span>&nbsp;<span class="ident" id="4383383">lparen</span><span class="op" id="4383389">,</span>&nbsp;<span class="ident" id="4383391">X</span><span class="op" id="4383392">:</span>&nbsp;<span class="ident" id="4383394">x</span><span class="op" id="4383395">,</span>&nbsp;<span class="ident" id="4383397">Rparen</span><span class="op" id="4383403">:</span>&nbsp;<span class="ident" id="4383405">rparen</span><span class="op" id="4383411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4383415">case</span>&nbsp;<span class="ident" id="4383420">token</span><span class="op" id="4383425">.</span><span class="ident" id="4383426">FUNC</span><span class="op" id="4383430">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4383434">return</span>&nbsp;<span class="ident" id="4383441">p</span><span class="op" id="4383442">.</span><span class="ident" id="4383443">parseFuncTypeOrLit</span><span class="op" id="4383461">(</span><span class="op" id="4383462">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4383465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4383469">if</span>&nbsp;<span class="ident" id="4383472">typ</span>&nbsp;<span class="op" id="4383476">:=</span>&nbsp;<span class="ident" id="4383479">p</span><span class="op" id="4383480">.</span><span class="ident" id="4383481">tryIdentOrType</span><span class="op" id="4383495">(</span><span class="op" id="4383496">)</span><span class="op" id="4383497">;</span>&nbsp;<span class="ident" id="4383499">typ</span>&nbsp;<span class="op" id="4383503">!=</span>&nbsp;<span class="ident" id="4383506">nil</span>&nbsp;<span class="op" id="4383510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4383514">//&nbsp;could&nbsp;be&nbsp;type&nbsp;for&nbsp;composite&nbsp;literal&nbsp;or&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383569">_</span><span class="op" id="4383570">,</span>&nbsp;<span class="ident" id="4383572">isIdent</span>&nbsp;<span class="op" id="4383580">:=</span>&nbsp;<span class="ident" id="4383583">typ</span><span class="op" id="4383586">.</span><span class="op" id="4383587">(</span><span class="op" id="4383588">*</span><span class="ident" id="4383589">ast</span><span class="op" id="4383592">.</span><span class="ident" id="4383593">Ident</span><span class="op" id="4383598">)</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383602">assert</span><span class="op" id="4383608">(</span><span class="op" id="4383609">!</span><span class="ident" id="4383610">isIdent</span><span class="op" id="4383617">,</span>&nbsp;<span class="string" id="4383619">&#34;type&nbsp;cannot&nbsp;be&nbsp;identifier&#34;</span><span class="op" id="4383646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4383650">return</span>&nbsp;<span class="ident" id="4383657">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4383662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4383666">//&nbsp;we&nbsp;have&nbsp;an&nbsp;error</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383687">pos</span>&nbsp;<span class="op" id="4383691">:=</span>&nbsp;<span class="ident" id="4383694">p</span><span class="op" id="4383695">.</span><span class="ident" id="4383696">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383701">p</span><span class="op" id="4383702">.</span><span class="ident" id="4383703">errorExpected</span><span class="op" id="4383716">(</span><span class="ident" id="4383717">pos</span><span class="op" id="4383720">,</span>&nbsp;<span class="string" id="4383722">&#34;operand&#34;</span><span class="op" id="4383731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383734">syncStmt</span><span class="op" id="4383742">(</span><span class="ident" id="4383743">p</span><span class="op" id="4383744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4383747">return</span>&nbsp;<span class="op" id="4383754">&amp;</span><span class="ident" id="4383755">ast</span><span class="op" id="4383758">.</span><span class="ident" id="4383759">BadExpr</span><span class="op" id="4383766">{</span><span class="ident" id="4383767">From</span><span class="op" id="4383771">:</span>&nbsp;<span class="ident" id="4383773">pos</span><span class="op" id="4383776">,</span>&nbsp;<span class="ident" id="4383778">To</span><span class="op" id="4383780">:</span>&nbsp;<span class="ident" id="4383782">p</span><span class="op" id="4383783">.</span><span class="ident" id="4383784">pos</span><span class="op" id="4383787">}</span><br>
<span class="lineno"></span><span class="op" id="4383789">}</span><br>
<span class="lineno">1160</span><br>
<span class="lineno"></span><span class="keyword" id="4383792">func</span>&nbsp;<span class="op" id="4383797">(</span><span class="ident" id="4383798">p</span>&nbsp;<span class="op" id="4383800">*</span><span class="ident" id="4383801">parser</span><span class="op" id="4383807">)</span>&nbsp;<span class="ident" id="4383809">parseSelector</span><span class="op" id="4383822">(</span><span class="ident" id="4383823">x</span>&nbsp;<span class="ident" id="4383825">ast</span><span class="op" id="4383828">.</span><span class="ident" id="4383829">Expr</span><span class="op" id="4383833">)</span>&nbsp;<span class="ident" id="4383835">ast</span><span class="op" id="4383838">.</span><span class="ident" id="4383839">Expr</span>&nbsp;<span class="op" id="4383844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4383847">if</span>&nbsp;<span class="ident" id="4383850">p</span><span class="op" id="4383851">.</span><span class="ident" id="4383852">trace</span>&nbsp;<span class="op" id="4383858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4383862">defer</span>&nbsp;<span class="ident" id="4383868">un</span><span class="op" id="4383870">(</span><span class="ident" id="4383871">trace</span><span class="op" id="4383876">(</span><span class="ident" id="4383877">p</span><span class="op" id="4383878">,</span>&nbsp;<span class="string" id="4383880">&#34;Selector&#34;</span><span class="op" id="4383890">)</span><span class="op" id="4383891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4383894">}</span><br>
<span class="lineno">1165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4383898">sel</span>&nbsp;<span class="op" id="4383902">:=</span>&nbsp;<span class="ident" id="4383905">p</span><span class="op" id="4383906">.</span><span class="ident" id="4383907">parseIdent</span><span class="op" id="4383917">(</span><span class="op" id="4383918">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4383922">return</span>&nbsp;<span class="op" id="4383929">&amp;</span><span class="ident" id="4383930">ast</span><span class="op" id="4383933">.</span><span class="ident" id="4383934">SelectorExpr</span><span class="op" id="4383946">{</span><span class="ident" id="4383947">X</span><span class="op" id="4383948">:</span>&nbsp;<span class="ident" id="4383950">x</span><span class="op" id="4383951">,</span>&nbsp;<span class="ident" id="4383953">Sel</span><span class="op" id="4383956">:</span>&nbsp;<span class="ident" id="4383958">sel</span><span class="op" id="4383961">}</span><br>
<span class="lineno"></span><span class="op" id="4383963">}</span><br>
<span class="lineno">1170</span><br>
<span class="lineno"></span><span class="keyword" id="4383966">func</span>&nbsp;<span class="op" id="4383971">(</span><span class="ident" id="4383972">p</span>&nbsp;<span class="op" id="4383974">*</span><span class="ident" id="4383975">parser</span><span class="op" id="4383981">)</span>&nbsp;<span class="ident" id="4383983">parseTypeAssertion</span><span class="op" id="4384001">(</span><span class="ident" id="4384002">x</span>&nbsp;<span class="ident" id="4384004">ast</span><span class="op" id="4384007">.</span><span class="ident" id="4384008">Expr</span><span class="op" id="4384012">)</span>&nbsp;<span class="ident" id="4384014">ast</span><span class="op" id="4384017">.</span><span class="ident" id="4384018">Expr</span>&nbsp;<span class="op" id="4384023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4384026">if</span>&nbsp;<span class="ident" id="4384029">p</span><span class="op" id="4384030">.</span><span class="ident" id="4384031">trace</span>&nbsp;<span class="op" id="4384037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4384041">defer</span>&nbsp;<span class="ident" id="4384047">un</span><span class="op" id="4384049">(</span><span class="ident" id="4384050">trace</span><span class="op" id="4384055">(</span><span class="ident" id="4384056">p</span><span class="op" id="4384057">,</span>&nbsp;<span class="string" id="4384059">&#34;TypeAssertion&#34;</span><span class="op" id="4384074">)</span><span class="op" id="4384075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4384078">}</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4384082">lparen</span>&nbsp;<span class="op" id="4384089">:=</span>&nbsp;<span class="ident" id="4384092">p</span><span class="op" id="4384093">.</span><span class="ident" id="4384094">expect</span><span class="op" id="4384100">(</span><span class="ident" id="4384101">token</span><span class="op" id="4384106">.</span><span class="ident" id="4384107">LPAREN</span><span class="op" id="4384113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4384116">var</span>&nbsp;<span class="ident" id="4384120">typ</span>&nbsp;<span class="ident" id="4384124">ast</span><span class="op" id="4384127">.</span><span class="ident" id="4384128">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4384134">if</span>&nbsp;<span class="ident" id="4384137">p</span><span class="op" id="4384138">.</span><span class="ident" id="4384139">tok</span>&nbsp;<span class="op" id="4384143">==</span>&nbsp;<span class="ident" id="4384146">token</span><span class="op" id="4384151">.</span><span class="ident" id="4384152">TYPE</span>&nbsp;<span class="op" id="4384157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4384161">//&nbsp;type&nbsp;switch:&nbsp;typ&nbsp;==&nbsp;nil</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4384190">p</span><span class="op" id="4384191">.</span><span class="ident" id="4384192">next</span><span class="op" id="4384196">(</span><span class="op" id="4384197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4384200">}</span>&nbsp;<span class="keyword" id="4384202">else</span>&nbsp;<span class="op" id="4384207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4384211">typ</span>&nbsp;<span class="op" id="4384215">=</span>&nbsp;<span class="ident" id="4384217">p</span><span class="op" id="4384218">.</span><span class="ident" id="4384219">parseType</span><span class="op" id="4384228">(</span><span class="op" id="4384229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4384232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4384235">rparen</span>&nbsp;<span class="op" id="4384242">:=</span>&nbsp;<span class="ident" id="4384245">p</span><span class="op" id="4384246">.</span><span class="ident" id="4384247">expect</span><span class="op" id="4384253">(</span><span class="ident" id="4384254">token</span><span class="op" id="4384259">.</span><span class="ident" id="4384260">RPAREN</span><span class="op" id="4384266">)</span><br>
<span class="lineno">1185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4384270">return</span>&nbsp;<span class="op" id="4384277">&amp;</span><span class="ident" id="4384278">ast</span><span class="op" id="4384281">.</span><span class="ident" id="4384282">TypeAssertExpr</span><span class="op" id="4384296">{</span><span class="ident" id="4384297">X</span><span class="op" id="4384298">:</span>&nbsp;<span class="ident" id="4384300">x</span><span class="op" id="4384301">,</span>&nbsp;<span class="ident" id="4384303">Type</span><span class="op" id="4384307">:</span>&nbsp;<span class="ident" id="4384309">typ</span><span class="op" id="4384312">,</span>&nbsp;<span class="ident" id="4384314">Lparen</span><span class="op" id="4384320">:</span>&nbsp;<span class="ident" id="4384322">lparen</span><span class="op" id="4384328">,</span>&nbsp;<span class="ident" id="4384330">Rparen</span><span class="op" id="4384336">:</span>&nbsp;<span class="ident" id="4384338">rparen</span><span class="op" id="4384344">}</span><br>
<span class="lineno"></span><span class="op" id="4384346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4384349">func</span>&nbsp;<span class="op" id="4384354">(</span><span class="ident" id="4384355">p</span>&nbsp;<span class="op" id="4384357">*</span><span class="ident" id="4384358">parser</span><span class="op" id="4384364">)</span>&nbsp;<span class="ident" id="4384366">parseIndexOrSlice</span><span class="op" id="4384383">(</span><span class="ident" id="4384384">x</span>&nbsp;<span class="ident" id="4384386">ast</span><span class="op" id="4384389">.</span><span class="ident" id="4384390">Expr</span><span class="op" id="4384394">)</span>&nbsp;<span class="ident" id="4384396">ast</span><span class="op" id="4384399">.</span><span class="ident" id="4384400">Expr</span>&nbsp;<span class="op" id="4384405">{</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4384408">if</span>&nbsp;<span class="ident" id="4384411">p</span><span class="op" id="4384412">.</span><span class="ident" id="4384413">trace</span>&nbsp;<span class="op" id="4384419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4384423">defer</span>&nbsp;<span class="ident" id="4384429">un</span><span class="op" id="4384431">(</span><span class="ident" id="4384432">trace</span><span class="op" id="4384437">(</span><span class="ident" id="4384438">p</span><span class="op" id="4384439">,</span>&nbsp;<span class="string" id="4384441">&#34;IndexOrSlice&#34;</span><span class="op" id="4384455">)</span><span class="op" id="4384456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4384459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4384463">const</span>&nbsp;<span class="ident" id="4384469">N</span>&nbsp;<span class="op" id="4384471">=</span>&nbsp;<span class="num" id="4384473">3</span>&nbsp;<span class="comment" id="4384475">//&nbsp;change&nbsp;the&nbsp;3&nbsp;to&nbsp;2&nbsp;to&nbsp;disable&nbsp;3-index&nbsp;slices</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4384523">lbrack</span>&nbsp;<span class="op" id="4384530">:=</span>&nbsp;<span class="ident" id="4384533">p</span><span class="op" id="4384534">.</span><span class="ident" id="4384535">expect</span><span class="op" id="4384541">(</span><span class="ident" id="4384542">token</span><span class="op" id="4384547">.</span><span class="ident" id="4384548">LBRACK</span><span class="op" id="4384554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4384557">p</span><span class="op" id="4384558">.</span><span class="ident" id="4384559">exprLev</span><span class="op" id="4384566">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4384570">var</span>&nbsp;<span class="ident" id="4384574">index</span>&nbsp;<span class="op" id="4384580">[</span><span class="ident" id="4384581">N</span><span class="op" id="4384582">]</span><span class="ident" id="4384583">ast</span><span class="op" id="4384586">.</span><span class="ident" id="4384587">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4384593">var</span>&nbsp;<span class="ident" id="4384597">colons</span>&nbsp;<span class="op" id="4384604">[</span><span class="ident" id="4384605">N</span>&nbsp;<span class="op" id="4384607">-</span>&nbsp;<span class="num" id="4384609">1</span><span class="op" id="4384610">]</span><span class="ident" id="4384611">token</span><span class="op" id="4384616">.</span><span class="ident" id="4384617">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4384622">if</span>&nbsp;<span class="ident" id="4384625">p</span><span class="op" id="4384626">.</span><span class="ident" id="4384627">tok</span>&nbsp;<span class="op" id="4384631">!=</span>&nbsp;<span class="ident" id="4384634">token</span><span class="op" id="4384639">.</span><span class="ident" id="4384640">COLON</span>&nbsp;<span class="op" id="4384646">{</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4384650">index</span><span class="op" id="4384655">[</span><span class="num" id="4384656">0</span><span class="op" id="4384657">]</span>&nbsp;<span class="op" id="4384659">=</span>&nbsp;<span class="ident" id="4384661">p</span><span class="op" id="4384662">.</span><span class="ident" id="4384663">parseRhs</span><span class="op" id="4384671">(</span><span class="op" id="4384672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4384675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4384678">ncolons</span>&nbsp;<span class="op" id="4384686">:=</span>&nbsp;<span class="num" id="4384689">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4384692">for</span>&nbsp;<span class="ident" id="4384696">p</span><span class="op" id="4384697">.</span><span class="ident" id="4384698">tok</span>&nbsp;<span class="op" id="4384702">==</span>&nbsp;<span class="ident" id="4384705">token</span><span class="op" id="4384710">.</span><span class="ident" id="4384711">COLON</span>&nbsp;<span class="op" id="4384717">&amp;&amp;</span>&nbsp;<span class="ident" id="4384720">ncolons</span>&nbsp;<span class="op" id="4384728">&lt;</span>&nbsp;<span class="builtinfunc" id="4384730">len</span><span class="op" id="4384733">(</span><span class="ident" id="4384734">colons</span><span class="op" id="4384740">)</span>&nbsp;<span class="op" id="4384742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4384746">colons</span><span class="op" id="4384752">[</span><span class="ident" id="4384753">ncolons</span><span class="op" id="4384760">]</span>&nbsp;<span class="op" id="4384762">=</span>&nbsp;<span class="ident" id="4384764">p</span><span class="op" id="4384765">.</span><span class="ident" id="4384766">pos</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4384772">ncolons</span><span class="op" id="4384779">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4384784">p</span><span class="op" id="4384785">.</span><span class="ident" id="4384786">next</span><span class="op" id="4384790">(</span><span class="op" id="4384791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4384795">if</span>&nbsp;<span class="ident" id="4384798">p</span><span class="op" id="4384799">.</span><span class="ident" id="4384800">tok</span>&nbsp;<span class="op" id="4384804">!=</span>&nbsp;<span class="ident" id="4384807">token</span><span class="op" id="4384812">.</span><span class="ident" id="4384813">COLON</span>&nbsp;<span class="op" id="4384819">&amp;&amp;</span>&nbsp;<span class="ident" id="4384822">p</span><span class="op" id="4384823">.</span><span class="ident" id="4384824">tok</span>&nbsp;<span class="op" id="4384828">!=</span>&nbsp;<span class="ident" id="4384831">token</span><span class="op" id="4384836">.</span><span class="ident" id="4384837">RBRACK</span>&nbsp;<span class="op" id="4384844">&amp;&amp;</span>&nbsp;<span class="ident" id="4384847">p</span><span class="op" id="4384848">.</span><span class="ident" id="4384849">tok</span>&nbsp;<span class="op" id="4384853">!=</span>&nbsp;<span class="ident" id="4384856">token</span><span class="op" id="4384861">.</span><span class="ident" id="4384862">EOF</span>&nbsp;<span class="op" id="4384866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4384871">index</span><span class="op" id="4384876">[</span><span class="ident" id="4384877">ncolons</span><span class="op" id="4384884">]</span>&nbsp;<span class="op" id="4384886">=</span>&nbsp;<span class="ident" id="4384888">p</span><span class="op" id="4384889">.</span><span class="ident" id="4384890">parseRhs</span><span class="op" id="4384898">(</span><span class="op" id="4384899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4384903">}</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4384906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4384909">p</span><span class="op" id="4384910">.</span><span class="ident" id="4384911">exprLev</span><span class="op" id="4384918">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4384922">rbrack</span>&nbsp;<span class="op" id="4384929">:=</span>&nbsp;<span class="ident" id="4384932">p</span><span class="op" id="4384933">.</span><span class="ident" id="4384934">expect</span><span class="op" id="4384940">(</span><span class="ident" id="4384941">token</span><span class="op" id="4384946">.</span><span class="ident" id="4384947">RBRACK</span><span class="op" id="4384953">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4384957">if</span>&nbsp;<span class="ident" id="4384960">ncolons</span>&nbsp;<span class="op" id="4384968">&gt;</span>&nbsp;<span class="num" id="4384970">0</span>&nbsp;<span class="op" id="4384972">{</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4384976">//&nbsp;slice&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4384998">slice3</span>&nbsp;<span class="op" id="4385005">:=</span>&nbsp;<span class="builtintype" id="4385008">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4385016">if</span>&nbsp;<span class="ident" id="4385019">ncolons</span>&nbsp;<span class="op" id="4385027">==</span>&nbsp;<span class="num" id="4385030">2</span>&nbsp;<span class="op" id="4385032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4385037">slice3</span>&nbsp;<span class="op" id="4385044">=</span>&nbsp;<span class="builtintype" id="4385046">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4385054">//&nbsp;Check&nbsp;presence&nbsp;of&nbsp;2nd&nbsp;and&nbsp;3rd&nbsp;index&nbsp;here&nbsp;rather&nbsp;than&nbsp;during&nbsp;type-checking</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4385134">//&nbsp;to&nbsp;prevent&nbsp;erroneous&nbsp;programs&nbsp;from&nbsp;passing&nbsp;through&nbsp;gofmt&nbsp;(was&nbsp;issue&nbsp;7305).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4385215">if</span>&nbsp;<span class="ident" id="4385218">index</span><span class="op" id="4385223">[</span><span class="num" id="4385224">1</span><span class="op" id="4385225">]</span>&nbsp;<span class="op" id="4385227">==</span>&nbsp;<span class="ident" id="4385230">nil</span>&nbsp;<span class="op" id="4385234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4385240">p</span><span class="op" id="4385241">.</span><span class="builtintype" id="4385242">error</span><span class="op" id="4385247">(</span><span class="ident" id="4385248">colons</span><span class="op" id="4385254">[</span><span class="num" id="4385255">0</span><span class="op" id="4385256">]</span><span class="op" id="4385257">,</span>&nbsp;<span class="string" id="4385259">&#34;2nd&nbsp;index&nbsp;required&nbsp;in&nbsp;3-index&nbsp;slice&#34;</span><span class="op" id="4385296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4385302">index</span><span class="op" id="4385307">[</span><span class="num" id="4385308">1</span><span class="op" id="4385309">]</span>&nbsp;<span class="op" id="4385311">=</span>&nbsp;<span class="op" id="4385313">&amp;</span><span class="ident" id="4385314">ast</span><span class="op" id="4385317">.</span><span class="ident" id="4385318">BadExpr</span><span class="op" id="4385325">{</span><span class="ident" id="4385326">From</span><span class="op" id="4385330">:</span>&nbsp;<span class="ident" id="4385332">colons</span><span class="op" id="4385338">[</span><span class="num" id="4385339">0</span><span class="op" id="4385340">]</span>&nbsp;<span class="op" id="4385342">+</span>&nbsp;<span class="num" id="4385344">1</span><span class="op" id="4385345">,</span>&nbsp;<span class="ident" id="4385347">To</span><span class="op" id="4385349">:</span>&nbsp;<span class="ident" id="4385351">colons</span><span class="op" id="4385357">[</span><span class="num" id="4385358">1</span><span class="op" id="4385359">]</span><span class="op" id="4385360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4385365">}</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4385370">if</span>&nbsp;<span class="ident" id="4385373">index</span><span class="op" id="4385378">[</span><span class="num" id="4385379">2</span><span class="op" id="4385380">]</span>&nbsp;<span class="op" id="4385382">==</span>&nbsp;<span class="ident" id="4385385">nil</span>&nbsp;<span class="op" id="4385389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4385395">p</span><span class="op" id="4385396">.</span><span class="builtintype" id="4385397">error</span><span class="op" id="4385402">(</span><span class="ident" id="4385403">colons</span><span class="op" id="4385409">[</span><span class="num" id="4385410">1</span><span class="op" id="4385411">]</span><span class="op" id="4385412">,</span>&nbsp;<span class="string" id="4385414">&#34;3rd&nbsp;index&nbsp;required&nbsp;in&nbsp;3-index&nbsp;slice&#34;</span><span class="op" id="4385451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4385457">index</span><span class="op" id="4385462">[</span><span class="num" id="4385463">2</span><span class="op" id="4385464">]</span>&nbsp;<span class="op" id="4385466">=</span>&nbsp;<span class="op" id="4385468">&amp;</span><span class="ident" id="4385469">ast</span><span class="op" id="4385472">.</span><span class="ident" id="4385473">BadExpr</span><span class="op" id="4385480">{</span><span class="ident" id="4385481">From</span><span class="op" id="4385485">:</span>&nbsp;<span class="ident" id="4385487">colons</span><span class="op" id="4385493">[</span><span class="num" id="4385494">1</span><span class="op" id="4385495">]</span>&nbsp;<span class="op" id="4385497">+</span>&nbsp;<span class="num" id="4385499">1</span><span class="op" id="4385500">,</span>&nbsp;<span class="ident" id="4385502">To</span><span class="op" id="4385504">:</span>&nbsp;<span class="ident" id="4385506">rbrack</span><span class="op" id="4385512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4385517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4385521">}</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4385525">return</span>&nbsp;<span class="op" id="4385532">&amp;</span><span class="ident" id="4385533">ast</span><span class="op" id="4385536">.</span><span class="ident" id="4385537">SliceExpr</span><span class="op" id="4385546">{</span><span class="ident" id="4385547">X</span><span class="op" id="4385548">:</span>&nbsp;<span class="ident" id="4385550">x</span><span class="op" id="4385551">,</span>&nbsp;<span class="ident" id="4385553">Lbrack</span><span class="op" id="4385559">:</span>&nbsp;<span class="ident" id="4385561">lbrack</span><span class="op" id="4385567">,</span>&nbsp;<span class="ident" id="4385569">Low</span><span class="op" id="4385572">:</span>&nbsp;<span class="ident" id="4385574">index</span><span class="op" id="4385579">[</span><span class="num" id="4385580">0</span><span class="op" id="4385581">]</span><span class="op" id="4385582">,</span>&nbsp;<span class="ident" id="4385584">High</span><span class="op" id="4385588">:</span>&nbsp;<span class="ident" id="4385590">index</span><span class="op" id="4385595">[</span><span class="num" id="4385596">1</span><span class="op" id="4385597">]</span><span class="op" id="4385598">,</span>&nbsp;<span class="ident" id="4385600">Max</span><span class="op" id="4385603">:</span>&nbsp;<span class="ident" id="4385605">index</span><span class="op" id="4385610">[</span><span class="num" id="4385611">2</span><span class="op" id="4385612">]</span><span class="op" id="4385613">,</span>&nbsp;<span class="ident" id="4385615">Slice3</span><span class="op" id="4385621">:</span>&nbsp;<span class="ident" id="4385623">slice3</span><span class="op" id="4385629">,</span>&nbsp;<span class="ident" id="4385631">Rbrack</span><span class="op" id="4385637">:</span>&nbsp;<span class="ident" id="4385639">rbrack</span><span class="op" id="4385645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4385648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4385652">return</span>&nbsp;<span class="op" id="4385659">&amp;</span><span class="ident" id="4385660">ast</span><span class="op" id="4385663">.</span><span class="ident" id="4385664">IndexExpr</span><span class="op" id="4385673">{</span><span class="ident" id="4385674">X</span><span class="op" id="4385675">:</span>&nbsp;<span class="ident" id="4385677">x</span><span class="op" id="4385678">,</span>&nbsp;<span class="ident" id="4385680">Lbrack</span><span class="op" id="4385686">:</span>&nbsp;<span class="ident" id="4385688">lbrack</span><span class="op" id="4385694">,</span>&nbsp;<span class="ident" id="4385696">Index</span><span class="op" id="4385701">:</span>&nbsp;<span class="ident" id="4385703">index</span><span class="op" id="4385708">[</span><span class="num" id="4385709">0</span><span class="op" id="4385710">]</span><span class="op" id="4385711">,</span>&nbsp;<span class="ident" id="4385713">Rbrack</span><span class="op" id="4385719">:</span>&nbsp;<span class="ident" id="4385721">rbrack</span><span class="op" id="4385727">}</span><br>
<span class="lineno"></span><span class="op" id="4385729">}</span><br>
<span class="lineno">1235</span><br>
<span class="lineno"></span><span class="keyword" id="4385732">func</span>&nbsp;<span class="op" id="4385737">(</span><span class="ident" id="4385738">p</span>&nbsp;<span class="op" id="4385740">*</span><span class="ident" id="4385741">parser</span><span class="op" id="4385747">)</span>&nbsp;<span class="ident" id="4385749">parseCallOrConversion</span><span class="op" id="4385770">(</span><span class="ident" id="4385771">fun</span>&nbsp;<span class="ident" id="4385775">ast</span><span class="op" id="4385778">.</span><span class="ident" id="4385779">Expr</span><span class="op" id="4385783">)</span>&nbsp;<span class="op" id="4385785">*</span><span class="ident" id="4385786">ast</span><span class="op" id="4385789">.</span><span class="ident" id="4385790">CallExpr</span>&nbsp;<span class="op" id="4385799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4385802">if</span>&nbsp;<span class="ident" id="4385805">p</span><span class="op" id="4385806">.</span><span class="ident" id="4385807">trace</span>&nbsp;<span class="op" id="4385813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4385817">defer</span>&nbsp;<span class="ident" id="4385823">un</span><span class="op" id="4385825">(</span><span class="ident" id="4385826">trace</span><span class="op" id="4385831">(</span><span class="ident" id="4385832">p</span><span class="op" id="4385833">,</span>&nbsp;<span class="string" id="4385835">&#34;CallOrConversion&#34;</span><span class="op" id="4385853">)</span><span class="op" id="4385854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4385857">}</span><br>
<span class="lineno">1240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4385861">lparen</span>&nbsp;<span class="op" id="4385868">:=</span>&nbsp;<span class="ident" id="4385871">p</span><span class="op" id="4385872">.</span><span class="ident" id="4385873">expect</span><span class="op" id="4385879">(</span><span class="ident" id="4385880">token</span><span class="op" id="4385885">.</span><span class="ident" id="4385886">LPAREN</span><span class="op" id="4385892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4385895">p</span><span class="op" id="4385896">.</span><span class="ident" id="4385897">exprLev</span><span class="op" id="4385904">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4385908">var</span>&nbsp;<span class="ident" id="4385912">list</span>&nbsp;<span class="op" id="4385917">[</span><span class="op" id="4385918">]</span><span class="ident" id="4385919">ast</span><span class="op" id="4385922">.</span><span class="ident" id="4385923">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4385929">var</span>&nbsp;<span class="ident" id="4385933">ellipsis</span>&nbsp;<span class="ident" id="4385942">token</span><span class="op" id="4385947">.</span><span class="ident" id="4385948">Pos</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4385953">for</span>&nbsp;<span class="ident" id="4385957">p</span><span class="op" id="4385958">.</span><span class="ident" id="4385959">tok</span>&nbsp;<span class="op" id="4385963">!=</span>&nbsp;<span class="ident" id="4385966">token</span><span class="op" id="4385971">.</span><span class="ident" id="4385972">RPAREN</span>&nbsp;<span class="op" id="4385979">&amp;&amp;</span>&nbsp;<span class="ident" id="4385982">p</span><span class="op" id="4385983">.</span><span class="ident" id="4385984">tok</span>&nbsp;<span class="op" id="4385988">!=</span>&nbsp;<span class="ident" id="4385991">token</span><span class="op" id="4385996">.</span><span class="ident" id="4385997">EOF</span>&nbsp;<span class="op" id="4386001">&amp;&amp;</span>&nbsp;<span class="op" id="4386004">!</span><span class="ident" id="4386005">ellipsis</span><span class="op" id="4386013">.</span><span class="ident" id="4386014">IsValid</span><span class="op" id="4386021">(</span><span class="op" id="4386022">)</span>&nbsp;<span class="op" id="4386024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4386028">list</span>&nbsp;<span class="op" id="4386033">=</span>&nbsp;<span class="builtinfunc" id="4386035">append</span><span class="op" id="4386041">(</span><span class="ident" id="4386042">list</span><span class="op" id="4386046">,</span>&nbsp;<span class="ident" id="4386048">p</span><span class="op" id="4386049">.</span><span class="ident" id="4386050">parseRhsOrType</span><span class="op" id="4386064">(</span><span class="op" id="4386065">)</span><span class="op" id="4386066">)</span>&nbsp;<span class="comment" id="4386068">//&nbsp;builtins&nbsp;may&nbsp;expect&nbsp;a&nbsp;type:&nbsp;make(some&nbsp;type,&nbsp;...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4386122">if</span>&nbsp;<span class="ident" id="4386125">p</span><span class="op" id="4386126">.</span><span class="ident" id="4386127">tok</span>&nbsp;<span class="op" id="4386131">==</span>&nbsp;<span class="ident" id="4386134">token</span><span class="op" id="4386139">.</span><span class="ident" id="4386140">ELLIPSIS</span>&nbsp;<span class="op" id="4386149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4386154">ellipsis</span>&nbsp;<span class="op" id="4386163">=</span>&nbsp;<span class="ident" id="4386165">p</span><span class="op" id="4386166">.</span><span class="ident" id="4386167">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4386174">p</span><span class="op" id="4386175">.</span><span class="ident" id="4386176">next</span><span class="op" id="4386180">(</span><span class="op" id="4386181">)</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4386185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4386189">if</span>&nbsp;<span class="op" id="4386192">!</span><span class="ident" id="4386193">p</span><span class="op" id="4386194">.</span><span class="ident" id="4386195">atComma</span><span class="op" id="4386202">(</span><span class="string" id="4386203">&#34;argument&nbsp;list&#34;</span><span class="op" id="4386218">)</span>&nbsp;<span class="op" id="4386220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4386225">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4386233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4386237">p</span><span class="op" id="4386238">.</span><span class="ident" id="4386239">next</span><span class="op" id="4386243">(</span><span class="op" id="4386244">)</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4386247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4386250">p</span><span class="op" id="4386251">.</span><span class="ident" id="4386252">exprLev</span><span class="op" id="4386259">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4386263">rparen</span>&nbsp;<span class="op" id="4386270">:=</span>&nbsp;<span class="ident" id="4386273">p</span><span class="op" id="4386274">.</span><span class="ident" id="4386275">expectClosing</span><span class="op" id="4386288">(</span><span class="ident" id="4386289">token</span><span class="op" id="4386294">.</span><span class="ident" id="4386295">RPAREN</span><span class="op" id="4386301">,</span>&nbsp;<span class="string" id="4386303">&#34;argument&nbsp;list&#34;</span><span class="op" id="4386318">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4386322">return</span>&nbsp;<span class="op" id="4386329">&amp;</span><span class="ident" id="4386330">ast</span><span class="op" id="4386333">.</span><span class="ident" id="4386334">CallExpr</span><span class="op" id="4386342">{</span><span class="ident" id="4386343">Fun</span><span class="op" id="4386346">:</span>&nbsp;<span class="ident" id="4386348">fun</span><span class="op" id="4386351">,</span>&nbsp;<span class="ident" id="4386353">Lparen</span><span class="op" id="4386359">:</span>&nbsp;<span class="ident" id="4386361">lparen</span><span class="op" id="4386367">,</span>&nbsp;<span class="ident" id="4386369">Args</span><span class="op" id="4386373">:</span>&nbsp;<span class="ident" id="4386375">list</span><span class="op" id="4386379">,</span>&nbsp;<span class="ident" id="4386381">Ellipsis</span><span class="op" id="4386389">:</span>&nbsp;<span class="ident" id="4386391">ellipsis</span><span class="op" id="4386399">,</span>&nbsp;<span class="ident" id="4386401">Rparen</span><span class="op" id="4386407">:</span>&nbsp;<span class="ident" id="4386409">rparen</span><span class="op" id="4386415">}</span><br>
<span class="lineno">1260</span><span class="op" id="4386417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4386420">func</span>&nbsp;<span class="op" id="4386425">(</span><span class="ident" id="4386426">p</span>&nbsp;<span class="op" id="4386428">*</span><span class="ident" id="4386429">parser</span><span class="op" id="4386435">)</span>&nbsp;<span class="ident" id="4386437">parseElement</span><span class="op" id="4386449">(</span><span class="ident" id="4386450">keyOk</span>&nbsp;<span class="builtintype" id="4386456">bool</span><span class="op" id="4386460">)</span>&nbsp;<span class="ident" id="4386462">ast</span><span class="op" id="4386465">.</span><span class="ident" id="4386466">Expr</span>&nbsp;<span class="op" id="4386471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4386474">if</span>&nbsp;<span class="ident" id="4386477">p</span><span class="op" id="4386478">.</span><span class="ident" id="4386479">trace</span>&nbsp;<span class="op" id="4386485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4386489">defer</span>&nbsp;<span class="ident" id="4386495">un</span><span class="op" id="4386497">(</span><span class="ident" id="4386498">trace</span><span class="op" id="4386503">(</span><span class="ident" id="4386504">p</span><span class="op" id="4386505">,</span>&nbsp;<span class="string" id="4386507">&#34;Element&#34;</span><span class="op" id="4386516">)</span><span class="op" id="4386517">)</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4386520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4386524">if</span>&nbsp;<span class="ident" id="4386527">p</span><span class="op" id="4386528">.</span><span class="ident" id="4386529">tok</span>&nbsp;<span class="op" id="4386533">==</span>&nbsp;<span class="ident" id="4386536">token</span><span class="op" id="4386541">.</span><span class="ident" id="4386542">LBRACE</span>&nbsp;<span class="op" id="4386549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4386553">return</span>&nbsp;<span class="ident" id="4386560">p</span><span class="op" id="4386561">.</span><span class="ident" id="4386562">parseLiteralValue</span><span class="op" id="4386579">(</span><span class="ident" id="4386580">nil</span><span class="op" id="4386583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4386586">}</span><br>
<span class="lineno">1270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4386590">//&nbsp;Because&nbsp;the&nbsp;parser&nbsp;doesn&#39;t&nbsp;know&nbsp;the&nbsp;composite&nbsp;literal&nbsp;type,&nbsp;it&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4386664">//&nbsp;know&nbsp;if&nbsp;a&nbsp;key&nbsp;that&#39;s&nbsp;an&nbsp;identifier&nbsp;is&nbsp;a&nbsp;struct&nbsp;field&nbsp;name&nbsp;or&nbsp;a&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4386736">//&nbsp;denoting&nbsp;a&nbsp;value.&nbsp;The&nbsp;former&nbsp;is&nbsp;not&nbsp;resolved&nbsp;by&nbsp;the&nbsp;parser&nbsp;or&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4386806">//&nbsp;resolver.</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4386820">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4386824">//&nbsp;Instead,&nbsp;_try_&nbsp;to&nbsp;resolve&nbsp;such&nbsp;a&nbsp;key&nbsp;if&nbsp;possible.&nbsp;If&nbsp;it&nbsp;resolves,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4386894">//&nbsp;it&nbsp;a)&nbsp;has&nbsp;correctly&nbsp;resolved,&nbsp;or&nbsp;b)&nbsp;incorrectly&nbsp;resolved&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4386963">//&nbsp;the&nbsp;key&nbsp;is&nbsp;a&nbsp;struct&nbsp;field&nbsp;with&nbsp;a&nbsp;name&nbsp;matching&nbsp;another&nbsp;identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4387034">//&nbsp;In&nbsp;the&nbsp;former&nbsp;case&nbsp;we&nbsp;are&nbsp;done,&nbsp;and&nbsp;in&nbsp;the&nbsp;latter&nbsp;case&nbsp;we&nbsp;don&#39;t</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4387102">//&nbsp;care&nbsp;because&nbsp;the&nbsp;type&nbsp;checker&nbsp;will&nbsp;do&nbsp;a&nbsp;separate&nbsp;field&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4387169">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4387173">//&nbsp;If&nbsp;the&nbsp;key&nbsp;does&nbsp;not&nbsp;resolve,&nbsp;it&nbsp;a)&nbsp;must&nbsp;be&nbsp;defined&nbsp;at&nbsp;the&nbsp;top</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4387239">//&nbsp;level&nbsp;in&nbsp;another&nbsp;file&nbsp;of&nbsp;the&nbsp;same&nbsp;package,&nbsp;the&nbsp;universe&nbsp;scope,&nbsp;or&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4387312">//&nbsp;undeclared;&nbsp;or&nbsp;b)&nbsp;it&nbsp;is&nbsp;a&nbsp;struct&nbsp;field.&nbsp;In&nbsp;the&nbsp;former&nbsp;case,&nbsp;the&nbsp;type</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4387385">//&nbsp;checker&nbsp;can&nbsp;do&nbsp;a&nbsp;top-level&nbsp;lookup,&nbsp;and&nbsp;in&nbsp;the&nbsp;latter&nbsp;case&nbsp;it&nbsp;will&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4387458">//&nbsp;a&nbsp;separate&nbsp;field&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4387487">x</span>&nbsp;<span class="op" id="4387489">:=</span>&nbsp;<span class="ident" id="4387492">p</span><span class="op" id="4387493">.</span><span class="ident" id="4387494">checkExpr</span><span class="op" id="4387503">(</span><span class="ident" id="4387504">p</span><span class="op" id="4387505">.</span><span class="ident" id="4387506">parseExpr</span><span class="op" id="4387515">(</span><span class="ident" id="4387516">keyOk</span><span class="op" id="4387521">)</span><span class="op" id="4387522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4387525">if</span>&nbsp;<span class="ident" id="4387528">keyOk</span>&nbsp;<span class="op" id="4387534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4387538">if</span>&nbsp;<span class="ident" id="4387541">p</span><span class="op" id="4387542">.</span><span class="ident" id="4387543">tok</span>&nbsp;<span class="op" id="4387547">==</span>&nbsp;<span class="ident" id="4387550">token</span><span class="op" id="4387555">.</span><span class="ident" id="4387556">COLON</span>&nbsp;<span class="op" id="4387562">{</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4387567">colon</span>&nbsp;<span class="op" id="4387573">:=</span>&nbsp;<span class="ident" id="4387576">p</span><span class="op" id="4387577">.</span><span class="ident" id="4387578">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4387585">p</span><span class="op" id="4387586">.</span><span class="ident" id="4387587">next</span><span class="op" id="4387591">(</span><span class="op" id="4387592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4387597">//&nbsp;Try&nbsp;to&nbsp;resolve&nbsp;the&nbsp;key&nbsp;but&nbsp;don&#39;t&nbsp;collect&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4387647">//&nbsp;as&nbsp;unresolved&nbsp;identifier&nbsp;if&nbsp;it&nbsp;fails&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4387698">//&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;(possibly&nbsp;false)&nbsp;errors&nbsp;about</span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4387747">//&nbsp;undeclared&nbsp;names.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4387771">p</span><span class="op" id="4387772">.</span><span class="ident" id="4387773">tryResolve</span><span class="op" id="4387783">(</span><span class="ident" id="4387784">x</span><span class="op" id="4387785">,</span>&nbsp;<span class="builtintype" id="4387787">false</span><span class="op" id="4387792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4387797">return</span>&nbsp;<span class="op" id="4387804">&amp;</span><span class="ident" id="4387805">ast</span><span class="op" id="4387808">.</span><span class="ident" id="4387809">KeyValueExpr</span><span class="op" id="4387821">{</span><span class="ident" id="4387822">Key</span><span class="op" id="4387825">:</span>&nbsp;<span class="ident" id="4387827">x</span><span class="op" id="4387828">,</span>&nbsp;<span class="ident" id="4387830">Colon</span><span class="op" id="4387835">:</span>&nbsp;<span class="ident" id="4387837">colon</span><span class="op" id="4387842">,</span>&nbsp;<span class="ident" id="4387844">Value</span><span class="op" id="4387849">:</span>&nbsp;<span class="ident" id="4387851">p</span><span class="op" id="4387852">.</span><span class="ident" id="4387853">parseElement</span><span class="op" id="4387865">(</span><span class="builtintype" id="4387866">false</span><span class="op" id="4387871">)</span><span class="op" id="4387872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4387876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4387880">p</span><span class="op" id="4387881">.</span><span class="ident" id="4387882">resolve</span><span class="op" id="4387889">(</span><span class="ident" id="4387890">x</span><span class="op" id="4387891">)</span>&nbsp;<span class="comment" id="4387893">//&nbsp;not&nbsp;a&nbsp;key</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4387907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4387911">return</span>&nbsp;<span class="ident" id="4387918">x</span><br>
<span class="lineno"></span><span class="op" id="4387920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1305</span><span class="keyword" id="4387923">func</span>&nbsp;<span class="op" id="4387928">(</span><span class="ident" id="4387929">p</span>&nbsp;<span class="op" id="4387931">*</span><span class="ident" id="4387932">parser</span><span class="op" id="4387938">)</span>&nbsp;<span class="ident" id="4387940">parseElementList</span><span class="op" id="4387956">(</span><span class="op" id="4387957">)</span>&nbsp;<span class="op" id="4387959">(</span><span class="ident" id="4387960">list</span>&nbsp;<span class="op" id="4387965">[</span><span class="op" id="4387966">]</span><span class="ident" id="4387967">ast</span><span class="op" id="4387970">.</span><span class="ident" id="4387971">Expr</span><span class="op" id="4387975">)</span>&nbsp;<span class="op" id="4387977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4387980">if</span>&nbsp;<span class="ident" id="4387983">p</span><span class="op" id="4387984">.</span><span class="ident" id="4387985">trace</span>&nbsp;<span class="op" id="4387991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4387995">defer</span>&nbsp;<span class="ident" id="4388001">un</span><span class="op" id="4388003">(</span><span class="ident" id="4388004">trace</span><span class="op" id="4388009">(</span><span class="ident" id="4388010">p</span><span class="op" id="4388011">,</span>&nbsp;<span class="string" id="4388013">&#34;ElementList&#34;</span><span class="op" id="4388026">)</span><span class="op" id="4388027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4388030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4388034">for</span>&nbsp;<span class="ident" id="4388038">p</span><span class="op" id="4388039">.</span><span class="ident" id="4388040">tok</span>&nbsp;<span class="op" id="4388044">!=</span>&nbsp;<span class="ident" id="4388047">token</span><span class="op" id="4388052">.</span><span class="ident" id="4388053">RBRACE</span>&nbsp;<span class="op" id="4388060">&amp;&amp;</span>&nbsp;<span class="ident" id="4388063">p</span><span class="op" id="4388064">.</span><span class="ident" id="4388065">tok</span>&nbsp;<span class="op" id="4388069">!=</span>&nbsp;<span class="ident" id="4388072">token</span><span class="op" id="4388077">.</span><span class="ident" id="4388078">EOF</span>&nbsp;<span class="op" id="4388082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4388086">list</span>&nbsp;<span class="op" id="4388091">=</span>&nbsp;<span class="builtinfunc" id="4388093">append</span><span class="op" id="4388099">(</span><span class="ident" id="4388100">list</span><span class="op" id="4388104">,</span>&nbsp;<span class="ident" id="4388106">p</span><span class="op" id="4388107">.</span><span class="ident" id="4388108">parseElement</span><span class="op" id="4388120">(</span><span class="builtintype" id="4388121">true</span><span class="op" id="4388125">)</span><span class="op" id="4388126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4388130">if</span>&nbsp;<span class="op" id="4388133">!</span><span class="ident" id="4388134">p</span><span class="op" id="4388135">.</span><span class="ident" id="4388136">atComma</span><span class="op" id="4388143">(</span><span class="string" id="4388144">&#34;composite&nbsp;literal&#34;</span><span class="op" id="4388163">)</span>&nbsp;<span class="op" id="4388165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4388170">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4388178">}</span><br>
<span class="lineno">1315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4388182">p</span><span class="op" id="4388183">.</span><span class="ident" id="4388184">next</span><span class="op" id="4388188">(</span><span class="op" id="4388189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4388192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4388196">return</span><br>
<span class="lineno"></span><span class="op" id="4388203">}</span><br>
<span class="lineno">1320</span><br>
<span class="lineno"></span><span class="keyword" id="4388206">func</span>&nbsp;<span class="op" id="4388211">(</span><span class="ident" id="4388212">p</span>&nbsp;<span class="op" id="4388214">*</span><span class="ident" id="4388215">parser</span><span class="op" id="4388221">)</span>&nbsp;<span class="ident" id="4388223">parseLiteralValue</span><span class="op" id="4388240">(</span><span class="ident" id="4388241">typ</span>&nbsp;<span class="ident" id="4388245">ast</span><span class="op" id="4388248">.</span><span class="ident" id="4388249">Expr</span><span class="op" id="4388253">)</span>&nbsp;<span class="ident" id="4388255">ast</span><span class="op" id="4388258">.</span><span class="ident" id="4388259">Expr</span>&nbsp;<span class="op" id="4388264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4388267">if</span>&nbsp;<span class="ident" id="4388270">p</span><span class="op" id="4388271">.</span><span class="ident" id="4388272">trace</span>&nbsp;<span class="op" id="4388278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4388282">defer</span>&nbsp;<span class="ident" id="4388288">un</span><span class="op" id="4388290">(</span><span class="ident" id="4388291">trace</span><span class="op" id="4388296">(</span><span class="ident" id="4388297">p</span><span class="op" id="4388298">,</span>&nbsp;<span class="string" id="4388300">&#34;LiteralValue&#34;</span><span class="op" id="4388314">)</span><span class="op" id="4388315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4388318">}</span><br>
<span class="lineno">1325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4388322">lbrace</span>&nbsp;<span class="op" id="4388329">:=</span>&nbsp;<span class="ident" id="4388332">p</span><span class="op" id="4388333">.</span><span class="ident" id="4388334">expect</span><span class="op" id="4388340">(</span><span class="ident" id="4388341">token</span><span class="op" id="4388346">.</span><span class="ident" id="4388347">LBRACE</span><span class="op" id="4388353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4388356">var</span>&nbsp;<span class="ident" id="4388360">elts</span>&nbsp;<span class="op" id="4388365">[</span><span class="op" id="4388366">]</span><span class="ident" id="4388367">ast</span><span class="op" id="4388370">.</span><span class="ident" id="4388371">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4388377">p</span><span class="op" id="4388378">.</span><span class="ident" id="4388379">exprLev</span><span class="op" id="4388386">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4388390">if</span>&nbsp;<span class="ident" id="4388393">p</span><span class="op" id="4388394">.</span><span class="ident" id="4388395">tok</span>&nbsp;<span class="op" id="4388399">!=</span>&nbsp;<span class="ident" id="4388402">token</span><span class="op" id="4388407">.</span><span class="ident" id="4388408">RBRACE</span>&nbsp;<span class="op" id="4388415">{</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4388419">elts</span>&nbsp;<span class="op" id="4388424">=</span>&nbsp;<span class="ident" id="4388426">p</span><span class="op" id="4388427">.</span><span class="ident" id="4388428">parseElementList</span><span class="op" id="4388444">(</span><span class="op" id="4388445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4388448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4388451">p</span><span class="op" id="4388452">.</span><span class="ident" id="4388453">exprLev</span><span class="op" id="4388460">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4388464">rbrace</span>&nbsp;<span class="op" id="4388471">:=</span>&nbsp;<span class="ident" id="4388474">p</span><span class="op" id="4388475">.</span><span class="ident" id="4388476">expectClosing</span><span class="op" id="4388489">(</span><span class="ident" id="4388490">token</span><span class="op" id="4388495">.</span><span class="ident" id="4388496">RBRACE</span><span class="op" id="4388502">,</span>&nbsp;<span class="string" id="4388504">&#34;composite&nbsp;literal&#34;</span><span class="op" id="4388523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4388526">return</span>&nbsp;<span class="op" id="4388533">&amp;</span><span class="ident" id="4388534">ast</span><span class="op" id="4388537">.</span><span class="ident" id="4388538">CompositeLit</span><span class="op" id="4388550">{</span><span class="ident" id="4388551">Type</span><span class="op" id="4388555">:</span>&nbsp;<span class="ident" id="4388557">typ</span><span class="op" id="4388560">,</span>&nbsp;<span class="ident" id="4388562">Lbrace</span><span class="op" id="4388568">:</span>&nbsp;<span class="ident" id="4388570">lbrace</span><span class="op" id="4388576">,</span>&nbsp;<span class="ident" id="4388578">Elts</span><span class="op" id="4388582">:</span>&nbsp;<span class="ident" id="4388584">elts</span><span class="op" id="4388588">,</span>&nbsp;<span class="ident" id="4388590">Rbrace</span><span class="op" id="4388596">:</span>&nbsp;<span class="ident" id="4388598">rbrace</span><span class="op" id="4388604">}</span><br>
<span class="lineno">1335</span><span class="op" id="4388606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4388609">//&nbsp;checkExpr&nbsp;checks&nbsp;that&nbsp;x&nbsp;is&nbsp;an&nbsp;expression&nbsp;(and&nbsp;not&nbsp;a&nbsp;type).</span><br>
<span class="lineno"></span><span class="keyword" id="4388671">func</span>&nbsp;<span class="op" id="4388676">(</span><span class="ident" id="4388677">p</span>&nbsp;<span class="op" id="4388679">*</span><span class="ident" id="4388680">parser</span><span class="op" id="4388686">)</span>&nbsp;<span class="ident" id="4388688">checkExpr</span><span class="op" id="4388697">(</span><span class="ident" id="4388698">x</span>&nbsp;<span class="ident" id="4388700">ast</span><span class="op" id="4388703">.</span><span class="ident" id="4388704">Expr</span><span class="op" id="4388708">)</span>&nbsp;<span class="ident" id="4388710">ast</span><span class="op" id="4388713">.</span><span class="ident" id="4388714">Expr</span>&nbsp;<span class="op" id="4388719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4388722">switch</span>&nbsp;<span class="ident" id="4388729">unparen</span><span class="op" id="4388736">(</span><span class="ident" id="4388737">x</span><span class="op" id="4388738">)</span><span class="op" id="4388739">.</span><span class="op" id="4388740">(</span><span class="keyword" id="4388741">type</span><span class="op" id="4388745">)</span>&nbsp;<span class="op" id="4388747">{</span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4388750">case</span>&nbsp;<span class="op" id="4388755">*</span><span class="ident" id="4388756">ast</span><span class="op" id="4388759">.</span><span class="ident" id="4388760">BadExpr</span><span class="op" id="4388767">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4388770">case</span>&nbsp;<span class="op" id="4388775">*</span><span class="ident" id="4388776">ast</span><span class="op" id="4388779">.</span><span class="ident" id="4388780">Ident</span><span class="op" id="4388785">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4388788">case</span>&nbsp;<span class="op" id="4388793">*</span><span class="ident" id="4388794">ast</span><span class="op" id="4388797">.</span><span class="ident" id="4388798">BasicLit</span><span class="op" id="4388806">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4388809">case</span>&nbsp;<span class="op" id="4388814">*</span><span class="ident" id="4388815">ast</span><span class="op" id="4388818">.</span><span class="ident" id="4388819">FuncLit</span><span class="op" id="4388826">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4388829">case</span>&nbsp;<span class="op" id="4388834">*</span><span class="ident" id="4388835">ast</span><span class="op" id="4388838">.</span><span class="ident" id="4388839">CompositeLit</span><span class="op" id="4388851">:</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4388854">case</span>&nbsp;<span class="op" id="4388859">*</span><span class="ident" id="4388860">ast</span><span class="op" id="4388863">.</span><span class="ident" id="4388864">ParenExpr</span><span class="op" id="4388873">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4388877">panic</span><span class="op" id="4388882">(</span><span class="string" id="4388883">&#34;unreachable&#34;</span><span class="op" id="4388896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4388899">case</span>&nbsp;<span class="op" id="4388904">*</span><span class="ident" id="4388905">ast</span><span class="op" id="4388908">.</span><span class="ident" id="4388909">SelectorExpr</span><span class="op" id="4388921">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4388924">case</span>&nbsp;<span class="op" id="4388929">*</span><span class="ident" id="4388930">ast</span><span class="op" id="4388933">.</span><span class="ident" id="4388934">IndexExpr</span><span class="op" id="4388943">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4388946">case</span>&nbsp;<span class="op" id="4388951">*</span><span class="ident" id="4388952">ast</span><span class="op" id="4388955">.</span><span class="ident" id="4388956">SliceExpr</span><span class="op" id="4388965">:</span><br>
<span class="lineno">1350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4388968">case</span>&nbsp;<span class="op" id="4388973">*</span><span class="ident" id="4388974">ast</span><span class="op" id="4388977">.</span><span class="ident" id="4388978">TypeAssertExpr</span><span class="op" id="4388992">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4388996">//&nbsp;If&nbsp;t.Type&nbsp;==&nbsp;nil&nbsp;we&nbsp;have&nbsp;a&nbsp;type&nbsp;assertion&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4389055">//&nbsp;y.(type),&nbsp;which&nbsp;is&nbsp;only&nbsp;allowed&nbsp;in&nbsp;type&nbsp;switch&nbsp;expressions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4389120">//&nbsp;It&#39;s&nbsp;hard&nbsp;to&nbsp;exclude&nbsp;those&nbsp;but&nbsp;for&nbsp;the&nbsp;case&nbsp;where&nbsp;we&nbsp;are&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4389185">//&nbsp;a&nbsp;type&nbsp;switch.&nbsp;Instead&nbsp;be&nbsp;lenient&nbsp;and&nbsp;test&nbsp;this&nbsp;in&nbsp;the&nbsp;type</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4389250">//&nbsp;checker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4389263">case</span>&nbsp;<span class="op" id="4389268">*</span><span class="ident" id="4389269">ast</span><span class="op" id="4389272">.</span><span class="ident" id="4389273">CallExpr</span><span class="op" id="4389281">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4389284">case</span>&nbsp;<span class="op" id="4389289">*</span><span class="ident" id="4389290">ast</span><span class="op" id="4389293">.</span><span class="ident" id="4389294">StarExpr</span><span class="op" id="4389302">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4389305">case</span>&nbsp;<span class="op" id="4389310">*</span><span class="ident" id="4389311">ast</span><span class="op" id="4389314">.</span><span class="ident" id="4389315">UnaryExpr</span><span class="op" id="4389324">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4389327">case</span>&nbsp;<span class="op" id="4389332">*</span><span class="ident" id="4389333">ast</span><span class="op" id="4389336">.</span><span class="ident" id="4389337">BinaryExpr</span><span class="op" id="4389347">:</span><br>
<span class="lineno">1360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4389350">default</span><span class="op" id="4389357">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4389361">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;proper&nbsp;expressions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4389409">p</span><span class="op" id="4389410">.</span><span class="ident" id="4389411">errorExpected</span><span class="op" id="4389424">(</span><span class="ident" id="4389425">x</span><span class="op" id="4389426">.</span><span class="ident" id="4389427">Pos</span><span class="op" id="4389430">(</span><span class="op" id="4389431">)</span><span class="op" id="4389432">,</span>&nbsp;<span class="string" id="4389434">&#34;expression&#34;</span><span class="op" id="4389446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4389450">x</span>&nbsp;<span class="op" id="4389452">=</span>&nbsp;<span class="op" id="4389454">&amp;</span><span class="ident" id="4389455">ast</span><span class="op" id="4389458">.</span><span class="ident" id="4389459">BadExpr</span><span class="op" id="4389466">{</span><span class="ident" id="4389467">From</span><span class="op" id="4389471">:</span>&nbsp;<span class="ident" id="4389473">x</span><span class="op" id="4389474">.</span><span class="ident" id="4389475">Pos</span><span class="op" id="4389478">(</span><span class="op" id="4389479">)</span><span class="op" id="4389480">,</span>&nbsp;<span class="ident" id="4389482">To</span><span class="op" id="4389484">:</span>&nbsp;<span class="ident" id="4389486">p</span><span class="op" id="4389487">.</span><span class="ident" id="4389488">safePos</span><span class="op" id="4389495">(</span><span class="ident" id="4389496">x</span><span class="op" id="4389497">.</span><span class="ident" id="4389498">End</span><span class="op" id="4389501">(</span><span class="op" id="4389502">)</span><span class="op" id="4389503">)</span><span class="op" id="4389504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4389507">}</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4389510">return</span>&nbsp;<span class="ident" id="4389517">x</span><br>
<span class="lineno"></span><span class="op" id="4389519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4389522">//&nbsp;isTypeName&nbsp;returns&nbsp;true&nbsp;iff&nbsp;x&nbsp;is&nbsp;a&nbsp;(qualified)&nbsp;TypeName.</span><br>
<span class="lineno"></span><span class="keyword" id="4389582">func</span>&nbsp;<span class="ident" id="4389587">isTypeName</span><span class="op" id="4389597">(</span><span class="ident" id="4389598">x</span>&nbsp;<span class="ident" id="4389600">ast</span><span class="op" id="4389603">.</span><span class="ident" id="4389604">Expr</span><span class="op" id="4389608">)</span>&nbsp;<span class="builtintype" id="4389610">bool</span>&nbsp;<span class="op" id="4389615">{</span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4389618">switch</span>&nbsp;<span class="ident" id="4389625">t</span>&nbsp;<span class="op" id="4389627">:=</span>&nbsp;<span class="ident" id="4389630">x</span><span class="op" id="4389631">.</span><span class="op" id="4389632">(</span><span class="keyword" id="4389633">type</span><span class="op" id="4389637">)</span>&nbsp;<span class="op" id="4389639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4389642">case</span>&nbsp;<span class="op" id="4389647">*</span><span class="ident" id="4389648">ast</span><span class="op" id="4389651">.</span><span class="ident" id="4389652">BadExpr</span><span class="op" id="4389659">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4389662">case</span>&nbsp;<span class="op" id="4389667">*</span><span class="ident" id="4389668">ast</span><span class="op" id="4389671">.</span><span class="ident" id="4389672">Ident</span><span class="op" id="4389677">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4389680">case</span>&nbsp;<span class="op" id="4389685">*</span><span class="ident" id="4389686">ast</span><span class="op" id="4389689">.</span><span class="ident" id="4389690">SelectorExpr</span><span class="op" id="4389702">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4389706">_</span><span class="op" id="4389707">,</span>&nbsp;<span class="ident" id="4389709">isIdent</span>&nbsp;<span class="op" id="4389717">:=</span>&nbsp;<span class="ident" id="4389720">t</span><span class="op" id="4389721">.</span><span class="ident" id="4389722">X</span><span class="op" id="4389723">.</span><span class="op" id="4389724">(</span><span class="op" id="4389725">*</span><span class="ident" id="4389726">ast</span><span class="op" id="4389729">.</span><span class="ident" id="4389730">Ident</span><span class="op" id="4389735">)</span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4389739">return</span>&nbsp;<span class="ident" id="4389746">isIdent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4389755">default</span><span class="op" id="4389762">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4389766">return</span>&nbsp;<span class="builtintype" id="4389773">false</span>&nbsp;<span class="comment" id="4389779">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;type&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4389818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4389821">return</span>&nbsp;<span class="builtintype" id="4389828">true</span><br>
<span class="lineno">1380</span><span class="op" id="4389833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4389836">//&nbsp;isLiteralType&nbsp;returns&nbsp;true&nbsp;iff&nbsp;x&nbsp;is&nbsp;a&nbsp;legal&nbsp;composite&nbsp;literal&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="4389907">func</span>&nbsp;<span class="ident" id="4389912">isLiteralType</span><span class="op" id="4389925">(</span><span class="ident" id="4389926">x</span>&nbsp;<span class="ident" id="4389928">ast</span><span class="op" id="4389931">.</span><span class="ident" id="4389932">Expr</span><span class="op" id="4389936">)</span>&nbsp;<span class="builtintype" id="4389938">bool</span>&nbsp;<span class="op" id="4389943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4389946">switch</span>&nbsp;<span class="ident" id="4389953">t</span>&nbsp;<span class="op" id="4389955">:=</span>&nbsp;<span class="ident" id="4389958">x</span><span class="op" id="4389959">.</span><span class="op" id="4389960">(</span><span class="keyword" id="4389961">type</span><span class="op" id="4389965">)</span>&nbsp;<span class="op" id="4389967">{</span><br>
<span class="lineno">1385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4389970">case</span>&nbsp;<span class="op" id="4389975">*</span><span class="ident" id="4389976">ast</span><span class="op" id="4389979">.</span><span class="ident" id="4389980">BadExpr</span><span class="op" id="4389987">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4389990">case</span>&nbsp;<span class="op" id="4389995">*</span><span class="ident" id="4389996">ast</span><span class="op" id="4389999">.</span><span class="ident" id="4390000">Ident</span><span class="op" id="4390005">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4390008">case</span>&nbsp;<span class="op" id="4390013">*</span><span class="ident" id="4390014">ast</span><span class="op" id="4390017">.</span><span class="ident" id="4390018">SelectorExpr</span><span class="op" id="4390030">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4390034">_</span><span class="op" id="4390035">,</span>&nbsp;<span class="ident" id="4390037">isIdent</span>&nbsp;<span class="op" id="4390045">:=</span>&nbsp;<span class="ident" id="4390048">t</span><span class="op" id="4390049">.</span><span class="ident" id="4390050">X</span><span class="op" id="4390051">.</span><span class="op" id="4390052">(</span><span class="op" id="4390053">*</span><span class="ident" id="4390054">ast</span><span class="op" id="4390057">.</span><span class="ident" id="4390058">Ident</span><span class="op" id="4390063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4390067">return</span>&nbsp;<span class="ident" id="4390074">isIdent</span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4390083">case</span>&nbsp;<span class="op" id="4390088">*</span><span class="ident" id="4390089">ast</span><span class="op" id="4390092">.</span><span class="ident" id="4390093">ArrayType</span><span class="op" id="4390102">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4390105">case</span>&nbsp;<span class="op" id="4390110">*</span><span class="ident" id="4390111">ast</span><span class="op" id="4390114">.</span><span class="ident" id="4390115">StructType</span><span class="op" id="4390125">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4390128">case</span>&nbsp;<span class="op" id="4390133">*</span><span class="ident" id="4390134">ast</span><span class="op" id="4390137">.</span><span class="ident" id="4390138">MapType</span><span class="op" id="4390145">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4390148">default</span><span class="op" id="4390155">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4390159">return</span>&nbsp;<span class="builtintype" id="4390166">false</span>&nbsp;<span class="comment" id="4390172">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;legal&nbsp;composite&nbsp;literal&nbsp;types</span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4390230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4390233">return</span>&nbsp;<span class="builtintype" id="4390240">true</span><br>
<span class="lineno"></span><span class="op" id="4390245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4390248">//&nbsp;If&nbsp;x&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;*T,&nbsp;deref&nbsp;returns&nbsp;T,&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;x.</span><br>
<span class="lineno">1400</span><span class="keyword" id="4390316">func</span>&nbsp;<span class="ident" id="4390321">deref</span><span class="op" id="4390326">(</span><span class="ident" id="4390327">x</span>&nbsp;<span class="ident" id="4390329">ast</span><span class="op" id="4390332">.</span><span class="ident" id="4390333">Expr</span><span class="op" id="4390337">)</span>&nbsp;<span class="ident" id="4390339">ast</span><span class="op" id="4390342">.</span><span class="ident" id="4390343">Expr</span>&nbsp;<span class="op" id="4390348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4390351">if</span>&nbsp;<span class="ident" id="4390354">p</span><span class="op" id="4390355">,</span>&nbsp;<span class="ident" id="4390357">isPtr</span>&nbsp;<span class="op" id="4390363">:=</span>&nbsp;<span class="ident" id="4390366">x</span><span class="op" id="4390367">.</span><span class="op" id="4390368">(</span><span class="op" id="4390369">*</span><span class="ident" id="4390370">ast</span><span class="op" id="4390373">.</span><span class="ident" id="4390374">StarExpr</span><span class="op" id="4390382">)</span><span class="op" id="4390383">;</span>&nbsp;<span class="ident" id="4390385">isPtr</span>&nbsp;<span class="op" id="4390391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4390395">x</span>&nbsp;<span class="op" id="4390397">=</span>&nbsp;<span class="ident" id="4390399">p</span><span class="op" id="4390400">.</span><span class="ident" id="4390401">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4390404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4390407">return</span>&nbsp;<span class="ident" id="4390414">x</span><br>
<span class="lineno">1405</span><span class="op" id="4390416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4390419">//&nbsp;If&nbsp;x&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;(T),&nbsp;unparen&nbsp;returns&nbsp;unparen(T),&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="4390499">func</span>&nbsp;<span class="ident" id="4390504">unparen</span><span class="op" id="4390511">(</span><span class="ident" id="4390512">x</span>&nbsp;<span class="ident" id="4390514">ast</span><span class="op" id="4390517">.</span><span class="ident" id="4390518">Expr</span><span class="op" id="4390522">)</span>&nbsp;<span class="ident" id="4390524">ast</span><span class="op" id="4390527">.</span><span class="ident" id="4390528">Expr</span>&nbsp;<span class="op" id="4390533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4390536">if</span>&nbsp;<span class="ident" id="4390539">p</span><span class="op" id="4390540">,</span>&nbsp;<span class="ident" id="4390542">isParen</span>&nbsp;<span class="op" id="4390550">:=</span>&nbsp;<span class="ident" id="4390553">x</span><span class="op" id="4390554">.</span><span class="op" id="4390555">(</span><span class="op" id="4390556">*</span><span class="ident" id="4390557">ast</span><span class="op" id="4390560">.</span><span class="ident" id="4390561">ParenExpr</span><span class="op" id="4390570">)</span><span class="op" id="4390571">;</span>&nbsp;<span class="ident" id="4390573">isParen</span>&nbsp;<span class="op" id="4390581">{</span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4390585">x</span>&nbsp;<span class="op" id="4390587">=</span>&nbsp;<span class="ident" id="4390589">unparen</span><span class="op" id="4390596">(</span><span class="ident" id="4390597">p</span><span class="op" id="4390598">.</span><span class="ident" id="4390599">X</span><span class="op" id="4390600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4390603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4390606">return</span>&nbsp;<span class="ident" id="4390613">x</span><br>
<span class="lineno"></span><span class="op" id="4390615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1415</span><span class="comment" id="4390618">//&nbsp;checkExprOrType&nbsp;checks&nbsp;that&nbsp;x&nbsp;is&nbsp;an&nbsp;expression&nbsp;or&nbsp;a&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="4390678">//&nbsp;(and&nbsp;not&nbsp;a&nbsp;raw&nbsp;type&nbsp;such&nbsp;as&nbsp;[...]T).</span><br>
<span class="lineno"></span><span class="comment" id="4390718">//</span><br>
<span class="lineno"></span><span class="keyword" id="4390721">func</span>&nbsp;<span class="op" id="4390726">(</span><span class="ident" id="4390727">p</span>&nbsp;<span class="op" id="4390729">*</span><span class="ident" id="4390730">parser</span><span class="op" id="4390736">)</span>&nbsp;<span class="ident" id="4390738">checkExprOrType</span><span class="op" id="4390753">(</span><span class="ident" id="4390754">x</span>&nbsp;<span class="ident" id="4390756">ast</span><span class="op" id="4390759">.</span><span class="ident" id="4390760">Expr</span><span class="op" id="4390764">)</span>&nbsp;<span class="ident" id="4390766">ast</span><span class="op" id="4390769">.</span><span class="ident" id="4390770">Expr</span>&nbsp;<span class="op" id="4390775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4390778">switch</span>&nbsp;<span class="ident" id="4390785">t</span>&nbsp;<span class="op" id="4390787">:=</span>&nbsp;<span class="ident" id="4390790">unparen</span><span class="op" id="4390797">(</span><span class="ident" id="4390798">x</span><span class="op" id="4390799">)</span><span class="op" id="4390800">.</span><span class="op" id="4390801">(</span><span class="keyword" id="4390802">type</span><span class="op" id="4390806">)</span>&nbsp;<span class="op" id="4390808">{</span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4390811">case</span>&nbsp;<span class="op" id="4390816">*</span><span class="ident" id="4390817">ast</span><span class="op" id="4390820">.</span><span class="ident" id="4390821">ParenExpr</span><span class="op" id="4390830">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4390834">panic</span><span class="op" id="4390839">(</span><span class="string" id="4390840">&#34;unreachable&#34;</span><span class="op" id="4390853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4390856">case</span>&nbsp;<span class="op" id="4390861">*</span><span class="ident" id="4390862">ast</span><span class="op" id="4390865">.</span><span class="ident" id="4390866">UnaryExpr</span><span class="op" id="4390875">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4390878">case</span>&nbsp;<span class="op" id="4390883">*</span><span class="ident" id="4390884">ast</span><span class="op" id="4390887">.</span><span class="ident" id="4390888">ArrayType</span><span class="op" id="4390897">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4390901">if</span>&nbsp;<span class="builtinfunc" id="4390904">len</span><span class="op" id="4390907">,</span>&nbsp;<span class="ident" id="4390909">isEllipsis</span>&nbsp;<span class="op" id="4390920">:=</span>&nbsp;<span class="ident" id="4390923">t</span><span class="op" id="4390924">.</span><span class="ident" id="4390925">Len</span><span class="op" id="4390928">.</span><span class="op" id="4390929">(</span><span class="op" id="4390930">*</span><span class="ident" id="4390931">ast</span><span class="op" id="4390934">.</span><span class="ident" id="4390935">Ellipsis</span><span class="op" id="4390943">)</span><span class="op" id="4390944">;</span>&nbsp;<span class="ident" id="4390946">isEllipsis</span>&nbsp;<span class="op" id="4390957">{</span><br>
<span class="lineno">1425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4390962">p</span><span class="op" id="4390963">.</span><span class="builtintype" id="4390964">error</span><span class="op" id="4390969">(</span><span class="builtinfunc" id="4390970">len</span><span class="op" id="4390973">.</span><span class="ident" id="4390974">Pos</span><span class="op" id="4390977">(</span><span class="op" id="4390978">)</span><span class="op" id="4390979">,</span>&nbsp;<span class="string" id="4390981">&#34;expected&nbsp;array&nbsp;length,&nbsp;found&nbsp;&#39;...&#39;&#34;</span><span class="op" id="4391017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4391022">x</span>&nbsp;<span class="op" id="4391024">=</span>&nbsp;<span class="op" id="4391026">&amp;</span><span class="ident" id="4391027">ast</span><span class="op" id="4391030">.</span><span class="ident" id="4391031">BadExpr</span><span class="op" id="4391038">{</span><span class="ident" id="4391039">From</span><span class="op" id="4391043">:</span>&nbsp;<span class="ident" id="4391045">x</span><span class="op" id="4391046">.</span><span class="ident" id="4391047">Pos</span><span class="op" id="4391050">(</span><span class="op" id="4391051">)</span><span class="op" id="4391052">,</span>&nbsp;<span class="ident" id="4391054">To</span><span class="op" id="4391056">:</span>&nbsp;<span class="ident" id="4391058">p</span><span class="op" id="4391059">.</span><span class="ident" id="4391060">safePos</span><span class="op" id="4391067">(</span><span class="ident" id="4391068">x</span><span class="op" id="4391069">.</span><span class="ident" id="4391070">End</span><span class="op" id="4391073">(</span><span class="op" id="4391074">)</span><span class="op" id="4391075">)</span><span class="op" id="4391076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4391080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4391083">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4391087">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;expressions&nbsp;or&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4391132">return</span>&nbsp;<span class="ident" id="4391139">x</span><br>
<span class="lineno"></span><span class="op" id="4391141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4391144">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">1435</span><span class="keyword" id="4391214">func</span>&nbsp;<span class="op" id="4391219">(</span><span class="ident" id="4391220">p</span>&nbsp;<span class="op" id="4391222">*</span><span class="ident" id="4391223">parser</span><span class="op" id="4391229">)</span>&nbsp;<span class="ident" id="4391231">parsePrimaryExpr</span><span class="op" id="4391247">(</span><span class="ident" id="4391248">lhs</span>&nbsp;<span class="builtintype" id="4391252">bool</span><span class="op" id="4391256">)</span>&nbsp;<span class="ident" id="4391258">ast</span><span class="op" id="4391261">.</span><span class="ident" id="4391262">Expr</span>&nbsp;<span class="op" id="4391267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4391270">if</span>&nbsp;<span class="ident" id="4391273">p</span><span class="op" id="4391274">.</span><span class="ident" id="4391275">trace</span>&nbsp;<span class="op" id="4391281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4391285">defer</span>&nbsp;<span class="ident" id="4391291">un</span><span class="op" id="4391293">(</span><span class="ident" id="4391294">trace</span><span class="op" id="4391299">(</span><span class="ident" id="4391300">p</span><span class="op" id="4391301">,</span>&nbsp;<span class="string" id="4391303">&#34;PrimaryExpr&#34;</span><span class="op" id="4391316">)</span><span class="op" id="4391317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4391320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4391324">x</span>&nbsp;<span class="op" id="4391326">:=</span>&nbsp;<span class="ident" id="4391329">p</span><span class="op" id="4391330">.</span><span class="ident" id="4391331">parseOperand</span><span class="op" id="4391343">(</span><span class="ident" id="4391344">lhs</span><span class="op" id="4391347">)</span><br>
<span class="lineno"></span><span class="ident" id="4391349">L</span><span class="op" id="4391350">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4391353">for</span>&nbsp;<span class="op" id="4391357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4391361">switch</span>&nbsp;<span class="ident" id="4391368">p</span><span class="op" id="4391369">.</span><span class="ident" id="4391370">tok</span>&nbsp;<span class="op" id="4391374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4391378">case</span>&nbsp;<span class="ident" id="4391383">token</span><span class="op" id="4391388">.</span><span class="ident" id="4391389">PERIOD</span><span class="op" id="4391395">:</span><br>
<span class="lineno">1445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4391400">p</span><span class="op" id="4391401">.</span><span class="ident" id="4391402">next</span><span class="op" id="4391406">(</span><span class="op" id="4391407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4391412">if</span>&nbsp;<span class="ident" id="4391415">lhs</span>&nbsp;<span class="op" id="4391419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4391425">p</span><span class="op" id="4391426">.</span><span class="ident" id="4391427">resolve</span><span class="op" id="4391434">(</span><span class="ident" id="4391435">x</span><span class="op" id="4391436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4391441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4391446">switch</span>&nbsp;<span class="ident" id="4391453">p</span><span class="op" id="4391454">.</span><span class="ident" id="4391455">tok</span>&nbsp;<span class="op" id="4391459">{</span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4391464">case</span>&nbsp;<span class="ident" id="4391469">token</span><span class="op" id="4391474">.</span><span class="ident" id="4391475">IDENT</span><span class="op" id="4391480">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4391486">x</span>&nbsp;<span class="op" id="4391488">=</span>&nbsp;<span class="ident" id="4391490">p</span><span class="op" id="4391491">.</span><span class="ident" id="4391492">parseSelector</span><span class="op" id="4391505">(</span><span class="ident" id="4391506">p</span><span class="op" id="4391507">.</span><span class="ident" id="4391508">checkExprOrType</span><span class="op" id="4391523">(</span><span class="ident" id="4391524">x</span><span class="op" id="4391525">)</span><span class="op" id="4391526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4391531">case</span>&nbsp;<span class="ident" id="4391536">token</span><span class="op" id="4391541">.</span><span class="ident" id="4391542">LPAREN</span><span class="op" id="4391548">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4391554">x</span>&nbsp;<span class="op" id="4391556">=</span>&nbsp;<span class="ident" id="4391558">p</span><span class="op" id="4391559">.</span><span class="ident" id="4391560">parseTypeAssertion</span><span class="op" id="4391578">(</span><span class="ident" id="4391579">p</span><span class="op" id="4391580">.</span><span class="ident" id="4391581">checkExpr</span><span class="op" id="4391590">(</span><span class="ident" id="4391591">x</span><span class="op" id="4391592">)</span><span class="op" id="4391593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4391598">default</span><span class="op" id="4391605">:</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4391611">pos</span>&nbsp;<span class="op" id="4391615">:=</span>&nbsp;<span class="ident" id="4391618">p</span><span class="op" id="4391619">.</span><span class="ident" id="4391620">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4391628">p</span><span class="op" id="4391629">.</span><span class="ident" id="4391630">errorExpected</span><span class="op" id="4391643">(</span><span class="ident" id="4391644">pos</span><span class="op" id="4391647">,</span>&nbsp;<span class="string" id="4391649">&#34;selector&nbsp;or&nbsp;type&nbsp;assertion&#34;</span><span class="op" id="4391677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4391683">p</span><span class="op" id="4391684">.</span><span class="ident" id="4391685">next</span><span class="op" id="4391689">(</span><span class="op" id="4391690">)</span>&nbsp;<span class="comment" id="4391692">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4391713">x</span>&nbsp;<span class="op" id="4391715">=</span>&nbsp;<span class="op" id="4391717">&amp;</span><span class="ident" id="4391718">ast</span><span class="op" id="4391721">.</span><span class="ident" id="4391722">BadExpr</span><span class="op" id="4391729">{</span><span class="ident" id="4391730">From</span><span class="op" id="4391734">:</span>&nbsp;<span class="ident" id="4391736">pos</span><span class="op" id="4391739">,</span>&nbsp;<span class="ident" id="4391741">To</span><span class="op" id="4391743">:</span>&nbsp;<span class="ident" id="4391745">p</span><span class="op" id="4391746">.</span><span class="ident" id="4391747">pos</span><span class="op" id="4391750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4391755">}</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4391759">case</span>&nbsp;<span class="ident" id="4391764">token</span><span class="op" id="4391769">.</span><span class="ident" id="4391770">LBRACK</span><span class="op" id="4391776">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4391781">if</span>&nbsp;<span class="ident" id="4391784">lhs</span>&nbsp;<span class="op" id="4391788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4391794">p</span><span class="op" id="4391795">.</span><span class="ident" id="4391796">resolve</span><span class="op" id="4391803">(</span><span class="ident" id="4391804">x</span><span class="op" id="4391805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4391810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4391815">x</span>&nbsp;<span class="op" id="4391817">=</span>&nbsp;<span class="ident" id="4391819">p</span><span class="op" id="4391820">.</span><span class="ident" id="4391821">parseIndexOrSlice</span><span class="op" id="4391838">(</span><span class="ident" id="4391839">p</span><span class="op" id="4391840">.</span><span class="ident" id="4391841">checkExpr</span><span class="op" id="4391850">(</span><span class="ident" id="4391851">x</span><span class="op" id="4391852">)</span><span class="op" id="4391853">)</span><br>
<span class="lineno">1465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4391857">case</span>&nbsp;<span class="ident" id="4391862">token</span><span class="op" id="4391867">.</span><span class="ident" id="4391868">LPAREN</span><span class="op" id="4391874">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4391879">if</span>&nbsp;<span class="ident" id="4391882">lhs</span>&nbsp;<span class="op" id="4391886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4391892">p</span><span class="op" id="4391893">.</span><span class="ident" id="4391894">resolve</span><span class="op" id="4391901">(</span><span class="ident" id="4391902">x</span><span class="op" id="4391903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4391908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4391913">x</span>&nbsp;<span class="op" id="4391915">=</span>&nbsp;<span class="ident" id="4391917">p</span><span class="op" id="4391918">.</span><span class="ident" id="4391919">parseCallOrConversion</span><span class="op" id="4391940">(</span><span class="ident" id="4391941">p</span><span class="op" id="4391942">.</span><span class="ident" id="4391943">checkExprOrType</span><span class="op" id="4391958">(</span><span class="ident" id="4391959">x</span><span class="op" id="4391960">)</span><span class="op" id="4391961">)</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4391965">case</span>&nbsp;<span class="ident" id="4391970">token</span><span class="op" id="4391975">.</span><span class="ident" id="4391976">LBRACE</span><span class="op" id="4391982">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4391987">if</span>&nbsp;<span class="ident" id="4391990">isLiteralType</span><span class="op" id="4392003">(</span><span class="ident" id="4392004">x</span><span class="op" id="4392005">)</span>&nbsp;<span class="op" id="4392007">&amp;&amp;</span>&nbsp;<span class="op" id="4392010">(</span><span class="ident" id="4392011">p</span><span class="op" id="4392012">.</span><span class="ident" id="4392013">exprLev</span>&nbsp;<span class="op" id="4392021">&gt;=</span>&nbsp;<span class="num" id="4392024">0</span>&nbsp;<span class="op" id="4392026">||</span>&nbsp;<span class="op" id="4392029">!</span><span class="ident" id="4392030">isTypeName</span><span class="op" id="4392040">(</span><span class="ident" id="4392041">x</span><span class="op" id="4392042">)</span><span class="op" id="4392043">)</span>&nbsp;<span class="op" id="4392045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4392051">if</span>&nbsp;<span class="ident" id="4392054">lhs</span>&nbsp;<span class="op" id="4392058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4392065">p</span><span class="op" id="4392066">.</span><span class="ident" id="4392067">resolve</span><span class="op" id="4392074">(</span><span class="ident" id="4392075">x</span><span class="op" id="4392076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4392082">}</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4392088">x</span>&nbsp;<span class="op" id="4392090">=</span>&nbsp;<span class="ident" id="4392092">p</span><span class="op" id="4392093">.</span><span class="ident" id="4392094">parseLiteralValue</span><span class="op" id="4392111">(</span><span class="ident" id="4392112">x</span><span class="op" id="4392113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4392118">}</span>&nbsp;<span class="keyword" id="4392120">else</span>&nbsp;<span class="op" id="4392125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4392131">break</span>&nbsp;<span class="ident" id="4392137">L</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4392142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4392146">default</span><span class="op" id="4392153">:</span><br>
<span class="lineno">1480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4392158">break</span>&nbsp;<span class="ident" id="4392164">L</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4392168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4392172">lhs</span>&nbsp;<span class="op" id="4392176">=</span>&nbsp;<span class="builtintype" id="4392178">false</span>&nbsp;<span class="comment" id="4392184">//&nbsp;no&nbsp;need&nbsp;to&nbsp;try&nbsp;to&nbsp;resolve&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4392220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4392224">return</span>&nbsp;<span class="ident" id="4392231">x</span><br>
<span class="lineno"></span><span class="op" id="4392233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4392236">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="4392306">func</span>&nbsp;<span class="op" id="4392311">(</span><span class="ident" id="4392312">p</span>&nbsp;<span class="op" id="4392314">*</span><span class="ident" id="4392315">parser</span><span class="op" id="4392321">)</span>&nbsp;<span class="ident" id="4392323">parseUnaryExpr</span><span class="op" id="4392337">(</span><span class="ident" id="4392338">lhs</span>&nbsp;<span class="builtintype" id="4392342">bool</span><span class="op" id="4392346">)</span>&nbsp;<span class="ident" id="4392348">ast</span><span class="op" id="4392351">.</span><span class="ident" id="4392352">Expr</span>&nbsp;<span class="op" id="4392357">{</span><br>
<span class="lineno">1490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4392360">if</span>&nbsp;<span class="ident" id="4392363">p</span><span class="op" id="4392364">.</span><span class="ident" id="4392365">trace</span>&nbsp;<span class="op" id="4392371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4392375">defer</span>&nbsp;<span class="ident" id="4392381">un</span><span class="op" id="4392383">(</span><span class="ident" id="4392384">trace</span><span class="op" id="4392389">(</span><span class="ident" id="4392390">p</span><span class="op" id="4392391">,</span>&nbsp;<span class="string" id="4392393">&#34;UnaryExpr&#34;</span><span class="op" id="4392404">)</span><span class="op" id="4392405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4392408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4392412">switch</span>&nbsp;<span class="ident" id="4392419">p</span><span class="op" id="4392420">.</span><span class="ident" id="4392421">tok</span>&nbsp;<span class="op" id="4392425">{</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4392428">case</span>&nbsp;<span class="ident" id="4392433">token</span><span class="op" id="4392438">.</span><span class="ident" id="4392439">ADD</span><span class="op" id="4392442">,</span>&nbsp;<span class="ident" id="4392444">token</span><span class="op" id="4392449">.</span><span class="ident" id="4392450">SUB</span><span class="op" id="4392453">,</span>&nbsp;<span class="ident" id="4392455">token</span><span class="op" id="4392460">.</span><span class="ident" id="4392461">NOT</span><span class="op" id="4392464">,</span>&nbsp;<span class="ident" id="4392466">token</span><span class="op" id="4392471">.</span><span class="ident" id="4392472">XOR</span><span class="op" id="4392475">,</span>&nbsp;<span class="ident" id="4392477">token</span><span class="op" id="4392482">.</span><span class="ident" id="4392483">AND</span><span class="op" id="4392486">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4392490">pos</span><span class="op" id="4392493">,</span>&nbsp;<span class="ident" id="4392495">op</span>&nbsp;<span class="op" id="4392498">:=</span>&nbsp;<span class="ident" id="4392501">p</span><span class="op" id="4392502">.</span><span class="ident" id="4392503">pos</span><span class="op" id="4392506">,</span>&nbsp;<span class="ident" id="4392508">p</span><span class="op" id="4392509">.</span><span class="ident" id="4392510">tok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4392516">p</span><span class="op" id="4392517">.</span><span class="ident" id="4392518">next</span><span class="op" id="4392522">(</span><span class="op" id="4392523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4392527">x</span>&nbsp;<span class="op" id="4392529">:=</span>&nbsp;<span class="ident" id="4392532">p</span><span class="op" id="4392533">.</span><span class="ident" id="4392534">parseUnaryExpr</span><span class="op" id="4392548">(</span><span class="builtintype" id="4392549">false</span><span class="op" id="4392554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4392558">return</span>&nbsp;<span class="op" id="4392565">&amp;</span><span class="ident" id="4392566">ast</span><span class="op" id="4392569">.</span><span class="ident" id="4392570">UnaryExpr</span><span class="op" id="4392579">{</span><span class="ident" id="4392580">OpPos</span><span class="op" id="4392585">:</span>&nbsp;<span class="ident" id="4392587">pos</span><span class="op" id="4392590">,</span>&nbsp;<span class="ident" id="4392592">Op</span><span class="op" id="4392594">:</span>&nbsp;<span class="ident" id="4392596">op</span><span class="op" id="4392598">,</span>&nbsp;<span class="ident" id="4392600">X</span><span class="op" id="4392601">:</span>&nbsp;<span class="ident" id="4392603">p</span><span class="op" id="4392604">.</span><span class="ident" id="4392605">checkExpr</span><span class="op" id="4392614">(</span><span class="ident" id="4392615">x</span><span class="op" id="4392616">)</span><span class="op" id="4392617">}</span><br>
<span class="lineno">1500</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4392621">case</span>&nbsp;<span class="ident" id="4392626">token</span><span class="op" id="4392631">.</span><span class="ident" id="4392632">ARROW</span><span class="op" id="4392637">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4392641">//&nbsp;channel&nbsp;type&nbsp;or&nbsp;receive&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4392681">arrow</span>&nbsp;<span class="op" id="4392687">:=</span>&nbsp;<span class="ident" id="4392690">p</span><span class="op" id="4392691">.</span><span class="ident" id="4392692">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4392698">p</span><span class="op" id="4392699">.</span><span class="ident" id="4392700">next</span><span class="op" id="4392704">(</span><span class="op" id="4392705">)</span><br>
<span class="lineno">1505</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4392710">//&nbsp;If&nbsp;the&nbsp;next&nbsp;token&nbsp;is&nbsp;token.CHAN&nbsp;we&nbsp;still&nbsp;don&#39;t&nbsp;know&nbsp;if&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4392773">//&nbsp;is&nbsp;a&nbsp;channel&nbsp;type&nbsp;or&nbsp;a&nbsp;receive&nbsp;operation&nbsp;-&nbsp;we&nbsp;only&nbsp;know</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4392834">//&nbsp;once&nbsp;we&nbsp;have&nbsp;found&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;unary&nbsp;expression.&nbsp;There</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4392897">//&nbsp;are&nbsp;two&nbsp;cases:</span><br>
<span class="lineno">1510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4392917">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4392922">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;type&nbsp;&nbsp;=&gt;&nbsp;(&lt;-type)&nbsp;must&nbsp;be&nbsp;channel&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4392971">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;expr&nbsp;&nbsp;=&gt;&nbsp;&lt;-(expr)&nbsp;is&nbsp;a&nbsp;receive&nbsp;from&nbsp;an&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4393031">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4393036">//&nbsp;In&nbsp;the&nbsp;first&nbsp;case,&nbsp;the&nbsp;arrow&nbsp;must&nbsp;be&nbsp;re-associated&nbsp;with</span><br>
<span class="lineno">1515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4393097">//&nbsp;the&nbsp;channel&nbsp;type&nbsp;parsed&nbsp;already:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4393135">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4393140">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;(chan&nbsp;type)&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;(&lt;-chan&nbsp;type)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4393183">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;(chan&lt;-&nbsp;type)&nbsp;&nbsp;=&gt;&nbsp;&nbsp;(&lt;-chan&nbsp;(&lt;-type))</span><br>
<span class="lineno"></span><br>
<span class="lineno">1520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4393231">x</span>&nbsp;<span class="op" id="4393233">:=</span>&nbsp;<span class="ident" id="4393236">p</span><span class="op" id="4393237">.</span><span class="ident" id="4393238">parseUnaryExpr</span><span class="op" id="4393252">(</span><span class="builtintype" id="4393253">false</span><span class="op" id="4393258">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4393263">//&nbsp;determine&nbsp;which&nbsp;case&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4393297">if</span>&nbsp;<span class="ident" id="4393300">typ</span><span class="op" id="4393303">,</span>&nbsp;<span class="ident" id="4393305">ok</span>&nbsp;<span class="op" id="4393308">:=</span>&nbsp;<span class="ident" id="4393311">x</span><span class="op" id="4393312">.</span><span class="op" id="4393313">(</span><span class="op" id="4393314">*</span><span class="ident" id="4393315">ast</span><span class="op" id="4393318">.</span><span class="ident" id="4393319">ChanType</span><span class="op" id="4393327">)</span><span class="op" id="4393328">;</span>&nbsp;<span class="ident" id="4393330">ok</span>&nbsp;<span class="op" id="4393333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4393338">//&nbsp;(&lt;-type)</span><br>
<span class="lineno">1525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4393354">//&nbsp;re-associate&nbsp;position&nbsp;info&nbsp;and&nbsp;&lt;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4393394">dir</span>&nbsp;<span class="op" id="4393398">:=</span>&nbsp;<span class="ident" id="4393401">ast</span><span class="op" id="4393404">.</span><span class="ident" id="4393405">SEND</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4393413">for</span>&nbsp;<span class="ident" id="4393417">ok</span>&nbsp;<span class="op" id="4393420">&amp;&amp;</span>&nbsp;<span class="ident" id="4393423">dir</span>&nbsp;<span class="op" id="4393427">==</span>&nbsp;<span class="ident" id="4393430">ast</span><span class="op" id="4393433">.</span><span class="ident" id="4393434">SEND</span>&nbsp;<span class="op" id="4393439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4393445">if</span>&nbsp;<span class="ident" id="4393448">typ</span><span class="op" id="4393451">.</span><span class="ident" id="4393452">Dir</span>&nbsp;<span class="op" id="4393456">==</span>&nbsp;<span class="ident" id="4393459">ast</span><span class="op" id="4393462">.</span><span class="ident" id="4393463">RECV</span>&nbsp;<span class="op" id="4393468">{</span><br>
<span class="lineno">1530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4393475">//&nbsp;error:&nbsp;(&lt;-type)&nbsp;is&nbsp;(&lt;-(&lt;-chan&nbsp;T))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4393517">p</span><span class="op" id="4393518">.</span><span class="ident" id="4393519">errorExpected</span><span class="op" id="4393532">(</span><span class="ident" id="4393533">typ</span><span class="op" id="4393536">.</span><span class="ident" id="4393537">Arrow</span><span class="op" id="4393542">,</span>&nbsp;<span class="string" id="4393544">&#34;&#39;chan&#39;&#34;</span><span class="op" id="4393552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4393558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4393564">arrow</span><span class="op" id="4393569">,</span>&nbsp;<span class="ident" id="4393571">typ</span><span class="op" id="4393574">.</span><span class="ident" id="4393575">Begin</span><span class="op" id="4393580">,</span>&nbsp;<span class="ident" id="4393582">typ</span><span class="op" id="4393585">.</span><span class="ident" id="4393586">Arrow</span>&nbsp;<span class="op" id="4393592">=</span>&nbsp;<span class="ident" id="4393594">typ</span><span class="op" id="4393597">.</span><span class="ident" id="4393598">Arrow</span><span class="op" id="4393603">,</span>&nbsp;<span class="ident" id="4393605">arrow</span><span class="op" id="4393610">,</span>&nbsp;<span class="ident" id="4393612">arrow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4393622">dir</span><span class="op" id="4393625">,</span>&nbsp;<span class="ident" id="4393627">typ</span><span class="op" id="4393630">.</span><span class="ident" id="4393631">Dir</span>&nbsp;<span class="op" id="4393635">=</span>&nbsp;<span class="ident" id="4393637">typ</span><span class="op" id="4393640">.</span><span class="ident" id="4393641">Dir</span><span class="op" id="4393644">,</span>&nbsp;<span class="ident" id="4393646">ast</span><span class="op" id="4393649">.</span><span class="ident" id="4393650">RECV</span><br>
<span class="lineno">1535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4393659">typ</span><span class="op" id="4393662">,</span>&nbsp;<span class="ident" id="4393664">ok</span>&nbsp;<span class="op" id="4393667">=</span>&nbsp;<span class="ident" id="4393669">typ</span><span class="op" id="4393672">.</span><span class="ident" id="4393673">Value</span><span class="op" id="4393678">.</span><span class="op" id="4393679">(</span><span class="op" id="4393680">*</span><span class="ident" id="4393681">ast</span><span class="op" id="4393684">.</span><span class="ident" id="4393685">ChanType</span><span class="op" id="4393693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4393698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4393703">if</span>&nbsp;<span class="ident" id="4393706">dir</span>&nbsp;<span class="op" id="4393710">==</span>&nbsp;<span class="ident" id="4393713">ast</span><span class="op" id="4393716">.</span><span class="ident" id="4393717">SEND</span>&nbsp;<span class="op" id="4393722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4393728">p</span><span class="op" id="4393729">.</span><span class="ident" id="4393730">errorExpected</span><span class="op" id="4393743">(</span><span class="ident" id="4393744">arrow</span><span class="op" id="4393749">,</span>&nbsp;<span class="string" id="4393751">&#34;channel&nbsp;type&#34;</span><span class="op" id="4393765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4393770">}</span><br>
<span class="lineno">1540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4393776">return</span>&nbsp;<span class="ident" id="4393783">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4393787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4393792">//&nbsp;&lt;-(expr)</span><br>
<span class="lineno">1545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4393806">return</span>&nbsp;<span class="op" id="4393813">&amp;</span><span class="ident" id="4393814">ast</span><span class="op" id="4393817">.</span><span class="ident" id="4393818">UnaryExpr</span><span class="op" id="4393827">{</span><span class="ident" id="4393828">OpPos</span><span class="op" id="4393833">:</span>&nbsp;<span class="ident" id="4393835">arrow</span><span class="op" id="4393840">,</span>&nbsp;<span class="ident" id="4393842">Op</span><span class="op" id="4393844">:</span>&nbsp;<span class="ident" id="4393846">token</span><span class="op" id="4393851">.</span><span class="ident" id="4393852">ARROW</span><span class="op" id="4393857">,</span>&nbsp;<span class="ident" id="4393859">X</span><span class="op" id="4393860">:</span>&nbsp;<span class="ident" id="4393862">p</span><span class="op" id="4393863">.</span><span class="ident" id="4393864">checkExpr</span><span class="op" id="4393873">(</span><span class="ident" id="4393874">x</span><span class="op" id="4393875">)</span><span class="op" id="4393876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4393880">case</span>&nbsp;<span class="ident" id="4393885">token</span><span class="op" id="4393890">.</span><span class="ident" id="4393891">MUL</span><span class="op" id="4393894">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4393898">//&nbsp;pointer&nbsp;type&nbsp;or&nbsp;unary&nbsp;&#34;*&#34;&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4393940">pos</span>&nbsp;<span class="op" id="4393944">:=</span>&nbsp;<span class="ident" id="4393947">p</span><span class="op" id="4393948">.</span><span class="ident" id="4393949">pos</span><br>
<span class="lineno">1550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4393955">p</span><span class="op" id="4393956">.</span><span class="ident" id="4393957">next</span><span class="op" id="4393961">(</span><span class="op" id="4393962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4393966">x</span>&nbsp;<span class="op" id="4393968">:=</span>&nbsp;<span class="ident" id="4393971">p</span><span class="op" id="4393972">.</span><span class="ident" id="4393973">parseUnaryExpr</span><span class="op" id="4393987">(</span><span class="builtintype" id="4393988">false</span><span class="op" id="4393993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4393997">return</span>&nbsp;<span class="op" id="4394004">&amp;</span><span class="ident" id="4394005">ast</span><span class="op" id="4394008">.</span><span class="ident" id="4394009">StarExpr</span><span class="op" id="4394017">{</span><span class="ident" id="4394018">Star</span><span class="op" id="4394022">:</span>&nbsp;<span class="ident" id="4394024">pos</span><span class="op" id="4394027">,</span>&nbsp;<span class="ident" id="4394029">X</span><span class="op" id="4394030">:</span>&nbsp;<span class="ident" id="4394032">p</span><span class="op" id="4394033">.</span><span class="ident" id="4394034">checkExprOrType</span><span class="op" id="4394049">(</span><span class="ident" id="4394050">x</span><span class="op" id="4394051">)</span><span class="op" id="4394052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4394055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4394059">return</span>&nbsp;<span class="ident" id="4394066">p</span><span class="op" id="4394067">.</span><span class="ident" id="4394068">parsePrimaryExpr</span><span class="op" id="4394084">(</span><span class="ident" id="4394085">lhs</span><span class="op" id="4394088">)</span><br>
<span class="lineno"></span><span class="op" id="4394090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4394093">func</span>&nbsp;<span class="op" id="4394098">(</span><span class="ident" id="4394099">p</span>&nbsp;<span class="op" id="4394101">*</span><span class="ident" id="4394102">parser</span><span class="op" id="4394108">)</span>&nbsp;<span class="ident" id="4394110">tokPrec</span><span class="op" id="4394117">(</span><span class="op" id="4394118">)</span>&nbsp;<span class="op" id="4394120">(</span><span class="ident" id="4394121">token</span><span class="op" id="4394126">.</span><span class="ident" id="4394127">Token</span><span class="op" id="4394132">,</span>&nbsp;<span class="builtintype" id="4394134">int</span><span class="op" id="4394137">)</span>&nbsp;<span class="op" id="4394139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394142">tok</span>&nbsp;<span class="op" id="4394146">:=</span>&nbsp;<span class="ident" id="4394149">p</span><span class="op" id="4394150">.</span><span class="ident" id="4394151">tok</span><br>
<span class="lineno">1560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4394156">if</span>&nbsp;<span class="ident" id="4394159">p</span><span class="op" id="4394160">.</span><span class="ident" id="4394161">inRhs</span>&nbsp;<span class="op" id="4394167">&amp;&amp;</span>&nbsp;<span class="ident" id="4394170">tok</span>&nbsp;<span class="op" id="4394174">==</span>&nbsp;<span class="ident" id="4394177">token</span><span class="op" id="4394182">.</span><span class="ident" id="4394183">ASSIGN</span>&nbsp;<span class="op" id="4394190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394194">tok</span>&nbsp;<span class="op" id="4394198">=</span>&nbsp;<span class="ident" id="4394200">token</span><span class="op" id="4394205">.</span><span class="ident" id="4394206">EQL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4394211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4394214">return</span>&nbsp;<span class="ident" id="4394221">tok</span><span class="op" id="4394224">,</span>&nbsp;<span class="ident" id="4394226">tok</span><span class="op" id="4394229">.</span><span class="ident" id="4394230">Precedence</span><span class="op" id="4394240">(</span><span class="op" id="4394241">)</span><br>
<span class="lineno"></span><span class="op" id="4394243">}</span><br>
<span class="lineno">1565</span><br>
<span class="lineno"></span><span class="comment" id="4394246">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="4394316">func</span>&nbsp;<span class="op" id="4394321">(</span><span class="ident" id="4394322">p</span>&nbsp;<span class="op" id="4394324">*</span><span class="ident" id="4394325">parser</span><span class="op" id="4394331">)</span>&nbsp;<span class="ident" id="4394333">parseBinaryExpr</span><span class="op" id="4394348">(</span><span class="ident" id="4394349">lhs</span>&nbsp;<span class="builtintype" id="4394353">bool</span><span class="op" id="4394357">,</span>&nbsp;<span class="ident" id="4394359">prec1</span>&nbsp;<span class="builtintype" id="4394365">int</span><span class="op" id="4394368">)</span>&nbsp;<span class="ident" id="4394370">ast</span><span class="op" id="4394373">.</span><span class="ident" id="4394374">Expr</span>&nbsp;<span class="op" id="4394379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4394382">if</span>&nbsp;<span class="ident" id="4394385">p</span><span class="op" id="4394386">.</span><span class="ident" id="4394387">trace</span>&nbsp;<span class="op" id="4394393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4394397">defer</span>&nbsp;<span class="ident" id="4394403">un</span><span class="op" id="4394405">(</span><span class="ident" id="4394406">trace</span><span class="op" id="4394411">(</span><span class="ident" id="4394412">p</span><span class="op" id="4394413">,</span>&nbsp;<span class="string" id="4394415">&#34;BinaryExpr&#34;</span><span class="op" id="4394427">)</span><span class="op" id="4394428">)</span><br>
<span class="lineno">1570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4394431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394435">x</span>&nbsp;<span class="op" id="4394437">:=</span>&nbsp;<span class="ident" id="4394440">p</span><span class="op" id="4394441">.</span><span class="ident" id="4394442">parseUnaryExpr</span><span class="op" id="4394456">(</span><span class="ident" id="4394457">lhs</span><span class="op" id="4394460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4394463">for</span>&nbsp;<span class="ident" id="4394467">_</span><span class="op" id="4394468">,</span>&nbsp;<span class="ident" id="4394470">prec</span>&nbsp;<span class="op" id="4394475">:=</span>&nbsp;<span class="ident" id="4394478">p</span><span class="op" id="4394479">.</span><span class="ident" id="4394480">tokPrec</span><span class="op" id="4394487">(</span><span class="op" id="4394488">)</span><span class="op" id="4394489">;</span>&nbsp;<span class="ident" id="4394491">prec</span>&nbsp;<span class="op" id="4394496">&gt;=</span>&nbsp;<span class="ident" id="4394499">prec1</span><span class="op" id="4394504">;</span>&nbsp;<span class="ident" id="4394506">prec</span><span class="op" id="4394510">--</span>&nbsp;<span class="op" id="4394513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4394517">for</span>&nbsp;<span class="op" id="4394521">{</span><br>
<span class="lineno">1575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394526">op</span><span class="op" id="4394528">,</span>&nbsp;<span class="ident" id="4394530">oprec</span>&nbsp;<span class="op" id="4394536">:=</span>&nbsp;<span class="ident" id="4394539">p</span><span class="op" id="4394540">.</span><span class="ident" id="4394541">tokPrec</span><span class="op" id="4394548">(</span><span class="op" id="4394549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4394554">if</span>&nbsp;<span class="ident" id="4394557">oprec</span>&nbsp;<span class="op" id="4394563">!=</span>&nbsp;<span class="ident" id="4394566">prec</span>&nbsp;<span class="op" id="4394571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4394577">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4394586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394591">pos</span>&nbsp;<span class="op" id="4394595">:=</span>&nbsp;<span class="ident" id="4394598">p</span><span class="op" id="4394599">.</span><span class="ident" id="4394600">expect</span><span class="op" id="4394606">(</span><span class="ident" id="4394607">op</span><span class="op" id="4394609">)</span><br>
<span class="lineno">1580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4394614">if</span>&nbsp;<span class="ident" id="4394617">lhs</span>&nbsp;<span class="op" id="4394621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394627">p</span><span class="op" id="4394628">.</span><span class="ident" id="4394629">resolve</span><span class="op" id="4394636">(</span><span class="ident" id="4394637">x</span><span class="op" id="4394638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394644">lhs</span>&nbsp;<span class="op" id="4394648">=</span>&nbsp;<span class="builtintype" id="4394650">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4394659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394664">y</span>&nbsp;<span class="op" id="4394666">:=</span>&nbsp;<span class="ident" id="4394669">p</span><span class="op" id="4394670">.</span><span class="ident" id="4394671">parseBinaryExpr</span><span class="op" id="4394686">(</span><span class="builtintype" id="4394687">false</span><span class="op" id="4394692">,</span>&nbsp;<span class="ident" id="4394694">prec</span><span class="op" id="4394698">+</span><span class="num" id="4394699">1</span><span class="op" id="4394700">)</span><br>
<span class="lineno">1585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394705">x</span>&nbsp;<span class="op" id="4394707">=</span>&nbsp;<span class="op" id="4394709">&amp;</span><span class="ident" id="4394710">ast</span><span class="op" id="4394713">.</span><span class="ident" id="4394714">BinaryExpr</span><span class="op" id="4394724">{</span><span class="ident" id="4394725">X</span><span class="op" id="4394726">:</span>&nbsp;<span class="ident" id="4394728">p</span><span class="op" id="4394729">.</span><span class="ident" id="4394730">checkExpr</span><span class="op" id="4394739">(</span><span class="ident" id="4394740">x</span><span class="op" id="4394741">)</span><span class="op" id="4394742">,</span>&nbsp;<span class="ident" id="4394744">OpPos</span><span class="op" id="4394749">:</span>&nbsp;<span class="ident" id="4394751">pos</span><span class="op" id="4394754">,</span>&nbsp;<span class="ident" id="4394756">Op</span><span class="op" id="4394758">:</span>&nbsp;<span class="ident" id="4394760">op</span><span class="op" id="4394762">,</span>&nbsp;<span class="ident" id="4394764">Y</span><span class="op" id="4394765">:</span>&nbsp;<span class="ident" id="4394767">p</span><span class="op" id="4394768">.</span><span class="ident" id="4394769">checkExpr</span><span class="op" id="4394778">(</span><span class="ident" id="4394779">y</span><span class="op" id="4394780">)</span><span class="op" id="4394781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4394785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4394788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4394792">return</span>&nbsp;<span class="ident" id="4394799">x</span><br>
<span class="lineno">1590</span><span class="op" id="4394801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4394804">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="comment" id="4394874">//&nbsp;The&nbsp;result&nbsp;may&nbsp;be&nbsp;a&nbsp;type&nbsp;or&nbsp;even&nbsp;a&nbsp;raw&nbsp;type&nbsp;([...]int).&nbsp;Callers&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="4394946">//&nbsp;check&nbsp;the&nbsp;result&nbsp;(using&nbsp;checkExpr&nbsp;or&nbsp;checkExprOrType),&nbsp;depending&nbsp;on</span><br>
<span class="lineno">1595</span><span class="comment" id="4395017">//&nbsp;context.</span><br>
<span class="lineno"></span><span class="keyword" id="4395029">func</span>&nbsp;<span class="op" id="4395034">(</span><span class="ident" id="4395035">p</span>&nbsp;<span class="op" id="4395037">*</span><span class="ident" id="4395038">parser</span><span class="op" id="4395044">)</span>&nbsp;<span class="ident" id="4395046">parseExpr</span><span class="op" id="4395055">(</span><span class="ident" id="4395056">lhs</span>&nbsp;<span class="builtintype" id="4395060">bool</span><span class="op" id="4395064">)</span>&nbsp;<span class="ident" id="4395066">ast</span><span class="op" id="4395069">.</span><span class="ident" id="4395070">Expr</span>&nbsp;<span class="op" id="4395075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4395078">if</span>&nbsp;<span class="ident" id="4395081">p</span><span class="op" id="4395082">.</span><span class="ident" id="4395083">trace</span>&nbsp;<span class="op" id="4395089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4395093">defer</span>&nbsp;<span class="ident" id="4395099">un</span><span class="op" id="4395101">(</span><span class="ident" id="4395102">trace</span><span class="op" id="4395107">(</span><span class="ident" id="4395108">p</span><span class="op" id="4395109">,</span>&nbsp;<span class="string" id="4395111">&#34;Expression&#34;</span><span class="op" id="4395123">)</span><span class="op" id="4395124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4395127">}</span><br>
<span class="lineno">1600</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4395131">return</span>&nbsp;<span class="ident" id="4395138">p</span><span class="op" id="4395139">.</span><span class="ident" id="4395140">parseBinaryExpr</span><span class="op" id="4395155">(</span><span class="ident" id="4395156">lhs</span><span class="op" id="4395159">,</span>&nbsp;<span class="ident" id="4395161">token</span><span class="op" id="4395166">.</span><span class="ident" id="4395167">LowestPrec</span><span class="op" id="4395177">+</span><span class="num" id="4395178">1</span><span class="op" id="4395179">)</span><br>
<span class="lineno"></span><span class="op" id="4395181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4395184">func</span>&nbsp;<span class="op" id="4395189">(</span><span class="ident" id="4395190">p</span>&nbsp;<span class="op" id="4395192">*</span><span class="ident" id="4395193">parser</span><span class="op" id="4395199">)</span>&nbsp;<span class="ident" id="4395201">parseRhs</span><span class="op" id="4395209">(</span><span class="op" id="4395210">)</span>&nbsp;<span class="ident" id="4395212">ast</span><span class="op" id="4395215">.</span><span class="ident" id="4395216">Expr</span>&nbsp;<span class="op" id="4395221">{</span><br>
<span class="lineno">1605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4395224">old</span>&nbsp;<span class="op" id="4395228">:=</span>&nbsp;<span class="ident" id="4395231">p</span><span class="op" id="4395232">.</span><span class="ident" id="4395233">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4395240">p</span><span class="op" id="4395241">.</span><span class="ident" id="4395242">inRhs</span>&nbsp;<span class="op" id="4395248">=</span>&nbsp;<span class="builtintype" id="4395250">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4395256">x</span>&nbsp;<span class="op" id="4395258">:=</span>&nbsp;<span class="ident" id="4395261">p</span><span class="op" id="4395262">.</span><span class="ident" id="4395263">checkExpr</span><span class="op" id="4395272">(</span><span class="ident" id="4395273">p</span><span class="op" id="4395274">.</span><span class="ident" id="4395275">parseExpr</span><span class="op" id="4395284">(</span><span class="builtintype" id="4395285">false</span><span class="op" id="4395290">)</span><span class="op" id="4395291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4395294">p</span><span class="op" id="4395295">.</span><span class="ident" id="4395296">inRhs</span>&nbsp;<span class="op" id="4395302">=</span>&nbsp;<span class="ident" id="4395304">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4395309">return</span>&nbsp;<span class="ident" id="4395316">x</span><br>
<span class="lineno">1610</span><span class="op" id="4395318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4395321">func</span>&nbsp;<span class="op" id="4395326">(</span><span class="ident" id="4395327">p</span>&nbsp;<span class="op" id="4395329">*</span><span class="ident" id="4395330">parser</span><span class="op" id="4395336">)</span>&nbsp;<span class="ident" id="4395338">parseRhsOrType</span><span class="op" id="4395352">(</span><span class="op" id="4395353">)</span>&nbsp;<span class="ident" id="4395355">ast</span><span class="op" id="4395358">.</span><span class="ident" id="4395359">Expr</span>&nbsp;<span class="op" id="4395364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4395367">old</span>&nbsp;<span class="op" id="4395371">:=</span>&nbsp;<span class="ident" id="4395374">p</span><span class="op" id="4395375">.</span><span class="ident" id="4395376">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4395383">p</span><span class="op" id="4395384">.</span><span class="ident" id="4395385">inRhs</span>&nbsp;<span class="op" id="4395391">=</span>&nbsp;<span class="builtintype" id="4395393">true</span><br>
<span class="lineno">1615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4395399">x</span>&nbsp;<span class="op" id="4395401">:=</span>&nbsp;<span class="ident" id="4395404">p</span><span class="op" id="4395405">.</span><span class="ident" id="4395406">checkExprOrType</span><span class="op" id="4395421">(</span><span class="ident" id="4395422">p</span><span class="op" id="4395423">.</span><span class="ident" id="4395424">parseExpr</span><span class="op" id="4395433">(</span><span class="builtintype" id="4395434">false</span><span class="op" id="4395439">)</span><span class="op" id="4395440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4395443">p</span><span class="op" id="4395444">.</span><span class="ident" id="4395445">inRhs</span>&nbsp;<span class="op" id="4395451">=</span>&nbsp;<span class="ident" id="4395453">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4395458">return</span>&nbsp;<span class="ident" id="4395465">x</span><br>
<span class="lineno"></span><span class="op" id="4395467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1620</span><span class="comment" id="4395470">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4395550">//&nbsp;Statements</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4395565">//&nbsp;Parsing&nbsp;modes&nbsp;for&nbsp;parseSimpleStmt.</span><br>
<span class="lineno"></span><span class="keyword" id="4395603">const</span>&nbsp;<span class="op" id="4395609">(</span><br>
<span class="lineno">1625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4395612">basic</span>&nbsp;<span class="op" id="4395618">=</span>&nbsp;<span class="ident" id="4395620">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4395626">labelOk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4395635">rangeOk</span><br>
<span class="lineno"></span><span class="op" id="4395643">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1630</span><span class="comment" id="4395646">//&nbsp;parseSimpleStmt&nbsp;returns&nbsp;true&nbsp;as&nbsp;2nd&nbsp;result&nbsp;if&nbsp;it&nbsp;parsed&nbsp;the&nbsp;assignment</span><br>
<span class="lineno"></span><span class="comment" id="4395720">//&nbsp;of&nbsp;a&nbsp;range&nbsp;clause&nbsp;(with&nbsp;mode&nbsp;==&nbsp;rangeOk).&nbsp;The&nbsp;returned&nbsp;statement&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="4395794">//&nbsp;assignment&nbsp;with&nbsp;a&nbsp;right-hand&nbsp;side&nbsp;that&nbsp;is&nbsp;a&nbsp;single&nbsp;unary&nbsp;expression&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4395868">//&nbsp;the&nbsp;form&nbsp;&#34;range&nbsp;x&#34;.&nbsp;No&nbsp;guarantees&nbsp;are&nbsp;given&nbsp;for&nbsp;the&nbsp;left-hand&nbsp;side.</span><br>
<span class="lineno"></span><span class="keyword" id="4395939">func</span>&nbsp;<span class="op" id="4395944">(</span><span class="ident" id="4395945">p</span>&nbsp;<span class="op" id="4395947">*</span><span class="ident" id="4395948">parser</span><span class="op" id="4395954">)</span>&nbsp;<span class="ident" id="4395956">parseSimpleStmt</span><span class="op" id="4395971">(</span><span class="ident" id="4395972">mode</span>&nbsp;<span class="builtintype" id="4395977">int</span><span class="op" id="4395980">)</span>&nbsp;<span class="op" id="4395982">(</span><span class="ident" id="4395983">ast</span><span class="op" id="4395986">.</span><span class="ident" id="4395987">Stmt</span><span class="op" id="4395991">,</span>&nbsp;<span class="builtintype" id="4395993">bool</span><span class="op" id="4395997">)</span>&nbsp;<span class="op" id="4395999">{</span><br>
<span class="lineno">1635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4396002">if</span>&nbsp;<span class="ident" id="4396005">p</span><span class="op" id="4396006">.</span><span class="ident" id="4396007">trace</span>&nbsp;<span class="op" id="4396013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4396017">defer</span>&nbsp;<span class="ident" id="4396023">un</span><span class="op" id="4396025">(</span><span class="ident" id="4396026">trace</span><span class="op" id="4396031">(</span><span class="ident" id="4396032">p</span><span class="op" id="4396033">,</span>&nbsp;<span class="string" id="4396035">&#34;SimpleStmt&#34;</span><span class="op" id="4396047">)</span><span class="op" id="4396048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4396051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4396055">x</span>&nbsp;<span class="op" id="4396057">:=</span>&nbsp;<span class="ident" id="4396060">p</span><span class="op" id="4396061">.</span><span class="ident" id="4396062">parseLhsList</span><span class="op" id="4396074">(</span><span class="op" id="4396075">)</span><br>
<span class="lineno">1640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4396079">switch</span>&nbsp;<span class="ident" id="4396086">p</span><span class="op" id="4396087">.</span><span class="ident" id="4396088">tok</span>&nbsp;<span class="op" id="4396092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4396095">case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4396102">token</span><span class="op" id="4396107">.</span><span class="ident" id="4396108">DEFINE</span><span class="op" id="4396114">,</span>&nbsp;<span class="ident" id="4396116">token</span><span class="op" id="4396121">.</span><span class="ident" id="4396122">ASSIGN</span><span class="op" id="4396128">,</span>&nbsp;<span class="ident" id="4396130">token</span><span class="op" id="4396135">.</span><span class="ident" id="4396136">ADD_ASSIGN</span><span class="op" id="4396146">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4396150">token</span><span class="op" id="4396155">.</span><span class="ident" id="4396156">SUB_ASSIGN</span><span class="op" id="4396166">,</span>&nbsp;<span class="ident" id="4396168">token</span><span class="op" id="4396173">.</span><span class="ident" id="4396174">MUL_ASSIGN</span><span class="op" id="4396184">,</span>&nbsp;<span class="ident" id="4396186">token</span><span class="op" id="4396191">.</span><span class="ident" id="4396192">QUO_ASSIGN</span><span class="op" id="4396202">,</span><br>
<span class="lineno">1645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4396206">token</span><span class="op" id="4396211">.</span><span class="ident" id="4396212">REM_ASSIGN</span><span class="op" id="4396222">,</span>&nbsp;<span class="ident" id="4396224">token</span><span class="op" id="4396229">.</span><span class="ident" id="4396230">AND_ASSIGN</span><span class="op" id="4396240">,</span>&nbsp;<span class="ident" id="4396242">token</span><span class="op" id="4396247">.</span><span class="ident" id="4396248">OR_ASSIGN</span><span class="op" id="4396257">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4396261">token</span><span class="op" id="4396266">.</span><span class="ident" id="4396267">XOR_ASSIGN</span><span class="op" id="4396277">,</span>&nbsp;<span class="ident" id="4396279">token</span><span class="op" id="4396284">.</span><span class="ident" id="4396285">SHL_ASSIGN</span><span class="op" id="4396295">,</span>&nbsp;<span class="ident" id="4396297">token</span><span class="op" id="4396302">.</span><span class="ident" id="4396303">SHR_ASSIGN</span><span class="op" id="4396313">,</span>&nbsp;<span class="ident" id="4396315">token</span><span class="op" id="4396320">.</span><span class="ident" id="4396321">AND_NOT_ASSIGN</span><span class="op" id="4396335">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4396339">//&nbsp;assignment&nbsp;statement,&nbsp;possibly&nbsp;part&nbsp;of&nbsp;a&nbsp;range&nbsp;clause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4396398">pos</span><span class="op" id="4396401">,</span>&nbsp;<span class="ident" id="4396403">tok</span>&nbsp;<span class="op" id="4396407">:=</span>&nbsp;<span class="ident" id="4396410">p</span><span class="op" id="4396411">.</span><span class="ident" id="4396412">pos</span><span class="op" id="4396415">,</span>&nbsp;<span class="ident" id="4396417">p</span><span class="op" id="4396418">.</span><span class="ident" id="4396419">tok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4396425">p</span><span class="op" id="4396426">.</span><span class="ident" id="4396427">next</span><span class="op" id="4396431">(</span><span class="op" id="4396432">)</span><br>
<span class="lineno">1650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4396436">var</span>&nbsp;<span class="ident" id="4396440">y</span>&nbsp;<span class="op" id="4396442">[</span><span class="op" id="4396443">]</span><span class="ident" id="4396444">ast</span><span class="op" id="4396447">.</span><span class="ident" id="4396448">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4396455">isRange</span>&nbsp;<span class="op" id="4396463">:=</span>&nbsp;<span class="builtintype" id="4396466">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4396474">if</span>&nbsp;<span class="ident" id="4396477">mode</span>&nbsp;<span class="op" id="4396482">==</span>&nbsp;<span class="ident" id="4396485">rangeOk</span>&nbsp;<span class="op" id="4396493">&amp;&amp;</span>&nbsp;<span class="ident" id="4396496">p</span><span class="op" id="4396497">.</span><span class="ident" id="4396498">tok</span>&nbsp;<span class="op" id="4396502">==</span>&nbsp;<span class="ident" id="4396505">token</span><span class="op" id="4396510">.</span><span class="ident" id="4396511">RANGE</span>&nbsp;<span class="op" id="4396517">&amp;&amp;</span>&nbsp;<span class="op" id="4396520">(</span><span class="ident" id="4396521">tok</span>&nbsp;<span class="op" id="4396525">==</span>&nbsp;<span class="ident" id="4396528">token</span><span class="op" id="4396533">.</span><span class="ident" id="4396534">DEFINE</span>&nbsp;<span class="op" id="4396541">||</span>&nbsp;<span class="ident" id="4396544">tok</span>&nbsp;<span class="op" id="4396548">==</span>&nbsp;<span class="ident" id="4396551">token</span><span class="op" id="4396556">.</span><span class="ident" id="4396557">ASSIGN</span><span class="op" id="4396563">)</span>&nbsp;<span class="op" id="4396565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4396570">pos</span>&nbsp;<span class="op" id="4396574">:=</span>&nbsp;<span class="ident" id="4396577">p</span><span class="op" id="4396578">.</span><span class="ident" id="4396579">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4396586">p</span><span class="op" id="4396587">.</span><span class="ident" id="4396588">next</span><span class="op" id="4396592">(</span><span class="op" id="4396593">)</span><br>
<span class="lineno">1655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4396598">y</span>&nbsp;<span class="op" id="4396600">=</span>&nbsp;<span class="op" id="4396602">[</span><span class="op" id="4396603">]</span><span class="ident" id="4396604">ast</span><span class="op" id="4396607">.</span><span class="ident" id="4396608">Expr</span><span class="op" id="4396612">{</span><span class="op" id="4396613">&amp;</span><span class="ident" id="4396614">ast</span><span class="op" id="4396617">.</span><span class="ident" id="4396618">UnaryExpr</span><span class="op" id="4396627">{</span><span class="ident" id="4396628">OpPos</span><span class="op" id="4396633">:</span>&nbsp;<span class="ident" id="4396635">pos</span><span class="op" id="4396638">,</span>&nbsp;<span class="ident" id="4396640">Op</span><span class="op" id="4396642">:</span>&nbsp;<span class="ident" id="4396644">token</span><span class="op" id="4396649">.</span><span class="ident" id="4396650">RANGE</span><span class="op" id="4396655">,</span>&nbsp;<span class="ident" id="4396657">X</span><span class="op" id="4396658">:</span>&nbsp;<span class="ident" id="4396660">p</span><span class="op" id="4396661">.</span><span class="ident" id="4396662">parseRhs</span><span class="op" id="4396670">(</span><span class="op" id="4396671">)</span><span class="op" id="4396672">}</span><span class="op" id="4396673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4396678">isRange</span>&nbsp;<span class="op" id="4396686">=</span>&nbsp;<span class="builtintype" id="4396688">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4396695">}</span>&nbsp;<span class="keyword" id="4396697">else</span>&nbsp;<span class="op" id="4396702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4396707">y</span>&nbsp;<span class="op" id="4396709">=</span>&nbsp;<span class="ident" id="4396711">p</span><span class="op" id="4396712">.</span><span class="ident" id="4396713">parseRhsList</span><span class="op" id="4396725">(</span><span class="op" id="4396726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4396730">}</span><br>
<span class="lineno">1660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4396734">as</span>&nbsp;<span class="op" id="4396737">:=</span>&nbsp;<span class="op" id="4396740">&amp;</span><span class="ident" id="4396741">ast</span><span class="op" id="4396744">.</span><span class="ident" id="4396745">AssignStmt</span><span class="op" id="4396755">{</span><span class="ident" id="4396756">Lhs</span><span class="op" id="4396759">:</span>&nbsp;<span class="ident" id="4396761">x</span><span class="op" id="4396762">,</span>&nbsp;<span class="ident" id="4396764">TokPos</span><span class="op" id="4396770">:</span>&nbsp;<span class="ident" id="4396772">pos</span><span class="op" id="4396775">,</span>&nbsp;<span class="ident" id="4396777">Tok</span><span class="op" id="4396780">:</span>&nbsp;<span class="ident" id="4396782">tok</span><span class="op" id="4396785">,</span>&nbsp;<span class="ident" id="4396787">Rhs</span><span class="op" id="4396790">:</span>&nbsp;<span class="ident" id="4396792">y</span><span class="op" id="4396793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4396797">if</span>&nbsp;<span class="ident" id="4396800">tok</span>&nbsp;<span class="op" id="4396804">==</span>&nbsp;<span class="ident" id="4396807">token</span><span class="op" id="4396812">.</span><span class="ident" id="4396813">DEFINE</span>&nbsp;<span class="op" id="4396820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4396825">p</span><span class="op" id="4396826">.</span><span class="ident" id="4396827">shortVarDecl</span><span class="op" id="4396839">(</span><span class="ident" id="4396840">as</span><span class="op" id="4396842">,</span>&nbsp;<span class="ident" id="4396844">x</span><span class="op" id="4396845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4396849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4396853">return</span>&nbsp;<span class="ident" id="4396860">as</span><span class="op" id="4396862">,</span>&nbsp;<span class="ident" id="4396864">isRange</span><br>
<span class="lineno">1665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4396873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4396877">if</span>&nbsp;<span class="builtinfunc" id="4396880">len</span><span class="op" id="4396883">(</span><span class="ident" id="4396884">x</span><span class="op" id="4396885">)</span>&nbsp;<span class="op" id="4396887">&gt;</span>&nbsp;<span class="num" id="4396889">1</span>&nbsp;<span class="op" id="4396891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4396895">p</span><span class="op" id="4396896">.</span><span class="ident" id="4396897">errorExpected</span><span class="op" id="4396910">(</span><span class="ident" id="4396911">x</span><span class="op" id="4396912">[</span><span class="num" id="4396913">0</span><span class="op" id="4396914">]</span><span class="op" id="4396915">.</span><span class="ident" id="4396916">Pos</span><span class="op" id="4396919">(</span><span class="op" id="4396920">)</span><span class="op" id="4396921">,</span>&nbsp;<span class="string" id="4396923">&#34;1&nbsp;expression&#34;</span><span class="op" id="4396937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4396941">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno">1670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4396976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4396980">switch</span>&nbsp;<span class="ident" id="4396987">p</span><span class="op" id="4396988">.</span><span class="ident" id="4396989">tok</span>&nbsp;<span class="op" id="4396993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4396996">case</span>&nbsp;<span class="ident" id="4397001">token</span><span class="op" id="4397006">.</span><span class="ident" id="4397007">COLON</span><span class="op" id="4397012">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4397016">//&nbsp;labeled&nbsp;statement</span><br>
<span class="lineno">1675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4397039">colon</span>&nbsp;<span class="op" id="4397045">:=</span>&nbsp;<span class="ident" id="4397048">p</span><span class="op" id="4397049">.</span><span class="ident" id="4397050">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4397056">p</span><span class="op" id="4397057">.</span><span class="ident" id="4397058">next</span><span class="op" id="4397062">(</span><span class="op" id="4397063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4397067">if</span>&nbsp;<span class="ident" id="4397070">label</span><span class="op" id="4397075">,</span>&nbsp;<span class="ident" id="4397077">isIdent</span>&nbsp;<span class="op" id="4397085">:=</span>&nbsp;<span class="ident" id="4397088">x</span><span class="op" id="4397089">[</span><span class="num" id="4397090">0</span><span class="op" id="4397091">]</span><span class="op" id="4397092">.</span><span class="op" id="4397093">(</span><span class="op" id="4397094">*</span><span class="ident" id="4397095">ast</span><span class="op" id="4397098">.</span><span class="ident" id="4397099">Ident</span><span class="op" id="4397104">)</span><span class="op" id="4397105">;</span>&nbsp;<span class="ident" id="4397107">mode</span>&nbsp;<span class="op" id="4397112">==</span>&nbsp;<span class="ident" id="4397115">labelOk</span>&nbsp;<span class="op" id="4397123">&amp;&amp;</span>&nbsp;<span class="ident" id="4397126">isIdent</span>&nbsp;<span class="op" id="4397134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4397139">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;label&nbsp;is&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4397203">//&nbsp;in&nbsp;which&nbsp;it&nbsp;is&nbsp;declared&nbsp;and&nbsp;excludes&nbsp;the&nbsp;body&nbsp;of&nbsp;any&nbsp;nested</span><br>
<span class="lineno">1680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4397269">//&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4397285">stmt</span>&nbsp;<span class="op" id="4397290">:=</span>&nbsp;<span class="op" id="4397293">&amp;</span><span class="ident" id="4397294">ast</span><span class="op" id="4397297">.</span><span class="ident" id="4397298">LabeledStmt</span><span class="op" id="4397309">{</span><span class="ident" id="4397310">Label</span><span class="op" id="4397315">:</span>&nbsp;<span class="ident" id="4397317">label</span><span class="op" id="4397322">,</span>&nbsp;<span class="ident" id="4397324">Colon</span><span class="op" id="4397329">:</span>&nbsp;<span class="ident" id="4397331">colon</span><span class="op" id="4397336">,</span>&nbsp;<span class="ident" id="4397338">Stmt</span><span class="op" id="4397342">:</span>&nbsp;<span class="ident" id="4397344">p</span><span class="op" id="4397345">.</span><span class="ident" id="4397346">parseStmt</span><span class="op" id="4397355">(</span><span class="op" id="4397356">)</span><span class="op" id="4397357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4397362">p</span><span class="op" id="4397363">.</span><span class="ident" id="4397364">declare</span><span class="op" id="4397371">(</span><span class="ident" id="4397372">stmt</span><span class="op" id="4397376">,</span>&nbsp;<span class="ident" id="4397378">nil</span><span class="op" id="4397381">,</span>&nbsp;<span class="ident" id="4397383">p</span><span class="op" id="4397384">.</span><span class="ident" id="4397385">labelScope</span><span class="op" id="4397395">,</span>&nbsp;<span class="ident" id="4397397">ast</span><span class="op" id="4397400">.</span><span class="ident" id="4397401">Lbl</span><span class="op" id="4397404">,</span>&nbsp;<span class="ident" id="4397406">label</span><span class="op" id="4397411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4397416">return</span>&nbsp;<span class="ident" id="4397423">stmt</span><span class="op" id="4397427">,</span>&nbsp;<span class="builtintype" id="4397429">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4397437">}</span><br>
<span class="lineno">1685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4397441">//&nbsp;The&nbsp;label&nbsp;declaration&nbsp;typically&nbsp;starts&nbsp;at&nbsp;x[0].Pos(),&nbsp;but&nbsp;the&nbsp;label</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4397514">//&nbsp;declaration&nbsp;may&nbsp;be&nbsp;erroneous&nbsp;due&nbsp;to&nbsp;a&nbsp;token&nbsp;after&nbsp;that&nbsp;position&nbsp;(and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4397588">//&nbsp;before&nbsp;the&nbsp;&#39;:&#39;).&nbsp;If&nbsp;SpuriousErrors&nbsp;is&nbsp;not&nbsp;set,&nbsp;the&nbsp;(only)&nbsp;error&nbsp;re-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4397661">//&nbsp;ported&nbsp;for&nbsp;the&nbsp;line&nbsp;is&nbsp;the&nbsp;illegal&nbsp;label&nbsp;error&nbsp;instead&nbsp;of&nbsp;the&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4397734">//&nbsp;before&nbsp;the&nbsp;&#39;:&#39;&nbsp;that&nbsp;caused&nbsp;the&nbsp;problem.&nbsp;Thus,&nbsp;use&nbsp;the&nbsp;(latest)&nbsp;colon</span><br>
<span class="lineno">1690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4397808">//&nbsp;position&nbsp;for&nbsp;error&nbsp;reporting.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4397843">p</span><span class="op" id="4397844">.</span><span class="builtintype" id="4397845">error</span><span class="op" id="4397850">(</span><span class="ident" id="4397851">colon</span><span class="op" id="4397856">,</span>&nbsp;<span class="string" id="4397858">&#34;illegal&nbsp;label&nbsp;declaration&#34;</span><span class="op" id="4397885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4397889">return</span>&nbsp;<span class="op" id="4397896">&amp;</span><span class="ident" id="4397897">ast</span><span class="op" id="4397900">.</span><span class="ident" id="4397901">BadStmt</span><span class="op" id="4397908">{</span><span class="ident" id="4397909">From</span><span class="op" id="4397913">:</span>&nbsp;<span class="ident" id="4397915">x</span><span class="op" id="4397916">[</span><span class="num" id="4397917">0</span><span class="op" id="4397918">]</span><span class="op" id="4397919">.</span><span class="ident" id="4397920">Pos</span><span class="op" id="4397923">(</span><span class="op" id="4397924">)</span><span class="op" id="4397925">,</span>&nbsp;<span class="ident" id="4397927">To</span><span class="op" id="4397929">:</span>&nbsp;<span class="ident" id="4397931">colon</span>&nbsp;<span class="op" id="4397937">+</span>&nbsp;<span class="num" id="4397939">1</span><span class="op" id="4397940">}</span><span class="op" id="4397941">,</span>&nbsp;<span class="builtintype" id="4397943">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4397951">case</span>&nbsp;<span class="ident" id="4397956">token</span><span class="op" id="4397961">.</span><span class="ident" id="4397962">ARROW</span><span class="op" id="4397967">:</span><br>
<span class="lineno">1695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4397971">//&nbsp;send&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4397991">arrow</span>&nbsp;<span class="op" id="4397997">:=</span>&nbsp;<span class="ident" id="4398000">p</span><span class="op" id="4398001">.</span><span class="ident" id="4398002">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4398008">p</span><span class="op" id="4398009">.</span><span class="ident" id="4398010">next</span><span class="op" id="4398014">(</span><span class="op" id="4398015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4398019">y</span>&nbsp;<span class="op" id="4398021">:=</span>&nbsp;<span class="ident" id="4398024">p</span><span class="op" id="4398025">.</span><span class="ident" id="4398026">parseRhs</span><span class="op" id="4398034">(</span><span class="op" id="4398035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4398039">return</span>&nbsp;<span class="op" id="4398046">&amp;</span><span class="ident" id="4398047">ast</span><span class="op" id="4398050">.</span><span class="ident" id="4398051">SendStmt</span><span class="op" id="4398059">{</span><span class="ident" id="4398060">Chan</span><span class="op" id="4398064">:</span>&nbsp;<span class="ident" id="4398066">x</span><span class="op" id="4398067">[</span><span class="num" id="4398068">0</span><span class="op" id="4398069">]</span><span class="op" id="4398070">,</span>&nbsp;<span class="ident" id="4398072">Arrow</span><span class="op" id="4398077">:</span>&nbsp;<span class="ident" id="4398079">arrow</span><span class="op" id="4398084">,</span>&nbsp;<span class="ident" id="4398086">Value</span><span class="op" id="4398091">:</span>&nbsp;<span class="ident" id="4398093">y</span><span class="op" id="4398094">}</span><span class="op" id="4398095">,</span>&nbsp;<span class="builtintype" id="4398097">false</span><br>
<span class="lineno">1700</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4398105">case</span>&nbsp;<span class="ident" id="4398110">token</span><span class="op" id="4398115">.</span><span class="ident" id="4398116">INC</span><span class="op" id="4398119">,</span>&nbsp;<span class="ident" id="4398121">token</span><span class="op" id="4398126">.</span><span class="ident" id="4398127">DEC</span><span class="op" id="4398130">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4398134">//&nbsp;increment&nbsp;or&nbsp;decrement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4398162">s</span>&nbsp;<span class="op" id="4398164">:=</span>&nbsp;<span class="op" id="4398167">&amp;</span><span class="ident" id="4398168">ast</span><span class="op" id="4398171">.</span><span class="ident" id="4398172">IncDecStmt</span><span class="op" id="4398182">{</span><span class="ident" id="4398183">X</span><span class="op" id="4398184">:</span>&nbsp;<span class="ident" id="4398186">x</span><span class="op" id="4398187">[</span><span class="num" id="4398188">0</span><span class="op" id="4398189">]</span><span class="op" id="4398190">,</span>&nbsp;<span class="ident" id="4398192">TokPos</span><span class="op" id="4398198">:</span>&nbsp;<span class="ident" id="4398200">p</span><span class="op" id="4398201">.</span><span class="ident" id="4398202">pos</span><span class="op" id="4398205">,</span>&nbsp;<span class="ident" id="4398207">Tok</span><span class="op" id="4398210">:</span>&nbsp;<span class="ident" id="4398212">p</span><span class="op" id="4398213">.</span><span class="ident" id="4398214">tok</span><span class="op" id="4398217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4398221">p</span><span class="op" id="4398222">.</span><span class="ident" id="4398223">next</span><span class="op" id="4398227">(</span><span class="op" id="4398228">)</span><br>
<span class="lineno">1705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4398232">return</span>&nbsp;<span class="ident" id="4398239">s</span><span class="op" id="4398240">,</span>&nbsp;<span class="builtintype" id="4398242">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4398249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4398253">//&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4398268">return</span>&nbsp;<span class="op" id="4398275">&amp;</span><span class="ident" id="4398276">ast</span><span class="op" id="4398279">.</span><span class="ident" id="4398280">ExprStmt</span><span class="op" id="4398288">{</span><span class="ident" id="4398289">X</span><span class="op" id="4398290">:</span>&nbsp;<span class="ident" id="4398292">x</span><span class="op" id="4398293">[</span><span class="num" id="4398294">0</span><span class="op" id="4398295">]</span><span class="op" id="4398296">}</span><span class="op" id="4398297">,</span>&nbsp;<span class="builtintype" id="4398299">false</span><br>
<span class="lineno">1710</span><span class="op" id="4398305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4398308">func</span>&nbsp;<span class="op" id="4398313">(</span><span class="ident" id="4398314">p</span>&nbsp;<span class="op" id="4398316">*</span><span class="ident" id="4398317">parser</span><span class="op" id="4398323">)</span>&nbsp;<span class="ident" id="4398325">parseCallExpr</span><span class="op" id="4398338">(</span><span class="ident" id="4398339">callType</span>&nbsp;<span class="builtintype" id="4398348">string</span><span class="op" id="4398354">)</span>&nbsp;<span class="op" id="4398356">*</span><span class="ident" id="4398357">ast</span><span class="op" id="4398360">.</span><span class="ident" id="4398361">CallExpr</span>&nbsp;<span class="op" id="4398370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4398373">x</span>&nbsp;<span class="op" id="4398375">:=</span>&nbsp;<span class="ident" id="4398378">p</span><span class="op" id="4398379">.</span><span class="ident" id="4398380">parseRhsOrType</span><span class="op" id="4398394">(</span><span class="op" id="4398395">)</span>&nbsp;<span class="comment" id="4398397">//&nbsp;could&nbsp;be&nbsp;a&nbsp;conversion:&nbsp;(some&nbsp;type)(x)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4398439">if</span>&nbsp;<span class="ident" id="4398442">call</span><span class="op" id="4398446">,</span>&nbsp;<span class="ident" id="4398448">isCall</span>&nbsp;<span class="op" id="4398455">:=</span>&nbsp;<span class="ident" id="4398458">x</span><span class="op" id="4398459">.</span><span class="op" id="4398460">(</span><span class="op" id="4398461">*</span><span class="ident" id="4398462">ast</span><span class="op" id="4398465">.</span><span class="ident" id="4398466">CallExpr</span><span class="op" id="4398474">)</span><span class="op" id="4398475">;</span>&nbsp;<span class="ident" id="4398477">isCall</span>&nbsp;<span class="op" id="4398484">{</span><br>
<span class="lineno">1715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4398488">return</span>&nbsp;<span class="ident" id="4398495">call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4398501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4398504">if</span>&nbsp;<span class="ident" id="4398507">_</span><span class="op" id="4398508">,</span>&nbsp;<span class="ident" id="4398510">isBad</span>&nbsp;<span class="op" id="4398516">:=</span>&nbsp;<span class="ident" id="4398519">x</span><span class="op" id="4398520">.</span><span class="op" id="4398521">(</span><span class="op" id="4398522">*</span><span class="ident" id="4398523">ast</span><span class="op" id="4398526">.</span><span class="ident" id="4398527">BadExpr</span><span class="op" id="4398534">)</span><span class="op" id="4398535">;</span>&nbsp;<span class="op" id="4398537">!</span><span class="ident" id="4398538">isBad</span>&nbsp;<span class="op" id="4398544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4398548">//&nbsp;only&nbsp;report&nbsp;error&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;new&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4398589">p</span><span class="op" id="4398590">.</span><span class="builtintype" id="4398591">error</span><span class="op" id="4398596">(</span><span class="ident" id="4398597">p</span><span class="op" id="4398598">.</span><span class="ident" id="4398599">safePos</span><span class="op" id="4398606">(</span><span class="ident" id="4398607">x</span><span class="op" id="4398608">.</span><span class="ident" id="4398609">End</span><span class="op" id="4398612">(</span><span class="op" id="4398613">)</span><span class="op" id="4398614">)</span><span class="op" id="4398615">,</span>&nbsp;<span class="ident" id="4398617">fmt</span><span class="op" id="4398620">.</span><span class="ident" id="4398621">Sprintf</span><span class="op" id="4398628">(</span><span class="string" id="4398629">&#34;function&nbsp;must&nbsp;be&nbsp;invoked&nbsp;in&nbsp;%s&nbsp;statement&#34;</span><span class="op" id="4398671">,</span>&nbsp;<span class="ident" id="4398673">callType</span><span class="op" id="4398681">)</span><span class="op" id="4398682">)</span><br>
<span class="lineno">1720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4398685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4398688">return</span>&nbsp;<span class="ident" id="4398695">nil</span><br>
<span class="lineno"></span><span class="op" id="4398699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4398702">func</span>&nbsp;<span class="op" id="4398707">(</span><span class="ident" id="4398708">p</span>&nbsp;<span class="op" id="4398710">*</span><span class="ident" id="4398711">parser</span><span class="op" id="4398717">)</span>&nbsp;<span class="ident" id="4398719">parseGoStmt</span><span class="op" id="4398730">(</span><span class="op" id="4398731">)</span>&nbsp;<span class="ident" id="4398733">ast</span><span class="op" id="4398736">.</span><span class="ident" id="4398737">Stmt</span>&nbsp;<span class="op" id="4398742">{</span><br>
<span class="lineno">1725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4398745">if</span>&nbsp;<span class="ident" id="4398748">p</span><span class="op" id="4398749">.</span><span class="ident" id="4398750">trace</span>&nbsp;<span class="op" id="4398756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4398760">defer</span>&nbsp;<span class="ident" id="4398766">un</span><span class="op" id="4398768">(</span><span class="ident" id="4398769">trace</span><span class="op" id="4398774">(</span><span class="ident" id="4398775">p</span><span class="op" id="4398776">,</span>&nbsp;<span class="string" id="4398778">&#34;GoStmt&#34;</span><span class="op" id="4398786">)</span><span class="op" id="4398787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4398790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4398794">pos</span>&nbsp;<span class="op" id="4398798">:=</span>&nbsp;<span class="ident" id="4398801">p</span><span class="op" id="4398802">.</span><span class="ident" id="4398803">expect</span><span class="op" id="4398809">(</span><span class="ident" id="4398810">token</span><span class="op" id="4398815">.</span><span class="ident" id="4398816">GO</span><span class="op" id="4398818">)</span><br>
<span class="lineno">1730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4398821">call</span>&nbsp;<span class="op" id="4398826">:=</span>&nbsp;<span class="ident" id="4398829">p</span><span class="op" id="4398830">.</span><span class="ident" id="4398831">parseCallExpr</span><span class="op" id="4398844">(</span><span class="string" id="4398845">&#34;go&#34;</span><span class="op" id="4398849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4398852">p</span><span class="op" id="4398853">.</span><span class="ident" id="4398854">expectSemi</span><span class="op" id="4398864">(</span><span class="op" id="4398865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4398868">if</span>&nbsp;<span class="ident" id="4398871">call</span>&nbsp;<span class="op" id="4398876">==</span>&nbsp;<span class="ident" id="4398879">nil</span>&nbsp;<span class="op" id="4398883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4398887">return</span>&nbsp;<span class="op" id="4398894">&amp;</span><span class="ident" id="4398895">ast</span><span class="op" id="4398898">.</span><span class="ident" id="4398899">BadStmt</span><span class="op" id="4398906">{</span><span class="ident" id="4398907">From</span><span class="op" id="4398911">:</span>&nbsp;<span class="ident" id="4398913">pos</span><span class="op" id="4398916">,</span>&nbsp;<span class="ident" id="4398918">To</span><span class="op" id="4398920">:</span>&nbsp;<span class="ident" id="4398922">pos</span>&nbsp;<span class="op" id="4398926">+</span>&nbsp;<span class="num" id="4398928">2</span><span class="op" id="4398929">}</span>&nbsp;<span class="comment" id="4398931">//&nbsp;len(&#34;go&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4398945">}</span><br>
<span class="lineno">1735</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4398949">return</span>&nbsp;<span class="op" id="4398956">&amp;</span><span class="ident" id="4398957">ast</span><span class="op" id="4398960">.</span><span class="ident" id="4398961">GoStmt</span><span class="op" id="4398967">{</span><span class="ident" id="4398968">Go</span><span class="op" id="4398970">:</span>&nbsp;<span class="ident" id="4398972">pos</span><span class="op" id="4398975">,</span>&nbsp;<span class="ident" id="4398977">Call</span><span class="op" id="4398981">:</span>&nbsp;<span class="ident" id="4398983">call</span><span class="op" id="4398987">}</span><br>
<span class="lineno"></span><span class="op" id="4398989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4398992">func</span>&nbsp;<span class="op" id="4398997">(</span><span class="ident" id="4398998">p</span>&nbsp;<span class="op" id="4399000">*</span><span class="ident" id="4399001">parser</span><span class="op" id="4399007">)</span>&nbsp;<span class="ident" id="4399009">parseDeferStmt</span><span class="op" id="4399023">(</span><span class="op" id="4399024">)</span>&nbsp;<span class="ident" id="4399026">ast</span><span class="op" id="4399029">.</span><span class="ident" id="4399030">Stmt</span>&nbsp;<span class="op" id="4399035">{</span><br>
<span class="lineno">1740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4399038">if</span>&nbsp;<span class="ident" id="4399041">p</span><span class="op" id="4399042">.</span><span class="ident" id="4399043">trace</span>&nbsp;<span class="op" id="4399049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4399053">defer</span>&nbsp;<span class="ident" id="4399059">un</span><span class="op" id="4399061">(</span><span class="ident" id="4399062">trace</span><span class="op" id="4399067">(</span><span class="ident" id="4399068">p</span><span class="op" id="4399069">,</span>&nbsp;<span class="string" id="4399071">&#34;DeferStmt&#34;</span><span class="op" id="4399082">)</span><span class="op" id="4399083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4399086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4399090">pos</span>&nbsp;<span class="op" id="4399094">:=</span>&nbsp;<span class="ident" id="4399097">p</span><span class="op" id="4399098">.</span><span class="ident" id="4399099">expect</span><span class="op" id="4399105">(</span><span class="ident" id="4399106">token</span><span class="op" id="4399111">.</span><span class="ident" id="4399112">DEFER</span><span class="op" id="4399117">)</span><br>
<span class="lineno">1745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4399120">call</span>&nbsp;<span class="op" id="4399125">:=</span>&nbsp;<span class="ident" id="4399128">p</span><span class="op" id="4399129">.</span><span class="ident" id="4399130">parseCallExpr</span><span class="op" id="4399143">(</span><span class="string" id="4399144">&#34;defer&#34;</span><span class="op" id="4399151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4399154">p</span><span class="op" id="4399155">.</span><span class="ident" id="4399156">expectSemi</span><span class="op" id="4399166">(</span><span class="op" id="4399167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4399170">if</span>&nbsp;<span class="ident" id="4399173">call</span>&nbsp;<span class="op" id="4399178">==</span>&nbsp;<span class="ident" id="4399181">nil</span>&nbsp;<span class="op" id="4399185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4399189">return</span>&nbsp;<span class="op" id="4399196">&amp;</span><span class="ident" id="4399197">ast</span><span class="op" id="4399200">.</span><span class="ident" id="4399201">BadStmt</span><span class="op" id="4399208">{</span><span class="ident" id="4399209">From</span><span class="op" id="4399213">:</span>&nbsp;<span class="ident" id="4399215">pos</span><span class="op" id="4399218">,</span>&nbsp;<span class="ident" id="4399220">To</span><span class="op" id="4399222">:</span>&nbsp;<span class="ident" id="4399224">pos</span>&nbsp;<span class="op" id="4399228">+</span>&nbsp;<span class="num" id="4399230">5</span><span class="op" id="4399231">}</span>&nbsp;<span class="comment" id="4399233">//&nbsp;len(&#34;defer&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4399250">}</span><br>
<span class="lineno">1750</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4399254">return</span>&nbsp;<span class="op" id="4399261">&amp;</span><span class="ident" id="4399262">ast</span><span class="op" id="4399265">.</span><span class="ident" id="4399266">DeferStmt</span><span class="op" id="4399275">{</span><span class="ident" id="4399276">Defer</span><span class="op" id="4399281">:</span>&nbsp;<span class="ident" id="4399283">pos</span><span class="op" id="4399286">,</span>&nbsp;<span class="ident" id="4399288">Call</span><span class="op" id="4399292">:</span>&nbsp;<span class="ident" id="4399294">call</span><span class="op" id="4399298">}</span><br>
<span class="lineno"></span><span class="op" id="4399300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4399303">func</span>&nbsp;<span class="op" id="4399308">(</span><span class="ident" id="4399309">p</span>&nbsp;<span class="op" id="4399311">*</span><span class="ident" id="4399312">parser</span><span class="op" id="4399318">)</span>&nbsp;<span class="ident" id="4399320">parseReturnStmt</span><span class="op" id="4399335">(</span><span class="op" id="4399336">)</span>&nbsp;<span class="op" id="4399338">*</span><span class="ident" id="4399339">ast</span><span class="op" id="4399342">.</span><span class="ident" id="4399343">ReturnStmt</span>&nbsp;<span class="op" id="4399354">{</span><br>
<span class="lineno">1755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4399357">if</span>&nbsp;<span class="ident" id="4399360">p</span><span class="op" id="4399361">.</span><span class="ident" id="4399362">trace</span>&nbsp;<span class="op" id="4399368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4399372">defer</span>&nbsp;<span class="ident" id="4399378">un</span><span class="op" id="4399380">(</span><span class="ident" id="4399381">trace</span><span class="op" id="4399386">(</span><span class="ident" id="4399387">p</span><span class="op" id="4399388">,</span>&nbsp;<span class="string" id="4399390">&#34;ReturnStmt&#34;</span><span class="op" id="4399402">)</span><span class="op" id="4399403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4399406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4399410">pos</span>&nbsp;<span class="op" id="4399414">:=</span>&nbsp;<span class="ident" id="4399417">p</span><span class="op" id="4399418">.</span><span class="ident" id="4399419">pos</span><br>
<span class="lineno">1760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4399424">p</span><span class="op" id="4399425">.</span><span class="ident" id="4399426">expect</span><span class="op" id="4399432">(</span><span class="ident" id="4399433">token</span><span class="op" id="4399438">.</span><span class="ident" id="4399439">RETURN</span><span class="op" id="4399445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4399448">var</span>&nbsp;<span class="ident" id="4399452">x</span>&nbsp;<span class="op" id="4399454">[</span><span class="op" id="4399455">]</span><span class="ident" id="4399456">ast</span><span class="op" id="4399459">.</span><span class="ident" id="4399460">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4399466">if</span>&nbsp;<span class="ident" id="4399469">p</span><span class="op" id="4399470">.</span><span class="ident" id="4399471">tok</span>&nbsp;<span class="op" id="4399475">!=</span>&nbsp;<span class="ident" id="4399478">token</span><span class="op" id="4399483">.</span><span class="ident" id="4399484">SEMICOLON</span>&nbsp;<span class="op" id="4399494">&amp;&amp;</span>&nbsp;<span class="ident" id="4399497">p</span><span class="op" id="4399498">.</span><span class="ident" id="4399499">tok</span>&nbsp;<span class="op" id="4399503">!=</span>&nbsp;<span class="ident" id="4399506">token</span><span class="op" id="4399511">.</span><span class="ident" id="4399512">RBRACE</span>&nbsp;<span class="op" id="4399519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4399523">x</span>&nbsp;<span class="op" id="4399525">=</span>&nbsp;<span class="ident" id="4399527">p</span><span class="op" id="4399528">.</span><span class="ident" id="4399529">parseRhsList</span><span class="op" id="4399541">(</span><span class="op" id="4399542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4399545">}</span><br>
<span class="lineno">1765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4399548">p</span><span class="op" id="4399549">.</span><span class="ident" id="4399550">expectSemi</span><span class="op" id="4399560">(</span><span class="op" id="4399561">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4399565">return</span>&nbsp;<span class="op" id="4399572">&amp;</span><span class="ident" id="4399573">ast</span><span class="op" id="4399576">.</span><span class="ident" id="4399577">ReturnStmt</span><span class="op" id="4399587">{</span><span class="ident" id="4399588">Return</span><span class="op" id="4399594">:</span>&nbsp;<span class="ident" id="4399596">pos</span><span class="op" id="4399599">,</span>&nbsp;<span class="ident" id="4399601">Results</span><span class="op" id="4399608">:</span>&nbsp;<span class="ident" id="4399610">x</span><span class="op" id="4399611">}</span><br>
<span class="lineno"></span><span class="op" id="4399613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1770</span><span class="keyword" id="4399616">func</span>&nbsp;<span class="op" id="4399621">(</span><span class="ident" id="4399622">p</span>&nbsp;<span class="op" id="4399624">*</span><span class="ident" id="4399625">parser</span><span class="op" id="4399631">)</span>&nbsp;<span class="ident" id="4399633">parseBranchStmt</span><span class="op" id="4399648">(</span><span class="ident" id="4399649">tok</span>&nbsp;<span class="ident" id="4399653">token</span><span class="op" id="4399658">.</span><span class="ident" id="4399659">Token</span><span class="op" id="4399664">)</span>&nbsp;<span class="op" id="4399666">*</span><span class="ident" id="4399667">ast</span><span class="op" id="4399670">.</span><span class="ident" id="4399671">BranchStmt</span>&nbsp;<span class="op" id="4399682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4399685">if</span>&nbsp;<span class="ident" id="4399688">p</span><span class="op" id="4399689">.</span><span class="ident" id="4399690">trace</span>&nbsp;<span class="op" id="4399696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4399700">defer</span>&nbsp;<span class="ident" id="4399706">un</span><span class="op" id="4399708">(</span><span class="ident" id="4399709">trace</span><span class="op" id="4399714">(</span><span class="ident" id="4399715">p</span><span class="op" id="4399716">,</span>&nbsp;<span class="string" id="4399718">&#34;BranchStmt&#34;</span><span class="op" id="4399730">)</span><span class="op" id="4399731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4399734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4399738">pos</span>&nbsp;<span class="op" id="4399742">:=</span>&nbsp;<span class="ident" id="4399745">p</span><span class="op" id="4399746">.</span><span class="ident" id="4399747">expect</span><span class="op" id="4399753">(</span><span class="ident" id="4399754">tok</span><span class="op" id="4399757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4399760">var</span>&nbsp;<span class="ident" id="4399764">label</span>&nbsp;<span class="op" id="4399770">*</span><span class="ident" id="4399771">ast</span><span class="op" id="4399774">.</span><span class="ident" id="4399775">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4399782">if</span>&nbsp;<span class="ident" id="4399785">tok</span>&nbsp;<span class="op" id="4399789">!=</span>&nbsp;<span class="ident" id="4399792">token</span><span class="op" id="4399797">.</span><span class="ident" id="4399798">FALLTHROUGH</span>&nbsp;<span class="op" id="4399810">&amp;&amp;</span>&nbsp;<span class="ident" id="4399813">p</span><span class="op" id="4399814">.</span><span class="ident" id="4399815">tok</span>&nbsp;<span class="op" id="4399819">==</span>&nbsp;<span class="ident" id="4399822">token</span><span class="op" id="4399827">.</span><span class="ident" id="4399828">IDENT</span>&nbsp;<span class="op" id="4399834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4399838">label</span>&nbsp;<span class="op" id="4399844">=</span>&nbsp;<span class="ident" id="4399846">p</span><span class="op" id="4399847">.</span><span class="ident" id="4399848">parseIdent</span><span class="op" id="4399858">(</span><span class="op" id="4399859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4399863">//&nbsp;add&nbsp;to&nbsp;list&nbsp;of&nbsp;unresolved&nbsp;targets</span><br>
<span class="lineno">1780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4399902">n</span>&nbsp;<span class="op" id="4399904">:=</span>&nbsp;<span class="builtinfunc" id="4399907">len</span><span class="op" id="4399910">(</span><span class="ident" id="4399911">p</span><span class="op" id="4399912">.</span><span class="ident" id="4399913">targetStack</span><span class="op" id="4399924">)</span>&nbsp;<span class="op" id="4399926">-</span>&nbsp;<span class="num" id="4399928">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4399932">p</span><span class="op" id="4399933">.</span><span class="ident" id="4399934">targetStack</span><span class="op" id="4399945">[</span><span class="ident" id="4399946">n</span><span class="op" id="4399947">]</span>&nbsp;<span class="op" id="4399949">=</span>&nbsp;<span class="builtinfunc" id="4399951">append</span><span class="op" id="4399957">(</span><span class="ident" id="4399958">p</span><span class="op" id="4399959">.</span><span class="ident" id="4399960">targetStack</span><span class="op" id="4399971">[</span><span class="ident" id="4399972">n</span><span class="op" id="4399973">]</span><span class="op" id="4399974">,</span>&nbsp;<span class="ident" id="4399976">label</span><span class="op" id="4399981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4399984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4399987">p</span><span class="op" id="4399988">.</span><span class="ident" id="4399989">expectSemi</span><span class="op" id="4399999">(</span><span class="op" id="4400000">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1785</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4400004">return</span>&nbsp;<span class="op" id="4400011">&amp;</span><span class="ident" id="4400012">ast</span><span class="op" id="4400015">.</span><span class="ident" id="4400016">BranchStmt</span><span class="op" id="4400026">{</span><span class="ident" id="4400027">TokPos</span><span class="op" id="4400033">:</span>&nbsp;<span class="ident" id="4400035">pos</span><span class="op" id="4400038">,</span>&nbsp;<span class="ident" id="4400040">Tok</span><span class="op" id="4400043">:</span>&nbsp;<span class="ident" id="4400045">tok</span><span class="op" id="4400048">,</span>&nbsp;<span class="ident" id="4400050">Label</span><span class="op" id="4400055">:</span>&nbsp;<span class="ident" id="4400057">label</span><span class="op" id="4400062">}</span><br>
<span class="lineno"></span><span class="op" id="4400064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4400067">func</span>&nbsp;<span class="op" id="4400072">(</span><span class="ident" id="4400073">p</span>&nbsp;<span class="op" id="4400075">*</span><span class="ident" id="4400076">parser</span><span class="op" id="4400082">)</span>&nbsp;<span class="ident" id="4400084">makeExpr</span><span class="op" id="4400092">(</span><span class="ident" id="4400093">s</span>&nbsp;<span class="ident" id="4400095">ast</span><span class="op" id="4400098">.</span><span class="ident" id="4400099">Stmt</span><span class="op" id="4400103">,</span>&nbsp;<span class="ident" id="4400105">kind</span>&nbsp;<span class="builtintype" id="4400110">string</span><span class="op" id="4400116">)</span>&nbsp;<span class="ident" id="4400118">ast</span><span class="op" id="4400121">.</span><span class="ident" id="4400122">Expr</span>&nbsp;<span class="op" id="4400127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4400130">if</span>&nbsp;<span class="ident" id="4400133">s</span>&nbsp;<span class="op" id="4400135">==</span>&nbsp;<span class="ident" id="4400138">nil</span>&nbsp;<span class="op" id="4400142">{</span><br>
<span class="lineno">1790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4400146">return</span>&nbsp;<span class="ident" id="4400153">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4400158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4400161">if</span>&nbsp;<span class="ident" id="4400164">es</span><span class="op" id="4400166">,</span>&nbsp;<span class="ident" id="4400168">isExpr</span>&nbsp;<span class="op" id="4400175">:=</span>&nbsp;<span class="ident" id="4400178">s</span><span class="op" id="4400179">.</span><span class="op" id="4400180">(</span><span class="op" id="4400181">*</span><span class="ident" id="4400182">ast</span><span class="op" id="4400185">.</span><span class="ident" id="4400186">ExprStmt</span><span class="op" id="4400194">)</span><span class="op" id="4400195">;</span>&nbsp;<span class="ident" id="4400197">isExpr</span>&nbsp;<span class="op" id="4400204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4400208">return</span>&nbsp;<span class="ident" id="4400215">p</span><span class="op" id="4400216">.</span><span class="ident" id="4400217">checkExpr</span><span class="op" id="4400226">(</span><span class="ident" id="4400227">es</span><span class="op" id="4400229">.</span><span class="ident" id="4400230">X</span><span class="op" id="4400231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4400234">}</span><br>
<span class="lineno">1795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4400237">p</span><span class="op" id="4400238">.</span><span class="builtintype" id="4400239">error</span><span class="op" id="4400244">(</span><span class="ident" id="4400245">s</span><span class="op" id="4400246">.</span><span class="ident" id="4400247">Pos</span><span class="op" id="4400250">(</span><span class="op" id="4400251">)</span><span class="op" id="4400252">,</span>&nbsp;<span class="ident" id="4400254">fmt</span><span class="op" id="4400257">.</span><span class="ident" id="4400258">Sprintf</span><span class="op" id="4400265">(</span><span class="string" id="4400266">&#34;expected&nbsp;%s,&nbsp;found&nbsp;simple&nbsp;statement&nbsp;(missing&nbsp;parentheses&nbsp;around&nbsp;composite&nbsp;literal?)&#34;</span><span class="op" id="4400351">,</span>&nbsp;<span class="ident" id="4400353">kind</span><span class="op" id="4400357">)</span><span class="op" id="4400358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4400361">return</span>&nbsp;<span class="op" id="4400368">&amp;</span><span class="ident" id="4400369">ast</span><span class="op" id="4400372">.</span><span class="ident" id="4400373">BadExpr</span><span class="op" id="4400380">{</span><span class="ident" id="4400381">From</span><span class="op" id="4400385">:</span>&nbsp;<span class="ident" id="4400387">s</span><span class="op" id="4400388">.</span><span class="ident" id="4400389">Pos</span><span class="op" id="4400392">(</span><span class="op" id="4400393">)</span><span class="op" id="4400394">,</span>&nbsp;<span class="ident" id="4400396">To</span><span class="op" id="4400398">:</span>&nbsp;<span class="ident" id="4400400">p</span><span class="op" id="4400401">.</span><span class="ident" id="4400402">safePos</span><span class="op" id="4400409">(</span><span class="ident" id="4400410">s</span><span class="op" id="4400411">.</span><span class="ident" id="4400412">End</span><span class="op" id="4400415">(</span><span class="op" id="4400416">)</span><span class="op" id="4400417">)</span><span class="op" id="4400418">}</span><br>
<span class="lineno"></span><span class="op" id="4400420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4400423">func</span>&nbsp;<span class="op" id="4400428">(</span><span class="ident" id="4400429">p</span>&nbsp;<span class="op" id="4400431">*</span><span class="ident" id="4400432">parser</span><span class="op" id="4400438">)</span>&nbsp;<span class="ident" id="4400440">parseIfStmt</span><span class="op" id="4400451">(</span><span class="op" id="4400452">)</span>&nbsp;<span class="op" id="4400454">*</span><span class="ident" id="4400455">ast</span><span class="op" id="4400458">.</span><span class="ident" id="4400459">IfStmt</span>&nbsp;<span class="op" id="4400466">{</span><br>
<span class="lineno">1800</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4400469">if</span>&nbsp;<span class="ident" id="4400472">p</span><span class="op" id="4400473">.</span><span class="ident" id="4400474">trace</span>&nbsp;<span class="op" id="4400480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4400484">defer</span>&nbsp;<span class="ident" id="4400490">un</span><span class="op" id="4400492">(</span><span class="ident" id="4400493">trace</span><span class="op" id="4400498">(</span><span class="ident" id="4400499">p</span><span class="op" id="4400500">,</span>&nbsp;<span class="string" id="4400502">&#34;IfStmt&#34;</span><span class="op" id="4400510">)</span><span class="op" id="4400511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4400514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4400518">pos</span>&nbsp;<span class="op" id="4400522">:=</span>&nbsp;<span class="ident" id="4400525">p</span><span class="op" id="4400526">.</span><span class="ident" id="4400527">expect</span><span class="op" id="4400533">(</span><span class="ident" id="4400534">token</span><span class="op" id="4400539">.</span><span class="ident" id="4400540">IF</span><span class="op" id="4400542">)</span><br>
<span class="lineno">1805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4400545">p</span><span class="op" id="4400546">.</span><span class="ident" id="4400547">openScope</span><span class="op" id="4400556">(</span><span class="op" id="4400557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4400560">defer</span>&nbsp;<span class="ident" id="4400566">p</span><span class="op" id="4400567">.</span><span class="ident" id="4400568">closeScope</span><span class="op" id="4400578">(</span><span class="op" id="4400579">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4400583">var</span>&nbsp;<span class="ident" id="4400587">s</span>&nbsp;<span class="ident" id="4400589">ast</span><span class="op" id="4400592">.</span><span class="ident" id="4400593">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4400599">var</span>&nbsp;<span class="ident" id="4400603">x</span>&nbsp;<span class="ident" id="4400605">ast</span><span class="op" id="4400608">.</span><span class="ident" id="4400609">Expr</span><br>
<span class="lineno">1810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4400615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4400619">prevLev</span>&nbsp;<span class="op" id="4400627">:=</span>&nbsp;<span class="ident" id="4400630">p</span><span class="op" id="4400631">.</span><span class="ident" id="4400632">exprLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4400642">p</span><span class="op" id="4400643">.</span><span class="ident" id="4400644">exprLev</span>&nbsp;<span class="op" id="4400652">=</span>&nbsp;<span class="op" id="4400654">-</span><span class="num" id="4400655">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4400659">if</span>&nbsp;<span class="ident" id="4400662">p</span><span class="op" id="4400663">.</span><span class="ident" id="4400664">tok</span>&nbsp;<span class="op" id="4400668">==</span>&nbsp;<span class="ident" id="4400671">token</span><span class="op" id="4400676">.</span><span class="ident" id="4400677">SEMICOLON</span>&nbsp;<span class="op" id="4400687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4400692">p</span><span class="op" id="4400693">.</span><span class="ident" id="4400694">next</span><span class="op" id="4400698">(</span><span class="op" id="4400699">)</span><br>
<span class="lineno">1815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4400704">x</span>&nbsp;<span class="op" id="4400706">=</span>&nbsp;<span class="ident" id="4400708">p</span><span class="op" id="4400709">.</span><span class="ident" id="4400710">parseRhs</span><span class="op" id="4400718">(</span><span class="op" id="4400719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4400723">}</span>&nbsp;<span class="keyword" id="4400725">else</span>&nbsp;<span class="op" id="4400730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4400735">s</span><span class="op" id="4400736">,</span>&nbsp;<span class="ident" id="4400738">_</span>&nbsp;<span class="op" id="4400740">=</span>&nbsp;<span class="ident" id="4400742">p</span><span class="op" id="4400743">.</span><span class="ident" id="4400744">parseSimpleStmt</span><span class="op" id="4400759">(</span><span class="ident" id="4400760">basic</span><span class="op" id="4400765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4400770">if</span>&nbsp;<span class="ident" id="4400773">p</span><span class="op" id="4400774">.</span><span class="ident" id="4400775">tok</span>&nbsp;<span class="op" id="4400779">==</span>&nbsp;<span class="ident" id="4400782">token</span><span class="op" id="4400787">.</span><span class="ident" id="4400788">SEMICOLON</span>&nbsp;<span class="op" id="4400798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4400804">p</span><span class="op" id="4400805">.</span><span class="ident" id="4400806">next</span><span class="op" id="4400810">(</span><span class="op" id="4400811">)</span><br>
<span class="lineno">1820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4400817">x</span>&nbsp;<span class="op" id="4400819">=</span>&nbsp;<span class="ident" id="4400821">p</span><span class="op" id="4400822">.</span><span class="ident" id="4400823">parseRhs</span><span class="op" id="4400831">(</span><span class="op" id="4400832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4400837">}</span>&nbsp;<span class="keyword" id="4400839">else</span>&nbsp;<span class="op" id="4400844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4400850">x</span>&nbsp;<span class="op" id="4400852">=</span>&nbsp;<span class="ident" id="4400854">p</span><span class="op" id="4400855">.</span><span class="ident" id="4400856">makeExpr</span><span class="op" id="4400864">(</span><span class="ident" id="4400865">s</span><span class="op" id="4400866">,</span>&nbsp;<span class="string" id="4400868">&#34;boolean&nbsp;expression&#34;</span><span class="op" id="4400888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4400894">s</span>&nbsp;<span class="op" id="4400896">=</span>&nbsp;<span class="ident" id="4400898">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4400905">}</span><br>
<span class="lineno">1825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4400909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4400913">p</span><span class="op" id="4400914">.</span><span class="ident" id="4400915">exprLev</span>&nbsp;<span class="op" id="4400923">=</span>&nbsp;<span class="ident" id="4400925">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4400934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4400938">body</span>&nbsp;<span class="op" id="4400943">:=</span>&nbsp;<span class="ident" id="4400946">p</span><span class="op" id="4400947">.</span><span class="ident" id="4400948">parseBlockStmt</span><span class="op" id="4400962">(</span><span class="op" id="4400963">)</span><br>
<span class="lineno">1830</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4400966">var</span>&nbsp;<span class="ident" id="4400970">else_</span>&nbsp;<span class="ident" id="4400976">ast</span><span class="op" id="4400979">.</span><span class="ident" id="4400980">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4400986">if</span>&nbsp;<span class="ident" id="4400989">p</span><span class="op" id="4400990">.</span><span class="ident" id="4400991">tok</span>&nbsp;<span class="op" id="4400995">==</span>&nbsp;<span class="ident" id="4400998">token</span><span class="op" id="4401003">.</span><span class="ident" id="4401004">ELSE</span>&nbsp;<span class="op" id="4401009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4401013">p</span><span class="op" id="4401014">.</span><span class="ident" id="4401015">next</span><span class="op" id="4401019">(</span><span class="op" id="4401020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4401024">else_</span>&nbsp;<span class="op" id="4401030">=</span>&nbsp;<span class="ident" id="4401032">p</span><span class="op" id="4401033">.</span><span class="ident" id="4401034">parseStmt</span><span class="op" id="4401043">(</span><span class="op" id="4401044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4401047">}</span>&nbsp;<span class="keyword" id="4401049">else</span>&nbsp;<span class="op" id="4401054">{</span><br>
<span class="lineno">1835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4401058">p</span><span class="op" id="4401059">.</span><span class="ident" id="4401060">expectSemi</span><span class="op" id="4401070">(</span><span class="op" id="4401071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4401074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4401078">return</span>&nbsp;<span class="op" id="4401085">&amp;</span><span class="ident" id="4401086">ast</span><span class="op" id="4401089">.</span><span class="ident" id="4401090">IfStmt</span><span class="op" id="4401096">{</span><span class="ident" id="4401097">If</span><span class="op" id="4401099">:</span>&nbsp;<span class="ident" id="4401101">pos</span><span class="op" id="4401104">,</span>&nbsp;<span class="ident" id="4401106">Init</span><span class="op" id="4401110">:</span>&nbsp;<span class="ident" id="4401112">s</span><span class="op" id="4401113">,</span>&nbsp;<span class="ident" id="4401115">Cond</span><span class="op" id="4401119">:</span>&nbsp;<span class="ident" id="4401121">x</span><span class="op" id="4401122">,</span>&nbsp;<span class="ident" id="4401124">Body</span><span class="op" id="4401128">:</span>&nbsp;<span class="ident" id="4401130">body</span><span class="op" id="4401134">,</span>&nbsp;<span class="ident" id="4401136">Else</span><span class="op" id="4401140">:</span>&nbsp;<span class="ident" id="4401142">else_</span><span class="op" id="4401147">}</span><br>
<span class="lineno"></span><span class="op" id="4401149">}</span><br>
<span class="lineno">1840</span><br>
<span class="lineno"></span><span class="keyword" id="4401152">func</span>&nbsp;<span class="op" id="4401157">(</span><span class="ident" id="4401158">p</span>&nbsp;<span class="op" id="4401160">*</span><span class="ident" id="4401161">parser</span><span class="op" id="4401167">)</span>&nbsp;<span class="ident" id="4401169">parseTypeList</span><span class="op" id="4401182">(</span><span class="op" id="4401183">)</span>&nbsp;<span class="op" id="4401185">(</span><span class="ident" id="4401186">list</span>&nbsp;<span class="op" id="4401191">[</span><span class="op" id="4401192">]</span><span class="ident" id="4401193">ast</span><span class="op" id="4401196">.</span><span class="ident" id="4401197">Expr</span><span class="op" id="4401201">)</span>&nbsp;<span class="op" id="4401203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4401206">if</span>&nbsp;<span class="ident" id="4401209">p</span><span class="op" id="4401210">.</span><span class="ident" id="4401211">trace</span>&nbsp;<span class="op" id="4401217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4401221">defer</span>&nbsp;<span class="ident" id="4401227">un</span><span class="op" id="4401229">(</span><span class="ident" id="4401230">trace</span><span class="op" id="4401235">(</span><span class="ident" id="4401236">p</span><span class="op" id="4401237">,</span>&nbsp;<span class="string" id="4401239">&#34;TypeList&#34;</span><span class="op" id="4401249">)</span><span class="op" id="4401250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4401253">}</span><br>
<span class="lineno">1845</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4401257">list</span>&nbsp;<span class="op" id="4401262">=</span>&nbsp;<span class="builtinfunc" id="4401264">append</span><span class="op" id="4401270">(</span><span class="ident" id="4401271">list</span><span class="op" id="4401275">,</span>&nbsp;<span class="ident" id="4401277">p</span><span class="op" id="4401278">.</span><span class="ident" id="4401279">parseType</span><span class="op" id="4401288">(</span><span class="op" id="4401289">)</span><span class="op" id="4401290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4401293">for</span>&nbsp;<span class="ident" id="4401297">p</span><span class="op" id="4401298">.</span><span class="ident" id="4401299">tok</span>&nbsp;<span class="op" id="4401303">==</span>&nbsp;<span class="ident" id="4401306">token</span><span class="op" id="4401311">.</span><span class="ident" id="4401312">COMMA</span>&nbsp;<span class="op" id="4401318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4401322">p</span><span class="op" id="4401323">.</span><span class="ident" id="4401324">next</span><span class="op" id="4401328">(</span><span class="op" id="4401329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4401333">list</span>&nbsp;<span class="op" id="4401338">=</span>&nbsp;<span class="builtinfunc" id="4401340">append</span><span class="op" id="4401346">(</span><span class="ident" id="4401347">list</span><span class="op" id="4401351">,</span>&nbsp;<span class="ident" id="4401353">p</span><span class="op" id="4401354">.</span><span class="ident" id="4401355">parseType</span><span class="op" id="4401364">(</span><span class="op" id="4401365">)</span><span class="op" id="4401366">)</span><br>
<span class="lineno">1850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4401369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4401373">return</span><br>
<span class="lineno"></span><span class="op" id="4401380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1855</span><span class="keyword" id="4401383">func</span>&nbsp;<span class="op" id="4401388">(</span><span class="ident" id="4401389">p</span>&nbsp;<span class="op" id="4401391">*</span><span class="ident" id="4401392">parser</span><span class="op" id="4401398">)</span>&nbsp;<span class="ident" id="4401400">parseCaseClause</span><span class="op" id="4401415">(</span><span class="ident" id="4401416">typeSwitch</span>&nbsp;<span class="builtintype" id="4401427">bool</span><span class="op" id="4401431">)</span>&nbsp;<span class="op" id="4401433">*</span><span class="ident" id="4401434">ast</span><span class="op" id="4401437">.</span><span class="ident" id="4401438">CaseClause</span>&nbsp;<span class="op" id="4401449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4401452">if</span>&nbsp;<span class="ident" id="4401455">p</span><span class="op" id="4401456">.</span><span class="ident" id="4401457">trace</span>&nbsp;<span class="op" id="4401463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4401467">defer</span>&nbsp;<span class="ident" id="4401473">un</span><span class="op" id="4401475">(</span><span class="ident" id="4401476">trace</span><span class="op" id="4401481">(</span><span class="ident" id="4401482">p</span><span class="op" id="4401483">,</span>&nbsp;<span class="string" id="4401485">&#34;CaseClause&#34;</span><span class="op" id="4401497">)</span><span class="op" id="4401498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4401501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4401505">pos</span>&nbsp;<span class="op" id="4401509">:=</span>&nbsp;<span class="ident" id="4401512">p</span><span class="op" id="4401513">.</span><span class="ident" id="4401514">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4401519">var</span>&nbsp;<span class="ident" id="4401523">list</span>&nbsp;<span class="op" id="4401528">[</span><span class="op" id="4401529">]</span><span class="ident" id="4401530">ast</span><span class="op" id="4401533">.</span><span class="ident" id="4401534">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4401540">if</span>&nbsp;<span class="ident" id="4401543">p</span><span class="op" id="4401544">.</span><span class="ident" id="4401545">tok</span>&nbsp;<span class="op" id="4401549">==</span>&nbsp;<span class="ident" id="4401552">token</span><span class="op" id="4401557">.</span><span class="ident" id="4401558">CASE</span>&nbsp;<span class="op" id="4401563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4401567">p</span><span class="op" id="4401568">.</span><span class="ident" id="4401569">next</span><span class="op" id="4401573">(</span><span class="op" id="4401574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4401578">if</span>&nbsp;<span class="ident" id="4401581">typeSwitch</span>&nbsp;<span class="op" id="4401592">{</span><br>
<span class="lineno">1865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4401597">list</span>&nbsp;<span class="op" id="4401602">=</span>&nbsp;<span class="ident" id="4401604">p</span><span class="op" id="4401605">.</span><span class="ident" id="4401606">parseTypeList</span><span class="op" id="4401619">(</span><span class="op" id="4401620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4401624">}</span>&nbsp;<span class="keyword" id="4401626">else</span>&nbsp;<span class="op" id="4401631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4401636">list</span>&nbsp;<span class="op" id="4401641">=</span>&nbsp;<span class="ident" id="4401643">p</span><span class="op" id="4401644">.</span><span class="ident" id="4401645">parseRhsList</span><span class="op" id="4401657">(</span><span class="op" id="4401658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4401662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4401665">}</span>&nbsp;<span class="keyword" id="4401667">else</span>&nbsp;<span class="op" id="4401672">{</span><br>
<span class="lineno">1870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4401676">p</span><span class="op" id="4401677">.</span><span class="ident" id="4401678">expect</span><span class="op" id="4401684">(</span><span class="ident" id="4401685">token</span><span class="op" id="4401690">.</span><span class="ident" id="4401691">DEFAULT</span><span class="op" id="4401698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4401701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4401705">colon</span>&nbsp;<span class="op" id="4401711">:=</span>&nbsp;<span class="ident" id="4401714">p</span><span class="op" id="4401715">.</span><span class="ident" id="4401716">expect</span><span class="op" id="4401722">(</span><span class="ident" id="4401723">token</span><span class="op" id="4401728">.</span><span class="ident" id="4401729">COLON</span><span class="op" id="4401734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4401737">p</span><span class="op" id="4401738">.</span><span class="ident" id="4401739">openScope</span><span class="op" id="4401748">(</span><span class="op" id="4401749">)</span><br>
<span class="lineno">1875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4401752">body</span>&nbsp;<span class="op" id="4401757">:=</span>&nbsp;<span class="ident" id="4401760">p</span><span class="op" id="4401761">.</span><span class="ident" id="4401762">parseStmtList</span><span class="op" id="4401775">(</span><span class="op" id="4401776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4401779">p</span><span class="op" id="4401780">.</span><span class="ident" id="4401781">closeScope</span><span class="op" id="4401791">(</span><span class="op" id="4401792">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4401796">return</span>&nbsp;<span class="op" id="4401803">&amp;</span><span class="ident" id="4401804">ast</span><span class="op" id="4401807">.</span><span class="ident" id="4401808">CaseClause</span><span class="op" id="4401818">{</span><span class="ident" id="4401819">Case</span><span class="op" id="4401823">:</span>&nbsp;<span class="ident" id="4401825">pos</span><span class="op" id="4401828">,</span>&nbsp;<span class="ident" id="4401830">List</span><span class="op" id="4401834">:</span>&nbsp;<span class="ident" id="4401836">list</span><span class="op" id="4401840">,</span>&nbsp;<span class="ident" id="4401842">Colon</span><span class="op" id="4401847">:</span>&nbsp;<span class="ident" id="4401849">colon</span><span class="op" id="4401854">,</span>&nbsp;<span class="ident" id="4401856">Body</span><span class="op" id="4401860">:</span>&nbsp;<span class="ident" id="4401862">body</span><span class="op" id="4401866">}</span><br>
<span class="lineno"></span><span class="op" id="4401868">}</span><br>
<span class="lineno">1880</span><br>
<span class="lineno"></span><span class="keyword" id="4401871">func</span>&nbsp;<span class="ident" id="4401876">isTypeSwitchAssert</span><span class="op" id="4401894">(</span><span class="ident" id="4401895">x</span>&nbsp;<span class="ident" id="4401897">ast</span><span class="op" id="4401900">.</span><span class="ident" id="4401901">Expr</span><span class="op" id="4401905">)</span>&nbsp;<span class="builtintype" id="4401907">bool</span>&nbsp;<span class="op" id="4401912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4401915">a</span><span class="op" id="4401916">,</span>&nbsp;<span class="ident" id="4401918">ok</span>&nbsp;<span class="op" id="4401921">:=</span>&nbsp;<span class="ident" id="4401924">x</span><span class="op" id="4401925">.</span><span class="op" id="4401926">(</span><span class="op" id="4401927">*</span><span class="ident" id="4401928">ast</span><span class="op" id="4401931">.</span><span class="ident" id="4401932">TypeAssertExpr</span><span class="op" id="4401946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4401949">return</span>&nbsp;<span class="ident" id="4401956">ok</span>&nbsp;<span class="op" id="4401959">&amp;&amp;</span>&nbsp;<span class="ident" id="4401962">a</span><span class="op" id="4401963">.</span><span class="ident" id="4401964">Type</span>&nbsp;<span class="op" id="4401969">==</span>&nbsp;<span class="ident" id="4401972">nil</span><br>
<span class="lineno"></span><span class="op" id="4401976">}</span><br>
<span class="lineno">1885</span><br>
<span class="lineno"></span><span class="keyword" id="4401979">func</span>&nbsp;<span class="ident" id="4401984">isTypeSwitchGuard</span><span class="op" id="4402001">(</span><span class="ident" id="4402002">s</span>&nbsp;<span class="ident" id="4402004">ast</span><span class="op" id="4402007">.</span><span class="ident" id="4402008">Stmt</span><span class="op" id="4402012">)</span>&nbsp;<span class="builtintype" id="4402014">bool</span>&nbsp;<span class="op" id="4402019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402022">switch</span>&nbsp;<span class="ident" id="4402029">t</span>&nbsp;<span class="op" id="4402031">:=</span>&nbsp;<span class="ident" id="4402034">s</span><span class="op" id="4402035">.</span><span class="op" id="4402036">(</span><span class="keyword" id="4402037">type</span><span class="op" id="4402041">)</span>&nbsp;<span class="op" id="4402043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402046">case</span>&nbsp;<span class="op" id="4402051">*</span><span class="ident" id="4402052">ast</span><span class="op" id="4402055">.</span><span class="ident" id="4402056">ExprStmt</span><span class="op" id="4402064">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4402068">//&nbsp;x.(nil)</span><br>
<span class="lineno">1890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402081">return</span>&nbsp;<span class="ident" id="4402088">isTypeSwitchAssert</span><span class="op" id="4402106">(</span><span class="ident" id="4402107">t</span><span class="op" id="4402108">.</span><span class="ident" id="4402109">X</span><span class="op" id="4402110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402113">case</span>&nbsp;<span class="op" id="4402118">*</span><span class="ident" id="4402119">ast</span><span class="op" id="4402122">.</span><span class="ident" id="4402123">AssignStmt</span><span class="op" id="4402133">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4402137">//&nbsp;v&nbsp;:=&nbsp;x.(nil)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402155">return</span>&nbsp;<span class="builtinfunc" id="4402162">len</span><span class="op" id="4402165">(</span><span class="ident" id="4402166">t</span><span class="op" id="4402167">.</span><span class="ident" id="4402168">Lhs</span><span class="op" id="4402171">)</span>&nbsp;<span class="op" id="4402173">==</span>&nbsp;<span class="num" id="4402176">1</span>&nbsp;<span class="op" id="4402178">&amp;&amp;</span>&nbsp;<span class="ident" id="4402181">t</span><span class="op" id="4402182">.</span><span class="ident" id="4402183">Tok</span>&nbsp;<span class="op" id="4402187">==</span>&nbsp;<span class="ident" id="4402190">token</span><span class="op" id="4402195">.</span><span class="ident" id="4402196">DEFINE</span>&nbsp;<span class="op" id="4402203">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4402206">len</span><span class="op" id="4402209">(</span><span class="ident" id="4402210">t</span><span class="op" id="4402211">.</span><span class="ident" id="4402212">Rhs</span><span class="op" id="4402215">)</span>&nbsp;<span class="op" id="4402217">==</span>&nbsp;<span class="num" id="4402220">1</span>&nbsp;<span class="op" id="4402222">&amp;&amp;</span>&nbsp;<span class="ident" id="4402225">isTypeSwitchAssert</span><span class="op" id="4402243">(</span><span class="ident" id="4402244">t</span><span class="op" id="4402245">.</span><span class="ident" id="4402246">Rhs</span><span class="op" id="4402249">[</span><span class="num" id="4402250">0</span><span class="op" id="4402251">]</span><span class="op" id="4402252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4402255">}</span><br>
<span class="lineno">1895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402258">return</span>&nbsp;<span class="builtintype" id="4402265">false</span><br>
<span class="lineno"></span><span class="op" id="4402271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4402274">func</span>&nbsp;<span class="op" id="4402279">(</span><span class="ident" id="4402280">p</span>&nbsp;<span class="op" id="4402282">*</span><span class="ident" id="4402283">parser</span><span class="op" id="4402289">)</span>&nbsp;<span class="ident" id="4402291">parseSwitchStmt</span><span class="op" id="4402306">(</span><span class="op" id="4402307">)</span>&nbsp;<span class="ident" id="4402309">ast</span><span class="op" id="4402312">.</span><span class="ident" id="4402313">Stmt</span>&nbsp;<span class="op" id="4402318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402321">if</span>&nbsp;<span class="ident" id="4402324">p</span><span class="op" id="4402325">.</span><span class="ident" id="4402326">trace</span>&nbsp;<span class="op" id="4402332">{</span><br>
<span class="lineno">1900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402336">defer</span>&nbsp;<span class="ident" id="4402342">un</span><span class="op" id="4402344">(</span><span class="ident" id="4402345">trace</span><span class="op" id="4402350">(</span><span class="ident" id="4402351">p</span><span class="op" id="4402352">,</span>&nbsp;<span class="string" id="4402354">&#34;SwitchStmt&#34;</span><span class="op" id="4402366">)</span><span class="op" id="4402367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4402370">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4402374">pos</span>&nbsp;<span class="op" id="4402378">:=</span>&nbsp;<span class="ident" id="4402381">p</span><span class="op" id="4402382">.</span><span class="ident" id="4402383">expect</span><span class="op" id="4402389">(</span><span class="ident" id="4402390">token</span><span class="op" id="4402395">.</span><span class="ident" id="4402396">SWITCH</span><span class="op" id="4402402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4402405">p</span><span class="op" id="4402406">.</span><span class="ident" id="4402407">openScope</span><span class="op" id="4402416">(</span><span class="op" id="4402417">)</span><br>
<span class="lineno">1905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402420">defer</span>&nbsp;<span class="ident" id="4402426">p</span><span class="op" id="4402427">.</span><span class="ident" id="4402428">closeScope</span><span class="op" id="4402438">(</span><span class="op" id="4402439">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402443">var</span>&nbsp;<span class="ident" id="4402447">s1</span><span class="op" id="4402449">,</span>&nbsp;<span class="ident" id="4402451">s2</span>&nbsp;<span class="ident" id="4402454">ast</span><span class="op" id="4402457">.</span><span class="ident" id="4402458">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402464">if</span>&nbsp;<span class="ident" id="4402467">p</span><span class="op" id="4402468">.</span><span class="ident" id="4402469">tok</span>&nbsp;<span class="op" id="4402473">!=</span>&nbsp;<span class="ident" id="4402476">token</span><span class="op" id="4402481">.</span><span class="ident" id="4402482">LBRACE</span>&nbsp;<span class="op" id="4402489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4402493">prevLev</span>&nbsp;<span class="op" id="4402501">:=</span>&nbsp;<span class="ident" id="4402504">p</span><span class="op" id="4402505">.</span><span class="ident" id="4402506">exprLev</span><br>
<span class="lineno">1910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4402516">p</span><span class="op" id="4402517">.</span><span class="ident" id="4402518">exprLev</span>&nbsp;<span class="op" id="4402526">=</span>&nbsp;<span class="op" id="4402528">-</span><span class="num" id="4402529">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402533">if</span>&nbsp;<span class="ident" id="4402536">p</span><span class="op" id="4402537">.</span><span class="ident" id="4402538">tok</span>&nbsp;<span class="op" id="4402542">!=</span>&nbsp;<span class="ident" id="4402545">token</span><span class="op" id="4402550">.</span><span class="ident" id="4402551">SEMICOLON</span>&nbsp;<span class="op" id="4402561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4402566">s2</span><span class="op" id="4402568">,</span>&nbsp;<span class="ident" id="4402570">_</span>&nbsp;<span class="op" id="4402572">=</span>&nbsp;<span class="ident" id="4402574">p</span><span class="op" id="4402575">.</span><span class="ident" id="4402576">parseSimpleStmt</span><span class="op" id="4402591">(</span><span class="ident" id="4402592">basic</span><span class="op" id="4402597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4402601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402605">if</span>&nbsp;<span class="ident" id="4402608">p</span><span class="op" id="4402609">.</span><span class="ident" id="4402610">tok</span>&nbsp;<span class="op" id="4402614">==</span>&nbsp;<span class="ident" id="4402617">token</span><span class="op" id="4402622">.</span><span class="ident" id="4402623">SEMICOLON</span>&nbsp;<span class="op" id="4402633">{</span><br>
<span class="lineno">1915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4402638">p</span><span class="op" id="4402639">.</span><span class="ident" id="4402640">next</span><span class="op" id="4402644">(</span><span class="op" id="4402645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4402650">s1</span>&nbsp;<span class="op" id="4402653">=</span>&nbsp;<span class="ident" id="4402655">s2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4402661">s2</span>&nbsp;<span class="op" id="4402664">=</span>&nbsp;<span class="ident" id="4402666">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402673">if</span>&nbsp;<span class="ident" id="4402676">p</span><span class="op" id="4402677">.</span><span class="ident" id="4402678">tok</span>&nbsp;<span class="op" id="4402682">!=</span>&nbsp;<span class="ident" id="4402685">token</span><span class="op" id="4402690">.</span><span class="ident" id="4402691">LBRACE</span>&nbsp;<span class="op" id="4402698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4402704">//&nbsp;A&nbsp;TypeSwitchGuard&nbsp;may&nbsp;declare&nbsp;a&nbsp;variable&nbsp;in&nbsp;addition</span><br>
<span class="lineno">1920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4402764">//&nbsp;to&nbsp;the&nbsp;variable&nbsp;declared&nbsp;in&nbsp;the&nbsp;initial&nbsp;SimpleStmt.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4402823">//&nbsp;Introduce&nbsp;extra&nbsp;scope&nbsp;to&nbsp;avoid&nbsp;redeclaration&nbsp;errors:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4402883">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4402890">//&nbsp;&nbsp;&nbsp;&nbspswitch&nbsp;t&nbsp;:=&nbsp;0;&nbsp;t&nbsp;:=&nbsp;x.(T)&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4402931">//</span><br>
<span class="lineno">1925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4402938">//&nbsp;(this&nbsp;code&nbsp;is&nbsp;not&nbsp;valid&nbsp;Go&nbsp;because&nbsp;the&nbsp;first&nbsp;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4402992">//&nbsp;cannot&nbsp;be&nbsp;accessed&nbsp;and&nbsp;thus&nbsp;is&nbsp;never&nbsp;used,&nbsp;the&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4403052">//&nbsp;scope&nbsp;is&nbsp;needed&nbsp;for&nbsp;the&nbsp;correct&nbsp;error&nbsp;message).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4403107">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4403114">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;a&nbsp;type&nbsp;switch,&nbsp;s2&nbsp;must&nbsp;be&nbsp;an&nbsp;expression.</span><br>
<span class="lineno">1930</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4403179">//&nbsp;Having&nbsp;the&nbsp;extra&nbsp;nested&nbsp;but&nbsp;empty&nbsp;scope&nbsp;won&#39;t&nbsp;affect&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4403243">p</span><span class="op" id="4403244">.</span><span class="ident" id="4403245">openScope</span><span class="op" id="4403254">(</span><span class="op" id="4403255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403261">defer</span>&nbsp;<span class="ident" id="4403267">p</span><span class="op" id="4403268">.</span><span class="ident" id="4403269">closeScope</span><span class="op" id="4403279">(</span><span class="op" id="4403280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4403286">s2</span><span class="op" id="4403288">,</span>&nbsp;<span class="ident" id="4403290">_</span>&nbsp;<span class="op" id="4403292">=</span>&nbsp;<span class="ident" id="4403294">p</span><span class="op" id="4403295">.</span><span class="ident" id="4403296">parseSimpleStmt</span><span class="op" id="4403311">(</span><span class="ident" id="4403312">basic</span><span class="op" id="4403317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4403322">}</span><br>
<span class="lineno">1935</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4403326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4403330">p</span><span class="op" id="4403331">.</span><span class="ident" id="4403332">exprLev</span>&nbsp;<span class="op" id="4403340">=</span>&nbsp;<span class="ident" id="4403342">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4403351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4403355">typeSwitch</span>&nbsp;<span class="op" id="4403366">:=</span>&nbsp;<span class="ident" id="4403369">isTypeSwitchGuard</span><span class="op" id="4403386">(</span><span class="ident" id="4403387">s2</span><span class="op" id="4403389">)</span><br>
<span class="lineno">1940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4403392">lbrace</span>&nbsp;<span class="op" id="4403399">:=</span>&nbsp;<span class="ident" id="4403402">p</span><span class="op" id="4403403">.</span><span class="ident" id="4403404">expect</span><span class="op" id="4403410">(</span><span class="ident" id="4403411">token</span><span class="op" id="4403416">.</span><span class="ident" id="4403417">LBRACE</span><span class="op" id="4403423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403426">var</span>&nbsp;<span class="ident" id="4403430">list</span>&nbsp;<span class="op" id="4403435">[</span><span class="op" id="4403436">]</span><span class="ident" id="4403437">ast</span><span class="op" id="4403440">.</span><span class="ident" id="4403441">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403447">for</span>&nbsp;<span class="ident" id="4403451">p</span><span class="op" id="4403452">.</span><span class="ident" id="4403453">tok</span>&nbsp;<span class="op" id="4403457">==</span>&nbsp;<span class="ident" id="4403460">token</span><span class="op" id="4403465">.</span><span class="ident" id="4403466">CASE</span>&nbsp;<span class="op" id="4403471">||</span>&nbsp;<span class="ident" id="4403474">p</span><span class="op" id="4403475">.</span><span class="ident" id="4403476">tok</span>&nbsp;<span class="op" id="4403480">==</span>&nbsp;<span class="ident" id="4403483">token</span><span class="op" id="4403488">.</span><span class="ident" id="4403489">DEFAULT</span>&nbsp;<span class="op" id="4403497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4403501">list</span>&nbsp;<span class="op" id="4403506">=</span>&nbsp;<span class="builtinfunc" id="4403508">append</span><span class="op" id="4403514">(</span><span class="ident" id="4403515">list</span><span class="op" id="4403519">,</span>&nbsp;<span class="ident" id="4403521">p</span><span class="op" id="4403522">.</span><span class="ident" id="4403523">parseCaseClause</span><span class="op" id="4403538">(</span><span class="ident" id="4403539">typeSwitch</span><span class="op" id="4403549">)</span><span class="op" id="4403550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4403553">}</span><br>
<span class="lineno">1945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4403556">rbrace</span>&nbsp;<span class="op" id="4403563">:=</span>&nbsp;<span class="ident" id="4403566">p</span><span class="op" id="4403567">.</span><span class="ident" id="4403568">expect</span><span class="op" id="4403574">(</span><span class="ident" id="4403575">token</span><span class="op" id="4403580">.</span><span class="ident" id="4403581">RBRACE</span><span class="op" id="4403587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4403590">p</span><span class="op" id="4403591">.</span><span class="ident" id="4403592">expectSemi</span><span class="op" id="4403602">(</span><span class="op" id="4403603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4403606">body</span>&nbsp;<span class="op" id="4403611">:=</span>&nbsp;<span class="op" id="4403614">&amp;</span><span class="ident" id="4403615">ast</span><span class="op" id="4403618">.</span><span class="ident" id="4403619">BlockStmt</span><span class="op" id="4403628">{</span><span class="ident" id="4403629">Lbrace</span><span class="op" id="4403635">:</span>&nbsp;<span class="ident" id="4403637">lbrace</span><span class="op" id="4403643">,</span>&nbsp;<span class="ident" id="4403645">List</span><span class="op" id="4403649">:</span>&nbsp;<span class="ident" id="4403651">list</span><span class="op" id="4403655">,</span>&nbsp;<span class="ident" id="4403657">Rbrace</span><span class="op" id="4403663">:</span>&nbsp;<span class="ident" id="4403665">rbrace</span><span class="op" id="4403671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403675">if</span>&nbsp;<span class="ident" id="4403678">typeSwitch</span>&nbsp;<span class="op" id="4403689">{</span><br>
<span class="lineno">1950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403693">return</span>&nbsp;<span class="op" id="4403700">&amp;</span><span class="ident" id="4403701">ast</span><span class="op" id="4403704">.</span><span class="ident" id="4403705">TypeSwitchStmt</span><span class="op" id="4403719">{</span><span class="ident" id="4403720">Switch</span><span class="op" id="4403726">:</span>&nbsp;<span class="ident" id="4403728">pos</span><span class="op" id="4403731">,</span>&nbsp;<span class="ident" id="4403733">Init</span><span class="op" id="4403737">:</span>&nbsp;<span class="ident" id="4403739">s1</span><span class="op" id="4403741">,</span>&nbsp;<span class="ident" id="4403743">Assign</span><span class="op" id="4403749">:</span>&nbsp;<span class="ident" id="4403751">s2</span><span class="op" id="4403753">,</span>&nbsp;<span class="ident" id="4403755">Body</span><span class="op" id="4403759">:</span>&nbsp;<span class="ident" id="4403761">body</span><span class="op" id="4403765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4403768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403772">return</span>&nbsp;<span class="op" id="4403779">&amp;</span><span class="ident" id="4403780">ast</span><span class="op" id="4403783">.</span><span class="ident" id="4403784">SwitchStmt</span><span class="op" id="4403794">{</span><span class="ident" id="4403795">Switch</span><span class="op" id="4403801">:</span>&nbsp;<span class="ident" id="4403803">pos</span><span class="op" id="4403806">,</span>&nbsp;<span class="ident" id="4403808">Init</span><span class="op" id="4403812">:</span>&nbsp;<span class="ident" id="4403814">s1</span><span class="op" id="4403816">,</span>&nbsp;<span class="ident" id="4403818">Tag</span><span class="op" id="4403821">:</span>&nbsp;<span class="ident" id="4403823">p</span><span class="op" id="4403824">.</span><span class="ident" id="4403825">makeExpr</span><span class="op" id="4403833">(</span><span class="ident" id="4403834">s2</span><span class="op" id="4403836">,</span>&nbsp;<span class="string" id="4403838">&#34;switch&nbsp;expression&#34;</span><span class="op" id="4403857">)</span><span class="op" id="4403858">,</span>&nbsp;<span class="ident" id="4403860">Body</span><span class="op" id="4403864">:</span>&nbsp;<span class="ident" id="4403866">body</span><span class="op" id="4403870">}</span><br>
<span class="lineno"></span><span class="op" id="4403872">}</span><br>
<span class="lineno">1955</span><br>
<span class="lineno"></span><span class="keyword" id="4403875">func</span>&nbsp;<span class="op" id="4403880">(</span><span class="ident" id="4403881">p</span>&nbsp;<span class="op" id="4403883">*</span><span class="ident" id="4403884">parser</span><span class="op" id="4403890">)</span>&nbsp;<span class="ident" id="4403892">parseCommClause</span><span class="op" id="4403907">(</span><span class="op" id="4403908">)</span>&nbsp;<span class="op" id="4403910">*</span><span class="ident" id="4403911">ast</span><span class="op" id="4403914">.</span><span class="ident" id="4403915">CommClause</span>&nbsp;<span class="op" id="4403926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403929">if</span>&nbsp;<span class="ident" id="4403932">p</span><span class="op" id="4403933">.</span><span class="ident" id="4403934">trace</span>&nbsp;<span class="op" id="4403940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403944">defer</span>&nbsp;<span class="ident" id="4403950">un</span><span class="op" id="4403952">(</span><span class="ident" id="4403953">trace</span><span class="op" id="4403958">(</span><span class="ident" id="4403959">p</span><span class="op" id="4403960">,</span>&nbsp;<span class="string" id="4403962">&#34;CommClause&#34;</span><span class="op" id="4403974">)</span><span class="op" id="4403975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4403978">}</span><br>
<span class="lineno">1960</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4403982">p</span><span class="op" id="4403983">.</span><span class="ident" id="4403984">openScope</span><span class="op" id="4403993">(</span><span class="op" id="4403994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4403997">pos</span>&nbsp;<span class="op" id="4404001">:=</span>&nbsp;<span class="ident" id="4404004">p</span><span class="op" id="4404005">.</span><span class="ident" id="4404006">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4404011">var</span>&nbsp;<span class="ident" id="4404015">comm</span>&nbsp;<span class="ident" id="4404020">ast</span><span class="op" id="4404023">.</span><span class="ident" id="4404024">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4404030">if</span>&nbsp;<span class="ident" id="4404033">p</span><span class="op" id="4404034">.</span><span class="ident" id="4404035">tok</span>&nbsp;<span class="op" id="4404039">==</span>&nbsp;<span class="ident" id="4404042">token</span><span class="op" id="4404047">.</span><span class="ident" id="4404048">CASE</span>&nbsp;<span class="op" id="4404053">{</span><br>
<span class="lineno">1965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404057">p</span><span class="op" id="4404058">.</span><span class="ident" id="4404059">next</span><span class="op" id="4404063">(</span><span class="op" id="4404064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404068">lhs</span>&nbsp;<span class="op" id="4404072">:=</span>&nbsp;<span class="ident" id="4404075">p</span><span class="op" id="4404076">.</span><span class="ident" id="4404077">parseLhsList</span><span class="op" id="4404089">(</span><span class="op" id="4404090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4404094">if</span>&nbsp;<span class="ident" id="4404097">p</span><span class="op" id="4404098">.</span><span class="ident" id="4404099">tok</span>&nbsp;<span class="op" id="4404103">==</span>&nbsp;<span class="ident" id="4404106">token</span><span class="op" id="4404111">.</span><span class="ident" id="4404112">ARROW</span>&nbsp;<span class="op" id="4404118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4404123">//&nbsp;SendStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4404138">if</span>&nbsp;<span class="builtinfunc" id="4404141">len</span><span class="op" id="4404144">(</span><span class="ident" id="4404145">lhs</span><span class="op" id="4404148">)</span>&nbsp;<span class="op" id="4404150">&gt;</span>&nbsp;<span class="num" id="4404152">1</span>&nbsp;<span class="op" id="4404154">{</span><br>
<span class="lineno">1970</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404160">p</span><span class="op" id="4404161">.</span><span class="ident" id="4404162">errorExpected</span><span class="op" id="4404175">(</span><span class="ident" id="4404176">lhs</span><span class="op" id="4404179">[</span><span class="num" id="4404180">0</span><span class="op" id="4404181">]</span><span class="op" id="4404182">.</span><span class="ident" id="4404183">Pos</span><span class="op" id="4404186">(</span><span class="op" id="4404187">)</span><span class="op" id="4404188">,</span>&nbsp;<span class="string" id="4404190">&#34;1&nbsp;expression&#34;</span><span class="op" id="4404204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4404210">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4404247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404252">arrow</span>&nbsp;<span class="op" id="4404258">:=</span>&nbsp;<span class="ident" id="4404261">p</span><span class="op" id="4404262">.</span><span class="ident" id="4404263">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404270">p</span><span class="op" id="4404271">.</span><span class="ident" id="4404272">next</span><span class="op" id="4404276">(</span><span class="op" id="4404277">)</span><br>
<span class="lineno">1975</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404282">rhs</span>&nbsp;<span class="op" id="4404286">:=</span>&nbsp;<span class="ident" id="4404289">p</span><span class="op" id="4404290">.</span><span class="ident" id="4404291">parseRhs</span><span class="op" id="4404299">(</span><span class="op" id="4404300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404305">comm</span>&nbsp;<span class="op" id="4404310">=</span>&nbsp;<span class="op" id="4404312">&amp;</span><span class="ident" id="4404313">ast</span><span class="op" id="4404316">.</span><span class="ident" id="4404317">SendStmt</span><span class="op" id="4404325">{</span><span class="ident" id="4404326">Chan</span><span class="op" id="4404330">:</span>&nbsp;<span class="ident" id="4404332">lhs</span><span class="op" id="4404335">[</span><span class="num" id="4404336">0</span><span class="op" id="4404337">]</span><span class="op" id="4404338">,</span>&nbsp;<span class="ident" id="4404340">Arrow</span><span class="op" id="4404345">:</span>&nbsp;<span class="ident" id="4404347">arrow</span><span class="op" id="4404352">,</span>&nbsp;<span class="ident" id="4404354">Value</span><span class="op" id="4404359">:</span>&nbsp;<span class="ident" id="4404361">rhs</span><span class="op" id="4404364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4404368">}</span>&nbsp;<span class="keyword" id="4404370">else</span>&nbsp;<span class="op" id="4404375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4404380">//&nbsp;RecvStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4404395">if</span>&nbsp;<span class="ident" id="4404398">tok</span>&nbsp;<span class="op" id="4404402">:=</span>&nbsp;<span class="ident" id="4404405">p</span><span class="op" id="4404406">.</span><span class="ident" id="4404407">tok</span><span class="op" id="4404410">;</span>&nbsp;<span class="ident" id="4404412">tok</span>&nbsp;<span class="op" id="4404416">==</span>&nbsp;<span class="ident" id="4404419">token</span><span class="op" id="4404424">.</span><span class="ident" id="4404425">ASSIGN</span>&nbsp;<span class="op" id="4404432">||</span>&nbsp;<span class="ident" id="4404435">tok</span>&nbsp;<span class="op" id="4404439">==</span>&nbsp;<span class="ident" id="4404442">token</span><span class="op" id="4404447">.</span><span class="ident" id="4404448">DEFINE</span>&nbsp;<span class="op" id="4404455">{</span><br>
<span class="lineno">1980</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4404461">//&nbsp;RecvStmt&nbsp;with&nbsp;assignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4404493">if</span>&nbsp;<span class="builtinfunc" id="4404496">len</span><span class="op" id="4404499">(</span><span class="ident" id="4404500">lhs</span><span class="op" id="4404503">)</span>&nbsp;<span class="op" id="4404505">&gt;</span>&nbsp;<span class="num" id="4404507">2</span>&nbsp;<span class="op" id="4404509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404516">p</span><span class="op" id="4404517">.</span><span class="ident" id="4404518">errorExpected</span><span class="op" id="4404531">(</span><span class="ident" id="4404532">lhs</span><span class="op" id="4404535">[</span><span class="num" id="4404536">0</span><span class="op" id="4404537">]</span><span class="op" id="4404538">.</span><span class="ident" id="4404539">Pos</span><span class="op" id="4404542">(</span><span class="op" id="4404543">)</span><span class="op" id="4404544">,</span>&nbsp;<span class="string" id="4404546">&#34;1&nbsp;or&nbsp;2&nbsp;expressions&#34;</span><span class="op" id="4404566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4404573">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;two&nbsp;expressions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404617">lhs</span>&nbsp;<span class="op" id="4404621">=</span>&nbsp;<span class="ident" id="4404623">lhs</span><span class="op" id="4404626">[</span><span class="num" id="4404627">0</span><span class="op" id="4404628">:</span><span class="num" id="4404629">2</span><span class="op" id="4404630">]</span><br>
<span class="lineno">1985</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4404636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404642">pos</span>&nbsp;<span class="op" id="4404646">:=</span>&nbsp;<span class="ident" id="4404649">p</span><span class="op" id="4404650">.</span><span class="ident" id="4404651">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404659">p</span><span class="op" id="4404660">.</span><span class="ident" id="4404661">next</span><span class="op" id="4404665">(</span><span class="op" id="4404666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404672">rhs</span>&nbsp;<span class="op" id="4404676">:=</span>&nbsp;<span class="ident" id="4404679">p</span><span class="op" id="4404680">.</span><span class="ident" id="4404681">parseRhs</span><span class="op" id="4404689">(</span><span class="op" id="4404690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404696">as</span>&nbsp;<span class="op" id="4404699">:=</span>&nbsp;<span class="op" id="4404702">&amp;</span><span class="ident" id="4404703">ast</span><span class="op" id="4404706">.</span><span class="ident" id="4404707">AssignStmt</span><span class="op" id="4404717">{</span><span class="ident" id="4404718">Lhs</span><span class="op" id="4404721">:</span>&nbsp;<span class="ident" id="4404723">lhs</span><span class="op" id="4404726">,</span>&nbsp;<span class="ident" id="4404728">TokPos</span><span class="op" id="4404734">:</span>&nbsp;<span class="ident" id="4404736">pos</span><span class="op" id="4404739">,</span>&nbsp;<span class="ident" id="4404741">Tok</span><span class="op" id="4404744">:</span>&nbsp;<span class="ident" id="4404746">tok</span><span class="op" id="4404749">,</span>&nbsp;<span class="ident" id="4404751">Rhs</span><span class="op" id="4404754">:</span>&nbsp;<span class="op" id="4404756">[</span><span class="op" id="4404757">]</span><span class="ident" id="4404758">ast</span><span class="op" id="4404761">.</span><span class="ident" id="4404762">Expr</span><span class="op" id="4404766">{</span><span class="ident" id="4404767">rhs</span><span class="op" id="4404770">}</span><span class="op" id="4404771">}</span><br>
<span class="lineno">1990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4404777">if</span>&nbsp;<span class="ident" id="4404780">tok</span>&nbsp;<span class="op" id="4404784">==</span>&nbsp;<span class="ident" id="4404787">token</span><span class="op" id="4404792">.</span><span class="ident" id="4404793">DEFINE</span>&nbsp;<span class="op" id="4404800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404807">p</span><span class="op" id="4404808">.</span><span class="ident" id="4404809">shortVarDecl</span><span class="op" id="4404821">(</span><span class="ident" id="4404822">as</span><span class="op" id="4404824">,</span>&nbsp;<span class="ident" id="4404826">lhs</span><span class="op" id="4404829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4404835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404841">comm</span>&nbsp;<span class="op" id="4404846">=</span>&nbsp;<span class="ident" id="4404848">as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4404854">}</span>&nbsp;<span class="keyword" id="4404856">else</span>&nbsp;<span class="op" id="4404861">{</span><br>
<span class="lineno">1995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4404867">//&nbsp;lhs&nbsp;must&nbsp;be&nbsp;single&nbsp;receive&nbsp;operation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4404911">if</span>&nbsp;<span class="builtinfunc" id="4404914">len</span><span class="op" id="4404917">(</span><span class="ident" id="4404918">lhs</span><span class="op" id="4404921">)</span>&nbsp;<span class="op" id="4404923">&gt;</span>&nbsp;<span class="num" id="4404925">1</span>&nbsp;<span class="op" id="4404927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404934">p</span><span class="op" id="4404935">.</span><span class="ident" id="4404936">errorExpected</span><span class="op" id="4404949">(</span><span class="ident" id="4404950">lhs</span><span class="op" id="4404953">[</span><span class="num" id="4404954">0</span><span class="op" id="4404955">]</span><span class="op" id="4404956">.</span><span class="ident" id="4404957">Pos</span><span class="op" id="4404960">(</span><span class="op" id="4404961">)</span><span class="op" id="4404962">,</span>&nbsp;<span class="string" id="4404964">&#34;1&nbsp;expression&#34;</span><span class="op" id="4404978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4404985">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4405023">}</span><br>
<span class="lineno">2000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4405029">comm</span>&nbsp;<span class="op" id="4405034">=</span>&nbsp;<span class="op" id="4405036">&amp;</span><span class="ident" id="4405037">ast</span><span class="op" id="4405040">.</span><span class="ident" id="4405041">ExprStmt</span><span class="op" id="4405049">{</span><span class="ident" id="4405050">X</span><span class="op" id="4405051">:</span>&nbsp;<span class="ident" id="4405053">lhs</span><span class="op" id="4405056">[</span><span class="num" id="4405057">0</span><span class="op" id="4405058">]</span><span class="op" id="4405059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4405064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4405068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4405071">}</span>&nbsp;<span class="keyword" id="4405073">else</span>&nbsp;<span class="op" id="4405078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4405082">p</span><span class="op" id="4405083">.</span><span class="ident" id="4405084">expect</span><span class="op" id="4405090">(</span><span class="ident" id="4405091">token</span><span class="op" id="4405096">.</span><span class="ident" id="4405097">DEFAULT</span><span class="op" id="4405104">)</span><br>
<span class="lineno">2005</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4405107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4405111">colon</span>&nbsp;<span class="op" id="4405117">:=</span>&nbsp;<span class="ident" id="4405120">p</span><span class="op" id="4405121">.</span><span class="ident" id="4405122">expect</span><span class="op" id="4405128">(</span><span class="ident" id="4405129">token</span><span class="op" id="4405134">.</span><span class="ident" id="4405135">COLON</span><span class="op" id="4405140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4405143">body</span>&nbsp;<span class="op" id="4405148">:=</span>&nbsp;<span class="ident" id="4405151">p</span><span class="op" id="4405152">.</span><span class="ident" id="4405153">parseStmtList</span><span class="op" id="4405166">(</span><span class="op" id="4405167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4405170">p</span><span class="op" id="4405171">.</span><span class="ident" id="4405172">closeScope</span><span class="op" id="4405182">(</span><span class="op" id="4405183">)</span><br>
<span class="lineno">2010</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4405187">return</span>&nbsp;<span class="op" id="4405194">&amp;</span><span class="ident" id="4405195">ast</span><span class="op" id="4405198">.</span><span class="ident" id="4405199">CommClause</span><span class="op" id="4405209">{</span><span class="ident" id="4405210">Case</span><span class="op" id="4405214">:</span>&nbsp;<span class="ident" id="4405216">pos</span><span class="op" id="4405219">,</span>&nbsp;<span class="ident" id="4405221">Comm</span><span class="op" id="4405225">:</span>&nbsp;<span class="ident" id="4405227">comm</span><span class="op" id="4405231">,</span>&nbsp;<span class="ident" id="4405233">Colon</span><span class="op" id="4405238">:</span>&nbsp;<span class="ident" id="4405240">colon</span><span class="op" id="4405245">,</span>&nbsp;<span class="ident" id="4405247">Body</span><span class="op" id="4405251">:</span>&nbsp;<span class="ident" id="4405253">body</span><span class="op" id="4405257">}</span><br>
<span class="lineno"></span><span class="op" id="4405259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4405262">func</span>&nbsp;<span class="op" id="4405267">(</span><span class="ident" id="4405268">p</span>&nbsp;<span class="op" id="4405270">*</span><span class="ident" id="4405271">parser</span><span class="op" id="4405277">)</span>&nbsp;<span class="ident" id="4405279">parseSelectStmt</span><span class="op" id="4405294">(</span><span class="op" id="4405295">)</span>&nbsp;<span class="op" id="4405297">*</span><span class="ident" id="4405298">ast</span><span class="op" id="4405301">.</span><span class="ident" id="4405302">SelectStmt</span>&nbsp;<span class="op" id="4405313">{</span><br>
<span class="lineno">2015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4405316">if</span>&nbsp;<span class="ident" id="4405319">p</span><span class="op" id="4405320">.</span><span class="ident" id="4405321">trace</span>&nbsp;<span class="op" id="4405327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4405331">defer</span>&nbsp;<span class="ident" id="4405337">un</span><span class="op" id="4405339">(</span><span class="ident" id="4405340">trace</span><span class="op" id="4405345">(</span><span class="ident" id="4405346">p</span><span class="op" id="4405347">,</span>&nbsp;<span class="string" id="4405349">&#34;SelectStmt&#34;</span><span class="op" id="4405361">)</span><span class="op" id="4405362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4405365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4405369">pos</span>&nbsp;<span class="op" id="4405373">:=</span>&nbsp;<span class="ident" id="4405376">p</span><span class="op" id="4405377">.</span><span class="ident" id="4405378">expect</span><span class="op" id="4405384">(</span><span class="ident" id="4405385">token</span><span class="op" id="4405390">.</span><span class="ident" id="4405391">SELECT</span><span class="op" id="4405397">)</span><br>
<span class="lineno">2020</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4405400">lbrace</span>&nbsp;<span class="op" id="4405407">:=</span>&nbsp;<span class="ident" id="4405410">p</span><span class="op" id="4405411">.</span><span class="ident" id="4405412">expect</span><span class="op" id="4405418">(</span><span class="ident" id="4405419">token</span><span class="op" id="4405424">.</span><span class="ident" id="4405425">LBRACE</span><span class="op" id="4405431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4405434">var</span>&nbsp;<span class="ident" id="4405438">list</span>&nbsp;<span class="op" id="4405443">[</span><span class="op" id="4405444">]</span><span class="ident" id="4405445">ast</span><span class="op" id="4405448">.</span><span class="ident" id="4405449">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4405455">for</span>&nbsp;<span class="ident" id="4405459">p</span><span class="op" id="4405460">.</span><span class="ident" id="4405461">tok</span>&nbsp;<span class="op" id="4405465">==</span>&nbsp;<span class="ident" id="4405468">token</span><span class="op" id="4405473">.</span><span class="ident" id="4405474">CASE</span>&nbsp;<span class="op" id="4405479">||</span>&nbsp;<span class="ident" id="4405482">p</span><span class="op" id="4405483">.</span><span class="ident" id="4405484">tok</span>&nbsp;<span class="op" id="4405488">==</span>&nbsp;<span class="ident" id="4405491">token</span><span class="op" id="4405496">.</span><span class="ident" id="4405497">DEFAULT</span>&nbsp;<span class="op" id="4405505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4405509">list</span>&nbsp;<span class="op" id="4405514">=</span>&nbsp;<span class="builtinfunc" id="4405516">append</span><span class="op" id="4405522">(</span><span class="ident" id="4405523">list</span><span class="op" id="4405527">,</span>&nbsp;<span class="ident" id="4405529">p</span><span class="op" id="4405530">.</span><span class="ident" id="4405531">parseCommClause</span><span class="op" id="4405546">(</span><span class="op" id="4405547">)</span><span class="op" id="4405548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4405551">}</span><br>
<span class="lineno">2025</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4405554">rbrace</span>&nbsp;<span class="op" id="4405561">:=</span>&nbsp;<span class="ident" id="4405564">p</span><span class="op" id="4405565">.</span><span class="ident" id="4405566">expect</span><span class="op" id="4405572">(</span><span class="ident" id="4405573">token</span><span class="op" id="4405578">.</span><span class="ident" id="4405579">RBRACE</span><span class="op" id="4405585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4405588">p</span><span class="op" id="4405589">.</span><span class="ident" id="4405590">expectSemi</span><span class="op" id="4405600">(</span><span class="op" id="4405601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4405604">body</span>&nbsp;<span class="op" id="4405609">:=</span>&nbsp;<span class="op" id="4405612">&amp;</span><span class="ident" id="4405613">ast</span><span class="op" id="4405616">.</span><span class="ident" id="4405617">BlockStmt</span><span class="op" id="4405626">{</span><span class="ident" id="4405627">Lbrace</span><span class="op" id="4405633">:</span>&nbsp;<span class="ident" id="4405635">lbrace</span><span class="op" id="4405641">,</span>&nbsp;<span class="ident" id="4405643">List</span><span class="op" id="4405647">:</span>&nbsp;<span class="ident" id="4405649">list</span><span class="op" id="4405653">,</span>&nbsp;<span class="ident" id="4405655">Rbrace</span><span class="op" id="4405661">:</span>&nbsp;<span class="ident" id="4405663">rbrace</span><span class="op" id="4405669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4405673">return</span>&nbsp;<span class="op" id="4405680">&amp;</span><span class="ident" id="4405681">ast</span><span class="op" id="4405684">.</span><span class="ident" id="4405685">SelectStmt</span><span class="op" id="4405695">{</span><span class="ident" id="4405696">Select</span><span class="op" id="4405702">:</span>&nbsp;<span class="ident" id="4405704">pos</span><span class="op" id="4405707">,</span>&nbsp;<span class="ident" id="4405709">Body</span><span class="op" id="4405713">:</span>&nbsp;<span class="ident" id="4405715">body</span><span class="op" id="4405719">}</span><br>
<span class="lineno">2030</span><span class="op" id="4405721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4405724">func</span>&nbsp;<span class="op" id="4405729">(</span><span class="ident" id="4405730">p</span>&nbsp;<span class="op" id="4405732">*</span><span class="ident" id="4405733">parser</span><span class="op" id="4405739">)</span>&nbsp;<span class="ident" id="4405741">parseForStmt</span><span class="op" id="4405753">(</span><span class="op" id="4405754">)</span>&nbsp;<span class="ident" id="4405756">ast</span><span class="op" id="4405759">.</span><span class="ident" id="4405760">Stmt</span>&nbsp;<span class="op" id="4405765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4405768">if</span>&nbsp;<span class="ident" id="4405771">p</span><span class="op" id="4405772">.</span><span class="ident" id="4405773">trace</span>&nbsp;<span class="op" id="4405779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4405783">defer</span>&nbsp;<span class="ident" id="4405789">un</span><span class="op" id="4405791">(</span><span class="ident" id="4405792">trace</span><span class="op" id="4405797">(</span><span class="ident" id="4405798">p</span><span class="op" id="4405799">,</span>&nbsp;<span class="string" id="4405801">&#34;ForStmt&#34;</span><span class="op" id="4405810">)</span><span class="op" id="4405811">)</span><br>
<span class="lineno">2035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4405814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4405818">pos</span>&nbsp;<span class="op" id="4405822">:=</span>&nbsp;<span class="ident" id="4405825">p</span><span class="op" id="4405826">.</span><span class="ident" id="4405827">expect</span><span class="op" id="4405833">(</span><span class="ident" id="4405834">token</span><span class="op" id="4405839">.</span><span class="ident" id="4405840">FOR</span><span class="op" id="4405843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4405846">p</span><span class="op" id="4405847">.</span><span class="ident" id="4405848">openScope</span><span class="op" id="4405857">(</span><span class="op" id="4405858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4405861">defer</span>&nbsp;<span class="ident" id="4405867">p</span><span class="op" id="4405868">.</span><span class="ident" id="4405869">closeScope</span><span class="op" id="4405879">(</span><span class="op" id="4405880">)</span><br>
<span class="lineno">2040</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4405884">var</span>&nbsp;<span class="ident" id="4405888">s1</span><span class="op" id="4405890">,</span>&nbsp;<span class="ident" id="4405892">s2</span><span class="op" id="4405894">,</span>&nbsp;<span class="ident" id="4405896">s3</span>&nbsp;<span class="ident" id="4405899">ast</span><span class="op" id="4405902">.</span><span class="ident" id="4405903">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4405909">var</span>&nbsp;<span class="ident" id="4405913">isRange</span>&nbsp;<span class="builtintype" id="4405921">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4405927">if</span>&nbsp;<span class="ident" id="4405930">p</span><span class="op" id="4405931">.</span><span class="ident" id="4405932">tok</span>&nbsp;<span class="op" id="4405936">!=</span>&nbsp;<span class="ident" id="4405939">token</span><span class="op" id="4405944">.</span><span class="ident" id="4405945">LBRACE</span>&nbsp;<span class="op" id="4405952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4405956">prevLev</span>&nbsp;<span class="op" id="4405964">:=</span>&nbsp;<span class="ident" id="4405967">p</span><span class="op" id="4405968">.</span><span class="ident" id="4405969">exprLev</span><br>
<span class="lineno">2045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4405979">p</span><span class="op" id="4405980">.</span><span class="ident" id="4405981">exprLev</span>&nbsp;<span class="op" id="4405989">=</span>&nbsp;<span class="op" id="4405991">-</span><span class="num" id="4405992">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4405996">if</span>&nbsp;<span class="ident" id="4405999">p</span><span class="op" id="4406000">.</span><span class="ident" id="4406001">tok</span>&nbsp;<span class="op" id="4406005">!=</span>&nbsp;<span class="ident" id="4406008">token</span><span class="op" id="4406013">.</span><span class="ident" id="4406014">SEMICOLON</span>&nbsp;<span class="op" id="4406024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4406029">if</span>&nbsp;<span class="ident" id="4406032">p</span><span class="op" id="4406033">.</span><span class="ident" id="4406034">tok</span>&nbsp;<span class="op" id="4406038">==</span>&nbsp;<span class="ident" id="4406041">token</span><span class="op" id="4406046">.</span><span class="ident" id="4406047">RANGE</span>&nbsp;<span class="op" id="4406053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4406059">//&nbsp;&#34;for&nbsp;range&nbsp;x&#34;&nbsp;(nil&nbsp;lhs&nbsp;in&nbsp;assignment)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4406104">pos</span>&nbsp;<span class="op" id="4406108">:=</span>&nbsp;<span class="ident" id="4406111">p</span><span class="op" id="4406112">.</span><span class="ident" id="4406113">pos</span><br>
<span class="lineno">2050</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4406121">p</span><span class="op" id="4406122">.</span><span class="ident" id="4406123">next</span><span class="op" id="4406127">(</span><span class="op" id="4406128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4406134">y</span>&nbsp;<span class="op" id="4406136">:=</span>&nbsp;<span class="op" id="4406139">[</span><span class="op" id="4406140">]</span><span class="ident" id="4406141">ast</span><span class="op" id="4406144">.</span><span class="ident" id="4406145">Expr</span><span class="op" id="4406149">{</span><span class="op" id="4406150">&amp;</span><span class="ident" id="4406151">ast</span><span class="op" id="4406154">.</span><span class="ident" id="4406155">UnaryExpr</span><span class="op" id="4406164">{</span><span class="ident" id="4406165">OpPos</span><span class="op" id="4406170">:</span>&nbsp;<span class="ident" id="4406172">pos</span><span class="op" id="4406175">,</span>&nbsp;<span class="ident" id="4406177">Op</span><span class="op" id="4406179">:</span>&nbsp;<span class="ident" id="4406181">token</span><span class="op" id="4406186">.</span><span class="ident" id="4406187">RANGE</span><span class="op" id="4406192">,</span>&nbsp;<span class="ident" id="4406194">X</span><span class="op" id="4406195">:</span>&nbsp;<span class="ident" id="4406197">p</span><span class="op" id="4406198">.</span><span class="ident" id="4406199">parseRhs</span><span class="op" id="4406207">(</span><span class="op" id="4406208">)</span><span class="op" id="4406209">}</span><span class="op" id="4406210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4406216">s2</span>&nbsp;<span class="op" id="4406219">=</span>&nbsp;<span class="op" id="4406221">&amp;</span><span class="ident" id="4406222">ast</span><span class="op" id="4406225">.</span><span class="ident" id="4406226">AssignStmt</span><span class="op" id="4406236">{</span><span class="ident" id="4406237">Rhs</span><span class="op" id="4406240">:</span>&nbsp;<span class="ident" id="4406242">y</span><span class="op" id="4406243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4406249">isRange</span>&nbsp;<span class="op" id="4406257">=</span>&nbsp;<span class="builtintype" id="4406259">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4406267">}</span>&nbsp;<span class="keyword" id="4406269">else</span>&nbsp;<span class="op" id="4406274">{</span><br>
<span class="lineno">2055</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4406280">s2</span><span class="op" id="4406282">,</span>&nbsp;<span class="ident" id="4406284">isRange</span>&nbsp;<span class="op" id="4406292">=</span>&nbsp;<span class="ident" id="4406294">p</span><span class="op" id="4406295">.</span><span class="ident" id="4406296">parseSimpleStmt</span><span class="op" id="4406311">(</span><span class="ident" id="4406312">rangeOk</span><span class="op" id="4406319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4406324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4406328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4406332">if</span>&nbsp;<span class="op" id="4406335">!</span><span class="ident" id="4406336">isRange</span>&nbsp;<span class="op" id="4406344">&amp;&amp;</span>&nbsp;<span class="ident" id="4406347">p</span><span class="op" id="4406348">.</span><span class="ident" id="4406349">tok</span>&nbsp;<span class="op" id="4406353">==</span>&nbsp;<span class="ident" id="4406356">token</span><span class="op" id="4406361">.</span><span class="ident" id="4406362">SEMICOLON</span>&nbsp;<span class="op" id="4406372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4406377">p</span><span class="op" id="4406378">.</span><span class="ident" id="4406379">next</span><span class="op" id="4406383">(</span><span class="op" id="4406384">)</span><br>
<span class="lineno">2060</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4406389">s1</span>&nbsp;<span class="op" id="4406392">=</span>&nbsp;<span class="ident" id="4406394">s2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4406400">s2</span>&nbsp;<span class="op" id="4406403">=</span>&nbsp;<span class="ident" id="4406405">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4406412">if</span>&nbsp;<span class="ident" id="4406415">p</span><span class="op" id="4406416">.</span><span class="ident" id="4406417">tok</span>&nbsp;<span class="op" id="4406421">!=</span>&nbsp;<span class="ident" id="4406424">token</span><span class="op" id="4406429">.</span><span class="ident" id="4406430">SEMICOLON</span>&nbsp;<span class="op" id="4406440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4406446">s2</span><span class="op" id="4406448">,</span>&nbsp;<span class="ident" id="4406450">_</span>&nbsp;<span class="op" id="4406452">=</span>&nbsp;<span class="ident" id="4406454">p</span><span class="op" id="4406455">.</span><span class="ident" id="4406456">parseSimpleStmt</span><span class="op" id="4406471">(</span><span class="ident" id="4406472">basic</span><span class="op" id="4406477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4406482">}</span><br>
<span class="lineno">2065</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4406487">p</span><span class="op" id="4406488">.</span><span class="ident" id="4406489">expectSemi</span><span class="op" id="4406499">(</span><span class="op" id="4406500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4406505">if</span>&nbsp;<span class="ident" id="4406508">p</span><span class="op" id="4406509">.</span><span class="ident" id="4406510">tok</span>&nbsp;<span class="op" id="4406514">!=</span>&nbsp;<span class="ident" id="4406517">token</span><span class="op" id="4406522">.</span><span class="ident" id="4406523">LBRACE</span>&nbsp;<span class="op" id="4406530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4406536">s3</span><span class="op" id="4406538">,</span>&nbsp;<span class="ident" id="4406540">_</span>&nbsp;<span class="op" id="4406542">=</span>&nbsp;<span class="ident" id="4406544">p</span><span class="op" id="4406545">.</span><span class="ident" id="4406546">parseSimpleStmt</span><span class="op" id="4406561">(</span><span class="ident" id="4406562">basic</span><span class="op" id="4406567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4406572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4406576">}</span><br>
<span class="lineno">2070</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4406580">p</span><span class="op" id="4406581">.</span><span class="ident" id="4406582">exprLev</span>&nbsp;<span class="op" id="4406590">=</span>&nbsp;<span class="ident" id="4406592">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4406601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4406605">body</span>&nbsp;<span class="op" id="4406610">:=</span>&nbsp;<span class="ident" id="4406613">p</span><span class="op" id="4406614">.</span><span class="ident" id="4406615">parseBlockStmt</span><span class="op" id="4406629">(</span><span class="op" id="4406630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4406633">p</span><span class="op" id="4406634">.</span><span class="ident" id="4406635">expectSemi</span><span class="op" id="4406645">(</span><span class="op" id="4406646">)</span><br>
<span class="lineno">2075</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4406650">if</span>&nbsp;<span class="ident" id="4406653">isRange</span>&nbsp;<span class="op" id="4406661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4406665">as</span>&nbsp;<span class="op" id="4406668">:=</span>&nbsp;<span class="ident" id="4406671">s2</span><span class="op" id="4406673">.</span><span class="op" id="4406674">(</span><span class="op" id="4406675">*</span><span class="ident" id="4406676">ast</span><span class="op" id="4406679">.</span><span class="ident" id="4406680">AssignStmt</span><span class="op" id="4406690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4406694">//&nbsp;check&nbsp;lhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4406709">var</span>&nbsp;<span class="ident" id="4406713">key</span><span class="op" id="4406716">,</span>&nbsp;<span class="ident" id="4406718">value</span>&nbsp;<span class="ident" id="4406724">ast</span><span class="op" id="4406727">.</span><span class="ident" id="4406728">Expr</span><br>
<span class="lineno">2080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4406735">switch</span>&nbsp;<span class="builtinfunc" id="4406742">len</span><span class="op" id="4406745">(</span><span class="ident" id="4406746">as</span><span class="op" id="4406748">.</span><span class="ident" id="4406749">Lhs</span><span class="op" id="4406752">)</span>&nbsp;<span class="op" id="4406754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4406758">case</span>&nbsp;<span class="num" id="4406763">0</span><span class="op" id="4406764">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4406769">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4406788">case</span>&nbsp;<span class="num" id="4406793">1</span><span class="op" id="4406794">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4406799">key</span>&nbsp;<span class="op" id="4406803">=</span>&nbsp;<span class="ident" id="4406805">as</span><span class="op" id="4406807">.</span><span class="ident" id="4406808">Lhs</span><span class="op" id="4406811">[</span><span class="num" id="4406812">0</span><span class="op" id="4406813">]</span><br>
<span class="lineno">2085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4406817">case</span>&nbsp;<span class="num" id="4406822">2</span><span class="op" id="4406823">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4406828">key</span><span class="op" id="4406831">,</span>&nbsp;<span class="ident" id="4406833">value</span>&nbsp;<span class="op" id="4406839">=</span>&nbsp;<span class="ident" id="4406841">as</span><span class="op" id="4406843">.</span><span class="ident" id="4406844">Lhs</span><span class="op" id="4406847">[</span><span class="num" id="4406848">0</span><span class="op" id="4406849">]</span><span class="op" id="4406850">,</span>&nbsp;<span class="ident" id="4406852">as</span><span class="op" id="4406854">.</span><span class="ident" id="4406855">Lhs</span><span class="op" id="4406858">[</span><span class="num" id="4406859">1</span><span class="op" id="4406860">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4406864">default</span><span class="op" id="4406871">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4406876">p</span><span class="op" id="4406877">.</span><span class="ident" id="4406878">errorExpected</span><span class="op" id="4406891">(</span><span class="ident" id="4406892">as</span><span class="op" id="4406894">.</span><span class="ident" id="4406895">Lhs</span><span class="op" id="4406898">[</span><span class="builtinfunc" id="4406899">len</span><span class="op" id="4406902">(</span><span class="ident" id="4406903">as</span><span class="op" id="4406905">.</span><span class="ident" id="4406906">Lhs</span><span class="op" id="4406909">)</span><span class="op" id="4406910">-</span><span class="num" id="4406911">1</span><span class="op" id="4406912">]</span><span class="op" id="4406913">.</span><span class="ident" id="4406914">Pos</span><span class="op" id="4406917">(</span><span class="op" id="4406918">)</span><span class="op" id="4406919">,</span>&nbsp;<span class="string" id="4406921">&#34;at&nbsp;most&nbsp;2&nbsp;expressions&#34;</span><span class="op" id="4406944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4406949">return</span>&nbsp;<span class="op" id="4406956">&amp;</span><span class="ident" id="4406957">ast</span><span class="op" id="4406960">.</span><span class="ident" id="4406961">BadStmt</span><span class="op" id="4406968">{</span><span class="ident" id="4406969">From</span><span class="op" id="4406973">:</span>&nbsp;<span class="ident" id="4406975">pos</span><span class="op" id="4406978">,</span>&nbsp;<span class="ident" id="4406980">To</span><span class="op" id="4406982">:</span>&nbsp;<span class="ident" id="4406984">p</span><span class="op" id="4406985">.</span><span class="ident" id="4406986">safePos</span><span class="op" id="4406993">(</span><span class="ident" id="4406994">body</span><span class="op" id="4406998">.</span><span class="ident" id="4406999">End</span><span class="op" id="4407002">(</span><span class="op" id="4407003">)</span><span class="op" id="4407004">)</span><span class="op" id="4407005">}</span><br>
<span class="lineno">2090</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4407009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4407013">//&nbsp;parseSimpleStmt&nbsp;returned&nbsp;a&nbsp;right-hand&nbsp;side&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4407066">//&nbsp;is&nbsp;a&nbsp;single&nbsp;unary&nbsp;expression&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;range&nbsp;x&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4407122">x</span>&nbsp;<span class="op" id="4407124">:=</span>&nbsp;<span class="ident" id="4407127">as</span><span class="op" id="4407129">.</span><span class="ident" id="4407130">Rhs</span><span class="op" id="4407133">[</span><span class="num" id="4407134">0</span><span class="op" id="4407135">]</span><span class="op" id="4407136">.</span><span class="op" id="4407137">(</span><span class="op" id="4407138">*</span><span class="ident" id="4407139">ast</span><span class="op" id="4407142">.</span><span class="ident" id="4407143">UnaryExpr</span><span class="op" id="4407152">)</span><span class="op" id="4407153">.</span><span class="ident" id="4407154">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4407158">return</span>&nbsp;<span class="op" id="4407165">&amp;</span><span class="ident" id="4407166">ast</span><span class="op" id="4407169">.</span><span class="ident" id="4407170">RangeStmt</span><span class="op" id="4407179">{</span><br>
<span class="lineno">2095</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4407184">For</span><span class="op" id="4407187">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4407192">pos</span><span class="op" id="4407195">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4407200">Key</span><span class="op" id="4407203">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4407208">key</span><span class="op" id="4407211">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4407216">Value</span><span class="op" id="4407221">:</span>&nbsp;&nbsp;<span class="ident" id="4407224">value</span><span class="op" id="4407229">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4407234">TokPos</span><span class="op" id="4407240">:</span>&nbsp;<span class="ident" id="4407242">as</span><span class="op" id="4407244">.</span><span class="ident" id="4407245">TokPos</span><span class="op" id="4407251">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4407256">Tok</span><span class="op" id="4407259">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4407264">as</span><span class="op" id="4407266">.</span><span class="ident" id="4407267">Tok</span><span class="op" id="4407270">,</span><br>
<span class="lineno">2100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4407275">X</span><span class="op" id="4407276">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4407283">x</span><span class="op" id="4407284">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4407289">Body</span><span class="op" id="4407293">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4407297">body</span><span class="op" id="4407301">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4407305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4407308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4407312">//&nbsp;regular&nbsp;for&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4407338">return</span>&nbsp;<span class="op" id="4407345">&amp;</span><span class="ident" id="4407346">ast</span><span class="op" id="4407349">.</span><span class="ident" id="4407350">ForStmt</span><span class="op" id="4407357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4407361">For</span><span class="op" id="4407364">:</span>&nbsp;&nbsp;<span class="ident" id="4407367">pos</span><span class="op" id="4407370">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4407374">Init</span><span class="op" id="4407378">:</span>&nbsp;<span class="ident" id="4407380">s1</span><span class="op" id="4407382">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4407386">Cond</span><span class="op" id="4407390">:</span>&nbsp;<span class="ident" id="4407392">p</span><span class="op" id="4407393">.</span><span class="ident" id="4407394">makeExpr</span><span class="op" id="4407402">(</span><span class="ident" id="4407403">s2</span><span class="op" id="4407405">,</span>&nbsp;<span class="string" id="4407407">&#34;boolean&nbsp;or&nbsp;range&nbsp;expression&#34;</span><span class="op" id="4407436">)</span><span class="op" id="4407437">,</span><br>
<span class="lineno">2110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4407441">Post</span><span class="op" id="4407445">:</span>&nbsp;<span class="ident" id="4407447">s3</span><span class="op" id="4407449">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4407453">Body</span><span class="op" id="4407457">:</span>&nbsp;<span class="ident" id="4407459">body</span><span class="op" id="4407463">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4407466">}</span><br>
<span class="lineno"></span><span class="op" id="4407468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2115</span><span class="keyword" id="4407471">func</span>&nbsp;<span class="op" id="4407476">(</span><span class="ident" id="4407477">p</span>&nbsp;<span class="op" id="4407479">*</span><span class="ident" id="4407480">parser</span><span class="op" id="4407486">)</span>&nbsp;<span class="ident" id="4407488">parseStmt</span><span class="op" id="4407497">(</span><span class="op" id="4407498">)</span>&nbsp;<span class="op" id="4407500">(</span><span class="ident" id="4407501">s</span>&nbsp;<span class="ident" id="4407503">ast</span><span class="op" id="4407506">.</span><span class="ident" id="4407507">Stmt</span><span class="op" id="4407511">)</span>&nbsp;<span class="op" id="4407513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4407516">if</span>&nbsp;<span class="ident" id="4407519">p</span><span class="op" id="4407520">.</span><span class="ident" id="4407521">trace</span>&nbsp;<span class="op" id="4407527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4407531">defer</span>&nbsp;<span class="ident" id="4407537">un</span><span class="op" id="4407539">(</span><span class="ident" id="4407540">trace</span><span class="op" id="4407545">(</span><span class="ident" id="4407546">p</span><span class="op" id="4407547">,</span>&nbsp;<span class="string" id="4407549">&#34;Statement&#34;</span><span class="op" id="4407560">)</span><span class="op" id="4407561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4407564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4407568">switch</span>&nbsp;<span class="ident" id="4407575">p</span><span class="op" id="4407576">.</span><span class="ident" id="4407577">tok</span>&nbsp;<span class="op" id="4407581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4407584">case</span>&nbsp;<span class="ident" id="4407589">token</span><span class="op" id="4407594">.</span><span class="ident" id="4407595">CONST</span><span class="op" id="4407600">,</span>&nbsp;<span class="ident" id="4407602">token</span><span class="op" id="4407607">.</span><span class="ident" id="4407608">TYPE</span><span class="op" id="4407612">,</span>&nbsp;<span class="ident" id="4407614">token</span><span class="op" id="4407619">.</span><span class="ident" id="4407620">VAR</span><span class="op" id="4407623">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4407627">s</span>&nbsp;<span class="op" id="4407629">=</span>&nbsp;<span class="op" id="4407631">&amp;</span><span class="ident" id="4407632">ast</span><span class="op" id="4407635">.</span><span class="ident" id="4407636">DeclStmt</span><span class="op" id="4407644">{</span><span class="ident" id="4407645">Decl</span><span class="op" id="4407649">:</span>&nbsp;<span class="ident" id="4407651">p</span><span class="op" id="4407652">.</span><span class="ident" id="4407653">parseDecl</span><span class="op" id="4407662">(</span><span class="ident" id="4407663">syncStmt</span><span class="op" id="4407671">)</span><span class="op" id="4407672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4407675">case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4407682">//&nbsp;tokens&nbsp;that&nbsp;may&nbsp;start&nbsp;an&nbsp;expression</span><br>
<span class="lineno">2125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4407723">token</span><span class="op" id="4407728">.</span><span class="ident" id="4407729">IDENT</span><span class="op" id="4407734">,</span>&nbsp;<span class="ident" id="4407736">token</span><span class="op" id="4407741">.</span><span class="ident" id="4407742">INT</span><span class="op" id="4407745">,</span>&nbsp;<span class="ident" id="4407747">token</span><span class="op" id="4407752">.</span><span class="ident" id="4407753">FLOAT</span><span class="op" id="4407758">,</span>&nbsp;<span class="ident" id="4407760">token</span><span class="op" id="4407765">.</span><span class="ident" id="4407766">IMAG</span><span class="op" id="4407770">,</span>&nbsp;<span class="ident" id="4407772">token</span><span class="op" id="4407777">.</span><span class="ident" id="4407778">CHAR</span><span class="op" id="4407782">,</span>&nbsp;<span class="ident" id="4407784">token</span><span class="op" id="4407789">.</span><span class="ident" id="4407790">STRING</span><span class="op" id="4407796">,</span>&nbsp;<span class="ident" id="4407798">token</span><span class="op" id="4407803">.</span><span class="ident" id="4407804">FUNC</span><span class="op" id="4407808">,</span>&nbsp;<span class="ident" id="4407810">token</span><span class="op" id="4407815">.</span><span class="ident" id="4407816">LPAREN</span><span class="op" id="4407822">,</span>&nbsp;<span class="comment" id="4407824">//&nbsp;operands</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4407838">token</span><span class="op" id="4407843">.</span><span class="ident" id="4407844">LBRACK</span><span class="op" id="4407850">,</span>&nbsp;<span class="ident" id="4407852">token</span><span class="op" id="4407857">.</span><span class="ident" id="4407858">STRUCT</span><span class="op" id="4407864">,</span>&nbsp;<span class="comment" id="4407866">//&nbsp;composite&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4407887">token</span><span class="op" id="4407892">.</span><span class="ident" id="4407893">ADD</span><span class="op" id="4407896">,</span>&nbsp;<span class="ident" id="4407898">token</span><span class="op" id="4407903">.</span><span class="ident" id="4407904">SUB</span><span class="op" id="4407907">,</span>&nbsp;<span class="ident" id="4407909">token</span><span class="op" id="4407914">.</span><span class="ident" id="4407915">MUL</span><span class="op" id="4407918">,</span>&nbsp;<span class="ident" id="4407920">token</span><span class="op" id="4407925">.</span><span class="ident" id="4407926">AND</span><span class="op" id="4407929">,</span>&nbsp;<span class="ident" id="4407931">token</span><span class="op" id="4407936">.</span><span class="ident" id="4407937">XOR</span><span class="op" id="4407940">,</span>&nbsp;<span class="ident" id="4407942">token</span><span class="op" id="4407947">.</span><span class="ident" id="4407948">ARROW</span><span class="op" id="4407953">,</span>&nbsp;<span class="ident" id="4407955">token</span><span class="op" id="4407960">.</span><span class="ident" id="4407961">NOT</span><span class="op" id="4407964">:</span>&nbsp;<span class="comment" id="4407966">//&nbsp;unary&nbsp;operators</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4407987">s</span><span class="op" id="4407988">,</span>&nbsp;<span class="ident" id="4407990">_</span>&nbsp;<span class="op" id="4407992">=</span>&nbsp;<span class="ident" id="4407994">p</span><span class="op" id="4407995">.</span><span class="ident" id="4407996">parseSimpleStmt</span><span class="op" id="4408011">(</span><span class="ident" id="4408012">labelOk</span><span class="op" id="4408019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4408023">//&nbsp;because&nbsp;of&nbsp;the&nbsp;required&nbsp;look-ahead,&nbsp;labeled&nbsp;statements&nbsp;are</span><br>
<span class="lineno">2130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4408087">//&nbsp;parsed&nbsp;by&nbsp;parseSimpleStmt&nbsp;-&nbsp;don&#39;t&nbsp;expect&nbsp;a&nbsp;semicolon&nbsp;after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4408151">//&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4408161">if</span>&nbsp;<span class="ident" id="4408164">_</span><span class="op" id="4408165">,</span>&nbsp;<span class="ident" id="4408167">isLabeledStmt</span>&nbsp;<span class="op" id="4408181">:=</span>&nbsp;<span class="ident" id="4408184">s</span><span class="op" id="4408185">.</span><span class="op" id="4408186">(</span><span class="op" id="4408187">*</span><span class="ident" id="4408188">ast</span><span class="op" id="4408191">.</span><span class="ident" id="4408192">LabeledStmt</span><span class="op" id="4408203">)</span><span class="op" id="4408204">;</span>&nbsp;<span class="op" id="4408206">!</span><span class="ident" id="4408207">isLabeledStmt</span>&nbsp;<span class="op" id="4408221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4408226">p</span><span class="op" id="4408227">.</span><span class="ident" id="4408228">expectSemi</span><span class="op" id="4408238">(</span><span class="op" id="4408239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4408243">}</span><br>
<span class="lineno">2135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4408246">case</span>&nbsp;<span class="ident" id="4408251">token</span><span class="op" id="4408256">.</span><span class="ident" id="4408257">GO</span><span class="op" id="4408259">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4408263">s</span>&nbsp;<span class="op" id="4408265">=</span>&nbsp;<span class="ident" id="4408267">p</span><span class="op" id="4408268">.</span><span class="ident" id="4408269">parseGoStmt</span><span class="op" id="4408280">(</span><span class="op" id="4408281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4408284">case</span>&nbsp;<span class="ident" id="4408289">token</span><span class="op" id="4408294">.</span><span class="ident" id="4408295">DEFER</span><span class="op" id="4408300">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4408304">s</span>&nbsp;<span class="op" id="4408306">=</span>&nbsp;<span class="ident" id="4408308">p</span><span class="op" id="4408309">.</span><span class="ident" id="4408310">parseDeferStmt</span><span class="op" id="4408324">(</span><span class="op" id="4408325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4408328">case</span>&nbsp;<span class="ident" id="4408333">token</span><span class="op" id="4408338">.</span><span class="ident" id="4408339">RETURN</span><span class="op" id="4408345">:</span><br>
<span class="lineno">2140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4408349">s</span>&nbsp;<span class="op" id="4408351">=</span>&nbsp;<span class="ident" id="4408353">p</span><span class="op" id="4408354">.</span><span class="ident" id="4408355">parseReturnStmt</span><span class="op" id="4408370">(</span><span class="op" id="4408371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4408374">case</span>&nbsp;<span class="ident" id="4408379">token</span><span class="op" id="4408384">.</span><span class="ident" id="4408385">BREAK</span><span class="op" id="4408390">,</span>&nbsp;<span class="ident" id="4408392">token</span><span class="op" id="4408397">.</span><span class="ident" id="4408398">CONTINUE</span><span class="op" id="4408406">,</span>&nbsp;<span class="ident" id="4408408">token</span><span class="op" id="4408413">.</span><span class="ident" id="4408414">GOTO</span><span class="op" id="4408418">,</span>&nbsp;<span class="ident" id="4408420">token</span><span class="op" id="4408425">.</span><span class="ident" id="4408426">FALLTHROUGH</span><span class="op" id="4408437">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4408441">s</span>&nbsp;<span class="op" id="4408443">=</span>&nbsp;<span class="ident" id="4408445">p</span><span class="op" id="4408446">.</span><span class="ident" id="4408447">parseBranchStmt</span><span class="op" id="4408462">(</span><span class="ident" id="4408463">p</span><span class="op" id="4408464">.</span><span class="ident" id="4408465">tok</span><span class="op" id="4408468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4408471">case</span>&nbsp;<span class="ident" id="4408476">token</span><span class="op" id="4408481">.</span><span class="ident" id="4408482">LBRACE</span><span class="op" id="4408488">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4408492">s</span>&nbsp;<span class="op" id="4408494">=</span>&nbsp;<span class="ident" id="4408496">p</span><span class="op" id="4408497">.</span><span class="ident" id="4408498">parseBlockStmt</span><span class="op" id="4408512">(</span><span class="op" id="4408513">)</span><br>
<span class="lineno">2145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4408517">p</span><span class="op" id="4408518">.</span><span class="ident" id="4408519">expectSemi</span><span class="op" id="4408529">(</span><span class="op" id="4408530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4408533">case</span>&nbsp;<span class="ident" id="4408538">token</span><span class="op" id="4408543">.</span><span class="ident" id="4408544">IF</span><span class="op" id="4408546">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4408550">s</span>&nbsp;<span class="op" id="4408552">=</span>&nbsp;<span class="ident" id="4408554">p</span><span class="op" id="4408555">.</span><span class="ident" id="4408556">parseIfStmt</span><span class="op" id="4408567">(</span><span class="op" id="4408568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4408571">case</span>&nbsp;<span class="ident" id="4408576">token</span><span class="op" id="4408581">.</span><span class="ident" id="4408582">SWITCH</span><span class="op" id="4408588">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4408592">s</span>&nbsp;<span class="op" id="4408594">=</span>&nbsp;<span class="ident" id="4408596">p</span><span class="op" id="4408597">.</span><span class="ident" id="4408598">parseSwitchStmt</span><span class="op" id="4408613">(</span><span class="op" id="4408614">)</span><br>
<span class="lineno">2150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4408617">case</span>&nbsp;<span class="ident" id="4408622">token</span><span class="op" id="4408627">.</span><span class="ident" id="4408628">SELECT</span><span class="op" id="4408634">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4408638">s</span>&nbsp;<span class="op" id="4408640">=</span>&nbsp;<span class="ident" id="4408642">p</span><span class="op" id="4408643">.</span><span class="ident" id="4408644">parseSelectStmt</span><span class="op" id="4408659">(</span><span class="op" id="4408660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4408663">case</span>&nbsp;<span class="ident" id="4408668">token</span><span class="op" id="4408673">.</span><span class="ident" id="4408674">FOR</span><span class="op" id="4408677">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4408681">s</span>&nbsp;<span class="op" id="4408683">=</span>&nbsp;<span class="ident" id="4408685">p</span><span class="op" id="4408686">.</span><span class="ident" id="4408687">parseForStmt</span><span class="op" id="4408699">(</span><span class="op" id="4408700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4408703">case</span>&nbsp;<span class="ident" id="4408708">token</span><span class="op" id="4408713">.</span><span class="ident" id="4408714">SEMICOLON</span><span class="op" id="4408723">:</span><br>
<span class="lineno">2155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4408727">s</span>&nbsp;<span class="op" id="4408729">=</span>&nbsp;<span class="op" id="4408731">&amp;</span><span class="ident" id="4408732">ast</span><span class="op" id="4408735">.</span><span class="ident" id="4408736">EmptyStmt</span><span class="op" id="4408745">{</span><span class="ident" id="4408746">Semicolon</span><span class="op" id="4408755">:</span>&nbsp;<span class="ident" id="4408757">p</span><span class="op" id="4408758">.</span><span class="ident" id="4408759">pos</span><span class="op" id="4408762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4408766">p</span><span class="op" id="4408767">.</span><span class="ident" id="4408768">next</span><span class="op" id="4408772">(</span><span class="op" id="4408773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4408776">case</span>&nbsp;<span class="ident" id="4408781">token</span><span class="op" id="4408786">.</span><span class="ident" id="4408787">RBRACE</span><span class="op" id="4408793">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4408797">//&nbsp;a&nbsp;semicolon&nbsp;may&nbsp;be&nbsp;omitted&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#34;}&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4408850">s</span>&nbsp;<span class="op" id="4408852">=</span>&nbsp;<span class="op" id="4408854">&amp;</span><span class="ident" id="4408855">ast</span><span class="op" id="4408858">.</span><span class="ident" id="4408859">EmptyStmt</span><span class="op" id="4408868">{</span><span class="ident" id="4408869">Semicolon</span><span class="op" id="4408878">:</span>&nbsp;<span class="ident" id="4408880">p</span><span class="op" id="4408881">.</span><span class="ident" id="4408882">pos</span><span class="op" id="4408885">}</span><br>
<span class="lineno">2160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4408888">default</span><span class="op" id="4408895">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4408899">//&nbsp;no&nbsp;statement&nbsp;found</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4408923">pos</span>&nbsp;<span class="op" id="4408927">:=</span>&nbsp;<span class="ident" id="4408930">p</span><span class="op" id="4408931">.</span><span class="ident" id="4408932">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4408938">p</span><span class="op" id="4408939">.</span><span class="ident" id="4408940">errorExpected</span><span class="op" id="4408953">(</span><span class="ident" id="4408954">pos</span><span class="op" id="4408957">,</span>&nbsp;<span class="string" id="4408959">&#34;statement&#34;</span><span class="op" id="4408970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4408974">syncStmt</span><span class="op" id="4408982">(</span><span class="ident" id="4408983">p</span><span class="op" id="4408984">)</span><br>
<span class="lineno">2165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4408988">s</span>&nbsp;<span class="op" id="4408990">=</span>&nbsp;<span class="op" id="4408992">&amp;</span><span class="ident" id="4408993">ast</span><span class="op" id="4408996">.</span><span class="ident" id="4408997">BadStmt</span><span class="op" id="4409004">{</span><span class="ident" id="4409005">From</span><span class="op" id="4409009">:</span>&nbsp;<span class="ident" id="4409011">pos</span><span class="op" id="4409014">,</span>&nbsp;<span class="ident" id="4409016">To</span><span class="op" id="4409018">:</span>&nbsp;<span class="ident" id="4409020">p</span><span class="op" id="4409021">.</span><span class="ident" id="4409022">pos</span><span class="op" id="4409025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4409028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4409032">return</span><br>
<span class="lineno"></span><span class="op" id="4409039">}</span><br>
<span class="lineno">2170</span><br>
<span class="lineno"></span><span class="comment" id="4409042">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4409122">//&nbsp;Declarations</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4409139">type</span>&nbsp;<span class="ident" id="4409144">parseSpecFunction</span>&nbsp;<span class="keyword" id="4409162">func</span><span class="op" id="4409166">(</span><span class="ident" id="4409167">doc</span>&nbsp;<span class="op" id="4409171">*</span><span class="ident" id="4409172">ast</span><span class="op" id="4409175">.</span><span class="ident" id="4409176">CommentGroup</span><span class="op" id="4409188">,</span>&nbsp;<span class="ident" id="4409190">keyword</span>&nbsp;<span class="ident" id="4409198">token</span><span class="op" id="4409203">.</span><span class="ident" id="4409204">Token</span><span class="op" id="4409209">,</span>&nbsp;<span class="ident" id="4409211">iota</span>&nbsp;<span class="builtintype" id="4409216">int</span><span class="op" id="4409219">)</span>&nbsp;<span class="ident" id="4409221">ast</span><span class="op" id="4409224">.</span><span class="ident" id="4409225">Spec</span><br>
<span class="lineno">2175</span><br>
<span class="lineno"></span><span class="keyword" id="4409231">func</span>&nbsp;<span class="ident" id="4409236">isValidImport</span><span class="op" id="4409249">(</span><span class="ident" id="4409250">lit</span>&nbsp;<span class="builtintype" id="4409254">string</span><span class="op" id="4409260">)</span>&nbsp;<span class="builtintype" id="4409262">bool</span>&nbsp;<span class="op" id="4409267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4409270">const</span>&nbsp;<span class="ident" id="4409276">illegalChars</span>&nbsp;<span class="op" id="4409289">=</span>&nbsp;<span class="string" id="4409291">`!&#34;#$%&amp;&#39;()*,:;&lt;=&gt;?[\]^{|}`</span>&nbsp;<span class="op" id="4409318">+</span>&nbsp;<span class="string" id="4409320">&#34;`\uFFFD&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4409331">s</span><span class="op" id="4409332">,</span>&nbsp;<span class="ident" id="4409334">_</span>&nbsp;<span class="op" id="4409336">:=</span>&nbsp;<span class="ident" id="4409339">strconv</span><span class="op" id="4409346">.</span><span class="ident" id="4409347">Unquote</span><span class="op" id="4409354">(</span><span class="ident" id="4409355">lit</span><span class="op" id="4409358">)</span>&nbsp;<span class="comment" id="4409360">//&nbsp;go/scanner&nbsp;returns&nbsp;a&nbsp;legal&nbsp;string&nbsp;literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4409406">for</span>&nbsp;<span class="ident" id="4409410">_</span><span class="op" id="4409411">,</span>&nbsp;<span class="ident" id="4409413">r</span>&nbsp;<span class="op" id="4409415">:=</span>&nbsp;<span class="keyword" id="4409418">range</span>&nbsp;<span class="ident" id="4409424">s</span>&nbsp;<span class="op" id="4409426">{</span><br>
<span class="lineno">2180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4409430">if</span>&nbsp;<span class="op" id="4409433">!</span><span class="ident" id="4409434">unicode</span><span class="op" id="4409441">.</span><span class="ident" id="4409442">IsGraphic</span><span class="op" id="4409451">(</span><span class="ident" id="4409452">r</span><span class="op" id="4409453">)</span>&nbsp;<span class="op" id="4409455">||</span>&nbsp;<span class="ident" id="4409458">unicode</span><span class="op" id="4409465">.</span><span class="ident" id="4409466">IsSpace</span><span class="op" id="4409473">(</span><span class="ident" id="4409474">r</span><span class="op" id="4409475">)</span>&nbsp;<span class="op" id="4409477">||</span>&nbsp;<span class="ident" id="4409480">strings</span><span class="op" id="4409487">.</span><span class="ident" id="4409488">ContainsRune</span><span class="op" id="4409500">(</span><span class="ident" id="4409501">illegalChars</span><span class="op" id="4409513">,</span>&nbsp;<span class="ident" id="4409515">r</span><span class="op" id="4409516">)</span>&nbsp;<span class="op" id="4409518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4409523">return</span>&nbsp;<span class="builtintype" id="4409530">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4409538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4409541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4409544">return</span>&nbsp;<span class="ident" id="4409551">s</span>&nbsp;<span class="op" id="4409553">!=</span>&nbsp;<span class="string" id="4409556">&#34;&#34;</span><br>
<span class="lineno">2185</span><span class="op" id="4409559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4409562">func</span>&nbsp;<span class="op" id="4409567">(</span><span class="ident" id="4409568">p</span>&nbsp;<span class="op" id="4409570">*</span><span class="ident" id="4409571">parser</span><span class="op" id="4409577">)</span>&nbsp;<span class="ident" id="4409579">parseImportSpec</span><span class="op" id="4409594">(</span><span class="ident" id="4409595">doc</span>&nbsp;<span class="op" id="4409599">*</span><span class="ident" id="4409600">ast</span><span class="op" id="4409603">.</span><span class="ident" id="4409604">CommentGroup</span><span class="op" id="4409616">,</span>&nbsp;<span class="ident" id="4409618">_</span>&nbsp;<span class="ident" id="4409620">token</span><span class="op" id="4409625">.</span><span class="ident" id="4409626">Token</span><span class="op" id="4409631">,</span>&nbsp;<span class="ident" id="4409633">_</span>&nbsp;<span class="builtintype" id="4409635">int</span><span class="op" id="4409638">)</span>&nbsp;<span class="ident" id="4409640">ast</span><span class="op" id="4409643">.</span><span class="ident" id="4409644">Spec</span>&nbsp;<span class="op" id="4409649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4409652">if</span>&nbsp;<span class="ident" id="4409655">p</span><span class="op" id="4409656">.</span><span class="ident" id="4409657">trace</span>&nbsp;<span class="op" id="4409663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4409667">defer</span>&nbsp;<span class="ident" id="4409673">un</span><span class="op" id="4409675">(</span><span class="ident" id="4409676">trace</span><span class="op" id="4409681">(</span><span class="ident" id="4409682">p</span><span class="op" id="4409683">,</span>&nbsp;<span class="string" id="4409685">&#34;ImportSpec&#34;</span><span class="op" id="4409697">)</span><span class="op" id="4409698">)</span><br>
<span class="lineno">2190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4409701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4409705">var</span>&nbsp;<span class="ident" id="4409709">ident</span>&nbsp;<span class="op" id="4409715">*</span><span class="ident" id="4409716">ast</span><span class="op" id="4409719">.</span><span class="ident" id="4409720">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4409727">switch</span>&nbsp;<span class="ident" id="4409734">p</span><span class="op" id="4409735">.</span><span class="ident" id="4409736">tok</span>&nbsp;<span class="op" id="4409740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4409743">case</span>&nbsp;<span class="ident" id="4409748">token</span><span class="op" id="4409753">.</span><span class="ident" id="4409754">PERIOD</span><span class="op" id="4409760">:</span><br>
<span class="lineno">2195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4409764">ident</span>&nbsp;<span class="op" id="4409770">=</span>&nbsp;<span class="op" id="4409772">&amp;</span><span class="ident" id="4409773">ast</span><span class="op" id="4409776">.</span><span class="ident" id="4409777">Ident</span><span class="op" id="4409782">{</span><span class="ident" id="4409783">NamePos</span><span class="op" id="4409790">:</span>&nbsp;<span class="ident" id="4409792">p</span><span class="op" id="4409793">.</span><span class="ident" id="4409794">pos</span><span class="op" id="4409797">,</span>&nbsp;<span class="ident" id="4409799">Name</span><span class="op" id="4409803">:</span>&nbsp;<span class="string" id="4409805">&#34;.&#34;</span><span class="op" id="4409808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4409812">p</span><span class="op" id="4409813">.</span><span class="ident" id="4409814">next</span><span class="op" id="4409818">(</span><span class="op" id="4409819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4409822">case</span>&nbsp;<span class="ident" id="4409827">token</span><span class="op" id="4409832">.</span><span class="ident" id="4409833">IDENT</span><span class="op" id="4409838">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4409842">ident</span>&nbsp;<span class="op" id="4409848">=</span>&nbsp;<span class="ident" id="4409850">p</span><span class="op" id="4409851">.</span><span class="ident" id="4409852">parseIdent</span><span class="op" id="4409862">(</span><span class="op" id="4409863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4409866">}</span><br>
<span class="lineno">2200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4409870">pos</span>&nbsp;<span class="op" id="4409874">:=</span>&nbsp;<span class="ident" id="4409877">p</span><span class="op" id="4409878">.</span><span class="ident" id="4409879">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4409884">var</span>&nbsp;<span class="ident" id="4409888">path</span>&nbsp;<span class="builtintype" id="4409893">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4409901">if</span>&nbsp;<span class="ident" id="4409904">p</span><span class="op" id="4409905">.</span><span class="ident" id="4409906">tok</span>&nbsp;<span class="op" id="4409910">==</span>&nbsp;<span class="ident" id="4409913">token</span><span class="op" id="4409918">.</span><span class="ident" id="4409919">STRING</span>&nbsp;<span class="op" id="4409926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4409930">path</span>&nbsp;<span class="op" id="4409935">=</span>&nbsp;<span class="ident" id="4409937">p</span><span class="op" id="4409938">.</span><span class="ident" id="4409939">lit</span><br>
<span class="lineno">2205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4409945">if</span>&nbsp;<span class="op" id="4409948">!</span><span class="ident" id="4409949">isValidImport</span><span class="op" id="4409962">(</span><span class="ident" id="4409963">path</span><span class="op" id="4409967">)</span>&nbsp;<span class="op" id="4409969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4409974">p</span><span class="op" id="4409975">.</span><span class="builtintype" id="4409976">error</span><span class="op" id="4409981">(</span><span class="ident" id="4409982">pos</span><span class="op" id="4409985">,</span>&nbsp;<span class="string" id="4409987">&#34;invalid&nbsp;import&nbsp;path:&nbsp;&#34;</span><span class="op" id="4410010">+</span><span class="ident" id="4410011">path</span><span class="op" id="4410015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4410019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4410023">p</span><span class="op" id="4410024">.</span><span class="ident" id="4410025">next</span><span class="op" id="4410029">(</span><span class="op" id="4410030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4410033">}</span>&nbsp;<span class="keyword" id="4410035">else</span>&nbsp;<span class="op" id="4410040">{</span><br>
<span class="lineno">2210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4410044">p</span><span class="op" id="4410045">.</span><span class="ident" id="4410046">expect</span><span class="op" id="4410052">(</span><span class="ident" id="4410053">token</span><span class="op" id="4410058">.</span><span class="ident" id="4410059">STRING</span><span class="op" id="4410065">)</span>&nbsp;<span class="comment" id="4410067">//&nbsp;use&nbsp;expect()&nbsp;error&nbsp;handling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4410099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4410102">p</span><span class="op" id="4410103">.</span><span class="ident" id="4410104">expectSemi</span><span class="op" id="4410114">(</span><span class="op" id="4410115">)</span>&nbsp;<span class="comment" id="4410117">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4410158">//&nbsp;collect&nbsp;imports</span><br>
<span class="lineno">2215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4410178">spec</span>&nbsp;<span class="op" id="4410183">:=</span>&nbsp;<span class="op" id="4410186">&amp;</span><span class="ident" id="4410187">ast</span><span class="op" id="4410190">.</span><span class="ident" id="4410191">ImportSpec</span><span class="op" id="4410201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4410205">Doc</span><span class="op" id="4410208">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4410214">doc</span><span class="op" id="4410217">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4410221">Name</span><span class="op" id="4410225">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4410230">ident</span><span class="op" id="4410235">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4410239">Path</span><span class="op" id="4410243">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4410248">&amp;</span><span class="ident" id="4410249">ast</span><span class="op" id="4410252">.</span><span class="ident" id="4410253">BasicLit</span><span class="op" id="4410261">{</span><span class="ident" id="4410262">ValuePos</span><span class="op" id="4410270">:</span>&nbsp;<span class="ident" id="4410272">pos</span><span class="op" id="4410275">,</span>&nbsp;<span class="ident" id="4410277">Kind</span><span class="op" id="4410281">:</span>&nbsp;<span class="ident" id="4410283">token</span><span class="op" id="4410288">.</span><span class="ident" id="4410289">STRING</span><span class="op" id="4410295">,</span>&nbsp;<span class="ident" id="4410297">Value</span><span class="op" id="4410302">:</span>&nbsp;<span class="ident" id="4410304">path</span><span class="op" id="4410308">}</span><span class="op" id="4410309">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4410313">Comment</span><span class="op" id="4410320">:</span>&nbsp;<span class="ident" id="4410322">p</span><span class="op" id="4410323">.</span><span class="ident" id="4410324">lineComment</span><span class="op" id="4410335">,</span><br>
<span class="lineno">2220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4410338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4410341">p</span><span class="op" id="4410342">.</span><span class="ident" id="4410343">imports</span>&nbsp;<span class="op" id="4410351">=</span>&nbsp;<span class="builtinfunc" id="4410353">append</span><span class="op" id="4410359">(</span><span class="ident" id="4410360">p</span><span class="op" id="4410361">.</span><span class="ident" id="4410362">imports</span><span class="op" id="4410369">,</span>&nbsp;<span class="ident" id="4410371">spec</span><span class="op" id="4410375">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4410379">return</span>&nbsp;<span class="ident" id="4410386">spec</span><br>
<span class="lineno"></span><span class="op" id="4410391">}</span><br>
<span class="lineno">2225</span><br>
<span class="lineno"></span><span class="keyword" id="4410394">func</span>&nbsp;<span class="op" id="4410399">(</span><span class="ident" id="4410400">p</span>&nbsp;<span class="op" id="4410402">*</span><span class="ident" id="4410403">parser</span><span class="op" id="4410409">)</span>&nbsp;<span class="ident" id="4410411">parseValueSpec</span><span class="op" id="4410425">(</span><span class="ident" id="4410426">doc</span>&nbsp;<span class="op" id="4410430">*</span><span class="ident" id="4410431">ast</span><span class="op" id="4410434">.</span><span class="ident" id="4410435">CommentGroup</span><span class="op" id="4410447">,</span>&nbsp;<span class="ident" id="4410449">keyword</span>&nbsp;<span class="ident" id="4410457">token</span><span class="op" id="4410462">.</span><span class="ident" id="4410463">Token</span><span class="op" id="4410468">,</span>&nbsp;<span class="ident" id="4410470">iota</span>&nbsp;<span class="builtintype" id="4410475">int</span><span class="op" id="4410478">)</span>&nbsp;<span class="ident" id="4410480">ast</span><span class="op" id="4410483">.</span><span class="ident" id="4410484">Spec</span>&nbsp;<span class="op" id="4410489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4410492">if</span>&nbsp;<span class="ident" id="4410495">p</span><span class="op" id="4410496">.</span><span class="ident" id="4410497">trace</span>&nbsp;<span class="op" id="4410503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4410507">defer</span>&nbsp;<span class="ident" id="4410513">un</span><span class="op" id="4410515">(</span><span class="ident" id="4410516">trace</span><span class="op" id="4410521">(</span><span class="ident" id="4410522">p</span><span class="op" id="4410523">,</span>&nbsp;<span class="ident" id="4410525">keyword</span><span class="op" id="4410532">.</span><span class="ident" id="4410533">String</span><span class="op" id="4410539">(</span><span class="op" id="4410540">)</span><span class="op" id="4410541">+</span><span class="string" id="4410542">&#34;Spec&#34;</span><span class="op" id="4410548">)</span><span class="op" id="4410549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4410552">}</span><br>
<span class="lineno">2230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4410556">idents</span>&nbsp;<span class="op" id="4410563">:=</span>&nbsp;<span class="ident" id="4410566">p</span><span class="op" id="4410567">.</span><span class="ident" id="4410568">parseIdentList</span><span class="op" id="4410582">(</span><span class="op" id="4410583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4410586">typ</span>&nbsp;<span class="op" id="4410590">:=</span>&nbsp;<span class="ident" id="4410593">p</span><span class="op" id="4410594">.</span><span class="ident" id="4410595">tryType</span><span class="op" id="4410602">(</span><span class="op" id="4410603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4410606">var</span>&nbsp;<span class="ident" id="4410610">values</span>&nbsp;<span class="op" id="4410617">[</span><span class="op" id="4410618">]</span><span class="ident" id="4410619">ast</span><span class="op" id="4410622">.</span><span class="ident" id="4410623">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4410629">//&nbsp;always&nbsp;permit&nbsp;optional&nbsp;initialization&nbsp;for&nbsp;more&nbsp;tolerant&nbsp;parsing</span><br>
<span class="lineno">2235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4410697">if</span>&nbsp;<span class="ident" id="4410700">p</span><span class="op" id="4410701">.</span><span class="ident" id="4410702">tok</span>&nbsp;<span class="op" id="4410706">==</span>&nbsp;<span class="ident" id="4410709">token</span><span class="op" id="4410714">.</span><span class="ident" id="4410715">ASSIGN</span>&nbsp;<span class="op" id="4410722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4410726">p</span><span class="op" id="4410727">.</span><span class="ident" id="4410728">next</span><span class="op" id="4410732">(</span><span class="op" id="4410733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4410737">values</span>&nbsp;<span class="op" id="4410744">=</span>&nbsp;<span class="ident" id="4410746">p</span><span class="op" id="4410747">.</span><span class="ident" id="4410748">parseRhsList</span><span class="op" id="4410760">(</span><span class="op" id="4410761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4410764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4410767">p</span><span class="op" id="4410768">.</span><span class="ident" id="4410769">expectSemi</span><span class="op" id="4410779">(</span><span class="op" id="4410780">)</span>&nbsp;<span class="comment" id="4410782">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno">2240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4410823">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;constant&nbsp;or&nbsp;variable&nbsp;identifier&nbsp;declared&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4410899">//&nbsp;a&nbsp;function&nbsp;begins&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;ConstSpec&nbsp;or&nbsp;VarSpec&nbsp;and&nbsp;ends&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4410972">//&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;innermost&nbsp;containing&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4411019">//&nbsp;(Global&nbsp;identifiers&nbsp;are&nbsp;resolved&nbsp;in&nbsp;a&nbsp;separate&nbsp;phase&nbsp;after&nbsp;parsing.)</span><br>
<span class="lineno">2245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4411092">spec</span>&nbsp;<span class="op" id="4411097">:=</span>&nbsp;<span class="op" id="4411100">&amp;</span><span class="ident" id="4411101">ast</span><span class="op" id="4411104">.</span><span class="ident" id="4411105">ValueSpec</span><span class="op" id="4411114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4411118">Doc</span><span class="op" id="4411121">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4411127">doc</span><span class="op" id="4411130">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4411134">Names</span><span class="op" id="4411139">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4411143">idents</span><span class="op" id="4411149">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4411153">Type</span><span class="op" id="4411157">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4411162">typ</span><span class="op" id="4411165">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4411169">Values</span><span class="op" id="4411175">:</span>&nbsp;&nbsp;<span class="ident" id="4411178">values</span><span class="op" id="4411184">,</span><br>
<span class="lineno">2250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4411188">Comment</span><span class="op" id="4411195">:</span>&nbsp;<span class="ident" id="4411197">p</span><span class="op" id="4411198">.</span><span class="ident" id="4411199">lineComment</span><span class="op" id="4411210">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4411213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4411216">kind</span>&nbsp;<span class="op" id="4411221">:=</span>&nbsp;<span class="ident" id="4411224">ast</span><span class="op" id="4411227">.</span><span class="ident" id="4411228">Con</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4411233">if</span>&nbsp;<span class="ident" id="4411236">keyword</span>&nbsp;<span class="op" id="4411244">==</span>&nbsp;<span class="ident" id="4411247">token</span><span class="op" id="4411252">.</span><span class="ident" id="4411253">VAR</span>&nbsp;<span class="op" id="4411257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4411261">kind</span>&nbsp;<span class="op" id="4411266">=</span>&nbsp;<span class="ident" id="4411268">ast</span><span class="op" id="4411271">.</span><span class="ident" id="4411272">Var</span><br>
<span class="lineno">2255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4411277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4411280">p</span><span class="op" id="4411281">.</span><span class="ident" id="4411282">declare</span><span class="op" id="4411289">(</span><span class="ident" id="4411290">spec</span><span class="op" id="4411294">,</span>&nbsp;<span class="ident" id="4411296">iota</span><span class="op" id="4411300">,</span>&nbsp;<span class="ident" id="4411302">p</span><span class="op" id="4411303">.</span><span class="ident" id="4411304">topScope</span><span class="op" id="4411312">,</span>&nbsp;<span class="ident" id="4411314">kind</span><span class="op" id="4411318">,</span>&nbsp;<span class="ident" id="4411320">idents</span><span class="op" id="4411326">...</span><span class="op" id="4411329">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4411333">return</span>&nbsp;<span class="ident" id="4411340">spec</span><br>
<span class="lineno"></span><span class="op" id="4411345">}</span><br>
<span class="lineno">2260</span><br>
<span class="lineno"></span><span class="keyword" id="4411348">func</span>&nbsp;<span class="op" id="4411353">(</span><span class="ident" id="4411354">p</span>&nbsp;<span class="op" id="4411356">*</span><span class="ident" id="4411357">parser</span><span class="op" id="4411363">)</span>&nbsp;<span class="ident" id="4411365">parseTypeSpec</span><span class="op" id="4411378">(</span><span class="ident" id="4411379">doc</span>&nbsp;<span class="op" id="4411383">*</span><span class="ident" id="4411384">ast</span><span class="op" id="4411387">.</span><span class="ident" id="4411388">CommentGroup</span><span class="op" id="4411400">,</span>&nbsp;<span class="ident" id="4411402">_</span>&nbsp;<span class="ident" id="4411404">token</span><span class="op" id="4411409">.</span><span class="ident" id="4411410">Token</span><span class="op" id="4411415">,</span>&nbsp;<span class="ident" id="4411417">_</span>&nbsp;<span class="builtintype" id="4411419">int</span><span class="op" id="4411422">)</span>&nbsp;<span class="ident" id="4411424">ast</span><span class="op" id="4411427">.</span><span class="ident" id="4411428">Spec</span>&nbsp;<span class="op" id="4411433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4411436">if</span>&nbsp;<span class="ident" id="4411439">p</span><span class="op" id="4411440">.</span><span class="ident" id="4411441">trace</span>&nbsp;<span class="op" id="4411447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4411451">defer</span>&nbsp;<span class="ident" id="4411457">un</span><span class="op" id="4411459">(</span><span class="ident" id="4411460">trace</span><span class="op" id="4411465">(</span><span class="ident" id="4411466">p</span><span class="op" id="4411467">,</span>&nbsp;<span class="string" id="4411469">&#34;TypeSpec&#34;</span><span class="op" id="4411479">)</span><span class="op" id="4411480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4411483">}</span><br>
<span class="lineno">2265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4411487">ident</span>&nbsp;<span class="op" id="4411493">:=</span>&nbsp;<span class="ident" id="4411496">p</span><span class="op" id="4411497">.</span><span class="ident" id="4411498">parseIdent</span><span class="op" id="4411508">(</span><span class="op" id="4411509">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4411513">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;type&nbsp;identifier&nbsp;declared&nbsp;inside&nbsp;a&nbsp;function&nbsp;begins</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4411591">//&nbsp;at&nbsp;the&nbsp;identifier&nbsp;in&nbsp;the&nbsp;TypeSpec&nbsp;and&nbsp;ends&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;innermost</span><br>
<span class="lineno">2270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4411666">//&nbsp;containing&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4411688">//&nbsp;(Global&nbsp;identifiers&nbsp;are&nbsp;resolved&nbsp;in&nbsp;a&nbsp;separate&nbsp;phase&nbsp;after&nbsp;parsing.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4411761">spec</span>&nbsp;<span class="op" id="4411766">:=</span>&nbsp;<span class="op" id="4411769">&amp;</span><span class="ident" id="4411770">ast</span><span class="op" id="4411773">.</span><span class="ident" id="4411774">TypeSpec</span><span class="op" id="4411782">{</span><span class="ident" id="4411783">Doc</span><span class="op" id="4411786">:</span>&nbsp;<span class="ident" id="4411788">doc</span><span class="op" id="4411791">,</span>&nbsp;<span class="ident" id="4411793">Name</span><span class="op" id="4411797">:</span>&nbsp;<span class="ident" id="4411799">ident</span><span class="op" id="4411804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4411807">p</span><span class="op" id="4411808">.</span><span class="ident" id="4411809">declare</span><span class="op" id="4411816">(</span><span class="ident" id="4411817">spec</span><span class="op" id="4411821">,</span>&nbsp;<span class="ident" id="4411823">nil</span><span class="op" id="4411826">,</span>&nbsp;<span class="ident" id="4411828">p</span><span class="op" id="4411829">.</span><span class="ident" id="4411830">topScope</span><span class="op" id="4411838">,</span>&nbsp;<span class="ident" id="4411840">ast</span><span class="op" id="4411843">.</span><span class="ident" id="4411844">Typ</span><span class="op" id="4411847">,</span>&nbsp;<span class="ident" id="4411849">ident</span><span class="op" id="4411854">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">2275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4411858">spec</span><span class="op" id="4411862">.</span><span class="ident" id="4411863">Type</span>&nbsp;<span class="op" id="4411868">=</span>&nbsp;<span class="ident" id="4411870">p</span><span class="op" id="4411871">.</span><span class="ident" id="4411872">parseType</span><span class="op" id="4411881">(</span><span class="op" id="4411882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4411885">p</span><span class="op" id="4411886">.</span><span class="ident" id="4411887">expectSemi</span><span class="op" id="4411897">(</span><span class="op" id="4411898">)</span>&nbsp;<span class="comment" id="4411900">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4411940">spec</span><span class="op" id="4411944">.</span><span class="ident" id="4411945">Comment</span>&nbsp;<span class="op" id="4411953">=</span>&nbsp;<span class="ident" id="4411955">p</span><span class="op" id="4411956">.</span><span class="ident" id="4411957">lineComment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4411971">return</span>&nbsp;<span class="ident" id="4411978">spec</span><br>
<span class="lineno">2280</span><span class="op" id="4411983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4411986">func</span>&nbsp;<span class="op" id="4411991">(</span><span class="ident" id="4411992">p</span>&nbsp;<span class="op" id="4411994">*</span><span class="ident" id="4411995">parser</span><span class="op" id="4412001">)</span>&nbsp;<span class="ident" id="4412003">parseGenDecl</span><span class="op" id="4412015">(</span><span class="ident" id="4412016">keyword</span>&nbsp;<span class="ident" id="4412024">token</span><span class="op" id="4412029">.</span><span class="ident" id="4412030">Token</span><span class="op" id="4412035">,</span>&nbsp;<span class="ident" id="4412037">f</span>&nbsp;<span class="ident" id="4412039">parseSpecFunction</span><span class="op" id="4412056">)</span>&nbsp;<span class="op" id="4412058">*</span><span class="ident" id="4412059">ast</span><span class="op" id="4412062">.</span><span class="ident" id="4412063">GenDecl</span>&nbsp;<span class="op" id="4412071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4412074">if</span>&nbsp;<span class="ident" id="4412077">p</span><span class="op" id="4412078">.</span><span class="ident" id="4412079">trace</span>&nbsp;<span class="op" id="4412085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4412089">defer</span>&nbsp;<span class="ident" id="4412095">un</span><span class="op" id="4412097">(</span><span class="ident" id="4412098">trace</span><span class="op" id="4412103">(</span><span class="ident" id="4412104">p</span><span class="op" id="4412105">,</span>&nbsp;<span class="string" id="4412107">&#34;GenDecl(&#34;</span><span class="op" id="4412117">+</span><span class="ident" id="4412118">keyword</span><span class="op" id="4412125">.</span><span class="ident" id="4412126">String</span><span class="op" id="4412132">(</span><span class="op" id="4412133">)</span><span class="op" id="4412134">+</span><span class="string" id="4412135">&#34;)&#34;</span><span class="op" id="4412138">)</span><span class="op" id="4412139">)</span><br>
<span class="lineno">2285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4412142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4412146">doc</span>&nbsp;<span class="op" id="4412150">:=</span>&nbsp;<span class="ident" id="4412153">p</span><span class="op" id="4412154">.</span><span class="ident" id="4412155">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4412168">pos</span>&nbsp;<span class="op" id="4412172">:=</span>&nbsp;<span class="ident" id="4412175">p</span><span class="op" id="4412176">.</span><span class="ident" id="4412177">expect</span><span class="op" id="4412183">(</span><span class="ident" id="4412184">keyword</span><span class="op" id="4412191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4412194">var</span>&nbsp;<span class="ident" id="4412198">lparen</span><span class="op" id="4412204">,</span>&nbsp;<span class="ident" id="4412206">rparen</span>&nbsp;<span class="ident" id="4412213">token</span><span class="op" id="4412218">.</span><span class="ident" id="4412219">Pos</span><br>
<span class="lineno">2290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4412224">var</span>&nbsp;<span class="ident" id="4412228">list</span>&nbsp;<span class="op" id="4412233">[</span><span class="op" id="4412234">]</span><span class="ident" id="4412235">ast</span><span class="op" id="4412238">.</span><span class="ident" id="4412239">Spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4412245">if</span>&nbsp;<span class="ident" id="4412248">p</span><span class="op" id="4412249">.</span><span class="ident" id="4412250">tok</span>&nbsp;<span class="op" id="4412254">==</span>&nbsp;<span class="ident" id="4412257">token</span><span class="op" id="4412262">.</span><span class="ident" id="4412263">LPAREN</span>&nbsp;<span class="op" id="4412270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4412274">lparen</span>&nbsp;<span class="op" id="4412281">=</span>&nbsp;<span class="ident" id="4412283">p</span><span class="op" id="4412284">.</span><span class="ident" id="4412285">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4412291">p</span><span class="op" id="4412292">.</span><span class="ident" id="4412293">next</span><span class="op" id="4412297">(</span><span class="op" id="4412298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4412302">for</span>&nbsp;<span class="ident" id="4412306">iota</span>&nbsp;<span class="op" id="4412311">:=</span>&nbsp;<span class="num" id="4412314">0</span><span class="op" id="4412315">;</span>&nbsp;<span class="ident" id="4412317">p</span><span class="op" id="4412318">.</span><span class="ident" id="4412319">tok</span>&nbsp;<span class="op" id="4412323">!=</span>&nbsp;<span class="ident" id="4412326">token</span><span class="op" id="4412331">.</span><span class="ident" id="4412332">RPAREN</span>&nbsp;<span class="op" id="4412339">&amp;&amp;</span>&nbsp;<span class="ident" id="4412342">p</span><span class="op" id="4412343">.</span><span class="ident" id="4412344">tok</span>&nbsp;<span class="op" id="4412348">!=</span>&nbsp;<span class="ident" id="4412351">token</span><span class="op" id="4412356">.</span><span class="ident" id="4412357">EOF</span><span class="op" id="4412360">;</span>&nbsp;<span class="ident" id="4412362">iota</span><span class="op" id="4412366">++</span>&nbsp;<span class="op" id="4412369">{</span><br>
<span class="lineno">2295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4412374">list</span>&nbsp;<span class="op" id="4412379">=</span>&nbsp;<span class="builtinfunc" id="4412381">append</span><span class="op" id="4412387">(</span><span class="ident" id="4412388">list</span><span class="op" id="4412392">,</span>&nbsp;<span class="ident" id="4412394">f</span><span class="op" id="4412395">(</span><span class="ident" id="4412396">p</span><span class="op" id="4412397">.</span><span class="ident" id="4412398">leadComment</span><span class="op" id="4412409">,</span>&nbsp;<span class="ident" id="4412411">keyword</span><span class="op" id="4412418">,</span>&nbsp;<span class="ident" id="4412420">iota</span><span class="op" id="4412424">)</span><span class="op" id="4412425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4412429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4412433">rparen</span>&nbsp;<span class="op" id="4412440">=</span>&nbsp;<span class="ident" id="4412442">p</span><span class="op" id="4412443">.</span><span class="ident" id="4412444">expect</span><span class="op" id="4412450">(</span><span class="ident" id="4412451">token</span><span class="op" id="4412456">.</span><span class="ident" id="4412457">RPAREN</span><span class="op" id="4412463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4412467">p</span><span class="op" id="4412468">.</span><span class="ident" id="4412469">expectSemi</span><span class="op" id="4412479">(</span><span class="op" id="4412480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4412483">}</span>&nbsp;<span class="keyword" id="4412485">else</span>&nbsp;<span class="op" id="4412490">{</span><br>
<span class="lineno">2300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4412494">list</span>&nbsp;<span class="op" id="4412499">=</span>&nbsp;<span class="builtinfunc" id="4412501">append</span><span class="op" id="4412507">(</span><span class="ident" id="4412508">list</span><span class="op" id="4412512">,</span>&nbsp;<span class="ident" id="4412514">f</span><span class="op" id="4412515">(</span><span class="ident" id="4412516">nil</span><span class="op" id="4412519">,</span>&nbsp;<span class="ident" id="4412521">keyword</span><span class="op" id="4412528">,</span>&nbsp;<span class="num" id="4412530">0</span><span class="op" id="4412531">)</span><span class="op" id="4412532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4412535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4412539">return</span>&nbsp;<span class="op" id="4412546">&amp;</span><span class="ident" id="4412547">ast</span><span class="op" id="4412550">.</span><span class="ident" id="4412551">GenDecl</span><span class="op" id="4412558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4412562">Doc</span><span class="op" id="4412565">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4412570">doc</span><span class="op" id="4412573">,</span><br>
<span class="lineno">2305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4412577">TokPos</span><span class="op" id="4412583">:</span>&nbsp;<span class="ident" id="4412585">pos</span><span class="op" id="4412588">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4412592">Tok</span><span class="op" id="4412595">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4412600">keyword</span><span class="op" id="4412607">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4412611">Lparen</span><span class="op" id="4412617">:</span>&nbsp;<span class="ident" id="4412619">lparen</span><span class="op" id="4412625">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4412629">Specs</span><span class="op" id="4412634">:</span>&nbsp;&nbsp;<span class="ident" id="4412637">list</span><span class="op" id="4412641">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4412645">Rparen</span><span class="op" id="4412651">:</span>&nbsp;<span class="ident" id="4412653">rparen</span><span class="op" id="4412659">,</span><br>
<span class="lineno">2310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4412662">}</span><br>
<span class="lineno"></span><span class="op" id="4412664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4412667">func</span>&nbsp;<span class="op" id="4412672">(</span><span class="ident" id="4412673">p</span>&nbsp;<span class="op" id="4412675">*</span><span class="ident" id="4412676">parser</span><span class="op" id="4412682">)</span>&nbsp;<span class="ident" id="4412684">parseFuncDecl</span><span class="op" id="4412697">(</span><span class="op" id="4412698">)</span>&nbsp;<span class="op" id="4412700">*</span><span class="ident" id="4412701">ast</span><span class="op" id="4412704">.</span><span class="ident" id="4412705">FuncDecl</span>&nbsp;<span class="op" id="4412714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4412717">if</span>&nbsp;<span class="ident" id="4412720">p</span><span class="op" id="4412721">.</span><span class="ident" id="4412722">trace</span>&nbsp;<span class="op" id="4412728">{</span><br>
<span class="lineno">2315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4412732">defer</span>&nbsp;<span class="ident" id="4412738">un</span><span class="op" id="4412740">(</span><span class="ident" id="4412741">trace</span><span class="op" id="4412746">(</span><span class="ident" id="4412747">p</span><span class="op" id="4412748">,</span>&nbsp;<span class="string" id="4412750">&#34;FunctionDecl&#34;</span><span class="op" id="4412764">)</span><span class="op" id="4412765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4412768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4412772">doc</span>&nbsp;<span class="op" id="4412776">:=</span>&nbsp;<span class="ident" id="4412779">p</span><span class="op" id="4412780">.</span><span class="ident" id="4412781">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4412794">pos</span>&nbsp;<span class="op" id="4412798">:=</span>&nbsp;<span class="ident" id="4412801">p</span><span class="op" id="4412802">.</span><span class="ident" id="4412803">expect</span><span class="op" id="4412809">(</span><span class="ident" id="4412810">token</span><span class="op" id="4412815">.</span><span class="ident" id="4412816">FUNC</span><span class="op" id="4412820">)</span><br>
<span class="lineno">2320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4412823">scope</span>&nbsp;<span class="op" id="4412829">:=</span>&nbsp;<span class="ident" id="4412832">ast</span><span class="op" id="4412835">.</span><span class="ident" id="4412836">NewScope</span><span class="op" id="4412844">(</span><span class="ident" id="4412845">p</span><span class="op" id="4412846">.</span><span class="ident" id="4412847">topScope</span><span class="op" id="4412855">)</span>&nbsp;<span class="comment" id="4412857">//&nbsp;function&nbsp;scope</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4412877">var</span>&nbsp;<span class="ident" id="4412881">recv</span>&nbsp;<span class="op" id="4412886">*</span><span class="ident" id="4412887">ast</span><span class="op" id="4412890">.</span><span class="ident" id="4412891">FieldList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4412902">if</span>&nbsp;<span class="ident" id="4412905">p</span><span class="op" id="4412906">.</span><span class="ident" id="4412907">tok</span>&nbsp;<span class="op" id="4412911">==</span>&nbsp;<span class="ident" id="4412914">token</span><span class="op" id="4412919">.</span><span class="ident" id="4412920">LPAREN</span>&nbsp;<span class="op" id="4412927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4412931">recv</span>&nbsp;<span class="op" id="4412936">=</span>&nbsp;<span class="ident" id="4412938">p</span><span class="op" id="4412939">.</span><span class="ident" id="4412940">parseParameters</span><span class="op" id="4412955">(</span><span class="ident" id="4412956">scope</span><span class="op" id="4412961">,</span>&nbsp;<span class="builtintype" id="4412963">false</span><span class="op" id="4412968">)</span><br>
<span class="lineno">2325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4412971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4412975">ident</span>&nbsp;<span class="op" id="4412981">:=</span>&nbsp;<span class="ident" id="4412984">p</span><span class="op" id="4412985">.</span><span class="ident" id="4412986">parseIdent</span><span class="op" id="4412996">(</span><span class="op" id="4412997">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4413001">params</span><span class="op" id="4413007">,</span>&nbsp;<span class="ident" id="4413009">results</span>&nbsp;<span class="op" id="4413017">:=</span>&nbsp;<span class="ident" id="4413020">p</span><span class="op" id="4413021">.</span><span class="ident" id="4413022">parseSignature</span><span class="op" id="4413036">(</span><span class="ident" id="4413037">scope</span><span class="op" id="4413042">)</span><br>
<span class="lineno">2330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4413046">var</span>&nbsp;<span class="ident" id="4413050">body</span>&nbsp;<span class="op" id="4413055">*</span><span class="ident" id="4413056">ast</span><span class="op" id="4413059">.</span><span class="ident" id="4413060">BlockStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4413071">if</span>&nbsp;<span class="ident" id="4413074">p</span><span class="op" id="4413075">.</span><span class="ident" id="4413076">tok</span>&nbsp;<span class="op" id="4413080">==</span>&nbsp;<span class="ident" id="4413083">token</span><span class="op" id="4413088">.</span><span class="ident" id="4413089">LBRACE</span>&nbsp;<span class="op" id="4413096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4413100">body</span>&nbsp;<span class="op" id="4413105">=</span>&nbsp;<span class="ident" id="4413107">p</span><span class="op" id="4413108">.</span><span class="ident" id="4413109">parseBody</span><span class="op" id="4413118">(</span><span class="ident" id="4413119">scope</span><span class="op" id="4413124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4413127">}</span><br>
<span class="lineno">2335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4413130">p</span><span class="op" id="4413131">.</span><span class="ident" id="4413132">expectSemi</span><span class="op" id="4413142">(</span><span class="op" id="4413143">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4413147">decl</span>&nbsp;<span class="op" id="4413152">:=</span>&nbsp;<span class="op" id="4413155">&amp;</span><span class="ident" id="4413156">ast</span><span class="op" id="4413159">.</span><span class="ident" id="4413160">FuncDecl</span><span class="op" id="4413168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4413172">Doc</span><span class="op" id="4413175">:</span>&nbsp;&nbsp;<span class="ident" id="4413178">doc</span><span class="op" id="4413181">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4413185">Recv</span><span class="op" id="4413189">:</span>&nbsp;<span class="ident" id="4413191">recv</span><span class="op" id="4413195">,</span><br>
<span class="lineno">2340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4413199">Name</span><span class="op" id="4413203">:</span>&nbsp;<span class="ident" id="4413205">ident</span><span class="op" id="4413210">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4413214">Type</span><span class="op" id="4413218">:</span>&nbsp;<span class="op" id="4413220">&amp;</span><span class="ident" id="4413221">ast</span><span class="op" id="4413224">.</span><span class="ident" id="4413225">FuncType</span><span class="op" id="4413233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4413238">Func</span><span class="op" id="4413242">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4413247">pos</span><span class="op" id="4413250">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4413255">Params</span><span class="op" id="4413261">:</span>&nbsp;&nbsp;<span class="ident" id="4413264">params</span><span class="op" id="4413270">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4413275">Results</span><span class="op" id="4413282">:</span>&nbsp;<span class="ident" id="4413284">results</span><span class="op" id="4413291">,</span><br>
<span class="lineno">2345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4413295">}</span><span class="op" id="4413296">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4413300">Body</span><span class="op" id="4413304">:</span>&nbsp;<span class="ident" id="4413306">body</span><span class="op" id="4413310">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4413313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4413316">if</span>&nbsp;<span class="ident" id="4413319">recv</span>&nbsp;<span class="op" id="4413324">==</span>&nbsp;<span class="ident" id="4413327">nil</span>&nbsp;<span class="op" id="4413331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4413335">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;constant,&nbsp;type,</span><br>
<span class="lineno">2350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4413403">//&nbsp;variable,&nbsp;or&nbsp;function&nbsp;(but&nbsp;not&nbsp;method)&nbsp;declared&nbsp;at&nbsp;top&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4413469">//&nbsp;(outside&nbsp;any&nbsp;function)&nbsp;is&nbsp;the&nbsp;package&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4413519">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4413524">//&nbsp;init()&nbsp;functions&nbsp;cannot&nbsp;be&nbsp;referred&nbsp;to&nbsp;and&nbsp;there&nbsp;may</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4413582">//&nbsp;be&nbsp;more&nbsp;than&nbsp;one&nbsp;-&nbsp;don&#39;t&nbsp;put&nbsp;them&nbsp;in&nbsp;the&nbsp;pkgScope</span><br>
<span class="lineno">2355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4413637">if</span>&nbsp;<span class="ident" id="4413640">ident</span><span class="op" id="4413645">.</span><span class="ident" id="4413646">Name</span>&nbsp;<span class="op" id="4413651">!=</span>&nbsp;<span class="string" id="4413654">&#34;init&#34;</span>&nbsp;<span class="op" id="4413661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4413666">p</span><span class="op" id="4413667">.</span><span class="ident" id="4413668">declare</span><span class="op" id="4413675">(</span><span class="ident" id="4413676">decl</span><span class="op" id="4413680">,</span>&nbsp;<span class="ident" id="4413682">nil</span><span class="op" id="4413685">,</span>&nbsp;<span class="ident" id="4413687">p</span><span class="op" id="4413688">.</span><span class="ident" id="4413689">pkgScope</span><span class="op" id="4413697">,</span>&nbsp;<span class="ident" id="4413699">ast</span><span class="op" id="4413702">.</span><span class="ident" id="4413703">Fun</span><span class="op" id="4413706">,</span>&nbsp;<span class="ident" id="4413708">ident</span><span class="op" id="4413713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4413717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4413720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4413724">return</span>&nbsp;<span class="ident" id="4413731">decl</span><br>
<span class="lineno"></span><span class="op" id="4413736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4413739">func</span>&nbsp;<span class="op" id="4413744">(</span><span class="ident" id="4413745">p</span>&nbsp;<span class="op" id="4413747">*</span><span class="ident" id="4413748">parser</span><span class="op" id="4413754">)</span>&nbsp;<span class="ident" id="4413756">parseDecl</span><span class="op" id="4413765">(</span><span class="ident" id="4413766">sync</span>&nbsp;<span class="keyword" id="4413771">func</span><span class="op" id="4413775">(</span><span class="op" id="4413776">*</span><span class="ident" id="4413777">parser</span><span class="op" id="4413783">)</span><span class="op" id="4413784">)</span>&nbsp;<span class="ident" id="4413786">ast</span><span class="op" id="4413789">.</span><span class="ident" id="4413790">Decl</span>&nbsp;<span class="op" id="4413795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4413798">if</span>&nbsp;<span class="ident" id="4413801">p</span><span class="op" id="4413802">.</span><span class="ident" id="4413803">trace</span>&nbsp;<span class="op" id="4413809">{</span><br>
<span class="lineno">2365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4413813">defer</span>&nbsp;<span class="ident" id="4413819">un</span><span class="op" id="4413821">(</span><span class="ident" id="4413822">trace</span><span class="op" id="4413827">(</span><span class="ident" id="4413828">p</span><span class="op" id="4413829">,</span>&nbsp;<span class="string" id="4413831">&#34;Declaration&#34;</span><span class="op" id="4413844">)</span><span class="op" id="4413845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4413848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4413852">var</span>&nbsp;<span class="ident" id="4413856">f</span>&nbsp;<span class="ident" id="4413858">parseSpecFunction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4413877">switch</span>&nbsp;<span class="ident" id="4413884">p</span><span class="op" id="4413885">.</span><span class="ident" id="4413886">tok</span>&nbsp;<span class="op" id="4413890">{</span><br>
<span class="lineno">2370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4413893">case</span>&nbsp;<span class="ident" id="4413898">token</span><span class="op" id="4413903">.</span><span class="ident" id="4413904">CONST</span><span class="op" id="4413909">,</span>&nbsp;<span class="ident" id="4413911">token</span><span class="op" id="4413916">.</span><span class="ident" id="4413917">VAR</span><span class="op" id="4413920">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4413924">f</span>&nbsp;<span class="op" id="4413926">=</span>&nbsp;<span class="ident" id="4413928">p</span><span class="op" id="4413929">.</span><span class="ident" id="4413930">parseValueSpec</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4413947">case</span>&nbsp;<span class="ident" id="4413952">token</span><span class="op" id="4413957">.</span><span class="ident" id="4413958">TYPE</span><span class="op" id="4413962">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4413966">f</span>&nbsp;<span class="op" id="4413968">=</span>&nbsp;<span class="ident" id="4413970">p</span><span class="op" id="4413971">.</span><span class="ident" id="4413972">parseTypeSpec</span><br>
<span class="lineno">2375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4413988">case</span>&nbsp;<span class="ident" id="4413993">token</span><span class="op" id="4413998">.</span><span class="ident" id="4413999">FUNC</span><span class="op" id="4414003">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4414007">return</span>&nbsp;<span class="ident" id="4414014">p</span><span class="op" id="4414015">.</span><span class="ident" id="4414016">parseFuncDecl</span><span class="op" id="4414029">(</span><span class="op" id="4414030">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4414034">default</span><span class="op" id="4414041">:</span><br>
<span class="lineno">2380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4414045">pos</span>&nbsp;<span class="op" id="4414049">:=</span>&nbsp;<span class="ident" id="4414052">p</span><span class="op" id="4414053">.</span><span class="ident" id="4414054">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4414060">p</span><span class="op" id="4414061">.</span><span class="ident" id="4414062">errorExpected</span><span class="op" id="4414075">(</span><span class="ident" id="4414076">pos</span><span class="op" id="4414079">,</span>&nbsp;<span class="string" id="4414081">&#34;declaration&#34;</span><span class="op" id="4414094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4414098">sync</span><span class="op" id="4414102">(</span><span class="ident" id="4414103">p</span><span class="op" id="4414104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4414108">return</span>&nbsp;<span class="op" id="4414115">&amp;</span><span class="ident" id="4414116">ast</span><span class="op" id="4414119">.</span><span class="ident" id="4414120">BadDecl</span><span class="op" id="4414127">{</span><span class="ident" id="4414128">From</span><span class="op" id="4414132">:</span>&nbsp;<span class="ident" id="4414134">pos</span><span class="op" id="4414137">,</span>&nbsp;<span class="ident" id="4414139">To</span><span class="op" id="4414141">:</span>&nbsp;<span class="ident" id="4414143">p</span><span class="op" id="4414144">.</span><span class="ident" id="4414145">pos</span><span class="op" id="4414148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4414151">}</span><br>
<span class="lineno">2385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4414155">return</span>&nbsp;<span class="ident" id="4414162">p</span><span class="op" id="4414163">.</span><span class="ident" id="4414164">parseGenDecl</span><span class="op" id="4414176">(</span><span class="ident" id="4414177">p</span><span class="op" id="4414178">.</span><span class="ident" id="4414179">tok</span><span class="op" id="4414182">,</span>&nbsp;<span class="ident" id="4414184">f</span><span class="op" id="4414185">)</span><br>
<span class="lineno"></span><span class="op" id="4414187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4414190">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">2390</span><span class="comment" id="4414270">//&nbsp;Source&nbsp;files</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4414287">func</span>&nbsp;<span class="op" id="4414292">(</span><span class="ident" id="4414293">p</span>&nbsp;<span class="op" id="4414295">*</span><span class="ident" id="4414296">parser</span><span class="op" id="4414302">)</span>&nbsp;<span class="ident" id="4414304">parseFile</span><span class="op" id="4414313">(</span><span class="op" id="4414314">)</span>&nbsp;<span class="op" id="4414316">*</span><span class="ident" id="4414317">ast</span><span class="op" id="4414320">.</span><span class="ident" id="4414321">File</span>&nbsp;<span class="op" id="4414326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4414329">if</span>&nbsp;<span class="ident" id="4414332">p</span><span class="op" id="4414333">.</span><span class="ident" id="4414334">trace</span>&nbsp;<span class="op" id="4414340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4414344">defer</span>&nbsp;<span class="ident" id="4414350">un</span><span class="op" id="4414352">(</span><span class="ident" id="4414353">trace</span><span class="op" id="4414358">(</span><span class="ident" id="4414359">p</span><span class="op" id="4414360">,</span>&nbsp;<span class="string" id="4414362">&#34;File&#34;</span><span class="op" id="4414368">)</span><span class="op" id="4414369">)</span><br>
<span class="lineno">2395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4414372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4414376">//&nbsp;Don&#39;t&nbsp;bother&nbsp;parsing&nbsp;the&nbsp;rest&nbsp;if&nbsp;we&nbsp;had&nbsp;errors&nbsp;scanning&nbsp;the&nbsp;first&nbsp;token.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4414453">//&nbsp;Likely&nbsp;not&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4414493">if</span>&nbsp;<span class="ident" id="4414496">p</span><span class="op" id="4414497">.</span><span class="ident" id="4414498">errors</span><span class="op" id="4414504">.</span><span class="ident" id="4414505">Len</span><span class="op" id="4414508">(</span><span class="op" id="4414509">)</span>&nbsp;<span class="op" id="4414511">!=</span>&nbsp;<span class="num" id="4414514">0</span>&nbsp;<span class="op" id="4414516">{</span><br>
<span class="lineno">2400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4414520">return</span>&nbsp;<span class="ident" id="4414527">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4414532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4414536">//&nbsp;package&nbsp;clause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4414555">doc</span>&nbsp;<span class="op" id="4414559">:=</span>&nbsp;<span class="ident" id="4414562">p</span><span class="op" id="4414563">.</span><span class="ident" id="4414564">leadComment</span><br>
<span class="lineno">2405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4414577">pos</span>&nbsp;<span class="op" id="4414581">:=</span>&nbsp;<span class="ident" id="4414584">p</span><span class="op" id="4414585">.</span><span class="ident" id="4414586">expect</span><span class="op" id="4414592">(</span><span class="ident" id="4414593">token</span><span class="op" id="4414598">.</span><span class="ident" id="4414599">PACKAGE</span><span class="op" id="4414606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4414609">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;package&nbsp;clause&nbsp;is&nbsp;not&nbsp;a&nbsp;declaration;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4414663">//&nbsp;the&nbsp;package&nbsp;name&nbsp;does&nbsp;not&nbsp;appear&nbsp;in&nbsp;any&nbsp;scope.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4414714">ident</span>&nbsp;<span class="op" id="4414720">:=</span>&nbsp;<span class="ident" id="4414723">p</span><span class="op" id="4414724">.</span><span class="ident" id="4414725">parseIdent</span><span class="op" id="4414735">(</span><span class="op" id="4414736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4414739">if</span>&nbsp;<span class="ident" id="4414742">ident</span><span class="op" id="4414747">.</span><span class="ident" id="4414748">Name</span>&nbsp;<span class="op" id="4414753">==</span>&nbsp;<span class="string" id="4414756">&#34;_&#34;</span>&nbsp;<span class="op" id="4414760">&amp;&amp;</span>&nbsp;<span class="ident" id="4414763">p</span><span class="op" id="4414764">.</span><span class="ident" id="4414765">mode</span><span class="op" id="4414769">&amp;</span><span class="ident" id="4414770">DeclarationErrors</span>&nbsp;<span class="op" id="4414788">!=</span>&nbsp;<span class="num" id="4414791">0</span>&nbsp;<span class="op" id="4414793">{</span><br>
<span class="lineno">2410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4414797">p</span><span class="op" id="4414798">.</span><span class="builtintype" id="4414799">error</span><span class="op" id="4414804">(</span><span class="ident" id="4414805">p</span><span class="op" id="4414806">.</span><span class="ident" id="4414807">pos</span><span class="op" id="4414810">,</span>&nbsp;<span class="string" id="4414812">&#34;invalid&nbsp;package&nbsp;name&nbsp;_&#34;</span><span class="op" id="4414836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4414839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4414842">p</span><span class="op" id="4414843">.</span><span class="ident" id="4414844">expectSemi</span><span class="op" id="4414854">(</span><span class="op" id="4414855">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4414859">//&nbsp;Don&#39;t&nbsp;bother&nbsp;parsing&nbsp;the&nbsp;rest&nbsp;if&nbsp;we&nbsp;had&nbsp;errors&nbsp;parsing&nbsp;the&nbsp;package&nbsp;clause.</span><br>
<span class="lineno">2415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4414938">//&nbsp;Likely&nbsp;not&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4414978">if</span>&nbsp;<span class="ident" id="4414981">p</span><span class="op" id="4414982">.</span><span class="ident" id="4414983">errors</span><span class="op" id="4414989">.</span><span class="ident" id="4414990">Len</span><span class="op" id="4414993">(</span><span class="op" id="4414994">)</span>&nbsp;<span class="op" id="4414996">!=</span>&nbsp;<span class="num" id="4414999">0</span>&nbsp;<span class="op" id="4415001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4415005">return</span>&nbsp;<span class="ident" id="4415012">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4415017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415021">p</span><span class="op" id="4415022">.</span><span class="ident" id="4415023">openScope</span><span class="op" id="4415032">(</span><span class="op" id="4415033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415036">p</span><span class="op" id="4415037">.</span><span class="ident" id="4415038">pkgScope</span>&nbsp;<span class="op" id="4415047">=</span>&nbsp;<span class="ident" id="4415049">p</span><span class="op" id="4415050">.</span><span class="ident" id="4415051">topScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4415061">var</span>&nbsp;<span class="ident" id="4415065">decls</span>&nbsp;<span class="op" id="4415071">[</span><span class="op" id="4415072">]</span><span class="ident" id="4415073">ast</span><span class="op" id="4415076">.</span><span class="ident" id="4415077">Decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4415083">if</span>&nbsp;<span class="ident" id="4415086">p</span><span class="op" id="4415087">.</span><span class="ident" id="4415088">mode</span><span class="op" id="4415092">&amp;</span><span class="ident" id="4415093">PackageClauseOnly</span>&nbsp;<span class="op" id="4415111">==</span>&nbsp;<span class="num" id="4415114">0</span>&nbsp;<span class="op" id="4415116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4415120">//&nbsp;import&nbsp;decls</span><br>
<span class="lineno">2425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4415138">for</span>&nbsp;<span class="ident" id="4415142">p</span><span class="op" id="4415143">.</span><span class="ident" id="4415144">tok</span>&nbsp;<span class="op" id="4415148">==</span>&nbsp;<span class="ident" id="4415151">token</span><span class="op" id="4415156">.</span><span class="ident" id="4415157">IMPORT</span>&nbsp;<span class="op" id="4415164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415169">decls</span>&nbsp;<span class="op" id="4415175">=</span>&nbsp;<span class="builtinfunc" id="4415177">append</span><span class="op" id="4415183">(</span><span class="ident" id="4415184">decls</span><span class="op" id="4415189">,</span>&nbsp;<span class="ident" id="4415191">p</span><span class="op" id="4415192">.</span><span class="ident" id="4415193">parseGenDecl</span><span class="op" id="4415205">(</span><span class="ident" id="4415206">token</span><span class="op" id="4415211">.</span><span class="ident" id="4415212">IMPORT</span><span class="op" id="4415218">,</span>&nbsp;<span class="ident" id="4415220">p</span><span class="op" id="4415221">.</span><span class="ident" id="4415222">parseImportSpec</span><span class="op" id="4415237">)</span><span class="op" id="4415238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4415242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4415247">if</span>&nbsp;<span class="ident" id="4415250">p</span><span class="op" id="4415251">.</span><span class="ident" id="4415252">mode</span><span class="op" id="4415256">&amp;</span><span class="ident" id="4415257">ImportsOnly</span>&nbsp;<span class="op" id="4415269">==</span>&nbsp;<span class="num" id="4415272">0</span>&nbsp;<span class="op" id="4415274">{</span><br>
<span class="lineno">2430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4415279">//&nbsp;rest&nbsp;of&nbsp;package&nbsp;body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4415306">for</span>&nbsp;<span class="ident" id="4415310">p</span><span class="op" id="4415311">.</span><span class="ident" id="4415312">tok</span>&nbsp;<span class="op" id="4415316">!=</span>&nbsp;<span class="ident" id="4415319">token</span><span class="op" id="4415324">.</span><span class="ident" id="4415325">EOF</span>&nbsp;<span class="op" id="4415329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415335">decls</span>&nbsp;<span class="op" id="4415341">=</span>&nbsp;<span class="builtinfunc" id="4415343">append</span><span class="op" id="4415349">(</span><span class="ident" id="4415350">decls</span><span class="op" id="4415355">,</span>&nbsp;<span class="ident" id="4415357">p</span><span class="op" id="4415358">.</span><span class="ident" id="4415359">parseDecl</span><span class="op" id="4415368">(</span><span class="ident" id="4415369">syncDecl</span><span class="op" id="4415377">)</span><span class="op" id="4415378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4415383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4415387">}</span><br>
<span class="lineno">2435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4415390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415393">p</span><span class="op" id="4415394">.</span><span class="ident" id="4415395">closeScope</span><span class="op" id="4415405">(</span><span class="op" id="4415406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415409">assert</span><span class="op" id="4415415">(</span><span class="ident" id="4415416">p</span><span class="op" id="4415417">.</span><span class="ident" id="4415418">topScope</span>&nbsp;<span class="op" id="4415427">==</span>&nbsp;<span class="ident" id="4415430">nil</span><span class="op" id="4415433">,</span>&nbsp;<span class="string" id="4415435">&#34;unbalanced&nbsp;scopes&#34;</span><span class="op" id="4415454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415457">assert</span><span class="op" id="4415463">(</span><span class="ident" id="4415464">p</span><span class="op" id="4415465">.</span><span class="ident" id="4415466">labelScope</span>&nbsp;<span class="op" id="4415477">==</span>&nbsp;<span class="ident" id="4415480">nil</span><span class="op" id="4415483">,</span>&nbsp;<span class="string" id="4415485">&#34;unbalanced&nbsp;label&nbsp;scopes&#34;</span><span class="op" id="4415510">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">2440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4415514">//&nbsp;resolve&nbsp;global&nbsp;identifiers&nbsp;within&nbsp;the&nbsp;same&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415566">i</span>&nbsp;<span class="op" id="4415568">:=</span>&nbsp;<span class="num" id="4415571">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4415574">for</span>&nbsp;<span class="ident" id="4415578">_</span><span class="op" id="4415579">,</span>&nbsp;<span class="ident" id="4415581">ident</span>&nbsp;<span class="op" id="4415587">:=</span>&nbsp;<span class="keyword" id="4415590">range</span>&nbsp;<span class="ident" id="4415596">p</span><span class="op" id="4415597">.</span><span class="ident" id="4415598">unresolved</span>&nbsp;<span class="op" id="4415609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4415613">//&nbsp;i&nbsp;&lt;=&nbsp;index&nbsp;for&nbsp;current&nbsp;ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415647">assert</span><span class="op" id="4415653">(</span><span class="ident" id="4415654">ident</span><span class="op" id="4415659">.</span><span class="ident" id="4415660">Obj</span>&nbsp;<span class="op" id="4415664">==</span>&nbsp;<span class="ident" id="4415667">unresolved</span><span class="op" id="4415677">,</span>&nbsp;<span class="string" id="4415679">&#34;object&nbsp;already&nbsp;resolved&#34;</span><span class="op" id="4415704">)</span><br>
<span class="lineno">2445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415708">ident</span><span class="op" id="4415713">.</span><span class="ident" id="4415714">Obj</span>&nbsp;<span class="op" id="4415718">=</span>&nbsp;<span class="ident" id="4415720">p</span><span class="op" id="4415721">.</span><span class="ident" id="4415722">pkgScope</span><span class="op" id="4415730">.</span><span class="ident" id="4415731">Lookup</span><span class="op" id="4415737">(</span><span class="ident" id="4415738">ident</span><span class="op" id="4415743">.</span><span class="ident" id="4415744">Name</span><span class="op" id="4415748">)</span>&nbsp;<span class="comment" id="4415750">//&nbsp;also&nbsp;removes&nbsp;unresolved&nbsp;sentinel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4415788">if</span>&nbsp;<span class="ident" id="4415791">ident</span><span class="op" id="4415796">.</span><span class="ident" id="4415797">Obj</span>&nbsp;<span class="op" id="4415801">==</span>&nbsp;<span class="ident" id="4415804">nil</span>&nbsp;<span class="op" id="4415808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415813">p</span><span class="op" id="4415814">.</span><span class="ident" id="4415815">unresolved</span><span class="op" id="4415825">[</span><span class="ident" id="4415826">i</span><span class="op" id="4415827">]</span>&nbsp;<span class="op" id="4415829">=</span>&nbsp;<span class="ident" id="4415831">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415840">i</span><span class="op" id="4415841">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4415846">}</span><br>
<span class="lineno">2450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4415849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4415853">return</span>&nbsp;<span class="op" id="4415860">&amp;</span><span class="ident" id="4415861">ast</span><span class="op" id="4415864">.</span><span class="ident" id="4415865">File</span><span class="op" id="4415869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415873">Doc</span><span class="op" id="4415876">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4415885">doc</span><span class="op" id="4415888">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415892">Package</span><span class="op" id="4415899">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4415904">pos</span><span class="op" id="4415907">,</span><br>
<span class="lineno">2455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415911">Name</span><span class="op" id="4415915">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4415923">ident</span><span class="op" id="4415928">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415932">Decls</span><span class="op" id="4415937">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4415944">decls</span><span class="op" id="4415949">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415953">Scope</span><span class="op" id="4415958">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4415965">p</span><span class="op" id="4415966">.</span><span class="ident" id="4415967">pkgScope</span><span class="op" id="4415975">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415979">Imports</span><span class="op" id="4415986">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4415991">p</span><span class="op" id="4415992">.</span><span class="ident" id="4415993">imports</span><span class="op" id="4416000">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416004">Unresolved</span><span class="op" id="4416014">:</span>&nbsp;<span class="ident" id="4416016">p</span><span class="op" id="4416017">.</span><span class="ident" id="4416018">unresolved</span><span class="op" id="4416028">[</span><span class="num" id="4416029">0</span><span class="op" id="4416030">:</span><span class="ident" id="4416031">i</span><span class="op" id="4416032">]</span><span class="op" id="4416033">,</span><br>
<span class="lineno">2460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416037">Comments</span><span class="op" id="4416045">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4416049">p</span><span class="op" id="4416050">.</span><span class="ident" id="4416051">comments</span><span class="op" id="4416059">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4416062">}</span><br>
<span class="lineno"></span><span class="op" id="4416064">}</span>
</div>
</body>
</html>
