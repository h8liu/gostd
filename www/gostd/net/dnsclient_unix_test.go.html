<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7844468">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7844523">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7844577">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7844628">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7844693">package</span>&nbsp;<span class="ident" id="7844701">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7844706">import</span>&nbsp;<span class="op" id="7844713">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7844716">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7844722">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7844735">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7844741">&#34;path&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7844749">&#34;reflect&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7844760">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7844771">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7844778">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7844781">var</span>&nbsp;<span class="ident" id="7844785">dnsTransportFallbackTests</span>&nbsp;<span class="op" id="7844811">=</span>&nbsp;<span class="op" id="7844813">[</span><span class="op" id="7844814">]</span><span class="keyword" id="7844815">struct</span>&nbsp;<span class="op" id="7844822">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7844825">server</span>&nbsp;&nbsp;<span class="builtintype" id="7844833">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7844841">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7844849">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7844857">qtype</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7844865">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7844873">timeout</span>&nbsp;<span class="builtintype" id="7844881">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7844886">rcode</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7844894">int</span><br>
<span class="lineno">25</span><span class="op" id="7844898">}</span><span class="op" id="7844899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7844902">//&nbsp;Querying&nbsp;&#34;com.&#34;&nbsp;with&nbsp;qtype=255&nbsp;usually&nbsp;makes&nbsp;an&nbsp;answer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7844961">//&nbsp;which&nbsp;requires&nbsp;more&nbsp;than&nbsp;512&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7845001">{</span><span class="string" id="7845002">&#34;8.8.8.8:53&#34;</span><span class="op" id="7845014">,</span>&nbsp;<span class="string" id="7845016">&#34;com.&#34;</span><span class="op" id="7845022">,</span>&nbsp;<span class="ident" id="7845024">dnsTypeALL</span><span class="op" id="7845034">,</span>&nbsp;<span class="num" id="7845036">2</span><span class="op" id="7845037">,</span>&nbsp;<span class="ident" id="7845039">dnsRcodeSuccess</span><span class="op" id="7845054">}</span><span class="op" id="7845055">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7845058">{</span><span class="string" id="7845059">&#34;8.8.4.4:53&#34;</span><span class="op" id="7845071">,</span>&nbsp;<span class="string" id="7845073">&#34;com.&#34;</span><span class="op" id="7845079">,</span>&nbsp;<span class="ident" id="7845081">dnsTypeALL</span><span class="op" id="7845091">,</span>&nbsp;<span class="num" id="7845093">4</span><span class="op" id="7845094">,</span>&nbsp;<span class="ident" id="7845096">dnsRcodeSuccess</span><span class="op" id="7845111">}</span><span class="op" id="7845112">,</span><br>
<span class="lineno">30</span><span class="op" id="7845114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7845117">func</span>&nbsp;<span class="ident" id="7845122">TestDNSTransportFallback</span><span class="op" id="7845146">(</span><span class="ident" id="7845147">t</span>&nbsp;<span class="op" id="7845149">*</span><span class="ident" id="7845150">testing</span><span class="op" id="7845157">.</span><span class="ident" id="7845158">T</span><span class="op" id="7845159">)</span>&nbsp;<span class="op" id="7845161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7845164">if</span>&nbsp;<span class="ident" id="7845167">testing</span><span class="op" id="7845174">.</span><span class="ident" id="7845175">Short</span><span class="op" id="7845180">(</span><span class="op" id="7845181">)</span>&nbsp;<span class="op" id="7845183">||</span>&nbsp;<span class="op" id="7845186">!</span><span class="op" id="7845187">*</span><span class="ident" id="7845188">testExternal</span>&nbsp;<span class="op" id="7845201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7845205">t</span><span class="op" id="7845206">.</span><span class="ident" id="7845207">Skip</span><span class="op" id="7845211">(</span><span class="string" id="7845212">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7845253">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7845256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7845260">for</span>&nbsp;<span class="ident" id="7845264">_</span><span class="op" id="7845265">,</span>&nbsp;<span class="ident" id="7845267">tt</span>&nbsp;<span class="op" id="7845270">:=</span>&nbsp;<span class="keyword" id="7845273">range</span>&nbsp;<span class="ident" id="7845279">dnsTransportFallbackTests</span>&nbsp;<span class="op" id="7845305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7845309">timeout</span>&nbsp;<span class="op" id="7845317">:=</span>&nbsp;<span class="ident" id="7845320">time</span><span class="op" id="7845324">.</span><span class="ident" id="7845325">Duration</span><span class="op" id="7845333">(</span><span class="ident" id="7845334">tt</span><span class="op" id="7845336">.</span><span class="ident" id="7845337">timeout</span><span class="op" id="7845344">)</span>&nbsp;<span class="op" id="7845346">*</span>&nbsp;<span class="ident" id="7845348">time</span><span class="op" id="7845352">.</span><span class="ident" id="7845353">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7845362">msg</span><span class="op" id="7845365">,</span>&nbsp;<span class="ident" id="7845367">err</span>&nbsp;<span class="op" id="7845371">:=</span>&nbsp;<span class="ident" id="7845374">exchange</span><span class="op" id="7845382">(</span><span class="ident" id="7845383">tt</span><span class="op" id="7845385">.</span><span class="ident" id="7845386">server</span><span class="op" id="7845392">,</span>&nbsp;<span class="ident" id="7845394">tt</span><span class="op" id="7845396">.</span><span class="ident" id="7845397">name</span><span class="op" id="7845401">,</span>&nbsp;<span class="ident" id="7845403">tt</span><span class="op" id="7845405">.</span><span class="ident" id="7845406">qtype</span><span class="op" id="7845411">,</span>&nbsp;<span class="ident" id="7845413">timeout</span><span class="op" id="7845420">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7845424">if</span>&nbsp;<span class="ident" id="7845427">err</span>&nbsp;<span class="op" id="7845431">!=</span>&nbsp;<span class="ident" id="7845434">nil</span>&nbsp;<span class="op" id="7845438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7845443">t</span><span class="op" id="7845444">.</span><span class="ident" id="7845445">Error</span><span class="op" id="7845450">(</span><span class="ident" id="7845451">err</span><span class="op" id="7845454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7845459">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7845470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7845474">switch</span>&nbsp;<span class="ident" id="7845481">msg</span><span class="op" id="7845484">.</span><span class="ident" id="7845485">rcode</span>&nbsp;<span class="op" id="7845491">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7845495">case</span>&nbsp;<span class="ident" id="7845500">tt</span><span class="op" id="7845502">.</span><span class="ident" id="7845503">rcode</span><span class="op" id="7845508">,</span>&nbsp;<span class="ident" id="7845510">dnsRcodeServerFailure</span><span class="op" id="7845531">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7845535">default</span><span class="op" id="7845542">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7845547">t</span><span class="op" id="7845548">.</span><span class="ident" id="7845549">Errorf</span><span class="op" id="7845555">(</span><span class="string" id="7845556">&#34;got&nbsp;%v&nbsp;from&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7845581">,</span>&nbsp;<span class="ident" id="7845583">msg</span><span class="op" id="7845586">.</span><span class="ident" id="7845587">rcode</span><span class="op" id="7845592">,</span>&nbsp;<span class="ident" id="7845594">tt</span><span class="op" id="7845596">.</span><span class="ident" id="7845597">server</span><span class="op" id="7845603">,</span>&nbsp;<span class="ident" id="7845605">tt</span><span class="op" id="7845607">.</span><span class="ident" id="7845608">rcode</span><span class="op" id="7845613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7845618">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7845629">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7845632">}</span><br>
<span class="lineno"></span><span class="op" id="7845634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7845637">//&nbsp;See&nbsp;RFC&nbsp;6761&nbsp;for&nbsp;further&nbsp;information&nbsp;about&nbsp;the&nbsp;reserved,&nbsp;pseudo</span><br>
<span class="lineno"></span><span class="comment" id="7845704">//&nbsp;domain&nbsp;names.</span><br>
<span class="lineno">55</span><span class="keyword" id="7845721">var</span>&nbsp;<span class="ident" id="7845725">specialDomainNameTests</span>&nbsp;<span class="op" id="7845748">=</span>&nbsp;<span class="op" id="7845750">[</span><span class="op" id="7845751">]</span><span class="keyword" id="7845752">struct</span>&nbsp;<span class="op" id="7845759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7845762">name</span>&nbsp;&nbsp;<span class="builtintype" id="7845768">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7845776">qtype</span>&nbsp;<span class="builtintype" id="7845782">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7845790">rcode</span>&nbsp;<span class="builtintype" id="7845796">int</span><br>
<span class="lineno"></span><span class="op" id="7845800">}</span><span class="op" id="7845801">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7845804">//&nbsp;Name&nbsp;resoltion&nbsp;APIs&nbsp;and&nbsp;libraries&nbsp;should&nbsp;not&nbsp;recongnize&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7845868">//&nbsp;followings&nbsp;as&nbsp;special.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7845895">{</span><span class="string" id="7845896">&#34;1.0.168.192.in-addr.arpa.&#34;</span><span class="op" id="7845923">,</span>&nbsp;<span class="ident" id="7845925">dnsTypePTR</span><span class="op" id="7845935">,</span>&nbsp;<span class="ident" id="7845937">dnsRcodeNameError</span><span class="op" id="7845954">}</span><span class="op" id="7845955">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7845958">{</span><span class="string" id="7845959">&#34;test.&#34;</span><span class="op" id="7845966">,</span>&nbsp;<span class="ident" id="7845968">dnsTypeALL</span><span class="op" id="7845978">,</span>&nbsp;<span class="ident" id="7845980">dnsRcodeNameError</span><span class="op" id="7845997">}</span><span class="op" id="7845998">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7846001">{</span><span class="string" id="7846002">&#34;example.com.&#34;</span><span class="op" id="7846016">,</span>&nbsp;<span class="ident" id="7846018">dnsTypeALL</span><span class="op" id="7846028">,</span>&nbsp;<span class="ident" id="7846030">dnsRcodeSuccess</span><span class="op" id="7846045">}</span><span class="op" id="7846046">,</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7846050">//&nbsp;Name&nbsp;resoltion&nbsp;APIs&nbsp;and&nbsp;libraries&nbsp;should&nbsp;recongnize&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7846110">//&nbsp;followings&nbsp;as&nbsp;special&nbsp;and&nbsp;should&nbsp;not&nbsp;send&nbsp;any&nbsp;queries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7846169">//&nbsp;Though,&nbsp;we&nbsp;test&nbsp;those&nbsp;names&nbsp;here&nbsp;for&nbsp;verifying&nbsp;nagative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7846229">//&nbsp;answers&nbsp;at&nbsp;DNS&nbsp;query-response&nbsp;interaction&nbsp;level.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7846282">{</span><span class="string" id="7846283">&#34;localhost.&#34;</span><span class="op" id="7846295">,</span>&nbsp;<span class="ident" id="7846297">dnsTypeALL</span><span class="op" id="7846307">,</span>&nbsp;<span class="ident" id="7846309">dnsRcodeNameError</span><span class="op" id="7846326">}</span><span class="op" id="7846327">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7846330">{</span><span class="string" id="7846331">&#34;invalid.&#34;</span><span class="op" id="7846341">,</span>&nbsp;<span class="ident" id="7846343">dnsTypeALL</span><span class="op" id="7846353">,</span>&nbsp;<span class="ident" id="7846355">dnsRcodeNameError</span><span class="op" id="7846372">}</span><span class="op" id="7846373">,</span><br>
<span class="lineno"></span><span class="op" id="7846375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7846378">func</span>&nbsp;<span class="ident" id="7846383">TestSpecialDomainName</span><span class="op" id="7846404">(</span><span class="ident" id="7846405">t</span>&nbsp;<span class="op" id="7846407">*</span><span class="ident" id="7846408">testing</span><span class="op" id="7846415">.</span><span class="ident" id="7846416">T</span><span class="op" id="7846417">)</span>&nbsp;<span class="op" id="7846419">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7846422">if</span>&nbsp;<span class="ident" id="7846425">testing</span><span class="op" id="7846432">.</span><span class="ident" id="7846433">Short</span><span class="op" id="7846438">(</span><span class="op" id="7846439">)</span>&nbsp;<span class="op" id="7846441">||</span>&nbsp;<span class="op" id="7846444">!</span><span class="op" id="7846445">*</span><span class="ident" id="7846446">testExternal</span>&nbsp;<span class="op" id="7846459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7846463">t</span><span class="op" id="7846464">.</span><span class="ident" id="7846465">Skip</span><span class="op" id="7846469">(</span><span class="string" id="7846470">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7846511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7846514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7846518">server</span>&nbsp;<span class="op" id="7846525">:=</span>&nbsp;<span class="string" id="7846528">&#34;8.8.8.8:53&#34;</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7846542">for</span>&nbsp;<span class="ident" id="7846546">_</span><span class="op" id="7846547">,</span>&nbsp;<span class="ident" id="7846549">tt</span>&nbsp;<span class="op" id="7846552">:=</span>&nbsp;<span class="keyword" id="7846555">range</span>&nbsp;<span class="ident" id="7846561">specialDomainNameTests</span>&nbsp;<span class="op" id="7846584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7846588">msg</span><span class="op" id="7846591">,</span>&nbsp;<span class="ident" id="7846593">err</span>&nbsp;<span class="op" id="7846597">:=</span>&nbsp;<span class="ident" id="7846600">exchange</span><span class="op" id="7846608">(</span><span class="ident" id="7846609">server</span><span class="op" id="7846615">,</span>&nbsp;<span class="ident" id="7846617">tt</span><span class="op" id="7846619">.</span><span class="ident" id="7846620">name</span><span class="op" id="7846624">,</span>&nbsp;<span class="ident" id="7846626">tt</span><span class="op" id="7846628">.</span><span class="ident" id="7846629">qtype</span><span class="op" id="7846634">,</span>&nbsp;<span class="num" id="7846636">0</span><span class="op" id="7846637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7846641">if</span>&nbsp;<span class="ident" id="7846644">err</span>&nbsp;<span class="op" id="7846648">!=</span>&nbsp;<span class="ident" id="7846651">nil</span>&nbsp;<span class="op" id="7846655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7846660">t</span><span class="op" id="7846661">.</span><span class="ident" id="7846662">Error</span><span class="op" id="7846667">(</span><span class="ident" id="7846668">err</span><span class="op" id="7846671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7846676">continue</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7846687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7846691">switch</span>&nbsp;<span class="ident" id="7846698">msg</span><span class="op" id="7846701">.</span><span class="ident" id="7846702">rcode</span>&nbsp;<span class="op" id="7846708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7846712">case</span>&nbsp;<span class="ident" id="7846717">tt</span><span class="op" id="7846719">.</span><span class="ident" id="7846720">rcode</span><span class="op" id="7846725">,</span>&nbsp;<span class="ident" id="7846727">dnsRcodeServerFailure</span><span class="op" id="7846748">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7846752">default</span><span class="op" id="7846759">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7846764">t</span><span class="op" id="7846765">.</span><span class="ident" id="7846766">Errorf</span><span class="op" id="7846772">(</span><span class="string" id="7846773">&#34;got&nbsp;%v&nbsp;from&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7846798">,</span>&nbsp;<span class="ident" id="7846800">msg</span><span class="op" id="7846803">.</span><span class="ident" id="7846804">rcode</span><span class="op" id="7846809">,</span>&nbsp;<span class="ident" id="7846811">server</span><span class="op" id="7846817">,</span>&nbsp;<span class="ident" id="7846819">tt</span><span class="op" id="7846821">.</span><span class="ident" id="7846822">rcode</span><span class="op" id="7846827">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7846832">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7846843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7846846">}</span><br>
<span class="lineno"></span><span class="op" id="7846848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="7846851">type</span>&nbsp;<span class="ident" id="7846856">resolvConfTest</span>&nbsp;<span class="keyword" id="7846871">struct</span>&nbsp;<span class="op" id="7846878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7846881">*</span><span class="ident" id="7846882">testing</span><span class="op" id="7846889">.</span><span class="ident" id="7846890">T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7846893">dir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7846901">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7846909">path</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7846917">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7846925">started</span>&nbsp;<span class="builtintype" id="7846933">bool</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7846939">quitc</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="7846947">chan</span>&nbsp;<span class="keyword" id="7846952">chan</span>&nbsp;<span class="keyword" id="7846957">struct</span><span class="op" id="7846963">{</span><span class="op" id="7846964">}</span><br>
<span class="lineno"></span><span class="op" id="7846966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7846969">func</span>&nbsp;<span class="ident" id="7846974">newResolvConfTest</span><span class="op" id="7846991">(</span><span class="ident" id="7846992">t</span>&nbsp;<span class="op" id="7846994">*</span><span class="ident" id="7846995">testing</span><span class="op" id="7847002">.</span><span class="ident" id="7847003">T</span><span class="op" id="7847004">)</span>&nbsp;<span class="op" id="7847006">*</span><span class="ident" id="7847007">resolvConfTest</span>&nbsp;<span class="op" id="7847022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847025">dir</span><span class="op" id="7847028">,</span>&nbsp;<span class="ident" id="7847030">err</span>&nbsp;<span class="op" id="7847034">:=</span>&nbsp;<span class="ident" id="7847037">ioutil</span><span class="op" id="7847043">.</span><span class="ident" id="7847044">TempDir</span><span class="op" id="7847051">(</span><span class="string" id="7847052">&#34;&#34;</span><span class="op" id="7847054">,</span>&nbsp;<span class="string" id="7847056">&#34;resolvConfTest&#34;</span><span class="op" id="7847072">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7847075">if</span>&nbsp;<span class="ident" id="7847078">err</span>&nbsp;<span class="op" id="7847082">!=</span>&nbsp;<span class="ident" id="7847085">nil</span>&nbsp;<span class="op" id="7847089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847093">t</span><span class="op" id="7847094">.</span><span class="ident" id="7847095">Fatalf</span><span class="op" id="7847101">(</span><span class="string" id="7847102">&#34;could&nbsp;not&nbsp;create&nbsp;temp&nbsp;dir:&nbsp;%v&#34;</span><span class="op" id="7847133">,</span>&nbsp;<span class="ident" id="7847135">err</span><span class="op" id="7847138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7847141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7847145">//&nbsp;Disable&nbsp;the&nbsp;default&nbsp;loadConfig</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847180">onceLoadConfig</span><span class="op" id="7847194">.</span><span class="ident" id="7847195">Do</span><span class="op" id="7847197">(</span><span class="keyword" id="7847198">func</span><span class="op" id="7847202">(</span><span class="op" id="7847203">)</span>&nbsp;<span class="op" id="7847205">{</span><span class="op" id="7847206">}</span><span class="op" id="7847207">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847211">r</span>&nbsp;<span class="op" id="7847213">:=</span>&nbsp;<span class="op" id="7847216">&amp;</span><span class="ident" id="7847217">resolvConfTest</span><span class="op" id="7847231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847235">T</span><span class="op" id="7847236">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7847242">t</span><span class="op" id="7847243">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847247">dir</span><span class="op" id="7847250">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7847254">dir</span><span class="op" id="7847257">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847261">path</span><span class="op" id="7847265">:</span>&nbsp;&nbsp;<span class="ident" id="7847268">path</span><span class="op" id="7847272">.</span><span class="ident" id="7847273">Join</span><span class="op" id="7847277">(</span><span class="ident" id="7847278">dir</span><span class="op" id="7847281">,</span>&nbsp;<span class="string" id="7847283">&#34;resolv.conf&#34;</span><span class="op" id="7847296">)</span><span class="op" id="7847297">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847301">quitc</span><span class="op" id="7847306">:</span>&nbsp;<span class="builtinfunc" id="7847308">make</span><span class="op" id="7847312">(</span><span class="keyword" id="7847313">chan</span>&nbsp;<span class="keyword" id="7847318">chan</span>&nbsp;<span class="keyword" id="7847323">struct</span><span class="op" id="7847329">{</span><span class="op" id="7847330">}</span><span class="op" id="7847331">)</span><span class="op" id="7847332">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7847335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7847339">return</span>&nbsp;<span class="ident" id="7847346">r</span><br>
<span class="lineno">120</span><span class="op" id="7847348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7847351">func</span>&nbsp;<span class="op" id="7847356">(</span><span class="ident" id="7847357">r</span>&nbsp;<span class="op" id="7847359">*</span><span class="ident" id="7847360">resolvConfTest</span><span class="op" id="7847374">)</span>&nbsp;<span class="ident" id="7847376">Start</span><span class="op" id="7847381">(</span><span class="op" id="7847382">)</span>&nbsp;<span class="op" id="7847384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847387">loadConfig</span><span class="op" id="7847397">(</span><span class="ident" id="7847398">r</span><span class="op" id="7847399">.</span><span class="ident" id="7847400">path</span><span class="op" id="7847404">,</span>&nbsp;<span class="num" id="7847406">100</span><span class="op" id="7847409">*</span><span class="ident" id="7847410">time</span><span class="op" id="7847414">.</span><span class="ident" id="7847415">Millisecond</span><span class="op" id="7847426">,</span>&nbsp;<span class="ident" id="7847428">r</span><span class="op" id="7847429">.</span><span class="ident" id="7847430">quitc</span><span class="op" id="7847435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847438">r</span><span class="op" id="7847439">.</span><span class="ident" id="7847440">started</span>&nbsp;<span class="op" id="7847448">=</span>&nbsp;<span class="builtintype" id="7847450">true</span><br>
<span class="lineno">125</span><span class="op" id="7847455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7847458">func</span>&nbsp;<span class="op" id="7847463">(</span><span class="ident" id="7847464">r</span>&nbsp;<span class="op" id="7847466">*</span><span class="ident" id="7847467">resolvConfTest</span><span class="op" id="7847481">)</span>&nbsp;<span class="ident" id="7847483">SetConf</span><span class="op" id="7847490">(</span><span class="ident" id="7847491">s</span>&nbsp;<span class="builtintype" id="7847493">string</span><span class="op" id="7847499">)</span>&nbsp;<span class="op" id="7847501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7847504">//&nbsp;Make&nbsp;sure&nbsp;the&nbsp;file&nbsp;mtime&nbsp;will&nbsp;be&nbsp;different&nbsp;once&nbsp;we&#39;re&nbsp;done&nbsp;here,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7847573">//&nbsp;even&nbsp;on&nbsp;systems&nbsp;with&nbsp;coarse&nbsp;(1s)&nbsp;mtime&nbsp;resolution.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847628">time</span><span class="op" id="7847632">.</span><span class="ident" id="7847633">Sleep</span><span class="op" id="7847638">(</span><span class="ident" id="7847639">time</span><span class="op" id="7847643">.</span><span class="ident" id="7847644">Second</span><span class="op" id="7847650">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847654">f</span><span class="op" id="7847655">,</span>&nbsp;<span class="ident" id="7847657">err</span>&nbsp;<span class="op" id="7847661">:=</span>&nbsp;<span class="ident" id="7847664">os</span><span class="op" id="7847666">.</span><span class="ident" id="7847667">OpenFile</span><span class="op" id="7847675">(</span><span class="ident" id="7847676">r</span><span class="op" id="7847677">.</span><span class="ident" id="7847678">path</span><span class="op" id="7847682">,</span>&nbsp;<span class="ident" id="7847684">os</span><span class="op" id="7847686">.</span><span class="ident" id="7847687">O_CREATE</span><span class="op" id="7847695">|</span><span class="ident" id="7847696">os</span><span class="op" id="7847698">.</span><span class="ident" id="7847699">O_TRUNC</span><span class="op" id="7847706">|</span><span class="ident" id="7847707">os</span><span class="op" id="7847709">.</span><span class="ident" id="7847710">O_WRONLY</span><span class="op" id="7847718">,</span>&nbsp;<span class="num" id="7847720">0600</span><span class="op" id="7847724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7847727">if</span>&nbsp;<span class="ident" id="7847730">err</span>&nbsp;<span class="op" id="7847734">!=</span>&nbsp;<span class="ident" id="7847737">nil</span>&nbsp;<span class="op" id="7847741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847745">r</span><span class="op" id="7847746">.</span><span class="ident" id="7847747">Fatalf</span><span class="op" id="7847753">(</span><span class="string" id="7847754">&#34;failed&nbsp;to&nbsp;create&nbsp;temp&nbsp;file&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="7847789">,</span>&nbsp;<span class="ident" id="7847791">r</span><span class="op" id="7847792">.</span><span class="ident" id="7847793">path</span><span class="op" id="7847797">,</span>&nbsp;<span class="ident" id="7847799">err</span><span class="op" id="7847802">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7847805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7847808">if</span>&nbsp;<span class="ident" id="7847811">_</span><span class="op" id="7847812">,</span>&nbsp;<span class="ident" id="7847814">err</span>&nbsp;<span class="op" id="7847818">:=</span>&nbsp;<span class="ident" id="7847821">io</span><span class="op" id="7847823">.</span><span class="ident" id="7847824">WriteString</span><span class="op" id="7847835">(</span><span class="ident" id="7847836">f</span><span class="op" id="7847837">,</span>&nbsp;<span class="ident" id="7847839">s</span><span class="op" id="7847840">)</span><span class="op" id="7847841">;</span>&nbsp;<span class="ident" id="7847843">err</span>&nbsp;<span class="op" id="7847847">!=</span>&nbsp;<span class="ident" id="7847850">nil</span>&nbsp;<span class="op" id="7847854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847858">f</span><span class="op" id="7847859">.</span><span class="ident" id="7847860">Close</span><span class="op" id="7847865">(</span><span class="op" id="7847866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847870">r</span><span class="op" id="7847871">.</span><span class="ident" id="7847872">Fatalf</span><span class="op" id="7847878">(</span><span class="string" id="7847879">&#34;failed&nbsp;to&nbsp;write&nbsp;temp&nbsp;file:&nbsp;%v&#34;</span><span class="op" id="7847910">,</span>&nbsp;<span class="ident" id="7847912">err</span><span class="op" id="7847915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7847918">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847921">f</span><span class="op" id="7847922">.</span><span class="ident" id="7847923">Close</span><span class="op" id="7847928">(</span><span class="op" id="7847929">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7847933">if</span>&nbsp;<span class="ident" id="7847936">r</span><span class="op" id="7847937">.</span><span class="ident" id="7847938">started</span>&nbsp;<span class="op" id="7847946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847950">cfg</span><span class="op" id="7847953">.</span><span class="ident" id="7847954">ch</span>&nbsp;<span class="op" id="7847957">&lt;-</span>&nbsp;<span class="keyword" id="7847960">struct</span><span class="op" id="7847966">{</span><span class="op" id="7847967">}</span><span class="op" id="7847968">{</span><span class="op" id="7847969">}</span>&nbsp;<span class="comment" id="7847971">//&nbsp;fill&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847988">cfg</span><span class="op" id="7847991">.</span><span class="ident" id="7847992">ch</span>&nbsp;<span class="op" id="7847995">&lt;-</span>&nbsp;<span class="keyword" id="7847998">struct</span><span class="op" id="7848004">{</span><span class="op" id="7848005">}</span><span class="op" id="7848006">{</span><span class="op" id="7848007">}</span>&nbsp;<span class="comment" id="7848009">//&nbsp;wait&nbsp;for&nbsp;reload&nbsp;to&nbsp;begin</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7848039">cfg</span><span class="op" id="7848042">.</span><span class="ident" id="7848043">ch</span>&nbsp;<span class="op" id="7848046">&lt;-</span>&nbsp;<span class="keyword" id="7848049">struct</span><span class="op" id="7848055">{</span><span class="op" id="7848056">}</span><span class="op" id="7848057">{</span><span class="op" id="7848058">}</span>&nbsp;<span class="comment" id="7848060">//&nbsp;wait&nbsp;for&nbsp;reload&nbsp;to&nbsp;complete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7848092">}</span><br>
<span class="lineno"></span><span class="op" id="7848094">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7848097">func</span>&nbsp;<span class="op" id="7848102">(</span><span class="ident" id="7848103">r</span>&nbsp;<span class="op" id="7848105">*</span><span class="ident" id="7848106">resolvConfTest</span><span class="op" id="7848120">)</span>&nbsp;<span class="ident" id="7848122">WantServers</span><span class="op" id="7848133">(</span><span class="ident" id="7848134">want</span>&nbsp;<span class="op" id="7848139">[</span><span class="op" id="7848140">]</span><span class="builtintype" id="7848141">string</span><span class="op" id="7848147">)</span>&nbsp;<span class="op" id="7848149">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7848152">cfg</span><span class="op" id="7848155">.</span><span class="ident" id="7848156">mu</span><span class="op" id="7848158">.</span><span class="ident" id="7848159">RLock</span><span class="op" id="7848164">(</span><span class="op" id="7848165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7848168">defer</span>&nbsp;<span class="ident" id="7848174">cfg</span><span class="op" id="7848177">.</span><span class="ident" id="7848178">mu</span><span class="op" id="7848180">.</span><span class="ident" id="7848181">RUnlock</span><span class="op" id="7848188">(</span><span class="op" id="7848189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7848192">if</span>&nbsp;<span class="ident" id="7848195">got</span>&nbsp;<span class="op" id="7848199">:=</span>&nbsp;<span class="ident" id="7848202">cfg</span><span class="op" id="7848205">.</span><span class="ident" id="7848206">dnsConfig</span><span class="op" id="7848215">.</span><span class="ident" id="7848216">servers</span><span class="op" id="7848223">;</span>&nbsp;<span class="op" id="7848225">!</span><span class="ident" id="7848226">reflect</span><span class="op" id="7848233">.</span><span class="ident" id="7848234">DeepEqual</span><span class="op" id="7848243">(</span><span class="ident" id="7848244">got</span><span class="op" id="7848247">,</span>&nbsp;<span class="ident" id="7848249">want</span><span class="op" id="7848253">)</span>&nbsp;<span class="op" id="7848255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7848259">r</span><span class="op" id="7848260">.</span><span class="ident" id="7848261">Fatalf</span><span class="op" id="7848267">(</span><span class="string" id="7848268">&#34;Unexpected&nbsp;dns&nbsp;server&nbsp;loaded,&nbsp;got&nbsp;%v&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7848314">,</span>&nbsp;<span class="ident" id="7848316">got</span><span class="op" id="7848319">,</span>&nbsp;<span class="ident" id="7848321">want</span><span class="op" id="7848325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7848328">}</span><br>
<span class="lineno">155</span><span class="op" id="7848330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7848333">func</span>&nbsp;<span class="op" id="7848338">(</span><span class="ident" id="7848339">r</span>&nbsp;<span class="op" id="7848341">*</span><span class="ident" id="7848342">resolvConfTest</span><span class="op" id="7848356">)</span>&nbsp;<span class="ident" id="7848358">Close</span><span class="op" id="7848363">(</span><span class="op" id="7848364">)</span>&nbsp;<span class="op" id="7848366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7848369">resp</span>&nbsp;<span class="op" id="7848374">:=</span>&nbsp;<span class="builtinfunc" id="7848377">make</span><span class="op" id="7848381">(</span><span class="keyword" id="7848382">chan</span>&nbsp;<span class="keyword" id="7848387">struct</span><span class="op" id="7848393">{</span><span class="op" id="7848394">}</span><span class="op" id="7848395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7848398">r</span><span class="op" id="7848399">.</span><span class="ident" id="7848400">quitc</span>&nbsp;<span class="op" id="7848406">&lt;-</span>&nbsp;<span class="ident" id="7848409">resp</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7848415">&lt;-</span><span class="ident" id="7848417">resp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7848423">if</span>&nbsp;<span class="ident" id="7848426">err</span>&nbsp;<span class="op" id="7848430">:=</span>&nbsp;<span class="ident" id="7848433">os</span><span class="op" id="7848435">.</span><span class="ident" id="7848436">RemoveAll</span><span class="op" id="7848445">(</span><span class="ident" id="7848446">r</span><span class="op" id="7848447">.</span><span class="ident" id="7848448">dir</span><span class="op" id="7848451">)</span><span class="op" id="7848452">;</span>&nbsp;<span class="ident" id="7848454">err</span>&nbsp;<span class="op" id="7848458">!=</span>&nbsp;<span class="ident" id="7848461">nil</span>&nbsp;<span class="op" id="7848465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7848469">r</span><span class="op" id="7848470">.</span><span class="ident" id="7848471">Logf</span><span class="op" id="7848475">(</span><span class="string" id="7848476">&#34;failed&nbsp;to&nbsp;remove&nbsp;temp&nbsp;dir&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="7848510">,</span>&nbsp;<span class="ident" id="7848512">r</span><span class="op" id="7848513">.</span><span class="ident" id="7848514">dir</span><span class="op" id="7848517">,</span>&nbsp;<span class="ident" id="7848519">err</span><span class="op" id="7848522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7848525">}</span><br>
<span class="lineno"></span><span class="op" id="7848527">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="7848530">func</span>&nbsp;<span class="ident" id="7848535">TestReloadResolvConfFail</span><span class="op" id="7848559">(</span><span class="ident" id="7848560">t</span>&nbsp;<span class="op" id="7848562">*</span><span class="ident" id="7848563">testing</span><span class="op" id="7848570">.</span><span class="ident" id="7848571">T</span><span class="op" id="7848572">)</span>&nbsp;<span class="op" id="7848574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7848577">if</span>&nbsp;<span class="ident" id="7848580">testing</span><span class="op" id="7848587">.</span><span class="ident" id="7848588">Short</span><span class="op" id="7848593">(</span><span class="op" id="7848594">)</span>&nbsp;<span class="op" id="7848596">||</span>&nbsp;<span class="op" id="7848599">!</span><span class="op" id="7848600">*</span><span class="ident" id="7848601">testExternal</span>&nbsp;<span class="op" id="7848614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7848618">t</span><span class="op" id="7848619">.</span><span class="ident" id="7848620">Skip</span><span class="op" id="7848624">(</span><span class="string" id="7848625">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7848666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7848669">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7848673">r</span>&nbsp;<span class="op" id="7848675">:=</span>&nbsp;<span class="ident" id="7848678">newResolvConfTest</span><span class="op" id="7848695">(</span><span class="ident" id="7848696">t</span><span class="op" id="7848697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7848700">defer</span>&nbsp;<span class="ident" id="7848706">r</span><span class="op" id="7848707">.</span><span class="ident" id="7848708">Close</span><span class="op" id="7848713">(</span><span class="op" id="7848714">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7848718">//&nbsp;resolv.conf.tmp&nbsp;does&nbsp;not&nbsp;exist&nbsp;yet</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7848757">r</span><span class="op" id="7848758">.</span><span class="ident" id="7848759">Start</span><span class="op" id="7848764">(</span><span class="op" id="7848765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7848768">if</span>&nbsp;<span class="ident" id="7848771">_</span><span class="op" id="7848772">,</span>&nbsp;<span class="ident" id="7848774">err</span>&nbsp;<span class="op" id="7848778">:=</span>&nbsp;<span class="ident" id="7848781">goLookupIP</span><span class="op" id="7848791">(</span><span class="string" id="7848792">&#34;golang.org&#34;</span><span class="op" id="7848804">)</span><span class="op" id="7848805">;</span>&nbsp;<span class="ident" id="7848807">err</span>&nbsp;<span class="op" id="7848811">==</span>&nbsp;<span class="ident" id="7848814">nil</span>&nbsp;<span class="op" id="7848818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7848822">t</span><span class="op" id="7848823">.</span><span class="ident" id="7848824">Fatal</span><span class="op" id="7848829">(</span><span class="string" id="7848830">&#34;goLookupIP(missing)&nbsp;succeeded&#34;</span><span class="op" id="7848861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7848864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7848868">r</span><span class="op" id="7848869">.</span><span class="ident" id="7848870">SetConf</span><span class="op" id="7848877">(</span><span class="string" id="7848878">&#34;nameserver&nbsp;8.8.8.8&#34;</span><span class="op" id="7848898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7848901">if</span>&nbsp;<span class="ident" id="7848904">_</span><span class="op" id="7848905">,</span>&nbsp;<span class="ident" id="7848907">err</span>&nbsp;<span class="op" id="7848911">:=</span>&nbsp;<span class="ident" id="7848914">goLookupIP</span><span class="op" id="7848924">(</span><span class="string" id="7848925">&#34;golang.org&#34;</span><span class="op" id="7848937">)</span><span class="op" id="7848938">;</span>&nbsp;<span class="ident" id="7848940">err</span>&nbsp;<span class="op" id="7848944">!=</span>&nbsp;<span class="ident" id="7848947">nil</span>&nbsp;<span class="op" id="7848951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7848955">t</span><span class="op" id="7848956">.</span><span class="ident" id="7848957">Fatalf</span><span class="op" id="7848963">(</span><span class="string" id="7848964">&#34;goLookupIP(missing;&nbsp;good)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7849002">,</span>&nbsp;<span class="ident" id="7849004">err</span><span class="op" id="7849007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7849010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7849014">//&nbsp;Using&nbsp;a&nbsp;bad&nbsp;resolv.conf&nbsp;while&nbsp;we&nbsp;had&nbsp;a&nbsp;good</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7849062">//&nbsp;one&nbsp;before&nbsp;should&nbsp;not&nbsp;update&nbsp;the&nbsp;config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7849106">r</span><span class="op" id="7849107">.</span><span class="ident" id="7849108">SetConf</span><span class="op" id="7849115">(</span><span class="string" id="7849116">&#34;&#34;</span><span class="op" id="7849118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7849121">if</span>&nbsp;<span class="ident" id="7849124">_</span><span class="op" id="7849125">,</span>&nbsp;<span class="ident" id="7849127">err</span>&nbsp;<span class="op" id="7849131">:=</span>&nbsp;<span class="ident" id="7849134">goLookupIP</span><span class="op" id="7849144">(</span><span class="string" id="7849145">&#34;golang.org&#34;</span><span class="op" id="7849157">)</span><span class="op" id="7849158">;</span>&nbsp;<span class="ident" id="7849160">err</span>&nbsp;<span class="op" id="7849164">!=</span>&nbsp;<span class="ident" id="7849167">nil</span>&nbsp;<span class="op" id="7849171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7849175">t</span><span class="op" id="7849176">.</span><span class="ident" id="7849177">Fatalf</span><span class="op" id="7849183">(</span><span class="string" id="7849184">&#34;goLookupIP(missing;&nbsp;good;&nbsp;bad)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7849227">,</span>&nbsp;<span class="ident" id="7849229">err</span><span class="op" id="7849232">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7849235">}</span><br>
<span class="lineno"></span><span class="op" id="7849237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7849240">func</span>&nbsp;<span class="ident" id="7849245">TestReloadResolvConfChange</span><span class="op" id="7849271">(</span><span class="ident" id="7849272">t</span>&nbsp;<span class="op" id="7849274">*</span><span class="ident" id="7849275">testing</span><span class="op" id="7849282">.</span><span class="ident" id="7849283">T</span><span class="op" id="7849284">)</span>&nbsp;<span class="op" id="7849286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7849289">if</span>&nbsp;<span class="ident" id="7849292">testing</span><span class="op" id="7849299">.</span><span class="ident" id="7849300">Short</span><span class="op" id="7849305">(</span><span class="op" id="7849306">)</span>&nbsp;<span class="op" id="7849308">||</span>&nbsp;<span class="op" id="7849311">!</span><span class="op" id="7849312">*</span><span class="ident" id="7849313">testExternal</span>&nbsp;<span class="op" id="7849326">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7849330">t</span><span class="op" id="7849331">.</span><span class="ident" id="7849332">Skip</span><span class="op" id="7849336">(</span><span class="string" id="7849337">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7849378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7849381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7849385">r</span>&nbsp;<span class="op" id="7849387">:=</span>&nbsp;<span class="ident" id="7849390">newResolvConfTest</span><span class="op" id="7849407">(</span><span class="ident" id="7849408">t</span><span class="op" id="7849409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7849412">defer</span>&nbsp;<span class="ident" id="7849418">r</span><span class="op" id="7849419">.</span><span class="ident" id="7849420">Close</span><span class="op" id="7849425">(</span><span class="op" id="7849426">)</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7849430">r</span><span class="op" id="7849431">.</span><span class="ident" id="7849432">SetConf</span><span class="op" id="7849439">(</span><span class="string" id="7849440">&#34;nameserver&nbsp;8.8.8.8&#34;</span><span class="op" id="7849460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7849463">r</span><span class="op" id="7849464">.</span><span class="ident" id="7849465">Start</span><span class="op" id="7849470">(</span><span class="op" id="7849471">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7849475">if</span>&nbsp;<span class="ident" id="7849478">_</span><span class="op" id="7849479">,</span>&nbsp;<span class="ident" id="7849481">err</span>&nbsp;<span class="op" id="7849485">:=</span>&nbsp;<span class="ident" id="7849488">goLookupIP</span><span class="op" id="7849498">(</span><span class="string" id="7849499">&#34;golang.org&#34;</span><span class="op" id="7849511">)</span><span class="op" id="7849512">;</span>&nbsp;<span class="ident" id="7849514">err</span>&nbsp;<span class="op" id="7849518">!=</span>&nbsp;<span class="ident" id="7849521">nil</span>&nbsp;<span class="op" id="7849525">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7849529">t</span><span class="op" id="7849530">.</span><span class="ident" id="7849531">Fatalf</span><span class="op" id="7849537">(</span><span class="string" id="7849538">&#34;goLookupIP(good)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7849567">,</span>&nbsp;<span class="ident" id="7849569">err</span><span class="op" id="7849572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7849575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7849578">r</span><span class="op" id="7849579">.</span><span class="ident" id="7849580">WantServers</span><span class="op" id="7849591">(</span><span class="op" id="7849592">[</span><span class="op" id="7849593">]</span><span class="builtintype" id="7849594">string</span><span class="op" id="7849600">{</span><span class="string" id="7849601">&#34;8.8.8.8&#34;</span><span class="op" id="7849610">}</span><span class="op" id="7849611">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7849615">//&nbsp;Using&nbsp;a&nbsp;bad&nbsp;resolv.conf&nbsp;when&nbsp;we&nbsp;had&nbsp;a&nbsp;good&nbsp;one</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7849666">//&nbsp;before&nbsp;should&nbsp;not&nbsp;update&nbsp;the&nbsp;config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7849706">r</span><span class="op" id="7849707">.</span><span class="ident" id="7849708">SetConf</span><span class="op" id="7849715">(</span><span class="string" id="7849716">&#34;&#34;</span><span class="op" id="7849718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7849721">if</span>&nbsp;<span class="ident" id="7849724">_</span><span class="op" id="7849725">,</span>&nbsp;<span class="ident" id="7849727">err</span>&nbsp;<span class="op" id="7849731">:=</span>&nbsp;<span class="ident" id="7849734">goLookupIP</span><span class="op" id="7849744">(</span><span class="string" id="7849745">&#34;golang.org&#34;</span><span class="op" id="7849757">)</span><span class="op" id="7849758">;</span>&nbsp;<span class="ident" id="7849760">err</span>&nbsp;<span class="op" id="7849764">!=</span>&nbsp;<span class="ident" id="7849767">nil</span>&nbsp;<span class="op" id="7849771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7849775">t</span><span class="op" id="7849776">.</span><span class="ident" id="7849777">Fatalf</span><span class="op" id="7849783">(</span><span class="string" id="7849784">&#34;goLookupIP(good;&nbsp;bad)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7849818">,</span>&nbsp;<span class="ident" id="7849820">err</span><span class="op" id="7849823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7849826">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7849830">//&nbsp;A&nbsp;new&nbsp;good&nbsp;config&nbsp;should&nbsp;get&nbsp;picked&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7849873">r</span><span class="op" id="7849874">.</span><span class="ident" id="7849875">SetConf</span><span class="op" id="7849882">(</span><span class="string" id="7849883">&#34;nameserver&nbsp;8.8.4.4&#34;</span><span class="op" id="7849903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7849906">r</span><span class="op" id="7849907">.</span><span class="ident" id="7849908">WantServers</span><span class="op" id="7849919">(</span><span class="op" id="7849920">[</span><span class="op" id="7849921">]</span><span class="builtintype" id="7849922">string</span><span class="op" id="7849928">{</span><span class="string" id="7849929">&#34;8.8.4.4&#34;</span><span class="op" id="7849938">}</span><span class="op" id="7849939">)</span><br>
<span class="lineno"></span><span class="op" id="7849941">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="7849944">func</span>&nbsp;<span class="ident" id="7849949">BenchmarkGoLookupIP</span><span class="op" id="7849968">(</span><span class="ident" id="7849969">b</span>&nbsp;<span class="op" id="7849971">*</span><span class="ident" id="7849972">testing</span><span class="op" id="7849979">.</span><span class="ident" id="7849980">B</span><span class="op" id="7849981">)</span>&nbsp;<span class="op" id="7849983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7849986">for</span>&nbsp;<span class="ident" id="7849990">i</span>&nbsp;<span class="op" id="7849992">:=</span>&nbsp;<span class="num" id="7849995">0</span><span class="op" id="7849996">;</span>&nbsp;<span class="ident" id="7849998">i</span>&nbsp;<span class="op" id="7850000">&lt;</span>&nbsp;<span class="ident" id="7850002">b</span><span class="op" id="7850003">.</span><span class="ident" id="7850004">N</span><span class="op" id="7850005">;</span>&nbsp;<span class="ident" id="7850007">i</span><span class="op" id="7850008">++</span>&nbsp;<span class="op" id="7850011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7850015">goLookupIP</span><span class="op" id="7850025">(</span><span class="string" id="7850026">&#34;www.example.com&#34;</span><span class="op" id="7850043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7850046">}</span><br>
<span class="lineno">225</span><span class="op" id="7850048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7850051">func</span>&nbsp;<span class="ident" id="7850056">BenchmarkGoLookupIPNoSuchHost</span><span class="op" id="7850085">(</span><span class="ident" id="7850086">b</span>&nbsp;<span class="op" id="7850088">*</span><span class="ident" id="7850089">testing</span><span class="op" id="7850096">.</span><span class="ident" id="7850097">B</span><span class="op" id="7850098">)</span>&nbsp;<span class="op" id="7850100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7850103">for</span>&nbsp;<span class="ident" id="7850107">i</span>&nbsp;<span class="op" id="7850109">:=</span>&nbsp;<span class="num" id="7850112">0</span><span class="op" id="7850113">;</span>&nbsp;<span class="ident" id="7850115">i</span>&nbsp;<span class="op" id="7850117">&lt;</span>&nbsp;<span class="ident" id="7850119">b</span><span class="op" id="7850120">.</span><span class="ident" id="7850121">N</span><span class="op" id="7850122">;</span>&nbsp;<span class="ident" id="7850124">i</span><span class="op" id="7850125">++</span>&nbsp;<span class="op" id="7850128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7850132">goLookupIP</span><span class="op" id="7850142">(</span><span class="string" id="7850143">&#34;some.nonexistent&#34;</span><span class="op" id="7850161">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7850164">}</span><br>
<span class="lineno"></span><span class="op" id="7850166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7850169">func</span>&nbsp;<span class="ident" id="7850174">BenchmarkGoLookupIPWithBrokenNameServer</span><span class="op" id="7850213">(</span><span class="ident" id="7850214">b</span>&nbsp;<span class="op" id="7850216">*</span><span class="ident" id="7850217">testing</span><span class="op" id="7850224">.</span><span class="ident" id="7850225">B</span><span class="op" id="7850226">)</span>&nbsp;<span class="op" id="7850228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7850231">onceLoadConfig</span><span class="op" id="7850245">.</span><span class="ident" id="7850246">Do</span><span class="op" id="7850248">(</span><span class="ident" id="7850249">loadDefaultConfig</span><span class="op" id="7850266">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7850269">if</span>&nbsp;<span class="ident" id="7850272">cfg</span><span class="op" id="7850275">.</span><span class="ident" id="7850276">dnserr</span>&nbsp;<span class="op" id="7850283">!=</span>&nbsp;<span class="ident" id="7850286">nil</span>&nbsp;<span class="op" id="7850290">||</span>&nbsp;<span class="ident" id="7850293">cfg</span><span class="op" id="7850296">.</span><span class="ident" id="7850297">dnsConfig</span>&nbsp;<span class="op" id="7850307">==</span>&nbsp;<span class="ident" id="7850310">nil</span>&nbsp;<span class="op" id="7850314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7850318">b</span><span class="op" id="7850319">.</span><span class="ident" id="7850320">Fatalf</span><span class="op" id="7850326">(</span><span class="string" id="7850327">&#34;loadConfig&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7850350">,</span>&nbsp;<span class="ident" id="7850352">cfg</span><span class="op" id="7850355">.</span><span class="ident" id="7850356">dnserr</span><span class="op" id="7850362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7850365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7850368">//&nbsp;This&nbsp;looks&nbsp;ugly&nbsp;but&nbsp;it&#39;s&nbsp;safe&nbsp;as&nbsp;long&nbsp;as&nbsp;benchmarks&nbsp;are&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7850432">//&nbsp;sequentially&nbsp;in&nbsp;package&nbsp;testing.</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7850469">orig</span>&nbsp;<span class="op" id="7850474">:=</span>&nbsp;<span class="ident" id="7850477">cfg</span><span class="op" id="7850480">.</span><span class="ident" id="7850481">dnsConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7850492">cfg</span><span class="op" id="7850495">.</span><span class="ident" id="7850496">dnsConfig</span><span class="op" id="7850505">.</span><span class="ident" id="7850506">servers</span>&nbsp;<span class="op" id="7850514">=</span>&nbsp;<span class="builtinfunc" id="7850516">append</span><span class="op" id="7850522">(</span><span class="op" id="7850523">[</span><span class="op" id="7850524">]</span><span class="builtintype" id="7850525">string</span><span class="op" id="7850531">{</span><span class="string" id="7850532">&#34;203.0.113.254&#34;</span><span class="op" id="7850547">}</span><span class="op" id="7850548">,</span>&nbsp;<span class="ident" id="7850550">cfg</span><span class="op" id="7850553">.</span><span class="ident" id="7850554">dnsConfig</span><span class="op" id="7850563">.</span><span class="ident" id="7850564">servers</span><span class="op" id="7850571">...</span><span class="op" id="7850574">)</span>&nbsp;<span class="comment" id="7850576">//&nbsp;use&nbsp;TEST-NET-3&nbsp;block,&nbsp;see&nbsp;RFC&nbsp;5737</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7850615">for</span>&nbsp;<span class="ident" id="7850619">i</span>&nbsp;<span class="op" id="7850621">:=</span>&nbsp;<span class="num" id="7850624">0</span><span class="op" id="7850625">;</span>&nbsp;<span class="ident" id="7850627">i</span>&nbsp;<span class="op" id="7850629">&lt;</span>&nbsp;<span class="ident" id="7850631">b</span><span class="op" id="7850632">.</span><span class="ident" id="7850633">N</span><span class="op" id="7850634">;</span>&nbsp;<span class="ident" id="7850636">i</span><span class="op" id="7850637">++</span>&nbsp;<span class="op" id="7850640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7850644">goLookupIP</span><span class="op" id="7850654">(</span><span class="string" id="7850655">&#34;www.example.com&#34;</span><span class="op" id="7850672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7850675">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7850678">cfg</span><span class="op" id="7850681">.</span><span class="ident" id="7850682">dnsConfig</span>&nbsp;<span class="op" id="7850692">=</span>&nbsp;<span class="ident" id="7850694">orig</span><br>
<span class="lineno"></span><span class="op" id="7850699">}</span>
</div>
</body>
</html>
