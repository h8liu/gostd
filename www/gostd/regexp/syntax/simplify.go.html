<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp/syntax</h2>
<ul>
<li><a href="/gostd/regexp/syntax/compile.go.html">compile.go</a></li>
<li><a href="/gostd/regexp/syntax/doc.go.html">doc.go</a></li>
<li><a href="/gostd/regexp/syntax/parse.go.html">parse.go</a></li>
<li><a href="/gostd/regexp/syntax/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/regexp/syntax/perl_groups.go.html">perl_groups.go</a></li>
<li><a href="/gostd/regexp/syntax/prog.go.html">prog.go</a></li>
<li><a href="/gostd/regexp/syntax/prog_test.go.html">prog_test.go</a></li>
<li><a href="/gostd/regexp/syntax/regexp.go.html">regexp.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify.go.html" class="current">simplify.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify_test.go.html">simplify_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3190761">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3190817">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3190871">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3190922">package</span>&nbsp;<span class="ident" id="3190930">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3190938">//&nbsp;Simplify&nbsp;returns&nbsp;a&nbsp;regexp&nbsp;equivalent&nbsp;to&nbsp;re&nbsp;but&nbsp;without&nbsp;counted&nbsp;repetitions</span><br>
<span class="lineno"></span><span class="comment" id="3191016">//&nbsp;and&nbsp;with&nbsp;various&nbsp;other&nbsp;simplifications,&nbsp;such&nbsp;as&nbsp;rewriting&nbsp;/(?:a+)+/&nbsp;to&nbsp;/a+/.</span><br>
<span class="lineno"></span><span class="comment" id="3191096">//&nbsp;The&nbsp;resulting&nbsp;regexp&nbsp;will&nbsp;execute&nbsp;correctly&nbsp;but&nbsp;its&nbsp;string&nbsp;representation</span><br>
<span class="lineno">10</span><span class="comment" id="3191173">//&nbsp;will&nbsp;not&nbsp;produce&nbsp;the&nbsp;same&nbsp;parse&nbsp;tree,&nbsp;because&nbsp;capturing&nbsp;parentheses</span><br>
<span class="lineno"></span><span class="comment" id="3191244">//&nbsp;may&nbsp;have&nbsp;been&nbsp;duplicated&nbsp;or&nbsp;removed.&nbsp;&nbsp;For&nbsp;example,&nbsp;the&nbsp;simplified&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3191318">//&nbsp;for&nbsp;/(x){1,2}/&nbsp;is&nbsp;/(x)(x)?/&nbsp;but&nbsp;both&nbsp;parentheses&nbsp;capture&nbsp;as&nbsp;$1.</span><br>
<span class="lineno"></span><span class="comment" id="3191385">//&nbsp;The&nbsp;returned&nbsp;regexp&nbsp;may&nbsp;share&nbsp;structure&nbsp;with&nbsp;or&nbsp;be&nbsp;the&nbsp;original.</span><br>
<span class="lineno"></span><span class="keyword" id="3191453">func</span>&nbsp;<span class="op" id="3191458">(</span><span class="ident" id="3191459">re</span>&nbsp;<span class="op" id="3191462">*</span><span class="ident" id="3191463">Regexp</span><span class="op" id="3191469">)</span>&nbsp;<span class="ident" id="3191471">Simplify</span><span class="op" id="3191479">(</span><span class="op" id="3191480">)</span>&nbsp;<span class="op" id="3191482">*</span><span class="ident" id="3191483">Regexp</span>&nbsp;<span class="op" id="3191490">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3191493">if</span>&nbsp;<span class="ident" id="3191496">re</span>&nbsp;<span class="op" id="3191499">==</span>&nbsp;<span class="ident" id="3191502">nil</span>&nbsp;<span class="op" id="3191506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3191510">return</span>&nbsp;<span class="ident" id="3191517">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3191522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3191525">switch</span>&nbsp;<span class="ident" id="3191532">re</span><span class="op" id="3191534">.</span><span class="ident" id="3191535">Op</span>&nbsp;<span class="op" id="3191538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3191541">case</span>&nbsp;<span class="ident" id="3191546">OpCapture</span><span class="op" id="3191555">,</span>&nbsp;<span class="ident" id="3191557">OpConcat</span><span class="op" id="3191565">,</span>&nbsp;<span class="ident" id="3191567">OpAlternate</span><span class="op" id="3191578">:</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3191582">//&nbsp;Simplify&nbsp;children,&nbsp;building&nbsp;new&nbsp;Regexp&nbsp;if&nbsp;children&nbsp;change.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3191646">nre</span>&nbsp;<span class="op" id="3191650">:=</span>&nbsp;<span class="ident" id="3191653">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3191658">for</span>&nbsp;<span class="ident" id="3191662">i</span><span class="op" id="3191663">,</span>&nbsp;<span class="ident" id="3191665">sub</span>&nbsp;<span class="op" id="3191669">:=</span>&nbsp;<span class="keyword" id="3191672">range</span>&nbsp;<span class="ident" id="3191678">re</span><span class="op" id="3191680">.</span><span class="ident" id="3191681">Sub</span>&nbsp;<span class="op" id="3191685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3191690">nsub</span>&nbsp;<span class="op" id="3191695">:=</span>&nbsp;<span class="ident" id="3191698">sub</span><span class="op" id="3191701">.</span><span class="ident" id="3191702">Simplify</span><span class="op" id="3191710">(</span><span class="op" id="3191711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3191716">if</span>&nbsp;<span class="ident" id="3191719">nre</span>&nbsp;<span class="op" id="3191723">==</span>&nbsp;<span class="ident" id="3191726">re</span>&nbsp;<span class="op" id="3191729">&amp;&amp;</span>&nbsp;<span class="ident" id="3191732">nsub</span>&nbsp;<span class="op" id="3191737">!=</span>&nbsp;<span class="ident" id="3191740">sub</span>&nbsp;<span class="op" id="3191744">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3191750">//&nbsp;Start&nbsp;a&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3191771">nre</span>&nbsp;<span class="op" id="3191775">=</span>&nbsp;<span class="builtinfunc" id="3191777">new</span><span class="op" id="3191780">(</span><span class="ident" id="3191781">Regexp</span><span class="op" id="3191787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3191793">*</span><span class="ident" id="3191794">nre</span>&nbsp;<span class="op" id="3191798">=</span>&nbsp;<span class="op" id="3191800">*</span><span class="ident" id="3191801">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3191808">nre</span><span class="op" id="3191811">.</span><span class="ident" id="3191812">Rune</span>&nbsp;<span class="op" id="3191817">=</span>&nbsp;<span class="ident" id="3191819">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3191827">nre</span><span class="op" id="3191830">.</span><span class="ident" id="3191831">Sub</span>&nbsp;<span class="op" id="3191835">=</span>&nbsp;<span class="builtinfunc" id="3191837">append</span><span class="op" id="3191843">(</span><span class="ident" id="3191844">nre</span><span class="op" id="3191847">.</span><span class="ident" id="3191848">Sub0</span><span class="op" id="3191852">[</span><span class="op" id="3191853">:</span><span class="num" id="3191854">0</span><span class="op" id="3191855">]</span><span class="op" id="3191856">,</span>&nbsp;<span class="ident" id="3191858">re</span><span class="op" id="3191860">.</span><span class="ident" id="3191861">Sub</span><span class="op" id="3191864">[</span><span class="op" id="3191865">:</span><span class="ident" id="3191866">i</span><span class="op" id="3191867">]</span><span class="op" id="3191868">...</span><span class="op" id="3191871">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3191876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3191881">if</span>&nbsp;<span class="ident" id="3191884">nre</span>&nbsp;<span class="op" id="3191888">!=</span>&nbsp;<span class="ident" id="3191891">re</span>&nbsp;<span class="op" id="3191894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3191900">nre</span><span class="op" id="3191903">.</span><span class="ident" id="3191904">Sub</span>&nbsp;<span class="op" id="3191908">=</span>&nbsp;<span class="builtinfunc" id="3191910">append</span><span class="op" id="3191916">(</span><span class="ident" id="3191917">nre</span><span class="op" id="3191920">.</span><span class="ident" id="3191921">Sub</span><span class="op" id="3191924">,</span>&nbsp;<span class="ident" id="3191926">nsub</span><span class="op" id="3191930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3191935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3191939">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3191943">return</span>&nbsp;<span class="ident" id="3191950">nre</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3191956">case</span>&nbsp;<span class="ident" id="3191961">OpStar</span><span class="op" id="3191967">,</span>&nbsp;<span class="ident" id="3191969">OpPlus</span><span class="op" id="3191975">,</span>&nbsp;<span class="ident" id="3191977">OpQuest</span><span class="op" id="3191984">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3191988">sub</span>&nbsp;<span class="op" id="3191992">:=</span>&nbsp;<span class="ident" id="3191995">re</span><span class="op" id="3191997">.</span><span class="ident" id="3191998">Sub</span><span class="op" id="3192001">[</span><span class="num" id="3192002">0</span><span class="op" id="3192003">]</span><span class="op" id="3192004">.</span><span class="ident" id="3192005">Simplify</span><span class="op" id="3192013">(</span><span class="op" id="3192014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3192018">return</span>&nbsp;<span class="ident" id="3192025">simplify1</span><span class="op" id="3192034">(</span><span class="ident" id="3192035">re</span><span class="op" id="3192037">.</span><span class="ident" id="3192038">Op</span><span class="op" id="3192040">,</span>&nbsp;<span class="ident" id="3192042">re</span><span class="op" id="3192044">.</span><span class="ident" id="3192045">Flags</span><span class="op" id="3192050">,</span>&nbsp;<span class="ident" id="3192052">sub</span><span class="op" id="3192055">,</span>&nbsp;<span class="ident" id="3192057">re</span><span class="op" id="3192059">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3192063">case</span>&nbsp;<span class="ident" id="3192068">OpRepeat</span><span class="op" id="3192076">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3192080">//&nbsp;Special&nbsp;special&nbsp;case:&nbsp;x{0}&nbsp;matches&nbsp;the&nbsp;empty&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3192137">//&nbsp;and&nbsp;doesn&#39;t&nbsp;even&nbsp;need&nbsp;to&nbsp;consider&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3192179">if</span>&nbsp;<span class="ident" id="3192182">re</span><span class="op" id="3192184">.</span><span class="ident" id="3192185">Min</span>&nbsp;<span class="op" id="3192189">==</span>&nbsp;<span class="num" id="3192192">0</span>&nbsp;<span class="op" id="3192194">&amp;&amp;</span>&nbsp;<span class="ident" id="3192197">re</span><span class="op" id="3192199">.</span><span class="ident" id="3192200">Max</span>&nbsp;<span class="op" id="3192204">==</span>&nbsp;<span class="num" id="3192207">0</span>&nbsp;<span class="op" id="3192209">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3192214">return</span>&nbsp;<span class="op" id="3192221">&amp;</span><span class="ident" id="3192222">Regexp</span><span class="op" id="3192228">{</span><span class="ident" id="3192229">Op</span><span class="op" id="3192231">:</span>&nbsp;<span class="ident" id="3192233">OpEmptyMatch</span><span class="op" id="3192245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3192249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3192254">//&nbsp;The&nbsp;fun&nbsp;begins.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3192275">sub</span>&nbsp;<span class="op" id="3192279">:=</span>&nbsp;<span class="ident" id="3192282">re</span><span class="op" id="3192284">.</span><span class="ident" id="3192285">Sub</span><span class="op" id="3192288">[</span><span class="num" id="3192289">0</span><span class="op" id="3192290">]</span><span class="op" id="3192291">.</span><span class="ident" id="3192292">Simplify</span><span class="op" id="3192300">(</span><span class="op" id="3192301">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3192306">//&nbsp;x{n,}&nbsp;means&nbsp;at&nbsp;least&nbsp;n&nbsp;matches&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3192348">if</span>&nbsp;<span class="ident" id="3192351">re</span><span class="op" id="3192353">.</span><span class="ident" id="3192354">Max</span>&nbsp;<span class="op" id="3192358">==</span>&nbsp;<span class="op" id="3192361">-</span><span class="num" id="3192362">1</span>&nbsp;<span class="op" id="3192364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3192369">//&nbsp;Special&nbsp;case:&nbsp;x{0,}&nbsp;is&nbsp;x*.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3192402">if</span>&nbsp;<span class="ident" id="3192405">re</span><span class="op" id="3192407">.</span><span class="ident" id="3192408">Min</span>&nbsp;<span class="op" id="3192412">==</span>&nbsp;<span class="num" id="3192415">0</span>&nbsp;<span class="op" id="3192417">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3192423">return</span>&nbsp;<span class="ident" id="3192430">simplify1</span><span class="op" id="3192439">(</span><span class="ident" id="3192440">OpStar</span><span class="op" id="3192446">,</span>&nbsp;<span class="ident" id="3192448">re</span><span class="op" id="3192450">.</span><span class="ident" id="3192451">Flags</span><span class="op" id="3192456">,</span>&nbsp;<span class="ident" id="3192458">sub</span><span class="op" id="3192461">,</span>&nbsp;<span class="ident" id="3192463">nil</span><span class="op" id="3192466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3192471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3192477">//&nbsp;Special&nbsp;case:&nbsp;x{1,}&nbsp;is&nbsp;x+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3192510">if</span>&nbsp;<span class="ident" id="3192513">re</span><span class="op" id="3192515">.</span><span class="ident" id="3192516">Min</span>&nbsp;<span class="op" id="3192520">==</span>&nbsp;<span class="num" id="3192523">1</span>&nbsp;<span class="op" id="3192525">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3192531">return</span>&nbsp;<span class="ident" id="3192538">simplify1</span><span class="op" id="3192547">(</span><span class="ident" id="3192548">OpPlus</span><span class="op" id="3192554">,</span>&nbsp;<span class="ident" id="3192556">re</span><span class="op" id="3192558">.</span><span class="ident" id="3192559">Flags</span><span class="op" id="3192564">,</span>&nbsp;<span class="ident" id="3192566">sub</span><span class="op" id="3192569">,</span>&nbsp;<span class="ident" id="3192571">nil</span><span class="op" id="3192574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3192579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3192585">//&nbsp;General&nbsp;case:&nbsp;x{4,}&nbsp;is&nbsp;xxxx+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3192621">nre</span>&nbsp;<span class="op" id="3192625">:=</span>&nbsp;<span class="op" id="3192628">&amp;</span><span class="ident" id="3192629">Regexp</span><span class="op" id="3192635">{</span><span class="ident" id="3192636">Op</span><span class="op" id="3192638">:</span>&nbsp;<span class="ident" id="3192640">OpConcat</span><span class="op" id="3192648">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3192653">nre</span><span class="op" id="3192656">.</span><span class="ident" id="3192657">Sub</span>&nbsp;<span class="op" id="3192661">=</span>&nbsp;<span class="ident" id="3192663">nre</span><span class="op" id="3192666">.</span><span class="ident" id="3192667">Sub0</span><span class="op" id="3192671">[</span><span class="op" id="3192672">:</span><span class="num" id="3192673">0</span><span class="op" id="3192674">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3192679">for</span>&nbsp;<span class="ident" id="3192683">i</span>&nbsp;<span class="op" id="3192685">:=</span>&nbsp;<span class="num" id="3192688">0</span><span class="op" id="3192689">;</span>&nbsp;<span class="ident" id="3192691">i</span>&nbsp;<span class="op" id="3192693">&lt;</span>&nbsp;<span class="ident" id="3192695">re</span><span class="op" id="3192697">.</span><span class="ident" id="3192698">Min</span><span class="op" id="3192701">-</span><span class="num" id="3192702">1</span><span class="op" id="3192703">;</span>&nbsp;<span class="ident" id="3192705">i</span><span class="op" id="3192706">++</span>&nbsp;<span class="op" id="3192709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3192715">nre</span><span class="op" id="3192718">.</span><span class="ident" id="3192719">Sub</span>&nbsp;<span class="op" id="3192723">=</span>&nbsp;<span class="builtinfunc" id="3192725">append</span><span class="op" id="3192731">(</span><span class="ident" id="3192732">nre</span><span class="op" id="3192735">.</span><span class="ident" id="3192736">Sub</span><span class="op" id="3192739">,</span>&nbsp;<span class="ident" id="3192741">sub</span><span class="op" id="3192744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3192749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3192754">nre</span><span class="op" id="3192757">.</span><span class="ident" id="3192758">Sub</span>&nbsp;<span class="op" id="3192762">=</span>&nbsp;<span class="builtinfunc" id="3192764">append</span><span class="op" id="3192770">(</span><span class="ident" id="3192771">nre</span><span class="op" id="3192774">.</span><span class="ident" id="3192775">Sub</span><span class="op" id="3192778">,</span>&nbsp;<span class="ident" id="3192780">simplify1</span><span class="op" id="3192789">(</span><span class="ident" id="3192790">OpPlus</span><span class="op" id="3192796">,</span>&nbsp;<span class="ident" id="3192798">re</span><span class="op" id="3192800">.</span><span class="ident" id="3192801">Flags</span><span class="op" id="3192806">,</span>&nbsp;<span class="ident" id="3192808">sub</span><span class="op" id="3192811">,</span>&nbsp;<span class="ident" id="3192813">nil</span><span class="op" id="3192816">)</span><span class="op" id="3192817">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3192822">return</span>&nbsp;<span class="ident" id="3192829">nre</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3192835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3192840">//&nbsp;Special&nbsp;case&nbsp;x{0}&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3192879">//&nbsp;Special&nbsp;case:&nbsp;x{1}&nbsp;is&nbsp;just&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3192914">if</span>&nbsp;<span class="ident" id="3192917">re</span><span class="op" id="3192919">.</span><span class="ident" id="3192920">Min</span>&nbsp;<span class="op" id="3192924">==</span>&nbsp;<span class="num" id="3192927">1</span>&nbsp;<span class="op" id="3192929">&amp;&amp;</span>&nbsp;<span class="ident" id="3192932">re</span><span class="op" id="3192934">.</span><span class="ident" id="3192935">Max</span>&nbsp;<span class="op" id="3192939">==</span>&nbsp;<span class="num" id="3192942">1</span>&nbsp;<span class="op" id="3192944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3192949">return</span>&nbsp;<span class="ident" id="3192956">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3192962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3192967">//&nbsp;General&nbsp;case:&nbsp;x{n,m}&nbsp;means&nbsp;n&nbsp;copies&nbsp;of&nbsp;x&nbsp;and&nbsp;m&nbsp;copies&nbsp;of&nbsp;x?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3193032">//&nbsp;The&nbsp;machine&nbsp;will&nbsp;do&nbsp;less&nbsp;work&nbsp;if&nbsp;we&nbsp;nest&nbsp;the&nbsp;final&nbsp;m&nbsp;copies,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3193098">//&nbsp;so&nbsp;that&nbsp;x{2,5}&nbsp;=&nbsp;xx(x(x(x)?)?)?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3193136">//&nbsp;Build&nbsp;leading&nbsp;prefix:&nbsp;xx.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3193167">var</span>&nbsp;<span class="ident" id="3193171">prefix</span>&nbsp;<span class="op" id="3193178">*</span><span class="ident" id="3193179">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3193188">if</span>&nbsp;<span class="ident" id="3193191">re</span><span class="op" id="3193193">.</span><span class="ident" id="3193194">Min</span>&nbsp;<span class="op" id="3193198">&gt;</span>&nbsp;<span class="num" id="3193200">0</span>&nbsp;<span class="op" id="3193202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193207">prefix</span>&nbsp;<span class="op" id="3193214">=</span>&nbsp;<span class="op" id="3193216">&amp;</span><span class="ident" id="3193217">Regexp</span><span class="op" id="3193223">{</span><span class="ident" id="3193224">Op</span><span class="op" id="3193226">:</span>&nbsp;<span class="ident" id="3193228">OpConcat</span><span class="op" id="3193236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193241">prefix</span><span class="op" id="3193247">.</span><span class="ident" id="3193248">Sub</span>&nbsp;<span class="op" id="3193252">=</span>&nbsp;<span class="ident" id="3193254">prefix</span><span class="op" id="3193260">.</span><span class="ident" id="3193261">Sub0</span><span class="op" id="3193265">[</span><span class="op" id="3193266">:</span><span class="num" id="3193267">0</span><span class="op" id="3193268">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3193273">for</span>&nbsp;<span class="ident" id="3193277">i</span>&nbsp;<span class="op" id="3193279">:=</span>&nbsp;<span class="num" id="3193282">0</span><span class="op" id="3193283">;</span>&nbsp;<span class="ident" id="3193285">i</span>&nbsp;<span class="op" id="3193287">&lt;</span>&nbsp;<span class="ident" id="3193289">re</span><span class="op" id="3193291">.</span><span class="ident" id="3193292">Min</span><span class="op" id="3193295">;</span>&nbsp;<span class="ident" id="3193297">i</span><span class="op" id="3193298">++</span>&nbsp;<span class="op" id="3193301">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193307">prefix</span><span class="op" id="3193313">.</span><span class="ident" id="3193314">Sub</span>&nbsp;<span class="op" id="3193318">=</span>&nbsp;<span class="builtinfunc" id="3193320">append</span><span class="op" id="3193326">(</span><span class="ident" id="3193327">prefix</span><span class="op" id="3193333">.</span><span class="ident" id="3193334">Sub</span><span class="op" id="3193337">,</span>&nbsp;<span class="ident" id="3193339">sub</span><span class="op" id="3193342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3193347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3193351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3193356">//&nbsp;Build&nbsp;and&nbsp;attach&nbsp;suffix:&nbsp;(x(x(x)?)?)?</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3193399">if</span>&nbsp;<span class="ident" id="3193402">re</span><span class="op" id="3193404">.</span><span class="ident" id="3193405">Max</span>&nbsp;<span class="op" id="3193409">&gt;</span>&nbsp;<span class="ident" id="3193411">re</span><span class="op" id="3193413">.</span><span class="ident" id="3193414">Min</span>&nbsp;<span class="op" id="3193418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193423">suffix</span>&nbsp;<span class="op" id="3193430">:=</span>&nbsp;<span class="ident" id="3193433">simplify1</span><span class="op" id="3193442">(</span><span class="ident" id="3193443">OpQuest</span><span class="op" id="3193450">,</span>&nbsp;<span class="ident" id="3193452">re</span><span class="op" id="3193454">.</span><span class="ident" id="3193455">Flags</span><span class="op" id="3193460">,</span>&nbsp;<span class="ident" id="3193462">sub</span><span class="op" id="3193465">,</span>&nbsp;<span class="ident" id="3193467">nil</span><span class="op" id="3193470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3193475">for</span>&nbsp;<span class="ident" id="3193479">i</span>&nbsp;<span class="op" id="3193481">:=</span>&nbsp;<span class="ident" id="3193484">re</span><span class="op" id="3193486">.</span><span class="ident" id="3193487">Min</span>&nbsp;<span class="op" id="3193491">+</span>&nbsp;<span class="num" id="3193493">1</span><span class="op" id="3193494">;</span>&nbsp;<span class="ident" id="3193496">i</span>&nbsp;<span class="op" id="3193498">&lt;</span>&nbsp;<span class="ident" id="3193500">re</span><span class="op" id="3193502">.</span><span class="ident" id="3193503">Max</span><span class="op" id="3193506">;</span>&nbsp;<span class="ident" id="3193508">i</span><span class="op" id="3193509">++</span>&nbsp;<span class="op" id="3193512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193518">nre2</span>&nbsp;<span class="op" id="3193523">:=</span>&nbsp;<span class="op" id="3193526">&amp;</span><span class="ident" id="3193527">Regexp</span><span class="op" id="3193533">{</span><span class="ident" id="3193534">Op</span><span class="op" id="3193536">:</span>&nbsp;<span class="ident" id="3193538">OpConcat</span><span class="op" id="3193546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193552">nre2</span><span class="op" id="3193556">.</span><span class="ident" id="3193557">Sub</span>&nbsp;<span class="op" id="3193561">=</span>&nbsp;<span class="builtinfunc" id="3193563">append</span><span class="op" id="3193569">(</span><span class="ident" id="3193570">nre2</span><span class="op" id="3193574">.</span><span class="ident" id="3193575">Sub0</span><span class="op" id="3193579">[</span><span class="op" id="3193580">:</span><span class="num" id="3193581">0</span><span class="op" id="3193582">]</span><span class="op" id="3193583">,</span>&nbsp;<span class="ident" id="3193585">sub</span><span class="op" id="3193588">,</span>&nbsp;<span class="ident" id="3193590">suffix</span><span class="op" id="3193596">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193602">suffix</span>&nbsp;<span class="op" id="3193609">=</span>&nbsp;<span class="ident" id="3193611">simplify1</span><span class="op" id="3193620">(</span><span class="ident" id="3193621">OpQuest</span><span class="op" id="3193628">,</span>&nbsp;<span class="ident" id="3193630">re</span><span class="op" id="3193632">.</span><span class="ident" id="3193633">Flags</span><span class="op" id="3193638">,</span>&nbsp;<span class="ident" id="3193640">nre2</span><span class="op" id="3193644">,</span>&nbsp;<span class="ident" id="3193646">nil</span><span class="op" id="3193649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3193654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3193659">if</span>&nbsp;<span class="ident" id="3193662">prefix</span>&nbsp;<span class="op" id="3193669">==</span>&nbsp;<span class="ident" id="3193672">nil</span>&nbsp;<span class="op" id="3193676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3193682">return</span>&nbsp;<span class="ident" id="3193689">suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3193699">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193704">prefix</span><span class="op" id="3193710">.</span><span class="ident" id="3193711">Sub</span>&nbsp;<span class="op" id="3193715">=</span>&nbsp;<span class="builtinfunc" id="3193717">append</span><span class="op" id="3193723">(</span><span class="ident" id="3193724">prefix</span><span class="op" id="3193730">.</span><span class="ident" id="3193731">Sub</span><span class="op" id="3193734">,</span>&nbsp;<span class="ident" id="3193736">suffix</span><span class="op" id="3193742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3193746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3193750">if</span>&nbsp;<span class="ident" id="3193753">prefix</span>&nbsp;<span class="op" id="3193760">!=</span>&nbsp;<span class="ident" id="3193763">nil</span>&nbsp;<span class="op" id="3193767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3193772">return</span>&nbsp;<span class="ident" id="3193779">prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3193788">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3193793">//&nbsp;Some&nbsp;degenerate&nbsp;case&nbsp;like&nbsp;min&nbsp;&gt;&nbsp;max&nbsp;or&nbsp;min&nbsp;&lt;&nbsp;max&nbsp;&lt;&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3193852">//&nbsp;Handle&nbsp;as&nbsp;impossible&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3193885">return</span>&nbsp;<span class="op" id="3193892">&amp;</span><span class="ident" id="3193893">Regexp</span><span class="op" id="3193899">{</span><span class="ident" id="3193900">Op</span><span class="op" id="3193902">:</span>&nbsp;<span class="ident" id="3193904">OpNoMatch</span><span class="op" id="3193913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3193916">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3193920">return</span>&nbsp;<span class="ident" id="3193927">re</span><br>
<span class="lineno"></span><span class="op" id="3193930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3193933">//&nbsp;simplify1&nbsp;implements&nbsp;Simplify&nbsp;for&nbsp;the&nbsp;unary&nbsp;OpStar,</span><br>
<span class="lineno">120</span><span class="comment" id="3193988">//&nbsp;OpPlus,&nbsp;and&nbsp;OpQuest&nbsp;operators.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;simple&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="3194052">//&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3194069">//</span><br>
<span class="lineno"></span><span class="comment" id="3194072">//&nbsp;&nbsp;&nbsp;&nbspRegexp{Op:&nbsp;op,&nbsp;Flags:&nbsp;flags,&nbsp;Sub:&nbsp;{sub}}</span><br>
<span class="lineno"></span><span class="comment" id="3194116">//</span><br>
<span class="lineno">125</span><span class="comment" id="3194119">//&nbsp;under&nbsp;the&nbsp;assumption&nbsp;that&nbsp;sub&nbsp;is&nbsp;already&nbsp;simple,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3194175">//&nbsp;without&nbsp;first&nbsp;allocating&nbsp;that&nbsp;structure.&nbsp;&nbsp;If&nbsp;the&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="3194234">//&nbsp;to&nbsp;be&nbsp;returned&nbsp;turns&nbsp;out&nbsp;to&nbsp;be&nbsp;equivalent&nbsp;to&nbsp;re,&nbsp;simplify1</span><br>
<span class="lineno"></span><span class="comment" id="3194296">//&nbsp;returns&nbsp;re&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="3194319">//</span><br>
<span class="lineno">130</span><span class="comment" id="3194322">//&nbsp;simplify1&nbsp;is&nbsp;factored&nbsp;out&nbsp;of&nbsp;Simplify&nbsp;because&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="3194390">//&nbsp;for&nbsp;other&nbsp;operators&nbsp;generates&nbsp;these&nbsp;unary&nbsp;expressions.</span><br>
<span class="lineno"></span><span class="comment" id="3194448">//&nbsp;Letting&nbsp;them&nbsp;call&nbsp;simplify1&nbsp;makes&nbsp;sure&nbsp;the&nbsp;expressions&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="3194511">//&nbsp;generate&nbsp;are&nbsp;simple.</span><br>
<span class="lineno"></span><span class="keyword" id="3194535">func</span>&nbsp;<span class="ident" id="3194540">simplify1</span><span class="op" id="3194549">(</span><span class="ident" id="3194550">op</span>&nbsp;<span class="ident" id="3194553">Op</span><span class="op" id="3194555">,</span>&nbsp;<span class="ident" id="3194557">flags</span>&nbsp;<span class="ident" id="3194563">Flags</span><span class="op" id="3194568">,</span>&nbsp;<span class="ident" id="3194570">sub</span><span class="op" id="3194573">,</span>&nbsp;<span class="ident" id="3194575">re</span>&nbsp;<span class="op" id="3194578">*</span><span class="ident" id="3194579">Regexp</span><span class="op" id="3194585">)</span>&nbsp;<span class="op" id="3194587">*</span><span class="ident" id="3194588">Regexp</span>&nbsp;<span class="op" id="3194595">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3194598">//&nbsp;Special&nbsp;case:&nbsp;repeat&nbsp;the&nbsp;empty&nbsp;string&nbsp;as&nbsp;much&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3194651">//&nbsp;you&nbsp;want,&nbsp;but&nbsp;it&#39;s&nbsp;still&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194698">if</span>&nbsp;<span class="ident" id="3194701">sub</span><span class="op" id="3194704">.</span><span class="ident" id="3194705">Op</span>&nbsp;<span class="op" id="3194708">==</span>&nbsp;<span class="ident" id="3194711">OpEmptyMatch</span>&nbsp;<span class="op" id="3194724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194728">return</span>&nbsp;<span class="ident" id="3194735">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3194740">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3194743">//&nbsp;The&nbsp;operators&nbsp;are&nbsp;idempotent&nbsp;if&nbsp;the&nbsp;flags&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194796">if</span>&nbsp;<span class="ident" id="3194799">op</span>&nbsp;<span class="op" id="3194802">==</span>&nbsp;<span class="ident" id="3194805">sub</span><span class="op" id="3194808">.</span><span class="ident" id="3194809">Op</span>&nbsp;<span class="op" id="3194812">&amp;&amp;</span>&nbsp;<span class="ident" id="3194815">flags</span><span class="op" id="3194820">&amp;</span><span class="ident" id="3194821">NonGreedy</span>&nbsp;<span class="op" id="3194831">==</span>&nbsp;<span class="ident" id="3194834">sub</span><span class="op" id="3194837">.</span><span class="ident" id="3194838">Flags</span><span class="op" id="3194843">&amp;</span><span class="ident" id="3194844">NonGreedy</span>&nbsp;<span class="op" id="3194854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194858">return</span>&nbsp;<span class="ident" id="3194865">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3194870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194873">if</span>&nbsp;<span class="ident" id="3194876">re</span>&nbsp;<span class="op" id="3194879">!=</span>&nbsp;<span class="ident" id="3194882">nil</span>&nbsp;<span class="op" id="3194886">&amp;&amp;</span>&nbsp;<span class="ident" id="3194889">re</span><span class="op" id="3194891">.</span><span class="ident" id="3194892">Op</span>&nbsp;<span class="op" id="3194895">==</span>&nbsp;<span class="ident" id="3194898">op</span>&nbsp;<span class="op" id="3194901">&amp;&amp;</span>&nbsp;<span class="ident" id="3194904">re</span><span class="op" id="3194906">.</span><span class="ident" id="3194907">Flags</span><span class="op" id="3194912">&amp;</span><span class="ident" id="3194913">NonGreedy</span>&nbsp;<span class="op" id="3194923">==</span>&nbsp;<span class="ident" id="3194926">flags</span><span class="op" id="3194931">&amp;</span><span class="ident" id="3194932">NonGreedy</span>&nbsp;<span class="op" id="3194942">&amp;&amp;</span>&nbsp;<span class="ident" id="3194945">sub</span>&nbsp;<span class="op" id="3194949">==</span>&nbsp;<span class="ident" id="3194952">re</span><span class="op" id="3194954">.</span><span class="ident" id="3194955">Sub</span><span class="op" id="3194958">[</span><span class="num" id="3194959">0</span><span class="op" id="3194960">]</span>&nbsp;<span class="op" id="3194962">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194966">return</span>&nbsp;<span class="ident" id="3194973">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3194977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3194981">re</span>&nbsp;<span class="op" id="3194984">=</span>&nbsp;<span class="op" id="3194986">&amp;</span><span class="ident" id="3194987">Regexp</span><span class="op" id="3194993">{</span><span class="ident" id="3194994">Op</span><span class="op" id="3194996">:</span>&nbsp;<span class="ident" id="3194998">op</span><span class="op" id="3195000">,</span>&nbsp;<span class="ident" id="3195002">Flags</span><span class="op" id="3195007">:</span>&nbsp;<span class="ident" id="3195009">flags</span><span class="op" id="3195014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3195017">re</span><span class="op" id="3195019">.</span><span class="ident" id="3195020">Sub</span>&nbsp;<span class="op" id="3195024">=</span>&nbsp;<span class="builtinfunc" id="3195026">append</span><span class="op" id="3195032">(</span><span class="ident" id="3195033">re</span><span class="op" id="3195035">.</span><span class="ident" id="3195036">Sub0</span><span class="op" id="3195040">[</span><span class="op" id="3195041">:</span><span class="num" id="3195042">0</span><span class="op" id="3195043">]</span><span class="op" id="3195044">,</span>&nbsp;<span class="ident" id="3195046">sub</span><span class="op" id="3195049">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3195052">return</span>&nbsp;<span class="ident" id="3195059">re</span><br>
<span class="lineno"></span><span class="op" id="3195062">}</span>
</div>
</body>
</html>
