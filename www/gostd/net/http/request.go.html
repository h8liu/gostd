<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html" class="current">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3469247">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3469302">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3469356">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3469407">//&nbsp;HTTP&nbsp;Request&nbsp;reading&nbsp;and&nbsp;parsing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3469445">package</span>&nbsp;<span class="ident" id="3469453">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3469459">import</span>&nbsp;<span class="op" id="3469466">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3469469">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3469478">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3469487">&#34;crypto/tls&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3469501">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3469520">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3469530">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3469537">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3469543">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3469556">&#34;mime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3469564">&#34;mime/multipart&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3469582">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3469599">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3469610">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3469621">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3469632">&#34;sync&#34;</span><br>
<span class="lineno">25</span><span class="op" id="3469639">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3469642">const</span>&nbsp;<span class="op" id="3469648">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3469651">maxValueLength</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3469668">=</span>&nbsp;<span class="num" id="3469670">4096</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3469676">maxHeaderLines</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3469693">=</span>&nbsp;<span class="num" id="3469695">1024</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3469701">chunkSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3469718">=</span>&nbsp;<span class="num" id="3469720">4</span>&nbsp;<span class="op" id="3469722">&lt;&lt;</span>&nbsp;<span class="num" id="3469725">10</span>&nbsp;&nbsp;<span class="comment" id="3469729">//&nbsp;4&nbsp;KB&nbsp;chunks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3469745">defaultMaxMemory</span>&nbsp;<span class="op" id="3469762">=</span>&nbsp;<span class="num" id="3469764">32</span>&nbsp;<span class="op" id="3469767">&lt;&lt;</span>&nbsp;<span class="num" id="3469770">20</span>&nbsp;<span class="comment" id="3469773">//&nbsp;32&nbsp;MB</span><br>
<span class="lineno"></span><span class="op" id="3469782">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3469785">//&nbsp;ErrMissingFile&nbsp;is&nbsp;returned&nbsp;by&nbsp;FormFile&nbsp;when&nbsp;the&nbsp;provided&nbsp;file&nbsp;field&nbsp;name</span><br>
<span class="lineno">35</span><span class="comment" id="3469861">//&nbsp;is&nbsp;either&nbsp;not&nbsp;present&nbsp;in&nbsp;the&nbsp;request&nbsp;or&nbsp;not&nbsp;a&nbsp;file&nbsp;field.</span><br>
<span class="lineno"></span><span class="keyword" id="3469922">var</span>&nbsp;<span class="ident" id="3469926">ErrMissingFile</span>&nbsp;<span class="op" id="3469941">=</span>&nbsp;<span class="ident" id="3469943">errors</span><span class="op" id="3469949">.</span><span class="ident" id="3469950">New</span><span class="op" id="3469953">(</span><span class="string" id="3469954">&#34;http:&nbsp;no&nbsp;such&nbsp;file&#34;</span><span class="op" id="3469974">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3469977">//&nbsp;HTTP&nbsp;request&nbsp;parsing&nbsp;errors.</span><br>
<span class="lineno"></span><span class="keyword" id="3470009">type</span>&nbsp;<span class="ident" id="3470014">ProtocolError</span>&nbsp;<span class="keyword" id="3470028">struct</span>&nbsp;<span class="op" id="3470035">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3470038">ErrorString</span>&nbsp;<span class="builtintype" id="3470050">string</span><br>
<span class="lineno"></span><span class="op" id="3470057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3470060">func</span>&nbsp;<span class="op" id="3470065">(</span><span class="ident" id="3470066">err</span>&nbsp;<span class="op" id="3470070">*</span><span class="ident" id="3470071">ProtocolError</span><span class="op" id="3470084">)</span>&nbsp;<span class="ident" id="3470086">Error</span><span class="op" id="3470091">(</span><span class="op" id="3470092">)</span>&nbsp;<span class="builtintype" id="3470094">string</span>&nbsp;<span class="op" id="3470101">{</span>&nbsp;<span class="keyword" id="3470103">return</span>&nbsp;<span class="ident" id="3470110">err</span><span class="op" id="3470113">.</span><span class="ident" id="3470114">ErrorString</span>&nbsp;<span class="op" id="3470126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="3470129">var</span>&nbsp;<span class="op" id="3470133">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3470136">ErrHeaderTooLong</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3470160">=</span>&nbsp;<span class="op" id="3470162">&amp;</span><span class="ident" id="3470163">ProtocolError</span><span class="op" id="3470176">{</span><span class="string" id="3470177">&#34;header&nbsp;too&nbsp;long&#34;</span><span class="op" id="3470194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3470197">ErrShortBody</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3470221">=</span>&nbsp;<span class="op" id="3470223">&amp;</span><span class="ident" id="3470224">ProtocolError</span><span class="op" id="3470237">{</span><span class="string" id="3470238">&#34;entity&nbsp;body&nbsp;too&nbsp;short&#34;</span><span class="op" id="3470261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3470264">ErrNotSupported</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3470288">=</span>&nbsp;<span class="op" id="3470290">&amp;</span><span class="ident" id="3470291">ProtocolError</span><span class="op" id="3470304">{</span><span class="string" id="3470305">&#34;feature&nbsp;not&nbsp;supported&#34;</span><span class="op" id="3470328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3470331">ErrUnexpectedTrailer</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3470355">=</span>&nbsp;<span class="op" id="3470357">&amp;</span><span class="ident" id="3470358">ProtocolError</span><span class="op" id="3470371">{</span><span class="string" id="3470372">&#34;trailer&nbsp;header&nbsp;without&nbsp;chunked&nbsp;transfer&nbsp;encoding&#34;</span><span class="op" id="3470422">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3470425">ErrMissingContentLength</span>&nbsp;<span class="op" id="3470449">=</span>&nbsp;<span class="op" id="3470451">&amp;</span><span class="ident" id="3470452">ProtocolError</span><span class="op" id="3470465">{</span><span class="string" id="3470466">&#34;missing&nbsp;ContentLength&nbsp;in&nbsp;HEAD&nbsp;response&#34;</span><span class="op" id="3470506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3470509">ErrNotMultipart</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3470533">=</span>&nbsp;<span class="op" id="3470535">&amp;</span><span class="ident" id="3470536">ProtocolError</span><span class="op" id="3470549">{</span><span class="string" id="3470550">&#34;request&nbsp;Content-Type&nbsp;isn&#39;t&nbsp;multipart/form-data&#34;</span><span class="op" id="3470598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3470601">ErrMissingBoundary</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3470625">=</span>&nbsp;<span class="op" id="3470627">&amp;</span><span class="ident" id="3470628">ProtocolError</span><span class="op" id="3470641">{</span><span class="string" id="3470642">&#34;no&nbsp;multipart&nbsp;boundary&nbsp;param&nbsp;in&nbsp;Content-Type&#34;</span><span class="op" id="3470687">}</span><br>
<span class="lineno"></span><span class="op" id="3470689">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="3470692">type</span>&nbsp;<span class="ident" id="3470697">badStringError</span>&nbsp;<span class="keyword" id="3470712">struct</span>&nbsp;<span class="op" id="3470719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3470722">what</span>&nbsp;<span class="builtintype" id="3470727">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3470735">str</span>&nbsp;&nbsp;<span class="builtintype" id="3470740">string</span><br>
<span class="lineno"></span><span class="op" id="3470747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="keyword" id="3470750">func</span>&nbsp;<span class="op" id="3470755">(</span><span class="ident" id="3470756">e</span>&nbsp;<span class="op" id="3470758">*</span><span class="ident" id="3470759">badStringError</span><span class="op" id="3470773">)</span>&nbsp;<span class="ident" id="3470775">Error</span><span class="op" id="3470780">(</span><span class="op" id="3470781">)</span>&nbsp;<span class="builtintype" id="3470783">string</span>&nbsp;<span class="op" id="3470790">{</span>&nbsp;<span class="keyword" id="3470792">return</span>&nbsp;<span class="ident" id="3470799">fmt</span><span class="op" id="3470802">.</span><span class="ident" id="3470803">Sprintf</span><span class="op" id="3470810">(</span><span class="string" id="3470811">&#34;%s&nbsp;%q&#34;</span><span class="op" id="3470818">,</span>&nbsp;<span class="ident" id="3470820">e</span><span class="op" id="3470821">.</span><span class="ident" id="3470822">what</span><span class="op" id="3470826">,</span>&nbsp;<span class="ident" id="3470828">e</span><span class="op" id="3470829">.</span><span class="ident" id="3470830">str</span><span class="op" id="3470833">)</span>&nbsp;<span class="op" id="3470835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3470838">//&nbsp;Headers&nbsp;that&nbsp;Request.Write&nbsp;handles&nbsp;itself&nbsp;and&nbsp;should&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="3470906">var</span>&nbsp;<span class="ident" id="3470910">reqWriteExcludeHeader</span>&nbsp;<span class="op" id="3470932">=</span>&nbsp;<span class="keyword" id="3470934">map</span><span class="op" id="3470937">[</span><span class="builtintype" id="3470938">string</span><span class="op" id="3470944">]</span><span class="builtintype" id="3470945">bool</span><span class="op" id="3470949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3470952">&#34;Host&#34;</span><span class="op" id="3470958">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3470973">true</span><span class="op" id="3470977">,</span>&nbsp;<span class="comment" id="3470979">//&nbsp;not&nbsp;in&nbsp;Header&nbsp;map&nbsp;anyway</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3471008">&#34;User-Agent&#34;</span><span class="op" id="3471020">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3471029">true</span><span class="op" id="3471033">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3471036">&#34;Content-Length&#34;</span><span class="op" id="3471052">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3471057">true</span><span class="op" id="3471061">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3471064">&#34;Transfer-Encoding&#34;</span><span class="op" id="3471083">:</span>&nbsp;<span class="builtintype" id="3471085">true</span><span class="op" id="3471089">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3471092">&#34;Trailer&#34;</span><span class="op" id="3471101">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3471113">true</span><span class="op" id="3471117">,</span><br>
<span class="lineno"></span><span class="op" id="3471119">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="3471122">//&nbsp;A&nbsp;Request&nbsp;represents&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;received&nbsp;by&nbsp;a&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="3471183">//&nbsp;or&nbsp;to&nbsp;be&nbsp;sent&nbsp;by&nbsp;a&nbsp;client.</span><br>
<span class="lineno"></span><span class="comment" id="3471213">//</span><br>
<span class="lineno"></span><span class="comment" id="3471216">//&nbsp;The&nbsp;field&nbsp;semantics&nbsp;differ&nbsp;slightly&nbsp;between&nbsp;client&nbsp;and&nbsp;server</span><br>
<span class="lineno">75</span><span class="comment" id="3471281">//&nbsp;usage.&nbsp;In&nbsp;addition&nbsp;to&nbsp;the&nbsp;notes&nbsp;on&nbsp;the&nbsp;fields&nbsp;below,&nbsp;see&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3471345">//&nbsp;documentation&nbsp;for&nbsp;Request.Write&nbsp;and&nbsp;RoundTripper.</span><br>
<span class="lineno"></span><span class="keyword" id="3471398">type</span>&nbsp;<span class="ident" id="3471403">Request</span>&nbsp;<span class="keyword" id="3471411">struct</span>&nbsp;<span class="op" id="3471418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3471421">//&nbsp;Method&nbsp;specifies&nbsp;the&nbsp;HTTP&nbsp;method&nbsp;(GET,&nbsp;POST,&nbsp;PUT,&nbsp;etc.).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3471482">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;an&nbsp;empty&nbsp;string&nbsp;means&nbsp;GET.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3471533">Method</span>&nbsp;<span class="builtintype" id="3471540">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3471549">//&nbsp;URL&nbsp;specifies&nbsp;either&nbsp;the&nbsp;URI&nbsp;being&nbsp;requested&nbsp;(for&nbsp;server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3471610">//&nbsp;requests)&nbsp;or&nbsp;the&nbsp;URL&nbsp;to&nbsp;access&nbsp;(for&nbsp;client&nbsp;requests).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3471668">//</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3471672">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;URL&nbsp;is&nbsp;parsed&nbsp;from&nbsp;the&nbsp;URI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3471727">//&nbsp;supplied&nbsp;on&nbsp;the&nbsp;Request-Line&nbsp;as&nbsp;stored&nbsp;in&nbsp;RequestURI.&nbsp;&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3471790">//&nbsp;most&nbsp;requests,&nbsp;fields&nbsp;other&nbsp;than&nbsp;Path&nbsp;and&nbsp;RawQuery&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3471853">//&nbsp;empty.&nbsp;(See&nbsp;RFC&nbsp;2616,&nbsp;Section&nbsp;5.1.2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3471894">//</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3471898">//&nbsp;For&nbsp;client&nbsp;requests,&nbsp;the&nbsp;URL&#39;s&nbsp;Host&nbsp;specifies&nbsp;the&nbsp;server&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3471962">//&nbsp;connect&nbsp;to,&nbsp;while&nbsp;the&nbsp;Request&#39;s&nbsp;Host&nbsp;field&nbsp;optionally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472020">//&nbsp;specifies&nbsp;the&nbsp;Host&nbsp;header&nbsp;value&nbsp;to&nbsp;send&nbsp;in&nbsp;the&nbsp;HTTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472076">//&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3472089">URL</span>&nbsp;<span class="op" id="3472093">*</span><span class="ident" id="3472094">url</span><span class="op" id="3472097">.</span><span class="ident" id="3472098">URL</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472104">//&nbsp;The&nbsp;protocol&nbsp;version&nbsp;for&nbsp;incoming&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472152">//&nbsp;Client&nbsp;requests&nbsp;always&nbsp;use&nbsp;HTTP/1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3472193">Proto</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3472204">string</span>&nbsp;<span class="comment" id="3472211">//&nbsp;&#34;HTTP/1.0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3472226">ProtoMajor</span>&nbsp;<span class="builtintype" id="3472237">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472244">//&nbsp;1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3472250">ProtoMinor</span>&nbsp;<span class="builtintype" id="3472261">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472268">//&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472275">//&nbsp;A&nbsp;header&nbsp;maps&nbsp;request&nbsp;lines&nbsp;to&nbsp;their&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472324">//&nbsp;If&nbsp;the&nbsp;header&nbsp;says</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472347">//</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472351">//&nbsp;&nbsp;&nbsp;&nbsp;accept-encoding:&nbsp;gzip,&nbsp;deflate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472386">//&nbsp;&nbsp;&nbsp;&nbsp;Accept-Language:&nbsp;en-us</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472413">//&nbsp;&nbsp;&nbsp;&nbsp;Connection:&nbsp;keep-alive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472440">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472444">//&nbsp;then</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472453">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472457">//&nbsp;&nbsp;&nbsp;&nbsp;Header&nbsp;=&nbsp;map[string][]string{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472491">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;Accept-Encoding&#34;:&nbsp;{&#34;gzip,&nbsp;deflate&#34;},</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472534">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;Accept-Language&#34;:&nbsp;{&#34;en-us&#34;},</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472569">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;Connection&#34;:&nbsp;{&#34;keep-alive&#34;},</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472604">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472610">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472614">//&nbsp;HTTP&nbsp;defines&nbsp;that&nbsp;header&nbsp;names&nbsp;are&nbsp;case-insensitive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472671">//&nbsp;The&nbsp;request&nbsp;parser&nbsp;implements&nbsp;this&nbsp;by&nbsp;canonicalizing&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472732">//&nbsp;name,&nbsp;making&nbsp;the&nbsp;first&nbsp;character&nbsp;and&nbsp;any&nbsp;characters</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472788">//&nbsp;following&nbsp;a&nbsp;hyphen&nbsp;uppercase&nbsp;and&nbsp;the&nbsp;rest&nbsp;lowercase.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472845">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472849">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;certain&nbsp;headers&nbsp;are&nbsp;automatically</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472907">//&nbsp;added&nbsp;and&nbsp;may&nbsp;override&nbsp;values&nbsp;in&nbsp;Header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472952">//</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472956">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;Request.Write&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3473012">Header</span>&nbsp;<span class="ident" id="3473019">Header</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3473028">//&nbsp;Body&nbsp;is&nbsp;the&nbsp;request&#39;s&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3473060">//</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3473064">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;a&nbsp;nil&nbsp;body&nbsp;means&nbsp;the&nbsp;request&nbsp;has&nbsp;no</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3473124">//&nbsp;body,&nbsp;such&nbsp;as&nbsp;a&nbsp;GET&nbsp;request.&nbsp;The&nbsp;HTTP&nbsp;Client&#39;s&nbsp;Transport</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3473185">//&nbsp;is&nbsp;responsible&nbsp;for&nbsp;calling&nbsp;the&nbsp;Close&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3473234">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3473238">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;Request&nbsp;Body&nbsp;is&nbsp;always&nbsp;non-nil</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3473297">//&nbsp;but&nbsp;will&nbsp;return&nbsp;EOF&nbsp;immediately&nbsp;when&nbsp;no&nbsp;body&nbsp;is&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3473358">//&nbsp;The&nbsp;Server&nbsp;will&nbsp;close&nbsp;the&nbsp;request&nbsp;body.&nbsp;The&nbsp;ServeHTTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3473416">//&nbsp;Handler&nbsp;does&nbsp;not&nbsp;need&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3473446">Body</span>&nbsp;<span class="ident" id="3473451">io</span><span class="op" id="3473453">.</span><span class="ident" id="3473454">ReadCloser</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3473467">//&nbsp;ContentLength&nbsp;records&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;associated&nbsp;content.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3473531">//&nbsp;The&nbsp;value&nbsp;-1&nbsp;indicates&nbsp;that&nbsp;the&nbsp;length&nbsp;is&nbsp;unknown.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3473586">//&nbsp;Values&nbsp;&gt;=&nbsp;0&nbsp;indicate&nbsp;that&nbsp;the&nbsp;given&nbsp;number&nbsp;of&nbsp;bytes&nbsp;may</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3473646">//&nbsp;be&nbsp;read&nbsp;from&nbsp;Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3473669">//&nbsp;For&nbsp;client&nbsp;requests,&nbsp;a&nbsp;value&nbsp;of&nbsp;0&nbsp;means&nbsp;unknown&nbsp;if&nbsp;Body&nbsp;is&nbsp;not&nbsp;nil.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3473741">ContentLength</span>&nbsp;<span class="ident" id="3473755">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3473763">//&nbsp;TransferEncoding&nbsp;lists&nbsp;the&nbsp;transfer&nbsp;encodings&nbsp;from&nbsp;outermost&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3473831">//&nbsp;innermost.&nbsp;An&nbsp;empty&nbsp;list&nbsp;denotes&nbsp;the&nbsp;&#34;identity&#34;&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3473893">//&nbsp;TransferEncoding&nbsp;can&nbsp;usually&nbsp;be&nbsp;ignored;&nbsp;chunked&nbsp;encoding&nbsp;is</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3473958">//&nbsp;automatically&nbsp;added&nbsp;and&nbsp;removed&nbsp;as&nbsp;necessary&nbsp;when&nbsp;sending&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3474024">//&nbsp;receiving&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3474048">TransferEncoding</span>&nbsp;<span class="op" id="3474065">[</span><span class="op" id="3474066">]</span><span class="builtintype" id="3474067">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3474076">//&nbsp;Close&nbsp;indicates&nbsp;whether&nbsp;to&nbsp;close&nbsp;the&nbsp;connection&nbsp;after</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3474134">//&nbsp;replying&nbsp;to&nbsp;this&nbsp;request&nbsp;(for&nbsp;servers)&nbsp;or&nbsp;after&nbsp;sending</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3474194">//&nbsp;the&nbsp;request&nbsp;(for&nbsp;clients).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3474225">Close</span>&nbsp;<span class="builtintype" id="3474231">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3474238">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;Host&nbsp;specifies&nbsp;the&nbsp;host&nbsp;on&nbsp;which&nbsp;the</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3474299">//&nbsp;URL&nbsp;is&nbsp;sought.&nbsp;Per&nbsp;RFC&nbsp;2616,&nbsp;this&nbsp;is&nbsp;either&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3474360">//&nbsp;the&nbsp;&#34;Host&#34;&nbsp;header&nbsp;or&nbsp;the&nbsp;host&nbsp;name&nbsp;given&nbsp;in&nbsp;the&nbsp;URL&nbsp;itself.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3474424">//&nbsp;It&nbsp;may&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host:port&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3474463">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3474467">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;Host&nbsp;optionally&nbsp;overrides&nbsp;the&nbsp;Host</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3474526">//&nbsp;header&nbsp;to&nbsp;send.&nbsp;If&nbsp;empty,&nbsp;the&nbsp;Request.Write&nbsp;method&nbsp;uses</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3474586">//&nbsp;the&nbsp;value&nbsp;of&nbsp;URL.Host.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3474613">Host</span>&nbsp;<span class="builtintype" id="3474618">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3474627">//&nbsp;Form&nbsp;contains&nbsp;the&nbsp;parsed&nbsp;form&nbsp;data,&nbsp;including&nbsp;both&nbsp;the&nbsp;URL</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3474690">//&nbsp;field&#39;s&nbsp;query&nbsp;parameters&nbsp;and&nbsp;the&nbsp;POST&nbsp;or&nbsp;PUT&nbsp;form&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3474750">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3474810">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;Form&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3474866">Form</span>&nbsp;<span class="ident" id="3474871">url</span><span class="op" id="3474874">.</span><span class="ident" id="3474875">Values</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3474884">//&nbsp;PostForm&nbsp;contains&nbsp;the&nbsp;parsed&nbsp;form&nbsp;data&nbsp;from&nbsp;POST&nbsp;or&nbsp;PUT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3474944">//&nbsp;body&nbsp;parameters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3474965">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3475025">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;PostForm&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3475085">PostForm</span>&nbsp;<span class="ident" id="3475094">url</span><span class="op" id="3475097">.</span><span class="ident" id="3475098">Values</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3475107">//&nbsp;MultipartForm&nbsp;is&nbsp;the&nbsp;parsed&nbsp;multipart&nbsp;form,&nbsp;including&nbsp;file&nbsp;uploads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3475179">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseMultipartForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3475248">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;MultipartForm&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3475313">MultipartForm</span>&nbsp;<span class="op" id="3475327">*</span><span class="ident" id="3475328">multipart</span><span class="op" id="3475337">.</span><span class="ident" id="3475338">Form</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3475345">//&nbsp;Trailer&nbsp;specifies&nbsp;additional&nbsp;headers&nbsp;that&nbsp;are&nbsp;sent&nbsp;after&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3475418">//&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3475428">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3475432">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;Trailer&nbsp;map&nbsp;initially&nbsp;contains&nbsp;only&nbsp;the</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3475500">//&nbsp;trailer&nbsp;keys,&nbsp;with&nbsp;nil&nbsp;values.&nbsp;(The&nbsp;client&nbsp;declares&nbsp;which&nbsp;trailers&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3475574">//&nbsp;will&nbsp;later&nbsp;send.)&nbsp;&nbsp;While&nbsp;the&nbsp;handler&nbsp;is&nbsp;reading&nbsp;from&nbsp;Body,&nbsp;it&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3475645">//&nbsp;not&nbsp;reference&nbsp;Trailer.&nbsp;After&nbsp;reading&nbsp;from&nbsp;Body&nbsp;returns&nbsp;EOF,&nbsp;Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3475717">//&nbsp;can&nbsp;be&nbsp;read&nbsp;again&nbsp;and&nbsp;will&nbsp;contain&nbsp;non-nil&nbsp;values,&nbsp;if&nbsp;they&nbsp;were&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3475790">//&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3475809">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3475813">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;Trailer&nbsp;must&nbsp;be&nbsp;initialized&nbsp;to&nbsp;a&nbsp;map&nbsp;containing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3475885">//&nbsp;the&nbsp;trailer&nbsp;keys&nbsp;to&nbsp;later&nbsp;send.&nbsp;The&nbsp;values&nbsp;may&nbsp;be&nbsp;nil&nbsp;or&nbsp;their&nbsp;final</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3475958">//&nbsp;values.&nbsp;The&nbsp;ContentLength&nbsp;must&nbsp;be&nbsp;0&nbsp;or&nbsp;-1,&nbsp;to&nbsp;send&nbsp;a&nbsp;chunked&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3476032">//&nbsp;After&nbsp;the&nbsp;HTTP&nbsp;request&nbsp;is&nbsp;sent&nbsp;the&nbsp;map&nbsp;values&nbsp;can&nbsp;be&nbsp;updated&nbsp;while</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3476103">//&nbsp;the&nbsp;request&nbsp;body&nbsp;is&nbsp;read.&nbsp;Once&nbsp;the&nbsp;body&nbsp;returns&nbsp;EOF,&nbsp;the&nbsp;caller&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3476176">//&nbsp;not&nbsp;mutate&nbsp;Trailer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3476200">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3476204">//&nbsp;Few&nbsp;HTTP&nbsp;clients,&nbsp;servers,&nbsp;or&nbsp;proxies&nbsp;support&nbsp;HTTP&nbsp;trailers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3476269">Trailer</span>&nbsp;<span class="ident" id="3476277">Header</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3476286">//&nbsp;RemoteAddr&nbsp;allows&nbsp;HTTP&nbsp;servers&nbsp;and&nbsp;other&nbsp;software&nbsp;to&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3476350">//&nbsp;the&nbsp;network&nbsp;address&nbsp;that&nbsp;sent&nbsp;the&nbsp;request,&nbsp;usually&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3476409">//&nbsp;logging.&nbsp;This&nbsp;field&nbsp;is&nbsp;not&nbsp;filled&nbsp;in&nbsp;by&nbsp;ReadRequest&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3476469">//&nbsp;has&nbsp;no&nbsp;defined&nbsp;format.&nbsp;The&nbsp;HTTP&nbsp;server&nbsp;in&nbsp;this&nbsp;package</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3476528">//&nbsp;sets&nbsp;RemoteAddr&nbsp;to&nbsp;an&nbsp;&#34;IP:port&#34;&nbsp;address&nbsp;before&nbsp;invoking&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3476590">//&nbsp;handler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3476603">//&nbsp;This&nbsp;field&nbsp;is&nbsp;ignored&nbsp;by&nbsp;the&nbsp;HTTP&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3476649">RemoteAddr</span>&nbsp;<span class="builtintype" id="3476660">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3476669">//&nbsp;RequestURI&nbsp;is&nbsp;the&nbsp;unmodified&nbsp;Request-URI&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3476721">//&nbsp;Request-Line&nbsp;(RFC&nbsp;2616,&nbsp;Section&nbsp;5.1)&nbsp;as&nbsp;sent&nbsp;by&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3476784">//&nbsp;to&nbsp;a&nbsp;server.&nbsp;Usually&nbsp;the&nbsp;URL&nbsp;field&nbsp;should&nbsp;be&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3476847">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;set&nbsp;this&nbsp;field&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;client&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3476911">RequestURI</span>&nbsp;<span class="builtintype" id="3476922">string</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3476931">//&nbsp;TLS&nbsp;allows&nbsp;HTTP&nbsp;servers&nbsp;and&nbsp;other&nbsp;software&nbsp;to&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3476988">//&nbsp;information&nbsp;about&nbsp;the&nbsp;TLS&nbsp;connection&nbsp;on&nbsp;which&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3477050">//&nbsp;was&nbsp;received.&nbsp;This&nbsp;field&nbsp;is&nbsp;not&nbsp;filled&nbsp;in&nbsp;by&nbsp;ReadRequest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3477112">//&nbsp;The&nbsp;HTTP&nbsp;server&nbsp;in&nbsp;this&nbsp;package&nbsp;sets&nbsp;the&nbsp;field&nbsp;for</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3477167">//&nbsp;TLS-enabled&nbsp;connections&nbsp;before&nbsp;invoking&nbsp;a&nbsp;handler;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3477222">//&nbsp;otherwise&nbsp;it&nbsp;leaves&nbsp;the&nbsp;field&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3477261">//&nbsp;This&nbsp;field&nbsp;is&nbsp;ignored&nbsp;by&nbsp;the&nbsp;HTTP&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3477307">TLS</span>&nbsp;<span class="op" id="3477311">*</span><span class="ident" id="3477312">tls</span><span class="op" id="3477315">.</span><span class="ident" id="3477316">ConnectionState</span><br>
<span class="lineno"></span><span class="op" id="3477332">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="3477335">//&nbsp;ProtoAtLeast&nbsp;reports&nbsp;whether&nbsp;the&nbsp;HTTP&nbsp;protocol&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="3477390">//&nbsp;in&nbsp;the&nbsp;request&nbsp;is&nbsp;at&nbsp;least&nbsp;major.minor.</span><br>
<span class="lineno"></span><span class="keyword" id="3477433">func</span>&nbsp;<span class="op" id="3477438">(</span><span class="ident" id="3477439">r</span>&nbsp;<span class="op" id="3477441">*</span><span class="ident" id="3477442">Request</span><span class="op" id="3477449">)</span>&nbsp;<span class="ident" id="3477451">ProtoAtLeast</span><span class="op" id="3477463">(</span><span class="ident" id="3477464">major</span><span class="op" id="3477469">,</span>&nbsp;<span class="ident" id="3477471">minor</span>&nbsp;<span class="builtintype" id="3477477">int</span><span class="op" id="3477480">)</span>&nbsp;<span class="builtintype" id="3477482">bool</span>&nbsp;<span class="op" id="3477487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3477490">return</span>&nbsp;<span class="ident" id="3477497">r</span><span class="op" id="3477498">.</span><span class="ident" id="3477499">ProtoMajor</span>&nbsp;<span class="op" id="3477510">&gt;</span>&nbsp;<span class="ident" id="3477512">major</span>&nbsp;<span class="op" id="3477518">||</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3477523">r</span><span class="op" id="3477524">.</span><span class="ident" id="3477525">ProtoMajor</span>&nbsp;<span class="op" id="3477536">==</span>&nbsp;<span class="ident" id="3477539">major</span>&nbsp;<span class="op" id="3477545">&amp;&amp;</span>&nbsp;<span class="ident" id="3477548">r</span><span class="op" id="3477549">.</span><span class="ident" id="3477550">ProtoMinor</span>&nbsp;<span class="op" id="3477561">&gt;=</span>&nbsp;<span class="ident" id="3477564">minor</span><br>
<span class="lineno"></span><span class="op" id="3477570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3477573">//&nbsp;UserAgent&nbsp;returns&nbsp;the&nbsp;client&#39;s&nbsp;User-Agent,&nbsp;if&nbsp;sent&nbsp;in&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="keyword" id="3477643">func</span>&nbsp;<span class="op" id="3477648">(</span><span class="ident" id="3477649">r</span>&nbsp;<span class="op" id="3477651">*</span><span class="ident" id="3477652">Request</span><span class="op" id="3477659">)</span>&nbsp;<span class="ident" id="3477661">UserAgent</span><span class="op" id="3477670">(</span><span class="op" id="3477671">)</span>&nbsp;<span class="builtintype" id="3477673">string</span>&nbsp;<span class="op" id="3477680">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3477683">return</span>&nbsp;<span class="ident" id="3477690">r</span><span class="op" id="3477691">.</span><span class="ident" id="3477692">Header</span><span class="op" id="3477698">.</span><span class="ident" id="3477699">Get</span><span class="op" id="3477702">(</span><span class="string" id="3477703">&#34;User-Agent&#34;</span><span class="op" id="3477715">)</span><br>
<span class="lineno"></span><span class="op" id="3477717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3477720">//&nbsp;Cookies&nbsp;parses&nbsp;and&nbsp;returns&nbsp;the&nbsp;HTTP&nbsp;cookies&nbsp;sent&nbsp;with&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="keyword" id="3477790">func</span>&nbsp;<span class="op" id="3477795">(</span><span class="ident" id="3477796">r</span>&nbsp;<span class="op" id="3477798">*</span><span class="ident" id="3477799">Request</span><span class="op" id="3477806">)</span>&nbsp;<span class="ident" id="3477808">Cookies</span><span class="op" id="3477815">(</span><span class="op" id="3477816">)</span>&nbsp;<span class="op" id="3477818">[</span><span class="op" id="3477819">]</span><span class="op" id="3477820">*</span><span class="ident" id="3477821">Cookie</span>&nbsp;<span class="op" id="3477828">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3477831">return</span>&nbsp;<span class="ident" id="3477838">readCookies</span><span class="op" id="3477849">(</span><span class="ident" id="3477850">r</span><span class="op" id="3477851">.</span><span class="ident" id="3477852">Header</span><span class="op" id="3477858">,</span>&nbsp;<span class="string" id="3477860">&#34;&#34;</span><span class="op" id="3477862">)</span><br>
<span class="lineno"></span><span class="op" id="3477864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3477867">var</span>&nbsp;<span class="ident" id="3477871">ErrNoCookie</span>&nbsp;<span class="op" id="3477883">=</span>&nbsp;<span class="ident" id="3477885">errors</span><span class="op" id="3477891">.</span><span class="ident" id="3477892">New</span><span class="op" id="3477895">(</span><span class="string" id="3477896">&#34;http:&nbsp;named&nbsp;cookie&nbsp;not&nbsp;present&#34;</span><span class="op" id="3477928">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="comment" id="3477931">//&nbsp;Cookie&nbsp;returns&nbsp;the&nbsp;named&nbsp;cookie&nbsp;provided&nbsp;in&nbsp;the&nbsp;request&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="3477993">//&nbsp;ErrNoCookie&nbsp;if&nbsp;not&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="3478022">func</span>&nbsp;<span class="op" id="3478027">(</span><span class="ident" id="3478028">r</span>&nbsp;<span class="op" id="3478030">*</span><span class="ident" id="3478031">Request</span><span class="op" id="3478038">)</span>&nbsp;<span class="ident" id="3478040">Cookie</span><span class="op" id="3478046">(</span><span class="ident" id="3478047">name</span>&nbsp;<span class="builtintype" id="3478052">string</span><span class="op" id="3478058">)</span>&nbsp;<span class="op" id="3478060">(</span><span class="op" id="3478061">*</span><span class="ident" id="3478062">Cookie</span><span class="op" id="3478068">,</span>&nbsp;<span class="builtintype" id="3478070">error</span><span class="op" id="3478075">)</span>&nbsp;<span class="op" id="3478077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3478080">for</span>&nbsp;<span class="ident" id="3478084">_</span><span class="op" id="3478085">,</span>&nbsp;<span class="ident" id="3478087">c</span>&nbsp;<span class="op" id="3478089">:=</span>&nbsp;<span class="keyword" id="3478092">range</span>&nbsp;<span class="ident" id="3478098">readCookies</span><span class="op" id="3478109">(</span><span class="ident" id="3478110">r</span><span class="op" id="3478111">.</span><span class="ident" id="3478112">Header</span><span class="op" id="3478118">,</span>&nbsp;<span class="ident" id="3478120">name</span><span class="op" id="3478124">)</span>&nbsp;<span class="op" id="3478126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3478130">return</span>&nbsp;<span class="ident" id="3478137">c</span><span class="op" id="3478138">,</span>&nbsp;<span class="ident" id="3478140">nil</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3478145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3478148">return</span>&nbsp;<span class="ident" id="3478155">nil</span><span class="op" id="3478158">,</span>&nbsp;<span class="ident" id="3478160">ErrNoCookie</span><br>
<span class="lineno"></span><span class="op" id="3478172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3478175">//&nbsp;AddCookie&nbsp;adds&nbsp;a&nbsp;cookie&nbsp;to&nbsp;the&nbsp;request.&nbsp;&nbsp;Per&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.4,</span><br>
<span class="lineno">260</span><span class="comment" id="3478245">//&nbsp;AddCookie&nbsp;does&nbsp;not&nbsp;attach&nbsp;more&nbsp;than&nbsp;one&nbsp;Cookie&nbsp;header&nbsp;field.&nbsp;&nbsp;That</span><br>
<span class="lineno"></span><span class="comment" id="3478315">//&nbsp;means&nbsp;all&nbsp;cookies,&nbsp;if&nbsp;any,&nbsp;are&nbsp;written&nbsp;into&nbsp;the&nbsp;same&nbsp;line,</span><br>
<span class="lineno"></span><span class="comment" id="3478377">//&nbsp;separated&nbsp;by&nbsp;semicolon.</span><br>
<span class="lineno"></span><span class="keyword" id="3478404">func</span>&nbsp;<span class="op" id="3478409">(</span><span class="ident" id="3478410">r</span>&nbsp;<span class="op" id="3478412">*</span><span class="ident" id="3478413">Request</span><span class="op" id="3478420">)</span>&nbsp;<span class="ident" id="3478422">AddCookie</span><span class="op" id="3478431">(</span><span class="ident" id="3478432">c</span>&nbsp;<span class="op" id="3478434">*</span><span class="ident" id="3478435">Cookie</span><span class="op" id="3478441">)</span>&nbsp;<span class="op" id="3478443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3478446">s</span>&nbsp;<span class="op" id="3478448">:=</span>&nbsp;<span class="ident" id="3478451">fmt</span><span class="op" id="3478454">.</span><span class="ident" id="3478455">Sprintf</span><span class="op" id="3478462">(</span><span class="string" id="3478463">&#34;%s=%s&#34;</span><span class="op" id="3478470">,</span>&nbsp;<span class="ident" id="3478472">sanitizeCookieName</span><span class="op" id="3478490">(</span><span class="ident" id="3478491">c</span><span class="op" id="3478492">.</span><span class="ident" id="3478493">Name</span><span class="op" id="3478497">)</span><span class="op" id="3478498">,</span>&nbsp;<span class="ident" id="3478500">sanitizeCookieValue</span><span class="op" id="3478519">(</span><span class="ident" id="3478520">c</span><span class="op" id="3478521">.</span><span class="ident" id="3478522">Value</span><span class="op" id="3478527">)</span><span class="op" id="3478528">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3478531">if</span>&nbsp;<span class="ident" id="3478534">c</span>&nbsp;<span class="op" id="3478536">:=</span>&nbsp;<span class="ident" id="3478539">r</span><span class="op" id="3478540">.</span><span class="ident" id="3478541">Header</span><span class="op" id="3478547">.</span><span class="ident" id="3478548">Get</span><span class="op" id="3478551">(</span><span class="string" id="3478552">&#34;Cookie&#34;</span><span class="op" id="3478560">)</span><span class="op" id="3478561">;</span>&nbsp;<span class="ident" id="3478563">c</span>&nbsp;<span class="op" id="3478565">!=</span>&nbsp;<span class="string" id="3478568">&#34;&#34;</span>&nbsp;<span class="op" id="3478571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3478575">r</span><span class="op" id="3478576">.</span><span class="ident" id="3478577">Header</span><span class="op" id="3478583">.</span><span class="ident" id="3478584">Set</span><span class="op" id="3478587">(</span><span class="string" id="3478588">&#34;Cookie&#34;</span><span class="op" id="3478596">,</span>&nbsp;<span class="ident" id="3478598">c</span><span class="op" id="3478599">+</span><span class="string" id="3478600">&#34;;&nbsp;&#34;</span><span class="op" id="3478604">+</span><span class="ident" id="3478605">s</span><span class="op" id="3478606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3478609">}</span>&nbsp;<span class="keyword" id="3478611">else</span>&nbsp;<span class="op" id="3478616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3478620">r</span><span class="op" id="3478621">.</span><span class="ident" id="3478622">Header</span><span class="op" id="3478628">.</span><span class="ident" id="3478629">Set</span><span class="op" id="3478632">(</span><span class="string" id="3478633">&#34;Cookie&#34;</span><span class="op" id="3478641">,</span>&nbsp;<span class="ident" id="3478643">s</span><span class="op" id="3478644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3478647">}</span><br>
<span class="lineno">270</span><span class="op" id="3478649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3478652">//&nbsp;Referer&nbsp;returns&nbsp;the&nbsp;referring&nbsp;URL,&nbsp;if&nbsp;sent&nbsp;in&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="3478714">//</span><br>
<span class="lineno"></span><span class="comment" id="3478717">//&nbsp;Referer&nbsp;is&nbsp;misspelled&nbsp;as&nbsp;in&nbsp;the&nbsp;request&nbsp;itself,&nbsp;a&nbsp;mistake&nbsp;from&nbsp;the</span><br>
<span class="lineno">275</span><span class="comment" id="3478787">//&nbsp;earliest&nbsp;days&nbsp;of&nbsp;HTTP.&nbsp;&nbsp;This&nbsp;value&nbsp;can&nbsp;also&nbsp;be&nbsp;fetched&nbsp;from&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3478854">//&nbsp;Header&nbsp;map&nbsp;as&nbsp;Header[&#34;Referer&#34;];&nbsp;the&nbsp;benefit&nbsp;of&nbsp;making&nbsp;it&nbsp;available</span><br>
<span class="lineno"></span><span class="comment" id="3478925">//&nbsp;as&nbsp;a&nbsp;method&nbsp;is&nbsp;that&nbsp;the&nbsp;compiler&nbsp;can&nbsp;diagnose&nbsp;programs&nbsp;that&nbsp;use&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3478996">//&nbsp;alternate&nbsp;(correct&nbsp;English)&nbsp;spelling&nbsp;req.Referrer()&nbsp;but&nbsp;cannot</span><br>
<span class="lineno"></span><span class="comment" id="3479062">//&nbsp;diagnose&nbsp;programs&nbsp;that&nbsp;use&nbsp;Header[&#34;Referrer&#34;].</span><br>
<span class="lineno">280</span><span class="keyword" id="3479112">func</span>&nbsp;<span class="op" id="3479117">(</span><span class="ident" id="3479118">r</span>&nbsp;<span class="op" id="3479120">*</span><span class="ident" id="3479121">Request</span><span class="op" id="3479128">)</span>&nbsp;<span class="ident" id="3479130">Referer</span><span class="op" id="3479137">(</span><span class="op" id="3479138">)</span>&nbsp;<span class="builtintype" id="3479140">string</span>&nbsp;<span class="op" id="3479147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3479150">return</span>&nbsp;<span class="ident" id="3479157">r</span><span class="op" id="3479158">.</span><span class="ident" id="3479159">Header</span><span class="op" id="3479165">.</span><span class="ident" id="3479166">Get</span><span class="op" id="3479169">(</span><span class="string" id="3479170">&#34;Referer&#34;</span><span class="op" id="3479179">)</span><br>
<span class="lineno"></span><span class="op" id="3479181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3479184">//&nbsp;multipartByReader&nbsp;is&nbsp;a&nbsp;sentinel&nbsp;value.</span><br>
<span class="lineno">285</span><span class="comment" id="3479226">//&nbsp;Its&nbsp;presence&nbsp;in&nbsp;Request.MultipartForm&nbsp;indicates&nbsp;that&nbsp;parsing&nbsp;of&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span><span class="comment" id="3479305">//&nbsp;body&nbsp;has&nbsp;been&nbsp;handed&nbsp;off&nbsp;to&nbsp;a&nbsp;MultipartReader&nbsp;instead&nbsp;of&nbsp;ParseMultipartFrom.</span><br>
<span class="lineno"></span><span class="keyword" id="3479385">var</span>&nbsp;<span class="ident" id="3479389">multipartByReader</span>&nbsp;<span class="op" id="3479407">=</span>&nbsp;<span class="op" id="3479409">&amp;</span><span class="ident" id="3479410">multipart</span><span class="op" id="3479419">.</span><span class="ident" id="3479420">Form</span><span class="op" id="3479424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3479427">Value</span><span class="op" id="3479432">:</span>&nbsp;<span class="builtinfunc" id="3479434">make</span><span class="op" id="3479438">(</span><span class="keyword" id="3479439">map</span><span class="op" id="3479442">[</span><span class="builtintype" id="3479443">string</span><span class="op" id="3479449">]</span><span class="op" id="3479450">[</span><span class="op" id="3479451">]</span><span class="builtintype" id="3479452">string</span><span class="op" id="3479458">)</span><span class="op" id="3479459">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3479462">File</span><span class="op" id="3479466">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="3479469">make</span><span class="op" id="3479473">(</span><span class="keyword" id="3479474">map</span><span class="op" id="3479477">[</span><span class="builtintype" id="3479478">string</span><span class="op" id="3479484">]</span><span class="op" id="3479485">[</span><span class="op" id="3479486">]</span><span class="op" id="3479487">*</span><span class="ident" id="3479488">multipart</span><span class="op" id="3479497">.</span><span class="ident" id="3479498">FileHeader</span><span class="op" id="3479508">)</span><span class="op" id="3479509">,</span><br>
<span class="lineno">290</span><span class="op" id="3479511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3479514">//&nbsp;MultipartReader&nbsp;returns&nbsp;a&nbsp;MIME&nbsp;multipart&nbsp;reader&nbsp;if&nbsp;this&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3479578">//&nbsp;multipart/form-data&nbsp;POST&nbsp;request,&nbsp;else&nbsp;returns&nbsp;nil&nbsp;and&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3479646">//&nbsp;Use&nbsp;this&nbsp;function&nbsp;instead&nbsp;of&nbsp;ParseMultipartForm&nbsp;to</span><br>
<span class="lineno">295</span><span class="comment" id="3479700">//&nbsp;process&nbsp;the&nbsp;request&nbsp;body&nbsp;as&nbsp;a&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="3479741">func</span>&nbsp;<span class="op" id="3479746">(</span><span class="ident" id="3479747">r</span>&nbsp;<span class="op" id="3479749">*</span><span class="ident" id="3479750">Request</span><span class="op" id="3479757">)</span>&nbsp;<span class="ident" id="3479759">MultipartReader</span><span class="op" id="3479774">(</span><span class="op" id="3479775">)</span>&nbsp;<span class="op" id="3479777">(</span><span class="op" id="3479778">*</span><span class="ident" id="3479779">multipart</span><span class="op" id="3479788">.</span><span class="ident" id="3479789">Reader</span><span class="op" id="3479795">,</span>&nbsp;<span class="builtintype" id="3479797">error</span><span class="op" id="3479802">)</span>&nbsp;<span class="op" id="3479804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3479807">if</span>&nbsp;<span class="ident" id="3479810">r</span><span class="op" id="3479811">.</span><span class="ident" id="3479812">MultipartForm</span>&nbsp;<span class="op" id="3479826">==</span>&nbsp;<span class="ident" id="3479829">multipartByReader</span>&nbsp;<span class="op" id="3479847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3479851">return</span>&nbsp;<span class="ident" id="3479858">nil</span><span class="op" id="3479861">,</span>&nbsp;<span class="ident" id="3479863">errors</span><span class="op" id="3479869">.</span><span class="ident" id="3479870">New</span><span class="op" id="3479873">(</span><span class="string" id="3479874">&#34;http:&nbsp;MultipartReader&nbsp;called&nbsp;twice&#34;</span><span class="op" id="3479910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3479913">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3479916">if</span>&nbsp;<span class="ident" id="3479919">r</span><span class="op" id="3479920">.</span><span class="ident" id="3479921">MultipartForm</span>&nbsp;<span class="op" id="3479935">!=</span>&nbsp;<span class="ident" id="3479938">nil</span>&nbsp;<span class="op" id="3479942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3479946">return</span>&nbsp;<span class="ident" id="3479953">nil</span><span class="op" id="3479956">,</span>&nbsp;<span class="ident" id="3479958">errors</span><span class="op" id="3479964">.</span><span class="ident" id="3479965">New</span><span class="op" id="3479968">(</span><span class="string" id="3479969">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;ParseMultipartForm&#34;</span><span class="op" id="3480016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3480019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3480022">r</span><span class="op" id="3480023">.</span><span class="ident" id="3480024">MultipartForm</span>&nbsp;<span class="op" id="3480038">=</span>&nbsp;<span class="ident" id="3480040">multipartByReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3480059">return</span>&nbsp;<span class="ident" id="3480066">r</span><span class="op" id="3480067">.</span><span class="ident" id="3480068">multipartReader</span><span class="op" id="3480083">(</span><span class="op" id="3480084">)</span><br>
<span class="lineno">305</span><span class="op" id="3480086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3480089">func</span>&nbsp;<span class="op" id="3480094">(</span><span class="ident" id="3480095">r</span>&nbsp;<span class="op" id="3480097">*</span><span class="ident" id="3480098">Request</span><span class="op" id="3480105">)</span>&nbsp;<span class="ident" id="3480107">multipartReader</span><span class="op" id="3480122">(</span><span class="op" id="3480123">)</span>&nbsp;<span class="op" id="3480125">(</span><span class="op" id="3480126">*</span><span class="ident" id="3480127">multipart</span><span class="op" id="3480136">.</span><span class="ident" id="3480137">Reader</span><span class="op" id="3480143">,</span>&nbsp;<span class="builtintype" id="3480145">error</span><span class="op" id="3480150">)</span>&nbsp;<span class="op" id="3480152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3480155">v</span>&nbsp;<span class="op" id="3480157">:=</span>&nbsp;<span class="ident" id="3480160">r</span><span class="op" id="3480161">.</span><span class="ident" id="3480162">Header</span><span class="op" id="3480168">.</span><span class="ident" id="3480169">Get</span><span class="op" id="3480172">(</span><span class="string" id="3480173">&#34;Content-Type&#34;</span><span class="op" id="3480187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3480190">if</span>&nbsp;<span class="ident" id="3480193">v</span>&nbsp;<span class="op" id="3480195">==</span>&nbsp;<span class="string" id="3480198">&#34;&#34;</span>&nbsp;<span class="op" id="3480201">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3480205">return</span>&nbsp;<span class="ident" id="3480212">nil</span><span class="op" id="3480215">,</span>&nbsp;<span class="ident" id="3480217">ErrNotMultipart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3480234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3480237">d</span><span class="op" id="3480238">,</span>&nbsp;<span class="ident" id="3480240">params</span><span class="op" id="3480246">,</span>&nbsp;<span class="ident" id="3480248">err</span>&nbsp;<span class="op" id="3480252">:=</span>&nbsp;<span class="ident" id="3480255">mime</span><span class="op" id="3480259">.</span><span class="ident" id="3480260">ParseMediaType</span><span class="op" id="3480274">(</span><span class="ident" id="3480275">v</span><span class="op" id="3480276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3480279">if</span>&nbsp;<span class="ident" id="3480282">err</span>&nbsp;<span class="op" id="3480286">!=</span>&nbsp;<span class="ident" id="3480289">nil</span>&nbsp;<span class="op" id="3480293">||</span>&nbsp;<span class="ident" id="3480296">d</span>&nbsp;<span class="op" id="3480298">!=</span>&nbsp;<span class="string" id="3480301">&#34;multipart/form-data&#34;</span>&nbsp;<span class="op" id="3480323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3480327">return</span>&nbsp;<span class="ident" id="3480334">nil</span><span class="op" id="3480337">,</span>&nbsp;<span class="ident" id="3480339">ErrNotMultipart</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3480356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3480359">boundary</span><span class="op" id="3480367">,</span>&nbsp;<span class="ident" id="3480369">ok</span>&nbsp;<span class="op" id="3480372">:=</span>&nbsp;<span class="ident" id="3480375">params</span><span class="op" id="3480381">[</span><span class="string" id="3480382">&#34;boundary&#34;</span><span class="op" id="3480392">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3480395">if</span>&nbsp;<span class="op" id="3480398">!</span><span class="ident" id="3480399">ok</span>&nbsp;<span class="op" id="3480402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3480406">return</span>&nbsp;<span class="ident" id="3480413">nil</span><span class="op" id="3480416">,</span>&nbsp;<span class="ident" id="3480418">ErrMissingBoundary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3480438">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3480441">return</span>&nbsp;<span class="ident" id="3480448">multipart</span><span class="op" id="3480457">.</span><span class="ident" id="3480458">NewReader</span><span class="op" id="3480467">(</span><span class="ident" id="3480468">r</span><span class="op" id="3480469">.</span><span class="ident" id="3480470">Body</span><span class="op" id="3480474">,</span>&nbsp;<span class="ident" id="3480476">boundary</span><span class="op" id="3480484">)</span><span class="op" id="3480485">,</span>&nbsp;<span class="ident" id="3480487">nil</span><br>
<span class="lineno"></span><span class="op" id="3480491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3480494">//&nbsp;Return&nbsp;value&nbsp;if&nbsp;nonempty,&nbsp;def&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="3480538">func</span>&nbsp;<span class="ident" id="3480543">valueOrDefault</span><span class="op" id="3480557">(</span><span class="ident" id="3480558">value</span><span class="op" id="3480563">,</span>&nbsp;<span class="ident" id="3480565">def</span>&nbsp;<span class="builtintype" id="3480569">string</span><span class="op" id="3480575">)</span>&nbsp;<span class="builtintype" id="3480577">string</span>&nbsp;<span class="op" id="3480584">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3480587">if</span>&nbsp;<span class="ident" id="3480590">value</span>&nbsp;<span class="op" id="3480596">!=</span>&nbsp;<span class="string" id="3480599">&#34;&#34;</span>&nbsp;<span class="op" id="3480602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3480606">return</span>&nbsp;<span class="ident" id="3480613">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3480620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3480623">return</span>&nbsp;<span class="ident" id="3480630">def</span><br>
<span class="lineno"></span><span class="op" id="3480634">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="3480637">//&nbsp;NOTE:&nbsp;This&nbsp;is&nbsp;not&nbsp;intended&nbsp;to&nbsp;reflect&nbsp;the&nbsp;actual&nbsp;Go&nbsp;version&nbsp;being&nbsp;used.</span><br>
<span class="lineno"></span><span class="comment" id="3480712">//&nbsp;It&nbsp;was&nbsp;changed&nbsp;from&nbsp;&#34;Go&nbsp;http&nbsp;package&#34;&nbsp;to&nbsp;&#34;Go&nbsp;1.1&nbsp;package&nbsp;http&#34;&nbsp;at&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3480785">//&nbsp;time&nbsp;of&nbsp;the&nbsp;Go&nbsp;1.1&nbsp;release&nbsp;because&nbsp;the&nbsp;former&nbsp;User-Agent&nbsp;had&nbsp;ended&nbsp;up</span><br>
<span class="lineno"></span><span class="comment" id="3480858">//&nbsp;on&nbsp;a&nbsp;blacklist&nbsp;for&nbsp;some&nbsp;intrusion&nbsp;detection&nbsp;systems.</span><br>
<span class="lineno">335</span><span class="comment" id="3480914">//&nbsp;See&nbsp;https://codereview.appspot.com/7532043.</span><br>
<span class="lineno"></span><span class="keyword" id="3480961">const</span>&nbsp;<span class="ident" id="3480967">defaultUserAgent</span>&nbsp;<span class="op" id="3480984">=</span>&nbsp;<span class="string" id="3480986">&#34;Go&nbsp;1.1&nbsp;package&nbsp;http&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3481009">//&nbsp;Write&nbsp;writes&nbsp;an&nbsp;HTTP/1.1&nbsp;request&nbsp;--&nbsp;header&nbsp;and&nbsp;body&nbsp;--&nbsp;in&nbsp;wire&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="3481083">//&nbsp;This&nbsp;method&nbsp;consults&nbsp;the&nbsp;following&nbsp;fields&nbsp;of&nbsp;the&nbsp;request:</span><br>
<span class="lineno">340</span><span class="comment" id="3481144">//&nbsp;&nbsp;&nbsp;&nbsp;Host</span><br>
<span class="lineno"></span><span class="comment" id="3481152">//&nbsp;&nbsp;&nbsp;&nbsp;URL</span><br>
<span class="lineno"></span><span class="comment" id="3481159">//&nbsp;&nbsp;&nbsp;&nbsp;Method&nbsp;(defaults&nbsp;to&nbsp;&#34;GET&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3481189">//&nbsp;&nbsp;&nbsp;&nbsp;Header</span><br>
<span class="lineno"></span><span class="comment" id="3481199">//&nbsp;&nbsp;&nbsp;&nbsp;ContentLength</span><br>
<span class="lineno">345</span><span class="comment" id="3481216">//&nbsp;&nbsp;&nbsp;&nbsp;TransferEncoding</span><br>
<span class="lineno"></span><span class="comment" id="3481236">//&nbsp;&nbsp;&nbsp;&nbsp;Body</span><br>
<span class="lineno"></span><span class="comment" id="3481244">//</span><br>
<span class="lineno"></span><span class="comment" id="3481247">//&nbsp;If&nbsp;Body&nbsp;is&nbsp;present,&nbsp;Content-Length&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;and&nbsp;TransferEncoding</span><br>
<span class="lineno"></span><span class="comment" id="3481314">//&nbsp;hasn&#39;t&nbsp;been&nbsp;set&nbsp;to&nbsp;&#34;identity&#34;,&nbsp;Write&nbsp;adds&nbsp;&#34;Transfer-Encoding:</span><br>
<span class="lineno">350</span><span class="comment" id="3481379">//&nbsp;chunked&#34;&nbsp;to&nbsp;the&nbsp;header.&nbsp;Body&nbsp;is&nbsp;closed&nbsp;after&nbsp;it&nbsp;is&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="3481439">func</span>&nbsp;<span class="op" id="3481444">(</span><span class="ident" id="3481445">r</span>&nbsp;<span class="op" id="3481447">*</span><span class="ident" id="3481448">Request</span><span class="op" id="3481455">)</span>&nbsp;<span class="ident" id="3481457">Write</span><span class="op" id="3481462">(</span><span class="ident" id="3481463">w</span>&nbsp;<span class="ident" id="3481465">io</span><span class="op" id="3481467">.</span><span class="ident" id="3481468">Writer</span><span class="op" id="3481474">)</span>&nbsp;<span class="builtintype" id="3481476">error</span>&nbsp;<span class="op" id="3481482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3481485">return</span>&nbsp;<span class="ident" id="3481492">r</span><span class="op" id="3481493">.</span><span class="ident" id="3481494">write</span><span class="op" id="3481499">(</span><span class="ident" id="3481500">w</span><span class="op" id="3481501">,</span>&nbsp;<span class="builtintype" id="3481503">false</span><span class="op" id="3481508">,</span>&nbsp;<span class="ident" id="3481510">nil</span><span class="op" id="3481513">)</span><br>
<span class="lineno"></span><span class="op" id="3481515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="3481518">//&nbsp;WriteProxy&nbsp;is&nbsp;like&nbsp;Write&nbsp;but&nbsp;writes&nbsp;the&nbsp;request&nbsp;in&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3481581">//&nbsp;expected&nbsp;by&nbsp;an&nbsp;HTTP&nbsp;proxy.&nbsp;&nbsp;In&nbsp;particular,&nbsp;WriteProxy&nbsp;writes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3481649">//&nbsp;initial&nbsp;Request-URI&nbsp;line&nbsp;of&nbsp;the&nbsp;request&nbsp;with&nbsp;an&nbsp;absolute&nbsp;URI,&nbsp;per</span><br>
<span class="lineno"></span><span class="comment" id="3481718">//&nbsp;section&nbsp;5.1.2&nbsp;of&nbsp;RFC&nbsp;2616,&nbsp;including&nbsp;the&nbsp;scheme&nbsp;and&nbsp;host.</span><br>
<span class="lineno"></span><span class="comment" id="3481779">//&nbsp;In&nbsp;either&nbsp;case,&nbsp;WriteProxy&nbsp;also&nbsp;writes&nbsp;a&nbsp;Host&nbsp;header,&nbsp;using</span><br>
<span class="lineno">360</span><span class="comment" id="3481842">//&nbsp;either&nbsp;r.Host&nbsp;or&nbsp;r.URL.Host.</span><br>
<span class="lineno"></span><span class="keyword" id="3481874">func</span>&nbsp;<span class="op" id="3481879">(</span><span class="ident" id="3481880">r</span>&nbsp;<span class="op" id="3481882">*</span><span class="ident" id="3481883">Request</span><span class="op" id="3481890">)</span>&nbsp;<span class="ident" id="3481892">WriteProxy</span><span class="op" id="3481902">(</span><span class="ident" id="3481903">w</span>&nbsp;<span class="ident" id="3481905">io</span><span class="op" id="3481907">.</span><span class="ident" id="3481908">Writer</span><span class="op" id="3481914">)</span>&nbsp;<span class="builtintype" id="3481916">error</span>&nbsp;<span class="op" id="3481922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3481925">return</span>&nbsp;<span class="ident" id="3481932">r</span><span class="op" id="3481933">.</span><span class="ident" id="3481934">write</span><span class="op" id="3481939">(</span><span class="ident" id="3481940">w</span><span class="op" id="3481941">,</span>&nbsp;<span class="builtintype" id="3481943">true</span><span class="op" id="3481947">,</span>&nbsp;<span class="ident" id="3481949">nil</span><span class="op" id="3481952">)</span><br>
<span class="lineno"></span><span class="op" id="3481954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="3481957">//&nbsp;extraHeaders&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span><span class="keyword" id="3481984">func</span>&nbsp;<span class="op" id="3481989">(</span><span class="ident" id="3481990">req</span>&nbsp;<span class="op" id="3481994">*</span><span class="ident" id="3481995">Request</span><span class="op" id="3482002">)</span>&nbsp;<span class="ident" id="3482004">write</span><span class="op" id="3482009">(</span><span class="ident" id="3482010">w</span>&nbsp;<span class="ident" id="3482012">io</span><span class="op" id="3482014">.</span><span class="ident" id="3482015">Writer</span><span class="op" id="3482021">,</span>&nbsp;<span class="ident" id="3482023">usingProxy</span>&nbsp;<span class="builtintype" id="3482034">bool</span><span class="op" id="3482038">,</span>&nbsp;<span class="ident" id="3482040">extraHeaders</span>&nbsp;<span class="ident" id="3482053">Header</span><span class="op" id="3482059">)</span>&nbsp;<span class="builtintype" id="3482061">error</span>&nbsp;<span class="op" id="3482067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3482070">host</span>&nbsp;<span class="op" id="3482075">:=</span>&nbsp;<span class="ident" id="3482078">req</span><span class="op" id="3482081">.</span><span class="ident" id="3482082">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3482088">if</span>&nbsp;<span class="ident" id="3482091">host</span>&nbsp;<span class="op" id="3482096">==</span>&nbsp;<span class="string" id="3482099">&#34;&#34;</span>&nbsp;<span class="op" id="3482102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3482106">if</span>&nbsp;<span class="ident" id="3482109">req</span><span class="op" id="3482112">.</span><span class="ident" id="3482113">URL</span>&nbsp;<span class="op" id="3482117">==</span>&nbsp;<span class="ident" id="3482120">nil</span>&nbsp;<span class="op" id="3482124">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3482129">return</span>&nbsp;<span class="ident" id="3482136">errors</span><span class="op" id="3482142">.</span><span class="ident" id="3482143">New</span><span class="op" id="3482146">(</span><span class="string" id="3482147">&#34;http:&nbsp;Request.Write&nbsp;on&nbsp;Request&nbsp;with&nbsp;no&nbsp;Host&nbsp;or&nbsp;URL&nbsp;set&#34;</span><span class="op" id="3482203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3482207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3482211">host</span>&nbsp;<span class="op" id="3482216">=</span>&nbsp;<span class="ident" id="3482218">req</span><span class="op" id="3482221">.</span><span class="ident" id="3482222">URL</span><span class="op" id="3482225">.</span><span class="ident" id="3482226">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3482232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3482236">ruri</span>&nbsp;<span class="op" id="3482241">:=</span>&nbsp;<span class="ident" id="3482244">req</span><span class="op" id="3482247">.</span><span class="ident" id="3482248">URL</span><span class="op" id="3482251">.</span><span class="ident" id="3482252">RequestURI</span><span class="op" id="3482262">(</span><span class="op" id="3482263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3482266">if</span>&nbsp;<span class="ident" id="3482269">usingProxy</span>&nbsp;<span class="op" id="3482280">&amp;&amp;</span>&nbsp;<span class="ident" id="3482283">req</span><span class="op" id="3482286">.</span><span class="ident" id="3482287">URL</span><span class="op" id="3482290">.</span><span class="ident" id="3482291">Scheme</span>&nbsp;<span class="op" id="3482298">!=</span>&nbsp;<span class="string" id="3482301">&#34;&#34;</span>&nbsp;<span class="op" id="3482304">&amp;&amp;</span>&nbsp;<span class="ident" id="3482307">req</span><span class="op" id="3482310">.</span><span class="ident" id="3482311">URL</span><span class="op" id="3482314">.</span><span class="ident" id="3482315">Opaque</span>&nbsp;<span class="op" id="3482322">==</span>&nbsp;<span class="string" id="3482325">&#34;&#34;</span>&nbsp;<span class="op" id="3482328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3482332">ruri</span>&nbsp;<span class="op" id="3482337">=</span>&nbsp;<span class="ident" id="3482339">req</span><span class="op" id="3482342">.</span><span class="ident" id="3482343">URL</span><span class="op" id="3482346">.</span><span class="ident" id="3482347">Scheme</span>&nbsp;<span class="op" id="3482354">+</span>&nbsp;<span class="string" id="3482356">&#34;://&#34;</span>&nbsp;<span class="op" id="3482362">+</span>&nbsp;<span class="ident" id="3482364">host</span>&nbsp;<span class="op" id="3482369">+</span>&nbsp;<span class="ident" id="3482371">ruri</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3482377">}</span>&nbsp;<span class="keyword" id="3482379">else</span>&nbsp;<span class="keyword" id="3482384">if</span>&nbsp;<span class="ident" id="3482387">req</span><span class="op" id="3482390">.</span><span class="ident" id="3482391">Method</span>&nbsp;<span class="op" id="3482398">==</span>&nbsp;<span class="string" id="3482401">&#34;CONNECT&#34;</span>&nbsp;<span class="op" id="3482411">&amp;&amp;</span>&nbsp;<span class="ident" id="3482414">req</span><span class="op" id="3482417">.</span><span class="ident" id="3482418">URL</span><span class="op" id="3482421">.</span><span class="ident" id="3482422">Path</span>&nbsp;<span class="op" id="3482427">==</span>&nbsp;<span class="string" id="3482430">&#34;&#34;</span>&nbsp;<span class="op" id="3482433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3482437">//&nbsp;CONNECT&nbsp;requests&nbsp;normally&nbsp;give&nbsp;just&nbsp;the&nbsp;host&nbsp;and&nbsp;port,&nbsp;not&nbsp;a&nbsp;full&nbsp;URL.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3482513">ruri</span>&nbsp;<span class="op" id="3482518">=</span>&nbsp;<span class="ident" id="3482520">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3482526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3482529">//&nbsp;TODO(bradfitz):&nbsp;escape&nbsp;at&nbsp;least&nbsp;newlines&nbsp;in&nbsp;ruri?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3482584">//&nbsp;Wrap&nbsp;the&nbsp;writer&nbsp;in&nbsp;a&nbsp;bufio&nbsp;Writer&nbsp;if&nbsp;it&#39;s&nbsp;not&nbsp;already&nbsp;buffered.</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3482652">//&nbsp;Don&#39;t&nbsp;always&nbsp;call&nbsp;NewWriter,&nbsp;as&nbsp;that&nbsp;forces&nbsp;a&nbsp;bytes.Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3482715">//&nbsp;and&nbsp;other&nbsp;small&nbsp;bufio&nbsp;Writers&nbsp;to&nbsp;have&nbsp;a&nbsp;minimum&nbsp;4k&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3482777">//&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3482787">var</span>&nbsp;<span class="ident" id="3482791">bw</span>&nbsp;<span class="op" id="3482794">*</span><span class="ident" id="3482795">bufio</span><span class="op" id="3482800">.</span><span class="ident" id="3482801">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3482809">if</span>&nbsp;<span class="ident" id="3482812">_</span><span class="op" id="3482813">,</span>&nbsp;<span class="ident" id="3482815">ok</span>&nbsp;<span class="op" id="3482818">:=</span>&nbsp;<span class="ident" id="3482821">w</span><span class="op" id="3482822">.</span><span class="op" id="3482823">(</span><span class="ident" id="3482824">io</span><span class="op" id="3482826">.</span><span class="ident" id="3482827">ByteWriter</span><span class="op" id="3482837">)</span><span class="op" id="3482838">;</span>&nbsp;<span class="op" id="3482840">!</span><span class="ident" id="3482841">ok</span>&nbsp;<span class="op" id="3482844">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3482848">bw</span>&nbsp;<span class="op" id="3482851">=</span>&nbsp;<span class="ident" id="3482853">bufio</span><span class="op" id="3482858">.</span><span class="ident" id="3482859">NewWriter</span><span class="op" id="3482868">(</span><span class="ident" id="3482869">w</span><span class="op" id="3482870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3482874">w</span>&nbsp;<span class="op" id="3482876">=</span>&nbsp;<span class="ident" id="3482878">bw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3482882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3482886">_</span><span class="op" id="3482887">,</span>&nbsp;<span class="ident" id="3482889">err</span>&nbsp;<span class="op" id="3482893">:=</span>&nbsp;<span class="ident" id="3482896">fmt</span><span class="op" id="3482899">.</span><span class="ident" id="3482900">Fprintf</span><span class="op" id="3482907">(</span><span class="ident" id="3482908">w</span><span class="op" id="3482909">,</span>&nbsp;<span class="string" id="3482911">&#34;%s&nbsp;%s&nbsp;HTTP/1.1\r\n&#34;</span><span class="op" id="3482931">,</span>&nbsp;<span class="ident" id="3482933">valueOrDefault</span><span class="op" id="3482947">(</span><span class="ident" id="3482948">req</span><span class="op" id="3482951">.</span><span class="ident" id="3482952">Method</span><span class="op" id="3482958">,</span>&nbsp;<span class="string" id="3482960">&#34;GET&#34;</span><span class="op" id="3482965">)</span><span class="op" id="3482966">,</span>&nbsp;<span class="ident" id="3482968">ruri</span><span class="op" id="3482972">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3482975">if</span>&nbsp;<span class="ident" id="3482978">err</span>&nbsp;<span class="op" id="3482982">!=</span>&nbsp;<span class="ident" id="3482985">nil</span>&nbsp;<span class="op" id="3482989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3482993">return</span>&nbsp;<span class="ident" id="3483000">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3483005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3483009">//&nbsp;Header&nbsp;lines</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3483026">_</span><span class="op" id="3483027">,</span>&nbsp;<span class="ident" id="3483029">err</span>&nbsp;<span class="op" id="3483033">=</span>&nbsp;<span class="ident" id="3483035">fmt</span><span class="op" id="3483038">.</span><span class="ident" id="3483039">Fprintf</span><span class="op" id="3483046">(</span><span class="ident" id="3483047">w</span><span class="op" id="3483048">,</span>&nbsp;<span class="string" id="3483050">&#34;Host:&nbsp;%s\r\n&#34;</span><span class="op" id="3483064">,</span>&nbsp;<span class="ident" id="3483066">host</span><span class="op" id="3483070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483073">if</span>&nbsp;<span class="ident" id="3483076">err</span>&nbsp;<span class="op" id="3483080">!=</span>&nbsp;<span class="ident" id="3483083">nil</span>&nbsp;<span class="op" id="3483087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483091">return</span>&nbsp;<span class="ident" id="3483098">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3483103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3483107">//&nbsp;Use&nbsp;the&nbsp;defaultUserAgent&nbsp;unless&nbsp;the&nbsp;Header&nbsp;contains&nbsp;one,&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3483174">//&nbsp;may&nbsp;be&nbsp;blank&nbsp;to&nbsp;not&nbsp;send&nbsp;the&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3483215">userAgent</span>&nbsp;<span class="op" id="3483225">:=</span>&nbsp;<span class="ident" id="3483228">defaultUserAgent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483246">if</span>&nbsp;<span class="ident" id="3483249">req</span><span class="op" id="3483252">.</span><span class="ident" id="3483253">Header</span>&nbsp;<span class="op" id="3483260">!=</span>&nbsp;<span class="ident" id="3483263">nil</span>&nbsp;<span class="op" id="3483267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483271">if</span>&nbsp;<span class="ident" id="3483274">ua</span>&nbsp;<span class="op" id="3483277">:=</span>&nbsp;<span class="ident" id="3483280">req</span><span class="op" id="3483283">.</span><span class="ident" id="3483284">Header</span><span class="op" id="3483290">[</span><span class="string" id="3483291">&#34;User-Agent&#34;</span><span class="op" id="3483303">]</span><span class="op" id="3483304">;</span>&nbsp;<span class="builtinfunc" id="3483306">len</span><span class="op" id="3483309">(</span><span class="ident" id="3483310">ua</span><span class="op" id="3483312">)</span>&nbsp;<span class="op" id="3483314">&gt;</span>&nbsp;<span class="num" id="3483316">0</span>&nbsp;<span class="op" id="3483318">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3483323">userAgent</span>&nbsp;<span class="op" id="3483333">=</span>&nbsp;<span class="ident" id="3483335">ua</span><span class="op" id="3483337">[</span><span class="num" id="3483338">0</span><span class="op" id="3483339">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3483343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3483346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483349">if</span>&nbsp;<span class="ident" id="3483352">userAgent</span>&nbsp;<span class="op" id="3483362">!=</span>&nbsp;<span class="string" id="3483365">&#34;&#34;</span>&nbsp;<span class="op" id="3483368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3483372">_</span><span class="op" id="3483373">,</span>&nbsp;<span class="ident" id="3483375">err</span>&nbsp;<span class="op" id="3483379">=</span>&nbsp;<span class="ident" id="3483381">fmt</span><span class="op" id="3483384">.</span><span class="ident" id="3483385">Fprintf</span><span class="op" id="3483392">(</span><span class="ident" id="3483393">w</span><span class="op" id="3483394">,</span>&nbsp;<span class="string" id="3483396">&#34;User-Agent:&nbsp;%s\r\n&#34;</span><span class="op" id="3483416">,</span>&nbsp;<span class="ident" id="3483418">userAgent</span><span class="op" id="3483427">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483431">if</span>&nbsp;<span class="ident" id="3483434">err</span>&nbsp;<span class="op" id="3483438">!=</span>&nbsp;<span class="ident" id="3483441">nil</span>&nbsp;<span class="op" id="3483445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483450">return</span>&nbsp;<span class="ident" id="3483457">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3483463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3483466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3483470">//&nbsp;Process&nbsp;Body,ContentLength,Close,Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3483515">tw</span><span class="op" id="3483517">,</span>&nbsp;<span class="ident" id="3483519">err</span>&nbsp;<span class="op" id="3483523">:=</span>&nbsp;<span class="ident" id="3483526">newTransferWriter</span><span class="op" id="3483543">(</span><span class="ident" id="3483544">req</span><span class="op" id="3483547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483550">if</span>&nbsp;<span class="ident" id="3483553">err</span>&nbsp;<span class="op" id="3483557">!=</span>&nbsp;<span class="ident" id="3483560">nil</span>&nbsp;<span class="op" id="3483564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483568">return</span>&nbsp;<span class="ident" id="3483575">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3483580">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3483583">err</span>&nbsp;<span class="op" id="3483587">=</span>&nbsp;<span class="ident" id="3483589">tw</span><span class="op" id="3483591">.</span><span class="ident" id="3483592">WriteHeader</span><span class="op" id="3483603">(</span><span class="ident" id="3483604">w</span><span class="op" id="3483605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483608">if</span>&nbsp;<span class="ident" id="3483611">err</span>&nbsp;<span class="op" id="3483615">!=</span>&nbsp;<span class="ident" id="3483618">nil</span>&nbsp;<span class="op" id="3483622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483626">return</span>&nbsp;<span class="ident" id="3483633">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3483638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3483642">err</span>&nbsp;<span class="op" id="3483646">=</span>&nbsp;<span class="ident" id="3483648">req</span><span class="op" id="3483651">.</span><span class="ident" id="3483652">Header</span><span class="op" id="3483658">.</span><span class="ident" id="3483659">WriteSubset</span><span class="op" id="3483670">(</span><span class="ident" id="3483671">w</span><span class="op" id="3483672">,</span>&nbsp;<span class="ident" id="3483674">reqWriteExcludeHeader</span><span class="op" id="3483695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483698">if</span>&nbsp;<span class="ident" id="3483701">err</span>&nbsp;<span class="op" id="3483705">!=</span>&nbsp;<span class="ident" id="3483708">nil</span>&nbsp;<span class="op" id="3483712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483716">return</span>&nbsp;<span class="ident" id="3483723">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3483728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483732">if</span>&nbsp;<span class="ident" id="3483735">extraHeaders</span>&nbsp;<span class="op" id="3483748">!=</span>&nbsp;<span class="ident" id="3483751">nil</span>&nbsp;<span class="op" id="3483755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3483759">err</span>&nbsp;<span class="op" id="3483763">=</span>&nbsp;<span class="ident" id="3483765">extraHeaders</span><span class="op" id="3483777">.</span><span class="ident" id="3483778">Write</span><span class="op" id="3483783">(</span><span class="ident" id="3483784">w</span><span class="op" id="3483785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483789">if</span>&nbsp;<span class="ident" id="3483792">err</span>&nbsp;<span class="op" id="3483796">!=</span>&nbsp;<span class="ident" id="3483799">nil</span>&nbsp;<span class="op" id="3483803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483808">return</span>&nbsp;<span class="ident" id="3483815">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3483821">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3483824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3483828">_</span><span class="op" id="3483829">,</span>&nbsp;<span class="ident" id="3483831">err</span>&nbsp;<span class="op" id="3483835">=</span>&nbsp;<span class="ident" id="3483837">io</span><span class="op" id="3483839">.</span><span class="ident" id="3483840">WriteString</span><span class="op" id="3483851">(</span><span class="ident" id="3483852">w</span><span class="op" id="3483853">,</span>&nbsp;<span class="string" id="3483855">&#34;\r\n&#34;</span><span class="op" id="3483861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483864">if</span>&nbsp;<span class="ident" id="3483867">err</span>&nbsp;<span class="op" id="3483871">!=</span>&nbsp;<span class="ident" id="3483874">nil</span>&nbsp;<span class="op" id="3483878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483882">return</span>&nbsp;<span class="ident" id="3483889">err</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3483894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3483898">//&nbsp;Write&nbsp;body&nbsp;and&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3483925">err</span>&nbsp;<span class="op" id="3483929">=</span>&nbsp;<span class="ident" id="3483931">tw</span><span class="op" id="3483933">.</span><span class="ident" id="3483934">WriteBody</span><span class="op" id="3483943">(</span><span class="ident" id="3483944">w</span><span class="op" id="3483945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483948">if</span>&nbsp;<span class="ident" id="3483951">err</span>&nbsp;<span class="op" id="3483955">!=</span>&nbsp;<span class="ident" id="3483958">nil</span>&nbsp;<span class="op" id="3483962">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483966">return</span>&nbsp;<span class="ident" id="3483973">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3483978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483982">if</span>&nbsp;<span class="ident" id="3483985">bw</span>&nbsp;<span class="op" id="3483988">!=</span>&nbsp;<span class="ident" id="3483991">nil</span>&nbsp;<span class="op" id="3483995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483999">return</span>&nbsp;<span class="ident" id="3484006">bw</span><span class="op" id="3484008">.</span><span class="ident" id="3484009">Flush</span><span class="op" id="3484014">(</span><span class="op" id="3484015">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3484018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484021">return</span>&nbsp;<span class="ident" id="3484028">nil</span><br>
<span class="lineno"></span><span class="op" id="3484032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3484035">//&nbsp;ParseHTTPVersion&nbsp;parses&nbsp;a&nbsp;HTTP&nbsp;version&nbsp;string.</span><br>
<span class="lineno">460</span><span class="comment" id="3484085">//&nbsp;&#34;HTTP/1.0&#34;&nbsp;returns&nbsp;(1,&nbsp;0,&nbsp;true).</span><br>
<span class="lineno"></span><span class="keyword" id="3484121">func</span>&nbsp;<span class="ident" id="3484126">ParseHTTPVersion</span><span class="op" id="3484142">(</span><span class="ident" id="3484143">vers</span>&nbsp;<span class="builtintype" id="3484148">string</span><span class="op" id="3484154">)</span>&nbsp;<span class="op" id="3484156">(</span><span class="ident" id="3484157">major</span><span class="op" id="3484162">,</span>&nbsp;<span class="ident" id="3484164">minor</span>&nbsp;<span class="builtintype" id="3484170">int</span><span class="op" id="3484173">,</span>&nbsp;<span class="ident" id="3484175">ok</span>&nbsp;<span class="builtintype" id="3484178">bool</span><span class="op" id="3484182">)</span>&nbsp;<span class="op" id="3484184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484187">const</span>&nbsp;<span class="ident" id="3484193">Big</span>&nbsp;<span class="op" id="3484197">=</span>&nbsp;<span class="num" id="3484199">1000000</span>&nbsp;<span class="comment" id="3484207">//&nbsp;arbitrary&nbsp;upper&nbsp;bound</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484233">switch</span>&nbsp;<span class="ident" id="3484240">vers</span>&nbsp;<span class="op" id="3484245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484248">case</span>&nbsp;<span class="string" id="3484253">&#34;HTTP/1.1&#34;</span><span class="op" id="3484263">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484267">return</span>&nbsp;<span class="num" id="3484274">1</span><span class="op" id="3484275">,</span>&nbsp;<span class="num" id="3484277">1</span><span class="op" id="3484278">,</span>&nbsp;<span class="builtintype" id="3484280">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484286">case</span>&nbsp;<span class="string" id="3484291">&#34;HTTP/1.0&#34;</span><span class="op" id="3484301">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484305">return</span>&nbsp;<span class="num" id="3484312">1</span><span class="op" id="3484313">,</span>&nbsp;<span class="num" id="3484315">0</span><span class="op" id="3484316">,</span>&nbsp;<span class="builtintype" id="3484318">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3484324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484327">if</span>&nbsp;<span class="op" id="3484330">!</span><span class="ident" id="3484331">strings</span><span class="op" id="3484338">.</span><span class="ident" id="3484339">HasPrefix</span><span class="op" id="3484348">(</span><span class="ident" id="3484349">vers</span><span class="op" id="3484353">,</span>&nbsp;<span class="string" id="3484355">&#34;HTTP/&#34;</span><span class="op" id="3484362">)</span>&nbsp;<span class="op" id="3484364">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484368">return</span>&nbsp;<span class="num" id="3484375">0</span><span class="op" id="3484376">,</span>&nbsp;<span class="num" id="3484378">0</span><span class="op" id="3484379">,</span>&nbsp;<span class="builtintype" id="3484381">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3484388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3484391">dot</span>&nbsp;<span class="op" id="3484395">:=</span>&nbsp;<span class="ident" id="3484398">strings</span><span class="op" id="3484405">.</span><span class="ident" id="3484406">Index</span><span class="op" id="3484411">(</span><span class="ident" id="3484412">vers</span><span class="op" id="3484416">,</span>&nbsp;<span class="string" id="3484418">&#34;.&#34;</span><span class="op" id="3484421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484424">if</span>&nbsp;<span class="ident" id="3484427">dot</span>&nbsp;<span class="op" id="3484431">&lt;</span>&nbsp;<span class="num" id="3484433">0</span>&nbsp;<span class="op" id="3484435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484439">return</span>&nbsp;<span class="num" id="3484446">0</span><span class="op" id="3484447">,</span>&nbsp;<span class="num" id="3484449">0</span><span class="op" id="3484450">,</span>&nbsp;<span class="builtintype" id="3484452">false</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3484459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3484462">major</span><span class="op" id="3484467">,</span>&nbsp;<span class="ident" id="3484469">err</span>&nbsp;<span class="op" id="3484473">:=</span>&nbsp;<span class="ident" id="3484476">strconv</span><span class="op" id="3484483">.</span><span class="ident" id="3484484">Atoi</span><span class="op" id="3484488">(</span><span class="ident" id="3484489">vers</span><span class="op" id="3484493">[</span><span class="num" id="3484494">5</span><span class="op" id="3484495">:</span><span class="ident" id="3484496">dot</span><span class="op" id="3484499">]</span><span class="op" id="3484500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484503">if</span>&nbsp;<span class="ident" id="3484506">err</span>&nbsp;<span class="op" id="3484510">!=</span>&nbsp;<span class="ident" id="3484513">nil</span>&nbsp;<span class="op" id="3484517">||</span>&nbsp;<span class="ident" id="3484520">major</span>&nbsp;<span class="op" id="3484526">&lt;</span>&nbsp;<span class="num" id="3484528">0</span>&nbsp;<span class="op" id="3484530">||</span>&nbsp;<span class="ident" id="3484533">major</span>&nbsp;<span class="op" id="3484539">&gt;</span>&nbsp;<span class="ident" id="3484541">Big</span>&nbsp;<span class="op" id="3484545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484549">return</span>&nbsp;<span class="num" id="3484556">0</span><span class="op" id="3484557">,</span>&nbsp;<span class="num" id="3484559">0</span><span class="op" id="3484560">,</span>&nbsp;<span class="builtintype" id="3484562">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3484569">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3484572">minor</span><span class="op" id="3484577">,</span>&nbsp;<span class="ident" id="3484579">err</span>&nbsp;<span class="op" id="3484583">=</span>&nbsp;<span class="ident" id="3484585">strconv</span><span class="op" id="3484592">.</span><span class="ident" id="3484593">Atoi</span><span class="op" id="3484597">(</span><span class="ident" id="3484598">vers</span><span class="op" id="3484602">[</span><span class="ident" id="3484603">dot</span><span class="op" id="3484606">+</span><span class="num" id="3484607">1</span><span class="op" id="3484608">:</span><span class="op" id="3484609">]</span><span class="op" id="3484610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484613">if</span>&nbsp;<span class="ident" id="3484616">err</span>&nbsp;<span class="op" id="3484620">!=</span>&nbsp;<span class="ident" id="3484623">nil</span>&nbsp;<span class="op" id="3484627">||</span>&nbsp;<span class="ident" id="3484630">minor</span>&nbsp;<span class="op" id="3484636">&lt;</span>&nbsp;<span class="num" id="3484638">0</span>&nbsp;<span class="op" id="3484640">||</span>&nbsp;<span class="ident" id="3484643">minor</span>&nbsp;<span class="op" id="3484649">&gt;</span>&nbsp;<span class="ident" id="3484651">Big</span>&nbsp;<span class="op" id="3484655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484659">return</span>&nbsp;<span class="num" id="3484666">0</span><span class="op" id="3484667">,</span>&nbsp;<span class="num" id="3484669">0</span><span class="op" id="3484670">,</span>&nbsp;<span class="builtintype" id="3484672">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3484679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484682">return</span>&nbsp;<span class="ident" id="3484689">major</span><span class="op" id="3484694">,</span>&nbsp;<span class="ident" id="3484696">minor</span><span class="op" id="3484701">,</span>&nbsp;<span class="builtintype" id="3484703">true</span><br>
<span class="lineno">485</span><span class="op" id="3484708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3484711">//&nbsp;NewRequest&nbsp;returns&nbsp;a&nbsp;new&nbsp;Request&nbsp;given&nbsp;a&nbsp;method,&nbsp;URL,&nbsp;and&nbsp;optional&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="3484787">//</span><br>
<span class="lineno"></span><span class="comment" id="3484790">//&nbsp;If&nbsp;the&nbsp;provided&nbsp;body&nbsp;is&nbsp;also&nbsp;an&nbsp;io.Closer,&nbsp;the&nbsp;returned</span><br>
<span class="lineno">490</span><span class="comment" id="3484849">//&nbsp;Request.Body&nbsp;is&nbsp;set&nbsp;to&nbsp;body&nbsp;and&nbsp;will&nbsp;be&nbsp;closed&nbsp;by&nbsp;the&nbsp;Client</span><br>
<span class="lineno"></span><span class="comment" id="3484913">//&nbsp;methods&nbsp;Do,&nbsp;Post,&nbsp;and&nbsp;PostForm,&nbsp;and&nbsp;Transport.RoundTrip.</span><br>
<span class="lineno"></span><span class="keyword" id="3484973">func</span>&nbsp;<span class="ident" id="3484978">NewRequest</span><span class="op" id="3484988">(</span><span class="ident" id="3484989">method</span><span class="op" id="3484995">,</span>&nbsp;<span class="ident" id="3484997">urlStr</span>&nbsp;<span class="builtintype" id="3485004">string</span><span class="op" id="3485010">,</span>&nbsp;<span class="ident" id="3485012">body</span>&nbsp;<span class="ident" id="3485017">io</span><span class="op" id="3485019">.</span><span class="ident" id="3485020">Reader</span><span class="op" id="3485026">)</span>&nbsp;<span class="op" id="3485028">(</span><span class="op" id="3485029">*</span><span class="ident" id="3485030">Request</span><span class="op" id="3485037">,</span>&nbsp;<span class="builtintype" id="3485039">error</span><span class="op" id="3485044">)</span>&nbsp;<span class="op" id="3485046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3485049">u</span><span class="op" id="3485050">,</span>&nbsp;<span class="ident" id="3485052">err</span>&nbsp;<span class="op" id="3485056">:=</span>&nbsp;<span class="ident" id="3485059">url</span><span class="op" id="3485062">.</span><span class="ident" id="3485063">Parse</span><span class="op" id="3485068">(</span><span class="ident" id="3485069">urlStr</span><span class="op" id="3485075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3485078">if</span>&nbsp;<span class="ident" id="3485081">err</span>&nbsp;<span class="op" id="3485085">!=</span>&nbsp;<span class="ident" id="3485088">nil</span>&nbsp;<span class="op" id="3485092">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3485096">return</span>&nbsp;<span class="ident" id="3485103">nil</span><span class="op" id="3485106">,</span>&nbsp;<span class="ident" id="3485108">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3485113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3485116">rc</span><span class="op" id="3485118">,</span>&nbsp;<span class="ident" id="3485120">ok</span>&nbsp;<span class="op" id="3485123">:=</span>&nbsp;<span class="ident" id="3485126">body</span><span class="op" id="3485130">.</span><span class="op" id="3485131">(</span><span class="ident" id="3485132">io</span><span class="op" id="3485134">.</span><span class="ident" id="3485135">ReadCloser</span><span class="op" id="3485145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3485148">if</span>&nbsp;<span class="op" id="3485151">!</span><span class="ident" id="3485152">ok</span>&nbsp;<span class="op" id="3485155">&amp;&amp;</span>&nbsp;<span class="ident" id="3485158">body</span>&nbsp;<span class="op" id="3485163">!=</span>&nbsp;<span class="ident" id="3485166">nil</span>&nbsp;<span class="op" id="3485170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3485174">rc</span>&nbsp;<span class="op" id="3485177">=</span>&nbsp;<span class="ident" id="3485179">ioutil</span><span class="op" id="3485185">.</span><span class="ident" id="3485186">NopCloser</span><span class="op" id="3485195">(</span><span class="ident" id="3485196">body</span><span class="op" id="3485200">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3485203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3485206">req</span>&nbsp;<span class="op" id="3485210">:=</span>&nbsp;<span class="op" id="3485213">&amp;</span><span class="ident" id="3485214">Request</span><span class="op" id="3485221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3485225">Method</span><span class="op" id="3485231">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3485237">method</span><span class="op" id="3485243">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3485247">URL</span><span class="op" id="3485250">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3485259">u</span><span class="op" id="3485260">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3485264">Proto</span><span class="op" id="3485269">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3485276">&#34;HTTP/1.1&#34;</span><span class="op" id="3485286">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3485290">ProtoMajor</span><span class="op" id="3485300">:</span>&nbsp;<span class="num" id="3485302">1</span><span class="op" id="3485303">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3485307">ProtoMinor</span><span class="op" id="3485317">:</span>&nbsp;<span class="num" id="3485319">1</span><span class="op" id="3485320">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3485324">Header</span><span class="op" id="3485330">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3485336">make</span><span class="op" id="3485340">(</span><span class="ident" id="3485341">Header</span><span class="op" id="3485347">)</span><span class="op" id="3485348">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3485352">Body</span><span class="op" id="3485356">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3485364">rc</span><span class="op" id="3485366">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3485370">Host</span><span class="op" id="3485374">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3485382">u</span><span class="op" id="3485383">.</span><span class="ident" id="3485384">Host</span><span class="op" id="3485388">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3485391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3485394">if</span>&nbsp;<span class="ident" id="3485397">body</span>&nbsp;<span class="op" id="3485402">!=</span>&nbsp;<span class="ident" id="3485405">nil</span>&nbsp;<span class="op" id="3485409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3485413">switch</span>&nbsp;<span class="ident" id="3485420">v</span>&nbsp;<span class="op" id="3485422">:=</span>&nbsp;<span class="ident" id="3485425">body</span><span class="op" id="3485429">.</span><span class="op" id="3485430">(</span><span class="keyword" id="3485431">type</span><span class="op" id="3485435">)</span>&nbsp;<span class="op" id="3485437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3485441">case</span>&nbsp;<span class="op" id="3485446">*</span><span class="ident" id="3485447">bytes</span><span class="op" id="3485452">.</span><span class="ident" id="3485453">Buffer</span><span class="op" id="3485459">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3485464">req</span><span class="op" id="3485467">.</span><span class="ident" id="3485468">ContentLength</span>&nbsp;<span class="op" id="3485482">=</span>&nbsp;<span class="ident" id="3485484">int64</span><span class="op" id="3485489">(</span><span class="ident" id="3485490">v</span><span class="op" id="3485491">.</span><span class="ident" id="3485492">Len</span><span class="op" id="3485495">(</span><span class="op" id="3485496">)</span><span class="op" id="3485497">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3485501">case</span>&nbsp;<span class="op" id="3485506">*</span><span class="ident" id="3485507">bytes</span><span class="op" id="3485512">.</span><span class="ident" id="3485513">Reader</span><span class="op" id="3485519">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3485524">req</span><span class="op" id="3485527">.</span><span class="ident" id="3485528">ContentLength</span>&nbsp;<span class="op" id="3485542">=</span>&nbsp;<span class="ident" id="3485544">int64</span><span class="op" id="3485549">(</span><span class="ident" id="3485550">v</span><span class="op" id="3485551">.</span><span class="ident" id="3485552">Len</span><span class="op" id="3485555">(</span><span class="op" id="3485556">)</span><span class="op" id="3485557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3485561">case</span>&nbsp;<span class="op" id="3485566">*</span><span class="ident" id="3485567">strings</span><span class="op" id="3485574">.</span><span class="ident" id="3485575">Reader</span><span class="op" id="3485581">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3485586">req</span><span class="op" id="3485589">.</span><span class="ident" id="3485590">ContentLength</span>&nbsp;<span class="op" id="3485604">=</span>&nbsp;<span class="ident" id="3485606">int64</span><span class="op" id="3485611">(</span><span class="ident" id="3485612">v</span><span class="op" id="3485613">.</span><span class="ident" id="3485614">Len</span><span class="op" id="3485617">(</span><span class="op" id="3485618">)</span><span class="op" id="3485619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3485623">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3485626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3485630">return</span>&nbsp;<span class="ident" id="3485637">req</span><span class="op" id="3485640">,</span>&nbsp;<span class="ident" id="3485642">nil</span><br>
<span class="lineno"></span><span class="op" id="3485646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="comment" id="3485649">//&nbsp;BasicAuth&nbsp;returns&nbsp;the&nbsp;username&nbsp;and&nbsp;password&nbsp;provided&nbsp;in&nbsp;the&nbsp;request&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3485722">//&nbsp;Authorization&nbsp;header,&nbsp;if&nbsp;the&nbsp;request&nbsp;uses&nbsp;HTTP&nbsp;Basic&nbsp;Authentication.</span><br>
<span class="lineno"></span><span class="comment" id="3485794">//&nbsp;See&nbsp;RFC&nbsp;2617,&nbsp;Section&nbsp;2.</span><br>
<span class="lineno"></span><span class="keyword" id="3485822">func</span>&nbsp;<span class="op" id="3485827">(</span><span class="ident" id="3485828">r</span>&nbsp;<span class="op" id="3485830">*</span><span class="ident" id="3485831">Request</span><span class="op" id="3485838">)</span>&nbsp;<span class="ident" id="3485840">BasicAuth</span><span class="op" id="3485849">(</span><span class="op" id="3485850">)</span>&nbsp;<span class="op" id="3485852">(</span><span class="ident" id="3485853">username</span><span class="op" id="3485861">,</span>&nbsp;<span class="ident" id="3485863">password</span>&nbsp;<span class="builtintype" id="3485872">string</span><span class="op" id="3485878">,</span>&nbsp;<span class="ident" id="3485880">ok</span>&nbsp;<span class="builtintype" id="3485883">bool</span><span class="op" id="3485887">)</span>&nbsp;<span class="op" id="3485889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3485892">auth</span>&nbsp;<span class="op" id="3485897">:=</span>&nbsp;<span class="ident" id="3485900">r</span><span class="op" id="3485901">.</span><span class="ident" id="3485902">Header</span><span class="op" id="3485908">.</span><span class="ident" id="3485909">Get</span><span class="op" id="3485912">(</span><span class="string" id="3485913">&#34;Authorization&#34;</span><span class="op" id="3485928">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3485931">if</span>&nbsp;<span class="ident" id="3485934">auth</span>&nbsp;<span class="op" id="3485939">==</span>&nbsp;<span class="string" id="3485942">&#34;&#34;</span>&nbsp;<span class="op" id="3485945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3485949">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3485957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3485960">return</span>&nbsp;<span class="ident" id="3485967">parseBasicAuth</span><span class="op" id="3485981">(</span><span class="ident" id="3485982">auth</span><span class="op" id="3485986">)</span><br>
<span class="lineno"></span><span class="op" id="3485988">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span><span class="comment" id="3485991">//&nbsp;parseBasicAuth&nbsp;parses&nbsp;an&nbsp;HTTP&nbsp;Basic&nbsp;Authentication&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="3486053">//&nbsp;&#34;Basic&nbsp;QWxhZGRpbjpvcGVuIHNlc2FtZQ==&#34;&nbsp;returns&nbsp;(&#34;Aladdin&#34;,&nbsp;&#34;open&nbsp;sesame&#34;,&nbsp;true).</span><br>
<span class="lineno"></span><span class="keyword" id="3486135">func</span>&nbsp;<span class="ident" id="3486140">parseBasicAuth</span><span class="op" id="3486154">(</span><span class="ident" id="3486155">auth</span>&nbsp;<span class="builtintype" id="3486160">string</span><span class="op" id="3486166">)</span>&nbsp;<span class="op" id="3486168">(</span><span class="ident" id="3486169">username</span><span class="op" id="3486177">,</span>&nbsp;<span class="ident" id="3486179">password</span>&nbsp;<span class="builtintype" id="3486188">string</span><span class="op" id="3486194">,</span>&nbsp;<span class="ident" id="3486196">ok</span>&nbsp;<span class="builtintype" id="3486199">bool</span><span class="op" id="3486203">)</span>&nbsp;<span class="op" id="3486205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3486208">if</span>&nbsp;<span class="op" id="3486211">!</span><span class="ident" id="3486212">strings</span><span class="op" id="3486219">.</span><span class="ident" id="3486220">HasPrefix</span><span class="op" id="3486229">(</span><span class="ident" id="3486230">auth</span><span class="op" id="3486234">,</span>&nbsp;<span class="string" id="3486236">&#34;Basic&nbsp;&#34;</span><span class="op" id="3486244">)</span>&nbsp;<span class="op" id="3486246">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3486250">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3486258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3486261">c</span><span class="op" id="3486262">,</span>&nbsp;<span class="ident" id="3486264">err</span>&nbsp;<span class="op" id="3486268">:=</span>&nbsp;<span class="ident" id="3486271">base64</span><span class="op" id="3486277">.</span><span class="ident" id="3486278">StdEncoding</span><span class="op" id="3486289">.</span><span class="ident" id="3486290">DecodeString</span><span class="op" id="3486302">(</span><span class="ident" id="3486303">strings</span><span class="op" id="3486310">.</span><span class="ident" id="3486311">TrimPrefix</span><span class="op" id="3486321">(</span><span class="ident" id="3486322">auth</span><span class="op" id="3486326">,</span>&nbsp;<span class="string" id="3486328">&#34;Basic&nbsp;&#34;</span><span class="op" id="3486336">)</span><span class="op" id="3486337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3486340">if</span>&nbsp;<span class="ident" id="3486343">err</span>&nbsp;<span class="op" id="3486347">!=</span>&nbsp;<span class="ident" id="3486350">nil</span>&nbsp;<span class="op" id="3486354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3486358">return</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3486366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3486369">cs</span>&nbsp;<span class="op" id="3486372">:=</span>&nbsp;<span class="builtintype" id="3486375">string</span><span class="op" id="3486381">(</span><span class="ident" id="3486382">c</span><span class="op" id="3486383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3486386">s</span>&nbsp;<span class="op" id="3486388">:=</span>&nbsp;<span class="ident" id="3486391">strings</span><span class="op" id="3486398">.</span><span class="ident" id="3486399">IndexByte</span><span class="op" id="3486408">(</span><span class="ident" id="3486409">cs</span><span class="op" id="3486411">,</span>&nbsp;<span class="string" id="3486413">&#39;:&#39;</span><span class="op" id="3486416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3486419">if</span>&nbsp;<span class="ident" id="3486422">s</span>&nbsp;<span class="op" id="3486424">&lt;</span>&nbsp;<span class="num" id="3486426">0</span>&nbsp;<span class="op" id="3486428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3486432">return</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3486440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3486443">return</span>&nbsp;<span class="ident" id="3486450">cs</span><span class="op" id="3486452">[</span><span class="op" id="3486453">:</span><span class="ident" id="3486454">s</span><span class="op" id="3486455">]</span><span class="op" id="3486456">,</span>&nbsp;<span class="ident" id="3486458">cs</span><span class="op" id="3486460">[</span><span class="ident" id="3486461">s</span><span class="op" id="3486462">+</span><span class="num" id="3486463">1</span><span class="op" id="3486464">:</span><span class="op" id="3486465">]</span><span class="op" id="3486466">,</span>&nbsp;<span class="builtintype" id="3486468">true</span><br>
<span class="lineno"></span><span class="op" id="3486473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3486476">//&nbsp;SetBasicAuth&nbsp;sets&nbsp;the&nbsp;request&#39;s&nbsp;Authorization&nbsp;header&nbsp;to&nbsp;use&nbsp;HTTP</span><br>
<span class="lineno">555</span><span class="comment" id="3486544">//&nbsp;Basic&nbsp;Authentication&nbsp;with&nbsp;the&nbsp;provided&nbsp;username&nbsp;and&nbsp;password.</span><br>
<span class="lineno"></span><span class="comment" id="3486609">//</span><br>
<span class="lineno"></span><span class="comment" id="3486612">//&nbsp;With&nbsp;HTTP&nbsp;Basic&nbsp;Authentication&nbsp;the&nbsp;provided&nbsp;username&nbsp;and&nbsp;password</span><br>
<span class="lineno"></span><span class="comment" id="3486681">//&nbsp;are&nbsp;not&nbsp;encrypted.</span><br>
<span class="lineno"></span><span class="keyword" id="3486703">func</span>&nbsp;<span class="op" id="3486708">(</span><span class="ident" id="3486709">r</span>&nbsp;<span class="op" id="3486711">*</span><span class="ident" id="3486712">Request</span><span class="op" id="3486719">)</span>&nbsp;<span class="ident" id="3486721">SetBasicAuth</span><span class="op" id="3486733">(</span><span class="ident" id="3486734">username</span><span class="op" id="3486742">,</span>&nbsp;<span class="ident" id="3486744">password</span>&nbsp;<span class="builtintype" id="3486753">string</span><span class="op" id="3486759">)</span>&nbsp;<span class="op" id="3486761">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3486764">r</span><span class="op" id="3486765">.</span><span class="ident" id="3486766">Header</span><span class="op" id="3486772">.</span><span class="ident" id="3486773">Set</span><span class="op" id="3486776">(</span><span class="string" id="3486777">&#34;Authorization&#34;</span><span class="op" id="3486792">,</span>&nbsp;<span class="string" id="3486794">&#34;Basic&nbsp;&#34;</span><span class="op" id="3486802">+</span><span class="ident" id="3486803">basicAuth</span><span class="op" id="3486812">(</span><span class="ident" id="3486813">username</span><span class="op" id="3486821">,</span>&nbsp;<span class="ident" id="3486823">password</span><span class="op" id="3486831">)</span><span class="op" id="3486832">)</span><br>
<span class="lineno"></span><span class="op" id="3486834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3486837">//&nbsp;parseRequestLine&nbsp;parses&nbsp;&#34;GET&nbsp;/foo&nbsp;HTTP/1.1&#34;&nbsp;into&nbsp;its&nbsp;three&nbsp;parts.</span><br>
<span class="lineno"></span><span class="keyword" id="3486906">func</span>&nbsp;<span class="ident" id="3486911">parseRequestLine</span><span class="op" id="3486927">(</span><span class="ident" id="3486928">line</span>&nbsp;<span class="builtintype" id="3486933">string</span><span class="op" id="3486939">)</span>&nbsp;<span class="op" id="3486941">(</span><span class="ident" id="3486942">method</span><span class="op" id="3486948">,</span>&nbsp;<span class="ident" id="3486950">requestURI</span><span class="op" id="3486960">,</span>&nbsp;<span class="ident" id="3486962">proto</span>&nbsp;<span class="builtintype" id="3486968">string</span><span class="op" id="3486974">,</span>&nbsp;<span class="ident" id="3486976">ok</span>&nbsp;<span class="builtintype" id="3486979">bool</span><span class="op" id="3486983">)</span>&nbsp;<span class="op" id="3486985">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3486988">s1</span>&nbsp;<span class="op" id="3486991">:=</span>&nbsp;<span class="ident" id="3486994">strings</span><span class="op" id="3487001">.</span><span class="ident" id="3487002">Index</span><span class="op" id="3487007">(</span><span class="ident" id="3487008">line</span><span class="op" id="3487012">,</span>&nbsp;<span class="string" id="3487014">&#34;&nbsp;&#34;</span><span class="op" id="3487017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3487020">s2</span>&nbsp;<span class="op" id="3487023">:=</span>&nbsp;<span class="ident" id="3487026">strings</span><span class="op" id="3487033">.</span><span class="ident" id="3487034">Index</span><span class="op" id="3487039">(</span><span class="ident" id="3487040">line</span><span class="op" id="3487044">[</span><span class="ident" id="3487045">s1</span><span class="op" id="3487047">+</span><span class="num" id="3487048">1</span><span class="op" id="3487049">:</span><span class="op" id="3487050">]</span><span class="op" id="3487051">,</span>&nbsp;<span class="string" id="3487053">&#34;&nbsp;&#34;</span><span class="op" id="3487056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3487059">if</span>&nbsp;<span class="ident" id="3487062">s1</span>&nbsp;<span class="op" id="3487065">&lt;</span>&nbsp;<span class="num" id="3487067">0</span>&nbsp;<span class="op" id="3487069">||</span>&nbsp;<span class="ident" id="3487072">s2</span>&nbsp;<span class="op" id="3487075">&lt;</span>&nbsp;<span class="num" id="3487077">0</span>&nbsp;<span class="op" id="3487079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3487083">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3487091">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3487094">s2</span>&nbsp;<span class="op" id="3487097">+=</span>&nbsp;<span class="ident" id="3487100">s1</span>&nbsp;<span class="op" id="3487103">+</span>&nbsp;<span class="num" id="3487105">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3487108">return</span>&nbsp;<span class="ident" id="3487115">line</span><span class="op" id="3487119">[</span><span class="op" id="3487120">:</span><span class="ident" id="3487121">s1</span><span class="op" id="3487123">]</span><span class="op" id="3487124">,</span>&nbsp;<span class="ident" id="3487126">line</span><span class="op" id="3487130">[</span><span class="ident" id="3487131">s1</span><span class="op" id="3487133">+</span><span class="num" id="3487134">1</span>&nbsp;<span class="op" id="3487136">:</span>&nbsp;<span class="ident" id="3487138">s2</span><span class="op" id="3487140">]</span><span class="op" id="3487141">,</span>&nbsp;<span class="ident" id="3487143">line</span><span class="op" id="3487147">[</span><span class="ident" id="3487148">s2</span><span class="op" id="3487150">+</span><span class="num" id="3487151">1</span><span class="op" id="3487152">:</span><span class="op" id="3487153">]</span><span class="op" id="3487154">,</span>&nbsp;<span class="builtintype" id="3487156">true</span><br>
<span class="lineno"></span><span class="op" id="3487161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3487164">var</span>&nbsp;<span class="ident" id="3487168">textprotoReaderPool</span>&nbsp;<span class="ident" id="3487188">sync</span><span class="op" id="3487192">.</span><span class="ident" id="3487193">Pool</span><br>
<span class="lineno">575</span><br>
<span class="lineno"></span><span class="keyword" id="3487199">func</span>&nbsp;<span class="ident" id="3487204">newTextprotoReader</span><span class="op" id="3487222">(</span><span class="ident" id="3487223">br</span>&nbsp;<span class="op" id="3487226">*</span><span class="ident" id="3487227">bufio</span><span class="op" id="3487232">.</span><span class="ident" id="3487233">Reader</span><span class="op" id="3487239">)</span>&nbsp;<span class="op" id="3487241">*</span><span class="ident" id="3487242">textproto</span><span class="op" id="3487251">.</span><span class="ident" id="3487252">Reader</span>&nbsp;<span class="op" id="3487259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3487262">if</span>&nbsp;<span class="ident" id="3487265">v</span>&nbsp;<span class="op" id="3487267">:=</span>&nbsp;<span class="ident" id="3487270">textprotoReaderPool</span><span class="op" id="3487289">.</span><span class="ident" id="3487290">Get</span><span class="op" id="3487293">(</span><span class="op" id="3487294">)</span><span class="op" id="3487295">;</span>&nbsp;<span class="ident" id="3487297">v</span>&nbsp;<span class="op" id="3487299">!=</span>&nbsp;<span class="ident" id="3487302">nil</span>&nbsp;<span class="op" id="3487306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3487310">tr</span>&nbsp;<span class="op" id="3487313">:=</span>&nbsp;<span class="ident" id="3487316">v</span><span class="op" id="3487317">.</span><span class="op" id="3487318">(</span><span class="op" id="3487319">*</span><span class="ident" id="3487320">textproto</span><span class="op" id="3487329">.</span><span class="ident" id="3487330">Reader</span><span class="op" id="3487336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3487340">tr</span><span class="op" id="3487342">.</span><span class="ident" id="3487343">R</span>&nbsp;<span class="op" id="3487345">=</span>&nbsp;<span class="ident" id="3487347">br</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3487352">return</span>&nbsp;<span class="ident" id="3487359">tr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3487363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3487366">return</span>&nbsp;<span class="ident" id="3487373">textproto</span><span class="op" id="3487382">.</span><span class="ident" id="3487383">NewReader</span><span class="op" id="3487392">(</span><span class="ident" id="3487393">br</span><span class="op" id="3487395">)</span><br>
<span class="lineno"></span><span class="op" id="3487397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">585</span><span class="keyword" id="3487400">func</span>&nbsp;<span class="ident" id="3487405">putTextprotoReader</span><span class="op" id="3487423">(</span><span class="ident" id="3487424">r</span>&nbsp;<span class="op" id="3487426">*</span><span class="ident" id="3487427">textproto</span><span class="op" id="3487436">.</span><span class="ident" id="3487437">Reader</span><span class="op" id="3487443">)</span>&nbsp;<span class="op" id="3487445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3487448">r</span><span class="op" id="3487449">.</span><span class="ident" id="3487450">R</span>&nbsp;<span class="op" id="3487452">=</span>&nbsp;<span class="ident" id="3487454">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3487459">textprotoReaderPool</span><span class="op" id="3487478">.</span><span class="ident" id="3487479">Put</span><span class="op" id="3487482">(</span><span class="ident" id="3487483">r</span><span class="op" id="3487484">)</span><br>
<span class="lineno"></span><span class="op" id="3487486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="3487489">//&nbsp;ReadRequest&nbsp;reads&nbsp;and&nbsp;parses&nbsp;a&nbsp;request&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="3487539">func</span>&nbsp;<span class="ident" id="3487544">ReadRequest</span><span class="op" id="3487555">(</span><span class="ident" id="3487556">b</span>&nbsp;<span class="op" id="3487558">*</span><span class="ident" id="3487559">bufio</span><span class="op" id="3487564">.</span><span class="ident" id="3487565">Reader</span><span class="op" id="3487571">)</span>&nbsp;<span class="op" id="3487573">(</span><span class="ident" id="3487574">req</span>&nbsp;<span class="op" id="3487578">*</span><span class="ident" id="3487579">Request</span><span class="op" id="3487586">,</span>&nbsp;<span class="ident" id="3487588">err</span>&nbsp;<span class="builtintype" id="3487592">error</span><span class="op" id="3487597">)</span>&nbsp;<span class="op" id="3487599">{</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3487603">tp</span>&nbsp;<span class="op" id="3487606">:=</span>&nbsp;<span class="ident" id="3487609">newTextprotoReader</span><span class="op" id="3487627">(</span><span class="ident" id="3487628">b</span><span class="op" id="3487629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3487632">req</span>&nbsp;<span class="op" id="3487636">=</span>&nbsp;<span class="builtinfunc" id="3487638">new</span><span class="op" id="3487641">(</span><span class="ident" id="3487642">Request</span><span class="op" id="3487649">)</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3487653">//&nbsp;First&nbsp;line:&nbsp;GET&nbsp;/index.html&nbsp;HTTP/1.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3487694">var</span>&nbsp;<span class="ident" id="3487698">s</span>&nbsp;<span class="builtintype" id="3487700">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3487708">if</span>&nbsp;<span class="ident" id="3487711">s</span><span class="op" id="3487712">,</span>&nbsp;<span class="ident" id="3487714">err</span>&nbsp;<span class="op" id="3487718">=</span>&nbsp;<span class="ident" id="3487720">tp</span><span class="op" id="3487722">.</span><span class="ident" id="3487723">ReadLine</span><span class="op" id="3487731">(</span><span class="op" id="3487732">)</span><span class="op" id="3487733">;</span>&nbsp;<span class="ident" id="3487735">err</span>&nbsp;<span class="op" id="3487739">!=</span>&nbsp;<span class="ident" id="3487742">nil</span>&nbsp;<span class="op" id="3487746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3487750">return</span>&nbsp;<span class="ident" id="3487757">nil</span><span class="op" id="3487760">,</span>&nbsp;<span class="ident" id="3487762">err</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3487767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3487770">defer</span>&nbsp;<span class="keyword" id="3487776">func</span><span class="op" id="3487780">(</span><span class="op" id="3487781">)</span>&nbsp;<span class="op" id="3487783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3487787">putTextprotoReader</span><span class="op" id="3487805">(</span><span class="ident" id="3487806">tp</span><span class="op" id="3487808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3487812">if</span>&nbsp;<span class="ident" id="3487815">err</span>&nbsp;<span class="op" id="3487819">==</span>&nbsp;<span class="ident" id="3487822">io</span><span class="op" id="3487824">.</span><span class="ident" id="3487825">EOF</span>&nbsp;<span class="op" id="3487829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3487834">err</span>&nbsp;<span class="op" id="3487838">=</span>&nbsp;<span class="ident" id="3487840">io</span><span class="op" id="3487842">.</span><span class="ident" id="3487843">ErrUnexpectedEOF</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3487862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3487865">}</span><span class="op" id="3487866">(</span><span class="op" id="3487867">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3487871">var</span>&nbsp;<span class="ident" id="3487875">ok</span>&nbsp;<span class="builtintype" id="3487878">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3487884">req</span><span class="op" id="3487887">.</span><span class="ident" id="3487888">Method</span><span class="op" id="3487894">,</span>&nbsp;<span class="ident" id="3487896">req</span><span class="op" id="3487899">.</span><span class="ident" id="3487900">RequestURI</span><span class="op" id="3487910">,</span>&nbsp;<span class="ident" id="3487912">req</span><span class="op" id="3487915">.</span><span class="ident" id="3487916">Proto</span><span class="op" id="3487921">,</span>&nbsp;<span class="ident" id="3487923">ok</span>&nbsp;<span class="op" id="3487926">=</span>&nbsp;<span class="ident" id="3487928">parseRequestLine</span><span class="op" id="3487944">(</span><span class="ident" id="3487945">s</span><span class="op" id="3487946">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3487949">if</span>&nbsp;<span class="op" id="3487952">!</span><span class="ident" id="3487953">ok</span>&nbsp;<span class="op" id="3487956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3487960">return</span>&nbsp;<span class="ident" id="3487967">nil</span><span class="op" id="3487970">,</span>&nbsp;<span class="op" id="3487972">&amp;</span><span class="ident" id="3487973">badStringError</span><span class="op" id="3487987">{</span><span class="string" id="3487988">&#34;malformed&nbsp;HTTP&nbsp;request&#34;</span><span class="op" id="3488012">,</span>&nbsp;<span class="ident" id="3488014">s</span><span class="op" id="3488015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3488018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3488021">rawurl</span>&nbsp;<span class="op" id="3488028">:=</span>&nbsp;<span class="ident" id="3488031">req</span><span class="op" id="3488034">.</span><span class="ident" id="3488035">RequestURI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3488047">if</span>&nbsp;<span class="ident" id="3488050">req</span><span class="op" id="3488053">.</span><span class="ident" id="3488054">ProtoMajor</span><span class="op" id="3488064">,</span>&nbsp;<span class="ident" id="3488066">req</span><span class="op" id="3488069">.</span><span class="ident" id="3488070">ProtoMinor</span><span class="op" id="3488080">,</span>&nbsp;<span class="ident" id="3488082">ok</span>&nbsp;<span class="op" id="3488085">=</span>&nbsp;<span class="ident" id="3488087">ParseHTTPVersion</span><span class="op" id="3488103">(</span><span class="ident" id="3488104">req</span><span class="op" id="3488107">.</span><span class="ident" id="3488108">Proto</span><span class="op" id="3488113">)</span><span class="op" id="3488114">;</span>&nbsp;<span class="op" id="3488116">!</span><span class="ident" id="3488117">ok</span>&nbsp;<span class="op" id="3488120">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3488124">return</span>&nbsp;<span class="ident" id="3488131">nil</span><span class="op" id="3488134">,</span>&nbsp;<span class="op" id="3488136">&amp;</span><span class="ident" id="3488137">badStringError</span><span class="op" id="3488151">{</span><span class="string" id="3488152">&#34;malformed&nbsp;HTTP&nbsp;version&#34;</span><span class="op" id="3488176">,</span>&nbsp;<span class="ident" id="3488178">req</span><span class="op" id="3488181">.</span><span class="ident" id="3488182">Proto</span><span class="op" id="3488187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3488190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3488194">//&nbsp;CONNECT&nbsp;requests&nbsp;are&nbsp;used&nbsp;two&nbsp;different&nbsp;ways,&nbsp;and&nbsp;neither&nbsp;uses&nbsp;a&nbsp;full&nbsp;URL:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3488273">//&nbsp;The&nbsp;standard&nbsp;use&nbsp;is&nbsp;to&nbsp;tunnel&nbsp;HTTPS&nbsp;through&nbsp;an&nbsp;HTTP&nbsp;proxy.</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3488336">//&nbsp;It&nbsp;looks&nbsp;like&nbsp;&#34;CONNECT&nbsp;www.google.com:443&nbsp;HTTP/1.1&#34;,&nbsp;and&nbsp;the&nbsp;parameter&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3488414">//&nbsp;just&nbsp;the&nbsp;authority&nbsp;section&nbsp;of&nbsp;a&nbsp;URL.&nbsp;This&nbsp;information&nbsp;should&nbsp;go&nbsp;in&nbsp;req.URL.Host.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3488499">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3488503">//&nbsp;The&nbsp;net/rpc&nbsp;package&nbsp;also&nbsp;uses&nbsp;CONNECT,&nbsp;but&nbsp;there&nbsp;the&nbsp;parameter&nbsp;is&nbsp;a&nbsp;path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3488580">//&nbsp;that&nbsp;starts&nbsp;with&nbsp;a&nbsp;slash.&nbsp;It&nbsp;can&nbsp;be&nbsp;parsed&nbsp;with&nbsp;the&nbsp;regular&nbsp;URL&nbsp;parser,</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3488656">//&nbsp;and&nbsp;the&nbsp;path&nbsp;will&nbsp;end&nbsp;up&nbsp;in&nbsp;req.URL.Path,&nbsp;where&nbsp;it&nbsp;needs&nbsp;to&nbsp;be&nbsp;in&nbsp;order&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3488736">//&nbsp;RPC&nbsp;to&nbsp;work.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3488753">justAuthority</span>&nbsp;<span class="op" id="3488767">:=</span>&nbsp;<span class="ident" id="3488770">req</span><span class="op" id="3488773">.</span><span class="ident" id="3488774">Method</span>&nbsp;<span class="op" id="3488781">==</span>&nbsp;<span class="string" id="3488784">&#34;CONNECT&#34;</span>&nbsp;<span class="op" id="3488794">&amp;&amp;</span>&nbsp;<span class="op" id="3488797">!</span><span class="ident" id="3488798">strings</span><span class="op" id="3488805">.</span><span class="ident" id="3488806">HasPrefix</span><span class="op" id="3488815">(</span><span class="ident" id="3488816">rawurl</span><span class="op" id="3488822">,</span>&nbsp;<span class="string" id="3488824">&#34;/&#34;</span><span class="op" id="3488827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3488830">if</span>&nbsp;<span class="ident" id="3488833">justAuthority</span>&nbsp;<span class="op" id="3488847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3488851">rawurl</span>&nbsp;<span class="op" id="3488858">=</span>&nbsp;<span class="string" id="3488860">&#34;http://&#34;</span>&nbsp;<span class="op" id="3488870">+</span>&nbsp;<span class="ident" id="3488872">rawurl</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3488880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3488884">if</span>&nbsp;<span class="ident" id="3488887">req</span><span class="op" id="3488890">.</span><span class="ident" id="3488891">URL</span><span class="op" id="3488894">,</span>&nbsp;<span class="ident" id="3488896">err</span>&nbsp;<span class="op" id="3488900">=</span>&nbsp;<span class="ident" id="3488902">url</span><span class="op" id="3488905">.</span><span class="ident" id="3488906">ParseRequestURI</span><span class="op" id="3488921">(</span><span class="ident" id="3488922">rawurl</span><span class="op" id="3488928">)</span><span class="op" id="3488929">;</span>&nbsp;<span class="ident" id="3488931">err</span>&nbsp;<span class="op" id="3488935">!=</span>&nbsp;<span class="ident" id="3488938">nil</span>&nbsp;<span class="op" id="3488942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3488946">return</span>&nbsp;<span class="ident" id="3488953">nil</span><span class="op" id="3488956">,</span>&nbsp;<span class="ident" id="3488958">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3488963">}</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3488967">if</span>&nbsp;<span class="ident" id="3488970">justAuthority</span>&nbsp;<span class="op" id="3488984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3488988">//&nbsp;Strip&nbsp;the&nbsp;bogus&nbsp;&#34;http://&#34;&nbsp;back&nbsp;off.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3489029">req</span><span class="op" id="3489032">.</span><span class="ident" id="3489033">URL</span><span class="op" id="3489036">.</span><span class="ident" id="3489037">Scheme</span>&nbsp;<span class="op" id="3489044">=</span>&nbsp;<span class="string" id="3489046">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3489050">}</span><br>
<span class="lineno">640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3489054">//&nbsp;Subsequent&nbsp;lines:&nbsp;Key:&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3489088">mimeHeader</span><span class="op" id="3489098">,</span>&nbsp;<span class="ident" id="3489100">err</span>&nbsp;<span class="op" id="3489104">:=</span>&nbsp;<span class="ident" id="3489107">tp</span><span class="op" id="3489109">.</span><span class="ident" id="3489110">ReadMIMEHeader</span><span class="op" id="3489124">(</span><span class="op" id="3489125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3489128">if</span>&nbsp;<span class="ident" id="3489131">err</span>&nbsp;<span class="op" id="3489135">!=</span>&nbsp;<span class="ident" id="3489138">nil</span>&nbsp;<span class="op" id="3489142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3489146">return</span>&nbsp;<span class="ident" id="3489153">nil</span><span class="op" id="3489156">,</span>&nbsp;<span class="ident" id="3489158">err</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3489163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3489166">req</span><span class="op" id="3489169">.</span><span class="ident" id="3489170">Header</span>&nbsp;<span class="op" id="3489177">=</span>&nbsp;<span class="ident" id="3489179">Header</span><span class="op" id="3489185">(</span><span class="ident" id="3489186">mimeHeader</span><span class="op" id="3489196">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3489200">//&nbsp;RFC2616:&nbsp;Must&nbsp;treat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3489224">//&nbsp;&nbsp;&nbsp;&nbsp;GET&nbsp;/index.html&nbsp;HTTP/1.1</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3489253">//&nbsp;&nbsp;&nbsp;&nbsp;Host:&nbsp;www.google.com</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3489278">//&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3489286">//&nbsp;&nbsp;&nbsp;&nbsp;GET&nbsp;http://www.google.com/index.html&nbsp;HTTP/1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3489336">//&nbsp;&nbsp;&nbsp;&nbsp;Host:&nbsp;doesntmatter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3489359">//&nbsp;the&nbsp;same.&nbsp;&nbsp;In&nbsp;the&nbsp;second&nbsp;case,&nbsp;any&nbsp;Host&nbsp;line&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3489420">req</span><span class="op" id="3489423">.</span><span class="ident" id="3489424">Host</span>&nbsp;<span class="op" id="3489429">=</span>&nbsp;<span class="ident" id="3489431">req</span><span class="op" id="3489434">.</span><span class="ident" id="3489435">URL</span><span class="op" id="3489438">.</span><span class="ident" id="3489439">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3489445">if</span>&nbsp;<span class="ident" id="3489448">req</span><span class="op" id="3489451">.</span><span class="ident" id="3489452">Host</span>&nbsp;<span class="op" id="3489457">==</span>&nbsp;<span class="string" id="3489460">&#34;&#34;</span>&nbsp;<span class="op" id="3489463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3489467">req</span><span class="op" id="3489470">.</span><span class="ident" id="3489471">Host</span>&nbsp;<span class="op" id="3489476">=</span>&nbsp;<span class="ident" id="3489478">req</span><span class="op" id="3489481">.</span><span class="ident" id="3489482">Header</span><span class="op" id="3489488">.</span><span class="ident" id="3489489">get</span><span class="op" id="3489492">(</span><span class="string" id="3489493">&#34;Host&#34;</span><span class="op" id="3489499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3489502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3489505">delete</span><span class="op" id="3489511">(</span><span class="ident" id="3489512">req</span><span class="op" id="3489515">.</span><span class="ident" id="3489516">Header</span><span class="op" id="3489522">,</span>&nbsp;<span class="string" id="3489524">&#34;Host&#34;</span><span class="op" id="3489530">)</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3489534">fixPragmaCacheControl</span><span class="op" id="3489555">(</span><span class="ident" id="3489556">req</span><span class="op" id="3489559">.</span><span class="ident" id="3489560">Header</span><span class="op" id="3489566">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3489570">err</span>&nbsp;<span class="op" id="3489574">=</span>&nbsp;<span class="ident" id="3489576">readTransfer</span><span class="op" id="3489588">(</span><span class="ident" id="3489589">req</span><span class="op" id="3489592">,</span>&nbsp;<span class="ident" id="3489594">b</span><span class="op" id="3489595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3489598">if</span>&nbsp;<span class="ident" id="3489601">err</span>&nbsp;<span class="op" id="3489605">!=</span>&nbsp;<span class="ident" id="3489608">nil</span>&nbsp;<span class="op" id="3489612">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3489616">return</span>&nbsp;<span class="ident" id="3489623">nil</span><span class="op" id="3489626">,</span>&nbsp;<span class="ident" id="3489628">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3489633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3489637">req</span><span class="op" id="3489640">.</span><span class="ident" id="3489641">Close</span>&nbsp;<span class="op" id="3489647">=</span>&nbsp;<span class="ident" id="3489649">shouldClose</span><span class="op" id="3489660">(</span><span class="ident" id="3489661">req</span><span class="op" id="3489664">.</span><span class="ident" id="3489665">ProtoMajor</span><span class="op" id="3489675">,</span>&nbsp;<span class="ident" id="3489677">req</span><span class="op" id="3489680">.</span><span class="ident" id="3489681">ProtoMinor</span><span class="op" id="3489691">,</span>&nbsp;<span class="ident" id="3489693">req</span><span class="op" id="3489696">.</span><span class="ident" id="3489697">Header</span><span class="op" id="3489703">,</span>&nbsp;<span class="builtintype" id="3489705">false</span><span class="op" id="3489710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3489713">return</span>&nbsp;<span class="ident" id="3489720">req</span><span class="op" id="3489723">,</span>&nbsp;<span class="ident" id="3489725">nil</span><br>
<span class="lineno">670</span><span class="op" id="3489729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3489732">//&nbsp;MaxBytesReader&nbsp;is&nbsp;similar&nbsp;to&nbsp;io.LimitReader&nbsp;but&nbsp;is&nbsp;intended&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3489799">//&nbsp;limiting&nbsp;the&nbsp;size&nbsp;of&nbsp;incoming&nbsp;request&nbsp;bodies.&nbsp;In&nbsp;contrast&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3489863">//&nbsp;io.LimitReader,&nbsp;MaxBytesReader&#39;s&nbsp;result&nbsp;is&nbsp;a&nbsp;ReadCloser,&nbsp;returns&nbsp;a</span><br>
<span class="lineno">675</span><span class="comment" id="3489933">//&nbsp;non-EOF&nbsp;error&nbsp;for&nbsp;a&nbsp;Read&nbsp;beyond&nbsp;the&nbsp;limit,&nbsp;and&nbsp;Closes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3489994">//&nbsp;underlying&nbsp;reader&nbsp;when&nbsp;its&nbsp;Close&nbsp;method&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span><span class="comment" id="3490048">//</span><br>
<span class="lineno"></span><span class="comment" id="3490051">//&nbsp;MaxBytesReader&nbsp;prevents&nbsp;clients&nbsp;from&nbsp;accidentally&nbsp;or&nbsp;maliciously</span><br>
<span class="lineno"></span><span class="comment" id="3490119">//&nbsp;sending&nbsp;a&nbsp;large&nbsp;request&nbsp;and&nbsp;wasting&nbsp;server&nbsp;resources.</span><br>
<span class="lineno">680</span><span class="keyword" id="3490176">func</span>&nbsp;<span class="ident" id="3490181">MaxBytesReader</span><span class="op" id="3490195">(</span><span class="ident" id="3490196">w</span>&nbsp;<span class="ident" id="3490198">ResponseWriter</span><span class="op" id="3490212">,</span>&nbsp;<span class="ident" id="3490214">r</span>&nbsp;<span class="ident" id="3490216">io</span><span class="op" id="3490218">.</span><span class="ident" id="3490219">ReadCloser</span><span class="op" id="3490229">,</span>&nbsp;<span class="ident" id="3490231">n</span>&nbsp;<span class="ident" id="3490233">int64</span><span class="op" id="3490238">)</span>&nbsp;<span class="ident" id="3490240">io</span><span class="op" id="3490242">.</span><span class="ident" id="3490243">ReadCloser</span>&nbsp;<span class="op" id="3490254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3490257">return</span>&nbsp;<span class="op" id="3490264">&amp;</span><span class="ident" id="3490265">maxBytesReader</span><span class="op" id="3490279">{</span><span class="ident" id="3490280">w</span><span class="op" id="3490281">:</span>&nbsp;<span class="ident" id="3490283">w</span><span class="op" id="3490284">,</span>&nbsp;<span class="ident" id="3490286">r</span><span class="op" id="3490287">:</span>&nbsp;<span class="ident" id="3490289">r</span><span class="op" id="3490290">,</span>&nbsp;<span class="ident" id="3490292">n</span><span class="op" id="3490293">:</span>&nbsp;<span class="ident" id="3490295">n</span><span class="op" id="3490296">}</span><br>
<span class="lineno"></span><span class="op" id="3490298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3490301">type</span>&nbsp;<span class="ident" id="3490306">maxBytesReader</span>&nbsp;<span class="keyword" id="3490321">struct</span>&nbsp;<span class="op" id="3490328">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3490331">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3490339">ResponseWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3490355">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3490363">io</span><span class="op" id="3490365">.</span><span class="ident" id="3490366">ReadCloser</span>&nbsp;<span class="comment" id="3490377">//&nbsp;underlying&nbsp;reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3490399">n</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3490407">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3490421">//&nbsp;max&nbsp;bytes&nbsp;remaining</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3490445">stopped</span>&nbsp;<span class="builtintype" id="3490453">bool</span><br>
<span class="lineno"></span><span class="op" id="3490458">}</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="keyword" id="3490461">func</span>&nbsp;<span class="op" id="3490466">(</span><span class="ident" id="3490467">l</span>&nbsp;<span class="op" id="3490469">*</span><span class="ident" id="3490470">maxBytesReader</span><span class="op" id="3490484">)</span>&nbsp;<span class="ident" id="3490486">Read</span><span class="op" id="3490490">(</span><span class="ident" id="3490491">p</span>&nbsp;<span class="op" id="3490493">[</span><span class="op" id="3490494">]</span><span class="builtintype" id="3490495">byte</span><span class="op" id="3490499">)</span>&nbsp;<span class="op" id="3490501">(</span><span class="ident" id="3490502">n</span>&nbsp;<span class="builtintype" id="3490504">int</span><span class="op" id="3490507">,</span>&nbsp;<span class="ident" id="3490509">err</span>&nbsp;<span class="builtintype" id="3490513">error</span><span class="op" id="3490518">)</span>&nbsp;<span class="op" id="3490520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3490523">if</span>&nbsp;<span class="ident" id="3490526">l</span><span class="op" id="3490527">.</span><span class="ident" id="3490528">n</span>&nbsp;<span class="op" id="3490530">&lt;=</span>&nbsp;<span class="num" id="3490533">0</span>&nbsp;<span class="op" id="3490535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3490539">if</span>&nbsp;<span class="op" id="3490542">!</span><span class="ident" id="3490543">l</span><span class="op" id="3490544">.</span><span class="ident" id="3490545">stopped</span>&nbsp;<span class="op" id="3490553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3490558">l</span><span class="op" id="3490559">.</span><span class="ident" id="3490560">stopped</span>&nbsp;<span class="op" id="3490568">=</span>&nbsp;<span class="builtintype" id="3490570">true</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3490578">if</span>&nbsp;<span class="ident" id="3490581">res</span><span class="op" id="3490584">,</span>&nbsp;<span class="ident" id="3490586">ok</span>&nbsp;<span class="op" id="3490589">:=</span>&nbsp;<span class="ident" id="3490592">l</span><span class="op" id="3490593">.</span><span class="ident" id="3490594">w</span><span class="op" id="3490595">.</span><span class="op" id="3490596">(</span><span class="op" id="3490597">*</span><span class="ident" id="3490598">response</span><span class="op" id="3490606">)</span><span class="op" id="3490607">;</span>&nbsp;<span class="ident" id="3490609">ok</span>&nbsp;<span class="op" id="3490612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3490618">res</span><span class="op" id="3490621">.</span><span class="ident" id="3490622">requestTooLarge</span><span class="op" id="3490637">(</span><span class="op" id="3490638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3490643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3490647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3490651">return</span>&nbsp;<span class="num" id="3490658">0</span><span class="op" id="3490659">,</span>&nbsp;<span class="ident" id="3490661">errors</span><span class="op" id="3490667">.</span><span class="ident" id="3490668">New</span><span class="op" id="3490671">(</span><span class="string" id="3490672">&#34;http:&nbsp;request&nbsp;body&nbsp;too&nbsp;large&#34;</span><span class="op" id="3490702">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3490705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3490708">if</span>&nbsp;<span class="ident" id="3490711">int64</span><span class="op" id="3490716">(</span><span class="builtinfunc" id="3490717">len</span><span class="op" id="3490720">(</span><span class="ident" id="3490721">p</span><span class="op" id="3490722">)</span><span class="op" id="3490723">)</span>&nbsp;<span class="op" id="3490725">&gt;</span>&nbsp;<span class="ident" id="3490727">l</span><span class="op" id="3490728">.</span><span class="ident" id="3490729">n</span>&nbsp;<span class="op" id="3490731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3490735">p</span>&nbsp;<span class="op" id="3490737">=</span>&nbsp;<span class="ident" id="3490739">p</span><span class="op" id="3490740">[</span><span class="op" id="3490741">:</span><span class="ident" id="3490742">l</span><span class="op" id="3490743">.</span><span class="ident" id="3490744">n</span><span class="op" id="3490745">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3490748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3490751">n</span><span class="op" id="3490752">,</span>&nbsp;<span class="ident" id="3490754">err</span>&nbsp;<span class="op" id="3490758">=</span>&nbsp;<span class="ident" id="3490760">l</span><span class="op" id="3490761">.</span><span class="ident" id="3490762">r</span><span class="op" id="3490763">.</span><span class="ident" id="3490764">Read</span><span class="op" id="3490768">(</span><span class="ident" id="3490769">p</span><span class="op" id="3490770">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3490773">l</span><span class="op" id="3490774">.</span><span class="ident" id="3490775">n</span>&nbsp;<span class="op" id="3490777">-=</span>&nbsp;<span class="ident" id="3490780">int64</span><span class="op" id="3490785">(</span><span class="ident" id="3490786">n</span><span class="op" id="3490787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3490790">return</span><br>
<span class="lineno"></span><span class="op" id="3490797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3490800">func</span>&nbsp;<span class="op" id="3490805">(</span><span class="ident" id="3490806">l</span>&nbsp;<span class="op" id="3490808">*</span><span class="ident" id="3490809">maxBytesReader</span><span class="op" id="3490823">)</span>&nbsp;<span class="ident" id="3490825">Close</span><span class="op" id="3490830">(</span><span class="op" id="3490831">)</span>&nbsp;<span class="builtintype" id="3490833">error</span>&nbsp;<span class="op" id="3490839">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3490842">return</span>&nbsp;<span class="ident" id="3490849">l</span><span class="op" id="3490850">.</span><span class="ident" id="3490851">r</span><span class="op" id="3490852">.</span><span class="ident" id="3490853">Close</span><span class="op" id="3490858">(</span><span class="op" id="3490859">)</span><br>
<span class="lineno"></span><span class="op" id="3490861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3490864">func</span>&nbsp;<span class="ident" id="3490869">copyValues</span><span class="op" id="3490879">(</span><span class="ident" id="3490880">dst</span><span class="op" id="3490883">,</span>&nbsp;<span class="ident" id="3490885">src</span>&nbsp;<span class="ident" id="3490889">url</span><span class="op" id="3490892">.</span><span class="ident" id="3490893">Values</span><span class="op" id="3490899">)</span>&nbsp;<span class="op" id="3490901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3490904">for</span>&nbsp;<span class="ident" id="3490908">k</span><span class="op" id="3490909">,</span>&nbsp;<span class="ident" id="3490911">vs</span>&nbsp;<span class="op" id="3490914">:=</span>&nbsp;<span class="keyword" id="3490917">range</span>&nbsp;<span class="ident" id="3490923">src</span>&nbsp;<span class="op" id="3490927">{</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3490931">for</span>&nbsp;<span class="ident" id="3490935">_</span><span class="op" id="3490936">,</span>&nbsp;<span class="ident" id="3490938">value</span>&nbsp;<span class="op" id="3490944">:=</span>&nbsp;<span class="keyword" id="3490947">range</span>&nbsp;<span class="ident" id="3490953">vs</span>&nbsp;<span class="op" id="3490956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3490961">dst</span><span class="op" id="3490964">.</span><span class="ident" id="3490965">Add</span><span class="op" id="3490968">(</span><span class="ident" id="3490969">k</span><span class="op" id="3490970">,</span>&nbsp;<span class="ident" id="3490972">value</span><span class="op" id="3490977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3490981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3490984">}</span><br>
<span class="lineno"></span><span class="op" id="3490986">}</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span><span class="keyword" id="3490989">func</span>&nbsp;<span class="ident" id="3490994">parsePostForm</span><span class="op" id="3491007">(</span><span class="ident" id="3491008">r</span>&nbsp;<span class="op" id="3491010">*</span><span class="ident" id="3491011">Request</span><span class="op" id="3491018">)</span>&nbsp;<span class="op" id="3491020">(</span><span class="ident" id="3491021">vs</span>&nbsp;<span class="ident" id="3491024">url</span><span class="op" id="3491027">.</span><span class="ident" id="3491028">Values</span><span class="op" id="3491034">,</span>&nbsp;<span class="ident" id="3491036">err</span>&nbsp;<span class="builtintype" id="3491040">error</span><span class="op" id="3491045">)</span>&nbsp;<span class="op" id="3491047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3491050">if</span>&nbsp;<span class="ident" id="3491053">r</span><span class="op" id="3491054">.</span><span class="ident" id="3491055">Body</span>&nbsp;<span class="op" id="3491060">==</span>&nbsp;<span class="ident" id="3491063">nil</span>&nbsp;<span class="op" id="3491067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3491071">err</span>&nbsp;<span class="op" id="3491075">=</span>&nbsp;<span class="ident" id="3491077">errors</span><span class="op" id="3491083">.</span><span class="ident" id="3491084">New</span><span class="op" id="3491087">(</span><span class="string" id="3491088">&#34;missing&nbsp;form&nbsp;body&#34;</span><span class="op" id="3491107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3491111">return</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3491119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3491122">ct</span>&nbsp;<span class="op" id="3491125">:=</span>&nbsp;<span class="ident" id="3491128">r</span><span class="op" id="3491129">.</span><span class="ident" id="3491130">Header</span><span class="op" id="3491136">.</span><span class="ident" id="3491137">Get</span><span class="op" id="3491140">(</span><span class="string" id="3491141">&#34;Content-Type&#34;</span><span class="op" id="3491155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3491158">//&nbsp;RFC&nbsp;2616,&nbsp;section&nbsp;7.2.1&nbsp;-&nbsp;empty&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3491199">//&nbsp;&nbsp;&nbsp;SHOULD&nbsp;be&nbsp;treated&nbsp;as&nbsp;application/octet-stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3491251">if</span>&nbsp;<span class="ident" id="3491254">ct</span>&nbsp;<span class="op" id="3491257">==</span>&nbsp;<span class="string" id="3491260">&#34;&#34;</span>&nbsp;<span class="op" id="3491263">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3491267">ct</span>&nbsp;<span class="op" id="3491270">=</span>&nbsp;<span class="string" id="3491272">&#34;application/octet-stream&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3491300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3491303">ct</span><span class="op" id="3491305">,</span>&nbsp;<span class="ident" id="3491307">_</span><span class="op" id="3491308">,</span>&nbsp;<span class="ident" id="3491310">err</span>&nbsp;<span class="op" id="3491314">=</span>&nbsp;<span class="ident" id="3491316">mime</span><span class="op" id="3491320">.</span><span class="ident" id="3491321">ParseMediaType</span><span class="op" id="3491335">(</span><span class="ident" id="3491336">ct</span><span class="op" id="3491338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3491341">switch</span>&nbsp;<span class="op" id="3491348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3491351">case</span>&nbsp;<span class="ident" id="3491356">ct</span>&nbsp;<span class="op" id="3491359">==</span>&nbsp;<span class="string" id="3491362">&#34;application/x-www-form-urlencoded&#34;</span><span class="op" id="3491397">:</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3491401">var</span>&nbsp;<span class="ident" id="3491405">reader</span>&nbsp;<span class="ident" id="3491412">io</span><span class="op" id="3491414">.</span><span class="ident" id="3491415">Reader</span>&nbsp;<span class="op" id="3491422">=</span>&nbsp;<span class="ident" id="3491424">r</span><span class="op" id="3491425">.</span><span class="ident" id="3491426">Body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3491433">maxFormSize</span>&nbsp;<span class="op" id="3491445">:=</span>&nbsp;<span class="ident" id="3491448">int64</span><span class="op" id="3491453">(</span><span class="num" id="3491454">1</span><span class="op" id="3491455">&lt;&lt;</span><span class="num" id="3491457">63</span>&nbsp;<span class="op" id="3491460">-</span>&nbsp;<span class="num" id="3491462">1</span><span class="op" id="3491463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3491467">if</span>&nbsp;<span class="ident" id="3491470">_</span><span class="op" id="3491471">,</span>&nbsp;<span class="ident" id="3491473">ok</span>&nbsp;<span class="op" id="3491476">:=</span>&nbsp;<span class="ident" id="3491479">r</span><span class="op" id="3491480">.</span><span class="ident" id="3491481">Body</span><span class="op" id="3491485">.</span><span class="op" id="3491486">(</span><span class="op" id="3491487">*</span><span class="ident" id="3491488">maxBytesReader</span><span class="op" id="3491502">)</span><span class="op" id="3491503">;</span>&nbsp;<span class="op" id="3491505">!</span><span class="ident" id="3491506">ok</span>&nbsp;<span class="op" id="3491509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3491514">maxFormSize</span>&nbsp;<span class="op" id="3491526">=</span>&nbsp;<span class="ident" id="3491528">int64</span><span class="op" id="3491533">(</span><span class="num" id="3491534">10</span>&nbsp;<span class="op" id="3491537">&lt;&lt;</span>&nbsp;<span class="num" id="3491540">20</span><span class="op" id="3491542">)</span>&nbsp;<span class="comment" id="3491544">//&nbsp;10&nbsp;MB&nbsp;is&nbsp;a&nbsp;lot&nbsp;of&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3491574">reader</span>&nbsp;<span class="op" id="3491581">=</span>&nbsp;<span class="ident" id="3491583">io</span><span class="op" id="3491585">.</span><span class="ident" id="3491586">LimitReader</span><span class="op" id="3491597">(</span><span class="ident" id="3491598">r</span><span class="op" id="3491599">.</span><span class="ident" id="3491600">Body</span><span class="op" id="3491604">,</span>&nbsp;<span class="ident" id="3491606">maxFormSize</span><span class="op" id="3491617">+</span><span class="num" id="3491618">1</span><span class="op" id="3491619">)</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3491623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3491627">b</span><span class="op" id="3491628">,</span>&nbsp;<span class="ident" id="3491630">e</span>&nbsp;<span class="op" id="3491632">:=</span>&nbsp;<span class="ident" id="3491635">ioutil</span><span class="op" id="3491641">.</span><span class="ident" id="3491642">ReadAll</span><span class="op" id="3491649">(</span><span class="ident" id="3491650">reader</span><span class="op" id="3491656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3491660">if</span>&nbsp;<span class="ident" id="3491663">e</span>&nbsp;<span class="op" id="3491665">!=</span>&nbsp;<span class="ident" id="3491668">nil</span>&nbsp;<span class="op" id="3491672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3491677">if</span>&nbsp;<span class="ident" id="3491680">err</span>&nbsp;<span class="op" id="3491684">==</span>&nbsp;<span class="ident" id="3491687">nil</span>&nbsp;<span class="op" id="3491691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3491697">err</span>&nbsp;<span class="op" id="3491701">=</span>&nbsp;<span class="ident" id="3491703">e</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3491708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3491713">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3491721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3491725">if</span>&nbsp;<span class="ident" id="3491728">int64</span><span class="op" id="3491733">(</span><span class="builtinfunc" id="3491734">len</span><span class="op" id="3491737">(</span><span class="ident" id="3491738">b</span><span class="op" id="3491739">)</span><span class="op" id="3491740">)</span>&nbsp;<span class="op" id="3491742">&gt;</span>&nbsp;<span class="ident" id="3491744">maxFormSize</span>&nbsp;<span class="op" id="3491756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3491761">err</span>&nbsp;<span class="op" id="3491765">=</span>&nbsp;<span class="ident" id="3491767">errors</span><span class="op" id="3491773">.</span><span class="ident" id="3491774">New</span><span class="op" id="3491777">(</span><span class="string" id="3491778">&#34;http:&nbsp;POST&nbsp;too&nbsp;large&#34;</span><span class="op" id="3491800">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3491805">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3491814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3491818">vs</span><span class="op" id="3491820">,</span>&nbsp;<span class="ident" id="3491822">e</span>&nbsp;<span class="op" id="3491824">=</span>&nbsp;<span class="ident" id="3491826">url</span><span class="op" id="3491829">.</span><span class="ident" id="3491830">ParseQuery</span><span class="op" id="3491840">(</span><span class="builtintype" id="3491841">string</span><span class="op" id="3491847">(</span><span class="ident" id="3491848">b</span><span class="op" id="3491849">)</span><span class="op" id="3491850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3491854">if</span>&nbsp;<span class="ident" id="3491857">err</span>&nbsp;<span class="op" id="3491861">==</span>&nbsp;<span class="ident" id="3491864">nil</span>&nbsp;<span class="op" id="3491868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3491873">err</span>&nbsp;<span class="op" id="3491877">=</span>&nbsp;<span class="ident" id="3491879">e</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3491883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3491886">case</span>&nbsp;<span class="ident" id="3491891">ct</span>&nbsp;<span class="op" id="3491894">==</span>&nbsp;<span class="string" id="3491897">&#34;multipart/form-data&#34;</span><span class="op" id="3491918">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3491922">//&nbsp;handled&nbsp;by&nbsp;ParseMultipartForm&nbsp;(which&nbsp;is&nbsp;calling&nbsp;us,&nbsp;or&nbsp;should&nbsp;be)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3491993">//&nbsp;TODO(bradfitz):&nbsp;there&nbsp;are&nbsp;too&nbsp;many&nbsp;possible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3492042">//&nbsp;orders&nbsp;to&nbsp;call&nbsp;too&nbsp;many&nbsp;functions&nbsp;here.</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3492087">//&nbsp;Clean&nbsp;this&nbsp;up&nbsp;and&nbsp;write&nbsp;more&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3492128">//&nbsp;request_test.go&nbsp;contains&nbsp;the&nbsp;start&nbsp;of&nbsp;this,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3492177">//&nbsp;in&nbsp;TestParseMultipartFormOrder&nbsp;and&nbsp;others.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3492224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3492227">return</span><br>
<span class="lineno">765</span><span class="op" id="3492234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3492237">//&nbsp;ParseForm&nbsp;parses&nbsp;the&nbsp;raw&nbsp;query&nbsp;from&nbsp;the&nbsp;URL&nbsp;and&nbsp;updates&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="3492304">//</span><br>
<span class="lineno"></span><span class="comment" id="3492307">//&nbsp;For&nbsp;POST&nbsp;or&nbsp;PUT&nbsp;requests,&nbsp;it&nbsp;also&nbsp;parses&nbsp;the&nbsp;request&nbsp;body&nbsp;as&nbsp;a&nbsp;form&nbsp;and</span><br>
<span class="lineno">770</span><span class="comment" id="3492382">//&nbsp;put&nbsp;the&nbsp;results&nbsp;into&nbsp;both&nbsp;r.PostForm&nbsp;and&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="3492434">//&nbsp;POST&nbsp;and&nbsp;PUT&nbsp;body&nbsp;parameters&nbsp;take&nbsp;precedence&nbsp;over&nbsp;URL&nbsp;query&nbsp;string&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="3492511">//&nbsp;in&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="3492525">//</span><br>
<span class="lineno"></span><span class="comment" id="3492528">//&nbsp;If&nbsp;the&nbsp;request&nbsp;Body&#39;s&nbsp;size&nbsp;has&nbsp;not&nbsp;already&nbsp;been&nbsp;limited&nbsp;by&nbsp;MaxBytesReader,</span><br>
<span class="lineno">775</span><span class="comment" id="3492606">//&nbsp;the&nbsp;size&nbsp;is&nbsp;capped&nbsp;at&nbsp;10MB.</span><br>
<span class="lineno"></span><span class="comment" id="3492637">//</span><br>
<span class="lineno"></span><span class="comment" id="3492640">//&nbsp;ParseMultipartForm&nbsp;calls&nbsp;ParseForm&nbsp;automatically.</span><br>
<span class="lineno"></span><span class="comment" id="3492693">//&nbsp;It&nbsp;is&nbsp;idempotent.</span><br>
<span class="lineno"></span><span class="keyword" id="3492714">func</span>&nbsp;<span class="op" id="3492719">(</span><span class="ident" id="3492720">r</span>&nbsp;<span class="op" id="3492722">*</span><span class="ident" id="3492723">Request</span><span class="op" id="3492730">)</span>&nbsp;<span class="ident" id="3492732">ParseForm</span><span class="op" id="3492741">(</span><span class="op" id="3492742">)</span>&nbsp;<span class="builtintype" id="3492744">error</span>&nbsp;<span class="op" id="3492750">{</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3492753">var</span>&nbsp;<span class="ident" id="3492757">err</span>&nbsp;<span class="builtintype" id="3492761">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3492768">if</span>&nbsp;<span class="ident" id="3492771">r</span><span class="op" id="3492772">.</span><span class="ident" id="3492773">PostForm</span>&nbsp;<span class="op" id="3492782">==</span>&nbsp;<span class="ident" id="3492785">nil</span>&nbsp;<span class="op" id="3492789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3492793">if</span>&nbsp;<span class="ident" id="3492796">r</span><span class="op" id="3492797">.</span><span class="ident" id="3492798">Method</span>&nbsp;<span class="op" id="3492805">==</span>&nbsp;<span class="string" id="3492808">&#34;POST&#34;</span>&nbsp;<span class="op" id="3492815">||</span>&nbsp;<span class="ident" id="3492818">r</span><span class="op" id="3492819">.</span><span class="ident" id="3492820">Method</span>&nbsp;<span class="op" id="3492827">==</span>&nbsp;<span class="string" id="3492830">&#34;PUT&#34;</span>&nbsp;<span class="op" id="3492836">||</span>&nbsp;<span class="ident" id="3492839">r</span><span class="op" id="3492840">.</span><span class="ident" id="3492841">Method</span>&nbsp;<span class="op" id="3492848">==</span>&nbsp;<span class="string" id="3492851">&#34;PATCH&#34;</span>&nbsp;<span class="op" id="3492859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3492864">r</span><span class="op" id="3492865">.</span><span class="ident" id="3492866">PostForm</span><span class="op" id="3492874">,</span>&nbsp;<span class="ident" id="3492876">err</span>&nbsp;<span class="op" id="3492880">=</span>&nbsp;<span class="ident" id="3492882">parsePostForm</span><span class="op" id="3492895">(</span><span class="ident" id="3492896">r</span><span class="op" id="3492897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3492901">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3492905">if</span>&nbsp;<span class="ident" id="3492908">r</span><span class="op" id="3492909">.</span><span class="ident" id="3492910">PostForm</span>&nbsp;<span class="op" id="3492919">==</span>&nbsp;<span class="ident" id="3492922">nil</span>&nbsp;<span class="op" id="3492926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3492931">r</span><span class="op" id="3492932">.</span><span class="ident" id="3492933">PostForm</span>&nbsp;<span class="op" id="3492942">=</span>&nbsp;<span class="builtinfunc" id="3492944">make</span><span class="op" id="3492948">(</span><span class="ident" id="3492949">url</span><span class="op" id="3492952">.</span><span class="ident" id="3492953">Values</span><span class="op" id="3492959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3492963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3492966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3492969">if</span>&nbsp;<span class="ident" id="3492972">r</span><span class="op" id="3492973">.</span><span class="ident" id="3492974">Form</span>&nbsp;<span class="op" id="3492979">==</span>&nbsp;<span class="ident" id="3492982">nil</span>&nbsp;<span class="op" id="3492986">{</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3492990">if</span>&nbsp;<span class="builtinfunc" id="3492993">len</span><span class="op" id="3492996">(</span><span class="ident" id="3492997">r</span><span class="op" id="3492998">.</span><span class="ident" id="3492999">PostForm</span><span class="op" id="3493007">)</span>&nbsp;<span class="op" id="3493009">&gt;</span>&nbsp;<span class="num" id="3493011">0</span>&nbsp;<span class="op" id="3493013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3493018">r</span><span class="op" id="3493019">.</span><span class="ident" id="3493020">Form</span>&nbsp;<span class="op" id="3493025">=</span>&nbsp;<span class="builtinfunc" id="3493027">make</span><span class="op" id="3493031">(</span><span class="ident" id="3493032">url</span><span class="op" id="3493035">.</span><span class="ident" id="3493036">Values</span><span class="op" id="3493042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3493047">copyValues</span><span class="op" id="3493057">(</span><span class="ident" id="3493058">r</span><span class="op" id="3493059">.</span><span class="ident" id="3493060">Form</span><span class="op" id="3493064">,</span>&nbsp;<span class="ident" id="3493066">r</span><span class="op" id="3493067">.</span><span class="ident" id="3493068">PostForm</span><span class="op" id="3493076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3493080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3493084">var</span>&nbsp;<span class="ident" id="3493088">newValues</span>&nbsp;<span class="ident" id="3493098">url</span><span class="op" id="3493101">.</span><span class="ident" id="3493102">Values</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3493111">if</span>&nbsp;<span class="ident" id="3493114">r</span><span class="op" id="3493115">.</span><span class="ident" id="3493116">URL</span>&nbsp;<span class="op" id="3493120">!=</span>&nbsp;<span class="ident" id="3493123">nil</span>&nbsp;<span class="op" id="3493127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3493132">var</span>&nbsp;<span class="ident" id="3493136">e</span>&nbsp;<span class="builtintype" id="3493138">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3493147">newValues</span><span class="op" id="3493156">,</span>&nbsp;<span class="ident" id="3493158">e</span>&nbsp;<span class="op" id="3493160">=</span>&nbsp;<span class="ident" id="3493162">url</span><span class="op" id="3493165">.</span><span class="ident" id="3493166">ParseQuery</span><span class="op" id="3493176">(</span><span class="ident" id="3493177">r</span><span class="op" id="3493178">.</span><span class="ident" id="3493179">URL</span><span class="op" id="3493182">.</span><span class="ident" id="3493183">RawQuery</span><span class="op" id="3493191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3493196">if</span>&nbsp;<span class="ident" id="3493199">err</span>&nbsp;<span class="op" id="3493203">==</span>&nbsp;<span class="ident" id="3493206">nil</span>&nbsp;<span class="op" id="3493210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3493216">err</span>&nbsp;<span class="op" id="3493220">=</span>&nbsp;<span class="ident" id="3493222">e</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3493227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3493231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3493235">if</span>&nbsp;<span class="ident" id="3493238">newValues</span>&nbsp;<span class="op" id="3493248">==</span>&nbsp;<span class="ident" id="3493251">nil</span>&nbsp;<span class="op" id="3493255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3493260">newValues</span>&nbsp;<span class="op" id="3493270">=</span>&nbsp;<span class="builtinfunc" id="3493272">make</span><span class="op" id="3493276">(</span><span class="ident" id="3493277">url</span><span class="op" id="3493280">.</span><span class="ident" id="3493281">Values</span><span class="op" id="3493287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3493291">}</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3493295">if</span>&nbsp;<span class="ident" id="3493298">r</span><span class="op" id="3493299">.</span><span class="ident" id="3493300">Form</span>&nbsp;<span class="op" id="3493305">==</span>&nbsp;<span class="ident" id="3493308">nil</span>&nbsp;<span class="op" id="3493312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3493317">r</span><span class="op" id="3493318">.</span><span class="ident" id="3493319">Form</span>&nbsp;<span class="op" id="3493324">=</span>&nbsp;<span class="ident" id="3493326">newValues</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3493338">}</span>&nbsp;<span class="keyword" id="3493340">else</span>&nbsp;<span class="op" id="3493345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3493350">copyValues</span><span class="op" id="3493360">(</span><span class="ident" id="3493361">r</span><span class="op" id="3493362">.</span><span class="ident" id="3493363">Form</span><span class="op" id="3493367">,</span>&nbsp;<span class="ident" id="3493369">newValues</span><span class="op" id="3493378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3493382">}</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3493385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3493388">return</span>&nbsp;<span class="ident" id="3493395">err</span><br>
<span class="lineno"></span><span class="op" id="3493399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3493402">//&nbsp;ParseMultipartForm&nbsp;parses&nbsp;a&nbsp;request&nbsp;body&nbsp;as&nbsp;multipart/form-data.</span><br>
<span class="lineno">815</span><span class="comment" id="3493470">//&nbsp;The&nbsp;whole&nbsp;request&nbsp;body&nbsp;is&nbsp;parsed&nbsp;and&nbsp;up&nbsp;to&nbsp;a&nbsp;total&nbsp;of&nbsp;maxMemory&nbsp;bytes&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3493546">//&nbsp;its&nbsp;file&nbsp;parts&nbsp;are&nbsp;stored&nbsp;in&nbsp;memory,&nbsp;with&nbsp;the&nbsp;remainder&nbsp;stored&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="3493615">//&nbsp;disk&nbsp;in&nbsp;temporary&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="3493643">//&nbsp;ParseMultipartForm&nbsp;calls&nbsp;ParseForm&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="comment" id="3493695">//&nbsp;After&nbsp;one&nbsp;call&nbsp;to&nbsp;ParseMultipartForm,&nbsp;subsequent&nbsp;calls&nbsp;have&nbsp;no&nbsp;effect.</span><br>
<span class="lineno">820</span><span class="keyword" id="3493769">func</span>&nbsp;<span class="op" id="3493774">(</span><span class="ident" id="3493775">r</span>&nbsp;<span class="op" id="3493777">*</span><span class="ident" id="3493778">Request</span><span class="op" id="3493785">)</span>&nbsp;<span class="ident" id="3493787">ParseMultipartForm</span><span class="op" id="3493805">(</span><span class="ident" id="3493806">maxMemory</span>&nbsp;<span class="ident" id="3493816">int64</span><span class="op" id="3493821">)</span>&nbsp;<span class="builtintype" id="3493823">error</span>&nbsp;<span class="op" id="3493829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3493832">if</span>&nbsp;<span class="ident" id="3493835">r</span><span class="op" id="3493836">.</span><span class="ident" id="3493837">MultipartForm</span>&nbsp;<span class="op" id="3493851">==</span>&nbsp;<span class="ident" id="3493854">multipartByReader</span>&nbsp;<span class="op" id="3493872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3493876">return</span>&nbsp;<span class="ident" id="3493883">errors</span><span class="op" id="3493889">.</span><span class="ident" id="3493890">New</span><span class="op" id="3493893">(</span><span class="string" id="3493894">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;MultipartReader&#34;</span><span class="op" id="3493938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3493941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3493944">if</span>&nbsp;<span class="ident" id="3493947">r</span><span class="op" id="3493948">.</span><span class="ident" id="3493949">Form</span>&nbsp;<span class="op" id="3493954">==</span>&nbsp;<span class="ident" id="3493957">nil</span>&nbsp;<span class="op" id="3493961">{</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3493965">err</span>&nbsp;<span class="op" id="3493969">:=</span>&nbsp;<span class="ident" id="3493972">r</span><span class="op" id="3493973">.</span><span class="ident" id="3493974">ParseForm</span><span class="op" id="3493983">(</span><span class="op" id="3493984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3493988">if</span>&nbsp;<span class="ident" id="3493991">err</span>&nbsp;<span class="op" id="3493995">!=</span>&nbsp;<span class="ident" id="3493998">nil</span>&nbsp;<span class="op" id="3494002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494007">return</span>&nbsp;<span class="ident" id="3494014">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3494020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3494023">}</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494026">if</span>&nbsp;<span class="ident" id="3494029">r</span><span class="op" id="3494030">.</span><span class="ident" id="3494031">MultipartForm</span>&nbsp;<span class="op" id="3494045">!=</span>&nbsp;<span class="ident" id="3494048">nil</span>&nbsp;<span class="op" id="3494052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494056">return</span>&nbsp;<span class="ident" id="3494063">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3494068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3494072">mr</span><span class="op" id="3494074">,</span>&nbsp;<span class="ident" id="3494076">err</span>&nbsp;<span class="op" id="3494080">:=</span>&nbsp;<span class="ident" id="3494083">r</span><span class="op" id="3494084">.</span><span class="ident" id="3494085">multipartReader</span><span class="op" id="3494100">(</span><span class="op" id="3494101">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494104">if</span>&nbsp;<span class="ident" id="3494107">err</span>&nbsp;<span class="op" id="3494111">!=</span>&nbsp;<span class="ident" id="3494114">nil</span>&nbsp;<span class="op" id="3494118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494122">return</span>&nbsp;<span class="ident" id="3494129">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3494134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3494138">f</span><span class="op" id="3494139">,</span>&nbsp;<span class="ident" id="3494141">err</span>&nbsp;<span class="op" id="3494145">:=</span>&nbsp;<span class="ident" id="3494148">mr</span><span class="op" id="3494150">.</span><span class="ident" id="3494151">ReadForm</span><span class="op" id="3494159">(</span><span class="ident" id="3494160">maxMemory</span><span class="op" id="3494169">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494172">if</span>&nbsp;<span class="ident" id="3494175">err</span>&nbsp;<span class="op" id="3494179">!=</span>&nbsp;<span class="ident" id="3494182">nil</span>&nbsp;<span class="op" id="3494186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494190">return</span>&nbsp;<span class="ident" id="3494197">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3494202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494205">for</span>&nbsp;<span class="ident" id="3494209">k</span><span class="op" id="3494210">,</span>&nbsp;<span class="ident" id="3494212">v</span>&nbsp;<span class="op" id="3494214">:=</span>&nbsp;<span class="keyword" id="3494217">range</span>&nbsp;<span class="ident" id="3494223">f</span><span class="op" id="3494224">.</span><span class="ident" id="3494225">Value</span>&nbsp;<span class="op" id="3494231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3494235">r</span><span class="op" id="3494236">.</span><span class="ident" id="3494237">Form</span><span class="op" id="3494241">[</span><span class="ident" id="3494242">k</span><span class="op" id="3494243">]</span>&nbsp;<span class="op" id="3494245">=</span>&nbsp;<span class="builtinfunc" id="3494247">append</span><span class="op" id="3494253">(</span><span class="ident" id="3494254">r</span><span class="op" id="3494255">.</span><span class="ident" id="3494256">Form</span><span class="op" id="3494260">[</span><span class="ident" id="3494261">k</span><span class="op" id="3494262">]</span><span class="op" id="3494263">,</span>&nbsp;<span class="ident" id="3494265">v</span><span class="op" id="3494266">...</span><span class="op" id="3494269">)</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3494272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3494275">r</span><span class="op" id="3494276">.</span><span class="ident" id="3494277">MultipartForm</span>&nbsp;<span class="op" id="3494291">=</span>&nbsp;<span class="ident" id="3494293">f</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494297">return</span>&nbsp;<span class="ident" id="3494304">nil</span><br>
<span class="lineno"></span><span class="op" id="3494308">}</span><br>
<span class="lineno">850</span><br>
<span class="lineno"></span><span class="comment" id="3494311">//&nbsp;FormValue&nbsp;returns&nbsp;the&nbsp;first&nbsp;value&nbsp;for&nbsp;the&nbsp;named&nbsp;component&nbsp;of&nbsp;the&nbsp;query.</span><br>
<span class="lineno"></span><span class="comment" id="3494386">//&nbsp;POST&nbsp;and&nbsp;PUT&nbsp;body&nbsp;parameters&nbsp;take&nbsp;precedence&nbsp;over&nbsp;URL&nbsp;query&nbsp;string&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="3494464">//&nbsp;FormValue&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary&nbsp;and&nbsp;ignores</span><br>
<span class="lineno"></span><span class="comment" id="3494541">//&nbsp;any&nbsp;errors&nbsp;returned&nbsp;by&nbsp;these&nbsp;functions.</span><br>
<span class="lineno">855</span><span class="comment" id="3494584">//&nbsp;To&nbsp;access&nbsp;multiple&nbsp;values&nbsp;of&nbsp;the&nbsp;same&nbsp;key,&nbsp;call&nbsp;ParseForm&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3494649">//&nbsp;then&nbsp;inspect&nbsp;Request.Form&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="3494688">func</span>&nbsp;<span class="op" id="3494693">(</span><span class="ident" id="3494694">r</span>&nbsp;<span class="op" id="3494696">*</span><span class="ident" id="3494697">Request</span><span class="op" id="3494704">)</span>&nbsp;<span class="ident" id="3494706">FormValue</span><span class="op" id="3494715">(</span><span class="ident" id="3494716">key</span>&nbsp;<span class="builtintype" id="3494720">string</span><span class="op" id="3494726">)</span>&nbsp;<span class="builtintype" id="3494728">string</span>&nbsp;<span class="op" id="3494735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494738">if</span>&nbsp;<span class="ident" id="3494741">r</span><span class="op" id="3494742">.</span><span class="ident" id="3494743">Form</span>&nbsp;<span class="op" id="3494748">==</span>&nbsp;<span class="ident" id="3494751">nil</span>&nbsp;<span class="op" id="3494755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3494759">r</span><span class="op" id="3494760">.</span><span class="ident" id="3494761">ParseMultipartForm</span><span class="op" id="3494779">(</span><span class="ident" id="3494780">defaultMaxMemory</span><span class="op" id="3494796">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3494799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494802">if</span>&nbsp;<span class="ident" id="3494805">vs</span>&nbsp;<span class="op" id="3494808">:=</span>&nbsp;<span class="ident" id="3494811">r</span><span class="op" id="3494812">.</span><span class="ident" id="3494813">Form</span><span class="op" id="3494817">[</span><span class="ident" id="3494818">key</span><span class="op" id="3494821">]</span><span class="op" id="3494822">;</span>&nbsp;<span class="builtinfunc" id="3494824">len</span><span class="op" id="3494827">(</span><span class="ident" id="3494828">vs</span><span class="op" id="3494830">)</span>&nbsp;<span class="op" id="3494832">&gt;</span>&nbsp;<span class="num" id="3494834">0</span>&nbsp;<span class="op" id="3494836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494840">return</span>&nbsp;<span class="ident" id="3494847">vs</span><span class="op" id="3494849">[</span><span class="num" id="3494850">0</span><span class="op" id="3494851">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3494854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494857">return</span>&nbsp;<span class="string" id="3494864">&#34;&#34;</span><br>
<span class="lineno">865</span><span class="op" id="3494867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3494870">//&nbsp;PostFormValue&nbsp;returns&nbsp;the&nbsp;first&nbsp;value&nbsp;for&nbsp;the&nbsp;named&nbsp;component&nbsp;of&nbsp;the&nbsp;POST</span><br>
<span class="lineno"></span><span class="comment" id="3494947">//&nbsp;or&nbsp;PUT&nbsp;request&nbsp;body.&nbsp;URL&nbsp;query&nbsp;parameters&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="3495005">//&nbsp;PostFormValue&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary&nbsp;and&nbsp;ignores</span><br>
<span class="lineno">870</span><span class="comment" id="3495086">//&nbsp;any&nbsp;errors&nbsp;returned&nbsp;by&nbsp;these&nbsp;functions.</span><br>
<span class="lineno"></span><span class="keyword" id="3495129">func</span>&nbsp;<span class="op" id="3495134">(</span><span class="ident" id="3495135">r</span>&nbsp;<span class="op" id="3495137">*</span><span class="ident" id="3495138">Request</span><span class="op" id="3495145">)</span>&nbsp;<span class="ident" id="3495147">PostFormValue</span><span class="op" id="3495160">(</span><span class="ident" id="3495161">key</span>&nbsp;<span class="builtintype" id="3495165">string</span><span class="op" id="3495171">)</span>&nbsp;<span class="builtintype" id="3495173">string</span>&nbsp;<span class="op" id="3495180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495183">if</span>&nbsp;<span class="ident" id="3495186">r</span><span class="op" id="3495187">.</span><span class="ident" id="3495188">PostForm</span>&nbsp;<span class="op" id="3495197">==</span>&nbsp;<span class="ident" id="3495200">nil</span>&nbsp;<span class="op" id="3495204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3495208">r</span><span class="op" id="3495209">.</span><span class="ident" id="3495210">ParseMultipartForm</span><span class="op" id="3495228">(</span><span class="ident" id="3495229">defaultMaxMemory</span><span class="op" id="3495245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3495248">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495251">if</span>&nbsp;<span class="ident" id="3495254">vs</span>&nbsp;<span class="op" id="3495257">:=</span>&nbsp;<span class="ident" id="3495260">r</span><span class="op" id="3495261">.</span><span class="ident" id="3495262">PostForm</span><span class="op" id="3495270">[</span><span class="ident" id="3495271">key</span><span class="op" id="3495274">]</span><span class="op" id="3495275">;</span>&nbsp;<span class="builtinfunc" id="3495277">len</span><span class="op" id="3495280">(</span><span class="ident" id="3495281">vs</span><span class="op" id="3495283">)</span>&nbsp;<span class="op" id="3495285">&gt;</span>&nbsp;<span class="num" id="3495287">0</span>&nbsp;<span class="op" id="3495289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495293">return</span>&nbsp;<span class="ident" id="3495300">vs</span><span class="op" id="3495302">[</span><span class="num" id="3495303">0</span><span class="op" id="3495304">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3495307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495310">return</span>&nbsp;<span class="string" id="3495317">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3495320">}</span><br>
<span class="lineno">880</span><br>
<span class="lineno"></span><span class="comment" id="3495323">//&nbsp;FormFile&nbsp;returns&nbsp;the&nbsp;first&nbsp;file&nbsp;for&nbsp;the&nbsp;provided&nbsp;form&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="3495385">//&nbsp;FormFile&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="3495450">func</span>&nbsp;<span class="op" id="3495455">(</span><span class="ident" id="3495456">r</span>&nbsp;<span class="op" id="3495458">*</span><span class="ident" id="3495459">Request</span><span class="op" id="3495466">)</span>&nbsp;<span class="ident" id="3495468">FormFile</span><span class="op" id="3495476">(</span><span class="ident" id="3495477">key</span>&nbsp;<span class="builtintype" id="3495481">string</span><span class="op" id="3495487">)</span>&nbsp;<span class="op" id="3495489">(</span><span class="ident" id="3495490">multipart</span><span class="op" id="3495499">.</span><span class="ident" id="3495500">File</span><span class="op" id="3495504">,</span>&nbsp;<span class="op" id="3495506">*</span><span class="ident" id="3495507">multipart</span><span class="op" id="3495516">.</span><span class="ident" id="3495517">FileHeader</span><span class="op" id="3495527">,</span>&nbsp;<span class="builtintype" id="3495529">error</span><span class="op" id="3495534">)</span>&nbsp;<span class="op" id="3495536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495539">if</span>&nbsp;<span class="ident" id="3495542">r</span><span class="op" id="3495543">.</span><span class="ident" id="3495544">MultipartForm</span>&nbsp;<span class="op" id="3495558">==</span>&nbsp;<span class="ident" id="3495561">multipartByReader</span>&nbsp;<span class="op" id="3495579">{</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495583">return</span>&nbsp;<span class="ident" id="3495590">nil</span><span class="op" id="3495593">,</span>&nbsp;<span class="ident" id="3495595">nil</span><span class="op" id="3495598">,</span>&nbsp;<span class="ident" id="3495600">errors</span><span class="op" id="3495606">.</span><span class="ident" id="3495607">New</span><span class="op" id="3495610">(</span><span class="string" id="3495611">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;MultipartReader&#34;</span><span class="op" id="3495655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3495658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495661">if</span>&nbsp;<span class="ident" id="3495664">r</span><span class="op" id="3495665">.</span><span class="ident" id="3495666">MultipartForm</span>&nbsp;<span class="op" id="3495680">==</span>&nbsp;<span class="ident" id="3495683">nil</span>&nbsp;<span class="op" id="3495687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3495691">err</span>&nbsp;<span class="op" id="3495695">:=</span>&nbsp;<span class="ident" id="3495698">r</span><span class="op" id="3495699">.</span><span class="ident" id="3495700">ParseMultipartForm</span><span class="op" id="3495718">(</span><span class="ident" id="3495719">defaultMaxMemory</span><span class="op" id="3495735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495739">if</span>&nbsp;<span class="ident" id="3495742">err</span>&nbsp;<span class="op" id="3495746">!=</span>&nbsp;<span class="ident" id="3495749">nil</span>&nbsp;<span class="op" id="3495753">{</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495758">return</span>&nbsp;<span class="ident" id="3495765">nil</span><span class="op" id="3495768">,</span>&nbsp;<span class="ident" id="3495770">nil</span><span class="op" id="3495773">,</span>&nbsp;<span class="ident" id="3495775">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3495781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3495784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495787">if</span>&nbsp;<span class="ident" id="3495790">r</span><span class="op" id="3495791">.</span><span class="ident" id="3495792">MultipartForm</span>&nbsp;<span class="op" id="3495806">!=</span>&nbsp;<span class="ident" id="3495809">nil</span>&nbsp;<span class="op" id="3495813">&amp;&amp;</span>&nbsp;<span class="ident" id="3495816">r</span><span class="op" id="3495817">.</span><span class="ident" id="3495818">MultipartForm</span><span class="op" id="3495831">.</span><span class="ident" id="3495832">File</span>&nbsp;<span class="op" id="3495837">!=</span>&nbsp;<span class="ident" id="3495840">nil</span>&nbsp;<span class="op" id="3495844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495848">if</span>&nbsp;<span class="ident" id="3495851">fhs</span>&nbsp;<span class="op" id="3495855">:=</span>&nbsp;<span class="ident" id="3495858">r</span><span class="op" id="3495859">.</span><span class="ident" id="3495860">MultipartForm</span><span class="op" id="3495873">.</span><span class="ident" id="3495874">File</span><span class="op" id="3495878">[</span><span class="ident" id="3495879">key</span><span class="op" id="3495882">]</span><span class="op" id="3495883">;</span>&nbsp;<span class="builtinfunc" id="3495885">len</span><span class="op" id="3495888">(</span><span class="ident" id="3495889">fhs</span><span class="op" id="3495892">)</span>&nbsp;<span class="op" id="3495894">&gt;</span>&nbsp;<span class="num" id="3495896">0</span>&nbsp;<span class="op" id="3495898">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3495903">f</span><span class="op" id="3495904">,</span>&nbsp;<span class="ident" id="3495906">err</span>&nbsp;<span class="op" id="3495910">:=</span>&nbsp;<span class="ident" id="3495913">fhs</span><span class="op" id="3495916">[</span><span class="num" id="3495917">0</span><span class="op" id="3495918">]</span><span class="op" id="3495919">.</span><span class="ident" id="3495920">Open</span><span class="op" id="3495924">(</span><span class="op" id="3495925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495930">return</span>&nbsp;<span class="ident" id="3495937">f</span><span class="op" id="3495938">,</span>&nbsp;<span class="ident" id="3495940">fhs</span><span class="op" id="3495943">[</span><span class="num" id="3495944">0</span><span class="op" id="3495945">]</span><span class="op" id="3495946">,</span>&nbsp;<span class="ident" id="3495948">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3495954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3495957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495960">return</span>&nbsp;<span class="ident" id="3495967">nil</span><span class="op" id="3495970">,</span>&nbsp;<span class="ident" id="3495972">nil</span><span class="op" id="3495975">,</span>&nbsp;<span class="ident" id="3495977">ErrMissingFile</span><br>
<span class="lineno">900</span><span class="op" id="3495992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3495995">func</span>&nbsp;<span class="op" id="3496000">(</span><span class="ident" id="3496001">r</span>&nbsp;<span class="op" id="3496003">*</span><span class="ident" id="3496004">Request</span><span class="op" id="3496011">)</span>&nbsp;<span class="ident" id="3496013">expectsContinue</span><span class="op" id="3496028">(</span><span class="op" id="3496029">)</span>&nbsp;<span class="builtintype" id="3496031">bool</span>&nbsp;<span class="op" id="3496036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496039">return</span>&nbsp;<span class="ident" id="3496046">hasToken</span><span class="op" id="3496054">(</span><span class="ident" id="3496055">r</span><span class="op" id="3496056">.</span><span class="ident" id="3496057">Header</span><span class="op" id="3496063">.</span><span class="ident" id="3496064">get</span><span class="op" id="3496067">(</span><span class="string" id="3496068">&#34;Expect&#34;</span><span class="op" id="3496076">)</span><span class="op" id="3496077">,</span>&nbsp;<span class="string" id="3496079">&#34;100-continue&#34;</span><span class="op" id="3496093">)</span><br>
<span class="lineno"></span><span class="op" id="3496095">}</span><br>
<span class="lineno">905</span><br>
<span class="lineno"></span><span class="keyword" id="3496098">func</span>&nbsp;<span class="op" id="3496103">(</span><span class="ident" id="3496104">r</span>&nbsp;<span class="op" id="3496106">*</span><span class="ident" id="3496107">Request</span><span class="op" id="3496114">)</span>&nbsp;<span class="ident" id="3496116">wantsHttp10KeepAlive</span><span class="op" id="3496136">(</span><span class="op" id="3496137">)</span>&nbsp;<span class="builtintype" id="3496139">bool</span>&nbsp;<span class="op" id="3496144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496147">if</span>&nbsp;<span class="ident" id="3496150">r</span><span class="op" id="3496151">.</span><span class="ident" id="3496152">ProtoMajor</span>&nbsp;<span class="op" id="3496163">!=</span>&nbsp;<span class="num" id="3496166">1</span>&nbsp;<span class="op" id="3496168">||</span>&nbsp;<span class="ident" id="3496171">r</span><span class="op" id="3496172">.</span><span class="ident" id="3496173">ProtoMinor</span>&nbsp;<span class="op" id="3496184">!=</span>&nbsp;<span class="num" id="3496187">0</span>&nbsp;<span class="op" id="3496189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496193">return</span>&nbsp;<span class="builtintype" id="3496200">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3496207">}</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496210">return</span>&nbsp;<span class="ident" id="3496217">hasToken</span><span class="op" id="3496225">(</span><span class="ident" id="3496226">r</span><span class="op" id="3496227">.</span><span class="ident" id="3496228">Header</span><span class="op" id="3496234">.</span><span class="ident" id="3496235">get</span><span class="op" id="3496238">(</span><span class="string" id="3496239">&#34;Connection&#34;</span><span class="op" id="3496251">)</span><span class="op" id="3496252">,</span>&nbsp;<span class="string" id="3496254">&#34;keep-alive&#34;</span><span class="op" id="3496266">)</span><br>
<span class="lineno"></span><span class="op" id="3496268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3496271">func</span>&nbsp;<span class="op" id="3496276">(</span><span class="ident" id="3496277">r</span>&nbsp;<span class="op" id="3496279">*</span><span class="ident" id="3496280">Request</span><span class="op" id="3496287">)</span>&nbsp;<span class="ident" id="3496289">wantsClose</span><span class="op" id="3496299">(</span><span class="op" id="3496300">)</span>&nbsp;<span class="builtintype" id="3496302">bool</span>&nbsp;<span class="op" id="3496307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496310">return</span>&nbsp;<span class="ident" id="3496317">hasToken</span><span class="op" id="3496325">(</span><span class="ident" id="3496326">r</span><span class="op" id="3496327">.</span><span class="ident" id="3496328">Header</span><span class="op" id="3496334">.</span><span class="ident" id="3496335">get</span><span class="op" id="3496338">(</span><span class="string" id="3496339">&#34;Connection&#34;</span><span class="op" id="3496351">)</span><span class="op" id="3496352">,</span>&nbsp;<span class="string" id="3496354">&#34;close&#34;</span><span class="op" id="3496361">)</span><br>
<span class="lineno">915</span><span class="op" id="3496363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3496366">func</span>&nbsp;<span class="op" id="3496371">(</span><span class="ident" id="3496372">r</span>&nbsp;<span class="op" id="3496374">*</span><span class="ident" id="3496375">Request</span><span class="op" id="3496382">)</span>&nbsp;<span class="ident" id="3496384">closeBody</span><span class="op" id="3496393">(</span><span class="op" id="3496394">)</span>&nbsp;<span class="op" id="3496396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496399">if</span>&nbsp;<span class="ident" id="3496402">r</span><span class="op" id="3496403">.</span><span class="ident" id="3496404">Body</span>&nbsp;<span class="op" id="3496409">!=</span>&nbsp;<span class="ident" id="3496412">nil</span>&nbsp;<span class="op" id="3496416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3496420">r</span><span class="op" id="3496421">.</span><span class="ident" id="3496422">Body</span><span class="op" id="3496426">.</span><span class="ident" id="3496427">Close</span><span class="op" id="3496432">(</span><span class="op" id="3496433">)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3496436">}</span><br>
<span class="lineno"></span><span class="op" id="3496438">}</span>
</div>
</body>
</html>
