<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/json</h2>
<ul>
<li><a href="/gostd/encoding/json/bench_test.go.html">bench_test.go</a></li>
<li><a href="/gostd/encoding/json/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/json/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/encoding/json/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/json/encode_test.go.html">encode_test.go</a></li>
<li><a href="/gostd/encoding/json/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/json/fold.go.html">fold.go</a></li>
<li><a href="/gostd/encoding/json/fold_test.go.html">fold_test.go</a></li>
<li><a href="/gostd/encoding/json/indent.go.html">indent.go</a></li>
<li><a href="/gostd/encoding/json/scanner.go.html">scanner.go</a></li>
<li><a href="/gostd/encoding/json/scanner_test.go.html">scanner_test.go</a></li>
<li><a href="/gostd/encoding/json/stream.go.html">stream.go</a></li>
<li><a href="/gostd/encoding/json/stream_test.go.html">stream_test.go</a></li>
<li><a href="/gostd/encoding/json/tagkey_test.go.html">tagkey_test.go</a></li>
<li><a href="/gostd/encoding/json/tags.go.html">tags.go</a></li>
<li><a href="/gostd/encoding/json/tags_test.go.html">tags_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8136294">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8136349">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8136403">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8136454">package</span>&nbsp;<span class="ident" id="8136462">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8136468">import</span>&nbsp;<span class="op" id="8136475">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8136478">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8136487">&#34;math&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8136495">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8136506">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8136517">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="8136527">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="8136530">type</span>&nbsp;<span class="ident" id="8136535">Optionals</span>&nbsp;<span class="keyword" id="8136545">struct</span>&nbsp;<span class="op" id="8136552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136555">Sr</span>&nbsp;<span class="builtintype" id="8136558">string</span>&nbsp;<span class="string" id="8136565">`json:&#34;sr&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136578">So</span>&nbsp;<span class="builtintype" id="8136581">string</span>&nbsp;<span class="string" id="8136588">`json:&#34;so,omitempty&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136611">Sw</span>&nbsp;<span class="builtintype" id="8136614">string</span>&nbsp;<span class="string" id="8136621">`json:&#34;-&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136634">Ir</span>&nbsp;<span class="builtintype" id="8136637">int</span>&nbsp;<span class="string" id="8136641">`json:&#34;omitempty&#34;`</span>&nbsp;<span class="comment" id="8136660">//&nbsp;actually&nbsp;named&nbsp;omitempty,&nbsp;not&nbsp;an&nbsp;option</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136704">Io</span>&nbsp;<span class="builtintype" id="8136707">int</span>&nbsp;<span class="string" id="8136711">`json:&#34;io,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136735">Slr</span>&nbsp;<span class="op" id="8136739">[</span><span class="op" id="8136740">]</span><span class="builtintype" id="8136741">string</span>&nbsp;<span class="string" id="8136748">`json:&#34;slr,random&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136769">Slo</span>&nbsp;<span class="op" id="8136773">[</span><span class="op" id="8136774">]</span><span class="builtintype" id="8136775">string</span>&nbsp;<span class="string" id="8136782">`json:&#34;slo,omitempty&#34;`</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136807">Mr</span>&nbsp;<span class="keyword" id="8136810">map</span><span class="op" id="8136813">[</span><span class="builtintype" id="8136814">string</span><span class="op" id="8136820">]</span><span class="keyword" id="8136821">interface</span><span class="op" id="8136830">{</span><span class="op" id="8136831">}</span>&nbsp;<span class="string" id="8136833">`json:&#34;mr&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136846">Mo</span>&nbsp;<span class="keyword" id="8136849">map</span><span class="op" id="8136852">[</span><span class="builtintype" id="8136853">string</span><span class="op" id="8136859">]</span><span class="keyword" id="8136860">interface</span><span class="op" id="8136869">{</span><span class="op" id="8136870">}</span>&nbsp;<span class="string" id="8136872">`json:&#34;,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136894">Fr</span>&nbsp;<span class="builtintype" id="8136897">float64</span>&nbsp;<span class="string" id="8136905">`json:&#34;fr&#34;`</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136918">Fo</span>&nbsp;<span class="builtintype" id="8136921">float64</span>&nbsp;<span class="string" id="8136929">`json:&#34;fo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136953">Br</span>&nbsp;<span class="builtintype" id="8136956">bool</span>&nbsp;<span class="string" id="8136961">`json:&#34;br&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136974">Bo</span>&nbsp;<span class="builtintype" id="8136977">bool</span>&nbsp;<span class="string" id="8136982">`json:&#34;bo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137006">Ur</span>&nbsp;<span class="builtintype" id="8137009">uint</span>&nbsp;<span class="string" id="8137014">`json:&#34;ur&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137027">Uo</span>&nbsp;<span class="builtintype" id="8137030">uint</span>&nbsp;<span class="string" id="8137035">`json:&#34;uo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137059">Str</span>&nbsp;<span class="keyword" id="8137063">struct</span><span class="op" id="8137069">{</span><span class="op" id="8137070">}</span>&nbsp;<span class="string" id="8137072">`json:&#34;str&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137086">Sto</span>&nbsp;<span class="keyword" id="8137090">struct</span><span class="op" id="8137096">{</span><span class="op" id="8137097">}</span>&nbsp;<span class="string" id="8137099">`json:&#34;sto,omitempty&#34;`</span><br>
<span class="lineno">40</span><span class="op" id="8137122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8137125">var</span>&nbsp;<span class="ident" id="8137129">optionalsExpected</span>&nbsp;<span class="op" id="8137147">=</span>&nbsp;<span class="string" id="8137149">`{<br>
<span class="lineno"></span>&nbsp;&#34;sr&#34;:&nbsp;&#34;&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;omitempty&#34;:&nbsp;0,<br>
<span class="lineno">45</span>&nbsp;&#34;slr&#34;:&nbsp;null,<br>
<span class="lineno"></span>&nbsp;&#34;mr&#34;:&nbsp;{},<br>
<span class="lineno"></span>&nbsp;&#34;fr&#34;:&nbsp;0,<br>
<span class="lineno"></span>&nbsp;&#34;br&#34;:&nbsp;false,<br>
<span class="lineno"></span>&nbsp;&#34;ur&#34;:&nbsp;0,<br>
<span class="lineno">50</span>&nbsp;&#34;str&#34;:&nbsp;{},<br>
<span class="lineno"></span>&nbsp;&#34;sto&#34;:&nbsp;{}<br>
<span class="lineno"></span>}`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8137266">func</span>&nbsp;<span class="ident" id="8137271">TestOmitEmpty</span><span class="op" id="8137284">(</span><span class="ident" id="8137285">t</span>&nbsp;<span class="op" id="8137287">*</span><span class="ident" id="8137288">testing</span><span class="op" id="8137295">.</span><span class="ident" id="8137296">T</span><span class="op" id="8137297">)</span>&nbsp;<span class="op" id="8137299">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8137302">var</span>&nbsp;<span class="ident" id="8137306">o</span>&nbsp;<span class="ident" id="8137308">Optionals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137319">o</span><span class="op" id="8137320">.</span><span class="ident" id="8137321">Sw</span>&nbsp;<span class="op" id="8137324">=</span>&nbsp;<span class="string" id="8137326">&#34;something&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137339">o</span><span class="op" id="8137340">.</span><span class="ident" id="8137341">Mr</span>&nbsp;<span class="op" id="8137344">=</span>&nbsp;<span class="keyword" id="8137346">map</span><span class="op" id="8137349">[</span><span class="builtintype" id="8137350">string</span><span class="op" id="8137356">]</span><span class="keyword" id="8137357">interface</span><span class="op" id="8137366">{</span><span class="op" id="8137367">}</span><span class="op" id="8137368">{</span><span class="op" id="8137369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137372">o</span><span class="op" id="8137373">.</span><span class="ident" id="8137374">Mo</span>&nbsp;<span class="op" id="8137377">=</span>&nbsp;<span class="keyword" id="8137379">map</span><span class="op" id="8137382">[</span><span class="builtintype" id="8137383">string</span><span class="op" id="8137389">]</span><span class="keyword" id="8137390">interface</span><span class="op" id="8137399">{</span><span class="op" id="8137400">}</span><span class="op" id="8137401">{</span><span class="op" id="8137402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137406">got</span><span class="op" id="8137409">,</span>&nbsp;<span class="ident" id="8137411">err</span>&nbsp;<span class="op" id="8137415">:=</span>&nbsp;<span class="ident" id="8137418">MarshalIndent</span><span class="op" id="8137431">(</span><span class="op" id="8137432">&amp;</span><span class="ident" id="8137433">o</span><span class="op" id="8137434">,</span>&nbsp;<span class="string" id="8137436">&#34;&#34;</span><span class="op" id="8137438">,</span>&nbsp;<span class="string" id="8137440">&#34;&nbsp;&#34;</span><span class="op" id="8137443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8137446">if</span>&nbsp;<span class="ident" id="8137449">err</span>&nbsp;<span class="op" id="8137453">!=</span>&nbsp;<span class="ident" id="8137456">nil</span>&nbsp;<span class="op" id="8137460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137464">t</span><span class="op" id="8137465">.</span><span class="ident" id="8137466">Fatal</span><span class="op" id="8137471">(</span><span class="ident" id="8137472">err</span><span class="op" id="8137475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8137478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8137481">if</span>&nbsp;<span class="ident" id="8137484">got</span>&nbsp;<span class="op" id="8137488">:=</span>&nbsp;<span class="builtintype" id="8137491">string</span><span class="op" id="8137497">(</span><span class="ident" id="8137498">got</span><span class="op" id="8137501">)</span><span class="op" id="8137502">;</span>&nbsp;<span class="ident" id="8137504">got</span>&nbsp;<span class="op" id="8137508">!=</span>&nbsp;<span class="ident" id="8137511">optionalsExpected</span>&nbsp;<span class="op" id="8137529">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137533">t</span><span class="op" id="8137534">.</span><span class="ident" id="8137535">Errorf</span><span class="op" id="8137541">(</span><span class="string" id="8137542">&#34;&nbsp;got:&nbsp;%s\nwant:&nbsp;%s\n&#34;</span><span class="op" id="8137564">,</span>&nbsp;<span class="ident" id="8137566">got</span><span class="op" id="8137569">,</span>&nbsp;<span class="ident" id="8137571">optionalsExpected</span><span class="op" id="8137588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8137591">}</span><br>
<span class="lineno"></span><span class="op" id="8137593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8137596">type</span>&nbsp;<span class="ident" id="8137601">StringTag</span>&nbsp;<span class="keyword" id="8137611">struct</span>&nbsp;<span class="op" id="8137618">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137621">BoolStr</span>&nbsp;<span class="builtintype" id="8137629">bool</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8137636">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137654">IntStr</span>&nbsp;&nbsp;<span class="ident" id="8137662">int64</span>&nbsp;&nbsp;<span class="string" id="8137669">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137687">StrStr</span>&nbsp;&nbsp;<span class="builtintype" id="8137695">string</span>&nbsp;<span class="string" id="8137702">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span><span class="op" id="8137719">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="8137722">var</span>&nbsp;<span class="ident" id="8137726">stringTagExpected</span>&nbsp;<span class="op" id="8137744">=</span>&nbsp;<span class="string" id="8137746">`{<br>
<span class="lineno"></span>&nbsp;&#34;BoolStr&#34;:&nbsp;&#34;true&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;IntStr&#34;:&nbsp;&#34;42&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;StrStr&#34;:&nbsp;&#34;\&#34;xzbit\&#34;&#34;<br>
<span class="lineno"></span>}`</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="8137813">func</span>&nbsp;<span class="ident" id="8137818">TestStringTag</span><span class="op" id="8137831">(</span><span class="ident" id="8137832">t</span>&nbsp;<span class="op" id="8137834">*</span><span class="ident" id="8137835">testing</span><span class="op" id="8137842">.</span><span class="ident" id="8137843">T</span><span class="op" id="8137844">)</span>&nbsp;<span class="op" id="8137846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8137849">var</span>&nbsp;<span class="ident" id="8137853">s</span>&nbsp;<span class="ident" id="8137855">StringTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137866">s</span><span class="op" id="8137867">.</span><span class="ident" id="8137868">BoolStr</span>&nbsp;<span class="op" id="8137876">=</span>&nbsp;<span class="builtintype" id="8137878">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137884">s</span><span class="op" id="8137885">.</span><span class="ident" id="8137886">IntStr</span>&nbsp;<span class="op" id="8137893">=</span>&nbsp;<span class="num" id="8137895">42</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137899">s</span><span class="op" id="8137900">.</span><span class="ident" id="8137901">StrStr</span>&nbsp;<span class="op" id="8137908">=</span>&nbsp;<span class="string" id="8137910">&#34;xzbit&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137919">got</span><span class="op" id="8137922">,</span>&nbsp;<span class="ident" id="8137924">err</span>&nbsp;<span class="op" id="8137928">:=</span>&nbsp;<span class="ident" id="8137931">MarshalIndent</span><span class="op" id="8137944">(</span><span class="op" id="8137945">&amp;</span><span class="ident" id="8137946">s</span><span class="op" id="8137947">,</span>&nbsp;<span class="string" id="8137949">&#34;&#34;</span><span class="op" id="8137951">,</span>&nbsp;<span class="string" id="8137953">&#34;&nbsp;&#34;</span><span class="op" id="8137956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8137959">if</span>&nbsp;<span class="ident" id="8137962">err</span>&nbsp;<span class="op" id="8137966">!=</span>&nbsp;<span class="ident" id="8137969">nil</span>&nbsp;<span class="op" id="8137973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137977">t</span><span class="op" id="8137978">.</span><span class="ident" id="8137979">Fatal</span><span class="op" id="8137984">(</span><span class="ident" id="8137985">err</span><span class="op" id="8137988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8137991">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8137994">if</span>&nbsp;<span class="ident" id="8137997">got</span>&nbsp;<span class="op" id="8138001">:=</span>&nbsp;<span class="builtintype" id="8138004">string</span><span class="op" id="8138010">(</span><span class="ident" id="8138011">got</span><span class="op" id="8138014">)</span><span class="op" id="8138015">;</span>&nbsp;<span class="ident" id="8138017">got</span>&nbsp;<span class="op" id="8138021">!=</span>&nbsp;<span class="ident" id="8138024">stringTagExpected</span>&nbsp;<span class="op" id="8138042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138046">t</span><span class="op" id="8138047">.</span><span class="ident" id="8138048">Fatalf</span><span class="op" id="8138054">(</span><span class="string" id="8138055">&#34;&nbsp;got:&nbsp;%s\nwant:&nbsp;%s\n&#34;</span><span class="op" id="8138077">,</span>&nbsp;<span class="ident" id="8138079">got</span><span class="op" id="8138082">,</span>&nbsp;<span class="ident" id="8138084">stringTagExpected</span><span class="op" id="8138101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8138104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8138108">//&nbsp;Verify&nbsp;that&nbsp;it&nbsp;round-trips.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8138140">var</span>&nbsp;<span class="ident" id="8138144">s2</span>&nbsp;<span class="ident" id="8138147">StringTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138158">err</span>&nbsp;<span class="op" id="8138162">=</span>&nbsp;<span class="ident" id="8138164">NewDecoder</span><span class="op" id="8138174">(</span><span class="ident" id="8138175">bytes</span><span class="op" id="8138180">.</span><span class="ident" id="8138181">NewReader</span><span class="op" id="8138190">(</span><span class="ident" id="8138191">got</span><span class="op" id="8138194">)</span><span class="op" id="8138195">)</span><span class="op" id="8138196">.</span><span class="ident" id="8138197">Decode</span><span class="op" id="8138203">(</span><span class="op" id="8138204">&amp;</span><span class="ident" id="8138205">s2</span><span class="op" id="8138207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8138210">if</span>&nbsp;<span class="ident" id="8138213">err</span>&nbsp;<span class="op" id="8138217">!=</span>&nbsp;<span class="ident" id="8138220">nil</span>&nbsp;<span class="op" id="8138224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138228">t</span><span class="op" id="8138229">.</span><span class="ident" id="8138230">Fatalf</span><span class="op" id="8138236">(</span><span class="string" id="8138237">&#34;Decode:&nbsp;%v&#34;</span><span class="op" id="8138249">,</span>&nbsp;<span class="ident" id="8138251">err</span><span class="op" id="8138254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8138257">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8138260">if</span>&nbsp;<span class="op" id="8138263">!</span><span class="ident" id="8138264">reflect</span><span class="op" id="8138271">.</span><span class="ident" id="8138272">DeepEqual</span><span class="op" id="8138281">(</span><span class="ident" id="8138282">s</span><span class="op" id="8138283">,</span>&nbsp;<span class="ident" id="8138285">s2</span><span class="op" id="8138287">)</span>&nbsp;<span class="op" id="8138289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138293">t</span><span class="op" id="8138294">.</span><span class="ident" id="8138295">Fatalf</span><span class="op" id="8138301">(</span><span class="string" id="8138302">&#34;decode&nbsp;didn&#39;t&nbsp;match.\nsource:&nbsp;%#v\nEncoded&nbsp;as:\n%s\ndecode:&nbsp;%#v&#34;</span><span class="op" id="8138367">,</span>&nbsp;<span class="ident" id="8138369">s</span><span class="op" id="8138370">,</span>&nbsp;<span class="builtintype" id="8138372">string</span><span class="op" id="8138378">(</span><span class="ident" id="8138379">got</span><span class="op" id="8138382">)</span><span class="op" id="8138383">,</span>&nbsp;<span class="ident" id="8138385">s2</span><span class="op" id="8138387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8138390">}</span><br>
<span class="lineno"></span><span class="op" id="8138392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="8138395">//&nbsp;byte&nbsp;slices&nbsp;are&nbsp;special&nbsp;even&nbsp;if&nbsp;they&#39;re&nbsp;renamed&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="8138453">type</span>&nbsp;<span class="ident" id="8138458">renamedByte</span>&nbsp;<span class="builtintype" id="8138470">byte</span><br>
<span class="lineno"></span><span class="keyword" id="8138475">type</span>&nbsp;<span class="ident" id="8138480">renamedByteSlice</span>&nbsp;<span class="op" id="8138497">[</span><span class="op" id="8138498">]</span><span class="builtintype" id="8138499">byte</span><br>
<span class="lineno"></span><span class="keyword" id="8138504">type</span>&nbsp;<span class="ident" id="8138509">renamedRenamedByteSlice</span>&nbsp;<span class="op" id="8138533">[</span><span class="op" id="8138534">]</span><span class="ident" id="8138535">renamedByte</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="8138548">func</span>&nbsp;<span class="ident" id="8138553">TestEncodeRenamedByteSlice</span><span class="op" id="8138579">(</span><span class="ident" id="8138580">t</span>&nbsp;<span class="op" id="8138582">*</span><span class="ident" id="8138583">testing</span><span class="op" id="8138590">.</span><span class="ident" id="8138591">T</span><span class="op" id="8138592">)</span>&nbsp;<span class="op" id="8138594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138597">s</span>&nbsp;<span class="op" id="8138599">:=</span>&nbsp;<span class="ident" id="8138602">renamedByteSlice</span><span class="op" id="8138618">(</span><span class="string" id="8138619">&#34;abc&#34;</span><span class="op" id="8138624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138627">result</span><span class="op" id="8138633">,</span>&nbsp;<span class="ident" id="8138635">err</span>&nbsp;<span class="op" id="8138639">:=</span>&nbsp;<span class="ident" id="8138642">Marshal</span><span class="op" id="8138649">(</span><span class="ident" id="8138650">s</span><span class="op" id="8138651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8138654">if</span>&nbsp;<span class="ident" id="8138657">err</span>&nbsp;<span class="op" id="8138661">!=</span>&nbsp;<span class="ident" id="8138664">nil</span>&nbsp;<span class="op" id="8138668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138672">t</span><span class="op" id="8138673">.</span><span class="ident" id="8138674">Fatal</span><span class="op" id="8138679">(</span><span class="ident" id="8138680">err</span><span class="op" id="8138683">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8138686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138689">expect</span>&nbsp;<span class="op" id="8138696">:=</span>&nbsp;<span class="string" id="8138699">`&#34;YWJj&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8138709">if</span>&nbsp;<span class="builtintype" id="8138712">string</span><span class="op" id="8138718">(</span><span class="ident" id="8138719">result</span><span class="op" id="8138725">)</span>&nbsp;<span class="op" id="8138727">!=</span>&nbsp;<span class="ident" id="8138730">expect</span>&nbsp;<span class="op" id="8138737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138741">t</span><span class="op" id="8138742">.</span><span class="ident" id="8138743">Errorf</span><span class="op" id="8138749">(</span><span class="string" id="8138750">&#34;&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8138767">,</span>&nbsp;<span class="ident" id="8138769">result</span><span class="op" id="8138775">,</span>&nbsp;<span class="ident" id="8138777">expect</span><span class="op" id="8138783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8138786">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138789">r</span>&nbsp;<span class="op" id="8138791">:=</span>&nbsp;<span class="ident" id="8138794">renamedRenamedByteSlice</span><span class="op" id="8138817">(</span><span class="string" id="8138818">&#34;abc&#34;</span><span class="op" id="8138823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138826">result</span><span class="op" id="8138832">,</span>&nbsp;<span class="ident" id="8138834">err</span>&nbsp;<span class="op" id="8138838">=</span>&nbsp;<span class="ident" id="8138840">Marshal</span><span class="op" id="8138847">(</span><span class="ident" id="8138848">r</span><span class="op" id="8138849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8138852">if</span>&nbsp;<span class="ident" id="8138855">err</span>&nbsp;<span class="op" id="8138859">!=</span>&nbsp;<span class="ident" id="8138862">nil</span>&nbsp;<span class="op" id="8138866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138870">t</span><span class="op" id="8138871">.</span><span class="ident" id="8138872">Fatal</span><span class="op" id="8138877">(</span><span class="ident" id="8138878">err</span><span class="op" id="8138881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8138884">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8138887">if</span>&nbsp;<span class="builtintype" id="8138890">string</span><span class="op" id="8138896">(</span><span class="ident" id="8138897">result</span><span class="op" id="8138903">)</span>&nbsp;<span class="op" id="8138905">!=</span>&nbsp;<span class="ident" id="8138908">expect</span>&nbsp;<span class="op" id="8138915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138919">t</span><span class="op" id="8138920">.</span><span class="ident" id="8138921">Errorf</span><span class="op" id="8138927">(</span><span class="string" id="8138928">&#34;&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8138945">,</span>&nbsp;<span class="ident" id="8138947">result</span><span class="op" id="8138953">,</span>&nbsp;<span class="ident" id="8138955">expect</span><span class="op" id="8138961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8138964">}</span><br>
<span class="lineno"></span><span class="op" id="8138966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="8138969">var</span>&nbsp;<span class="ident" id="8138973">unsupportedValues</span>&nbsp;<span class="op" id="8138991">=</span>&nbsp;<span class="op" id="8138993">[</span><span class="op" id="8138994">]</span><span class="keyword" id="8138995">interface</span><span class="op" id="8139004">{</span><span class="op" id="8139005">}</span><span class="op" id="8139006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139009">math</span><span class="op" id="8139013">.</span><span class="ident" id="8139014">NaN</span><span class="op" id="8139017">(</span><span class="op" id="8139018">)</span><span class="op" id="8139019">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139022">math</span><span class="op" id="8139026">.</span><span class="ident" id="8139027">Inf</span><span class="op" id="8139030">(</span><span class="op" id="8139031">-</span><span class="num" id="8139032">1</span><span class="op" id="8139033">)</span><span class="op" id="8139034">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139037">math</span><span class="op" id="8139041">.</span><span class="ident" id="8139042">Inf</span><span class="op" id="8139045">(</span><span class="num" id="8139046">1</span><span class="op" id="8139047">)</span><span class="op" id="8139048">,</span><br>
<span class="lineno"></span><span class="op" id="8139050">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="8139053">func</span>&nbsp;<span class="ident" id="8139058">TestUnsupportedValues</span><span class="op" id="8139079">(</span><span class="ident" id="8139080">t</span>&nbsp;<span class="op" id="8139082">*</span><span class="ident" id="8139083">testing</span><span class="op" id="8139090">.</span><span class="ident" id="8139091">T</span><span class="op" id="8139092">)</span>&nbsp;<span class="op" id="8139094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8139097">for</span>&nbsp;<span class="ident" id="8139101">_</span><span class="op" id="8139102">,</span>&nbsp;<span class="ident" id="8139104">v</span>&nbsp;<span class="op" id="8139106">:=</span>&nbsp;<span class="keyword" id="8139109">range</span>&nbsp;<span class="ident" id="8139115">unsupportedValues</span>&nbsp;<span class="op" id="8139133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8139137">if</span>&nbsp;<span class="ident" id="8139140">_</span><span class="op" id="8139141">,</span>&nbsp;<span class="ident" id="8139143">err</span>&nbsp;<span class="op" id="8139147">:=</span>&nbsp;<span class="ident" id="8139150">Marshal</span><span class="op" id="8139157">(</span><span class="ident" id="8139158">v</span><span class="op" id="8139159">)</span><span class="op" id="8139160">;</span>&nbsp;<span class="ident" id="8139162">err</span>&nbsp;<span class="op" id="8139166">!=</span>&nbsp;<span class="ident" id="8139169">nil</span>&nbsp;<span class="op" id="8139173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8139178">if</span>&nbsp;<span class="ident" id="8139181">_</span><span class="op" id="8139182">,</span>&nbsp;<span class="ident" id="8139184">ok</span>&nbsp;<span class="op" id="8139187">:=</span>&nbsp;<span class="ident" id="8139190">err</span><span class="op" id="8139193">.</span><span class="op" id="8139194">(</span><span class="op" id="8139195">*</span><span class="ident" id="8139196">UnsupportedValueError</span><span class="op" id="8139217">)</span><span class="op" id="8139218">;</span>&nbsp;<span class="op" id="8139220">!</span><span class="ident" id="8139221">ok</span>&nbsp;<span class="op" id="8139224">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139230">t</span><span class="op" id="8139231">.</span><span class="ident" id="8139232">Errorf</span><span class="op" id="8139238">(</span><span class="string" id="8139239">&#34;for&nbsp;%v,&nbsp;got&nbsp;%T&nbsp;want&nbsp;UnsupportedValueError&#34;</span><span class="op" id="8139282">,</span>&nbsp;<span class="ident" id="8139284">v</span><span class="op" id="8139285">,</span>&nbsp;<span class="ident" id="8139287">err</span><span class="op" id="8139290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8139295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8139299">}</span>&nbsp;<span class="keyword" id="8139301">else</span>&nbsp;<span class="op" id="8139306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139311">t</span><span class="op" id="8139312">.</span><span class="ident" id="8139313">Errorf</span><span class="op" id="8139319">(</span><span class="string" id="8139320">&#34;for&nbsp;%v,&nbsp;expected&nbsp;error&#34;</span><span class="op" id="8139344">,</span>&nbsp;<span class="ident" id="8139346">v</span><span class="op" id="8139347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8139351">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8139354">}</span><br>
<span class="lineno"></span><span class="op" id="8139356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8139359">//&nbsp;Ref&nbsp;has&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;methods&nbsp;with&nbsp;pointer&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="8139427">type</span>&nbsp;<span class="ident" id="8139432">Ref</span>&nbsp;<span class="builtintype" id="8139436">int</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="8139441">func</span>&nbsp;<span class="op" id="8139446">(</span><span class="op" id="8139447">*</span><span class="ident" id="8139448">Ref</span><span class="op" id="8139451">)</span>&nbsp;<span class="ident" id="8139453">MarshalJSON</span><span class="op" id="8139464">(</span><span class="op" id="8139465">)</span>&nbsp;<span class="op" id="8139467">(</span><span class="op" id="8139468">[</span><span class="op" id="8139469">]</span><span class="builtintype" id="8139470">byte</span><span class="op" id="8139474">,</span>&nbsp;<span class="builtintype" id="8139476">error</span><span class="op" id="8139481">)</span>&nbsp;<span class="op" id="8139483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8139486">return</span>&nbsp;<span class="op" id="8139493">[</span><span class="op" id="8139494">]</span><span class="builtintype" id="8139495">byte</span><span class="op" id="8139499">(</span><span class="string" id="8139500">`&#34;ref&#34;`</span><span class="op" id="8139507">)</span><span class="op" id="8139508">,</span>&nbsp;<span class="ident" id="8139510">nil</span><br>
<span class="lineno"></span><span class="op" id="8139514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="8139517">func</span>&nbsp;<span class="op" id="8139522">(</span><span class="ident" id="8139523">r</span>&nbsp;<span class="op" id="8139525">*</span><span class="ident" id="8139526">Ref</span><span class="op" id="8139529">)</span>&nbsp;<span class="ident" id="8139531">UnmarshalJSON</span><span class="op" id="8139544">(</span><span class="op" id="8139545">[</span><span class="op" id="8139546">]</span><span class="builtintype" id="8139547">byte</span><span class="op" id="8139551">)</span>&nbsp;<span class="builtintype" id="8139553">error</span>&nbsp;<span class="op" id="8139559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8139562">*</span><span class="ident" id="8139563">r</span>&nbsp;<span class="op" id="8139565">=</span>&nbsp;<span class="num" id="8139567">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8139571">return</span>&nbsp;<span class="ident" id="8139578">nil</span><br>
<span class="lineno"></span><span class="op" id="8139582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="8139585">//&nbsp;Val&nbsp;has&nbsp;Marshaler&nbsp;methods&nbsp;with&nbsp;value&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="8139635">type</span>&nbsp;<span class="ident" id="8139640">Val</span>&nbsp;<span class="builtintype" id="8139644">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8139649">func</span>&nbsp;<span class="op" id="8139654">(</span><span class="ident" id="8139655">Val</span><span class="op" id="8139658">)</span>&nbsp;<span class="ident" id="8139660">MarshalJSON</span><span class="op" id="8139671">(</span><span class="op" id="8139672">)</span>&nbsp;<span class="op" id="8139674">(</span><span class="op" id="8139675">[</span><span class="op" id="8139676">]</span><span class="builtintype" id="8139677">byte</span><span class="op" id="8139681">,</span>&nbsp;<span class="builtintype" id="8139683">error</span><span class="op" id="8139688">)</span>&nbsp;<span class="op" id="8139690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8139693">return</span>&nbsp;<span class="op" id="8139700">[</span><span class="op" id="8139701">]</span><span class="builtintype" id="8139702">byte</span><span class="op" id="8139706">(</span><span class="string" id="8139707">`&#34;val&#34;`</span><span class="op" id="8139714">)</span><span class="op" id="8139715">,</span>&nbsp;<span class="ident" id="8139717">nil</span><br>
<span class="lineno">165</span><span class="op" id="8139721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8139724">//&nbsp;RefText&nbsp;has&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;methods&nbsp;with&nbsp;pointer&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="8139796">type</span>&nbsp;<span class="ident" id="8139801">RefText</span>&nbsp;<span class="builtintype" id="8139809">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="8139814">func</span>&nbsp;<span class="op" id="8139819">(</span><span class="op" id="8139820">*</span><span class="ident" id="8139821">RefText</span><span class="op" id="8139828">)</span>&nbsp;<span class="ident" id="8139830">MarshalText</span><span class="op" id="8139841">(</span><span class="op" id="8139842">)</span>&nbsp;<span class="op" id="8139844">(</span><span class="op" id="8139845">[</span><span class="op" id="8139846">]</span><span class="builtintype" id="8139847">byte</span><span class="op" id="8139851">,</span>&nbsp;<span class="builtintype" id="8139853">error</span><span class="op" id="8139858">)</span>&nbsp;<span class="op" id="8139860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8139863">return</span>&nbsp;<span class="op" id="8139870">[</span><span class="op" id="8139871">]</span><span class="builtintype" id="8139872">byte</span><span class="op" id="8139876">(</span><span class="string" id="8139877">`&#34;ref&#34;`</span><span class="op" id="8139884">)</span><span class="op" id="8139885">,</span>&nbsp;<span class="ident" id="8139887">nil</span><br>
<span class="lineno"></span><span class="op" id="8139891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8139894">func</span>&nbsp;<span class="op" id="8139899">(</span><span class="ident" id="8139900">r</span>&nbsp;<span class="op" id="8139902">*</span><span class="ident" id="8139903">RefText</span><span class="op" id="8139910">)</span>&nbsp;<span class="ident" id="8139912">UnmarshalText</span><span class="op" id="8139925">(</span><span class="op" id="8139926">[</span><span class="op" id="8139927">]</span><span class="builtintype" id="8139928">byte</span><span class="op" id="8139932">)</span>&nbsp;<span class="builtintype" id="8139934">error</span>&nbsp;<span class="op" id="8139940">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8139943">*</span><span class="ident" id="8139944">r</span>&nbsp;<span class="op" id="8139946">=</span>&nbsp;<span class="num" id="8139948">13</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8139952">return</span>&nbsp;<span class="ident" id="8139959">nil</span><br>
<span class="lineno"></span><span class="op" id="8139963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8139966">//&nbsp;ValText&nbsp;has&nbsp;Marshaler&nbsp;methods&nbsp;with&nbsp;value&nbsp;receiver.</span><br>
<span class="lineno">180</span><span class="keyword" id="8140020">type</span>&nbsp;<span class="ident" id="8140025">ValText</span>&nbsp;<span class="builtintype" id="8140033">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8140038">func</span>&nbsp;<span class="op" id="8140043">(</span><span class="ident" id="8140044">ValText</span><span class="op" id="8140051">)</span>&nbsp;<span class="ident" id="8140053">MarshalText</span><span class="op" id="8140064">(</span><span class="op" id="8140065">)</span>&nbsp;<span class="op" id="8140067">(</span><span class="op" id="8140068">[</span><span class="op" id="8140069">]</span><span class="builtintype" id="8140070">byte</span><span class="op" id="8140074">,</span>&nbsp;<span class="builtintype" id="8140076">error</span><span class="op" id="8140081">)</span>&nbsp;<span class="op" id="8140083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8140086">return</span>&nbsp;<span class="op" id="8140093">[</span><span class="op" id="8140094">]</span><span class="builtintype" id="8140095">byte</span><span class="op" id="8140099">(</span><span class="string" id="8140100">`&#34;val&#34;`</span><span class="op" id="8140107">)</span><span class="op" id="8140108">,</span>&nbsp;<span class="ident" id="8140110">nil</span><br>
<span class="lineno"></span><span class="op" id="8140114">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="keyword" id="8140117">func</span>&nbsp;<span class="ident" id="8140122">TestRefValMarshal</span><span class="op" id="8140139">(</span><span class="ident" id="8140140">t</span>&nbsp;<span class="op" id="8140142">*</span><span class="ident" id="8140143">testing</span><span class="op" id="8140150">.</span><span class="ident" id="8140151">T</span><span class="op" id="8140152">)</span>&nbsp;<span class="op" id="8140154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8140157">var</span>&nbsp;<span class="ident" id="8140161">s</span>&nbsp;<span class="op" id="8140163">=</span>&nbsp;<span class="keyword" id="8140165">struct</span>&nbsp;<span class="op" id="8140172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140176">R0</span>&nbsp;<span class="ident" id="8140179">Ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140185">R1</span>&nbsp;<span class="op" id="8140188">*</span><span class="ident" id="8140189">Ref</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140195">R2</span>&nbsp;<span class="ident" id="8140198">RefText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140208">R3</span>&nbsp;<span class="op" id="8140211">*</span><span class="ident" id="8140212">RefText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140222">V0</span>&nbsp;<span class="ident" id="8140225">Val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140231">V1</span>&nbsp;<span class="op" id="8140234">*</span><span class="ident" id="8140235">Val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140241">V2</span>&nbsp;<span class="ident" id="8140244">ValText</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140254">V3</span>&nbsp;<span class="op" id="8140257">*</span><span class="ident" id="8140258">ValText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8140267">}</span><span class="op" id="8140268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140272">R0</span><span class="op" id="8140274">:</span>&nbsp;<span class="num" id="8140276">12</span><span class="op" id="8140278">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140282">R1</span><span class="op" id="8140284">:</span>&nbsp;<span class="builtinfunc" id="8140286">new</span><span class="op" id="8140289">(</span><span class="ident" id="8140290">Ref</span><span class="op" id="8140293">)</span><span class="op" id="8140294">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140298">R2</span><span class="op" id="8140300">:</span>&nbsp;<span class="num" id="8140302">14</span><span class="op" id="8140304">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140308">R3</span><span class="op" id="8140310">:</span>&nbsp;<span class="builtinfunc" id="8140312">new</span><span class="op" id="8140315">(</span><span class="ident" id="8140316">RefText</span><span class="op" id="8140323">)</span><span class="op" id="8140324">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140328">V0</span><span class="op" id="8140330">:</span>&nbsp;<span class="num" id="8140332">13</span><span class="op" id="8140334">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140338">V1</span><span class="op" id="8140340">:</span>&nbsp;<span class="builtinfunc" id="8140342">new</span><span class="op" id="8140345">(</span><span class="ident" id="8140346">Val</span><span class="op" id="8140349">)</span><span class="op" id="8140350">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140354">V2</span><span class="op" id="8140356">:</span>&nbsp;<span class="num" id="8140358">15</span><span class="op" id="8140360">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140364">V3</span><span class="op" id="8140366">:</span>&nbsp;<span class="builtinfunc" id="8140368">new</span><span class="op" id="8140371">(</span><span class="ident" id="8140372">ValText</span><span class="op" id="8140379">)</span><span class="op" id="8140380">,</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8140383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8140386">const</span>&nbsp;<span class="ident" id="8140392">want</span>&nbsp;<span class="op" id="8140397">=</span>&nbsp;<span class="string" id="8140399">`{&#34;R0&#34;:&#34;ref&#34;,&#34;R1&#34;:&#34;ref&#34;,&#34;R2&#34;:&#34;\&#34;ref\&#34;&#34;,&#34;R3&#34;:&#34;\&#34;ref\&#34;&#34;,&#34;V0&#34;:&#34;val&#34;,&#34;V1&#34;:&#34;val&#34;,&#34;V2&#34;:&#34;\&#34;val\&#34;&#34;,&#34;V3&#34;:&#34;\&#34;val\&#34;&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140508">b</span><span class="op" id="8140509">,</span>&nbsp;<span class="ident" id="8140511">err</span>&nbsp;<span class="op" id="8140515">:=</span>&nbsp;<span class="ident" id="8140518">Marshal</span><span class="op" id="8140525">(</span><span class="op" id="8140526">&amp;</span><span class="ident" id="8140527">s</span><span class="op" id="8140528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8140531">if</span>&nbsp;<span class="ident" id="8140534">err</span>&nbsp;<span class="op" id="8140538">!=</span>&nbsp;<span class="ident" id="8140541">nil</span>&nbsp;<span class="op" id="8140545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140549">t</span><span class="op" id="8140550">.</span><span class="ident" id="8140551">Fatalf</span><span class="op" id="8140557">(</span><span class="string" id="8140558">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="8140571">,</span>&nbsp;<span class="ident" id="8140573">err</span><span class="op" id="8140576">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8140579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8140582">if</span>&nbsp;<span class="ident" id="8140585">got</span>&nbsp;<span class="op" id="8140589">:=</span>&nbsp;<span class="builtintype" id="8140592">string</span><span class="op" id="8140598">(</span><span class="ident" id="8140599">b</span><span class="op" id="8140600">)</span><span class="op" id="8140601">;</span>&nbsp;<span class="ident" id="8140603">got</span>&nbsp;<span class="op" id="8140607">!=</span>&nbsp;<span class="ident" id="8140610">want</span>&nbsp;<span class="op" id="8140615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140619">t</span><span class="op" id="8140620">.</span><span class="ident" id="8140621">Errorf</span><span class="op" id="8140627">(</span><span class="string" id="8140628">&#34;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8140645">,</span>&nbsp;<span class="ident" id="8140647">got</span><span class="op" id="8140650">,</span>&nbsp;<span class="ident" id="8140652">want</span><span class="op" id="8140656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8140659">}</span><br>
<span class="lineno"></span><span class="op" id="8140661">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="comment" id="8140664">//&nbsp;C&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;returns&nbsp;unescaped&nbsp;JSON.</span><br>
<span class="lineno"></span><span class="keyword" id="8140718">type</span>&nbsp;<span class="ident" id="8140723">C</span>&nbsp;<span class="builtintype" id="8140725">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8140730">func</span>&nbsp;<span class="op" id="8140735">(</span><span class="ident" id="8140736">C</span><span class="op" id="8140737">)</span>&nbsp;<span class="ident" id="8140739">MarshalJSON</span><span class="op" id="8140750">(</span><span class="op" id="8140751">)</span>&nbsp;<span class="op" id="8140753">(</span><span class="op" id="8140754">[</span><span class="op" id="8140755">]</span><span class="builtintype" id="8140756">byte</span><span class="op" id="8140760">,</span>&nbsp;<span class="builtintype" id="8140762">error</span><span class="op" id="8140767">)</span>&nbsp;<span class="op" id="8140769">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8140772">return</span>&nbsp;<span class="op" id="8140779">[</span><span class="op" id="8140780">]</span><span class="builtintype" id="8140781">byte</span><span class="op" id="8140785">(</span><span class="string" id="8140786">`&#34;&lt;&amp;&gt;&#34;`</span><span class="op" id="8140793">)</span><span class="op" id="8140794">,</span>&nbsp;<span class="ident" id="8140796">nil</span><br>
<span class="lineno"></span><span class="op" id="8140800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8140803">//&nbsp;CText&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;returns&nbsp;unescaped&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="8140861">type</span>&nbsp;<span class="ident" id="8140866">CText</span>&nbsp;<span class="builtintype" id="8140872">int</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="keyword" id="8140877">func</span>&nbsp;<span class="op" id="8140882">(</span><span class="ident" id="8140883">CText</span><span class="op" id="8140888">)</span>&nbsp;<span class="ident" id="8140890">MarshalText</span><span class="op" id="8140901">(</span><span class="op" id="8140902">)</span>&nbsp;<span class="op" id="8140904">(</span><span class="op" id="8140905">[</span><span class="op" id="8140906">]</span><span class="builtintype" id="8140907">byte</span><span class="op" id="8140911">,</span>&nbsp;<span class="builtintype" id="8140913">error</span><span class="op" id="8140918">)</span>&nbsp;<span class="op" id="8140920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8140923">return</span>&nbsp;<span class="op" id="8140930">[</span><span class="op" id="8140931">]</span><span class="builtintype" id="8140932">byte</span><span class="op" id="8140936">(</span><span class="string" id="8140937">`&#34;&lt;&amp;&gt;&#34;`</span><span class="op" id="8140944">)</span><span class="op" id="8140945">,</span>&nbsp;<span class="ident" id="8140947">nil</span><br>
<span class="lineno"></span><span class="op" id="8140951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="8140954">func</span>&nbsp;<span class="ident" id="8140959">TestMarshalerEscaping</span><span class="op" id="8140980">(</span><span class="ident" id="8140981">t</span>&nbsp;<span class="op" id="8140983">*</span><span class="ident" id="8140984">testing</span><span class="op" id="8140991">.</span><span class="ident" id="8140992">T</span><span class="op" id="8140993">)</span>&nbsp;<span class="op" id="8140995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8140998">var</span>&nbsp;<span class="ident" id="8141002">c</span>&nbsp;<span class="ident" id="8141004">C</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141007">want</span>&nbsp;<span class="op" id="8141012">:=</span>&nbsp;<span class="string" id="8141015">`&#34;\u003c\u0026\u003e&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141039">b</span><span class="op" id="8141040">,</span>&nbsp;<span class="ident" id="8141042">err</span>&nbsp;<span class="op" id="8141046">:=</span>&nbsp;<span class="ident" id="8141049">Marshal</span><span class="op" id="8141056">(</span><span class="ident" id="8141057">c</span><span class="op" id="8141058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8141061">if</span>&nbsp;<span class="ident" id="8141064">err</span>&nbsp;<span class="op" id="8141068">!=</span>&nbsp;<span class="ident" id="8141071">nil</span>&nbsp;<span class="op" id="8141075">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141079">t</span><span class="op" id="8141080">.</span><span class="ident" id="8141081">Fatalf</span><span class="op" id="8141087">(</span><span class="string" id="8141088">&#34;Marshal(c):&nbsp;%v&#34;</span><span class="op" id="8141104">,</span>&nbsp;<span class="ident" id="8141106">err</span><span class="op" id="8141109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8141112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8141115">if</span>&nbsp;<span class="ident" id="8141118">got</span>&nbsp;<span class="op" id="8141122">:=</span>&nbsp;<span class="builtintype" id="8141125">string</span><span class="op" id="8141131">(</span><span class="ident" id="8141132">b</span><span class="op" id="8141133">)</span><span class="op" id="8141134">;</span>&nbsp;<span class="ident" id="8141136">got</span>&nbsp;<span class="op" id="8141140">!=</span>&nbsp;<span class="ident" id="8141143">want</span>&nbsp;<span class="op" id="8141148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141152">t</span><span class="op" id="8141153">.</span><span class="ident" id="8141154">Errorf</span><span class="op" id="8141160">(</span><span class="string" id="8141161">&#34;Marshal(c)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="8141189">,</span>&nbsp;<span class="ident" id="8141191">got</span><span class="op" id="8141194">,</span>&nbsp;<span class="ident" id="8141196">want</span><span class="op" id="8141200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8141203">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8141207">var</span>&nbsp;<span class="ident" id="8141211">ct</span>&nbsp;<span class="ident" id="8141214">CText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141221">want</span>&nbsp;<span class="op" id="8141226">=</span>&nbsp;<span class="string" id="8141228">`&#34;\&#34;\u003c\u0026\u003e\&#34;&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141256">b</span><span class="op" id="8141257">,</span>&nbsp;<span class="ident" id="8141259">err</span>&nbsp;<span class="op" id="8141263">=</span>&nbsp;<span class="ident" id="8141265">Marshal</span><span class="op" id="8141272">(</span><span class="ident" id="8141273">ct</span><span class="op" id="8141275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8141278">if</span>&nbsp;<span class="ident" id="8141281">err</span>&nbsp;<span class="op" id="8141285">!=</span>&nbsp;<span class="ident" id="8141288">nil</span>&nbsp;<span class="op" id="8141292">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141296">t</span><span class="op" id="8141297">.</span><span class="ident" id="8141298">Fatalf</span><span class="op" id="8141304">(</span><span class="string" id="8141305">&#34;Marshal(ct):&nbsp;%v&#34;</span><span class="op" id="8141322">,</span>&nbsp;<span class="ident" id="8141324">err</span><span class="op" id="8141327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8141330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8141333">if</span>&nbsp;<span class="ident" id="8141336">got</span>&nbsp;<span class="op" id="8141340">:=</span>&nbsp;<span class="builtintype" id="8141343">string</span><span class="op" id="8141349">(</span><span class="ident" id="8141350">b</span><span class="op" id="8141351">)</span><span class="op" id="8141352">;</span>&nbsp;<span class="ident" id="8141354">got</span>&nbsp;<span class="op" id="8141358">!=</span>&nbsp;<span class="ident" id="8141361">want</span>&nbsp;<span class="op" id="8141366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141370">t</span><span class="op" id="8141371">.</span><span class="ident" id="8141372">Errorf</span><span class="op" id="8141378">(</span><span class="string" id="8141379">&#34;Marshal(ct)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="8141408">,</span>&nbsp;<span class="ident" id="8141410">got</span><span class="op" id="8141413">,</span>&nbsp;<span class="ident" id="8141415">want</span><span class="op" id="8141419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8141422">}</span><br>
<span class="lineno">250</span><span class="op" id="8141424">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8141427">type</span>&nbsp;<span class="ident" id="8141432">IntType</span>&nbsp;<span class="builtintype" id="8141440">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8141445">type</span>&nbsp;<span class="ident" id="8141450">MyStruct</span>&nbsp;<span class="keyword" id="8141459">struct</span>&nbsp;<span class="op" id="8141466">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141469">IntType</span><br>
<span class="lineno"></span><span class="op" id="8141477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8141480">func</span>&nbsp;<span class="ident" id="8141485">TestAnonymousNonstruct</span><span class="op" id="8141507">(</span><span class="ident" id="8141508">t</span>&nbsp;<span class="op" id="8141510">*</span><span class="ident" id="8141511">testing</span><span class="op" id="8141518">.</span><span class="ident" id="8141519">T</span><span class="op" id="8141520">)</span>&nbsp;<span class="op" id="8141522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8141525">var</span>&nbsp;<span class="ident" id="8141529">i</span>&nbsp;<span class="ident" id="8141531">IntType</span>&nbsp;<span class="op" id="8141539">=</span>&nbsp;<span class="num" id="8141541">11</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141545">a</span>&nbsp;<span class="op" id="8141547">:=</span>&nbsp;<span class="ident" id="8141550">MyStruct</span><span class="op" id="8141558">{</span><span class="ident" id="8141559">i</span><span class="op" id="8141560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8141563">const</span>&nbsp;<span class="ident" id="8141569">want</span>&nbsp;<span class="op" id="8141574">=</span>&nbsp;<span class="string" id="8141576">`{&#34;IntType&#34;:11}`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141595">b</span><span class="op" id="8141596">,</span>&nbsp;<span class="ident" id="8141598">err</span>&nbsp;<span class="op" id="8141602">:=</span>&nbsp;<span class="ident" id="8141605">Marshal</span><span class="op" id="8141612">(</span><span class="ident" id="8141613">a</span><span class="op" id="8141614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8141617">if</span>&nbsp;<span class="ident" id="8141620">err</span>&nbsp;<span class="op" id="8141624">!=</span>&nbsp;<span class="ident" id="8141627">nil</span>&nbsp;<span class="op" id="8141631">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141635">t</span><span class="op" id="8141636">.</span><span class="ident" id="8141637">Fatalf</span><span class="op" id="8141643">(</span><span class="string" id="8141644">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="8141657">,</span>&nbsp;<span class="ident" id="8141659">err</span><span class="op" id="8141662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8141665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8141668">if</span>&nbsp;<span class="ident" id="8141671">got</span>&nbsp;<span class="op" id="8141675">:=</span>&nbsp;<span class="builtintype" id="8141678">string</span><span class="op" id="8141684">(</span><span class="ident" id="8141685">b</span><span class="op" id="8141686">)</span><span class="op" id="8141687">;</span>&nbsp;<span class="ident" id="8141689">got</span>&nbsp;<span class="op" id="8141693">!=</span>&nbsp;<span class="ident" id="8141696">want</span>&nbsp;<span class="op" id="8141701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141705">t</span><span class="op" id="8141706">.</span><span class="ident" id="8141707">Errorf</span><span class="op" id="8141713">(</span><span class="string" id="8141714">&#34;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8141731">,</span>&nbsp;<span class="ident" id="8141733">got</span><span class="op" id="8141736">,</span>&nbsp;<span class="ident" id="8141738">want</span><span class="op" id="8141742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8141745">}</span><br>
<span class="lineno">270</span><span class="op" id="8141747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8141750">type</span>&nbsp;<span class="ident" id="8141755">BugA</span>&nbsp;<span class="keyword" id="8141760">struct</span>&nbsp;<span class="op" id="8141767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141770">S</span>&nbsp;<span class="builtintype" id="8141772">string</span><br>
<span class="lineno"></span><span class="op" id="8141779">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="keyword" id="8141782">type</span>&nbsp;<span class="ident" id="8141787">BugB</span>&nbsp;<span class="keyword" id="8141792">struct</span>&nbsp;<span class="op" id="8141799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141802">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141808">S</span>&nbsp;<span class="builtintype" id="8141810">string</span><br>
<span class="lineno"></span><span class="op" id="8141817">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="8141820">type</span>&nbsp;<span class="ident" id="8141825">BugC</span>&nbsp;<span class="keyword" id="8141830">struct</span>&nbsp;<span class="op" id="8141837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141840">S</span>&nbsp;<span class="builtintype" id="8141842">string</span><br>
<span class="lineno"></span><span class="op" id="8141849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="comment" id="8141852">//&nbsp;Legal&nbsp;Go:&nbsp;We&nbsp;never&nbsp;use&nbsp;the&nbsp;repeated&nbsp;embedded&nbsp;field&nbsp;(S).</span><br>
<span class="lineno"></span><span class="keyword" id="8141911">type</span>&nbsp;<span class="ident" id="8141916">BugX</span>&nbsp;<span class="keyword" id="8141921">struct</span>&nbsp;<span class="op" id="8141928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141931">A</span>&nbsp;<span class="builtintype" id="8141933">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141938">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141944">BugB</span><br>
<span class="lineno">290</span><span class="op" id="8141949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8141952">//&nbsp;Issue&nbsp;5245.</span><br>
<span class="lineno"></span><span class="keyword" id="8141967">func</span>&nbsp;<span class="ident" id="8141972">TestEmbeddedBug</span><span class="op" id="8141987">(</span><span class="ident" id="8141988">t</span>&nbsp;<span class="op" id="8141990">*</span><span class="ident" id="8141991">testing</span><span class="op" id="8141998">.</span><span class="ident" id="8141999">T</span><span class="op" id="8142000">)</span>&nbsp;<span class="op" id="8142002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142005">v</span>&nbsp;<span class="op" id="8142007">:=</span>&nbsp;<span class="ident" id="8142010">BugB</span><span class="op" id="8142014">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142018">BugA</span><span class="op" id="8142022">{</span><span class="string" id="8142023">&#34;A&#34;</span><span class="op" id="8142026">}</span><span class="op" id="8142027">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8142031">&#34;B&#34;</span><span class="op" id="8142034">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8142037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142040">b</span><span class="op" id="8142041">,</span>&nbsp;<span class="ident" id="8142043">err</span>&nbsp;<span class="op" id="8142047">:=</span>&nbsp;<span class="ident" id="8142050">Marshal</span><span class="op" id="8142057">(</span><span class="ident" id="8142058">v</span><span class="op" id="8142059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8142062">if</span>&nbsp;<span class="ident" id="8142065">err</span>&nbsp;<span class="op" id="8142069">!=</span>&nbsp;<span class="ident" id="8142072">nil</span>&nbsp;<span class="op" id="8142076">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142080">t</span><span class="op" id="8142081">.</span><span class="ident" id="8142082">Fatal</span><span class="op" id="8142087">(</span><span class="string" id="8142088">&#34;Marshal:&#34;</span><span class="op" id="8142098">,</span>&nbsp;<span class="ident" id="8142100">err</span><span class="op" id="8142103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8142106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142109">want</span>&nbsp;<span class="op" id="8142114">:=</span>&nbsp;<span class="string" id="8142117">`{&#34;S&#34;:&#34;B&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142130">got</span>&nbsp;<span class="op" id="8142134">:=</span>&nbsp;<span class="builtintype" id="8142137">string</span><span class="op" id="8142143">(</span><span class="ident" id="8142144">b</span><span class="op" id="8142145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8142148">if</span>&nbsp;<span class="ident" id="8142151">got</span>&nbsp;<span class="op" id="8142155">!=</span>&nbsp;<span class="ident" id="8142158">want</span>&nbsp;<span class="op" id="8142163">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142167">t</span><span class="op" id="8142168">.</span><span class="ident" id="8142169">Fatalf</span><span class="op" id="8142175">(</span><span class="string" id="8142176">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8142201">,</span>&nbsp;<span class="ident" id="8142203">got</span><span class="op" id="8142206">,</span>&nbsp;<span class="ident" id="8142208">want</span><span class="op" id="8142212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8142215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8142218">//&nbsp;Now&nbsp;check&nbsp;that&nbsp;the&nbsp;duplicate&nbsp;field,&nbsp;S,&nbsp;does&nbsp;not&nbsp;appear.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142278">x</span>&nbsp;<span class="op" id="8142280">:=</span>&nbsp;<span class="ident" id="8142283">BugX</span><span class="op" id="8142287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142291">A</span><span class="op" id="8142292">:</span>&nbsp;<span class="num" id="8142294">23</span><span class="op" id="8142296">,</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8142299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142302">b</span><span class="op" id="8142303">,</span>&nbsp;<span class="ident" id="8142305">err</span>&nbsp;<span class="op" id="8142309">=</span>&nbsp;<span class="ident" id="8142311">Marshal</span><span class="op" id="8142318">(</span><span class="ident" id="8142319">x</span><span class="op" id="8142320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8142323">if</span>&nbsp;<span class="ident" id="8142326">err</span>&nbsp;<span class="op" id="8142330">!=</span>&nbsp;<span class="ident" id="8142333">nil</span>&nbsp;<span class="op" id="8142337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142341">t</span><span class="op" id="8142342">.</span><span class="ident" id="8142343">Fatal</span><span class="op" id="8142348">(</span><span class="string" id="8142349">&#34;Marshal:&#34;</span><span class="op" id="8142359">,</span>&nbsp;<span class="ident" id="8142361">err</span><span class="op" id="8142364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8142367">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142370">want</span>&nbsp;<span class="op" id="8142375">=</span>&nbsp;<span class="string" id="8142377">`{&#34;A&#34;:23}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142389">got</span>&nbsp;<span class="op" id="8142393">=</span>&nbsp;<span class="builtintype" id="8142395">string</span><span class="op" id="8142401">(</span><span class="ident" id="8142402">b</span><span class="op" id="8142403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8142406">if</span>&nbsp;<span class="ident" id="8142409">got</span>&nbsp;<span class="op" id="8142413">!=</span>&nbsp;<span class="ident" id="8142416">want</span>&nbsp;<span class="op" id="8142421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142425">t</span><span class="op" id="8142426">.</span><span class="ident" id="8142427">Fatalf</span><span class="op" id="8142433">(</span><span class="string" id="8142434">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8142459">,</span>&nbsp;<span class="ident" id="8142461">got</span><span class="op" id="8142464">,</span>&nbsp;<span class="ident" id="8142466">want</span><span class="op" id="8142470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8142473">}</span><br>
<span class="lineno">320</span><span class="op" id="8142475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8142478">type</span>&nbsp;<span class="ident" id="8142483">BugD</span>&nbsp;<span class="keyword" id="8142488">struct</span>&nbsp;<span class="op" id="8142495">{</span>&nbsp;<span class="comment" id="8142497">//&nbsp;Same&nbsp;as&nbsp;BugA&nbsp;after&nbsp;tagging.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142529">XXX</span>&nbsp;<span class="builtintype" id="8142533">string</span>&nbsp;<span class="string" id="8142540">`json:&#34;S&#34;`</span><br>
<span class="lineno"></span><span class="op" id="8142551">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="8142554">//&nbsp;BugD&#39;s&nbsp;tagged&nbsp;S&nbsp;field&nbsp;should&nbsp;dominate&nbsp;BugA&#39;s.</span><br>
<span class="lineno"></span><span class="keyword" id="8142603">type</span>&nbsp;<span class="ident" id="8142608">BugY</span>&nbsp;<span class="keyword" id="8142613">struct</span>&nbsp;<span class="op" id="8142620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142623">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142629">BugD</span><br>
<span class="lineno">330</span><span class="op" id="8142634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8142637">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;field&nbsp;with&nbsp;a&nbsp;tag&nbsp;dominates&nbsp;untagged&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="8142696">func</span>&nbsp;<span class="ident" id="8142701">TestTaggedFieldDominates</span><span class="op" id="8142725">(</span><span class="ident" id="8142726">t</span>&nbsp;<span class="op" id="8142728">*</span><span class="ident" id="8142729">testing</span><span class="op" id="8142736">.</span><span class="ident" id="8142737">T</span><span class="op" id="8142738">)</span>&nbsp;<span class="op" id="8142740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142743">v</span>&nbsp;<span class="op" id="8142745">:=</span>&nbsp;<span class="ident" id="8142748">BugY</span><span class="op" id="8142752">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142756">BugA</span><span class="op" id="8142760">{</span><span class="string" id="8142761">&#34;BugA&#34;</span><span class="op" id="8142767">}</span><span class="op" id="8142768">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142772">BugD</span><span class="op" id="8142776">{</span><span class="string" id="8142777">&#34;BugD&#34;</span><span class="op" id="8142783">}</span><span class="op" id="8142784">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8142787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142790">b</span><span class="op" id="8142791">,</span>&nbsp;<span class="ident" id="8142793">err</span>&nbsp;<span class="op" id="8142797">:=</span>&nbsp;<span class="ident" id="8142800">Marshal</span><span class="op" id="8142807">(</span><span class="ident" id="8142808">v</span><span class="op" id="8142809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8142812">if</span>&nbsp;<span class="ident" id="8142815">err</span>&nbsp;<span class="op" id="8142819">!=</span>&nbsp;<span class="ident" id="8142822">nil</span>&nbsp;<span class="op" id="8142826">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142830">t</span><span class="op" id="8142831">.</span><span class="ident" id="8142832">Fatal</span><span class="op" id="8142837">(</span><span class="string" id="8142838">&#34;Marshal:&#34;</span><span class="op" id="8142848">,</span>&nbsp;<span class="ident" id="8142850">err</span><span class="op" id="8142853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8142856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142859">want</span>&nbsp;<span class="op" id="8142864">:=</span>&nbsp;<span class="string" id="8142867">`{&#34;S&#34;:&#34;BugD&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142883">got</span>&nbsp;<span class="op" id="8142887">:=</span>&nbsp;<span class="builtintype" id="8142890">string</span><span class="op" id="8142896">(</span><span class="ident" id="8142897">b</span><span class="op" id="8142898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8142901">if</span>&nbsp;<span class="ident" id="8142904">got</span>&nbsp;<span class="op" id="8142908">!=</span>&nbsp;<span class="ident" id="8142911">want</span>&nbsp;<span class="op" id="8142916">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142920">t</span><span class="op" id="8142921">.</span><span class="ident" id="8142922">Fatalf</span><span class="op" id="8142928">(</span><span class="string" id="8142929">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8142954">,</span>&nbsp;<span class="ident" id="8142956">got</span><span class="op" id="8142959">,</span>&nbsp;<span class="ident" id="8142961">want</span><span class="op" id="8142965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8142968">}</span><br>
<span class="lineno"></span><span class="op" id="8142970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8142973">//&nbsp;There&nbsp;are&nbsp;no&nbsp;tags&nbsp;here,&nbsp;so&nbsp;S&nbsp;should&nbsp;not&nbsp;appear.</span><br>
<span class="lineno">350</span><span class="keyword" id="8143024">type</span>&nbsp;<span class="ident" id="8143029">BugZ</span>&nbsp;<span class="keyword" id="8143034">struct</span>&nbsp;<span class="op" id="8143041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143044">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143050">BugC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143056">BugY</span>&nbsp;<span class="comment" id="8143061">//&nbsp;Contains&nbsp;a&nbsp;tagged&nbsp;S&nbsp;field&nbsp;through&nbsp;BugD;&nbsp;should&nbsp;not&nbsp;dominate.</span><br>
<span class="lineno"></span><span class="op" id="8143125">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="keyword" id="8143128">func</span>&nbsp;<span class="ident" id="8143133">TestDuplicatedFieldDisappears</span><span class="op" id="8143162">(</span><span class="ident" id="8143163">t</span>&nbsp;<span class="op" id="8143165">*</span><span class="ident" id="8143166">testing</span><span class="op" id="8143173">.</span><span class="ident" id="8143174">T</span><span class="op" id="8143175">)</span>&nbsp;<span class="op" id="8143177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143180">v</span>&nbsp;<span class="op" id="8143182">:=</span>&nbsp;<span class="ident" id="8143185">BugZ</span><span class="op" id="8143189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143193">BugA</span><span class="op" id="8143197">{</span><span class="string" id="8143198">&#34;BugA&#34;</span><span class="op" id="8143204">}</span><span class="op" id="8143205">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143209">BugC</span><span class="op" id="8143213">{</span><span class="string" id="8143214">&#34;BugC&#34;</span><span class="op" id="8143220">}</span><span class="op" id="8143221">,</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143225">BugY</span><span class="op" id="8143229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143234">BugA</span><span class="op" id="8143238">{</span><span class="string" id="8143239">&#34;nested&nbsp;BugA&#34;</span><span class="op" id="8143252">}</span><span class="op" id="8143253">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143258">BugD</span><span class="op" id="8143262">{</span><span class="string" id="8143263">&#34;nested&nbsp;BugD&#34;</span><span class="op" id="8143276">}</span><span class="op" id="8143277">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8143281">}</span><span class="op" id="8143282">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8143285">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143288">b</span><span class="op" id="8143289">,</span>&nbsp;<span class="ident" id="8143291">err</span>&nbsp;<span class="op" id="8143295">:=</span>&nbsp;<span class="ident" id="8143298">Marshal</span><span class="op" id="8143305">(</span><span class="ident" id="8143306">v</span><span class="op" id="8143307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8143310">if</span>&nbsp;<span class="ident" id="8143313">err</span>&nbsp;<span class="op" id="8143317">!=</span>&nbsp;<span class="ident" id="8143320">nil</span>&nbsp;<span class="op" id="8143324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143328">t</span><span class="op" id="8143329">.</span><span class="ident" id="8143330">Fatal</span><span class="op" id="8143335">(</span><span class="string" id="8143336">&#34;Marshal:&#34;</span><span class="op" id="8143346">,</span>&nbsp;<span class="ident" id="8143348">err</span><span class="op" id="8143351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8143354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143357">want</span>&nbsp;<span class="op" id="8143362">:=</span>&nbsp;<span class="string" id="8143365">`{}`</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143371">got</span>&nbsp;<span class="op" id="8143375">:=</span>&nbsp;<span class="builtintype" id="8143378">string</span><span class="op" id="8143384">(</span><span class="ident" id="8143385">b</span><span class="op" id="8143386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8143389">if</span>&nbsp;<span class="ident" id="8143392">got</span>&nbsp;<span class="op" id="8143396">!=</span>&nbsp;<span class="ident" id="8143399">want</span>&nbsp;<span class="op" id="8143404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143408">t</span><span class="op" id="8143409">.</span><span class="ident" id="8143410">Fatalf</span><span class="op" id="8143416">(</span><span class="string" id="8143417">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8143442">,</span>&nbsp;<span class="ident" id="8143444">got</span><span class="op" id="8143447">,</span>&nbsp;<span class="ident" id="8143449">want</span><span class="op" id="8143453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8143456">}</span><br>
<span class="lineno"></span><span class="op" id="8143458">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="keyword" id="8143461">func</span>&nbsp;<span class="ident" id="8143466">TestStringBytes</span><span class="op" id="8143481">(</span><span class="ident" id="8143482">t</span>&nbsp;<span class="op" id="8143484">*</span><span class="ident" id="8143485">testing</span><span class="op" id="8143492">.</span><span class="ident" id="8143493">T</span><span class="op" id="8143494">)</span>&nbsp;<span class="op" id="8143496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8143499">//&nbsp;Test&nbsp;that&nbsp;encodeState.stringBytes&nbsp;and&nbsp;encodeState.string&nbsp;use&nbsp;the&nbsp;same&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143583">es</span>&nbsp;<span class="op" id="8143586">:=</span>&nbsp;<span class="op" id="8143589">&amp;</span><span class="ident" id="8143590">encodeState</span><span class="op" id="8143601">{</span><span class="op" id="8143602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8143605">var</span>&nbsp;<span class="ident" id="8143609">r</span>&nbsp;<span class="op" id="8143611">[</span><span class="op" id="8143612">]</span><span class="builtintype" id="8143613">rune</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8143619">for</span>&nbsp;<span class="ident" id="8143623">i</span>&nbsp;<span class="op" id="8143625">:=</span>&nbsp;<span class="string" id="8143628">&#39;\u0000&#39;</span><span class="op" id="8143636">;</span>&nbsp;<span class="ident" id="8143638">i</span>&nbsp;<span class="op" id="8143640">&lt;=</span>&nbsp;<span class="ident" id="8143643">unicode</span><span class="op" id="8143650">.</span><span class="ident" id="8143651">MaxRune</span><span class="op" id="8143658">;</span>&nbsp;<span class="ident" id="8143660">i</span><span class="op" id="8143661">++</span>&nbsp;<span class="op" id="8143664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143668">r</span>&nbsp;<span class="op" id="8143670">=</span>&nbsp;<span class="builtinfunc" id="8143672">append</span><span class="op" id="8143678">(</span><span class="ident" id="8143679">r</span><span class="op" id="8143680">,</span>&nbsp;<span class="ident" id="8143682">i</span><span class="op" id="8143683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8143686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143689">s</span>&nbsp;<span class="op" id="8143691">:=</span>&nbsp;<span class="builtintype" id="8143694">string</span><span class="op" id="8143700">(</span><span class="ident" id="8143701">r</span><span class="op" id="8143702">)</span>&nbsp;<span class="op" id="8143704">+</span>&nbsp;<span class="string" id="8143706">&#34;\xff\xff\xffhello&#34;</span>&nbsp;<span class="comment" id="8143726">//&nbsp;some&nbsp;invalid&nbsp;UTF-8&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143753">_</span><span class="op" id="8143754">,</span>&nbsp;<span class="ident" id="8143756">err</span>&nbsp;<span class="op" id="8143760">:=</span>&nbsp;<span class="ident" id="8143763">es</span><span class="op" id="8143765">.</span><span class="builtintype" id="8143766">string</span><span class="op" id="8143772">(</span><span class="ident" id="8143773">s</span><span class="op" id="8143774">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8143777">if</span>&nbsp;<span class="ident" id="8143780">err</span>&nbsp;<span class="op" id="8143784">!=</span>&nbsp;<span class="ident" id="8143787">nil</span>&nbsp;<span class="op" id="8143791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143795">t</span><span class="op" id="8143796">.</span><span class="ident" id="8143797">Fatal</span><span class="op" id="8143802">(</span><span class="ident" id="8143803">err</span><span class="op" id="8143806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8143809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143813">esBytes</span>&nbsp;<span class="op" id="8143821">:=</span>&nbsp;<span class="op" id="8143824">&amp;</span><span class="ident" id="8143825">encodeState</span><span class="op" id="8143836">{</span><span class="op" id="8143837">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143840">_</span><span class="op" id="8143841">,</span>&nbsp;<span class="ident" id="8143843">err</span>&nbsp;<span class="op" id="8143847">=</span>&nbsp;<span class="ident" id="8143849">esBytes</span><span class="op" id="8143856">.</span><span class="ident" id="8143857">stringBytes</span><span class="op" id="8143868">(</span><span class="op" id="8143869">[</span><span class="op" id="8143870">]</span><span class="builtintype" id="8143871">byte</span><span class="op" id="8143875">(</span><span class="ident" id="8143876">s</span><span class="op" id="8143877">)</span><span class="op" id="8143878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8143881">if</span>&nbsp;<span class="ident" id="8143884">err</span>&nbsp;<span class="op" id="8143888">!=</span>&nbsp;<span class="ident" id="8143891">nil</span>&nbsp;<span class="op" id="8143895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143899">t</span><span class="op" id="8143900">.</span><span class="ident" id="8143901">Fatal</span><span class="op" id="8143906">(</span><span class="ident" id="8143907">err</span><span class="op" id="8143910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8143913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143917">enc</span>&nbsp;<span class="op" id="8143921">:=</span>&nbsp;<span class="ident" id="8143924">es</span><span class="op" id="8143926">.</span><span class="ident" id="8143927">Buffer</span><span class="op" id="8143933">.</span><span class="ident" id="8143934">String</span><span class="op" id="8143940">(</span><span class="op" id="8143941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143944">encBytes</span>&nbsp;<span class="op" id="8143953">:=</span>&nbsp;<span class="ident" id="8143956">esBytes</span><span class="op" id="8143963">.</span><span class="ident" id="8143964">Buffer</span><span class="op" id="8143970">.</span><span class="ident" id="8143971">String</span><span class="op" id="8143977">(</span><span class="op" id="8143978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8143981">if</span>&nbsp;<span class="ident" id="8143984">enc</span>&nbsp;<span class="op" id="8143988">!=</span>&nbsp;<span class="ident" id="8143991">encBytes</span>&nbsp;<span class="op" id="8144000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144004">i</span>&nbsp;<span class="op" id="8144006">:=</span>&nbsp;<span class="num" id="8144009">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8144013">for</span>&nbsp;<span class="ident" id="8144017">i</span>&nbsp;<span class="op" id="8144019">&lt;</span>&nbsp;<span class="builtinfunc" id="8144021">len</span><span class="op" id="8144024">(</span><span class="ident" id="8144025">enc</span><span class="op" id="8144028">)</span>&nbsp;<span class="op" id="8144030">&amp;&amp;</span>&nbsp;<span class="ident" id="8144033">i</span>&nbsp;<span class="op" id="8144035">&lt;</span>&nbsp;<span class="builtinfunc" id="8144037">len</span><span class="op" id="8144040">(</span><span class="ident" id="8144041">encBytes</span><span class="op" id="8144049">)</span>&nbsp;<span class="op" id="8144051">&amp;&amp;</span>&nbsp;<span class="ident" id="8144054">enc</span><span class="op" id="8144057">[</span><span class="ident" id="8144058">i</span><span class="op" id="8144059">]</span>&nbsp;<span class="op" id="8144061">==</span>&nbsp;<span class="ident" id="8144064">encBytes</span><span class="op" id="8144072">[</span><span class="ident" id="8144073">i</span><span class="op" id="8144074">]</span>&nbsp;<span class="op" id="8144076">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144081">i</span><span class="op" id="8144082">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8144087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144091">enc</span>&nbsp;<span class="op" id="8144095">=</span>&nbsp;<span class="ident" id="8144097">enc</span><span class="op" id="8144100">[</span><span class="ident" id="8144101">i</span><span class="op" id="8144102">:</span><span class="op" id="8144103">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144107">encBytes</span>&nbsp;<span class="op" id="8144116">=</span>&nbsp;<span class="ident" id="8144118">encBytes</span><span class="op" id="8144126">[</span><span class="ident" id="8144127">i</span><span class="op" id="8144128">:</span><span class="op" id="8144129">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144133">i</span>&nbsp;<span class="op" id="8144135">=</span>&nbsp;<span class="num" id="8144137">0</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8144141">for</span>&nbsp;<span class="ident" id="8144145">i</span>&nbsp;<span class="op" id="8144147">&lt;</span>&nbsp;<span class="builtinfunc" id="8144149">len</span><span class="op" id="8144152">(</span><span class="ident" id="8144153">enc</span><span class="op" id="8144156">)</span>&nbsp;<span class="op" id="8144158">&amp;&amp;</span>&nbsp;<span class="ident" id="8144161">i</span>&nbsp;<span class="op" id="8144163">&lt;</span>&nbsp;<span class="builtinfunc" id="8144165">len</span><span class="op" id="8144168">(</span><span class="ident" id="8144169">encBytes</span><span class="op" id="8144177">)</span>&nbsp;<span class="op" id="8144179">&amp;&amp;</span>&nbsp;<span class="ident" id="8144182">enc</span><span class="op" id="8144185">[</span><span class="builtinfunc" id="8144186">len</span><span class="op" id="8144189">(</span><span class="ident" id="8144190">enc</span><span class="op" id="8144193">)</span><span class="op" id="8144194">-</span><span class="ident" id="8144195">i</span><span class="op" id="8144196">-</span><span class="num" id="8144197">1</span><span class="op" id="8144198">]</span>&nbsp;<span class="op" id="8144200">==</span>&nbsp;<span class="ident" id="8144203">encBytes</span><span class="op" id="8144211">[</span><span class="builtinfunc" id="8144212">len</span><span class="op" id="8144215">(</span><span class="ident" id="8144216">encBytes</span><span class="op" id="8144224">)</span><span class="op" id="8144225">-</span><span class="ident" id="8144226">i</span><span class="op" id="8144227">-</span><span class="num" id="8144228">1</span><span class="op" id="8144229">]</span>&nbsp;<span class="op" id="8144231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144236">i</span><span class="op" id="8144237">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8144242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144246">enc</span>&nbsp;<span class="op" id="8144250">=</span>&nbsp;<span class="ident" id="8144252">enc</span><span class="op" id="8144255">[</span><span class="op" id="8144256">:</span><span class="builtinfunc" id="8144257">len</span><span class="op" id="8144260">(</span><span class="ident" id="8144261">enc</span><span class="op" id="8144264">)</span><span class="op" id="8144265">-</span><span class="ident" id="8144266">i</span><span class="op" id="8144267">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144271">encBytes</span>&nbsp;<span class="op" id="8144280">=</span>&nbsp;<span class="ident" id="8144282">encBytes</span><span class="op" id="8144290">[</span><span class="op" id="8144291">:</span><span class="builtinfunc" id="8144292">len</span><span class="op" id="8144295">(</span><span class="ident" id="8144296">encBytes</span><span class="op" id="8144304">)</span><span class="op" id="8144305">-</span><span class="ident" id="8144306">i</span><span class="op" id="8144307">]</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8144312">if</span>&nbsp;<span class="builtinfunc" id="8144315">len</span><span class="op" id="8144318">(</span><span class="ident" id="8144319">enc</span><span class="op" id="8144322">)</span>&nbsp;<span class="op" id="8144324">&gt;</span>&nbsp;<span class="num" id="8144326">20</span>&nbsp;<span class="op" id="8144329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144334">enc</span>&nbsp;<span class="op" id="8144338">=</span>&nbsp;<span class="ident" id="8144340">enc</span><span class="op" id="8144343">[</span><span class="op" id="8144344">:</span><span class="num" id="8144345">20</span><span class="op" id="8144347">]</span>&nbsp;<span class="op" id="8144349">+</span>&nbsp;<span class="string" id="8144351">&#34;...&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8144359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8144363">if</span>&nbsp;<span class="builtinfunc" id="8144366">len</span><span class="op" id="8144369">(</span><span class="ident" id="8144370">encBytes</span><span class="op" id="8144378">)</span>&nbsp;<span class="op" id="8144380">&gt;</span>&nbsp;<span class="num" id="8144382">20</span>&nbsp;<span class="op" id="8144385">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144390">encBytes</span>&nbsp;<span class="op" id="8144399">=</span>&nbsp;<span class="ident" id="8144401">encBytes</span><span class="op" id="8144409">[</span><span class="op" id="8144410">:</span><span class="num" id="8144411">20</span><span class="op" id="8144413">]</span>&nbsp;<span class="op" id="8144415">+</span>&nbsp;<span class="string" id="8144417">&#34;...&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8144425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144430">t</span><span class="op" id="8144431">.</span><span class="ident" id="8144432">Errorf</span><span class="op" id="8144438">(</span><span class="string" id="8144439">&#34;encodings&nbsp;differ&nbsp;at&nbsp;%#q&nbsp;vs&nbsp;%#q&#34;</span><span class="op" id="8144471">,</span>&nbsp;<span class="ident" id="8144473">enc</span><span class="op" id="8144476">,</span>&nbsp;<span class="ident" id="8144478">encBytes</span><span class="op" id="8144486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8144489">}</span><br>
<span class="lineno">420</span><span class="op" id="8144491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8144494">func</span>&nbsp;<span class="ident" id="8144499">TestIssue6458</span><span class="op" id="8144512">(</span><span class="ident" id="8144513">t</span>&nbsp;<span class="op" id="8144515">*</span><span class="ident" id="8144516">testing</span><span class="op" id="8144523">.</span><span class="ident" id="8144524">T</span><span class="op" id="8144525">)</span>&nbsp;<span class="op" id="8144527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8144530">type</span>&nbsp;<span class="ident" id="8144535">Foo</span>&nbsp;<span class="keyword" id="8144539">struct</span>&nbsp;<span class="op" id="8144546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144550">M</span>&nbsp;<span class="ident" id="8144552">RawMessage</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8144564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144567">x</span>&nbsp;<span class="op" id="8144569">:=</span>&nbsp;<span class="ident" id="8144572">Foo</span><span class="op" id="8144575">{</span><span class="ident" id="8144576">RawMessage</span><span class="op" id="8144586">(</span><span class="string" id="8144587">`&#34;foo&#34;`</span><span class="op" id="8144594">)</span><span class="op" id="8144595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144599">b</span><span class="op" id="8144600">,</span>&nbsp;<span class="ident" id="8144602">err</span>&nbsp;<span class="op" id="8144606">:=</span>&nbsp;<span class="ident" id="8144609">Marshal</span><span class="op" id="8144616">(</span><span class="op" id="8144617">&amp;</span><span class="ident" id="8144618">x</span><span class="op" id="8144619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8144622">if</span>&nbsp;<span class="ident" id="8144625">err</span>&nbsp;<span class="op" id="8144629">!=</span>&nbsp;<span class="ident" id="8144632">nil</span>&nbsp;<span class="op" id="8144636">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144640">t</span><span class="op" id="8144641">.</span><span class="ident" id="8144642">Fatal</span><span class="op" id="8144647">(</span><span class="ident" id="8144648">err</span><span class="op" id="8144651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8144654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8144657">if</span>&nbsp;<span class="ident" id="8144660">want</span>&nbsp;<span class="op" id="8144665">:=</span>&nbsp;<span class="string" id="8144668">`{&#34;M&#34;:&#34;foo&#34;}`</span><span class="op" id="8144681">;</span>&nbsp;<span class="builtintype" id="8144683">string</span><span class="op" id="8144689">(</span><span class="ident" id="8144690">b</span><span class="op" id="8144691">)</span>&nbsp;<span class="op" id="8144693">!=</span>&nbsp;<span class="ident" id="8144696">want</span>&nbsp;<span class="op" id="8144701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144705">t</span><span class="op" id="8144706">.</span><span class="ident" id="8144707">Errorf</span><span class="op" id="8144713">(</span><span class="string" id="8144714">&#34;Marshal(&amp;x)&nbsp;=&nbsp;%#q;&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="8144743">,</span>&nbsp;<span class="ident" id="8144745">b</span><span class="op" id="8144746">,</span>&nbsp;<span class="ident" id="8144748">want</span><span class="op" id="8144752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8144755">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144759">b</span><span class="op" id="8144760">,</span>&nbsp;<span class="ident" id="8144762">err</span>&nbsp;<span class="op" id="8144766">=</span>&nbsp;<span class="ident" id="8144768">Marshal</span><span class="op" id="8144775">(</span><span class="ident" id="8144776">x</span><span class="op" id="8144777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8144780">if</span>&nbsp;<span class="ident" id="8144783">err</span>&nbsp;<span class="op" id="8144787">!=</span>&nbsp;<span class="ident" id="8144790">nil</span>&nbsp;<span class="op" id="8144794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144798">t</span><span class="op" id="8144799">.</span><span class="ident" id="8144800">Fatal</span><span class="op" id="8144805">(</span><span class="ident" id="8144806">err</span><span class="op" id="8144809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8144812">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8144816">if</span>&nbsp;<span class="ident" id="8144819">want</span>&nbsp;<span class="op" id="8144824">:=</span>&nbsp;<span class="string" id="8144827">`{&#34;M&#34;:&#34;ImZvbyI=&#34;}`</span><span class="op" id="8144845">;</span>&nbsp;<span class="builtintype" id="8144847">string</span><span class="op" id="8144853">(</span><span class="ident" id="8144854">b</span><span class="op" id="8144855">)</span>&nbsp;<span class="op" id="8144857">!=</span>&nbsp;<span class="ident" id="8144860">want</span>&nbsp;<span class="op" id="8144865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144869">t</span><span class="op" id="8144870">.</span><span class="ident" id="8144871">Errorf</span><span class="op" id="8144877">(</span><span class="string" id="8144878">&#34;Marshal(x)&nbsp;=&nbsp;%#q;&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="8144906">,</span>&nbsp;<span class="ident" id="8144908">b</span><span class="op" id="8144909">,</span>&nbsp;<span class="ident" id="8144911">want</span><span class="op" id="8144915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8144918">}</span><br>
<span class="lineno"></span><span class="op" id="8144920">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="8144923">func</span>&nbsp;<span class="ident" id="8144928">TestHTMLEscape</span><span class="op" id="8144942">(</span><span class="ident" id="8144943">t</span>&nbsp;<span class="op" id="8144945">*</span><span class="ident" id="8144946">testing</span><span class="op" id="8144953">.</span><span class="ident" id="8144954">T</span><span class="op" id="8144955">)</span>&nbsp;<span class="op" id="8144957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8144960">var</span>&nbsp;<span class="ident" id="8144964">b</span><span class="op" id="8144965">,</span>&nbsp;<span class="ident" id="8144967">want</span>&nbsp;<span class="ident" id="8144972">bytes</span><span class="op" id="8144977">.</span><span class="ident" id="8144978">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144986">m</span>&nbsp;<span class="op" id="8144988">:=</span>&nbsp;<span class="string" id="8144991">`{&#34;M&#34;:&#34;&lt;html&gt;foo&nbsp;&amp;`</span>&nbsp;<span class="op" id="8145011">+</span>&nbsp;<span class="string" id="8145013">&#34;\xe2\x80\xa8&nbsp;\xe2\x80\xa9&#34;</span>&nbsp;<span class="op" id="8145041">+</span>&nbsp;<span class="string" id="8145043">`&lt;/html&gt;&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145056">want</span><span class="op" id="8145060">.</span><span class="ident" id="8145061">Write</span><span class="op" id="8145066">(</span><span class="op" id="8145067">[</span><span class="op" id="8145068">]</span><span class="builtintype" id="8145069">byte</span><span class="op" id="8145073">(</span><span class="string" id="8145074">`{&#34;M&#34;:&#34;\u003chtml\u003efoo&nbsp;\u0026\u2028&nbsp;\u2029\u003c/html\u003e&#34;}`</span><span class="op" id="8145140">)</span><span class="op" id="8145141">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145144">HTMLEscape</span><span class="op" id="8145154">(</span><span class="op" id="8145155">&amp;</span><span class="ident" id="8145156">b</span><span class="op" id="8145157">,</span>&nbsp;<span class="op" id="8145159">[</span><span class="op" id="8145160">]</span><span class="builtintype" id="8145161">byte</span><span class="op" id="8145165">(</span><span class="ident" id="8145166">m</span><span class="op" id="8145167">)</span><span class="op" id="8145168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8145171">if</span>&nbsp;<span class="op" id="8145174">!</span><span class="ident" id="8145175">bytes</span><span class="op" id="8145180">.</span><span class="ident" id="8145181">Equal</span><span class="op" id="8145186">(</span><span class="ident" id="8145187">b</span><span class="op" id="8145188">.</span><span class="ident" id="8145189">Bytes</span><span class="op" id="8145194">(</span><span class="op" id="8145195">)</span><span class="op" id="8145196">,</span>&nbsp;<span class="ident" id="8145198">want</span><span class="op" id="8145202">.</span><span class="ident" id="8145203">Bytes</span><span class="op" id="8145208">(</span><span class="op" id="8145209">)</span><span class="op" id="8145210">)</span>&nbsp;<span class="op" id="8145212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145216">t</span><span class="op" id="8145217">.</span><span class="ident" id="8145218">Errorf</span><span class="op" id="8145224">(</span><span class="string" id="8145225">&#34;HTMLEscape(&amp;b,&nbsp;[]byte(m))&nbsp;=&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8145266">,</span>&nbsp;<span class="ident" id="8145268">b</span><span class="op" id="8145269">.</span><span class="ident" id="8145270">Bytes</span><span class="op" id="8145275">(</span><span class="op" id="8145276">)</span><span class="op" id="8145277">,</span>&nbsp;<span class="ident" id="8145279">want</span><span class="op" id="8145283">.</span><span class="ident" id="8145284">Bytes</span><span class="op" id="8145289">(</span><span class="op" id="8145290">)</span><span class="op" id="8145291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8145294">}</span><br>
<span class="lineno"></span><span class="op" id="8145296">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="8145299">//&nbsp;golang.org/issue/8582</span><br>
<span class="lineno"></span><span class="keyword" id="8145324">func</span>&nbsp;<span class="ident" id="8145329">TestEncodePointerString</span><span class="op" id="8145352">(</span><span class="ident" id="8145353">t</span>&nbsp;<span class="op" id="8145355">*</span><span class="ident" id="8145356">testing</span><span class="op" id="8145363">.</span><span class="ident" id="8145364">T</span><span class="op" id="8145365">)</span>&nbsp;<span class="op" id="8145367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8145370">type</span>&nbsp;<span class="ident" id="8145375">stringPointer</span>&nbsp;<span class="keyword" id="8145389">struct</span>&nbsp;<span class="op" id="8145396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145400">N</span>&nbsp;<span class="op" id="8145402">*</span><span class="ident" id="8145403">int64</span>&nbsp;<span class="string" id="8145409">`json:&#34;n,string&#34;`</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8145428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8145431">var</span>&nbsp;<span class="ident" id="8145435">n</span>&nbsp;<span class="ident" id="8145437">int64</span>&nbsp;<span class="op" id="8145443">=</span>&nbsp;<span class="num" id="8145445">42</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145449">b</span><span class="op" id="8145450">,</span>&nbsp;<span class="ident" id="8145452">err</span>&nbsp;<span class="op" id="8145456">:=</span>&nbsp;<span class="ident" id="8145459">Marshal</span><span class="op" id="8145466">(</span><span class="ident" id="8145467">stringPointer</span><span class="op" id="8145480">{</span><span class="ident" id="8145481">N</span><span class="op" id="8145482">:</span>&nbsp;<span class="op" id="8145484">&amp;</span><span class="ident" id="8145485">n</span><span class="op" id="8145486">}</span><span class="op" id="8145487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8145490">if</span>&nbsp;<span class="ident" id="8145493">err</span>&nbsp;<span class="op" id="8145497">!=</span>&nbsp;<span class="ident" id="8145500">nil</span>&nbsp;<span class="op" id="8145504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145508">t</span><span class="op" id="8145509">.</span><span class="ident" id="8145510">Fatalf</span><span class="op" id="8145516">(</span><span class="string" id="8145517">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="8145530">,</span>&nbsp;<span class="ident" id="8145532">err</span><span class="op" id="8145535">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8145538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8145541">if</span>&nbsp;<span class="ident" id="8145544">got</span><span class="op" id="8145547">,</span>&nbsp;<span class="ident" id="8145549">want</span>&nbsp;<span class="op" id="8145554">:=</span>&nbsp;<span class="builtintype" id="8145557">string</span><span class="op" id="8145563">(</span><span class="ident" id="8145564">b</span><span class="op" id="8145565">)</span><span class="op" id="8145566">,</span>&nbsp;<span class="string" id="8145568">`{&#34;n&#34;:&#34;42&#34;}`</span><span class="op" id="8145580">;</span>&nbsp;<span class="ident" id="8145582">got</span>&nbsp;<span class="op" id="8145586">!=</span>&nbsp;<span class="ident" id="8145589">want</span>&nbsp;<span class="op" id="8145594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145598">t</span><span class="op" id="8145599">.</span><span class="ident" id="8145600">Errorf</span><span class="op" id="8145606">(</span><span class="string" id="8145607">&#34;Marshal&nbsp;=&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8145630">,</span>&nbsp;<span class="ident" id="8145632">got</span><span class="op" id="8145635">,</span>&nbsp;<span class="ident" id="8145637">want</span><span class="op" id="8145641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8145644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8145647">var</span>&nbsp;<span class="ident" id="8145651">back</span>&nbsp;<span class="ident" id="8145656">stringPointer</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145671">err</span>&nbsp;<span class="op" id="8145675">=</span>&nbsp;<span class="ident" id="8145677">Unmarshal</span><span class="op" id="8145686">(</span><span class="ident" id="8145687">b</span><span class="op" id="8145688">,</span>&nbsp;<span class="op" id="8145690">&amp;</span><span class="ident" id="8145691">back</span><span class="op" id="8145695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8145698">if</span>&nbsp;<span class="ident" id="8145701">err</span>&nbsp;<span class="op" id="8145705">!=</span>&nbsp;<span class="ident" id="8145708">nil</span>&nbsp;<span class="op" id="8145712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145716">t</span><span class="op" id="8145717">.</span><span class="ident" id="8145718">Fatalf</span><span class="op" id="8145724">(</span><span class="string" id="8145725">&#34;Unmarshal:&nbsp;%v&#34;</span><span class="op" id="8145740">,</span>&nbsp;<span class="ident" id="8145742">err</span><span class="op" id="8145745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8145748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8145751">if</span>&nbsp;<span class="ident" id="8145754">back</span><span class="op" id="8145758">.</span><span class="ident" id="8145759">N</span>&nbsp;<span class="op" id="8145761">==</span>&nbsp;<span class="ident" id="8145764">nil</span>&nbsp;<span class="op" id="8145768">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145772">t</span><span class="op" id="8145773">.</span><span class="ident" id="8145774">Fatalf</span><span class="op" id="8145780">(</span><span class="string" id="8145781">&#34;Unmarshalled&nbsp;nil&nbsp;N&nbsp;field&#34;</span><span class="op" id="8145807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8145810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8145813">if</span>&nbsp;<span class="op" id="8145816">*</span><span class="ident" id="8145817">back</span><span class="op" id="8145821">.</span><span class="ident" id="8145822">N</span>&nbsp;<span class="op" id="8145824">!=</span>&nbsp;<span class="num" id="8145827">42</span>&nbsp;<span class="op" id="8145830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145834">t</span><span class="op" id="8145835">.</span><span class="ident" id="8145836">Fatalf</span><span class="op" id="8145842">(</span><span class="string" id="8145843">&#34;*N&nbsp;=&nbsp;%d;&nbsp;want&nbsp;42&#34;</span><span class="op" id="8145861">,</span>&nbsp;<span class="op" id="8145863">*</span><span class="ident" id="8145864">back</span><span class="op" id="8145868">.</span><span class="ident" id="8145869">N</span><span class="op" id="8145870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8145873">}</span><br>
<span class="lineno">480</span><span class="op" id="8145875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8145878">var</span>&nbsp;<span class="ident" id="8145882">encodeStringTests</span>&nbsp;<span class="op" id="8145900">=</span>&nbsp;<span class="op" id="8145902">[</span><span class="op" id="8145903">]</span><span class="keyword" id="8145904">struct</span>&nbsp;<span class="op" id="8145911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145914">in</span>&nbsp;&nbsp;<span class="builtintype" id="8145918">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145926">out</span>&nbsp;<span class="builtintype" id="8145930">string</span><br>
<span class="lineno">485</span><span class="op" id="8145937">}</span><span class="op" id="8145938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8145941">{</span><span class="string" id="8145942">&#34;\x00&#34;</span><span class="op" id="8145948">,</span>&nbsp;<span class="string" id="8145950">`&#34;\u0000&#34;`</span><span class="op" id="8145960">}</span><span class="op" id="8145961">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8145964">{</span><span class="string" id="8145965">&#34;\x01&#34;</span><span class="op" id="8145971">,</span>&nbsp;<span class="string" id="8145973">`&#34;\u0001&#34;`</span><span class="op" id="8145983">}</span><span class="op" id="8145984">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8145987">{</span><span class="string" id="8145988">&#34;\x02&#34;</span><span class="op" id="8145994">,</span>&nbsp;<span class="string" id="8145996">`&#34;\u0002&#34;`</span><span class="op" id="8146006">}</span><span class="op" id="8146007">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146010">{</span><span class="string" id="8146011">&#34;\x03&#34;</span><span class="op" id="8146017">,</span>&nbsp;<span class="string" id="8146019">`&#34;\u0003&#34;`</span><span class="op" id="8146029">}</span><span class="op" id="8146030">,</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146033">{</span><span class="string" id="8146034">&#34;\x04&#34;</span><span class="op" id="8146040">,</span>&nbsp;<span class="string" id="8146042">`&#34;\u0004&#34;`</span><span class="op" id="8146052">}</span><span class="op" id="8146053">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146056">{</span><span class="string" id="8146057">&#34;\x05&#34;</span><span class="op" id="8146063">,</span>&nbsp;<span class="string" id="8146065">`&#34;\u0005&#34;`</span><span class="op" id="8146075">}</span><span class="op" id="8146076">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146079">{</span><span class="string" id="8146080">&#34;\x06&#34;</span><span class="op" id="8146086">,</span>&nbsp;<span class="string" id="8146088">`&#34;\u0006&#34;`</span><span class="op" id="8146098">}</span><span class="op" id="8146099">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146102">{</span><span class="string" id="8146103">&#34;\x07&#34;</span><span class="op" id="8146109">,</span>&nbsp;<span class="string" id="8146111">`&#34;\u0007&#34;`</span><span class="op" id="8146121">}</span><span class="op" id="8146122">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146125">{</span><span class="string" id="8146126">&#34;\x08&#34;</span><span class="op" id="8146132">,</span>&nbsp;<span class="string" id="8146134">`&#34;\u0008&#34;`</span><span class="op" id="8146144">}</span><span class="op" id="8146145">,</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146148">{</span><span class="string" id="8146149">&#34;\x09&#34;</span><span class="op" id="8146155">,</span>&nbsp;<span class="string" id="8146157">`&#34;\t&#34;`</span><span class="op" id="8146163">}</span><span class="op" id="8146164">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146167">{</span><span class="string" id="8146168">&#34;\x0a&#34;</span><span class="op" id="8146174">,</span>&nbsp;<span class="string" id="8146176">`&#34;\n&#34;`</span><span class="op" id="8146182">}</span><span class="op" id="8146183">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146186">{</span><span class="string" id="8146187">&#34;\x0b&#34;</span><span class="op" id="8146193">,</span>&nbsp;<span class="string" id="8146195">`&#34;\u000b&#34;`</span><span class="op" id="8146205">}</span><span class="op" id="8146206">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146209">{</span><span class="string" id="8146210">&#34;\x0c&#34;</span><span class="op" id="8146216">,</span>&nbsp;<span class="string" id="8146218">`&#34;\u000c&#34;`</span><span class="op" id="8146228">}</span><span class="op" id="8146229">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146232">{</span><span class="string" id="8146233">&#34;\x0d&#34;</span><span class="op" id="8146239">,</span>&nbsp;<span class="string" id="8146241">`&#34;\r&#34;`</span><span class="op" id="8146247">}</span><span class="op" id="8146248">,</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146251">{</span><span class="string" id="8146252">&#34;\x0e&#34;</span><span class="op" id="8146258">,</span>&nbsp;<span class="string" id="8146260">`&#34;\u000e&#34;`</span><span class="op" id="8146270">}</span><span class="op" id="8146271">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146274">{</span><span class="string" id="8146275">&#34;\x0f&#34;</span><span class="op" id="8146281">,</span>&nbsp;<span class="string" id="8146283">`&#34;\u000f&#34;`</span><span class="op" id="8146293">}</span><span class="op" id="8146294">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146297">{</span><span class="string" id="8146298">&#34;\x10&#34;</span><span class="op" id="8146304">,</span>&nbsp;<span class="string" id="8146306">`&#34;\u0010&#34;`</span><span class="op" id="8146316">}</span><span class="op" id="8146317">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146320">{</span><span class="string" id="8146321">&#34;\x11&#34;</span><span class="op" id="8146327">,</span>&nbsp;<span class="string" id="8146329">`&#34;\u0011&#34;`</span><span class="op" id="8146339">}</span><span class="op" id="8146340">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146343">{</span><span class="string" id="8146344">&#34;\x12&#34;</span><span class="op" id="8146350">,</span>&nbsp;<span class="string" id="8146352">`&#34;\u0012&#34;`</span><span class="op" id="8146362">}</span><span class="op" id="8146363">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146366">{</span><span class="string" id="8146367">&#34;\x13&#34;</span><span class="op" id="8146373">,</span>&nbsp;<span class="string" id="8146375">`&#34;\u0013&#34;`</span><span class="op" id="8146385">}</span><span class="op" id="8146386">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146389">{</span><span class="string" id="8146390">&#34;\x14&#34;</span><span class="op" id="8146396">,</span>&nbsp;<span class="string" id="8146398">`&#34;\u0014&#34;`</span><span class="op" id="8146408">}</span><span class="op" id="8146409">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146412">{</span><span class="string" id="8146413">&#34;\x15&#34;</span><span class="op" id="8146419">,</span>&nbsp;<span class="string" id="8146421">`&#34;\u0015&#34;`</span><span class="op" id="8146431">}</span><span class="op" id="8146432">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146435">{</span><span class="string" id="8146436">&#34;\x16&#34;</span><span class="op" id="8146442">,</span>&nbsp;<span class="string" id="8146444">`&#34;\u0016&#34;`</span><span class="op" id="8146454">}</span><span class="op" id="8146455">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146458">{</span><span class="string" id="8146459">&#34;\x17&#34;</span><span class="op" id="8146465">,</span>&nbsp;<span class="string" id="8146467">`&#34;\u0017&#34;`</span><span class="op" id="8146477">}</span><span class="op" id="8146478">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146481">{</span><span class="string" id="8146482">&#34;\x18&#34;</span><span class="op" id="8146488">,</span>&nbsp;<span class="string" id="8146490">`&#34;\u0018&#34;`</span><span class="op" id="8146500">}</span><span class="op" id="8146501">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146504">{</span><span class="string" id="8146505">&#34;\x19&#34;</span><span class="op" id="8146511">,</span>&nbsp;<span class="string" id="8146513">`&#34;\u0019&#34;`</span><span class="op" id="8146523">}</span><span class="op" id="8146524">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146527">{</span><span class="string" id="8146528">&#34;\x1a&#34;</span><span class="op" id="8146534">,</span>&nbsp;<span class="string" id="8146536">`&#34;\u001a&#34;`</span><span class="op" id="8146546">}</span><span class="op" id="8146547">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146550">{</span><span class="string" id="8146551">&#34;\x1b&#34;</span><span class="op" id="8146557">,</span>&nbsp;<span class="string" id="8146559">`&#34;\u001b&#34;`</span><span class="op" id="8146569">}</span><span class="op" id="8146570">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146573">{</span><span class="string" id="8146574">&#34;\x1c&#34;</span><span class="op" id="8146580">,</span>&nbsp;<span class="string" id="8146582">`&#34;\u001c&#34;`</span><span class="op" id="8146592">}</span><span class="op" id="8146593">,</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146596">{</span><span class="string" id="8146597">&#34;\x1d&#34;</span><span class="op" id="8146603">,</span>&nbsp;<span class="string" id="8146605">`&#34;\u001d&#34;`</span><span class="op" id="8146615">}</span><span class="op" id="8146616">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146619">{</span><span class="string" id="8146620">&#34;\x1e&#34;</span><span class="op" id="8146626">,</span>&nbsp;<span class="string" id="8146628">`&#34;\u001e&#34;`</span><span class="op" id="8146638">}</span><span class="op" id="8146639">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146642">{</span><span class="string" id="8146643">&#34;\x1f&#34;</span><span class="op" id="8146649">,</span>&nbsp;<span class="string" id="8146651">`&#34;\u001f&#34;`</span><span class="op" id="8146661">}</span><span class="op" id="8146662">,</span><br>
<span class="lineno"></span><span class="op" id="8146664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">520</span><span class="keyword" id="8146667">func</span>&nbsp;<span class="ident" id="8146672">TestEncodeString</span><span class="op" id="8146688">(</span><span class="ident" id="8146689">t</span>&nbsp;<span class="op" id="8146691">*</span><span class="ident" id="8146692">testing</span><span class="op" id="8146699">.</span><span class="ident" id="8146700">T</span><span class="op" id="8146701">)</span>&nbsp;<span class="op" id="8146703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8146706">for</span>&nbsp;<span class="ident" id="8146710">_</span><span class="op" id="8146711">,</span>&nbsp;<span class="ident" id="8146713">tt</span>&nbsp;<span class="op" id="8146716">:=</span>&nbsp;<span class="keyword" id="8146719">range</span>&nbsp;<span class="ident" id="8146725">encodeStringTests</span>&nbsp;<span class="op" id="8146743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8146747">b</span><span class="op" id="8146748">,</span>&nbsp;<span class="ident" id="8146750">err</span>&nbsp;<span class="op" id="8146754">:=</span>&nbsp;<span class="ident" id="8146757">Marshal</span><span class="op" id="8146764">(</span><span class="ident" id="8146765">tt</span><span class="op" id="8146767">.</span><span class="ident" id="8146768">in</span><span class="op" id="8146770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8146774">if</span>&nbsp;<span class="ident" id="8146777">err</span>&nbsp;<span class="op" id="8146781">!=</span>&nbsp;<span class="ident" id="8146784">nil</span>&nbsp;<span class="op" id="8146788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8146793">t</span><span class="op" id="8146794">.</span><span class="ident" id="8146795">Errorf</span><span class="op" id="8146801">(</span><span class="string" id="8146802">&#34;Marshal(%q):&nbsp;%v&#34;</span><span class="op" id="8146819">,</span>&nbsp;<span class="ident" id="8146821">tt</span><span class="op" id="8146823">.</span><span class="ident" id="8146824">in</span><span class="op" id="8146826">,</span>&nbsp;<span class="ident" id="8146828">err</span><span class="op" id="8146831">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8146836">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8146851">out</span>&nbsp;<span class="op" id="8146855">:=</span>&nbsp;<span class="builtintype" id="8146858">string</span><span class="op" id="8146864">(</span><span class="ident" id="8146865">b</span><span class="op" id="8146866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8146870">if</span>&nbsp;<span class="ident" id="8146873">out</span>&nbsp;<span class="op" id="8146877">!=</span>&nbsp;<span class="ident" id="8146880">tt</span><span class="op" id="8146882">.</span><span class="ident" id="8146883">out</span>&nbsp;<span class="op" id="8146887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8146892">t</span><span class="op" id="8146893">.</span><span class="ident" id="8146894">Errorf</span><span class="op" id="8146900">(</span><span class="string" id="8146901">&#34;Marshal(%q)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="8146930">,</span>&nbsp;<span class="ident" id="8146932">tt</span><span class="op" id="8146934">.</span><span class="ident" id="8146935">in</span><span class="op" id="8146937">,</span>&nbsp;<span class="ident" id="8146939">out</span><span class="op" id="8146942">,</span>&nbsp;<span class="ident" id="8146944">tt</span><span class="op" id="8146946">.</span><span class="ident" id="8146947">out</span><span class="op" id="8146950">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146957">}</span><br>
<span class="lineno"></span><span class="op" id="8146959">}</span>
</div>
</body>
</html>
