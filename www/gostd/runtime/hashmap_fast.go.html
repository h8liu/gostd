<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html" class="current">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1509184">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1509239">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1509293">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1509344">package</span>&nbsp;<span class="ident" id="1509352">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1509361">import</span>&nbsp;<span class="op" id="1509368">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1509371">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1509380">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1509383">func</span>&nbsp;<span class="ident" id="1509388">mapaccess1_fast32</span><span class="op" id="1509405">(</span><span class="ident" id="1509406">t</span>&nbsp;<span class="op" id="1509408">*</span><span class="ident" id="1509409">maptype</span><span class="op" id="1509416">,</span>&nbsp;<span class="ident" id="1509418">h</span>&nbsp;<span class="op" id="1509420">*</span><span class="ident" id="1509421">hmap</span><span class="op" id="1509425">,</span>&nbsp;<span class="ident" id="1509427">key</span>&nbsp;<span class="builtintype" id="1509431">uint32</span><span class="op" id="1509437">)</span>&nbsp;<span class="ident" id="1509439">unsafe</span><span class="op" id="1509445">.</span><span class="ident" id="1509446">Pointer</span>&nbsp;<span class="op" id="1509454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1509457">if</span>&nbsp;<span class="ident" id="1509460">raceenabled</span>&nbsp;<span class="op" id="1509472">&amp;&amp;</span>&nbsp;<span class="ident" id="1509475">h</span>&nbsp;<span class="op" id="1509477">!=</span>&nbsp;<span class="ident" id="1509480">nil</span>&nbsp;<span class="op" id="1509484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1509488">callerpc</span>&nbsp;<span class="op" id="1509497">:=</span>&nbsp;<span class="ident" id="1509500">getcallerpc</span><span class="op" id="1509511">(</span><span class="ident" id="1509512">unsafe</span><span class="op" id="1509518">.</span><span class="ident" id="1509519">Pointer</span><span class="op" id="1509526">(</span><span class="op" id="1509527">&amp;</span><span class="ident" id="1509528">t</span><span class="op" id="1509529">)</span><span class="op" id="1509530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1509534">racereadpc</span><span class="op" id="1509544">(</span><span class="ident" id="1509545">unsafe</span><span class="op" id="1509551">.</span><span class="ident" id="1509552">Pointer</span><span class="op" id="1509559">(</span><span class="ident" id="1509560">h</span><span class="op" id="1509561">)</span><span class="op" id="1509562">,</span>&nbsp;<span class="ident" id="1509564">callerpc</span><span class="op" id="1509572">,</span>&nbsp;<span class="ident" id="1509574">funcPC</span><span class="op" id="1509580">(</span><span class="ident" id="1509581">mapaccess1_fast32</span><span class="op" id="1509598">)</span><span class="op" id="1509599">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1509602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1509605">if</span>&nbsp;<span class="ident" id="1509608">h</span>&nbsp;<span class="op" id="1509610">==</span>&nbsp;<span class="ident" id="1509613">nil</span>&nbsp;<span class="op" id="1509617">||</span>&nbsp;<span class="ident" id="1509620">h</span><span class="op" id="1509621">.</span><span class="ident" id="1509622">count</span>&nbsp;<span class="op" id="1509628">==</span>&nbsp;<span class="num" id="1509631">0</span>&nbsp;<span class="op" id="1509633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1509637">return</span>&nbsp;<span class="ident" id="1509644">unsafe</span><span class="op" id="1509650">.</span><span class="ident" id="1509651">Pointer</span><span class="op" id="1509658">(</span><span class="ident" id="1509659">t</span><span class="op" id="1509660">.</span><span class="ident" id="1509661">elem</span><span class="op" id="1509665">.</span><span class="ident" id="1509666">zero</span><span class="op" id="1509670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1509673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1509676">var</span>&nbsp;<span class="ident" id="1509680">b</span>&nbsp;<span class="op" id="1509682">*</span><span class="ident" id="1509683">bmap</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1509689">if</span>&nbsp;<span class="ident" id="1509692">h</span><span class="op" id="1509693">.</span><span class="ident" id="1509694">B</span>&nbsp;<span class="op" id="1509696">==</span>&nbsp;<span class="num" id="1509699">0</span>&nbsp;<span class="op" id="1509701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1509705">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1509746">b</span>&nbsp;<span class="op" id="1509748">=</span>&nbsp;<span class="op" id="1509750">(</span><span class="op" id="1509751">*</span><span class="ident" id="1509752">bmap</span><span class="op" id="1509756">)</span><span class="op" id="1509757">(</span><span class="ident" id="1509758">h</span><span class="op" id="1509759">.</span><span class="ident" id="1509760">buckets</span><span class="op" id="1509767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1509770">}</span>&nbsp;<span class="keyword" id="1509772">else</span>&nbsp;<span class="op" id="1509777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1509781">hash</span>&nbsp;<span class="op" id="1509786">:=</span>&nbsp;<span class="ident" id="1509789">goalg</span><span class="op" id="1509794">(</span><span class="ident" id="1509795">t</span><span class="op" id="1509796">.</span><span class="ident" id="1509797">key</span><span class="op" id="1509800">.</span><span class="ident" id="1509801">alg</span><span class="op" id="1509804">)</span><span class="op" id="1509805">.</span><span class="ident" id="1509806">hash</span><span class="op" id="1509810">(</span><span class="ident" id="1509811">noescape</span><span class="op" id="1509819">(</span><span class="ident" id="1509820">unsafe</span><span class="op" id="1509826">.</span><span class="ident" id="1509827">Pointer</span><span class="op" id="1509834">(</span><span class="op" id="1509835">&amp;</span><span class="ident" id="1509836">key</span><span class="op" id="1509839">)</span><span class="op" id="1509840">)</span><span class="op" id="1509841">,</span>&nbsp;<span class="num" id="1509843">4</span><span class="op" id="1509844">,</span>&nbsp;<span class="builtintype" id="1509846">uintptr</span><span class="op" id="1509853">(</span><span class="ident" id="1509854">h</span><span class="op" id="1509855">.</span><span class="ident" id="1509856">hash0</span><span class="op" id="1509861">)</span><span class="op" id="1509862">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1509866">m</span>&nbsp;<span class="op" id="1509868">:=</span>&nbsp;<span class="builtintype" id="1509871">uintptr</span><span class="op" id="1509878">(</span><span class="num" id="1509879">1</span><span class="op" id="1509880">)</span><span class="op" id="1509881">&lt;&lt;</span><span class="ident" id="1509883">h</span><span class="op" id="1509884">.</span><span class="ident" id="1509885">B</span>&nbsp;<span class="op" id="1509887">-</span>&nbsp;<span class="num" id="1509889">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1509893">b</span>&nbsp;<span class="op" id="1509895">=</span>&nbsp;<span class="op" id="1509897">(</span><span class="op" id="1509898">*</span><span class="ident" id="1509899">bmap</span><span class="op" id="1509903">)</span><span class="op" id="1509904">(</span><span class="ident" id="1509905">add</span><span class="op" id="1509908">(</span><span class="ident" id="1509909">h</span><span class="op" id="1509910">.</span><span class="ident" id="1509911">buckets</span><span class="op" id="1509918">,</span>&nbsp;<span class="op" id="1509920">(</span><span class="ident" id="1509921">hash</span><span class="op" id="1509925">&amp;</span><span class="ident" id="1509926">m</span><span class="op" id="1509927">)</span><span class="op" id="1509928">*</span><span class="builtintype" id="1509929">uintptr</span><span class="op" id="1509936">(</span><span class="ident" id="1509937">t</span><span class="op" id="1509938">.</span><span class="ident" id="1509939">bucketsize</span><span class="op" id="1509949">)</span><span class="op" id="1509950">)</span><span class="op" id="1509951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1509955">if</span>&nbsp;<span class="ident" id="1509958">c</span>&nbsp;<span class="op" id="1509960">:=</span>&nbsp;<span class="ident" id="1509963">h</span><span class="op" id="1509964">.</span><span class="ident" id="1509965">oldbuckets</span><span class="op" id="1509975">;</span>&nbsp;<span class="ident" id="1509977">c</span>&nbsp;<span class="op" id="1509979">!=</span>&nbsp;<span class="ident" id="1509982">nil</span>&nbsp;<span class="op" id="1509986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1509991">oldb</span>&nbsp;<span class="op" id="1509996">:=</span>&nbsp;<span class="op" id="1509999">(</span><span class="op" id="1510000">*</span><span class="ident" id="1510001">bmap</span><span class="op" id="1510005">)</span><span class="op" id="1510006">(</span><span class="ident" id="1510007">add</span><span class="op" id="1510010">(</span><span class="ident" id="1510011">c</span><span class="op" id="1510012">,</span>&nbsp;<span class="op" id="1510014">(</span><span class="ident" id="1510015">hash</span><span class="op" id="1510019">&amp;</span><span class="op" id="1510020">(</span><span class="ident" id="1510021">m</span><span class="op" id="1510022">&gt;&gt;</span><span class="num" id="1510024">1</span><span class="op" id="1510025">)</span><span class="op" id="1510026">)</span><span class="op" id="1510027">*</span><span class="builtintype" id="1510028">uintptr</span><span class="op" id="1510035">(</span><span class="ident" id="1510036">t</span><span class="op" id="1510037">.</span><span class="ident" id="1510038">bucketsize</span><span class="op" id="1510048">)</span><span class="op" id="1510049">)</span><span class="op" id="1510050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1510055">if</span>&nbsp;<span class="op" id="1510058">!</span><span class="ident" id="1510059">evacuated</span><span class="op" id="1510068">(</span><span class="ident" id="1510069">oldb</span><span class="op" id="1510073">)</span>&nbsp;<span class="op" id="1510075">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1510081">b</span>&nbsp;<span class="op" id="1510083">=</span>&nbsp;<span class="ident" id="1510085">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1510093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1510097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1510100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1510103">for</span>&nbsp;<span class="op" id="1510107">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1510111">for</span>&nbsp;<span class="ident" id="1510115">i</span>&nbsp;<span class="op" id="1510117">:=</span>&nbsp;<span class="builtintype" id="1510120">uintptr</span><span class="op" id="1510127">(</span><span class="num" id="1510128">0</span><span class="op" id="1510129">)</span><span class="op" id="1510130">;</span>&nbsp;<span class="ident" id="1510132">i</span>&nbsp;<span class="op" id="1510134">&lt;</span>&nbsp;<span class="ident" id="1510136">bucketCnt</span><span class="op" id="1510145">;</span>&nbsp;<span class="ident" id="1510147">i</span><span class="op" id="1510148">++</span>&nbsp;<span class="op" id="1510151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1510156">k</span>&nbsp;<span class="op" id="1510158">:=</span>&nbsp;<span class="op" id="1510161">*</span><span class="op" id="1510162">(</span><span class="op" id="1510163">(</span><span class="op" id="1510164">*</span><span class="builtintype" id="1510165">uint32</span><span class="op" id="1510171">)</span><span class="op" id="1510172">(</span><span class="ident" id="1510173">add</span><span class="op" id="1510176">(</span><span class="ident" id="1510177">unsafe</span><span class="op" id="1510183">.</span><span class="ident" id="1510184">Pointer</span><span class="op" id="1510191">(</span><span class="ident" id="1510192">b</span><span class="op" id="1510193">)</span><span class="op" id="1510194">,</span>&nbsp;<span class="ident" id="1510196">dataOffset</span><span class="op" id="1510206">+</span><span class="ident" id="1510207">i</span><span class="op" id="1510208">*</span><span class="num" id="1510209">4</span><span class="op" id="1510210">)</span><span class="op" id="1510211">)</span><span class="op" id="1510212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1510217">if</span>&nbsp;<span class="ident" id="1510220">k</span>&nbsp;<span class="op" id="1510222">!=</span>&nbsp;<span class="ident" id="1510225">key</span>&nbsp;<span class="op" id="1510229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1510235">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1510247">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1510252">x</span>&nbsp;<span class="op" id="1510254">:=</span>&nbsp;<span class="op" id="1510257">*</span><span class="op" id="1510258">(</span><span class="op" id="1510259">(</span><span class="op" id="1510260">*</span><span class="builtintype" id="1510261">uint8</span><span class="op" id="1510266">)</span><span class="op" id="1510267">(</span><span class="ident" id="1510268">add</span><span class="op" id="1510271">(</span><span class="ident" id="1510272">unsafe</span><span class="op" id="1510278">.</span><span class="ident" id="1510279">Pointer</span><span class="op" id="1510286">(</span><span class="ident" id="1510287">b</span><span class="op" id="1510288">)</span><span class="op" id="1510289">,</span>&nbsp;<span class="ident" id="1510291">i</span><span class="op" id="1510292">)</span><span class="op" id="1510293">)</span><span class="op" id="1510294">)</span>&nbsp;<span class="comment" id="1510296">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1510340">if</span>&nbsp;<span class="ident" id="1510343">x</span>&nbsp;<span class="op" id="1510345">==</span>&nbsp;<span class="ident" id="1510348">empty</span>&nbsp;<span class="op" id="1510354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1510360">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1510372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1510377">return</span>&nbsp;<span class="ident" id="1510384">add</span><span class="op" id="1510387">(</span><span class="ident" id="1510388">unsafe</span><span class="op" id="1510394">.</span><span class="ident" id="1510395">Pointer</span><span class="op" id="1510402">(</span><span class="ident" id="1510403">b</span><span class="op" id="1510404">)</span><span class="op" id="1510405">,</span>&nbsp;<span class="ident" id="1510407">dataOffset</span><span class="op" id="1510417">+</span><span class="ident" id="1510418">bucketCnt</span><span class="op" id="1510427">*</span><span class="num" id="1510428">4</span><span class="op" id="1510429">+</span><span class="ident" id="1510430">i</span><span class="op" id="1510431">*</span><span class="builtintype" id="1510432">uintptr</span><span class="op" id="1510439">(</span><span class="ident" id="1510440">t</span><span class="op" id="1510441">.</span><span class="ident" id="1510442">valuesize</span><span class="op" id="1510451">)</span><span class="op" id="1510452">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1510456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1510460">b</span>&nbsp;<span class="op" id="1510462">=</span>&nbsp;<span class="ident" id="1510464">b</span><span class="op" id="1510465">.</span><span class="ident" id="1510466">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1510477">if</span>&nbsp;<span class="ident" id="1510480">b</span>&nbsp;<span class="op" id="1510482">==</span>&nbsp;<span class="ident" id="1510485">nil</span>&nbsp;<span class="op" id="1510489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1510494">return</span>&nbsp;<span class="ident" id="1510501">unsafe</span><span class="op" id="1510507">.</span><span class="ident" id="1510508">Pointer</span><span class="op" id="1510515">(</span><span class="ident" id="1510516">t</span><span class="op" id="1510517">.</span><span class="ident" id="1510518">elem</span><span class="op" id="1510522">.</span><span class="ident" id="1510523">zero</span><span class="op" id="1510527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1510531">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1510534">}</span><br>
<span class="lineno"></span><span class="op" id="1510536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1510539">func</span>&nbsp;<span class="ident" id="1510544">mapaccess2_fast32</span><span class="op" id="1510561">(</span><span class="ident" id="1510562">t</span>&nbsp;<span class="op" id="1510564">*</span><span class="ident" id="1510565">maptype</span><span class="op" id="1510572">,</span>&nbsp;<span class="ident" id="1510574">h</span>&nbsp;<span class="op" id="1510576">*</span><span class="ident" id="1510577">hmap</span><span class="op" id="1510581">,</span>&nbsp;<span class="ident" id="1510583">key</span>&nbsp;<span class="builtintype" id="1510587">uint32</span><span class="op" id="1510593">)</span>&nbsp;<span class="op" id="1510595">(</span><span class="ident" id="1510596">unsafe</span><span class="op" id="1510602">.</span><span class="ident" id="1510603">Pointer</span><span class="op" id="1510610">,</span>&nbsp;<span class="builtintype" id="1510612">bool</span><span class="op" id="1510616">)</span>&nbsp;<span class="op" id="1510618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1510621">if</span>&nbsp;<span class="ident" id="1510624">raceenabled</span>&nbsp;<span class="op" id="1510636">&amp;&amp;</span>&nbsp;<span class="ident" id="1510639">h</span>&nbsp;<span class="op" id="1510641">!=</span>&nbsp;<span class="ident" id="1510644">nil</span>&nbsp;<span class="op" id="1510648">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1510652">callerpc</span>&nbsp;<span class="op" id="1510661">:=</span>&nbsp;<span class="ident" id="1510664">getcallerpc</span><span class="op" id="1510675">(</span><span class="ident" id="1510676">unsafe</span><span class="op" id="1510682">.</span><span class="ident" id="1510683">Pointer</span><span class="op" id="1510690">(</span><span class="op" id="1510691">&amp;</span><span class="ident" id="1510692">t</span><span class="op" id="1510693">)</span><span class="op" id="1510694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1510698">racereadpc</span><span class="op" id="1510708">(</span><span class="ident" id="1510709">unsafe</span><span class="op" id="1510715">.</span><span class="ident" id="1510716">Pointer</span><span class="op" id="1510723">(</span><span class="ident" id="1510724">h</span><span class="op" id="1510725">)</span><span class="op" id="1510726">,</span>&nbsp;<span class="ident" id="1510728">callerpc</span><span class="op" id="1510736">,</span>&nbsp;<span class="ident" id="1510738">funcPC</span><span class="op" id="1510744">(</span><span class="ident" id="1510745">mapaccess2_fast32</span><span class="op" id="1510762">)</span><span class="op" id="1510763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1510766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1510769">if</span>&nbsp;<span class="ident" id="1510772">h</span>&nbsp;<span class="op" id="1510774">==</span>&nbsp;<span class="ident" id="1510777">nil</span>&nbsp;<span class="op" id="1510781">||</span>&nbsp;<span class="ident" id="1510784">h</span><span class="op" id="1510785">.</span><span class="ident" id="1510786">count</span>&nbsp;<span class="op" id="1510792">==</span>&nbsp;<span class="num" id="1510795">0</span>&nbsp;<span class="op" id="1510797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1510801">return</span>&nbsp;<span class="ident" id="1510808">unsafe</span><span class="op" id="1510814">.</span><span class="ident" id="1510815">Pointer</span><span class="op" id="1510822">(</span><span class="ident" id="1510823">t</span><span class="op" id="1510824">.</span><span class="ident" id="1510825">elem</span><span class="op" id="1510829">.</span><span class="ident" id="1510830">zero</span><span class="op" id="1510834">)</span><span class="op" id="1510835">,</span>&nbsp;<span class="builtintype" id="1510837">false</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1510844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1510847">var</span>&nbsp;<span class="ident" id="1510851">b</span>&nbsp;<span class="op" id="1510853">*</span><span class="ident" id="1510854">bmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1510860">if</span>&nbsp;<span class="ident" id="1510863">h</span><span class="op" id="1510864">.</span><span class="ident" id="1510865">B</span>&nbsp;<span class="op" id="1510867">==</span>&nbsp;<span class="num" id="1510870">0</span>&nbsp;<span class="op" id="1510872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1510876">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1510917">b</span>&nbsp;<span class="op" id="1510919">=</span>&nbsp;<span class="op" id="1510921">(</span><span class="op" id="1510922">*</span><span class="ident" id="1510923">bmap</span><span class="op" id="1510927">)</span><span class="op" id="1510928">(</span><span class="ident" id="1510929">h</span><span class="op" id="1510930">.</span><span class="ident" id="1510931">buckets</span><span class="op" id="1510938">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1510941">}</span>&nbsp;<span class="keyword" id="1510943">else</span>&nbsp;<span class="op" id="1510948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1510952">hash</span>&nbsp;<span class="op" id="1510957">:=</span>&nbsp;<span class="ident" id="1510960">goalg</span><span class="op" id="1510965">(</span><span class="ident" id="1510966">t</span><span class="op" id="1510967">.</span><span class="ident" id="1510968">key</span><span class="op" id="1510971">.</span><span class="ident" id="1510972">alg</span><span class="op" id="1510975">)</span><span class="op" id="1510976">.</span><span class="ident" id="1510977">hash</span><span class="op" id="1510981">(</span><span class="ident" id="1510982">noescape</span><span class="op" id="1510990">(</span><span class="ident" id="1510991">unsafe</span><span class="op" id="1510997">.</span><span class="ident" id="1510998">Pointer</span><span class="op" id="1511005">(</span><span class="op" id="1511006">&amp;</span><span class="ident" id="1511007">key</span><span class="op" id="1511010">)</span><span class="op" id="1511011">)</span><span class="op" id="1511012">,</span>&nbsp;<span class="num" id="1511014">4</span><span class="op" id="1511015">,</span>&nbsp;<span class="builtintype" id="1511017">uintptr</span><span class="op" id="1511024">(</span><span class="ident" id="1511025">h</span><span class="op" id="1511026">.</span><span class="ident" id="1511027">hash0</span><span class="op" id="1511032">)</span><span class="op" id="1511033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1511037">m</span>&nbsp;<span class="op" id="1511039">:=</span>&nbsp;<span class="builtintype" id="1511042">uintptr</span><span class="op" id="1511049">(</span><span class="num" id="1511050">1</span><span class="op" id="1511051">)</span><span class="op" id="1511052">&lt;&lt;</span><span class="ident" id="1511054">h</span><span class="op" id="1511055">.</span><span class="ident" id="1511056">B</span>&nbsp;<span class="op" id="1511058">-</span>&nbsp;<span class="num" id="1511060">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1511064">b</span>&nbsp;<span class="op" id="1511066">=</span>&nbsp;<span class="op" id="1511068">(</span><span class="op" id="1511069">*</span><span class="ident" id="1511070">bmap</span><span class="op" id="1511074">)</span><span class="op" id="1511075">(</span><span class="ident" id="1511076">add</span><span class="op" id="1511079">(</span><span class="ident" id="1511080">h</span><span class="op" id="1511081">.</span><span class="ident" id="1511082">buckets</span><span class="op" id="1511089">,</span>&nbsp;<span class="op" id="1511091">(</span><span class="ident" id="1511092">hash</span><span class="op" id="1511096">&amp;</span><span class="ident" id="1511097">m</span><span class="op" id="1511098">)</span><span class="op" id="1511099">*</span><span class="builtintype" id="1511100">uintptr</span><span class="op" id="1511107">(</span><span class="ident" id="1511108">t</span><span class="op" id="1511109">.</span><span class="ident" id="1511110">bucketsize</span><span class="op" id="1511120">)</span><span class="op" id="1511121">)</span><span class="op" id="1511122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1511126">if</span>&nbsp;<span class="ident" id="1511129">c</span>&nbsp;<span class="op" id="1511131">:=</span>&nbsp;<span class="ident" id="1511134">h</span><span class="op" id="1511135">.</span><span class="ident" id="1511136">oldbuckets</span><span class="op" id="1511146">;</span>&nbsp;<span class="ident" id="1511148">c</span>&nbsp;<span class="op" id="1511150">!=</span>&nbsp;<span class="ident" id="1511153">nil</span>&nbsp;<span class="op" id="1511157">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1511162">oldb</span>&nbsp;<span class="op" id="1511167">:=</span>&nbsp;<span class="op" id="1511170">(</span><span class="op" id="1511171">*</span><span class="ident" id="1511172">bmap</span><span class="op" id="1511176">)</span><span class="op" id="1511177">(</span><span class="ident" id="1511178">add</span><span class="op" id="1511181">(</span><span class="ident" id="1511182">c</span><span class="op" id="1511183">,</span>&nbsp;<span class="op" id="1511185">(</span><span class="ident" id="1511186">hash</span><span class="op" id="1511190">&amp;</span><span class="op" id="1511191">(</span><span class="ident" id="1511192">m</span><span class="op" id="1511193">&gt;&gt;</span><span class="num" id="1511195">1</span><span class="op" id="1511196">)</span><span class="op" id="1511197">)</span><span class="op" id="1511198">*</span><span class="builtintype" id="1511199">uintptr</span><span class="op" id="1511206">(</span><span class="ident" id="1511207">t</span><span class="op" id="1511208">.</span><span class="ident" id="1511209">bucketsize</span><span class="op" id="1511219">)</span><span class="op" id="1511220">)</span><span class="op" id="1511221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1511226">if</span>&nbsp;<span class="op" id="1511229">!</span><span class="ident" id="1511230">evacuated</span><span class="op" id="1511239">(</span><span class="ident" id="1511240">oldb</span><span class="op" id="1511244">)</span>&nbsp;<span class="op" id="1511246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1511252">b</span>&nbsp;<span class="op" id="1511254">=</span>&nbsp;<span class="ident" id="1511256">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1511264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1511268">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1511271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1511274">for</span>&nbsp;<span class="op" id="1511278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1511282">for</span>&nbsp;<span class="ident" id="1511286">i</span>&nbsp;<span class="op" id="1511288">:=</span>&nbsp;<span class="builtintype" id="1511291">uintptr</span><span class="op" id="1511298">(</span><span class="num" id="1511299">0</span><span class="op" id="1511300">)</span><span class="op" id="1511301">;</span>&nbsp;<span class="ident" id="1511303">i</span>&nbsp;<span class="op" id="1511305">&lt;</span>&nbsp;<span class="ident" id="1511307">bucketCnt</span><span class="op" id="1511316">;</span>&nbsp;<span class="ident" id="1511318">i</span><span class="op" id="1511319">++</span>&nbsp;<span class="op" id="1511322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1511327">k</span>&nbsp;<span class="op" id="1511329">:=</span>&nbsp;<span class="op" id="1511332">*</span><span class="op" id="1511333">(</span><span class="op" id="1511334">(</span><span class="op" id="1511335">*</span><span class="builtintype" id="1511336">uint32</span><span class="op" id="1511342">)</span><span class="op" id="1511343">(</span><span class="ident" id="1511344">add</span><span class="op" id="1511347">(</span><span class="ident" id="1511348">unsafe</span><span class="op" id="1511354">.</span><span class="ident" id="1511355">Pointer</span><span class="op" id="1511362">(</span><span class="ident" id="1511363">b</span><span class="op" id="1511364">)</span><span class="op" id="1511365">,</span>&nbsp;<span class="ident" id="1511367">dataOffset</span><span class="op" id="1511377">+</span><span class="ident" id="1511378">i</span><span class="op" id="1511379">*</span><span class="num" id="1511380">4</span><span class="op" id="1511381">)</span><span class="op" id="1511382">)</span><span class="op" id="1511383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1511388">if</span>&nbsp;<span class="ident" id="1511391">k</span>&nbsp;<span class="op" id="1511393">!=</span>&nbsp;<span class="ident" id="1511396">key</span>&nbsp;<span class="op" id="1511400">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1511406">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1511418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1511423">x</span>&nbsp;<span class="op" id="1511425">:=</span>&nbsp;<span class="op" id="1511428">*</span><span class="op" id="1511429">(</span><span class="op" id="1511430">(</span><span class="op" id="1511431">*</span><span class="builtintype" id="1511432">uint8</span><span class="op" id="1511437">)</span><span class="op" id="1511438">(</span><span class="ident" id="1511439">add</span><span class="op" id="1511442">(</span><span class="ident" id="1511443">unsafe</span><span class="op" id="1511449">.</span><span class="ident" id="1511450">Pointer</span><span class="op" id="1511457">(</span><span class="ident" id="1511458">b</span><span class="op" id="1511459">)</span><span class="op" id="1511460">,</span>&nbsp;<span class="ident" id="1511462">i</span><span class="op" id="1511463">)</span><span class="op" id="1511464">)</span><span class="op" id="1511465">)</span>&nbsp;<span class="comment" id="1511467">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1511511">if</span>&nbsp;<span class="ident" id="1511514">x</span>&nbsp;<span class="op" id="1511516">==</span>&nbsp;<span class="ident" id="1511519">empty</span>&nbsp;<span class="op" id="1511525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1511531">continue</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1511543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1511548">return</span>&nbsp;<span class="ident" id="1511555">add</span><span class="op" id="1511558">(</span><span class="ident" id="1511559">unsafe</span><span class="op" id="1511565">.</span><span class="ident" id="1511566">Pointer</span><span class="op" id="1511573">(</span><span class="ident" id="1511574">b</span><span class="op" id="1511575">)</span><span class="op" id="1511576">,</span>&nbsp;<span class="ident" id="1511578">dataOffset</span><span class="op" id="1511588">+</span><span class="ident" id="1511589">bucketCnt</span><span class="op" id="1511598">*</span><span class="num" id="1511599">4</span><span class="op" id="1511600">+</span><span class="ident" id="1511601">i</span><span class="op" id="1511602">*</span><span class="builtintype" id="1511603">uintptr</span><span class="op" id="1511610">(</span><span class="ident" id="1511611">t</span><span class="op" id="1511612">.</span><span class="ident" id="1511613">valuesize</span><span class="op" id="1511622">)</span><span class="op" id="1511623">)</span><span class="op" id="1511624">,</span>&nbsp;<span class="builtintype" id="1511626">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1511633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1511637">b</span>&nbsp;<span class="op" id="1511639">=</span>&nbsp;<span class="ident" id="1511641">b</span><span class="op" id="1511642">.</span><span class="ident" id="1511643">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1511654">if</span>&nbsp;<span class="ident" id="1511657">b</span>&nbsp;<span class="op" id="1511659">==</span>&nbsp;<span class="ident" id="1511662">nil</span>&nbsp;<span class="op" id="1511666">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1511671">return</span>&nbsp;<span class="ident" id="1511678">unsafe</span><span class="op" id="1511684">.</span><span class="ident" id="1511685">Pointer</span><span class="op" id="1511692">(</span><span class="ident" id="1511693">t</span><span class="op" id="1511694">.</span><span class="ident" id="1511695">elem</span><span class="op" id="1511699">.</span><span class="ident" id="1511700">zero</span><span class="op" id="1511704">)</span><span class="op" id="1511705">,</span>&nbsp;<span class="builtintype" id="1511707">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1511715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1511718">}</span><br>
<span class="lineno"></span><span class="op" id="1511720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="1511723">func</span>&nbsp;<span class="ident" id="1511728">mapaccess1_fast64</span><span class="op" id="1511745">(</span><span class="ident" id="1511746">t</span>&nbsp;<span class="op" id="1511748">*</span><span class="ident" id="1511749">maptype</span><span class="op" id="1511756">,</span>&nbsp;<span class="ident" id="1511758">h</span>&nbsp;<span class="op" id="1511760">*</span><span class="ident" id="1511761">hmap</span><span class="op" id="1511765">,</span>&nbsp;<span class="ident" id="1511767">key</span>&nbsp;<span class="ident" id="1511771">uint64</span><span class="op" id="1511777">)</span>&nbsp;<span class="ident" id="1511779">unsafe</span><span class="op" id="1511785">.</span><span class="ident" id="1511786">Pointer</span>&nbsp;<span class="op" id="1511794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1511797">if</span>&nbsp;<span class="ident" id="1511800">raceenabled</span>&nbsp;<span class="op" id="1511812">&amp;&amp;</span>&nbsp;<span class="ident" id="1511815">h</span>&nbsp;<span class="op" id="1511817">!=</span>&nbsp;<span class="ident" id="1511820">nil</span>&nbsp;<span class="op" id="1511824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1511828">callerpc</span>&nbsp;<span class="op" id="1511837">:=</span>&nbsp;<span class="ident" id="1511840">getcallerpc</span><span class="op" id="1511851">(</span><span class="ident" id="1511852">unsafe</span><span class="op" id="1511858">.</span><span class="ident" id="1511859">Pointer</span><span class="op" id="1511866">(</span><span class="op" id="1511867">&amp;</span><span class="ident" id="1511868">t</span><span class="op" id="1511869">)</span><span class="op" id="1511870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1511874">racereadpc</span><span class="op" id="1511884">(</span><span class="ident" id="1511885">unsafe</span><span class="op" id="1511891">.</span><span class="ident" id="1511892">Pointer</span><span class="op" id="1511899">(</span><span class="ident" id="1511900">h</span><span class="op" id="1511901">)</span><span class="op" id="1511902">,</span>&nbsp;<span class="ident" id="1511904">callerpc</span><span class="op" id="1511912">,</span>&nbsp;<span class="ident" id="1511914">funcPC</span><span class="op" id="1511920">(</span><span class="ident" id="1511921">mapaccess1_fast64</span><span class="op" id="1511938">)</span><span class="op" id="1511939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1511942">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1511945">if</span>&nbsp;<span class="ident" id="1511948">h</span>&nbsp;<span class="op" id="1511950">==</span>&nbsp;<span class="ident" id="1511953">nil</span>&nbsp;<span class="op" id="1511957">||</span>&nbsp;<span class="ident" id="1511960">h</span><span class="op" id="1511961">.</span><span class="ident" id="1511962">count</span>&nbsp;<span class="op" id="1511968">==</span>&nbsp;<span class="num" id="1511971">0</span>&nbsp;<span class="op" id="1511973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1511977">return</span>&nbsp;<span class="ident" id="1511984">unsafe</span><span class="op" id="1511990">.</span><span class="ident" id="1511991">Pointer</span><span class="op" id="1511998">(</span><span class="ident" id="1511999">t</span><span class="op" id="1512000">.</span><span class="ident" id="1512001">elem</span><span class="op" id="1512005">.</span><span class="ident" id="1512006">zero</span><span class="op" id="1512010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1512013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1512016">var</span>&nbsp;<span class="ident" id="1512020">b</span>&nbsp;<span class="op" id="1512022">*</span><span class="ident" id="1512023">bmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1512029">if</span>&nbsp;<span class="ident" id="1512032">h</span><span class="op" id="1512033">.</span><span class="ident" id="1512034">B</span>&nbsp;<span class="op" id="1512036">==</span>&nbsp;<span class="num" id="1512039">0</span>&nbsp;<span class="op" id="1512041">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1512045">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1512086">b</span>&nbsp;<span class="op" id="1512088">=</span>&nbsp;<span class="op" id="1512090">(</span><span class="op" id="1512091">*</span><span class="ident" id="1512092">bmap</span><span class="op" id="1512096">)</span><span class="op" id="1512097">(</span><span class="ident" id="1512098">h</span><span class="op" id="1512099">.</span><span class="ident" id="1512100">buckets</span><span class="op" id="1512107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1512110">}</span>&nbsp;<span class="keyword" id="1512112">else</span>&nbsp;<span class="op" id="1512117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1512121">hash</span>&nbsp;<span class="op" id="1512126">:=</span>&nbsp;<span class="ident" id="1512129">goalg</span><span class="op" id="1512134">(</span><span class="ident" id="1512135">t</span><span class="op" id="1512136">.</span><span class="ident" id="1512137">key</span><span class="op" id="1512140">.</span><span class="ident" id="1512141">alg</span><span class="op" id="1512144">)</span><span class="op" id="1512145">.</span><span class="ident" id="1512146">hash</span><span class="op" id="1512150">(</span><span class="ident" id="1512151">noescape</span><span class="op" id="1512159">(</span><span class="ident" id="1512160">unsafe</span><span class="op" id="1512166">.</span><span class="ident" id="1512167">Pointer</span><span class="op" id="1512174">(</span><span class="op" id="1512175">&amp;</span><span class="ident" id="1512176">key</span><span class="op" id="1512179">)</span><span class="op" id="1512180">)</span><span class="op" id="1512181">,</span>&nbsp;<span class="num" id="1512183">8</span><span class="op" id="1512184">,</span>&nbsp;<span class="builtintype" id="1512186">uintptr</span><span class="op" id="1512193">(</span><span class="ident" id="1512194">h</span><span class="op" id="1512195">.</span><span class="ident" id="1512196">hash0</span><span class="op" id="1512201">)</span><span class="op" id="1512202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1512206">m</span>&nbsp;<span class="op" id="1512208">:=</span>&nbsp;<span class="builtintype" id="1512211">uintptr</span><span class="op" id="1512218">(</span><span class="num" id="1512219">1</span><span class="op" id="1512220">)</span><span class="op" id="1512221">&lt;&lt;</span><span class="ident" id="1512223">h</span><span class="op" id="1512224">.</span><span class="ident" id="1512225">B</span>&nbsp;<span class="op" id="1512227">-</span>&nbsp;<span class="num" id="1512229">1</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1512233">b</span>&nbsp;<span class="op" id="1512235">=</span>&nbsp;<span class="op" id="1512237">(</span><span class="op" id="1512238">*</span><span class="ident" id="1512239">bmap</span><span class="op" id="1512243">)</span><span class="op" id="1512244">(</span><span class="ident" id="1512245">add</span><span class="op" id="1512248">(</span><span class="ident" id="1512249">h</span><span class="op" id="1512250">.</span><span class="ident" id="1512251">buckets</span><span class="op" id="1512258">,</span>&nbsp;<span class="op" id="1512260">(</span><span class="ident" id="1512261">hash</span><span class="op" id="1512265">&amp;</span><span class="ident" id="1512266">m</span><span class="op" id="1512267">)</span><span class="op" id="1512268">*</span><span class="builtintype" id="1512269">uintptr</span><span class="op" id="1512276">(</span><span class="ident" id="1512277">t</span><span class="op" id="1512278">.</span><span class="ident" id="1512279">bucketsize</span><span class="op" id="1512289">)</span><span class="op" id="1512290">)</span><span class="op" id="1512291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1512295">if</span>&nbsp;<span class="ident" id="1512298">c</span>&nbsp;<span class="op" id="1512300">:=</span>&nbsp;<span class="ident" id="1512303">h</span><span class="op" id="1512304">.</span><span class="ident" id="1512305">oldbuckets</span><span class="op" id="1512315">;</span>&nbsp;<span class="ident" id="1512317">c</span>&nbsp;<span class="op" id="1512319">!=</span>&nbsp;<span class="ident" id="1512322">nil</span>&nbsp;<span class="op" id="1512326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1512331">oldb</span>&nbsp;<span class="op" id="1512336">:=</span>&nbsp;<span class="op" id="1512339">(</span><span class="op" id="1512340">*</span><span class="ident" id="1512341">bmap</span><span class="op" id="1512345">)</span><span class="op" id="1512346">(</span><span class="ident" id="1512347">add</span><span class="op" id="1512350">(</span><span class="ident" id="1512351">c</span><span class="op" id="1512352">,</span>&nbsp;<span class="op" id="1512354">(</span><span class="ident" id="1512355">hash</span><span class="op" id="1512359">&amp;</span><span class="op" id="1512360">(</span><span class="ident" id="1512361">m</span><span class="op" id="1512362">&gt;&gt;</span><span class="num" id="1512364">1</span><span class="op" id="1512365">)</span><span class="op" id="1512366">)</span><span class="op" id="1512367">*</span><span class="builtintype" id="1512368">uintptr</span><span class="op" id="1512375">(</span><span class="ident" id="1512376">t</span><span class="op" id="1512377">.</span><span class="ident" id="1512378">bucketsize</span><span class="op" id="1512388">)</span><span class="op" id="1512389">)</span><span class="op" id="1512390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1512395">if</span>&nbsp;<span class="op" id="1512398">!</span><span class="ident" id="1512399">evacuated</span><span class="op" id="1512408">(</span><span class="ident" id="1512409">oldb</span><span class="op" id="1512413">)</span>&nbsp;<span class="op" id="1512415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1512421">b</span>&nbsp;<span class="op" id="1512423">=</span>&nbsp;<span class="ident" id="1512425">oldb</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1512433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1512437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1512440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1512443">for</span>&nbsp;<span class="op" id="1512447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1512451">for</span>&nbsp;<span class="ident" id="1512455">i</span>&nbsp;<span class="op" id="1512457">:=</span>&nbsp;<span class="builtintype" id="1512460">uintptr</span><span class="op" id="1512467">(</span><span class="num" id="1512468">0</span><span class="op" id="1512469">)</span><span class="op" id="1512470">;</span>&nbsp;<span class="ident" id="1512472">i</span>&nbsp;<span class="op" id="1512474">&lt;</span>&nbsp;<span class="ident" id="1512476">bucketCnt</span><span class="op" id="1512485">;</span>&nbsp;<span class="ident" id="1512487">i</span><span class="op" id="1512488">++</span>&nbsp;<span class="op" id="1512491">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1512496">k</span>&nbsp;<span class="op" id="1512498">:=</span>&nbsp;<span class="op" id="1512501">*</span><span class="op" id="1512502">(</span><span class="op" id="1512503">(</span><span class="op" id="1512504">*</span><span class="ident" id="1512505">uint64</span><span class="op" id="1512511">)</span><span class="op" id="1512512">(</span><span class="ident" id="1512513">add</span><span class="op" id="1512516">(</span><span class="ident" id="1512517">unsafe</span><span class="op" id="1512523">.</span><span class="ident" id="1512524">Pointer</span><span class="op" id="1512531">(</span><span class="ident" id="1512532">b</span><span class="op" id="1512533">)</span><span class="op" id="1512534">,</span>&nbsp;<span class="ident" id="1512536">dataOffset</span><span class="op" id="1512546">+</span><span class="ident" id="1512547">i</span><span class="op" id="1512548">*</span><span class="num" id="1512549">8</span><span class="op" id="1512550">)</span><span class="op" id="1512551">)</span><span class="op" id="1512552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1512557">if</span>&nbsp;<span class="ident" id="1512560">k</span>&nbsp;<span class="op" id="1512562">!=</span>&nbsp;<span class="ident" id="1512565">key</span>&nbsp;<span class="op" id="1512569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1512575">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1512587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1512592">x</span>&nbsp;<span class="op" id="1512594">:=</span>&nbsp;<span class="op" id="1512597">*</span><span class="op" id="1512598">(</span><span class="op" id="1512599">(</span><span class="op" id="1512600">*</span><span class="builtintype" id="1512601">uint8</span><span class="op" id="1512606">)</span><span class="op" id="1512607">(</span><span class="ident" id="1512608">add</span><span class="op" id="1512611">(</span><span class="ident" id="1512612">unsafe</span><span class="op" id="1512618">.</span><span class="ident" id="1512619">Pointer</span><span class="op" id="1512626">(</span><span class="ident" id="1512627">b</span><span class="op" id="1512628">)</span><span class="op" id="1512629">,</span>&nbsp;<span class="ident" id="1512631">i</span><span class="op" id="1512632">)</span><span class="op" id="1512633">)</span><span class="op" id="1512634">)</span>&nbsp;<span class="comment" id="1512636">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1512680">if</span>&nbsp;<span class="ident" id="1512683">x</span>&nbsp;<span class="op" id="1512685">==</span>&nbsp;<span class="ident" id="1512688">empty</span>&nbsp;<span class="op" id="1512694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1512700">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1512712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1512717">return</span>&nbsp;<span class="ident" id="1512724">add</span><span class="op" id="1512727">(</span><span class="ident" id="1512728">unsafe</span><span class="op" id="1512734">.</span><span class="ident" id="1512735">Pointer</span><span class="op" id="1512742">(</span><span class="ident" id="1512743">b</span><span class="op" id="1512744">)</span><span class="op" id="1512745">,</span>&nbsp;<span class="ident" id="1512747">dataOffset</span><span class="op" id="1512757">+</span><span class="ident" id="1512758">bucketCnt</span><span class="op" id="1512767">*</span><span class="num" id="1512768">8</span><span class="op" id="1512769">+</span><span class="ident" id="1512770">i</span><span class="op" id="1512771">*</span><span class="builtintype" id="1512772">uintptr</span><span class="op" id="1512779">(</span><span class="ident" id="1512780">t</span><span class="op" id="1512781">.</span><span class="ident" id="1512782">valuesize</span><span class="op" id="1512791">)</span><span class="op" id="1512792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1512796">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1512800">b</span>&nbsp;<span class="op" id="1512802">=</span>&nbsp;<span class="ident" id="1512804">b</span><span class="op" id="1512805">.</span><span class="ident" id="1512806">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1512817">if</span>&nbsp;<span class="ident" id="1512820">b</span>&nbsp;<span class="op" id="1512822">==</span>&nbsp;<span class="ident" id="1512825">nil</span>&nbsp;<span class="op" id="1512829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1512834">return</span>&nbsp;<span class="ident" id="1512841">unsafe</span><span class="op" id="1512847">.</span><span class="ident" id="1512848">Pointer</span><span class="op" id="1512855">(</span><span class="ident" id="1512856">t</span><span class="op" id="1512857">.</span><span class="ident" id="1512858">elem</span><span class="op" id="1512862">.</span><span class="ident" id="1512863">zero</span><span class="op" id="1512867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1512871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1512874">}</span><br>
<span class="lineno">135</span><span class="op" id="1512876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1512879">func</span>&nbsp;<span class="ident" id="1512884">mapaccess2_fast64</span><span class="op" id="1512901">(</span><span class="ident" id="1512902">t</span>&nbsp;<span class="op" id="1512904">*</span><span class="ident" id="1512905">maptype</span><span class="op" id="1512912">,</span>&nbsp;<span class="ident" id="1512914">h</span>&nbsp;<span class="op" id="1512916">*</span><span class="ident" id="1512917">hmap</span><span class="op" id="1512921">,</span>&nbsp;<span class="ident" id="1512923">key</span>&nbsp;<span class="ident" id="1512927">uint64</span><span class="op" id="1512933">)</span>&nbsp;<span class="op" id="1512935">(</span><span class="ident" id="1512936">unsafe</span><span class="op" id="1512942">.</span><span class="ident" id="1512943">Pointer</span><span class="op" id="1512950">,</span>&nbsp;<span class="builtintype" id="1512952">bool</span><span class="op" id="1512956">)</span>&nbsp;<span class="op" id="1512958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1512961">if</span>&nbsp;<span class="ident" id="1512964">raceenabled</span>&nbsp;<span class="op" id="1512976">&amp;&amp;</span>&nbsp;<span class="ident" id="1512979">h</span>&nbsp;<span class="op" id="1512981">!=</span>&nbsp;<span class="ident" id="1512984">nil</span>&nbsp;<span class="op" id="1512988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1512992">callerpc</span>&nbsp;<span class="op" id="1513001">:=</span>&nbsp;<span class="ident" id="1513004">getcallerpc</span><span class="op" id="1513015">(</span><span class="ident" id="1513016">unsafe</span><span class="op" id="1513022">.</span><span class="ident" id="1513023">Pointer</span><span class="op" id="1513030">(</span><span class="op" id="1513031">&amp;</span><span class="ident" id="1513032">t</span><span class="op" id="1513033">)</span><span class="op" id="1513034">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1513038">racereadpc</span><span class="op" id="1513048">(</span><span class="ident" id="1513049">unsafe</span><span class="op" id="1513055">.</span><span class="ident" id="1513056">Pointer</span><span class="op" id="1513063">(</span><span class="ident" id="1513064">h</span><span class="op" id="1513065">)</span><span class="op" id="1513066">,</span>&nbsp;<span class="ident" id="1513068">callerpc</span><span class="op" id="1513076">,</span>&nbsp;<span class="ident" id="1513078">funcPC</span><span class="op" id="1513084">(</span><span class="ident" id="1513085">mapaccess2_fast64</span><span class="op" id="1513102">)</span><span class="op" id="1513103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1513106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1513109">if</span>&nbsp;<span class="ident" id="1513112">h</span>&nbsp;<span class="op" id="1513114">==</span>&nbsp;<span class="ident" id="1513117">nil</span>&nbsp;<span class="op" id="1513121">||</span>&nbsp;<span class="ident" id="1513124">h</span><span class="op" id="1513125">.</span><span class="ident" id="1513126">count</span>&nbsp;<span class="op" id="1513132">==</span>&nbsp;<span class="num" id="1513135">0</span>&nbsp;<span class="op" id="1513137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1513141">return</span>&nbsp;<span class="ident" id="1513148">unsafe</span><span class="op" id="1513154">.</span><span class="ident" id="1513155">Pointer</span><span class="op" id="1513162">(</span><span class="ident" id="1513163">t</span><span class="op" id="1513164">.</span><span class="ident" id="1513165">elem</span><span class="op" id="1513169">.</span><span class="ident" id="1513170">zero</span><span class="op" id="1513174">)</span><span class="op" id="1513175">,</span>&nbsp;<span class="builtintype" id="1513177">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1513184">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1513187">var</span>&nbsp;<span class="ident" id="1513191">b</span>&nbsp;<span class="op" id="1513193">*</span><span class="ident" id="1513194">bmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1513200">if</span>&nbsp;<span class="ident" id="1513203">h</span><span class="op" id="1513204">.</span><span class="ident" id="1513205">B</span>&nbsp;<span class="op" id="1513207">==</span>&nbsp;<span class="num" id="1513210">0</span>&nbsp;<span class="op" id="1513212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1513216">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1513257">b</span>&nbsp;<span class="op" id="1513259">=</span>&nbsp;<span class="op" id="1513261">(</span><span class="op" id="1513262">*</span><span class="ident" id="1513263">bmap</span><span class="op" id="1513267">)</span><span class="op" id="1513268">(</span><span class="ident" id="1513269">h</span><span class="op" id="1513270">.</span><span class="ident" id="1513271">buckets</span><span class="op" id="1513278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1513281">}</span>&nbsp;<span class="keyword" id="1513283">else</span>&nbsp;<span class="op" id="1513288">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1513292">hash</span>&nbsp;<span class="op" id="1513297">:=</span>&nbsp;<span class="ident" id="1513300">goalg</span><span class="op" id="1513305">(</span><span class="ident" id="1513306">t</span><span class="op" id="1513307">.</span><span class="ident" id="1513308">key</span><span class="op" id="1513311">.</span><span class="ident" id="1513312">alg</span><span class="op" id="1513315">)</span><span class="op" id="1513316">.</span><span class="ident" id="1513317">hash</span><span class="op" id="1513321">(</span><span class="ident" id="1513322">noescape</span><span class="op" id="1513330">(</span><span class="ident" id="1513331">unsafe</span><span class="op" id="1513337">.</span><span class="ident" id="1513338">Pointer</span><span class="op" id="1513345">(</span><span class="op" id="1513346">&amp;</span><span class="ident" id="1513347">key</span><span class="op" id="1513350">)</span><span class="op" id="1513351">)</span><span class="op" id="1513352">,</span>&nbsp;<span class="num" id="1513354">8</span><span class="op" id="1513355">,</span>&nbsp;<span class="builtintype" id="1513357">uintptr</span><span class="op" id="1513364">(</span><span class="ident" id="1513365">h</span><span class="op" id="1513366">.</span><span class="ident" id="1513367">hash0</span><span class="op" id="1513372">)</span><span class="op" id="1513373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1513377">m</span>&nbsp;<span class="op" id="1513379">:=</span>&nbsp;<span class="builtintype" id="1513382">uintptr</span><span class="op" id="1513389">(</span><span class="num" id="1513390">1</span><span class="op" id="1513391">)</span><span class="op" id="1513392">&lt;&lt;</span><span class="ident" id="1513394">h</span><span class="op" id="1513395">.</span><span class="ident" id="1513396">B</span>&nbsp;<span class="op" id="1513398">-</span>&nbsp;<span class="num" id="1513400">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1513404">b</span>&nbsp;<span class="op" id="1513406">=</span>&nbsp;<span class="op" id="1513408">(</span><span class="op" id="1513409">*</span><span class="ident" id="1513410">bmap</span><span class="op" id="1513414">)</span><span class="op" id="1513415">(</span><span class="ident" id="1513416">add</span><span class="op" id="1513419">(</span><span class="ident" id="1513420">h</span><span class="op" id="1513421">.</span><span class="ident" id="1513422">buckets</span><span class="op" id="1513429">,</span>&nbsp;<span class="op" id="1513431">(</span><span class="ident" id="1513432">hash</span><span class="op" id="1513436">&amp;</span><span class="ident" id="1513437">m</span><span class="op" id="1513438">)</span><span class="op" id="1513439">*</span><span class="builtintype" id="1513440">uintptr</span><span class="op" id="1513447">(</span><span class="ident" id="1513448">t</span><span class="op" id="1513449">.</span><span class="ident" id="1513450">bucketsize</span><span class="op" id="1513460">)</span><span class="op" id="1513461">)</span><span class="op" id="1513462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1513466">if</span>&nbsp;<span class="ident" id="1513469">c</span>&nbsp;<span class="op" id="1513471">:=</span>&nbsp;<span class="ident" id="1513474">h</span><span class="op" id="1513475">.</span><span class="ident" id="1513476">oldbuckets</span><span class="op" id="1513486">;</span>&nbsp;<span class="ident" id="1513488">c</span>&nbsp;<span class="op" id="1513490">!=</span>&nbsp;<span class="ident" id="1513493">nil</span>&nbsp;<span class="op" id="1513497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1513502">oldb</span>&nbsp;<span class="op" id="1513507">:=</span>&nbsp;<span class="op" id="1513510">(</span><span class="op" id="1513511">*</span><span class="ident" id="1513512">bmap</span><span class="op" id="1513516">)</span><span class="op" id="1513517">(</span><span class="ident" id="1513518">add</span><span class="op" id="1513521">(</span><span class="ident" id="1513522">c</span><span class="op" id="1513523">,</span>&nbsp;<span class="op" id="1513525">(</span><span class="ident" id="1513526">hash</span><span class="op" id="1513530">&amp;</span><span class="op" id="1513531">(</span><span class="ident" id="1513532">m</span><span class="op" id="1513533">&gt;&gt;</span><span class="num" id="1513535">1</span><span class="op" id="1513536">)</span><span class="op" id="1513537">)</span><span class="op" id="1513538">*</span><span class="builtintype" id="1513539">uintptr</span><span class="op" id="1513546">(</span><span class="ident" id="1513547">t</span><span class="op" id="1513548">.</span><span class="ident" id="1513549">bucketsize</span><span class="op" id="1513559">)</span><span class="op" id="1513560">)</span><span class="op" id="1513561">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1513566">if</span>&nbsp;<span class="op" id="1513569">!</span><span class="ident" id="1513570">evacuated</span><span class="op" id="1513579">(</span><span class="ident" id="1513580">oldb</span><span class="op" id="1513584">)</span>&nbsp;<span class="op" id="1513586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1513592">b</span>&nbsp;<span class="op" id="1513594">=</span>&nbsp;<span class="ident" id="1513596">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1513604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1513608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1513611">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1513614">for</span>&nbsp;<span class="op" id="1513618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1513622">for</span>&nbsp;<span class="ident" id="1513626">i</span>&nbsp;<span class="op" id="1513628">:=</span>&nbsp;<span class="builtintype" id="1513631">uintptr</span><span class="op" id="1513638">(</span><span class="num" id="1513639">0</span><span class="op" id="1513640">)</span><span class="op" id="1513641">;</span>&nbsp;<span class="ident" id="1513643">i</span>&nbsp;<span class="op" id="1513645">&lt;</span>&nbsp;<span class="ident" id="1513647">bucketCnt</span><span class="op" id="1513656">;</span>&nbsp;<span class="ident" id="1513658">i</span><span class="op" id="1513659">++</span>&nbsp;<span class="op" id="1513662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1513667">k</span>&nbsp;<span class="op" id="1513669">:=</span>&nbsp;<span class="op" id="1513672">*</span><span class="op" id="1513673">(</span><span class="op" id="1513674">(</span><span class="op" id="1513675">*</span><span class="ident" id="1513676">uint64</span><span class="op" id="1513682">)</span><span class="op" id="1513683">(</span><span class="ident" id="1513684">add</span><span class="op" id="1513687">(</span><span class="ident" id="1513688">unsafe</span><span class="op" id="1513694">.</span><span class="ident" id="1513695">Pointer</span><span class="op" id="1513702">(</span><span class="ident" id="1513703">b</span><span class="op" id="1513704">)</span><span class="op" id="1513705">,</span>&nbsp;<span class="ident" id="1513707">dataOffset</span><span class="op" id="1513717">+</span><span class="ident" id="1513718">i</span><span class="op" id="1513719">*</span><span class="num" id="1513720">8</span><span class="op" id="1513721">)</span><span class="op" id="1513722">)</span><span class="op" id="1513723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1513728">if</span>&nbsp;<span class="ident" id="1513731">k</span>&nbsp;<span class="op" id="1513733">!=</span>&nbsp;<span class="ident" id="1513736">key</span>&nbsp;<span class="op" id="1513740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1513746">continue</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1513758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1513763">x</span>&nbsp;<span class="op" id="1513765">:=</span>&nbsp;<span class="op" id="1513768">*</span><span class="op" id="1513769">(</span><span class="op" id="1513770">(</span><span class="op" id="1513771">*</span><span class="builtintype" id="1513772">uint8</span><span class="op" id="1513777">)</span><span class="op" id="1513778">(</span><span class="ident" id="1513779">add</span><span class="op" id="1513782">(</span><span class="ident" id="1513783">unsafe</span><span class="op" id="1513789">.</span><span class="ident" id="1513790">Pointer</span><span class="op" id="1513797">(</span><span class="ident" id="1513798">b</span><span class="op" id="1513799">)</span><span class="op" id="1513800">,</span>&nbsp;<span class="ident" id="1513802">i</span><span class="op" id="1513803">)</span><span class="op" id="1513804">)</span><span class="op" id="1513805">)</span>&nbsp;<span class="comment" id="1513807">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1513851">if</span>&nbsp;<span class="ident" id="1513854">x</span>&nbsp;<span class="op" id="1513856">==</span>&nbsp;<span class="ident" id="1513859">empty</span>&nbsp;<span class="op" id="1513865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1513871">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1513883">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1513888">return</span>&nbsp;<span class="ident" id="1513895">add</span><span class="op" id="1513898">(</span><span class="ident" id="1513899">unsafe</span><span class="op" id="1513905">.</span><span class="ident" id="1513906">Pointer</span><span class="op" id="1513913">(</span><span class="ident" id="1513914">b</span><span class="op" id="1513915">)</span><span class="op" id="1513916">,</span>&nbsp;<span class="ident" id="1513918">dataOffset</span><span class="op" id="1513928">+</span><span class="ident" id="1513929">bucketCnt</span><span class="op" id="1513938">*</span><span class="num" id="1513939">8</span><span class="op" id="1513940">+</span><span class="ident" id="1513941">i</span><span class="op" id="1513942">*</span><span class="builtintype" id="1513943">uintptr</span><span class="op" id="1513950">(</span><span class="ident" id="1513951">t</span><span class="op" id="1513952">.</span><span class="ident" id="1513953">valuesize</span><span class="op" id="1513962">)</span><span class="op" id="1513963">)</span><span class="op" id="1513964">,</span>&nbsp;<span class="builtintype" id="1513966">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1513973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1513977">b</span>&nbsp;<span class="op" id="1513979">=</span>&nbsp;<span class="ident" id="1513981">b</span><span class="op" id="1513982">.</span><span class="ident" id="1513983">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1513994">if</span>&nbsp;<span class="ident" id="1513997">b</span>&nbsp;<span class="op" id="1513999">==</span>&nbsp;<span class="ident" id="1514002">nil</span>&nbsp;<span class="op" id="1514006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1514011">return</span>&nbsp;<span class="ident" id="1514018">unsafe</span><span class="op" id="1514024">.</span><span class="ident" id="1514025">Pointer</span><span class="op" id="1514032">(</span><span class="ident" id="1514033">t</span><span class="op" id="1514034">.</span><span class="ident" id="1514035">elem</span><span class="op" id="1514039">.</span><span class="ident" id="1514040">zero</span><span class="op" id="1514044">)</span><span class="op" id="1514045">,</span>&nbsp;<span class="builtintype" id="1514047">false</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1514055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1514058">}</span><br>
<span class="lineno"></span><span class="op" id="1514060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1514063">func</span>&nbsp;<span class="ident" id="1514068">mapaccess1_faststr</span><span class="op" id="1514086">(</span><span class="ident" id="1514087">t</span>&nbsp;<span class="op" id="1514089">*</span><span class="ident" id="1514090">maptype</span><span class="op" id="1514097">,</span>&nbsp;<span class="ident" id="1514099">h</span>&nbsp;<span class="op" id="1514101">*</span><span class="ident" id="1514102">hmap</span><span class="op" id="1514106">,</span>&nbsp;<span class="ident" id="1514108">ky</span>&nbsp;<span class="builtintype" id="1514111">string</span><span class="op" id="1514117">)</span>&nbsp;<span class="ident" id="1514119">unsafe</span><span class="op" id="1514125">.</span><span class="ident" id="1514126">Pointer</span>&nbsp;<span class="op" id="1514134">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1514137">if</span>&nbsp;<span class="ident" id="1514140">raceenabled</span>&nbsp;<span class="op" id="1514152">&amp;&amp;</span>&nbsp;<span class="ident" id="1514155">h</span>&nbsp;<span class="op" id="1514157">!=</span>&nbsp;<span class="ident" id="1514160">nil</span>&nbsp;<span class="op" id="1514164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1514168">callerpc</span>&nbsp;<span class="op" id="1514177">:=</span>&nbsp;<span class="ident" id="1514180">getcallerpc</span><span class="op" id="1514191">(</span><span class="ident" id="1514192">unsafe</span><span class="op" id="1514198">.</span><span class="ident" id="1514199">Pointer</span><span class="op" id="1514206">(</span><span class="op" id="1514207">&amp;</span><span class="ident" id="1514208">t</span><span class="op" id="1514209">)</span><span class="op" id="1514210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1514214">racereadpc</span><span class="op" id="1514224">(</span><span class="ident" id="1514225">unsafe</span><span class="op" id="1514231">.</span><span class="ident" id="1514232">Pointer</span><span class="op" id="1514239">(</span><span class="ident" id="1514240">h</span><span class="op" id="1514241">)</span><span class="op" id="1514242">,</span>&nbsp;<span class="ident" id="1514244">callerpc</span><span class="op" id="1514252">,</span>&nbsp;<span class="ident" id="1514254">funcPC</span><span class="op" id="1514260">(</span><span class="ident" id="1514261">mapaccess1_faststr</span><span class="op" id="1514279">)</span><span class="op" id="1514280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1514283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1514286">if</span>&nbsp;<span class="ident" id="1514289">h</span>&nbsp;<span class="op" id="1514291">==</span>&nbsp;<span class="ident" id="1514294">nil</span>&nbsp;<span class="op" id="1514298">||</span>&nbsp;<span class="ident" id="1514301">h</span><span class="op" id="1514302">.</span><span class="ident" id="1514303">count</span>&nbsp;<span class="op" id="1514309">==</span>&nbsp;<span class="num" id="1514312">0</span>&nbsp;<span class="op" id="1514314">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1514318">return</span>&nbsp;<span class="ident" id="1514325">unsafe</span><span class="op" id="1514331">.</span><span class="ident" id="1514332">Pointer</span><span class="op" id="1514339">(</span><span class="ident" id="1514340">t</span><span class="op" id="1514341">.</span><span class="ident" id="1514342">elem</span><span class="op" id="1514346">.</span><span class="ident" id="1514347">zero</span><span class="op" id="1514351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1514354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1514357">key</span>&nbsp;<span class="op" id="1514361">:=</span>&nbsp;<span class="op" id="1514364">(</span><span class="op" id="1514365">*</span><span class="ident" id="1514366">stringStruct</span><span class="op" id="1514378">)</span><span class="op" id="1514379">(</span><span class="ident" id="1514380">unsafe</span><span class="op" id="1514386">.</span><span class="ident" id="1514387">Pointer</span><span class="op" id="1514394">(</span><span class="op" id="1514395">&amp;</span><span class="ident" id="1514396">ky</span><span class="op" id="1514398">)</span><span class="op" id="1514399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1514402">if</span>&nbsp;<span class="ident" id="1514405">h</span><span class="op" id="1514406">.</span><span class="ident" id="1514407">B</span>&nbsp;<span class="op" id="1514409">==</span>&nbsp;<span class="num" id="1514412">0</span>&nbsp;<span class="op" id="1514414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1514418">//&nbsp;One-bucket&nbsp;table.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1514441">b</span>&nbsp;<span class="op" id="1514443">:=</span>&nbsp;<span class="op" id="1514446">(</span><span class="op" id="1514447">*</span><span class="ident" id="1514448">bmap</span><span class="op" id="1514452">)</span><span class="op" id="1514453">(</span><span class="ident" id="1514454">h</span><span class="op" id="1514455">.</span><span class="ident" id="1514456">buckets</span><span class="op" id="1514463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1514467">if</span>&nbsp;<span class="ident" id="1514470">key</span><span class="op" id="1514473">.</span><span class="builtinfunc" id="1514474">len</span>&nbsp;<span class="op" id="1514478">&lt;</span>&nbsp;<span class="num" id="1514480">32</span>&nbsp;<span class="op" id="1514483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1514488">//&nbsp;short&nbsp;key,&nbsp;doing&nbsp;lots&nbsp;of&nbsp;comparisons&nbsp;is&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1514537">for</span>&nbsp;<span class="ident" id="1514541">i</span>&nbsp;<span class="op" id="1514543">:=</span>&nbsp;<span class="builtintype" id="1514546">uintptr</span><span class="op" id="1514553">(</span><span class="num" id="1514554">0</span><span class="op" id="1514555">)</span><span class="op" id="1514556">;</span>&nbsp;<span class="ident" id="1514558">i</span>&nbsp;<span class="op" id="1514560">&lt;</span>&nbsp;<span class="ident" id="1514562">bucketCnt</span><span class="op" id="1514571">;</span>&nbsp;<span class="ident" id="1514573">i</span><span class="op" id="1514574">++</span>&nbsp;<span class="op" id="1514577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1514583">x</span>&nbsp;<span class="op" id="1514585">:=</span>&nbsp;<span class="op" id="1514588">*</span><span class="op" id="1514589">(</span><span class="op" id="1514590">(</span><span class="op" id="1514591">*</span><span class="builtintype" id="1514592">uint8</span><span class="op" id="1514597">)</span><span class="op" id="1514598">(</span><span class="ident" id="1514599">add</span><span class="op" id="1514602">(</span><span class="ident" id="1514603">unsafe</span><span class="op" id="1514609">.</span><span class="ident" id="1514610">Pointer</span><span class="op" id="1514617">(</span><span class="ident" id="1514618">b</span><span class="op" id="1514619">)</span><span class="op" id="1514620">,</span>&nbsp;<span class="ident" id="1514622">i</span><span class="op" id="1514623">)</span><span class="op" id="1514624">)</span><span class="op" id="1514625">)</span>&nbsp;<span class="comment" id="1514627">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1514672">if</span>&nbsp;<span class="ident" id="1514675">x</span>&nbsp;<span class="op" id="1514677">==</span>&nbsp;<span class="ident" id="1514680">empty</span>&nbsp;<span class="op" id="1514686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1514693">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1514706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1514712">k</span>&nbsp;<span class="op" id="1514714">:=</span>&nbsp;<span class="op" id="1514717">(</span><span class="op" id="1514718">*</span><span class="ident" id="1514719">stringStruct</span><span class="op" id="1514731">)</span><span class="op" id="1514732">(</span><span class="ident" id="1514733">add</span><span class="op" id="1514736">(</span><span class="ident" id="1514737">unsafe</span><span class="op" id="1514743">.</span><span class="ident" id="1514744">Pointer</span><span class="op" id="1514751">(</span><span class="ident" id="1514752">b</span><span class="op" id="1514753">)</span><span class="op" id="1514754">,</span>&nbsp;<span class="ident" id="1514756">dataOffset</span><span class="op" id="1514766">+</span><span class="ident" id="1514767">i</span><span class="op" id="1514768">*</span><span class="num" id="1514769">2</span><span class="op" id="1514770">*</span><span class="ident" id="1514771">ptrSize</span><span class="op" id="1514778">)</span><span class="op" id="1514779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1514785">if</span>&nbsp;<span class="ident" id="1514788">k</span><span class="op" id="1514789">.</span><span class="builtinfunc" id="1514790">len</span>&nbsp;<span class="op" id="1514794">!=</span>&nbsp;<span class="ident" id="1514797">key</span><span class="op" id="1514800">.</span><span class="builtinfunc" id="1514801">len</span>&nbsp;<span class="op" id="1514805">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1514812">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1514825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1514831">if</span>&nbsp;<span class="ident" id="1514834">k</span><span class="op" id="1514835">.</span><span class="ident" id="1514836">str</span>&nbsp;<span class="op" id="1514840">==</span>&nbsp;<span class="ident" id="1514843">key</span><span class="op" id="1514846">.</span><span class="ident" id="1514847">str</span>&nbsp;<span class="op" id="1514851">||</span>&nbsp;<span class="ident" id="1514854">memeq</span><span class="op" id="1514859">(</span><span class="ident" id="1514860">k</span><span class="op" id="1514861">.</span><span class="ident" id="1514862">str</span><span class="op" id="1514865">,</span>&nbsp;<span class="ident" id="1514867">key</span><span class="op" id="1514870">.</span><span class="ident" id="1514871">str</span><span class="op" id="1514874">,</span>&nbsp;<span class="builtintype" id="1514876">uintptr</span><span class="op" id="1514883">(</span><span class="ident" id="1514884">key</span><span class="op" id="1514887">.</span><span class="builtinfunc" id="1514888">len</span><span class="op" id="1514891">)</span><span class="op" id="1514892">)</span>&nbsp;<span class="op" id="1514894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1514901">return</span>&nbsp;<span class="ident" id="1514908">add</span><span class="op" id="1514911">(</span><span class="ident" id="1514912">unsafe</span><span class="op" id="1514918">.</span><span class="ident" id="1514919">Pointer</span><span class="op" id="1514926">(</span><span class="ident" id="1514927">b</span><span class="op" id="1514928">)</span><span class="op" id="1514929">,</span>&nbsp;<span class="ident" id="1514931">dataOffset</span><span class="op" id="1514941">+</span><span class="ident" id="1514942">bucketCnt</span><span class="op" id="1514951">*</span><span class="num" id="1514952">2</span><span class="op" id="1514953">*</span><span class="ident" id="1514954">ptrSize</span><span class="op" id="1514961">+</span><span class="ident" id="1514962">i</span><span class="op" id="1514963">*</span><span class="builtintype" id="1514964">uintptr</span><span class="op" id="1514971">(</span><span class="ident" id="1514972">t</span><span class="op" id="1514973">.</span><span class="ident" id="1514974">valuesize</span><span class="op" id="1514983">)</span><span class="op" id="1514984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1514990">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1514995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1515000">return</span>&nbsp;<span class="ident" id="1515007">unsafe</span><span class="op" id="1515013">.</span><span class="ident" id="1515014">Pointer</span><span class="op" id="1515021">(</span><span class="ident" id="1515022">t</span><span class="op" id="1515023">.</span><span class="ident" id="1515024">elem</span><span class="op" id="1515028">.</span><span class="ident" id="1515029">zero</span><span class="op" id="1515033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1515037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1515041">//&nbsp;long&nbsp;key,&nbsp;try&nbsp;not&nbsp;to&nbsp;do&nbsp;more&nbsp;comparisons&nbsp;than&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1515102">keymaybe</span>&nbsp;<span class="op" id="1515111">:=</span>&nbsp;<span class="builtintype" id="1515114">uintptr</span><span class="op" id="1515121">(</span><span class="ident" id="1515122">bucketCnt</span><span class="op" id="1515131">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1515135">for</span>&nbsp;<span class="ident" id="1515139">i</span>&nbsp;<span class="op" id="1515141">:=</span>&nbsp;<span class="builtintype" id="1515144">uintptr</span><span class="op" id="1515151">(</span><span class="num" id="1515152">0</span><span class="op" id="1515153">)</span><span class="op" id="1515154">;</span>&nbsp;<span class="ident" id="1515156">i</span>&nbsp;<span class="op" id="1515158">&lt;</span>&nbsp;<span class="ident" id="1515160">bucketCnt</span><span class="op" id="1515169">;</span>&nbsp;<span class="ident" id="1515171">i</span><span class="op" id="1515172">++</span>&nbsp;<span class="op" id="1515175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1515180">x</span>&nbsp;<span class="op" id="1515182">:=</span>&nbsp;<span class="op" id="1515185">*</span><span class="op" id="1515186">(</span><span class="op" id="1515187">(</span><span class="op" id="1515188">*</span><span class="builtintype" id="1515189">uint8</span><span class="op" id="1515194">)</span><span class="op" id="1515195">(</span><span class="ident" id="1515196">add</span><span class="op" id="1515199">(</span><span class="ident" id="1515200">unsafe</span><span class="op" id="1515206">.</span><span class="ident" id="1515207">Pointer</span><span class="op" id="1515214">(</span><span class="ident" id="1515215">b</span><span class="op" id="1515216">)</span><span class="op" id="1515217">,</span>&nbsp;<span class="ident" id="1515219">i</span><span class="op" id="1515220">)</span><span class="op" id="1515221">)</span><span class="op" id="1515222">)</span>&nbsp;<span class="comment" id="1515224">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1515268">if</span>&nbsp;<span class="ident" id="1515271">x</span>&nbsp;<span class="op" id="1515273">==</span>&nbsp;<span class="ident" id="1515276">empty</span>&nbsp;<span class="op" id="1515282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1515288">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1515300">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1515305">k</span>&nbsp;<span class="op" id="1515307">:=</span>&nbsp;<span class="op" id="1515310">(</span><span class="op" id="1515311">*</span><span class="ident" id="1515312">stringStruct</span><span class="op" id="1515324">)</span><span class="op" id="1515325">(</span><span class="ident" id="1515326">add</span><span class="op" id="1515329">(</span><span class="ident" id="1515330">unsafe</span><span class="op" id="1515336">.</span><span class="ident" id="1515337">Pointer</span><span class="op" id="1515344">(</span><span class="ident" id="1515345">b</span><span class="op" id="1515346">)</span><span class="op" id="1515347">,</span>&nbsp;<span class="ident" id="1515349">dataOffset</span><span class="op" id="1515359">+</span><span class="ident" id="1515360">i</span><span class="op" id="1515361">*</span><span class="num" id="1515362">2</span><span class="op" id="1515363">*</span><span class="ident" id="1515364">ptrSize</span><span class="op" id="1515371">)</span><span class="op" id="1515372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1515377">if</span>&nbsp;<span class="ident" id="1515380">k</span><span class="op" id="1515381">.</span><span class="builtinfunc" id="1515382">len</span>&nbsp;<span class="op" id="1515386">!=</span>&nbsp;<span class="ident" id="1515389">key</span><span class="op" id="1515392">.</span><span class="builtinfunc" id="1515393">len</span>&nbsp;<span class="op" id="1515397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1515403">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1515415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1515420">if</span>&nbsp;<span class="ident" id="1515423">k</span><span class="op" id="1515424">.</span><span class="ident" id="1515425">str</span>&nbsp;<span class="op" id="1515429">==</span>&nbsp;<span class="ident" id="1515432">key</span><span class="op" id="1515435">.</span><span class="ident" id="1515436">str</span>&nbsp;<span class="op" id="1515440">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1515446">return</span>&nbsp;<span class="ident" id="1515453">add</span><span class="op" id="1515456">(</span><span class="ident" id="1515457">unsafe</span><span class="op" id="1515463">.</span><span class="ident" id="1515464">Pointer</span><span class="op" id="1515471">(</span><span class="ident" id="1515472">b</span><span class="op" id="1515473">)</span><span class="op" id="1515474">,</span>&nbsp;<span class="ident" id="1515476">dataOffset</span><span class="op" id="1515486">+</span><span class="ident" id="1515487">bucketCnt</span><span class="op" id="1515496">*</span><span class="num" id="1515497">2</span><span class="op" id="1515498">*</span><span class="ident" id="1515499">ptrSize</span><span class="op" id="1515506">+</span><span class="ident" id="1515507">i</span><span class="op" id="1515508">*</span><span class="builtintype" id="1515509">uintptr</span><span class="op" id="1515516">(</span><span class="ident" id="1515517">t</span><span class="op" id="1515518">.</span><span class="ident" id="1515519">valuesize</span><span class="op" id="1515528">)</span><span class="op" id="1515529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1515534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1515539">//&nbsp;check&nbsp;first&nbsp;4&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1515565">//&nbsp;TODO:&nbsp;on&nbsp;amd64/386&nbsp;at&nbsp;least,&nbsp;make&nbsp;this&nbsp;compile&nbsp;to&nbsp;one&nbsp;4-byte&nbsp;comparison&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1515654">//&nbsp;four&nbsp;1-byte&nbsp;comparisons.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1515685">if</span>&nbsp;<span class="op" id="1515688">*</span><span class="op" id="1515689">(</span><span class="op" id="1515690">(</span><span class="op" id="1515691">*</span><span class="op" id="1515692">[</span><span class="num" id="1515693">4</span><span class="op" id="1515694">]</span><span class="builtintype" id="1515695">byte</span><span class="op" id="1515699">)</span><span class="op" id="1515700">(</span><span class="ident" id="1515701">key</span><span class="op" id="1515704">.</span><span class="ident" id="1515705">str</span><span class="op" id="1515708">)</span><span class="op" id="1515709">)</span>&nbsp;<span class="op" id="1515711">!=</span>&nbsp;<span class="op" id="1515714">*</span><span class="op" id="1515715">(</span><span class="op" id="1515716">(</span><span class="op" id="1515717">*</span><span class="op" id="1515718">[</span><span class="num" id="1515719">4</span><span class="op" id="1515720">]</span><span class="builtintype" id="1515721">byte</span><span class="op" id="1515725">)</span><span class="op" id="1515726">(</span><span class="ident" id="1515727">k</span><span class="op" id="1515728">.</span><span class="ident" id="1515729">str</span><span class="op" id="1515732">)</span><span class="op" id="1515733">)</span>&nbsp;<span class="op" id="1515735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1515741">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1515753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1515758">//&nbsp;check&nbsp;last&nbsp;4&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1515783">if</span>&nbsp;<span class="op" id="1515786">*</span><span class="op" id="1515787">(</span><span class="op" id="1515788">(</span><span class="op" id="1515789">*</span><span class="op" id="1515790">[</span><span class="num" id="1515791">4</span><span class="op" id="1515792">]</span><span class="builtintype" id="1515793">byte</span><span class="op" id="1515797">)</span><span class="op" id="1515798">(</span><span class="ident" id="1515799">add</span><span class="op" id="1515802">(</span><span class="ident" id="1515803">key</span><span class="op" id="1515806">.</span><span class="ident" id="1515807">str</span><span class="op" id="1515810">,</span>&nbsp;<span class="builtintype" id="1515812">uintptr</span><span class="op" id="1515819">(</span><span class="ident" id="1515820">key</span><span class="op" id="1515823">.</span><span class="builtinfunc" id="1515824">len</span><span class="op" id="1515827">)</span><span class="op" id="1515828">-</span><span class="num" id="1515829">4</span><span class="op" id="1515830">)</span><span class="op" id="1515831">)</span><span class="op" id="1515832">)</span>&nbsp;<span class="op" id="1515834">!=</span>&nbsp;<span class="op" id="1515837">*</span><span class="op" id="1515838">(</span><span class="op" id="1515839">(</span><span class="op" id="1515840">*</span><span class="op" id="1515841">[</span><span class="num" id="1515842">4</span><span class="op" id="1515843">]</span><span class="builtintype" id="1515844">byte</span><span class="op" id="1515848">)</span><span class="op" id="1515849">(</span><span class="ident" id="1515850">add</span><span class="op" id="1515853">(</span><span class="ident" id="1515854">k</span><span class="op" id="1515855">.</span><span class="ident" id="1515856">str</span><span class="op" id="1515859">,</span>&nbsp;<span class="builtintype" id="1515861">uintptr</span><span class="op" id="1515868">(</span><span class="ident" id="1515869">key</span><span class="op" id="1515872">.</span><span class="builtinfunc" id="1515873">len</span><span class="op" id="1515876">)</span><span class="op" id="1515877">-</span><span class="num" id="1515878">4</span><span class="op" id="1515879">)</span><span class="op" id="1515880">)</span><span class="op" id="1515881">)</span>&nbsp;<span class="op" id="1515883">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1515889">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1515901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1515906">if</span>&nbsp;<span class="ident" id="1515909">keymaybe</span>&nbsp;<span class="op" id="1515918">!=</span>&nbsp;<span class="ident" id="1515921">bucketCnt</span>&nbsp;<span class="op" id="1515931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1515937">//&nbsp;Two&nbsp;keys&nbsp;are&nbsp;potential&nbsp;matches.&nbsp;&nbsp;Use&nbsp;hash&nbsp;to&nbsp;distinguish&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1516007">goto</span>&nbsp;<span class="ident" id="1516012">dohash</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1516022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1516027">keymaybe</span>&nbsp;<span class="op" id="1516036">=</span>&nbsp;<span class="ident" id="1516038">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1516042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1516046">if</span>&nbsp;<span class="ident" id="1516049">keymaybe</span>&nbsp;<span class="op" id="1516058">!=</span>&nbsp;<span class="ident" id="1516061">bucketCnt</span>&nbsp;<span class="op" id="1516071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1516076">k</span>&nbsp;<span class="op" id="1516078">:=</span>&nbsp;<span class="op" id="1516081">(</span><span class="op" id="1516082">*</span><span class="ident" id="1516083">stringStruct</span><span class="op" id="1516095">)</span><span class="op" id="1516096">(</span><span class="ident" id="1516097">add</span><span class="op" id="1516100">(</span><span class="ident" id="1516101">unsafe</span><span class="op" id="1516107">.</span><span class="ident" id="1516108">Pointer</span><span class="op" id="1516115">(</span><span class="ident" id="1516116">b</span><span class="op" id="1516117">)</span><span class="op" id="1516118">,</span>&nbsp;<span class="ident" id="1516120">dataOffset</span><span class="op" id="1516130">+</span><span class="ident" id="1516131">keymaybe</span><span class="op" id="1516139">*</span><span class="num" id="1516140">2</span><span class="op" id="1516141">*</span><span class="ident" id="1516142">ptrSize</span><span class="op" id="1516149">)</span><span class="op" id="1516150">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1516155">if</span>&nbsp;<span class="ident" id="1516158">memeq</span><span class="op" id="1516163">(</span><span class="ident" id="1516164">k</span><span class="op" id="1516165">.</span><span class="ident" id="1516166">str</span><span class="op" id="1516169">,</span>&nbsp;<span class="ident" id="1516171">key</span><span class="op" id="1516174">.</span><span class="ident" id="1516175">str</span><span class="op" id="1516178">,</span>&nbsp;<span class="builtintype" id="1516180">uintptr</span><span class="op" id="1516187">(</span><span class="ident" id="1516188">key</span><span class="op" id="1516191">.</span><span class="builtinfunc" id="1516192">len</span><span class="op" id="1516195">)</span><span class="op" id="1516196">)</span>&nbsp;<span class="op" id="1516198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1516204">return</span>&nbsp;<span class="ident" id="1516211">add</span><span class="op" id="1516214">(</span><span class="ident" id="1516215">unsafe</span><span class="op" id="1516221">.</span><span class="ident" id="1516222">Pointer</span><span class="op" id="1516229">(</span><span class="ident" id="1516230">b</span><span class="op" id="1516231">)</span><span class="op" id="1516232">,</span>&nbsp;<span class="ident" id="1516234">dataOffset</span><span class="op" id="1516244">+</span><span class="ident" id="1516245">bucketCnt</span><span class="op" id="1516254">*</span><span class="num" id="1516255">2</span><span class="op" id="1516256">*</span><span class="ident" id="1516257">ptrSize</span><span class="op" id="1516264">+</span><span class="ident" id="1516265">keymaybe</span><span class="op" id="1516273">*</span><span class="builtintype" id="1516274">uintptr</span><span class="op" id="1516281">(</span><span class="ident" id="1516282">t</span><span class="op" id="1516283">.</span><span class="ident" id="1516284">valuesize</span><span class="op" id="1516293">)</span><span class="op" id="1516294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1516299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1516303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1516307">return</span>&nbsp;<span class="ident" id="1516314">unsafe</span><span class="op" id="1516320">.</span><span class="ident" id="1516321">Pointer</span><span class="op" id="1516328">(</span><span class="ident" id="1516329">t</span><span class="op" id="1516330">.</span><span class="ident" id="1516331">elem</span><span class="op" id="1516335">.</span><span class="ident" id="1516336">zero</span><span class="op" id="1516340">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1516343">}</span><br>
<span class="lineno"></span><span class="ident" id="1516345">dohash</span><span class="op" id="1516351">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1516354">hash</span>&nbsp;<span class="op" id="1516359">:=</span>&nbsp;<span class="ident" id="1516362">goalg</span><span class="op" id="1516367">(</span><span class="ident" id="1516368">t</span><span class="op" id="1516369">.</span><span class="ident" id="1516370">key</span><span class="op" id="1516373">.</span><span class="ident" id="1516374">alg</span><span class="op" id="1516377">)</span><span class="op" id="1516378">.</span><span class="ident" id="1516379">hash</span><span class="op" id="1516383">(</span><span class="ident" id="1516384">noescape</span><span class="op" id="1516392">(</span><span class="ident" id="1516393">unsafe</span><span class="op" id="1516399">.</span><span class="ident" id="1516400">Pointer</span><span class="op" id="1516407">(</span><span class="op" id="1516408">&amp;</span><span class="ident" id="1516409">ky</span><span class="op" id="1516411">)</span><span class="op" id="1516412">)</span><span class="op" id="1516413">,</span>&nbsp;<span class="num" id="1516415">2</span><span class="op" id="1516416">*</span><span class="ident" id="1516417">ptrSize</span><span class="op" id="1516424">,</span>&nbsp;<span class="builtintype" id="1516426">uintptr</span><span class="op" id="1516433">(</span><span class="ident" id="1516434">h</span><span class="op" id="1516435">.</span><span class="ident" id="1516436">hash0</span><span class="op" id="1516441">)</span><span class="op" id="1516442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1516445">m</span>&nbsp;<span class="op" id="1516447">:=</span>&nbsp;<span class="builtintype" id="1516450">uintptr</span><span class="op" id="1516457">(</span><span class="num" id="1516458">1</span><span class="op" id="1516459">)</span><span class="op" id="1516460">&lt;&lt;</span><span class="ident" id="1516462">h</span><span class="op" id="1516463">.</span><span class="ident" id="1516464">B</span>&nbsp;<span class="op" id="1516466">-</span>&nbsp;<span class="num" id="1516468">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1516471">b</span>&nbsp;<span class="op" id="1516473">:=</span>&nbsp;<span class="op" id="1516476">(</span><span class="op" id="1516477">*</span><span class="ident" id="1516478">bmap</span><span class="op" id="1516482">)</span><span class="op" id="1516483">(</span><span class="ident" id="1516484">add</span><span class="op" id="1516487">(</span><span class="ident" id="1516488">h</span><span class="op" id="1516489">.</span><span class="ident" id="1516490">buckets</span><span class="op" id="1516497">,</span>&nbsp;<span class="op" id="1516499">(</span><span class="ident" id="1516500">hash</span><span class="op" id="1516504">&amp;</span><span class="ident" id="1516505">m</span><span class="op" id="1516506">)</span><span class="op" id="1516507">*</span><span class="builtintype" id="1516508">uintptr</span><span class="op" id="1516515">(</span><span class="ident" id="1516516">t</span><span class="op" id="1516517">.</span><span class="ident" id="1516518">bucketsize</span><span class="op" id="1516528">)</span><span class="op" id="1516529">)</span><span class="op" id="1516530">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1516533">if</span>&nbsp;<span class="ident" id="1516536">c</span>&nbsp;<span class="op" id="1516538">:=</span>&nbsp;<span class="ident" id="1516541">h</span><span class="op" id="1516542">.</span><span class="ident" id="1516543">oldbuckets</span><span class="op" id="1516553">;</span>&nbsp;<span class="ident" id="1516555">c</span>&nbsp;<span class="op" id="1516557">!=</span>&nbsp;<span class="ident" id="1516560">nil</span>&nbsp;<span class="op" id="1516564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1516568">oldb</span>&nbsp;<span class="op" id="1516573">:=</span>&nbsp;<span class="op" id="1516576">(</span><span class="op" id="1516577">*</span><span class="ident" id="1516578">bmap</span><span class="op" id="1516582">)</span><span class="op" id="1516583">(</span><span class="ident" id="1516584">add</span><span class="op" id="1516587">(</span><span class="ident" id="1516588">c</span><span class="op" id="1516589">,</span>&nbsp;<span class="op" id="1516591">(</span><span class="ident" id="1516592">hash</span><span class="op" id="1516596">&amp;</span><span class="op" id="1516597">(</span><span class="ident" id="1516598">m</span><span class="op" id="1516599">&gt;&gt;</span><span class="num" id="1516601">1</span><span class="op" id="1516602">)</span><span class="op" id="1516603">)</span><span class="op" id="1516604">*</span><span class="builtintype" id="1516605">uintptr</span><span class="op" id="1516612">(</span><span class="ident" id="1516613">t</span><span class="op" id="1516614">.</span><span class="ident" id="1516615">bucketsize</span><span class="op" id="1516625">)</span><span class="op" id="1516626">)</span><span class="op" id="1516627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1516631">if</span>&nbsp;<span class="op" id="1516634">!</span><span class="ident" id="1516635">evacuated</span><span class="op" id="1516644">(</span><span class="ident" id="1516645">oldb</span><span class="op" id="1516649">)</span>&nbsp;<span class="op" id="1516651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1516656">b</span>&nbsp;<span class="op" id="1516658">=</span>&nbsp;<span class="ident" id="1516660">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1516667">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1516670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1516673">top</span>&nbsp;<span class="op" id="1516677">:=</span>&nbsp;<span class="builtintype" id="1516680">uint8</span><span class="op" id="1516685">(</span><span class="ident" id="1516686">hash</span>&nbsp;<span class="op" id="1516691">&gt;&gt;</span>&nbsp;<span class="op" id="1516694">(</span><span class="ident" id="1516695">ptrSize</span><span class="op" id="1516702">*</span><span class="num" id="1516703">8</span>&nbsp;<span class="op" id="1516705">-</span>&nbsp;<span class="num" id="1516707">8</span><span class="op" id="1516708">)</span><span class="op" id="1516709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1516712">if</span>&nbsp;<span class="ident" id="1516715">top</span>&nbsp;<span class="op" id="1516719">&lt;</span>&nbsp;<span class="ident" id="1516721">minTopHash</span>&nbsp;<span class="op" id="1516732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1516736">top</span>&nbsp;<span class="op" id="1516740">+=</span>&nbsp;<span class="ident" id="1516743">minTopHash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1516755">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1516758">for</span>&nbsp;<span class="op" id="1516762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1516766">for</span>&nbsp;<span class="ident" id="1516770">i</span>&nbsp;<span class="op" id="1516772">:=</span>&nbsp;<span class="builtintype" id="1516775">uintptr</span><span class="op" id="1516782">(</span><span class="num" id="1516783">0</span><span class="op" id="1516784">)</span><span class="op" id="1516785">;</span>&nbsp;<span class="ident" id="1516787">i</span>&nbsp;<span class="op" id="1516789">&lt;</span>&nbsp;<span class="ident" id="1516791">bucketCnt</span><span class="op" id="1516800">;</span>&nbsp;<span class="ident" id="1516802">i</span><span class="op" id="1516803">++</span>&nbsp;<span class="op" id="1516806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1516811">x</span>&nbsp;<span class="op" id="1516813">:=</span>&nbsp;<span class="op" id="1516816">*</span><span class="op" id="1516817">(</span><span class="op" id="1516818">(</span><span class="op" id="1516819">*</span><span class="builtintype" id="1516820">uint8</span><span class="op" id="1516825">)</span><span class="op" id="1516826">(</span><span class="ident" id="1516827">add</span><span class="op" id="1516830">(</span><span class="ident" id="1516831">unsafe</span><span class="op" id="1516837">.</span><span class="ident" id="1516838">Pointer</span><span class="op" id="1516845">(</span><span class="ident" id="1516846">b</span><span class="op" id="1516847">)</span><span class="op" id="1516848">,</span>&nbsp;<span class="ident" id="1516850">i</span><span class="op" id="1516851">)</span><span class="op" id="1516852">)</span><span class="op" id="1516853">)</span>&nbsp;<span class="comment" id="1516855">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1516899">if</span>&nbsp;<span class="ident" id="1516902">x</span>&nbsp;<span class="op" id="1516904">!=</span>&nbsp;<span class="ident" id="1516907">top</span>&nbsp;<span class="op" id="1516911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1516917">continue</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1516929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1516934">k</span>&nbsp;<span class="op" id="1516936">:=</span>&nbsp;<span class="op" id="1516939">(</span><span class="op" id="1516940">*</span><span class="ident" id="1516941">stringStruct</span><span class="op" id="1516953">)</span><span class="op" id="1516954">(</span><span class="ident" id="1516955">add</span><span class="op" id="1516958">(</span><span class="ident" id="1516959">unsafe</span><span class="op" id="1516965">.</span><span class="ident" id="1516966">Pointer</span><span class="op" id="1516973">(</span><span class="ident" id="1516974">b</span><span class="op" id="1516975">)</span><span class="op" id="1516976">,</span>&nbsp;<span class="ident" id="1516978">dataOffset</span><span class="op" id="1516988">+</span><span class="ident" id="1516989">i</span><span class="op" id="1516990">*</span><span class="num" id="1516991">2</span><span class="op" id="1516992">*</span><span class="ident" id="1516993">ptrSize</span><span class="op" id="1517000">)</span><span class="op" id="1517001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1517006">if</span>&nbsp;<span class="ident" id="1517009">k</span><span class="op" id="1517010">.</span><span class="builtinfunc" id="1517011">len</span>&nbsp;<span class="op" id="1517015">!=</span>&nbsp;<span class="ident" id="1517018">key</span><span class="op" id="1517021">.</span><span class="builtinfunc" id="1517022">len</span>&nbsp;<span class="op" id="1517026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1517032">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1517044">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1517049">if</span>&nbsp;<span class="ident" id="1517052">k</span><span class="op" id="1517053">.</span><span class="ident" id="1517054">str</span>&nbsp;<span class="op" id="1517058">==</span>&nbsp;<span class="ident" id="1517061">key</span><span class="op" id="1517064">.</span><span class="ident" id="1517065">str</span>&nbsp;<span class="op" id="1517069">||</span>&nbsp;<span class="ident" id="1517072">memeq</span><span class="op" id="1517077">(</span><span class="ident" id="1517078">k</span><span class="op" id="1517079">.</span><span class="ident" id="1517080">str</span><span class="op" id="1517083">,</span>&nbsp;<span class="ident" id="1517085">key</span><span class="op" id="1517088">.</span><span class="ident" id="1517089">str</span><span class="op" id="1517092">,</span>&nbsp;<span class="builtintype" id="1517094">uintptr</span><span class="op" id="1517101">(</span><span class="ident" id="1517102">key</span><span class="op" id="1517105">.</span><span class="builtinfunc" id="1517106">len</span><span class="op" id="1517109">)</span><span class="op" id="1517110">)</span>&nbsp;<span class="op" id="1517112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1517118">return</span>&nbsp;<span class="ident" id="1517125">add</span><span class="op" id="1517128">(</span><span class="ident" id="1517129">unsafe</span><span class="op" id="1517135">.</span><span class="ident" id="1517136">Pointer</span><span class="op" id="1517143">(</span><span class="ident" id="1517144">b</span><span class="op" id="1517145">)</span><span class="op" id="1517146">,</span>&nbsp;<span class="ident" id="1517148">dataOffset</span><span class="op" id="1517158">+</span><span class="ident" id="1517159">bucketCnt</span><span class="op" id="1517168">*</span><span class="num" id="1517169">2</span><span class="op" id="1517170">*</span><span class="ident" id="1517171">ptrSize</span><span class="op" id="1517178">+</span><span class="ident" id="1517179">i</span><span class="op" id="1517180">*</span><span class="builtintype" id="1517181">uintptr</span><span class="op" id="1517188">(</span><span class="ident" id="1517189">t</span><span class="op" id="1517190">.</span><span class="ident" id="1517191">valuesize</span><span class="op" id="1517200">)</span><span class="op" id="1517201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1517206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1517210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1517214">b</span>&nbsp;<span class="op" id="1517216">=</span>&nbsp;<span class="ident" id="1517218">b</span><span class="op" id="1517219">.</span><span class="ident" id="1517220">overflow</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1517231">if</span>&nbsp;<span class="ident" id="1517234">b</span>&nbsp;<span class="op" id="1517236">==</span>&nbsp;<span class="ident" id="1517239">nil</span>&nbsp;<span class="op" id="1517243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1517248">return</span>&nbsp;<span class="ident" id="1517255">unsafe</span><span class="op" id="1517261">.</span><span class="ident" id="1517262">Pointer</span><span class="op" id="1517269">(</span><span class="ident" id="1517270">t</span><span class="op" id="1517271">.</span><span class="ident" id="1517272">elem</span><span class="op" id="1517276">.</span><span class="ident" id="1517277">zero</span><span class="op" id="1517281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1517285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1517288">}</span><br>
<span class="lineno"></span><span class="op" id="1517290">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="1517293">func</span>&nbsp;<span class="ident" id="1517298">mapaccess2_faststr</span><span class="op" id="1517316">(</span><span class="ident" id="1517317">t</span>&nbsp;<span class="op" id="1517319">*</span><span class="ident" id="1517320">maptype</span><span class="op" id="1517327">,</span>&nbsp;<span class="ident" id="1517329">h</span>&nbsp;<span class="op" id="1517331">*</span><span class="ident" id="1517332">hmap</span><span class="op" id="1517336">,</span>&nbsp;<span class="ident" id="1517338">ky</span>&nbsp;<span class="builtintype" id="1517341">string</span><span class="op" id="1517347">)</span>&nbsp;<span class="op" id="1517349">(</span><span class="ident" id="1517350">unsafe</span><span class="op" id="1517356">.</span><span class="ident" id="1517357">Pointer</span><span class="op" id="1517364">,</span>&nbsp;<span class="builtintype" id="1517366">bool</span><span class="op" id="1517370">)</span>&nbsp;<span class="op" id="1517372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1517375">if</span>&nbsp;<span class="ident" id="1517378">raceenabled</span>&nbsp;<span class="op" id="1517390">&amp;&amp;</span>&nbsp;<span class="ident" id="1517393">h</span>&nbsp;<span class="op" id="1517395">!=</span>&nbsp;<span class="ident" id="1517398">nil</span>&nbsp;<span class="op" id="1517402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1517406">callerpc</span>&nbsp;<span class="op" id="1517415">:=</span>&nbsp;<span class="ident" id="1517418">getcallerpc</span><span class="op" id="1517429">(</span><span class="ident" id="1517430">unsafe</span><span class="op" id="1517436">.</span><span class="ident" id="1517437">Pointer</span><span class="op" id="1517444">(</span><span class="op" id="1517445">&amp;</span><span class="ident" id="1517446">t</span><span class="op" id="1517447">)</span><span class="op" id="1517448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1517452">racereadpc</span><span class="op" id="1517462">(</span><span class="ident" id="1517463">unsafe</span><span class="op" id="1517469">.</span><span class="ident" id="1517470">Pointer</span><span class="op" id="1517477">(</span><span class="ident" id="1517478">h</span><span class="op" id="1517479">)</span><span class="op" id="1517480">,</span>&nbsp;<span class="ident" id="1517482">callerpc</span><span class="op" id="1517490">,</span>&nbsp;<span class="ident" id="1517492">funcPC</span><span class="op" id="1517498">(</span><span class="ident" id="1517499">mapaccess2_faststr</span><span class="op" id="1517517">)</span><span class="op" id="1517518">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1517521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1517524">if</span>&nbsp;<span class="ident" id="1517527">h</span>&nbsp;<span class="op" id="1517529">==</span>&nbsp;<span class="ident" id="1517532">nil</span>&nbsp;<span class="op" id="1517536">||</span>&nbsp;<span class="ident" id="1517539">h</span><span class="op" id="1517540">.</span><span class="ident" id="1517541">count</span>&nbsp;<span class="op" id="1517547">==</span>&nbsp;<span class="num" id="1517550">0</span>&nbsp;<span class="op" id="1517552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1517556">return</span>&nbsp;<span class="ident" id="1517563">unsafe</span><span class="op" id="1517569">.</span><span class="ident" id="1517570">Pointer</span><span class="op" id="1517577">(</span><span class="ident" id="1517578">t</span><span class="op" id="1517579">.</span><span class="ident" id="1517580">elem</span><span class="op" id="1517584">.</span><span class="ident" id="1517585">zero</span><span class="op" id="1517589">)</span><span class="op" id="1517590">,</span>&nbsp;<span class="builtintype" id="1517592">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1517599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1517602">key</span>&nbsp;<span class="op" id="1517606">:=</span>&nbsp;<span class="op" id="1517609">(</span><span class="op" id="1517610">*</span><span class="ident" id="1517611">stringStruct</span><span class="op" id="1517623">)</span><span class="op" id="1517624">(</span><span class="ident" id="1517625">unsafe</span><span class="op" id="1517631">.</span><span class="ident" id="1517632">Pointer</span><span class="op" id="1517639">(</span><span class="op" id="1517640">&amp;</span><span class="ident" id="1517641">ky</span><span class="op" id="1517643">)</span><span class="op" id="1517644">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1517647">if</span>&nbsp;<span class="ident" id="1517650">h</span><span class="op" id="1517651">.</span><span class="ident" id="1517652">B</span>&nbsp;<span class="op" id="1517654">==</span>&nbsp;<span class="num" id="1517657">0</span>&nbsp;<span class="op" id="1517659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1517663">//&nbsp;One-bucket&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1517686">b</span>&nbsp;<span class="op" id="1517688">:=</span>&nbsp;<span class="op" id="1517691">(</span><span class="op" id="1517692">*</span><span class="ident" id="1517693">bmap</span><span class="op" id="1517697">)</span><span class="op" id="1517698">(</span><span class="ident" id="1517699">h</span><span class="op" id="1517700">.</span><span class="ident" id="1517701">buckets</span><span class="op" id="1517708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1517712">if</span>&nbsp;<span class="ident" id="1517715">key</span><span class="op" id="1517718">.</span><span class="builtinfunc" id="1517719">len</span>&nbsp;<span class="op" id="1517723">&lt;</span>&nbsp;<span class="num" id="1517725">32</span>&nbsp;<span class="op" id="1517728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1517733">//&nbsp;short&nbsp;key,&nbsp;doing&nbsp;lots&nbsp;of&nbsp;comparisons&nbsp;is&nbsp;ok</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1517782">for</span>&nbsp;<span class="ident" id="1517786">i</span>&nbsp;<span class="op" id="1517788">:=</span>&nbsp;<span class="builtintype" id="1517791">uintptr</span><span class="op" id="1517798">(</span><span class="num" id="1517799">0</span><span class="op" id="1517800">)</span><span class="op" id="1517801">;</span>&nbsp;<span class="ident" id="1517803">i</span>&nbsp;<span class="op" id="1517805">&lt;</span>&nbsp;<span class="ident" id="1517807">bucketCnt</span><span class="op" id="1517816">;</span>&nbsp;<span class="ident" id="1517818">i</span><span class="op" id="1517819">++</span>&nbsp;<span class="op" id="1517822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1517828">x</span>&nbsp;<span class="op" id="1517830">:=</span>&nbsp;<span class="op" id="1517833">*</span><span class="op" id="1517834">(</span><span class="op" id="1517835">(</span><span class="op" id="1517836">*</span><span class="builtintype" id="1517837">uint8</span><span class="op" id="1517842">)</span><span class="op" id="1517843">(</span><span class="ident" id="1517844">add</span><span class="op" id="1517847">(</span><span class="ident" id="1517848">unsafe</span><span class="op" id="1517854">.</span><span class="ident" id="1517855">Pointer</span><span class="op" id="1517862">(</span><span class="ident" id="1517863">b</span><span class="op" id="1517864">)</span><span class="op" id="1517865">,</span>&nbsp;<span class="ident" id="1517867">i</span><span class="op" id="1517868">)</span><span class="op" id="1517869">)</span><span class="op" id="1517870">)</span>&nbsp;<span class="comment" id="1517872">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1517917">if</span>&nbsp;<span class="ident" id="1517920">x</span>&nbsp;<span class="op" id="1517922">==</span>&nbsp;<span class="ident" id="1517925">empty</span>&nbsp;<span class="op" id="1517931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1517938">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1517951">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1517957">k</span>&nbsp;<span class="op" id="1517959">:=</span>&nbsp;<span class="op" id="1517962">(</span><span class="op" id="1517963">*</span><span class="ident" id="1517964">stringStruct</span><span class="op" id="1517976">)</span><span class="op" id="1517977">(</span><span class="ident" id="1517978">add</span><span class="op" id="1517981">(</span><span class="ident" id="1517982">unsafe</span><span class="op" id="1517988">.</span><span class="ident" id="1517989">Pointer</span><span class="op" id="1517996">(</span><span class="ident" id="1517997">b</span><span class="op" id="1517998">)</span><span class="op" id="1517999">,</span>&nbsp;<span class="ident" id="1518001">dataOffset</span><span class="op" id="1518011">+</span><span class="ident" id="1518012">i</span><span class="op" id="1518013">*</span><span class="num" id="1518014">2</span><span class="op" id="1518015">*</span><span class="ident" id="1518016">ptrSize</span><span class="op" id="1518023">)</span><span class="op" id="1518024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1518030">if</span>&nbsp;<span class="ident" id="1518033">k</span><span class="op" id="1518034">.</span><span class="builtinfunc" id="1518035">len</span>&nbsp;<span class="op" id="1518039">!=</span>&nbsp;<span class="ident" id="1518042">key</span><span class="op" id="1518045">.</span><span class="builtinfunc" id="1518046">len</span>&nbsp;<span class="op" id="1518050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1518057">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1518070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1518076">if</span>&nbsp;<span class="ident" id="1518079">k</span><span class="op" id="1518080">.</span><span class="ident" id="1518081">str</span>&nbsp;<span class="op" id="1518085">==</span>&nbsp;<span class="ident" id="1518088">key</span><span class="op" id="1518091">.</span><span class="ident" id="1518092">str</span>&nbsp;<span class="op" id="1518096">||</span>&nbsp;<span class="ident" id="1518099">memeq</span><span class="op" id="1518104">(</span><span class="ident" id="1518105">k</span><span class="op" id="1518106">.</span><span class="ident" id="1518107">str</span><span class="op" id="1518110">,</span>&nbsp;<span class="ident" id="1518112">key</span><span class="op" id="1518115">.</span><span class="ident" id="1518116">str</span><span class="op" id="1518119">,</span>&nbsp;<span class="builtintype" id="1518121">uintptr</span><span class="op" id="1518128">(</span><span class="ident" id="1518129">key</span><span class="op" id="1518132">.</span><span class="builtinfunc" id="1518133">len</span><span class="op" id="1518136">)</span><span class="op" id="1518137">)</span>&nbsp;<span class="op" id="1518139">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1518146">return</span>&nbsp;<span class="ident" id="1518153">add</span><span class="op" id="1518156">(</span><span class="ident" id="1518157">unsafe</span><span class="op" id="1518163">.</span><span class="ident" id="1518164">Pointer</span><span class="op" id="1518171">(</span><span class="ident" id="1518172">b</span><span class="op" id="1518173">)</span><span class="op" id="1518174">,</span>&nbsp;<span class="ident" id="1518176">dataOffset</span><span class="op" id="1518186">+</span><span class="ident" id="1518187">bucketCnt</span><span class="op" id="1518196">*</span><span class="num" id="1518197">2</span><span class="op" id="1518198">*</span><span class="ident" id="1518199">ptrSize</span><span class="op" id="1518206">+</span><span class="ident" id="1518207">i</span><span class="op" id="1518208">*</span><span class="builtintype" id="1518209">uintptr</span><span class="op" id="1518216">(</span><span class="ident" id="1518217">t</span><span class="op" id="1518218">.</span><span class="ident" id="1518219">valuesize</span><span class="op" id="1518228">)</span><span class="op" id="1518229">)</span><span class="op" id="1518230">,</span>&nbsp;<span class="builtintype" id="1518232">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1518241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1518246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1518251">return</span>&nbsp;<span class="ident" id="1518258">unsafe</span><span class="op" id="1518264">.</span><span class="ident" id="1518265">Pointer</span><span class="op" id="1518272">(</span><span class="ident" id="1518273">t</span><span class="op" id="1518274">.</span><span class="ident" id="1518275">elem</span><span class="op" id="1518279">.</span><span class="ident" id="1518280">zero</span><span class="op" id="1518284">)</span><span class="op" id="1518285">,</span>&nbsp;<span class="builtintype" id="1518287">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1518295">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1518299">//&nbsp;long&nbsp;key,&nbsp;try&nbsp;not&nbsp;to&nbsp;do&nbsp;more&nbsp;comparisons&nbsp;than&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1518360">keymaybe</span>&nbsp;<span class="op" id="1518369">:=</span>&nbsp;<span class="builtintype" id="1518372">uintptr</span><span class="op" id="1518379">(</span><span class="ident" id="1518380">bucketCnt</span><span class="op" id="1518389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1518393">for</span>&nbsp;<span class="ident" id="1518397">i</span>&nbsp;<span class="op" id="1518399">:=</span>&nbsp;<span class="builtintype" id="1518402">uintptr</span><span class="op" id="1518409">(</span><span class="num" id="1518410">0</span><span class="op" id="1518411">)</span><span class="op" id="1518412">;</span>&nbsp;<span class="ident" id="1518414">i</span>&nbsp;<span class="op" id="1518416">&lt;</span>&nbsp;<span class="ident" id="1518418">bucketCnt</span><span class="op" id="1518427">;</span>&nbsp;<span class="ident" id="1518429">i</span><span class="op" id="1518430">++</span>&nbsp;<span class="op" id="1518433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1518438">x</span>&nbsp;<span class="op" id="1518440">:=</span>&nbsp;<span class="op" id="1518443">*</span><span class="op" id="1518444">(</span><span class="op" id="1518445">(</span><span class="op" id="1518446">*</span><span class="builtintype" id="1518447">uint8</span><span class="op" id="1518452">)</span><span class="op" id="1518453">(</span><span class="ident" id="1518454">add</span><span class="op" id="1518457">(</span><span class="ident" id="1518458">unsafe</span><span class="op" id="1518464">.</span><span class="ident" id="1518465">Pointer</span><span class="op" id="1518472">(</span><span class="ident" id="1518473">b</span><span class="op" id="1518474">)</span><span class="op" id="1518475">,</span>&nbsp;<span class="ident" id="1518477">i</span><span class="op" id="1518478">)</span><span class="op" id="1518479">)</span><span class="op" id="1518480">)</span>&nbsp;<span class="comment" id="1518482">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1518526">if</span>&nbsp;<span class="ident" id="1518529">x</span>&nbsp;<span class="op" id="1518531">==</span>&nbsp;<span class="ident" id="1518534">empty</span>&nbsp;<span class="op" id="1518540">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1518546">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1518558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1518563">k</span>&nbsp;<span class="op" id="1518565">:=</span>&nbsp;<span class="op" id="1518568">(</span><span class="op" id="1518569">*</span><span class="ident" id="1518570">stringStruct</span><span class="op" id="1518582">)</span><span class="op" id="1518583">(</span><span class="ident" id="1518584">add</span><span class="op" id="1518587">(</span><span class="ident" id="1518588">unsafe</span><span class="op" id="1518594">.</span><span class="ident" id="1518595">Pointer</span><span class="op" id="1518602">(</span><span class="ident" id="1518603">b</span><span class="op" id="1518604">)</span><span class="op" id="1518605">,</span>&nbsp;<span class="ident" id="1518607">dataOffset</span><span class="op" id="1518617">+</span><span class="ident" id="1518618">i</span><span class="op" id="1518619">*</span><span class="num" id="1518620">2</span><span class="op" id="1518621">*</span><span class="ident" id="1518622">ptrSize</span><span class="op" id="1518629">)</span><span class="op" id="1518630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1518635">if</span>&nbsp;<span class="ident" id="1518638">k</span><span class="op" id="1518639">.</span><span class="builtinfunc" id="1518640">len</span>&nbsp;<span class="op" id="1518644">!=</span>&nbsp;<span class="ident" id="1518647">key</span><span class="op" id="1518650">.</span><span class="builtinfunc" id="1518651">len</span>&nbsp;<span class="op" id="1518655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1518661">continue</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1518673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1518678">if</span>&nbsp;<span class="ident" id="1518681">k</span><span class="op" id="1518682">.</span><span class="ident" id="1518683">str</span>&nbsp;<span class="op" id="1518687">==</span>&nbsp;<span class="ident" id="1518690">key</span><span class="op" id="1518693">.</span><span class="ident" id="1518694">str</span>&nbsp;<span class="op" id="1518698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1518704">return</span>&nbsp;<span class="ident" id="1518711">add</span><span class="op" id="1518714">(</span><span class="ident" id="1518715">unsafe</span><span class="op" id="1518721">.</span><span class="ident" id="1518722">Pointer</span><span class="op" id="1518729">(</span><span class="ident" id="1518730">b</span><span class="op" id="1518731">)</span><span class="op" id="1518732">,</span>&nbsp;<span class="ident" id="1518734">dataOffset</span><span class="op" id="1518744">+</span><span class="ident" id="1518745">bucketCnt</span><span class="op" id="1518754">*</span><span class="num" id="1518755">2</span><span class="op" id="1518756">*</span><span class="ident" id="1518757">ptrSize</span><span class="op" id="1518764">+</span><span class="ident" id="1518765">i</span><span class="op" id="1518766">*</span><span class="builtintype" id="1518767">uintptr</span><span class="op" id="1518774">(</span><span class="ident" id="1518775">t</span><span class="op" id="1518776">.</span><span class="ident" id="1518777">valuesize</span><span class="op" id="1518786">)</span><span class="op" id="1518787">)</span><span class="op" id="1518788">,</span>&nbsp;<span class="builtintype" id="1518790">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1518798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1518803">//&nbsp;check&nbsp;first&nbsp;4&nbsp;bytes</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1518829">if</span>&nbsp;<span class="op" id="1518832">*</span><span class="op" id="1518833">(</span><span class="op" id="1518834">(</span><span class="op" id="1518835">*</span><span class="op" id="1518836">[</span><span class="num" id="1518837">4</span><span class="op" id="1518838">]</span><span class="builtintype" id="1518839">byte</span><span class="op" id="1518843">)</span><span class="op" id="1518844">(</span><span class="ident" id="1518845">key</span><span class="op" id="1518848">.</span><span class="ident" id="1518849">str</span><span class="op" id="1518852">)</span><span class="op" id="1518853">)</span>&nbsp;<span class="op" id="1518855">!=</span>&nbsp;<span class="op" id="1518858">*</span><span class="op" id="1518859">(</span><span class="op" id="1518860">(</span><span class="op" id="1518861">*</span><span class="op" id="1518862">[</span><span class="num" id="1518863">4</span><span class="op" id="1518864">]</span><span class="builtintype" id="1518865">byte</span><span class="op" id="1518869">)</span><span class="op" id="1518870">(</span><span class="ident" id="1518871">k</span><span class="op" id="1518872">.</span><span class="ident" id="1518873">str</span><span class="op" id="1518876">)</span><span class="op" id="1518877">)</span>&nbsp;<span class="op" id="1518879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1518885">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1518897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1518902">//&nbsp;check&nbsp;last&nbsp;4&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1518927">if</span>&nbsp;<span class="op" id="1518930">*</span><span class="op" id="1518931">(</span><span class="op" id="1518932">(</span><span class="op" id="1518933">*</span><span class="op" id="1518934">[</span><span class="num" id="1518935">4</span><span class="op" id="1518936">]</span><span class="builtintype" id="1518937">byte</span><span class="op" id="1518941">)</span><span class="op" id="1518942">(</span><span class="ident" id="1518943">add</span><span class="op" id="1518946">(</span><span class="ident" id="1518947">key</span><span class="op" id="1518950">.</span><span class="ident" id="1518951">str</span><span class="op" id="1518954">,</span>&nbsp;<span class="builtintype" id="1518956">uintptr</span><span class="op" id="1518963">(</span><span class="ident" id="1518964">key</span><span class="op" id="1518967">.</span><span class="builtinfunc" id="1518968">len</span><span class="op" id="1518971">)</span><span class="op" id="1518972">-</span><span class="num" id="1518973">4</span><span class="op" id="1518974">)</span><span class="op" id="1518975">)</span><span class="op" id="1518976">)</span>&nbsp;<span class="op" id="1518978">!=</span>&nbsp;<span class="op" id="1518981">*</span><span class="op" id="1518982">(</span><span class="op" id="1518983">(</span><span class="op" id="1518984">*</span><span class="op" id="1518985">[</span><span class="num" id="1518986">4</span><span class="op" id="1518987">]</span><span class="builtintype" id="1518988">byte</span><span class="op" id="1518992">)</span><span class="op" id="1518993">(</span><span class="ident" id="1518994">add</span><span class="op" id="1518997">(</span><span class="ident" id="1518998">k</span><span class="op" id="1518999">.</span><span class="ident" id="1519000">str</span><span class="op" id="1519003">,</span>&nbsp;<span class="builtintype" id="1519005">uintptr</span><span class="op" id="1519012">(</span><span class="ident" id="1519013">key</span><span class="op" id="1519016">.</span><span class="builtinfunc" id="1519017">len</span><span class="op" id="1519020">)</span><span class="op" id="1519021">-</span><span class="num" id="1519022">4</span><span class="op" id="1519023">)</span><span class="op" id="1519024">)</span><span class="op" id="1519025">)</span>&nbsp;<span class="op" id="1519027">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1519033">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1519045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1519050">if</span>&nbsp;<span class="ident" id="1519053">keymaybe</span>&nbsp;<span class="op" id="1519062">!=</span>&nbsp;<span class="ident" id="1519065">bucketCnt</span>&nbsp;<span class="op" id="1519075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1519081">//&nbsp;Two&nbsp;keys&nbsp;are&nbsp;potential&nbsp;matches.&nbsp;&nbsp;Use&nbsp;hash&nbsp;to&nbsp;distinguish&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1519151">goto</span>&nbsp;<span class="ident" id="1519156">dohash</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1519166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1519171">keymaybe</span>&nbsp;<span class="op" id="1519180">=</span>&nbsp;<span class="ident" id="1519182">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1519186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1519190">if</span>&nbsp;<span class="ident" id="1519193">keymaybe</span>&nbsp;<span class="op" id="1519202">!=</span>&nbsp;<span class="ident" id="1519205">bucketCnt</span>&nbsp;<span class="op" id="1519215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1519220">k</span>&nbsp;<span class="op" id="1519222">:=</span>&nbsp;<span class="op" id="1519225">(</span><span class="op" id="1519226">*</span><span class="ident" id="1519227">stringStruct</span><span class="op" id="1519239">)</span><span class="op" id="1519240">(</span><span class="ident" id="1519241">add</span><span class="op" id="1519244">(</span><span class="ident" id="1519245">unsafe</span><span class="op" id="1519251">.</span><span class="ident" id="1519252">Pointer</span><span class="op" id="1519259">(</span><span class="ident" id="1519260">b</span><span class="op" id="1519261">)</span><span class="op" id="1519262">,</span>&nbsp;<span class="ident" id="1519264">dataOffset</span><span class="op" id="1519274">+</span><span class="ident" id="1519275">keymaybe</span><span class="op" id="1519283">*</span><span class="num" id="1519284">2</span><span class="op" id="1519285">*</span><span class="ident" id="1519286">ptrSize</span><span class="op" id="1519293">)</span><span class="op" id="1519294">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1519299">if</span>&nbsp;<span class="ident" id="1519302">memeq</span><span class="op" id="1519307">(</span><span class="ident" id="1519308">k</span><span class="op" id="1519309">.</span><span class="ident" id="1519310">str</span><span class="op" id="1519313">,</span>&nbsp;<span class="ident" id="1519315">key</span><span class="op" id="1519318">.</span><span class="ident" id="1519319">str</span><span class="op" id="1519322">,</span>&nbsp;<span class="builtintype" id="1519324">uintptr</span><span class="op" id="1519331">(</span><span class="ident" id="1519332">key</span><span class="op" id="1519335">.</span><span class="builtinfunc" id="1519336">len</span><span class="op" id="1519339">)</span><span class="op" id="1519340">)</span>&nbsp;<span class="op" id="1519342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1519348">return</span>&nbsp;<span class="ident" id="1519355">add</span><span class="op" id="1519358">(</span><span class="ident" id="1519359">unsafe</span><span class="op" id="1519365">.</span><span class="ident" id="1519366">Pointer</span><span class="op" id="1519373">(</span><span class="ident" id="1519374">b</span><span class="op" id="1519375">)</span><span class="op" id="1519376">,</span>&nbsp;<span class="ident" id="1519378">dataOffset</span><span class="op" id="1519388">+</span><span class="ident" id="1519389">bucketCnt</span><span class="op" id="1519398">*</span><span class="num" id="1519399">2</span><span class="op" id="1519400">*</span><span class="ident" id="1519401">ptrSize</span><span class="op" id="1519408">+</span><span class="ident" id="1519409">keymaybe</span><span class="op" id="1519417">*</span><span class="builtintype" id="1519418">uintptr</span><span class="op" id="1519425">(</span><span class="ident" id="1519426">t</span><span class="op" id="1519427">.</span><span class="ident" id="1519428">valuesize</span><span class="op" id="1519437">)</span><span class="op" id="1519438">)</span><span class="op" id="1519439">,</span>&nbsp;<span class="builtintype" id="1519441">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1519449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1519453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1519457">return</span>&nbsp;<span class="ident" id="1519464">unsafe</span><span class="op" id="1519470">.</span><span class="ident" id="1519471">Pointer</span><span class="op" id="1519478">(</span><span class="ident" id="1519479">t</span><span class="op" id="1519480">.</span><span class="ident" id="1519481">elem</span><span class="op" id="1519485">.</span><span class="ident" id="1519486">zero</span><span class="op" id="1519490">)</span><span class="op" id="1519491">,</span>&nbsp;<span class="builtintype" id="1519493">false</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1519500">}</span><br>
<span class="lineno"></span><span class="ident" id="1519502">dohash</span><span class="op" id="1519508">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1519511">hash</span>&nbsp;<span class="op" id="1519516">:=</span>&nbsp;<span class="ident" id="1519519">goalg</span><span class="op" id="1519524">(</span><span class="ident" id="1519525">t</span><span class="op" id="1519526">.</span><span class="ident" id="1519527">key</span><span class="op" id="1519530">.</span><span class="ident" id="1519531">alg</span><span class="op" id="1519534">)</span><span class="op" id="1519535">.</span><span class="ident" id="1519536">hash</span><span class="op" id="1519540">(</span><span class="ident" id="1519541">noescape</span><span class="op" id="1519549">(</span><span class="ident" id="1519550">unsafe</span><span class="op" id="1519556">.</span><span class="ident" id="1519557">Pointer</span><span class="op" id="1519564">(</span><span class="op" id="1519565">&amp;</span><span class="ident" id="1519566">ky</span><span class="op" id="1519568">)</span><span class="op" id="1519569">)</span><span class="op" id="1519570">,</span>&nbsp;<span class="num" id="1519572">2</span><span class="op" id="1519573">*</span><span class="ident" id="1519574">ptrSize</span><span class="op" id="1519581">,</span>&nbsp;<span class="builtintype" id="1519583">uintptr</span><span class="op" id="1519590">(</span><span class="ident" id="1519591">h</span><span class="op" id="1519592">.</span><span class="ident" id="1519593">hash0</span><span class="op" id="1519598">)</span><span class="op" id="1519599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1519602">m</span>&nbsp;<span class="op" id="1519604">:=</span>&nbsp;<span class="builtintype" id="1519607">uintptr</span><span class="op" id="1519614">(</span><span class="num" id="1519615">1</span><span class="op" id="1519616">)</span><span class="op" id="1519617">&lt;&lt;</span><span class="ident" id="1519619">h</span><span class="op" id="1519620">.</span><span class="ident" id="1519621">B</span>&nbsp;<span class="op" id="1519623">-</span>&nbsp;<span class="num" id="1519625">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1519628">b</span>&nbsp;<span class="op" id="1519630">:=</span>&nbsp;<span class="op" id="1519633">(</span><span class="op" id="1519634">*</span><span class="ident" id="1519635">bmap</span><span class="op" id="1519639">)</span><span class="op" id="1519640">(</span><span class="ident" id="1519641">add</span><span class="op" id="1519644">(</span><span class="ident" id="1519645">h</span><span class="op" id="1519646">.</span><span class="ident" id="1519647">buckets</span><span class="op" id="1519654">,</span>&nbsp;<span class="op" id="1519656">(</span><span class="ident" id="1519657">hash</span><span class="op" id="1519661">&amp;</span><span class="ident" id="1519662">m</span><span class="op" id="1519663">)</span><span class="op" id="1519664">*</span><span class="builtintype" id="1519665">uintptr</span><span class="op" id="1519672">(</span><span class="ident" id="1519673">t</span><span class="op" id="1519674">.</span><span class="ident" id="1519675">bucketsize</span><span class="op" id="1519685">)</span><span class="op" id="1519686">)</span><span class="op" id="1519687">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1519690">if</span>&nbsp;<span class="ident" id="1519693">c</span>&nbsp;<span class="op" id="1519695">:=</span>&nbsp;<span class="ident" id="1519698">h</span><span class="op" id="1519699">.</span><span class="ident" id="1519700">oldbuckets</span><span class="op" id="1519710">;</span>&nbsp;<span class="ident" id="1519712">c</span>&nbsp;<span class="op" id="1519714">!=</span>&nbsp;<span class="ident" id="1519717">nil</span>&nbsp;<span class="op" id="1519721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1519725">oldb</span>&nbsp;<span class="op" id="1519730">:=</span>&nbsp;<span class="op" id="1519733">(</span><span class="op" id="1519734">*</span><span class="ident" id="1519735">bmap</span><span class="op" id="1519739">)</span><span class="op" id="1519740">(</span><span class="ident" id="1519741">add</span><span class="op" id="1519744">(</span><span class="ident" id="1519745">c</span><span class="op" id="1519746">,</span>&nbsp;<span class="op" id="1519748">(</span><span class="ident" id="1519749">hash</span><span class="op" id="1519753">&amp;</span><span class="op" id="1519754">(</span><span class="ident" id="1519755">m</span><span class="op" id="1519756">&gt;&gt;</span><span class="num" id="1519758">1</span><span class="op" id="1519759">)</span><span class="op" id="1519760">)</span><span class="op" id="1519761">*</span><span class="builtintype" id="1519762">uintptr</span><span class="op" id="1519769">(</span><span class="ident" id="1519770">t</span><span class="op" id="1519771">.</span><span class="ident" id="1519772">bucketsize</span><span class="op" id="1519782">)</span><span class="op" id="1519783">)</span><span class="op" id="1519784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1519788">if</span>&nbsp;<span class="op" id="1519791">!</span><span class="ident" id="1519792">evacuated</span><span class="op" id="1519801">(</span><span class="ident" id="1519802">oldb</span><span class="op" id="1519806">)</span>&nbsp;<span class="op" id="1519808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1519813">b</span>&nbsp;<span class="op" id="1519815">=</span>&nbsp;<span class="ident" id="1519817">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1519824">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1519827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1519830">top</span>&nbsp;<span class="op" id="1519834">:=</span>&nbsp;<span class="builtintype" id="1519837">uint8</span><span class="op" id="1519842">(</span><span class="ident" id="1519843">hash</span>&nbsp;<span class="op" id="1519848">&gt;&gt;</span>&nbsp;<span class="op" id="1519851">(</span><span class="ident" id="1519852">ptrSize</span><span class="op" id="1519859">*</span><span class="num" id="1519860">8</span>&nbsp;<span class="op" id="1519862">-</span>&nbsp;<span class="num" id="1519864">8</span><span class="op" id="1519865">)</span><span class="op" id="1519866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1519869">if</span>&nbsp;<span class="ident" id="1519872">top</span>&nbsp;<span class="op" id="1519876">&lt;</span>&nbsp;<span class="ident" id="1519878">minTopHash</span>&nbsp;<span class="op" id="1519889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1519893">top</span>&nbsp;<span class="op" id="1519897">+=</span>&nbsp;<span class="ident" id="1519900">minTopHash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1519912">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1519915">for</span>&nbsp;<span class="op" id="1519919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1519923">for</span>&nbsp;<span class="ident" id="1519927">i</span>&nbsp;<span class="op" id="1519929">:=</span>&nbsp;<span class="builtintype" id="1519932">uintptr</span><span class="op" id="1519939">(</span><span class="num" id="1519940">0</span><span class="op" id="1519941">)</span><span class="op" id="1519942">;</span>&nbsp;<span class="ident" id="1519944">i</span>&nbsp;<span class="op" id="1519946">&lt;</span>&nbsp;<span class="ident" id="1519948">bucketCnt</span><span class="op" id="1519957">;</span>&nbsp;<span class="ident" id="1519959">i</span><span class="op" id="1519960">++</span>&nbsp;<span class="op" id="1519963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1519968">x</span>&nbsp;<span class="op" id="1519970">:=</span>&nbsp;<span class="op" id="1519973">*</span><span class="op" id="1519974">(</span><span class="op" id="1519975">(</span><span class="op" id="1519976">*</span><span class="builtintype" id="1519977">uint8</span><span class="op" id="1519982">)</span><span class="op" id="1519983">(</span><span class="ident" id="1519984">add</span><span class="op" id="1519987">(</span><span class="ident" id="1519988">unsafe</span><span class="op" id="1519994">.</span><span class="ident" id="1519995">Pointer</span><span class="op" id="1520002">(</span><span class="ident" id="1520003">b</span><span class="op" id="1520004">)</span><span class="op" id="1520005">,</span>&nbsp;<span class="ident" id="1520007">i</span><span class="op" id="1520008">)</span><span class="op" id="1520009">)</span><span class="op" id="1520010">)</span>&nbsp;<span class="comment" id="1520012">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1520056">if</span>&nbsp;<span class="ident" id="1520059">x</span>&nbsp;<span class="op" id="1520061">!=</span>&nbsp;<span class="ident" id="1520064">top</span>&nbsp;<span class="op" id="1520068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1520074">continue</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1520086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1520091">k</span>&nbsp;<span class="op" id="1520093">:=</span>&nbsp;<span class="op" id="1520096">(</span><span class="op" id="1520097">*</span><span class="ident" id="1520098">stringStruct</span><span class="op" id="1520110">)</span><span class="op" id="1520111">(</span><span class="ident" id="1520112">add</span><span class="op" id="1520115">(</span><span class="ident" id="1520116">unsafe</span><span class="op" id="1520122">.</span><span class="ident" id="1520123">Pointer</span><span class="op" id="1520130">(</span><span class="ident" id="1520131">b</span><span class="op" id="1520132">)</span><span class="op" id="1520133">,</span>&nbsp;<span class="ident" id="1520135">dataOffset</span><span class="op" id="1520145">+</span><span class="ident" id="1520146">i</span><span class="op" id="1520147">*</span><span class="num" id="1520148">2</span><span class="op" id="1520149">*</span><span class="ident" id="1520150">ptrSize</span><span class="op" id="1520157">)</span><span class="op" id="1520158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1520163">if</span>&nbsp;<span class="ident" id="1520166">k</span><span class="op" id="1520167">.</span><span class="builtinfunc" id="1520168">len</span>&nbsp;<span class="op" id="1520172">!=</span>&nbsp;<span class="ident" id="1520175">key</span><span class="op" id="1520178">.</span><span class="builtinfunc" id="1520179">len</span>&nbsp;<span class="op" id="1520183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1520189">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1520201">}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1520206">if</span>&nbsp;<span class="ident" id="1520209">k</span><span class="op" id="1520210">.</span><span class="ident" id="1520211">str</span>&nbsp;<span class="op" id="1520215">==</span>&nbsp;<span class="ident" id="1520218">key</span><span class="op" id="1520221">.</span><span class="ident" id="1520222">str</span>&nbsp;<span class="op" id="1520226">||</span>&nbsp;<span class="ident" id="1520229">memeq</span><span class="op" id="1520234">(</span><span class="ident" id="1520235">k</span><span class="op" id="1520236">.</span><span class="ident" id="1520237">str</span><span class="op" id="1520240">,</span>&nbsp;<span class="ident" id="1520242">key</span><span class="op" id="1520245">.</span><span class="ident" id="1520246">str</span><span class="op" id="1520249">,</span>&nbsp;<span class="builtintype" id="1520251">uintptr</span><span class="op" id="1520258">(</span><span class="ident" id="1520259">key</span><span class="op" id="1520262">.</span><span class="builtinfunc" id="1520263">len</span><span class="op" id="1520266">)</span><span class="op" id="1520267">)</span>&nbsp;<span class="op" id="1520269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1520275">return</span>&nbsp;<span class="ident" id="1520282">add</span><span class="op" id="1520285">(</span><span class="ident" id="1520286">unsafe</span><span class="op" id="1520292">.</span><span class="ident" id="1520293">Pointer</span><span class="op" id="1520300">(</span><span class="ident" id="1520301">b</span><span class="op" id="1520302">)</span><span class="op" id="1520303">,</span>&nbsp;<span class="ident" id="1520305">dataOffset</span><span class="op" id="1520315">+</span><span class="ident" id="1520316">bucketCnt</span><span class="op" id="1520325">*</span><span class="num" id="1520326">2</span><span class="op" id="1520327">*</span><span class="ident" id="1520328">ptrSize</span><span class="op" id="1520335">+</span><span class="ident" id="1520336">i</span><span class="op" id="1520337">*</span><span class="builtintype" id="1520338">uintptr</span><span class="op" id="1520345">(</span><span class="ident" id="1520346">t</span><span class="op" id="1520347">.</span><span class="ident" id="1520348">valuesize</span><span class="op" id="1520357">)</span><span class="op" id="1520358">)</span><span class="op" id="1520359">,</span>&nbsp;<span class="builtintype" id="1520361">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1520369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1520373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1520377">b</span>&nbsp;<span class="op" id="1520379">=</span>&nbsp;<span class="ident" id="1520381">b</span><span class="op" id="1520382">.</span><span class="ident" id="1520383">overflow</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1520394">if</span>&nbsp;<span class="ident" id="1520397">b</span>&nbsp;<span class="op" id="1520399">==</span>&nbsp;<span class="ident" id="1520402">nil</span>&nbsp;<span class="op" id="1520406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1520411">return</span>&nbsp;<span class="ident" id="1520418">unsafe</span><span class="op" id="1520424">.</span><span class="ident" id="1520425">Pointer</span><span class="op" id="1520432">(</span><span class="ident" id="1520433">t</span><span class="op" id="1520434">.</span><span class="ident" id="1520435">elem</span><span class="op" id="1520439">.</span><span class="ident" id="1520440">zero</span><span class="op" id="1520444">)</span><span class="op" id="1520445">,</span>&nbsp;<span class="builtintype" id="1520447">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1520455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1520458">}</span><br>
<span class="lineno"></span><span class="op" id="1520460">}</span>
</div>
</body>
</html>
