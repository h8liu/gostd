<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html" class="current">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1709914">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1709969">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1710023">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1710074">package</span>&nbsp;<span class="ident" id="1710082">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1710091">import</span>&nbsp;<span class="op" id="1710098">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1710101">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1710110">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1710113">type</span>&nbsp;<span class="ident" id="1710118">sliceStruct</span>&nbsp;<span class="keyword" id="1710130">struct</span>&nbsp;<span class="op" id="1710137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1710140">array</span>&nbsp;<span class="ident" id="1710146">unsafe</span><span class="op" id="1710152">.</span><span class="ident" id="1710153">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1710162">len</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1710168">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1710173">cap</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1710179">int</span><br>
<span class="lineno">15</span><span class="op" id="1710183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1710186">//&nbsp;TODO:&nbsp;take&nbsp;uintptrs&nbsp;instead&nbsp;of&nbsp;int64s?</span><br>
<span class="lineno"></span><span class="keyword" id="1710228">func</span>&nbsp;<span class="ident" id="1710233">makeslice</span><span class="op" id="1710242">(</span><span class="ident" id="1710243">t</span>&nbsp;<span class="op" id="1710245">*</span><span class="ident" id="1710246">slicetype</span><span class="op" id="1710255">,</span>&nbsp;<span class="ident" id="1710257">len64</span>&nbsp;<span class="ident" id="1710263">int64</span><span class="op" id="1710268">,</span>&nbsp;<span class="ident" id="1710270">cap64</span>&nbsp;<span class="ident" id="1710276">int64</span><span class="op" id="1710281">)</span>&nbsp;<span class="ident" id="1710283">sliceStruct</span>&nbsp;<span class="op" id="1710295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1710298">//&nbsp;NOTE:&nbsp;The&nbsp;len&nbsp;&gt;&nbsp;MaxMem/elemsize&nbsp;check&nbsp;here&nbsp;is&nbsp;not&nbsp;strictly&nbsp;necessary,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1710372">//&nbsp;but&nbsp;it&nbsp;produces&nbsp;a&nbsp;&#39;len&nbsp;out&nbsp;of&nbsp;range&#39;&nbsp;error&nbsp;instead&nbsp;of&nbsp;a&nbsp;&#39;cap&nbsp;out&nbsp;of&nbsp;range&#39;&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1710457">//&nbsp;when&nbsp;someone&nbsp;does&nbsp;make([]T,&nbsp;bignumber).&nbsp;&#39;cap&nbsp;out&nbsp;of&nbsp;range&#39;&nbsp;is&nbsp;true&nbsp;too,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1710533">//&nbsp;but&nbsp;since&nbsp;the&nbsp;cap&nbsp;is&nbsp;only&nbsp;being&nbsp;supplied&nbsp;implicitly,&nbsp;saying&nbsp;len&nbsp;is&nbsp;clearer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1710613">//&nbsp;See&nbsp;issue&nbsp;4085.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1710633">len</span>&nbsp;<span class="op" id="1710637">:=</span>&nbsp;<span class="builtintype" id="1710640">int</span><span class="op" id="1710643">(</span><span class="ident" id="1710644">len64</span><span class="op" id="1710649">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1710652">if</span>&nbsp;<span class="ident" id="1710655">len64</span>&nbsp;<span class="op" id="1710661">&lt;</span>&nbsp;<span class="num" id="1710663">0</span>&nbsp;<span class="op" id="1710665">||</span>&nbsp;<span class="ident" id="1710668">int64</span><span class="op" id="1710673">(</span><span class="builtinfunc" id="1710674">len</span><span class="op" id="1710677">)</span>&nbsp;<span class="op" id="1710679">!=</span>&nbsp;<span class="ident" id="1710682">len64</span>&nbsp;<span class="op" id="1710688">||</span>&nbsp;<span class="ident" id="1710691">t</span><span class="op" id="1710692">.</span><span class="ident" id="1710693">elem</span><span class="op" id="1710697">.</span><span class="ident" id="1710698">size</span>&nbsp;<span class="op" id="1710703">&gt;</span>&nbsp;<span class="num" id="1710705">0</span>&nbsp;<span class="op" id="1710707">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1710710">uintptr</span><span class="op" id="1710717">(</span><span class="builtinfunc" id="1710718">len</span><span class="op" id="1710721">)</span>&nbsp;<span class="op" id="1710723">&gt;</span>&nbsp;<span class="ident" id="1710725">maxmem</span><span class="op" id="1710731">/</span><span class="builtintype" id="1710732">uintptr</span><span class="op" id="1710739">(</span><span class="ident" id="1710740">t</span><span class="op" id="1710741">.</span><span class="ident" id="1710742">elem</span><span class="op" id="1710746">.</span><span class="ident" id="1710747">size</span><span class="op" id="1710751">)</span>&nbsp;<span class="op" id="1710753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1710757">panic</span><span class="op" id="1710762">(</span><span class="ident" id="1710763">errorString</span><span class="op" id="1710774">(</span><span class="string" id="1710775">&#34;makeslice:&nbsp;len&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1710804">)</span><span class="op" id="1710805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1710808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1710811">cap</span>&nbsp;<span class="op" id="1710815">:=</span>&nbsp;<span class="builtintype" id="1710818">int</span><span class="op" id="1710821">(</span><span class="ident" id="1710822">cap64</span><span class="op" id="1710827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1710830">if</span>&nbsp;<span class="builtinfunc" id="1710833">cap</span>&nbsp;<span class="op" id="1710837">&lt;</span>&nbsp;<span class="builtinfunc" id="1710839">len</span>&nbsp;<span class="op" id="1710843">||</span>&nbsp;<span class="ident" id="1710846">int64</span><span class="op" id="1710851">(</span><span class="builtinfunc" id="1710852">cap</span><span class="op" id="1710855">)</span>&nbsp;<span class="op" id="1710857">!=</span>&nbsp;<span class="ident" id="1710860">cap64</span>&nbsp;<span class="op" id="1710866">||</span>&nbsp;<span class="ident" id="1710869">t</span><span class="op" id="1710870">.</span><span class="ident" id="1710871">elem</span><span class="op" id="1710875">.</span><span class="ident" id="1710876">size</span>&nbsp;<span class="op" id="1710881">&gt;</span>&nbsp;<span class="num" id="1710883">0</span>&nbsp;<span class="op" id="1710885">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1710888">uintptr</span><span class="op" id="1710895">(</span><span class="builtinfunc" id="1710896">cap</span><span class="op" id="1710899">)</span>&nbsp;<span class="op" id="1710901">&gt;</span>&nbsp;<span class="ident" id="1710903">maxmem</span><span class="op" id="1710909">/</span><span class="builtintype" id="1710910">uintptr</span><span class="op" id="1710917">(</span><span class="ident" id="1710918">t</span><span class="op" id="1710919">.</span><span class="ident" id="1710920">elem</span><span class="op" id="1710924">.</span><span class="ident" id="1710925">size</span><span class="op" id="1710929">)</span>&nbsp;<span class="op" id="1710931">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1710935">panic</span><span class="op" id="1710940">(</span><span class="ident" id="1710941">errorString</span><span class="op" id="1710952">(</span><span class="string" id="1710953">&#34;makeslice:&nbsp;cap&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1710982">)</span><span class="op" id="1710983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1710986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1710989">p</span>&nbsp;<span class="op" id="1710991">:=</span>&nbsp;<span class="ident" id="1710994">newarray</span><span class="op" id="1711002">(</span><span class="ident" id="1711003">t</span><span class="op" id="1711004">.</span><span class="ident" id="1711005">elem</span><span class="op" id="1711009">,</span>&nbsp;<span class="builtintype" id="1711011">uintptr</span><span class="op" id="1711018">(</span><span class="builtinfunc" id="1711019">cap</span><span class="op" id="1711022">)</span><span class="op" id="1711023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1711026">return</span>&nbsp;<span class="ident" id="1711033">sliceStruct</span><span class="op" id="1711044">{</span><span class="ident" id="1711045">p</span><span class="op" id="1711046">,</span>&nbsp;<span class="builtinfunc" id="1711048">len</span><span class="op" id="1711051">,</span>&nbsp;<span class="builtinfunc" id="1711053">cap</span><span class="op" id="1711056">}</span><br>
<span class="lineno"></span><span class="op" id="1711058">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="1711061">//&nbsp;TODO:&nbsp;take&nbsp;uintptr&nbsp;instead&nbsp;of&nbsp;int64?</span><br>
<span class="lineno"></span><span class="keyword" id="1711101">func</span>&nbsp;<span class="ident" id="1711106">growslice</span><span class="op" id="1711115">(</span><span class="ident" id="1711116">t</span>&nbsp;<span class="op" id="1711118">*</span><span class="ident" id="1711119">slicetype</span><span class="op" id="1711128">,</span>&nbsp;<span class="ident" id="1711130">old</span>&nbsp;<span class="ident" id="1711134">sliceStruct</span><span class="op" id="1711145">,</span>&nbsp;<span class="ident" id="1711147">n</span>&nbsp;<span class="ident" id="1711149">int64</span><span class="op" id="1711154">)</span>&nbsp;<span class="ident" id="1711156">sliceStruct</span>&nbsp;<span class="op" id="1711168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1711171">if</span>&nbsp;<span class="ident" id="1711174">n</span>&nbsp;<span class="op" id="1711176">&lt;</span>&nbsp;<span class="num" id="1711178">1</span>&nbsp;<span class="op" id="1711180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1711184">panic</span><span class="op" id="1711189">(</span><span class="ident" id="1711190">errorString</span><span class="op" id="1711201">(</span><span class="string" id="1711202">&#34;growslice:&nbsp;invalid&nbsp;n&#34;</span><span class="op" id="1711224">)</span><span class="op" id="1711225">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1711228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1711232">cap64</span>&nbsp;<span class="op" id="1711238">:=</span>&nbsp;<span class="ident" id="1711241">int64</span><span class="op" id="1711246">(</span><span class="ident" id="1711247">old</span><span class="op" id="1711250">.</span><span class="builtinfunc" id="1711251">cap</span><span class="op" id="1711254">)</span>&nbsp;<span class="op" id="1711256">+</span>&nbsp;<span class="ident" id="1711258">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1711261">cap</span>&nbsp;<span class="op" id="1711265">:=</span>&nbsp;<span class="builtintype" id="1711268">int</span><span class="op" id="1711271">(</span><span class="ident" id="1711272">cap64</span><span class="op" id="1711277">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1711281">if</span>&nbsp;<span class="ident" id="1711284">int64</span><span class="op" id="1711289">(</span><span class="builtinfunc" id="1711290">cap</span><span class="op" id="1711293">)</span>&nbsp;<span class="op" id="1711295">!=</span>&nbsp;<span class="ident" id="1711298">cap64</span>&nbsp;<span class="op" id="1711304">||</span>&nbsp;<span class="builtinfunc" id="1711307">cap</span>&nbsp;<span class="op" id="1711311">&lt;</span>&nbsp;<span class="ident" id="1711313">old</span><span class="op" id="1711316">.</span><span class="builtinfunc" id="1711317">cap</span>&nbsp;<span class="op" id="1711321">||</span>&nbsp;<span class="ident" id="1711324">t</span><span class="op" id="1711325">.</span><span class="ident" id="1711326">elem</span><span class="op" id="1711330">.</span><span class="ident" id="1711331">size</span>&nbsp;<span class="op" id="1711336">&gt;</span>&nbsp;<span class="num" id="1711338">0</span>&nbsp;<span class="op" id="1711340">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1711343">uintptr</span><span class="op" id="1711350">(</span><span class="builtinfunc" id="1711351">cap</span><span class="op" id="1711354">)</span>&nbsp;<span class="op" id="1711356">&gt;</span>&nbsp;<span class="ident" id="1711358">maxmem</span><span class="op" id="1711364">/</span><span class="builtintype" id="1711365">uintptr</span><span class="op" id="1711372">(</span><span class="ident" id="1711373">t</span><span class="op" id="1711374">.</span><span class="ident" id="1711375">elem</span><span class="op" id="1711379">.</span><span class="ident" id="1711380">size</span><span class="op" id="1711384">)</span>&nbsp;<span class="op" id="1711386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1711390">panic</span><span class="op" id="1711395">(</span><span class="ident" id="1711396">errorString</span><span class="op" id="1711407">(</span><span class="string" id="1711408">&#34;growslice:&nbsp;cap&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1711437">)</span><span class="op" id="1711438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1711441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1711445">if</span>&nbsp;<span class="ident" id="1711448">raceenabled</span>&nbsp;<span class="op" id="1711460">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1711464">callerpc</span>&nbsp;<span class="op" id="1711473">:=</span>&nbsp;<span class="ident" id="1711476">getcallerpc</span><span class="op" id="1711487">(</span><span class="ident" id="1711488">unsafe</span><span class="op" id="1711494">.</span><span class="ident" id="1711495">Pointer</span><span class="op" id="1711502">(</span><span class="op" id="1711503">&amp;</span><span class="ident" id="1711504">t</span><span class="op" id="1711505">)</span><span class="op" id="1711506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1711510">racereadrangepc</span><span class="op" id="1711525">(</span><span class="ident" id="1711526">old</span><span class="op" id="1711529">.</span><span class="ident" id="1711530">array</span><span class="op" id="1711535">,</span>&nbsp;<span class="builtintype" id="1711537">uintptr</span><span class="op" id="1711544">(</span><span class="ident" id="1711545">old</span><span class="op" id="1711548">.</span><span class="builtinfunc" id="1711549">len</span><span class="op" id="1711552">*</span><span class="builtintype" id="1711553">int</span><span class="op" id="1711556">(</span><span class="ident" id="1711557">t</span><span class="op" id="1711558">.</span><span class="ident" id="1711559">elem</span><span class="op" id="1711563">.</span><span class="ident" id="1711564">size</span><span class="op" id="1711568">)</span><span class="op" id="1711569">)</span><span class="op" id="1711570">,</span>&nbsp;<span class="ident" id="1711572">callerpc</span><span class="op" id="1711580">,</span>&nbsp;<span class="ident" id="1711582">funcPC</span><span class="op" id="1711588">(</span><span class="ident" id="1711589">growslice</span><span class="op" id="1711598">)</span><span class="op" id="1711599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1711602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1711606">et</span>&nbsp;<span class="op" id="1711609">:=</span>&nbsp;<span class="ident" id="1711612">t</span><span class="op" id="1711613">.</span><span class="ident" id="1711614">elem</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1711620">if</span>&nbsp;<span class="ident" id="1711623">et</span><span class="op" id="1711625">.</span><span class="ident" id="1711626">size</span>&nbsp;<span class="op" id="1711631">==</span>&nbsp;<span class="num" id="1711634">0</span>&nbsp;<span class="op" id="1711636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1711640">return</span>&nbsp;<span class="ident" id="1711647">sliceStruct</span><span class="op" id="1711658">{</span><span class="ident" id="1711659">old</span><span class="op" id="1711662">.</span><span class="ident" id="1711663">array</span><span class="op" id="1711668">,</span>&nbsp;<span class="ident" id="1711670">old</span><span class="op" id="1711673">.</span><span class="builtinfunc" id="1711674">len</span><span class="op" id="1711677">,</span>&nbsp;<span class="builtinfunc" id="1711679">cap</span><span class="op" id="1711682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1711685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1711689">newcap</span>&nbsp;<span class="op" id="1711696">:=</span>&nbsp;<span class="ident" id="1711699">old</span><span class="op" id="1711702">.</span><span class="builtinfunc" id="1711703">cap</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1711708">if</span>&nbsp;<span class="ident" id="1711711">newcap</span><span class="op" id="1711717">+</span><span class="ident" id="1711718">newcap</span>&nbsp;<span class="op" id="1711725">&lt;</span>&nbsp;<span class="builtinfunc" id="1711727">cap</span>&nbsp;<span class="op" id="1711731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1711735">newcap</span>&nbsp;<span class="op" id="1711742">=</span>&nbsp;<span class="builtinfunc" id="1711744">cap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1711749">}</span>&nbsp;<span class="keyword" id="1711751">else</span>&nbsp;<span class="op" id="1711756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1711760">for</span>&nbsp;<span class="op" id="1711764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1711769">if</span>&nbsp;<span class="ident" id="1711772">old</span><span class="op" id="1711775">.</span><span class="builtinfunc" id="1711776">len</span>&nbsp;<span class="op" id="1711780">&lt;</span>&nbsp;<span class="num" id="1711782">1024</span>&nbsp;<span class="op" id="1711787">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1711793">newcap</span>&nbsp;<span class="op" id="1711800">+=</span>&nbsp;<span class="ident" id="1711803">newcap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1711813">}</span>&nbsp;<span class="keyword" id="1711815">else</span>&nbsp;<span class="op" id="1711820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1711826">newcap</span>&nbsp;<span class="op" id="1711833">+=</span>&nbsp;<span class="ident" id="1711836">newcap</span>&nbsp;<span class="op" id="1711843">/</span>&nbsp;<span class="num" id="1711845">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1711850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1711855">if</span>&nbsp;<span class="ident" id="1711858">newcap</span>&nbsp;<span class="op" id="1711865">&gt;=</span>&nbsp;<span class="builtinfunc" id="1711868">cap</span>&nbsp;<span class="op" id="1711872">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1711878">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1711887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1711891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1711894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1711898">if</span>&nbsp;<span class="builtintype" id="1711901">uintptr</span><span class="op" id="1711908">(</span><span class="ident" id="1711909">newcap</span><span class="op" id="1711915">)</span>&nbsp;<span class="op" id="1711917">&gt;=</span>&nbsp;<span class="ident" id="1711920">maxmem</span><span class="op" id="1711926">/</span><span class="builtintype" id="1711927">uintptr</span><span class="op" id="1711934">(</span><span class="ident" id="1711935">et</span><span class="op" id="1711937">.</span><span class="ident" id="1711938">size</span><span class="op" id="1711942">)</span>&nbsp;<span class="op" id="1711944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1711948">panic</span><span class="op" id="1711953">(</span><span class="ident" id="1711954">errorString</span><span class="op" id="1711965">(</span><span class="string" id="1711966">&#34;growslice:&nbsp;cap&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1711995">)</span><span class="op" id="1711996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1711999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1712002">lenmem</span>&nbsp;<span class="op" id="1712009">:=</span>&nbsp;<span class="builtintype" id="1712012">uintptr</span><span class="op" id="1712019">(</span><span class="ident" id="1712020">old</span><span class="op" id="1712023">.</span><span class="builtinfunc" id="1712024">len</span><span class="op" id="1712027">)</span>&nbsp;<span class="op" id="1712029">*</span>&nbsp;<span class="builtintype" id="1712031">uintptr</span><span class="op" id="1712038">(</span><span class="ident" id="1712039">et</span><span class="op" id="1712041">.</span><span class="ident" id="1712042">size</span><span class="op" id="1712046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1712049">capmem</span>&nbsp;<span class="op" id="1712056">:=</span>&nbsp;<span class="ident" id="1712059">goroundupsize</span><span class="op" id="1712072">(</span><span class="builtintype" id="1712073">uintptr</span><span class="op" id="1712080">(</span><span class="ident" id="1712081">newcap</span><span class="op" id="1712087">)</span>&nbsp;<span class="op" id="1712089">*</span>&nbsp;<span class="builtintype" id="1712091">uintptr</span><span class="op" id="1712098">(</span><span class="ident" id="1712099">et</span><span class="op" id="1712101">.</span><span class="ident" id="1712102">size</span><span class="op" id="1712106">)</span><span class="op" id="1712107">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1712110">newcap</span>&nbsp;<span class="op" id="1712117">=</span>&nbsp;<span class="builtintype" id="1712119">int</span><span class="op" id="1712122">(</span><span class="ident" id="1712123">capmem</span>&nbsp;<span class="op" id="1712130">/</span>&nbsp;<span class="builtintype" id="1712132">uintptr</span><span class="op" id="1712139">(</span><span class="ident" id="1712140">et</span><span class="op" id="1712142">.</span><span class="ident" id="1712143">size</span><span class="op" id="1712147">)</span><span class="op" id="1712148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1712151">var</span>&nbsp;<span class="ident" id="1712155">p</span>&nbsp;<span class="ident" id="1712157">unsafe</span><span class="op" id="1712163">.</span><span class="ident" id="1712164">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1712173">if</span>&nbsp;<span class="ident" id="1712176">et</span><span class="op" id="1712178">.</span><span class="ident" id="1712179">kind</span><span class="op" id="1712183">&amp;</span><span class="ident" id="1712184">kindNoPointers</span>&nbsp;<span class="op" id="1712199">!=</span>&nbsp;<span class="num" id="1712202">0</span>&nbsp;<span class="op" id="1712204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1712208">p</span>&nbsp;<span class="op" id="1712210">=</span>&nbsp;<span class="ident" id="1712212">rawmem</span><span class="op" id="1712218">(</span><span class="ident" id="1712219">capmem</span><span class="op" id="1712225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1712229">memclr</span><span class="op" id="1712235">(</span><span class="ident" id="1712236">add</span><span class="op" id="1712239">(</span><span class="ident" id="1712240">p</span><span class="op" id="1712241">,</span>&nbsp;<span class="ident" id="1712243">lenmem</span><span class="op" id="1712249">)</span><span class="op" id="1712250">,</span>&nbsp;<span class="ident" id="1712252">capmem</span><span class="op" id="1712258">-</span><span class="ident" id="1712259">lenmem</span><span class="op" id="1712265">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1712268">}</span>&nbsp;<span class="keyword" id="1712270">else</span>&nbsp;<span class="op" id="1712275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1712279">//&nbsp;Note:&nbsp;can&#39;t&nbsp;use&nbsp;rawmem&nbsp;(which&nbsp;avoids&nbsp;zeroing&nbsp;of&nbsp;memory),&nbsp;because&nbsp;then&nbsp;GC&nbsp;can&nbsp;scan&nbsp;unitialized&nbsp;memory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1712385">p</span>&nbsp;<span class="op" id="1712387">=</span>&nbsp;<span class="ident" id="1712389">newarray</span><span class="op" id="1712397">(</span><span class="ident" id="1712398">et</span><span class="op" id="1712400">,</span>&nbsp;<span class="builtintype" id="1712402">uintptr</span><span class="op" id="1712409">(</span><span class="ident" id="1712410">newcap</span><span class="op" id="1712416">)</span><span class="op" id="1712417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1712420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1712423">memmove</span><span class="op" id="1712430">(</span><span class="ident" id="1712431">p</span><span class="op" id="1712432">,</span>&nbsp;<span class="ident" id="1712434">old</span><span class="op" id="1712437">.</span><span class="ident" id="1712438">array</span><span class="op" id="1712443">,</span>&nbsp;<span class="ident" id="1712445">lenmem</span><span class="op" id="1712451">)</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1712455">return</span>&nbsp;<span class="ident" id="1712462">sliceStruct</span><span class="op" id="1712473">{</span><span class="ident" id="1712474">p</span><span class="op" id="1712475">,</span>&nbsp;<span class="ident" id="1712477">old</span><span class="op" id="1712480">.</span><span class="builtinfunc" id="1712481">len</span><span class="op" id="1712484">,</span>&nbsp;<span class="ident" id="1712486">newcap</span><span class="op" id="1712492">}</span><br>
<span class="lineno"></span><span class="op" id="1712494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1712497">func</span>&nbsp;<span class="ident" id="1712502">slicecopy</span><span class="op" id="1712511">(</span><span class="ident" id="1712512">to</span>&nbsp;<span class="ident" id="1712515">sliceStruct</span><span class="op" id="1712526">,</span>&nbsp;<span class="ident" id="1712528">fm</span>&nbsp;<span class="ident" id="1712531">sliceStruct</span><span class="op" id="1712542">,</span>&nbsp;<span class="ident" id="1712544">width</span>&nbsp;<span class="builtintype" id="1712550">uintptr</span><span class="op" id="1712557">)</span>&nbsp;<span class="builtintype" id="1712559">int</span>&nbsp;<span class="op" id="1712563">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1712566">if</span>&nbsp;<span class="ident" id="1712569">fm</span><span class="op" id="1712571">.</span><span class="builtinfunc" id="1712572">len</span>&nbsp;<span class="op" id="1712576">==</span>&nbsp;<span class="num" id="1712579">0</span>&nbsp;<span class="op" id="1712581">||</span>&nbsp;<span class="ident" id="1712584">to</span><span class="op" id="1712586">.</span><span class="builtinfunc" id="1712587">len</span>&nbsp;<span class="op" id="1712591">==</span>&nbsp;<span class="num" id="1712594">0</span>&nbsp;<span class="op" id="1712596">||</span>&nbsp;<span class="ident" id="1712599">width</span>&nbsp;<span class="op" id="1712605">==</span>&nbsp;<span class="num" id="1712608">0</span>&nbsp;<span class="op" id="1712610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1712614">return</span>&nbsp;<span class="num" id="1712621">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1712624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1712628">n</span>&nbsp;<span class="op" id="1712630">:=</span>&nbsp;<span class="ident" id="1712633">fm</span><span class="op" id="1712635">.</span><span class="builtinfunc" id="1712636">len</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1712641">if</span>&nbsp;<span class="ident" id="1712644">to</span><span class="op" id="1712646">.</span><span class="builtinfunc" id="1712647">len</span>&nbsp;<span class="op" id="1712651">&lt;</span>&nbsp;<span class="ident" id="1712653">n</span>&nbsp;<span class="op" id="1712655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1712659">n</span>&nbsp;<span class="op" id="1712661">=</span>&nbsp;<span class="ident" id="1712663">to</span><span class="op" id="1712665">.</span><span class="builtinfunc" id="1712666">len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1712671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1712675">if</span>&nbsp;<span class="ident" id="1712678">raceenabled</span>&nbsp;<span class="op" id="1712690">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1712694">callerpc</span>&nbsp;<span class="op" id="1712703">:=</span>&nbsp;<span class="ident" id="1712706">getcallerpc</span><span class="op" id="1712717">(</span><span class="ident" id="1712718">unsafe</span><span class="op" id="1712724">.</span><span class="ident" id="1712725">Pointer</span><span class="op" id="1712732">(</span><span class="op" id="1712733">&amp;</span><span class="ident" id="1712734">to</span><span class="op" id="1712736">)</span><span class="op" id="1712737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1712741">pc</span>&nbsp;<span class="op" id="1712744">:=</span>&nbsp;<span class="ident" id="1712747">funcPC</span><span class="op" id="1712753">(</span><span class="ident" id="1712754">slicecopy</span><span class="op" id="1712763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1712767">racewriterangepc</span><span class="op" id="1712783">(</span><span class="ident" id="1712784">to</span><span class="op" id="1712786">.</span><span class="ident" id="1712787">array</span><span class="op" id="1712792">,</span>&nbsp;<span class="builtintype" id="1712794">uintptr</span><span class="op" id="1712801">(</span><span class="ident" id="1712802">n</span><span class="op" id="1712803">*</span><span class="builtintype" id="1712804">int</span><span class="op" id="1712807">(</span><span class="ident" id="1712808">width</span><span class="op" id="1712813">)</span><span class="op" id="1712814">)</span><span class="op" id="1712815">,</span>&nbsp;<span class="ident" id="1712817">callerpc</span><span class="op" id="1712825">,</span>&nbsp;<span class="ident" id="1712827">pc</span><span class="op" id="1712829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1712833">racereadrangepc</span><span class="op" id="1712848">(</span><span class="ident" id="1712849">fm</span><span class="op" id="1712851">.</span><span class="ident" id="1712852">array</span><span class="op" id="1712857">,</span>&nbsp;<span class="builtintype" id="1712859">uintptr</span><span class="op" id="1712866">(</span><span class="ident" id="1712867">n</span><span class="op" id="1712868">*</span><span class="builtintype" id="1712869">int</span><span class="op" id="1712872">(</span><span class="ident" id="1712873">width</span><span class="op" id="1712878">)</span><span class="op" id="1712879">)</span><span class="op" id="1712880">,</span>&nbsp;<span class="ident" id="1712882">callerpc</span><span class="op" id="1712890">,</span>&nbsp;<span class="ident" id="1712892">pc</span><span class="op" id="1712894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1712897">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1712901">size</span>&nbsp;<span class="op" id="1712906">:=</span>&nbsp;<span class="builtintype" id="1712909">uintptr</span><span class="op" id="1712916">(</span><span class="ident" id="1712917">n</span><span class="op" id="1712918">)</span>&nbsp;<span class="op" id="1712920">*</span>&nbsp;<span class="ident" id="1712922">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1712929">if</span>&nbsp;<span class="ident" id="1712932">size</span>&nbsp;<span class="op" id="1712937">==</span>&nbsp;<span class="num" id="1712940">1</span>&nbsp;<span class="op" id="1712942">{</span>&nbsp;<span class="comment" id="1712944">//&nbsp;common&nbsp;case&nbsp;worth&nbsp;about&nbsp;2x&nbsp;to&nbsp;do&nbsp;here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1712987">//&nbsp;TODO:&nbsp;is&nbsp;this&nbsp;still&nbsp;worth&nbsp;it&nbsp;with&nbsp;new&nbsp;memmove&nbsp;impl?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1713044">*</span><span class="op" id="1713045">(</span><span class="op" id="1713046">*</span><span class="builtintype" id="1713047">byte</span><span class="op" id="1713051">)</span><span class="op" id="1713052">(</span><span class="ident" id="1713053">to</span><span class="op" id="1713055">.</span><span class="ident" id="1713056">array</span><span class="op" id="1713061">)</span>&nbsp;<span class="op" id="1713063">=</span>&nbsp;<span class="op" id="1713065">*</span><span class="op" id="1713066">(</span><span class="op" id="1713067">*</span><span class="builtintype" id="1713068">byte</span><span class="op" id="1713072">)</span><span class="op" id="1713073">(</span><span class="ident" id="1713074">fm</span><span class="op" id="1713076">.</span><span class="ident" id="1713077">array</span><span class="op" id="1713082">)</span>&nbsp;<span class="comment" id="1713084">//&nbsp;known&nbsp;to&nbsp;be&nbsp;a&nbsp;byte&nbsp;pointer</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1713115">}</span>&nbsp;<span class="keyword" id="1713117">else</span>&nbsp;<span class="op" id="1713122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1713126">memmove</span><span class="op" id="1713133">(</span><span class="ident" id="1713134">to</span><span class="op" id="1713136">.</span><span class="ident" id="1713137">array</span><span class="op" id="1713142">,</span>&nbsp;<span class="ident" id="1713144">fm</span><span class="op" id="1713146">.</span><span class="ident" id="1713147">array</span><span class="op" id="1713152">,</span>&nbsp;<span class="ident" id="1713154">size</span><span class="op" id="1713158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1713161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1713164">return</span>&nbsp;<span class="builtintype" id="1713171">int</span><span class="op" id="1713174">(</span><span class="ident" id="1713175">n</span><span class="op" id="1713176">)</span><br>
<span class="lineno"></span><span class="op" id="1713178">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="1713181">func</span>&nbsp;<span class="ident" id="1713186">slicestringcopy</span><span class="op" id="1713201">(</span><span class="ident" id="1713202">to</span>&nbsp;<span class="op" id="1713205">[</span><span class="op" id="1713206">]</span><span class="builtintype" id="1713207">byte</span><span class="op" id="1713211">,</span>&nbsp;<span class="ident" id="1713213">fm</span>&nbsp;<span class="builtintype" id="1713216">string</span><span class="op" id="1713222">)</span>&nbsp;<span class="builtintype" id="1713224">int</span>&nbsp;<span class="op" id="1713228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1713231">if</span>&nbsp;<span class="builtinfunc" id="1713234">len</span><span class="op" id="1713237">(</span><span class="ident" id="1713238">fm</span><span class="op" id="1713240">)</span>&nbsp;<span class="op" id="1713242">==</span>&nbsp;<span class="num" id="1713245">0</span>&nbsp;<span class="op" id="1713247">||</span>&nbsp;<span class="builtinfunc" id="1713250">len</span><span class="op" id="1713253">(</span><span class="ident" id="1713254">to</span><span class="op" id="1713256">)</span>&nbsp;<span class="op" id="1713258">==</span>&nbsp;<span class="num" id="1713261">0</span>&nbsp;<span class="op" id="1713263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1713267">return</span>&nbsp;<span class="num" id="1713274">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1713277">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1713281">n</span>&nbsp;<span class="op" id="1713283">:=</span>&nbsp;<span class="builtinfunc" id="1713286">len</span><span class="op" id="1713289">(</span><span class="ident" id="1713290">fm</span><span class="op" id="1713292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1713295">if</span>&nbsp;<span class="builtinfunc" id="1713298">len</span><span class="op" id="1713301">(</span><span class="ident" id="1713302">to</span><span class="op" id="1713304">)</span>&nbsp;<span class="op" id="1713306">&lt;</span>&nbsp;<span class="ident" id="1713308">n</span>&nbsp;<span class="op" id="1713310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1713314">n</span>&nbsp;<span class="op" id="1713316">=</span>&nbsp;<span class="builtinfunc" id="1713318">len</span><span class="op" id="1713321">(</span><span class="ident" id="1713322">to</span><span class="op" id="1713324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1713327">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1713331">if</span>&nbsp;<span class="ident" id="1713334">raceenabled</span>&nbsp;<span class="op" id="1713346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1713350">callerpc</span>&nbsp;<span class="op" id="1713359">:=</span>&nbsp;<span class="ident" id="1713362">getcallerpc</span><span class="op" id="1713373">(</span><span class="ident" id="1713374">unsafe</span><span class="op" id="1713380">.</span><span class="ident" id="1713381">Pointer</span><span class="op" id="1713388">(</span><span class="op" id="1713389">&amp;</span><span class="ident" id="1713390">to</span><span class="op" id="1713392">)</span><span class="op" id="1713393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1713397">pc</span>&nbsp;<span class="op" id="1713400">:=</span>&nbsp;<span class="ident" id="1713403">funcPC</span><span class="op" id="1713409">(</span><span class="ident" id="1713410">slicestringcopy</span><span class="op" id="1713425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1713429">racewriterangepc</span><span class="op" id="1713445">(</span><span class="ident" id="1713446">unsafe</span><span class="op" id="1713452">.</span><span class="ident" id="1713453">Pointer</span><span class="op" id="1713460">(</span><span class="op" id="1713461">&amp;</span><span class="ident" id="1713462">to</span><span class="op" id="1713464">[</span><span class="num" id="1713465">0</span><span class="op" id="1713466">]</span><span class="op" id="1713467">)</span><span class="op" id="1713468">,</span>&nbsp;<span class="builtintype" id="1713470">uintptr</span><span class="op" id="1713477">(</span><span class="ident" id="1713478">n</span><span class="op" id="1713479">)</span><span class="op" id="1713480">,</span>&nbsp;<span class="ident" id="1713482">callerpc</span><span class="op" id="1713490">,</span>&nbsp;<span class="ident" id="1713492">pc</span><span class="op" id="1713494">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1713497">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1713501">memmove</span><span class="op" id="1713508">(</span><span class="ident" id="1713509">unsafe</span><span class="op" id="1713515">.</span><span class="ident" id="1713516">Pointer</span><span class="op" id="1713523">(</span><span class="op" id="1713524">&amp;</span><span class="ident" id="1713525">to</span><span class="op" id="1713527">[</span><span class="num" id="1713528">0</span><span class="op" id="1713529">]</span><span class="op" id="1713530">)</span><span class="op" id="1713531">,</span>&nbsp;<span class="ident" id="1713533">unsafe</span><span class="op" id="1713539">.</span><span class="ident" id="1713540">Pointer</span><span class="op" id="1713547">(</span><span class="op" id="1713548">(</span><span class="op" id="1713549">*</span><span class="ident" id="1713550">stringStruct</span><span class="op" id="1713562">)</span><span class="op" id="1713563">(</span><span class="ident" id="1713564">unsafe</span><span class="op" id="1713570">.</span><span class="ident" id="1713571">Pointer</span><span class="op" id="1713578">(</span><span class="op" id="1713579">&amp;</span><span class="ident" id="1713580">fm</span><span class="op" id="1713582">)</span><span class="op" id="1713583">)</span><span class="op" id="1713584">.</span><span class="ident" id="1713585">str</span><span class="op" id="1713588">)</span><span class="op" id="1713589">,</span>&nbsp;<span class="builtintype" id="1713591">uintptr</span><span class="op" id="1713598">(</span><span class="ident" id="1713599">n</span><span class="op" id="1713600">)</span><span class="op" id="1713601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1713604">return</span>&nbsp;<span class="ident" id="1713611">n</span><br>
<span class="lineno"></span><span class="op" id="1713613">}</span>
</div>
</body>
</html>
