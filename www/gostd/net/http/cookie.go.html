<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3360419">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3360474">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3360528">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3360579">package</span>&nbsp;<span class="ident" id="3360587">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3360593">import</span>&nbsp;<span class="op" id="3360600">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3360603">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3360612">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3360619">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3360626">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3360633">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3360644">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3360655">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3360662">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3360665">//&nbsp;This&nbsp;implementation&nbsp;is&nbsp;done&nbsp;according&nbsp;to&nbsp;RFC&nbsp;6265:</span><br>
<span class="lineno"></span><span class="comment" id="3360719">//</span><br>
<span class="lineno"></span><span class="comment" id="3360722">//&nbsp;&nbsp;&nbsp;&nbsp;http://tools.ietf.org/html/rfc6265</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="3360764">//&nbsp;A&nbsp;Cookie&nbsp;represents&nbsp;an&nbsp;HTTP&nbsp;cookie&nbsp;as&nbsp;sent&nbsp;in&nbsp;the&nbsp;Set-Cookie&nbsp;header&nbsp;of&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="3360841">//&nbsp;HTTP&nbsp;response&nbsp;or&nbsp;the&nbsp;Cookie&nbsp;header&nbsp;of&nbsp;an&nbsp;HTTP&nbsp;request.</span><br>
<span class="lineno"></span><span class="keyword" id="3360899">type</span>&nbsp;<span class="ident" id="3360904">Cookie</span>&nbsp;<span class="keyword" id="3360911">struct</span>&nbsp;<span class="op" id="3360918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3360921">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3360932">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3360940">Value</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3360951">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3360959">Path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3360970">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3360978">Domain</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3360989">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3360997">Expires</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3361008">time</span><span class="op" id="3361012">.</span><span class="ident" id="3361013">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361019">RawExpires</span>&nbsp;<span class="builtintype" id="3361030">string</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3361039">//&nbsp;MaxAge=0&nbsp;means&nbsp;no&nbsp;&#39;Max-Age&#39;&nbsp;attribute&nbsp;specified.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3361092">//&nbsp;MaxAge&lt;0&nbsp;means&nbsp;delete&nbsp;cookie&nbsp;now,&nbsp;equivalently&nbsp;&#39;Max-Age:&nbsp;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3361156">//&nbsp;MaxAge&gt;0&nbsp;means&nbsp;Max-Age&nbsp;attribute&nbsp;present&nbsp;and&nbsp;given&nbsp;in&nbsp;seconds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361222">MaxAge</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3361231">int</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361236">Secure</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3361245">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361251">HttpOnly</span>&nbsp;<span class="builtintype" id="3361260">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361266">Raw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3361275">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361283">Unparsed</span>&nbsp;<span class="op" id="3361292">[</span><span class="op" id="3361293">]</span><span class="builtintype" id="3361294">string</span>&nbsp;<span class="comment" id="3361301">//&nbsp;Raw&nbsp;text&nbsp;of&nbsp;unparsed&nbsp;attribute-value&nbsp;pairs</span><br>
<span class="lineno"></span><span class="op" id="3361347">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="3361350">//&nbsp;readSetCookies&nbsp;parses&nbsp;all&nbsp;&#34;Set-Cookie&#34;&nbsp;values&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="3361404">//&nbsp;the&nbsp;header&nbsp;h&nbsp;and&nbsp;returns&nbsp;the&nbsp;successfully&nbsp;parsed&nbsp;Cookies.</span><br>
<span class="lineno"></span><span class="keyword" id="3361465">func</span>&nbsp;<span class="ident" id="3361470">readSetCookies</span><span class="op" id="3361484">(</span><span class="ident" id="3361485">h</span>&nbsp;<span class="ident" id="3361487">Header</span><span class="op" id="3361493">)</span>&nbsp;<span class="op" id="3361495">[</span><span class="op" id="3361496">]</span><span class="op" id="3361497">*</span><span class="ident" id="3361498">Cookie</span>&nbsp;<span class="op" id="3361505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361508">cookies</span>&nbsp;<span class="op" id="3361516">:=</span>&nbsp;<span class="op" id="3361519">[</span><span class="op" id="3361520">]</span><span class="op" id="3361521">*</span><span class="ident" id="3361522">Cookie</span><span class="op" id="3361528">{</span><span class="op" id="3361529">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361532">for</span>&nbsp;<span class="ident" id="3361536">_</span><span class="op" id="3361537">,</span>&nbsp;<span class="ident" id="3361539">line</span>&nbsp;<span class="op" id="3361544">:=</span>&nbsp;<span class="keyword" id="3361547">range</span>&nbsp;<span class="ident" id="3361553">h</span><span class="op" id="3361554">[</span><span class="string" id="3361555">&#34;Set-Cookie&#34;</span><span class="op" id="3361567">]</span>&nbsp;<span class="op" id="3361569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361573">parts</span>&nbsp;<span class="op" id="3361579">:=</span>&nbsp;<span class="ident" id="3361582">strings</span><span class="op" id="3361589">.</span><span class="ident" id="3361590">Split</span><span class="op" id="3361595">(</span><span class="ident" id="3361596">strings</span><span class="op" id="3361603">.</span><span class="ident" id="3361604">TrimSpace</span><span class="op" id="3361613">(</span><span class="ident" id="3361614">line</span><span class="op" id="3361618">)</span><span class="op" id="3361619">,</span>&nbsp;<span class="string" id="3361621">&#34;;&#34;</span><span class="op" id="3361624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361628">if</span>&nbsp;<span class="builtinfunc" id="3361631">len</span><span class="op" id="3361634">(</span><span class="ident" id="3361635">parts</span><span class="op" id="3361640">)</span>&nbsp;<span class="op" id="3361642">==</span>&nbsp;<span class="num" id="3361645">1</span>&nbsp;<span class="op" id="3361647">&amp;&amp;</span>&nbsp;<span class="ident" id="3361650">parts</span><span class="op" id="3361655">[</span><span class="num" id="3361656">0</span><span class="op" id="3361657">]</span>&nbsp;<span class="op" id="3361659">==</span>&nbsp;<span class="string" id="3361662">&#34;&#34;</span>&nbsp;<span class="op" id="3361665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361670">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3361681">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361685">parts</span><span class="op" id="3361690">[</span><span class="num" id="3361691">0</span><span class="op" id="3361692">]</span>&nbsp;<span class="op" id="3361694">=</span>&nbsp;<span class="ident" id="3361696">strings</span><span class="op" id="3361703">.</span><span class="ident" id="3361704">TrimSpace</span><span class="op" id="3361713">(</span><span class="ident" id="3361714">parts</span><span class="op" id="3361719">[</span><span class="num" id="3361720">0</span><span class="op" id="3361721">]</span><span class="op" id="3361722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361726">j</span>&nbsp;<span class="op" id="3361728">:=</span>&nbsp;<span class="ident" id="3361731">strings</span><span class="op" id="3361738">.</span><span class="ident" id="3361739">Index</span><span class="op" id="3361744">(</span><span class="ident" id="3361745">parts</span><span class="op" id="3361750">[</span><span class="num" id="3361751">0</span><span class="op" id="3361752">]</span><span class="op" id="3361753">,</span>&nbsp;<span class="string" id="3361755">&#34;=&#34;</span><span class="op" id="3361758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361762">if</span>&nbsp;<span class="ident" id="3361765">j</span>&nbsp;<span class="op" id="3361767">&lt;</span>&nbsp;<span class="num" id="3361769">0</span>&nbsp;<span class="op" id="3361771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361776">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3361787">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361791">name</span><span class="op" id="3361795">,</span>&nbsp;<span class="ident" id="3361797">value</span>&nbsp;<span class="op" id="3361803">:=</span>&nbsp;<span class="ident" id="3361806">parts</span><span class="op" id="3361811">[</span><span class="num" id="3361812">0</span><span class="op" id="3361813">]</span><span class="op" id="3361814">[</span><span class="op" id="3361815">:</span><span class="ident" id="3361816">j</span><span class="op" id="3361817">]</span><span class="op" id="3361818">,</span>&nbsp;<span class="ident" id="3361820">parts</span><span class="op" id="3361825">[</span><span class="num" id="3361826">0</span><span class="op" id="3361827">]</span><span class="op" id="3361828">[</span><span class="ident" id="3361829">j</span><span class="op" id="3361830">+</span><span class="num" id="3361831">1</span><span class="op" id="3361832">:</span><span class="op" id="3361833">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361837">if</span>&nbsp;<span class="op" id="3361840">!</span><span class="ident" id="3361841">isCookieNameValid</span><span class="op" id="3361858">(</span><span class="ident" id="3361859">name</span><span class="op" id="3361863">)</span>&nbsp;<span class="op" id="3361865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361870">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3361881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361885">value</span><span class="op" id="3361890">,</span>&nbsp;<span class="ident" id="3361892">success</span>&nbsp;<span class="op" id="3361900">:=</span>&nbsp;<span class="ident" id="3361903">parseCookieValue</span><span class="op" id="3361919">(</span><span class="ident" id="3361920">value</span><span class="op" id="3361925">,</span>&nbsp;<span class="builtintype" id="3361927">true</span><span class="op" id="3361931">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361935">if</span>&nbsp;<span class="op" id="3361938">!</span><span class="ident" id="3361939">success</span>&nbsp;<span class="op" id="3361947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361952">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3361963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361967">c</span>&nbsp;<span class="op" id="3361969">:=</span>&nbsp;<span class="op" id="3361972">&amp;</span><span class="ident" id="3361973">Cookie</span><span class="op" id="3361979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361984">Name</span><span class="op" id="3361988">:</span>&nbsp;&nbsp;<span class="ident" id="3361991">name</span><span class="op" id="3361995">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362000">Value</span><span class="op" id="3362005">:</span>&nbsp;<span class="ident" id="3362007">value</span><span class="op" id="3362012">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362017">Raw</span><span class="op" id="3362020">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3362024">line</span><span class="op" id="3362028">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3362032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3362036">for</span>&nbsp;<span class="ident" id="3362040">i</span>&nbsp;<span class="op" id="3362042">:=</span>&nbsp;<span class="num" id="3362045">1</span><span class="op" id="3362046">;</span>&nbsp;<span class="ident" id="3362048">i</span>&nbsp;<span class="op" id="3362050">&lt;</span>&nbsp;<span class="builtinfunc" id="3362052">len</span><span class="op" id="3362055">(</span><span class="ident" id="3362056">parts</span><span class="op" id="3362061">)</span><span class="op" id="3362062">;</span>&nbsp;<span class="ident" id="3362064">i</span><span class="op" id="3362065">++</span>&nbsp;<span class="op" id="3362068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362073">parts</span><span class="op" id="3362078">[</span><span class="ident" id="3362079">i</span><span class="op" id="3362080">]</span>&nbsp;<span class="op" id="3362082">=</span>&nbsp;<span class="ident" id="3362084">strings</span><span class="op" id="3362091">.</span><span class="ident" id="3362092">TrimSpace</span><span class="op" id="3362101">(</span><span class="ident" id="3362102">parts</span><span class="op" id="3362107">[</span><span class="ident" id="3362108">i</span><span class="op" id="3362109">]</span><span class="op" id="3362110">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3362115">if</span>&nbsp;<span class="builtinfunc" id="3362118">len</span><span class="op" id="3362121">(</span><span class="ident" id="3362122">parts</span><span class="op" id="3362127">[</span><span class="ident" id="3362128">i</span><span class="op" id="3362129">]</span><span class="op" id="3362130">)</span>&nbsp;<span class="op" id="3362132">==</span>&nbsp;<span class="num" id="3362135">0</span>&nbsp;<span class="op" id="3362137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3362143">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3362155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362161">attr</span><span class="op" id="3362165">,</span>&nbsp;<span class="ident" id="3362167">val</span>&nbsp;<span class="op" id="3362171">:=</span>&nbsp;<span class="ident" id="3362174">parts</span><span class="op" id="3362179">[</span><span class="ident" id="3362180">i</span><span class="op" id="3362181">]</span><span class="op" id="3362182">,</span>&nbsp;<span class="string" id="3362184">&#34;&#34;</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3362190">if</span>&nbsp;<span class="ident" id="3362193">j</span>&nbsp;<span class="op" id="3362195">:=</span>&nbsp;<span class="ident" id="3362198">strings</span><span class="op" id="3362205">.</span><span class="ident" id="3362206">Index</span><span class="op" id="3362211">(</span><span class="ident" id="3362212">attr</span><span class="op" id="3362216">,</span>&nbsp;<span class="string" id="3362218">&#34;=&#34;</span><span class="op" id="3362221">)</span><span class="op" id="3362222">;</span>&nbsp;<span class="ident" id="3362224">j</span>&nbsp;<span class="op" id="3362226">&gt;=</span>&nbsp;<span class="num" id="3362229">0</span>&nbsp;<span class="op" id="3362231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362237">attr</span><span class="op" id="3362241">,</span>&nbsp;<span class="ident" id="3362243">val</span>&nbsp;<span class="op" id="3362247">=</span>&nbsp;<span class="ident" id="3362249">attr</span><span class="op" id="3362253">[</span><span class="op" id="3362254">:</span><span class="ident" id="3362255">j</span><span class="op" id="3362256">]</span><span class="op" id="3362257">,</span>&nbsp;<span class="ident" id="3362259">attr</span><span class="op" id="3362263">[</span><span class="ident" id="3362264">j</span><span class="op" id="3362265">+</span><span class="num" id="3362266">1</span><span class="op" id="3362267">:</span><span class="op" id="3362268">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3362273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362278">lowerAttr</span>&nbsp;<span class="op" id="3362288">:=</span>&nbsp;<span class="ident" id="3362291">strings</span><span class="op" id="3362298">.</span><span class="ident" id="3362299">ToLower</span><span class="op" id="3362306">(</span><span class="ident" id="3362307">attr</span><span class="op" id="3362311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362316">val</span><span class="op" id="3362319">,</span>&nbsp;<span class="ident" id="3362321">success</span>&nbsp;<span class="op" id="3362329">=</span>&nbsp;<span class="ident" id="3362331">parseCookieValue</span><span class="op" id="3362347">(</span><span class="ident" id="3362348">val</span><span class="op" id="3362351">,</span>&nbsp;<span class="builtintype" id="3362353">false</span><span class="op" id="3362358">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3362363">if</span>&nbsp;<span class="op" id="3362366">!</span><span class="ident" id="3362367">success</span>&nbsp;<span class="op" id="3362375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362381">c</span><span class="op" id="3362382">.</span><span class="ident" id="3362383">Unparsed</span>&nbsp;<span class="op" id="3362392">=</span>&nbsp;<span class="builtinfunc" id="3362394">append</span><span class="op" id="3362400">(</span><span class="ident" id="3362401">c</span><span class="op" id="3362402">.</span><span class="ident" id="3362403">Unparsed</span><span class="op" id="3362411">,</span>&nbsp;<span class="ident" id="3362413">parts</span><span class="op" id="3362418">[</span><span class="ident" id="3362419">i</span><span class="op" id="3362420">]</span><span class="op" id="3362421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3362427">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3362439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3362444">switch</span>&nbsp;<span class="ident" id="3362451">lowerAttr</span>&nbsp;<span class="op" id="3362461">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3362466">case</span>&nbsp;<span class="string" id="3362471">&#34;secure&#34;</span><span class="op" id="3362479">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362485">c</span><span class="op" id="3362486">.</span><span class="ident" id="3362487">Secure</span>&nbsp;<span class="op" id="3362494">=</span>&nbsp;<span class="builtintype" id="3362496">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3362505">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3362517">case</span>&nbsp;<span class="string" id="3362522">&#34;httponly&#34;</span><span class="op" id="3362532">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362538">c</span><span class="op" id="3362539">.</span><span class="ident" id="3362540">HttpOnly</span>&nbsp;<span class="op" id="3362549">=</span>&nbsp;<span class="builtintype" id="3362551">true</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3362560">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3362572">case</span>&nbsp;<span class="string" id="3362577">&#34;domain&#34;</span><span class="op" id="3362585">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362591">c</span><span class="op" id="3362592">.</span><span class="ident" id="3362593">Domain</span>&nbsp;<span class="op" id="3362600">=</span>&nbsp;<span class="ident" id="3362602">val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3362610">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3362622">case</span>&nbsp;<span class="string" id="3362627">&#34;max-age&#34;</span><span class="op" id="3362636">:</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362642">secs</span><span class="op" id="3362646">,</span>&nbsp;<span class="ident" id="3362648">err</span>&nbsp;<span class="op" id="3362652">:=</span>&nbsp;<span class="ident" id="3362655">strconv</span><span class="op" id="3362662">.</span><span class="ident" id="3362663">Atoi</span><span class="op" id="3362667">(</span><span class="ident" id="3362668">val</span><span class="op" id="3362671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3362677">if</span>&nbsp;<span class="ident" id="3362680">err</span>&nbsp;<span class="op" id="3362684">!=</span>&nbsp;<span class="ident" id="3362687">nil</span>&nbsp;<span class="op" id="3362691">||</span>&nbsp;<span class="ident" id="3362694">secs</span>&nbsp;<span class="op" id="3362699">!=</span>&nbsp;<span class="num" id="3362702">0</span>&nbsp;<span class="op" id="3362704">&amp;&amp;</span>&nbsp;<span class="ident" id="3362707">val</span><span class="op" id="3362710">[</span><span class="num" id="3362711">0</span><span class="op" id="3362712">]</span>&nbsp;<span class="op" id="3362714">==</span>&nbsp;<span class="string" id="3362717">&#39;0&#39;</span>&nbsp;<span class="op" id="3362721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3362728">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3362738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3362744">if</span>&nbsp;<span class="ident" id="3362747">secs</span>&nbsp;<span class="op" id="3362752">&lt;=</span>&nbsp;<span class="num" id="3362755">0</span>&nbsp;<span class="op" id="3362757">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362764">c</span><span class="op" id="3362765">.</span><span class="ident" id="3362766">MaxAge</span>&nbsp;<span class="op" id="3362773">=</span>&nbsp;<span class="op" id="3362775">-</span><span class="num" id="3362776">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3362782">}</span>&nbsp;<span class="keyword" id="3362784">else</span>&nbsp;<span class="op" id="3362789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362796">c</span><span class="op" id="3362797">.</span><span class="ident" id="3362798">MaxAge</span>&nbsp;<span class="op" id="3362805">=</span>&nbsp;<span class="ident" id="3362807">secs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3362816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3362822">continue</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3362834">case</span>&nbsp;<span class="string" id="3362839">&#34;expires&#34;</span><span class="op" id="3362848">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362854">c</span><span class="op" id="3362855">.</span><span class="ident" id="3362856">RawExpires</span>&nbsp;<span class="op" id="3362867">=</span>&nbsp;<span class="ident" id="3362869">val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362877">exptime</span><span class="op" id="3362884">,</span>&nbsp;<span class="ident" id="3362886">err</span>&nbsp;<span class="op" id="3362890">:=</span>&nbsp;<span class="ident" id="3362893">time</span><span class="op" id="3362897">.</span><span class="ident" id="3362898">Parse</span><span class="op" id="3362903">(</span><span class="ident" id="3362904">time</span><span class="op" id="3362908">.</span><span class="ident" id="3362909">RFC1123</span><span class="op" id="3362916">,</span>&nbsp;<span class="ident" id="3362918">val</span><span class="op" id="3362921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3362927">if</span>&nbsp;<span class="ident" id="3362930">err</span>&nbsp;<span class="op" id="3362934">!=</span>&nbsp;<span class="ident" id="3362937">nil</span>&nbsp;<span class="op" id="3362941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362948">exptime</span><span class="op" id="3362955">,</span>&nbsp;<span class="ident" id="3362957">err</span>&nbsp;<span class="op" id="3362961">=</span>&nbsp;<span class="ident" id="3362963">time</span><span class="op" id="3362967">.</span><span class="ident" id="3362968">Parse</span><span class="op" id="3362973">(</span><span class="string" id="3362974">&#34;Mon,&nbsp;02-Jan-2006&nbsp;15:04:05&nbsp;MST&#34;</span><span class="op" id="3363005">,</span>&nbsp;<span class="ident" id="3363007">val</span><span class="op" id="3363010">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3363017">if</span>&nbsp;<span class="ident" id="3363020">err</span>&nbsp;<span class="op" id="3363024">!=</span>&nbsp;<span class="ident" id="3363027">nil</span>&nbsp;<span class="op" id="3363031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3363039">c</span><span class="op" id="3363040">.</span><span class="ident" id="3363041">Expires</span>&nbsp;<span class="op" id="3363049">=</span>&nbsp;<span class="ident" id="3363051">time</span><span class="op" id="3363055">.</span><span class="ident" id="3363056">Time</span><span class="op" id="3363060">{</span><span class="op" id="3363061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3363069">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3363080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3363086">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3363092">c</span><span class="op" id="3363093">.</span><span class="ident" id="3363094">Expires</span>&nbsp;<span class="op" id="3363102">=</span>&nbsp;<span class="ident" id="3363104">exptime</span><span class="op" id="3363111">.</span><span class="ident" id="3363112">UTC</span><span class="op" id="3363115">(</span><span class="op" id="3363116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3363122">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3363134">case</span>&nbsp;<span class="string" id="3363139">&#34;path&#34;</span><span class="op" id="3363145">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3363151">c</span><span class="op" id="3363152">.</span><span class="ident" id="3363153">Path</span>&nbsp;<span class="op" id="3363158">=</span>&nbsp;<span class="ident" id="3363160">val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3363168">continue</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3363180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3363185">c</span><span class="op" id="3363186">.</span><span class="ident" id="3363187">Unparsed</span>&nbsp;<span class="op" id="3363196">=</span>&nbsp;<span class="builtinfunc" id="3363198">append</span><span class="op" id="3363204">(</span><span class="ident" id="3363205">c</span><span class="op" id="3363206">.</span><span class="ident" id="3363207">Unparsed</span><span class="op" id="3363215">,</span>&nbsp;<span class="ident" id="3363217">parts</span><span class="op" id="3363222">[</span><span class="ident" id="3363223">i</span><span class="op" id="3363224">]</span><span class="op" id="3363225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3363229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3363233">cookies</span>&nbsp;<span class="op" id="3363241">=</span>&nbsp;<span class="builtinfunc" id="3363243">append</span><span class="op" id="3363249">(</span><span class="ident" id="3363250">cookies</span><span class="op" id="3363257">,</span>&nbsp;<span class="ident" id="3363259">c</span><span class="op" id="3363260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3363263">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3363266">return</span>&nbsp;<span class="ident" id="3363273">cookies</span><br>
<span class="lineno"></span><span class="op" id="3363281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3363284">//&nbsp;SetCookie&nbsp;adds&nbsp;a&nbsp;Set-Cookie&nbsp;header&nbsp;to&nbsp;the&nbsp;provided&nbsp;ResponseWriter&#39;s&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="3363364">func</span>&nbsp;<span class="ident" id="3363369">SetCookie</span><span class="op" id="3363378">(</span><span class="ident" id="3363379">w</span>&nbsp;<span class="ident" id="3363381">ResponseWriter</span><span class="op" id="3363395">,</span>&nbsp;<span class="ident" id="3363397">cookie</span>&nbsp;<span class="op" id="3363404">*</span><span class="ident" id="3363405">Cookie</span><span class="op" id="3363411">)</span>&nbsp;<span class="op" id="3363413">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3363416">w</span><span class="op" id="3363417">.</span><span class="ident" id="3363418">Header</span><span class="op" id="3363424">(</span><span class="op" id="3363425">)</span><span class="op" id="3363426">.</span><span class="ident" id="3363427">Add</span><span class="op" id="3363430">(</span><span class="string" id="3363431">&#34;Set-Cookie&#34;</span><span class="op" id="3363443">,</span>&nbsp;<span class="ident" id="3363445">cookie</span><span class="op" id="3363451">.</span><span class="ident" id="3363452">String</span><span class="op" id="3363458">(</span><span class="op" id="3363459">)</span><span class="op" id="3363460">)</span><br>
<span class="lineno"></span><span class="op" id="3363462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3363465">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;serialization&nbsp;of&nbsp;the&nbsp;cookie&nbsp;for&nbsp;use&nbsp;in&nbsp;a&nbsp;Cookie</span><br>
<span class="lineno"></span><span class="comment" id="3363535">//&nbsp;header&nbsp;(if&nbsp;only&nbsp;Name&nbsp;and&nbsp;Value&nbsp;are&nbsp;set)&nbsp;or&nbsp;a&nbsp;Set-Cookie&nbsp;response</span><br>
<span class="lineno">135</span><span class="comment" id="3363603">//&nbsp;header&nbsp;(if&nbsp;other&nbsp;fields&nbsp;are&nbsp;set).</span><br>
<span class="lineno"></span><span class="keyword" id="3363640">func</span>&nbsp;<span class="op" id="3363645">(</span><span class="ident" id="3363646">c</span>&nbsp;<span class="op" id="3363648">*</span><span class="ident" id="3363649">Cookie</span><span class="op" id="3363655">)</span>&nbsp;<span class="ident" id="3363657">String</span><span class="op" id="3363663">(</span><span class="op" id="3363664">)</span>&nbsp;<span class="builtintype" id="3363666">string</span>&nbsp;<span class="op" id="3363673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3363676">var</span>&nbsp;<span class="ident" id="3363680">b</span>&nbsp;<span class="ident" id="3363682">bytes</span><span class="op" id="3363687">.</span><span class="ident" id="3363688">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3363696">fmt</span><span class="op" id="3363699">.</span><span class="ident" id="3363700">Fprintf</span><span class="op" id="3363707">(</span><span class="op" id="3363708">&amp;</span><span class="ident" id="3363709">b</span><span class="op" id="3363710">,</span>&nbsp;<span class="string" id="3363712">&#34;%s=%s&#34;</span><span class="op" id="3363719">,</span>&nbsp;<span class="ident" id="3363721">sanitizeCookieName</span><span class="op" id="3363739">(</span><span class="ident" id="3363740">c</span><span class="op" id="3363741">.</span><span class="ident" id="3363742">Name</span><span class="op" id="3363746">)</span><span class="op" id="3363747">,</span>&nbsp;<span class="ident" id="3363749">sanitizeCookieValue</span><span class="op" id="3363768">(</span><span class="ident" id="3363769">c</span><span class="op" id="3363770">.</span><span class="ident" id="3363771">Value</span><span class="op" id="3363776">)</span><span class="op" id="3363777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3363780">if</span>&nbsp;<span class="builtinfunc" id="3363783">len</span><span class="op" id="3363786">(</span><span class="ident" id="3363787">c</span><span class="op" id="3363788">.</span><span class="ident" id="3363789">Path</span><span class="op" id="3363793">)</span>&nbsp;<span class="op" id="3363795">&gt;</span>&nbsp;<span class="num" id="3363797">0</span>&nbsp;<span class="op" id="3363799">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3363803">fmt</span><span class="op" id="3363806">.</span><span class="ident" id="3363807">Fprintf</span><span class="op" id="3363814">(</span><span class="op" id="3363815">&amp;</span><span class="ident" id="3363816">b</span><span class="op" id="3363817">,</span>&nbsp;<span class="string" id="3363819">&#34;;&nbsp;Path=%s&#34;</span><span class="op" id="3363830">,</span>&nbsp;<span class="ident" id="3363832">sanitizeCookiePath</span><span class="op" id="3363850">(</span><span class="ident" id="3363851">c</span><span class="op" id="3363852">.</span><span class="ident" id="3363853">Path</span><span class="op" id="3363857">)</span><span class="op" id="3363858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3363861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3363864">if</span>&nbsp;<span class="builtinfunc" id="3363867">len</span><span class="op" id="3363870">(</span><span class="ident" id="3363871">c</span><span class="op" id="3363872">.</span><span class="ident" id="3363873">Domain</span><span class="op" id="3363879">)</span>&nbsp;<span class="op" id="3363881">&gt;</span>&nbsp;<span class="num" id="3363883">0</span>&nbsp;<span class="op" id="3363885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3363889">if</span>&nbsp;<span class="ident" id="3363892">validCookieDomain</span><span class="op" id="3363909">(</span><span class="ident" id="3363910">c</span><span class="op" id="3363911">.</span><span class="ident" id="3363912">Domain</span><span class="op" id="3363918">)</span>&nbsp;<span class="op" id="3363920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3363925">//&nbsp;A&nbsp;c.Domain&nbsp;containing&nbsp;illegal&nbsp;characters&nbsp;is&nbsp;not</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3363979">//&nbsp;sanitized&nbsp;but&nbsp;simply&nbsp;dropped&nbsp;which&nbsp;turns&nbsp;the&nbsp;cookie</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3364037">//&nbsp;into&nbsp;a&nbsp;host-only&nbsp;cookie.&nbsp;A&nbsp;leading&nbsp;dot&nbsp;is&nbsp;okay</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3364090">//&nbsp;but&nbsp;won&#39;t&nbsp;be&nbsp;sent.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364115">d</span>&nbsp;<span class="op" id="3364117">:=</span>&nbsp;<span class="ident" id="3364120">c</span><span class="op" id="3364121">.</span><span class="ident" id="3364122">Domain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3364132">if</span>&nbsp;<span class="ident" id="3364135">d</span><span class="op" id="3364136">[</span><span class="num" id="3364137">0</span><span class="op" id="3364138">]</span>&nbsp;<span class="op" id="3364140">==</span>&nbsp;<span class="string" id="3364143">&#39;.&#39;</span>&nbsp;<span class="op" id="3364147">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364153">d</span>&nbsp;<span class="op" id="3364155">=</span>&nbsp;<span class="ident" id="3364157">d</span><span class="op" id="3364158">[</span><span class="num" id="3364159">1</span><span class="op" id="3364160">:</span><span class="op" id="3364161">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3364166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364171">fmt</span><span class="op" id="3364174">.</span><span class="ident" id="3364175">Fprintf</span><span class="op" id="3364182">(</span><span class="op" id="3364183">&amp;</span><span class="ident" id="3364184">b</span><span class="op" id="3364185">,</span>&nbsp;<span class="string" id="3364187">&#34;;&nbsp;Domain=%s&#34;</span><span class="op" id="3364200">,</span>&nbsp;<span class="ident" id="3364202">d</span><span class="op" id="3364203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3364207">}</span>&nbsp;<span class="keyword" id="3364209">else</span>&nbsp;<span class="op" id="3364214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364219">log</span><span class="op" id="3364222">.</span><span class="ident" id="3364223">Printf</span><span class="op" id="3364229">(</span><span class="string" id="3364230">&#34;net/http:&nbsp;invalid&nbsp;Cookie.Domain&nbsp;%q;&nbsp;dropping&nbsp;domain&nbsp;attribute&#34;</span><span class="op" id="3364293">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364299">c</span><span class="op" id="3364300">.</span><span class="ident" id="3364301">Domain</span><span class="op" id="3364307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3364311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3364314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3364317">if</span>&nbsp;<span class="ident" id="3364320">c</span><span class="op" id="3364321">.</span><span class="ident" id="3364322">Expires</span><span class="op" id="3364329">.</span><span class="ident" id="3364330">Unix</span><span class="op" id="3364334">(</span><span class="op" id="3364335">)</span>&nbsp;<span class="op" id="3364337">&gt;</span>&nbsp;<span class="num" id="3364339">0</span>&nbsp;<span class="op" id="3364341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364345">fmt</span><span class="op" id="3364348">.</span><span class="ident" id="3364349">Fprintf</span><span class="op" id="3364356">(</span><span class="op" id="3364357">&amp;</span><span class="ident" id="3364358">b</span><span class="op" id="3364359">,</span>&nbsp;<span class="string" id="3364361">&#34;;&nbsp;Expires=%s&#34;</span><span class="op" id="3364375">,</span>&nbsp;<span class="ident" id="3364377">c</span><span class="op" id="3364378">.</span><span class="ident" id="3364379">Expires</span><span class="op" id="3364386">.</span><span class="ident" id="3364387">UTC</span><span class="op" id="3364390">(</span><span class="op" id="3364391">)</span><span class="op" id="3364392">.</span><span class="ident" id="3364393">Format</span><span class="op" id="3364399">(</span><span class="ident" id="3364400">time</span><span class="op" id="3364404">.</span><span class="ident" id="3364405">RFC1123</span><span class="op" id="3364412">)</span><span class="op" id="3364413">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3364416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3364419">if</span>&nbsp;<span class="ident" id="3364422">c</span><span class="op" id="3364423">.</span><span class="ident" id="3364424">MaxAge</span>&nbsp;<span class="op" id="3364431">&gt;</span>&nbsp;<span class="num" id="3364433">0</span>&nbsp;<span class="op" id="3364435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364439">fmt</span><span class="op" id="3364442">.</span><span class="ident" id="3364443">Fprintf</span><span class="op" id="3364450">(</span><span class="op" id="3364451">&amp;</span><span class="ident" id="3364452">b</span><span class="op" id="3364453">,</span>&nbsp;<span class="string" id="3364455">&#34;;&nbsp;Max-Age=%d&#34;</span><span class="op" id="3364469">,</span>&nbsp;<span class="ident" id="3364471">c</span><span class="op" id="3364472">.</span><span class="ident" id="3364473">MaxAge</span><span class="op" id="3364479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3364482">}</span>&nbsp;<span class="keyword" id="3364484">else</span>&nbsp;<span class="keyword" id="3364489">if</span>&nbsp;<span class="ident" id="3364492">c</span><span class="op" id="3364493">.</span><span class="ident" id="3364494">MaxAge</span>&nbsp;<span class="op" id="3364501">&lt;</span>&nbsp;<span class="num" id="3364503">0</span>&nbsp;<span class="op" id="3364505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364509">fmt</span><span class="op" id="3364512">.</span><span class="ident" id="3364513">Fprintf</span><span class="op" id="3364520">(</span><span class="op" id="3364521">&amp;</span><span class="ident" id="3364522">b</span><span class="op" id="3364523">,</span>&nbsp;<span class="string" id="3364525">&#34;;&nbsp;Max-Age=0&#34;</span><span class="op" id="3364538">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3364541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3364544">if</span>&nbsp;<span class="ident" id="3364547">c</span><span class="op" id="3364548">.</span><span class="ident" id="3364549">HttpOnly</span>&nbsp;<span class="op" id="3364558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364562">fmt</span><span class="op" id="3364565">.</span><span class="ident" id="3364566">Fprintf</span><span class="op" id="3364573">(</span><span class="op" id="3364574">&amp;</span><span class="ident" id="3364575">b</span><span class="op" id="3364576">,</span>&nbsp;<span class="string" id="3364578">&#34;;&nbsp;HttpOnly&#34;</span><span class="op" id="3364590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3364593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3364596">if</span>&nbsp;<span class="ident" id="3364599">c</span><span class="op" id="3364600">.</span><span class="ident" id="3364601">Secure</span>&nbsp;<span class="op" id="3364608">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364612">fmt</span><span class="op" id="3364615">.</span><span class="ident" id="3364616">Fprintf</span><span class="op" id="3364623">(</span><span class="op" id="3364624">&amp;</span><span class="ident" id="3364625">b</span><span class="op" id="3364626">,</span>&nbsp;<span class="string" id="3364628">&#34;;&nbsp;Secure&#34;</span><span class="op" id="3364638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3364641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3364644">return</span>&nbsp;<span class="ident" id="3364651">b</span><span class="op" id="3364652">.</span><span class="ident" id="3364653">String</span><span class="op" id="3364659">(</span><span class="op" id="3364660">)</span><br>
<span class="lineno"></span><span class="op" id="3364662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="3364665">//&nbsp;readCookies&nbsp;parses&nbsp;all&nbsp;&#34;Cookie&#34;&nbsp;values&nbsp;from&nbsp;the&nbsp;header&nbsp;h&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3364729">//&nbsp;returns&nbsp;the&nbsp;successfully&nbsp;parsed&nbsp;Cookies.</span><br>
<span class="lineno"></span><span class="comment" id="3364773">//</span><br>
<span class="lineno"></span><span class="comment" id="3364776">//&nbsp;if&nbsp;filter&nbsp;isn&#39;t&nbsp;empty,&nbsp;only&nbsp;cookies&nbsp;of&nbsp;that&nbsp;name&nbsp;are&nbsp;returned</span><br>
<span class="lineno"></span><span class="keyword" id="3364841">func</span>&nbsp;<span class="ident" id="3364846">readCookies</span><span class="op" id="3364857">(</span><span class="ident" id="3364858">h</span>&nbsp;<span class="ident" id="3364860">Header</span><span class="op" id="3364866">,</span>&nbsp;<span class="ident" id="3364868">filter</span>&nbsp;<span class="builtintype" id="3364875">string</span><span class="op" id="3364881">)</span>&nbsp;<span class="op" id="3364883">[</span><span class="op" id="3364884">]</span><span class="op" id="3364885">*</span><span class="ident" id="3364886">Cookie</span>&nbsp;<span class="op" id="3364893">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364896">cookies</span>&nbsp;<span class="op" id="3364904">:=</span>&nbsp;<span class="op" id="3364907">[</span><span class="op" id="3364908">]</span><span class="op" id="3364909">*</span><span class="ident" id="3364910">Cookie</span><span class="op" id="3364916">{</span><span class="op" id="3364917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364920">lines</span><span class="op" id="3364925">,</span>&nbsp;<span class="ident" id="3364927">ok</span>&nbsp;<span class="op" id="3364930">:=</span>&nbsp;<span class="ident" id="3364933">h</span><span class="op" id="3364934">[</span><span class="string" id="3364935">&#34;Cookie&#34;</span><span class="op" id="3364943">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3364946">if</span>&nbsp;<span class="op" id="3364949">!</span><span class="ident" id="3364950">ok</span>&nbsp;<span class="op" id="3364953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3364957">return</span>&nbsp;<span class="ident" id="3364964">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3364973">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3364977">for</span>&nbsp;<span class="ident" id="3364981">_</span><span class="op" id="3364982">,</span>&nbsp;<span class="ident" id="3364984">line</span>&nbsp;<span class="op" id="3364989">:=</span>&nbsp;<span class="keyword" id="3364992">range</span>&nbsp;<span class="ident" id="3364998">lines</span>&nbsp;<span class="op" id="3365004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3365008">parts</span>&nbsp;<span class="op" id="3365014">:=</span>&nbsp;<span class="ident" id="3365017">strings</span><span class="op" id="3365024">.</span><span class="ident" id="3365025">Split</span><span class="op" id="3365030">(</span><span class="ident" id="3365031">strings</span><span class="op" id="3365038">.</span><span class="ident" id="3365039">TrimSpace</span><span class="op" id="3365048">(</span><span class="ident" id="3365049">line</span><span class="op" id="3365053">)</span><span class="op" id="3365054">,</span>&nbsp;<span class="string" id="3365056">&#34;;&#34;</span><span class="op" id="3365059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365063">if</span>&nbsp;<span class="builtinfunc" id="3365066">len</span><span class="op" id="3365069">(</span><span class="ident" id="3365070">parts</span><span class="op" id="3365075">)</span>&nbsp;<span class="op" id="3365077">==</span>&nbsp;<span class="num" id="3365080">1</span>&nbsp;<span class="op" id="3365082">&amp;&amp;</span>&nbsp;<span class="ident" id="3365085">parts</span><span class="op" id="3365090">[</span><span class="num" id="3365091">0</span><span class="op" id="3365092">]</span>&nbsp;<span class="op" id="3365094">==</span>&nbsp;<span class="string" id="3365097">&#34;&#34;</span>&nbsp;<span class="op" id="3365100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365105">continue</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3365116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3365120">//&nbsp;Per-line&nbsp;attributes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3365145">parsedPairs</span>&nbsp;<span class="op" id="3365157">:=</span>&nbsp;<span class="num" id="3365160">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365164">for</span>&nbsp;<span class="ident" id="3365168">i</span>&nbsp;<span class="op" id="3365170">:=</span>&nbsp;<span class="num" id="3365173">0</span><span class="op" id="3365174">;</span>&nbsp;<span class="ident" id="3365176">i</span>&nbsp;<span class="op" id="3365178">&lt;</span>&nbsp;<span class="builtinfunc" id="3365180">len</span><span class="op" id="3365183">(</span><span class="ident" id="3365184">parts</span><span class="op" id="3365189">)</span><span class="op" id="3365190">;</span>&nbsp;<span class="ident" id="3365192">i</span><span class="op" id="3365193">++</span>&nbsp;<span class="op" id="3365196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3365201">parts</span><span class="op" id="3365206">[</span><span class="ident" id="3365207">i</span><span class="op" id="3365208">]</span>&nbsp;<span class="op" id="3365210">=</span>&nbsp;<span class="ident" id="3365212">strings</span><span class="op" id="3365219">.</span><span class="ident" id="3365220">TrimSpace</span><span class="op" id="3365229">(</span><span class="ident" id="3365230">parts</span><span class="op" id="3365235">[</span><span class="ident" id="3365236">i</span><span class="op" id="3365237">]</span><span class="op" id="3365238">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365243">if</span>&nbsp;<span class="builtinfunc" id="3365246">len</span><span class="op" id="3365249">(</span><span class="ident" id="3365250">parts</span><span class="op" id="3365255">[</span><span class="ident" id="3365256">i</span><span class="op" id="3365257">]</span><span class="op" id="3365258">)</span>&nbsp;<span class="op" id="3365260">==</span>&nbsp;<span class="num" id="3365263">0</span>&nbsp;<span class="op" id="3365265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365271">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3365283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3365288">name</span><span class="op" id="3365292">,</span>&nbsp;<span class="ident" id="3365294">val</span>&nbsp;<span class="op" id="3365298">:=</span>&nbsp;<span class="ident" id="3365301">parts</span><span class="op" id="3365306">[</span><span class="ident" id="3365307">i</span><span class="op" id="3365308">]</span><span class="op" id="3365309">,</span>&nbsp;<span class="string" id="3365311">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365317">if</span>&nbsp;<span class="ident" id="3365320">j</span>&nbsp;<span class="op" id="3365322">:=</span>&nbsp;<span class="ident" id="3365325">strings</span><span class="op" id="3365332">.</span><span class="ident" id="3365333">Index</span><span class="op" id="3365338">(</span><span class="ident" id="3365339">name</span><span class="op" id="3365343">,</span>&nbsp;<span class="string" id="3365345">&#34;=&#34;</span><span class="op" id="3365348">)</span><span class="op" id="3365349">;</span>&nbsp;<span class="ident" id="3365351">j</span>&nbsp;<span class="op" id="3365353">&gt;=</span>&nbsp;<span class="num" id="3365356">0</span>&nbsp;<span class="op" id="3365358">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3365364">name</span><span class="op" id="3365368">,</span>&nbsp;<span class="ident" id="3365370">val</span>&nbsp;<span class="op" id="3365374">=</span>&nbsp;<span class="ident" id="3365376">name</span><span class="op" id="3365380">[</span><span class="op" id="3365381">:</span><span class="ident" id="3365382">j</span><span class="op" id="3365383">]</span><span class="op" id="3365384">,</span>&nbsp;<span class="ident" id="3365386">name</span><span class="op" id="3365390">[</span><span class="ident" id="3365391">j</span><span class="op" id="3365392">+</span><span class="num" id="3365393">1</span><span class="op" id="3365394">:</span><span class="op" id="3365395">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3365400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365405">if</span>&nbsp;<span class="op" id="3365408">!</span><span class="ident" id="3365409">isCookieNameValid</span><span class="op" id="3365426">(</span><span class="ident" id="3365427">name</span><span class="op" id="3365431">)</span>&nbsp;<span class="op" id="3365433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365439">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3365451">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365456">if</span>&nbsp;<span class="ident" id="3365459">filter</span>&nbsp;<span class="op" id="3365466">!=</span>&nbsp;<span class="string" id="3365469">&#34;&#34;</span>&nbsp;<span class="op" id="3365472">&amp;&amp;</span>&nbsp;<span class="ident" id="3365475">filter</span>&nbsp;<span class="op" id="3365482">!=</span>&nbsp;<span class="ident" id="3365485">name</span>&nbsp;<span class="op" id="3365490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365496">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3365508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3365513">val</span><span class="op" id="3365516">,</span>&nbsp;<span class="ident" id="3365518">success</span>&nbsp;<span class="op" id="3365526">:=</span>&nbsp;<span class="ident" id="3365529">parseCookieValue</span><span class="op" id="3365545">(</span><span class="ident" id="3365546">val</span><span class="op" id="3365549">,</span>&nbsp;<span class="builtintype" id="3365551">true</span><span class="op" id="3365555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365560">if</span>&nbsp;<span class="op" id="3365563">!</span><span class="ident" id="3365564">success</span>&nbsp;<span class="op" id="3365572">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365578">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3365590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3365595">cookies</span>&nbsp;<span class="op" id="3365603">=</span>&nbsp;<span class="builtinfunc" id="3365605">append</span><span class="op" id="3365611">(</span><span class="ident" id="3365612">cookies</span><span class="op" id="3365619">,</span>&nbsp;<span class="op" id="3365621">&amp;</span><span class="ident" id="3365622">Cookie</span><span class="op" id="3365628">{</span><span class="ident" id="3365629">Name</span><span class="op" id="3365633">:</span>&nbsp;<span class="ident" id="3365635">name</span><span class="op" id="3365639">,</span>&nbsp;<span class="ident" id="3365641">Value</span><span class="op" id="3365646">:</span>&nbsp;<span class="ident" id="3365648">val</span><span class="op" id="3365651">}</span><span class="op" id="3365652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3365657">parsedPairs</span><span class="op" id="3365668">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3365673">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3365676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365679">return</span>&nbsp;<span class="ident" id="3365686">cookies</span><br>
<span class="lineno"></span><span class="op" id="3365694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3365697">//&nbsp;validCookieDomain&nbsp;returns&nbsp;wheter&nbsp;v&nbsp;is&nbsp;a&nbsp;valid&nbsp;cookie&nbsp;domain-value.</span><br>
<span class="lineno">220</span><span class="keyword" id="3365767">func</span>&nbsp;<span class="ident" id="3365772">validCookieDomain</span><span class="op" id="3365789">(</span><span class="ident" id="3365790">v</span>&nbsp;<span class="builtintype" id="3365792">string</span><span class="op" id="3365798">)</span>&nbsp;<span class="builtintype" id="3365800">bool</span>&nbsp;<span class="op" id="3365805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365808">if</span>&nbsp;<span class="ident" id="3365811">isCookieDomainName</span><span class="op" id="3365829">(</span><span class="ident" id="3365830">v</span><span class="op" id="3365831">)</span>&nbsp;<span class="op" id="3365833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365837">return</span>&nbsp;<span class="builtintype" id="3365844">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3365850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365853">if</span>&nbsp;<span class="ident" id="3365856">net</span><span class="op" id="3365859">.</span><span class="ident" id="3365860">ParseIP</span><span class="op" id="3365867">(</span><span class="ident" id="3365868">v</span><span class="op" id="3365869">)</span>&nbsp;<span class="op" id="3365871">!=</span>&nbsp;<span class="ident" id="3365874">nil</span>&nbsp;<span class="op" id="3365878">&amp;&amp;</span>&nbsp;<span class="op" id="3365881">!</span><span class="ident" id="3365882">strings</span><span class="op" id="3365889">.</span><span class="ident" id="3365890">Contains</span><span class="op" id="3365898">(</span><span class="ident" id="3365899">v</span><span class="op" id="3365900">,</span>&nbsp;<span class="string" id="3365902">&#34;:&#34;</span><span class="op" id="3365905">)</span>&nbsp;<span class="op" id="3365907">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365911">return</span>&nbsp;<span class="builtintype" id="3365918">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3365924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365927">return</span>&nbsp;<span class="builtintype" id="3365934">false</span><br>
<span class="lineno"></span><span class="op" id="3365940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="comment" id="3365943">//&nbsp;isCookieDomainName&nbsp;returns&nbsp;whether&nbsp;s&nbsp;is&nbsp;a&nbsp;valid&nbsp;domain&nbsp;name&nbsp;or&nbsp;a&nbsp;valid</span><br>
<span class="lineno"></span><span class="comment" id="3366017">//&nbsp;domain&nbsp;name&nbsp;with&nbsp;a&nbsp;leading&nbsp;dot&nbsp;&#39;.&#39;.&nbsp;&nbsp;It&nbsp;is&nbsp;almost&nbsp;a&nbsp;direct&nbsp;copy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3366087">//&nbsp;package&nbsp;net&#39;s&nbsp;isDomainName.</span><br>
<span class="lineno"></span><span class="keyword" id="3366118">func</span>&nbsp;<span class="ident" id="3366123">isCookieDomainName</span><span class="op" id="3366141">(</span><span class="ident" id="3366142">s</span>&nbsp;<span class="builtintype" id="3366144">string</span><span class="op" id="3366150">)</span>&nbsp;<span class="builtintype" id="3366152">bool</span>&nbsp;<span class="op" id="3366157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366160">if</span>&nbsp;<span class="builtinfunc" id="3366163">len</span><span class="op" id="3366166">(</span><span class="ident" id="3366167">s</span><span class="op" id="3366168">)</span>&nbsp;<span class="op" id="3366170">==</span>&nbsp;<span class="num" id="3366173">0</span>&nbsp;<span class="op" id="3366175">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366179">return</span>&nbsp;<span class="builtintype" id="3366186">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3366193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366196">if</span>&nbsp;<span class="builtinfunc" id="3366199">len</span><span class="op" id="3366202">(</span><span class="ident" id="3366203">s</span><span class="op" id="3366204">)</span>&nbsp;<span class="op" id="3366206">&gt;</span>&nbsp;<span class="num" id="3366208">255</span>&nbsp;<span class="op" id="3366212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366216">return</span>&nbsp;<span class="builtintype" id="3366223">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3366230">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366234">if</span>&nbsp;<span class="ident" id="3366237">s</span><span class="op" id="3366238">[</span><span class="num" id="3366239">0</span><span class="op" id="3366240">]</span>&nbsp;<span class="op" id="3366242">==</span>&nbsp;<span class="string" id="3366245">&#39;.&#39;</span>&nbsp;<span class="op" id="3366249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3366253">//&nbsp;A&nbsp;cookie&nbsp;a&nbsp;domain&nbsp;attribute&nbsp;may&nbsp;start&nbsp;with&nbsp;a&nbsp;leading&nbsp;dot.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366316">s</span>&nbsp;<span class="op" id="3366318">=</span>&nbsp;<span class="ident" id="3366320">s</span><span class="op" id="3366321">[</span><span class="num" id="3366322">1</span><span class="op" id="3366323">:</span><span class="op" id="3366324">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3366327">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366330">last</span>&nbsp;<span class="op" id="3366335">:=</span>&nbsp;<span class="builtintype" id="3366338">byte</span><span class="op" id="3366342">(</span><span class="string" id="3366343">&#39;.&#39;</span><span class="op" id="3366346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366349">ok</span>&nbsp;<span class="op" id="3366352">:=</span>&nbsp;<span class="builtintype" id="3366355">false</span>&nbsp;<span class="comment" id="3366361">//&nbsp;Ok&nbsp;once&nbsp;we&#39;ve&nbsp;seen&nbsp;a&nbsp;letter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366394">partlen</span>&nbsp;<span class="op" id="3366402">:=</span>&nbsp;<span class="num" id="3366405">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366408">for</span>&nbsp;<span class="ident" id="3366412">i</span>&nbsp;<span class="op" id="3366414">:=</span>&nbsp;<span class="num" id="3366417">0</span><span class="op" id="3366418">;</span>&nbsp;<span class="ident" id="3366420">i</span>&nbsp;<span class="op" id="3366422">&lt;</span>&nbsp;<span class="builtinfunc" id="3366424">len</span><span class="op" id="3366427">(</span><span class="ident" id="3366428">s</span><span class="op" id="3366429">)</span><span class="op" id="3366430">;</span>&nbsp;<span class="ident" id="3366432">i</span><span class="op" id="3366433">++</span>&nbsp;<span class="op" id="3366436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366440">c</span>&nbsp;<span class="op" id="3366442">:=</span>&nbsp;<span class="ident" id="3366445">s</span><span class="op" id="3366446">[</span><span class="ident" id="3366447">i</span><span class="op" id="3366448">]</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366452">switch</span>&nbsp;<span class="op" id="3366459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366463">default</span><span class="op" id="3366470">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366475">return</span>&nbsp;<span class="builtintype" id="3366482">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366490">case</span>&nbsp;<span class="string" id="3366495">&#39;a&#39;</span>&nbsp;<span class="op" id="3366499">&lt;=</span>&nbsp;<span class="ident" id="3366502">c</span>&nbsp;<span class="op" id="3366504">&amp;&amp;</span>&nbsp;<span class="ident" id="3366507">c</span>&nbsp;<span class="op" id="3366509">&lt;=</span>&nbsp;<span class="string" id="3366512">&#39;z&#39;</span>&nbsp;<span class="op" id="3366516">||</span>&nbsp;<span class="string" id="3366519">&#39;A&#39;</span>&nbsp;<span class="op" id="3366523">&lt;=</span>&nbsp;<span class="ident" id="3366526">c</span>&nbsp;<span class="op" id="3366528">&amp;&amp;</span>&nbsp;<span class="ident" id="3366531">c</span>&nbsp;<span class="op" id="3366533">&lt;=</span>&nbsp;<span class="string" id="3366536">&#39;Z&#39;</span><span class="op" id="3366539">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3366544">//&nbsp;No&nbsp;&#39;_&#39;&nbsp;allowed&nbsp;here&nbsp;(in&nbsp;contrast&nbsp;to&nbsp;package&nbsp;net).</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366600">ok</span>&nbsp;<span class="op" id="3366603">=</span>&nbsp;<span class="builtintype" id="3366605">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366613">partlen</span><span class="op" id="3366620">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366625">case</span>&nbsp;<span class="string" id="3366630">&#39;0&#39;</span>&nbsp;<span class="op" id="3366634">&lt;=</span>&nbsp;<span class="ident" id="3366637">c</span>&nbsp;<span class="op" id="3366639">&amp;&amp;</span>&nbsp;<span class="ident" id="3366642">c</span>&nbsp;<span class="op" id="3366644">&lt;=</span>&nbsp;<span class="string" id="3366647">&#39;9&#39;</span><span class="op" id="3366650">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3366655">//&nbsp;fine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366666">partlen</span><span class="op" id="3366673">++</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366678">case</span>&nbsp;<span class="ident" id="3366683">c</span>&nbsp;<span class="op" id="3366685">==</span>&nbsp;<span class="string" id="3366688">&#39;-&#39;</span><span class="op" id="3366691">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3366696">//&nbsp;Byte&nbsp;before&nbsp;dash&nbsp;cannot&nbsp;be&nbsp;dot.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366734">if</span>&nbsp;<span class="ident" id="3366737">last</span>&nbsp;<span class="op" id="3366742">==</span>&nbsp;<span class="string" id="3366745">&#39;.&#39;</span>&nbsp;<span class="op" id="3366749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366755">return</span>&nbsp;<span class="builtintype" id="3366762">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3366771">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366776">partlen</span><span class="op" id="3366783">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366788">case</span>&nbsp;<span class="ident" id="3366793">c</span>&nbsp;<span class="op" id="3366795">==</span>&nbsp;<span class="string" id="3366798">&#39;.&#39;</span><span class="op" id="3366801">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3366806">//&nbsp;Byte&nbsp;before&nbsp;dot&nbsp;cannot&nbsp;be&nbsp;dot,&nbsp;dash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366849">if</span>&nbsp;<span class="ident" id="3366852">last</span>&nbsp;<span class="op" id="3366857">==</span>&nbsp;<span class="string" id="3366860">&#39;.&#39;</span>&nbsp;<span class="op" id="3366864">||</span>&nbsp;<span class="ident" id="3366867">last</span>&nbsp;<span class="op" id="3366872">==</span>&nbsp;<span class="string" id="3366875">&#39;-&#39;</span>&nbsp;<span class="op" id="3366879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366885">return</span>&nbsp;<span class="builtintype" id="3366892">false</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3366901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366906">if</span>&nbsp;<span class="ident" id="3366909">partlen</span>&nbsp;<span class="op" id="3366917">&gt;</span>&nbsp;<span class="num" id="3366919">63</span>&nbsp;<span class="op" id="3366922">||</span>&nbsp;<span class="ident" id="3366925">partlen</span>&nbsp;<span class="op" id="3366933">==</span>&nbsp;<span class="num" id="3366936">0</span>&nbsp;<span class="op" id="3366938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366944">return</span>&nbsp;<span class="builtintype" id="3366951">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3366960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366965">partlen</span>&nbsp;<span class="op" id="3366973">=</span>&nbsp;<span class="num" id="3366975">0</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3366979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366983">last</span>&nbsp;<span class="op" id="3366988">=</span>&nbsp;<span class="ident" id="3366990">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3366993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366996">if</span>&nbsp;<span class="ident" id="3366999">last</span>&nbsp;<span class="op" id="3367004">==</span>&nbsp;<span class="string" id="3367007">&#39;-&#39;</span>&nbsp;<span class="op" id="3367011">||</span>&nbsp;<span class="ident" id="3367014">partlen</span>&nbsp;<span class="op" id="3367022">&gt;</span>&nbsp;<span class="num" id="3367024">63</span>&nbsp;<span class="op" id="3367027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367031">return</span>&nbsp;<span class="builtintype" id="3367038">false</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3367045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367049">return</span>&nbsp;<span class="ident" id="3367056">ok</span><br>
<span class="lineno"></span><span class="op" id="3367059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="3367062">var</span>&nbsp;<span class="ident" id="3367066">cookieNameSanitizer</span>&nbsp;<span class="op" id="3367086">=</span>&nbsp;<span class="ident" id="3367088">strings</span><span class="op" id="3367095">.</span><span class="ident" id="3367096">NewReplacer</span><span class="op" id="3367107">(</span><span class="string" id="3367108">&#34;\n&#34;</span><span class="op" id="3367112">,</span>&nbsp;<span class="string" id="3367114">&#34;-&#34;</span><span class="op" id="3367117">,</span>&nbsp;<span class="string" id="3367119">&#34;\r&#34;</span><span class="op" id="3367123">,</span>&nbsp;<span class="string" id="3367125">&#34;-&#34;</span><span class="op" id="3367128">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3367131">func</span>&nbsp;<span class="ident" id="3367136">sanitizeCookieName</span><span class="op" id="3367154">(</span><span class="ident" id="3367155">n</span>&nbsp;<span class="builtintype" id="3367157">string</span><span class="op" id="3367163">)</span>&nbsp;<span class="builtintype" id="3367165">string</span>&nbsp;<span class="op" id="3367172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367175">return</span>&nbsp;<span class="ident" id="3367182">cookieNameSanitizer</span><span class="op" id="3367201">.</span><span class="ident" id="3367202">Replace</span><span class="op" id="3367209">(</span><span class="ident" id="3367210">n</span><span class="op" id="3367211">)</span><br>
<span class="lineno"></span><span class="op" id="3367213">}</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span><span class="comment" id="3367216">//&nbsp;http://tools.ietf.org/html/rfc6265#section-4.1.1</span><br>
<span class="lineno"></span><span class="comment" id="3367268">//&nbsp;cookie-value&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;*cookie-octet&nbsp;/&nbsp;(&nbsp;DQUOTE&nbsp;*cookie-octet&nbsp;DQUOTE&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="3367339">//&nbsp;cookie-octet&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;%x21&nbsp;/&nbsp;%x23-2B&nbsp;/&nbsp;%x2D-3A&nbsp;/&nbsp;%x3C-5B&nbsp;/&nbsp;%x5D-7E</span><br>
<span class="lineno"></span><span class="comment" id="3367407">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;US-ASCII&nbsp;characters&nbsp;excluding&nbsp;CTLs,</span><br>
<span class="lineno">295</span><span class="comment" id="3367458">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;whitespace&nbsp;DQUOTE,&nbsp;comma,&nbsp;semicolon,</span><br>
<span class="lineno"></span><span class="comment" id="3367510">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;and&nbsp;backslash</span><br>
<span class="lineno"></span><span class="comment" id="3367539">//&nbsp;We&nbsp;loosen&nbsp;this&nbsp;as&nbsp;spaces&nbsp;and&nbsp;commas&nbsp;are&nbsp;common&nbsp;in&nbsp;cookie&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="3367606">//&nbsp;but&nbsp;we&nbsp;produce&nbsp;a&nbsp;quoted&nbsp;cookie-value&nbsp;in&nbsp;when&nbsp;value&nbsp;starts&nbsp;or&nbsp;ends</span><br>
<span class="lineno"></span><span class="comment" id="3367675">//&nbsp;with&nbsp;a&nbsp;comma&nbsp;or&nbsp;space.</span><br>
<span class="lineno">300</span><span class="comment" id="3367701">//&nbsp;See&nbsp;http://golang.org/issue/7243&nbsp;for&nbsp;the&nbsp;discussion.</span><br>
<span class="lineno"></span><span class="keyword" id="3367757">func</span>&nbsp;<span class="ident" id="3367762">sanitizeCookieValue</span><span class="op" id="3367781">(</span><span class="ident" id="3367782">v</span>&nbsp;<span class="builtintype" id="3367784">string</span><span class="op" id="3367790">)</span>&nbsp;<span class="builtintype" id="3367792">string</span>&nbsp;<span class="op" id="3367799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367802">v</span>&nbsp;<span class="op" id="3367804">=</span>&nbsp;<span class="ident" id="3367806">sanitizeOrWarn</span><span class="op" id="3367820">(</span><span class="string" id="3367821">&#34;Cookie.Value&#34;</span><span class="op" id="3367835">,</span>&nbsp;<span class="ident" id="3367837">validCookieValueByte</span><span class="op" id="3367857">,</span>&nbsp;<span class="ident" id="3367859">v</span><span class="op" id="3367860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367863">if</span>&nbsp;<span class="builtinfunc" id="3367866">len</span><span class="op" id="3367869">(</span><span class="ident" id="3367870">v</span><span class="op" id="3367871">)</span>&nbsp;<span class="op" id="3367873">==</span>&nbsp;<span class="num" id="3367876">0</span>&nbsp;<span class="op" id="3367878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367882">return</span>&nbsp;<span class="ident" id="3367889">v</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3367892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367895">if</span>&nbsp;<span class="ident" id="3367898">v</span><span class="op" id="3367899">[</span><span class="num" id="3367900">0</span><span class="op" id="3367901">]</span>&nbsp;<span class="op" id="3367903">==</span>&nbsp;<span class="string" id="3367906">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3367910">||</span>&nbsp;<span class="ident" id="3367913">v</span><span class="op" id="3367914">[</span><span class="num" id="3367915">0</span><span class="op" id="3367916">]</span>&nbsp;<span class="op" id="3367918">==</span>&nbsp;<span class="string" id="3367921">&#39;,&#39;</span>&nbsp;<span class="op" id="3367925">||</span>&nbsp;<span class="ident" id="3367928">v</span><span class="op" id="3367929">[</span><span class="builtinfunc" id="3367930">len</span><span class="op" id="3367933">(</span><span class="ident" id="3367934">v</span><span class="op" id="3367935">)</span><span class="op" id="3367936">-</span><span class="num" id="3367937">1</span><span class="op" id="3367938">]</span>&nbsp;<span class="op" id="3367940">==</span>&nbsp;<span class="string" id="3367943">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3367947">||</span>&nbsp;<span class="ident" id="3367950">v</span><span class="op" id="3367951">[</span><span class="builtinfunc" id="3367952">len</span><span class="op" id="3367955">(</span><span class="ident" id="3367956">v</span><span class="op" id="3367957">)</span><span class="op" id="3367958">-</span><span class="num" id="3367959">1</span><span class="op" id="3367960">]</span>&nbsp;<span class="op" id="3367962">==</span>&nbsp;<span class="string" id="3367965">&#39;,&#39;</span>&nbsp;<span class="op" id="3367969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367973">return</span>&nbsp;<span class="string" id="3367980">`&#34;`</span>&nbsp;<span class="op" id="3367984">+</span>&nbsp;<span class="ident" id="3367986">v</span>&nbsp;<span class="op" id="3367988">+</span>&nbsp;<span class="string" id="3367990">`&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3367995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367998">return</span>&nbsp;<span class="ident" id="3368005">v</span><br>
<span class="lineno">310</span><span class="op" id="3368007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3368010">func</span>&nbsp;<span class="ident" id="3368015">validCookieValueByte</span><span class="op" id="3368035">(</span><span class="ident" id="3368036">b</span>&nbsp;<span class="builtintype" id="3368038">byte</span><span class="op" id="3368042">)</span>&nbsp;<span class="builtintype" id="3368044">bool</span>&nbsp;<span class="op" id="3368049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368052">return</span>&nbsp;<span class="num" id="3368059">0x20</span>&nbsp;<span class="op" id="3368064">&lt;=</span>&nbsp;<span class="ident" id="3368067">b</span>&nbsp;<span class="op" id="3368069">&amp;&amp;</span>&nbsp;<span class="ident" id="3368072">b</span>&nbsp;<span class="op" id="3368074">&lt;</span>&nbsp;<span class="num" id="3368076">0x7f</span>&nbsp;<span class="op" id="3368081">&amp;&amp;</span>&nbsp;<span class="ident" id="3368084">b</span>&nbsp;<span class="op" id="3368086">!=</span>&nbsp;<span class="string" id="3368089">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="3368093">&amp;&amp;</span>&nbsp;<span class="ident" id="3368096">b</span>&nbsp;<span class="op" id="3368098">!=</span>&nbsp;<span class="string" id="3368101">&#39;;&#39;</span>&nbsp;<span class="op" id="3368105">&amp;&amp;</span>&nbsp;<span class="ident" id="3368108">b</span>&nbsp;<span class="op" id="3368110">!=</span>&nbsp;<span class="string" id="3368113">&#39;\\&#39;</span><br>
<span class="lineno"></span><span class="op" id="3368118">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="comment" id="3368121">//&nbsp;path-av&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&#34;Path=&#34;&nbsp;path-value</span><br>
<span class="lineno"></span><span class="comment" id="3368163">//&nbsp;path-value&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&lt;any&nbsp;CHAR&nbsp;except&nbsp;CTLs&nbsp;or&nbsp;&#34;;&#34;&gt;</span><br>
<span class="lineno"></span><span class="keyword" id="3368216">func</span>&nbsp;<span class="ident" id="3368221">sanitizeCookiePath</span><span class="op" id="3368239">(</span><span class="ident" id="3368240">v</span>&nbsp;<span class="builtintype" id="3368242">string</span><span class="op" id="3368248">)</span>&nbsp;<span class="builtintype" id="3368250">string</span>&nbsp;<span class="op" id="3368257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368260">return</span>&nbsp;<span class="ident" id="3368267">sanitizeOrWarn</span><span class="op" id="3368281">(</span><span class="string" id="3368282">&#34;Cookie.Path&#34;</span><span class="op" id="3368295">,</span>&nbsp;<span class="ident" id="3368297">validCookiePathByte</span><span class="op" id="3368316">,</span>&nbsp;<span class="ident" id="3368318">v</span><span class="op" id="3368319">)</span><br>
<span class="lineno">320</span><span class="op" id="3368321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3368324">func</span>&nbsp;<span class="ident" id="3368329">validCookiePathByte</span><span class="op" id="3368348">(</span><span class="ident" id="3368349">b</span>&nbsp;<span class="builtintype" id="3368351">byte</span><span class="op" id="3368355">)</span>&nbsp;<span class="builtintype" id="3368357">bool</span>&nbsp;<span class="op" id="3368362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368365">return</span>&nbsp;<span class="num" id="3368372">0x20</span>&nbsp;<span class="op" id="3368377">&lt;=</span>&nbsp;<span class="ident" id="3368380">b</span>&nbsp;<span class="op" id="3368382">&amp;&amp;</span>&nbsp;<span class="ident" id="3368385">b</span>&nbsp;<span class="op" id="3368387">&lt;</span>&nbsp;<span class="num" id="3368389">0x7f</span>&nbsp;<span class="op" id="3368394">&amp;&amp;</span>&nbsp;<span class="ident" id="3368397">b</span>&nbsp;<span class="op" id="3368399">!=</span>&nbsp;<span class="string" id="3368402">&#39;;&#39;</span><br>
<span class="lineno"></span><span class="op" id="3368406">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="keyword" id="3368409">func</span>&nbsp;<span class="ident" id="3368414">sanitizeOrWarn</span><span class="op" id="3368428">(</span><span class="ident" id="3368429">fieldName</span>&nbsp;<span class="builtintype" id="3368439">string</span><span class="op" id="3368445">,</span>&nbsp;<span class="ident" id="3368447">valid</span>&nbsp;<span class="keyword" id="3368453">func</span><span class="op" id="3368457">(</span><span class="builtintype" id="3368458">byte</span><span class="op" id="3368462">)</span>&nbsp;<span class="builtintype" id="3368464">bool</span><span class="op" id="3368468">,</span>&nbsp;<span class="ident" id="3368470">v</span>&nbsp;<span class="builtintype" id="3368472">string</span><span class="op" id="3368478">)</span>&nbsp;<span class="builtintype" id="3368480">string</span>&nbsp;<span class="op" id="3368487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368490">ok</span>&nbsp;<span class="op" id="3368493">:=</span>&nbsp;<span class="builtintype" id="3368496">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368502">for</span>&nbsp;<span class="ident" id="3368506">i</span>&nbsp;<span class="op" id="3368508">:=</span>&nbsp;<span class="num" id="3368511">0</span><span class="op" id="3368512">;</span>&nbsp;<span class="ident" id="3368514">i</span>&nbsp;<span class="op" id="3368516">&lt;</span>&nbsp;<span class="builtinfunc" id="3368518">len</span><span class="op" id="3368521">(</span><span class="ident" id="3368522">v</span><span class="op" id="3368523">)</span><span class="op" id="3368524">;</span>&nbsp;<span class="ident" id="3368526">i</span><span class="op" id="3368527">++</span>&nbsp;<span class="op" id="3368530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368534">if</span>&nbsp;<span class="ident" id="3368537">valid</span><span class="op" id="3368542">(</span><span class="ident" id="3368543">v</span><span class="op" id="3368544">[</span><span class="ident" id="3368545">i</span><span class="op" id="3368546">]</span><span class="op" id="3368547">)</span>&nbsp;<span class="op" id="3368549">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368554">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3368565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368569">log</span><span class="op" id="3368572">.</span><span class="ident" id="3368573">Printf</span><span class="op" id="3368579">(</span><span class="string" id="3368580">&#34;net/http:&nbsp;invalid&nbsp;byte&nbsp;%q&nbsp;in&nbsp;%s;&nbsp;dropping&nbsp;invalid&nbsp;bytes&#34;</span><span class="op" id="3368637">,</span>&nbsp;<span class="ident" id="3368639">v</span><span class="op" id="3368640">[</span><span class="ident" id="3368641">i</span><span class="op" id="3368642">]</span><span class="op" id="3368643">,</span>&nbsp;<span class="ident" id="3368645">fieldName</span><span class="op" id="3368654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368658">ok</span>&nbsp;<span class="op" id="3368661">=</span>&nbsp;<span class="builtintype" id="3368663">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368671">break</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3368678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368681">if</span>&nbsp;<span class="ident" id="3368684">ok</span>&nbsp;<span class="op" id="3368687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368691">return</span>&nbsp;<span class="ident" id="3368698">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3368701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368704">buf</span>&nbsp;<span class="op" id="3368708">:=</span>&nbsp;<span class="builtinfunc" id="3368711">make</span><span class="op" id="3368715">(</span><span class="op" id="3368716">[</span><span class="op" id="3368717">]</span><span class="builtintype" id="3368718">byte</span><span class="op" id="3368722">,</span>&nbsp;<span class="num" id="3368724">0</span><span class="op" id="3368725">,</span>&nbsp;<span class="builtinfunc" id="3368727">len</span><span class="op" id="3368730">(</span><span class="ident" id="3368731">v</span><span class="op" id="3368732">)</span><span class="op" id="3368733">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368736">for</span>&nbsp;<span class="ident" id="3368740">i</span>&nbsp;<span class="op" id="3368742">:=</span>&nbsp;<span class="num" id="3368745">0</span><span class="op" id="3368746">;</span>&nbsp;<span class="ident" id="3368748">i</span>&nbsp;<span class="op" id="3368750">&lt;</span>&nbsp;<span class="builtinfunc" id="3368752">len</span><span class="op" id="3368755">(</span><span class="ident" id="3368756">v</span><span class="op" id="3368757">)</span><span class="op" id="3368758">;</span>&nbsp;<span class="ident" id="3368760">i</span><span class="op" id="3368761">++</span>&nbsp;<span class="op" id="3368764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368768">if</span>&nbsp;<span class="ident" id="3368771">b</span>&nbsp;<span class="op" id="3368773">:=</span>&nbsp;<span class="ident" id="3368776">v</span><span class="op" id="3368777">[</span><span class="ident" id="3368778">i</span><span class="op" id="3368779">]</span><span class="op" id="3368780">;</span>&nbsp;<span class="ident" id="3368782">valid</span><span class="op" id="3368787">(</span><span class="ident" id="3368788">b</span><span class="op" id="3368789">)</span>&nbsp;<span class="op" id="3368791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368796">buf</span>&nbsp;<span class="op" id="3368800">=</span>&nbsp;<span class="builtinfunc" id="3368802">append</span><span class="op" id="3368808">(</span><span class="ident" id="3368809">buf</span><span class="op" id="3368812">,</span>&nbsp;<span class="ident" id="3368814">b</span><span class="op" id="3368815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3368819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3368822">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368825">return</span>&nbsp;<span class="builtintype" id="3368832">string</span><span class="op" id="3368838">(</span><span class="ident" id="3368839">buf</span><span class="op" id="3368842">)</span><br>
<span class="lineno"></span><span class="op" id="3368844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3368847">func</span>&nbsp;<span class="ident" id="3368852">parseCookieValue</span><span class="op" id="3368868">(</span><span class="ident" id="3368869">raw</span>&nbsp;<span class="builtintype" id="3368873">string</span><span class="op" id="3368879">,</span>&nbsp;<span class="ident" id="3368881">allowDoubleQuote</span>&nbsp;<span class="builtintype" id="3368898">bool</span><span class="op" id="3368902">)</span>&nbsp;<span class="op" id="3368904">(</span><span class="builtintype" id="3368905">string</span><span class="op" id="3368911">,</span>&nbsp;<span class="builtintype" id="3368913">bool</span><span class="op" id="3368917">)</span>&nbsp;<span class="op" id="3368919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3368922">//&nbsp;Strip&nbsp;the&nbsp;quotes,&nbsp;if&nbsp;present.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368956">if</span>&nbsp;<span class="ident" id="3368959">allowDoubleQuote</span>&nbsp;<span class="op" id="3368976">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3368979">len</span><span class="op" id="3368982">(</span><span class="ident" id="3368983">raw</span><span class="op" id="3368986">)</span>&nbsp;<span class="op" id="3368988">&gt;</span>&nbsp;<span class="num" id="3368990">1</span>&nbsp;<span class="op" id="3368992">&amp;&amp;</span>&nbsp;<span class="ident" id="3368995">raw</span><span class="op" id="3368998">[</span><span class="num" id="3368999">0</span><span class="op" id="3369000">]</span>&nbsp;<span class="op" id="3369002">==</span>&nbsp;<span class="string" id="3369005">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="3369009">&amp;&amp;</span>&nbsp;<span class="ident" id="3369012">raw</span><span class="op" id="3369015">[</span><span class="builtinfunc" id="3369016">len</span><span class="op" id="3369019">(</span><span class="ident" id="3369020">raw</span><span class="op" id="3369023">)</span><span class="op" id="3369024">-</span><span class="num" id="3369025">1</span><span class="op" id="3369026">]</span>&nbsp;<span class="op" id="3369028">==</span>&nbsp;<span class="string" id="3369031">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="3369035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3369039">raw</span>&nbsp;<span class="op" id="3369043">=</span>&nbsp;<span class="ident" id="3369045">raw</span><span class="op" id="3369048">[</span><span class="num" id="3369049">1</span>&nbsp;<span class="op" id="3369051">:</span>&nbsp;<span class="builtinfunc" id="3369053">len</span><span class="op" id="3369056">(</span><span class="ident" id="3369057">raw</span><span class="op" id="3369060">)</span><span class="op" id="3369061">-</span><span class="num" id="3369062">1</span><span class="op" id="3369063">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3369066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369069">for</span>&nbsp;<span class="ident" id="3369073">i</span>&nbsp;<span class="op" id="3369075">:=</span>&nbsp;<span class="num" id="3369078">0</span><span class="op" id="3369079">;</span>&nbsp;<span class="ident" id="3369081">i</span>&nbsp;<span class="op" id="3369083">&lt;</span>&nbsp;<span class="builtinfunc" id="3369085">len</span><span class="op" id="3369088">(</span><span class="ident" id="3369089">raw</span><span class="op" id="3369092">)</span><span class="op" id="3369093">;</span>&nbsp;<span class="ident" id="3369095">i</span><span class="op" id="3369096">++</span>&nbsp;<span class="op" id="3369099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369103">if</span>&nbsp;<span class="op" id="3369106">!</span><span class="ident" id="3369107">validCookieValueByte</span><span class="op" id="3369127">(</span><span class="ident" id="3369128">raw</span><span class="op" id="3369131">[</span><span class="ident" id="3369132">i</span><span class="op" id="3369133">]</span><span class="op" id="3369134">)</span>&nbsp;<span class="op" id="3369136">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369141">return</span>&nbsp;<span class="string" id="3369148">&#34;&#34;</span><span class="op" id="3369150">,</span>&nbsp;<span class="builtintype" id="3369152">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3369160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3369163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369166">return</span>&nbsp;<span class="ident" id="3369173">raw</span><span class="op" id="3369176">,</span>&nbsp;<span class="builtintype" id="3369178">true</span><br>
<span class="lineno"></span><span class="op" id="3369183">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="keyword" id="3369186">func</span>&nbsp;<span class="ident" id="3369191">isCookieNameValid</span><span class="op" id="3369208">(</span><span class="ident" id="3369209">raw</span>&nbsp;<span class="builtintype" id="3369213">string</span><span class="op" id="3369219">)</span>&nbsp;<span class="builtintype" id="3369221">bool</span>&nbsp;<span class="op" id="3369226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369229">return</span>&nbsp;<span class="ident" id="3369236">strings</span><span class="op" id="3369243">.</span><span class="ident" id="3369244">IndexFunc</span><span class="op" id="3369253">(</span><span class="ident" id="3369254">raw</span><span class="op" id="3369257">,</span>&nbsp;<span class="ident" id="3369259">isNotToken</span><span class="op" id="3369269">)</span>&nbsp;<span class="op" id="3369271">&lt;</span>&nbsp;<span class="num" id="3369273">0</span><br>
<span class="lineno"></span><span class="op" id="3369275">}</span>
</div>
</body>
</html>
