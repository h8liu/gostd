<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rsa</h2>
<ul>
<li><a href="/gostd/crypto/rsa/pkcs1v15.go.html">pkcs1v15.go</a></li>
<li><a href="/gostd/crypto/rsa/pkcs1v15_test.go.html">pkcs1v15_test.go</a></li>
<li><a href="/gostd/crypto/rsa/pss.go.html">pss.go</a></li>
<li><a href="/gostd/crypto/rsa/pss_test.go.html">pss_test.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa.go.html" class="current">rsa.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa_test.go.html">rsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3927091">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3927146">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3927200">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3927251">//&nbsp;Package&nbsp;rsa&nbsp;implements&nbsp;RSA&nbsp;encryption&nbsp;as&nbsp;specified&nbsp;in&nbsp;PKCS#1.</span><br>
<span class="lineno"></span><span class="keyword" id="3927316">package</span>&nbsp;<span class="ident" id="3927324">rsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3927329">import</span>&nbsp;<span class="op" id="3927336">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3927339">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3927349">&#34;crypto/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3927364">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3927381">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3927391">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3927399">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3927405">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="3927416">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3927419">var</span>&nbsp;<span class="ident" id="3927423">bigZero</span>&nbsp;<span class="op" id="3927431">=</span>&nbsp;<span class="ident" id="3927433">big</span><span class="op" id="3927436">.</span><span class="ident" id="3927437">NewInt</span><span class="op" id="3927443">(</span><span class="num" id="3927444">0</span><span class="op" id="3927445">)</span><br>
<span class="lineno"></span><span class="keyword" id="3927447">var</span>&nbsp;<span class="ident" id="3927451">bigOne</span>&nbsp;<span class="op" id="3927458">=</span>&nbsp;<span class="ident" id="3927460">big</span><span class="op" id="3927463">.</span><span class="ident" id="3927464">NewInt</span><span class="op" id="3927470">(</span><span class="num" id="3927471">1</span><span class="op" id="3927472">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="3927475">//&nbsp;A&nbsp;PublicKey&nbsp;represents&nbsp;the&nbsp;public&nbsp;part&nbsp;of&nbsp;an&nbsp;RSA&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3927532">type</span>&nbsp;<span class="ident" id="3927537">PublicKey</span>&nbsp;<span class="keyword" id="3927547">struct</span>&nbsp;<span class="op" id="3927554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3927557">N</span>&nbsp;<span class="op" id="3927559">*</span><span class="ident" id="3927560">big</span><span class="op" id="3927563">.</span><span class="ident" id="3927564">Int</span>&nbsp;<span class="comment" id="3927568">//&nbsp;modulus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3927580">E</span>&nbsp;<span class="builtintype" id="3927582">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3927591">//&nbsp;public&nbsp;exponent</span><br>
<span class="lineno">25</span><span class="op" id="3927610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3927613">var</span>&nbsp;<span class="op" id="3927617">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3927620">errPublicModulus</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3927643">=</span>&nbsp;<span class="ident" id="3927645">errors</span><span class="op" id="3927651">.</span><span class="ident" id="3927652">New</span><span class="op" id="3927655">(</span><span class="string" id="3927656">&#34;crypto/rsa:&nbsp;missing&nbsp;public&nbsp;modulus&#34;</span><span class="op" id="3927692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3927695">errPublicExponentSmall</span>&nbsp;<span class="op" id="3927718">=</span>&nbsp;<span class="ident" id="3927720">errors</span><span class="op" id="3927726">.</span><span class="ident" id="3927727">New</span><span class="op" id="3927730">(</span><span class="string" id="3927731">&#34;crypto/rsa:&nbsp;public&nbsp;exponent&nbsp;too&nbsp;small&#34;</span><span class="op" id="3927770">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3927773">errPublicExponentLarge</span>&nbsp;<span class="op" id="3927796">=</span>&nbsp;<span class="ident" id="3927798">errors</span><span class="op" id="3927804">.</span><span class="ident" id="3927805">New</span><span class="op" id="3927808">(</span><span class="string" id="3927809">&#34;crypto/rsa:&nbsp;public&nbsp;exponent&nbsp;too&nbsp;large&#34;</span><span class="op" id="3927848">)</span><br>
<span class="lineno"></span><span class="op" id="3927850">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3927853">//&nbsp;checkPub&nbsp;sanity&nbsp;checks&nbsp;the&nbsp;public&nbsp;key&nbsp;before&nbsp;we&nbsp;use&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="3927912">//&nbsp;We&nbsp;require&nbsp;pub.E&nbsp;to&nbsp;fit&nbsp;into&nbsp;a&nbsp;32-bit&nbsp;integer&nbsp;so&nbsp;that&nbsp;we</span><br>
<span class="lineno">35</span><span class="comment" id="3927972">//&nbsp;do&nbsp;not&nbsp;have&nbsp;different&nbsp;behavior&nbsp;depending&nbsp;on&nbsp;whether</span><br>
<span class="lineno"></span><span class="comment" id="3928027">//&nbsp;int&nbsp;is&nbsp;32&nbsp;or&nbsp;64&nbsp;bits.&nbsp;See&nbsp;also</span><br>
<span class="lineno"></span><span class="comment" id="3928061">//&nbsp;http://www.imperialviolet.org/2012/03/16/rsae.html.</span><br>
<span class="lineno"></span><span class="keyword" id="3928116">func</span>&nbsp;<span class="ident" id="3928121">checkPub</span><span class="op" id="3928129">(</span><span class="ident" id="3928130">pub</span>&nbsp;<span class="op" id="3928134">*</span><span class="ident" id="3928135">PublicKey</span><span class="op" id="3928144">)</span>&nbsp;<span class="builtintype" id="3928146">error</span>&nbsp;<span class="op" id="3928152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928155">if</span>&nbsp;<span class="ident" id="3928158">pub</span><span class="op" id="3928161">.</span><span class="ident" id="3928162">N</span>&nbsp;<span class="op" id="3928164">==</span>&nbsp;<span class="ident" id="3928167">nil</span>&nbsp;<span class="op" id="3928171">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928175">return</span>&nbsp;<span class="ident" id="3928182">errPublicModulus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3928200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928203">if</span>&nbsp;<span class="ident" id="3928206">pub</span><span class="op" id="3928209">.</span><span class="ident" id="3928210">E</span>&nbsp;<span class="op" id="3928212">&lt;</span>&nbsp;<span class="num" id="3928214">2</span>&nbsp;<span class="op" id="3928216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928220">return</span>&nbsp;<span class="ident" id="3928227">errPublicExponentSmall</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3928251">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928254">if</span>&nbsp;<span class="ident" id="3928257">pub</span><span class="op" id="3928260">.</span><span class="ident" id="3928261">E</span>&nbsp;<span class="op" id="3928263">&gt;</span>&nbsp;<span class="num" id="3928265">1</span><span class="op" id="3928266">&lt;&lt;</span><span class="num" id="3928268">31</span><span class="op" id="3928270">-</span><span class="num" id="3928271">1</span>&nbsp;<span class="op" id="3928273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928277">return</span>&nbsp;<span class="ident" id="3928284">errPublicExponentLarge</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3928308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928311">return</span>&nbsp;<span class="ident" id="3928318">nil</span><br>
<span class="lineno"></span><span class="op" id="3928322">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="3928325">//&nbsp;A&nbsp;PrivateKey&nbsp;represents&nbsp;an&nbsp;RSA&nbsp;key</span><br>
<span class="lineno"></span><span class="keyword" id="3928363">type</span>&nbsp;<span class="ident" id="3928368">PrivateKey</span>&nbsp;<span class="keyword" id="3928379">struct</span>&nbsp;<span class="op" id="3928386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3928389">PublicKey</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3928410">//&nbsp;public&nbsp;part.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3928427">D</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3928437">*</span><span class="ident" id="3928438">big</span><span class="op" id="3928441">.</span><span class="ident" id="3928442">Int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3928448">//&nbsp;private&nbsp;exponent</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3928469">Primes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3928479">[</span><span class="op" id="3928480">]</span><span class="op" id="3928481">*</span><span class="ident" id="3928482">big</span><span class="op" id="3928485">.</span><span class="ident" id="3928486">Int</span>&nbsp;<span class="comment" id="3928490">//&nbsp;prime&nbsp;factors&nbsp;of&nbsp;N,&nbsp;has&nbsp;&gt;=&nbsp;2&nbsp;elements.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3928534">//&nbsp;Precomputed&nbsp;contains&nbsp;precomputed&nbsp;values&nbsp;that&nbsp;speed&nbsp;up&nbsp;private</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3928600">//&nbsp;operations,&nbsp;if&nbsp;available.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3928630">Precomputed</span>&nbsp;<span class="ident" id="3928642">PrecomputedValues</span><br>
<span class="lineno">60</span><span class="op" id="3928660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3928663">//&nbsp;Public&nbsp;returns&nbsp;the&nbsp;public&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;priv.</span><br>
<span class="lineno"></span><span class="keyword" id="3928719">func</span>&nbsp;<span class="op" id="3928724">(</span><span class="ident" id="3928725">priv</span>&nbsp;<span class="op" id="3928730">*</span><span class="ident" id="3928731">PrivateKey</span><span class="op" id="3928741">)</span>&nbsp;<span class="ident" id="3928743">Public</span><span class="op" id="3928749">(</span><span class="op" id="3928750">)</span>&nbsp;<span class="ident" id="3928752">crypto</span><span class="op" id="3928758">.</span><span class="ident" id="3928759">PublicKey</span>&nbsp;<span class="op" id="3928769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928772">return</span>&nbsp;<span class="op" id="3928779">&amp;</span><span class="ident" id="3928780">priv</span><span class="op" id="3928784">.</span><span class="ident" id="3928785">PublicKey</span><br>
<span class="lineno">65</span><span class="op" id="3928795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3928798">//&nbsp;Sign&nbsp;signs&nbsp;msg&nbsp;with&nbsp;priv,&nbsp;reading&nbsp;randomness&nbsp;from&nbsp;rand.&nbsp;If&nbsp;opts&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3928870">//&nbsp;*PSSOptions&nbsp;then&nbsp;the&nbsp;PSS&nbsp;algorithm&nbsp;will&nbsp;be&nbsp;used,&nbsp;otherwise&nbsp;PKCS#1&nbsp;v1.5&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="3928949">//&nbsp;be&nbsp;used.&nbsp;This&nbsp;method&nbsp;is&nbsp;intended&nbsp;to&nbsp;support&nbsp;keys&nbsp;where&nbsp;the&nbsp;private&nbsp;part&nbsp;is</span><br>
<span class="lineno">70</span><span class="comment" id="3929027">//&nbsp;kept&nbsp;in,&nbsp;for&nbsp;example,&nbsp;a&nbsp;hardware&nbsp;module.&nbsp;Common&nbsp;uses&nbsp;should&nbsp;use&nbsp;the&nbsp;Sign*</span><br>
<span class="lineno"></span><span class="comment" id="3929104">//&nbsp;functions&nbsp;in&nbsp;this&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="3929134">func</span>&nbsp;<span class="op" id="3929139">(</span><span class="ident" id="3929140">priv</span>&nbsp;<span class="op" id="3929145">*</span><span class="ident" id="3929146">PrivateKey</span><span class="op" id="3929156">)</span>&nbsp;<span class="ident" id="3929158">Sign</span><span class="op" id="3929162">(</span><span class="ident" id="3929163">rand</span>&nbsp;<span class="ident" id="3929168">io</span><span class="op" id="3929170">.</span><span class="ident" id="3929171">Reader</span><span class="op" id="3929177">,</span>&nbsp;<span class="ident" id="3929179">msg</span>&nbsp;<span class="op" id="3929183">[</span><span class="op" id="3929184">]</span><span class="builtintype" id="3929185">byte</span><span class="op" id="3929189">,</span>&nbsp;<span class="ident" id="3929191">opts</span>&nbsp;<span class="ident" id="3929196">crypto</span><span class="op" id="3929202">.</span><span class="ident" id="3929203">SignerOpts</span><span class="op" id="3929213">)</span>&nbsp;<span class="op" id="3929215">(</span><span class="op" id="3929216">[</span><span class="op" id="3929217">]</span><span class="builtintype" id="3929218">byte</span><span class="op" id="3929222">,</span>&nbsp;<span class="builtintype" id="3929224">error</span><span class="op" id="3929229">)</span>&nbsp;<span class="op" id="3929231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3929234">if</span>&nbsp;<span class="ident" id="3929237">pssOpts</span><span class="op" id="3929244">,</span>&nbsp;<span class="ident" id="3929246">ok</span>&nbsp;<span class="op" id="3929249">:=</span>&nbsp;<span class="ident" id="3929252">opts</span><span class="op" id="3929256">.</span><span class="op" id="3929257">(</span><span class="op" id="3929258">*</span><span class="ident" id="3929259">PSSOptions</span><span class="op" id="3929269">)</span><span class="op" id="3929270">;</span>&nbsp;<span class="ident" id="3929272">ok</span>&nbsp;<span class="op" id="3929275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3929279">return</span>&nbsp;<span class="ident" id="3929286">SignPSS</span><span class="op" id="3929293">(</span><span class="ident" id="3929294">rand</span><span class="op" id="3929298">,</span>&nbsp;<span class="ident" id="3929300">priv</span><span class="op" id="3929304">,</span>&nbsp;<span class="ident" id="3929306">pssOpts</span><span class="op" id="3929313">.</span><span class="ident" id="3929314">Hash</span><span class="op" id="3929318">,</span>&nbsp;<span class="ident" id="3929320">msg</span><span class="op" id="3929323">,</span>&nbsp;<span class="ident" id="3929325">pssOpts</span><span class="op" id="3929332">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3929335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3929339">return</span>&nbsp;<span class="ident" id="3929346">SignPKCS1v15</span><span class="op" id="3929358">(</span><span class="ident" id="3929359">rand</span><span class="op" id="3929363">,</span>&nbsp;<span class="ident" id="3929365">priv</span><span class="op" id="3929369">,</span>&nbsp;<span class="ident" id="3929371">opts</span><span class="op" id="3929375">.</span><span class="ident" id="3929376">HashFunc</span><span class="op" id="3929384">(</span><span class="op" id="3929385">)</span><span class="op" id="3929386">,</span>&nbsp;<span class="ident" id="3929388">msg</span><span class="op" id="3929391">)</span><br>
<span class="lineno"></span><span class="op" id="3929393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="3929396">type</span>&nbsp;<span class="ident" id="3929401">PrecomputedValues</span>&nbsp;<span class="keyword" id="3929419">struct</span>&nbsp;<span class="op" id="3929426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929429">Dp</span><span class="op" id="3929431">,</span>&nbsp;<span class="ident" id="3929433">Dq</span>&nbsp;<span class="op" id="3929436">*</span><span class="ident" id="3929437">big</span><span class="op" id="3929440">.</span><span class="ident" id="3929441">Int</span>&nbsp;<span class="comment" id="3929445">//&nbsp;D&nbsp;mod&nbsp;(P-1)&nbsp;(or&nbsp;mod&nbsp;Q-1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929474">Qinv</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3929481">*</span><span class="ident" id="3929482">big</span><span class="op" id="3929485">.</span><span class="ident" id="3929486">Int</span>&nbsp;<span class="comment" id="3929490">//&nbsp;Q^-1&nbsp;mod&nbsp;P</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3929506">//&nbsp;CRTValues&nbsp;is&nbsp;used&nbsp;for&nbsp;the&nbsp;3rd&nbsp;and&nbsp;subsequent&nbsp;primes.&nbsp;Due&nbsp;to&nbsp;a</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3929572">//&nbsp;historical&nbsp;accident,&nbsp;the&nbsp;CRT&nbsp;for&nbsp;the&nbsp;first&nbsp;two&nbsp;primes&nbsp;is&nbsp;handled</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3929641">//&nbsp;differently&nbsp;in&nbsp;PKCS#1&nbsp;and&nbsp;interoperability&nbsp;is&nbsp;sufficiently</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3929704">//&nbsp;important&nbsp;that&nbsp;we&nbsp;mirror&nbsp;this.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929739">CRTValues</span>&nbsp;<span class="op" id="3929749">[</span><span class="op" id="3929750">]</span><span class="ident" id="3929751">CRTValue</span><br>
<span class="lineno"></span><span class="op" id="3929760">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="3929763">//&nbsp;CRTValue&nbsp;contains&nbsp;the&nbsp;precomputed&nbsp;chinese&nbsp;remainder&nbsp;theorem&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="3929834">type</span>&nbsp;<span class="ident" id="3929839">CRTValue</span>&nbsp;<span class="keyword" id="3929848">struct</span>&nbsp;<span class="op" id="3929855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929858">Exp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3929864">*</span><span class="ident" id="3929865">big</span><span class="op" id="3929868">.</span><span class="ident" id="3929869">Int</span>&nbsp;<span class="comment" id="3929873">//&nbsp;D&nbsp;mod&nbsp;(prime-1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929894">Coeff</span>&nbsp;<span class="op" id="3929900">*</span><span class="ident" id="3929901">big</span><span class="op" id="3929904">.</span><span class="ident" id="3929905">Int</span>&nbsp;<span class="comment" id="3929909">//&nbsp;R·Coeff&nbsp;≡&nbsp;1&nbsp;mod&nbsp;Prime.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929939">R</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3929945">*</span><span class="ident" id="3929946">big</span><span class="op" id="3929949">.</span><span class="ident" id="3929950">Int</span>&nbsp;<span class="comment" id="3929954">//&nbsp;product&nbsp;of&nbsp;primes&nbsp;prior&nbsp;to&nbsp;this&nbsp;(inc&nbsp;p&nbsp;and&nbsp;q).</span><br>
<span class="lineno"></span><span class="op" id="3930004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3930007">//&nbsp;Validate&nbsp;performs&nbsp;basic&nbsp;sanity&nbsp;checks&nbsp;on&nbsp;the&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="3930060">//&nbsp;It&nbsp;returns&nbsp;nil&nbsp;if&nbsp;the&nbsp;key&nbsp;is&nbsp;valid,&nbsp;or&nbsp;else&nbsp;an&nbsp;error&nbsp;describing&nbsp;a&nbsp;problem.</span><br>
<span class="lineno">100</span><span class="keyword" id="3930138">func</span>&nbsp;<span class="op" id="3930143">(</span><span class="ident" id="3930144">priv</span>&nbsp;<span class="op" id="3930149">*</span><span class="ident" id="3930150">PrivateKey</span><span class="op" id="3930160">)</span>&nbsp;<span class="ident" id="3930162">Validate</span><span class="op" id="3930170">(</span><span class="op" id="3930171">)</span>&nbsp;<span class="builtintype" id="3930173">error</span>&nbsp;<span class="op" id="3930179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3930182">if</span>&nbsp;<span class="ident" id="3930185">err</span>&nbsp;<span class="op" id="3930189">:=</span>&nbsp;<span class="ident" id="3930192">checkPub</span><span class="op" id="3930200">(</span><span class="op" id="3930201">&amp;</span><span class="ident" id="3930202">priv</span><span class="op" id="3930206">.</span><span class="ident" id="3930207">PublicKey</span><span class="op" id="3930216">)</span><span class="op" id="3930217">;</span>&nbsp;<span class="ident" id="3930219">err</span>&nbsp;<span class="op" id="3930223">!=</span>&nbsp;<span class="ident" id="3930226">nil</span>&nbsp;<span class="op" id="3930230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3930234">return</span>&nbsp;<span class="ident" id="3930241">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3930246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3930250">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;prime&nbsp;factors&nbsp;are&nbsp;actually&nbsp;prime.&nbsp;Note&nbsp;that&nbsp;this&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3930321">//&nbsp;just&nbsp;a&nbsp;sanity&nbsp;check.&nbsp;Since&nbsp;the&nbsp;random&nbsp;witnesses&nbsp;chosen&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3930383">//&nbsp;ProbablyPrime&nbsp;are&nbsp;deterministic,&nbsp;given&nbsp;the&nbsp;candidate&nbsp;number,&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3930453">//&nbsp;easy&nbsp;for&nbsp;an&nbsp;attack&nbsp;to&nbsp;generate&nbsp;composites&nbsp;that&nbsp;pass&nbsp;this&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3930520">for</span>&nbsp;<span class="ident" id="3930524">_</span><span class="op" id="3930525">,</span>&nbsp;<span class="ident" id="3930527">prime</span>&nbsp;<span class="op" id="3930533">:=</span>&nbsp;<span class="keyword" id="3930536">range</span>&nbsp;<span class="ident" id="3930542">priv</span><span class="op" id="3930546">.</span><span class="ident" id="3930547">Primes</span>&nbsp;<span class="op" id="3930554">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3930558">if</span>&nbsp;<span class="op" id="3930561">!</span><span class="ident" id="3930562">prime</span><span class="op" id="3930567">.</span><span class="ident" id="3930568">ProbablyPrime</span><span class="op" id="3930581">(</span><span class="num" id="3930582">20</span><span class="op" id="3930584">)</span>&nbsp;<span class="op" id="3930586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3930591">return</span>&nbsp;<span class="ident" id="3930598">errors</span><span class="op" id="3930604">.</span><span class="ident" id="3930605">New</span><span class="op" id="3930608">(</span><span class="string" id="3930609">&#34;crypto/rsa:&nbsp;prime&nbsp;factor&nbsp;is&nbsp;composite&#34;</span><span class="op" id="3930648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3930652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3930655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3930659">//&nbsp;Check&nbsp;that&nbsp;Πprimes&nbsp;==&nbsp;n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930689">modulus</span>&nbsp;<span class="op" id="3930697">:=</span>&nbsp;<span class="builtinfunc" id="3930700">new</span><span class="op" id="3930703">(</span><span class="ident" id="3930704">big</span><span class="op" id="3930707">.</span><span class="ident" id="3930708">Int</span><span class="op" id="3930711">)</span><span class="op" id="3930712">.</span><span class="ident" id="3930713">Set</span><span class="op" id="3930716">(</span><span class="ident" id="3930717">bigOne</span><span class="op" id="3930723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3930726">for</span>&nbsp;<span class="ident" id="3930730">_</span><span class="op" id="3930731">,</span>&nbsp;<span class="ident" id="3930733">prime</span>&nbsp;<span class="op" id="3930739">:=</span>&nbsp;<span class="keyword" id="3930742">range</span>&nbsp;<span class="ident" id="3930748">priv</span><span class="op" id="3930752">.</span><span class="ident" id="3930753">Primes</span>&nbsp;<span class="op" id="3930760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930764">modulus</span><span class="op" id="3930771">.</span><span class="ident" id="3930772">Mul</span><span class="op" id="3930775">(</span><span class="ident" id="3930776">modulus</span><span class="op" id="3930783">,</span>&nbsp;<span class="ident" id="3930785">prime</span><span class="op" id="3930790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3930793">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3930796">if</span>&nbsp;<span class="ident" id="3930799">modulus</span><span class="op" id="3930806">.</span><span class="ident" id="3930807">Cmp</span><span class="op" id="3930810">(</span><span class="ident" id="3930811">priv</span><span class="op" id="3930815">.</span><span class="ident" id="3930816">N</span><span class="op" id="3930817">)</span>&nbsp;<span class="op" id="3930819">!=</span>&nbsp;<span class="num" id="3930822">0</span>&nbsp;<span class="op" id="3930824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3930828">return</span>&nbsp;<span class="ident" id="3930835">errors</span><span class="op" id="3930841">.</span><span class="ident" id="3930842">New</span><span class="op" id="3930845">(</span><span class="string" id="3930846">&#34;crypto/rsa:&nbsp;invalid&nbsp;modulus&#34;</span><span class="op" id="3930875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3930878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3930882">//&nbsp;Check&nbsp;that&nbsp;de&nbsp;≡&nbsp;1&nbsp;mod&nbsp;p-1,&nbsp;for&nbsp;each&nbsp;prime.</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3930931">//&nbsp;This&nbsp;implies&nbsp;that&nbsp;e&nbsp;is&nbsp;coprime&nbsp;to&nbsp;each&nbsp;p-1&nbsp;as&nbsp;e&nbsp;has&nbsp;a&nbsp;multiplicative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3931004">//&nbsp;inverse.&nbsp;Therefore&nbsp;e&nbsp;is&nbsp;coprime&nbsp;to&nbsp;lcm(p-1,q-1,r-1,...)&nbsp;=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3931066">//&nbsp;exponent(ℤ/nℤ).&nbsp;It&nbsp;also&nbsp;implies&nbsp;that&nbsp;a^de&nbsp;≡&nbsp;a&nbsp;mod&nbsp;p&nbsp;as&nbsp;a^(p-1)&nbsp;≡&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3931145">//&nbsp;mod&nbsp;p.&nbsp;Thus&nbsp;a^de&nbsp;≡&nbsp;a&nbsp;mod&nbsp;n&nbsp;for&nbsp;all&nbsp;a&nbsp;coprime&nbsp;to&nbsp;n,&nbsp;as&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931215">congruence</span>&nbsp;<span class="op" id="3931226">:=</span>&nbsp;<span class="builtinfunc" id="3931229">new</span><span class="op" id="3931232">(</span><span class="ident" id="3931233">big</span><span class="op" id="3931236">.</span><span class="ident" id="3931237">Int</span><span class="op" id="3931240">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931243">de</span>&nbsp;<span class="op" id="3931246">:=</span>&nbsp;<span class="builtinfunc" id="3931249">new</span><span class="op" id="3931252">(</span><span class="ident" id="3931253">big</span><span class="op" id="3931256">.</span><span class="ident" id="3931257">Int</span><span class="op" id="3931260">)</span><span class="op" id="3931261">.</span><span class="ident" id="3931262">SetInt64</span><span class="op" id="3931270">(</span><span class="ident" id="3931271">int64</span><span class="op" id="3931276">(</span><span class="ident" id="3931277">priv</span><span class="op" id="3931281">.</span><span class="ident" id="3931282">E</span><span class="op" id="3931283">)</span><span class="op" id="3931284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931287">de</span><span class="op" id="3931289">.</span><span class="ident" id="3931290">Mul</span><span class="op" id="3931293">(</span><span class="ident" id="3931294">de</span><span class="op" id="3931296">,</span>&nbsp;<span class="ident" id="3931298">priv</span><span class="op" id="3931302">.</span><span class="ident" id="3931303">D</span><span class="op" id="3931304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3931307">for</span>&nbsp;<span class="ident" id="3931311">_</span><span class="op" id="3931312">,</span>&nbsp;<span class="ident" id="3931314">prime</span>&nbsp;<span class="op" id="3931320">:=</span>&nbsp;<span class="keyword" id="3931323">range</span>&nbsp;<span class="ident" id="3931329">priv</span><span class="op" id="3931333">.</span><span class="ident" id="3931334">Primes</span>&nbsp;<span class="op" id="3931341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931345">pminus1</span>&nbsp;<span class="op" id="3931353">:=</span>&nbsp;<span class="builtinfunc" id="3931356">new</span><span class="op" id="3931359">(</span><span class="ident" id="3931360">big</span><span class="op" id="3931363">.</span><span class="ident" id="3931364">Int</span><span class="op" id="3931367">)</span><span class="op" id="3931368">.</span><span class="ident" id="3931369">Sub</span><span class="op" id="3931372">(</span><span class="ident" id="3931373">prime</span><span class="op" id="3931378">,</span>&nbsp;<span class="ident" id="3931380">bigOne</span><span class="op" id="3931386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931390">congruence</span><span class="op" id="3931400">.</span><span class="ident" id="3931401">Mod</span><span class="op" id="3931404">(</span><span class="ident" id="3931405">de</span><span class="op" id="3931407">,</span>&nbsp;<span class="ident" id="3931409">pminus1</span><span class="op" id="3931416">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3931420">if</span>&nbsp;<span class="ident" id="3931423">congruence</span><span class="op" id="3931433">.</span><span class="ident" id="3931434">Cmp</span><span class="op" id="3931437">(</span><span class="ident" id="3931438">bigOne</span><span class="op" id="3931444">)</span>&nbsp;<span class="op" id="3931446">!=</span>&nbsp;<span class="num" id="3931449">0</span>&nbsp;<span class="op" id="3931451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3931456">return</span>&nbsp;<span class="ident" id="3931463">errors</span><span class="op" id="3931469">.</span><span class="ident" id="3931470">New</span><span class="op" id="3931473">(</span><span class="string" id="3931474">&#34;crypto/rsa:&nbsp;invalid&nbsp;exponents&#34;</span><span class="op" id="3931505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3931509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3931512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3931515">return</span>&nbsp;<span class="ident" id="3931522">nil</span><br>
<span class="lineno">140</span><span class="op" id="3931526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3931529">//&nbsp;GenerateKey&nbsp;generates&nbsp;an&nbsp;RSA&nbsp;keypair&nbsp;of&nbsp;the&nbsp;given&nbsp;bit&nbsp;size&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3931601">//&nbsp;random&nbsp;source&nbsp;random&nbsp;(for&nbsp;example,&nbsp;crypto/rand.Reader).</span><br>
<span class="lineno"></span><span class="keyword" id="3931660">func</span>&nbsp;<span class="ident" id="3931665">GenerateKey</span><span class="op" id="3931676">(</span><span class="ident" id="3931677">random</span>&nbsp;<span class="ident" id="3931684">io</span><span class="op" id="3931686">.</span><span class="ident" id="3931687">Reader</span><span class="op" id="3931693">,</span>&nbsp;<span class="ident" id="3931695">bits</span>&nbsp;<span class="builtintype" id="3931700">int</span><span class="op" id="3931703">)</span>&nbsp;<span class="op" id="3931705">(</span><span class="ident" id="3931706">priv</span>&nbsp;<span class="op" id="3931711">*</span><span class="ident" id="3931712">PrivateKey</span><span class="op" id="3931722">,</span>&nbsp;<span class="ident" id="3931724">err</span>&nbsp;<span class="builtintype" id="3931728">error</span><span class="op" id="3931733">)</span>&nbsp;<span class="op" id="3931735">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3931738">return</span>&nbsp;<span class="ident" id="3931745">GenerateMultiPrimeKey</span><span class="op" id="3931766">(</span><span class="ident" id="3931767">random</span><span class="op" id="3931773">,</span>&nbsp;<span class="num" id="3931775">2</span><span class="op" id="3931776">,</span>&nbsp;<span class="ident" id="3931778">bits</span><span class="op" id="3931782">)</span><br>
<span class="lineno"></span><span class="op" id="3931784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3931787">//&nbsp;GenerateMultiPrimeKey&nbsp;generates&nbsp;a&nbsp;multi-prime&nbsp;RSA&nbsp;keypair&nbsp;of&nbsp;the&nbsp;given&nbsp;bit</span><br>
<span class="lineno"></span><span class="comment" id="3931865">//&nbsp;size&nbsp;and&nbsp;the&nbsp;given&nbsp;random&nbsp;source,&nbsp;as&nbsp;suggested&nbsp;in&nbsp;[1].&nbsp;Although&nbsp;the&nbsp;public</span><br>
<span class="lineno">150</span><span class="comment" id="3931943">//&nbsp;keys&nbsp;are&nbsp;compatible&nbsp;(actually,&nbsp;indistinguishable)&nbsp;from&nbsp;the&nbsp;2-prime&nbsp;case,</span><br>
<span class="lineno"></span><span class="comment" id="3932019">//&nbsp;the&nbsp;private&nbsp;keys&nbsp;are&nbsp;not.&nbsp;Thus&nbsp;it&nbsp;may&nbsp;not&nbsp;be&nbsp;possible&nbsp;to&nbsp;export&nbsp;multi-prime</span><br>
<span class="lineno"></span><span class="comment" id="3932098">//&nbsp;private&nbsp;keys&nbsp;in&nbsp;certain&nbsp;formats&nbsp;or&nbsp;to&nbsp;subsequently&nbsp;import&nbsp;them&nbsp;into&nbsp;other</span><br>
<span class="lineno"></span><span class="comment" id="3932175">//&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="3932184">//</span><br>
<span class="lineno">155</span><span class="comment" id="3932187">//&nbsp;Table&nbsp;1&nbsp;in&nbsp;[2]&nbsp;suggests&nbsp;maximum&nbsp;numbers&nbsp;of&nbsp;primes&nbsp;for&nbsp;a&nbsp;given&nbsp;size.</span><br>
<span class="lineno"></span><span class="comment" id="3932258">//</span><br>
<span class="lineno"></span><span class="comment" id="3932261">//&nbsp;[1]&nbsp;US&nbsp;patent&nbsp;4405829&nbsp;(1972,&nbsp;expired)</span><br>
<span class="lineno"></span><span class="comment" id="3932302">//&nbsp;[2]&nbsp;http://www.cacr.math.uwaterloo.ca/techreports/2006/cacr2006-16.pdf</span><br>
<span class="lineno"></span><span class="keyword" id="3932376">func</span>&nbsp;<span class="ident" id="3932381">GenerateMultiPrimeKey</span><span class="op" id="3932402">(</span><span class="ident" id="3932403">random</span>&nbsp;<span class="ident" id="3932410">io</span><span class="op" id="3932412">.</span><span class="ident" id="3932413">Reader</span><span class="op" id="3932419">,</span>&nbsp;<span class="ident" id="3932421">nprimes</span>&nbsp;<span class="builtintype" id="3932429">int</span><span class="op" id="3932432">,</span>&nbsp;<span class="ident" id="3932434">bits</span>&nbsp;<span class="builtintype" id="3932439">int</span><span class="op" id="3932442">)</span>&nbsp;<span class="op" id="3932444">(</span><span class="ident" id="3932445">priv</span>&nbsp;<span class="op" id="3932450">*</span><span class="ident" id="3932451">PrivateKey</span><span class="op" id="3932461">,</span>&nbsp;<span class="ident" id="3932463">err</span>&nbsp;<span class="builtintype" id="3932467">error</span><span class="op" id="3932472">)</span>&nbsp;<span class="op" id="3932474">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3932477">priv</span>&nbsp;<span class="op" id="3932482">=</span>&nbsp;<span class="builtinfunc" id="3932484">new</span><span class="op" id="3932487">(</span><span class="ident" id="3932488">PrivateKey</span><span class="op" id="3932498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3932501">priv</span><span class="op" id="3932505">.</span><span class="ident" id="3932506">E</span>&nbsp;<span class="op" id="3932508">=</span>&nbsp;<span class="num" id="3932510">65537</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3932518">if</span>&nbsp;<span class="ident" id="3932521">nprimes</span>&nbsp;<span class="op" id="3932529">&lt;</span>&nbsp;<span class="num" id="3932531">2</span>&nbsp;<span class="op" id="3932533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3932537">return</span>&nbsp;<span class="ident" id="3932544">nil</span><span class="op" id="3932547">,</span>&nbsp;<span class="ident" id="3932549">errors</span><span class="op" id="3932555">.</span><span class="ident" id="3932556">New</span><span class="op" id="3932559">(</span><span class="string" id="3932560">&#34;crypto/rsa:&nbsp;GenerateMultiPrimeKey:&nbsp;nprimes&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;2&#34;</span><span class="op" id="3932617">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3932620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3932624">primes</span>&nbsp;<span class="op" id="3932631">:=</span>&nbsp;<span class="builtinfunc" id="3932634">make</span><span class="op" id="3932638">(</span><span class="op" id="3932639">[</span><span class="op" id="3932640">]</span><span class="op" id="3932641">*</span><span class="ident" id="3932642">big</span><span class="op" id="3932645">.</span><span class="ident" id="3932646">Int</span><span class="op" id="3932649">,</span>&nbsp;<span class="ident" id="3932651">nprimes</span><span class="op" id="3932658">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="3932661">NextSetOfPrimes</span><span class="op" id="3932676">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3932679">for</span>&nbsp;<span class="op" id="3932683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3932687">todo</span>&nbsp;<span class="op" id="3932692">:=</span>&nbsp;<span class="ident" id="3932695">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3932702">//&nbsp;crypto/rand&nbsp;should&nbsp;set&nbsp;the&nbsp;top&nbsp;two&nbsp;bits&nbsp;in&nbsp;each&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3932762">//&nbsp;Thus&nbsp;each&nbsp;prime&nbsp;has&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3932796">//&nbsp;&nbsp;&nbsp;p_i&nbsp;=&nbsp;2^bitlen(p_i)&nbsp;×&nbsp;0.11...&nbsp;(in&nbsp;base&nbsp;2).</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3932847">//&nbsp;And&nbsp;the&nbsp;product&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3932872">//&nbsp;&nbsp;&nbsp;P&nbsp;=&nbsp;2^todo&nbsp;×&nbsp;α</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3932896">//&nbsp;where&nbsp;α&nbsp;is&nbsp;the&nbsp;product&nbsp;of&nbsp;nprimes&nbsp;numbers&nbsp;of&nbsp;the&nbsp;form&nbsp;0.11...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3932964">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3932969">//&nbsp;If&nbsp;α&nbsp;&lt;&nbsp;1/2&nbsp;(which&nbsp;can&nbsp;happen&nbsp;for&nbsp;nprimes&nbsp;&gt;&nbsp;2),&nbsp;we&nbsp;need&nbsp;to</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3933033">//&nbsp;shift&nbsp;todo&nbsp;to&nbsp;compensate&nbsp;for&nbsp;lost&nbsp;bits:&nbsp;the&nbsp;mean&nbsp;value&nbsp;of&nbsp;0.11...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3933104">//&nbsp;is&nbsp;7/8,&nbsp;so&nbsp;todo&nbsp;+&nbsp;shift&nbsp;-&nbsp;nprimes&nbsp;*&nbsp;log2(7/8)&nbsp;~=&nbsp;bits&nbsp;-&nbsp;1/2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3933169">//&nbsp;will&nbsp;give&nbsp;good&nbsp;results.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933198">if</span>&nbsp;<span class="ident" id="3933201">nprimes</span>&nbsp;<span class="op" id="3933209">&gt;=</span>&nbsp;<span class="num" id="3933212">7</span>&nbsp;<span class="op" id="3933214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3933219">todo</span>&nbsp;<span class="op" id="3933224">+=</span>&nbsp;<span class="op" id="3933227">(</span><span class="ident" id="3933228">nprimes</span>&nbsp;<span class="op" id="3933236">-</span>&nbsp;<span class="num" id="3933238">2</span><span class="op" id="3933239">)</span>&nbsp;<span class="op" id="3933241">/</span>&nbsp;<span class="num" id="3933243">5</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3933247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933251">for</span>&nbsp;<span class="ident" id="3933255">i</span>&nbsp;<span class="op" id="3933257">:=</span>&nbsp;<span class="num" id="3933260">0</span><span class="op" id="3933261">;</span>&nbsp;<span class="ident" id="3933263">i</span>&nbsp;<span class="op" id="3933265">&lt;</span>&nbsp;<span class="ident" id="3933267">nprimes</span><span class="op" id="3933274">;</span>&nbsp;<span class="ident" id="3933276">i</span><span class="op" id="3933277">++</span>&nbsp;<span class="op" id="3933280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3933285">primes</span><span class="op" id="3933291">[</span><span class="ident" id="3933292">i</span><span class="op" id="3933293">]</span><span class="op" id="3933294">,</span>&nbsp;<span class="ident" id="3933296">err</span>&nbsp;<span class="op" id="3933300">=</span>&nbsp;<span class="ident" id="3933302">rand</span><span class="op" id="3933306">.</span><span class="ident" id="3933307">Prime</span><span class="op" id="3933312">(</span><span class="ident" id="3933313">random</span><span class="op" id="3933319">,</span>&nbsp;<span class="ident" id="3933321">todo</span><span class="op" id="3933325">/</span><span class="op" id="3933326">(</span><span class="ident" id="3933327">nprimes</span><span class="op" id="3933334">-</span><span class="ident" id="3933335">i</span><span class="op" id="3933336">)</span><span class="op" id="3933337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933342">if</span>&nbsp;<span class="ident" id="3933345">err</span>&nbsp;<span class="op" id="3933349">!=</span>&nbsp;<span class="ident" id="3933352">nil</span>&nbsp;<span class="op" id="3933356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933362">return</span>&nbsp;<span class="ident" id="3933369">nil</span><span class="op" id="3933372">,</span>&nbsp;<span class="ident" id="3933374">err</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3933381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3933386">todo</span>&nbsp;<span class="op" id="3933391">-=</span>&nbsp;<span class="ident" id="3933394">primes</span><span class="op" id="3933400">[</span><span class="ident" id="3933401">i</span><span class="op" id="3933402">]</span><span class="op" id="3933403">.</span><span class="ident" id="3933404">BitLen</span><span class="op" id="3933410">(</span><span class="op" id="3933411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3933415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3933420">//&nbsp;Make&nbsp;sure&nbsp;that&nbsp;primes&nbsp;is&nbsp;pairwise&nbsp;unequal.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933468">for</span>&nbsp;<span class="ident" id="3933472">i</span><span class="op" id="3933473">,</span>&nbsp;<span class="ident" id="3933475">prime</span>&nbsp;<span class="op" id="3933481">:=</span>&nbsp;<span class="keyword" id="3933484">range</span>&nbsp;<span class="ident" id="3933490">primes</span>&nbsp;<span class="op" id="3933497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933502">for</span>&nbsp;<span class="ident" id="3933506">j</span>&nbsp;<span class="op" id="3933508">:=</span>&nbsp;<span class="num" id="3933511">0</span><span class="op" id="3933512">;</span>&nbsp;<span class="ident" id="3933514">j</span>&nbsp;<span class="op" id="3933516">&lt;</span>&nbsp;<span class="ident" id="3933518">i</span><span class="op" id="3933519">;</span>&nbsp;<span class="ident" id="3933521">j</span><span class="op" id="3933522">++</span>&nbsp;<span class="op" id="3933525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933531">if</span>&nbsp;<span class="ident" id="3933534">prime</span><span class="op" id="3933539">.</span><span class="ident" id="3933540">Cmp</span><span class="op" id="3933543">(</span><span class="ident" id="3933544">primes</span><span class="op" id="3933550">[</span><span class="ident" id="3933551">j</span><span class="op" id="3933552">]</span><span class="op" id="3933553">)</span>&nbsp;<span class="op" id="3933555">==</span>&nbsp;<span class="num" id="3933558">0</span>&nbsp;<span class="op" id="3933560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933567">continue</span>&nbsp;<span class="ident" id="3933576">NextSetOfPrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3933596">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3933601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3933605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3933610">n</span>&nbsp;<span class="op" id="3933612">:=</span>&nbsp;<span class="builtinfunc" id="3933615">new</span><span class="op" id="3933618">(</span><span class="ident" id="3933619">big</span><span class="op" id="3933622">.</span><span class="ident" id="3933623">Int</span><span class="op" id="3933626">)</span><span class="op" id="3933627">.</span><span class="ident" id="3933628">Set</span><span class="op" id="3933631">(</span><span class="ident" id="3933632">bigOne</span><span class="op" id="3933638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3933642">totient</span>&nbsp;<span class="op" id="3933650">:=</span>&nbsp;<span class="builtinfunc" id="3933653">new</span><span class="op" id="3933656">(</span><span class="ident" id="3933657">big</span><span class="op" id="3933660">.</span><span class="ident" id="3933661">Int</span><span class="op" id="3933664">)</span><span class="op" id="3933665">.</span><span class="ident" id="3933666">Set</span><span class="op" id="3933669">(</span><span class="ident" id="3933670">bigOne</span><span class="op" id="3933676">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3933680">pminus1</span>&nbsp;<span class="op" id="3933688">:=</span>&nbsp;<span class="builtinfunc" id="3933691">new</span><span class="op" id="3933694">(</span><span class="ident" id="3933695">big</span><span class="op" id="3933698">.</span><span class="ident" id="3933699">Int</span><span class="op" id="3933702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933706">for</span>&nbsp;<span class="ident" id="3933710">_</span><span class="op" id="3933711">,</span>&nbsp;<span class="ident" id="3933713">prime</span>&nbsp;<span class="op" id="3933719">:=</span>&nbsp;<span class="keyword" id="3933722">range</span>&nbsp;<span class="ident" id="3933728">primes</span>&nbsp;<span class="op" id="3933735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3933740">n</span><span class="op" id="3933741">.</span><span class="ident" id="3933742">Mul</span><span class="op" id="3933745">(</span><span class="ident" id="3933746">n</span><span class="op" id="3933747">,</span>&nbsp;<span class="ident" id="3933749">prime</span><span class="op" id="3933754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3933759">pminus1</span><span class="op" id="3933766">.</span><span class="ident" id="3933767">Sub</span><span class="op" id="3933770">(</span><span class="ident" id="3933771">prime</span><span class="op" id="3933776">,</span>&nbsp;<span class="ident" id="3933778">bigOne</span><span class="op" id="3933784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3933789">totient</span><span class="op" id="3933796">.</span><span class="ident" id="3933797">Mul</span><span class="op" id="3933800">(</span><span class="ident" id="3933801">totient</span><span class="op" id="3933808">,</span>&nbsp;<span class="ident" id="3933810">pminus1</span><span class="op" id="3933817">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3933821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933825">if</span>&nbsp;<span class="ident" id="3933828">n</span><span class="op" id="3933829">.</span><span class="ident" id="3933830">BitLen</span><span class="op" id="3933836">(</span><span class="op" id="3933837">)</span>&nbsp;<span class="op" id="3933839">!=</span>&nbsp;<span class="ident" id="3933842">bits</span>&nbsp;<span class="op" id="3933847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3933852">//&nbsp;This&nbsp;should&nbsp;never&nbsp;happen&nbsp;for&nbsp;nprimes&nbsp;==&nbsp;2&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3933908">//&nbsp;crypto/rand&nbsp;should&nbsp;set&nbsp;the&nbsp;top&nbsp;two&nbsp;bits&nbsp;in&nbsp;each&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3933969">//&nbsp;For&nbsp;nprimes&nbsp;&gt;&nbsp;2&nbsp;we&nbsp;hope&nbsp;it&nbsp;does&nbsp;not&nbsp;happen&nbsp;often.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3934025">continue</span>&nbsp;<span class="ident" id="3934034">NextSetOfPrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3934052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3934057">g</span>&nbsp;<span class="op" id="3934059">:=</span>&nbsp;<span class="builtinfunc" id="3934062">new</span><span class="op" id="3934065">(</span><span class="ident" id="3934066">big</span><span class="op" id="3934069">.</span><span class="ident" id="3934070">Int</span><span class="op" id="3934073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3934077">priv</span><span class="op" id="3934081">.</span><span class="ident" id="3934082">D</span>&nbsp;<span class="op" id="3934084">=</span>&nbsp;<span class="builtinfunc" id="3934086">new</span><span class="op" id="3934089">(</span><span class="ident" id="3934090">big</span><span class="op" id="3934093">.</span><span class="ident" id="3934094">Int</span><span class="op" id="3934097">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3934101">y</span>&nbsp;<span class="op" id="3934103">:=</span>&nbsp;<span class="builtinfunc" id="3934106">new</span><span class="op" id="3934109">(</span><span class="ident" id="3934110">big</span><span class="op" id="3934113">.</span><span class="ident" id="3934114">Int</span><span class="op" id="3934117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3934121">e</span>&nbsp;<span class="op" id="3934123">:=</span>&nbsp;<span class="ident" id="3934126">big</span><span class="op" id="3934129">.</span><span class="ident" id="3934130">NewInt</span><span class="op" id="3934136">(</span><span class="ident" id="3934137">int64</span><span class="op" id="3934142">(</span><span class="ident" id="3934143">priv</span><span class="op" id="3934147">.</span><span class="ident" id="3934148">E</span><span class="op" id="3934149">)</span><span class="op" id="3934150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3934154">g</span><span class="op" id="3934155">.</span><span class="ident" id="3934156">GCD</span><span class="op" id="3934159">(</span><span class="ident" id="3934160">priv</span><span class="op" id="3934164">.</span><span class="ident" id="3934165">D</span><span class="op" id="3934166">,</span>&nbsp;<span class="ident" id="3934168">y</span><span class="op" id="3934169">,</span>&nbsp;<span class="ident" id="3934171">e</span><span class="op" id="3934172">,</span>&nbsp;<span class="ident" id="3934174">totient</span><span class="op" id="3934181">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3934186">if</span>&nbsp;<span class="ident" id="3934189">g</span><span class="op" id="3934190">.</span><span class="ident" id="3934191">Cmp</span><span class="op" id="3934194">(</span><span class="ident" id="3934195">bigOne</span><span class="op" id="3934201">)</span>&nbsp;<span class="op" id="3934203">==</span>&nbsp;<span class="num" id="3934206">0</span>&nbsp;<span class="op" id="3934208">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3934213">if</span>&nbsp;<span class="ident" id="3934216">priv</span><span class="op" id="3934220">.</span><span class="ident" id="3934221">D</span><span class="op" id="3934222">.</span><span class="ident" id="3934223">Sign</span><span class="op" id="3934227">(</span><span class="op" id="3934228">)</span>&nbsp;<span class="op" id="3934230">&lt;</span>&nbsp;<span class="num" id="3934232">0</span>&nbsp;<span class="op" id="3934234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3934240">priv</span><span class="op" id="3934244">.</span><span class="ident" id="3934245">D</span><span class="op" id="3934246">.</span><span class="ident" id="3934247">Add</span><span class="op" id="3934250">(</span><span class="ident" id="3934251">priv</span><span class="op" id="3934255">.</span><span class="ident" id="3934256">D</span><span class="op" id="3934257">,</span>&nbsp;<span class="ident" id="3934259">totient</span><span class="op" id="3934266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3934271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3934276">priv</span><span class="op" id="3934280">.</span><span class="ident" id="3934281">Primes</span>&nbsp;<span class="op" id="3934288">=</span>&nbsp;<span class="ident" id="3934290">primes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3934300">priv</span><span class="op" id="3934304">.</span><span class="ident" id="3934305">N</span>&nbsp;<span class="op" id="3934307">=</span>&nbsp;<span class="ident" id="3934309">n</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3934315">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3934323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3934326">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3934330">priv</span><span class="op" id="3934334">.</span><span class="ident" id="3934335">Precompute</span><span class="op" id="3934345">(</span><span class="op" id="3934346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3934349">return</span><br>
<span class="lineno"></span><span class="op" id="3934356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3934359">//&nbsp;incCounter&nbsp;increments&nbsp;a&nbsp;four&nbsp;byte,&nbsp;big-endian&nbsp;counter.</span><br>
<span class="lineno">240</span><span class="keyword" id="3934417">func</span>&nbsp;<span class="ident" id="3934422">incCounter</span><span class="op" id="3934432">(</span><span class="ident" id="3934433">c</span>&nbsp;<span class="op" id="3934435">*</span><span class="op" id="3934436">[</span><span class="num" id="3934437">4</span><span class="op" id="3934438">]</span><span class="builtintype" id="3934439">byte</span><span class="op" id="3934443">)</span>&nbsp;<span class="op" id="3934445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3934448">if</span>&nbsp;<span class="ident" id="3934451">c</span><span class="op" id="3934452">[</span><span class="num" id="3934453">3</span><span class="op" id="3934454">]</span><span class="op" id="3934455">++</span><span class="op" id="3934457">;</span>&nbsp;<span class="ident" id="3934459">c</span><span class="op" id="3934460">[</span><span class="num" id="3934461">3</span><span class="op" id="3934462">]</span>&nbsp;<span class="op" id="3934464">!=</span>&nbsp;<span class="num" id="3934467">0</span>&nbsp;<span class="op" id="3934469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3934473">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3934481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3934484">if</span>&nbsp;<span class="ident" id="3934487">c</span><span class="op" id="3934488">[</span><span class="num" id="3934489">2</span><span class="op" id="3934490">]</span><span class="op" id="3934491">++</span><span class="op" id="3934493">;</span>&nbsp;<span class="ident" id="3934495">c</span><span class="op" id="3934496">[</span><span class="num" id="3934497">2</span><span class="op" id="3934498">]</span>&nbsp;<span class="op" id="3934500">!=</span>&nbsp;<span class="num" id="3934503">0</span>&nbsp;<span class="op" id="3934505">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3934509">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3934517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3934520">if</span>&nbsp;<span class="ident" id="3934523">c</span><span class="op" id="3934524">[</span><span class="num" id="3934525">1</span><span class="op" id="3934526">]</span><span class="op" id="3934527">++</span><span class="op" id="3934529">;</span>&nbsp;<span class="ident" id="3934531">c</span><span class="op" id="3934532">[</span><span class="num" id="3934533">1</span><span class="op" id="3934534">]</span>&nbsp;<span class="op" id="3934536">!=</span>&nbsp;<span class="num" id="3934539">0</span>&nbsp;<span class="op" id="3934541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3934545">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3934553">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3934556">c</span><span class="op" id="3934557">[</span><span class="num" id="3934558">0</span><span class="op" id="3934559">]</span><span class="op" id="3934560">++</span><br>
<span class="lineno"></span><span class="op" id="3934563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3934566">//&nbsp;mgf1XOR&nbsp;XORs&nbsp;the&nbsp;bytes&nbsp;in&nbsp;out&nbsp;with&nbsp;a&nbsp;mask&nbsp;generated&nbsp;using&nbsp;the&nbsp;MGF1&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="3934645">//&nbsp;specified&nbsp;in&nbsp;PKCS#1&nbsp;v2.1.</span><br>
<span class="lineno">255</span><span class="keyword" id="3934674">func</span>&nbsp;<span class="ident" id="3934679">mgf1XOR</span><span class="op" id="3934686">(</span><span class="ident" id="3934687">out</span>&nbsp;<span class="op" id="3934691">[</span><span class="op" id="3934692">]</span><span class="builtintype" id="3934693">byte</span><span class="op" id="3934697">,</span>&nbsp;<span class="ident" id="3934699">hash</span>&nbsp;<span class="ident" id="3934704">hash</span><span class="op" id="3934708">.</span><span class="ident" id="3934709">Hash</span><span class="op" id="3934713">,</span>&nbsp;<span class="ident" id="3934715">seed</span>&nbsp;<span class="op" id="3934720">[</span><span class="op" id="3934721">]</span><span class="builtintype" id="3934722">byte</span><span class="op" id="3934726">)</span>&nbsp;<span class="op" id="3934728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3934731">var</span>&nbsp;<span class="ident" id="3934735">counter</span>&nbsp;<span class="op" id="3934743">[</span><span class="num" id="3934744">4</span><span class="op" id="3934745">]</span><span class="builtintype" id="3934746">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3934752">var</span>&nbsp;<span class="ident" id="3934756">digest</span>&nbsp;<span class="op" id="3934763">[</span><span class="op" id="3934764">]</span><span class="builtintype" id="3934765">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3934772">done</span>&nbsp;<span class="op" id="3934777">:=</span>&nbsp;<span class="num" id="3934780">0</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3934783">for</span>&nbsp;<span class="ident" id="3934787">done</span>&nbsp;<span class="op" id="3934792">&lt;</span>&nbsp;<span class="builtinfunc" id="3934794">len</span><span class="op" id="3934797">(</span><span class="ident" id="3934798">out</span><span class="op" id="3934801">)</span>&nbsp;<span class="op" id="3934803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3934807">hash</span><span class="op" id="3934811">.</span><span class="ident" id="3934812">Write</span><span class="op" id="3934817">(</span><span class="ident" id="3934818">seed</span><span class="op" id="3934822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3934826">hash</span><span class="op" id="3934830">.</span><span class="ident" id="3934831">Write</span><span class="op" id="3934836">(</span><span class="ident" id="3934837">counter</span><span class="op" id="3934844">[</span><span class="num" id="3934845">0</span><span class="op" id="3934846">:</span><span class="num" id="3934847">4</span><span class="op" id="3934848">]</span><span class="op" id="3934849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3934853">digest</span>&nbsp;<span class="op" id="3934860">=</span>&nbsp;<span class="ident" id="3934862">hash</span><span class="op" id="3934866">.</span><span class="ident" id="3934867">Sum</span><span class="op" id="3934870">(</span><span class="ident" id="3934871">digest</span><span class="op" id="3934877">[</span><span class="op" id="3934878">:</span><span class="num" id="3934879">0</span><span class="op" id="3934880">]</span><span class="op" id="3934881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3934885">hash</span><span class="op" id="3934889">.</span><span class="ident" id="3934890">Reset</span><span class="op" id="3934895">(</span><span class="op" id="3934896">)</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3934901">for</span>&nbsp;<span class="ident" id="3934905">i</span>&nbsp;<span class="op" id="3934907">:=</span>&nbsp;<span class="num" id="3934910">0</span><span class="op" id="3934911">;</span>&nbsp;<span class="ident" id="3934913">i</span>&nbsp;<span class="op" id="3934915">&lt;</span>&nbsp;<span class="builtinfunc" id="3934917">len</span><span class="op" id="3934920">(</span><span class="ident" id="3934921">digest</span><span class="op" id="3934927">)</span>&nbsp;<span class="op" id="3934929">&amp;&amp;</span>&nbsp;<span class="ident" id="3934932">done</span>&nbsp;<span class="op" id="3934937">&lt;</span>&nbsp;<span class="builtinfunc" id="3934939">len</span><span class="op" id="3934942">(</span><span class="ident" id="3934943">out</span><span class="op" id="3934946">)</span><span class="op" id="3934947">;</span>&nbsp;<span class="ident" id="3934949">i</span><span class="op" id="3934950">++</span>&nbsp;<span class="op" id="3934953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3934958">out</span><span class="op" id="3934961">[</span><span class="ident" id="3934962">done</span><span class="op" id="3934966">]</span>&nbsp;<span class="op" id="3934968">^=</span>&nbsp;<span class="ident" id="3934971">digest</span><span class="op" id="3934977">[</span><span class="ident" id="3934978">i</span><span class="op" id="3934979">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3934984">done</span><span class="op" id="3934988">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3934993">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3934997">incCounter</span><span class="op" id="3935007">(</span><span class="op" id="3935008">&amp;</span><span class="ident" id="3935009">counter</span><span class="op" id="3935016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3935019">}</span><br>
<span class="lineno"></span><span class="op" id="3935021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3935024">//&nbsp;ErrMessageTooLong&nbsp;is&nbsp;returned&nbsp;when&nbsp;attempting&nbsp;to&nbsp;encrypt&nbsp;a&nbsp;message&nbsp;which&nbsp;is</span><br>
<span class="lineno">275</span><span class="comment" id="3935103">//&nbsp;too&nbsp;large&nbsp;for&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3935148">var</span>&nbsp;<span class="ident" id="3935152">ErrMessageTooLong</span>&nbsp;<span class="op" id="3935170">=</span>&nbsp;<span class="ident" id="3935172">errors</span><span class="op" id="3935178">.</span><span class="ident" id="3935179">New</span><span class="op" id="3935182">(</span><span class="string" id="3935183">&#34;crypto/rsa:&nbsp;message&nbsp;too&nbsp;long&nbsp;for&nbsp;RSA&nbsp;public&nbsp;key&nbsp;size&#34;</span><span class="op" id="3935237">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3935240">func</span>&nbsp;<span class="ident" id="3935245">encrypt</span><span class="op" id="3935252">(</span><span class="ident" id="3935253">c</span>&nbsp;<span class="op" id="3935255">*</span><span class="ident" id="3935256">big</span><span class="op" id="3935259">.</span><span class="ident" id="3935260">Int</span><span class="op" id="3935263">,</span>&nbsp;<span class="ident" id="3935265">pub</span>&nbsp;<span class="op" id="3935269">*</span><span class="ident" id="3935270">PublicKey</span><span class="op" id="3935279">,</span>&nbsp;<span class="ident" id="3935281">m</span>&nbsp;<span class="op" id="3935283">*</span><span class="ident" id="3935284">big</span><span class="op" id="3935287">.</span><span class="ident" id="3935288">Int</span><span class="op" id="3935291">)</span>&nbsp;<span class="op" id="3935293">*</span><span class="ident" id="3935294">big</span><span class="op" id="3935297">.</span><span class="ident" id="3935298">Int</span>&nbsp;<span class="op" id="3935302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3935305">e</span>&nbsp;<span class="op" id="3935307">:=</span>&nbsp;<span class="ident" id="3935310">big</span><span class="op" id="3935313">.</span><span class="ident" id="3935314">NewInt</span><span class="op" id="3935320">(</span><span class="ident" id="3935321">int64</span><span class="op" id="3935326">(</span><span class="ident" id="3935327">pub</span><span class="op" id="3935330">.</span><span class="ident" id="3935331">E</span><span class="op" id="3935332">)</span><span class="op" id="3935333">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3935336">c</span><span class="op" id="3935337">.</span><span class="ident" id="3935338">Exp</span><span class="op" id="3935341">(</span><span class="ident" id="3935342">m</span><span class="op" id="3935343">,</span>&nbsp;<span class="ident" id="3935345">e</span><span class="op" id="3935346">,</span>&nbsp;<span class="ident" id="3935348">pub</span><span class="op" id="3935351">.</span><span class="ident" id="3935352">N</span><span class="op" id="3935353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3935356">return</span>&nbsp;<span class="ident" id="3935363">c</span><br>
<span class="lineno"></span><span class="op" id="3935365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3935368">//&nbsp;EncryptOAEP&nbsp;encrypts&nbsp;the&nbsp;given&nbsp;message&nbsp;with&nbsp;RSA-OAEP.</span><br>
<span class="lineno">285</span><span class="comment" id="3935425">//&nbsp;The&nbsp;message&nbsp;must&nbsp;be&nbsp;no&nbsp;longer&nbsp;than&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;public&nbsp;modulus&nbsp;less</span><br>
<span class="lineno"></span><span class="comment" id="3935501">//&nbsp;twice&nbsp;the&nbsp;hash&nbsp;length&nbsp;plus&nbsp;2.</span><br>
<span class="lineno"></span><span class="keyword" id="3935534">func</span>&nbsp;<span class="ident" id="3935539">EncryptOAEP</span><span class="op" id="3935550">(</span><span class="ident" id="3935551">hash</span>&nbsp;<span class="ident" id="3935556">hash</span><span class="op" id="3935560">.</span><span class="ident" id="3935561">Hash</span><span class="op" id="3935565">,</span>&nbsp;<span class="ident" id="3935567">random</span>&nbsp;<span class="ident" id="3935574">io</span><span class="op" id="3935576">.</span><span class="ident" id="3935577">Reader</span><span class="op" id="3935583">,</span>&nbsp;<span class="ident" id="3935585">pub</span>&nbsp;<span class="op" id="3935589">*</span><span class="ident" id="3935590">PublicKey</span><span class="op" id="3935599">,</span>&nbsp;<span class="ident" id="3935601">msg</span>&nbsp;<span class="op" id="3935605">[</span><span class="op" id="3935606">]</span><span class="builtintype" id="3935607">byte</span><span class="op" id="3935611">,</span>&nbsp;<span class="ident" id="3935613">label</span>&nbsp;<span class="op" id="3935619">[</span><span class="op" id="3935620">]</span><span class="builtintype" id="3935621">byte</span><span class="op" id="3935625">)</span>&nbsp;<span class="op" id="3935627">(</span><span class="ident" id="3935628">out</span>&nbsp;<span class="op" id="3935632">[</span><span class="op" id="3935633">]</span><span class="builtintype" id="3935634">byte</span><span class="op" id="3935638">,</span>&nbsp;<span class="ident" id="3935640">err</span>&nbsp;<span class="builtintype" id="3935644">error</span><span class="op" id="3935649">)</span>&nbsp;<span class="op" id="3935651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3935654">if</span>&nbsp;<span class="ident" id="3935657">err</span>&nbsp;<span class="op" id="3935661">:=</span>&nbsp;<span class="ident" id="3935664">checkPub</span><span class="op" id="3935672">(</span><span class="ident" id="3935673">pub</span><span class="op" id="3935676">)</span><span class="op" id="3935677">;</span>&nbsp;<span class="ident" id="3935679">err</span>&nbsp;<span class="op" id="3935683">!=</span>&nbsp;<span class="ident" id="3935686">nil</span>&nbsp;<span class="op" id="3935690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3935694">return</span>&nbsp;<span class="ident" id="3935701">nil</span><span class="op" id="3935704">,</span>&nbsp;<span class="ident" id="3935706">err</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3935711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3935714">hash</span><span class="op" id="3935718">.</span><span class="ident" id="3935719">Reset</span><span class="op" id="3935724">(</span><span class="op" id="3935725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3935728">k</span>&nbsp;<span class="op" id="3935730">:=</span>&nbsp;<span class="op" id="3935733">(</span><span class="ident" id="3935734">pub</span><span class="op" id="3935737">.</span><span class="ident" id="3935738">N</span><span class="op" id="3935739">.</span><span class="ident" id="3935740">BitLen</span><span class="op" id="3935746">(</span><span class="op" id="3935747">)</span>&nbsp;<span class="op" id="3935749">+</span>&nbsp;<span class="num" id="3935751">7</span><span class="op" id="3935752">)</span>&nbsp;<span class="op" id="3935754">/</span>&nbsp;<span class="num" id="3935756">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3935759">if</span>&nbsp;<span class="builtinfunc" id="3935762">len</span><span class="op" id="3935765">(</span><span class="ident" id="3935766">msg</span><span class="op" id="3935769">)</span>&nbsp;<span class="op" id="3935771">&gt;</span>&nbsp;<span class="ident" id="3935773">k</span><span class="op" id="3935774">-</span><span class="num" id="3935775">2</span><span class="op" id="3935776">*</span><span class="ident" id="3935777">hash</span><span class="op" id="3935781">.</span><span class="ident" id="3935782">Size</span><span class="op" id="3935786">(</span><span class="op" id="3935787">)</span><span class="op" id="3935788">-</span><span class="num" id="3935789">2</span>&nbsp;<span class="op" id="3935791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3935795">err</span>&nbsp;<span class="op" id="3935799">=</span>&nbsp;<span class="ident" id="3935801">ErrMessageTooLong</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3935821">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3935829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3935833">hash</span><span class="op" id="3935837">.</span><span class="ident" id="3935838">Write</span><span class="op" id="3935843">(</span><span class="ident" id="3935844">label</span><span class="op" id="3935849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3935852">lHash</span>&nbsp;<span class="op" id="3935858">:=</span>&nbsp;<span class="ident" id="3935861">hash</span><span class="op" id="3935865">.</span><span class="ident" id="3935866">Sum</span><span class="op" id="3935869">(</span><span class="ident" id="3935870">nil</span><span class="op" id="3935873">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3935876">hash</span><span class="op" id="3935880">.</span><span class="ident" id="3935881">Reset</span><span class="op" id="3935886">(</span><span class="op" id="3935887">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3935891">em</span>&nbsp;<span class="op" id="3935894">:=</span>&nbsp;<span class="builtinfunc" id="3935897">make</span><span class="op" id="3935901">(</span><span class="op" id="3935902">[</span><span class="op" id="3935903">]</span><span class="builtintype" id="3935904">byte</span><span class="op" id="3935908">,</span>&nbsp;<span class="ident" id="3935910">k</span><span class="op" id="3935911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3935914">seed</span>&nbsp;<span class="op" id="3935919">:=</span>&nbsp;<span class="ident" id="3935922">em</span><span class="op" id="3935924">[</span><span class="num" id="3935925">1</span>&nbsp;<span class="op" id="3935927">:</span>&nbsp;<span class="num" id="3935929">1</span><span class="op" id="3935930">+</span><span class="ident" id="3935931">hash</span><span class="op" id="3935935">.</span><span class="ident" id="3935936">Size</span><span class="op" id="3935940">(</span><span class="op" id="3935941">)</span><span class="op" id="3935942">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3935945">db</span>&nbsp;<span class="op" id="3935948">:=</span>&nbsp;<span class="ident" id="3935951">em</span><span class="op" id="3935953">[</span><span class="num" id="3935954">1</span><span class="op" id="3935955">+</span><span class="ident" id="3935956">hash</span><span class="op" id="3935960">.</span><span class="ident" id="3935961">Size</span><span class="op" id="3935965">(</span><span class="op" id="3935966">)</span><span class="op" id="3935967">:</span><span class="op" id="3935968">]</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3935972">copy</span><span class="op" id="3935976">(</span><span class="ident" id="3935977">db</span><span class="op" id="3935979">[</span><span class="num" id="3935980">0</span><span class="op" id="3935981">:</span><span class="ident" id="3935982">hash</span><span class="op" id="3935986">.</span><span class="ident" id="3935987">Size</span><span class="op" id="3935991">(</span><span class="op" id="3935992">)</span><span class="op" id="3935993">]</span><span class="op" id="3935994">,</span>&nbsp;<span class="ident" id="3935996">lHash</span><span class="op" id="3936001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936004">db</span><span class="op" id="3936006">[</span><span class="builtinfunc" id="3936007">len</span><span class="op" id="3936010">(</span><span class="ident" id="3936011">db</span><span class="op" id="3936013">)</span><span class="op" id="3936014">-</span><span class="builtinfunc" id="3936015">len</span><span class="op" id="3936018">(</span><span class="ident" id="3936019">msg</span><span class="op" id="3936022">)</span><span class="op" id="3936023">-</span><span class="num" id="3936024">1</span><span class="op" id="3936025">]</span>&nbsp;<span class="op" id="3936027">=</span>&nbsp;<span class="num" id="3936029">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3936032">copy</span><span class="op" id="3936036">(</span><span class="ident" id="3936037">db</span><span class="op" id="3936039">[</span><span class="builtinfunc" id="3936040">len</span><span class="op" id="3936043">(</span><span class="ident" id="3936044">db</span><span class="op" id="3936046">)</span><span class="op" id="3936047">-</span><span class="builtinfunc" id="3936048">len</span><span class="op" id="3936051">(</span><span class="ident" id="3936052">msg</span><span class="op" id="3936055">)</span><span class="op" id="3936056">:</span><span class="op" id="3936057">]</span><span class="op" id="3936058">,</span>&nbsp;<span class="ident" id="3936060">msg</span><span class="op" id="3936063">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936067">_</span><span class="op" id="3936068">,</span>&nbsp;<span class="ident" id="3936070">err</span>&nbsp;<span class="op" id="3936074">=</span>&nbsp;<span class="ident" id="3936076">io</span><span class="op" id="3936078">.</span><span class="ident" id="3936079">ReadFull</span><span class="op" id="3936087">(</span><span class="ident" id="3936088">random</span><span class="op" id="3936094">,</span>&nbsp;<span class="ident" id="3936096">seed</span><span class="op" id="3936100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3936103">if</span>&nbsp;<span class="ident" id="3936106">err</span>&nbsp;<span class="op" id="3936110">!=</span>&nbsp;<span class="ident" id="3936113">nil</span>&nbsp;<span class="op" id="3936117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3936121">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3936129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936133">mgf1XOR</span><span class="op" id="3936140">(</span><span class="ident" id="3936141">db</span><span class="op" id="3936143">,</span>&nbsp;<span class="ident" id="3936145">hash</span><span class="op" id="3936149">,</span>&nbsp;<span class="ident" id="3936151">seed</span><span class="op" id="3936155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936158">mgf1XOR</span><span class="op" id="3936165">(</span><span class="ident" id="3936166">seed</span><span class="op" id="3936170">,</span>&nbsp;<span class="ident" id="3936172">hash</span><span class="op" id="3936176">,</span>&nbsp;<span class="ident" id="3936178">db</span><span class="op" id="3936180">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936184">m</span>&nbsp;<span class="op" id="3936186">:=</span>&nbsp;<span class="builtinfunc" id="3936189">new</span><span class="op" id="3936192">(</span><span class="ident" id="3936193">big</span><span class="op" id="3936196">.</span><span class="ident" id="3936197">Int</span><span class="op" id="3936200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936203">m</span><span class="op" id="3936204">.</span><span class="ident" id="3936205">SetBytes</span><span class="op" id="3936213">(</span><span class="ident" id="3936214">em</span><span class="op" id="3936216">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936219">c</span>&nbsp;<span class="op" id="3936221">:=</span>&nbsp;<span class="ident" id="3936224">encrypt</span><span class="op" id="3936231">(</span><span class="builtinfunc" id="3936232">new</span><span class="op" id="3936235">(</span><span class="ident" id="3936236">big</span><span class="op" id="3936239">.</span><span class="ident" id="3936240">Int</span><span class="op" id="3936243">)</span><span class="op" id="3936244">,</span>&nbsp;<span class="ident" id="3936246">pub</span><span class="op" id="3936249">,</span>&nbsp;<span class="ident" id="3936251">m</span><span class="op" id="3936252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936255">out</span>&nbsp;<span class="op" id="3936259">=</span>&nbsp;<span class="ident" id="3936261">c</span><span class="op" id="3936262">.</span><span class="ident" id="3936263">Bytes</span><span class="op" id="3936268">(</span><span class="op" id="3936269">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3936273">if</span>&nbsp;<span class="builtinfunc" id="3936276">len</span><span class="op" id="3936279">(</span><span class="ident" id="3936280">out</span><span class="op" id="3936283">)</span>&nbsp;<span class="op" id="3936285">&lt;</span>&nbsp;<span class="ident" id="3936287">k</span>&nbsp;<span class="op" id="3936289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3936293">//&nbsp;If&nbsp;the&nbsp;output&nbsp;is&nbsp;too&nbsp;small,&nbsp;we&nbsp;need&nbsp;to&nbsp;left-pad&nbsp;with&nbsp;zeros.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936358">t</span>&nbsp;<span class="op" id="3936360">:=</span>&nbsp;<span class="builtinfunc" id="3936363">make</span><span class="op" id="3936367">(</span><span class="op" id="3936368">[</span><span class="op" id="3936369">]</span><span class="builtintype" id="3936370">byte</span><span class="op" id="3936374">,</span>&nbsp;<span class="ident" id="3936376">k</span><span class="op" id="3936377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3936381">copy</span><span class="op" id="3936385">(</span><span class="ident" id="3936386">t</span><span class="op" id="3936387">[</span><span class="ident" id="3936388">k</span><span class="op" id="3936389">-</span><span class="builtinfunc" id="3936390">len</span><span class="op" id="3936393">(</span><span class="ident" id="3936394">out</span><span class="op" id="3936397">)</span><span class="op" id="3936398">:</span><span class="op" id="3936399">]</span><span class="op" id="3936400">,</span>&nbsp;<span class="ident" id="3936402">out</span><span class="op" id="3936405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936409">out</span>&nbsp;<span class="op" id="3936413">=</span>&nbsp;<span class="ident" id="3936415">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3936418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3936422">return</span><br>
<span class="lineno"></span><span class="op" id="3936429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3936432">//&nbsp;ErrDecryption&nbsp;represents&nbsp;a&nbsp;failure&nbsp;to&nbsp;decrypt&nbsp;a&nbsp;message.</span><br>
<span class="lineno"></span><span class="comment" id="3936492">//&nbsp;It&nbsp;is&nbsp;deliberately&nbsp;vague&nbsp;to&nbsp;avoid&nbsp;adaptive&nbsp;attacks.</span><br>
<span class="lineno">335</span><span class="keyword" id="3936547">var</span>&nbsp;<span class="ident" id="3936551">ErrDecryption</span>&nbsp;<span class="op" id="3936565">=</span>&nbsp;<span class="ident" id="3936567">errors</span><span class="op" id="3936573">.</span><span class="ident" id="3936574">New</span><span class="op" id="3936577">(</span><span class="string" id="3936578">&#34;crypto/rsa:&nbsp;decryption&nbsp;error&#34;</span><span class="op" id="3936608">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3936611">//&nbsp;ErrVerification&nbsp;represents&nbsp;a&nbsp;failure&nbsp;to&nbsp;verify&nbsp;a&nbsp;signature.</span><br>
<span class="lineno"></span><span class="comment" id="3936674">//&nbsp;It&nbsp;is&nbsp;deliberately&nbsp;vague&nbsp;to&nbsp;avoid&nbsp;adaptive&nbsp;attacks.</span><br>
<span class="lineno"></span><span class="keyword" id="3936729">var</span>&nbsp;<span class="ident" id="3936733">ErrVerification</span>&nbsp;<span class="op" id="3936749">=</span>&nbsp;<span class="ident" id="3936751">errors</span><span class="op" id="3936757">.</span><span class="ident" id="3936758">New</span><span class="op" id="3936761">(</span><span class="string" id="3936762">&#34;crypto/rsa:&nbsp;verification&nbsp;error&#34;</span><span class="op" id="3936794">)</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span><span class="comment" id="3936797">//&nbsp;modInverse&nbsp;returns&nbsp;ia,&nbsp;the&nbsp;inverse&nbsp;of&nbsp;a&nbsp;in&nbsp;the&nbsp;multiplicative&nbsp;group&nbsp;of&nbsp;prime</span><br>
<span class="lineno"></span><span class="comment" id="3936877">//&nbsp;order&nbsp;n.&nbsp;It&nbsp;requires&nbsp;that&nbsp;a&nbsp;be&nbsp;a&nbsp;member&nbsp;of&nbsp;the&nbsp;group&nbsp;(i.e.&nbsp;less&nbsp;than&nbsp;n).</span><br>
<span class="lineno"></span><span class="keyword" id="3936953">func</span>&nbsp;<span class="ident" id="3936958">modInverse</span><span class="op" id="3936968">(</span><span class="ident" id="3936969">a</span><span class="op" id="3936970">,</span>&nbsp;<span class="ident" id="3936972">n</span>&nbsp;<span class="op" id="3936974">*</span><span class="ident" id="3936975">big</span><span class="op" id="3936978">.</span><span class="ident" id="3936979">Int</span><span class="op" id="3936982">)</span>&nbsp;<span class="op" id="3936984">(</span><span class="ident" id="3936985">ia</span>&nbsp;<span class="op" id="3936988">*</span><span class="ident" id="3936989">big</span><span class="op" id="3936992">.</span><span class="ident" id="3936993">Int</span><span class="op" id="3936996">,</span>&nbsp;<span class="ident" id="3936998">ok</span>&nbsp;<span class="builtintype" id="3937001">bool</span><span class="op" id="3937005">)</span>&nbsp;<span class="op" id="3937007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937010">g</span>&nbsp;<span class="op" id="3937012">:=</span>&nbsp;<span class="builtinfunc" id="3937015">new</span><span class="op" id="3937018">(</span><span class="ident" id="3937019">big</span><span class="op" id="3937022">.</span><span class="ident" id="3937023">Int</span><span class="op" id="3937026">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937029">x</span>&nbsp;<span class="op" id="3937031">:=</span>&nbsp;<span class="builtinfunc" id="3937034">new</span><span class="op" id="3937037">(</span><span class="ident" id="3937038">big</span><span class="op" id="3937041">.</span><span class="ident" id="3937042">Int</span><span class="op" id="3937045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937048">y</span>&nbsp;<span class="op" id="3937050">:=</span>&nbsp;<span class="builtinfunc" id="3937053">new</span><span class="op" id="3937056">(</span><span class="ident" id="3937057">big</span><span class="op" id="3937060">.</span><span class="ident" id="3937061">Int</span><span class="op" id="3937064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937067">g</span><span class="op" id="3937068">.</span><span class="ident" id="3937069">GCD</span><span class="op" id="3937072">(</span><span class="ident" id="3937073">x</span><span class="op" id="3937074">,</span>&nbsp;<span class="ident" id="3937076">y</span><span class="op" id="3937077">,</span>&nbsp;<span class="ident" id="3937079">a</span><span class="op" id="3937080">,</span>&nbsp;<span class="ident" id="3937082">n</span><span class="op" id="3937083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3937086">if</span>&nbsp;<span class="ident" id="3937089">g</span><span class="op" id="3937090">.</span><span class="ident" id="3937091">Cmp</span><span class="op" id="3937094">(</span><span class="ident" id="3937095">bigOne</span><span class="op" id="3937101">)</span>&nbsp;<span class="op" id="3937103">!=</span>&nbsp;<span class="num" id="3937106">0</span>&nbsp;<span class="op" id="3937108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3937112">//&nbsp;In&nbsp;this&nbsp;case,&nbsp;a&nbsp;and&nbsp;n&nbsp;aren&#39;t&nbsp;coprime&nbsp;and&nbsp;we&nbsp;cannot&nbsp;calculate</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3937178">//&nbsp;the&nbsp;inverse.&nbsp;This&nbsp;happens&nbsp;because&nbsp;the&nbsp;values&nbsp;of&nbsp;n&nbsp;are&nbsp;nearly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3937244">//&nbsp;prime&nbsp;(being&nbsp;the&nbsp;product&nbsp;of&nbsp;two&nbsp;primes)&nbsp;rather&nbsp;than&nbsp;truly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3937307">//&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3937319">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3937327">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3937331">if</span>&nbsp;<span class="ident" id="3937334">x</span><span class="op" id="3937335">.</span><span class="ident" id="3937336">Cmp</span><span class="op" id="3937339">(</span><span class="ident" id="3937340">bigOne</span><span class="op" id="3937346">)</span>&nbsp;<span class="op" id="3937348">&lt;</span>&nbsp;<span class="num" id="3937350">0</span>&nbsp;<span class="op" id="3937352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3937356">//&nbsp;0&nbsp;is&nbsp;not&nbsp;the&nbsp;multiplicative&nbsp;inverse&nbsp;of&nbsp;any&nbsp;element&nbsp;so,&nbsp;if&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3937421">//&nbsp;&lt;&nbsp;1,&nbsp;then&nbsp;x&nbsp;is&nbsp;negative.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937451">x</span><span class="op" id="3937452">.</span><span class="ident" id="3937453">Add</span><span class="op" id="3937456">(</span><span class="ident" id="3937457">x</span><span class="op" id="3937458">,</span>&nbsp;<span class="ident" id="3937460">n</span><span class="op" id="3937461">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3937464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3937468">return</span>&nbsp;<span class="ident" id="3937475">x</span><span class="op" id="3937476">,</span>&nbsp;<span class="builtintype" id="3937478">true</span><br>
<span class="lineno"></span><span class="op" id="3937483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="3937486">//&nbsp;Precompute&nbsp;performs&nbsp;some&nbsp;calculations&nbsp;that&nbsp;speed&nbsp;up&nbsp;private&nbsp;key&nbsp;operations</span><br>
<span class="lineno"></span><span class="comment" id="3937564">//&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno"></span><span class="keyword" id="3937582">func</span>&nbsp;<span class="op" id="3937587">(</span><span class="ident" id="3937588">priv</span>&nbsp;<span class="op" id="3937593">*</span><span class="ident" id="3937594">PrivateKey</span><span class="op" id="3937604">)</span>&nbsp;<span class="ident" id="3937606">Precompute</span><span class="op" id="3937616">(</span><span class="op" id="3937617">)</span>&nbsp;<span class="op" id="3937619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3937622">if</span>&nbsp;<span class="ident" id="3937625">priv</span><span class="op" id="3937629">.</span><span class="ident" id="3937630">Precomputed</span><span class="op" id="3937641">.</span><span class="ident" id="3937642">Dp</span>&nbsp;<span class="op" id="3937645">!=</span>&nbsp;<span class="ident" id="3937648">nil</span>&nbsp;<span class="op" id="3937652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3937656">return</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3937664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937668">priv</span><span class="op" id="3937672">.</span><span class="ident" id="3937673">Precomputed</span><span class="op" id="3937684">.</span><span class="ident" id="3937685">Dp</span>&nbsp;<span class="op" id="3937688">=</span>&nbsp;<span class="builtinfunc" id="3937690">new</span><span class="op" id="3937693">(</span><span class="ident" id="3937694">big</span><span class="op" id="3937697">.</span><span class="ident" id="3937698">Int</span><span class="op" id="3937701">)</span><span class="op" id="3937702">.</span><span class="ident" id="3937703">Sub</span><span class="op" id="3937706">(</span><span class="ident" id="3937707">priv</span><span class="op" id="3937711">.</span><span class="ident" id="3937712">Primes</span><span class="op" id="3937718">[</span><span class="num" id="3937719">0</span><span class="op" id="3937720">]</span><span class="op" id="3937721">,</span>&nbsp;<span class="ident" id="3937723">bigOne</span><span class="op" id="3937729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937732">priv</span><span class="op" id="3937736">.</span><span class="ident" id="3937737">Precomputed</span><span class="op" id="3937748">.</span><span class="ident" id="3937749">Dp</span><span class="op" id="3937751">.</span><span class="ident" id="3937752">Mod</span><span class="op" id="3937755">(</span><span class="ident" id="3937756">priv</span><span class="op" id="3937760">.</span><span class="ident" id="3937761">D</span><span class="op" id="3937762">,</span>&nbsp;<span class="ident" id="3937764">priv</span><span class="op" id="3937768">.</span><span class="ident" id="3937769">Precomputed</span><span class="op" id="3937780">.</span><span class="ident" id="3937781">Dp</span><span class="op" id="3937783">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937787">priv</span><span class="op" id="3937791">.</span><span class="ident" id="3937792">Precomputed</span><span class="op" id="3937803">.</span><span class="ident" id="3937804">Dq</span>&nbsp;<span class="op" id="3937807">=</span>&nbsp;<span class="builtinfunc" id="3937809">new</span><span class="op" id="3937812">(</span><span class="ident" id="3937813">big</span><span class="op" id="3937816">.</span><span class="ident" id="3937817">Int</span><span class="op" id="3937820">)</span><span class="op" id="3937821">.</span><span class="ident" id="3937822">Sub</span><span class="op" id="3937825">(</span><span class="ident" id="3937826">priv</span><span class="op" id="3937830">.</span><span class="ident" id="3937831">Primes</span><span class="op" id="3937837">[</span><span class="num" id="3937838">1</span><span class="op" id="3937839">]</span><span class="op" id="3937840">,</span>&nbsp;<span class="ident" id="3937842">bigOne</span><span class="op" id="3937848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937851">priv</span><span class="op" id="3937855">.</span><span class="ident" id="3937856">Precomputed</span><span class="op" id="3937867">.</span><span class="ident" id="3937868">Dq</span><span class="op" id="3937870">.</span><span class="ident" id="3937871">Mod</span><span class="op" id="3937874">(</span><span class="ident" id="3937875">priv</span><span class="op" id="3937879">.</span><span class="ident" id="3937880">D</span><span class="op" id="3937881">,</span>&nbsp;<span class="ident" id="3937883">priv</span><span class="op" id="3937887">.</span><span class="ident" id="3937888">Precomputed</span><span class="op" id="3937899">.</span><span class="ident" id="3937900">Dq</span><span class="op" id="3937902">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937906">priv</span><span class="op" id="3937910">.</span><span class="ident" id="3937911">Precomputed</span><span class="op" id="3937922">.</span><span class="ident" id="3937923">Qinv</span>&nbsp;<span class="op" id="3937928">=</span>&nbsp;<span class="builtinfunc" id="3937930">new</span><span class="op" id="3937933">(</span><span class="ident" id="3937934">big</span><span class="op" id="3937937">.</span><span class="ident" id="3937938">Int</span><span class="op" id="3937941">)</span><span class="op" id="3937942">.</span><span class="ident" id="3937943">ModInverse</span><span class="op" id="3937953">(</span><span class="ident" id="3937954">priv</span><span class="op" id="3937958">.</span><span class="ident" id="3937959">Primes</span><span class="op" id="3937965">[</span><span class="num" id="3937966">1</span><span class="op" id="3937967">]</span><span class="op" id="3937968">,</span>&nbsp;<span class="ident" id="3937970">priv</span><span class="op" id="3937974">.</span><span class="ident" id="3937975">Primes</span><span class="op" id="3937981">[</span><span class="num" id="3937982">0</span><span class="op" id="3937983">]</span><span class="op" id="3937984">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937988">r</span>&nbsp;<span class="op" id="3937990">:=</span>&nbsp;<span class="builtinfunc" id="3937993">new</span><span class="op" id="3937996">(</span><span class="ident" id="3937997">big</span><span class="op" id="3938000">.</span><span class="ident" id="3938001">Int</span><span class="op" id="3938004">)</span><span class="op" id="3938005">.</span><span class="ident" id="3938006">Mul</span><span class="op" id="3938009">(</span><span class="ident" id="3938010">priv</span><span class="op" id="3938014">.</span><span class="ident" id="3938015">Primes</span><span class="op" id="3938021">[</span><span class="num" id="3938022">0</span><span class="op" id="3938023">]</span><span class="op" id="3938024">,</span>&nbsp;<span class="ident" id="3938026">priv</span><span class="op" id="3938030">.</span><span class="ident" id="3938031">Primes</span><span class="op" id="3938037">[</span><span class="num" id="3938038">1</span><span class="op" id="3938039">]</span><span class="op" id="3938040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938043">priv</span><span class="op" id="3938047">.</span><span class="ident" id="3938048">Precomputed</span><span class="op" id="3938059">.</span><span class="ident" id="3938060">CRTValues</span>&nbsp;<span class="op" id="3938070">=</span>&nbsp;<span class="builtinfunc" id="3938072">make</span><span class="op" id="3938076">(</span><span class="op" id="3938077">[</span><span class="op" id="3938078">]</span><span class="ident" id="3938079">CRTValue</span><span class="op" id="3938087">,</span>&nbsp;<span class="builtinfunc" id="3938089">len</span><span class="op" id="3938092">(</span><span class="ident" id="3938093">priv</span><span class="op" id="3938097">.</span><span class="ident" id="3938098">Primes</span><span class="op" id="3938104">)</span><span class="op" id="3938105">-</span><span class="num" id="3938106">2</span><span class="op" id="3938107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3938110">for</span>&nbsp;<span class="ident" id="3938114">i</span>&nbsp;<span class="op" id="3938116">:=</span>&nbsp;<span class="num" id="3938119">2</span><span class="op" id="3938120">;</span>&nbsp;<span class="ident" id="3938122">i</span>&nbsp;<span class="op" id="3938124">&lt;</span>&nbsp;<span class="builtinfunc" id="3938126">len</span><span class="op" id="3938129">(</span><span class="ident" id="3938130">priv</span><span class="op" id="3938134">.</span><span class="ident" id="3938135">Primes</span><span class="op" id="3938141">)</span><span class="op" id="3938142">;</span>&nbsp;<span class="ident" id="3938144">i</span><span class="op" id="3938145">++</span>&nbsp;<span class="op" id="3938148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938152">prime</span>&nbsp;<span class="op" id="3938158">:=</span>&nbsp;<span class="ident" id="3938161">priv</span><span class="op" id="3938165">.</span><span class="ident" id="3938166">Primes</span><span class="op" id="3938172">[</span><span class="ident" id="3938173">i</span><span class="op" id="3938174">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938178">values</span>&nbsp;<span class="op" id="3938185">:=</span>&nbsp;<span class="op" id="3938188">&amp;</span><span class="ident" id="3938189">priv</span><span class="op" id="3938193">.</span><span class="ident" id="3938194">Precomputed</span><span class="op" id="3938205">.</span><span class="ident" id="3938206">CRTValues</span><span class="op" id="3938215">[</span><span class="ident" id="3938216">i</span><span class="op" id="3938217">-</span><span class="num" id="3938218">2</span><span class="op" id="3938219">]</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938224">values</span><span class="op" id="3938230">.</span><span class="ident" id="3938231">Exp</span>&nbsp;<span class="op" id="3938235">=</span>&nbsp;<span class="builtinfunc" id="3938237">new</span><span class="op" id="3938240">(</span><span class="ident" id="3938241">big</span><span class="op" id="3938244">.</span><span class="ident" id="3938245">Int</span><span class="op" id="3938248">)</span><span class="op" id="3938249">.</span><span class="ident" id="3938250">Sub</span><span class="op" id="3938253">(</span><span class="ident" id="3938254">prime</span><span class="op" id="3938259">,</span>&nbsp;<span class="ident" id="3938261">bigOne</span><span class="op" id="3938267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938271">values</span><span class="op" id="3938277">.</span><span class="ident" id="3938278">Exp</span><span class="op" id="3938281">.</span><span class="ident" id="3938282">Mod</span><span class="op" id="3938285">(</span><span class="ident" id="3938286">priv</span><span class="op" id="3938290">.</span><span class="ident" id="3938291">D</span><span class="op" id="3938292">,</span>&nbsp;<span class="ident" id="3938294">values</span><span class="op" id="3938300">.</span><span class="ident" id="3938301">Exp</span><span class="op" id="3938304">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938309">values</span><span class="op" id="3938315">.</span><span class="ident" id="3938316">R</span>&nbsp;<span class="op" id="3938318">=</span>&nbsp;<span class="builtinfunc" id="3938320">new</span><span class="op" id="3938323">(</span><span class="ident" id="3938324">big</span><span class="op" id="3938327">.</span><span class="ident" id="3938328">Int</span><span class="op" id="3938331">)</span><span class="op" id="3938332">.</span><span class="ident" id="3938333">Set</span><span class="op" id="3938336">(</span><span class="ident" id="3938337">r</span><span class="op" id="3938338">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938342">values</span><span class="op" id="3938348">.</span><span class="ident" id="3938349">Coeff</span>&nbsp;<span class="op" id="3938355">=</span>&nbsp;<span class="builtinfunc" id="3938357">new</span><span class="op" id="3938360">(</span><span class="ident" id="3938361">big</span><span class="op" id="3938364">.</span><span class="ident" id="3938365">Int</span><span class="op" id="3938368">)</span><span class="op" id="3938369">.</span><span class="ident" id="3938370">ModInverse</span><span class="op" id="3938380">(</span><span class="ident" id="3938381">r</span><span class="op" id="3938382">,</span>&nbsp;<span class="ident" id="3938384">prime</span><span class="op" id="3938389">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938394">r</span><span class="op" id="3938395">.</span><span class="ident" id="3938396">Mul</span><span class="op" id="3938399">(</span><span class="ident" id="3938400">r</span><span class="op" id="3938401">,</span>&nbsp;<span class="ident" id="3938403">prime</span><span class="op" id="3938408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3938411">}</span><br>
<span class="lineno"></span><span class="op" id="3938413">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="comment" id="3938416">//&nbsp;decrypt&nbsp;performs&nbsp;an&nbsp;RSA&nbsp;decryption,&nbsp;resulting&nbsp;in&nbsp;a&nbsp;plaintext&nbsp;integer.&nbsp;If&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3938494">//&nbsp;random&nbsp;source&nbsp;is&nbsp;given,&nbsp;RSA&nbsp;blinding&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="3938543">func</span>&nbsp;<span class="ident" id="3938548">decrypt</span><span class="op" id="3938555">(</span><span class="ident" id="3938556">random</span>&nbsp;<span class="ident" id="3938563">io</span><span class="op" id="3938565">.</span><span class="ident" id="3938566">Reader</span><span class="op" id="3938572">,</span>&nbsp;<span class="ident" id="3938574">priv</span>&nbsp;<span class="op" id="3938579">*</span><span class="ident" id="3938580">PrivateKey</span><span class="op" id="3938590">,</span>&nbsp;<span class="ident" id="3938592">c</span>&nbsp;<span class="op" id="3938594">*</span><span class="ident" id="3938595">big</span><span class="op" id="3938598">.</span><span class="ident" id="3938599">Int</span><span class="op" id="3938602">)</span>&nbsp;<span class="op" id="3938604">(</span><span class="ident" id="3938605">m</span>&nbsp;<span class="op" id="3938607">*</span><span class="ident" id="3938608">big</span><span class="op" id="3938611">.</span><span class="ident" id="3938612">Int</span><span class="op" id="3938615">,</span>&nbsp;<span class="ident" id="3938617">err</span>&nbsp;<span class="builtintype" id="3938621">error</span><span class="op" id="3938626">)</span>&nbsp;<span class="op" id="3938628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3938631">//&nbsp;TODO(agl):&nbsp;can&nbsp;we&nbsp;get&nbsp;away&nbsp;with&nbsp;reusing&nbsp;blinds?</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3938683">if</span>&nbsp;<span class="ident" id="3938686">c</span><span class="op" id="3938687">.</span><span class="ident" id="3938688">Cmp</span><span class="op" id="3938691">(</span><span class="ident" id="3938692">priv</span><span class="op" id="3938696">.</span><span class="ident" id="3938697">N</span><span class="op" id="3938698">)</span>&nbsp;<span class="op" id="3938700">&gt;</span>&nbsp;<span class="num" id="3938702">0</span>&nbsp;<span class="op" id="3938704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938708">err</span>&nbsp;<span class="op" id="3938712">=</span>&nbsp;<span class="ident" id="3938714">ErrDecryption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3938730">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3938738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3938742">var</span>&nbsp;<span class="ident" id="3938746">ir</span>&nbsp;<span class="op" id="3938749">*</span><span class="ident" id="3938750">big</span><span class="op" id="3938753">.</span><span class="ident" id="3938754">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3938759">if</span>&nbsp;<span class="ident" id="3938762">random</span>&nbsp;<span class="op" id="3938769">!=</span>&nbsp;<span class="ident" id="3938772">nil</span>&nbsp;<span class="op" id="3938776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3938780">//&nbsp;Blinding&nbsp;enabled.&nbsp;Blinding&nbsp;involves&nbsp;multiplying&nbsp;c&nbsp;by&nbsp;r^e.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3938843">//&nbsp;Then&nbsp;the&nbsp;decryption&nbsp;operation&nbsp;performs&nbsp;(m^e&nbsp;*&nbsp;r^e)^d&nbsp;mod&nbsp;n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3938907">//&nbsp;which&nbsp;equals&nbsp;mr&nbsp;mod&nbsp;n.&nbsp;The&nbsp;factor&nbsp;of&nbsp;r&nbsp;can&nbsp;then&nbsp;be&nbsp;removed</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3938971">//&nbsp;by&nbsp;multiplying&nbsp;by&nbsp;the&nbsp;multiplicative&nbsp;inverse&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3939028">var</span>&nbsp;<span class="ident" id="3939032">r</span>&nbsp;<span class="op" id="3939034">*</span><span class="ident" id="3939035">big</span><span class="op" id="3939038">.</span><span class="ident" id="3939039">Int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3939046">for</span>&nbsp;<span class="op" id="3939050">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939055">r</span><span class="op" id="3939056">,</span>&nbsp;<span class="ident" id="3939058">err</span>&nbsp;<span class="op" id="3939062">=</span>&nbsp;<span class="ident" id="3939064">rand</span><span class="op" id="3939068">.</span><span class="ident" id="3939069">Int</span><span class="op" id="3939072">(</span><span class="ident" id="3939073">random</span><span class="op" id="3939079">,</span>&nbsp;<span class="ident" id="3939081">priv</span><span class="op" id="3939085">.</span><span class="ident" id="3939086">N</span><span class="op" id="3939087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3939092">if</span>&nbsp;<span class="ident" id="3939095">err</span>&nbsp;<span class="op" id="3939099">!=</span>&nbsp;<span class="ident" id="3939102">nil</span>&nbsp;<span class="op" id="3939106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3939112">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3939122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3939127">if</span>&nbsp;<span class="ident" id="3939130">r</span><span class="op" id="3939131">.</span><span class="ident" id="3939132">Cmp</span><span class="op" id="3939135">(</span><span class="ident" id="3939136">bigZero</span><span class="op" id="3939143">)</span>&nbsp;<span class="op" id="3939145">==</span>&nbsp;<span class="num" id="3939148">0</span>&nbsp;<span class="op" id="3939150">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939156">r</span>&nbsp;<span class="op" id="3939158">=</span>&nbsp;<span class="ident" id="3939160">bigOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3939170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3939175">var</span>&nbsp;<span class="ident" id="3939179">ok</span>&nbsp;<span class="builtintype" id="3939182">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939190">ir</span><span class="op" id="3939192">,</span>&nbsp;<span class="ident" id="3939194">ok</span>&nbsp;<span class="op" id="3939197">=</span>&nbsp;<span class="ident" id="3939199">modInverse</span><span class="op" id="3939209">(</span><span class="ident" id="3939210">r</span><span class="op" id="3939211">,</span>&nbsp;<span class="ident" id="3939213">priv</span><span class="op" id="3939217">.</span><span class="ident" id="3939218">N</span><span class="op" id="3939219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3939224">if</span>&nbsp;<span class="ident" id="3939227">ok</span>&nbsp;<span class="op" id="3939230">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3939236">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3939245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3939249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939253">bigE</span>&nbsp;<span class="op" id="3939258">:=</span>&nbsp;<span class="ident" id="3939261">big</span><span class="op" id="3939264">.</span><span class="ident" id="3939265">NewInt</span><span class="op" id="3939271">(</span><span class="ident" id="3939272">int64</span><span class="op" id="3939277">(</span><span class="ident" id="3939278">priv</span><span class="op" id="3939282">.</span><span class="ident" id="3939283">E</span><span class="op" id="3939284">)</span><span class="op" id="3939285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939289">rpowe</span>&nbsp;<span class="op" id="3939295">:=</span>&nbsp;<span class="builtinfunc" id="3939298">new</span><span class="op" id="3939301">(</span><span class="ident" id="3939302">big</span><span class="op" id="3939305">.</span><span class="ident" id="3939306">Int</span><span class="op" id="3939309">)</span><span class="op" id="3939310">.</span><span class="ident" id="3939311">Exp</span><span class="op" id="3939314">(</span><span class="ident" id="3939315">r</span><span class="op" id="3939316">,</span>&nbsp;<span class="ident" id="3939318">bigE</span><span class="op" id="3939322">,</span>&nbsp;<span class="ident" id="3939324">priv</span><span class="op" id="3939328">.</span><span class="ident" id="3939329">N</span><span class="op" id="3939330">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939334">cCopy</span>&nbsp;<span class="op" id="3939340">:=</span>&nbsp;<span class="builtinfunc" id="3939343">new</span><span class="op" id="3939346">(</span><span class="ident" id="3939347">big</span><span class="op" id="3939350">.</span><span class="ident" id="3939351">Int</span><span class="op" id="3939354">)</span><span class="op" id="3939355">.</span><span class="ident" id="3939356">Set</span><span class="op" id="3939359">(</span><span class="ident" id="3939360">c</span><span class="op" id="3939361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939365">cCopy</span><span class="op" id="3939370">.</span><span class="ident" id="3939371">Mul</span><span class="op" id="3939374">(</span><span class="ident" id="3939375">cCopy</span><span class="op" id="3939380">,</span>&nbsp;<span class="ident" id="3939382">rpowe</span><span class="op" id="3939387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939391">cCopy</span><span class="op" id="3939396">.</span><span class="ident" id="3939397">Mod</span><span class="op" id="3939400">(</span><span class="ident" id="3939401">cCopy</span><span class="op" id="3939406">,</span>&nbsp;<span class="ident" id="3939408">priv</span><span class="op" id="3939412">.</span><span class="ident" id="3939413">N</span><span class="op" id="3939414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939418">c</span>&nbsp;<span class="op" id="3939420">=</span>&nbsp;<span class="ident" id="3939422">cCopy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3939429">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3939433">if</span>&nbsp;<span class="ident" id="3939436">priv</span><span class="op" id="3939440">.</span><span class="ident" id="3939441">Precomputed</span><span class="op" id="3939452">.</span><span class="ident" id="3939453">Dp</span>&nbsp;<span class="op" id="3939456">==</span>&nbsp;<span class="ident" id="3939459">nil</span>&nbsp;<span class="op" id="3939463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939467">m</span>&nbsp;<span class="op" id="3939469">=</span>&nbsp;<span class="builtinfunc" id="3939471">new</span><span class="op" id="3939474">(</span><span class="ident" id="3939475">big</span><span class="op" id="3939478">.</span><span class="ident" id="3939479">Int</span><span class="op" id="3939482">)</span><span class="op" id="3939483">.</span><span class="ident" id="3939484">Exp</span><span class="op" id="3939487">(</span><span class="ident" id="3939488">c</span><span class="op" id="3939489">,</span>&nbsp;<span class="ident" id="3939491">priv</span><span class="op" id="3939495">.</span><span class="ident" id="3939496">D</span><span class="op" id="3939497">,</span>&nbsp;<span class="ident" id="3939499">priv</span><span class="op" id="3939503">.</span><span class="ident" id="3939504">N</span><span class="op" id="3939505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3939508">}</span>&nbsp;<span class="keyword" id="3939510">else</span>&nbsp;<span class="op" id="3939515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3939519">//&nbsp;We&nbsp;have&nbsp;the&nbsp;precalculated&nbsp;values&nbsp;needed&nbsp;for&nbsp;the&nbsp;CRT.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939577">m</span>&nbsp;<span class="op" id="3939579">=</span>&nbsp;<span class="builtinfunc" id="3939581">new</span><span class="op" id="3939584">(</span><span class="ident" id="3939585">big</span><span class="op" id="3939588">.</span><span class="ident" id="3939589">Int</span><span class="op" id="3939592">)</span><span class="op" id="3939593">.</span><span class="ident" id="3939594">Exp</span><span class="op" id="3939597">(</span><span class="ident" id="3939598">c</span><span class="op" id="3939599">,</span>&nbsp;<span class="ident" id="3939601">priv</span><span class="op" id="3939605">.</span><span class="ident" id="3939606">Precomputed</span><span class="op" id="3939617">.</span><span class="ident" id="3939618">Dp</span><span class="op" id="3939620">,</span>&nbsp;<span class="ident" id="3939622">priv</span><span class="op" id="3939626">.</span><span class="ident" id="3939627">Primes</span><span class="op" id="3939633">[</span><span class="num" id="3939634">0</span><span class="op" id="3939635">]</span><span class="op" id="3939636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939640">m2</span>&nbsp;<span class="op" id="3939643">:=</span>&nbsp;<span class="builtinfunc" id="3939646">new</span><span class="op" id="3939649">(</span><span class="ident" id="3939650">big</span><span class="op" id="3939653">.</span><span class="ident" id="3939654">Int</span><span class="op" id="3939657">)</span><span class="op" id="3939658">.</span><span class="ident" id="3939659">Exp</span><span class="op" id="3939662">(</span><span class="ident" id="3939663">c</span><span class="op" id="3939664">,</span>&nbsp;<span class="ident" id="3939666">priv</span><span class="op" id="3939670">.</span><span class="ident" id="3939671">Precomputed</span><span class="op" id="3939682">.</span><span class="ident" id="3939683">Dq</span><span class="op" id="3939685">,</span>&nbsp;<span class="ident" id="3939687">priv</span><span class="op" id="3939691">.</span><span class="ident" id="3939692">Primes</span><span class="op" id="3939698">[</span><span class="num" id="3939699">1</span><span class="op" id="3939700">]</span><span class="op" id="3939701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939705">m</span><span class="op" id="3939706">.</span><span class="ident" id="3939707">Sub</span><span class="op" id="3939710">(</span><span class="ident" id="3939711">m</span><span class="op" id="3939712">,</span>&nbsp;<span class="ident" id="3939714">m2</span><span class="op" id="3939716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3939720">if</span>&nbsp;<span class="ident" id="3939723">m</span><span class="op" id="3939724">.</span><span class="ident" id="3939725">Sign</span><span class="op" id="3939729">(</span><span class="op" id="3939730">)</span>&nbsp;<span class="op" id="3939732">&lt;</span>&nbsp;<span class="num" id="3939734">0</span>&nbsp;<span class="op" id="3939736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939741">m</span><span class="op" id="3939742">.</span><span class="ident" id="3939743">Add</span><span class="op" id="3939746">(</span><span class="ident" id="3939747">m</span><span class="op" id="3939748">,</span>&nbsp;<span class="ident" id="3939750">priv</span><span class="op" id="3939754">.</span><span class="ident" id="3939755">Primes</span><span class="op" id="3939761">[</span><span class="num" id="3939762">0</span><span class="op" id="3939763">]</span><span class="op" id="3939764">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3939768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939772">m</span><span class="op" id="3939773">.</span><span class="ident" id="3939774">Mul</span><span class="op" id="3939777">(</span><span class="ident" id="3939778">m</span><span class="op" id="3939779">,</span>&nbsp;<span class="ident" id="3939781">priv</span><span class="op" id="3939785">.</span><span class="ident" id="3939786">Precomputed</span><span class="op" id="3939797">.</span><span class="ident" id="3939798">Qinv</span><span class="op" id="3939802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939806">m</span><span class="op" id="3939807">.</span><span class="ident" id="3939808">Mod</span><span class="op" id="3939811">(</span><span class="ident" id="3939812">m</span><span class="op" id="3939813">,</span>&nbsp;<span class="ident" id="3939815">priv</span><span class="op" id="3939819">.</span><span class="ident" id="3939820">Primes</span><span class="op" id="3939826">[</span><span class="num" id="3939827">0</span><span class="op" id="3939828">]</span><span class="op" id="3939829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939833">m</span><span class="op" id="3939834">.</span><span class="ident" id="3939835">Mul</span><span class="op" id="3939838">(</span><span class="ident" id="3939839">m</span><span class="op" id="3939840">,</span>&nbsp;<span class="ident" id="3939842">priv</span><span class="op" id="3939846">.</span><span class="ident" id="3939847">Primes</span><span class="op" id="3939853">[</span><span class="num" id="3939854">1</span><span class="op" id="3939855">]</span><span class="op" id="3939856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939860">m</span><span class="op" id="3939861">.</span><span class="ident" id="3939862">Add</span><span class="op" id="3939865">(</span><span class="ident" id="3939866">m</span><span class="op" id="3939867">,</span>&nbsp;<span class="ident" id="3939869">m2</span><span class="op" id="3939871">)</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3939876">for</span>&nbsp;<span class="ident" id="3939880">i</span><span class="op" id="3939881">,</span>&nbsp;<span class="ident" id="3939883">values</span>&nbsp;<span class="op" id="3939890">:=</span>&nbsp;<span class="keyword" id="3939893">range</span>&nbsp;<span class="ident" id="3939899">priv</span><span class="op" id="3939903">.</span><span class="ident" id="3939904">Precomputed</span><span class="op" id="3939915">.</span><span class="ident" id="3939916">CRTValues</span>&nbsp;<span class="op" id="3939926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939931">prime</span>&nbsp;<span class="op" id="3939937">:=</span>&nbsp;<span class="ident" id="3939940">priv</span><span class="op" id="3939944">.</span><span class="ident" id="3939945">Primes</span><span class="op" id="3939951">[</span><span class="num" id="3939952">2</span><span class="op" id="3939953">+</span><span class="ident" id="3939954">i</span><span class="op" id="3939955">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939960">m2</span><span class="op" id="3939962">.</span><span class="ident" id="3939963">Exp</span><span class="op" id="3939966">(</span><span class="ident" id="3939967">c</span><span class="op" id="3939968">,</span>&nbsp;<span class="ident" id="3939970">values</span><span class="op" id="3939976">.</span><span class="ident" id="3939977">Exp</span><span class="op" id="3939980">,</span>&nbsp;<span class="ident" id="3939982">prime</span><span class="op" id="3939987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939992">m2</span><span class="op" id="3939994">.</span><span class="ident" id="3939995">Sub</span><span class="op" id="3939998">(</span><span class="ident" id="3939999">m2</span><span class="op" id="3940001">,</span>&nbsp;<span class="ident" id="3940003">m</span><span class="op" id="3940004">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940009">m2</span><span class="op" id="3940011">.</span><span class="ident" id="3940012">Mul</span><span class="op" id="3940015">(</span><span class="ident" id="3940016">m2</span><span class="op" id="3940018">,</span>&nbsp;<span class="ident" id="3940020">values</span><span class="op" id="3940026">.</span><span class="ident" id="3940027">Coeff</span><span class="op" id="3940032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940037">m2</span><span class="op" id="3940039">.</span><span class="ident" id="3940040">Mod</span><span class="op" id="3940043">(</span><span class="ident" id="3940044">m2</span><span class="op" id="3940046">,</span>&nbsp;<span class="ident" id="3940048">prime</span><span class="op" id="3940053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940058">if</span>&nbsp;<span class="ident" id="3940061">m2</span><span class="op" id="3940063">.</span><span class="ident" id="3940064">Sign</span><span class="op" id="3940068">(</span><span class="op" id="3940069">)</span>&nbsp;<span class="op" id="3940071">&lt;</span>&nbsp;<span class="num" id="3940073">0</span>&nbsp;<span class="op" id="3940075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940081">m2</span><span class="op" id="3940083">.</span><span class="ident" id="3940084">Add</span><span class="op" id="3940087">(</span><span class="ident" id="3940088">m2</span><span class="op" id="3940090">,</span>&nbsp;<span class="ident" id="3940092">prime</span><span class="op" id="3940097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940102">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940107">m2</span><span class="op" id="3940109">.</span><span class="ident" id="3940110">Mul</span><span class="op" id="3940113">(</span><span class="ident" id="3940114">m2</span><span class="op" id="3940116">,</span>&nbsp;<span class="ident" id="3940118">values</span><span class="op" id="3940124">.</span><span class="ident" id="3940125">R</span><span class="op" id="3940126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940131">m</span><span class="op" id="3940132">.</span><span class="ident" id="3940133">Add</span><span class="op" id="3940136">(</span><span class="ident" id="3940137">m</span><span class="op" id="3940138">,</span>&nbsp;<span class="ident" id="3940140">m2</span><span class="op" id="3940142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940153">if</span>&nbsp;<span class="ident" id="3940156">ir</span>&nbsp;<span class="op" id="3940159">!=</span>&nbsp;<span class="ident" id="3940162">nil</span>&nbsp;<span class="op" id="3940166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3940170">//&nbsp;Unblind.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940184">m</span><span class="op" id="3940185">.</span><span class="ident" id="3940186">Mul</span><span class="op" id="3940189">(</span><span class="ident" id="3940190">m</span><span class="op" id="3940191">,</span>&nbsp;<span class="ident" id="3940193">ir</span><span class="op" id="3940195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940199">m</span><span class="op" id="3940200">.</span><span class="ident" id="3940201">Mod</span><span class="op" id="3940204">(</span><span class="ident" id="3940205">m</span><span class="op" id="3940206">,</span>&nbsp;<span class="ident" id="3940208">priv</span><span class="op" id="3940212">.</span><span class="ident" id="3940213">N</span><span class="op" id="3940214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940217">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940221">return</span><br>
<span class="lineno"></span><span class="op" id="3940228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3940231">//&nbsp;DecryptOAEP&nbsp;decrypts&nbsp;ciphertext&nbsp;using&nbsp;RSA-OAEP.</span><br>
<span class="lineno">475</span><span class="comment" id="3940282">//&nbsp;If&nbsp;random&nbsp;!=&nbsp;nil,&nbsp;DecryptOAEP&nbsp;uses&nbsp;RSA&nbsp;blinding&nbsp;to&nbsp;avoid&nbsp;timing&nbsp;side-channel&nbsp;attacks.</span><br>
<span class="lineno"></span><span class="keyword" id="3940371">func</span>&nbsp;<span class="ident" id="3940376">DecryptOAEP</span><span class="op" id="3940387">(</span><span class="ident" id="3940388">hash</span>&nbsp;<span class="ident" id="3940393">hash</span><span class="op" id="3940397">.</span><span class="ident" id="3940398">Hash</span><span class="op" id="3940402">,</span>&nbsp;<span class="ident" id="3940404">random</span>&nbsp;<span class="ident" id="3940411">io</span><span class="op" id="3940413">.</span><span class="ident" id="3940414">Reader</span><span class="op" id="3940420">,</span>&nbsp;<span class="ident" id="3940422">priv</span>&nbsp;<span class="op" id="3940427">*</span><span class="ident" id="3940428">PrivateKey</span><span class="op" id="3940438">,</span>&nbsp;<span class="ident" id="3940440">ciphertext</span>&nbsp;<span class="op" id="3940451">[</span><span class="op" id="3940452">]</span><span class="builtintype" id="3940453">byte</span><span class="op" id="3940457">,</span>&nbsp;<span class="ident" id="3940459">label</span>&nbsp;<span class="op" id="3940465">[</span><span class="op" id="3940466">]</span><span class="builtintype" id="3940467">byte</span><span class="op" id="3940471">)</span>&nbsp;<span class="op" id="3940473">(</span><span class="ident" id="3940474">msg</span>&nbsp;<span class="op" id="3940478">[</span><span class="op" id="3940479">]</span><span class="builtintype" id="3940480">byte</span><span class="op" id="3940484">,</span>&nbsp;<span class="ident" id="3940486">err</span>&nbsp;<span class="builtintype" id="3940490">error</span><span class="op" id="3940495">)</span>&nbsp;<span class="op" id="3940497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940500">if</span>&nbsp;<span class="ident" id="3940503">err</span>&nbsp;<span class="op" id="3940507">:=</span>&nbsp;<span class="ident" id="3940510">checkPub</span><span class="op" id="3940518">(</span><span class="op" id="3940519">&amp;</span><span class="ident" id="3940520">priv</span><span class="op" id="3940524">.</span><span class="ident" id="3940525">PublicKey</span><span class="op" id="3940534">)</span><span class="op" id="3940535">;</span>&nbsp;<span class="ident" id="3940537">err</span>&nbsp;<span class="op" id="3940541">!=</span>&nbsp;<span class="ident" id="3940544">nil</span>&nbsp;<span class="op" id="3940548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940552">return</span>&nbsp;<span class="ident" id="3940559">nil</span><span class="op" id="3940562">,</span>&nbsp;<span class="ident" id="3940564">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940569">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940572">k</span>&nbsp;<span class="op" id="3940574">:=</span>&nbsp;<span class="op" id="3940577">(</span><span class="ident" id="3940578">priv</span><span class="op" id="3940582">.</span><span class="ident" id="3940583">N</span><span class="op" id="3940584">.</span><span class="ident" id="3940585">BitLen</span><span class="op" id="3940591">(</span><span class="op" id="3940592">)</span>&nbsp;<span class="op" id="3940594">+</span>&nbsp;<span class="num" id="3940596">7</span><span class="op" id="3940597">)</span>&nbsp;<span class="op" id="3940599">/</span>&nbsp;<span class="num" id="3940601">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940604">if</span>&nbsp;<span class="builtinfunc" id="3940607">len</span><span class="op" id="3940610">(</span><span class="ident" id="3940611">ciphertext</span><span class="op" id="3940621">)</span>&nbsp;<span class="op" id="3940623">&gt;</span>&nbsp;<span class="ident" id="3940625">k</span>&nbsp;<span class="op" id="3940627">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940632">k</span>&nbsp;<span class="op" id="3940634">&lt;</span>&nbsp;<span class="ident" id="3940636">hash</span><span class="op" id="3940640">.</span><span class="ident" id="3940641">Size</span><span class="op" id="3940645">(</span><span class="op" id="3940646">)</span><span class="op" id="3940647">*</span><span class="num" id="3940648">2</span><span class="op" id="3940649">+</span><span class="num" id="3940650">2</span>&nbsp;<span class="op" id="3940652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940656">err</span>&nbsp;<span class="op" id="3940660">=</span>&nbsp;<span class="ident" id="3940662">ErrDecryption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940678">return</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940690">c</span>&nbsp;<span class="op" id="3940692">:=</span>&nbsp;<span class="builtinfunc" id="3940695">new</span><span class="op" id="3940698">(</span><span class="ident" id="3940699">big</span><span class="op" id="3940702">.</span><span class="ident" id="3940703">Int</span><span class="op" id="3940706">)</span><span class="op" id="3940707">.</span><span class="ident" id="3940708">SetBytes</span><span class="op" id="3940716">(</span><span class="ident" id="3940717">ciphertext</span><span class="op" id="3940727">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940731">m</span><span class="op" id="3940732">,</span>&nbsp;<span class="ident" id="3940734">err</span>&nbsp;<span class="op" id="3940738">:=</span>&nbsp;<span class="ident" id="3940741">decrypt</span><span class="op" id="3940748">(</span><span class="ident" id="3940749">random</span><span class="op" id="3940755">,</span>&nbsp;<span class="ident" id="3940757">priv</span><span class="op" id="3940761">,</span>&nbsp;<span class="ident" id="3940763">c</span><span class="op" id="3940764">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940767">if</span>&nbsp;<span class="ident" id="3940770">err</span>&nbsp;<span class="op" id="3940774">!=</span>&nbsp;<span class="ident" id="3940777">nil</span>&nbsp;<span class="op" id="3940781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940785">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940797">hash</span><span class="op" id="3940801">.</span><span class="ident" id="3940802">Write</span><span class="op" id="3940807">(</span><span class="ident" id="3940808">label</span><span class="op" id="3940813">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940816">lHash</span>&nbsp;<span class="op" id="3940822">:=</span>&nbsp;<span class="ident" id="3940825">hash</span><span class="op" id="3940829">.</span><span class="ident" id="3940830">Sum</span><span class="op" id="3940833">(</span><span class="ident" id="3940834">nil</span><span class="op" id="3940837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940840">hash</span><span class="op" id="3940844">.</span><span class="ident" id="3940845">Reset</span><span class="op" id="3940850">(</span><span class="op" id="3940851">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3940855">//&nbsp;Converting&nbsp;the&nbsp;plaintext&nbsp;number&nbsp;to&nbsp;bytes&nbsp;will&nbsp;strip&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3940915">//&nbsp;leading&nbsp;zeros&nbsp;so&nbsp;we&nbsp;may&nbsp;have&nbsp;to&nbsp;left&nbsp;pad.&nbsp;We&nbsp;do&nbsp;this&nbsp;unconditionally</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3940988">//&nbsp;to&nbsp;avoid&nbsp;leaking&nbsp;timing&nbsp;information.&nbsp;(Although&nbsp;we&nbsp;still&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3941057">//&nbsp;leak&nbsp;the&nbsp;number&nbsp;of&nbsp;leading&nbsp;zeros.&nbsp;It&#39;s&nbsp;not&nbsp;clear&nbsp;that&nbsp;we&nbsp;can&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3941125">//&nbsp;anything&nbsp;about&nbsp;this.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941151">em</span>&nbsp;<span class="op" id="3941154">:=</span>&nbsp;<span class="ident" id="3941157">leftPad</span><span class="op" id="3941164">(</span><span class="ident" id="3941165">m</span><span class="op" id="3941166">.</span><span class="ident" id="3941167">Bytes</span><span class="op" id="3941172">(</span><span class="op" id="3941173">)</span><span class="op" id="3941174">,</span>&nbsp;<span class="ident" id="3941176">k</span><span class="op" id="3941177">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941181">firstByteIsZero</span>&nbsp;<span class="op" id="3941197">:=</span>&nbsp;<span class="ident" id="3941200">subtle</span><span class="op" id="3941206">.</span><span class="ident" id="3941207">ConstantTimeByteEq</span><span class="op" id="3941225">(</span><span class="ident" id="3941226">em</span><span class="op" id="3941228">[</span><span class="num" id="3941229">0</span><span class="op" id="3941230">]</span><span class="op" id="3941231">,</span>&nbsp;<span class="num" id="3941233">0</span><span class="op" id="3941234">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941238">seed</span>&nbsp;<span class="op" id="3941243">:=</span>&nbsp;<span class="ident" id="3941246">em</span><span class="op" id="3941248">[</span><span class="num" id="3941249">1</span>&nbsp;<span class="op" id="3941251">:</span>&nbsp;<span class="ident" id="3941253">hash</span><span class="op" id="3941257">.</span><span class="ident" id="3941258">Size</span><span class="op" id="3941262">(</span><span class="op" id="3941263">)</span><span class="op" id="3941264">+</span><span class="num" id="3941265">1</span><span class="op" id="3941266">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941269">db</span>&nbsp;<span class="op" id="3941272">:=</span>&nbsp;<span class="ident" id="3941275">em</span><span class="op" id="3941277">[</span><span class="ident" id="3941278">hash</span><span class="op" id="3941282">.</span><span class="ident" id="3941283">Size</span><span class="op" id="3941287">(</span><span class="op" id="3941288">)</span><span class="op" id="3941289">+</span><span class="num" id="3941290">1</span><span class="op" id="3941291">:</span><span class="op" id="3941292">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941296">mgf1XOR</span><span class="op" id="3941303">(</span><span class="ident" id="3941304">seed</span><span class="op" id="3941308">,</span>&nbsp;<span class="ident" id="3941310">hash</span><span class="op" id="3941314">,</span>&nbsp;<span class="ident" id="3941316">db</span><span class="op" id="3941318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941321">mgf1XOR</span><span class="op" id="3941328">(</span><span class="ident" id="3941329">db</span><span class="op" id="3941331">,</span>&nbsp;<span class="ident" id="3941333">hash</span><span class="op" id="3941337">,</span>&nbsp;<span class="ident" id="3941339">seed</span><span class="op" id="3941343">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941347">lHash2</span>&nbsp;<span class="op" id="3941354">:=</span>&nbsp;<span class="ident" id="3941357">db</span><span class="op" id="3941359">[</span><span class="num" id="3941360">0</span><span class="op" id="3941361">:</span><span class="ident" id="3941362">hash</span><span class="op" id="3941366">.</span><span class="ident" id="3941367">Size</span><span class="op" id="3941371">(</span><span class="op" id="3941372">)</span><span class="op" id="3941373">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3941377">//&nbsp;We&nbsp;have&nbsp;to&nbsp;validate&nbsp;the&nbsp;plaintext&nbsp;in&nbsp;constant&nbsp;time&nbsp;in&nbsp;order&nbsp;to&nbsp;avoid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3941450">//&nbsp;attacks&nbsp;like:&nbsp;J.&nbsp;Manger.&nbsp;A&nbsp;Chosen&nbsp;Ciphertext&nbsp;Attack&nbsp;on&nbsp;RSA&nbsp;Optimal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3941521">//&nbsp;Asymmetric&nbsp;Encryption&nbsp;Padding&nbsp;(OAEP)&nbsp;as&nbsp;Standardized&nbsp;in&nbsp;PKCS&nbsp;#1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3941589">//&nbsp;v2.0.&nbsp;In&nbsp;J.&nbsp;Kilian,&nbsp;editor,&nbsp;Advances&nbsp;in&nbsp;Cryptology.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941645">lHash2Good</span>&nbsp;<span class="op" id="3941656">:=</span>&nbsp;<span class="ident" id="3941659">subtle</span><span class="op" id="3941665">.</span><span class="ident" id="3941666">ConstantTimeCompare</span><span class="op" id="3941685">(</span><span class="ident" id="3941686">lHash</span><span class="op" id="3941691">,</span>&nbsp;<span class="ident" id="3941693">lHash2</span><span class="op" id="3941699">)</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3941703">//&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;plaintext&nbsp;must&nbsp;be&nbsp;zero&nbsp;or&nbsp;more&nbsp;0x00,&nbsp;followed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3941774">//&nbsp;by&nbsp;0x01,&nbsp;followed&nbsp;by&nbsp;the&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3941812">//&nbsp;&nbsp;&nbsp;lookingForIndex:&nbsp;1&nbsp;iff&nbsp;we&nbsp;are&nbsp;still&nbsp;looking&nbsp;for&nbsp;the&nbsp;0x01</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3941875">//&nbsp;&nbsp;&nbsp;index:&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;first&nbsp;0x01&nbsp;byte</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3941922">//&nbsp;&nbsp;&nbsp;invalid:&nbsp;1&nbsp;iff&nbsp;we&nbsp;saw&nbsp;a&nbsp;non-zero&nbsp;byte&nbsp;before&nbsp;the&nbsp;0x01.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3941983">var</span>&nbsp;<span class="ident" id="3941987">lookingForIndex</span><span class="op" id="3942002">,</span>&nbsp;<span class="ident" id="3942004">index</span><span class="op" id="3942009">,</span>&nbsp;<span class="ident" id="3942011">invalid</span>&nbsp;<span class="builtintype" id="3942019">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942024">lookingForIndex</span>&nbsp;<span class="op" id="3942040">=</span>&nbsp;<span class="num" id="3942042">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942045">rest</span>&nbsp;<span class="op" id="3942050">:=</span>&nbsp;<span class="ident" id="3942053">db</span><span class="op" id="3942055">[</span><span class="ident" id="3942056">hash</span><span class="op" id="3942060">.</span><span class="ident" id="3942061">Size</span><span class="op" id="3942065">(</span><span class="op" id="3942066">)</span><span class="op" id="3942067">:</span><span class="op" id="3942068">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3942072">for</span>&nbsp;<span class="ident" id="3942076">i</span>&nbsp;<span class="op" id="3942078">:=</span>&nbsp;<span class="num" id="3942081">0</span><span class="op" id="3942082">;</span>&nbsp;<span class="ident" id="3942084">i</span>&nbsp;<span class="op" id="3942086">&lt;</span>&nbsp;<span class="builtinfunc" id="3942088">len</span><span class="op" id="3942091">(</span><span class="ident" id="3942092">rest</span><span class="op" id="3942096">)</span><span class="op" id="3942097">;</span>&nbsp;<span class="ident" id="3942099">i</span><span class="op" id="3942100">++</span>&nbsp;<span class="op" id="3942103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942107">equals0</span>&nbsp;<span class="op" id="3942115">:=</span>&nbsp;<span class="ident" id="3942118">subtle</span><span class="op" id="3942124">.</span><span class="ident" id="3942125">ConstantTimeByteEq</span><span class="op" id="3942143">(</span><span class="ident" id="3942144">rest</span><span class="op" id="3942148">[</span><span class="ident" id="3942149">i</span><span class="op" id="3942150">]</span><span class="op" id="3942151">,</span>&nbsp;<span class="num" id="3942153">0</span><span class="op" id="3942154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942158">equals1</span>&nbsp;<span class="op" id="3942166">:=</span>&nbsp;<span class="ident" id="3942169">subtle</span><span class="op" id="3942175">.</span><span class="ident" id="3942176">ConstantTimeByteEq</span><span class="op" id="3942194">(</span><span class="ident" id="3942195">rest</span><span class="op" id="3942199">[</span><span class="ident" id="3942200">i</span><span class="op" id="3942201">]</span><span class="op" id="3942202">,</span>&nbsp;<span class="num" id="3942204">1</span><span class="op" id="3942205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942209">index</span>&nbsp;<span class="op" id="3942215">=</span>&nbsp;<span class="ident" id="3942217">subtle</span><span class="op" id="3942223">.</span><span class="ident" id="3942224">ConstantTimeSelect</span><span class="op" id="3942242">(</span><span class="ident" id="3942243">lookingForIndex</span><span class="op" id="3942258">&amp;</span><span class="ident" id="3942259">equals1</span><span class="op" id="3942266">,</span>&nbsp;<span class="ident" id="3942268">i</span><span class="op" id="3942269">,</span>&nbsp;<span class="ident" id="3942271">index</span><span class="op" id="3942276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942280">lookingForIndex</span>&nbsp;<span class="op" id="3942296">=</span>&nbsp;<span class="ident" id="3942298">subtle</span><span class="op" id="3942304">.</span><span class="ident" id="3942305">ConstantTimeSelect</span><span class="op" id="3942323">(</span><span class="ident" id="3942324">equals1</span><span class="op" id="3942331">,</span>&nbsp;<span class="num" id="3942333">0</span><span class="op" id="3942334">,</span>&nbsp;<span class="ident" id="3942336">lookingForIndex</span><span class="op" id="3942351">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942355">invalid</span>&nbsp;<span class="op" id="3942363">=</span>&nbsp;<span class="ident" id="3942365">subtle</span><span class="op" id="3942371">.</span><span class="ident" id="3942372">ConstantTimeSelect</span><span class="op" id="3942390">(</span><span class="ident" id="3942391">lookingForIndex</span><span class="op" id="3942406">&amp;^</span><span class="ident" id="3942408">equals0</span><span class="op" id="3942415">,</span>&nbsp;<span class="num" id="3942417">1</span><span class="op" id="3942418">,</span>&nbsp;<span class="ident" id="3942420">invalid</span><span class="op" id="3942427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3942430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3942434">if</span>&nbsp;<span class="ident" id="3942437">firstByteIsZero</span><span class="op" id="3942452">&amp;</span><span class="ident" id="3942453">lHash2Good</span><span class="op" id="3942463">&amp;^</span><span class="ident" id="3942465">invalid</span><span class="op" id="3942472">&amp;^</span><span class="ident" id="3942474">lookingForIndex</span>&nbsp;<span class="op" id="3942490">!=</span>&nbsp;<span class="num" id="3942493">1</span>&nbsp;<span class="op" id="3942495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942499">err</span>&nbsp;<span class="op" id="3942503">=</span>&nbsp;<span class="ident" id="3942505">ErrDecryption</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3942521">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3942529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942533">msg</span>&nbsp;<span class="op" id="3942537">=</span>&nbsp;<span class="ident" id="3942539">rest</span><span class="op" id="3942543">[</span><span class="ident" id="3942544">index</span><span class="op" id="3942549">+</span><span class="num" id="3942550">1</span><span class="op" id="3942551">:</span><span class="op" id="3942552">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3942555">return</span><br>
<span class="lineno">545</span><span class="op" id="3942562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3942565">//&nbsp;leftPad&nbsp;returns&nbsp;a&nbsp;new&nbsp;slice&nbsp;of&nbsp;length&nbsp;size.&nbsp;The&nbsp;contents&nbsp;of&nbsp;input&nbsp;are&nbsp;right</span><br>
<span class="lineno"></span><span class="comment" id="3942644">//&nbsp;aligned&nbsp;in&nbsp;the&nbsp;new&nbsp;slice.</span><br>
<span class="lineno"></span><span class="keyword" id="3942673">func</span>&nbsp;<span class="ident" id="3942678">leftPad</span><span class="op" id="3942685">(</span><span class="ident" id="3942686">input</span>&nbsp;<span class="op" id="3942692">[</span><span class="op" id="3942693">]</span><span class="builtintype" id="3942694">byte</span><span class="op" id="3942698">,</span>&nbsp;<span class="ident" id="3942700">size</span>&nbsp;<span class="builtintype" id="3942705">int</span><span class="op" id="3942708">)</span>&nbsp;<span class="op" id="3942710">(</span><span class="ident" id="3942711">out</span>&nbsp;<span class="op" id="3942715">[</span><span class="op" id="3942716">]</span><span class="builtintype" id="3942717">byte</span><span class="op" id="3942721">)</span>&nbsp;<span class="op" id="3942723">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942726">n</span>&nbsp;<span class="op" id="3942728">:=</span>&nbsp;<span class="builtinfunc" id="3942731">len</span><span class="op" id="3942734">(</span><span class="ident" id="3942735">input</span><span class="op" id="3942740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3942743">if</span>&nbsp;<span class="ident" id="3942746">n</span>&nbsp;<span class="op" id="3942748">&gt;</span>&nbsp;<span class="ident" id="3942750">size</span>&nbsp;<span class="op" id="3942755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942759">n</span>&nbsp;<span class="op" id="3942761">=</span>&nbsp;<span class="ident" id="3942763">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3942769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942772">out</span>&nbsp;<span class="op" id="3942776">=</span>&nbsp;<span class="builtinfunc" id="3942778">make</span><span class="op" id="3942782">(</span><span class="op" id="3942783">[</span><span class="op" id="3942784">]</span><span class="builtintype" id="3942785">byte</span><span class="op" id="3942789">,</span>&nbsp;<span class="ident" id="3942791">size</span><span class="op" id="3942795">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3942798">copy</span><span class="op" id="3942802">(</span><span class="ident" id="3942803">out</span><span class="op" id="3942806">[</span><span class="builtinfunc" id="3942807">len</span><span class="op" id="3942810">(</span><span class="ident" id="3942811">out</span><span class="op" id="3942814">)</span><span class="op" id="3942815">-</span><span class="ident" id="3942816">n</span><span class="op" id="3942817">:</span><span class="op" id="3942818">]</span><span class="op" id="3942819">,</span>&nbsp;<span class="ident" id="3942821">input</span><span class="op" id="3942826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3942829">return</span><br>
<span class="lineno"></span><span class="op" id="3942836">}</span>
</div>
</body>
</html>
