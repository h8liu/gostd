<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/httptest</h2>
<ul>
<li><a href="/gostd/net/http/httptest/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder.go.html">recorder.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder_test.go.html" class="current">recorder_test.go</a></li>
<li><a href="/gostd/net/http/httptest/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/httptest/server_test.go.html">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8555303">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8555358">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8555412">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8555463">package</span>&nbsp;<span class="ident" id="8555471">httptest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8555481">import</span>&nbsp;<span class="op" id="8555488">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8555491">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8555498">&#34;net/http&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8555510">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8555520">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8555523">func</span>&nbsp;<span class="ident" id="8555528">TestRecorder</span><span class="op" id="8555540">(</span><span class="ident" id="8555541">t</span>&nbsp;<span class="op" id="8555543">*</span><span class="ident" id="8555544">testing</span><span class="op" id="8555551">.</span><span class="ident" id="8555552">T</span><span class="op" id="8555553">)</span>&nbsp;<span class="op" id="8555555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8555558">type</span>&nbsp;<span class="ident" id="8555563">checkFunc</span>&nbsp;<span class="keyword" id="8555573">func</span><span class="op" id="8555577">(</span><span class="op" id="8555578">*</span><span class="ident" id="8555579">ResponseRecorder</span><span class="op" id="8555595">)</span>&nbsp;<span class="builtintype" id="8555597">error</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8555604">check</span>&nbsp;<span class="op" id="8555610">:=</span>&nbsp;<span class="keyword" id="8555613">func</span><span class="op" id="8555617">(</span><span class="ident" id="8555618">fns</span>&nbsp;<span class="op" id="8555622">...</span><span class="ident" id="8555625">checkFunc</span><span class="op" id="8555634">)</span>&nbsp;<span class="op" id="8555636">[</span><span class="op" id="8555637">]</span><span class="ident" id="8555638">checkFunc</span>&nbsp;<span class="op" id="8555648">{</span>&nbsp;<span class="keyword" id="8555650">return</span>&nbsp;<span class="ident" id="8555657">fns</span>&nbsp;<span class="op" id="8555661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8555665">hasStatus</span>&nbsp;<span class="op" id="8555675">:=</span>&nbsp;<span class="keyword" id="8555678">func</span><span class="op" id="8555682">(</span><span class="ident" id="8555683">wantCode</span>&nbsp;<span class="builtintype" id="8555692">int</span><span class="op" id="8555695">)</span>&nbsp;<span class="ident" id="8555697">checkFunc</span>&nbsp;<span class="op" id="8555707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8555711">return</span>&nbsp;<span class="keyword" id="8555718">func</span><span class="op" id="8555722">(</span><span class="ident" id="8555723">rec</span>&nbsp;<span class="op" id="8555727">*</span><span class="ident" id="8555728">ResponseRecorder</span><span class="op" id="8555744">)</span>&nbsp;<span class="builtintype" id="8555746">error</span>&nbsp;<span class="op" id="8555752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8555757">if</span>&nbsp;<span class="ident" id="8555760">rec</span><span class="op" id="8555763">.</span><span class="ident" id="8555764">Code</span>&nbsp;<span class="op" id="8555769">!=</span>&nbsp;<span class="ident" id="8555772">wantCode</span>&nbsp;<span class="op" id="8555781">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8555787">return</span>&nbsp;<span class="ident" id="8555794">fmt</span><span class="op" id="8555797">.</span><span class="ident" id="8555798">Errorf</span><span class="op" id="8555804">(</span><span class="string" id="8555805">&#34;Status&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8555827">,</span>&nbsp;<span class="ident" id="8555829">rec</span><span class="op" id="8555832">.</span><span class="ident" id="8555833">Code</span><span class="op" id="8555837">,</span>&nbsp;<span class="ident" id="8555839">wantCode</span><span class="op" id="8555847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8555852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8555857">return</span>&nbsp;<span class="ident" id="8555864">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8555870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8555873">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8555876">hasContents</span>&nbsp;<span class="op" id="8555888">:=</span>&nbsp;<span class="keyword" id="8555891">func</span><span class="op" id="8555895">(</span><span class="ident" id="8555896">want</span>&nbsp;<span class="builtintype" id="8555901">string</span><span class="op" id="8555907">)</span>&nbsp;<span class="ident" id="8555909">checkFunc</span>&nbsp;<span class="op" id="8555919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8555923">return</span>&nbsp;<span class="keyword" id="8555930">func</span><span class="op" id="8555934">(</span><span class="ident" id="8555935">rec</span>&nbsp;<span class="op" id="8555939">*</span><span class="ident" id="8555940">ResponseRecorder</span><span class="op" id="8555956">)</span>&nbsp;<span class="builtintype" id="8555958">error</span>&nbsp;<span class="op" id="8555964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8555969">if</span>&nbsp;<span class="ident" id="8555972">rec</span><span class="op" id="8555975">.</span><span class="ident" id="8555976">Body</span><span class="op" id="8555980">.</span><span class="ident" id="8555981">String</span><span class="op" id="8555987">(</span><span class="op" id="8555988">)</span>&nbsp;<span class="op" id="8555990">!=</span>&nbsp;<span class="ident" id="8555993">want</span>&nbsp;<span class="op" id="8555998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8556004">return</span>&nbsp;<span class="ident" id="8556011">fmt</span><span class="op" id="8556014">.</span><span class="ident" id="8556015">Errorf</span><span class="op" id="8556021">(</span><span class="string" id="8556022">&#34;wrote&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8556043">,</span>&nbsp;<span class="ident" id="8556045">rec</span><span class="op" id="8556048">.</span><span class="ident" id="8556049">Body</span><span class="op" id="8556053">.</span><span class="ident" id="8556054">String</span><span class="op" id="8556060">(</span><span class="op" id="8556061">)</span><span class="op" id="8556062">,</span>&nbsp;<span class="ident" id="8556064">want</span><span class="op" id="8556068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8556073">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8556078">return</span>&nbsp;<span class="ident" id="8556085">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8556091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8556094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8556097">hasFlush</span>&nbsp;<span class="op" id="8556106">:=</span>&nbsp;<span class="keyword" id="8556109">func</span><span class="op" id="8556113">(</span><span class="ident" id="8556114">want</span>&nbsp;<span class="builtintype" id="8556119">bool</span><span class="op" id="8556123">)</span>&nbsp;<span class="ident" id="8556125">checkFunc</span>&nbsp;<span class="op" id="8556135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8556139">return</span>&nbsp;<span class="keyword" id="8556146">func</span><span class="op" id="8556150">(</span><span class="ident" id="8556151">rec</span>&nbsp;<span class="op" id="8556155">*</span><span class="ident" id="8556156">ResponseRecorder</span><span class="op" id="8556172">)</span>&nbsp;<span class="builtintype" id="8556174">error</span>&nbsp;<span class="op" id="8556180">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8556185">if</span>&nbsp;<span class="ident" id="8556188">rec</span><span class="op" id="8556191">.</span><span class="ident" id="8556192">Flushed</span>&nbsp;<span class="op" id="8556200">!=</span>&nbsp;<span class="ident" id="8556203">want</span>&nbsp;<span class="op" id="8556208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8556214">return</span>&nbsp;<span class="ident" id="8556221">fmt</span><span class="op" id="8556224">.</span><span class="ident" id="8556225">Errorf</span><span class="op" id="8556231">(</span><span class="string" id="8556232">&#34;Flushed&nbsp;=&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8556255">,</span>&nbsp;<span class="ident" id="8556257">rec</span><span class="op" id="8556260">.</span><span class="ident" id="8556261">Flushed</span><span class="op" id="8556268">,</span>&nbsp;<span class="ident" id="8556270">want</span><span class="op" id="8556274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8556279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8556284">return</span>&nbsp;<span class="ident" id="8556291">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8556297">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8556300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8556304">tests</span>&nbsp;<span class="op" id="8556310">:=</span>&nbsp;<span class="op" id="8556313">[</span><span class="op" id="8556314">]</span><span class="keyword" id="8556315">struct</span>&nbsp;<span class="op" id="8556322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8556326">name</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8556333">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8556342">h</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8556349">func</span><span class="op" id="8556353">(</span><span class="ident" id="8556354">w</span>&nbsp;<span class="ident" id="8556356">http</span><span class="op" id="8556360">.</span><span class="ident" id="8556361">ResponseWriter</span><span class="op" id="8556375">,</span>&nbsp;<span class="ident" id="8556377">r</span>&nbsp;<span class="op" id="8556379">*</span><span class="ident" id="8556380">http</span><span class="op" id="8556384">.</span><span class="ident" id="8556385">Request</span><span class="op" id="8556392">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8556396">checks</span>&nbsp;<span class="op" id="8556403">[</span><span class="op" id="8556404">]</span><span class="ident" id="8556405">checkFunc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8556416">}</span><span class="op" id="8556417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8556421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8556426">&#34;200&nbsp;default&#34;</span><span class="op" id="8556439">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8556444">func</span><span class="op" id="8556448">(</span><span class="ident" id="8556449">w</span>&nbsp;<span class="ident" id="8556451">http</span><span class="op" id="8556455">.</span><span class="ident" id="8556456">ResponseWriter</span><span class="op" id="8556470">,</span>&nbsp;<span class="ident" id="8556472">r</span>&nbsp;<span class="op" id="8556474">*</span><span class="ident" id="8556475">http</span><span class="op" id="8556479">.</span><span class="ident" id="8556480">Request</span><span class="op" id="8556487">)</span>&nbsp;<span class="op" id="8556489">{</span><span class="op" id="8556490">}</span><span class="op" id="8556491">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8556496">check</span><span class="op" id="8556501">(</span><span class="ident" id="8556502">hasStatus</span><span class="op" id="8556511">(</span><span class="num" id="8556512">200</span><span class="op" id="8556515">)</span><span class="op" id="8556516">,</span>&nbsp;<span class="ident" id="8556518">hasContents</span><span class="op" id="8556529">(</span><span class="string" id="8556530">&#34;&#34;</span><span class="op" id="8556532">)</span><span class="op" id="8556533">)</span><span class="op" id="8556534">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8556538">}</span><span class="op" id="8556539">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8556543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8556548">&#34;first&nbsp;code&nbsp;only&#34;</span><span class="op" id="8556565">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8556570">func</span><span class="op" id="8556574">(</span><span class="ident" id="8556575">w</span>&nbsp;<span class="ident" id="8556577">http</span><span class="op" id="8556581">.</span><span class="ident" id="8556582">ResponseWriter</span><span class="op" id="8556596">,</span>&nbsp;<span class="ident" id="8556598">r</span>&nbsp;<span class="op" id="8556600">*</span><span class="ident" id="8556601">http</span><span class="op" id="8556605">.</span><span class="ident" id="8556606">Request</span><span class="op" id="8556613">)</span>&nbsp;<span class="op" id="8556615">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8556621">w</span><span class="op" id="8556622">.</span><span class="ident" id="8556623">WriteHeader</span><span class="op" id="8556634">(</span><span class="num" id="8556635">201</span><span class="op" id="8556638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8556644">w</span><span class="op" id="8556645">.</span><span class="ident" id="8556646">WriteHeader</span><span class="op" id="8556657">(</span><span class="num" id="8556658">202</span><span class="op" id="8556661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8556667">w</span><span class="op" id="8556668">.</span><span class="ident" id="8556669">Write</span><span class="op" id="8556674">(</span><span class="op" id="8556675">[</span><span class="op" id="8556676">]</span><span class="builtintype" id="8556677">byte</span><span class="op" id="8556681">(</span><span class="string" id="8556682">&#34;hi&#34;</span><span class="op" id="8556686">)</span><span class="op" id="8556687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8556692">}</span><span class="op" id="8556693">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8556698">check</span><span class="op" id="8556703">(</span><span class="ident" id="8556704">hasStatus</span><span class="op" id="8556713">(</span><span class="num" id="8556714">201</span><span class="op" id="8556717">)</span><span class="op" id="8556718">,</span>&nbsp;<span class="ident" id="8556720">hasContents</span><span class="op" id="8556731">(</span><span class="string" id="8556732">&#34;hi&#34;</span><span class="op" id="8556736">)</span><span class="op" id="8556737">)</span><span class="op" id="8556738">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8556742">}</span><span class="op" id="8556743">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8556747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8556752">&#34;write&nbsp;sends&nbsp;200&#34;</span><span class="op" id="8556769">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8556774">func</span><span class="op" id="8556778">(</span><span class="ident" id="8556779">w</span>&nbsp;<span class="ident" id="8556781">http</span><span class="op" id="8556785">.</span><span class="ident" id="8556786">ResponseWriter</span><span class="op" id="8556800">,</span>&nbsp;<span class="ident" id="8556802">r</span>&nbsp;<span class="op" id="8556804">*</span><span class="ident" id="8556805">http</span><span class="op" id="8556809">.</span><span class="ident" id="8556810">Request</span><span class="op" id="8556817">)</span>&nbsp;<span class="op" id="8556819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8556825">w</span><span class="op" id="8556826">.</span><span class="ident" id="8556827">Write</span><span class="op" id="8556832">(</span><span class="op" id="8556833">[</span><span class="op" id="8556834">]</span><span class="builtintype" id="8556835">byte</span><span class="op" id="8556839">(</span><span class="string" id="8556840">&#34;hi&nbsp;first&#34;</span><span class="op" id="8556850">)</span><span class="op" id="8556851">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8556857">w</span><span class="op" id="8556858">.</span><span class="ident" id="8556859">WriteHeader</span><span class="op" id="8556870">(</span><span class="num" id="8556871">201</span><span class="op" id="8556874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8556880">w</span><span class="op" id="8556881">.</span><span class="ident" id="8556882">WriteHeader</span><span class="op" id="8556893">(</span><span class="num" id="8556894">202</span><span class="op" id="8556897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8556902">}</span><span class="op" id="8556903">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8556908">check</span><span class="op" id="8556913">(</span><span class="ident" id="8556914">hasStatus</span><span class="op" id="8556923">(</span><span class="num" id="8556924">200</span><span class="op" id="8556927">)</span><span class="op" id="8556928">,</span>&nbsp;<span class="ident" id="8556930">hasContents</span><span class="op" id="8556941">(</span><span class="string" id="8556942">&#34;hi&nbsp;first&#34;</span><span class="op" id="8556952">)</span><span class="op" id="8556953">,</span>&nbsp;<span class="ident" id="8556955">hasFlush</span><span class="op" id="8556963">(</span><span class="builtintype" id="8556964">false</span><span class="op" id="8556969">)</span><span class="op" id="8556970">)</span><span class="op" id="8556971">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8556975">}</span><span class="op" id="8556976">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8556980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8556985">&#34;flush&#34;</span><span class="op" id="8556992">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8556997">func</span><span class="op" id="8557001">(</span><span class="ident" id="8557002">w</span>&nbsp;<span class="ident" id="8557004">http</span><span class="op" id="8557008">.</span><span class="ident" id="8557009">ResponseWriter</span><span class="op" id="8557023">,</span>&nbsp;<span class="ident" id="8557025">r</span>&nbsp;<span class="op" id="8557027">*</span><span class="ident" id="8557028">http</span><span class="op" id="8557032">.</span><span class="ident" id="8557033">Request</span><span class="op" id="8557040">)</span>&nbsp;<span class="op" id="8557042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8557048">w</span><span class="op" id="8557049">.</span><span class="op" id="8557050">(</span><span class="ident" id="8557051">http</span><span class="op" id="8557055">.</span><span class="ident" id="8557056">Flusher</span><span class="op" id="8557063">)</span><span class="op" id="8557064">.</span><span class="ident" id="8557065">Flush</span><span class="op" id="8557070">(</span><span class="op" id="8557071">)</span>&nbsp;<span class="comment" id="8557073">//&nbsp;also&nbsp;sends&nbsp;a&nbsp;200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8557097">w</span><span class="op" id="8557098">.</span><span class="ident" id="8557099">WriteHeader</span><span class="op" id="8557110">(</span><span class="num" id="8557111">201</span><span class="op" id="8557114">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8557119">}</span><span class="op" id="8557120">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8557125">check</span><span class="op" id="8557130">(</span><span class="ident" id="8557131">hasStatus</span><span class="op" id="8557140">(</span><span class="num" id="8557141">200</span><span class="op" id="8557144">)</span><span class="op" id="8557145">,</span>&nbsp;<span class="ident" id="8557147">hasFlush</span><span class="op" id="8557155">(</span><span class="builtintype" id="8557156">true</span><span class="op" id="8557160">)</span><span class="op" id="8557161">)</span><span class="op" id="8557162">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8557166">}</span><span class="op" id="8557167">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8557170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8557173">r</span><span class="op" id="8557174">,</span>&nbsp;<span class="ident" id="8557176">_</span>&nbsp;<span class="op" id="8557178">:=</span>&nbsp;<span class="ident" id="8557181">http</span><span class="op" id="8557185">.</span><span class="ident" id="8557186">NewRequest</span><span class="op" id="8557196">(</span><span class="string" id="8557197">&#34;GET&#34;</span><span class="op" id="8557202">,</span>&nbsp;<span class="string" id="8557204">&#34;http://foo.com/&#34;</span><span class="op" id="8557221">,</span>&nbsp;<span class="ident" id="8557223">nil</span><span class="op" id="8557226">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8557229">for</span>&nbsp;<span class="ident" id="8557233">_</span><span class="op" id="8557234">,</span>&nbsp;<span class="ident" id="8557236">tt</span>&nbsp;<span class="op" id="8557239">:=</span>&nbsp;<span class="keyword" id="8557242">range</span>&nbsp;<span class="ident" id="8557248">tests</span>&nbsp;<span class="op" id="8557254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8557258">h</span>&nbsp;<span class="op" id="8557260">:=</span>&nbsp;<span class="ident" id="8557263">http</span><span class="op" id="8557267">.</span><span class="ident" id="8557268">HandlerFunc</span><span class="op" id="8557279">(</span><span class="ident" id="8557280">tt</span><span class="op" id="8557282">.</span><span class="ident" id="8557283">h</span><span class="op" id="8557284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8557288">rec</span>&nbsp;<span class="op" id="8557292">:=</span>&nbsp;<span class="ident" id="8557295">NewRecorder</span><span class="op" id="8557306">(</span><span class="op" id="8557307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8557311">h</span><span class="op" id="8557312">.</span><span class="ident" id="8557313">ServeHTTP</span><span class="op" id="8557322">(</span><span class="ident" id="8557323">rec</span><span class="op" id="8557326">,</span>&nbsp;<span class="ident" id="8557328">r</span><span class="op" id="8557329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8557333">for</span>&nbsp;<span class="ident" id="8557337">_</span><span class="op" id="8557338">,</span>&nbsp;<span class="ident" id="8557340">check</span>&nbsp;<span class="op" id="8557346">:=</span>&nbsp;<span class="keyword" id="8557349">range</span>&nbsp;<span class="ident" id="8557355">tt</span><span class="op" id="8557357">.</span><span class="ident" id="8557358">checks</span>&nbsp;<span class="op" id="8557365">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8557370">if</span>&nbsp;<span class="ident" id="8557373">err</span>&nbsp;<span class="op" id="8557377">:=</span>&nbsp;<span class="ident" id="8557380">check</span><span class="op" id="8557385">(</span><span class="ident" id="8557386">rec</span><span class="op" id="8557389">)</span><span class="op" id="8557390">;</span>&nbsp;<span class="ident" id="8557392">err</span>&nbsp;<span class="op" id="8557396">!=</span>&nbsp;<span class="ident" id="8557399">nil</span>&nbsp;<span class="op" id="8557403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8557409">t</span><span class="op" id="8557410">.</span><span class="ident" id="8557411">Errorf</span><span class="op" id="8557417">(</span><span class="string" id="8557418">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="8557426">,</span>&nbsp;<span class="ident" id="8557428">tt</span><span class="op" id="8557430">.</span><span class="ident" id="8557431">name</span><span class="op" id="8557435">,</span>&nbsp;<span class="ident" id="8557437">err</span><span class="op" id="8557440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8557445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8557449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8557452">}</span><br>
<span class="lineno">90</span><span class="op" id="8557454">}</span>
</div>
</body>
</html>
