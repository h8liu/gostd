<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html" class="current">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6725454">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6725509">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6725563">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6725614">package</span>&nbsp;<span class="ident" id="6725622">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6725627">import</span>&nbsp;<span class="op" id="6725634">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6725637">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6725644">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6725650">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6725663">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6725674">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6725685">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6725692">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="6725695">func</span>&nbsp;<span class="ident" id="6725700">isTimeout</span><span class="op" id="6725709">(</span><span class="ident" id="6725710">err</span>&nbsp;<span class="builtintype" id="6725714">error</span><span class="op" id="6725719">)</span>&nbsp;<span class="builtintype" id="6725721">bool</span>&nbsp;<span class="op" id="6725726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725729">e</span><span class="op" id="6725730">,</span>&nbsp;<span class="ident" id="6725732">ok</span>&nbsp;<span class="op" id="6725735">:=</span>&nbsp;<span class="ident" id="6725738">err</span><span class="op" id="6725741">.</span><span class="op" id="6725742">(</span><span class="ident" id="6725743">Error</span><span class="op" id="6725748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6725751">return</span>&nbsp;<span class="ident" id="6725758">ok</span>&nbsp;<span class="op" id="6725761">&amp;&amp;</span>&nbsp;<span class="ident" id="6725764">e</span><span class="op" id="6725765">.</span><span class="ident" id="6725766">Timeout</span><span class="op" id="6725773">(</span><span class="op" id="6725774">)</span><br>
<span class="lineno"></span><span class="op" id="6725776">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="6725779">type</span>&nbsp;<span class="ident" id="6725784">copyRes</span>&nbsp;<span class="keyword" id="6725792">struct</span>&nbsp;<span class="op" id="6725799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725802">n</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6725806">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725813">err</span>&nbsp;<span class="builtintype" id="6725817">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725824">d</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6725828">time</span><span class="op" id="6725832">.</span><span class="ident" id="6725833">Duration</span><br>
<span class="lineno">25</span><span class="op" id="6725842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6725845">func</span>&nbsp;<span class="ident" id="6725850">TestAcceptTimeout</span><span class="op" id="6725867">(</span><span class="ident" id="6725868">t</span>&nbsp;<span class="op" id="6725870">*</span><span class="ident" id="6725871">testing</span><span class="op" id="6725878">.</span><span class="ident" id="6725879">T</span><span class="op" id="6725880">)</span>&nbsp;<span class="op" id="6725882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6725885">switch</span>&nbsp;<span class="ident" id="6725892">runtime</span><span class="op" id="6725899">.</span><span class="ident" id="6725900">GOOS</span>&nbsp;<span class="op" id="6725905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6725908">case</span>&nbsp;<span class="string" id="6725913">&#34;plan9&#34;</span><span class="op" id="6725920">:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725924">t</span><span class="op" id="6725925">.</span><span class="ident" id="6725926">Skipf</span><span class="op" id="6725931">(</span><span class="string" id="6725932">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6725953">,</span>&nbsp;<span class="ident" id="6725955">runtime</span><span class="op" id="6725962">.</span><span class="ident" id="6725963">GOOS</span><span class="op" id="6725967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6725970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725974">ln</span>&nbsp;<span class="op" id="6725977">:=</span>&nbsp;<span class="ident" id="6725980">newLocalListener</span><span class="op" id="6725996">(</span><span class="ident" id="6725997">t</span><span class="op" id="6725998">)</span><span class="op" id="6725999">.</span><span class="op" id="6726000">(</span><span class="op" id="6726001">*</span><span class="ident" id="6726002">TCPListener</span><span class="op" id="6726013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6726016">defer</span>&nbsp;<span class="ident" id="6726022">ln</span><span class="op" id="6726024">.</span><span class="ident" id="6726025">Close</span><span class="op" id="6726030">(</span><span class="op" id="6726031">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726034">ln</span><span class="op" id="6726036">.</span><span class="ident" id="6726037">SetDeadline</span><span class="op" id="6726048">(</span><span class="ident" id="6726049">time</span><span class="op" id="6726053">.</span><span class="ident" id="6726054">Now</span><span class="op" id="6726057">(</span><span class="op" id="6726058">)</span><span class="op" id="6726059">.</span><span class="ident" id="6726060">Add</span><span class="op" id="6726063">(</span><span class="op" id="6726064">-</span><span class="num" id="6726065">1</span>&nbsp;<span class="op" id="6726067">*</span>&nbsp;<span class="ident" id="6726069">time</span><span class="op" id="6726073">.</span><span class="ident" id="6726074">Second</span><span class="op" id="6726080">)</span><span class="op" id="6726081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6726084">if</span>&nbsp;<span class="ident" id="6726087">_</span><span class="op" id="6726088">,</span>&nbsp;<span class="ident" id="6726090">err</span>&nbsp;<span class="op" id="6726094">:=</span>&nbsp;<span class="ident" id="6726097">ln</span><span class="op" id="6726099">.</span><span class="ident" id="6726100">Accept</span><span class="op" id="6726106">(</span><span class="op" id="6726107">)</span><span class="op" id="6726108">;</span>&nbsp;<span class="op" id="6726110">!</span><span class="ident" id="6726111">isTimeout</span><span class="op" id="6726120">(</span><span class="ident" id="6726121">err</span><span class="op" id="6726124">)</span>&nbsp;<span class="op" id="6726126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726130">t</span><span class="op" id="6726131">.</span><span class="ident" id="6726132">Fatalf</span><span class="op" id="6726138">(</span><span class="string" id="6726139">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6726172">,</span>&nbsp;<span class="ident" id="6726174">errTimeout</span><span class="op" id="6726184">,</span>&nbsp;<span class="ident" id="6726186">err</span><span class="op" id="6726189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6726192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6726195">if</span>&nbsp;<span class="ident" id="6726198">_</span><span class="op" id="6726199">,</span>&nbsp;<span class="ident" id="6726201">err</span>&nbsp;<span class="op" id="6726205">:=</span>&nbsp;<span class="ident" id="6726208">ln</span><span class="op" id="6726210">.</span><span class="ident" id="6726211">Accept</span><span class="op" id="6726217">(</span><span class="op" id="6726218">)</span><span class="op" id="6726219">;</span>&nbsp;<span class="op" id="6726221">!</span><span class="ident" id="6726222">isTimeout</span><span class="op" id="6726231">(</span><span class="ident" id="6726232">err</span><span class="op" id="6726235">)</span>&nbsp;<span class="op" id="6726237">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726241">t</span><span class="op" id="6726242">.</span><span class="ident" id="6726243">Fatalf</span><span class="op" id="6726249">(</span><span class="string" id="6726250">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6726283">,</span>&nbsp;<span class="ident" id="6726285">errTimeout</span><span class="op" id="6726295">,</span>&nbsp;<span class="ident" id="6726297">err</span><span class="op" id="6726300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6726303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726306">ln</span><span class="op" id="6726308">.</span><span class="ident" id="6726309">SetDeadline</span><span class="op" id="6726320">(</span><span class="ident" id="6726321">time</span><span class="op" id="6726325">.</span><span class="ident" id="6726326">Now</span><span class="op" id="6726329">(</span><span class="op" id="6726330">)</span><span class="op" id="6726331">.</span><span class="ident" id="6726332">Add</span><span class="op" id="6726335">(</span><span class="num" id="6726336">100</span>&nbsp;<span class="op" id="6726340">*</span>&nbsp;<span class="ident" id="6726342">time</span><span class="op" id="6726346">.</span><span class="ident" id="6726347">Millisecond</span><span class="op" id="6726358">)</span><span class="op" id="6726359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6726362">if</span>&nbsp;<span class="ident" id="6726365">_</span><span class="op" id="6726366">,</span>&nbsp;<span class="ident" id="6726368">err</span>&nbsp;<span class="op" id="6726372">:=</span>&nbsp;<span class="ident" id="6726375">ln</span><span class="op" id="6726377">.</span><span class="ident" id="6726378">Accept</span><span class="op" id="6726384">(</span><span class="op" id="6726385">)</span><span class="op" id="6726386">;</span>&nbsp;<span class="op" id="6726388">!</span><span class="ident" id="6726389">isTimeout</span><span class="op" id="6726398">(</span><span class="ident" id="6726399">err</span><span class="op" id="6726402">)</span>&nbsp;<span class="op" id="6726404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726408">t</span><span class="op" id="6726409">.</span><span class="ident" id="6726410">Fatalf</span><span class="op" id="6726416">(</span><span class="string" id="6726417">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6726450">,</span>&nbsp;<span class="ident" id="6726452">errTimeout</span><span class="op" id="6726462">,</span>&nbsp;<span class="ident" id="6726464">err</span><span class="op" id="6726467">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6726470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6726473">if</span>&nbsp;<span class="ident" id="6726476">_</span><span class="op" id="6726477">,</span>&nbsp;<span class="ident" id="6726479">err</span>&nbsp;<span class="op" id="6726483">:=</span>&nbsp;<span class="ident" id="6726486">ln</span><span class="op" id="6726488">.</span><span class="ident" id="6726489">Accept</span><span class="op" id="6726495">(</span><span class="op" id="6726496">)</span><span class="op" id="6726497">;</span>&nbsp;<span class="op" id="6726499">!</span><span class="ident" id="6726500">isTimeout</span><span class="op" id="6726509">(</span><span class="ident" id="6726510">err</span><span class="op" id="6726513">)</span>&nbsp;<span class="op" id="6726515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726519">t</span><span class="op" id="6726520">.</span><span class="ident" id="6726521">Fatalf</span><span class="op" id="6726527">(</span><span class="string" id="6726528">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6726561">,</span>&nbsp;<span class="ident" id="6726563">errTimeout</span><span class="op" id="6726573">,</span>&nbsp;<span class="ident" id="6726575">err</span><span class="op" id="6726578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6726581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726584">ln</span><span class="op" id="6726586">.</span><span class="ident" id="6726587">SetDeadline</span><span class="op" id="6726598">(</span><span class="ident" id="6726599">noDeadline</span><span class="op" id="6726609">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726612">errc</span>&nbsp;<span class="op" id="6726617">:=</span>&nbsp;<span class="builtinfunc" id="6726620">make</span><span class="op" id="6726624">(</span><span class="keyword" id="6726625">chan</span>&nbsp;<span class="builtintype" id="6726630">error</span><span class="op" id="6726635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6726638">go</span>&nbsp;<span class="keyword" id="6726641">func</span><span class="op" id="6726645">(</span><span class="op" id="6726646">)</span>&nbsp;<span class="op" id="6726648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726652">_</span><span class="op" id="6726653">,</span>&nbsp;<span class="ident" id="6726655">err</span>&nbsp;<span class="op" id="6726659">:=</span>&nbsp;<span class="ident" id="6726662">ln</span><span class="op" id="6726664">.</span><span class="ident" id="6726665">Accept</span><span class="op" id="6726671">(</span><span class="op" id="6726672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726676">errc</span>&nbsp;<span class="op" id="6726681">&lt;-</span>&nbsp;<span class="ident" id="6726684">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6726689">}</span><span class="op" id="6726690">(</span><span class="op" id="6726691">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726694">time</span><span class="op" id="6726698">.</span><span class="ident" id="6726699">Sleep</span><span class="op" id="6726704">(</span><span class="num" id="6726705">100</span>&nbsp;<span class="op" id="6726709">*</span>&nbsp;<span class="ident" id="6726711">time</span><span class="op" id="6726715">.</span><span class="ident" id="6726716">Millisecond</span><span class="op" id="6726727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6726730">select</span>&nbsp;<span class="op" id="6726737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6726740">case</span>&nbsp;<span class="ident" id="6726745">err</span>&nbsp;<span class="op" id="6726749">:=</span>&nbsp;<span class="op" id="6726752">&lt;-</span><span class="ident" id="6726754">errc</span><span class="op" id="6726758">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726762">t</span><span class="op" id="6726763">.</span><span class="ident" id="6726764">Fatalf</span><span class="op" id="6726770">(</span><span class="string" id="6726771">&#34;Expected&nbsp;Accept()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="6726831">,</span>&nbsp;<span class="ident" id="6726833">err</span><span class="op" id="6726836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6726839">default</span><span class="op" id="6726846">:</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6726849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726852">ln</span><span class="op" id="6726854">.</span><span class="ident" id="6726855">Close</span><span class="op" id="6726860">(</span><span class="op" id="6726861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6726864">switch</span>&nbsp;<span class="ident" id="6726871">nerr</span>&nbsp;<span class="op" id="6726876">:=</span>&nbsp;<span class="op" id="6726879">&lt;-</span><span class="ident" id="6726881">errc</span><span class="op" id="6726885">;</span>&nbsp;<span class="ident" id="6726887">err</span>&nbsp;<span class="op" id="6726891">:=</span>&nbsp;<span class="ident" id="6726894">nerr</span><span class="op" id="6726898">.</span><span class="op" id="6726899">(</span><span class="keyword" id="6726900">type</span><span class="op" id="6726904">)</span>&nbsp;<span class="op" id="6726906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6726909">case</span>&nbsp;<span class="op" id="6726914">*</span><span class="ident" id="6726915">OpError</span><span class="op" id="6726922">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6726926">if</span>&nbsp;<span class="ident" id="6726929">err</span><span class="op" id="6726932">.</span><span class="ident" id="6726933">Err</span>&nbsp;<span class="op" id="6726937">!=</span>&nbsp;<span class="ident" id="6726940">errClosing</span>&nbsp;<span class="op" id="6726951">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726956">t</span><span class="op" id="6726957">.</span><span class="ident" id="6726958">Fatalf</span><span class="op" id="6726964">(</span><span class="string" id="6726965">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6726998">,</span>&nbsp;<span class="ident" id="6727000">errClosing</span><span class="op" id="6727010">,</span>&nbsp;<span class="ident" id="6727012">err</span><span class="op" id="6727015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6727019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727022">default</span><span class="op" id="6727029">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727033">if</span>&nbsp;<span class="ident" id="6727036">err</span>&nbsp;<span class="op" id="6727040">!=</span>&nbsp;<span class="ident" id="6727043">errClosing</span>&nbsp;<span class="op" id="6727054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727059">t</span><span class="op" id="6727060">.</span><span class="ident" id="6727061">Fatalf</span><span class="op" id="6727067">(</span><span class="string" id="6727068">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6727101">,</span>&nbsp;<span class="ident" id="6727103">errClosing</span><span class="op" id="6727113">,</span>&nbsp;<span class="ident" id="6727115">err</span><span class="op" id="6727118">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6727122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6727125">}</span><br>
<span class="lineno"></span><span class="op" id="6727127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6727130">func</span>&nbsp;<span class="ident" id="6727135">TestReadTimeout</span><span class="op" id="6727150">(</span><span class="ident" id="6727151">t</span>&nbsp;<span class="op" id="6727153">*</span><span class="ident" id="6727154">testing</span><span class="op" id="6727161">.</span><span class="ident" id="6727162">T</span><span class="op" id="6727163">)</span>&nbsp;<span class="op" id="6727165">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727168">switch</span>&nbsp;<span class="ident" id="6727175">runtime</span><span class="op" id="6727182">.</span><span class="ident" id="6727183">GOOS</span>&nbsp;<span class="op" id="6727188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727191">case</span>&nbsp;<span class="string" id="6727196">&#34;plan9&#34;</span><span class="op" id="6727203">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727207">t</span><span class="op" id="6727208">.</span><span class="ident" id="6727209">Skipf</span><span class="op" id="6727214">(</span><span class="string" id="6727215">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6727236">,</span>&nbsp;<span class="ident" id="6727238">runtime</span><span class="op" id="6727245">.</span><span class="ident" id="6727246">GOOS</span><span class="op" id="6727250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6727253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727257">ln</span>&nbsp;<span class="op" id="6727260">:=</span>&nbsp;<span class="ident" id="6727263">newLocalListener</span><span class="op" id="6727279">(</span><span class="ident" id="6727280">t</span><span class="op" id="6727281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727284">defer</span>&nbsp;<span class="ident" id="6727290">ln</span><span class="op" id="6727292">.</span><span class="ident" id="6727293">Close</span><span class="op" id="6727298">(</span><span class="op" id="6727299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727302">c</span><span class="op" id="6727303">,</span>&nbsp;<span class="ident" id="6727305">err</span>&nbsp;<span class="op" id="6727309">:=</span>&nbsp;<span class="ident" id="6727312">DialTCP</span><span class="op" id="6727319">(</span><span class="string" id="6727320">&#34;tcp&#34;</span><span class="op" id="6727325">,</span>&nbsp;<span class="ident" id="6727327">nil</span><span class="op" id="6727330">,</span>&nbsp;<span class="ident" id="6727332">ln</span><span class="op" id="6727334">.</span><span class="ident" id="6727335">Addr</span><span class="op" id="6727339">(</span><span class="op" id="6727340">)</span><span class="op" id="6727341">.</span><span class="op" id="6727342">(</span><span class="op" id="6727343">*</span><span class="ident" id="6727344">TCPAddr</span><span class="op" id="6727351">)</span><span class="op" id="6727352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727355">if</span>&nbsp;<span class="ident" id="6727358">err</span>&nbsp;<span class="op" id="6727362">!=</span>&nbsp;<span class="ident" id="6727365">nil</span>&nbsp;<span class="op" id="6727369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727373">t</span><span class="op" id="6727374">.</span><span class="ident" id="6727375">Fatalf</span><span class="op" id="6727381">(</span><span class="string" id="6727382">&#34;Connect:&nbsp;%v&#34;</span><span class="op" id="6727395">,</span>&nbsp;<span class="ident" id="6727397">err</span><span class="op" id="6727400">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6727403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727406">defer</span>&nbsp;<span class="ident" id="6727412">c</span><span class="op" id="6727413">.</span><span class="ident" id="6727414">Close</span><span class="op" id="6727419">(</span><span class="op" id="6727420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727423">c</span><span class="op" id="6727424">.</span><span class="ident" id="6727425">SetDeadline</span><span class="op" id="6727436">(</span><span class="ident" id="6727437">time</span><span class="op" id="6727441">.</span><span class="ident" id="6727442">Now</span><span class="op" id="6727445">(</span><span class="op" id="6727446">)</span><span class="op" id="6727447">.</span><span class="ident" id="6727448">Add</span><span class="op" id="6727451">(</span><span class="ident" id="6727452">time</span><span class="op" id="6727456">.</span><span class="ident" id="6727457">Hour</span><span class="op" id="6727461">)</span><span class="op" id="6727462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727465">c</span><span class="op" id="6727466">.</span><span class="ident" id="6727467">SetReadDeadline</span><span class="op" id="6727482">(</span><span class="ident" id="6727483">time</span><span class="op" id="6727487">.</span><span class="ident" id="6727488">Now</span><span class="op" id="6727491">(</span><span class="op" id="6727492">)</span><span class="op" id="6727493">.</span><span class="ident" id="6727494">Add</span><span class="op" id="6727497">(</span><span class="op" id="6727498">-</span><span class="num" id="6727499">1</span>&nbsp;<span class="op" id="6727501">*</span>&nbsp;<span class="ident" id="6727503">time</span><span class="op" id="6727507">.</span><span class="ident" id="6727508">Second</span><span class="op" id="6727514">)</span><span class="op" id="6727515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727518">buf</span>&nbsp;<span class="op" id="6727522">:=</span>&nbsp;<span class="builtinfunc" id="6727525">make</span><span class="op" id="6727529">(</span><span class="op" id="6727530">[</span><span class="op" id="6727531">]</span><span class="builtintype" id="6727532">byte</span><span class="op" id="6727536">,</span>&nbsp;<span class="num" id="6727538">1</span><span class="op" id="6727539">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727542">if</span>&nbsp;<span class="ident" id="6727545">_</span><span class="op" id="6727546">,</span>&nbsp;<span class="ident" id="6727548">err</span>&nbsp;<span class="op" id="6727552">=</span>&nbsp;<span class="ident" id="6727554">c</span><span class="op" id="6727555">.</span><span class="ident" id="6727556">Read</span><span class="op" id="6727560">(</span><span class="ident" id="6727561">buf</span><span class="op" id="6727564">)</span><span class="op" id="6727565">;</span>&nbsp;<span class="op" id="6727567">!</span><span class="ident" id="6727568">isTimeout</span><span class="op" id="6727577">(</span><span class="ident" id="6727578">err</span><span class="op" id="6727581">)</span>&nbsp;<span class="op" id="6727583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727587">t</span><span class="op" id="6727588">.</span><span class="ident" id="6727589">Fatalf</span><span class="op" id="6727595">(</span><span class="string" id="6727596">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6727627">,</span>&nbsp;<span class="ident" id="6727629">errTimeout</span><span class="op" id="6727639">,</span>&nbsp;<span class="ident" id="6727641">err</span><span class="op" id="6727644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6727647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727650">if</span>&nbsp;<span class="ident" id="6727653">_</span><span class="op" id="6727654">,</span>&nbsp;<span class="ident" id="6727656">err</span>&nbsp;<span class="op" id="6727660">=</span>&nbsp;<span class="ident" id="6727662">c</span><span class="op" id="6727663">.</span><span class="ident" id="6727664">Read</span><span class="op" id="6727668">(</span><span class="ident" id="6727669">buf</span><span class="op" id="6727672">)</span><span class="op" id="6727673">;</span>&nbsp;<span class="op" id="6727675">!</span><span class="ident" id="6727676">isTimeout</span><span class="op" id="6727685">(</span><span class="ident" id="6727686">err</span><span class="op" id="6727689">)</span>&nbsp;<span class="op" id="6727691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727695">t</span><span class="op" id="6727696">.</span><span class="ident" id="6727697">Fatalf</span><span class="op" id="6727703">(</span><span class="string" id="6727704">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6727735">,</span>&nbsp;<span class="ident" id="6727737">errTimeout</span><span class="op" id="6727747">,</span>&nbsp;<span class="ident" id="6727749">err</span><span class="op" id="6727752">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6727755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727758">c</span><span class="op" id="6727759">.</span><span class="ident" id="6727760">SetDeadline</span><span class="op" id="6727771">(</span><span class="ident" id="6727772">time</span><span class="op" id="6727776">.</span><span class="ident" id="6727777">Now</span><span class="op" id="6727780">(</span><span class="op" id="6727781">)</span><span class="op" id="6727782">.</span><span class="ident" id="6727783">Add</span><span class="op" id="6727786">(</span><span class="num" id="6727787">100</span>&nbsp;<span class="op" id="6727791">*</span>&nbsp;<span class="ident" id="6727793">time</span><span class="op" id="6727797">.</span><span class="ident" id="6727798">Millisecond</span><span class="op" id="6727809">)</span><span class="op" id="6727810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727813">if</span>&nbsp;<span class="ident" id="6727816">_</span><span class="op" id="6727817">,</span>&nbsp;<span class="ident" id="6727819">err</span>&nbsp;<span class="op" id="6727823">=</span>&nbsp;<span class="ident" id="6727825">c</span><span class="op" id="6727826">.</span><span class="ident" id="6727827">Read</span><span class="op" id="6727831">(</span><span class="ident" id="6727832">buf</span><span class="op" id="6727835">)</span><span class="op" id="6727836">;</span>&nbsp;<span class="op" id="6727838">!</span><span class="ident" id="6727839">isTimeout</span><span class="op" id="6727848">(</span><span class="ident" id="6727849">err</span><span class="op" id="6727852">)</span>&nbsp;<span class="op" id="6727854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727858">t</span><span class="op" id="6727859">.</span><span class="ident" id="6727860">Fatalf</span><span class="op" id="6727866">(</span><span class="string" id="6727867">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6727898">,</span>&nbsp;<span class="ident" id="6727900">errTimeout</span><span class="op" id="6727910">,</span>&nbsp;<span class="ident" id="6727912">err</span><span class="op" id="6727915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6727918">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727921">if</span>&nbsp;<span class="ident" id="6727924">_</span><span class="op" id="6727925">,</span>&nbsp;<span class="ident" id="6727927">err</span>&nbsp;<span class="op" id="6727931">=</span>&nbsp;<span class="ident" id="6727933">c</span><span class="op" id="6727934">.</span><span class="ident" id="6727935">Read</span><span class="op" id="6727939">(</span><span class="ident" id="6727940">buf</span><span class="op" id="6727943">)</span><span class="op" id="6727944">;</span>&nbsp;<span class="op" id="6727946">!</span><span class="ident" id="6727947">isTimeout</span><span class="op" id="6727956">(</span><span class="ident" id="6727957">err</span><span class="op" id="6727960">)</span>&nbsp;<span class="op" id="6727962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727966">t</span><span class="op" id="6727967">.</span><span class="ident" id="6727968">Fatalf</span><span class="op" id="6727974">(</span><span class="string" id="6727975">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6728006">,</span>&nbsp;<span class="ident" id="6728008">errTimeout</span><span class="op" id="6728018">,</span>&nbsp;<span class="ident" id="6728020">err</span><span class="op" id="6728023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6728026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728029">c</span><span class="op" id="6728030">.</span><span class="ident" id="6728031">SetReadDeadline</span><span class="op" id="6728046">(</span><span class="ident" id="6728047">noDeadline</span><span class="op" id="6728057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728060">c</span><span class="op" id="6728061">.</span><span class="ident" id="6728062">SetWriteDeadline</span><span class="op" id="6728078">(</span><span class="ident" id="6728079">time</span><span class="op" id="6728083">.</span><span class="ident" id="6728084">Now</span><span class="op" id="6728087">(</span><span class="op" id="6728088">)</span><span class="op" id="6728089">.</span><span class="ident" id="6728090">Add</span><span class="op" id="6728093">(</span><span class="op" id="6728094">-</span><span class="num" id="6728095">1</span>&nbsp;<span class="op" id="6728097">*</span>&nbsp;<span class="ident" id="6728099">time</span><span class="op" id="6728103">.</span><span class="ident" id="6728104">Second</span><span class="op" id="6728110">)</span><span class="op" id="6728111">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728114">errc</span>&nbsp;<span class="op" id="6728119">:=</span>&nbsp;<span class="builtinfunc" id="6728122">make</span><span class="op" id="6728126">(</span><span class="keyword" id="6728127">chan</span>&nbsp;<span class="builtintype" id="6728132">error</span><span class="op" id="6728137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728140">go</span>&nbsp;<span class="keyword" id="6728143">func</span><span class="op" id="6728147">(</span><span class="op" id="6728148">)</span>&nbsp;<span class="op" id="6728150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728154">_</span><span class="op" id="6728155">,</span>&nbsp;<span class="ident" id="6728157">err</span>&nbsp;<span class="op" id="6728161">:=</span>&nbsp;<span class="ident" id="6728164">c</span><span class="op" id="6728165">.</span><span class="ident" id="6728166">Read</span><span class="op" id="6728170">(</span><span class="ident" id="6728171">buf</span><span class="op" id="6728174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728178">errc</span>&nbsp;<span class="op" id="6728183">&lt;-</span>&nbsp;<span class="ident" id="6728186">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6728191">}</span><span class="op" id="6728192">(</span><span class="op" id="6728193">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728196">time</span><span class="op" id="6728200">.</span><span class="ident" id="6728201">Sleep</span><span class="op" id="6728206">(</span><span class="num" id="6728207">100</span>&nbsp;<span class="op" id="6728211">*</span>&nbsp;<span class="ident" id="6728213">time</span><span class="op" id="6728217">.</span><span class="ident" id="6728218">Millisecond</span><span class="op" id="6728229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728232">select</span>&nbsp;<span class="op" id="6728239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728242">case</span>&nbsp;<span class="ident" id="6728247">err</span>&nbsp;<span class="op" id="6728251">:=</span>&nbsp;<span class="op" id="6728254">&lt;-</span><span class="ident" id="6728256">errc</span><span class="op" id="6728260">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728264">t</span><span class="op" id="6728265">.</span><span class="ident" id="6728266">Fatalf</span><span class="op" id="6728272">(</span><span class="string" id="6728273">&#34;Expected&nbsp;Read()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="6728331">,</span>&nbsp;<span class="ident" id="6728333">err</span><span class="op" id="6728336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728339">default</span><span class="op" id="6728346">:</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6728349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728352">c</span><span class="op" id="6728353">.</span><span class="ident" id="6728354">Close</span><span class="op" id="6728359">(</span><span class="op" id="6728360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728363">switch</span>&nbsp;<span class="ident" id="6728370">nerr</span>&nbsp;<span class="op" id="6728375">:=</span>&nbsp;<span class="op" id="6728378">&lt;-</span><span class="ident" id="6728380">errc</span><span class="op" id="6728384">;</span>&nbsp;<span class="ident" id="6728386">err</span>&nbsp;<span class="op" id="6728390">:=</span>&nbsp;<span class="ident" id="6728393">nerr</span><span class="op" id="6728397">.</span><span class="op" id="6728398">(</span><span class="keyword" id="6728399">type</span><span class="op" id="6728403">)</span>&nbsp;<span class="op" id="6728405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728408">case</span>&nbsp;<span class="op" id="6728413">*</span><span class="ident" id="6728414">OpError</span><span class="op" id="6728421">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728425">if</span>&nbsp;<span class="ident" id="6728428">err</span><span class="op" id="6728431">.</span><span class="ident" id="6728432">Err</span>&nbsp;<span class="op" id="6728436">!=</span>&nbsp;<span class="ident" id="6728439">errClosing</span>&nbsp;<span class="op" id="6728450">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728455">t</span><span class="op" id="6728456">.</span><span class="ident" id="6728457">Fatalf</span><span class="op" id="6728463">(</span><span class="string" id="6728464">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6728495">,</span>&nbsp;<span class="ident" id="6728497">errClosing</span><span class="op" id="6728507">,</span>&nbsp;<span class="ident" id="6728509">err</span><span class="op" id="6728512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6728516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728519">default</span><span class="op" id="6728526">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728530">if</span>&nbsp;<span class="ident" id="6728533">err</span>&nbsp;<span class="op" id="6728537">==</span>&nbsp;<span class="ident" id="6728540">io</span><span class="op" id="6728542">.</span><span class="ident" id="6728543">EOF</span>&nbsp;<span class="op" id="6728547">&amp;&amp;</span>&nbsp;<span class="ident" id="6728550">runtime</span><span class="op" id="6728557">.</span><span class="ident" id="6728558">GOOS</span>&nbsp;<span class="op" id="6728563">==</span>&nbsp;<span class="string" id="6728566">&#34;nacl&#34;</span>&nbsp;<span class="op" id="6728573">{</span>&nbsp;<span class="comment" id="6728575">//&nbsp;close&nbsp;enough;&nbsp;golang.org/issue/8044</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728617">break</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6728625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728629">if</span>&nbsp;<span class="ident" id="6728632">err</span>&nbsp;<span class="op" id="6728636">!=</span>&nbsp;<span class="ident" id="6728639">errClosing</span>&nbsp;<span class="op" id="6728650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728655">t</span><span class="op" id="6728656">.</span><span class="ident" id="6728657">Fatalf</span><span class="op" id="6728663">(</span><span class="string" id="6728664">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6728695">,</span>&nbsp;<span class="ident" id="6728697">errClosing</span><span class="op" id="6728707">,</span>&nbsp;<span class="ident" id="6728709">err</span><span class="op" id="6728712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6728716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6728719">}</span><br>
<span class="lineno">130</span><span class="op" id="6728721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6728724">func</span>&nbsp;<span class="ident" id="6728729">TestWriteTimeout</span><span class="op" id="6728745">(</span><span class="ident" id="6728746">t</span>&nbsp;<span class="op" id="6728748">*</span><span class="ident" id="6728749">testing</span><span class="op" id="6728756">.</span><span class="ident" id="6728757">T</span><span class="op" id="6728758">)</span>&nbsp;<span class="op" id="6728760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728763">switch</span>&nbsp;<span class="ident" id="6728770">runtime</span><span class="op" id="6728777">.</span><span class="ident" id="6728778">GOOS</span>&nbsp;<span class="op" id="6728783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728786">case</span>&nbsp;<span class="string" id="6728791">&#34;plan9&#34;</span><span class="op" id="6728798">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728802">t</span><span class="op" id="6728803">.</span><span class="ident" id="6728804">Skipf</span><span class="op" id="6728809">(</span><span class="string" id="6728810">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6728831">,</span>&nbsp;<span class="ident" id="6728833">runtime</span><span class="op" id="6728840">.</span><span class="ident" id="6728841">GOOS</span><span class="op" id="6728845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6728848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728852">ln</span>&nbsp;<span class="op" id="6728855">:=</span>&nbsp;<span class="ident" id="6728858">newLocalListener</span><span class="op" id="6728874">(</span><span class="ident" id="6728875">t</span><span class="op" id="6728876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728879">defer</span>&nbsp;<span class="ident" id="6728885">ln</span><span class="op" id="6728887">.</span><span class="ident" id="6728888">Close</span><span class="op" id="6728893">(</span><span class="op" id="6728894">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728897">c</span><span class="op" id="6728898">,</span>&nbsp;<span class="ident" id="6728900">err</span>&nbsp;<span class="op" id="6728904">:=</span>&nbsp;<span class="ident" id="6728907">DialTCP</span><span class="op" id="6728914">(</span><span class="string" id="6728915">&#34;tcp&#34;</span><span class="op" id="6728920">,</span>&nbsp;<span class="ident" id="6728922">nil</span><span class="op" id="6728925">,</span>&nbsp;<span class="ident" id="6728927">ln</span><span class="op" id="6728929">.</span><span class="ident" id="6728930">Addr</span><span class="op" id="6728934">(</span><span class="op" id="6728935">)</span><span class="op" id="6728936">.</span><span class="op" id="6728937">(</span><span class="op" id="6728938">*</span><span class="ident" id="6728939">TCPAddr</span><span class="op" id="6728946">)</span><span class="op" id="6728947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728950">if</span>&nbsp;<span class="ident" id="6728953">err</span>&nbsp;<span class="op" id="6728957">!=</span>&nbsp;<span class="ident" id="6728960">nil</span>&nbsp;<span class="op" id="6728964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728968">t</span><span class="op" id="6728969">.</span><span class="ident" id="6728970">Fatalf</span><span class="op" id="6728976">(</span><span class="string" id="6728977">&#34;Connect:&nbsp;%v&#34;</span><span class="op" id="6728990">,</span>&nbsp;<span class="ident" id="6728992">err</span><span class="op" id="6728995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6728998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729001">defer</span>&nbsp;<span class="ident" id="6729007">c</span><span class="op" id="6729008">.</span><span class="ident" id="6729009">Close</span><span class="op" id="6729014">(</span><span class="op" id="6729015">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6729018">c</span><span class="op" id="6729019">.</span><span class="ident" id="6729020">SetDeadline</span><span class="op" id="6729031">(</span><span class="ident" id="6729032">time</span><span class="op" id="6729036">.</span><span class="ident" id="6729037">Now</span><span class="op" id="6729040">(</span><span class="op" id="6729041">)</span><span class="op" id="6729042">.</span><span class="ident" id="6729043">Add</span><span class="op" id="6729046">(</span><span class="ident" id="6729047">time</span><span class="op" id="6729051">.</span><span class="ident" id="6729052">Hour</span><span class="op" id="6729056">)</span><span class="op" id="6729057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6729060">c</span><span class="op" id="6729061">.</span><span class="ident" id="6729062">SetWriteDeadline</span><span class="op" id="6729078">(</span><span class="ident" id="6729079">time</span><span class="op" id="6729083">.</span><span class="ident" id="6729084">Now</span><span class="op" id="6729087">(</span><span class="op" id="6729088">)</span><span class="op" id="6729089">.</span><span class="ident" id="6729090">Add</span><span class="op" id="6729093">(</span><span class="op" id="6729094">-</span><span class="num" id="6729095">1</span>&nbsp;<span class="op" id="6729097">*</span>&nbsp;<span class="ident" id="6729099">time</span><span class="op" id="6729103">.</span><span class="ident" id="6729104">Second</span><span class="op" id="6729110">)</span><span class="op" id="6729111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6729114">buf</span>&nbsp;<span class="op" id="6729118">:=</span>&nbsp;<span class="builtinfunc" id="6729121">make</span><span class="op" id="6729125">(</span><span class="op" id="6729126">[</span><span class="op" id="6729127">]</span><span class="builtintype" id="6729128">byte</span><span class="op" id="6729132">,</span>&nbsp;<span class="num" id="6729134">4096</span><span class="op" id="6729138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6729141">writeUntilTimeout</span>&nbsp;<span class="op" id="6729159">:=</span>&nbsp;<span class="keyword" id="6729162">func</span><span class="op" id="6729166">(</span><span class="op" id="6729167">)</span>&nbsp;<span class="op" id="6729169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729173">for</span>&nbsp;<span class="op" id="6729177">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6729182">_</span><span class="op" id="6729183">,</span>&nbsp;<span class="ident" id="6729185">err</span>&nbsp;<span class="op" id="6729189">:=</span>&nbsp;<span class="ident" id="6729192">c</span><span class="op" id="6729193">.</span><span class="ident" id="6729194">Write</span><span class="op" id="6729199">(</span><span class="ident" id="6729200">buf</span><span class="op" id="6729203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729208">if</span>&nbsp;<span class="ident" id="6729211">err</span>&nbsp;<span class="op" id="6729215">!=</span>&nbsp;<span class="ident" id="6729218">nil</span>&nbsp;<span class="op" id="6729222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729228">if</span>&nbsp;<span class="ident" id="6729231">isTimeout</span><span class="op" id="6729240">(</span><span class="ident" id="6729241">err</span><span class="op" id="6729244">)</span>&nbsp;<span class="op" id="6729246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729253">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6729264">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6729270">t</span><span class="op" id="6729271">.</span><span class="ident" id="6729272">Fatalf</span><span class="op" id="6729278">(</span><span class="string" id="6729279">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6729311">,</span>&nbsp;<span class="ident" id="6729313">errTimeout</span><span class="op" id="6729323">,</span>&nbsp;<span class="ident" id="6729325">err</span><span class="op" id="6729328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6729333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6729337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6729340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6729343">writeUntilTimeout</span><span class="op" id="6729360">(</span><span class="op" id="6729361">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6729364">c</span><span class="op" id="6729365">.</span><span class="ident" id="6729366">SetDeadline</span><span class="op" id="6729377">(</span><span class="ident" id="6729378">time</span><span class="op" id="6729382">.</span><span class="ident" id="6729383">Now</span><span class="op" id="6729386">(</span><span class="op" id="6729387">)</span><span class="op" id="6729388">.</span><span class="ident" id="6729389">Add</span><span class="op" id="6729392">(</span><span class="num" id="6729393">10</span>&nbsp;<span class="op" id="6729396">*</span>&nbsp;<span class="ident" id="6729398">time</span><span class="op" id="6729402">.</span><span class="ident" id="6729403">Millisecond</span><span class="op" id="6729414">)</span><span class="op" id="6729415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6729418">writeUntilTimeout</span><span class="op" id="6729435">(</span><span class="op" id="6729436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6729439">writeUntilTimeout</span><span class="op" id="6729456">(</span><span class="op" id="6729457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6729460">c</span><span class="op" id="6729461">.</span><span class="ident" id="6729462">SetWriteDeadline</span><span class="op" id="6729478">(</span><span class="ident" id="6729479">noDeadline</span><span class="op" id="6729489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6729492">c</span><span class="op" id="6729493">.</span><span class="ident" id="6729494">SetReadDeadline</span><span class="op" id="6729509">(</span><span class="ident" id="6729510">time</span><span class="op" id="6729514">.</span><span class="ident" id="6729515">Now</span><span class="op" id="6729518">(</span><span class="op" id="6729519">)</span><span class="op" id="6729520">.</span><span class="ident" id="6729521">Add</span><span class="op" id="6729524">(</span><span class="op" id="6729525">-</span><span class="num" id="6729526">1</span>&nbsp;<span class="op" id="6729528">*</span>&nbsp;<span class="ident" id="6729530">time</span><span class="op" id="6729534">.</span><span class="ident" id="6729535">Second</span><span class="op" id="6729541">)</span><span class="op" id="6729542">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6729545">errc</span>&nbsp;<span class="op" id="6729550">:=</span>&nbsp;<span class="builtinfunc" id="6729553">make</span><span class="op" id="6729557">(</span><span class="keyword" id="6729558">chan</span>&nbsp;<span class="builtintype" id="6729563">error</span><span class="op" id="6729568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729571">go</span>&nbsp;<span class="keyword" id="6729574">func</span><span class="op" id="6729578">(</span><span class="op" id="6729579">)</span>&nbsp;<span class="op" id="6729581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729585">for</span>&nbsp;<span class="op" id="6729589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6729594">_</span><span class="op" id="6729595">,</span>&nbsp;<span class="ident" id="6729597">err</span>&nbsp;<span class="op" id="6729601">:=</span>&nbsp;<span class="ident" id="6729604">c</span><span class="op" id="6729605">.</span><span class="ident" id="6729606">Write</span><span class="op" id="6729611">(</span><span class="ident" id="6729612">buf</span><span class="op" id="6729615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729620">if</span>&nbsp;<span class="ident" id="6729623">err</span>&nbsp;<span class="op" id="6729627">!=</span>&nbsp;<span class="ident" id="6729630">nil</span>&nbsp;<span class="op" id="6729634">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6729640">errc</span>&nbsp;<span class="op" id="6729645">&lt;-</span>&nbsp;<span class="ident" id="6729648">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6729655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6729659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6729662">}</span><span class="op" id="6729663">(</span><span class="op" id="6729664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6729667">time</span><span class="op" id="6729671">.</span><span class="ident" id="6729672">Sleep</span><span class="op" id="6729677">(</span><span class="num" id="6729678">100</span>&nbsp;<span class="op" id="6729682">*</span>&nbsp;<span class="ident" id="6729684">time</span><span class="op" id="6729688">.</span><span class="ident" id="6729689">Millisecond</span><span class="op" id="6729700">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729703">select</span>&nbsp;<span class="op" id="6729710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729713">case</span>&nbsp;<span class="ident" id="6729718">err</span>&nbsp;<span class="op" id="6729722">:=</span>&nbsp;<span class="op" id="6729725">&lt;-</span><span class="ident" id="6729727">errc</span><span class="op" id="6729731">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6729735">t</span><span class="op" id="6729736">.</span><span class="ident" id="6729737">Fatalf</span><span class="op" id="6729743">(</span><span class="string" id="6729744">&#34;Expected&nbsp;Write()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="6729803">,</span>&nbsp;<span class="ident" id="6729805">err</span><span class="op" id="6729808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729811">default</span><span class="op" id="6729818">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6729821">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6729824">c</span><span class="op" id="6729825">.</span><span class="ident" id="6729826">Close</span><span class="op" id="6729831">(</span><span class="op" id="6729832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729835">switch</span>&nbsp;<span class="ident" id="6729842">nerr</span>&nbsp;<span class="op" id="6729847">:=</span>&nbsp;<span class="op" id="6729850">&lt;-</span><span class="ident" id="6729852">errc</span><span class="op" id="6729856">;</span>&nbsp;<span class="ident" id="6729858">err</span>&nbsp;<span class="op" id="6729862">:=</span>&nbsp;<span class="ident" id="6729865">nerr</span><span class="op" id="6729869">.</span><span class="op" id="6729870">(</span><span class="keyword" id="6729871">type</span><span class="op" id="6729875">)</span>&nbsp;<span class="op" id="6729877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729880">case</span>&nbsp;<span class="op" id="6729885">*</span><span class="ident" id="6729886">OpError</span><span class="op" id="6729893">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729897">if</span>&nbsp;<span class="ident" id="6729900">err</span><span class="op" id="6729903">.</span><span class="ident" id="6729904">Err</span>&nbsp;<span class="op" id="6729908">!=</span>&nbsp;<span class="ident" id="6729911">errClosing</span>&nbsp;<span class="op" id="6729922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6729927">t</span><span class="op" id="6729928">.</span><span class="ident" id="6729929">Fatalf</span><span class="op" id="6729935">(</span><span class="string" id="6729936">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6729968">,</span>&nbsp;<span class="ident" id="6729970">errClosing</span><span class="op" id="6729980">,</span>&nbsp;<span class="ident" id="6729982">err</span><span class="op" id="6729985">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6729989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729992">default</span><span class="op" id="6729999">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6730003">if</span>&nbsp;<span class="ident" id="6730006">err</span>&nbsp;<span class="op" id="6730010">!=</span>&nbsp;<span class="ident" id="6730013">errClosing</span>&nbsp;<span class="op" id="6730024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730029">t</span><span class="op" id="6730030">.</span><span class="ident" id="6730031">Fatalf</span><span class="op" id="6730037">(</span><span class="string" id="6730038">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6730070">,</span>&nbsp;<span class="ident" id="6730072">errClosing</span><span class="op" id="6730082">,</span>&nbsp;<span class="ident" id="6730084">err</span><span class="op" id="6730087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6730091">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6730094">}</span><br>
<span class="lineno"></span><span class="op" id="6730096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6730099">func</span>&nbsp;<span class="ident" id="6730104">testTimeout</span><span class="op" id="6730115">(</span><span class="ident" id="6730116">t</span>&nbsp;<span class="op" id="6730118">*</span><span class="ident" id="6730119">testing</span><span class="op" id="6730126">.</span><span class="ident" id="6730127">T</span><span class="op" id="6730128">,</span>&nbsp;<span class="ident" id="6730130">net</span><span class="op" id="6730133">,</span>&nbsp;<span class="ident" id="6730135">addr</span>&nbsp;<span class="builtintype" id="6730140">string</span><span class="op" id="6730146">,</span>&nbsp;<span class="ident" id="6730148">readFrom</span>&nbsp;<span class="builtintype" id="6730157">bool</span><span class="op" id="6730161">)</span>&nbsp;<span class="op" id="6730163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730166">c</span><span class="op" id="6730167">,</span>&nbsp;<span class="ident" id="6730169">err</span>&nbsp;<span class="op" id="6730173">:=</span>&nbsp;<span class="ident" id="6730176">Dial</span><span class="op" id="6730180">(</span><span class="ident" id="6730181">net</span><span class="op" id="6730184">,</span>&nbsp;<span class="ident" id="6730186">addr</span><span class="op" id="6730190">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6730193">if</span>&nbsp;<span class="ident" id="6730196">err</span>&nbsp;<span class="op" id="6730200">!=</span>&nbsp;<span class="ident" id="6730203">nil</span>&nbsp;<span class="op" id="6730207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730211">t</span><span class="op" id="6730212">.</span><span class="ident" id="6730213">Errorf</span><span class="op" id="6730219">(</span><span class="string" id="6730220">&#34;Dial(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6730245">,</span>&nbsp;<span class="ident" id="6730247">net</span><span class="op" id="6730250">,</span>&nbsp;<span class="ident" id="6730252">addr</span><span class="op" id="6730256">,</span>&nbsp;<span class="ident" id="6730258">err</span><span class="op" id="6730261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6730265">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6730273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6730276">defer</span>&nbsp;<span class="ident" id="6730282">c</span><span class="op" id="6730283">.</span><span class="ident" id="6730284">Close</span><span class="op" id="6730289">(</span><span class="op" id="6730290">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730293">what</span>&nbsp;<span class="op" id="6730298">:=</span>&nbsp;<span class="string" id="6730301">&#34;Read&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6730309">if</span>&nbsp;<span class="ident" id="6730312">readFrom</span>&nbsp;<span class="op" id="6730321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730325">what</span>&nbsp;<span class="op" id="6730330">=</span>&nbsp;<span class="string" id="6730332">&#34;ReadFrom&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6730344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730348">errc</span>&nbsp;<span class="op" id="6730353">:=</span>&nbsp;<span class="builtinfunc" id="6730356">make</span><span class="op" id="6730360">(</span><span class="keyword" id="6730361">chan</span>&nbsp;<span class="builtintype" id="6730366">error</span><span class="op" id="6730371">,</span>&nbsp;<span class="num" id="6730373">1</span><span class="op" id="6730374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6730377">go</span>&nbsp;<span class="keyword" id="6730380">func</span><span class="op" id="6730384">(</span><span class="op" id="6730385">)</span>&nbsp;<span class="op" id="6730387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730391">t0</span>&nbsp;<span class="op" id="6730394">:=</span>&nbsp;<span class="ident" id="6730397">time</span><span class="op" id="6730401">.</span><span class="ident" id="6730402">Now</span><span class="op" id="6730405">(</span><span class="op" id="6730406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730410">c</span><span class="op" id="6730411">.</span><span class="ident" id="6730412">SetReadDeadline</span><span class="op" id="6730427">(</span><span class="ident" id="6730428">time</span><span class="op" id="6730432">.</span><span class="ident" id="6730433">Now</span><span class="op" id="6730436">(</span><span class="op" id="6730437">)</span><span class="op" id="6730438">.</span><span class="ident" id="6730439">Add</span><span class="op" id="6730442">(</span><span class="num" id="6730443">100</span>&nbsp;<span class="op" id="6730447">*</span>&nbsp;<span class="ident" id="6730449">time</span><span class="op" id="6730453">.</span><span class="ident" id="6730454">Millisecond</span><span class="op" id="6730465">)</span><span class="op" id="6730466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6730470">var</span>&nbsp;<span class="ident" id="6730474">b</span>&nbsp;<span class="op" id="6730476">[</span><span class="num" id="6730477">100</span><span class="op" id="6730480">]</span><span class="builtintype" id="6730481">byte</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6730488">var</span>&nbsp;<span class="ident" id="6730492">n</span>&nbsp;<span class="builtintype" id="6730494">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6730500">var</span>&nbsp;<span class="ident" id="6730504">err</span>&nbsp;<span class="builtintype" id="6730508">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6730516">if</span>&nbsp;<span class="ident" id="6730519">readFrom</span>&nbsp;<span class="op" id="6730528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730533">n</span><span class="op" id="6730534">,</span>&nbsp;<span class="ident" id="6730536">_</span><span class="op" id="6730537">,</span>&nbsp;<span class="ident" id="6730539">err</span>&nbsp;<span class="op" id="6730543">=</span>&nbsp;<span class="ident" id="6730545">c</span><span class="op" id="6730546">.</span><span class="op" id="6730547">(</span><span class="ident" id="6730548">PacketConn</span><span class="op" id="6730558">)</span><span class="op" id="6730559">.</span><span class="ident" id="6730560">ReadFrom</span><span class="op" id="6730568">(</span><span class="ident" id="6730569">b</span><span class="op" id="6730570">[</span><span class="num" id="6730571">0</span><span class="op" id="6730572">:</span><span class="op" id="6730573">]</span><span class="op" id="6730574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6730578">}</span>&nbsp;<span class="keyword" id="6730580">else</span>&nbsp;<span class="op" id="6730585">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730590">n</span><span class="op" id="6730591">,</span>&nbsp;<span class="ident" id="6730593">err</span>&nbsp;<span class="op" id="6730597">=</span>&nbsp;<span class="ident" id="6730599">c</span><span class="op" id="6730600">.</span><span class="ident" id="6730601">Read</span><span class="op" id="6730605">(</span><span class="ident" id="6730606">b</span><span class="op" id="6730607">[</span><span class="num" id="6730608">0</span><span class="op" id="6730609">:</span><span class="op" id="6730610">]</span><span class="op" id="6730611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6730615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730619">t1</span>&nbsp;<span class="op" id="6730622">:=</span>&nbsp;<span class="ident" id="6730625">time</span><span class="op" id="6730629">.</span><span class="ident" id="6730630">Now</span><span class="op" id="6730633">(</span><span class="op" id="6730634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6730638">if</span>&nbsp;<span class="ident" id="6730641">n</span>&nbsp;<span class="op" id="6730643">!=</span>&nbsp;<span class="num" id="6730646">0</span>&nbsp;<span class="op" id="6730648">||</span>&nbsp;<span class="ident" id="6730651">err</span>&nbsp;<span class="op" id="6730655">==</span>&nbsp;<span class="ident" id="6730658">nil</span>&nbsp;<span class="op" id="6730662">||</span>&nbsp;<span class="op" id="6730665">!</span><span class="ident" id="6730666">err</span><span class="op" id="6730669">.</span><span class="op" id="6730670">(</span><span class="ident" id="6730671">Error</span><span class="op" id="6730676">)</span><span class="op" id="6730677">.</span><span class="ident" id="6730678">Timeout</span><span class="op" id="6730685">(</span><span class="op" id="6730686">)</span>&nbsp;<span class="op" id="6730688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730693">errc</span>&nbsp;<span class="op" id="6730698">&lt;-</span>&nbsp;<span class="ident" id="6730701">fmt</span><span class="op" id="6730704">.</span><span class="ident" id="6730705">Errorf</span><span class="op" id="6730711">(</span><span class="string" id="6730712">&#34;%s(%q,&nbsp;%q)&nbsp;did&nbsp;not&nbsp;return&nbsp;0,&nbsp;timeout:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="6730758">,</span>&nbsp;<span class="ident" id="6730760">what</span><span class="op" id="6730764">,</span>&nbsp;<span class="ident" id="6730766">net</span><span class="op" id="6730769">,</span>&nbsp;<span class="ident" id="6730771">addr</span><span class="op" id="6730775">,</span>&nbsp;<span class="ident" id="6730777">n</span><span class="op" id="6730778">,</span>&nbsp;<span class="ident" id="6730780">err</span><span class="op" id="6730783">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6730788">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6730797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6730801">if</span>&nbsp;<span class="ident" id="6730804">dt</span>&nbsp;<span class="op" id="6730807">:=</span>&nbsp;<span class="ident" id="6730810">t1</span><span class="op" id="6730812">.</span><span class="ident" id="6730813">Sub</span><span class="op" id="6730816">(</span><span class="ident" id="6730817">t0</span><span class="op" id="6730819">)</span><span class="op" id="6730820">;</span>&nbsp;<span class="ident" id="6730822">dt</span>&nbsp;<span class="op" id="6730825">&lt;</span>&nbsp;<span class="num" id="6730827">50</span><span class="op" id="6730829">*</span><span class="ident" id="6730830">time</span><span class="op" id="6730834">.</span><span class="ident" id="6730835">Millisecond</span>&nbsp;<span class="op" id="6730847">||</span>&nbsp;<span class="op" id="6730850">!</span><span class="ident" id="6730851">testing</span><span class="op" id="6730858">.</span><span class="ident" id="6730859">Short</span><span class="op" id="6730864">(</span><span class="op" id="6730865">)</span>&nbsp;<span class="op" id="6730867">&amp;&amp;</span>&nbsp;<span class="ident" id="6730870">dt</span>&nbsp;<span class="op" id="6730873">&gt;</span>&nbsp;<span class="num" id="6730875">250</span><span class="op" id="6730878">*</span><span class="ident" id="6730879">time</span><span class="op" id="6730883">.</span><span class="ident" id="6730884">Millisecond</span>&nbsp;<span class="op" id="6730896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730901">errc</span>&nbsp;<span class="op" id="6730906">&lt;-</span>&nbsp;<span class="ident" id="6730909">fmt</span><span class="op" id="6730912">.</span><span class="ident" id="6730913">Errorf</span><span class="op" id="6730919">(</span><span class="string" id="6730920">&#34;%s(%q,&nbsp;%q)&nbsp;took&nbsp;%s,&nbsp;expected&nbsp;0.1s&#34;</span><span class="op" id="6730955">,</span>&nbsp;<span class="ident" id="6730957">what</span><span class="op" id="6730961">,</span>&nbsp;<span class="ident" id="6730963">net</span><span class="op" id="6730966">,</span>&nbsp;<span class="ident" id="6730968">addr</span><span class="op" id="6730972">,</span>&nbsp;<span class="ident" id="6730974">dt</span><span class="op" id="6730976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6730981">return</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6730990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730994">errc</span>&nbsp;<span class="op" id="6730999">&lt;-</span>&nbsp;<span class="ident" id="6731002">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6731007">}</span><span class="op" id="6731008">(</span><span class="op" id="6731009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6731012">select</span>&nbsp;<span class="op" id="6731019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6731022">case</span>&nbsp;<span class="ident" id="6731027">err</span>&nbsp;<span class="op" id="6731031">:=</span>&nbsp;<span class="op" id="6731034">&lt;-</span><span class="ident" id="6731036">errc</span><span class="op" id="6731040">:</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6731044">if</span>&nbsp;<span class="ident" id="6731047">err</span>&nbsp;<span class="op" id="6731051">!=</span>&nbsp;<span class="ident" id="6731054">nil</span>&nbsp;<span class="op" id="6731058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6731063">t</span><span class="op" id="6731064">.</span><span class="ident" id="6731065">Error</span><span class="op" id="6731070">(</span><span class="ident" id="6731071">err</span><span class="op" id="6731074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6731078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6731081">case</span>&nbsp;<span class="op" id="6731086">&lt;-</span><span class="ident" id="6731088">time</span><span class="op" id="6731092">.</span><span class="ident" id="6731093">After</span><span class="op" id="6731098">(</span><span class="num" id="6731099">1</span>&nbsp;<span class="op" id="6731101">*</span>&nbsp;<span class="ident" id="6731103">time</span><span class="op" id="6731107">.</span><span class="ident" id="6731108">Second</span><span class="op" id="6731114">)</span><span class="op" id="6731115">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6731119">t</span><span class="op" id="6731120">.</span><span class="ident" id="6731121">Errorf</span><span class="op" id="6731127">(</span><span class="string" id="6731128">&#34;%s(%q,&nbsp;%q)&nbsp;took&nbsp;over&nbsp;1&nbsp;second,&nbsp;expected&nbsp;0.1s&#34;</span><span class="op" id="6731174">,</span>&nbsp;<span class="ident" id="6731176">what</span><span class="op" id="6731180">,</span>&nbsp;<span class="ident" id="6731182">net</span><span class="op" id="6731185">,</span>&nbsp;<span class="ident" id="6731187">addr</span><span class="op" id="6731191">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6731194">}</span><br>
<span class="lineno"></span><span class="op" id="6731196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6731199">func</span>&nbsp;<span class="ident" id="6731204">TestTimeoutUDP</span><span class="op" id="6731218">(</span><span class="ident" id="6731219">t</span>&nbsp;<span class="op" id="6731221">*</span><span class="ident" id="6731222">testing</span><span class="op" id="6731229">.</span><span class="ident" id="6731230">T</span><span class="op" id="6731231">)</span>&nbsp;<span class="op" id="6731233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6731236">switch</span>&nbsp;<span class="ident" id="6731243">runtime</span><span class="op" id="6731250">.</span><span class="ident" id="6731251">GOOS</span>&nbsp;<span class="op" id="6731256">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6731259">case</span>&nbsp;<span class="string" id="6731264">&#34;plan9&#34;</span><span class="op" id="6731271">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6731275">t</span><span class="op" id="6731276">.</span><span class="ident" id="6731277">Skipf</span><span class="op" id="6731282">(</span><span class="string" id="6731283">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6731304">,</span>&nbsp;<span class="ident" id="6731306">runtime</span><span class="op" id="6731313">.</span><span class="ident" id="6731314">GOOS</span><span class="op" id="6731318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6731321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6731325">//&nbsp;set&nbsp;up&nbsp;a&nbsp;listener&nbsp;that&nbsp;won&#39;t&nbsp;talk&nbsp;back</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6731368">listening</span>&nbsp;<span class="op" id="6731378">:=</span>&nbsp;<span class="builtinfunc" id="6731381">make</span><span class="op" id="6731385">(</span><span class="keyword" id="6731386">chan</span>&nbsp;<span class="builtintype" id="6731391">string</span><span class="op" id="6731397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6731400">done</span>&nbsp;<span class="op" id="6731405">:=</span>&nbsp;<span class="builtinfunc" id="6731408">make</span><span class="op" id="6731412">(</span><span class="keyword" id="6731413">chan</span>&nbsp;<span class="builtintype" id="6731418">int</span><span class="op" id="6731421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6731424">go</span>&nbsp;<span class="ident" id="6731427">runDatagramPacketConnServer</span><span class="op" id="6731454">(</span><span class="ident" id="6731455">t</span><span class="op" id="6731456">,</span>&nbsp;<span class="string" id="6731458">&#34;udp&#34;</span><span class="op" id="6731463">,</span>&nbsp;<span class="string" id="6731465">&#34;127.0.0.1:0&#34;</span><span class="op" id="6731478">,</span>&nbsp;<span class="ident" id="6731480">listening</span><span class="op" id="6731489">,</span>&nbsp;<span class="ident" id="6731491">done</span><span class="op" id="6731495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6731498">addr</span>&nbsp;<span class="op" id="6731503">:=</span>&nbsp;<span class="op" id="6731506">&lt;-</span><span class="ident" id="6731508">listening</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6731520">testTimeout</span><span class="op" id="6731531">(</span><span class="ident" id="6731532">t</span><span class="op" id="6731533">,</span>&nbsp;<span class="string" id="6731535">&#34;udp&#34;</span><span class="op" id="6731540">,</span>&nbsp;<span class="ident" id="6731542">addr</span><span class="op" id="6731546">,</span>&nbsp;<span class="builtintype" id="6731548">false</span><span class="op" id="6731553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6731556">testTimeout</span><span class="op" id="6731567">(</span><span class="ident" id="6731568">t</span><span class="op" id="6731569">,</span>&nbsp;<span class="string" id="6731571">&#34;udp&#34;</span><span class="op" id="6731576">,</span>&nbsp;<span class="ident" id="6731578">addr</span><span class="op" id="6731582">,</span>&nbsp;<span class="builtintype" id="6731584">true</span><span class="op" id="6731588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6731591">&lt;-</span><span class="ident" id="6731593">done</span><br>
<span class="lineno"></span><span class="op" id="6731598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="6731601">func</span>&nbsp;<span class="ident" id="6731606">TestTimeoutTCP</span><span class="op" id="6731620">(</span><span class="ident" id="6731621">t</span>&nbsp;<span class="op" id="6731623">*</span><span class="ident" id="6731624">testing</span><span class="op" id="6731631">.</span><span class="ident" id="6731632">T</span><span class="op" id="6731633">)</span>&nbsp;<span class="op" id="6731635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6731638">switch</span>&nbsp;<span class="ident" id="6731645">runtime</span><span class="op" id="6731652">.</span><span class="ident" id="6731653">GOOS</span>&nbsp;<span class="op" id="6731658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6731661">case</span>&nbsp;<span class="string" id="6731666">&#34;plan9&#34;</span><span class="op" id="6731673">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6731677">t</span><span class="op" id="6731678">.</span><span class="ident" id="6731679">Skipf</span><span class="op" id="6731684">(</span><span class="string" id="6731685">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6731706">,</span>&nbsp;<span class="ident" id="6731708">runtime</span><span class="op" id="6731715">.</span><span class="ident" id="6731716">GOOS</span><span class="op" id="6731720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6731723">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6731727">//&nbsp;set&nbsp;up&nbsp;a&nbsp;listener&nbsp;that&nbsp;won&#39;t&nbsp;talk&nbsp;back</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6731770">listening</span>&nbsp;<span class="op" id="6731780">:=</span>&nbsp;<span class="builtinfunc" id="6731783">make</span><span class="op" id="6731787">(</span><span class="keyword" id="6731788">chan</span>&nbsp;<span class="builtintype" id="6731793">string</span><span class="op" id="6731799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6731802">done</span>&nbsp;<span class="op" id="6731807">:=</span>&nbsp;<span class="builtinfunc" id="6731810">make</span><span class="op" id="6731814">(</span><span class="keyword" id="6731815">chan</span>&nbsp;<span class="builtintype" id="6731820">int</span><span class="op" id="6731823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6731826">go</span>&nbsp;<span class="ident" id="6731829">runStreamConnServer</span><span class="op" id="6731848">(</span><span class="ident" id="6731849">t</span><span class="op" id="6731850">,</span>&nbsp;<span class="string" id="6731852">&#34;tcp&#34;</span><span class="op" id="6731857">,</span>&nbsp;<span class="string" id="6731859">&#34;127.0.0.1:0&#34;</span><span class="op" id="6731872">,</span>&nbsp;<span class="ident" id="6731874">listening</span><span class="op" id="6731883">,</span>&nbsp;<span class="ident" id="6731885">done</span><span class="op" id="6731889">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6731892">addr</span>&nbsp;<span class="op" id="6731897">:=</span>&nbsp;<span class="op" id="6731900">&lt;-</span><span class="ident" id="6731902">listening</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6731914">testTimeout</span><span class="op" id="6731925">(</span><span class="ident" id="6731926">t</span><span class="op" id="6731927">,</span>&nbsp;<span class="string" id="6731929">&#34;tcp&#34;</span><span class="op" id="6731934">,</span>&nbsp;<span class="ident" id="6731936">addr</span><span class="op" id="6731940">,</span>&nbsp;<span class="builtintype" id="6731942">false</span><span class="op" id="6731947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6731950">&lt;-</span><span class="ident" id="6731952">done</span><br>
<span class="lineno"></span><span class="op" id="6731957">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="keyword" id="6731960">func</span>&nbsp;<span class="ident" id="6731965">TestDeadlineReset</span><span class="op" id="6731982">(</span><span class="ident" id="6731983">t</span>&nbsp;<span class="op" id="6731985">*</span><span class="ident" id="6731986">testing</span><span class="op" id="6731993">.</span><span class="ident" id="6731994">T</span><span class="op" id="6731995">)</span>&nbsp;<span class="op" id="6731997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6732000">switch</span>&nbsp;<span class="ident" id="6732007">runtime</span><span class="op" id="6732014">.</span><span class="ident" id="6732015">GOOS</span>&nbsp;<span class="op" id="6732020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6732023">case</span>&nbsp;<span class="string" id="6732028">&#34;plan9&#34;</span><span class="op" id="6732035">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6732039">t</span><span class="op" id="6732040">.</span><span class="ident" id="6732041">Skipf</span><span class="op" id="6732046">(</span><span class="string" id="6732047">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6732068">,</span>&nbsp;<span class="ident" id="6732070">runtime</span><span class="op" id="6732077">.</span><span class="ident" id="6732078">GOOS</span><span class="op" id="6732082">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6732085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6732088">ln</span><span class="op" id="6732090">,</span>&nbsp;<span class="ident" id="6732092">err</span>&nbsp;<span class="op" id="6732096">:=</span>&nbsp;<span class="ident" id="6732099">Listen</span><span class="op" id="6732105">(</span><span class="string" id="6732106">&#34;tcp&#34;</span><span class="op" id="6732111">,</span>&nbsp;<span class="string" id="6732113">&#34;127.0.0.1:0&#34;</span><span class="op" id="6732126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6732129">if</span>&nbsp;<span class="ident" id="6732132">err</span>&nbsp;<span class="op" id="6732136">!=</span>&nbsp;<span class="ident" id="6732139">nil</span>&nbsp;<span class="op" id="6732143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6732147">t</span><span class="op" id="6732148">.</span><span class="ident" id="6732149">Fatal</span><span class="op" id="6732154">(</span><span class="ident" id="6732155">err</span><span class="op" id="6732158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6732161">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6732164">defer</span>&nbsp;<span class="ident" id="6732170">ln</span><span class="op" id="6732172">.</span><span class="ident" id="6732173">Close</span><span class="op" id="6732178">(</span><span class="op" id="6732179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6732182">tl</span>&nbsp;<span class="op" id="6732185">:=</span>&nbsp;<span class="ident" id="6732188">ln</span><span class="op" id="6732190">.</span><span class="op" id="6732191">(</span><span class="op" id="6732192">*</span><span class="ident" id="6732193">TCPListener</span><span class="op" id="6732204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6732207">tl</span><span class="op" id="6732209">.</span><span class="ident" id="6732210">SetDeadline</span><span class="op" id="6732221">(</span><span class="ident" id="6732222">time</span><span class="op" id="6732226">.</span><span class="ident" id="6732227">Now</span><span class="op" id="6732230">(</span><span class="op" id="6732231">)</span><span class="op" id="6732232">.</span><span class="ident" id="6732233">Add</span><span class="op" id="6732236">(</span><span class="num" id="6732237">1</span>&nbsp;<span class="op" id="6732239">*</span>&nbsp;<span class="ident" id="6732241">time</span><span class="op" id="6732245">.</span><span class="ident" id="6732246">Minute</span><span class="op" id="6732252">)</span><span class="op" id="6732253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6732256">tl</span><span class="op" id="6732258">.</span><span class="ident" id="6732259">SetDeadline</span><span class="op" id="6732270">(</span><span class="ident" id="6732271">noDeadline</span><span class="op" id="6732281">)</span>&nbsp;<span class="comment" id="6732283">//&nbsp;reset&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6732296">errc</span>&nbsp;<span class="op" id="6732301">:=</span>&nbsp;<span class="builtinfunc" id="6732304">make</span><span class="op" id="6732308">(</span><span class="keyword" id="6732309">chan</span>&nbsp;<span class="builtintype" id="6732314">error</span><span class="op" id="6732319">,</span>&nbsp;<span class="num" id="6732321">1</span><span class="op" id="6732322">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6732325">go</span>&nbsp;<span class="keyword" id="6732328">func</span><span class="op" id="6732332">(</span><span class="op" id="6732333">)</span>&nbsp;<span class="op" id="6732335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6732339">_</span><span class="op" id="6732340">,</span>&nbsp;<span class="ident" id="6732342">err</span>&nbsp;<span class="op" id="6732346">:=</span>&nbsp;<span class="ident" id="6732349">ln</span><span class="op" id="6732351">.</span><span class="ident" id="6732352">Accept</span><span class="op" id="6732358">(</span><span class="op" id="6732359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6732363">errc</span>&nbsp;<span class="op" id="6732368">&lt;-</span>&nbsp;<span class="ident" id="6732371">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6732376">}</span><span class="op" id="6732377">(</span><span class="op" id="6732378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6732381">select</span>&nbsp;<span class="op" id="6732388">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6732391">case</span>&nbsp;<span class="op" id="6732396">&lt;-</span><span class="ident" id="6732398">time</span><span class="op" id="6732402">.</span><span class="ident" id="6732403">After</span><span class="op" id="6732408">(</span><span class="num" id="6732409">50</span>&nbsp;<span class="op" id="6732412">*</span>&nbsp;<span class="ident" id="6732414">time</span><span class="op" id="6732418">.</span><span class="ident" id="6732419">Millisecond</span><span class="op" id="6732430">)</span><span class="op" id="6732431">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6732435">//&nbsp;Pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6732445">case</span>&nbsp;<span class="ident" id="6732450">err</span>&nbsp;<span class="op" id="6732454">:=</span>&nbsp;<span class="op" id="6732457">&lt;-</span><span class="ident" id="6732459">errc</span><span class="op" id="6732463">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6732467">//&nbsp;Accept&nbsp;should&nbsp;never&nbsp;return;&nbsp;we&nbsp;never</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6732509">//&nbsp;connected&nbsp;to&nbsp;it.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6732531">t</span><span class="op" id="6732532">.</span><span class="ident" id="6732533">Errorf</span><span class="op" id="6732539">(</span><span class="string" id="6732540">&#34;unexpected&nbsp;return&nbsp;from&nbsp;Accept;&nbsp;err=%v&#34;</span><span class="op" id="6732579">,</span>&nbsp;<span class="ident" id="6732581">err</span><span class="op" id="6732584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6732587">}</span><br>
<span class="lineno"></span><span class="op" id="6732589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6732592">func</span>&nbsp;<span class="ident" id="6732597">TestTimeoutAccept</span><span class="op" id="6732614">(</span><span class="ident" id="6732615">t</span>&nbsp;<span class="op" id="6732617">*</span><span class="ident" id="6732618">testing</span><span class="op" id="6732625">.</span><span class="ident" id="6732626">T</span><span class="op" id="6732627">)</span>&nbsp;<span class="op" id="6732629">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6732632">switch</span>&nbsp;<span class="ident" id="6732639">runtime</span><span class="op" id="6732646">.</span><span class="ident" id="6732647">GOOS</span>&nbsp;<span class="op" id="6732652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6732655">case</span>&nbsp;<span class="string" id="6732660">&#34;plan9&#34;</span><span class="op" id="6732667">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6732671">t</span><span class="op" id="6732672">.</span><span class="ident" id="6732673">Skipf</span><span class="op" id="6732678">(</span><span class="string" id="6732679">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6732700">,</span>&nbsp;<span class="ident" id="6732702">runtime</span><span class="op" id="6732709">.</span><span class="ident" id="6732710">GOOS</span><span class="op" id="6732714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6732717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6732720">ln</span><span class="op" id="6732722">,</span>&nbsp;<span class="ident" id="6732724">err</span>&nbsp;<span class="op" id="6732728">:=</span>&nbsp;<span class="ident" id="6732731">Listen</span><span class="op" id="6732737">(</span><span class="string" id="6732738">&#34;tcp&#34;</span><span class="op" id="6732743">,</span>&nbsp;<span class="string" id="6732745">&#34;127.0.0.1:0&#34;</span><span class="op" id="6732758">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6732761">if</span>&nbsp;<span class="ident" id="6732764">err</span>&nbsp;<span class="op" id="6732768">!=</span>&nbsp;<span class="ident" id="6732771">nil</span>&nbsp;<span class="op" id="6732775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6732779">t</span><span class="op" id="6732780">.</span><span class="ident" id="6732781">Fatal</span><span class="op" id="6732786">(</span><span class="ident" id="6732787">err</span><span class="op" id="6732790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6732793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6732796">defer</span>&nbsp;<span class="ident" id="6732802">ln</span><span class="op" id="6732804">.</span><span class="ident" id="6732805">Close</span><span class="op" id="6732810">(</span><span class="op" id="6732811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6732814">tl</span>&nbsp;<span class="op" id="6732817">:=</span>&nbsp;<span class="ident" id="6732820">ln</span><span class="op" id="6732822">.</span><span class="op" id="6732823">(</span><span class="op" id="6732824">*</span><span class="ident" id="6732825">TCPListener</span><span class="op" id="6732836">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6732839">tl</span><span class="op" id="6732841">.</span><span class="ident" id="6732842">SetDeadline</span><span class="op" id="6732853">(</span><span class="ident" id="6732854">time</span><span class="op" id="6732858">.</span><span class="ident" id="6732859">Now</span><span class="op" id="6732862">(</span><span class="op" id="6732863">)</span><span class="op" id="6732864">.</span><span class="ident" id="6732865">Add</span><span class="op" id="6732868">(</span><span class="num" id="6732869">100</span>&nbsp;<span class="op" id="6732873">*</span>&nbsp;<span class="ident" id="6732875">time</span><span class="op" id="6732879">.</span><span class="ident" id="6732880">Millisecond</span><span class="op" id="6732891">)</span><span class="op" id="6732892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6732895">errc</span>&nbsp;<span class="op" id="6732900">:=</span>&nbsp;<span class="builtinfunc" id="6732903">make</span><span class="op" id="6732907">(</span><span class="keyword" id="6732908">chan</span>&nbsp;<span class="builtintype" id="6732913">error</span><span class="op" id="6732918">,</span>&nbsp;<span class="num" id="6732920">1</span><span class="op" id="6732921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6732924">go</span>&nbsp;<span class="keyword" id="6732927">func</span><span class="op" id="6732931">(</span><span class="op" id="6732932">)</span>&nbsp;<span class="op" id="6732934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6732938">_</span><span class="op" id="6732939">,</span>&nbsp;<span class="ident" id="6732941">err</span>&nbsp;<span class="op" id="6732945">:=</span>&nbsp;<span class="ident" id="6732948">ln</span><span class="op" id="6732950">.</span><span class="ident" id="6732951">Accept</span><span class="op" id="6732957">(</span><span class="op" id="6732958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6732962">errc</span>&nbsp;<span class="op" id="6732967">&lt;-</span>&nbsp;<span class="ident" id="6732970">err</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6732975">}</span><span class="op" id="6732976">(</span><span class="op" id="6732977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6732980">select</span>&nbsp;<span class="op" id="6732987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6732990">case</span>&nbsp;<span class="op" id="6732995">&lt;-</span><span class="ident" id="6732997">time</span><span class="op" id="6733001">.</span><span class="ident" id="6733002">After</span><span class="op" id="6733007">(</span><span class="num" id="6733008">1</span>&nbsp;<span class="op" id="6733010">*</span>&nbsp;<span class="ident" id="6733012">time</span><span class="op" id="6733016">.</span><span class="ident" id="6733017">Second</span><span class="op" id="6733023">)</span><span class="op" id="6733024">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6733028">//&nbsp;Accept&nbsp;shouldn&#39;t&nbsp;block&nbsp;indefinitely</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6733069">t</span><span class="op" id="6733070">.</span><span class="ident" id="6733071">Errorf</span><span class="op" id="6733077">(</span><span class="string" id="6733078">&#34;Accept&nbsp;didn&#39;t&nbsp;return&nbsp;in&nbsp;an&nbsp;expected&nbsp;time&#34;</span><span class="op" id="6733120">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6733123">case</span>&nbsp;<span class="op" id="6733128">&lt;-</span><span class="ident" id="6733130">errc</span><span class="op" id="6733134">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6733138">//&nbsp;Pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6733148">}</span><br>
<span class="lineno"></span><span class="op" id="6733150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="6733153">func</span>&nbsp;<span class="ident" id="6733158">TestReadWriteDeadline</span><span class="op" id="6733179">(</span><span class="ident" id="6733180">t</span>&nbsp;<span class="op" id="6733182">*</span><span class="ident" id="6733183">testing</span><span class="op" id="6733190">.</span><span class="ident" id="6733191">T</span><span class="op" id="6733192">)</span>&nbsp;<span class="op" id="6733194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6733197">switch</span>&nbsp;<span class="ident" id="6733204">runtime</span><span class="op" id="6733211">.</span><span class="ident" id="6733212">GOOS</span>&nbsp;<span class="op" id="6733217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6733220">case</span>&nbsp;<span class="string" id="6733225">&#34;plan9&#34;</span><span class="op" id="6733232">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6733236">t</span><span class="op" id="6733237">.</span><span class="ident" id="6733238">Skipf</span><span class="op" id="6733243">(</span><span class="string" id="6733244">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6733265">,</span>&nbsp;<span class="ident" id="6733267">runtime</span><span class="op" id="6733274">.</span><span class="ident" id="6733275">GOOS</span><span class="op" id="6733279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6733282">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6733286">const</span>&nbsp;<span class="op" id="6733292">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6733296">readTimeout</span>&nbsp;&nbsp;<span class="op" id="6733309">=</span>&nbsp;<span class="num" id="6733311">50</span>&nbsp;<span class="op" id="6733314">*</span>&nbsp;<span class="ident" id="6733316">time</span><span class="op" id="6733320">.</span><span class="ident" id="6733321">Millisecond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6733335">writeTimeout</span>&nbsp;<span class="op" id="6733348">=</span>&nbsp;<span class="num" id="6733350">250</span>&nbsp;<span class="op" id="6733354">*</span>&nbsp;<span class="ident" id="6733356">time</span><span class="op" id="6733360">.</span><span class="ident" id="6733361">Millisecond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6733374">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6733377">checkTimeout</span>&nbsp;<span class="op" id="6733390">:=</span>&nbsp;<span class="keyword" id="6733393">func</span><span class="op" id="6733397">(</span><span class="ident" id="6733398">command</span>&nbsp;<span class="builtintype" id="6733406">string</span><span class="op" id="6733412">,</span>&nbsp;<span class="ident" id="6733414">start</span>&nbsp;<span class="ident" id="6733420">time</span><span class="op" id="6733424">.</span><span class="ident" id="6733425">Time</span><span class="op" id="6733429">,</span>&nbsp;<span class="ident" id="6733431">should</span>&nbsp;<span class="ident" id="6733438">time</span><span class="op" id="6733442">.</span><span class="ident" id="6733443">Duration</span><span class="op" id="6733451">)</span>&nbsp;<span class="op" id="6733453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6733457">is</span>&nbsp;<span class="op" id="6733460">:=</span>&nbsp;<span class="ident" id="6733463">time</span><span class="op" id="6733467">.</span><span class="ident" id="6733468">Now</span><span class="op" id="6733471">(</span><span class="op" id="6733472">)</span><span class="op" id="6733473">.</span><span class="ident" id="6733474">Sub</span><span class="op" id="6733477">(</span><span class="ident" id="6733478">start</span><span class="op" id="6733483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6733487">d</span>&nbsp;<span class="op" id="6733489">:=</span>&nbsp;<span class="ident" id="6733492">is</span>&nbsp;<span class="op" id="6733495">-</span>&nbsp;<span class="ident" id="6733497">should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6733506">if</span>&nbsp;<span class="ident" id="6733509">d</span>&nbsp;<span class="op" id="6733511">&lt;</span>&nbsp;<span class="op" id="6733513">-</span><span class="num" id="6733514">30</span><span class="op" id="6733516">*</span><span class="ident" id="6733517">time</span><span class="op" id="6733521">.</span><span class="ident" id="6733522">Millisecond</span>&nbsp;<span class="op" id="6733534">||</span>&nbsp;<span class="op" id="6733537">!</span><span class="ident" id="6733538">testing</span><span class="op" id="6733545">.</span><span class="ident" id="6733546">Short</span><span class="op" id="6733551">(</span><span class="op" id="6733552">)</span>&nbsp;<span class="op" id="6733554">&amp;&amp;</span>&nbsp;<span class="num" id="6733557">150</span><span class="op" id="6733560">*</span><span class="ident" id="6733561">time</span><span class="op" id="6733565">.</span><span class="ident" id="6733566">Millisecond</span>&nbsp;<span class="op" id="6733578">&lt;</span>&nbsp;<span class="ident" id="6733580">d</span>&nbsp;<span class="op" id="6733582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6733587">t</span><span class="op" id="6733588">.</span><span class="ident" id="6733589">Errorf</span><span class="op" id="6733595">(</span><span class="string" id="6733596">&#34;%s&nbsp;timeout&nbsp;test&nbsp;failed:&nbsp;is=%v&nbsp;should=%v\n&#34;</span><span class="op" id="6733639">,</span>&nbsp;<span class="ident" id="6733641">command</span><span class="op" id="6733648">,</span>&nbsp;<span class="ident" id="6733650">is</span><span class="op" id="6733652">,</span>&nbsp;<span class="ident" id="6733654">should</span><span class="op" id="6733660">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6733664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6733667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6733671">ln</span><span class="op" id="6733673">,</span>&nbsp;<span class="ident" id="6733675">err</span>&nbsp;<span class="op" id="6733679">:=</span>&nbsp;<span class="ident" id="6733682">Listen</span><span class="op" id="6733688">(</span><span class="string" id="6733689">&#34;tcp&#34;</span><span class="op" id="6733694">,</span>&nbsp;<span class="string" id="6733696">&#34;127.0.0.1:0&#34;</span><span class="op" id="6733709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6733712">if</span>&nbsp;<span class="ident" id="6733715">err</span>&nbsp;<span class="op" id="6733719">!=</span>&nbsp;<span class="ident" id="6733722">nil</span>&nbsp;<span class="op" id="6733726">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6733730">t</span><span class="op" id="6733731">.</span><span class="ident" id="6733732">Fatalf</span><span class="op" id="6733738">(</span><span class="string" id="6733739">&#34;ListenTCP&nbsp;on&nbsp;:0:&nbsp;%v&#34;</span><span class="op" id="6733760">,</span>&nbsp;<span class="ident" id="6733762">err</span><span class="op" id="6733765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6733768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6733771">defer</span>&nbsp;<span class="ident" id="6733777">ln</span><span class="op" id="6733779">.</span><span class="ident" id="6733780">Close</span><span class="op" id="6733785">(</span><span class="op" id="6733786">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6733790">lnquit</span>&nbsp;<span class="op" id="6733797">:=</span>&nbsp;<span class="builtinfunc" id="6733800">make</span><span class="op" id="6733804">(</span><span class="keyword" id="6733805">chan</span>&nbsp;<span class="builtintype" id="6733810">bool</span><span class="op" id="6733814">)</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6733818">go</span>&nbsp;<span class="keyword" id="6733821">func</span><span class="op" id="6733825">(</span><span class="op" id="6733826">)</span>&nbsp;<span class="op" id="6733828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6733832">c</span><span class="op" id="6733833">,</span>&nbsp;<span class="ident" id="6733835">err</span>&nbsp;<span class="op" id="6733839">:=</span>&nbsp;<span class="ident" id="6733842">ln</span><span class="op" id="6733844">.</span><span class="ident" id="6733845">Accept</span><span class="op" id="6733851">(</span><span class="op" id="6733852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6733856">if</span>&nbsp;<span class="ident" id="6733859">err</span>&nbsp;<span class="op" id="6733863">!=</span>&nbsp;<span class="ident" id="6733866">nil</span>&nbsp;<span class="op" id="6733870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6733875">t</span><span class="op" id="6733876">.</span><span class="ident" id="6733877">Errorf</span><span class="op" id="6733883">(</span><span class="string" id="6733884">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="6733896">,</span>&nbsp;<span class="ident" id="6733898">err</span><span class="op" id="6733901">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6733906">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6733915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6733919">defer</span>&nbsp;<span class="ident" id="6733925">c</span><span class="op" id="6733926">.</span><span class="ident" id="6733927">Close</span><span class="op" id="6733932">(</span><span class="op" id="6733933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6733937">lnquit</span>&nbsp;<span class="op" id="6733944">&lt;-</span>&nbsp;<span class="builtintype" id="6733947">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6733953">}</span><span class="op" id="6733954">(</span><span class="op" id="6733955">)</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6733959">c</span><span class="op" id="6733960">,</span>&nbsp;<span class="ident" id="6733962">err</span>&nbsp;<span class="op" id="6733966">:=</span>&nbsp;<span class="ident" id="6733969">Dial</span><span class="op" id="6733973">(</span><span class="string" id="6733974">&#34;tcp&#34;</span><span class="op" id="6733979">,</span>&nbsp;<span class="ident" id="6733981">ln</span><span class="op" id="6733983">.</span><span class="ident" id="6733984">Addr</span><span class="op" id="6733988">(</span><span class="op" id="6733989">)</span><span class="op" id="6733990">.</span><span class="ident" id="6733991">String</span><span class="op" id="6733997">(</span><span class="op" id="6733998">)</span><span class="op" id="6733999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6734002">if</span>&nbsp;<span class="ident" id="6734005">err</span>&nbsp;<span class="op" id="6734009">!=</span>&nbsp;<span class="ident" id="6734012">nil</span>&nbsp;<span class="op" id="6734016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6734020">t</span><span class="op" id="6734021">.</span><span class="ident" id="6734022">Fatalf</span><span class="op" id="6734028">(</span><span class="string" id="6734029">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="6734039">,</span>&nbsp;<span class="ident" id="6734041">err</span><span class="op" id="6734044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6734047">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6734050">defer</span>&nbsp;<span class="ident" id="6734056">c</span><span class="op" id="6734057">.</span><span class="ident" id="6734058">Close</span><span class="op" id="6734063">(</span><span class="op" id="6734064">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6734068">start</span>&nbsp;<span class="op" id="6734074">:=</span>&nbsp;<span class="ident" id="6734077">time</span><span class="op" id="6734081">.</span><span class="ident" id="6734082">Now</span><span class="op" id="6734085">(</span><span class="op" id="6734086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6734089">err</span>&nbsp;<span class="op" id="6734093">=</span>&nbsp;<span class="ident" id="6734095">c</span><span class="op" id="6734096">.</span><span class="ident" id="6734097">SetReadDeadline</span><span class="op" id="6734112">(</span><span class="ident" id="6734113">start</span><span class="op" id="6734118">.</span><span class="ident" id="6734119">Add</span><span class="op" id="6734122">(</span><span class="ident" id="6734123">readTimeout</span><span class="op" id="6734134">)</span><span class="op" id="6734135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6734138">if</span>&nbsp;<span class="ident" id="6734141">err</span>&nbsp;<span class="op" id="6734145">!=</span>&nbsp;<span class="ident" id="6734148">nil</span>&nbsp;<span class="op" id="6734152">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6734156">t</span><span class="op" id="6734157">.</span><span class="ident" id="6734158">Fatalf</span><span class="op" id="6734164">(</span><span class="string" id="6734165">&#34;SetReadDeadline:&nbsp;%v&#34;</span><span class="op" id="6734186">,</span>&nbsp;<span class="ident" id="6734188">err</span><span class="op" id="6734191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6734194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6734197">err</span>&nbsp;<span class="op" id="6734201">=</span>&nbsp;<span class="ident" id="6734203">c</span><span class="op" id="6734204">.</span><span class="ident" id="6734205">SetWriteDeadline</span><span class="op" id="6734221">(</span><span class="ident" id="6734222">start</span><span class="op" id="6734227">.</span><span class="ident" id="6734228">Add</span><span class="op" id="6734231">(</span><span class="ident" id="6734232">writeTimeout</span><span class="op" id="6734244">)</span><span class="op" id="6734245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6734248">if</span>&nbsp;<span class="ident" id="6734251">err</span>&nbsp;<span class="op" id="6734255">!=</span>&nbsp;<span class="ident" id="6734258">nil</span>&nbsp;<span class="op" id="6734262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6734266">t</span><span class="op" id="6734267">.</span><span class="ident" id="6734268">Fatalf</span><span class="op" id="6734274">(</span><span class="string" id="6734275">&#34;SetWriteDeadline:&nbsp;%v&#34;</span><span class="op" id="6734297">,</span>&nbsp;<span class="ident" id="6734299">err</span><span class="op" id="6734302">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6734305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6734309">quit</span>&nbsp;<span class="op" id="6734314">:=</span>&nbsp;<span class="builtinfunc" id="6734317">make</span><span class="op" id="6734321">(</span><span class="keyword" id="6734322">chan</span>&nbsp;<span class="builtintype" id="6734327">bool</span><span class="op" id="6734331">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6734335">go</span>&nbsp;<span class="keyword" id="6734338">func</span><span class="op" id="6734342">(</span><span class="op" id="6734343">)</span>&nbsp;<span class="op" id="6734345">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6734349">var</span>&nbsp;<span class="ident" id="6734353">buf</span>&nbsp;<span class="op" id="6734357">[</span><span class="num" id="6734358">10</span><span class="op" id="6734360">]</span><span class="builtintype" id="6734361">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6734368">_</span><span class="op" id="6734369">,</span>&nbsp;<span class="ident" id="6734371">err</span>&nbsp;<span class="op" id="6734375">:=</span>&nbsp;<span class="ident" id="6734378">c</span><span class="op" id="6734379">.</span><span class="ident" id="6734380">Read</span><span class="op" id="6734384">(</span><span class="ident" id="6734385">buf</span><span class="op" id="6734388">[</span><span class="op" id="6734389">:</span><span class="op" id="6734390">]</span><span class="op" id="6734391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6734395">if</span>&nbsp;<span class="ident" id="6734398">err</span>&nbsp;<span class="op" id="6734402">==</span>&nbsp;<span class="ident" id="6734405">nil</span>&nbsp;<span class="op" id="6734409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6734414">t</span><span class="op" id="6734415">.</span><span class="ident" id="6734416">Errorf</span><span class="op" id="6734422">(</span><span class="string" id="6734423">&#34;Read&nbsp;should&nbsp;not&nbsp;succeed&#34;</span><span class="op" id="6734448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6734452">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6734456">checkTimeout</span><span class="op" id="6734468">(</span><span class="string" id="6734469">&#34;Read&#34;</span><span class="op" id="6734475">,</span>&nbsp;<span class="ident" id="6734477">start</span><span class="op" id="6734482">,</span>&nbsp;<span class="ident" id="6734484">readTimeout</span><span class="op" id="6734495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6734499">quit</span>&nbsp;<span class="op" id="6734504">&lt;-</span>&nbsp;<span class="builtintype" id="6734507">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6734513">}</span><span class="op" id="6734514">(</span><span class="op" id="6734515">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6734519">go</span>&nbsp;<span class="keyword" id="6734522">func</span><span class="op" id="6734526">(</span><span class="op" id="6734527">)</span>&nbsp;<span class="op" id="6734529">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6734533">var</span>&nbsp;<span class="ident" id="6734537">buf</span>&nbsp;<span class="op" id="6734541">[</span><span class="num" id="6734542">10000</span><span class="op" id="6734547">]</span><span class="builtintype" id="6734548">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6734555">for</span>&nbsp;<span class="op" id="6734559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6734564">_</span><span class="op" id="6734565">,</span>&nbsp;<span class="ident" id="6734567">err</span>&nbsp;<span class="op" id="6734571">:=</span>&nbsp;<span class="ident" id="6734574">c</span><span class="op" id="6734575">.</span><span class="ident" id="6734576">Write</span><span class="op" id="6734581">(</span><span class="ident" id="6734582">buf</span><span class="op" id="6734585">[</span><span class="op" id="6734586">:</span><span class="op" id="6734587">]</span><span class="op" id="6734588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6734593">if</span>&nbsp;<span class="ident" id="6734596">err</span>&nbsp;<span class="op" id="6734600">!=</span>&nbsp;<span class="ident" id="6734603">nil</span>&nbsp;<span class="op" id="6734607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6734613">break</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6734622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6734626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6734630">checkTimeout</span><span class="op" id="6734642">(</span><span class="string" id="6734643">&#34;Write&#34;</span><span class="op" id="6734650">,</span>&nbsp;<span class="ident" id="6734652">start</span><span class="op" id="6734657">,</span>&nbsp;<span class="ident" id="6734659">writeTimeout</span><span class="op" id="6734671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6734675">quit</span>&nbsp;<span class="op" id="6734680">&lt;-</span>&nbsp;<span class="builtintype" id="6734683">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6734689">}</span><span class="op" id="6734690">(</span><span class="op" id="6734691">)</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6734695">&lt;-</span><span class="ident" id="6734697">quit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6734703">&lt;-</span><span class="ident" id="6734705">quit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6734711">&lt;-</span><span class="ident" id="6734713">lnquit</span><br>
<span class="lineno"></span><span class="op" id="6734720">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="6734723">type</span>&nbsp;<span class="ident" id="6734728">neverEnding</span>&nbsp;<span class="builtintype" id="6734740">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6734746">func</span>&nbsp;<span class="op" id="6734751">(</span><span class="ident" id="6734752">b</span>&nbsp;<span class="ident" id="6734754">neverEnding</span><span class="op" id="6734765">)</span>&nbsp;<span class="ident" id="6734767">Read</span><span class="op" id="6734771">(</span><span class="ident" id="6734772">p</span>&nbsp;<span class="op" id="6734774">[</span><span class="op" id="6734775">]</span><span class="builtintype" id="6734776">byte</span><span class="op" id="6734780">)</span>&nbsp;<span class="op" id="6734782">(</span><span class="ident" id="6734783">n</span>&nbsp;<span class="builtintype" id="6734785">int</span><span class="op" id="6734788">,</span>&nbsp;<span class="ident" id="6734790">err</span>&nbsp;<span class="builtintype" id="6734794">error</span><span class="op" id="6734799">)</span>&nbsp;<span class="op" id="6734801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6734804">for</span>&nbsp;<span class="ident" id="6734808">i</span>&nbsp;<span class="op" id="6734810">:=</span>&nbsp;<span class="keyword" id="6734813">range</span>&nbsp;<span class="ident" id="6734819">p</span>&nbsp;<span class="op" id="6734821">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6734825">p</span><span class="op" id="6734826">[</span><span class="ident" id="6734827">i</span><span class="op" id="6734828">]</span>&nbsp;<span class="op" id="6734830">=</span>&nbsp;<span class="builtintype" id="6734832">byte</span><span class="op" id="6734836">(</span><span class="ident" id="6734837">b</span><span class="op" id="6734838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6734841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6734844">return</span>&nbsp;<span class="builtinfunc" id="6734851">len</span><span class="op" id="6734854">(</span><span class="ident" id="6734855">p</span><span class="op" id="6734856">)</span><span class="op" id="6734857">,</span>&nbsp;<span class="ident" id="6734859">nil</span><br>
<span class="lineno"></span><span class="op" id="6734863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="keyword" id="6734866">func</span>&nbsp;<span class="ident" id="6734871">TestVariousDeadlines1Proc</span><span class="op" id="6734896">(</span><span class="ident" id="6734897">t</span>&nbsp;<span class="op" id="6734899">*</span><span class="ident" id="6734900">testing</span><span class="op" id="6734907">.</span><span class="ident" id="6734908">T</span><span class="op" id="6734909">)</span>&nbsp;<span class="op" id="6734911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6734914">testVariousDeadlines</span><span class="op" id="6734934">(</span><span class="ident" id="6734935">t</span><span class="op" id="6734936">,</span>&nbsp;<span class="num" id="6734938">1</span><span class="op" id="6734939">)</span><br>
<span class="lineno"></span><span class="op" id="6734941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6734944">func</span>&nbsp;<span class="ident" id="6734949">TestVariousDeadlines4Proc</span><span class="op" id="6734974">(</span><span class="ident" id="6734975">t</span>&nbsp;<span class="op" id="6734977">*</span><span class="ident" id="6734978">testing</span><span class="op" id="6734985">.</span><span class="ident" id="6734986">T</span><span class="op" id="6734987">)</span>&nbsp;<span class="op" id="6734989">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6734992">testVariousDeadlines</span><span class="op" id="6735012">(</span><span class="ident" id="6735013">t</span><span class="op" id="6735014">,</span>&nbsp;<span class="num" id="6735016">4</span><span class="op" id="6735017">)</span><br>
<span class="lineno"></span><span class="op" id="6735019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6735022">func</span>&nbsp;<span class="ident" id="6735027">testVariousDeadlines</span><span class="op" id="6735047">(</span><span class="ident" id="6735048">t</span>&nbsp;<span class="op" id="6735050">*</span><span class="ident" id="6735051">testing</span><span class="op" id="6735058">.</span><span class="ident" id="6735059">T</span><span class="op" id="6735060">,</span>&nbsp;<span class="ident" id="6735062">maxProcs</span>&nbsp;<span class="builtintype" id="6735071">int</span><span class="op" id="6735074">)</span>&nbsp;<span class="op" id="6735076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6735079">switch</span>&nbsp;<span class="ident" id="6735086">runtime</span><span class="op" id="6735093">.</span><span class="ident" id="6735094">GOOS</span>&nbsp;<span class="op" id="6735099">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6735102">case</span>&nbsp;<span class="string" id="6735107">&#34;plan9&#34;</span><span class="op" id="6735114">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6735118">t</span><span class="op" id="6735119">.</span><span class="ident" id="6735120">Skipf</span><span class="op" id="6735125">(</span><span class="string" id="6735126">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6735147">,</span>&nbsp;<span class="ident" id="6735149">runtime</span><span class="op" id="6735156">.</span><span class="ident" id="6735157">GOOS</span><span class="op" id="6735161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6735164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6735168">defer</span>&nbsp;<span class="ident" id="6735174">runtime</span><span class="op" id="6735181">.</span><span class="ident" id="6735182">GOMAXPROCS</span><span class="op" id="6735192">(</span><span class="ident" id="6735193">runtime</span><span class="op" id="6735200">.</span><span class="ident" id="6735201">GOMAXPROCS</span><span class="op" id="6735211">(</span><span class="ident" id="6735212">maxProcs</span><span class="op" id="6735220">)</span><span class="op" id="6735221">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6735224">ln</span>&nbsp;<span class="op" id="6735227">:=</span>&nbsp;<span class="ident" id="6735230">newLocalListener</span><span class="op" id="6735246">(</span><span class="ident" id="6735247">t</span><span class="op" id="6735248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6735251">defer</span>&nbsp;<span class="ident" id="6735257">ln</span><span class="op" id="6735259">.</span><span class="ident" id="6735260">Close</span><span class="op" id="6735265">(</span><span class="op" id="6735266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6735269">acceptc</span>&nbsp;<span class="op" id="6735277">:=</span>&nbsp;<span class="builtinfunc" id="6735280">make</span><span class="op" id="6735284">(</span><span class="keyword" id="6735285">chan</span>&nbsp;<span class="builtintype" id="6735290">error</span><span class="op" id="6735295">,</span>&nbsp;<span class="num" id="6735297">1</span><span class="op" id="6735298">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6735302">//&nbsp;The&nbsp;server,&nbsp;with&nbsp;no&nbsp;timeouts&nbsp;of&nbsp;its&nbsp;own,&nbsp;sending&nbsp;bytes&nbsp;to&nbsp;clients</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6735372">//&nbsp;as&nbsp;fast&nbsp;as&nbsp;it&nbsp;can.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6735395">servec</span>&nbsp;<span class="op" id="6735402">:=</span>&nbsp;<span class="builtinfunc" id="6735405">make</span><span class="op" id="6735409">(</span><span class="keyword" id="6735410">chan</span>&nbsp;<span class="ident" id="6735415">copyRes</span><span class="op" id="6735422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6735425">go</span>&nbsp;<span class="keyword" id="6735428">func</span><span class="op" id="6735432">(</span><span class="op" id="6735433">)</span>&nbsp;<span class="op" id="6735435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6735439">for</span>&nbsp;<span class="op" id="6735443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6735448">c</span><span class="op" id="6735449">,</span>&nbsp;<span class="ident" id="6735451">err</span>&nbsp;<span class="op" id="6735455">:=</span>&nbsp;<span class="ident" id="6735458">ln</span><span class="op" id="6735460">.</span><span class="ident" id="6735461">Accept</span><span class="op" id="6735467">(</span><span class="op" id="6735468">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6735473">if</span>&nbsp;<span class="ident" id="6735476">err</span>&nbsp;<span class="op" id="6735480">!=</span>&nbsp;<span class="ident" id="6735483">nil</span>&nbsp;<span class="op" id="6735487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6735493">acceptc</span>&nbsp;<span class="op" id="6735501">&lt;-</span>&nbsp;<span class="ident" id="6735504">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6735512">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6735522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6735527">go</span>&nbsp;<span class="keyword" id="6735530">func</span><span class="op" id="6735534">(</span><span class="op" id="6735535">)</span>&nbsp;<span class="op" id="6735537">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6735543">t0</span>&nbsp;<span class="op" id="6735546">:=</span>&nbsp;<span class="ident" id="6735549">time</span><span class="op" id="6735553">.</span><span class="ident" id="6735554">Now</span><span class="op" id="6735557">(</span><span class="op" id="6735558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6735564">n</span><span class="op" id="6735565">,</span>&nbsp;<span class="ident" id="6735567">err</span>&nbsp;<span class="op" id="6735571">:=</span>&nbsp;<span class="ident" id="6735574">io</span><span class="op" id="6735576">.</span><span class="ident" id="6735577">Copy</span><span class="op" id="6735581">(</span><span class="ident" id="6735582">c</span><span class="op" id="6735583">,</span>&nbsp;<span class="ident" id="6735585">neverEnding</span><span class="op" id="6735596">(</span><span class="string" id="6735597">&#39;a&#39;</span><span class="op" id="6735600">)</span><span class="op" id="6735601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6735607">d</span>&nbsp;<span class="op" id="6735609">:=</span>&nbsp;<span class="ident" id="6735612">time</span><span class="op" id="6735616">.</span><span class="ident" id="6735617">Since</span><span class="op" id="6735622">(</span><span class="ident" id="6735623">t0</span><span class="op" id="6735625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6735631">c</span><span class="op" id="6735632">.</span><span class="ident" id="6735633">Close</span><span class="op" id="6735638">(</span><span class="op" id="6735639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6735645">servec</span>&nbsp;<span class="op" id="6735652">&lt;-</span>&nbsp;<span class="ident" id="6735655">copyRes</span><span class="op" id="6735662">{</span><span class="ident" id="6735663">n</span><span class="op" id="6735664">,</span>&nbsp;<span class="ident" id="6735666">err</span><span class="op" id="6735669">,</span>&nbsp;<span class="ident" id="6735671">d</span><span class="op" id="6735672">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6735677">}</span><span class="op" id="6735678">(</span><span class="op" id="6735679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6735683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6735686">}</span><span class="op" id="6735687">(</span><span class="op" id="6735688">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6735692">for</span>&nbsp;<span class="ident" id="6735696">_</span><span class="op" id="6735697">,</span>&nbsp;<span class="ident" id="6735699">timeout</span>&nbsp;<span class="op" id="6735707">:=</span>&nbsp;<span class="keyword" id="6735710">range</span>&nbsp;<span class="op" id="6735716">[</span><span class="op" id="6735717">]</span><span class="ident" id="6735718">time</span><span class="op" id="6735722">.</span><span class="ident" id="6735723">Duration</span><span class="op" id="6735731">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6735735">1</span>&nbsp;<span class="op" id="6735737">*</span>&nbsp;<span class="ident" id="6735739">time</span><span class="op" id="6735743">.</span><span class="ident" id="6735744">Nanosecond</span><span class="op" id="6735754">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6735758">2</span>&nbsp;<span class="op" id="6735760">*</span>&nbsp;<span class="ident" id="6735762">time</span><span class="op" id="6735766">.</span><span class="ident" id="6735767">Nanosecond</span><span class="op" id="6735777">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6735781">5</span>&nbsp;<span class="op" id="6735783">*</span>&nbsp;<span class="ident" id="6735785">time</span><span class="op" id="6735789">.</span><span class="ident" id="6735790">Nanosecond</span><span class="op" id="6735800">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6735804">50</span>&nbsp;<span class="op" id="6735807">*</span>&nbsp;<span class="ident" id="6735809">time</span><span class="op" id="6735813">.</span><span class="ident" id="6735814">Nanosecond</span><span class="op" id="6735824">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6735828">100</span>&nbsp;<span class="op" id="6735832">*</span>&nbsp;<span class="ident" id="6735834">time</span><span class="op" id="6735838">.</span><span class="ident" id="6735839">Nanosecond</span><span class="op" id="6735849">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6735853">200</span>&nbsp;<span class="op" id="6735857">*</span>&nbsp;<span class="ident" id="6735859">time</span><span class="op" id="6735863">.</span><span class="ident" id="6735864">Nanosecond</span><span class="op" id="6735874">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6735878">500</span>&nbsp;<span class="op" id="6735882">*</span>&nbsp;<span class="ident" id="6735884">time</span><span class="op" id="6735888">.</span><span class="ident" id="6735889">Nanosecond</span><span class="op" id="6735899">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6735903">750</span>&nbsp;<span class="op" id="6735907">*</span>&nbsp;<span class="ident" id="6735909">time</span><span class="op" id="6735913">.</span><span class="ident" id="6735914">Nanosecond</span><span class="op" id="6735924">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6735928">1</span>&nbsp;<span class="op" id="6735930">*</span>&nbsp;<span class="ident" id="6735932">time</span><span class="op" id="6735936">.</span><span class="ident" id="6735937">Microsecond</span><span class="op" id="6735948">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6735952">5</span>&nbsp;<span class="op" id="6735954">*</span>&nbsp;<span class="ident" id="6735956">time</span><span class="op" id="6735960">.</span><span class="ident" id="6735961">Microsecond</span><span class="op" id="6735972">,</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6735976">25</span>&nbsp;<span class="op" id="6735979">*</span>&nbsp;<span class="ident" id="6735981">time</span><span class="op" id="6735985">.</span><span class="ident" id="6735986">Microsecond</span><span class="op" id="6735997">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6736001">250</span>&nbsp;<span class="op" id="6736005">*</span>&nbsp;<span class="ident" id="6736007">time</span><span class="op" id="6736011">.</span><span class="ident" id="6736012">Microsecond</span><span class="op" id="6736023">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6736027">500</span>&nbsp;<span class="op" id="6736031">*</span>&nbsp;<span class="ident" id="6736033">time</span><span class="op" id="6736037">.</span><span class="ident" id="6736038">Microsecond</span><span class="op" id="6736049">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6736053">1</span>&nbsp;<span class="op" id="6736055">*</span>&nbsp;<span class="ident" id="6736057">time</span><span class="op" id="6736061">.</span><span class="ident" id="6736062">Millisecond</span><span class="op" id="6736073">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6736077">5</span>&nbsp;<span class="op" id="6736079">*</span>&nbsp;<span class="ident" id="6736081">time</span><span class="op" id="6736085">.</span><span class="ident" id="6736086">Millisecond</span><span class="op" id="6736097">,</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6736101">100</span>&nbsp;<span class="op" id="6736105">*</span>&nbsp;<span class="ident" id="6736107">time</span><span class="op" id="6736111">.</span><span class="ident" id="6736112">Millisecond</span><span class="op" id="6736123">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6736127">250</span>&nbsp;<span class="op" id="6736131">*</span>&nbsp;<span class="ident" id="6736133">time</span><span class="op" id="6736137">.</span><span class="ident" id="6736138">Millisecond</span><span class="op" id="6736149">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6736153">500</span>&nbsp;<span class="op" id="6736157">*</span>&nbsp;<span class="ident" id="6736159">time</span><span class="op" id="6736163">.</span><span class="ident" id="6736164">Millisecond</span><span class="op" id="6736175">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6736179">1</span>&nbsp;<span class="op" id="6736181">*</span>&nbsp;<span class="ident" id="6736183">time</span><span class="op" id="6736187">.</span><span class="ident" id="6736188">Second</span><span class="op" id="6736194">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6736197">}</span>&nbsp;<span class="op" id="6736199">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6736203">numRuns</span>&nbsp;<span class="op" id="6736211">:=</span>&nbsp;<span class="num" id="6736214">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6736218">if</span>&nbsp;<span class="ident" id="6736221">testing</span><span class="op" id="6736228">.</span><span class="ident" id="6736229">Short</span><span class="op" id="6736234">(</span><span class="op" id="6736235">)</span>&nbsp;<span class="op" id="6736237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6736242">numRuns</span>&nbsp;<span class="op" id="6736250">=</span>&nbsp;<span class="num" id="6736252">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6736257">if</span>&nbsp;<span class="ident" id="6736260">timeout</span>&nbsp;<span class="op" id="6736268">&gt;</span>&nbsp;<span class="num" id="6736270">500</span><span class="op" id="6736273">*</span><span class="ident" id="6736274">time</span><span class="op" id="6736278">.</span><span class="ident" id="6736279">Microsecond</span>&nbsp;<span class="op" id="6736291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6736297">continue</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6736309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6736313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6736317">for</span>&nbsp;<span class="ident" id="6736321">run</span>&nbsp;<span class="op" id="6736325">:=</span>&nbsp;<span class="num" id="6736328">0</span><span class="op" id="6736329">;</span>&nbsp;<span class="ident" id="6736331">run</span>&nbsp;<span class="op" id="6736335">&lt;</span>&nbsp;<span class="ident" id="6736337">numRuns</span><span class="op" id="6736344">;</span>&nbsp;<span class="ident" id="6736346">run</span><span class="op" id="6736349">++</span>&nbsp;<span class="op" id="6736352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6736357">name</span>&nbsp;<span class="op" id="6736362">:=</span>&nbsp;<span class="ident" id="6736365">fmt</span><span class="op" id="6736368">.</span><span class="ident" id="6736369">Sprintf</span><span class="op" id="6736376">(</span><span class="string" id="6736377">&#34;%v&nbsp;run&nbsp;%d/%d&#34;</span><span class="op" id="6736391">,</span>&nbsp;<span class="ident" id="6736393">timeout</span><span class="op" id="6736400">,</span>&nbsp;<span class="ident" id="6736402">run</span><span class="op" id="6736405">+</span><span class="num" id="6736406">1</span><span class="op" id="6736407">,</span>&nbsp;<span class="ident" id="6736409">numRuns</span><span class="op" id="6736416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6736421">t</span><span class="op" id="6736422">.</span><span class="ident" id="6736423">Log</span><span class="op" id="6736426">(</span><span class="ident" id="6736427">name</span><span class="op" id="6736431">)</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6736437">c</span><span class="op" id="6736438">,</span>&nbsp;<span class="ident" id="6736440">err</span>&nbsp;<span class="op" id="6736444">:=</span>&nbsp;<span class="ident" id="6736447">Dial</span><span class="op" id="6736451">(</span><span class="string" id="6736452">&#34;tcp&#34;</span><span class="op" id="6736457">,</span>&nbsp;<span class="ident" id="6736459">ln</span><span class="op" id="6736461">.</span><span class="ident" id="6736462">Addr</span><span class="op" id="6736466">(</span><span class="op" id="6736467">)</span><span class="op" id="6736468">.</span><span class="ident" id="6736469">String</span><span class="op" id="6736475">(</span><span class="op" id="6736476">)</span><span class="op" id="6736477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6736482">if</span>&nbsp;<span class="ident" id="6736485">err</span>&nbsp;<span class="op" id="6736489">!=</span>&nbsp;<span class="ident" id="6736492">nil</span>&nbsp;<span class="op" id="6736496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6736502">t</span><span class="op" id="6736503">.</span><span class="ident" id="6736504">Fatalf</span><span class="op" id="6736510">(</span><span class="string" id="6736511">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="6736521">,</span>&nbsp;<span class="ident" id="6736523">err</span><span class="op" id="6736526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6736531">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6736536">clientc</span>&nbsp;<span class="op" id="6736544">:=</span>&nbsp;<span class="builtinfunc" id="6736547">make</span><span class="op" id="6736551">(</span><span class="keyword" id="6736552">chan</span>&nbsp;<span class="ident" id="6736557">copyRes</span><span class="op" id="6736564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6736569">go</span>&nbsp;<span class="keyword" id="6736572">func</span><span class="op" id="6736576">(</span><span class="op" id="6736577">)</span>&nbsp;<span class="op" id="6736579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6736585">t0</span>&nbsp;<span class="op" id="6736588">:=</span>&nbsp;<span class="ident" id="6736591">time</span><span class="op" id="6736595">.</span><span class="ident" id="6736596">Now</span><span class="op" id="6736599">(</span><span class="op" id="6736600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6736606">c</span><span class="op" id="6736607">.</span><span class="ident" id="6736608">SetDeadline</span><span class="op" id="6736619">(</span><span class="ident" id="6736620">t0</span><span class="op" id="6736622">.</span><span class="ident" id="6736623">Add</span><span class="op" id="6736626">(</span><span class="ident" id="6736627">timeout</span><span class="op" id="6736634">)</span><span class="op" id="6736635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6736641">n</span><span class="op" id="6736642">,</span>&nbsp;<span class="ident" id="6736644">err</span>&nbsp;<span class="op" id="6736648">:=</span>&nbsp;<span class="ident" id="6736651">io</span><span class="op" id="6736653">.</span><span class="ident" id="6736654">Copy</span><span class="op" id="6736658">(</span><span class="ident" id="6736659">ioutil</span><span class="op" id="6736665">.</span><span class="ident" id="6736666">Discard</span><span class="op" id="6736673">,</span>&nbsp;<span class="ident" id="6736675">c</span><span class="op" id="6736676">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6736682">d</span>&nbsp;<span class="op" id="6736684">:=</span>&nbsp;<span class="ident" id="6736687">time</span><span class="op" id="6736691">.</span><span class="ident" id="6736692">Since</span><span class="op" id="6736697">(</span><span class="ident" id="6736698">t0</span><span class="op" id="6736700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6736706">c</span><span class="op" id="6736707">.</span><span class="ident" id="6736708">Close</span><span class="op" id="6736713">(</span><span class="op" id="6736714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6736720">clientc</span>&nbsp;<span class="op" id="6736728">&lt;-</span>&nbsp;<span class="ident" id="6736731">copyRes</span><span class="op" id="6736738">{</span><span class="ident" id="6736739">n</span><span class="op" id="6736740">,</span>&nbsp;<span class="ident" id="6736742">err</span><span class="op" id="6736745">,</span>&nbsp;<span class="ident" id="6736747">d</span><span class="op" id="6736748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6736753">}</span><span class="op" id="6736754">(</span><span class="op" id="6736755">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6736761">tooLong</span>&nbsp;<span class="op" id="6736769">:=</span>&nbsp;<span class="num" id="6736772">5</span>&nbsp;<span class="op" id="6736774">*</span>&nbsp;<span class="ident" id="6736776">time</span><span class="op" id="6736780">.</span><span class="ident" id="6736781">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6736791">select</span>&nbsp;<span class="op" id="6736798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6736803">case</span>&nbsp;<span class="ident" id="6736808">res</span>&nbsp;<span class="op" id="6736812">:=</span>&nbsp;<span class="op" id="6736815">&lt;-</span><span class="ident" id="6736817">clientc</span><span class="op" id="6736824">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6736830">if</span>&nbsp;<span class="ident" id="6736833">isTimeout</span><span class="op" id="6736842">(</span><span class="ident" id="6736843">res</span><span class="op" id="6736846">.</span><span class="ident" id="6736847">err</span><span class="op" id="6736850">)</span>&nbsp;<span class="op" id="6736852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6736859">t</span><span class="op" id="6736860">.</span><span class="ident" id="6736861">Logf</span><span class="op" id="6736865">(</span><span class="string" id="6736866">&#34;for&nbsp;%v,&nbsp;good&nbsp;client&nbsp;timeout&nbsp;after&nbsp;%v,&nbsp;reading&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="6736922">,</span>&nbsp;<span class="ident" id="6736924">name</span><span class="op" id="6736928">,</span>&nbsp;<span class="ident" id="6736930">res</span><span class="op" id="6736933">.</span><span class="ident" id="6736934">d</span><span class="op" id="6736935">,</span>&nbsp;<span class="ident" id="6736937">res</span><span class="op" id="6736940">.</span><span class="ident" id="6736941">n</span><span class="op" id="6736942">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6736948">}</span>&nbsp;<span class="keyword" id="6736950">else</span>&nbsp;<span class="op" id="6736955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6736962">t</span><span class="op" id="6736963">.</span><span class="ident" id="6736964">Fatalf</span><span class="op" id="6736970">(</span><span class="string" id="6736971">&#34;for&nbsp;%v:&nbsp;client&nbsp;Copy&nbsp;=&nbsp;%d,&nbsp;%v&nbsp;(want&nbsp;timeout)&#34;</span><span class="op" id="6737016">,</span>&nbsp;<span class="ident" id="6737018">name</span><span class="op" id="6737022">,</span>&nbsp;<span class="ident" id="6737024">res</span><span class="op" id="6737027">.</span><span class="ident" id="6737028">n</span><span class="op" id="6737029">,</span>&nbsp;<span class="ident" id="6737031">res</span><span class="op" id="6737034">.</span><span class="ident" id="6737035">err</span><span class="op" id="6737038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6737044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6737049">case</span>&nbsp;<span class="op" id="6737054">&lt;-</span><span class="ident" id="6737056">time</span><span class="op" id="6737060">.</span><span class="ident" id="6737061">After</span><span class="op" id="6737066">(</span><span class="ident" id="6737067">tooLong</span><span class="op" id="6737074">)</span><span class="op" id="6737075">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6737081">t</span><span class="op" id="6737082">.</span><span class="ident" id="6737083">Fatalf</span><span class="op" id="6737089">(</span><span class="string" id="6737090">&#34;for&nbsp;%v:&nbsp;timeout&nbsp;(%v)&nbsp;waiting&nbsp;for&nbsp;client&nbsp;to&nbsp;timeout&nbsp;(%v)&nbsp;reading&#34;</span><span class="op" id="6737155">,</span>&nbsp;<span class="ident" id="6737157">name</span><span class="op" id="6737161">,</span>&nbsp;<span class="ident" id="6737163">tooLong</span><span class="op" id="6737170">,</span>&nbsp;<span class="ident" id="6737172">timeout</span><span class="op" id="6737179">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6737184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6737190">select</span>&nbsp;<span class="op" id="6737197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6737202">case</span>&nbsp;<span class="ident" id="6737207">res</span>&nbsp;<span class="op" id="6737211">:=</span>&nbsp;<span class="op" id="6737214">&lt;-</span><span class="ident" id="6737216">servec</span><span class="op" id="6737222">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6737228">t</span><span class="op" id="6737229">.</span><span class="ident" id="6737230">Logf</span><span class="op" id="6737234">(</span><span class="string" id="6737235">&#34;for&nbsp;%v:&nbsp;server&nbsp;in&nbsp;%v&nbsp;wrote&nbsp;%d,&nbsp;%v&#34;</span><span class="op" id="6737270">,</span>&nbsp;<span class="ident" id="6737272">name</span><span class="op" id="6737276">,</span>&nbsp;<span class="ident" id="6737278">res</span><span class="op" id="6737281">.</span><span class="ident" id="6737282">d</span><span class="op" id="6737283">,</span>&nbsp;<span class="ident" id="6737285">res</span><span class="op" id="6737288">.</span><span class="ident" id="6737289">n</span><span class="op" id="6737290">,</span>&nbsp;<span class="ident" id="6737292">res</span><span class="op" id="6737295">.</span><span class="ident" id="6737296">err</span><span class="op" id="6737299">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6737304">case</span>&nbsp;<span class="ident" id="6737309">err</span>&nbsp;<span class="op" id="6737313">:=</span>&nbsp;<span class="op" id="6737316">&lt;-</span><span class="ident" id="6737318">acceptc</span><span class="op" id="6737325">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6737331">t</span><span class="op" id="6737332">.</span><span class="ident" id="6737333">Fatalf</span><span class="op" id="6737339">(</span><span class="string" id="6737340">&#34;for&nbsp;%v:&nbsp;server&nbsp;Accept&nbsp;=&nbsp;%v&#34;</span><span class="op" id="6737368">,</span>&nbsp;<span class="ident" id="6737370">name</span><span class="op" id="6737374">,</span>&nbsp;<span class="ident" id="6737376">err</span><span class="op" id="6737379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6737384">case</span>&nbsp;<span class="op" id="6737389">&lt;-</span><span class="ident" id="6737391">time</span><span class="op" id="6737395">.</span><span class="ident" id="6737396">After</span><span class="op" id="6737401">(</span><span class="ident" id="6737402">tooLong</span><span class="op" id="6737409">)</span><span class="op" id="6737410">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6737416">t</span><span class="op" id="6737417">.</span><span class="ident" id="6737418">Fatalf</span><span class="op" id="6737424">(</span><span class="string" id="6737425">&#34;for&nbsp;%v,&nbsp;timeout&nbsp;waiting&nbsp;for&nbsp;server&nbsp;to&nbsp;finish&nbsp;writing&#34;</span><span class="op" id="6737479">,</span>&nbsp;<span class="ident" id="6737481">name</span><span class="op" id="6737485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6737490">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6737494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6737497">}</span><br>
<span class="lineno"></span><span class="op" id="6737499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6737502">//&nbsp;TestReadDeadlineDataAvailable&nbsp;tests&nbsp;that&nbsp;read&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">525</span><span class="comment" id="6737572">//&nbsp;if&nbsp;there&#39;s&nbsp;data&nbsp;ready&nbsp;to&nbsp;be&nbsp;read.</span><br>
<span class="lineno"></span><span class="keyword" id="6737609">func</span>&nbsp;<span class="ident" id="6737614">TestReadDeadlineDataAvailable</span><span class="op" id="6737643">(</span><span class="ident" id="6737644">t</span>&nbsp;<span class="op" id="6737646">*</span><span class="ident" id="6737647">testing</span><span class="op" id="6737654">.</span><span class="ident" id="6737655">T</span><span class="op" id="6737656">)</span>&nbsp;<span class="op" id="6737658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6737661">switch</span>&nbsp;<span class="ident" id="6737668">runtime</span><span class="op" id="6737675">.</span><span class="ident" id="6737676">GOOS</span>&nbsp;<span class="op" id="6737681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6737684">case</span>&nbsp;<span class="string" id="6737689">&#34;plan9&#34;</span><span class="op" id="6737696">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6737700">t</span><span class="op" id="6737701">.</span><span class="ident" id="6737702">Skipf</span><span class="op" id="6737707">(</span><span class="string" id="6737708">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6737729">,</span>&nbsp;<span class="ident" id="6737731">runtime</span><span class="op" id="6737738">.</span><span class="ident" id="6737739">GOOS</span><span class="op" id="6737743">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6737746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6737750">ln</span>&nbsp;<span class="op" id="6737753">:=</span>&nbsp;<span class="ident" id="6737756">newLocalListener</span><span class="op" id="6737772">(</span><span class="ident" id="6737773">t</span><span class="op" id="6737774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6737777">defer</span>&nbsp;<span class="ident" id="6737783">ln</span><span class="op" id="6737785">.</span><span class="ident" id="6737786">Close</span><span class="op" id="6737791">(</span><span class="op" id="6737792">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6737796">servec</span>&nbsp;<span class="op" id="6737803">:=</span>&nbsp;<span class="builtinfunc" id="6737806">make</span><span class="op" id="6737810">(</span><span class="keyword" id="6737811">chan</span>&nbsp;<span class="ident" id="6737816">copyRes</span><span class="op" id="6737823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6737826">const</span>&nbsp;<span class="ident" id="6737832">msg</span>&nbsp;<span class="op" id="6737836">=</span>&nbsp;<span class="string" id="6737838">&#34;data&nbsp;client&nbsp;shouldn&#39;t&nbsp;read,&nbsp;even&nbsp;though&nbsp;it&#39;ll&nbsp;be&nbsp;waiting&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6737898">go</span>&nbsp;<span class="keyword" id="6737901">func</span><span class="op" id="6737905">(</span><span class="op" id="6737906">)</span>&nbsp;<span class="op" id="6737908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6737912">c</span><span class="op" id="6737913">,</span>&nbsp;<span class="ident" id="6737915">err</span>&nbsp;<span class="op" id="6737919">:=</span>&nbsp;<span class="ident" id="6737922">ln</span><span class="op" id="6737924">.</span><span class="ident" id="6737925">Accept</span><span class="op" id="6737931">(</span><span class="op" id="6737932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6737936">if</span>&nbsp;<span class="ident" id="6737939">err</span>&nbsp;<span class="op" id="6737943">!=</span>&nbsp;<span class="ident" id="6737946">nil</span>&nbsp;<span class="op" id="6737950">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6737955">t</span><span class="op" id="6737956">.</span><span class="ident" id="6737957">Errorf</span><span class="op" id="6737963">(</span><span class="string" id="6737964">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="6737976">,</span>&nbsp;<span class="ident" id="6737978">err</span><span class="op" id="6737981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6737986">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6737995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6737999">defer</span>&nbsp;<span class="ident" id="6738005">c</span><span class="op" id="6738006">.</span><span class="ident" id="6738007">Close</span><span class="op" id="6738012">(</span><span class="op" id="6738013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6738017">n</span><span class="op" id="6738018">,</span>&nbsp;<span class="ident" id="6738020">err</span>&nbsp;<span class="op" id="6738024">:=</span>&nbsp;<span class="ident" id="6738027">c</span><span class="op" id="6738028">.</span><span class="ident" id="6738029">Write</span><span class="op" id="6738034">(</span><span class="op" id="6738035">[</span><span class="op" id="6738036">]</span><span class="builtintype" id="6738037">byte</span><span class="op" id="6738041">(</span><span class="ident" id="6738042">msg</span><span class="op" id="6738045">)</span><span class="op" id="6738046">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6738050">servec</span>&nbsp;<span class="op" id="6738057">&lt;-</span>&nbsp;<span class="ident" id="6738060">copyRes</span><span class="op" id="6738067">{</span><span class="ident" id="6738068">n</span><span class="op" id="6738069">:</span>&nbsp;<span class="ident" id="6738071">int64</span><span class="op" id="6738076">(</span><span class="ident" id="6738077">n</span><span class="op" id="6738078">)</span><span class="op" id="6738079">,</span>&nbsp;<span class="ident" id="6738081">err</span><span class="op" id="6738084">:</span>&nbsp;<span class="ident" id="6738086">err</span><span class="op" id="6738089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6738092">}</span><span class="op" id="6738093">(</span><span class="op" id="6738094">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6738098">c</span><span class="op" id="6738099">,</span>&nbsp;<span class="ident" id="6738101">err</span>&nbsp;<span class="op" id="6738105">:=</span>&nbsp;<span class="ident" id="6738108">Dial</span><span class="op" id="6738112">(</span><span class="string" id="6738113">&#34;tcp&#34;</span><span class="op" id="6738118">,</span>&nbsp;<span class="ident" id="6738120">ln</span><span class="op" id="6738122">.</span><span class="ident" id="6738123">Addr</span><span class="op" id="6738127">(</span><span class="op" id="6738128">)</span><span class="op" id="6738129">.</span><span class="ident" id="6738130">String</span><span class="op" id="6738136">(</span><span class="op" id="6738137">)</span><span class="op" id="6738138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6738141">if</span>&nbsp;<span class="ident" id="6738144">err</span>&nbsp;<span class="op" id="6738148">!=</span>&nbsp;<span class="ident" id="6738151">nil</span>&nbsp;<span class="op" id="6738155">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6738159">t</span><span class="op" id="6738160">.</span><span class="ident" id="6738161">Fatalf</span><span class="op" id="6738167">(</span><span class="string" id="6738168">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="6738178">,</span>&nbsp;<span class="ident" id="6738180">err</span><span class="op" id="6738183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6738186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6738189">defer</span>&nbsp;<span class="ident" id="6738195">c</span><span class="op" id="6738196">.</span><span class="ident" id="6738197">Close</span><span class="op" id="6738202">(</span><span class="op" id="6738203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6738206">if</span>&nbsp;<span class="ident" id="6738209">res</span>&nbsp;<span class="op" id="6738213">:=</span>&nbsp;<span class="op" id="6738216">&lt;-</span><span class="ident" id="6738218">servec</span><span class="op" id="6738224">;</span>&nbsp;<span class="ident" id="6738226">res</span><span class="op" id="6738229">.</span><span class="ident" id="6738230">err</span>&nbsp;<span class="op" id="6738234">!=</span>&nbsp;<span class="ident" id="6738237">nil</span>&nbsp;<span class="op" id="6738241">||</span>&nbsp;<span class="ident" id="6738244">res</span><span class="op" id="6738247">.</span><span class="ident" id="6738248">n</span>&nbsp;<span class="op" id="6738250">!=</span>&nbsp;<span class="ident" id="6738253">int64</span><span class="op" id="6738258">(</span><span class="builtinfunc" id="6738259">len</span><span class="op" id="6738262">(</span><span class="ident" id="6738263">msg</span><span class="op" id="6738266">)</span><span class="op" id="6738267">)</span>&nbsp;<span class="op" id="6738269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6738273">t</span><span class="op" id="6738274">.</span><span class="ident" id="6738275">Fatalf</span><span class="op" id="6738281">(</span><span class="string" id="6738282">&#34;unexpected&nbsp;server&nbsp;Write:&nbsp;n=%d,&nbsp;err=%v;&nbsp;want&nbsp;n=%d,&nbsp;err=nil&#34;</span><span class="op" id="6738341">,</span>&nbsp;<span class="ident" id="6738343">res</span><span class="op" id="6738346">.</span><span class="ident" id="6738347">n</span><span class="op" id="6738348">,</span>&nbsp;<span class="ident" id="6738350">res</span><span class="op" id="6738353">.</span><span class="ident" id="6738354">err</span><span class="op" id="6738357">,</span>&nbsp;<span class="builtinfunc" id="6738359">len</span><span class="op" id="6738362">(</span><span class="ident" id="6738363">msg</span><span class="op" id="6738366">)</span><span class="op" id="6738367">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6738370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6738373">c</span><span class="op" id="6738374">.</span><span class="ident" id="6738375">SetReadDeadline</span><span class="op" id="6738390">(</span><span class="ident" id="6738391">time</span><span class="op" id="6738395">.</span><span class="ident" id="6738396">Now</span><span class="op" id="6738399">(</span><span class="op" id="6738400">)</span><span class="op" id="6738401">.</span><span class="ident" id="6738402">Add</span><span class="op" id="6738405">(</span><span class="op" id="6738406">-</span><span class="num" id="6738407">5</span>&nbsp;<span class="op" id="6738409">*</span>&nbsp;<span class="ident" id="6738411">time</span><span class="op" id="6738415">.</span><span class="ident" id="6738416">Second</span><span class="op" id="6738422">)</span><span class="op" id="6738423">)</span>&nbsp;<span class="comment" id="6738425">//&nbsp;in&nbsp;the&nbsp;psat.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6738442">buf</span>&nbsp;<span class="op" id="6738446">:=</span>&nbsp;<span class="builtinfunc" id="6738449">make</span><span class="op" id="6738453">(</span><span class="op" id="6738454">[</span><span class="op" id="6738455">]</span><span class="builtintype" id="6738456">byte</span><span class="op" id="6738460">,</span>&nbsp;<span class="builtinfunc" id="6738462">len</span><span class="op" id="6738465">(</span><span class="ident" id="6738466">msg</span><span class="op" id="6738469">)</span><span class="op" id="6738470">/</span><span class="num" id="6738471">2</span><span class="op" id="6738472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6738475">n</span><span class="op" id="6738476">,</span>&nbsp;<span class="ident" id="6738478">err</span>&nbsp;<span class="op" id="6738482">:=</span>&nbsp;<span class="ident" id="6738485">c</span><span class="op" id="6738486">.</span><span class="ident" id="6738487">Read</span><span class="op" id="6738491">(</span><span class="ident" id="6738492">buf</span><span class="op" id="6738495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6738498">if</span>&nbsp;<span class="ident" id="6738501">n</span>&nbsp;<span class="op" id="6738503">&gt;</span>&nbsp;<span class="num" id="6738505">0</span>&nbsp;<span class="op" id="6738507">||</span>&nbsp;<span class="op" id="6738510">!</span><span class="ident" id="6738511">isTimeout</span><span class="op" id="6738520">(</span><span class="ident" id="6738521">err</span><span class="op" id="6738524">)</span>&nbsp;<span class="op" id="6738526">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6738530">t</span><span class="op" id="6738531">.</span><span class="ident" id="6738532">Fatalf</span><span class="op" id="6738538">(</span><span class="string" id="6738539">&#34;client&nbsp;read&nbsp;=&nbsp;%d&nbsp;(%q)&nbsp;err=%v;&nbsp;want&nbsp;0,&nbsp;timeout&#34;</span><span class="op" id="6738586">,</span>&nbsp;<span class="ident" id="6738588">n</span><span class="op" id="6738589">,</span>&nbsp;<span class="ident" id="6738591">buf</span><span class="op" id="6738594">[</span><span class="op" id="6738595">:</span><span class="ident" id="6738596">n</span><span class="op" id="6738597">]</span><span class="op" id="6738598">,</span>&nbsp;<span class="ident" id="6738600">err</span><span class="op" id="6738603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6738606">}</span><br>
<span class="lineno"></span><span class="op" id="6738608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6738611">//&nbsp;TestWriteDeadlineBufferAvailable&nbsp;tests&nbsp;that&nbsp;write&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">565</span><span class="comment" id="6738685">//&nbsp;if&nbsp;there&#39;s&nbsp;buffer&nbsp;space&nbsp;available&nbsp;to&nbsp;write.</span><br>
<span class="lineno"></span><span class="keyword" id="6738732">func</span>&nbsp;<span class="ident" id="6738737">TestWriteDeadlineBufferAvailable</span><span class="op" id="6738769">(</span><span class="ident" id="6738770">t</span>&nbsp;<span class="op" id="6738772">*</span><span class="ident" id="6738773">testing</span><span class="op" id="6738780">.</span><span class="ident" id="6738781">T</span><span class="op" id="6738782">)</span>&nbsp;<span class="op" id="6738784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6738787">switch</span>&nbsp;<span class="ident" id="6738794">runtime</span><span class="op" id="6738801">.</span><span class="ident" id="6738802">GOOS</span>&nbsp;<span class="op" id="6738807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6738810">case</span>&nbsp;<span class="string" id="6738815">&#34;plan9&#34;</span><span class="op" id="6738822">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6738826">t</span><span class="op" id="6738827">.</span><span class="ident" id="6738828">Skipf</span><span class="op" id="6738833">(</span><span class="string" id="6738834">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6738855">,</span>&nbsp;<span class="ident" id="6738857">runtime</span><span class="op" id="6738864">.</span><span class="ident" id="6738865">GOOS</span><span class="op" id="6738869">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6738872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6738876">ln</span>&nbsp;<span class="op" id="6738879">:=</span>&nbsp;<span class="ident" id="6738882">newLocalListener</span><span class="op" id="6738898">(</span><span class="ident" id="6738899">t</span><span class="op" id="6738900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6738903">defer</span>&nbsp;<span class="ident" id="6738909">ln</span><span class="op" id="6738911">.</span><span class="ident" id="6738912">Close</span><span class="op" id="6738917">(</span><span class="op" id="6738918">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6738922">servec</span>&nbsp;<span class="op" id="6738929">:=</span>&nbsp;<span class="builtinfunc" id="6738932">make</span><span class="op" id="6738936">(</span><span class="keyword" id="6738937">chan</span>&nbsp;<span class="ident" id="6738942">copyRes</span><span class="op" id="6738949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6738952">go</span>&nbsp;<span class="keyword" id="6738955">func</span><span class="op" id="6738959">(</span><span class="op" id="6738960">)</span>&nbsp;<span class="op" id="6738962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6738966">c</span><span class="op" id="6738967">,</span>&nbsp;<span class="ident" id="6738969">err</span>&nbsp;<span class="op" id="6738973">:=</span>&nbsp;<span class="ident" id="6738976">ln</span><span class="op" id="6738978">.</span><span class="ident" id="6738979">Accept</span><span class="op" id="6738985">(</span><span class="op" id="6738986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6738990">if</span>&nbsp;<span class="ident" id="6738993">err</span>&nbsp;<span class="op" id="6738997">!=</span>&nbsp;<span class="ident" id="6739000">nil</span>&nbsp;<span class="op" id="6739004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6739009">t</span><span class="op" id="6739010">.</span><span class="ident" id="6739011">Errorf</span><span class="op" id="6739017">(</span><span class="string" id="6739018">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="6739030">,</span>&nbsp;<span class="ident" id="6739032">err</span><span class="op" id="6739035">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6739040">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6739049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6739053">defer</span>&nbsp;<span class="ident" id="6739059">c</span><span class="op" id="6739060">.</span><span class="ident" id="6739061">Close</span><span class="op" id="6739066">(</span><span class="op" id="6739067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6739071">c</span><span class="op" id="6739072">.</span><span class="ident" id="6739073">SetWriteDeadline</span><span class="op" id="6739089">(</span><span class="ident" id="6739090">time</span><span class="op" id="6739094">.</span><span class="ident" id="6739095">Now</span><span class="op" id="6739098">(</span><span class="op" id="6739099">)</span><span class="op" id="6739100">.</span><span class="ident" id="6739101">Add</span><span class="op" id="6739104">(</span><span class="op" id="6739105">-</span><span class="num" id="6739106">5</span>&nbsp;<span class="op" id="6739108">*</span>&nbsp;<span class="ident" id="6739110">time</span><span class="op" id="6739114">.</span><span class="ident" id="6739115">Second</span><span class="op" id="6739121">)</span><span class="op" id="6739122">)</span>&nbsp;<span class="comment" id="6739124">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6739141">n</span><span class="op" id="6739142">,</span>&nbsp;<span class="ident" id="6739144">err</span>&nbsp;<span class="op" id="6739148">:=</span>&nbsp;<span class="ident" id="6739151">c</span><span class="op" id="6739152">.</span><span class="ident" id="6739153">Write</span><span class="op" id="6739158">(</span><span class="op" id="6739159">[</span><span class="op" id="6739160">]</span><span class="builtintype" id="6739161">byte</span><span class="op" id="6739165">{</span><span class="string" id="6739166">&#39;x&#39;</span><span class="op" id="6739169">}</span><span class="op" id="6739170">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6739174">servec</span>&nbsp;<span class="op" id="6739181">&lt;-</span>&nbsp;<span class="ident" id="6739184">copyRes</span><span class="op" id="6739191">{</span><span class="ident" id="6739192">n</span><span class="op" id="6739193">:</span>&nbsp;<span class="ident" id="6739195">int64</span><span class="op" id="6739200">(</span><span class="ident" id="6739201">n</span><span class="op" id="6739202">)</span><span class="op" id="6739203">,</span>&nbsp;<span class="ident" id="6739205">err</span><span class="op" id="6739208">:</span>&nbsp;<span class="ident" id="6739210">err</span><span class="op" id="6739213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6739216">}</span><span class="op" id="6739217">(</span><span class="op" id="6739218">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6739222">c</span><span class="op" id="6739223">,</span>&nbsp;<span class="ident" id="6739225">err</span>&nbsp;<span class="op" id="6739229">:=</span>&nbsp;<span class="ident" id="6739232">Dial</span><span class="op" id="6739236">(</span><span class="string" id="6739237">&#34;tcp&#34;</span><span class="op" id="6739242">,</span>&nbsp;<span class="ident" id="6739244">ln</span><span class="op" id="6739246">.</span><span class="ident" id="6739247">Addr</span><span class="op" id="6739251">(</span><span class="op" id="6739252">)</span><span class="op" id="6739253">.</span><span class="ident" id="6739254">String</span><span class="op" id="6739260">(</span><span class="op" id="6739261">)</span><span class="op" id="6739262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6739265">if</span>&nbsp;<span class="ident" id="6739268">err</span>&nbsp;<span class="op" id="6739272">!=</span>&nbsp;<span class="ident" id="6739275">nil</span>&nbsp;<span class="op" id="6739279">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6739283">t</span><span class="op" id="6739284">.</span><span class="ident" id="6739285">Fatalf</span><span class="op" id="6739291">(</span><span class="string" id="6739292">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="6739302">,</span>&nbsp;<span class="ident" id="6739304">err</span><span class="op" id="6739307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6739310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6739313">defer</span>&nbsp;<span class="ident" id="6739319">c</span><span class="op" id="6739320">.</span><span class="ident" id="6739321">Close</span><span class="op" id="6739326">(</span><span class="op" id="6739327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6739330">res</span>&nbsp;<span class="op" id="6739334">:=</span>&nbsp;<span class="op" id="6739337">&lt;-</span><span class="ident" id="6739339">servec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6739347">if</span>&nbsp;<span class="ident" id="6739350">res</span><span class="op" id="6739353">.</span><span class="ident" id="6739354">n</span>&nbsp;<span class="op" id="6739356">!=</span>&nbsp;<span class="num" id="6739359">0</span>&nbsp;<span class="op" id="6739361">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6739365">t</span><span class="op" id="6739366">.</span><span class="ident" id="6739367">Errorf</span><span class="op" id="6739373">(</span><span class="string" id="6739374">&#34;Write&nbsp;=&nbsp;%d;&nbsp;want&nbsp;0&#34;</span><span class="op" id="6739394">,</span>&nbsp;<span class="ident" id="6739396">res</span><span class="op" id="6739399">.</span><span class="ident" id="6739400">n</span><span class="op" id="6739401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6739404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6739407">if</span>&nbsp;<span class="op" id="6739410">!</span><span class="ident" id="6739411">isTimeout</span><span class="op" id="6739420">(</span><span class="ident" id="6739421">res</span><span class="op" id="6739424">.</span><span class="ident" id="6739425">err</span><span class="op" id="6739428">)</span>&nbsp;<span class="op" id="6739430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6739434">t</span><span class="op" id="6739435">.</span><span class="ident" id="6739436">Errorf</span><span class="op" id="6739442">(</span><span class="string" id="6739443">&#34;Write&nbsp;error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="6739475">,</span>&nbsp;<span class="ident" id="6739477">res</span><span class="op" id="6739480">.</span><span class="ident" id="6739481">err</span><span class="op" id="6739484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6739487">}</span><br>
<span class="lineno">600</span><span class="op" id="6739489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6739492">//&nbsp;TestAcceptDeadlineConnectionAvailable&nbsp;tests&nbsp;that&nbsp;accept&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno"></span><span class="comment" id="6739572">//&nbsp;if&nbsp;there&#39;s&nbsp;incoming&nbsp;connections&nbsp;available.</span><br>
<span class="lineno"></span><span class="keyword" id="6739618">func</span>&nbsp;<span class="ident" id="6739623">TestAcceptDeadlineConnectionAvailable</span><span class="op" id="6739660">(</span><span class="ident" id="6739661">t</span>&nbsp;<span class="op" id="6739663">*</span><span class="ident" id="6739664">testing</span><span class="op" id="6739671">.</span><span class="ident" id="6739672">T</span><span class="op" id="6739673">)</span>&nbsp;<span class="op" id="6739675">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6739678">switch</span>&nbsp;<span class="ident" id="6739685">runtime</span><span class="op" id="6739692">.</span><span class="ident" id="6739693">GOOS</span>&nbsp;<span class="op" id="6739698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6739701">case</span>&nbsp;<span class="string" id="6739706">&#34;plan9&#34;</span><span class="op" id="6739713">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6739717">t</span><span class="op" id="6739718">.</span><span class="ident" id="6739719">Skipf</span><span class="op" id="6739724">(</span><span class="string" id="6739725">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6739746">,</span>&nbsp;<span class="ident" id="6739748">runtime</span><span class="op" id="6739755">.</span><span class="ident" id="6739756">GOOS</span><span class="op" id="6739760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6739763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6739767">ln</span>&nbsp;<span class="op" id="6739770">:=</span>&nbsp;<span class="ident" id="6739773">newLocalListener</span><span class="op" id="6739789">(</span><span class="ident" id="6739790">t</span><span class="op" id="6739791">)</span><span class="op" id="6739792">.</span><span class="op" id="6739793">(</span><span class="op" id="6739794">*</span><span class="ident" id="6739795">TCPListener</span><span class="op" id="6739806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6739809">defer</span>&nbsp;<span class="ident" id="6739815">ln</span><span class="op" id="6739817">.</span><span class="ident" id="6739818">Close</span><span class="op" id="6739823">(</span><span class="op" id="6739824">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6739828">go</span>&nbsp;<span class="keyword" id="6739831">func</span><span class="op" id="6739835">(</span><span class="op" id="6739836">)</span>&nbsp;<span class="op" id="6739838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6739842">c</span><span class="op" id="6739843">,</span>&nbsp;<span class="ident" id="6739845">err</span>&nbsp;<span class="op" id="6739849">:=</span>&nbsp;<span class="ident" id="6739852">Dial</span><span class="op" id="6739856">(</span><span class="string" id="6739857">&#34;tcp&#34;</span><span class="op" id="6739862">,</span>&nbsp;<span class="ident" id="6739864">ln</span><span class="op" id="6739866">.</span><span class="ident" id="6739867">Addr</span><span class="op" id="6739871">(</span><span class="op" id="6739872">)</span><span class="op" id="6739873">.</span><span class="ident" id="6739874">String</span><span class="op" id="6739880">(</span><span class="op" id="6739881">)</span><span class="op" id="6739882">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6739886">if</span>&nbsp;<span class="ident" id="6739889">err</span>&nbsp;<span class="op" id="6739893">!=</span>&nbsp;<span class="ident" id="6739896">nil</span>&nbsp;<span class="op" id="6739900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6739905">t</span><span class="op" id="6739906">.</span><span class="ident" id="6739907">Errorf</span><span class="op" id="6739913">(</span><span class="string" id="6739914">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="6739924">,</span>&nbsp;<span class="ident" id="6739926">err</span><span class="op" id="6739929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6739934">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6739943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6739947">defer</span>&nbsp;<span class="ident" id="6739953">c</span><span class="op" id="6739954">.</span><span class="ident" id="6739955">Close</span><span class="op" id="6739960">(</span><span class="op" id="6739961">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6739965">var</span>&nbsp;<span class="ident" id="6739969">buf</span>&nbsp;<span class="op" id="6739973">[</span><span class="num" id="6739974">1</span><span class="op" id="6739975">]</span><span class="builtintype" id="6739976">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6739983">c</span><span class="op" id="6739984">.</span><span class="ident" id="6739985">Read</span><span class="op" id="6739989">(</span><span class="ident" id="6739990">buf</span><span class="op" id="6739993">[</span><span class="op" id="6739994">:</span><span class="op" id="6739995">]</span><span class="op" id="6739996">)</span>&nbsp;<span class="comment" id="6739998">//&nbsp;block&nbsp;until&nbsp;the&nbsp;connection&nbsp;or&nbsp;listener&nbsp;is&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6740051">}</span><span class="op" id="6740052">(</span><span class="op" id="6740053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6740056">time</span><span class="op" id="6740060">.</span><span class="ident" id="6740061">Sleep</span><span class="op" id="6740066">(</span><span class="num" id="6740067">10</span>&nbsp;<span class="op" id="6740070">*</span>&nbsp;<span class="ident" id="6740072">time</span><span class="op" id="6740076">.</span><span class="ident" id="6740077">Millisecond</span><span class="op" id="6740088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6740091">ln</span><span class="op" id="6740093">.</span><span class="ident" id="6740094">SetDeadline</span><span class="op" id="6740105">(</span><span class="ident" id="6740106">time</span><span class="op" id="6740110">.</span><span class="ident" id="6740111">Now</span><span class="op" id="6740114">(</span><span class="op" id="6740115">)</span><span class="op" id="6740116">.</span><span class="ident" id="6740117">Add</span><span class="op" id="6740120">(</span><span class="op" id="6740121">-</span><span class="num" id="6740122">5</span>&nbsp;<span class="op" id="6740124">*</span>&nbsp;<span class="ident" id="6740126">time</span><span class="op" id="6740130">.</span><span class="ident" id="6740131">Second</span><span class="op" id="6740137">)</span><span class="op" id="6740138">)</span>&nbsp;<span class="comment" id="6740140">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6740156">c</span><span class="op" id="6740157">,</span>&nbsp;<span class="ident" id="6740159">err</span>&nbsp;<span class="op" id="6740163">:=</span>&nbsp;<span class="ident" id="6740166">ln</span><span class="op" id="6740168">.</span><span class="ident" id="6740169">Accept</span><span class="op" id="6740175">(</span><span class="op" id="6740176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6740179">if</span>&nbsp;<span class="ident" id="6740182">err</span>&nbsp;<span class="op" id="6740186">==</span>&nbsp;<span class="ident" id="6740189">nil</span>&nbsp;<span class="op" id="6740193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6740197">defer</span>&nbsp;<span class="ident" id="6740203">c</span><span class="op" id="6740204">.</span><span class="ident" id="6740205">Close</span><span class="op" id="6740210">(</span><span class="op" id="6740211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6740214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6740217">if</span>&nbsp;<span class="op" id="6740220">!</span><span class="ident" id="6740221">isTimeout</span><span class="op" id="6740230">(</span><span class="ident" id="6740231">err</span><span class="op" id="6740234">)</span>&nbsp;<span class="op" id="6740236">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6740240">t</span><span class="op" id="6740241">.</span><span class="ident" id="6740242">Fatalf</span><span class="op" id="6740248">(</span><span class="string" id="6740249">&#34;Accept:&nbsp;got&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="6740279">,</span>&nbsp;<span class="ident" id="6740281">err</span><span class="op" id="6740284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6740287">}</span><br>
<span class="lineno"></span><span class="op" id="6740289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6740292">//&nbsp;TestConnectDeadlineInThePast&nbsp;tests&nbsp;that&nbsp;connect&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">635</span><span class="comment" id="6740364">//&nbsp;if&nbsp;the&nbsp;connection&nbsp;can&nbsp;be&nbsp;established&nbsp;w/o&nbsp;blocking.</span><br>
<span class="lineno"></span><span class="keyword" id="6740418">func</span>&nbsp;<span class="ident" id="6740423">TestConnectDeadlineInThePast</span><span class="op" id="6740451">(</span><span class="ident" id="6740452">t</span>&nbsp;<span class="op" id="6740454">*</span><span class="ident" id="6740455">testing</span><span class="op" id="6740462">.</span><span class="ident" id="6740463">T</span><span class="op" id="6740464">)</span>&nbsp;<span class="op" id="6740466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6740469">switch</span>&nbsp;<span class="ident" id="6740476">runtime</span><span class="op" id="6740483">.</span><span class="ident" id="6740484">GOOS</span>&nbsp;<span class="op" id="6740489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6740492">case</span>&nbsp;<span class="string" id="6740497">&#34;plan9&#34;</span><span class="op" id="6740504">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6740508">t</span><span class="op" id="6740509">.</span><span class="ident" id="6740510">Skipf</span><span class="op" id="6740515">(</span><span class="string" id="6740516">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6740537">,</span>&nbsp;<span class="ident" id="6740539">runtime</span><span class="op" id="6740546">.</span><span class="ident" id="6740547">GOOS</span><span class="op" id="6740551">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6740554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6740558">ln</span>&nbsp;<span class="op" id="6740561">:=</span>&nbsp;<span class="ident" id="6740564">newLocalListener</span><span class="op" id="6740580">(</span><span class="ident" id="6740581">t</span><span class="op" id="6740582">)</span><span class="op" id="6740583">.</span><span class="op" id="6740584">(</span><span class="op" id="6740585">*</span><span class="ident" id="6740586">TCPListener</span><span class="op" id="6740597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6740600">defer</span>&nbsp;<span class="ident" id="6740606">ln</span><span class="op" id="6740608">.</span><span class="ident" id="6740609">Close</span><span class="op" id="6740614">(</span><span class="op" id="6740615">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6740619">go</span>&nbsp;<span class="keyword" id="6740622">func</span><span class="op" id="6740626">(</span><span class="op" id="6740627">)</span>&nbsp;<span class="op" id="6740629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6740633">c</span><span class="op" id="6740634">,</span>&nbsp;<span class="ident" id="6740636">err</span>&nbsp;<span class="op" id="6740640">:=</span>&nbsp;<span class="ident" id="6740643">ln</span><span class="op" id="6740645">.</span><span class="ident" id="6740646">Accept</span><span class="op" id="6740652">(</span><span class="op" id="6740653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6740657">if</span>&nbsp;<span class="ident" id="6740660">err</span>&nbsp;<span class="op" id="6740664">==</span>&nbsp;<span class="ident" id="6740667">nil</span>&nbsp;<span class="op" id="6740671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6740676">defer</span>&nbsp;<span class="ident" id="6740682">c</span><span class="op" id="6740683">.</span><span class="ident" id="6740684">Close</span><span class="op" id="6740689">(</span><span class="op" id="6740690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6740694">}</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6740697">}</span><span class="op" id="6740698">(</span><span class="op" id="6740699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6740702">time</span><span class="op" id="6740706">.</span><span class="ident" id="6740707">Sleep</span><span class="op" id="6740712">(</span><span class="num" id="6740713">10</span>&nbsp;<span class="op" id="6740716">*</span>&nbsp;<span class="ident" id="6740718">time</span><span class="op" id="6740722">.</span><span class="ident" id="6740723">Millisecond</span><span class="op" id="6740734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6740737">c</span><span class="op" id="6740738">,</span>&nbsp;<span class="ident" id="6740740">err</span>&nbsp;<span class="op" id="6740744">:=</span>&nbsp;<span class="ident" id="6740747">DialTimeout</span><span class="op" id="6740758">(</span><span class="string" id="6740759">&#34;tcp&#34;</span><span class="op" id="6740764">,</span>&nbsp;<span class="ident" id="6740766">ln</span><span class="op" id="6740768">.</span><span class="ident" id="6740769">Addr</span><span class="op" id="6740773">(</span><span class="op" id="6740774">)</span><span class="op" id="6740775">.</span><span class="ident" id="6740776">String</span><span class="op" id="6740782">(</span><span class="op" id="6740783">)</span><span class="op" id="6740784">,</span>&nbsp;<span class="op" id="6740786">-</span><span class="num" id="6740787">5</span><span class="op" id="6740788">*</span><span class="ident" id="6740789">time</span><span class="op" id="6740793">.</span><span class="ident" id="6740794">Second</span><span class="op" id="6740800">)</span>&nbsp;<span class="comment" id="6740802">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6740818">if</span>&nbsp;<span class="ident" id="6740821">err</span>&nbsp;<span class="op" id="6740825">==</span>&nbsp;<span class="ident" id="6740828">nil</span>&nbsp;<span class="op" id="6740832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6740836">defer</span>&nbsp;<span class="ident" id="6740842">c</span><span class="op" id="6740843">.</span><span class="ident" id="6740844">Close</span><span class="op" id="6740849">(</span><span class="op" id="6740850">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6740853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6740856">if</span>&nbsp;<span class="op" id="6740859">!</span><span class="ident" id="6740860">isTimeout</span><span class="op" id="6740869">(</span><span class="ident" id="6740870">err</span><span class="op" id="6740873">)</span>&nbsp;<span class="op" id="6740875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6740879">t</span><span class="op" id="6740880">.</span><span class="ident" id="6740881">Fatalf</span><span class="op" id="6740887">(</span><span class="string" id="6740888">&#34;DialTimeout:&nbsp;got&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="6740923">,</span>&nbsp;<span class="ident" id="6740925">err</span><span class="op" id="6740928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6740931">}</span><br>
<span class="lineno"></span><span class="op" id="6740933">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="comment" id="6740936">//&nbsp;TestProlongTimeout&nbsp;tests&nbsp;concurrent&nbsp;deadline&nbsp;modification.</span><br>
<span class="lineno"></span><span class="comment" id="6740998">//&nbsp;Known&nbsp;to&nbsp;cause&nbsp;data&nbsp;races&nbsp;in&nbsp;the&nbsp;past.</span><br>
<span class="lineno"></span><span class="keyword" id="6741040">func</span>&nbsp;<span class="ident" id="6741045">TestProlongTimeout</span><span class="op" id="6741063">(</span><span class="ident" id="6741064">t</span>&nbsp;<span class="op" id="6741066">*</span><span class="ident" id="6741067">testing</span><span class="op" id="6741074">.</span><span class="ident" id="6741075">T</span><span class="op" id="6741076">)</span>&nbsp;<span class="op" id="6741078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6741081">switch</span>&nbsp;<span class="ident" id="6741088">runtime</span><span class="op" id="6741095">.</span><span class="ident" id="6741096">GOOS</span>&nbsp;<span class="op" id="6741101">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6741104">case</span>&nbsp;<span class="string" id="6741109">&#34;plan9&#34;</span><span class="op" id="6741116">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6741120">t</span><span class="op" id="6741121">.</span><span class="ident" id="6741122">Skipf</span><span class="op" id="6741127">(</span><span class="string" id="6741128">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6741149">,</span>&nbsp;<span class="ident" id="6741151">runtime</span><span class="op" id="6741158">.</span><span class="ident" id="6741159">GOOS</span><span class="op" id="6741163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6741166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6741170">ln</span>&nbsp;<span class="op" id="6741173">:=</span>&nbsp;<span class="ident" id="6741176">newLocalListener</span><span class="op" id="6741192">(</span><span class="ident" id="6741193">t</span><span class="op" id="6741194">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6741197">defer</span>&nbsp;<span class="ident" id="6741203">ln</span><span class="op" id="6741205">.</span><span class="ident" id="6741206">Close</span><span class="op" id="6741211">(</span><span class="op" id="6741212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6741215">connected</span>&nbsp;<span class="op" id="6741225">:=</span>&nbsp;<span class="builtinfunc" id="6741228">make</span><span class="op" id="6741232">(</span><span class="keyword" id="6741233">chan</span>&nbsp;<span class="builtintype" id="6741238">bool</span><span class="op" id="6741242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6741245">go</span>&nbsp;<span class="keyword" id="6741248">func</span><span class="op" id="6741252">(</span><span class="op" id="6741253">)</span>&nbsp;<span class="op" id="6741255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6741259">s</span><span class="op" id="6741260">,</span>&nbsp;<span class="ident" id="6741262">err</span>&nbsp;<span class="op" id="6741266">:=</span>&nbsp;<span class="ident" id="6741269">ln</span><span class="op" id="6741271">.</span><span class="ident" id="6741272">Accept</span><span class="op" id="6741278">(</span><span class="op" id="6741279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6741283">connected</span>&nbsp;<span class="op" id="6741293">&lt;-</span>&nbsp;<span class="builtintype" id="6741296">true</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6741303">if</span>&nbsp;<span class="ident" id="6741306">err</span>&nbsp;<span class="op" id="6741310">!=</span>&nbsp;<span class="ident" id="6741313">nil</span>&nbsp;<span class="op" id="6741317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6741322">t</span><span class="op" id="6741323">.</span><span class="ident" id="6741324">Errorf</span><span class="op" id="6741330">(</span><span class="string" id="6741331">&#34;ln.Accept:&nbsp;%v&#34;</span><span class="op" id="6741346">,</span>&nbsp;<span class="ident" id="6741348">err</span><span class="op" id="6741351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6741356">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6741365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6741369">defer</span>&nbsp;<span class="ident" id="6741375">s</span><span class="op" id="6741376">.</span><span class="ident" id="6741377">Close</span><span class="op" id="6741382">(</span><span class="op" id="6741383">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6741387">s</span><span class="op" id="6741388">.</span><span class="ident" id="6741389">SetDeadline</span><span class="op" id="6741400">(</span><span class="ident" id="6741401">time</span><span class="op" id="6741405">.</span><span class="ident" id="6741406">Now</span><span class="op" id="6741409">(</span><span class="op" id="6741410">)</span><span class="op" id="6741411">.</span><span class="ident" id="6741412">Add</span><span class="op" id="6741415">(</span><span class="ident" id="6741416">time</span><span class="op" id="6741420">.</span><span class="ident" id="6741421">Hour</span><span class="op" id="6741425">)</span><span class="op" id="6741426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6741430">go</span>&nbsp;<span class="keyword" id="6741433">func</span><span class="op" id="6741437">(</span><span class="op" id="6741438">)</span>&nbsp;<span class="op" id="6741440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6741445">var</span>&nbsp;<span class="ident" id="6741449">buf</span>&nbsp;<span class="op" id="6741453">[</span><span class="num" id="6741454">4096</span><span class="op" id="6741458">]</span><span class="builtintype" id="6741459">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6741467">for</span>&nbsp;<span class="op" id="6741471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6741477">_</span><span class="op" id="6741478">,</span>&nbsp;<span class="ident" id="6741480">err</span>&nbsp;<span class="op" id="6741484">:=</span>&nbsp;<span class="ident" id="6741487">s</span><span class="op" id="6741488">.</span><span class="ident" id="6741489">Write</span><span class="op" id="6741494">(</span><span class="ident" id="6741495">buf</span><span class="op" id="6741498">[</span><span class="op" id="6741499">:</span><span class="op" id="6741500">]</span><span class="op" id="6741501">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6741507">if</span>&nbsp;<span class="ident" id="6741510">err</span>&nbsp;<span class="op" id="6741514">!=</span>&nbsp;<span class="ident" id="6741517">nil</span>&nbsp;<span class="op" id="6741521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6741528">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6741538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6741544">s</span><span class="op" id="6741545">.</span><span class="ident" id="6741546">SetDeadline</span><span class="op" id="6741557">(</span><span class="ident" id="6741558">time</span><span class="op" id="6741562">.</span><span class="ident" id="6741563">Now</span><span class="op" id="6741566">(</span><span class="op" id="6741567">)</span><span class="op" id="6741568">.</span><span class="ident" id="6741569">Add</span><span class="op" id="6741572">(</span><span class="ident" id="6741573">time</span><span class="op" id="6741577">.</span><span class="ident" id="6741578">Hour</span><span class="op" id="6741582">)</span><span class="op" id="6741583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6741588">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6741592">}</span><span class="op" id="6741593">(</span><span class="op" id="6741594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6741598">buf</span>&nbsp;<span class="op" id="6741602">:=</span>&nbsp;<span class="builtinfunc" id="6741605">make</span><span class="op" id="6741609">(</span><span class="op" id="6741610">[</span><span class="op" id="6741611">]</span><span class="builtintype" id="6741612">byte</span><span class="op" id="6741616">,</span>&nbsp;<span class="num" id="6741618">1</span><span class="op" id="6741619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6741623">for</span>&nbsp;<span class="op" id="6741627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6741632">_</span><span class="op" id="6741633">,</span>&nbsp;<span class="ident" id="6741635">err</span>&nbsp;<span class="op" id="6741639">:=</span>&nbsp;<span class="ident" id="6741642">s</span><span class="op" id="6741643">.</span><span class="ident" id="6741644">Read</span><span class="op" id="6741648">(</span><span class="ident" id="6741649">buf</span><span class="op" id="6741652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6741657">if</span>&nbsp;<span class="ident" id="6741660">err</span>&nbsp;<span class="op" id="6741664">!=</span>&nbsp;<span class="ident" id="6741667">nil</span>&nbsp;<span class="op" id="6741671">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6741677">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6741686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6741691">s</span><span class="op" id="6741692">.</span><span class="ident" id="6741693">SetDeadline</span><span class="op" id="6741704">(</span><span class="ident" id="6741705">time</span><span class="op" id="6741709">.</span><span class="ident" id="6741710">Now</span><span class="op" id="6741713">(</span><span class="op" id="6741714">)</span><span class="op" id="6741715">.</span><span class="ident" id="6741716">Add</span><span class="op" id="6741719">(</span><span class="ident" id="6741720">time</span><span class="op" id="6741724">.</span><span class="ident" id="6741725">Hour</span><span class="op" id="6741729">)</span><span class="op" id="6741730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6741734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6741737">}</span><span class="op" id="6741738">(</span><span class="op" id="6741739">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6741742">c</span><span class="op" id="6741743">,</span>&nbsp;<span class="ident" id="6741745">err</span>&nbsp;<span class="op" id="6741749">:=</span>&nbsp;<span class="ident" id="6741752">Dial</span><span class="op" id="6741756">(</span><span class="string" id="6741757">&#34;tcp&#34;</span><span class="op" id="6741762">,</span>&nbsp;<span class="ident" id="6741764">ln</span><span class="op" id="6741766">.</span><span class="ident" id="6741767">Addr</span><span class="op" id="6741771">(</span><span class="op" id="6741772">)</span><span class="op" id="6741773">.</span><span class="ident" id="6741774">String</span><span class="op" id="6741780">(</span><span class="op" id="6741781">)</span><span class="op" id="6741782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6741785">if</span>&nbsp;<span class="ident" id="6741788">err</span>&nbsp;<span class="op" id="6741792">!=</span>&nbsp;<span class="ident" id="6741795">nil</span>&nbsp;<span class="op" id="6741799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6741803">t</span><span class="op" id="6741804">.</span><span class="ident" id="6741805">Fatalf</span><span class="op" id="6741811">(</span><span class="string" id="6741812">&#34;DialTCP:&nbsp;%v&#34;</span><span class="op" id="6741825">,</span>&nbsp;<span class="ident" id="6741827">err</span><span class="op" id="6741830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6741833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6741836">defer</span>&nbsp;<span class="ident" id="6741842">c</span><span class="op" id="6741843">.</span><span class="ident" id="6741844">Close</span><span class="op" id="6741849">(</span><span class="op" id="6741850">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6741853">&lt;-</span><span class="ident" id="6741855">connected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6741866">for</span>&nbsp;<span class="ident" id="6741870">i</span>&nbsp;<span class="op" id="6741872">:=</span>&nbsp;<span class="num" id="6741875">0</span><span class="op" id="6741876">;</span>&nbsp;<span class="ident" id="6741878">i</span>&nbsp;<span class="op" id="6741880">&lt;</span>&nbsp;<span class="num" id="6741882">1024</span><span class="op" id="6741886">;</span>&nbsp;<span class="ident" id="6741888">i</span><span class="op" id="6741889">++</span>&nbsp;<span class="op" id="6741892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6741896">var</span>&nbsp;<span class="ident" id="6741900">buf</span>&nbsp;<span class="op" id="6741904">[</span><span class="num" id="6741905">1</span><span class="op" id="6741906">]</span><span class="builtintype" id="6741907">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6741914">c</span><span class="op" id="6741915">.</span><span class="ident" id="6741916">Write</span><span class="op" id="6741921">(</span><span class="ident" id="6741922">buf</span><span class="op" id="6741925">[</span><span class="op" id="6741926">:</span><span class="op" id="6741927">]</span><span class="op" id="6741928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6741931">}</span><br>
<span class="lineno">710</span><span class="op" id="6741933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6741936">func</span>&nbsp;<span class="ident" id="6741941">TestDeadlineRace</span><span class="op" id="6741957">(</span><span class="ident" id="6741958">t</span>&nbsp;<span class="op" id="6741960">*</span><span class="ident" id="6741961">testing</span><span class="op" id="6741968">.</span><span class="ident" id="6741969">T</span><span class="op" id="6741970">)</span>&nbsp;<span class="op" id="6741972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6741975">switch</span>&nbsp;<span class="ident" id="6741982">runtime</span><span class="op" id="6741989">.</span><span class="ident" id="6741990">GOOS</span>&nbsp;<span class="op" id="6741995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6741998">case</span>&nbsp;<span class="string" id="6742003">&#34;nacl&#34;</span><span class="op" id="6742009">,</span>&nbsp;<span class="string" id="6742011">&#34;plan9&#34;</span><span class="op" id="6742018">:</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6742022">t</span><span class="op" id="6742023">.</span><span class="ident" id="6742024">Skipf</span><span class="op" id="6742029">(</span><span class="string" id="6742030">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6742051">,</span>&nbsp;<span class="ident" id="6742053">runtime</span><span class="op" id="6742060">.</span><span class="ident" id="6742061">GOOS</span><span class="op" id="6742065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6742068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6742072">N</span>&nbsp;<span class="op" id="6742074">:=</span>&nbsp;<span class="num" id="6742077">1000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6742083">if</span>&nbsp;<span class="ident" id="6742086">testing</span><span class="op" id="6742093">.</span><span class="ident" id="6742094">Short</span><span class="op" id="6742099">(</span><span class="op" id="6742100">)</span>&nbsp;<span class="op" id="6742102">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6742106">N</span>&nbsp;<span class="op" id="6742108">=</span>&nbsp;<span class="num" id="6742110">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6742114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6742117">defer</span>&nbsp;<span class="ident" id="6742123">runtime</span><span class="op" id="6742130">.</span><span class="ident" id="6742131">GOMAXPROCS</span><span class="op" id="6742141">(</span><span class="ident" id="6742142">runtime</span><span class="op" id="6742149">.</span><span class="ident" id="6742150">GOMAXPROCS</span><span class="op" id="6742160">(</span><span class="num" id="6742161">4</span><span class="op" id="6742162">)</span><span class="op" id="6742163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6742166">ln</span>&nbsp;<span class="op" id="6742169">:=</span>&nbsp;<span class="ident" id="6742172">newLocalListener</span><span class="op" id="6742188">(</span><span class="ident" id="6742189">t</span><span class="op" id="6742190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6742193">defer</span>&nbsp;<span class="ident" id="6742199">ln</span><span class="op" id="6742201">.</span><span class="ident" id="6742202">Close</span><span class="op" id="6742207">(</span><span class="op" id="6742208">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6742211">c</span><span class="op" id="6742212">,</span>&nbsp;<span class="ident" id="6742214">err</span>&nbsp;<span class="op" id="6742218">:=</span>&nbsp;<span class="ident" id="6742221">Dial</span><span class="op" id="6742225">(</span><span class="string" id="6742226">&#34;tcp&#34;</span><span class="op" id="6742231">,</span>&nbsp;<span class="ident" id="6742233">ln</span><span class="op" id="6742235">.</span><span class="ident" id="6742236">Addr</span><span class="op" id="6742240">(</span><span class="op" id="6742241">)</span><span class="op" id="6742242">.</span><span class="ident" id="6742243">String</span><span class="op" id="6742249">(</span><span class="op" id="6742250">)</span><span class="op" id="6742251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6742254">if</span>&nbsp;<span class="ident" id="6742257">err</span>&nbsp;<span class="op" id="6742261">!=</span>&nbsp;<span class="ident" id="6742264">nil</span>&nbsp;<span class="op" id="6742268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6742272">t</span><span class="op" id="6742273">.</span><span class="ident" id="6742274">Fatalf</span><span class="op" id="6742280">(</span><span class="string" id="6742281">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="6742291">,</span>&nbsp;<span class="ident" id="6742293">err</span><span class="op" id="6742296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6742299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6742302">defer</span>&nbsp;<span class="ident" id="6742308">c</span><span class="op" id="6742309">.</span><span class="ident" id="6742310">Close</span><span class="op" id="6742315">(</span><span class="op" id="6742316">)</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6742319">done</span>&nbsp;<span class="op" id="6742324">:=</span>&nbsp;<span class="builtinfunc" id="6742327">make</span><span class="op" id="6742331">(</span><span class="keyword" id="6742332">chan</span>&nbsp;<span class="builtintype" id="6742337">bool</span><span class="op" id="6742341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6742344">go</span>&nbsp;<span class="keyword" id="6742347">func</span><span class="op" id="6742351">(</span><span class="op" id="6742352">)</span>&nbsp;<span class="op" id="6742354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6742358">t</span>&nbsp;<span class="op" id="6742360">:=</span>&nbsp;<span class="ident" id="6742363">time</span><span class="op" id="6742367">.</span><span class="ident" id="6742368">NewTicker</span><span class="op" id="6742377">(</span><span class="num" id="6742378">2</span>&nbsp;<span class="op" id="6742380">*</span>&nbsp;<span class="ident" id="6742382">time</span><span class="op" id="6742386">.</span><span class="ident" id="6742387">Microsecond</span><span class="op" id="6742398">)</span><span class="op" id="6742399">.</span><span class="ident" id="6742400">C</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6742404">for</span>&nbsp;<span class="ident" id="6742408">i</span>&nbsp;<span class="op" id="6742410">:=</span>&nbsp;<span class="num" id="6742413">0</span><span class="op" id="6742414">;</span>&nbsp;<span class="ident" id="6742416">i</span>&nbsp;<span class="op" id="6742418">&lt;</span>&nbsp;<span class="ident" id="6742420">N</span><span class="op" id="6742421">;</span>&nbsp;<span class="ident" id="6742423">i</span><span class="op" id="6742424">++</span>&nbsp;<span class="op" id="6742427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6742432">if</span>&nbsp;<span class="ident" id="6742435">err</span>&nbsp;<span class="op" id="6742439">:=</span>&nbsp;<span class="ident" id="6742442">c</span><span class="op" id="6742443">.</span><span class="ident" id="6742444">SetDeadline</span><span class="op" id="6742455">(</span><span class="ident" id="6742456">time</span><span class="op" id="6742460">.</span><span class="ident" id="6742461">Now</span><span class="op" id="6742464">(</span><span class="op" id="6742465">)</span><span class="op" id="6742466">.</span><span class="ident" id="6742467">Add</span><span class="op" id="6742470">(</span><span class="num" id="6742471">2</span>&nbsp;<span class="op" id="6742473">*</span>&nbsp;<span class="ident" id="6742475">time</span><span class="op" id="6742479">.</span><span class="ident" id="6742480">Microsecond</span><span class="op" id="6742491">)</span><span class="op" id="6742492">)</span><span class="op" id="6742493">;</span>&nbsp;<span class="ident" id="6742495">err</span>&nbsp;<span class="op" id="6742499">!=</span>&nbsp;<span class="ident" id="6742502">nil</span>&nbsp;<span class="op" id="6742506">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6742512">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6742521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6742526">&lt;-</span><span class="ident" id="6742528">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6742532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6742536">done</span>&nbsp;<span class="op" id="6742541">&lt;-</span>&nbsp;<span class="builtintype" id="6742544">true</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6742550">}</span><span class="op" id="6742551">(</span><span class="op" id="6742552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6742555">var</span>&nbsp;<span class="ident" id="6742559">buf</span>&nbsp;<span class="op" id="6742563">[</span><span class="num" id="6742564">1</span><span class="op" id="6742565">]</span><span class="builtintype" id="6742566">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6742572">for</span>&nbsp;<span class="ident" id="6742576">i</span>&nbsp;<span class="op" id="6742578">:=</span>&nbsp;<span class="num" id="6742581">0</span><span class="op" id="6742582">;</span>&nbsp;<span class="ident" id="6742584">i</span>&nbsp;<span class="op" id="6742586">&lt;</span>&nbsp;<span class="ident" id="6742588">N</span><span class="op" id="6742589">;</span>&nbsp;<span class="ident" id="6742591">i</span><span class="op" id="6742592">++</span>&nbsp;<span class="op" id="6742595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6742599">c</span><span class="op" id="6742600">.</span><span class="ident" id="6742601">Read</span><span class="op" id="6742605">(</span><span class="ident" id="6742606">buf</span><span class="op" id="6742609">[</span><span class="op" id="6742610">:</span><span class="op" id="6742611">]</span><span class="op" id="6742612">)</span>&nbsp;<span class="comment" id="6742614">//&nbsp;ignore&nbsp;possible&nbsp;timeout&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6742649">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6742652">c</span><span class="op" id="6742653">.</span><span class="ident" id="6742654">Close</span><span class="op" id="6742659">(</span><span class="op" id="6742660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6742663">&lt;-</span><span class="ident" id="6742665">done</span><br>
<span class="lineno"></span><span class="op" id="6742670">}</span>
</div>
</body>
</html>
