<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/aes</h2>
<ul>
<li><a href="/gostd/crypto/aes/aes_test.go.html">aes_test.go</a></li>
<li><a href="/gostd/crypto/aes/block.go.html" class="current">block.go</a></li>
<li><a href="/gostd/crypto/aes/cipher.go.html">cipher.go</a></li>
<li><a href="/gostd/crypto/aes/cipher_asm.go.html">cipher_asm.go</a></li>
<li><a href="/gostd/crypto/aes/const.go.html">const.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3692306">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3692361">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3692415">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3692466">//&nbsp;This&nbsp;Go&nbsp;implementation&nbsp;is&nbsp;derived&nbsp;in&nbsp;part&nbsp;from&nbsp;the&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="3692530">//&nbsp;ANSI&nbsp;C&nbsp;implementation,&nbsp;which&nbsp;carries&nbsp;the&nbsp;following&nbsp;notice:</span><br>
<span class="lineno"></span><span class="comment" id="3692592">//</span><br>
<span class="lineno"></span><span class="comment" id="3692595">//&nbsp;&nbsp;&nbsp;&nbsp;rijndael-alg-fst.c</span><br>
<span class="lineno"></span><span class="comment" id="3692617">//</span><br>
<span class="lineno">10</span><span class="comment" id="3692620">//&nbsp;&nbsp;&nbsp;&nbsp;@version&nbsp;3.0&nbsp;(December&nbsp;2000)</span><br>
<span class="lineno"></span><span class="comment" id="3692652">//</span><br>
<span class="lineno"></span><span class="comment" id="3692655">//&nbsp;&nbsp;&nbsp;&nbsp;Optimised&nbsp;ANSI&nbsp;C&nbsp;code&nbsp;for&nbsp;the&nbsp;Rijndael&nbsp;cipher&nbsp;(now&nbsp;AES)</span><br>
<span class="lineno"></span><span class="comment" id="3692714">//</span><br>
<span class="lineno"></span><span class="comment" id="3692717">//&nbsp;&nbsp;&nbsp;&nbsp;@author&nbsp;Vincent&nbsp;Rijmen&nbsp;&lt;vincent.rijmen@esat.kuleuven.ac.be&gt;</span><br>
<span class="lineno">15</span><span class="comment" id="3692780">//&nbsp;&nbsp;&nbsp;&nbsp;@author&nbsp;Antoon&nbsp;Bosselaers&nbsp;&lt;antoon.bosselaers@esat.kuleuven.ac.be&gt;</span><br>
<span class="lineno"></span><span class="comment" id="3692849">//&nbsp;&nbsp;&nbsp;&nbsp;@author&nbsp;Paulo&nbsp;Barreto&nbsp;&lt;paulo.barreto@terra.com.br&gt;</span><br>
<span class="lineno"></span><span class="comment" id="3692903">//</span><br>
<span class="lineno"></span><span class="comment" id="3692906">//&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;code&nbsp;is&nbsp;hereby&nbsp;placed&nbsp;in&nbsp;the&nbsp;public&nbsp;domain.</span><br>
<span class="lineno"></span><span class="comment" id="3692958">//</span><br>
<span class="lineno">20</span><span class="comment" id="3692961">//&nbsp;&nbsp;&nbsp;&nbsp;THIS&nbsp;SOFTWARE&nbsp;IS&nbsp;PROVIDED&nbsp;BY&nbsp;THE&nbsp;AUTHORS&nbsp;&#39;&#39;AS&nbsp;IS&#39;&#39;&nbsp;AND&nbsp;ANY&nbsp;EXPRESS</span><br>
<span class="lineno"></span><span class="comment" id="3693031">//&nbsp;&nbsp;&nbsp;&nbsp;OR&nbsp;IMPLIED&nbsp;WARRANTIES,&nbsp;INCLUDING,&nbsp;BUT&nbsp;NOT&nbsp;LIMITED&nbsp;TO,&nbsp;THE&nbsp;IMPLIED</span><br>
<span class="lineno"></span><span class="comment" id="3693100">//&nbsp;&nbsp;&nbsp;&nbsp;WARRANTIES&nbsp;OF&nbsp;MERCHANTABILITY&nbsp;AND&nbsp;FITNESS&nbsp;FOR&nbsp;A&nbsp;PARTICULAR&nbsp;PURPOSE</span><br>
<span class="lineno"></span><span class="comment" id="3693170">//&nbsp;&nbsp;&nbsp;&nbsp;ARE&nbsp;DISCLAIMED.&nbsp;&nbsp;IN&nbsp;NO&nbsp;EVENT&nbsp;SHALL&nbsp;THE&nbsp;AUTHORS&nbsp;OR&nbsp;CONTRIBUTORS&nbsp;BE</span><br>
<span class="lineno"></span><span class="comment" id="3693239">//&nbsp;&nbsp;&nbsp;&nbsp;LIABLE&nbsp;FOR&nbsp;ANY&nbsp;DIRECT,&nbsp;INDIRECT,&nbsp;INCIDENTAL,&nbsp;SPECIAL,&nbsp;EXEMPLARY,&nbsp;OR</span><br>
<span class="lineno">25</span><span class="comment" id="3693310">//&nbsp;&nbsp;&nbsp;&nbsp;CONSEQUENTIAL&nbsp;DAMAGES&nbsp;(INCLUDING,&nbsp;BUT&nbsp;NOT&nbsp;LIMITED&nbsp;TO,&nbsp;PROCUREMENT&nbsp;OF</span><br>
<span class="lineno"></span><span class="comment" id="3693382">//&nbsp;&nbsp;&nbsp;&nbsp;SUBSTITUTE&nbsp;GOODS&nbsp;OR&nbsp;SERVICES;&nbsp;LOSS&nbsp;OF&nbsp;USE,&nbsp;DATA,&nbsp;OR&nbsp;PROFITS;&nbsp;OR</span><br>
<span class="lineno"></span><span class="comment" id="3693449">//&nbsp;&nbsp;&nbsp;&nbsp;BUSINESS&nbsp;INTERRUPTION)&nbsp;HOWEVER&nbsp;CAUSED&nbsp;AND&nbsp;ON&nbsp;ANY&nbsp;THEORY&nbsp;OF&nbsp;LIABILITY,</span><br>
<span class="lineno"></span><span class="comment" id="3693522">//&nbsp;&nbsp;&nbsp;&nbsp;WHETHER&nbsp;IN&nbsp;CONTRACT,&nbsp;STRICT&nbsp;LIABILITY,&nbsp;OR&nbsp;TORT&nbsp;(INCLUDING&nbsp;NEGLIGENCE</span><br>
<span class="lineno"></span><span class="comment" id="3693594">//&nbsp;&nbsp;&nbsp;&nbsp;OR&nbsp;OTHERWISE)&nbsp;ARISING&nbsp;IN&nbsp;ANY&nbsp;WAY&nbsp;OUT&nbsp;OF&nbsp;THE&nbsp;USE&nbsp;OF&nbsp;THIS&nbsp;SOFTWARE,</span><br>
<span class="lineno">30</span><span class="comment" id="3693663">//&nbsp;&nbsp;&nbsp;&nbsp;EVEN&nbsp;IF&nbsp;ADVISED&nbsp;OF&nbsp;THE&nbsp;POSSIBILITY&nbsp;OF&nbsp;SUCH&nbsp;DAMAGE.</span><br>
<span class="lineno"></span><span class="comment" id="3693717">//</span><br>
<span class="lineno"></span><span class="comment" id="3693720">//&nbsp;See&nbsp;FIPS&nbsp;197&nbsp;for&nbsp;specification,&nbsp;and&nbsp;see&nbsp;Daemen&nbsp;and&nbsp;Rijmen&#39;s&nbsp;Rijndael&nbsp;submission</span><br>
<span class="lineno"></span><span class="comment" id="3693803">//&nbsp;for&nbsp;implementation&nbsp;details.</span><br>
<span class="lineno"></span><span class="comment" id="3693834">//&nbsp;&nbsp;&nbsp;&nbsp;http://www.csrc.nist.gov/publications/fips/fips197/fips-197.pdf</span><br>
<span class="lineno">35</span><span class="comment" id="3693901">//&nbsp;&nbsp;&nbsp;&nbsp;http://csrc.nist.gov/archive/aes/rijndael/Rijndael-ammended.pdf</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3693969">package</span>&nbsp;<span class="ident" id="3693977">aes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3693982">//&nbsp;Encrypt&nbsp;one&nbsp;block&nbsp;from&nbsp;src&nbsp;into&nbsp;dst,&nbsp;using&nbsp;the&nbsp;expanded&nbsp;key&nbsp;xk.</span><br>
<span class="lineno">40</span><span class="keyword" id="3694049">func</span>&nbsp;<span class="ident" id="3694054">encryptBlockGo</span><span class="op" id="3694068">(</span><span class="ident" id="3694069">xk</span>&nbsp;<span class="op" id="3694072">[</span><span class="op" id="3694073">]</span><span class="builtintype" id="3694074">uint32</span><span class="op" id="3694080">,</span>&nbsp;<span class="ident" id="3694082">dst</span><span class="op" id="3694085">,</span>&nbsp;<span class="ident" id="3694087">src</span>&nbsp;<span class="op" id="3694091">[</span><span class="op" id="3694092">]</span><span class="builtintype" id="3694093">byte</span><span class="op" id="3694097">)</span>&nbsp;<span class="op" id="3694099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3694102">var</span>&nbsp;<span class="ident" id="3694106">s0</span><span class="op" id="3694108">,</span>&nbsp;<span class="ident" id="3694110">s1</span><span class="op" id="3694112">,</span>&nbsp;<span class="ident" id="3694114">s2</span><span class="op" id="3694116">,</span>&nbsp;<span class="ident" id="3694118">s3</span><span class="op" id="3694120">,</span>&nbsp;<span class="ident" id="3694122">t0</span><span class="op" id="3694124">,</span>&nbsp;<span class="ident" id="3694126">t1</span><span class="op" id="3694128">,</span>&nbsp;<span class="ident" id="3694130">t2</span><span class="op" id="3694132">,</span>&nbsp;<span class="ident" id="3694134">t3</span>&nbsp;<span class="builtintype" id="3694137">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3694146">s0</span>&nbsp;<span class="op" id="3694149">=</span>&nbsp;<span class="builtintype" id="3694151">uint32</span><span class="op" id="3694157">(</span><span class="ident" id="3694158">src</span><span class="op" id="3694161">[</span><span class="num" id="3694162">0</span><span class="op" id="3694163">]</span><span class="op" id="3694164">)</span><span class="op" id="3694165">&lt;&lt;</span><span class="num" id="3694167">24</span>&nbsp;<span class="op" id="3694170">|</span>&nbsp;<span class="builtintype" id="3694172">uint32</span><span class="op" id="3694178">(</span><span class="ident" id="3694179">src</span><span class="op" id="3694182">[</span><span class="num" id="3694183">1</span><span class="op" id="3694184">]</span><span class="op" id="3694185">)</span><span class="op" id="3694186">&lt;&lt;</span><span class="num" id="3694188">16</span>&nbsp;<span class="op" id="3694191">|</span>&nbsp;<span class="builtintype" id="3694193">uint32</span><span class="op" id="3694199">(</span><span class="ident" id="3694200">src</span><span class="op" id="3694203">[</span><span class="num" id="3694204">2</span><span class="op" id="3694205">]</span><span class="op" id="3694206">)</span><span class="op" id="3694207">&lt;&lt;</span><span class="num" id="3694209">8</span>&nbsp;<span class="op" id="3694211">|</span>&nbsp;<span class="builtintype" id="3694213">uint32</span><span class="op" id="3694219">(</span><span class="ident" id="3694220">src</span><span class="op" id="3694223">[</span><span class="num" id="3694224">3</span><span class="op" id="3694225">]</span><span class="op" id="3694226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3694229">s1</span>&nbsp;<span class="op" id="3694232">=</span>&nbsp;<span class="builtintype" id="3694234">uint32</span><span class="op" id="3694240">(</span><span class="ident" id="3694241">src</span><span class="op" id="3694244">[</span><span class="num" id="3694245">4</span><span class="op" id="3694246">]</span><span class="op" id="3694247">)</span><span class="op" id="3694248">&lt;&lt;</span><span class="num" id="3694250">24</span>&nbsp;<span class="op" id="3694253">|</span>&nbsp;<span class="builtintype" id="3694255">uint32</span><span class="op" id="3694261">(</span><span class="ident" id="3694262">src</span><span class="op" id="3694265">[</span><span class="num" id="3694266">5</span><span class="op" id="3694267">]</span><span class="op" id="3694268">)</span><span class="op" id="3694269">&lt;&lt;</span><span class="num" id="3694271">16</span>&nbsp;<span class="op" id="3694274">|</span>&nbsp;<span class="builtintype" id="3694276">uint32</span><span class="op" id="3694282">(</span><span class="ident" id="3694283">src</span><span class="op" id="3694286">[</span><span class="num" id="3694287">6</span><span class="op" id="3694288">]</span><span class="op" id="3694289">)</span><span class="op" id="3694290">&lt;&lt;</span><span class="num" id="3694292">8</span>&nbsp;<span class="op" id="3694294">|</span>&nbsp;<span class="builtintype" id="3694296">uint32</span><span class="op" id="3694302">(</span><span class="ident" id="3694303">src</span><span class="op" id="3694306">[</span><span class="num" id="3694307">7</span><span class="op" id="3694308">]</span><span class="op" id="3694309">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3694312">s2</span>&nbsp;<span class="op" id="3694315">=</span>&nbsp;<span class="builtintype" id="3694317">uint32</span><span class="op" id="3694323">(</span><span class="ident" id="3694324">src</span><span class="op" id="3694327">[</span><span class="num" id="3694328">8</span><span class="op" id="3694329">]</span><span class="op" id="3694330">)</span><span class="op" id="3694331">&lt;&lt;</span><span class="num" id="3694333">24</span>&nbsp;<span class="op" id="3694336">|</span>&nbsp;<span class="builtintype" id="3694338">uint32</span><span class="op" id="3694344">(</span><span class="ident" id="3694345">src</span><span class="op" id="3694348">[</span><span class="num" id="3694349">9</span><span class="op" id="3694350">]</span><span class="op" id="3694351">)</span><span class="op" id="3694352">&lt;&lt;</span><span class="num" id="3694354">16</span>&nbsp;<span class="op" id="3694357">|</span>&nbsp;<span class="builtintype" id="3694359">uint32</span><span class="op" id="3694365">(</span><span class="ident" id="3694366">src</span><span class="op" id="3694369">[</span><span class="num" id="3694370">10</span><span class="op" id="3694372">]</span><span class="op" id="3694373">)</span><span class="op" id="3694374">&lt;&lt;</span><span class="num" id="3694376">8</span>&nbsp;<span class="op" id="3694378">|</span>&nbsp;<span class="builtintype" id="3694380">uint32</span><span class="op" id="3694386">(</span><span class="ident" id="3694387">src</span><span class="op" id="3694390">[</span><span class="num" id="3694391">11</span><span class="op" id="3694393">]</span><span class="op" id="3694394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3694397">s3</span>&nbsp;<span class="op" id="3694400">=</span>&nbsp;<span class="builtintype" id="3694402">uint32</span><span class="op" id="3694408">(</span><span class="ident" id="3694409">src</span><span class="op" id="3694412">[</span><span class="num" id="3694413">12</span><span class="op" id="3694415">]</span><span class="op" id="3694416">)</span><span class="op" id="3694417">&lt;&lt;</span><span class="num" id="3694419">24</span>&nbsp;<span class="op" id="3694422">|</span>&nbsp;<span class="builtintype" id="3694424">uint32</span><span class="op" id="3694430">(</span><span class="ident" id="3694431">src</span><span class="op" id="3694434">[</span><span class="num" id="3694435">13</span><span class="op" id="3694437">]</span><span class="op" id="3694438">)</span><span class="op" id="3694439">&lt;&lt;</span><span class="num" id="3694441">16</span>&nbsp;<span class="op" id="3694444">|</span>&nbsp;<span class="builtintype" id="3694446">uint32</span><span class="op" id="3694452">(</span><span class="ident" id="3694453">src</span><span class="op" id="3694456">[</span><span class="num" id="3694457">14</span><span class="op" id="3694459">]</span><span class="op" id="3694460">)</span><span class="op" id="3694461">&lt;&lt;</span><span class="num" id="3694463">8</span>&nbsp;<span class="op" id="3694465">|</span>&nbsp;<span class="builtintype" id="3694467">uint32</span><span class="op" id="3694473">(</span><span class="ident" id="3694474">src</span><span class="op" id="3694477">[</span><span class="num" id="3694478">15</span><span class="op" id="3694480">]</span><span class="op" id="3694481">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3694485">//&nbsp;First&nbsp;round&nbsp;just&nbsp;XORs&nbsp;input&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3694527">s0</span>&nbsp;<span class="op" id="3694530">^=</span>&nbsp;<span class="ident" id="3694533">xk</span><span class="op" id="3694535">[</span><span class="num" id="3694536">0</span><span class="op" id="3694537">]</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3694540">s1</span>&nbsp;<span class="op" id="3694543">^=</span>&nbsp;<span class="ident" id="3694546">xk</span><span class="op" id="3694548">[</span><span class="num" id="3694549">1</span><span class="op" id="3694550">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3694553">s2</span>&nbsp;<span class="op" id="3694556">^=</span>&nbsp;<span class="ident" id="3694559">xk</span><span class="op" id="3694561">[</span><span class="num" id="3694562">2</span><span class="op" id="3694563">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3694566">s3</span>&nbsp;<span class="op" id="3694569">^=</span>&nbsp;<span class="ident" id="3694572">xk</span><span class="op" id="3694574">[</span><span class="num" id="3694575">3</span><span class="op" id="3694576">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3694580">//&nbsp;Middle&nbsp;rounds&nbsp;shuffle&nbsp;using&nbsp;tables.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3694620">//&nbsp;Number&nbsp;of&nbsp;rounds&nbsp;is&nbsp;set&nbsp;by&nbsp;length&nbsp;of&nbsp;expanded&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3694675">nr</span>&nbsp;<span class="op" id="3694678">:=</span>&nbsp;<span class="builtinfunc" id="3694681">len</span><span class="op" id="3694684">(</span><span class="ident" id="3694685">xk</span><span class="op" id="3694687">)</span><span class="op" id="3694688">/</span><span class="num" id="3694689">4</span>&nbsp;<span class="op" id="3694691">-</span>&nbsp;<span class="num" id="3694693">2</span>&nbsp;<span class="comment" id="3694695">//&nbsp;-&nbsp;2:&nbsp;one&nbsp;above,&nbsp;one&nbsp;more&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3694730">k</span>&nbsp;<span class="op" id="3694732">:=</span>&nbsp;<span class="num" id="3694735">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3694738">for</span>&nbsp;<span class="ident" id="3694742">r</span>&nbsp;<span class="op" id="3694744">:=</span>&nbsp;<span class="num" id="3694747">0</span><span class="op" id="3694748">;</span>&nbsp;<span class="ident" id="3694750">r</span>&nbsp;<span class="op" id="3694752">&lt;</span>&nbsp;<span class="ident" id="3694754">nr</span><span class="op" id="3694756">;</span>&nbsp;<span class="ident" id="3694758">r</span><span class="op" id="3694759">++</span>&nbsp;<span class="op" id="3694762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3694766">t0</span>&nbsp;<span class="op" id="3694769">=</span>&nbsp;<span class="ident" id="3694771">xk</span><span class="op" id="3694773">[</span><span class="ident" id="3694774">k</span><span class="op" id="3694775">+</span><span class="num" id="3694776">0</span><span class="op" id="3694777">]</span>&nbsp;<span class="op" id="3694779">^</span>&nbsp;<span class="ident" id="3694781">te0</span><span class="op" id="3694784">[</span><span class="builtintype" id="3694785">uint8</span><span class="op" id="3694790">(</span><span class="ident" id="3694791">s0</span><span class="op" id="3694793">&gt;&gt;</span><span class="num" id="3694795">24</span><span class="op" id="3694797">)</span><span class="op" id="3694798">]</span>&nbsp;<span class="op" id="3694800">^</span>&nbsp;<span class="ident" id="3694802">te1</span><span class="op" id="3694805">[</span><span class="builtintype" id="3694806">uint8</span><span class="op" id="3694811">(</span><span class="ident" id="3694812">s1</span><span class="op" id="3694814">&gt;&gt;</span><span class="num" id="3694816">16</span><span class="op" id="3694818">)</span><span class="op" id="3694819">]</span>&nbsp;<span class="op" id="3694821">^</span>&nbsp;<span class="ident" id="3694823">te2</span><span class="op" id="3694826">[</span><span class="builtintype" id="3694827">uint8</span><span class="op" id="3694832">(</span><span class="ident" id="3694833">s2</span><span class="op" id="3694835">&gt;&gt;</span><span class="num" id="3694837">8</span><span class="op" id="3694838">)</span><span class="op" id="3694839">]</span>&nbsp;<span class="op" id="3694841">^</span>&nbsp;<span class="ident" id="3694843">te3</span><span class="op" id="3694846">[</span><span class="builtintype" id="3694847">uint8</span><span class="op" id="3694852">(</span><span class="ident" id="3694853">s3</span><span class="op" id="3694855">)</span><span class="op" id="3694856">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3694860">t1</span>&nbsp;<span class="op" id="3694863">=</span>&nbsp;<span class="ident" id="3694865">xk</span><span class="op" id="3694867">[</span><span class="ident" id="3694868">k</span><span class="op" id="3694869">+</span><span class="num" id="3694870">1</span><span class="op" id="3694871">]</span>&nbsp;<span class="op" id="3694873">^</span>&nbsp;<span class="ident" id="3694875">te0</span><span class="op" id="3694878">[</span><span class="builtintype" id="3694879">uint8</span><span class="op" id="3694884">(</span><span class="ident" id="3694885">s1</span><span class="op" id="3694887">&gt;&gt;</span><span class="num" id="3694889">24</span><span class="op" id="3694891">)</span><span class="op" id="3694892">]</span>&nbsp;<span class="op" id="3694894">^</span>&nbsp;<span class="ident" id="3694896">te1</span><span class="op" id="3694899">[</span><span class="builtintype" id="3694900">uint8</span><span class="op" id="3694905">(</span><span class="ident" id="3694906">s2</span><span class="op" id="3694908">&gt;&gt;</span><span class="num" id="3694910">16</span><span class="op" id="3694912">)</span><span class="op" id="3694913">]</span>&nbsp;<span class="op" id="3694915">^</span>&nbsp;<span class="ident" id="3694917">te2</span><span class="op" id="3694920">[</span><span class="builtintype" id="3694921">uint8</span><span class="op" id="3694926">(</span><span class="ident" id="3694927">s3</span><span class="op" id="3694929">&gt;&gt;</span><span class="num" id="3694931">8</span><span class="op" id="3694932">)</span><span class="op" id="3694933">]</span>&nbsp;<span class="op" id="3694935">^</span>&nbsp;<span class="ident" id="3694937">te3</span><span class="op" id="3694940">[</span><span class="builtintype" id="3694941">uint8</span><span class="op" id="3694946">(</span><span class="ident" id="3694947">s0</span><span class="op" id="3694949">)</span><span class="op" id="3694950">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3694954">t2</span>&nbsp;<span class="op" id="3694957">=</span>&nbsp;<span class="ident" id="3694959">xk</span><span class="op" id="3694961">[</span><span class="ident" id="3694962">k</span><span class="op" id="3694963">+</span><span class="num" id="3694964">2</span><span class="op" id="3694965">]</span>&nbsp;<span class="op" id="3694967">^</span>&nbsp;<span class="ident" id="3694969">te0</span><span class="op" id="3694972">[</span><span class="builtintype" id="3694973">uint8</span><span class="op" id="3694978">(</span><span class="ident" id="3694979">s2</span><span class="op" id="3694981">&gt;&gt;</span><span class="num" id="3694983">24</span><span class="op" id="3694985">)</span><span class="op" id="3694986">]</span>&nbsp;<span class="op" id="3694988">^</span>&nbsp;<span class="ident" id="3694990">te1</span><span class="op" id="3694993">[</span><span class="builtintype" id="3694994">uint8</span><span class="op" id="3694999">(</span><span class="ident" id="3695000">s3</span><span class="op" id="3695002">&gt;&gt;</span><span class="num" id="3695004">16</span><span class="op" id="3695006">)</span><span class="op" id="3695007">]</span>&nbsp;<span class="op" id="3695009">^</span>&nbsp;<span class="ident" id="3695011">te2</span><span class="op" id="3695014">[</span><span class="builtintype" id="3695015">uint8</span><span class="op" id="3695020">(</span><span class="ident" id="3695021">s0</span><span class="op" id="3695023">&gt;&gt;</span><span class="num" id="3695025">8</span><span class="op" id="3695026">)</span><span class="op" id="3695027">]</span>&nbsp;<span class="op" id="3695029">^</span>&nbsp;<span class="ident" id="3695031">te3</span><span class="op" id="3695034">[</span><span class="builtintype" id="3695035">uint8</span><span class="op" id="3695040">(</span><span class="ident" id="3695041">s1</span><span class="op" id="3695043">)</span><span class="op" id="3695044">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3695048">t3</span>&nbsp;<span class="op" id="3695051">=</span>&nbsp;<span class="ident" id="3695053">xk</span><span class="op" id="3695055">[</span><span class="ident" id="3695056">k</span><span class="op" id="3695057">+</span><span class="num" id="3695058">3</span><span class="op" id="3695059">]</span>&nbsp;<span class="op" id="3695061">^</span>&nbsp;<span class="ident" id="3695063">te0</span><span class="op" id="3695066">[</span><span class="builtintype" id="3695067">uint8</span><span class="op" id="3695072">(</span><span class="ident" id="3695073">s3</span><span class="op" id="3695075">&gt;&gt;</span><span class="num" id="3695077">24</span><span class="op" id="3695079">)</span><span class="op" id="3695080">]</span>&nbsp;<span class="op" id="3695082">^</span>&nbsp;<span class="ident" id="3695084">te1</span><span class="op" id="3695087">[</span><span class="builtintype" id="3695088">uint8</span><span class="op" id="3695093">(</span><span class="ident" id="3695094">s0</span><span class="op" id="3695096">&gt;&gt;</span><span class="num" id="3695098">16</span><span class="op" id="3695100">)</span><span class="op" id="3695101">]</span>&nbsp;<span class="op" id="3695103">^</span>&nbsp;<span class="ident" id="3695105">te2</span><span class="op" id="3695108">[</span><span class="builtintype" id="3695109">uint8</span><span class="op" id="3695114">(</span><span class="ident" id="3695115">s1</span><span class="op" id="3695117">&gt;&gt;</span><span class="num" id="3695119">8</span><span class="op" id="3695120">)</span><span class="op" id="3695121">]</span>&nbsp;<span class="op" id="3695123">^</span>&nbsp;<span class="ident" id="3695125">te3</span><span class="op" id="3695128">[</span><span class="builtintype" id="3695129">uint8</span><span class="op" id="3695134">(</span><span class="ident" id="3695135">s2</span><span class="op" id="3695137">)</span><span class="op" id="3695138">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3695142">k</span>&nbsp;<span class="op" id="3695144">+=</span>&nbsp;<span class="num" id="3695147">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3695151">s0</span><span class="op" id="3695153">,</span>&nbsp;<span class="ident" id="3695155">s1</span><span class="op" id="3695157">,</span>&nbsp;<span class="ident" id="3695159">s2</span><span class="op" id="3695161">,</span>&nbsp;<span class="ident" id="3695163">s3</span>&nbsp;<span class="op" id="3695166">=</span>&nbsp;<span class="ident" id="3695168">t0</span><span class="op" id="3695170">,</span>&nbsp;<span class="ident" id="3695172">t1</span><span class="op" id="3695174">,</span>&nbsp;<span class="ident" id="3695176">t2</span><span class="op" id="3695178">,</span>&nbsp;<span class="ident" id="3695180">t3</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3695184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3695188">//&nbsp;Last&nbsp;round&nbsp;uses&nbsp;s-box&nbsp;directly&nbsp;and&nbsp;XORs&nbsp;to&nbsp;produce&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3695251">s0</span>&nbsp;<span class="op" id="3695254">=</span>&nbsp;<span class="builtintype" id="3695256">uint32</span><span class="op" id="3695262">(</span><span class="ident" id="3695263">sbox0</span><span class="op" id="3695268">[</span><span class="ident" id="3695269">t0</span><span class="op" id="3695271">&gt;&gt;</span><span class="num" id="3695273">24</span><span class="op" id="3695275">]</span><span class="op" id="3695276">)</span><span class="op" id="3695277">&lt;&lt;</span><span class="num" id="3695279">24</span>&nbsp;<span class="op" id="3695282">|</span>&nbsp;<span class="builtintype" id="3695284">uint32</span><span class="op" id="3695290">(</span><span class="ident" id="3695291">sbox0</span><span class="op" id="3695296">[</span><span class="ident" id="3695297">t1</span><span class="op" id="3695299">&gt;&gt;</span><span class="num" id="3695301">16</span><span class="op" id="3695303">&amp;</span><span class="num" id="3695304">0xff</span><span class="op" id="3695308">]</span><span class="op" id="3695309">)</span><span class="op" id="3695310">&lt;&lt;</span><span class="num" id="3695312">16</span>&nbsp;<span class="op" id="3695315">|</span>&nbsp;<span class="builtintype" id="3695317">uint32</span><span class="op" id="3695323">(</span><span class="ident" id="3695324">sbox0</span><span class="op" id="3695329">[</span><span class="ident" id="3695330">t2</span><span class="op" id="3695332">&gt;&gt;</span><span class="num" id="3695334">8</span><span class="op" id="3695335">&amp;</span><span class="num" id="3695336">0xff</span><span class="op" id="3695340">]</span><span class="op" id="3695341">)</span><span class="op" id="3695342">&lt;&lt;</span><span class="num" id="3695344">8</span>&nbsp;<span class="op" id="3695346">|</span>&nbsp;<span class="builtintype" id="3695348">uint32</span><span class="op" id="3695354">(</span><span class="ident" id="3695355">sbox0</span><span class="op" id="3695360">[</span><span class="ident" id="3695361">t3</span><span class="op" id="3695363">&amp;</span><span class="num" id="3695364">0xff</span><span class="op" id="3695368">]</span><span class="op" id="3695369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3695372">s1</span>&nbsp;<span class="op" id="3695375">=</span>&nbsp;<span class="builtintype" id="3695377">uint32</span><span class="op" id="3695383">(</span><span class="ident" id="3695384">sbox0</span><span class="op" id="3695389">[</span><span class="ident" id="3695390">t1</span><span class="op" id="3695392">&gt;&gt;</span><span class="num" id="3695394">24</span><span class="op" id="3695396">]</span><span class="op" id="3695397">)</span><span class="op" id="3695398">&lt;&lt;</span><span class="num" id="3695400">24</span>&nbsp;<span class="op" id="3695403">|</span>&nbsp;<span class="builtintype" id="3695405">uint32</span><span class="op" id="3695411">(</span><span class="ident" id="3695412">sbox0</span><span class="op" id="3695417">[</span><span class="ident" id="3695418">t2</span><span class="op" id="3695420">&gt;&gt;</span><span class="num" id="3695422">16</span><span class="op" id="3695424">&amp;</span><span class="num" id="3695425">0xff</span><span class="op" id="3695429">]</span><span class="op" id="3695430">)</span><span class="op" id="3695431">&lt;&lt;</span><span class="num" id="3695433">16</span>&nbsp;<span class="op" id="3695436">|</span>&nbsp;<span class="builtintype" id="3695438">uint32</span><span class="op" id="3695444">(</span><span class="ident" id="3695445">sbox0</span><span class="op" id="3695450">[</span><span class="ident" id="3695451">t3</span><span class="op" id="3695453">&gt;&gt;</span><span class="num" id="3695455">8</span><span class="op" id="3695456">&amp;</span><span class="num" id="3695457">0xff</span><span class="op" id="3695461">]</span><span class="op" id="3695462">)</span><span class="op" id="3695463">&lt;&lt;</span><span class="num" id="3695465">8</span>&nbsp;<span class="op" id="3695467">|</span>&nbsp;<span class="builtintype" id="3695469">uint32</span><span class="op" id="3695475">(</span><span class="ident" id="3695476">sbox0</span><span class="op" id="3695481">[</span><span class="ident" id="3695482">t0</span><span class="op" id="3695484">&amp;</span><span class="num" id="3695485">0xff</span><span class="op" id="3695489">]</span><span class="op" id="3695490">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3695493">s2</span>&nbsp;<span class="op" id="3695496">=</span>&nbsp;<span class="builtintype" id="3695498">uint32</span><span class="op" id="3695504">(</span><span class="ident" id="3695505">sbox0</span><span class="op" id="3695510">[</span><span class="ident" id="3695511">t2</span><span class="op" id="3695513">&gt;&gt;</span><span class="num" id="3695515">24</span><span class="op" id="3695517">]</span><span class="op" id="3695518">)</span><span class="op" id="3695519">&lt;&lt;</span><span class="num" id="3695521">24</span>&nbsp;<span class="op" id="3695524">|</span>&nbsp;<span class="builtintype" id="3695526">uint32</span><span class="op" id="3695532">(</span><span class="ident" id="3695533">sbox0</span><span class="op" id="3695538">[</span><span class="ident" id="3695539">t3</span><span class="op" id="3695541">&gt;&gt;</span><span class="num" id="3695543">16</span><span class="op" id="3695545">&amp;</span><span class="num" id="3695546">0xff</span><span class="op" id="3695550">]</span><span class="op" id="3695551">)</span><span class="op" id="3695552">&lt;&lt;</span><span class="num" id="3695554">16</span>&nbsp;<span class="op" id="3695557">|</span>&nbsp;<span class="builtintype" id="3695559">uint32</span><span class="op" id="3695565">(</span><span class="ident" id="3695566">sbox0</span><span class="op" id="3695571">[</span><span class="ident" id="3695572">t0</span><span class="op" id="3695574">&gt;&gt;</span><span class="num" id="3695576">8</span><span class="op" id="3695577">&amp;</span><span class="num" id="3695578">0xff</span><span class="op" id="3695582">]</span><span class="op" id="3695583">)</span><span class="op" id="3695584">&lt;&lt;</span><span class="num" id="3695586">8</span>&nbsp;<span class="op" id="3695588">|</span>&nbsp;<span class="builtintype" id="3695590">uint32</span><span class="op" id="3695596">(</span><span class="ident" id="3695597">sbox0</span><span class="op" id="3695602">[</span><span class="ident" id="3695603">t1</span><span class="op" id="3695605">&amp;</span><span class="num" id="3695606">0xff</span><span class="op" id="3695610">]</span><span class="op" id="3695611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3695614">s3</span>&nbsp;<span class="op" id="3695617">=</span>&nbsp;<span class="builtintype" id="3695619">uint32</span><span class="op" id="3695625">(</span><span class="ident" id="3695626">sbox0</span><span class="op" id="3695631">[</span><span class="ident" id="3695632">t3</span><span class="op" id="3695634">&gt;&gt;</span><span class="num" id="3695636">24</span><span class="op" id="3695638">]</span><span class="op" id="3695639">)</span><span class="op" id="3695640">&lt;&lt;</span><span class="num" id="3695642">24</span>&nbsp;<span class="op" id="3695645">|</span>&nbsp;<span class="builtintype" id="3695647">uint32</span><span class="op" id="3695653">(</span><span class="ident" id="3695654">sbox0</span><span class="op" id="3695659">[</span><span class="ident" id="3695660">t0</span><span class="op" id="3695662">&gt;&gt;</span><span class="num" id="3695664">16</span><span class="op" id="3695666">&amp;</span><span class="num" id="3695667">0xff</span><span class="op" id="3695671">]</span><span class="op" id="3695672">)</span><span class="op" id="3695673">&lt;&lt;</span><span class="num" id="3695675">16</span>&nbsp;<span class="op" id="3695678">|</span>&nbsp;<span class="builtintype" id="3695680">uint32</span><span class="op" id="3695686">(</span><span class="ident" id="3695687">sbox0</span><span class="op" id="3695692">[</span><span class="ident" id="3695693">t1</span><span class="op" id="3695695">&gt;&gt;</span><span class="num" id="3695697">8</span><span class="op" id="3695698">&amp;</span><span class="num" id="3695699">0xff</span><span class="op" id="3695703">]</span><span class="op" id="3695704">)</span><span class="op" id="3695705">&lt;&lt;</span><span class="num" id="3695707">8</span>&nbsp;<span class="op" id="3695709">|</span>&nbsp;<span class="builtintype" id="3695711">uint32</span><span class="op" id="3695717">(</span><span class="ident" id="3695718">sbox0</span><span class="op" id="3695723">[</span><span class="ident" id="3695724">t2</span><span class="op" id="3695726">&amp;</span><span class="num" id="3695727">0xff</span><span class="op" id="3695731">]</span><span class="op" id="3695732">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3695736">s0</span>&nbsp;<span class="op" id="3695739">^=</span>&nbsp;<span class="ident" id="3695742">xk</span><span class="op" id="3695744">[</span><span class="ident" id="3695745">k</span><span class="op" id="3695746">+</span><span class="num" id="3695747">0</span><span class="op" id="3695748">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3695751">s1</span>&nbsp;<span class="op" id="3695754">^=</span>&nbsp;<span class="ident" id="3695757">xk</span><span class="op" id="3695759">[</span><span class="ident" id="3695760">k</span><span class="op" id="3695761">+</span><span class="num" id="3695762">1</span><span class="op" id="3695763">]</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3695766">s2</span>&nbsp;<span class="op" id="3695769">^=</span>&nbsp;<span class="ident" id="3695772">xk</span><span class="op" id="3695774">[</span><span class="ident" id="3695775">k</span><span class="op" id="3695776">+</span><span class="num" id="3695777">2</span><span class="op" id="3695778">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3695781">s3</span>&nbsp;<span class="op" id="3695784">^=</span>&nbsp;<span class="ident" id="3695787">xk</span><span class="op" id="3695789">[</span><span class="ident" id="3695790">k</span><span class="op" id="3695791">+</span><span class="num" id="3695792">3</span><span class="op" id="3695793">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3695797">dst</span><span class="op" id="3695800">[</span><span class="num" id="3695801">0</span><span class="op" id="3695802">]</span><span class="op" id="3695803">,</span>&nbsp;<span class="ident" id="3695805">dst</span><span class="op" id="3695808">[</span><span class="num" id="3695809">1</span><span class="op" id="3695810">]</span><span class="op" id="3695811">,</span>&nbsp;<span class="ident" id="3695813">dst</span><span class="op" id="3695816">[</span><span class="num" id="3695817">2</span><span class="op" id="3695818">]</span><span class="op" id="3695819">,</span>&nbsp;<span class="ident" id="3695821">dst</span><span class="op" id="3695824">[</span><span class="num" id="3695825">3</span><span class="op" id="3695826">]</span>&nbsp;<span class="op" id="3695828">=</span>&nbsp;<span class="builtintype" id="3695830">byte</span><span class="op" id="3695834">(</span><span class="ident" id="3695835">s0</span><span class="op" id="3695837">&gt;&gt;</span><span class="num" id="3695839">24</span><span class="op" id="3695841">)</span><span class="op" id="3695842">,</span>&nbsp;<span class="builtintype" id="3695844">byte</span><span class="op" id="3695848">(</span><span class="ident" id="3695849">s0</span><span class="op" id="3695851">&gt;&gt;</span><span class="num" id="3695853">16</span><span class="op" id="3695855">)</span><span class="op" id="3695856">,</span>&nbsp;<span class="builtintype" id="3695858">byte</span><span class="op" id="3695862">(</span><span class="ident" id="3695863">s0</span><span class="op" id="3695865">&gt;&gt;</span><span class="num" id="3695867">8</span><span class="op" id="3695868">)</span><span class="op" id="3695869">,</span>&nbsp;<span class="builtintype" id="3695871">byte</span><span class="op" id="3695875">(</span><span class="ident" id="3695876">s0</span><span class="op" id="3695878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3695881">dst</span><span class="op" id="3695884">[</span><span class="num" id="3695885">4</span><span class="op" id="3695886">]</span><span class="op" id="3695887">,</span>&nbsp;<span class="ident" id="3695889">dst</span><span class="op" id="3695892">[</span><span class="num" id="3695893">5</span><span class="op" id="3695894">]</span><span class="op" id="3695895">,</span>&nbsp;<span class="ident" id="3695897">dst</span><span class="op" id="3695900">[</span><span class="num" id="3695901">6</span><span class="op" id="3695902">]</span><span class="op" id="3695903">,</span>&nbsp;<span class="ident" id="3695905">dst</span><span class="op" id="3695908">[</span><span class="num" id="3695909">7</span><span class="op" id="3695910">]</span>&nbsp;<span class="op" id="3695912">=</span>&nbsp;<span class="builtintype" id="3695914">byte</span><span class="op" id="3695918">(</span><span class="ident" id="3695919">s1</span><span class="op" id="3695921">&gt;&gt;</span><span class="num" id="3695923">24</span><span class="op" id="3695925">)</span><span class="op" id="3695926">,</span>&nbsp;<span class="builtintype" id="3695928">byte</span><span class="op" id="3695932">(</span><span class="ident" id="3695933">s1</span><span class="op" id="3695935">&gt;&gt;</span><span class="num" id="3695937">16</span><span class="op" id="3695939">)</span><span class="op" id="3695940">,</span>&nbsp;<span class="builtintype" id="3695942">byte</span><span class="op" id="3695946">(</span><span class="ident" id="3695947">s1</span><span class="op" id="3695949">&gt;&gt;</span><span class="num" id="3695951">8</span><span class="op" id="3695952">)</span><span class="op" id="3695953">,</span>&nbsp;<span class="builtintype" id="3695955">byte</span><span class="op" id="3695959">(</span><span class="ident" id="3695960">s1</span><span class="op" id="3695962">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3695965">dst</span><span class="op" id="3695968">[</span><span class="num" id="3695969">8</span><span class="op" id="3695970">]</span><span class="op" id="3695971">,</span>&nbsp;<span class="ident" id="3695973">dst</span><span class="op" id="3695976">[</span><span class="num" id="3695977">9</span><span class="op" id="3695978">]</span><span class="op" id="3695979">,</span>&nbsp;<span class="ident" id="3695981">dst</span><span class="op" id="3695984">[</span><span class="num" id="3695985">10</span><span class="op" id="3695987">]</span><span class="op" id="3695988">,</span>&nbsp;<span class="ident" id="3695990">dst</span><span class="op" id="3695993">[</span><span class="num" id="3695994">11</span><span class="op" id="3695996">]</span>&nbsp;<span class="op" id="3695998">=</span>&nbsp;<span class="builtintype" id="3696000">byte</span><span class="op" id="3696004">(</span><span class="ident" id="3696005">s2</span><span class="op" id="3696007">&gt;&gt;</span><span class="num" id="3696009">24</span><span class="op" id="3696011">)</span><span class="op" id="3696012">,</span>&nbsp;<span class="builtintype" id="3696014">byte</span><span class="op" id="3696018">(</span><span class="ident" id="3696019">s2</span><span class="op" id="3696021">&gt;&gt;</span><span class="num" id="3696023">16</span><span class="op" id="3696025">)</span><span class="op" id="3696026">,</span>&nbsp;<span class="builtintype" id="3696028">byte</span><span class="op" id="3696032">(</span><span class="ident" id="3696033">s2</span><span class="op" id="3696035">&gt;&gt;</span><span class="num" id="3696037">8</span><span class="op" id="3696038">)</span><span class="op" id="3696039">,</span>&nbsp;<span class="builtintype" id="3696041">byte</span><span class="op" id="3696045">(</span><span class="ident" id="3696046">s2</span><span class="op" id="3696048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3696051">dst</span><span class="op" id="3696054">[</span><span class="num" id="3696055">12</span><span class="op" id="3696057">]</span><span class="op" id="3696058">,</span>&nbsp;<span class="ident" id="3696060">dst</span><span class="op" id="3696063">[</span><span class="num" id="3696064">13</span><span class="op" id="3696066">]</span><span class="op" id="3696067">,</span>&nbsp;<span class="ident" id="3696069">dst</span><span class="op" id="3696072">[</span><span class="num" id="3696073">14</span><span class="op" id="3696075">]</span><span class="op" id="3696076">,</span>&nbsp;<span class="ident" id="3696078">dst</span><span class="op" id="3696081">[</span><span class="num" id="3696082">15</span><span class="op" id="3696084">]</span>&nbsp;<span class="op" id="3696086">=</span>&nbsp;<span class="builtintype" id="3696088">byte</span><span class="op" id="3696092">(</span><span class="ident" id="3696093">s3</span><span class="op" id="3696095">&gt;&gt;</span><span class="num" id="3696097">24</span><span class="op" id="3696099">)</span><span class="op" id="3696100">,</span>&nbsp;<span class="builtintype" id="3696102">byte</span><span class="op" id="3696106">(</span><span class="ident" id="3696107">s3</span><span class="op" id="3696109">&gt;&gt;</span><span class="num" id="3696111">16</span><span class="op" id="3696113">)</span><span class="op" id="3696114">,</span>&nbsp;<span class="builtintype" id="3696116">byte</span><span class="op" id="3696120">(</span><span class="ident" id="3696121">s3</span><span class="op" id="3696123">&gt;&gt;</span><span class="num" id="3696125">8</span><span class="op" id="3696126">)</span><span class="op" id="3696127">,</span>&nbsp;<span class="builtintype" id="3696129">byte</span><span class="op" id="3696133">(</span><span class="ident" id="3696134">s3</span><span class="op" id="3696136">)</span><br>
<span class="lineno"></span><span class="op" id="3696138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3696141">//&nbsp;Decrypt&nbsp;one&nbsp;block&nbsp;from&nbsp;src&nbsp;into&nbsp;dst,&nbsp;using&nbsp;the&nbsp;expanded&nbsp;key&nbsp;xk.</span><br>
<span class="lineno">85</span><span class="keyword" id="3696208">func</span>&nbsp;<span class="ident" id="3696213">decryptBlockGo</span><span class="op" id="3696227">(</span><span class="ident" id="3696228">xk</span>&nbsp;<span class="op" id="3696231">[</span><span class="op" id="3696232">]</span><span class="builtintype" id="3696233">uint32</span><span class="op" id="3696239">,</span>&nbsp;<span class="ident" id="3696241">dst</span><span class="op" id="3696244">,</span>&nbsp;<span class="ident" id="3696246">src</span>&nbsp;<span class="op" id="3696250">[</span><span class="op" id="3696251">]</span><span class="builtintype" id="3696252">byte</span><span class="op" id="3696256">)</span>&nbsp;<span class="op" id="3696258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3696261">var</span>&nbsp;<span class="ident" id="3696265">s0</span><span class="op" id="3696267">,</span>&nbsp;<span class="ident" id="3696269">s1</span><span class="op" id="3696271">,</span>&nbsp;<span class="ident" id="3696273">s2</span><span class="op" id="3696275">,</span>&nbsp;<span class="ident" id="3696277">s3</span><span class="op" id="3696279">,</span>&nbsp;<span class="ident" id="3696281">t0</span><span class="op" id="3696283">,</span>&nbsp;<span class="ident" id="3696285">t1</span><span class="op" id="3696287">,</span>&nbsp;<span class="ident" id="3696289">t2</span><span class="op" id="3696291">,</span>&nbsp;<span class="ident" id="3696293">t3</span>&nbsp;<span class="builtintype" id="3696296">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3696305">s0</span>&nbsp;<span class="op" id="3696308">=</span>&nbsp;<span class="builtintype" id="3696310">uint32</span><span class="op" id="3696316">(</span><span class="ident" id="3696317">src</span><span class="op" id="3696320">[</span><span class="num" id="3696321">0</span><span class="op" id="3696322">]</span><span class="op" id="3696323">)</span><span class="op" id="3696324">&lt;&lt;</span><span class="num" id="3696326">24</span>&nbsp;<span class="op" id="3696329">|</span>&nbsp;<span class="builtintype" id="3696331">uint32</span><span class="op" id="3696337">(</span><span class="ident" id="3696338">src</span><span class="op" id="3696341">[</span><span class="num" id="3696342">1</span><span class="op" id="3696343">]</span><span class="op" id="3696344">)</span><span class="op" id="3696345">&lt;&lt;</span><span class="num" id="3696347">16</span>&nbsp;<span class="op" id="3696350">|</span>&nbsp;<span class="builtintype" id="3696352">uint32</span><span class="op" id="3696358">(</span><span class="ident" id="3696359">src</span><span class="op" id="3696362">[</span><span class="num" id="3696363">2</span><span class="op" id="3696364">]</span><span class="op" id="3696365">)</span><span class="op" id="3696366">&lt;&lt;</span><span class="num" id="3696368">8</span>&nbsp;<span class="op" id="3696370">|</span>&nbsp;<span class="builtintype" id="3696372">uint32</span><span class="op" id="3696378">(</span><span class="ident" id="3696379">src</span><span class="op" id="3696382">[</span><span class="num" id="3696383">3</span><span class="op" id="3696384">]</span><span class="op" id="3696385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3696388">s1</span>&nbsp;<span class="op" id="3696391">=</span>&nbsp;<span class="builtintype" id="3696393">uint32</span><span class="op" id="3696399">(</span><span class="ident" id="3696400">src</span><span class="op" id="3696403">[</span><span class="num" id="3696404">4</span><span class="op" id="3696405">]</span><span class="op" id="3696406">)</span><span class="op" id="3696407">&lt;&lt;</span><span class="num" id="3696409">24</span>&nbsp;<span class="op" id="3696412">|</span>&nbsp;<span class="builtintype" id="3696414">uint32</span><span class="op" id="3696420">(</span><span class="ident" id="3696421">src</span><span class="op" id="3696424">[</span><span class="num" id="3696425">5</span><span class="op" id="3696426">]</span><span class="op" id="3696427">)</span><span class="op" id="3696428">&lt;&lt;</span><span class="num" id="3696430">16</span>&nbsp;<span class="op" id="3696433">|</span>&nbsp;<span class="builtintype" id="3696435">uint32</span><span class="op" id="3696441">(</span><span class="ident" id="3696442">src</span><span class="op" id="3696445">[</span><span class="num" id="3696446">6</span><span class="op" id="3696447">]</span><span class="op" id="3696448">)</span><span class="op" id="3696449">&lt;&lt;</span><span class="num" id="3696451">8</span>&nbsp;<span class="op" id="3696453">|</span>&nbsp;<span class="builtintype" id="3696455">uint32</span><span class="op" id="3696461">(</span><span class="ident" id="3696462">src</span><span class="op" id="3696465">[</span><span class="num" id="3696466">7</span><span class="op" id="3696467">]</span><span class="op" id="3696468">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3696471">s2</span>&nbsp;<span class="op" id="3696474">=</span>&nbsp;<span class="builtintype" id="3696476">uint32</span><span class="op" id="3696482">(</span><span class="ident" id="3696483">src</span><span class="op" id="3696486">[</span><span class="num" id="3696487">8</span><span class="op" id="3696488">]</span><span class="op" id="3696489">)</span><span class="op" id="3696490">&lt;&lt;</span><span class="num" id="3696492">24</span>&nbsp;<span class="op" id="3696495">|</span>&nbsp;<span class="builtintype" id="3696497">uint32</span><span class="op" id="3696503">(</span><span class="ident" id="3696504">src</span><span class="op" id="3696507">[</span><span class="num" id="3696508">9</span><span class="op" id="3696509">]</span><span class="op" id="3696510">)</span><span class="op" id="3696511">&lt;&lt;</span><span class="num" id="3696513">16</span>&nbsp;<span class="op" id="3696516">|</span>&nbsp;<span class="builtintype" id="3696518">uint32</span><span class="op" id="3696524">(</span><span class="ident" id="3696525">src</span><span class="op" id="3696528">[</span><span class="num" id="3696529">10</span><span class="op" id="3696531">]</span><span class="op" id="3696532">)</span><span class="op" id="3696533">&lt;&lt;</span><span class="num" id="3696535">8</span>&nbsp;<span class="op" id="3696537">|</span>&nbsp;<span class="builtintype" id="3696539">uint32</span><span class="op" id="3696545">(</span><span class="ident" id="3696546">src</span><span class="op" id="3696549">[</span><span class="num" id="3696550">11</span><span class="op" id="3696552">]</span><span class="op" id="3696553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3696556">s3</span>&nbsp;<span class="op" id="3696559">=</span>&nbsp;<span class="builtintype" id="3696561">uint32</span><span class="op" id="3696567">(</span><span class="ident" id="3696568">src</span><span class="op" id="3696571">[</span><span class="num" id="3696572">12</span><span class="op" id="3696574">]</span><span class="op" id="3696575">)</span><span class="op" id="3696576">&lt;&lt;</span><span class="num" id="3696578">24</span>&nbsp;<span class="op" id="3696581">|</span>&nbsp;<span class="builtintype" id="3696583">uint32</span><span class="op" id="3696589">(</span><span class="ident" id="3696590">src</span><span class="op" id="3696593">[</span><span class="num" id="3696594">13</span><span class="op" id="3696596">]</span><span class="op" id="3696597">)</span><span class="op" id="3696598">&lt;&lt;</span><span class="num" id="3696600">16</span>&nbsp;<span class="op" id="3696603">|</span>&nbsp;<span class="builtintype" id="3696605">uint32</span><span class="op" id="3696611">(</span><span class="ident" id="3696612">src</span><span class="op" id="3696615">[</span><span class="num" id="3696616">14</span><span class="op" id="3696618">]</span><span class="op" id="3696619">)</span><span class="op" id="3696620">&lt;&lt;</span><span class="num" id="3696622">8</span>&nbsp;<span class="op" id="3696624">|</span>&nbsp;<span class="builtintype" id="3696626">uint32</span><span class="op" id="3696632">(</span><span class="ident" id="3696633">src</span><span class="op" id="3696636">[</span><span class="num" id="3696637">15</span><span class="op" id="3696639">]</span><span class="op" id="3696640">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3696644">//&nbsp;First&nbsp;round&nbsp;just&nbsp;XORs&nbsp;input&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3696686">s0</span>&nbsp;<span class="op" id="3696689">^=</span>&nbsp;<span class="ident" id="3696692">xk</span><span class="op" id="3696694">[</span><span class="num" id="3696695">0</span><span class="op" id="3696696">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3696699">s1</span>&nbsp;<span class="op" id="3696702">^=</span>&nbsp;<span class="ident" id="3696705">xk</span><span class="op" id="3696707">[</span><span class="num" id="3696708">1</span><span class="op" id="3696709">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3696712">s2</span>&nbsp;<span class="op" id="3696715">^=</span>&nbsp;<span class="ident" id="3696718">xk</span><span class="op" id="3696720">[</span><span class="num" id="3696721">2</span><span class="op" id="3696722">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3696725">s3</span>&nbsp;<span class="op" id="3696728">^=</span>&nbsp;<span class="ident" id="3696731">xk</span><span class="op" id="3696733">[</span><span class="num" id="3696734">3</span><span class="op" id="3696735">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3696739">//&nbsp;Middle&nbsp;rounds&nbsp;shuffle&nbsp;using&nbsp;tables.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3696779">//&nbsp;Number&nbsp;of&nbsp;rounds&nbsp;is&nbsp;set&nbsp;by&nbsp;length&nbsp;of&nbsp;expanded&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3696834">nr</span>&nbsp;<span class="op" id="3696837">:=</span>&nbsp;<span class="builtinfunc" id="3696840">len</span><span class="op" id="3696843">(</span><span class="ident" id="3696844">xk</span><span class="op" id="3696846">)</span><span class="op" id="3696847">/</span><span class="num" id="3696848">4</span>&nbsp;<span class="op" id="3696850">-</span>&nbsp;<span class="num" id="3696852">2</span>&nbsp;<span class="comment" id="3696854">//&nbsp;-&nbsp;2:&nbsp;one&nbsp;above,&nbsp;one&nbsp;more&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3696889">k</span>&nbsp;<span class="op" id="3696891">:=</span>&nbsp;<span class="num" id="3696894">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3696897">for</span>&nbsp;<span class="ident" id="3696901">r</span>&nbsp;<span class="op" id="3696903">:=</span>&nbsp;<span class="num" id="3696906">0</span><span class="op" id="3696907">;</span>&nbsp;<span class="ident" id="3696909">r</span>&nbsp;<span class="op" id="3696911">&lt;</span>&nbsp;<span class="ident" id="3696913">nr</span><span class="op" id="3696915">;</span>&nbsp;<span class="ident" id="3696917">r</span><span class="op" id="3696918">++</span>&nbsp;<span class="op" id="3696921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3696925">t0</span>&nbsp;<span class="op" id="3696928">=</span>&nbsp;<span class="ident" id="3696930">xk</span><span class="op" id="3696932">[</span><span class="ident" id="3696933">k</span><span class="op" id="3696934">+</span><span class="num" id="3696935">0</span><span class="op" id="3696936">]</span>&nbsp;<span class="op" id="3696938">^</span>&nbsp;<span class="ident" id="3696940">td0</span><span class="op" id="3696943">[</span><span class="builtintype" id="3696944">uint8</span><span class="op" id="3696949">(</span><span class="ident" id="3696950">s0</span><span class="op" id="3696952">&gt;&gt;</span><span class="num" id="3696954">24</span><span class="op" id="3696956">)</span><span class="op" id="3696957">]</span>&nbsp;<span class="op" id="3696959">^</span>&nbsp;<span class="ident" id="3696961">td1</span><span class="op" id="3696964">[</span><span class="builtintype" id="3696965">uint8</span><span class="op" id="3696970">(</span><span class="ident" id="3696971">s3</span><span class="op" id="3696973">&gt;&gt;</span><span class="num" id="3696975">16</span><span class="op" id="3696977">)</span><span class="op" id="3696978">]</span>&nbsp;<span class="op" id="3696980">^</span>&nbsp;<span class="ident" id="3696982">td2</span><span class="op" id="3696985">[</span><span class="builtintype" id="3696986">uint8</span><span class="op" id="3696991">(</span><span class="ident" id="3696992">s2</span><span class="op" id="3696994">&gt;&gt;</span><span class="num" id="3696996">8</span><span class="op" id="3696997">)</span><span class="op" id="3696998">]</span>&nbsp;<span class="op" id="3697000">^</span>&nbsp;<span class="ident" id="3697002">td3</span><span class="op" id="3697005">[</span><span class="builtintype" id="3697006">uint8</span><span class="op" id="3697011">(</span><span class="ident" id="3697012">s1</span><span class="op" id="3697014">)</span><span class="op" id="3697015">]</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3697019">t1</span>&nbsp;<span class="op" id="3697022">=</span>&nbsp;<span class="ident" id="3697024">xk</span><span class="op" id="3697026">[</span><span class="ident" id="3697027">k</span><span class="op" id="3697028">+</span><span class="num" id="3697029">1</span><span class="op" id="3697030">]</span>&nbsp;<span class="op" id="3697032">^</span>&nbsp;<span class="ident" id="3697034">td0</span><span class="op" id="3697037">[</span><span class="builtintype" id="3697038">uint8</span><span class="op" id="3697043">(</span><span class="ident" id="3697044">s1</span><span class="op" id="3697046">&gt;&gt;</span><span class="num" id="3697048">24</span><span class="op" id="3697050">)</span><span class="op" id="3697051">]</span>&nbsp;<span class="op" id="3697053">^</span>&nbsp;<span class="ident" id="3697055">td1</span><span class="op" id="3697058">[</span><span class="builtintype" id="3697059">uint8</span><span class="op" id="3697064">(</span><span class="ident" id="3697065">s0</span><span class="op" id="3697067">&gt;&gt;</span><span class="num" id="3697069">16</span><span class="op" id="3697071">)</span><span class="op" id="3697072">]</span>&nbsp;<span class="op" id="3697074">^</span>&nbsp;<span class="ident" id="3697076">td2</span><span class="op" id="3697079">[</span><span class="builtintype" id="3697080">uint8</span><span class="op" id="3697085">(</span><span class="ident" id="3697086">s3</span><span class="op" id="3697088">&gt;&gt;</span><span class="num" id="3697090">8</span><span class="op" id="3697091">)</span><span class="op" id="3697092">]</span>&nbsp;<span class="op" id="3697094">^</span>&nbsp;<span class="ident" id="3697096">td3</span><span class="op" id="3697099">[</span><span class="builtintype" id="3697100">uint8</span><span class="op" id="3697105">(</span><span class="ident" id="3697106">s2</span><span class="op" id="3697108">)</span><span class="op" id="3697109">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3697113">t2</span>&nbsp;<span class="op" id="3697116">=</span>&nbsp;<span class="ident" id="3697118">xk</span><span class="op" id="3697120">[</span><span class="ident" id="3697121">k</span><span class="op" id="3697122">+</span><span class="num" id="3697123">2</span><span class="op" id="3697124">]</span>&nbsp;<span class="op" id="3697126">^</span>&nbsp;<span class="ident" id="3697128">td0</span><span class="op" id="3697131">[</span><span class="builtintype" id="3697132">uint8</span><span class="op" id="3697137">(</span><span class="ident" id="3697138">s2</span><span class="op" id="3697140">&gt;&gt;</span><span class="num" id="3697142">24</span><span class="op" id="3697144">)</span><span class="op" id="3697145">]</span>&nbsp;<span class="op" id="3697147">^</span>&nbsp;<span class="ident" id="3697149">td1</span><span class="op" id="3697152">[</span><span class="builtintype" id="3697153">uint8</span><span class="op" id="3697158">(</span><span class="ident" id="3697159">s1</span><span class="op" id="3697161">&gt;&gt;</span><span class="num" id="3697163">16</span><span class="op" id="3697165">)</span><span class="op" id="3697166">]</span>&nbsp;<span class="op" id="3697168">^</span>&nbsp;<span class="ident" id="3697170">td2</span><span class="op" id="3697173">[</span><span class="builtintype" id="3697174">uint8</span><span class="op" id="3697179">(</span><span class="ident" id="3697180">s0</span><span class="op" id="3697182">&gt;&gt;</span><span class="num" id="3697184">8</span><span class="op" id="3697185">)</span><span class="op" id="3697186">]</span>&nbsp;<span class="op" id="3697188">^</span>&nbsp;<span class="ident" id="3697190">td3</span><span class="op" id="3697193">[</span><span class="builtintype" id="3697194">uint8</span><span class="op" id="3697199">(</span><span class="ident" id="3697200">s3</span><span class="op" id="3697202">)</span><span class="op" id="3697203">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3697207">t3</span>&nbsp;<span class="op" id="3697210">=</span>&nbsp;<span class="ident" id="3697212">xk</span><span class="op" id="3697214">[</span><span class="ident" id="3697215">k</span><span class="op" id="3697216">+</span><span class="num" id="3697217">3</span><span class="op" id="3697218">]</span>&nbsp;<span class="op" id="3697220">^</span>&nbsp;<span class="ident" id="3697222">td0</span><span class="op" id="3697225">[</span><span class="builtintype" id="3697226">uint8</span><span class="op" id="3697231">(</span><span class="ident" id="3697232">s3</span><span class="op" id="3697234">&gt;&gt;</span><span class="num" id="3697236">24</span><span class="op" id="3697238">)</span><span class="op" id="3697239">]</span>&nbsp;<span class="op" id="3697241">^</span>&nbsp;<span class="ident" id="3697243">td1</span><span class="op" id="3697246">[</span><span class="builtintype" id="3697247">uint8</span><span class="op" id="3697252">(</span><span class="ident" id="3697253">s2</span><span class="op" id="3697255">&gt;&gt;</span><span class="num" id="3697257">16</span><span class="op" id="3697259">)</span><span class="op" id="3697260">]</span>&nbsp;<span class="op" id="3697262">^</span>&nbsp;<span class="ident" id="3697264">td2</span><span class="op" id="3697267">[</span><span class="builtintype" id="3697268">uint8</span><span class="op" id="3697273">(</span><span class="ident" id="3697274">s1</span><span class="op" id="3697276">&gt;&gt;</span><span class="num" id="3697278">8</span><span class="op" id="3697279">)</span><span class="op" id="3697280">]</span>&nbsp;<span class="op" id="3697282">^</span>&nbsp;<span class="ident" id="3697284">td3</span><span class="op" id="3697287">[</span><span class="builtintype" id="3697288">uint8</span><span class="op" id="3697293">(</span><span class="ident" id="3697294">s0</span><span class="op" id="3697296">)</span><span class="op" id="3697297">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3697301">k</span>&nbsp;<span class="op" id="3697303">+=</span>&nbsp;<span class="num" id="3697306">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3697310">s0</span><span class="op" id="3697312">,</span>&nbsp;<span class="ident" id="3697314">s1</span><span class="op" id="3697316">,</span>&nbsp;<span class="ident" id="3697318">s2</span><span class="op" id="3697320">,</span>&nbsp;<span class="ident" id="3697322">s3</span>&nbsp;<span class="op" id="3697325">=</span>&nbsp;<span class="ident" id="3697327">t0</span><span class="op" id="3697329">,</span>&nbsp;<span class="ident" id="3697331">t1</span><span class="op" id="3697333">,</span>&nbsp;<span class="ident" id="3697335">t2</span><span class="op" id="3697337">,</span>&nbsp;<span class="ident" id="3697339">t3</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3697343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3697347">//&nbsp;Last&nbsp;round&nbsp;uses&nbsp;s-box&nbsp;directly&nbsp;and&nbsp;XORs&nbsp;to&nbsp;produce&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3697410">s0</span>&nbsp;<span class="op" id="3697413">=</span>&nbsp;<span class="builtintype" id="3697415">uint32</span><span class="op" id="3697421">(</span><span class="ident" id="3697422">sbox1</span><span class="op" id="3697427">[</span><span class="ident" id="3697428">t0</span><span class="op" id="3697430">&gt;&gt;</span><span class="num" id="3697432">24</span><span class="op" id="3697434">]</span><span class="op" id="3697435">)</span><span class="op" id="3697436">&lt;&lt;</span><span class="num" id="3697438">24</span>&nbsp;<span class="op" id="3697441">|</span>&nbsp;<span class="builtintype" id="3697443">uint32</span><span class="op" id="3697449">(</span><span class="ident" id="3697450">sbox1</span><span class="op" id="3697455">[</span><span class="ident" id="3697456">t3</span><span class="op" id="3697458">&gt;&gt;</span><span class="num" id="3697460">16</span><span class="op" id="3697462">&amp;</span><span class="num" id="3697463">0xff</span><span class="op" id="3697467">]</span><span class="op" id="3697468">)</span><span class="op" id="3697469">&lt;&lt;</span><span class="num" id="3697471">16</span>&nbsp;<span class="op" id="3697474">|</span>&nbsp;<span class="builtintype" id="3697476">uint32</span><span class="op" id="3697482">(</span><span class="ident" id="3697483">sbox1</span><span class="op" id="3697488">[</span><span class="ident" id="3697489">t2</span><span class="op" id="3697491">&gt;&gt;</span><span class="num" id="3697493">8</span><span class="op" id="3697494">&amp;</span><span class="num" id="3697495">0xff</span><span class="op" id="3697499">]</span><span class="op" id="3697500">)</span><span class="op" id="3697501">&lt;&lt;</span><span class="num" id="3697503">8</span>&nbsp;<span class="op" id="3697505">|</span>&nbsp;<span class="builtintype" id="3697507">uint32</span><span class="op" id="3697513">(</span><span class="ident" id="3697514">sbox1</span><span class="op" id="3697519">[</span><span class="ident" id="3697520">t1</span><span class="op" id="3697522">&amp;</span><span class="num" id="3697523">0xff</span><span class="op" id="3697527">]</span><span class="op" id="3697528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3697531">s1</span>&nbsp;<span class="op" id="3697534">=</span>&nbsp;<span class="builtintype" id="3697536">uint32</span><span class="op" id="3697542">(</span><span class="ident" id="3697543">sbox1</span><span class="op" id="3697548">[</span><span class="ident" id="3697549">t1</span><span class="op" id="3697551">&gt;&gt;</span><span class="num" id="3697553">24</span><span class="op" id="3697555">]</span><span class="op" id="3697556">)</span><span class="op" id="3697557">&lt;&lt;</span><span class="num" id="3697559">24</span>&nbsp;<span class="op" id="3697562">|</span>&nbsp;<span class="builtintype" id="3697564">uint32</span><span class="op" id="3697570">(</span><span class="ident" id="3697571">sbox1</span><span class="op" id="3697576">[</span><span class="ident" id="3697577">t0</span><span class="op" id="3697579">&gt;&gt;</span><span class="num" id="3697581">16</span><span class="op" id="3697583">&amp;</span><span class="num" id="3697584">0xff</span><span class="op" id="3697588">]</span><span class="op" id="3697589">)</span><span class="op" id="3697590">&lt;&lt;</span><span class="num" id="3697592">16</span>&nbsp;<span class="op" id="3697595">|</span>&nbsp;<span class="builtintype" id="3697597">uint32</span><span class="op" id="3697603">(</span><span class="ident" id="3697604">sbox1</span><span class="op" id="3697609">[</span><span class="ident" id="3697610">t3</span><span class="op" id="3697612">&gt;&gt;</span><span class="num" id="3697614">8</span><span class="op" id="3697615">&amp;</span><span class="num" id="3697616">0xff</span><span class="op" id="3697620">]</span><span class="op" id="3697621">)</span><span class="op" id="3697622">&lt;&lt;</span><span class="num" id="3697624">8</span>&nbsp;<span class="op" id="3697626">|</span>&nbsp;<span class="builtintype" id="3697628">uint32</span><span class="op" id="3697634">(</span><span class="ident" id="3697635">sbox1</span><span class="op" id="3697640">[</span><span class="ident" id="3697641">t2</span><span class="op" id="3697643">&amp;</span><span class="num" id="3697644">0xff</span><span class="op" id="3697648">]</span><span class="op" id="3697649">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3697652">s2</span>&nbsp;<span class="op" id="3697655">=</span>&nbsp;<span class="builtintype" id="3697657">uint32</span><span class="op" id="3697663">(</span><span class="ident" id="3697664">sbox1</span><span class="op" id="3697669">[</span><span class="ident" id="3697670">t2</span><span class="op" id="3697672">&gt;&gt;</span><span class="num" id="3697674">24</span><span class="op" id="3697676">]</span><span class="op" id="3697677">)</span><span class="op" id="3697678">&lt;&lt;</span><span class="num" id="3697680">24</span>&nbsp;<span class="op" id="3697683">|</span>&nbsp;<span class="builtintype" id="3697685">uint32</span><span class="op" id="3697691">(</span><span class="ident" id="3697692">sbox1</span><span class="op" id="3697697">[</span><span class="ident" id="3697698">t1</span><span class="op" id="3697700">&gt;&gt;</span><span class="num" id="3697702">16</span><span class="op" id="3697704">&amp;</span><span class="num" id="3697705">0xff</span><span class="op" id="3697709">]</span><span class="op" id="3697710">)</span><span class="op" id="3697711">&lt;&lt;</span><span class="num" id="3697713">16</span>&nbsp;<span class="op" id="3697716">|</span>&nbsp;<span class="builtintype" id="3697718">uint32</span><span class="op" id="3697724">(</span><span class="ident" id="3697725">sbox1</span><span class="op" id="3697730">[</span><span class="ident" id="3697731">t0</span><span class="op" id="3697733">&gt;&gt;</span><span class="num" id="3697735">8</span><span class="op" id="3697736">&amp;</span><span class="num" id="3697737">0xff</span><span class="op" id="3697741">]</span><span class="op" id="3697742">)</span><span class="op" id="3697743">&lt;&lt;</span><span class="num" id="3697745">8</span>&nbsp;<span class="op" id="3697747">|</span>&nbsp;<span class="builtintype" id="3697749">uint32</span><span class="op" id="3697755">(</span><span class="ident" id="3697756">sbox1</span><span class="op" id="3697761">[</span><span class="ident" id="3697762">t3</span><span class="op" id="3697764">&amp;</span><span class="num" id="3697765">0xff</span><span class="op" id="3697769">]</span><span class="op" id="3697770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3697773">s3</span>&nbsp;<span class="op" id="3697776">=</span>&nbsp;<span class="builtintype" id="3697778">uint32</span><span class="op" id="3697784">(</span><span class="ident" id="3697785">sbox1</span><span class="op" id="3697790">[</span><span class="ident" id="3697791">t3</span><span class="op" id="3697793">&gt;&gt;</span><span class="num" id="3697795">24</span><span class="op" id="3697797">]</span><span class="op" id="3697798">)</span><span class="op" id="3697799">&lt;&lt;</span><span class="num" id="3697801">24</span>&nbsp;<span class="op" id="3697804">|</span>&nbsp;<span class="builtintype" id="3697806">uint32</span><span class="op" id="3697812">(</span><span class="ident" id="3697813">sbox1</span><span class="op" id="3697818">[</span><span class="ident" id="3697819">t2</span><span class="op" id="3697821">&gt;&gt;</span><span class="num" id="3697823">16</span><span class="op" id="3697825">&amp;</span><span class="num" id="3697826">0xff</span><span class="op" id="3697830">]</span><span class="op" id="3697831">)</span><span class="op" id="3697832">&lt;&lt;</span><span class="num" id="3697834">16</span>&nbsp;<span class="op" id="3697837">|</span>&nbsp;<span class="builtintype" id="3697839">uint32</span><span class="op" id="3697845">(</span><span class="ident" id="3697846">sbox1</span><span class="op" id="3697851">[</span><span class="ident" id="3697852">t1</span><span class="op" id="3697854">&gt;&gt;</span><span class="num" id="3697856">8</span><span class="op" id="3697857">&amp;</span><span class="num" id="3697858">0xff</span><span class="op" id="3697862">]</span><span class="op" id="3697863">)</span><span class="op" id="3697864">&lt;&lt;</span><span class="num" id="3697866">8</span>&nbsp;<span class="op" id="3697868">|</span>&nbsp;<span class="builtintype" id="3697870">uint32</span><span class="op" id="3697876">(</span><span class="ident" id="3697877">sbox1</span><span class="op" id="3697882">[</span><span class="ident" id="3697883">t0</span><span class="op" id="3697885">&amp;</span><span class="num" id="3697886">0xff</span><span class="op" id="3697890">]</span><span class="op" id="3697891">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3697895">s0</span>&nbsp;<span class="op" id="3697898">^=</span>&nbsp;<span class="ident" id="3697901">xk</span><span class="op" id="3697903">[</span><span class="ident" id="3697904">k</span><span class="op" id="3697905">+</span><span class="num" id="3697906">0</span><span class="op" id="3697907">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3697910">s1</span>&nbsp;<span class="op" id="3697913">^=</span>&nbsp;<span class="ident" id="3697916">xk</span><span class="op" id="3697918">[</span><span class="ident" id="3697919">k</span><span class="op" id="3697920">+</span><span class="num" id="3697921">1</span><span class="op" id="3697922">]</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3697925">s2</span>&nbsp;<span class="op" id="3697928">^=</span>&nbsp;<span class="ident" id="3697931">xk</span><span class="op" id="3697933">[</span><span class="ident" id="3697934">k</span><span class="op" id="3697935">+</span><span class="num" id="3697936">2</span><span class="op" id="3697937">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3697940">s3</span>&nbsp;<span class="op" id="3697943">^=</span>&nbsp;<span class="ident" id="3697946">xk</span><span class="op" id="3697948">[</span><span class="ident" id="3697949">k</span><span class="op" id="3697950">+</span><span class="num" id="3697951">3</span><span class="op" id="3697952">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3697956">dst</span><span class="op" id="3697959">[</span><span class="num" id="3697960">0</span><span class="op" id="3697961">]</span><span class="op" id="3697962">,</span>&nbsp;<span class="ident" id="3697964">dst</span><span class="op" id="3697967">[</span><span class="num" id="3697968">1</span><span class="op" id="3697969">]</span><span class="op" id="3697970">,</span>&nbsp;<span class="ident" id="3697972">dst</span><span class="op" id="3697975">[</span><span class="num" id="3697976">2</span><span class="op" id="3697977">]</span><span class="op" id="3697978">,</span>&nbsp;<span class="ident" id="3697980">dst</span><span class="op" id="3697983">[</span><span class="num" id="3697984">3</span><span class="op" id="3697985">]</span>&nbsp;<span class="op" id="3697987">=</span>&nbsp;<span class="builtintype" id="3697989">byte</span><span class="op" id="3697993">(</span><span class="ident" id="3697994">s0</span><span class="op" id="3697996">&gt;&gt;</span><span class="num" id="3697998">24</span><span class="op" id="3698000">)</span><span class="op" id="3698001">,</span>&nbsp;<span class="builtintype" id="3698003">byte</span><span class="op" id="3698007">(</span><span class="ident" id="3698008">s0</span><span class="op" id="3698010">&gt;&gt;</span><span class="num" id="3698012">16</span><span class="op" id="3698014">)</span><span class="op" id="3698015">,</span>&nbsp;<span class="builtintype" id="3698017">byte</span><span class="op" id="3698021">(</span><span class="ident" id="3698022">s0</span><span class="op" id="3698024">&gt;&gt;</span><span class="num" id="3698026">8</span><span class="op" id="3698027">)</span><span class="op" id="3698028">,</span>&nbsp;<span class="builtintype" id="3698030">byte</span><span class="op" id="3698034">(</span><span class="ident" id="3698035">s0</span><span class="op" id="3698037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3698040">dst</span><span class="op" id="3698043">[</span><span class="num" id="3698044">4</span><span class="op" id="3698045">]</span><span class="op" id="3698046">,</span>&nbsp;<span class="ident" id="3698048">dst</span><span class="op" id="3698051">[</span><span class="num" id="3698052">5</span><span class="op" id="3698053">]</span><span class="op" id="3698054">,</span>&nbsp;<span class="ident" id="3698056">dst</span><span class="op" id="3698059">[</span><span class="num" id="3698060">6</span><span class="op" id="3698061">]</span><span class="op" id="3698062">,</span>&nbsp;<span class="ident" id="3698064">dst</span><span class="op" id="3698067">[</span><span class="num" id="3698068">7</span><span class="op" id="3698069">]</span>&nbsp;<span class="op" id="3698071">=</span>&nbsp;<span class="builtintype" id="3698073">byte</span><span class="op" id="3698077">(</span><span class="ident" id="3698078">s1</span><span class="op" id="3698080">&gt;&gt;</span><span class="num" id="3698082">24</span><span class="op" id="3698084">)</span><span class="op" id="3698085">,</span>&nbsp;<span class="builtintype" id="3698087">byte</span><span class="op" id="3698091">(</span><span class="ident" id="3698092">s1</span><span class="op" id="3698094">&gt;&gt;</span><span class="num" id="3698096">16</span><span class="op" id="3698098">)</span><span class="op" id="3698099">,</span>&nbsp;<span class="builtintype" id="3698101">byte</span><span class="op" id="3698105">(</span><span class="ident" id="3698106">s1</span><span class="op" id="3698108">&gt;&gt;</span><span class="num" id="3698110">8</span><span class="op" id="3698111">)</span><span class="op" id="3698112">,</span>&nbsp;<span class="builtintype" id="3698114">byte</span><span class="op" id="3698118">(</span><span class="ident" id="3698119">s1</span><span class="op" id="3698121">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3698124">dst</span><span class="op" id="3698127">[</span><span class="num" id="3698128">8</span><span class="op" id="3698129">]</span><span class="op" id="3698130">,</span>&nbsp;<span class="ident" id="3698132">dst</span><span class="op" id="3698135">[</span><span class="num" id="3698136">9</span><span class="op" id="3698137">]</span><span class="op" id="3698138">,</span>&nbsp;<span class="ident" id="3698140">dst</span><span class="op" id="3698143">[</span><span class="num" id="3698144">10</span><span class="op" id="3698146">]</span><span class="op" id="3698147">,</span>&nbsp;<span class="ident" id="3698149">dst</span><span class="op" id="3698152">[</span><span class="num" id="3698153">11</span><span class="op" id="3698155">]</span>&nbsp;<span class="op" id="3698157">=</span>&nbsp;<span class="builtintype" id="3698159">byte</span><span class="op" id="3698163">(</span><span class="ident" id="3698164">s2</span><span class="op" id="3698166">&gt;&gt;</span><span class="num" id="3698168">24</span><span class="op" id="3698170">)</span><span class="op" id="3698171">,</span>&nbsp;<span class="builtintype" id="3698173">byte</span><span class="op" id="3698177">(</span><span class="ident" id="3698178">s2</span><span class="op" id="3698180">&gt;&gt;</span><span class="num" id="3698182">16</span><span class="op" id="3698184">)</span><span class="op" id="3698185">,</span>&nbsp;<span class="builtintype" id="3698187">byte</span><span class="op" id="3698191">(</span><span class="ident" id="3698192">s2</span><span class="op" id="3698194">&gt;&gt;</span><span class="num" id="3698196">8</span><span class="op" id="3698197">)</span><span class="op" id="3698198">,</span>&nbsp;<span class="builtintype" id="3698200">byte</span><span class="op" id="3698204">(</span><span class="ident" id="3698205">s2</span><span class="op" id="3698207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3698210">dst</span><span class="op" id="3698213">[</span><span class="num" id="3698214">12</span><span class="op" id="3698216">]</span><span class="op" id="3698217">,</span>&nbsp;<span class="ident" id="3698219">dst</span><span class="op" id="3698222">[</span><span class="num" id="3698223">13</span><span class="op" id="3698225">]</span><span class="op" id="3698226">,</span>&nbsp;<span class="ident" id="3698228">dst</span><span class="op" id="3698231">[</span><span class="num" id="3698232">14</span><span class="op" id="3698234">]</span><span class="op" id="3698235">,</span>&nbsp;<span class="ident" id="3698237">dst</span><span class="op" id="3698240">[</span><span class="num" id="3698241">15</span><span class="op" id="3698243">]</span>&nbsp;<span class="op" id="3698245">=</span>&nbsp;<span class="builtintype" id="3698247">byte</span><span class="op" id="3698251">(</span><span class="ident" id="3698252">s3</span><span class="op" id="3698254">&gt;&gt;</span><span class="num" id="3698256">24</span><span class="op" id="3698258">)</span><span class="op" id="3698259">,</span>&nbsp;<span class="builtintype" id="3698261">byte</span><span class="op" id="3698265">(</span><span class="ident" id="3698266">s3</span><span class="op" id="3698268">&gt;&gt;</span><span class="num" id="3698270">16</span><span class="op" id="3698272">)</span><span class="op" id="3698273">,</span>&nbsp;<span class="builtintype" id="3698275">byte</span><span class="op" id="3698279">(</span><span class="ident" id="3698280">s3</span><span class="op" id="3698282">&gt;&gt;</span><span class="num" id="3698284">8</span><span class="op" id="3698285">)</span><span class="op" id="3698286">,</span>&nbsp;<span class="builtintype" id="3698288">byte</span><span class="op" id="3698292">(</span><span class="ident" id="3698293">s3</span><span class="op" id="3698295">)</span><br>
<span class="lineno"></span><span class="op" id="3698297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3698300">//&nbsp;Apply&nbsp;sbox0&nbsp;to&nbsp;each&nbsp;byte&nbsp;in&nbsp;w.</span><br>
<span class="lineno">130</span><span class="keyword" id="3698334">func</span>&nbsp;<span class="ident" id="3698339">subw</span><span class="op" id="3698343">(</span><span class="ident" id="3698344">w</span>&nbsp;<span class="builtintype" id="3698346">uint32</span><span class="op" id="3698352">)</span>&nbsp;<span class="builtintype" id="3698354">uint32</span>&nbsp;<span class="op" id="3698361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3698364">return</span>&nbsp;<span class="builtintype" id="3698371">uint32</span><span class="op" id="3698377">(</span><span class="ident" id="3698378">sbox0</span><span class="op" id="3698383">[</span><span class="ident" id="3698384">w</span><span class="op" id="3698385">&gt;&gt;</span><span class="num" id="3698387">24</span><span class="op" id="3698389">]</span><span class="op" id="3698390">)</span><span class="op" id="3698391">&lt;&lt;</span><span class="num" id="3698393">24</span>&nbsp;<span class="op" id="3698396">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3698400">uint32</span><span class="op" id="3698406">(</span><span class="ident" id="3698407">sbox0</span><span class="op" id="3698412">[</span><span class="ident" id="3698413">w</span><span class="op" id="3698414">&gt;&gt;</span><span class="num" id="3698416">16</span><span class="op" id="3698418">&amp;</span><span class="num" id="3698419">0xff</span><span class="op" id="3698423">]</span><span class="op" id="3698424">)</span><span class="op" id="3698425">&lt;&lt;</span><span class="num" id="3698427">16</span>&nbsp;<span class="op" id="3698430">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3698434">uint32</span><span class="op" id="3698440">(</span><span class="ident" id="3698441">sbox0</span><span class="op" id="3698446">[</span><span class="ident" id="3698447">w</span><span class="op" id="3698448">&gt;&gt;</span><span class="num" id="3698450">8</span><span class="op" id="3698451">&amp;</span><span class="num" id="3698452">0xff</span><span class="op" id="3698456">]</span><span class="op" id="3698457">)</span><span class="op" id="3698458">&lt;&lt;</span><span class="num" id="3698460">8</span>&nbsp;<span class="op" id="3698462">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3698466">uint32</span><span class="op" id="3698472">(</span><span class="ident" id="3698473">sbox0</span><span class="op" id="3698478">[</span><span class="ident" id="3698479">w</span><span class="op" id="3698480">&amp;</span><span class="num" id="3698481">0xff</span><span class="op" id="3698485">]</span><span class="op" id="3698486">)</span><br>
<span class="lineno">135</span><span class="op" id="3698488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3698491">//&nbsp;Rotate</span><br>
<span class="lineno"></span><span class="keyword" id="3698501">func</span>&nbsp;<span class="ident" id="3698506">rotw</span><span class="op" id="3698510">(</span><span class="ident" id="3698511">w</span>&nbsp;<span class="builtintype" id="3698513">uint32</span><span class="op" id="3698519">)</span>&nbsp;<span class="builtintype" id="3698521">uint32</span>&nbsp;<span class="op" id="3698528">{</span>&nbsp;<span class="keyword" id="3698530">return</span>&nbsp;<span class="ident" id="3698537">w</span><span class="op" id="3698538">&lt;&lt;</span><span class="num" id="3698540">8</span>&nbsp;<span class="op" id="3698542">|</span>&nbsp;<span class="ident" id="3698544">w</span><span class="op" id="3698545">&gt;&gt;</span><span class="num" id="3698547">24</span>&nbsp;<span class="op" id="3698550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="3698553">//&nbsp;Key&nbsp;expansion&nbsp;algorithm.&nbsp;&nbsp;See&nbsp;FIPS-197,&nbsp;Figure&nbsp;11.</span><br>
<span class="lineno"></span><span class="comment" id="3698607">//&nbsp;Their&nbsp;rcon[i]&nbsp;is&nbsp;our&nbsp;powx[i-1]&nbsp;&lt;&lt;&nbsp;24.</span><br>
<span class="lineno"></span><span class="keyword" id="3698648">func</span>&nbsp;<span class="ident" id="3698653">expandKeyGo</span><span class="op" id="3698664">(</span><span class="ident" id="3698665">key</span>&nbsp;<span class="op" id="3698669">[</span><span class="op" id="3698670">]</span><span class="builtintype" id="3698671">byte</span><span class="op" id="3698675">,</span>&nbsp;<span class="ident" id="3698677">enc</span><span class="op" id="3698680">,</span>&nbsp;<span class="ident" id="3698682">dec</span>&nbsp;<span class="op" id="3698686">[</span><span class="op" id="3698687">]</span><span class="builtintype" id="3698688">uint32</span><span class="op" id="3698694">)</span>&nbsp;<span class="op" id="3698696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3698699">//&nbsp;Encryption&nbsp;key&nbsp;setup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3698725">var</span>&nbsp;<span class="ident" id="3698729">i</span>&nbsp;<span class="builtintype" id="3698731">int</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3698736">nk</span>&nbsp;<span class="op" id="3698739">:=</span>&nbsp;<span class="builtinfunc" id="3698742">len</span><span class="op" id="3698745">(</span><span class="ident" id="3698746">key</span><span class="op" id="3698749">)</span>&nbsp;<span class="op" id="3698751">/</span>&nbsp;<span class="num" id="3698753">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3698756">for</span>&nbsp;<span class="ident" id="3698760">i</span>&nbsp;<span class="op" id="3698762">=</span>&nbsp;<span class="num" id="3698764">0</span><span class="op" id="3698765">;</span>&nbsp;<span class="ident" id="3698767">i</span>&nbsp;<span class="op" id="3698769">&lt;</span>&nbsp;<span class="ident" id="3698771">nk</span><span class="op" id="3698773">;</span>&nbsp;<span class="ident" id="3698775">i</span><span class="op" id="3698776">++</span>&nbsp;<span class="op" id="3698779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3698783">enc</span><span class="op" id="3698786">[</span><span class="ident" id="3698787">i</span><span class="op" id="3698788">]</span>&nbsp;<span class="op" id="3698790">=</span>&nbsp;<span class="builtintype" id="3698792">uint32</span><span class="op" id="3698798">(</span><span class="ident" id="3698799">key</span><span class="op" id="3698802">[</span><span class="num" id="3698803">4</span><span class="op" id="3698804">*</span><span class="ident" id="3698805">i</span><span class="op" id="3698806">]</span><span class="op" id="3698807">)</span><span class="op" id="3698808">&lt;&lt;</span><span class="num" id="3698810">24</span>&nbsp;<span class="op" id="3698813">|</span>&nbsp;<span class="builtintype" id="3698815">uint32</span><span class="op" id="3698821">(</span><span class="ident" id="3698822">key</span><span class="op" id="3698825">[</span><span class="num" id="3698826">4</span><span class="op" id="3698827">*</span><span class="ident" id="3698828">i</span><span class="op" id="3698829">+</span><span class="num" id="3698830">1</span><span class="op" id="3698831">]</span><span class="op" id="3698832">)</span><span class="op" id="3698833">&lt;&lt;</span><span class="num" id="3698835">16</span>&nbsp;<span class="op" id="3698838">|</span>&nbsp;<span class="builtintype" id="3698840">uint32</span><span class="op" id="3698846">(</span><span class="ident" id="3698847">key</span><span class="op" id="3698850">[</span><span class="num" id="3698851">4</span><span class="op" id="3698852">*</span><span class="ident" id="3698853">i</span><span class="op" id="3698854">+</span><span class="num" id="3698855">2</span><span class="op" id="3698856">]</span><span class="op" id="3698857">)</span><span class="op" id="3698858">&lt;&lt;</span><span class="num" id="3698860">8</span>&nbsp;<span class="op" id="3698862">|</span>&nbsp;<span class="builtintype" id="3698864">uint32</span><span class="op" id="3698870">(</span><span class="ident" id="3698871">key</span><span class="op" id="3698874">[</span><span class="num" id="3698875">4</span><span class="op" id="3698876">*</span><span class="ident" id="3698877">i</span><span class="op" id="3698878">+</span><span class="num" id="3698879">3</span><span class="op" id="3698880">]</span><span class="op" id="3698881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3698884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3698887">for</span>&nbsp;<span class="op" id="3698891">;</span>&nbsp;<span class="ident" id="3698893">i</span>&nbsp;<span class="op" id="3698895">&lt;</span>&nbsp;<span class="builtinfunc" id="3698897">len</span><span class="op" id="3698900">(</span><span class="ident" id="3698901">enc</span><span class="op" id="3698904">)</span><span class="op" id="3698905">;</span>&nbsp;<span class="ident" id="3698907">i</span><span class="op" id="3698908">++</span>&nbsp;<span class="op" id="3698911">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3698915">t</span>&nbsp;<span class="op" id="3698917">:=</span>&nbsp;<span class="ident" id="3698920">enc</span><span class="op" id="3698923">[</span><span class="ident" id="3698924">i</span><span class="op" id="3698925">-</span><span class="num" id="3698926">1</span><span class="op" id="3698927">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3698931">if</span>&nbsp;<span class="ident" id="3698934">i</span><span class="op" id="3698935">%</span><span class="ident" id="3698936">nk</span>&nbsp;<span class="op" id="3698939">==</span>&nbsp;<span class="num" id="3698942">0</span>&nbsp;<span class="op" id="3698944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3698949">t</span>&nbsp;<span class="op" id="3698951">=</span>&nbsp;<span class="ident" id="3698953">subw</span><span class="op" id="3698957">(</span><span class="ident" id="3698958">rotw</span><span class="op" id="3698962">(</span><span class="ident" id="3698963">t</span><span class="op" id="3698964">)</span><span class="op" id="3698965">)</span>&nbsp;<span class="op" id="3698967">^</span>&nbsp;<span class="op" id="3698969">(</span><span class="builtintype" id="3698970">uint32</span><span class="op" id="3698976">(</span><span class="ident" id="3698977">powx</span><span class="op" id="3698981">[</span><span class="ident" id="3698982">i</span><span class="op" id="3698983">/</span><span class="ident" id="3698984">nk</span><span class="op" id="3698986">-</span><span class="num" id="3698987">1</span><span class="op" id="3698988">]</span><span class="op" id="3698989">)</span>&nbsp;<span class="op" id="3698991">&lt;&lt;</span>&nbsp;<span class="num" id="3698994">24</span><span class="op" id="3698996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3699000">}</span>&nbsp;<span class="keyword" id="3699002">else</span>&nbsp;<span class="keyword" id="3699007">if</span>&nbsp;<span class="ident" id="3699010">nk</span>&nbsp;<span class="op" id="3699013">&gt;</span>&nbsp;<span class="num" id="3699015">6</span>&nbsp;<span class="op" id="3699017">&amp;&amp;</span>&nbsp;<span class="ident" id="3699020">i</span><span class="op" id="3699021">%</span><span class="ident" id="3699022">nk</span>&nbsp;<span class="op" id="3699025">==</span>&nbsp;<span class="num" id="3699028">4</span>&nbsp;<span class="op" id="3699030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3699035">t</span>&nbsp;<span class="op" id="3699037">=</span>&nbsp;<span class="ident" id="3699039">subw</span><span class="op" id="3699043">(</span><span class="ident" id="3699044">t</span><span class="op" id="3699045">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3699049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3699053">enc</span><span class="op" id="3699056">[</span><span class="ident" id="3699057">i</span><span class="op" id="3699058">]</span>&nbsp;<span class="op" id="3699060">=</span>&nbsp;<span class="ident" id="3699062">enc</span><span class="op" id="3699065">[</span><span class="ident" id="3699066">i</span><span class="op" id="3699067">-</span><span class="ident" id="3699068">nk</span><span class="op" id="3699070">]</span>&nbsp;<span class="op" id="3699072">^</span>&nbsp;<span class="ident" id="3699074">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3699077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3699081">//&nbsp;Derive&nbsp;decryption&nbsp;key&nbsp;from&nbsp;encryption&nbsp;key.</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3699128">//&nbsp;Reverse&nbsp;the&nbsp;4-word&nbsp;round&nbsp;key&nbsp;sets&nbsp;from&nbsp;enc&nbsp;to&nbsp;produce&nbsp;dec.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3699191">//&nbsp;All&nbsp;sets&nbsp;but&nbsp;the&nbsp;first&nbsp;and&nbsp;last&nbsp;get&nbsp;the&nbsp;MixColumn&nbsp;transform&nbsp;applied.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3699264">if</span>&nbsp;<span class="ident" id="3699267">dec</span>&nbsp;<span class="op" id="3699271">==</span>&nbsp;<span class="ident" id="3699274">nil</span>&nbsp;<span class="op" id="3699278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3699282">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3699290">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3699293">n</span>&nbsp;<span class="op" id="3699295">:=</span>&nbsp;<span class="builtinfunc" id="3699298">len</span><span class="op" id="3699301">(</span><span class="ident" id="3699302">enc</span><span class="op" id="3699305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3699308">for</span>&nbsp;<span class="ident" id="3699312">i</span>&nbsp;<span class="op" id="3699314">:=</span>&nbsp;<span class="num" id="3699317">0</span><span class="op" id="3699318">;</span>&nbsp;<span class="ident" id="3699320">i</span>&nbsp;<span class="op" id="3699322">&lt;</span>&nbsp;<span class="ident" id="3699324">n</span><span class="op" id="3699325">;</span>&nbsp;<span class="ident" id="3699327">i</span>&nbsp;<span class="op" id="3699329">+=</span>&nbsp;<span class="num" id="3699332">4</span>&nbsp;<span class="op" id="3699334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3699338">ei</span>&nbsp;<span class="op" id="3699341">:=</span>&nbsp;<span class="ident" id="3699344">n</span>&nbsp;<span class="op" id="3699346">-</span>&nbsp;<span class="ident" id="3699348">i</span>&nbsp;<span class="op" id="3699350">-</span>&nbsp;<span class="num" id="3699352">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3699356">for</span>&nbsp;<span class="ident" id="3699360">j</span>&nbsp;<span class="op" id="3699362">:=</span>&nbsp;<span class="num" id="3699365">0</span><span class="op" id="3699366">;</span>&nbsp;<span class="ident" id="3699368">j</span>&nbsp;<span class="op" id="3699370">&lt;</span>&nbsp;<span class="num" id="3699372">4</span><span class="op" id="3699373">;</span>&nbsp;<span class="ident" id="3699375">j</span><span class="op" id="3699376">++</span>&nbsp;<span class="op" id="3699379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3699384">x</span>&nbsp;<span class="op" id="3699386">:=</span>&nbsp;<span class="ident" id="3699389">enc</span><span class="op" id="3699392">[</span><span class="ident" id="3699393">ei</span><span class="op" id="3699395">+</span><span class="ident" id="3699396">j</span><span class="op" id="3699397">]</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3699402">if</span>&nbsp;<span class="ident" id="3699405">i</span>&nbsp;<span class="op" id="3699407">&gt;</span>&nbsp;<span class="num" id="3699409">0</span>&nbsp;<span class="op" id="3699411">&amp;&amp;</span>&nbsp;<span class="ident" id="3699414">i</span><span class="op" id="3699415">+</span><span class="num" id="3699416">4</span>&nbsp;<span class="op" id="3699418">&lt;</span>&nbsp;<span class="ident" id="3699420">n</span>&nbsp;<span class="op" id="3699422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3699428">x</span>&nbsp;<span class="op" id="3699430">=</span>&nbsp;<span class="ident" id="3699432">td0</span><span class="op" id="3699435">[</span><span class="ident" id="3699436">sbox0</span><span class="op" id="3699441">[</span><span class="ident" id="3699442">x</span><span class="op" id="3699443">&gt;&gt;</span><span class="num" id="3699445">24</span><span class="op" id="3699447">]</span><span class="op" id="3699448">]</span>&nbsp;<span class="op" id="3699450">^</span>&nbsp;<span class="ident" id="3699452">td1</span><span class="op" id="3699455">[</span><span class="ident" id="3699456">sbox0</span><span class="op" id="3699461">[</span><span class="ident" id="3699462">x</span><span class="op" id="3699463">&gt;&gt;</span><span class="num" id="3699465">16</span><span class="op" id="3699467">&amp;</span><span class="num" id="3699468">0xff</span><span class="op" id="3699472">]</span><span class="op" id="3699473">]</span>&nbsp;<span class="op" id="3699475">^</span>&nbsp;<span class="ident" id="3699477">td2</span><span class="op" id="3699480">[</span><span class="ident" id="3699481">sbox0</span><span class="op" id="3699486">[</span><span class="ident" id="3699487">x</span><span class="op" id="3699488">&gt;&gt;</span><span class="num" id="3699490">8</span><span class="op" id="3699491">&amp;</span><span class="num" id="3699492">0xff</span><span class="op" id="3699496">]</span><span class="op" id="3699497">]</span>&nbsp;<span class="op" id="3699499">^</span>&nbsp;<span class="ident" id="3699501">td3</span><span class="op" id="3699504">[</span><span class="ident" id="3699505">sbox0</span><span class="op" id="3699510">[</span><span class="ident" id="3699511">x</span><span class="op" id="3699512">&amp;</span><span class="num" id="3699513">0xff</span><span class="op" id="3699517">]</span><span class="op" id="3699518">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3699523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3699528">dec</span><span class="op" id="3699531">[</span><span class="ident" id="3699532">i</span><span class="op" id="3699533">+</span><span class="ident" id="3699534">j</span><span class="op" id="3699535">]</span>&nbsp;<span class="op" id="3699537">=</span>&nbsp;<span class="ident" id="3699539">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3699543">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3699546">}</span><br>
<span class="lineno"></span><span class="op" id="3699548">}</span>
</div>
</body>
</html>
