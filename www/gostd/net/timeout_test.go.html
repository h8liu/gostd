<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8343547">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8343602">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8343656">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8343707">package</span>&nbsp;<span class="ident" id="8343715">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8343720">import</span>&nbsp;<span class="op" id="8343727">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8343730">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8343737">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8343743">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8343756">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8343767">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8343778">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8343785">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="8343788">func</span>&nbsp;<span class="ident" id="8343793">isTimeout</span><span class="op" id="8343802">(</span><span class="ident" id="8343803">err</span>&nbsp;<span class="builtintype" id="8343807">error</span><span class="op" id="8343812">)</span>&nbsp;<span class="builtintype" id="8343814">bool</span>&nbsp;<span class="op" id="8343819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8343822">e</span><span class="op" id="8343823">,</span>&nbsp;<span class="ident" id="8343825">ok</span>&nbsp;<span class="op" id="8343828">:=</span>&nbsp;<span class="ident" id="8343831">err</span><span class="op" id="8343834">.</span><span class="op" id="8343835">(</span><span class="ident" id="8343836">Error</span><span class="op" id="8343841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343844">return</span>&nbsp;<span class="ident" id="8343851">ok</span>&nbsp;<span class="op" id="8343854">&amp;&amp;</span>&nbsp;<span class="ident" id="8343857">e</span><span class="op" id="8343858">.</span><span class="ident" id="8343859">Timeout</span><span class="op" id="8343866">(</span><span class="op" id="8343867">)</span><br>
<span class="lineno"></span><span class="op" id="8343869">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="8343872">type</span>&nbsp;<span class="ident" id="8343877">copyRes</span>&nbsp;<span class="keyword" id="8343885">struct</span>&nbsp;<span class="op" id="8343892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8343895">n</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8343899">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8343906">err</span>&nbsp;<span class="builtintype" id="8343910">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8343917">d</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8343921">time</span><span class="op" id="8343925">.</span><span class="ident" id="8343926">Duration</span><br>
<span class="lineno">25</span><span class="op" id="8343935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8343938">func</span>&nbsp;<span class="ident" id="8343943">TestAcceptTimeout</span><span class="op" id="8343960">(</span><span class="ident" id="8343961">t</span>&nbsp;<span class="op" id="8343963">*</span><span class="ident" id="8343964">testing</span><span class="op" id="8343971">.</span><span class="ident" id="8343972">T</span><span class="op" id="8343973">)</span>&nbsp;<span class="op" id="8343975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343978">switch</span>&nbsp;<span class="ident" id="8343985">runtime</span><span class="op" id="8343992">.</span><span class="ident" id="8343993">GOOS</span>&nbsp;<span class="op" id="8343998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344001">case</span>&nbsp;<span class="string" id="8344006">&#34;plan9&#34;</span><span class="op" id="8344013">:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344017">t</span><span class="op" id="8344018">.</span><span class="ident" id="8344019">Skipf</span><span class="op" id="8344024">(</span><span class="string" id="8344025">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8344046">,</span>&nbsp;<span class="ident" id="8344048">runtime</span><span class="op" id="8344055">.</span><span class="ident" id="8344056">GOOS</span><span class="op" id="8344060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8344063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344067">ln</span>&nbsp;<span class="op" id="8344070">:=</span>&nbsp;<span class="ident" id="8344073">newLocalListener</span><span class="op" id="8344089">(</span><span class="ident" id="8344090">t</span><span class="op" id="8344091">)</span><span class="op" id="8344092">.</span><span class="op" id="8344093">(</span><span class="op" id="8344094">*</span><span class="ident" id="8344095">TCPListener</span><span class="op" id="8344106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344109">defer</span>&nbsp;<span class="ident" id="8344115">ln</span><span class="op" id="8344117">.</span><span class="ident" id="8344118">Close</span><span class="op" id="8344123">(</span><span class="op" id="8344124">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344127">ln</span><span class="op" id="8344129">.</span><span class="ident" id="8344130">SetDeadline</span><span class="op" id="8344141">(</span><span class="ident" id="8344142">time</span><span class="op" id="8344146">.</span><span class="ident" id="8344147">Now</span><span class="op" id="8344150">(</span><span class="op" id="8344151">)</span><span class="op" id="8344152">.</span><span class="ident" id="8344153">Add</span><span class="op" id="8344156">(</span><span class="op" id="8344157">-</span><span class="num" id="8344158">1</span>&nbsp;<span class="op" id="8344160">*</span>&nbsp;<span class="ident" id="8344162">time</span><span class="op" id="8344166">.</span><span class="ident" id="8344167">Second</span><span class="op" id="8344173">)</span><span class="op" id="8344174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344177">if</span>&nbsp;<span class="ident" id="8344180">_</span><span class="op" id="8344181">,</span>&nbsp;<span class="ident" id="8344183">err</span>&nbsp;<span class="op" id="8344187">:=</span>&nbsp;<span class="ident" id="8344190">ln</span><span class="op" id="8344192">.</span><span class="ident" id="8344193">Accept</span><span class="op" id="8344199">(</span><span class="op" id="8344200">)</span><span class="op" id="8344201">;</span>&nbsp;<span class="op" id="8344203">!</span><span class="ident" id="8344204">isTimeout</span><span class="op" id="8344213">(</span><span class="ident" id="8344214">err</span><span class="op" id="8344217">)</span>&nbsp;<span class="op" id="8344219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344223">t</span><span class="op" id="8344224">.</span><span class="ident" id="8344225">Fatalf</span><span class="op" id="8344231">(</span><span class="string" id="8344232">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8344265">,</span>&nbsp;<span class="ident" id="8344267">errTimeout</span><span class="op" id="8344277">,</span>&nbsp;<span class="ident" id="8344279">err</span><span class="op" id="8344282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8344285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344288">if</span>&nbsp;<span class="ident" id="8344291">_</span><span class="op" id="8344292">,</span>&nbsp;<span class="ident" id="8344294">err</span>&nbsp;<span class="op" id="8344298">:=</span>&nbsp;<span class="ident" id="8344301">ln</span><span class="op" id="8344303">.</span><span class="ident" id="8344304">Accept</span><span class="op" id="8344310">(</span><span class="op" id="8344311">)</span><span class="op" id="8344312">;</span>&nbsp;<span class="op" id="8344314">!</span><span class="ident" id="8344315">isTimeout</span><span class="op" id="8344324">(</span><span class="ident" id="8344325">err</span><span class="op" id="8344328">)</span>&nbsp;<span class="op" id="8344330">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344334">t</span><span class="op" id="8344335">.</span><span class="ident" id="8344336">Fatalf</span><span class="op" id="8344342">(</span><span class="string" id="8344343">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8344376">,</span>&nbsp;<span class="ident" id="8344378">errTimeout</span><span class="op" id="8344388">,</span>&nbsp;<span class="ident" id="8344390">err</span><span class="op" id="8344393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8344396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344399">ln</span><span class="op" id="8344401">.</span><span class="ident" id="8344402">SetDeadline</span><span class="op" id="8344413">(</span><span class="ident" id="8344414">time</span><span class="op" id="8344418">.</span><span class="ident" id="8344419">Now</span><span class="op" id="8344422">(</span><span class="op" id="8344423">)</span><span class="op" id="8344424">.</span><span class="ident" id="8344425">Add</span><span class="op" id="8344428">(</span><span class="num" id="8344429">100</span>&nbsp;<span class="op" id="8344433">*</span>&nbsp;<span class="ident" id="8344435">time</span><span class="op" id="8344439">.</span><span class="ident" id="8344440">Millisecond</span><span class="op" id="8344451">)</span><span class="op" id="8344452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344455">if</span>&nbsp;<span class="ident" id="8344458">_</span><span class="op" id="8344459">,</span>&nbsp;<span class="ident" id="8344461">err</span>&nbsp;<span class="op" id="8344465">:=</span>&nbsp;<span class="ident" id="8344468">ln</span><span class="op" id="8344470">.</span><span class="ident" id="8344471">Accept</span><span class="op" id="8344477">(</span><span class="op" id="8344478">)</span><span class="op" id="8344479">;</span>&nbsp;<span class="op" id="8344481">!</span><span class="ident" id="8344482">isTimeout</span><span class="op" id="8344491">(</span><span class="ident" id="8344492">err</span><span class="op" id="8344495">)</span>&nbsp;<span class="op" id="8344497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344501">t</span><span class="op" id="8344502">.</span><span class="ident" id="8344503">Fatalf</span><span class="op" id="8344509">(</span><span class="string" id="8344510">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8344543">,</span>&nbsp;<span class="ident" id="8344545">errTimeout</span><span class="op" id="8344555">,</span>&nbsp;<span class="ident" id="8344557">err</span><span class="op" id="8344560">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8344563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344566">if</span>&nbsp;<span class="ident" id="8344569">_</span><span class="op" id="8344570">,</span>&nbsp;<span class="ident" id="8344572">err</span>&nbsp;<span class="op" id="8344576">:=</span>&nbsp;<span class="ident" id="8344579">ln</span><span class="op" id="8344581">.</span><span class="ident" id="8344582">Accept</span><span class="op" id="8344588">(</span><span class="op" id="8344589">)</span><span class="op" id="8344590">;</span>&nbsp;<span class="op" id="8344592">!</span><span class="ident" id="8344593">isTimeout</span><span class="op" id="8344602">(</span><span class="ident" id="8344603">err</span><span class="op" id="8344606">)</span>&nbsp;<span class="op" id="8344608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344612">t</span><span class="op" id="8344613">.</span><span class="ident" id="8344614">Fatalf</span><span class="op" id="8344620">(</span><span class="string" id="8344621">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8344654">,</span>&nbsp;<span class="ident" id="8344656">errTimeout</span><span class="op" id="8344666">,</span>&nbsp;<span class="ident" id="8344668">err</span><span class="op" id="8344671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8344674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344677">ln</span><span class="op" id="8344679">.</span><span class="ident" id="8344680">SetDeadline</span><span class="op" id="8344691">(</span><span class="ident" id="8344692">noDeadline</span><span class="op" id="8344702">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344705">errc</span>&nbsp;<span class="op" id="8344710">:=</span>&nbsp;<span class="builtinfunc" id="8344713">make</span><span class="op" id="8344717">(</span><span class="keyword" id="8344718">chan</span>&nbsp;<span class="builtintype" id="8344723">error</span><span class="op" id="8344728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344731">go</span>&nbsp;<span class="keyword" id="8344734">func</span><span class="op" id="8344738">(</span><span class="op" id="8344739">)</span>&nbsp;<span class="op" id="8344741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344745">_</span><span class="op" id="8344746">,</span>&nbsp;<span class="ident" id="8344748">err</span>&nbsp;<span class="op" id="8344752">:=</span>&nbsp;<span class="ident" id="8344755">ln</span><span class="op" id="8344757">.</span><span class="ident" id="8344758">Accept</span><span class="op" id="8344764">(</span><span class="op" id="8344765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344769">errc</span>&nbsp;<span class="op" id="8344774">&lt;-</span>&nbsp;<span class="ident" id="8344777">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8344782">}</span><span class="op" id="8344783">(</span><span class="op" id="8344784">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344787">time</span><span class="op" id="8344791">.</span><span class="ident" id="8344792">Sleep</span><span class="op" id="8344797">(</span><span class="num" id="8344798">100</span>&nbsp;<span class="op" id="8344802">*</span>&nbsp;<span class="ident" id="8344804">time</span><span class="op" id="8344808">.</span><span class="ident" id="8344809">Millisecond</span><span class="op" id="8344820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344823">select</span>&nbsp;<span class="op" id="8344830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344833">case</span>&nbsp;<span class="ident" id="8344838">err</span>&nbsp;<span class="op" id="8344842">:=</span>&nbsp;<span class="op" id="8344845">&lt;-</span><span class="ident" id="8344847">errc</span><span class="op" id="8344851">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344855">t</span><span class="op" id="8344856">.</span><span class="ident" id="8344857">Fatalf</span><span class="op" id="8344863">(</span><span class="string" id="8344864">&#34;Expected&nbsp;Accept()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="8344924">,</span>&nbsp;<span class="ident" id="8344926">err</span><span class="op" id="8344929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344932">default</span><span class="op" id="8344939">:</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8344942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344945">ln</span><span class="op" id="8344947">.</span><span class="ident" id="8344948">Close</span><span class="op" id="8344953">(</span><span class="op" id="8344954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344957">switch</span>&nbsp;<span class="ident" id="8344964">nerr</span>&nbsp;<span class="op" id="8344969">:=</span>&nbsp;<span class="op" id="8344972">&lt;-</span><span class="ident" id="8344974">errc</span><span class="op" id="8344978">;</span>&nbsp;<span class="ident" id="8344980">err</span>&nbsp;<span class="op" id="8344984">:=</span>&nbsp;<span class="ident" id="8344987">nerr</span><span class="op" id="8344991">.</span><span class="op" id="8344992">(</span><span class="keyword" id="8344993">type</span><span class="op" id="8344997">)</span>&nbsp;<span class="op" id="8344999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345002">case</span>&nbsp;<span class="op" id="8345007">*</span><span class="ident" id="8345008">OpError</span><span class="op" id="8345015">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345019">if</span>&nbsp;<span class="ident" id="8345022">err</span><span class="op" id="8345025">.</span><span class="ident" id="8345026">Err</span>&nbsp;<span class="op" id="8345030">!=</span>&nbsp;<span class="ident" id="8345033">errClosing</span>&nbsp;<span class="op" id="8345044">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345049">t</span><span class="op" id="8345050">.</span><span class="ident" id="8345051">Fatalf</span><span class="op" id="8345057">(</span><span class="string" id="8345058">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8345091">,</span>&nbsp;<span class="ident" id="8345093">errClosing</span><span class="op" id="8345103">,</span>&nbsp;<span class="ident" id="8345105">err</span><span class="op" id="8345108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8345112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345115">default</span><span class="op" id="8345122">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345126">if</span>&nbsp;<span class="ident" id="8345129">err</span>&nbsp;<span class="op" id="8345133">!=</span>&nbsp;<span class="ident" id="8345136">errClosing</span>&nbsp;<span class="op" id="8345147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345152">t</span><span class="op" id="8345153">.</span><span class="ident" id="8345154">Fatalf</span><span class="op" id="8345160">(</span><span class="string" id="8345161">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8345194">,</span>&nbsp;<span class="ident" id="8345196">errClosing</span><span class="op" id="8345206">,</span>&nbsp;<span class="ident" id="8345208">err</span><span class="op" id="8345211">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8345215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8345218">}</span><br>
<span class="lineno"></span><span class="op" id="8345220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8345223">func</span>&nbsp;<span class="ident" id="8345228">TestReadTimeout</span><span class="op" id="8345243">(</span><span class="ident" id="8345244">t</span>&nbsp;<span class="op" id="8345246">*</span><span class="ident" id="8345247">testing</span><span class="op" id="8345254">.</span><span class="ident" id="8345255">T</span><span class="op" id="8345256">)</span>&nbsp;<span class="op" id="8345258">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345261">switch</span>&nbsp;<span class="ident" id="8345268">runtime</span><span class="op" id="8345275">.</span><span class="ident" id="8345276">GOOS</span>&nbsp;<span class="op" id="8345281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345284">case</span>&nbsp;<span class="string" id="8345289">&#34;plan9&#34;</span><span class="op" id="8345296">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345300">t</span><span class="op" id="8345301">.</span><span class="ident" id="8345302">Skipf</span><span class="op" id="8345307">(</span><span class="string" id="8345308">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8345329">,</span>&nbsp;<span class="ident" id="8345331">runtime</span><span class="op" id="8345338">.</span><span class="ident" id="8345339">GOOS</span><span class="op" id="8345343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8345346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345350">ln</span>&nbsp;<span class="op" id="8345353">:=</span>&nbsp;<span class="ident" id="8345356">newLocalListener</span><span class="op" id="8345372">(</span><span class="ident" id="8345373">t</span><span class="op" id="8345374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345377">defer</span>&nbsp;<span class="ident" id="8345383">ln</span><span class="op" id="8345385">.</span><span class="ident" id="8345386">Close</span><span class="op" id="8345391">(</span><span class="op" id="8345392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345395">c</span><span class="op" id="8345396">,</span>&nbsp;<span class="ident" id="8345398">err</span>&nbsp;<span class="op" id="8345402">:=</span>&nbsp;<span class="ident" id="8345405">DialTCP</span><span class="op" id="8345412">(</span><span class="string" id="8345413">&#34;tcp&#34;</span><span class="op" id="8345418">,</span>&nbsp;<span class="ident" id="8345420">nil</span><span class="op" id="8345423">,</span>&nbsp;<span class="ident" id="8345425">ln</span><span class="op" id="8345427">.</span><span class="ident" id="8345428">Addr</span><span class="op" id="8345432">(</span><span class="op" id="8345433">)</span><span class="op" id="8345434">.</span><span class="op" id="8345435">(</span><span class="op" id="8345436">*</span><span class="ident" id="8345437">TCPAddr</span><span class="op" id="8345444">)</span><span class="op" id="8345445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345448">if</span>&nbsp;<span class="ident" id="8345451">err</span>&nbsp;<span class="op" id="8345455">!=</span>&nbsp;<span class="ident" id="8345458">nil</span>&nbsp;<span class="op" id="8345462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345466">t</span><span class="op" id="8345467">.</span><span class="ident" id="8345468">Fatalf</span><span class="op" id="8345474">(</span><span class="string" id="8345475">&#34;Connect:&nbsp;%v&#34;</span><span class="op" id="8345488">,</span>&nbsp;<span class="ident" id="8345490">err</span><span class="op" id="8345493">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8345496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345499">defer</span>&nbsp;<span class="ident" id="8345505">c</span><span class="op" id="8345506">.</span><span class="ident" id="8345507">Close</span><span class="op" id="8345512">(</span><span class="op" id="8345513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345516">c</span><span class="op" id="8345517">.</span><span class="ident" id="8345518">SetDeadline</span><span class="op" id="8345529">(</span><span class="ident" id="8345530">time</span><span class="op" id="8345534">.</span><span class="ident" id="8345535">Now</span><span class="op" id="8345538">(</span><span class="op" id="8345539">)</span><span class="op" id="8345540">.</span><span class="ident" id="8345541">Add</span><span class="op" id="8345544">(</span><span class="ident" id="8345545">time</span><span class="op" id="8345549">.</span><span class="ident" id="8345550">Hour</span><span class="op" id="8345554">)</span><span class="op" id="8345555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345558">c</span><span class="op" id="8345559">.</span><span class="ident" id="8345560">SetReadDeadline</span><span class="op" id="8345575">(</span><span class="ident" id="8345576">time</span><span class="op" id="8345580">.</span><span class="ident" id="8345581">Now</span><span class="op" id="8345584">(</span><span class="op" id="8345585">)</span><span class="op" id="8345586">.</span><span class="ident" id="8345587">Add</span><span class="op" id="8345590">(</span><span class="op" id="8345591">-</span><span class="num" id="8345592">1</span>&nbsp;<span class="op" id="8345594">*</span>&nbsp;<span class="ident" id="8345596">time</span><span class="op" id="8345600">.</span><span class="ident" id="8345601">Second</span><span class="op" id="8345607">)</span><span class="op" id="8345608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345611">buf</span>&nbsp;<span class="op" id="8345615">:=</span>&nbsp;<span class="builtinfunc" id="8345618">make</span><span class="op" id="8345622">(</span><span class="op" id="8345623">[</span><span class="op" id="8345624">]</span><span class="builtintype" id="8345625">byte</span><span class="op" id="8345629">,</span>&nbsp;<span class="num" id="8345631">1</span><span class="op" id="8345632">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345635">if</span>&nbsp;<span class="ident" id="8345638">_</span><span class="op" id="8345639">,</span>&nbsp;<span class="ident" id="8345641">err</span>&nbsp;<span class="op" id="8345645">=</span>&nbsp;<span class="ident" id="8345647">c</span><span class="op" id="8345648">.</span><span class="ident" id="8345649">Read</span><span class="op" id="8345653">(</span><span class="ident" id="8345654">buf</span><span class="op" id="8345657">)</span><span class="op" id="8345658">;</span>&nbsp;<span class="op" id="8345660">!</span><span class="ident" id="8345661">isTimeout</span><span class="op" id="8345670">(</span><span class="ident" id="8345671">err</span><span class="op" id="8345674">)</span>&nbsp;<span class="op" id="8345676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345680">t</span><span class="op" id="8345681">.</span><span class="ident" id="8345682">Fatalf</span><span class="op" id="8345688">(</span><span class="string" id="8345689">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8345720">,</span>&nbsp;<span class="ident" id="8345722">errTimeout</span><span class="op" id="8345732">,</span>&nbsp;<span class="ident" id="8345734">err</span><span class="op" id="8345737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8345740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345743">if</span>&nbsp;<span class="ident" id="8345746">_</span><span class="op" id="8345747">,</span>&nbsp;<span class="ident" id="8345749">err</span>&nbsp;<span class="op" id="8345753">=</span>&nbsp;<span class="ident" id="8345755">c</span><span class="op" id="8345756">.</span><span class="ident" id="8345757">Read</span><span class="op" id="8345761">(</span><span class="ident" id="8345762">buf</span><span class="op" id="8345765">)</span><span class="op" id="8345766">;</span>&nbsp;<span class="op" id="8345768">!</span><span class="ident" id="8345769">isTimeout</span><span class="op" id="8345778">(</span><span class="ident" id="8345779">err</span><span class="op" id="8345782">)</span>&nbsp;<span class="op" id="8345784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345788">t</span><span class="op" id="8345789">.</span><span class="ident" id="8345790">Fatalf</span><span class="op" id="8345796">(</span><span class="string" id="8345797">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8345828">,</span>&nbsp;<span class="ident" id="8345830">errTimeout</span><span class="op" id="8345840">,</span>&nbsp;<span class="ident" id="8345842">err</span><span class="op" id="8345845">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8345848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345851">c</span><span class="op" id="8345852">.</span><span class="ident" id="8345853">SetDeadline</span><span class="op" id="8345864">(</span><span class="ident" id="8345865">time</span><span class="op" id="8345869">.</span><span class="ident" id="8345870">Now</span><span class="op" id="8345873">(</span><span class="op" id="8345874">)</span><span class="op" id="8345875">.</span><span class="ident" id="8345876">Add</span><span class="op" id="8345879">(</span><span class="num" id="8345880">100</span>&nbsp;<span class="op" id="8345884">*</span>&nbsp;<span class="ident" id="8345886">time</span><span class="op" id="8345890">.</span><span class="ident" id="8345891">Millisecond</span><span class="op" id="8345902">)</span><span class="op" id="8345903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345906">if</span>&nbsp;<span class="ident" id="8345909">_</span><span class="op" id="8345910">,</span>&nbsp;<span class="ident" id="8345912">err</span>&nbsp;<span class="op" id="8345916">=</span>&nbsp;<span class="ident" id="8345918">c</span><span class="op" id="8345919">.</span><span class="ident" id="8345920">Read</span><span class="op" id="8345924">(</span><span class="ident" id="8345925">buf</span><span class="op" id="8345928">)</span><span class="op" id="8345929">;</span>&nbsp;<span class="op" id="8345931">!</span><span class="ident" id="8345932">isTimeout</span><span class="op" id="8345941">(</span><span class="ident" id="8345942">err</span><span class="op" id="8345945">)</span>&nbsp;<span class="op" id="8345947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345951">t</span><span class="op" id="8345952">.</span><span class="ident" id="8345953">Fatalf</span><span class="op" id="8345959">(</span><span class="string" id="8345960">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8345991">,</span>&nbsp;<span class="ident" id="8345993">errTimeout</span><span class="op" id="8346003">,</span>&nbsp;<span class="ident" id="8346005">err</span><span class="op" id="8346008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8346011">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346014">if</span>&nbsp;<span class="ident" id="8346017">_</span><span class="op" id="8346018">,</span>&nbsp;<span class="ident" id="8346020">err</span>&nbsp;<span class="op" id="8346024">=</span>&nbsp;<span class="ident" id="8346026">c</span><span class="op" id="8346027">.</span><span class="ident" id="8346028">Read</span><span class="op" id="8346032">(</span><span class="ident" id="8346033">buf</span><span class="op" id="8346036">)</span><span class="op" id="8346037">;</span>&nbsp;<span class="op" id="8346039">!</span><span class="ident" id="8346040">isTimeout</span><span class="op" id="8346049">(</span><span class="ident" id="8346050">err</span><span class="op" id="8346053">)</span>&nbsp;<span class="op" id="8346055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346059">t</span><span class="op" id="8346060">.</span><span class="ident" id="8346061">Fatalf</span><span class="op" id="8346067">(</span><span class="string" id="8346068">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8346099">,</span>&nbsp;<span class="ident" id="8346101">errTimeout</span><span class="op" id="8346111">,</span>&nbsp;<span class="ident" id="8346113">err</span><span class="op" id="8346116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8346119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346122">c</span><span class="op" id="8346123">.</span><span class="ident" id="8346124">SetReadDeadline</span><span class="op" id="8346139">(</span><span class="ident" id="8346140">noDeadline</span><span class="op" id="8346150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346153">c</span><span class="op" id="8346154">.</span><span class="ident" id="8346155">SetWriteDeadline</span><span class="op" id="8346171">(</span><span class="ident" id="8346172">time</span><span class="op" id="8346176">.</span><span class="ident" id="8346177">Now</span><span class="op" id="8346180">(</span><span class="op" id="8346181">)</span><span class="op" id="8346182">.</span><span class="ident" id="8346183">Add</span><span class="op" id="8346186">(</span><span class="op" id="8346187">-</span><span class="num" id="8346188">1</span>&nbsp;<span class="op" id="8346190">*</span>&nbsp;<span class="ident" id="8346192">time</span><span class="op" id="8346196">.</span><span class="ident" id="8346197">Second</span><span class="op" id="8346203">)</span><span class="op" id="8346204">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346207">errc</span>&nbsp;<span class="op" id="8346212">:=</span>&nbsp;<span class="builtinfunc" id="8346215">make</span><span class="op" id="8346219">(</span><span class="keyword" id="8346220">chan</span>&nbsp;<span class="builtintype" id="8346225">error</span><span class="op" id="8346230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346233">go</span>&nbsp;<span class="keyword" id="8346236">func</span><span class="op" id="8346240">(</span><span class="op" id="8346241">)</span>&nbsp;<span class="op" id="8346243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346247">_</span><span class="op" id="8346248">,</span>&nbsp;<span class="ident" id="8346250">err</span>&nbsp;<span class="op" id="8346254">:=</span>&nbsp;<span class="ident" id="8346257">c</span><span class="op" id="8346258">.</span><span class="ident" id="8346259">Read</span><span class="op" id="8346263">(</span><span class="ident" id="8346264">buf</span><span class="op" id="8346267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346271">errc</span>&nbsp;<span class="op" id="8346276">&lt;-</span>&nbsp;<span class="ident" id="8346279">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8346284">}</span><span class="op" id="8346285">(</span><span class="op" id="8346286">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346289">time</span><span class="op" id="8346293">.</span><span class="ident" id="8346294">Sleep</span><span class="op" id="8346299">(</span><span class="num" id="8346300">100</span>&nbsp;<span class="op" id="8346304">*</span>&nbsp;<span class="ident" id="8346306">time</span><span class="op" id="8346310">.</span><span class="ident" id="8346311">Millisecond</span><span class="op" id="8346322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346325">select</span>&nbsp;<span class="op" id="8346332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346335">case</span>&nbsp;<span class="ident" id="8346340">err</span>&nbsp;<span class="op" id="8346344">:=</span>&nbsp;<span class="op" id="8346347">&lt;-</span><span class="ident" id="8346349">errc</span><span class="op" id="8346353">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346357">t</span><span class="op" id="8346358">.</span><span class="ident" id="8346359">Fatalf</span><span class="op" id="8346365">(</span><span class="string" id="8346366">&#34;Expected&nbsp;Read()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="8346424">,</span>&nbsp;<span class="ident" id="8346426">err</span><span class="op" id="8346429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346432">default</span><span class="op" id="8346439">:</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8346442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346445">c</span><span class="op" id="8346446">.</span><span class="ident" id="8346447">Close</span><span class="op" id="8346452">(</span><span class="op" id="8346453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346456">switch</span>&nbsp;<span class="ident" id="8346463">nerr</span>&nbsp;<span class="op" id="8346468">:=</span>&nbsp;<span class="op" id="8346471">&lt;-</span><span class="ident" id="8346473">errc</span><span class="op" id="8346477">;</span>&nbsp;<span class="ident" id="8346479">err</span>&nbsp;<span class="op" id="8346483">:=</span>&nbsp;<span class="ident" id="8346486">nerr</span><span class="op" id="8346490">.</span><span class="op" id="8346491">(</span><span class="keyword" id="8346492">type</span><span class="op" id="8346496">)</span>&nbsp;<span class="op" id="8346498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346501">case</span>&nbsp;<span class="op" id="8346506">*</span><span class="ident" id="8346507">OpError</span><span class="op" id="8346514">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346518">if</span>&nbsp;<span class="ident" id="8346521">err</span><span class="op" id="8346524">.</span><span class="ident" id="8346525">Err</span>&nbsp;<span class="op" id="8346529">!=</span>&nbsp;<span class="ident" id="8346532">errClosing</span>&nbsp;<span class="op" id="8346543">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346548">t</span><span class="op" id="8346549">.</span><span class="ident" id="8346550">Fatalf</span><span class="op" id="8346556">(</span><span class="string" id="8346557">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8346588">,</span>&nbsp;<span class="ident" id="8346590">errClosing</span><span class="op" id="8346600">,</span>&nbsp;<span class="ident" id="8346602">err</span><span class="op" id="8346605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8346609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346612">default</span><span class="op" id="8346619">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346623">if</span>&nbsp;<span class="ident" id="8346626">err</span>&nbsp;<span class="op" id="8346630">==</span>&nbsp;<span class="ident" id="8346633">io</span><span class="op" id="8346635">.</span><span class="ident" id="8346636">EOF</span>&nbsp;<span class="op" id="8346640">&amp;&amp;</span>&nbsp;<span class="ident" id="8346643">runtime</span><span class="op" id="8346650">.</span><span class="ident" id="8346651">GOOS</span>&nbsp;<span class="op" id="8346656">==</span>&nbsp;<span class="string" id="8346659">&#34;nacl&#34;</span>&nbsp;<span class="op" id="8346666">{</span>&nbsp;<span class="comment" id="8346668">//&nbsp;close&nbsp;enough;&nbsp;golang.org/issue/8044</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346710">break</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8346718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346722">if</span>&nbsp;<span class="ident" id="8346725">err</span>&nbsp;<span class="op" id="8346729">!=</span>&nbsp;<span class="ident" id="8346732">errClosing</span>&nbsp;<span class="op" id="8346743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346748">t</span><span class="op" id="8346749">.</span><span class="ident" id="8346750">Fatalf</span><span class="op" id="8346756">(</span><span class="string" id="8346757">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8346788">,</span>&nbsp;<span class="ident" id="8346790">errClosing</span><span class="op" id="8346800">,</span>&nbsp;<span class="ident" id="8346802">err</span><span class="op" id="8346805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8346809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8346812">}</span><br>
<span class="lineno">130</span><span class="op" id="8346814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8346817">func</span>&nbsp;<span class="ident" id="8346822">TestWriteTimeout</span><span class="op" id="8346838">(</span><span class="ident" id="8346839">t</span>&nbsp;<span class="op" id="8346841">*</span><span class="ident" id="8346842">testing</span><span class="op" id="8346849">.</span><span class="ident" id="8346850">T</span><span class="op" id="8346851">)</span>&nbsp;<span class="op" id="8346853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346856">switch</span>&nbsp;<span class="ident" id="8346863">runtime</span><span class="op" id="8346870">.</span><span class="ident" id="8346871">GOOS</span>&nbsp;<span class="op" id="8346876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346879">case</span>&nbsp;<span class="string" id="8346884">&#34;plan9&#34;</span><span class="op" id="8346891">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346895">t</span><span class="op" id="8346896">.</span><span class="ident" id="8346897">Skipf</span><span class="op" id="8346902">(</span><span class="string" id="8346903">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8346924">,</span>&nbsp;<span class="ident" id="8346926">runtime</span><span class="op" id="8346933">.</span><span class="ident" id="8346934">GOOS</span><span class="op" id="8346938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8346941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346945">ln</span>&nbsp;<span class="op" id="8346948">:=</span>&nbsp;<span class="ident" id="8346951">newLocalListener</span><span class="op" id="8346967">(</span><span class="ident" id="8346968">t</span><span class="op" id="8346969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346972">defer</span>&nbsp;<span class="ident" id="8346978">ln</span><span class="op" id="8346980">.</span><span class="ident" id="8346981">Close</span><span class="op" id="8346986">(</span><span class="op" id="8346987">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346990">c</span><span class="op" id="8346991">,</span>&nbsp;<span class="ident" id="8346993">err</span>&nbsp;<span class="op" id="8346997">:=</span>&nbsp;<span class="ident" id="8347000">DialTCP</span><span class="op" id="8347007">(</span><span class="string" id="8347008">&#34;tcp&#34;</span><span class="op" id="8347013">,</span>&nbsp;<span class="ident" id="8347015">nil</span><span class="op" id="8347018">,</span>&nbsp;<span class="ident" id="8347020">ln</span><span class="op" id="8347022">.</span><span class="ident" id="8347023">Addr</span><span class="op" id="8347027">(</span><span class="op" id="8347028">)</span><span class="op" id="8347029">.</span><span class="op" id="8347030">(</span><span class="op" id="8347031">*</span><span class="ident" id="8347032">TCPAddr</span><span class="op" id="8347039">)</span><span class="op" id="8347040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347043">if</span>&nbsp;<span class="ident" id="8347046">err</span>&nbsp;<span class="op" id="8347050">!=</span>&nbsp;<span class="ident" id="8347053">nil</span>&nbsp;<span class="op" id="8347057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347061">t</span><span class="op" id="8347062">.</span><span class="ident" id="8347063">Fatalf</span><span class="op" id="8347069">(</span><span class="string" id="8347070">&#34;Connect:&nbsp;%v&#34;</span><span class="op" id="8347083">,</span>&nbsp;<span class="ident" id="8347085">err</span><span class="op" id="8347088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8347091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347094">defer</span>&nbsp;<span class="ident" id="8347100">c</span><span class="op" id="8347101">.</span><span class="ident" id="8347102">Close</span><span class="op" id="8347107">(</span><span class="op" id="8347108">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347111">c</span><span class="op" id="8347112">.</span><span class="ident" id="8347113">SetDeadline</span><span class="op" id="8347124">(</span><span class="ident" id="8347125">time</span><span class="op" id="8347129">.</span><span class="ident" id="8347130">Now</span><span class="op" id="8347133">(</span><span class="op" id="8347134">)</span><span class="op" id="8347135">.</span><span class="ident" id="8347136">Add</span><span class="op" id="8347139">(</span><span class="ident" id="8347140">time</span><span class="op" id="8347144">.</span><span class="ident" id="8347145">Hour</span><span class="op" id="8347149">)</span><span class="op" id="8347150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347153">c</span><span class="op" id="8347154">.</span><span class="ident" id="8347155">SetWriteDeadline</span><span class="op" id="8347171">(</span><span class="ident" id="8347172">time</span><span class="op" id="8347176">.</span><span class="ident" id="8347177">Now</span><span class="op" id="8347180">(</span><span class="op" id="8347181">)</span><span class="op" id="8347182">.</span><span class="ident" id="8347183">Add</span><span class="op" id="8347186">(</span><span class="op" id="8347187">-</span><span class="num" id="8347188">1</span>&nbsp;<span class="op" id="8347190">*</span>&nbsp;<span class="ident" id="8347192">time</span><span class="op" id="8347196">.</span><span class="ident" id="8347197">Second</span><span class="op" id="8347203">)</span><span class="op" id="8347204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347207">buf</span>&nbsp;<span class="op" id="8347211">:=</span>&nbsp;<span class="builtinfunc" id="8347214">make</span><span class="op" id="8347218">(</span><span class="op" id="8347219">[</span><span class="op" id="8347220">]</span><span class="builtintype" id="8347221">byte</span><span class="op" id="8347225">,</span>&nbsp;<span class="num" id="8347227">4096</span><span class="op" id="8347231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347234">writeUntilTimeout</span>&nbsp;<span class="op" id="8347252">:=</span>&nbsp;<span class="keyword" id="8347255">func</span><span class="op" id="8347259">(</span><span class="op" id="8347260">)</span>&nbsp;<span class="op" id="8347262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347266">for</span>&nbsp;<span class="op" id="8347270">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347275">_</span><span class="op" id="8347276">,</span>&nbsp;<span class="ident" id="8347278">err</span>&nbsp;<span class="op" id="8347282">:=</span>&nbsp;<span class="ident" id="8347285">c</span><span class="op" id="8347286">.</span><span class="ident" id="8347287">Write</span><span class="op" id="8347292">(</span><span class="ident" id="8347293">buf</span><span class="op" id="8347296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347301">if</span>&nbsp;<span class="ident" id="8347304">err</span>&nbsp;<span class="op" id="8347308">!=</span>&nbsp;<span class="ident" id="8347311">nil</span>&nbsp;<span class="op" id="8347315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347321">if</span>&nbsp;<span class="ident" id="8347324">isTimeout</span><span class="op" id="8347333">(</span><span class="ident" id="8347334">err</span><span class="op" id="8347337">)</span>&nbsp;<span class="op" id="8347339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347346">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8347357">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347363">t</span><span class="op" id="8347364">.</span><span class="ident" id="8347365">Fatalf</span><span class="op" id="8347371">(</span><span class="string" id="8347372">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8347404">,</span>&nbsp;<span class="ident" id="8347406">errTimeout</span><span class="op" id="8347416">,</span>&nbsp;<span class="ident" id="8347418">err</span><span class="op" id="8347421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8347426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8347430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8347433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347436">writeUntilTimeout</span><span class="op" id="8347453">(</span><span class="op" id="8347454">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347457">c</span><span class="op" id="8347458">.</span><span class="ident" id="8347459">SetDeadline</span><span class="op" id="8347470">(</span><span class="ident" id="8347471">time</span><span class="op" id="8347475">.</span><span class="ident" id="8347476">Now</span><span class="op" id="8347479">(</span><span class="op" id="8347480">)</span><span class="op" id="8347481">.</span><span class="ident" id="8347482">Add</span><span class="op" id="8347485">(</span><span class="num" id="8347486">10</span>&nbsp;<span class="op" id="8347489">*</span>&nbsp;<span class="ident" id="8347491">time</span><span class="op" id="8347495">.</span><span class="ident" id="8347496">Millisecond</span><span class="op" id="8347507">)</span><span class="op" id="8347508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347511">writeUntilTimeout</span><span class="op" id="8347528">(</span><span class="op" id="8347529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347532">writeUntilTimeout</span><span class="op" id="8347549">(</span><span class="op" id="8347550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347553">c</span><span class="op" id="8347554">.</span><span class="ident" id="8347555">SetWriteDeadline</span><span class="op" id="8347571">(</span><span class="ident" id="8347572">noDeadline</span><span class="op" id="8347582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347585">c</span><span class="op" id="8347586">.</span><span class="ident" id="8347587">SetReadDeadline</span><span class="op" id="8347602">(</span><span class="ident" id="8347603">time</span><span class="op" id="8347607">.</span><span class="ident" id="8347608">Now</span><span class="op" id="8347611">(</span><span class="op" id="8347612">)</span><span class="op" id="8347613">.</span><span class="ident" id="8347614">Add</span><span class="op" id="8347617">(</span><span class="op" id="8347618">-</span><span class="num" id="8347619">1</span>&nbsp;<span class="op" id="8347621">*</span>&nbsp;<span class="ident" id="8347623">time</span><span class="op" id="8347627">.</span><span class="ident" id="8347628">Second</span><span class="op" id="8347634">)</span><span class="op" id="8347635">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347638">errc</span>&nbsp;<span class="op" id="8347643">:=</span>&nbsp;<span class="builtinfunc" id="8347646">make</span><span class="op" id="8347650">(</span><span class="keyword" id="8347651">chan</span>&nbsp;<span class="builtintype" id="8347656">error</span><span class="op" id="8347661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347664">go</span>&nbsp;<span class="keyword" id="8347667">func</span><span class="op" id="8347671">(</span><span class="op" id="8347672">)</span>&nbsp;<span class="op" id="8347674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347678">for</span>&nbsp;<span class="op" id="8347682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347687">_</span><span class="op" id="8347688">,</span>&nbsp;<span class="ident" id="8347690">err</span>&nbsp;<span class="op" id="8347694">:=</span>&nbsp;<span class="ident" id="8347697">c</span><span class="op" id="8347698">.</span><span class="ident" id="8347699">Write</span><span class="op" id="8347704">(</span><span class="ident" id="8347705">buf</span><span class="op" id="8347708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347713">if</span>&nbsp;<span class="ident" id="8347716">err</span>&nbsp;<span class="op" id="8347720">!=</span>&nbsp;<span class="ident" id="8347723">nil</span>&nbsp;<span class="op" id="8347727">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347733">errc</span>&nbsp;<span class="op" id="8347738">&lt;-</span>&nbsp;<span class="ident" id="8347741">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8347748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8347752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8347755">}</span><span class="op" id="8347756">(</span><span class="op" id="8347757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347760">time</span><span class="op" id="8347764">.</span><span class="ident" id="8347765">Sleep</span><span class="op" id="8347770">(</span><span class="num" id="8347771">100</span>&nbsp;<span class="op" id="8347775">*</span>&nbsp;<span class="ident" id="8347777">time</span><span class="op" id="8347781">.</span><span class="ident" id="8347782">Millisecond</span><span class="op" id="8347793">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347796">select</span>&nbsp;<span class="op" id="8347803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347806">case</span>&nbsp;<span class="ident" id="8347811">err</span>&nbsp;<span class="op" id="8347815">:=</span>&nbsp;<span class="op" id="8347818">&lt;-</span><span class="ident" id="8347820">errc</span><span class="op" id="8347824">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347828">t</span><span class="op" id="8347829">.</span><span class="ident" id="8347830">Fatalf</span><span class="op" id="8347836">(</span><span class="string" id="8347837">&#34;Expected&nbsp;Write()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="8347896">,</span>&nbsp;<span class="ident" id="8347898">err</span><span class="op" id="8347901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347904">default</span><span class="op" id="8347911">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8347914">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347917">c</span><span class="op" id="8347918">.</span><span class="ident" id="8347919">Close</span><span class="op" id="8347924">(</span><span class="op" id="8347925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347928">switch</span>&nbsp;<span class="ident" id="8347935">nerr</span>&nbsp;<span class="op" id="8347940">:=</span>&nbsp;<span class="op" id="8347943">&lt;-</span><span class="ident" id="8347945">errc</span><span class="op" id="8347949">;</span>&nbsp;<span class="ident" id="8347951">err</span>&nbsp;<span class="op" id="8347955">:=</span>&nbsp;<span class="ident" id="8347958">nerr</span><span class="op" id="8347962">.</span><span class="op" id="8347963">(</span><span class="keyword" id="8347964">type</span><span class="op" id="8347968">)</span>&nbsp;<span class="op" id="8347970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347973">case</span>&nbsp;<span class="op" id="8347978">*</span><span class="ident" id="8347979">OpError</span><span class="op" id="8347986">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347990">if</span>&nbsp;<span class="ident" id="8347993">err</span><span class="op" id="8347996">.</span><span class="ident" id="8347997">Err</span>&nbsp;<span class="op" id="8348001">!=</span>&nbsp;<span class="ident" id="8348004">errClosing</span>&nbsp;<span class="op" id="8348015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348020">t</span><span class="op" id="8348021">.</span><span class="ident" id="8348022">Fatalf</span><span class="op" id="8348028">(</span><span class="string" id="8348029">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8348061">,</span>&nbsp;<span class="ident" id="8348063">errClosing</span><span class="op" id="8348073">,</span>&nbsp;<span class="ident" id="8348075">err</span><span class="op" id="8348078">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8348082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8348085">default</span><span class="op" id="8348092">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8348096">if</span>&nbsp;<span class="ident" id="8348099">err</span>&nbsp;<span class="op" id="8348103">!=</span>&nbsp;<span class="ident" id="8348106">errClosing</span>&nbsp;<span class="op" id="8348117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348122">t</span><span class="op" id="8348123">.</span><span class="ident" id="8348124">Fatalf</span><span class="op" id="8348130">(</span><span class="string" id="8348131">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8348163">,</span>&nbsp;<span class="ident" id="8348165">errClosing</span><span class="op" id="8348175">,</span>&nbsp;<span class="ident" id="8348177">err</span><span class="op" id="8348180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8348184">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8348187">}</span><br>
<span class="lineno"></span><span class="op" id="8348189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8348192">func</span>&nbsp;<span class="ident" id="8348197">testTimeout</span><span class="op" id="8348208">(</span><span class="ident" id="8348209">t</span>&nbsp;<span class="op" id="8348211">*</span><span class="ident" id="8348212">testing</span><span class="op" id="8348219">.</span><span class="ident" id="8348220">T</span><span class="op" id="8348221">,</span>&nbsp;<span class="ident" id="8348223">net</span><span class="op" id="8348226">,</span>&nbsp;<span class="ident" id="8348228">addr</span>&nbsp;<span class="builtintype" id="8348233">string</span><span class="op" id="8348239">,</span>&nbsp;<span class="ident" id="8348241">readFrom</span>&nbsp;<span class="builtintype" id="8348250">bool</span><span class="op" id="8348254">)</span>&nbsp;<span class="op" id="8348256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348259">c</span><span class="op" id="8348260">,</span>&nbsp;<span class="ident" id="8348262">err</span>&nbsp;<span class="op" id="8348266">:=</span>&nbsp;<span class="ident" id="8348269">Dial</span><span class="op" id="8348273">(</span><span class="ident" id="8348274">net</span><span class="op" id="8348277">,</span>&nbsp;<span class="ident" id="8348279">addr</span><span class="op" id="8348283">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8348286">if</span>&nbsp;<span class="ident" id="8348289">err</span>&nbsp;<span class="op" id="8348293">!=</span>&nbsp;<span class="ident" id="8348296">nil</span>&nbsp;<span class="op" id="8348300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348304">t</span><span class="op" id="8348305">.</span><span class="ident" id="8348306">Errorf</span><span class="op" id="8348312">(</span><span class="string" id="8348313">&#34;Dial(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8348338">,</span>&nbsp;<span class="ident" id="8348340">net</span><span class="op" id="8348343">,</span>&nbsp;<span class="ident" id="8348345">addr</span><span class="op" id="8348349">,</span>&nbsp;<span class="ident" id="8348351">err</span><span class="op" id="8348354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8348358">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8348366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8348369">defer</span>&nbsp;<span class="ident" id="8348375">c</span><span class="op" id="8348376">.</span><span class="ident" id="8348377">Close</span><span class="op" id="8348382">(</span><span class="op" id="8348383">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348386">what</span>&nbsp;<span class="op" id="8348391">:=</span>&nbsp;<span class="string" id="8348394">&#34;Read&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8348402">if</span>&nbsp;<span class="ident" id="8348405">readFrom</span>&nbsp;<span class="op" id="8348414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348418">what</span>&nbsp;<span class="op" id="8348423">=</span>&nbsp;<span class="string" id="8348425">&#34;ReadFrom&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8348437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348441">errc</span>&nbsp;<span class="op" id="8348446">:=</span>&nbsp;<span class="builtinfunc" id="8348449">make</span><span class="op" id="8348453">(</span><span class="keyword" id="8348454">chan</span>&nbsp;<span class="builtintype" id="8348459">error</span><span class="op" id="8348464">,</span>&nbsp;<span class="num" id="8348466">1</span><span class="op" id="8348467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8348470">go</span>&nbsp;<span class="keyword" id="8348473">func</span><span class="op" id="8348477">(</span><span class="op" id="8348478">)</span>&nbsp;<span class="op" id="8348480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348484">t0</span>&nbsp;<span class="op" id="8348487">:=</span>&nbsp;<span class="ident" id="8348490">time</span><span class="op" id="8348494">.</span><span class="ident" id="8348495">Now</span><span class="op" id="8348498">(</span><span class="op" id="8348499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348503">c</span><span class="op" id="8348504">.</span><span class="ident" id="8348505">SetReadDeadline</span><span class="op" id="8348520">(</span><span class="ident" id="8348521">time</span><span class="op" id="8348525">.</span><span class="ident" id="8348526">Now</span><span class="op" id="8348529">(</span><span class="op" id="8348530">)</span><span class="op" id="8348531">.</span><span class="ident" id="8348532">Add</span><span class="op" id="8348535">(</span><span class="num" id="8348536">100</span>&nbsp;<span class="op" id="8348540">*</span>&nbsp;<span class="ident" id="8348542">time</span><span class="op" id="8348546">.</span><span class="ident" id="8348547">Millisecond</span><span class="op" id="8348558">)</span><span class="op" id="8348559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8348563">var</span>&nbsp;<span class="ident" id="8348567">b</span>&nbsp;<span class="op" id="8348569">[</span><span class="num" id="8348570">100</span><span class="op" id="8348573">]</span><span class="builtintype" id="8348574">byte</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8348581">var</span>&nbsp;<span class="ident" id="8348585">n</span>&nbsp;<span class="builtintype" id="8348587">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8348593">var</span>&nbsp;<span class="ident" id="8348597">err</span>&nbsp;<span class="builtintype" id="8348601">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8348609">if</span>&nbsp;<span class="ident" id="8348612">readFrom</span>&nbsp;<span class="op" id="8348621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348626">n</span><span class="op" id="8348627">,</span>&nbsp;<span class="ident" id="8348629">_</span><span class="op" id="8348630">,</span>&nbsp;<span class="ident" id="8348632">err</span>&nbsp;<span class="op" id="8348636">=</span>&nbsp;<span class="ident" id="8348638">c</span><span class="op" id="8348639">.</span><span class="op" id="8348640">(</span><span class="ident" id="8348641">PacketConn</span><span class="op" id="8348651">)</span><span class="op" id="8348652">.</span><span class="ident" id="8348653">ReadFrom</span><span class="op" id="8348661">(</span><span class="ident" id="8348662">b</span><span class="op" id="8348663">[</span><span class="num" id="8348664">0</span><span class="op" id="8348665">:</span><span class="op" id="8348666">]</span><span class="op" id="8348667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8348671">}</span>&nbsp;<span class="keyword" id="8348673">else</span>&nbsp;<span class="op" id="8348678">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348683">n</span><span class="op" id="8348684">,</span>&nbsp;<span class="ident" id="8348686">err</span>&nbsp;<span class="op" id="8348690">=</span>&nbsp;<span class="ident" id="8348692">c</span><span class="op" id="8348693">.</span><span class="ident" id="8348694">Read</span><span class="op" id="8348698">(</span><span class="ident" id="8348699">b</span><span class="op" id="8348700">[</span><span class="num" id="8348701">0</span><span class="op" id="8348702">:</span><span class="op" id="8348703">]</span><span class="op" id="8348704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8348708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348712">t1</span>&nbsp;<span class="op" id="8348715">:=</span>&nbsp;<span class="ident" id="8348718">time</span><span class="op" id="8348722">.</span><span class="ident" id="8348723">Now</span><span class="op" id="8348726">(</span><span class="op" id="8348727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8348731">if</span>&nbsp;<span class="ident" id="8348734">n</span>&nbsp;<span class="op" id="8348736">!=</span>&nbsp;<span class="num" id="8348739">0</span>&nbsp;<span class="op" id="8348741">||</span>&nbsp;<span class="ident" id="8348744">err</span>&nbsp;<span class="op" id="8348748">==</span>&nbsp;<span class="ident" id="8348751">nil</span>&nbsp;<span class="op" id="8348755">||</span>&nbsp;<span class="op" id="8348758">!</span><span class="ident" id="8348759">err</span><span class="op" id="8348762">.</span><span class="op" id="8348763">(</span><span class="ident" id="8348764">Error</span><span class="op" id="8348769">)</span><span class="op" id="8348770">.</span><span class="ident" id="8348771">Timeout</span><span class="op" id="8348778">(</span><span class="op" id="8348779">)</span>&nbsp;<span class="op" id="8348781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348786">errc</span>&nbsp;<span class="op" id="8348791">&lt;-</span>&nbsp;<span class="ident" id="8348794">fmt</span><span class="op" id="8348797">.</span><span class="ident" id="8348798">Errorf</span><span class="op" id="8348804">(</span><span class="string" id="8348805">&#34;%s(%q,&nbsp;%q)&nbsp;did&nbsp;not&nbsp;return&nbsp;0,&nbsp;timeout:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="8348851">,</span>&nbsp;<span class="ident" id="8348853">what</span><span class="op" id="8348857">,</span>&nbsp;<span class="ident" id="8348859">net</span><span class="op" id="8348862">,</span>&nbsp;<span class="ident" id="8348864">addr</span><span class="op" id="8348868">,</span>&nbsp;<span class="ident" id="8348870">n</span><span class="op" id="8348871">,</span>&nbsp;<span class="ident" id="8348873">err</span><span class="op" id="8348876">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8348881">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8348890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8348894">if</span>&nbsp;<span class="ident" id="8348897">dt</span>&nbsp;<span class="op" id="8348900">:=</span>&nbsp;<span class="ident" id="8348903">t1</span><span class="op" id="8348905">.</span><span class="ident" id="8348906">Sub</span><span class="op" id="8348909">(</span><span class="ident" id="8348910">t0</span><span class="op" id="8348912">)</span><span class="op" id="8348913">;</span>&nbsp;<span class="ident" id="8348915">dt</span>&nbsp;<span class="op" id="8348918">&lt;</span>&nbsp;<span class="num" id="8348920">50</span><span class="op" id="8348922">*</span><span class="ident" id="8348923">time</span><span class="op" id="8348927">.</span><span class="ident" id="8348928">Millisecond</span>&nbsp;<span class="op" id="8348940">||</span>&nbsp;<span class="op" id="8348943">!</span><span class="ident" id="8348944">testing</span><span class="op" id="8348951">.</span><span class="ident" id="8348952">Short</span><span class="op" id="8348957">(</span><span class="op" id="8348958">)</span>&nbsp;<span class="op" id="8348960">&amp;&amp;</span>&nbsp;<span class="ident" id="8348963">dt</span>&nbsp;<span class="op" id="8348966">&gt;</span>&nbsp;<span class="num" id="8348968">250</span><span class="op" id="8348971">*</span><span class="ident" id="8348972">time</span><span class="op" id="8348976">.</span><span class="ident" id="8348977">Millisecond</span>&nbsp;<span class="op" id="8348989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348994">errc</span>&nbsp;<span class="op" id="8348999">&lt;-</span>&nbsp;<span class="ident" id="8349002">fmt</span><span class="op" id="8349005">.</span><span class="ident" id="8349006">Errorf</span><span class="op" id="8349012">(</span><span class="string" id="8349013">&#34;%s(%q,&nbsp;%q)&nbsp;took&nbsp;%s,&nbsp;expected&nbsp;0.1s&#34;</span><span class="op" id="8349048">,</span>&nbsp;<span class="ident" id="8349050">what</span><span class="op" id="8349054">,</span>&nbsp;<span class="ident" id="8349056">net</span><span class="op" id="8349059">,</span>&nbsp;<span class="ident" id="8349061">addr</span><span class="op" id="8349065">,</span>&nbsp;<span class="ident" id="8349067">dt</span><span class="op" id="8349069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349074">return</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8349083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8349087">errc</span>&nbsp;<span class="op" id="8349092">&lt;-</span>&nbsp;<span class="ident" id="8349095">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8349100">}</span><span class="op" id="8349101">(</span><span class="op" id="8349102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349105">select</span>&nbsp;<span class="op" id="8349112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349115">case</span>&nbsp;<span class="ident" id="8349120">err</span>&nbsp;<span class="op" id="8349124">:=</span>&nbsp;<span class="op" id="8349127">&lt;-</span><span class="ident" id="8349129">errc</span><span class="op" id="8349133">:</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349137">if</span>&nbsp;<span class="ident" id="8349140">err</span>&nbsp;<span class="op" id="8349144">!=</span>&nbsp;<span class="ident" id="8349147">nil</span>&nbsp;<span class="op" id="8349151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8349156">t</span><span class="op" id="8349157">.</span><span class="ident" id="8349158">Error</span><span class="op" id="8349163">(</span><span class="ident" id="8349164">err</span><span class="op" id="8349167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8349171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349174">case</span>&nbsp;<span class="op" id="8349179">&lt;-</span><span class="ident" id="8349181">time</span><span class="op" id="8349185">.</span><span class="ident" id="8349186">After</span><span class="op" id="8349191">(</span><span class="num" id="8349192">1</span>&nbsp;<span class="op" id="8349194">*</span>&nbsp;<span class="ident" id="8349196">time</span><span class="op" id="8349200">.</span><span class="ident" id="8349201">Second</span><span class="op" id="8349207">)</span><span class="op" id="8349208">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8349212">t</span><span class="op" id="8349213">.</span><span class="ident" id="8349214">Errorf</span><span class="op" id="8349220">(</span><span class="string" id="8349221">&#34;%s(%q,&nbsp;%q)&nbsp;took&nbsp;over&nbsp;1&nbsp;second,&nbsp;expected&nbsp;0.1s&#34;</span><span class="op" id="8349267">,</span>&nbsp;<span class="ident" id="8349269">what</span><span class="op" id="8349273">,</span>&nbsp;<span class="ident" id="8349275">net</span><span class="op" id="8349278">,</span>&nbsp;<span class="ident" id="8349280">addr</span><span class="op" id="8349284">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8349287">}</span><br>
<span class="lineno"></span><span class="op" id="8349289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8349292">func</span>&nbsp;<span class="ident" id="8349297">TestTimeoutUDP</span><span class="op" id="8349311">(</span><span class="ident" id="8349312">t</span>&nbsp;<span class="op" id="8349314">*</span><span class="ident" id="8349315">testing</span><span class="op" id="8349322">.</span><span class="ident" id="8349323">T</span><span class="op" id="8349324">)</span>&nbsp;<span class="op" id="8349326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349329">switch</span>&nbsp;<span class="ident" id="8349336">runtime</span><span class="op" id="8349343">.</span><span class="ident" id="8349344">GOOS</span>&nbsp;<span class="op" id="8349349">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349352">case</span>&nbsp;<span class="string" id="8349357">&#34;plan9&#34;</span><span class="op" id="8349364">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8349368">t</span><span class="op" id="8349369">.</span><span class="ident" id="8349370">Skipf</span><span class="op" id="8349375">(</span><span class="string" id="8349376">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8349397">,</span>&nbsp;<span class="ident" id="8349399">runtime</span><span class="op" id="8349406">.</span><span class="ident" id="8349407">GOOS</span><span class="op" id="8349411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8349414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8349418">//&nbsp;set&nbsp;up&nbsp;a&nbsp;listener&nbsp;that&nbsp;won&#39;t&nbsp;talk&nbsp;back</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8349461">listening</span>&nbsp;<span class="op" id="8349471">:=</span>&nbsp;<span class="builtinfunc" id="8349474">make</span><span class="op" id="8349478">(</span><span class="keyword" id="8349479">chan</span>&nbsp;<span class="builtintype" id="8349484">string</span><span class="op" id="8349490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8349493">done</span>&nbsp;<span class="op" id="8349498">:=</span>&nbsp;<span class="builtinfunc" id="8349501">make</span><span class="op" id="8349505">(</span><span class="keyword" id="8349506">chan</span>&nbsp;<span class="builtintype" id="8349511">int</span><span class="op" id="8349514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349517">go</span>&nbsp;<span class="ident" id="8349520">runDatagramPacketConnServer</span><span class="op" id="8349547">(</span><span class="ident" id="8349548">t</span><span class="op" id="8349549">,</span>&nbsp;<span class="string" id="8349551">&#34;udp&#34;</span><span class="op" id="8349556">,</span>&nbsp;<span class="string" id="8349558">&#34;127.0.0.1:0&#34;</span><span class="op" id="8349571">,</span>&nbsp;<span class="ident" id="8349573">listening</span><span class="op" id="8349582">,</span>&nbsp;<span class="ident" id="8349584">done</span><span class="op" id="8349588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8349591">addr</span>&nbsp;<span class="op" id="8349596">:=</span>&nbsp;<span class="op" id="8349599">&lt;-</span><span class="ident" id="8349601">listening</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8349613">testTimeout</span><span class="op" id="8349624">(</span><span class="ident" id="8349625">t</span><span class="op" id="8349626">,</span>&nbsp;<span class="string" id="8349628">&#34;udp&#34;</span><span class="op" id="8349633">,</span>&nbsp;<span class="ident" id="8349635">addr</span><span class="op" id="8349639">,</span>&nbsp;<span class="builtintype" id="8349641">false</span><span class="op" id="8349646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8349649">testTimeout</span><span class="op" id="8349660">(</span><span class="ident" id="8349661">t</span><span class="op" id="8349662">,</span>&nbsp;<span class="string" id="8349664">&#34;udp&#34;</span><span class="op" id="8349669">,</span>&nbsp;<span class="ident" id="8349671">addr</span><span class="op" id="8349675">,</span>&nbsp;<span class="builtintype" id="8349677">true</span><span class="op" id="8349681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8349684">&lt;-</span><span class="ident" id="8349686">done</span><br>
<span class="lineno"></span><span class="op" id="8349691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="8349694">func</span>&nbsp;<span class="ident" id="8349699">TestTimeoutTCP</span><span class="op" id="8349713">(</span><span class="ident" id="8349714">t</span>&nbsp;<span class="op" id="8349716">*</span><span class="ident" id="8349717">testing</span><span class="op" id="8349724">.</span><span class="ident" id="8349725">T</span><span class="op" id="8349726">)</span>&nbsp;<span class="op" id="8349728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349731">switch</span>&nbsp;<span class="ident" id="8349738">runtime</span><span class="op" id="8349745">.</span><span class="ident" id="8349746">GOOS</span>&nbsp;<span class="op" id="8349751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349754">case</span>&nbsp;<span class="string" id="8349759">&#34;plan9&#34;</span><span class="op" id="8349766">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8349770">t</span><span class="op" id="8349771">.</span><span class="ident" id="8349772">Skipf</span><span class="op" id="8349777">(</span><span class="string" id="8349778">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8349799">,</span>&nbsp;<span class="ident" id="8349801">runtime</span><span class="op" id="8349808">.</span><span class="ident" id="8349809">GOOS</span><span class="op" id="8349813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8349816">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8349820">//&nbsp;set&nbsp;up&nbsp;a&nbsp;listener&nbsp;that&nbsp;won&#39;t&nbsp;talk&nbsp;back</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8349863">listening</span>&nbsp;<span class="op" id="8349873">:=</span>&nbsp;<span class="builtinfunc" id="8349876">make</span><span class="op" id="8349880">(</span><span class="keyword" id="8349881">chan</span>&nbsp;<span class="builtintype" id="8349886">string</span><span class="op" id="8349892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8349895">done</span>&nbsp;<span class="op" id="8349900">:=</span>&nbsp;<span class="builtinfunc" id="8349903">make</span><span class="op" id="8349907">(</span><span class="keyword" id="8349908">chan</span>&nbsp;<span class="builtintype" id="8349913">int</span><span class="op" id="8349916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349919">go</span>&nbsp;<span class="ident" id="8349922">runStreamConnServer</span><span class="op" id="8349941">(</span><span class="ident" id="8349942">t</span><span class="op" id="8349943">,</span>&nbsp;<span class="string" id="8349945">&#34;tcp&#34;</span><span class="op" id="8349950">,</span>&nbsp;<span class="string" id="8349952">&#34;127.0.0.1:0&#34;</span><span class="op" id="8349965">,</span>&nbsp;<span class="ident" id="8349967">listening</span><span class="op" id="8349976">,</span>&nbsp;<span class="ident" id="8349978">done</span><span class="op" id="8349982">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8349985">addr</span>&nbsp;<span class="op" id="8349990">:=</span>&nbsp;<span class="op" id="8349993">&lt;-</span><span class="ident" id="8349995">listening</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350007">testTimeout</span><span class="op" id="8350018">(</span><span class="ident" id="8350019">t</span><span class="op" id="8350020">,</span>&nbsp;<span class="string" id="8350022">&#34;tcp&#34;</span><span class="op" id="8350027">,</span>&nbsp;<span class="ident" id="8350029">addr</span><span class="op" id="8350033">,</span>&nbsp;<span class="builtintype" id="8350035">false</span><span class="op" id="8350040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8350043">&lt;-</span><span class="ident" id="8350045">done</span><br>
<span class="lineno"></span><span class="op" id="8350050">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="keyword" id="8350053">func</span>&nbsp;<span class="ident" id="8350058">TestDeadlineReset</span><span class="op" id="8350075">(</span><span class="ident" id="8350076">t</span>&nbsp;<span class="op" id="8350078">*</span><span class="ident" id="8350079">testing</span><span class="op" id="8350086">.</span><span class="ident" id="8350087">T</span><span class="op" id="8350088">)</span>&nbsp;<span class="op" id="8350090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350093">switch</span>&nbsp;<span class="ident" id="8350100">runtime</span><span class="op" id="8350107">.</span><span class="ident" id="8350108">GOOS</span>&nbsp;<span class="op" id="8350113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350116">case</span>&nbsp;<span class="string" id="8350121">&#34;plan9&#34;</span><span class="op" id="8350128">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350132">t</span><span class="op" id="8350133">.</span><span class="ident" id="8350134">Skipf</span><span class="op" id="8350139">(</span><span class="string" id="8350140">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8350161">,</span>&nbsp;<span class="ident" id="8350163">runtime</span><span class="op" id="8350170">.</span><span class="ident" id="8350171">GOOS</span><span class="op" id="8350175">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8350178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350181">ln</span><span class="op" id="8350183">,</span>&nbsp;<span class="ident" id="8350185">err</span>&nbsp;<span class="op" id="8350189">:=</span>&nbsp;<span class="ident" id="8350192">Listen</span><span class="op" id="8350198">(</span><span class="string" id="8350199">&#34;tcp&#34;</span><span class="op" id="8350204">,</span>&nbsp;<span class="string" id="8350206">&#34;127.0.0.1:0&#34;</span><span class="op" id="8350219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350222">if</span>&nbsp;<span class="ident" id="8350225">err</span>&nbsp;<span class="op" id="8350229">!=</span>&nbsp;<span class="ident" id="8350232">nil</span>&nbsp;<span class="op" id="8350236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350240">t</span><span class="op" id="8350241">.</span><span class="ident" id="8350242">Fatal</span><span class="op" id="8350247">(</span><span class="ident" id="8350248">err</span><span class="op" id="8350251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8350254">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350257">defer</span>&nbsp;<span class="ident" id="8350263">ln</span><span class="op" id="8350265">.</span><span class="ident" id="8350266">Close</span><span class="op" id="8350271">(</span><span class="op" id="8350272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350275">tl</span>&nbsp;<span class="op" id="8350278">:=</span>&nbsp;<span class="ident" id="8350281">ln</span><span class="op" id="8350283">.</span><span class="op" id="8350284">(</span><span class="op" id="8350285">*</span><span class="ident" id="8350286">TCPListener</span><span class="op" id="8350297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350300">tl</span><span class="op" id="8350302">.</span><span class="ident" id="8350303">SetDeadline</span><span class="op" id="8350314">(</span><span class="ident" id="8350315">time</span><span class="op" id="8350319">.</span><span class="ident" id="8350320">Now</span><span class="op" id="8350323">(</span><span class="op" id="8350324">)</span><span class="op" id="8350325">.</span><span class="ident" id="8350326">Add</span><span class="op" id="8350329">(</span><span class="num" id="8350330">1</span>&nbsp;<span class="op" id="8350332">*</span>&nbsp;<span class="ident" id="8350334">time</span><span class="op" id="8350338">.</span><span class="ident" id="8350339">Minute</span><span class="op" id="8350345">)</span><span class="op" id="8350346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350349">tl</span><span class="op" id="8350351">.</span><span class="ident" id="8350352">SetDeadline</span><span class="op" id="8350363">(</span><span class="ident" id="8350364">noDeadline</span><span class="op" id="8350374">)</span>&nbsp;<span class="comment" id="8350376">//&nbsp;reset&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350389">errc</span>&nbsp;<span class="op" id="8350394">:=</span>&nbsp;<span class="builtinfunc" id="8350397">make</span><span class="op" id="8350401">(</span><span class="keyword" id="8350402">chan</span>&nbsp;<span class="builtintype" id="8350407">error</span><span class="op" id="8350412">,</span>&nbsp;<span class="num" id="8350414">1</span><span class="op" id="8350415">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350418">go</span>&nbsp;<span class="keyword" id="8350421">func</span><span class="op" id="8350425">(</span><span class="op" id="8350426">)</span>&nbsp;<span class="op" id="8350428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350432">_</span><span class="op" id="8350433">,</span>&nbsp;<span class="ident" id="8350435">err</span>&nbsp;<span class="op" id="8350439">:=</span>&nbsp;<span class="ident" id="8350442">ln</span><span class="op" id="8350444">.</span><span class="ident" id="8350445">Accept</span><span class="op" id="8350451">(</span><span class="op" id="8350452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350456">errc</span>&nbsp;<span class="op" id="8350461">&lt;-</span>&nbsp;<span class="ident" id="8350464">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8350469">}</span><span class="op" id="8350470">(</span><span class="op" id="8350471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350474">select</span>&nbsp;<span class="op" id="8350481">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350484">case</span>&nbsp;<span class="op" id="8350489">&lt;-</span><span class="ident" id="8350491">time</span><span class="op" id="8350495">.</span><span class="ident" id="8350496">After</span><span class="op" id="8350501">(</span><span class="num" id="8350502">50</span>&nbsp;<span class="op" id="8350505">*</span>&nbsp;<span class="ident" id="8350507">time</span><span class="op" id="8350511">.</span><span class="ident" id="8350512">Millisecond</span><span class="op" id="8350523">)</span><span class="op" id="8350524">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8350528">//&nbsp;Pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350538">case</span>&nbsp;<span class="ident" id="8350543">err</span>&nbsp;<span class="op" id="8350547">:=</span>&nbsp;<span class="op" id="8350550">&lt;-</span><span class="ident" id="8350552">errc</span><span class="op" id="8350556">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8350560">//&nbsp;Accept&nbsp;should&nbsp;never&nbsp;return;&nbsp;we&nbsp;never</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8350602">//&nbsp;connected&nbsp;to&nbsp;it.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350624">t</span><span class="op" id="8350625">.</span><span class="ident" id="8350626">Errorf</span><span class="op" id="8350632">(</span><span class="string" id="8350633">&#34;unexpected&nbsp;return&nbsp;from&nbsp;Accept;&nbsp;err=%v&#34;</span><span class="op" id="8350672">,</span>&nbsp;<span class="ident" id="8350674">err</span><span class="op" id="8350677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8350680">}</span><br>
<span class="lineno"></span><span class="op" id="8350682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8350685">func</span>&nbsp;<span class="ident" id="8350690">TestTimeoutAccept</span><span class="op" id="8350707">(</span><span class="ident" id="8350708">t</span>&nbsp;<span class="op" id="8350710">*</span><span class="ident" id="8350711">testing</span><span class="op" id="8350718">.</span><span class="ident" id="8350719">T</span><span class="op" id="8350720">)</span>&nbsp;<span class="op" id="8350722">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350725">switch</span>&nbsp;<span class="ident" id="8350732">runtime</span><span class="op" id="8350739">.</span><span class="ident" id="8350740">GOOS</span>&nbsp;<span class="op" id="8350745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350748">case</span>&nbsp;<span class="string" id="8350753">&#34;plan9&#34;</span><span class="op" id="8350760">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350764">t</span><span class="op" id="8350765">.</span><span class="ident" id="8350766">Skipf</span><span class="op" id="8350771">(</span><span class="string" id="8350772">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8350793">,</span>&nbsp;<span class="ident" id="8350795">runtime</span><span class="op" id="8350802">.</span><span class="ident" id="8350803">GOOS</span><span class="op" id="8350807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8350810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350813">ln</span><span class="op" id="8350815">,</span>&nbsp;<span class="ident" id="8350817">err</span>&nbsp;<span class="op" id="8350821">:=</span>&nbsp;<span class="ident" id="8350824">Listen</span><span class="op" id="8350830">(</span><span class="string" id="8350831">&#34;tcp&#34;</span><span class="op" id="8350836">,</span>&nbsp;<span class="string" id="8350838">&#34;127.0.0.1:0&#34;</span><span class="op" id="8350851">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350854">if</span>&nbsp;<span class="ident" id="8350857">err</span>&nbsp;<span class="op" id="8350861">!=</span>&nbsp;<span class="ident" id="8350864">nil</span>&nbsp;<span class="op" id="8350868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350872">t</span><span class="op" id="8350873">.</span><span class="ident" id="8350874">Fatal</span><span class="op" id="8350879">(</span><span class="ident" id="8350880">err</span><span class="op" id="8350883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8350886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350889">defer</span>&nbsp;<span class="ident" id="8350895">ln</span><span class="op" id="8350897">.</span><span class="ident" id="8350898">Close</span><span class="op" id="8350903">(</span><span class="op" id="8350904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350907">tl</span>&nbsp;<span class="op" id="8350910">:=</span>&nbsp;<span class="ident" id="8350913">ln</span><span class="op" id="8350915">.</span><span class="op" id="8350916">(</span><span class="op" id="8350917">*</span><span class="ident" id="8350918">TCPListener</span><span class="op" id="8350929">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350932">tl</span><span class="op" id="8350934">.</span><span class="ident" id="8350935">SetDeadline</span><span class="op" id="8350946">(</span><span class="ident" id="8350947">time</span><span class="op" id="8350951">.</span><span class="ident" id="8350952">Now</span><span class="op" id="8350955">(</span><span class="op" id="8350956">)</span><span class="op" id="8350957">.</span><span class="ident" id="8350958">Add</span><span class="op" id="8350961">(</span><span class="num" id="8350962">100</span>&nbsp;<span class="op" id="8350966">*</span>&nbsp;<span class="ident" id="8350968">time</span><span class="op" id="8350972">.</span><span class="ident" id="8350973">Millisecond</span><span class="op" id="8350984">)</span><span class="op" id="8350985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350988">errc</span>&nbsp;<span class="op" id="8350993">:=</span>&nbsp;<span class="builtinfunc" id="8350996">make</span><span class="op" id="8351000">(</span><span class="keyword" id="8351001">chan</span>&nbsp;<span class="builtintype" id="8351006">error</span><span class="op" id="8351011">,</span>&nbsp;<span class="num" id="8351013">1</span><span class="op" id="8351014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8351017">go</span>&nbsp;<span class="keyword" id="8351020">func</span><span class="op" id="8351024">(</span><span class="op" id="8351025">)</span>&nbsp;<span class="op" id="8351027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8351031">_</span><span class="op" id="8351032">,</span>&nbsp;<span class="ident" id="8351034">err</span>&nbsp;<span class="op" id="8351038">:=</span>&nbsp;<span class="ident" id="8351041">ln</span><span class="op" id="8351043">.</span><span class="ident" id="8351044">Accept</span><span class="op" id="8351050">(</span><span class="op" id="8351051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8351055">errc</span>&nbsp;<span class="op" id="8351060">&lt;-</span>&nbsp;<span class="ident" id="8351063">err</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8351068">}</span><span class="op" id="8351069">(</span><span class="op" id="8351070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8351073">select</span>&nbsp;<span class="op" id="8351080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8351083">case</span>&nbsp;<span class="op" id="8351088">&lt;-</span><span class="ident" id="8351090">time</span><span class="op" id="8351094">.</span><span class="ident" id="8351095">After</span><span class="op" id="8351100">(</span><span class="num" id="8351101">1</span>&nbsp;<span class="op" id="8351103">*</span>&nbsp;<span class="ident" id="8351105">time</span><span class="op" id="8351109">.</span><span class="ident" id="8351110">Second</span><span class="op" id="8351116">)</span><span class="op" id="8351117">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8351121">//&nbsp;Accept&nbsp;shouldn&#39;t&nbsp;block&nbsp;indefinitely</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8351162">t</span><span class="op" id="8351163">.</span><span class="ident" id="8351164">Errorf</span><span class="op" id="8351170">(</span><span class="string" id="8351171">&#34;Accept&nbsp;didn&#39;t&nbsp;return&nbsp;in&nbsp;an&nbsp;expected&nbsp;time&#34;</span><span class="op" id="8351213">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8351216">case</span>&nbsp;<span class="op" id="8351221">&lt;-</span><span class="ident" id="8351223">errc</span><span class="op" id="8351227">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8351231">//&nbsp;Pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8351241">}</span><br>
<span class="lineno"></span><span class="op" id="8351243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="8351246">func</span>&nbsp;<span class="ident" id="8351251">TestReadWriteDeadline</span><span class="op" id="8351272">(</span><span class="ident" id="8351273">t</span>&nbsp;<span class="op" id="8351275">*</span><span class="ident" id="8351276">testing</span><span class="op" id="8351283">.</span><span class="ident" id="8351284">T</span><span class="op" id="8351285">)</span>&nbsp;<span class="op" id="8351287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8351290">switch</span>&nbsp;<span class="ident" id="8351297">runtime</span><span class="op" id="8351304">.</span><span class="ident" id="8351305">GOOS</span>&nbsp;<span class="op" id="8351310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8351313">case</span>&nbsp;<span class="string" id="8351318">&#34;plan9&#34;</span><span class="op" id="8351325">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8351329">t</span><span class="op" id="8351330">.</span><span class="ident" id="8351331">Skipf</span><span class="op" id="8351336">(</span><span class="string" id="8351337">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8351358">,</span>&nbsp;<span class="ident" id="8351360">runtime</span><span class="op" id="8351367">.</span><span class="ident" id="8351368">GOOS</span><span class="op" id="8351372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8351375">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8351379">const</span>&nbsp;<span class="op" id="8351385">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8351389">readTimeout</span>&nbsp;&nbsp;<span class="op" id="8351402">=</span>&nbsp;<span class="num" id="8351404">50</span>&nbsp;<span class="op" id="8351407">*</span>&nbsp;<span class="ident" id="8351409">time</span><span class="op" id="8351413">.</span><span class="ident" id="8351414">Millisecond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8351428">writeTimeout</span>&nbsp;<span class="op" id="8351441">=</span>&nbsp;<span class="num" id="8351443">250</span>&nbsp;<span class="op" id="8351447">*</span>&nbsp;<span class="ident" id="8351449">time</span><span class="op" id="8351453">.</span><span class="ident" id="8351454">Millisecond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8351467">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8351470">checkTimeout</span>&nbsp;<span class="op" id="8351483">:=</span>&nbsp;<span class="keyword" id="8351486">func</span><span class="op" id="8351490">(</span><span class="ident" id="8351491">command</span>&nbsp;<span class="builtintype" id="8351499">string</span><span class="op" id="8351505">,</span>&nbsp;<span class="ident" id="8351507">start</span>&nbsp;<span class="ident" id="8351513">time</span><span class="op" id="8351517">.</span><span class="ident" id="8351518">Time</span><span class="op" id="8351522">,</span>&nbsp;<span class="ident" id="8351524">should</span>&nbsp;<span class="ident" id="8351531">time</span><span class="op" id="8351535">.</span><span class="ident" id="8351536">Duration</span><span class="op" id="8351544">)</span>&nbsp;<span class="op" id="8351546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8351550">is</span>&nbsp;<span class="op" id="8351553">:=</span>&nbsp;<span class="ident" id="8351556">time</span><span class="op" id="8351560">.</span><span class="ident" id="8351561">Now</span><span class="op" id="8351564">(</span><span class="op" id="8351565">)</span><span class="op" id="8351566">.</span><span class="ident" id="8351567">Sub</span><span class="op" id="8351570">(</span><span class="ident" id="8351571">start</span><span class="op" id="8351576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8351580">d</span>&nbsp;<span class="op" id="8351582">:=</span>&nbsp;<span class="ident" id="8351585">is</span>&nbsp;<span class="op" id="8351588">-</span>&nbsp;<span class="ident" id="8351590">should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8351599">if</span>&nbsp;<span class="ident" id="8351602">d</span>&nbsp;<span class="op" id="8351604">&lt;</span>&nbsp;<span class="op" id="8351606">-</span><span class="num" id="8351607">30</span><span class="op" id="8351609">*</span><span class="ident" id="8351610">time</span><span class="op" id="8351614">.</span><span class="ident" id="8351615">Millisecond</span>&nbsp;<span class="op" id="8351627">||</span>&nbsp;<span class="op" id="8351630">!</span><span class="ident" id="8351631">testing</span><span class="op" id="8351638">.</span><span class="ident" id="8351639">Short</span><span class="op" id="8351644">(</span><span class="op" id="8351645">)</span>&nbsp;<span class="op" id="8351647">&amp;&amp;</span>&nbsp;<span class="num" id="8351650">150</span><span class="op" id="8351653">*</span><span class="ident" id="8351654">time</span><span class="op" id="8351658">.</span><span class="ident" id="8351659">Millisecond</span>&nbsp;<span class="op" id="8351671">&lt;</span>&nbsp;<span class="ident" id="8351673">d</span>&nbsp;<span class="op" id="8351675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8351680">t</span><span class="op" id="8351681">.</span><span class="ident" id="8351682">Errorf</span><span class="op" id="8351688">(</span><span class="string" id="8351689">&#34;%s&nbsp;timeout&nbsp;test&nbsp;failed:&nbsp;is=%v&nbsp;should=%v\n&#34;</span><span class="op" id="8351732">,</span>&nbsp;<span class="ident" id="8351734">command</span><span class="op" id="8351741">,</span>&nbsp;<span class="ident" id="8351743">is</span><span class="op" id="8351745">,</span>&nbsp;<span class="ident" id="8351747">should</span><span class="op" id="8351753">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8351757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8351760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8351764">ln</span><span class="op" id="8351766">,</span>&nbsp;<span class="ident" id="8351768">err</span>&nbsp;<span class="op" id="8351772">:=</span>&nbsp;<span class="ident" id="8351775">Listen</span><span class="op" id="8351781">(</span><span class="string" id="8351782">&#34;tcp&#34;</span><span class="op" id="8351787">,</span>&nbsp;<span class="string" id="8351789">&#34;127.0.0.1:0&#34;</span><span class="op" id="8351802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8351805">if</span>&nbsp;<span class="ident" id="8351808">err</span>&nbsp;<span class="op" id="8351812">!=</span>&nbsp;<span class="ident" id="8351815">nil</span>&nbsp;<span class="op" id="8351819">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8351823">t</span><span class="op" id="8351824">.</span><span class="ident" id="8351825">Fatalf</span><span class="op" id="8351831">(</span><span class="string" id="8351832">&#34;ListenTCP&nbsp;on&nbsp;:0:&nbsp;%v&#34;</span><span class="op" id="8351853">,</span>&nbsp;<span class="ident" id="8351855">err</span><span class="op" id="8351858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8351861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8351864">defer</span>&nbsp;<span class="ident" id="8351870">ln</span><span class="op" id="8351872">.</span><span class="ident" id="8351873">Close</span><span class="op" id="8351878">(</span><span class="op" id="8351879">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8351883">lnquit</span>&nbsp;<span class="op" id="8351890">:=</span>&nbsp;<span class="builtinfunc" id="8351893">make</span><span class="op" id="8351897">(</span><span class="keyword" id="8351898">chan</span>&nbsp;<span class="builtintype" id="8351903">bool</span><span class="op" id="8351907">)</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8351911">go</span>&nbsp;<span class="keyword" id="8351914">func</span><span class="op" id="8351918">(</span><span class="op" id="8351919">)</span>&nbsp;<span class="op" id="8351921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8351925">c</span><span class="op" id="8351926">,</span>&nbsp;<span class="ident" id="8351928">err</span>&nbsp;<span class="op" id="8351932">:=</span>&nbsp;<span class="ident" id="8351935">ln</span><span class="op" id="8351937">.</span><span class="ident" id="8351938">Accept</span><span class="op" id="8351944">(</span><span class="op" id="8351945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8351949">if</span>&nbsp;<span class="ident" id="8351952">err</span>&nbsp;<span class="op" id="8351956">!=</span>&nbsp;<span class="ident" id="8351959">nil</span>&nbsp;<span class="op" id="8351963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8351968">t</span><span class="op" id="8351969">.</span><span class="ident" id="8351970">Errorf</span><span class="op" id="8351976">(</span><span class="string" id="8351977">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="8351989">,</span>&nbsp;<span class="ident" id="8351991">err</span><span class="op" id="8351994">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8351999">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8352008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8352012">defer</span>&nbsp;<span class="ident" id="8352018">c</span><span class="op" id="8352019">.</span><span class="ident" id="8352020">Close</span><span class="op" id="8352025">(</span><span class="op" id="8352026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352030">lnquit</span>&nbsp;<span class="op" id="8352037">&lt;-</span>&nbsp;<span class="builtintype" id="8352040">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8352046">}</span><span class="op" id="8352047">(</span><span class="op" id="8352048">)</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352052">c</span><span class="op" id="8352053">,</span>&nbsp;<span class="ident" id="8352055">err</span>&nbsp;<span class="op" id="8352059">:=</span>&nbsp;<span class="ident" id="8352062">Dial</span><span class="op" id="8352066">(</span><span class="string" id="8352067">&#34;tcp&#34;</span><span class="op" id="8352072">,</span>&nbsp;<span class="ident" id="8352074">ln</span><span class="op" id="8352076">.</span><span class="ident" id="8352077">Addr</span><span class="op" id="8352081">(</span><span class="op" id="8352082">)</span><span class="op" id="8352083">.</span><span class="ident" id="8352084">String</span><span class="op" id="8352090">(</span><span class="op" id="8352091">)</span><span class="op" id="8352092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8352095">if</span>&nbsp;<span class="ident" id="8352098">err</span>&nbsp;<span class="op" id="8352102">!=</span>&nbsp;<span class="ident" id="8352105">nil</span>&nbsp;<span class="op" id="8352109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352113">t</span><span class="op" id="8352114">.</span><span class="ident" id="8352115">Fatalf</span><span class="op" id="8352121">(</span><span class="string" id="8352122">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="8352132">,</span>&nbsp;<span class="ident" id="8352134">err</span><span class="op" id="8352137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8352140">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8352143">defer</span>&nbsp;<span class="ident" id="8352149">c</span><span class="op" id="8352150">.</span><span class="ident" id="8352151">Close</span><span class="op" id="8352156">(</span><span class="op" id="8352157">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352161">start</span>&nbsp;<span class="op" id="8352167">:=</span>&nbsp;<span class="ident" id="8352170">time</span><span class="op" id="8352174">.</span><span class="ident" id="8352175">Now</span><span class="op" id="8352178">(</span><span class="op" id="8352179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352182">err</span>&nbsp;<span class="op" id="8352186">=</span>&nbsp;<span class="ident" id="8352188">c</span><span class="op" id="8352189">.</span><span class="ident" id="8352190">SetReadDeadline</span><span class="op" id="8352205">(</span><span class="ident" id="8352206">start</span><span class="op" id="8352211">.</span><span class="ident" id="8352212">Add</span><span class="op" id="8352215">(</span><span class="ident" id="8352216">readTimeout</span><span class="op" id="8352227">)</span><span class="op" id="8352228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8352231">if</span>&nbsp;<span class="ident" id="8352234">err</span>&nbsp;<span class="op" id="8352238">!=</span>&nbsp;<span class="ident" id="8352241">nil</span>&nbsp;<span class="op" id="8352245">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352249">t</span><span class="op" id="8352250">.</span><span class="ident" id="8352251">Fatalf</span><span class="op" id="8352257">(</span><span class="string" id="8352258">&#34;SetReadDeadline:&nbsp;%v&#34;</span><span class="op" id="8352279">,</span>&nbsp;<span class="ident" id="8352281">err</span><span class="op" id="8352284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8352287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352290">err</span>&nbsp;<span class="op" id="8352294">=</span>&nbsp;<span class="ident" id="8352296">c</span><span class="op" id="8352297">.</span><span class="ident" id="8352298">SetWriteDeadline</span><span class="op" id="8352314">(</span><span class="ident" id="8352315">start</span><span class="op" id="8352320">.</span><span class="ident" id="8352321">Add</span><span class="op" id="8352324">(</span><span class="ident" id="8352325">writeTimeout</span><span class="op" id="8352337">)</span><span class="op" id="8352338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8352341">if</span>&nbsp;<span class="ident" id="8352344">err</span>&nbsp;<span class="op" id="8352348">!=</span>&nbsp;<span class="ident" id="8352351">nil</span>&nbsp;<span class="op" id="8352355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352359">t</span><span class="op" id="8352360">.</span><span class="ident" id="8352361">Fatalf</span><span class="op" id="8352367">(</span><span class="string" id="8352368">&#34;SetWriteDeadline:&nbsp;%v&#34;</span><span class="op" id="8352390">,</span>&nbsp;<span class="ident" id="8352392">err</span><span class="op" id="8352395">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8352398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352402">quit</span>&nbsp;<span class="op" id="8352407">:=</span>&nbsp;<span class="builtinfunc" id="8352410">make</span><span class="op" id="8352414">(</span><span class="keyword" id="8352415">chan</span>&nbsp;<span class="builtintype" id="8352420">bool</span><span class="op" id="8352424">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8352428">go</span>&nbsp;<span class="keyword" id="8352431">func</span><span class="op" id="8352435">(</span><span class="op" id="8352436">)</span>&nbsp;<span class="op" id="8352438">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8352442">var</span>&nbsp;<span class="ident" id="8352446">buf</span>&nbsp;<span class="op" id="8352450">[</span><span class="num" id="8352451">10</span><span class="op" id="8352453">]</span><span class="builtintype" id="8352454">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352461">_</span><span class="op" id="8352462">,</span>&nbsp;<span class="ident" id="8352464">err</span>&nbsp;<span class="op" id="8352468">:=</span>&nbsp;<span class="ident" id="8352471">c</span><span class="op" id="8352472">.</span><span class="ident" id="8352473">Read</span><span class="op" id="8352477">(</span><span class="ident" id="8352478">buf</span><span class="op" id="8352481">[</span><span class="op" id="8352482">:</span><span class="op" id="8352483">]</span><span class="op" id="8352484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8352488">if</span>&nbsp;<span class="ident" id="8352491">err</span>&nbsp;<span class="op" id="8352495">==</span>&nbsp;<span class="ident" id="8352498">nil</span>&nbsp;<span class="op" id="8352502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352507">t</span><span class="op" id="8352508">.</span><span class="ident" id="8352509">Errorf</span><span class="op" id="8352515">(</span><span class="string" id="8352516">&#34;Read&nbsp;should&nbsp;not&nbsp;succeed&#34;</span><span class="op" id="8352541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8352545">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352549">checkTimeout</span><span class="op" id="8352561">(</span><span class="string" id="8352562">&#34;Read&#34;</span><span class="op" id="8352568">,</span>&nbsp;<span class="ident" id="8352570">start</span><span class="op" id="8352575">,</span>&nbsp;<span class="ident" id="8352577">readTimeout</span><span class="op" id="8352588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352592">quit</span>&nbsp;<span class="op" id="8352597">&lt;-</span>&nbsp;<span class="builtintype" id="8352600">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8352606">}</span><span class="op" id="8352607">(</span><span class="op" id="8352608">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8352612">go</span>&nbsp;<span class="keyword" id="8352615">func</span><span class="op" id="8352619">(</span><span class="op" id="8352620">)</span>&nbsp;<span class="op" id="8352622">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8352626">var</span>&nbsp;<span class="ident" id="8352630">buf</span>&nbsp;<span class="op" id="8352634">[</span><span class="num" id="8352635">10000</span><span class="op" id="8352640">]</span><span class="builtintype" id="8352641">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8352648">for</span>&nbsp;<span class="op" id="8352652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352657">_</span><span class="op" id="8352658">,</span>&nbsp;<span class="ident" id="8352660">err</span>&nbsp;<span class="op" id="8352664">:=</span>&nbsp;<span class="ident" id="8352667">c</span><span class="op" id="8352668">.</span><span class="ident" id="8352669">Write</span><span class="op" id="8352674">(</span><span class="ident" id="8352675">buf</span><span class="op" id="8352678">[</span><span class="op" id="8352679">:</span><span class="op" id="8352680">]</span><span class="op" id="8352681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8352686">if</span>&nbsp;<span class="ident" id="8352689">err</span>&nbsp;<span class="op" id="8352693">!=</span>&nbsp;<span class="ident" id="8352696">nil</span>&nbsp;<span class="op" id="8352700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8352706">break</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8352715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8352719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352723">checkTimeout</span><span class="op" id="8352735">(</span><span class="string" id="8352736">&#34;Write&#34;</span><span class="op" id="8352743">,</span>&nbsp;<span class="ident" id="8352745">start</span><span class="op" id="8352750">,</span>&nbsp;<span class="ident" id="8352752">writeTimeout</span><span class="op" id="8352764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352768">quit</span>&nbsp;<span class="op" id="8352773">&lt;-</span>&nbsp;<span class="builtintype" id="8352776">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8352782">}</span><span class="op" id="8352783">(</span><span class="op" id="8352784">)</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8352788">&lt;-</span><span class="ident" id="8352790">quit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8352796">&lt;-</span><span class="ident" id="8352798">quit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8352804">&lt;-</span><span class="ident" id="8352806">lnquit</span><br>
<span class="lineno"></span><span class="op" id="8352813">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="8352816">type</span>&nbsp;<span class="ident" id="8352821">neverEnding</span>&nbsp;<span class="builtintype" id="8352833">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8352839">func</span>&nbsp;<span class="op" id="8352844">(</span><span class="ident" id="8352845">b</span>&nbsp;<span class="ident" id="8352847">neverEnding</span><span class="op" id="8352858">)</span>&nbsp;<span class="ident" id="8352860">Read</span><span class="op" id="8352864">(</span><span class="ident" id="8352865">p</span>&nbsp;<span class="op" id="8352867">[</span><span class="op" id="8352868">]</span><span class="builtintype" id="8352869">byte</span><span class="op" id="8352873">)</span>&nbsp;<span class="op" id="8352875">(</span><span class="ident" id="8352876">n</span>&nbsp;<span class="builtintype" id="8352878">int</span><span class="op" id="8352881">,</span>&nbsp;<span class="ident" id="8352883">err</span>&nbsp;<span class="builtintype" id="8352887">error</span><span class="op" id="8352892">)</span>&nbsp;<span class="op" id="8352894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8352897">for</span>&nbsp;<span class="ident" id="8352901">i</span>&nbsp;<span class="op" id="8352903">:=</span>&nbsp;<span class="keyword" id="8352906">range</span>&nbsp;<span class="ident" id="8352912">p</span>&nbsp;<span class="op" id="8352914">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352918">p</span><span class="op" id="8352919">[</span><span class="ident" id="8352920">i</span><span class="op" id="8352921">]</span>&nbsp;<span class="op" id="8352923">=</span>&nbsp;<span class="builtintype" id="8352925">byte</span><span class="op" id="8352929">(</span><span class="ident" id="8352930">b</span><span class="op" id="8352931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8352934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8352937">return</span>&nbsp;<span class="builtinfunc" id="8352944">len</span><span class="op" id="8352947">(</span><span class="ident" id="8352948">p</span><span class="op" id="8352949">)</span><span class="op" id="8352950">,</span>&nbsp;<span class="ident" id="8352952">nil</span><br>
<span class="lineno"></span><span class="op" id="8352956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="keyword" id="8352959">func</span>&nbsp;<span class="ident" id="8352964">TestVariousDeadlines1Proc</span><span class="op" id="8352989">(</span><span class="ident" id="8352990">t</span>&nbsp;<span class="op" id="8352992">*</span><span class="ident" id="8352993">testing</span><span class="op" id="8353000">.</span><span class="ident" id="8353001">T</span><span class="op" id="8353002">)</span>&nbsp;<span class="op" id="8353004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8353007">testVariousDeadlines</span><span class="op" id="8353027">(</span><span class="ident" id="8353028">t</span><span class="op" id="8353029">,</span>&nbsp;<span class="num" id="8353031">1</span><span class="op" id="8353032">)</span><br>
<span class="lineno"></span><span class="op" id="8353034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8353037">func</span>&nbsp;<span class="ident" id="8353042">TestVariousDeadlines4Proc</span><span class="op" id="8353067">(</span><span class="ident" id="8353068">t</span>&nbsp;<span class="op" id="8353070">*</span><span class="ident" id="8353071">testing</span><span class="op" id="8353078">.</span><span class="ident" id="8353079">T</span><span class="op" id="8353080">)</span>&nbsp;<span class="op" id="8353082">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8353085">testVariousDeadlines</span><span class="op" id="8353105">(</span><span class="ident" id="8353106">t</span><span class="op" id="8353107">,</span>&nbsp;<span class="num" id="8353109">4</span><span class="op" id="8353110">)</span><br>
<span class="lineno"></span><span class="op" id="8353112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8353115">func</span>&nbsp;<span class="ident" id="8353120">testVariousDeadlines</span><span class="op" id="8353140">(</span><span class="ident" id="8353141">t</span>&nbsp;<span class="op" id="8353143">*</span><span class="ident" id="8353144">testing</span><span class="op" id="8353151">.</span><span class="ident" id="8353152">T</span><span class="op" id="8353153">,</span>&nbsp;<span class="ident" id="8353155">maxProcs</span>&nbsp;<span class="builtintype" id="8353164">int</span><span class="op" id="8353167">)</span>&nbsp;<span class="op" id="8353169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8353172">switch</span>&nbsp;<span class="ident" id="8353179">runtime</span><span class="op" id="8353186">.</span><span class="ident" id="8353187">GOOS</span>&nbsp;<span class="op" id="8353192">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8353195">case</span>&nbsp;<span class="string" id="8353200">&#34;plan9&#34;</span><span class="op" id="8353207">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8353211">t</span><span class="op" id="8353212">.</span><span class="ident" id="8353213">Skipf</span><span class="op" id="8353218">(</span><span class="string" id="8353219">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8353240">,</span>&nbsp;<span class="ident" id="8353242">runtime</span><span class="op" id="8353249">.</span><span class="ident" id="8353250">GOOS</span><span class="op" id="8353254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8353257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8353261">defer</span>&nbsp;<span class="ident" id="8353267">runtime</span><span class="op" id="8353274">.</span><span class="ident" id="8353275">GOMAXPROCS</span><span class="op" id="8353285">(</span><span class="ident" id="8353286">runtime</span><span class="op" id="8353293">.</span><span class="ident" id="8353294">GOMAXPROCS</span><span class="op" id="8353304">(</span><span class="ident" id="8353305">maxProcs</span><span class="op" id="8353313">)</span><span class="op" id="8353314">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8353317">ln</span>&nbsp;<span class="op" id="8353320">:=</span>&nbsp;<span class="ident" id="8353323">newLocalListener</span><span class="op" id="8353339">(</span><span class="ident" id="8353340">t</span><span class="op" id="8353341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8353344">defer</span>&nbsp;<span class="ident" id="8353350">ln</span><span class="op" id="8353352">.</span><span class="ident" id="8353353">Close</span><span class="op" id="8353358">(</span><span class="op" id="8353359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8353362">acceptc</span>&nbsp;<span class="op" id="8353370">:=</span>&nbsp;<span class="builtinfunc" id="8353373">make</span><span class="op" id="8353377">(</span><span class="keyword" id="8353378">chan</span>&nbsp;<span class="builtintype" id="8353383">error</span><span class="op" id="8353388">,</span>&nbsp;<span class="num" id="8353390">1</span><span class="op" id="8353391">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8353395">//&nbsp;The&nbsp;server,&nbsp;with&nbsp;no&nbsp;timeouts&nbsp;of&nbsp;its&nbsp;own,&nbsp;sending&nbsp;bytes&nbsp;to&nbsp;clients</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8353465">//&nbsp;as&nbsp;fast&nbsp;as&nbsp;it&nbsp;can.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8353488">servec</span>&nbsp;<span class="op" id="8353495">:=</span>&nbsp;<span class="builtinfunc" id="8353498">make</span><span class="op" id="8353502">(</span><span class="keyword" id="8353503">chan</span>&nbsp;<span class="ident" id="8353508">copyRes</span><span class="op" id="8353515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8353518">go</span>&nbsp;<span class="keyword" id="8353521">func</span><span class="op" id="8353525">(</span><span class="op" id="8353526">)</span>&nbsp;<span class="op" id="8353528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8353532">for</span>&nbsp;<span class="op" id="8353536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8353541">c</span><span class="op" id="8353542">,</span>&nbsp;<span class="ident" id="8353544">err</span>&nbsp;<span class="op" id="8353548">:=</span>&nbsp;<span class="ident" id="8353551">ln</span><span class="op" id="8353553">.</span><span class="ident" id="8353554">Accept</span><span class="op" id="8353560">(</span><span class="op" id="8353561">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8353566">if</span>&nbsp;<span class="ident" id="8353569">err</span>&nbsp;<span class="op" id="8353573">!=</span>&nbsp;<span class="ident" id="8353576">nil</span>&nbsp;<span class="op" id="8353580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8353586">acceptc</span>&nbsp;<span class="op" id="8353594">&lt;-</span>&nbsp;<span class="ident" id="8353597">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8353605">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8353615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8353620">go</span>&nbsp;<span class="keyword" id="8353623">func</span><span class="op" id="8353627">(</span><span class="op" id="8353628">)</span>&nbsp;<span class="op" id="8353630">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8353636">t0</span>&nbsp;<span class="op" id="8353639">:=</span>&nbsp;<span class="ident" id="8353642">time</span><span class="op" id="8353646">.</span><span class="ident" id="8353647">Now</span><span class="op" id="8353650">(</span><span class="op" id="8353651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8353657">n</span><span class="op" id="8353658">,</span>&nbsp;<span class="ident" id="8353660">err</span>&nbsp;<span class="op" id="8353664">:=</span>&nbsp;<span class="ident" id="8353667">io</span><span class="op" id="8353669">.</span><span class="ident" id="8353670">Copy</span><span class="op" id="8353674">(</span><span class="ident" id="8353675">c</span><span class="op" id="8353676">,</span>&nbsp;<span class="ident" id="8353678">neverEnding</span><span class="op" id="8353689">(</span><span class="string" id="8353690">&#39;a&#39;</span><span class="op" id="8353693">)</span><span class="op" id="8353694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8353700">d</span>&nbsp;<span class="op" id="8353702">:=</span>&nbsp;<span class="ident" id="8353705">time</span><span class="op" id="8353709">.</span><span class="ident" id="8353710">Since</span><span class="op" id="8353715">(</span><span class="ident" id="8353716">t0</span><span class="op" id="8353718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8353724">c</span><span class="op" id="8353725">.</span><span class="ident" id="8353726">Close</span><span class="op" id="8353731">(</span><span class="op" id="8353732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8353738">servec</span>&nbsp;<span class="op" id="8353745">&lt;-</span>&nbsp;<span class="ident" id="8353748">copyRes</span><span class="op" id="8353755">{</span><span class="ident" id="8353756">n</span><span class="op" id="8353757">,</span>&nbsp;<span class="ident" id="8353759">err</span><span class="op" id="8353762">,</span>&nbsp;<span class="ident" id="8353764">d</span><span class="op" id="8353765">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8353770">}</span><span class="op" id="8353771">(</span><span class="op" id="8353772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8353776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8353779">}</span><span class="op" id="8353780">(</span><span class="op" id="8353781">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8353785">for</span>&nbsp;<span class="ident" id="8353789">_</span><span class="op" id="8353790">,</span>&nbsp;<span class="ident" id="8353792">timeout</span>&nbsp;<span class="op" id="8353800">:=</span>&nbsp;<span class="keyword" id="8353803">range</span>&nbsp;<span class="op" id="8353809">[</span><span class="op" id="8353810">]</span><span class="ident" id="8353811">time</span><span class="op" id="8353815">.</span><span class="ident" id="8353816">Duration</span><span class="op" id="8353824">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8353828">1</span>&nbsp;<span class="op" id="8353830">*</span>&nbsp;<span class="ident" id="8353832">time</span><span class="op" id="8353836">.</span><span class="ident" id="8353837">Nanosecond</span><span class="op" id="8353847">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8353851">2</span>&nbsp;<span class="op" id="8353853">*</span>&nbsp;<span class="ident" id="8353855">time</span><span class="op" id="8353859">.</span><span class="ident" id="8353860">Nanosecond</span><span class="op" id="8353870">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8353874">5</span>&nbsp;<span class="op" id="8353876">*</span>&nbsp;<span class="ident" id="8353878">time</span><span class="op" id="8353882">.</span><span class="ident" id="8353883">Nanosecond</span><span class="op" id="8353893">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8353897">50</span>&nbsp;<span class="op" id="8353900">*</span>&nbsp;<span class="ident" id="8353902">time</span><span class="op" id="8353906">.</span><span class="ident" id="8353907">Nanosecond</span><span class="op" id="8353917">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8353921">100</span>&nbsp;<span class="op" id="8353925">*</span>&nbsp;<span class="ident" id="8353927">time</span><span class="op" id="8353931">.</span><span class="ident" id="8353932">Nanosecond</span><span class="op" id="8353942">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8353946">200</span>&nbsp;<span class="op" id="8353950">*</span>&nbsp;<span class="ident" id="8353952">time</span><span class="op" id="8353956">.</span><span class="ident" id="8353957">Nanosecond</span><span class="op" id="8353967">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8353971">500</span>&nbsp;<span class="op" id="8353975">*</span>&nbsp;<span class="ident" id="8353977">time</span><span class="op" id="8353981">.</span><span class="ident" id="8353982">Nanosecond</span><span class="op" id="8353992">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8353996">750</span>&nbsp;<span class="op" id="8354000">*</span>&nbsp;<span class="ident" id="8354002">time</span><span class="op" id="8354006">.</span><span class="ident" id="8354007">Nanosecond</span><span class="op" id="8354017">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8354021">1</span>&nbsp;<span class="op" id="8354023">*</span>&nbsp;<span class="ident" id="8354025">time</span><span class="op" id="8354029">.</span><span class="ident" id="8354030">Microsecond</span><span class="op" id="8354041">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8354045">5</span>&nbsp;<span class="op" id="8354047">*</span>&nbsp;<span class="ident" id="8354049">time</span><span class="op" id="8354053">.</span><span class="ident" id="8354054">Microsecond</span><span class="op" id="8354065">,</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8354069">25</span>&nbsp;<span class="op" id="8354072">*</span>&nbsp;<span class="ident" id="8354074">time</span><span class="op" id="8354078">.</span><span class="ident" id="8354079">Microsecond</span><span class="op" id="8354090">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8354094">250</span>&nbsp;<span class="op" id="8354098">*</span>&nbsp;<span class="ident" id="8354100">time</span><span class="op" id="8354104">.</span><span class="ident" id="8354105">Microsecond</span><span class="op" id="8354116">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8354120">500</span>&nbsp;<span class="op" id="8354124">*</span>&nbsp;<span class="ident" id="8354126">time</span><span class="op" id="8354130">.</span><span class="ident" id="8354131">Microsecond</span><span class="op" id="8354142">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8354146">1</span>&nbsp;<span class="op" id="8354148">*</span>&nbsp;<span class="ident" id="8354150">time</span><span class="op" id="8354154">.</span><span class="ident" id="8354155">Millisecond</span><span class="op" id="8354166">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8354170">5</span>&nbsp;<span class="op" id="8354172">*</span>&nbsp;<span class="ident" id="8354174">time</span><span class="op" id="8354178">.</span><span class="ident" id="8354179">Millisecond</span><span class="op" id="8354190">,</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8354194">100</span>&nbsp;<span class="op" id="8354198">*</span>&nbsp;<span class="ident" id="8354200">time</span><span class="op" id="8354204">.</span><span class="ident" id="8354205">Millisecond</span><span class="op" id="8354216">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8354220">250</span>&nbsp;<span class="op" id="8354224">*</span>&nbsp;<span class="ident" id="8354226">time</span><span class="op" id="8354230">.</span><span class="ident" id="8354231">Millisecond</span><span class="op" id="8354242">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8354246">500</span>&nbsp;<span class="op" id="8354250">*</span>&nbsp;<span class="ident" id="8354252">time</span><span class="op" id="8354256">.</span><span class="ident" id="8354257">Millisecond</span><span class="op" id="8354268">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8354272">1</span>&nbsp;<span class="op" id="8354274">*</span>&nbsp;<span class="ident" id="8354276">time</span><span class="op" id="8354280">.</span><span class="ident" id="8354281">Second</span><span class="op" id="8354287">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8354290">}</span>&nbsp;<span class="op" id="8354292">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8354296">numRuns</span>&nbsp;<span class="op" id="8354304">:=</span>&nbsp;<span class="num" id="8354307">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8354311">if</span>&nbsp;<span class="ident" id="8354314">testing</span><span class="op" id="8354321">.</span><span class="ident" id="8354322">Short</span><span class="op" id="8354327">(</span><span class="op" id="8354328">)</span>&nbsp;<span class="op" id="8354330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8354335">numRuns</span>&nbsp;<span class="op" id="8354343">=</span>&nbsp;<span class="num" id="8354345">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8354350">if</span>&nbsp;<span class="ident" id="8354353">timeout</span>&nbsp;<span class="op" id="8354361">&gt;</span>&nbsp;<span class="num" id="8354363">500</span><span class="op" id="8354366">*</span><span class="ident" id="8354367">time</span><span class="op" id="8354371">.</span><span class="ident" id="8354372">Microsecond</span>&nbsp;<span class="op" id="8354384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8354390">continue</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8354402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8354406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8354410">for</span>&nbsp;<span class="ident" id="8354414">run</span>&nbsp;<span class="op" id="8354418">:=</span>&nbsp;<span class="num" id="8354421">0</span><span class="op" id="8354422">;</span>&nbsp;<span class="ident" id="8354424">run</span>&nbsp;<span class="op" id="8354428">&lt;</span>&nbsp;<span class="ident" id="8354430">numRuns</span><span class="op" id="8354437">;</span>&nbsp;<span class="ident" id="8354439">run</span><span class="op" id="8354442">++</span>&nbsp;<span class="op" id="8354445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8354450">name</span>&nbsp;<span class="op" id="8354455">:=</span>&nbsp;<span class="ident" id="8354458">fmt</span><span class="op" id="8354461">.</span><span class="ident" id="8354462">Sprintf</span><span class="op" id="8354469">(</span><span class="string" id="8354470">&#34;%v&nbsp;run&nbsp;%d/%d&#34;</span><span class="op" id="8354484">,</span>&nbsp;<span class="ident" id="8354486">timeout</span><span class="op" id="8354493">,</span>&nbsp;<span class="ident" id="8354495">run</span><span class="op" id="8354498">+</span><span class="num" id="8354499">1</span><span class="op" id="8354500">,</span>&nbsp;<span class="ident" id="8354502">numRuns</span><span class="op" id="8354509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8354514">t</span><span class="op" id="8354515">.</span><span class="ident" id="8354516">Log</span><span class="op" id="8354519">(</span><span class="ident" id="8354520">name</span><span class="op" id="8354524">)</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8354530">c</span><span class="op" id="8354531">,</span>&nbsp;<span class="ident" id="8354533">err</span>&nbsp;<span class="op" id="8354537">:=</span>&nbsp;<span class="ident" id="8354540">Dial</span><span class="op" id="8354544">(</span><span class="string" id="8354545">&#34;tcp&#34;</span><span class="op" id="8354550">,</span>&nbsp;<span class="ident" id="8354552">ln</span><span class="op" id="8354554">.</span><span class="ident" id="8354555">Addr</span><span class="op" id="8354559">(</span><span class="op" id="8354560">)</span><span class="op" id="8354561">.</span><span class="ident" id="8354562">String</span><span class="op" id="8354568">(</span><span class="op" id="8354569">)</span><span class="op" id="8354570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8354575">if</span>&nbsp;<span class="ident" id="8354578">err</span>&nbsp;<span class="op" id="8354582">!=</span>&nbsp;<span class="ident" id="8354585">nil</span>&nbsp;<span class="op" id="8354589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8354595">t</span><span class="op" id="8354596">.</span><span class="ident" id="8354597">Fatalf</span><span class="op" id="8354603">(</span><span class="string" id="8354604">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="8354614">,</span>&nbsp;<span class="ident" id="8354616">err</span><span class="op" id="8354619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8354624">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8354629">clientc</span>&nbsp;<span class="op" id="8354637">:=</span>&nbsp;<span class="builtinfunc" id="8354640">make</span><span class="op" id="8354644">(</span><span class="keyword" id="8354645">chan</span>&nbsp;<span class="ident" id="8354650">copyRes</span><span class="op" id="8354657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8354662">go</span>&nbsp;<span class="keyword" id="8354665">func</span><span class="op" id="8354669">(</span><span class="op" id="8354670">)</span>&nbsp;<span class="op" id="8354672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8354678">t0</span>&nbsp;<span class="op" id="8354681">:=</span>&nbsp;<span class="ident" id="8354684">time</span><span class="op" id="8354688">.</span><span class="ident" id="8354689">Now</span><span class="op" id="8354692">(</span><span class="op" id="8354693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8354699">c</span><span class="op" id="8354700">.</span><span class="ident" id="8354701">SetDeadline</span><span class="op" id="8354712">(</span><span class="ident" id="8354713">t0</span><span class="op" id="8354715">.</span><span class="ident" id="8354716">Add</span><span class="op" id="8354719">(</span><span class="ident" id="8354720">timeout</span><span class="op" id="8354727">)</span><span class="op" id="8354728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8354734">n</span><span class="op" id="8354735">,</span>&nbsp;<span class="ident" id="8354737">err</span>&nbsp;<span class="op" id="8354741">:=</span>&nbsp;<span class="ident" id="8354744">io</span><span class="op" id="8354746">.</span><span class="ident" id="8354747">Copy</span><span class="op" id="8354751">(</span><span class="ident" id="8354752">ioutil</span><span class="op" id="8354758">.</span><span class="ident" id="8354759">Discard</span><span class="op" id="8354766">,</span>&nbsp;<span class="ident" id="8354768">c</span><span class="op" id="8354769">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8354775">d</span>&nbsp;<span class="op" id="8354777">:=</span>&nbsp;<span class="ident" id="8354780">time</span><span class="op" id="8354784">.</span><span class="ident" id="8354785">Since</span><span class="op" id="8354790">(</span><span class="ident" id="8354791">t0</span><span class="op" id="8354793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8354799">c</span><span class="op" id="8354800">.</span><span class="ident" id="8354801">Close</span><span class="op" id="8354806">(</span><span class="op" id="8354807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8354813">clientc</span>&nbsp;<span class="op" id="8354821">&lt;-</span>&nbsp;<span class="ident" id="8354824">copyRes</span><span class="op" id="8354831">{</span><span class="ident" id="8354832">n</span><span class="op" id="8354833">,</span>&nbsp;<span class="ident" id="8354835">err</span><span class="op" id="8354838">,</span>&nbsp;<span class="ident" id="8354840">d</span><span class="op" id="8354841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8354846">}</span><span class="op" id="8354847">(</span><span class="op" id="8354848">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8354854">tooLong</span>&nbsp;<span class="op" id="8354862">:=</span>&nbsp;<span class="num" id="8354865">5</span>&nbsp;<span class="op" id="8354867">*</span>&nbsp;<span class="ident" id="8354869">time</span><span class="op" id="8354873">.</span><span class="ident" id="8354874">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8354884">select</span>&nbsp;<span class="op" id="8354891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8354896">case</span>&nbsp;<span class="ident" id="8354901">res</span>&nbsp;<span class="op" id="8354905">:=</span>&nbsp;<span class="op" id="8354908">&lt;-</span><span class="ident" id="8354910">clientc</span><span class="op" id="8354917">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8354923">if</span>&nbsp;<span class="ident" id="8354926">isTimeout</span><span class="op" id="8354935">(</span><span class="ident" id="8354936">res</span><span class="op" id="8354939">.</span><span class="ident" id="8354940">err</span><span class="op" id="8354943">)</span>&nbsp;<span class="op" id="8354945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8354952">t</span><span class="op" id="8354953">.</span><span class="ident" id="8354954">Logf</span><span class="op" id="8354958">(</span><span class="string" id="8354959">&#34;for&nbsp;%v,&nbsp;good&nbsp;client&nbsp;timeout&nbsp;after&nbsp;%v,&nbsp;reading&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="8355015">,</span>&nbsp;<span class="ident" id="8355017">name</span><span class="op" id="8355021">,</span>&nbsp;<span class="ident" id="8355023">res</span><span class="op" id="8355026">.</span><span class="ident" id="8355027">d</span><span class="op" id="8355028">,</span>&nbsp;<span class="ident" id="8355030">res</span><span class="op" id="8355033">.</span><span class="ident" id="8355034">n</span><span class="op" id="8355035">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8355041">}</span>&nbsp;<span class="keyword" id="8355043">else</span>&nbsp;<span class="op" id="8355048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8355055">t</span><span class="op" id="8355056">.</span><span class="ident" id="8355057">Fatalf</span><span class="op" id="8355063">(</span><span class="string" id="8355064">&#34;for&nbsp;%v:&nbsp;client&nbsp;Copy&nbsp;=&nbsp;%d,&nbsp;%v&nbsp;(want&nbsp;timeout)&#34;</span><span class="op" id="8355109">,</span>&nbsp;<span class="ident" id="8355111">name</span><span class="op" id="8355115">,</span>&nbsp;<span class="ident" id="8355117">res</span><span class="op" id="8355120">.</span><span class="ident" id="8355121">n</span><span class="op" id="8355122">,</span>&nbsp;<span class="ident" id="8355124">res</span><span class="op" id="8355127">.</span><span class="ident" id="8355128">err</span><span class="op" id="8355131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8355137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8355142">case</span>&nbsp;<span class="op" id="8355147">&lt;-</span><span class="ident" id="8355149">time</span><span class="op" id="8355153">.</span><span class="ident" id="8355154">After</span><span class="op" id="8355159">(</span><span class="ident" id="8355160">tooLong</span><span class="op" id="8355167">)</span><span class="op" id="8355168">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8355174">t</span><span class="op" id="8355175">.</span><span class="ident" id="8355176">Fatalf</span><span class="op" id="8355182">(</span><span class="string" id="8355183">&#34;for&nbsp;%v:&nbsp;timeout&nbsp;(%v)&nbsp;waiting&nbsp;for&nbsp;client&nbsp;to&nbsp;timeout&nbsp;(%v)&nbsp;reading&#34;</span><span class="op" id="8355248">,</span>&nbsp;<span class="ident" id="8355250">name</span><span class="op" id="8355254">,</span>&nbsp;<span class="ident" id="8355256">tooLong</span><span class="op" id="8355263">,</span>&nbsp;<span class="ident" id="8355265">timeout</span><span class="op" id="8355272">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8355277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8355283">select</span>&nbsp;<span class="op" id="8355290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8355295">case</span>&nbsp;<span class="ident" id="8355300">res</span>&nbsp;<span class="op" id="8355304">:=</span>&nbsp;<span class="op" id="8355307">&lt;-</span><span class="ident" id="8355309">servec</span><span class="op" id="8355315">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8355321">t</span><span class="op" id="8355322">.</span><span class="ident" id="8355323">Logf</span><span class="op" id="8355327">(</span><span class="string" id="8355328">&#34;for&nbsp;%v:&nbsp;server&nbsp;in&nbsp;%v&nbsp;wrote&nbsp;%d,&nbsp;%v&#34;</span><span class="op" id="8355363">,</span>&nbsp;<span class="ident" id="8355365">name</span><span class="op" id="8355369">,</span>&nbsp;<span class="ident" id="8355371">res</span><span class="op" id="8355374">.</span><span class="ident" id="8355375">d</span><span class="op" id="8355376">,</span>&nbsp;<span class="ident" id="8355378">res</span><span class="op" id="8355381">.</span><span class="ident" id="8355382">n</span><span class="op" id="8355383">,</span>&nbsp;<span class="ident" id="8355385">res</span><span class="op" id="8355388">.</span><span class="ident" id="8355389">err</span><span class="op" id="8355392">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8355397">case</span>&nbsp;<span class="ident" id="8355402">err</span>&nbsp;<span class="op" id="8355406">:=</span>&nbsp;<span class="op" id="8355409">&lt;-</span><span class="ident" id="8355411">acceptc</span><span class="op" id="8355418">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8355424">t</span><span class="op" id="8355425">.</span><span class="ident" id="8355426">Fatalf</span><span class="op" id="8355432">(</span><span class="string" id="8355433">&#34;for&nbsp;%v:&nbsp;server&nbsp;Accept&nbsp;=&nbsp;%v&#34;</span><span class="op" id="8355461">,</span>&nbsp;<span class="ident" id="8355463">name</span><span class="op" id="8355467">,</span>&nbsp;<span class="ident" id="8355469">err</span><span class="op" id="8355472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8355477">case</span>&nbsp;<span class="op" id="8355482">&lt;-</span><span class="ident" id="8355484">time</span><span class="op" id="8355488">.</span><span class="ident" id="8355489">After</span><span class="op" id="8355494">(</span><span class="ident" id="8355495">tooLong</span><span class="op" id="8355502">)</span><span class="op" id="8355503">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8355509">t</span><span class="op" id="8355510">.</span><span class="ident" id="8355511">Fatalf</span><span class="op" id="8355517">(</span><span class="string" id="8355518">&#34;for&nbsp;%v,&nbsp;timeout&nbsp;waiting&nbsp;for&nbsp;server&nbsp;to&nbsp;finish&nbsp;writing&#34;</span><span class="op" id="8355572">,</span>&nbsp;<span class="ident" id="8355574">name</span><span class="op" id="8355578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8355583">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8355587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8355590">}</span><br>
<span class="lineno"></span><span class="op" id="8355592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8355595">//&nbsp;TestReadDeadlineDataAvailable&nbsp;tests&nbsp;that&nbsp;read&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">525</span><span class="comment" id="8355665">//&nbsp;if&nbsp;there&#39;s&nbsp;data&nbsp;ready&nbsp;to&nbsp;be&nbsp;read.</span><br>
<span class="lineno"></span><span class="keyword" id="8355702">func</span>&nbsp;<span class="ident" id="8355707">TestReadDeadlineDataAvailable</span><span class="op" id="8355736">(</span><span class="ident" id="8355737">t</span>&nbsp;<span class="op" id="8355739">*</span><span class="ident" id="8355740">testing</span><span class="op" id="8355747">.</span><span class="ident" id="8355748">T</span><span class="op" id="8355749">)</span>&nbsp;<span class="op" id="8355751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8355754">switch</span>&nbsp;<span class="ident" id="8355761">runtime</span><span class="op" id="8355768">.</span><span class="ident" id="8355769">GOOS</span>&nbsp;<span class="op" id="8355774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8355777">case</span>&nbsp;<span class="string" id="8355782">&#34;plan9&#34;</span><span class="op" id="8355789">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8355793">t</span><span class="op" id="8355794">.</span><span class="ident" id="8355795">Skipf</span><span class="op" id="8355800">(</span><span class="string" id="8355801">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8355822">,</span>&nbsp;<span class="ident" id="8355824">runtime</span><span class="op" id="8355831">.</span><span class="ident" id="8355832">GOOS</span><span class="op" id="8355836">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8355839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8355843">ln</span>&nbsp;<span class="op" id="8355846">:=</span>&nbsp;<span class="ident" id="8355849">newLocalListener</span><span class="op" id="8355865">(</span><span class="ident" id="8355866">t</span><span class="op" id="8355867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8355870">defer</span>&nbsp;<span class="ident" id="8355876">ln</span><span class="op" id="8355878">.</span><span class="ident" id="8355879">Close</span><span class="op" id="8355884">(</span><span class="op" id="8355885">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8355889">servec</span>&nbsp;<span class="op" id="8355896">:=</span>&nbsp;<span class="builtinfunc" id="8355899">make</span><span class="op" id="8355903">(</span><span class="keyword" id="8355904">chan</span>&nbsp;<span class="ident" id="8355909">copyRes</span><span class="op" id="8355916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8355919">const</span>&nbsp;<span class="ident" id="8355925">msg</span>&nbsp;<span class="op" id="8355929">=</span>&nbsp;<span class="string" id="8355931">&#34;data&nbsp;client&nbsp;shouldn&#39;t&nbsp;read,&nbsp;even&nbsp;though&nbsp;it&#39;ll&nbsp;be&nbsp;waiting&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8355991">go</span>&nbsp;<span class="keyword" id="8355994">func</span><span class="op" id="8355998">(</span><span class="op" id="8355999">)</span>&nbsp;<span class="op" id="8356001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356005">c</span><span class="op" id="8356006">,</span>&nbsp;<span class="ident" id="8356008">err</span>&nbsp;<span class="op" id="8356012">:=</span>&nbsp;<span class="ident" id="8356015">ln</span><span class="op" id="8356017">.</span><span class="ident" id="8356018">Accept</span><span class="op" id="8356024">(</span><span class="op" id="8356025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8356029">if</span>&nbsp;<span class="ident" id="8356032">err</span>&nbsp;<span class="op" id="8356036">!=</span>&nbsp;<span class="ident" id="8356039">nil</span>&nbsp;<span class="op" id="8356043">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356048">t</span><span class="op" id="8356049">.</span><span class="ident" id="8356050">Errorf</span><span class="op" id="8356056">(</span><span class="string" id="8356057">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="8356069">,</span>&nbsp;<span class="ident" id="8356071">err</span><span class="op" id="8356074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8356079">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8356088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8356092">defer</span>&nbsp;<span class="ident" id="8356098">c</span><span class="op" id="8356099">.</span><span class="ident" id="8356100">Close</span><span class="op" id="8356105">(</span><span class="op" id="8356106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356110">n</span><span class="op" id="8356111">,</span>&nbsp;<span class="ident" id="8356113">err</span>&nbsp;<span class="op" id="8356117">:=</span>&nbsp;<span class="ident" id="8356120">c</span><span class="op" id="8356121">.</span><span class="ident" id="8356122">Write</span><span class="op" id="8356127">(</span><span class="op" id="8356128">[</span><span class="op" id="8356129">]</span><span class="builtintype" id="8356130">byte</span><span class="op" id="8356134">(</span><span class="ident" id="8356135">msg</span><span class="op" id="8356138">)</span><span class="op" id="8356139">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356143">servec</span>&nbsp;<span class="op" id="8356150">&lt;-</span>&nbsp;<span class="ident" id="8356153">copyRes</span><span class="op" id="8356160">{</span><span class="ident" id="8356161">n</span><span class="op" id="8356162">:</span>&nbsp;<span class="ident" id="8356164">int64</span><span class="op" id="8356169">(</span><span class="ident" id="8356170">n</span><span class="op" id="8356171">)</span><span class="op" id="8356172">,</span>&nbsp;<span class="ident" id="8356174">err</span><span class="op" id="8356177">:</span>&nbsp;<span class="ident" id="8356179">err</span><span class="op" id="8356182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8356185">}</span><span class="op" id="8356186">(</span><span class="op" id="8356187">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356191">c</span><span class="op" id="8356192">,</span>&nbsp;<span class="ident" id="8356194">err</span>&nbsp;<span class="op" id="8356198">:=</span>&nbsp;<span class="ident" id="8356201">Dial</span><span class="op" id="8356205">(</span><span class="string" id="8356206">&#34;tcp&#34;</span><span class="op" id="8356211">,</span>&nbsp;<span class="ident" id="8356213">ln</span><span class="op" id="8356215">.</span><span class="ident" id="8356216">Addr</span><span class="op" id="8356220">(</span><span class="op" id="8356221">)</span><span class="op" id="8356222">.</span><span class="ident" id="8356223">String</span><span class="op" id="8356229">(</span><span class="op" id="8356230">)</span><span class="op" id="8356231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8356234">if</span>&nbsp;<span class="ident" id="8356237">err</span>&nbsp;<span class="op" id="8356241">!=</span>&nbsp;<span class="ident" id="8356244">nil</span>&nbsp;<span class="op" id="8356248">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356252">t</span><span class="op" id="8356253">.</span><span class="ident" id="8356254">Fatalf</span><span class="op" id="8356260">(</span><span class="string" id="8356261">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="8356271">,</span>&nbsp;<span class="ident" id="8356273">err</span><span class="op" id="8356276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8356279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8356282">defer</span>&nbsp;<span class="ident" id="8356288">c</span><span class="op" id="8356289">.</span><span class="ident" id="8356290">Close</span><span class="op" id="8356295">(</span><span class="op" id="8356296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8356299">if</span>&nbsp;<span class="ident" id="8356302">res</span>&nbsp;<span class="op" id="8356306">:=</span>&nbsp;<span class="op" id="8356309">&lt;-</span><span class="ident" id="8356311">servec</span><span class="op" id="8356317">;</span>&nbsp;<span class="ident" id="8356319">res</span><span class="op" id="8356322">.</span><span class="ident" id="8356323">err</span>&nbsp;<span class="op" id="8356327">!=</span>&nbsp;<span class="ident" id="8356330">nil</span>&nbsp;<span class="op" id="8356334">||</span>&nbsp;<span class="ident" id="8356337">res</span><span class="op" id="8356340">.</span><span class="ident" id="8356341">n</span>&nbsp;<span class="op" id="8356343">!=</span>&nbsp;<span class="ident" id="8356346">int64</span><span class="op" id="8356351">(</span><span class="builtinfunc" id="8356352">len</span><span class="op" id="8356355">(</span><span class="ident" id="8356356">msg</span><span class="op" id="8356359">)</span><span class="op" id="8356360">)</span>&nbsp;<span class="op" id="8356362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356366">t</span><span class="op" id="8356367">.</span><span class="ident" id="8356368">Fatalf</span><span class="op" id="8356374">(</span><span class="string" id="8356375">&#34;unexpected&nbsp;server&nbsp;Write:&nbsp;n=%d,&nbsp;err=%v;&nbsp;want&nbsp;n=%d,&nbsp;err=nil&#34;</span><span class="op" id="8356434">,</span>&nbsp;<span class="ident" id="8356436">res</span><span class="op" id="8356439">.</span><span class="ident" id="8356440">n</span><span class="op" id="8356441">,</span>&nbsp;<span class="ident" id="8356443">res</span><span class="op" id="8356446">.</span><span class="ident" id="8356447">err</span><span class="op" id="8356450">,</span>&nbsp;<span class="builtinfunc" id="8356452">len</span><span class="op" id="8356455">(</span><span class="ident" id="8356456">msg</span><span class="op" id="8356459">)</span><span class="op" id="8356460">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8356463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356466">c</span><span class="op" id="8356467">.</span><span class="ident" id="8356468">SetReadDeadline</span><span class="op" id="8356483">(</span><span class="ident" id="8356484">time</span><span class="op" id="8356488">.</span><span class="ident" id="8356489">Now</span><span class="op" id="8356492">(</span><span class="op" id="8356493">)</span><span class="op" id="8356494">.</span><span class="ident" id="8356495">Add</span><span class="op" id="8356498">(</span><span class="op" id="8356499">-</span><span class="num" id="8356500">5</span>&nbsp;<span class="op" id="8356502">*</span>&nbsp;<span class="ident" id="8356504">time</span><span class="op" id="8356508">.</span><span class="ident" id="8356509">Second</span><span class="op" id="8356515">)</span><span class="op" id="8356516">)</span>&nbsp;<span class="comment" id="8356518">//&nbsp;in&nbsp;the&nbsp;psat.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356535">buf</span>&nbsp;<span class="op" id="8356539">:=</span>&nbsp;<span class="builtinfunc" id="8356542">make</span><span class="op" id="8356546">(</span><span class="op" id="8356547">[</span><span class="op" id="8356548">]</span><span class="builtintype" id="8356549">byte</span><span class="op" id="8356553">,</span>&nbsp;<span class="builtinfunc" id="8356555">len</span><span class="op" id="8356558">(</span><span class="ident" id="8356559">msg</span><span class="op" id="8356562">)</span><span class="op" id="8356563">/</span><span class="num" id="8356564">2</span><span class="op" id="8356565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356568">n</span><span class="op" id="8356569">,</span>&nbsp;<span class="ident" id="8356571">err</span>&nbsp;<span class="op" id="8356575">:=</span>&nbsp;<span class="ident" id="8356578">c</span><span class="op" id="8356579">.</span><span class="ident" id="8356580">Read</span><span class="op" id="8356584">(</span><span class="ident" id="8356585">buf</span><span class="op" id="8356588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8356591">if</span>&nbsp;<span class="ident" id="8356594">n</span>&nbsp;<span class="op" id="8356596">&gt;</span>&nbsp;<span class="num" id="8356598">0</span>&nbsp;<span class="op" id="8356600">||</span>&nbsp;<span class="op" id="8356603">!</span><span class="ident" id="8356604">isTimeout</span><span class="op" id="8356613">(</span><span class="ident" id="8356614">err</span><span class="op" id="8356617">)</span>&nbsp;<span class="op" id="8356619">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356623">t</span><span class="op" id="8356624">.</span><span class="ident" id="8356625">Fatalf</span><span class="op" id="8356631">(</span><span class="string" id="8356632">&#34;client&nbsp;read&nbsp;=&nbsp;%d&nbsp;(%q)&nbsp;err=%v;&nbsp;want&nbsp;0,&nbsp;timeout&#34;</span><span class="op" id="8356679">,</span>&nbsp;<span class="ident" id="8356681">n</span><span class="op" id="8356682">,</span>&nbsp;<span class="ident" id="8356684">buf</span><span class="op" id="8356687">[</span><span class="op" id="8356688">:</span><span class="ident" id="8356689">n</span><span class="op" id="8356690">]</span><span class="op" id="8356691">,</span>&nbsp;<span class="ident" id="8356693">err</span><span class="op" id="8356696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8356699">}</span><br>
<span class="lineno"></span><span class="op" id="8356701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8356704">//&nbsp;TestWriteDeadlineBufferAvailable&nbsp;tests&nbsp;that&nbsp;write&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">565</span><span class="comment" id="8356778">//&nbsp;if&nbsp;there&#39;s&nbsp;buffer&nbsp;space&nbsp;available&nbsp;to&nbsp;write.</span><br>
<span class="lineno"></span><span class="keyword" id="8356825">func</span>&nbsp;<span class="ident" id="8356830">TestWriteDeadlineBufferAvailable</span><span class="op" id="8356862">(</span><span class="ident" id="8356863">t</span>&nbsp;<span class="op" id="8356865">*</span><span class="ident" id="8356866">testing</span><span class="op" id="8356873">.</span><span class="ident" id="8356874">T</span><span class="op" id="8356875">)</span>&nbsp;<span class="op" id="8356877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8356880">switch</span>&nbsp;<span class="ident" id="8356887">runtime</span><span class="op" id="8356894">.</span><span class="ident" id="8356895">GOOS</span>&nbsp;<span class="op" id="8356900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8356903">case</span>&nbsp;<span class="string" id="8356908">&#34;plan9&#34;</span><span class="op" id="8356915">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356919">t</span><span class="op" id="8356920">.</span><span class="ident" id="8356921">Skipf</span><span class="op" id="8356926">(</span><span class="string" id="8356927">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8356948">,</span>&nbsp;<span class="ident" id="8356950">runtime</span><span class="op" id="8356957">.</span><span class="ident" id="8356958">GOOS</span><span class="op" id="8356962">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8356965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8356969">ln</span>&nbsp;<span class="op" id="8356972">:=</span>&nbsp;<span class="ident" id="8356975">newLocalListener</span><span class="op" id="8356991">(</span><span class="ident" id="8356992">t</span><span class="op" id="8356993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8356996">defer</span>&nbsp;<span class="ident" id="8357002">ln</span><span class="op" id="8357004">.</span><span class="ident" id="8357005">Close</span><span class="op" id="8357010">(</span><span class="op" id="8357011">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357015">servec</span>&nbsp;<span class="op" id="8357022">:=</span>&nbsp;<span class="builtinfunc" id="8357025">make</span><span class="op" id="8357029">(</span><span class="keyword" id="8357030">chan</span>&nbsp;<span class="ident" id="8357035">copyRes</span><span class="op" id="8357042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8357045">go</span>&nbsp;<span class="keyword" id="8357048">func</span><span class="op" id="8357052">(</span><span class="op" id="8357053">)</span>&nbsp;<span class="op" id="8357055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357059">c</span><span class="op" id="8357060">,</span>&nbsp;<span class="ident" id="8357062">err</span>&nbsp;<span class="op" id="8357066">:=</span>&nbsp;<span class="ident" id="8357069">ln</span><span class="op" id="8357071">.</span><span class="ident" id="8357072">Accept</span><span class="op" id="8357078">(</span><span class="op" id="8357079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8357083">if</span>&nbsp;<span class="ident" id="8357086">err</span>&nbsp;<span class="op" id="8357090">!=</span>&nbsp;<span class="ident" id="8357093">nil</span>&nbsp;<span class="op" id="8357097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357102">t</span><span class="op" id="8357103">.</span><span class="ident" id="8357104">Errorf</span><span class="op" id="8357110">(</span><span class="string" id="8357111">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="8357123">,</span>&nbsp;<span class="ident" id="8357125">err</span><span class="op" id="8357128">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8357133">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8357142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8357146">defer</span>&nbsp;<span class="ident" id="8357152">c</span><span class="op" id="8357153">.</span><span class="ident" id="8357154">Close</span><span class="op" id="8357159">(</span><span class="op" id="8357160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357164">c</span><span class="op" id="8357165">.</span><span class="ident" id="8357166">SetWriteDeadline</span><span class="op" id="8357182">(</span><span class="ident" id="8357183">time</span><span class="op" id="8357187">.</span><span class="ident" id="8357188">Now</span><span class="op" id="8357191">(</span><span class="op" id="8357192">)</span><span class="op" id="8357193">.</span><span class="ident" id="8357194">Add</span><span class="op" id="8357197">(</span><span class="op" id="8357198">-</span><span class="num" id="8357199">5</span>&nbsp;<span class="op" id="8357201">*</span>&nbsp;<span class="ident" id="8357203">time</span><span class="op" id="8357207">.</span><span class="ident" id="8357208">Second</span><span class="op" id="8357214">)</span><span class="op" id="8357215">)</span>&nbsp;<span class="comment" id="8357217">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357234">n</span><span class="op" id="8357235">,</span>&nbsp;<span class="ident" id="8357237">err</span>&nbsp;<span class="op" id="8357241">:=</span>&nbsp;<span class="ident" id="8357244">c</span><span class="op" id="8357245">.</span><span class="ident" id="8357246">Write</span><span class="op" id="8357251">(</span><span class="op" id="8357252">[</span><span class="op" id="8357253">]</span><span class="builtintype" id="8357254">byte</span><span class="op" id="8357258">{</span><span class="string" id="8357259">&#39;x&#39;</span><span class="op" id="8357262">}</span><span class="op" id="8357263">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357267">servec</span>&nbsp;<span class="op" id="8357274">&lt;-</span>&nbsp;<span class="ident" id="8357277">copyRes</span><span class="op" id="8357284">{</span><span class="ident" id="8357285">n</span><span class="op" id="8357286">:</span>&nbsp;<span class="ident" id="8357288">int64</span><span class="op" id="8357293">(</span><span class="ident" id="8357294">n</span><span class="op" id="8357295">)</span><span class="op" id="8357296">,</span>&nbsp;<span class="ident" id="8357298">err</span><span class="op" id="8357301">:</span>&nbsp;<span class="ident" id="8357303">err</span><span class="op" id="8357306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8357309">}</span><span class="op" id="8357310">(</span><span class="op" id="8357311">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357315">c</span><span class="op" id="8357316">,</span>&nbsp;<span class="ident" id="8357318">err</span>&nbsp;<span class="op" id="8357322">:=</span>&nbsp;<span class="ident" id="8357325">Dial</span><span class="op" id="8357329">(</span><span class="string" id="8357330">&#34;tcp&#34;</span><span class="op" id="8357335">,</span>&nbsp;<span class="ident" id="8357337">ln</span><span class="op" id="8357339">.</span><span class="ident" id="8357340">Addr</span><span class="op" id="8357344">(</span><span class="op" id="8357345">)</span><span class="op" id="8357346">.</span><span class="ident" id="8357347">String</span><span class="op" id="8357353">(</span><span class="op" id="8357354">)</span><span class="op" id="8357355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8357358">if</span>&nbsp;<span class="ident" id="8357361">err</span>&nbsp;<span class="op" id="8357365">!=</span>&nbsp;<span class="ident" id="8357368">nil</span>&nbsp;<span class="op" id="8357372">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357376">t</span><span class="op" id="8357377">.</span><span class="ident" id="8357378">Fatalf</span><span class="op" id="8357384">(</span><span class="string" id="8357385">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="8357395">,</span>&nbsp;<span class="ident" id="8357397">err</span><span class="op" id="8357400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8357403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8357406">defer</span>&nbsp;<span class="ident" id="8357412">c</span><span class="op" id="8357413">.</span><span class="ident" id="8357414">Close</span><span class="op" id="8357419">(</span><span class="op" id="8357420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357423">res</span>&nbsp;<span class="op" id="8357427">:=</span>&nbsp;<span class="op" id="8357430">&lt;-</span><span class="ident" id="8357432">servec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8357440">if</span>&nbsp;<span class="ident" id="8357443">res</span><span class="op" id="8357446">.</span><span class="ident" id="8357447">n</span>&nbsp;<span class="op" id="8357449">!=</span>&nbsp;<span class="num" id="8357452">0</span>&nbsp;<span class="op" id="8357454">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357458">t</span><span class="op" id="8357459">.</span><span class="ident" id="8357460">Errorf</span><span class="op" id="8357466">(</span><span class="string" id="8357467">&#34;Write&nbsp;=&nbsp;%d;&nbsp;want&nbsp;0&#34;</span><span class="op" id="8357487">,</span>&nbsp;<span class="ident" id="8357489">res</span><span class="op" id="8357492">.</span><span class="ident" id="8357493">n</span><span class="op" id="8357494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8357497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8357500">if</span>&nbsp;<span class="op" id="8357503">!</span><span class="ident" id="8357504">isTimeout</span><span class="op" id="8357513">(</span><span class="ident" id="8357514">res</span><span class="op" id="8357517">.</span><span class="ident" id="8357518">err</span><span class="op" id="8357521">)</span>&nbsp;<span class="op" id="8357523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357527">t</span><span class="op" id="8357528">.</span><span class="ident" id="8357529">Errorf</span><span class="op" id="8357535">(</span><span class="string" id="8357536">&#34;Write&nbsp;error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="8357568">,</span>&nbsp;<span class="ident" id="8357570">res</span><span class="op" id="8357573">.</span><span class="ident" id="8357574">err</span><span class="op" id="8357577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8357580">}</span><br>
<span class="lineno">600</span><span class="op" id="8357582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8357585">//&nbsp;TestAcceptDeadlineConnectionAvailable&nbsp;tests&nbsp;that&nbsp;accept&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno"></span><span class="comment" id="8357665">//&nbsp;if&nbsp;there&#39;s&nbsp;incoming&nbsp;connections&nbsp;available.</span><br>
<span class="lineno"></span><span class="keyword" id="8357711">func</span>&nbsp;<span class="ident" id="8357716">TestAcceptDeadlineConnectionAvailable</span><span class="op" id="8357753">(</span><span class="ident" id="8357754">t</span>&nbsp;<span class="op" id="8357756">*</span><span class="ident" id="8357757">testing</span><span class="op" id="8357764">.</span><span class="ident" id="8357765">T</span><span class="op" id="8357766">)</span>&nbsp;<span class="op" id="8357768">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8357771">switch</span>&nbsp;<span class="ident" id="8357778">runtime</span><span class="op" id="8357785">.</span><span class="ident" id="8357786">GOOS</span>&nbsp;<span class="op" id="8357791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8357794">case</span>&nbsp;<span class="string" id="8357799">&#34;plan9&#34;</span><span class="op" id="8357806">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357810">t</span><span class="op" id="8357811">.</span><span class="ident" id="8357812">Skipf</span><span class="op" id="8357817">(</span><span class="string" id="8357818">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8357839">,</span>&nbsp;<span class="ident" id="8357841">runtime</span><span class="op" id="8357848">.</span><span class="ident" id="8357849">GOOS</span><span class="op" id="8357853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8357856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357860">ln</span>&nbsp;<span class="op" id="8357863">:=</span>&nbsp;<span class="ident" id="8357866">newLocalListener</span><span class="op" id="8357882">(</span><span class="ident" id="8357883">t</span><span class="op" id="8357884">)</span><span class="op" id="8357885">.</span><span class="op" id="8357886">(</span><span class="op" id="8357887">*</span><span class="ident" id="8357888">TCPListener</span><span class="op" id="8357899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8357902">defer</span>&nbsp;<span class="ident" id="8357908">ln</span><span class="op" id="8357910">.</span><span class="ident" id="8357911">Close</span><span class="op" id="8357916">(</span><span class="op" id="8357917">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8357921">go</span>&nbsp;<span class="keyword" id="8357924">func</span><span class="op" id="8357928">(</span><span class="op" id="8357929">)</span>&nbsp;<span class="op" id="8357931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357935">c</span><span class="op" id="8357936">,</span>&nbsp;<span class="ident" id="8357938">err</span>&nbsp;<span class="op" id="8357942">:=</span>&nbsp;<span class="ident" id="8357945">Dial</span><span class="op" id="8357949">(</span><span class="string" id="8357950">&#34;tcp&#34;</span><span class="op" id="8357955">,</span>&nbsp;<span class="ident" id="8357957">ln</span><span class="op" id="8357959">.</span><span class="ident" id="8357960">Addr</span><span class="op" id="8357964">(</span><span class="op" id="8357965">)</span><span class="op" id="8357966">.</span><span class="ident" id="8357967">String</span><span class="op" id="8357973">(</span><span class="op" id="8357974">)</span><span class="op" id="8357975">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8357979">if</span>&nbsp;<span class="ident" id="8357982">err</span>&nbsp;<span class="op" id="8357986">!=</span>&nbsp;<span class="ident" id="8357989">nil</span>&nbsp;<span class="op" id="8357993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357998">t</span><span class="op" id="8357999">.</span><span class="ident" id="8358000">Errorf</span><span class="op" id="8358006">(</span><span class="string" id="8358007">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="8358017">,</span>&nbsp;<span class="ident" id="8358019">err</span><span class="op" id="8358022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358027">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8358036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358040">defer</span>&nbsp;<span class="ident" id="8358046">c</span><span class="op" id="8358047">.</span><span class="ident" id="8358048">Close</span><span class="op" id="8358053">(</span><span class="op" id="8358054">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358058">var</span>&nbsp;<span class="ident" id="8358062">buf</span>&nbsp;<span class="op" id="8358066">[</span><span class="num" id="8358067">1</span><span class="op" id="8358068">]</span><span class="builtintype" id="8358069">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358076">c</span><span class="op" id="8358077">.</span><span class="ident" id="8358078">Read</span><span class="op" id="8358082">(</span><span class="ident" id="8358083">buf</span><span class="op" id="8358086">[</span><span class="op" id="8358087">:</span><span class="op" id="8358088">]</span><span class="op" id="8358089">)</span>&nbsp;<span class="comment" id="8358091">//&nbsp;block&nbsp;until&nbsp;the&nbsp;connection&nbsp;or&nbsp;listener&nbsp;is&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8358144">}</span><span class="op" id="8358145">(</span><span class="op" id="8358146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358149">time</span><span class="op" id="8358153">.</span><span class="ident" id="8358154">Sleep</span><span class="op" id="8358159">(</span><span class="num" id="8358160">10</span>&nbsp;<span class="op" id="8358163">*</span>&nbsp;<span class="ident" id="8358165">time</span><span class="op" id="8358169">.</span><span class="ident" id="8358170">Millisecond</span><span class="op" id="8358181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358184">ln</span><span class="op" id="8358186">.</span><span class="ident" id="8358187">SetDeadline</span><span class="op" id="8358198">(</span><span class="ident" id="8358199">time</span><span class="op" id="8358203">.</span><span class="ident" id="8358204">Now</span><span class="op" id="8358207">(</span><span class="op" id="8358208">)</span><span class="op" id="8358209">.</span><span class="ident" id="8358210">Add</span><span class="op" id="8358213">(</span><span class="op" id="8358214">-</span><span class="num" id="8358215">5</span>&nbsp;<span class="op" id="8358217">*</span>&nbsp;<span class="ident" id="8358219">time</span><span class="op" id="8358223">.</span><span class="ident" id="8358224">Second</span><span class="op" id="8358230">)</span><span class="op" id="8358231">)</span>&nbsp;<span class="comment" id="8358233">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358249">c</span><span class="op" id="8358250">,</span>&nbsp;<span class="ident" id="8358252">err</span>&nbsp;<span class="op" id="8358256">:=</span>&nbsp;<span class="ident" id="8358259">ln</span><span class="op" id="8358261">.</span><span class="ident" id="8358262">Accept</span><span class="op" id="8358268">(</span><span class="op" id="8358269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358272">if</span>&nbsp;<span class="ident" id="8358275">err</span>&nbsp;<span class="op" id="8358279">==</span>&nbsp;<span class="ident" id="8358282">nil</span>&nbsp;<span class="op" id="8358286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358290">defer</span>&nbsp;<span class="ident" id="8358296">c</span><span class="op" id="8358297">.</span><span class="ident" id="8358298">Close</span><span class="op" id="8358303">(</span><span class="op" id="8358304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8358307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358310">if</span>&nbsp;<span class="op" id="8358313">!</span><span class="ident" id="8358314">isTimeout</span><span class="op" id="8358323">(</span><span class="ident" id="8358324">err</span><span class="op" id="8358327">)</span>&nbsp;<span class="op" id="8358329">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358333">t</span><span class="op" id="8358334">.</span><span class="ident" id="8358335">Fatalf</span><span class="op" id="8358341">(</span><span class="string" id="8358342">&#34;Accept:&nbsp;got&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="8358372">,</span>&nbsp;<span class="ident" id="8358374">err</span><span class="op" id="8358377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8358380">}</span><br>
<span class="lineno"></span><span class="op" id="8358382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8358385">//&nbsp;TestConnectDeadlineInThePast&nbsp;tests&nbsp;that&nbsp;connect&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">635</span><span class="comment" id="8358457">//&nbsp;if&nbsp;the&nbsp;connection&nbsp;can&nbsp;be&nbsp;established&nbsp;w/o&nbsp;blocking.</span><br>
<span class="lineno"></span><span class="keyword" id="8358511">func</span>&nbsp;<span class="ident" id="8358516">TestConnectDeadlineInThePast</span><span class="op" id="8358544">(</span><span class="ident" id="8358545">t</span>&nbsp;<span class="op" id="8358547">*</span><span class="ident" id="8358548">testing</span><span class="op" id="8358555">.</span><span class="ident" id="8358556">T</span><span class="op" id="8358557">)</span>&nbsp;<span class="op" id="8358559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358562">switch</span>&nbsp;<span class="ident" id="8358569">runtime</span><span class="op" id="8358576">.</span><span class="ident" id="8358577">GOOS</span>&nbsp;<span class="op" id="8358582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358585">case</span>&nbsp;<span class="string" id="8358590">&#34;plan9&#34;</span><span class="op" id="8358597">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358601">t</span><span class="op" id="8358602">.</span><span class="ident" id="8358603">Skipf</span><span class="op" id="8358608">(</span><span class="string" id="8358609">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8358630">,</span>&nbsp;<span class="ident" id="8358632">runtime</span><span class="op" id="8358639">.</span><span class="ident" id="8358640">GOOS</span><span class="op" id="8358644">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8358647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358651">ln</span>&nbsp;<span class="op" id="8358654">:=</span>&nbsp;<span class="ident" id="8358657">newLocalListener</span><span class="op" id="8358673">(</span><span class="ident" id="8358674">t</span><span class="op" id="8358675">)</span><span class="op" id="8358676">.</span><span class="op" id="8358677">(</span><span class="op" id="8358678">*</span><span class="ident" id="8358679">TCPListener</span><span class="op" id="8358690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358693">defer</span>&nbsp;<span class="ident" id="8358699">ln</span><span class="op" id="8358701">.</span><span class="ident" id="8358702">Close</span><span class="op" id="8358707">(</span><span class="op" id="8358708">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358712">go</span>&nbsp;<span class="keyword" id="8358715">func</span><span class="op" id="8358719">(</span><span class="op" id="8358720">)</span>&nbsp;<span class="op" id="8358722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358726">c</span><span class="op" id="8358727">,</span>&nbsp;<span class="ident" id="8358729">err</span>&nbsp;<span class="op" id="8358733">:=</span>&nbsp;<span class="ident" id="8358736">ln</span><span class="op" id="8358738">.</span><span class="ident" id="8358739">Accept</span><span class="op" id="8358745">(</span><span class="op" id="8358746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358750">if</span>&nbsp;<span class="ident" id="8358753">err</span>&nbsp;<span class="op" id="8358757">==</span>&nbsp;<span class="ident" id="8358760">nil</span>&nbsp;<span class="op" id="8358764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358769">defer</span>&nbsp;<span class="ident" id="8358775">c</span><span class="op" id="8358776">.</span><span class="ident" id="8358777">Close</span><span class="op" id="8358782">(</span><span class="op" id="8358783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8358787">}</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8358790">}</span><span class="op" id="8358791">(</span><span class="op" id="8358792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358795">time</span><span class="op" id="8358799">.</span><span class="ident" id="8358800">Sleep</span><span class="op" id="8358805">(</span><span class="num" id="8358806">10</span>&nbsp;<span class="op" id="8358809">*</span>&nbsp;<span class="ident" id="8358811">time</span><span class="op" id="8358815">.</span><span class="ident" id="8358816">Millisecond</span><span class="op" id="8358827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358830">c</span><span class="op" id="8358831">,</span>&nbsp;<span class="ident" id="8358833">err</span>&nbsp;<span class="op" id="8358837">:=</span>&nbsp;<span class="ident" id="8358840">DialTimeout</span><span class="op" id="8358851">(</span><span class="string" id="8358852">&#34;tcp&#34;</span><span class="op" id="8358857">,</span>&nbsp;<span class="ident" id="8358859">ln</span><span class="op" id="8358861">.</span><span class="ident" id="8358862">Addr</span><span class="op" id="8358866">(</span><span class="op" id="8358867">)</span><span class="op" id="8358868">.</span><span class="ident" id="8358869">String</span><span class="op" id="8358875">(</span><span class="op" id="8358876">)</span><span class="op" id="8358877">,</span>&nbsp;<span class="op" id="8358879">-</span><span class="num" id="8358880">5</span><span class="op" id="8358881">*</span><span class="ident" id="8358882">time</span><span class="op" id="8358886">.</span><span class="ident" id="8358887">Second</span><span class="op" id="8358893">)</span>&nbsp;<span class="comment" id="8358895">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358911">if</span>&nbsp;<span class="ident" id="8358914">err</span>&nbsp;<span class="op" id="8358918">==</span>&nbsp;<span class="ident" id="8358921">nil</span>&nbsp;<span class="op" id="8358925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358929">defer</span>&nbsp;<span class="ident" id="8358935">c</span><span class="op" id="8358936">.</span><span class="ident" id="8358937">Close</span><span class="op" id="8358942">(</span><span class="op" id="8358943">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8358946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358949">if</span>&nbsp;<span class="op" id="8358952">!</span><span class="ident" id="8358953">isTimeout</span><span class="op" id="8358962">(</span><span class="ident" id="8358963">err</span><span class="op" id="8358966">)</span>&nbsp;<span class="op" id="8358968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358972">t</span><span class="op" id="8358973">.</span><span class="ident" id="8358974">Fatalf</span><span class="op" id="8358980">(</span><span class="string" id="8358981">&#34;DialTimeout:&nbsp;got&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="8359016">,</span>&nbsp;<span class="ident" id="8359018">err</span><span class="op" id="8359021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8359024">}</span><br>
<span class="lineno"></span><span class="op" id="8359026">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="comment" id="8359029">//&nbsp;TestProlongTimeout&nbsp;tests&nbsp;concurrent&nbsp;deadline&nbsp;modification.</span><br>
<span class="lineno"></span><span class="comment" id="8359091">//&nbsp;Known&nbsp;to&nbsp;cause&nbsp;data&nbsp;races&nbsp;in&nbsp;the&nbsp;past.</span><br>
<span class="lineno"></span><span class="keyword" id="8359133">func</span>&nbsp;<span class="ident" id="8359138">TestProlongTimeout</span><span class="op" id="8359156">(</span><span class="ident" id="8359157">t</span>&nbsp;<span class="op" id="8359159">*</span><span class="ident" id="8359160">testing</span><span class="op" id="8359167">.</span><span class="ident" id="8359168">T</span><span class="op" id="8359169">)</span>&nbsp;<span class="op" id="8359171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359174">switch</span>&nbsp;<span class="ident" id="8359181">runtime</span><span class="op" id="8359188">.</span><span class="ident" id="8359189">GOOS</span>&nbsp;<span class="op" id="8359194">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359197">case</span>&nbsp;<span class="string" id="8359202">&#34;plan9&#34;</span><span class="op" id="8359209">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359213">t</span><span class="op" id="8359214">.</span><span class="ident" id="8359215">Skipf</span><span class="op" id="8359220">(</span><span class="string" id="8359221">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8359242">,</span>&nbsp;<span class="ident" id="8359244">runtime</span><span class="op" id="8359251">.</span><span class="ident" id="8359252">GOOS</span><span class="op" id="8359256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8359259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359263">ln</span>&nbsp;<span class="op" id="8359266">:=</span>&nbsp;<span class="ident" id="8359269">newLocalListener</span><span class="op" id="8359285">(</span><span class="ident" id="8359286">t</span><span class="op" id="8359287">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359290">defer</span>&nbsp;<span class="ident" id="8359296">ln</span><span class="op" id="8359298">.</span><span class="ident" id="8359299">Close</span><span class="op" id="8359304">(</span><span class="op" id="8359305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359308">connected</span>&nbsp;<span class="op" id="8359318">:=</span>&nbsp;<span class="builtinfunc" id="8359321">make</span><span class="op" id="8359325">(</span><span class="keyword" id="8359326">chan</span>&nbsp;<span class="builtintype" id="8359331">bool</span><span class="op" id="8359335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359338">go</span>&nbsp;<span class="keyword" id="8359341">func</span><span class="op" id="8359345">(</span><span class="op" id="8359346">)</span>&nbsp;<span class="op" id="8359348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359352">s</span><span class="op" id="8359353">,</span>&nbsp;<span class="ident" id="8359355">err</span>&nbsp;<span class="op" id="8359359">:=</span>&nbsp;<span class="ident" id="8359362">ln</span><span class="op" id="8359364">.</span><span class="ident" id="8359365">Accept</span><span class="op" id="8359371">(</span><span class="op" id="8359372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359376">connected</span>&nbsp;<span class="op" id="8359386">&lt;-</span>&nbsp;<span class="builtintype" id="8359389">true</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359396">if</span>&nbsp;<span class="ident" id="8359399">err</span>&nbsp;<span class="op" id="8359403">!=</span>&nbsp;<span class="ident" id="8359406">nil</span>&nbsp;<span class="op" id="8359410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359415">t</span><span class="op" id="8359416">.</span><span class="ident" id="8359417">Errorf</span><span class="op" id="8359423">(</span><span class="string" id="8359424">&#34;ln.Accept:&nbsp;%v&#34;</span><span class="op" id="8359439">,</span>&nbsp;<span class="ident" id="8359441">err</span><span class="op" id="8359444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359449">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8359458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359462">defer</span>&nbsp;<span class="ident" id="8359468">s</span><span class="op" id="8359469">.</span><span class="ident" id="8359470">Close</span><span class="op" id="8359475">(</span><span class="op" id="8359476">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359480">s</span><span class="op" id="8359481">.</span><span class="ident" id="8359482">SetDeadline</span><span class="op" id="8359493">(</span><span class="ident" id="8359494">time</span><span class="op" id="8359498">.</span><span class="ident" id="8359499">Now</span><span class="op" id="8359502">(</span><span class="op" id="8359503">)</span><span class="op" id="8359504">.</span><span class="ident" id="8359505">Add</span><span class="op" id="8359508">(</span><span class="ident" id="8359509">time</span><span class="op" id="8359513">.</span><span class="ident" id="8359514">Hour</span><span class="op" id="8359518">)</span><span class="op" id="8359519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359523">go</span>&nbsp;<span class="keyword" id="8359526">func</span><span class="op" id="8359530">(</span><span class="op" id="8359531">)</span>&nbsp;<span class="op" id="8359533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359538">var</span>&nbsp;<span class="ident" id="8359542">buf</span>&nbsp;<span class="op" id="8359546">[</span><span class="num" id="8359547">4096</span><span class="op" id="8359551">]</span><span class="builtintype" id="8359552">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359560">for</span>&nbsp;<span class="op" id="8359564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359570">_</span><span class="op" id="8359571">,</span>&nbsp;<span class="ident" id="8359573">err</span>&nbsp;<span class="op" id="8359577">:=</span>&nbsp;<span class="ident" id="8359580">s</span><span class="op" id="8359581">.</span><span class="ident" id="8359582">Write</span><span class="op" id="8359587">(</span><span class="ident" id="8359588">buf</span><span class="op" id="8359591">[</span><span class="op" id="8359592">:</span><span class="op" id="8359593">]</span><span class="op" id="8359594">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359600">if</span>&nbsp;<span class="ident" id="8359603">err</span>&nbsp;<span class="op" id="8359607">!=</span>&nbsp;<span class="ident" id="8359610">nil</span>&nbsp;<span class="op" id="8359614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359621">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8359631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359637">s</span><span class="op" id="8359638">.</span><span class="ident" id="8359639">SetDeadline</span><span class="op" id="8359650">(</span><span class="ident" id="8359651">time</span><span class="op" id="8359655">.</span><span class="ident" id="8359656">Now</span><span class="op" id="8359659">(</span><span class="op" id="8359660">)</span><span class="op" id="8359661">.</span><span class="ident" id="8359662">Add</span><span class="op" id="8359665">(</span><span class="ident" id="8359666">time</span><span class="op" id="8359670">.</span><span class="ident" id="8359671">Hour</span><span class="op" id="8359675">)</span><span class="op" id="8359676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8359681">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8359685">}</span><span class="op" id="8359686">(</span><span class="op" id="8359687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359691">buf</span>&nbsp;<span class="op" id="8359695">:=</span>&nbsp;<span class="builtinfunc" id="8359698">make</span><span class="op" id="8359702">(</span><span class="op" id="8359703">[</span><span class="op" id="8359704">]</span><span class="builtintype" id="8359705">byte</span><span class="op" id="8359709">,</span>&nbsp;<span class="num" id="8359711">1</span><span class="op" id="8359712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359716">for</span>&nbsp;<span class="op" id="8359720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359725">_</span><span class="op" id="8359726">,</span>&nbsp;<span class="ident" id="8359728">err</span>&nbsp;<span class="op" id="8359732">:=</span>&nbsp;<span class="ident" id="8359735">s</span><span class="op" id="8359736">.</span><span class="ident" id="8359737">Read</span><span class="op" id="8359741">(</span><span class="ident" id="8359742">buf</span><span class="op" id="8359745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359750">if</span>&nbsp;<span class="ident" id="8359753">err</span>&nbsp;<span class="op" id="8359757">!=</span>&nbsp;<span class="ident" id="8359760">nil</span>&nbsp;<span class="op" id="8359764">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359770">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8359779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359784">s</span><span class="op" id="8359785">.</span><span class="ident" id="8359786">SetDeadline</span><span class="op" id="8359797">(</span><span class="ident" id="8359798">time</span><span class="op" id="8359802">.</span><span class="ident" id="8359803">Now</span><span class="op" id="8359806">(</span><span class="op" id="8359807">)</span><span class="op" id="8359808">.</span><span class="ident" id="8359809">Add</span><span class="op" id="8359812">(</span><span class="ident" id="8359813">time</span><span class="op" id="8359817">.</span><span class="ident" id="8359818">Hour</span><span class="op" id="8359822">)</span><span class="op" id="8359823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8359827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8359830">}</span><span class="op" id="8359831">(</span><span class="op" id="8359832">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359835">c</span><span class="op" id="8359836">,</span>&nbsp;<span class="ident" id="8359838">err</span>&nbsp;<span class="op" id="8359842">:=</span>&nbsp;<span class="ident" id="8359845">Dial</span><span class="op" id="8359849">(</span><span class="string" id="8359850">&#34;tcp&#34;</span><span class="op" id="8359855">,</span>&nbsp;<span class="ident" id="8359857">ln</span><span class="op" id="8359859">.</span><span class="ident" id="8359860">Addr</span><span class="op" id="8359864">(</span><span class="op" id="8359865">)</span><span class="op" id="8359866">.</span><span class="ident" id="8359867">String</span><span class="op" id="8359873">(</span><span class="op" id="8359874">)</span><span class="op" id="8359875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359878">if</span>&nbsp;<span class="ident" id="8359881">err</span>&nbsp;<span class="op" id="8359885">!=</span>&nbsp;<span class="ident" id="8359888">nil</span>&nbsp;<span class="op" id="8359892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359896">t</span><span class="op" id="8359897">.</span><span class="ident" id="8359898">Fatalf</span><span class="op" id="8359904">(</span><span class="string" id="8359905">&#34;DialTCP:&nbsp;%v&#34;</span><span class="op" id="8359918">,</span>&nbsp;<span class="ident" id="8359920">err</span><span class="op" id="8359923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8359926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359929">defer</span>&nbsp;<span class="ident" id="8359935">c</span><span class="op" id="8359936">.</span><span class="ident" id="8359937">Close</span><span class="op" id="8359942">(</span><span class="op" id="8359943">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8359946">&lt;-</span><span class="ident" id="8359948">connected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359959">for</span>&nbsp;<span class="ident" id="8359963">i</span>&nbsp;<span class="op" id="8359965">:=</span>&nbsp;<span class="num" id="8359968">0</span><span class="op" id="8359969">;</span>&nbsp;<span class="ident" id="8359971">i</span>&nbsp;<span class="op" id="8359973">&lt;</span>&nbsp;<span class="num" id="8359975">1024</span><span class="op" id="8359979">;</span>&nbsp;<span class="ident" id="8359981">i</span><span class="op" id="8359982">++</span>&nbsp;<span class="op" id="8359985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359989">var</span>&nbsp;<span class="ident" id="8359993">buf</span>&nbsp;<span class="op" id="8359997">[</span><span class="num" id="8359998">1</span><span class="op" id="8359999">]</span><span class="builtintype" id="8360000">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360007">c</span><span class="op" id="8360008">.</span><span class="ident" id="8360009">Write</span><span class="op" id="8360014">(</span><span class="ident" id="8360015">buf</span><span class="op" id="8360018">[</span><span class="op" id="8360019">:</span><span class="op" id="8360020">]</span><span class="op" id="8360021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8360024">}</span><br>
<span class="lineno">710</span><span class="op" id="8360026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8360029">func</span>&nbsp;<span class="ident" id="8360034">TestDeadlineRace</span><span class="op" id="8360050">(</span><span class="ident" id="8360051">t</span>&nbsp;<span class="op" id="8360053">*</span><span class="ident" id="8360054">testing</span><span class="op" id="8360061">.</span><span class="ident" id="8360062">T</span><span class="op" id="8360063">)</span>&nbsp;<span class="op" id="8360065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360068">switch</span>&nbsp;<span class="ident" id="8360075">runtime</span><span class="op" id="8360082">.</span><span class="ident" id="8360083">GOOS</span>&nbsp;<span class="op" id="8360088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360091">case</span>&nbsp;<span class="string" id="8360096">&#34;nacl&#34;</span><span class="op" id="8360102">,</span>&nbsp;<span class="string" id="8360104">&#34;plan9&#34;</span><span class="op" id="8360111">:</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360115">t</span><span class="op" id="8360116">.</span><span class="ident" id="8360117">Skipf</span><span class="op" id="8360122">(</span><span class="string" id="8360123">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8360144">,</span>&nbsp;<span class="ident" id="8360146">runtime</span><span class="op" id="8360153">.</span><span class="ident" id="8360154">GOOS</span><span class="op" id="8360158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8360161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360165">N</span>&nbsp;<span class="op" id="8360167">:=</span>&nbsp;<span class="num" id="8360170">1000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360176">if</span>&nbsp;<span class="ident" id="8360179">testing</span><span class="op" id="8360186">.</span><span class="ident" id="8360187">Short</span><span class="op" id="8360192">(</span><span class="op" id="8360193">)</span>&nbsp;<span class="op" id="8360195">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360199">N</span>&nbsp;<span class="op" id="8360201">=</span>&nbsp;<span class="num" id="8360203">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8360207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360210">defer</span>&nbsp;<span class="ident" id="8360216">runtime</span><span class="op" id="8360223">.</span><span class="ident" id="8360224">GOMAXPROCS</span><span class="op" id="8360234">(</span><span class="ident" id="8360235">runtime</span><span class="op" id="8360242">.</span><span class="ident" id="8360243">GOMAXPROCS</span><span class="op" id="8360253">(</span><span class="num" id="8360254">4</span><span class="op" id="8360255">)</span><span class="op" id="8360256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360259">ln</span>&nbsp;<span class="op" id="8360262">:=</span>&nbsp;<span class="ident" id="8360265">newLocalListener</span><span class="op" id="8360281">(</span><span class="ident" id="8360282">t</span><span class="op" id="8360283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360286">defer</span>&nbsp;<span class="ident" id="8360292">ln</span><span class="op" id="8360294">.</span><span class="ident" id="8360295">Close</span><span class="op" id="8360300">(</span><span class="op" id="8360301">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360304">c</span><span class="op" id="8360305">,</span>&nbsp;<span class="ident" id="8360307">err</span>&nbsp;<span class="op" id="8360311">:=</span>&nbsp;<span class="ident" id="8360314">Dial</span><span class="op" id="8360318">(</span><span class="string" id="8360319">&#34;tcp&#34;</span><span class="op" id="8360324">,</span>&nbsp;<span class="ident" id="8360326">ln</span><span class="op" id="8360328">.</span><span class="ident" id="8360329">Addr</span><span class="op" id="8360333">(</span><span class="op" id="8360334">)</span><span class="op" id="8360335">.</span><span class="ident" id="8360336">String</span><span class="op" id="8360342">(</span><span class="op" id="8360343">)</span><span class="op" id="8360344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360347">if</span>&nbsp;<span class="ident" id="8360350">err</span>&nbsp;<span class="op" id="8360354">!=</span>&nbsp;<span class="ident" id="8360357">nil</span>&nbsp;<span class="op" id="8360361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360365">t</span><span class="op" id="8360366">.</span><span class="ident" id="8360367">Fatalf</span><span class="op" id="8360373">(</span><span class="string" id="8360374">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="8360384">,</span>&nbsp;<span class="ident" id="8360386">err</span><span class="op" id="8360389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8360392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360395">defer</span>&nbsp;<span class="ident" id="8360401">c</span><span class="op" id="8360402">.</span><span class="ident" id="8360403">Close</span><span class="op" id="8360408">(</span><span class="op" id="8360409">)</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360412">done</span>&nbsp;<span class="op" id="8360417">:=</span>&nbsp;<span class="builtinfunc" id="8360420">make</span><span class="op" id="8360424">(</span><span class="keyword" id="8360425">chan</span>&nbsp;<span class="builtintype" id="8360430">bool</span><span class="op" id="8360434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360437">go</span>&nbsp;<span class="keyword" id="8360440">func</span><span class="op" id="8360444">(</span><span class="op" id="8360445">)</span>&nbsp;<span class="op" id="8360447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360451">t</span>&nbsp;<span class="op" id="8360453">:=</span>&nbsp;<span class="ident" id="8360456">time</span><span class="op" id="8360460">.</span><span class="ident" id="8360461">NewTicker</span><span class="op" id="8360470">(</span><span class="num" id="8360471">2</span>&nbsp;<span class="op" id="8360473">*</span>&nbsp;<span class="ident" id="8360475">time</span><span class="op" id="8360479">.</span><span class="ident" id="8360480">Microsecond</span><span class="op" id="8360491">)</span><span class="op" id="8360492">.</span><span class="ident" id="8360493">C</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360497">for</span>&nbsp;<span class="ident" id="8360501">i</span>&nbsp;<span class="op" id="8360503">:=</span>&nbsp;<span class="num" id="8360506">0</span><span class="op" id="8360507">;</span>&nbsp;<span class="ident" id="8360509">i</span>&nbsp;<span class="op" id="8360511">&lt;</span>&nbsp;<span class="ident" id="8360513">N</span><span class="op" id="8360514">;</span>&nbsp;<span class="ident" id="8360516">i</span><span class="op" id="8360517">++</span>&nbsp;<span class="op" id="8360520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360525">if</span>&nbsp;<span class="ident" id="8360528">err</span>&nbsp;<span class="op" id="8360532">:=</span>&nbsp;<span class="ident" id="8360535">c</span><span class="op" id="8360536">.</span><span class="ident" id="8360537">SetDeadline</span><span class="op" id="8360548">(</span><span class="ident" id="8360549">time</span><span class="op" id="8360553">.</span><span class="ident" id="8360554">Now</span><span class="op" id="8360557">(</span><span class="op" id="8360558">)</span><span class="op" id="8360559">.</span><span class="ident" id="8360560">Add</span><span class="op" id="8360563">(</span><span class="num" id="8360564">2</span>&nbsp;<span class="op" id="8360566">*</span>&nbsp;<span class="ident" id="8360568">time</span><span class="op" id="8360572">.</span><span class="ident" id="8360573">Microsecond</span><span class="op" id="8360584">)</span><span class="op" id="8360585">)</span><span class="op" id="8360586">;</span>&nbsp;<span class="ident" id="8360588">err</span>&nbsp;<span class="op" id="8360592">!=</span>&nbsp;<span class="ident" id="8360595">nil</span>&nbsp;<span class="op" id="8360599">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360605">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8360614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8360619">&lt;-</span><span class="ident" id="8360621">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8360625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360629">done</span>&nbsp;<span class="op" id="8360634">&lt;-</span>&nbsp;<span class="builtintype" id="8360637">true</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8360643">}</span><span class="op" id="8360644">(</span><span class="op" id="8360645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360648">var</span>&nbsp;<span class="ident" id="8360652">buf</span>&nbsp;<span class="op" id="8360656">[</span><span class="num" id="8360657">1</span><span class="op" id="8360658">]</span><span class="builtintype" id="8360659">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360665">for</span>&nbsp;<span class="ident" id="8360669">i</span>&nbsp;<span class="op" id="8360671">:=</span>&nbsp;<span class="num" id="8360674">0</span><span class="op" id="8360675">;</span>&nbsp;<span class="ident" id="8360677">i</span>&nbsp;<span class="op" id="8360679">&lt;</span>&nbsp;<span class="ident" id="8360681">N</span><span class="op" id="8360682">;</span>&nbsp;<span class="ident" id="8360684">i</span><span class="op" id="8360685">++</span>&nbsp;<span class="op" id="8360688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360692">c</span><span class="op" id="8360693">.</span><span class="ident" id="8360694">Read</span><span class="op" id="8360698">(</span><span class="ident" id="8360699">buf</span><span class="op" id="8360702">[</span><span class="op" id="8360703">:</span><span class="op" id="8360704">]</span><span class="op" id="8360705">)</span>&nbsp;<span class="comment" id="8360707">//&nbsp;ignore&nbsp;possible&nbsp;timeout&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8360742">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360745">c</span><span class="op" id="8360746">.</span><span class="ident" id="8360747">Close</span><span class="op" id="8360752">(</span><span class="op" id="8360753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8360756">&lt;-</span><span class="ident" id="8360758">done</span><br>
<span class="lineno"></span><span class="op" id="8360763">}</span>
</div>
</body>
</html>
