<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>reflect</h2>
<ul>
<li><a href="/gostd/reflect/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/reflect/deepequal.go.html">deepequal.go</a></li>
<li><a href="/gostd/reflect/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/reflect/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/reflect/makefunc.go.html" class="current">makefunc.go</a></li>
<li><a href="/gostd/reflect/set_test.go.html">set_test.go</a></li>
<li><a href="/gostd/reflect/tostring_test.go.html">tostring_test.go</a></li>
<li><a href="/gostd/reflect/type.go.html">type.go</a></li>
<li><a href="/gostd/reflect/value.go.html">value.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2669370">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2669426">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2669480">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2669531">//&nbsp;MakeFunc&nbsp;implementation.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2669560">package</span>&nbsp;<span class="ident" id="2669568">reflect</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2669577">import</span>&nbsp;<span class="op" id="2669584">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2669587">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="2669596">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2669599">//&nbsp;makeFuncImpl&nbsp;is&nbsp;the&nbsp;closure&nbsp;value&nbsp;implementing&nbsp;the&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="2669662">//&nbsp;returned&nbsp;by&nbsp;MakeFunc.</span><br>
<span class="lineno">15</span><span class="keyword" id="2669687">type</span>&nbsp;<span class="ident" id="2669692">makeFuncImpl</span>&nbsp;<span class="keyword" id="2669705">struct</span>&nbsp;<span class="op" id="2669712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2669715">code</span>&nbsp;&nbsp;<span class="builtintype" id="2669721">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2669730">stack</span>&nbsp;<span class="op" id="2669736">*</span><span class="ident" id="2669737">bitVector</span>&nbsp;<span class="comment" id="2669747">//&nbsp;stack&nbsp;bitmap&nbsp;for&nbsp;args&nbsp;-&nbsp;offset&nbsp;known&nbsp;to&nbsp;runtime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2669799">typ</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2669805">*</span><span class="ident" id="2669806">funcType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2669816">fn</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2669822">func</span><span class="op" id="2669826">(</span><span class="op" id="2669827">[</span><span class="op" id="2669828">]</span><span class="ident" id="2669829">Value</span><span class="op" id="2669834">)</span>&nbsp;<span class="op" id="2669836">[</span><span class="op" id="2669837">]</span><span class="ident" id="2669838">Value</span><br>
<span class="lineno">20</span><span class="op" id="2669844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2669847">//&nbsp;MakeFunc&nbsp;returns&nbsp;a&nbsp;new&nbsp;function&nbsp;of&nbsp;the&nbsp;given&nbsp;Type</span><br>
<span class="lineno"></span><span class="comment" id="2669900">//&nbsp;that&nbsp;wraps&nbsp;the&nbsp;function&nbsp;fn.&nbsp;When&nbsp;called,&nbsp;that&nbsp;new&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="2669962">//&nbsp;does&nbsp;the&nbsp;following:</span><br>
<span class="lineno">25</span><span class="comment" id="2669985">//</span><br>
<span class="lineno"></span><span class="comment" id="2669988">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;converts&nbsp;its&nbsp;arguments&nbsp;to&nbsp;a&nbsp;slice&nbsp;of&nbsp;Values.</span><br>
<span class="lineno"></span><span class="comment" id="2670038">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;runs&nbsp;results&nbsp;:=&nbsp;fn(args).</span><br>
<span class="lineno"></span><span class="comment" id="2670069">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;returns&nbsp;the&nbsp;results&nbsp;as&nbsp;a&nbsp;slice&nbsp;of&nbsp;Values,&nbsp;one&nbsp;per&nbsp;formal&nbsp;result.</span><br>
<span class="lineno"></span><span class="comment" id="2670139">//</span><br>
<span class="lineno">30</span><span class="comment" id="2670142">//&nbsp;The&nbsp;implementation&nbsp;fn&nbsp;can&nbsp;assume&nbsp;that&nbsp;the&nbsp;argument&nbsp;Value&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="2670208">//&nbsp;has&nbsp;the&nbsp;number&nbsp;and&nbsp;type&nbsp;of&nbsp;arguments&nbsp;given&nbsp;by&nbsp;typ.</span><br>
<span class="lineno"></span><span class="comment" id="2670262">//&nbsp;If&nbsp;typ&nbsp;describes&nbsp;a&nbsp;variadic&nbsp;function,&nbsp;the&nbsp;final&nbsp;Value&nbsp;is&nbsp;itself</span><br>
<span class="lineno"></span><span class="comment" id="2670329">//&nbsp;a&nbsp;slice&nbsp;representing&nbsp;the&nbsp;variadic&nbsp;arguments,&nbsp;as&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2670387">//&nbsp;body&nbsp;of&nbsp;a&nbsp;variadic&nbsp;function.&nbsp;The&nbsp;result&nbsp;Value&nbsp;slice&nbsp;returned&nbsp;by&nbsp;fn</span><br>
<span class="lineno">35</span><span class="comment" id="2670457">//&nbsp;must&nbsp;have&nbsp;the&nbsp;number&nbsp;and&nbsp;type&nbsp;of&nbsp;results&nbsp;given&nbsp;by&nbsp;typ.</span><br>
<span class="lineno"></span><span class="comment" id="2670515">//</span><br>
<span class="lineno"></span><span class="comment" id="2670518">//&nbsp;The&nbsp;Value.Call&nbsp;method&nbsp;allows&nbsp;the&nbsp;caller&nbsp;to&nbsp;invoke&nbsp;a&nbsp;typed&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="2670588">//&nbsp;in&nbsp;terms&nbsp;of&nbsp;Values;&nbsp;in&nbsp;contrast,&nbsp;MakeFunc&nbsp;allows&nbsp;the&nbsp;caller&nbsp;to&nbsp;implement</span><br>
<span class="lineno"></span><span class="comment" id="2670664">//&nbsp;a&nbsp;typed&nbsp;function&nbsp;in&nbsp;terms&nbsp;of&nbsp;Values.</span><br>
<span class="lineno">40</span><span class="comment" id="2670704">//</span><br>
<span class="lineno"></span><span class="comment" id="2670707">//&nbsp;The&nbsp;Examples&nbsp;section&nbsp;of&nbsp;the&nbsp;documentation&nbsp;includes&nbsp;an&nbsp;illustration</span><br>
<span class="lineno"></span><span class="comment" id="2670777">//&nbsp;of&nbsp;how&nbsp;to&nbsp;use&nbsp;MakeFunc&nbsp;to&nbsp;build&nbsp;a&nbsp;swap&nbsp;function&nbsp;for&nbsp;different&nbsp;types.</span><br>
<span class="lineno"></span><span class="comment" id="2670849">//</span><br>
<span class="lineno"></span><span class="keyword" id="2670852">func</span>&nbsp;<span class="ident" id="2670857">MakeFunc</span><span class="op" id="2670865">(</span><span class="ident" id="2670866">typ</span>&nbsp;<span class="ident" id="2670870">Type</span><span class="op" id="2670874">,</span>&nbsp;<span class="ident" id="2670876">fn</span>&nbsp;<span class="keyword" id="2670879">func</span><span class="op" id="2670883">(</span><span class="ident" id="2670884">args</span>&nbsp;<span class="op" id="2670889">[</span><span class="op" id="2670890">]</span><span class="ident" id="2670891">Value</span><span class="op" id="2670896">)</span>&nbsp;<span class="op" id="2670898">(</span><span class="ident" id="2670899">results</span>&nbsp;<span class="op" id="2670907">[</span><span class="op" id="2670908">]</span><span class="ident" id="2670909">Value</span><span class="op" id="2670914">)</span><span class="op" id="2670915">)</span>&nbsp;<span class="ident" id="2670917">Value</span>&nbsp;<span class="op" id="2670923">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2670926">if</span>&nbsp;<span class="ident" id="2670929">typ</span><span class="op" id="2670932">.</span><span class="ident" id="2670933">Kind</span><span class="op" id="2670937">(</span><span class="op" id="2670938">)</span>&nbsp;<span class="op" id="2670940">!=</span>&nbsp;<span class="ident" id="2670943">Func</span>&nbsp;<span class="op" id="2670948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2670952">panic</span><span class="op" id="2670957">(</span><span class="string" id="2670958">&#34;reflect:&nbsp;call&nbsp;of&nbsp;MakeFunc&nbsp;with&nbsp;non-Func&nbsp;type&#34;</span><span class="op" id="2671004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2671007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2671011">t</span>&nbsp;<span class="op" id="2671013">:=</span>&nbsp;<span class="ident" id="2671016">typ</span><span class="op" id="2671019">.</span><span class="ident" id="2671020">common</span><span class="op" id="2671026">(</span><span class="op" id="2671027">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2671030">ftyp</span>&nbsp;<span class="op" id="2671035">:=</span>&nbsp;<span class="op" id="2671038">(</span><span class="op" id="2671039">*</span><span class="ident" id="2671040">funcType</span><span class="op" id="2671048">)</span><span class="op" id="2671049">(</span><span class="ident" id="2671050">unsafe</span><span class="op" id="2671056">.</span><span class="ident" id="2671057">Pointer</span><span class="op" id="2671064">(</span><span class="ident" id="2671065">t</span><span class="op" id="2671066">)</span><span class="op" id="2671067">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2671071">//&nbsp;Indirect&nbsp;Go&nbsp;func&nbsp;value&nbsp;(dummy)&nbsp;to&nbsp;obtain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2671116">//&nbsp;actual&nbsp;code&nbsp;address.&nbsp;(A&nbsp;Go&nbsp;func&nbsp;value&nbsp;is&nbsp;a&nbsp;pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2671171">//&nbsp;to&nbsp;a&nbsp;C&nbsp;function&nbsp;pointer.&nbsp;http://golang.org/s/go11func.)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2671231">dummy</span>&nbsp;<span class="op" id="2671237">:=</span>&nbsp;<span class="ident" id="2671240">makeFuncStub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2671254">code</span>&nbsp;<span class="op" id="2671259">:=</span>&nbsp;<span class="op" id="2671262">*</span><span class="op" id="2671263">*</span><span class="op" id="2671264">(</span><span class="op" id="2671265">*</span><span class="op" id="2671266">*</span><span class="builtintype" id="2671267">uintptr</span><span class="op" id="2671274">)</span><span class="op" id="2671275">(</span><span class="ident" id="2671276">unsafe</span><span class="op" id="2671282">.</span><span class="ident" id="2671283">Pointer</span><span class="op" id="2671290">(</span><span class="op" id="2671291">&amp;</span><span class="ident" id="2671292">dummy</span><span class="op" id="2671297">)</span><span class="op" id="2671298">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2671302">//&nbsp;makeFuncImpl&nbsp;contains&nbsp;a&nbsp;stack&nbsp;map&nbsp;for&nbsp;use&nbsp;by&nbsp;the&nbsp;runtime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2671363">_</span><span class="op" id="2671364">,</span>&nbsp;<span class="ident" id="2671366">_</span><span class="op" id="2671367">,</span>&nbsp;<span class="ident" id="2671369">_</span><span class="op" id="2671370">,</span>&nbsp;<span class="ident" id="2671372">stack</span>&nbsp;<span class="op" id="2671378">:=</span>&nbsp;<span class="ident" id="2671381">funcLayout</span><span class="op" id="2671391">(</span><span class="ident" id="2671392">t</span><span class="op" id="2671393">,</span>&nbsp;<span class="builtintype" id="2671395">nil</span><span class="op" id="2671398">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2671402">impl</span>&nbsp;<span class="op" id="2671407">:=</span>&nbsp;<span class="op" id="2671410">&amp;</span><span class="ident" id="2671411">makeFuncImpl</span><span class="op" id="2671423">{</span><span class="ident" id="2671424">code</span><span class="op" id="2671428">:</span>&nbsp;<span class="ident" id="2671430">code</span><span class="op" id="2671434">,</span>&nbsp;<span class="ident" id="2671436">stack</span><span class="op" id="2671441">:</span>&nbsp;<span class="ident" id="2671443">stack</span><span class="op" id="2671448">,</span>&nbsp;<span class="ident" id="2671450">typ</span><span class="op" id="2671453">:</span>&nbsp;<span class="ident" id="2671455">ftyp</span><span class="op" id="2671459">,</span>&nbsp;<span class="ident" id="2671461">fn</span><span class="op" id="2671463">:</span>&nbsp;<span class="ident" id="2671465">fn</span><span class="op" id="2671467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2671471">return</span>&nbsp;<span class="ident" id="2671478">Value</span><span class="op" id="2671483">{</span><span class="ident" id="2671484">t</span><span class="op" id="2671485">,</span>&nbsp;<span class="ident" id="2671487">unsafe</span><span class="op" id="2671493">.</span><span class="ident" id="2671494">Pointer</span><span class="op" id="2671501">(</span><span class="ident" id="2671502">impl</span><span class="op" id="2671506">)</span><span class="op" id="2671507">,</span>&nbsp;<span class="ident" id="2671509">flag</span><span class="op" id="2671513">(</span><span class="ident" id="2671514">Func</span><span class="op" id="2671518">)</span><span class="op" id="2671519">}</span><br>
<span class="lineno"></span><span class="op" id="2671521">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="2671524">//&nbsp;makeFuncStub&nbsp;is&nbsp;an&nbsp;assembly&nbsp;function&nbsp;that&nbsp;is&nbsp;the&nbsp;code&nbsp;half&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2671589">//&nbsp;the&nbsp;function&nbsp;returned&nbsp;from&nbsp;MakeFunc.&nbsp;It&nbsp;expects&nbsp;a&nbsp;*callReflectFunc</span><br>
<span class="lineno"></span><span class="comment" id="2671659">//&nbsp;as&nbsp;its&nbsp;context&nbsp;register,&nbsp;and&nbsp;its&nbsp;job&nbsp;is&nbsp;to&nbsp;invoke&nbsp;callReflect(ctxt,&nbsp;frame)</span><br>
<span class="lineno"></span><span class="comment" id="2671737">//&nbsp;where&nbsp;ctxt&nbsp;is&nbsp;the&nbsp;context&nbsp;register&nbsp;and&nbsp;frame&nbsp;is&nbsp;a&nbsp;pointer&nbsp;to&nbsp;the&nbsp;first</span><br>
<span class="lineno">70</span><span class="comment" id="2671811">//&nbsp;word&nbsp;in&nbsp;the&nbsp;passed-in&nbsp;argument&nbsp;frame.</span><br>
<span class="lineno"></span><span class="keyword" id="2671852">func</span>&nbsp;<span class="ident" id="2671857">makeFuncStub</span><span class="op" id="2671869">(</span><span class="op" id="2671870">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2671873">type</span>&nbsp;<span class="ident" id="2671878">methodValue</span>&nbsp;<span class="keyword" id="2671890">struct</span>&nbsp;<span class="op" id="2671897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2671900">fn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2671907">uintptr</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2671916">stack</span>&nbsp;&nbsp;<span class="op" id="2671923">*</span><span class="ident" id="2671924">bitVector</span>&nbsp;<span class="comment" id="2671934">//&nbsp;stack&nbsp;bitmap&nbsp;for&nbsp;args&nbsp;-&nbsp;offset&nbsp;known&nbsp;to&nbsp;runtime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2671986">method</span>&nbsp;<span class="builtintype" id="2671993">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2671998">rcvr</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2672005">Value</span><br>
<span class="lineno"></span><span class="op" id="2672011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="2672014">//&nbsp;makeMethodValue&nbsp;converts&nbsp;v&nbsp;from&nbsp;the&nbsp;rcvr+method&nbsp;index&nbsp;representation</span><br>
<span class="lineno"></span><span class="comment" id="2672086">//&nbsp;of&nbsp;a&nbsp;method&nbsp;value&nbsp;to&nbsp;an&nbsp;actual&nbsp;method&nbsp;func&nbsp;value,&nbsp;which&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2672148">//&nbsp;basically&nbsp;the&nbsp;receiver&nbsp;value&nbsp;with&nbsp;a&nbsp;special&nbsp;bit&nbsp;set,&nbsp;into&nbsp;a&nbsp;true</span><br>
<span class="lineno"></span><span class="comment" id="2672216">//&nbsp;func&nbsp;value&nbsp;-&nbsp;a&nbsp;value&nbsp;holding&nbsp;an&nbsp;actual&nbsp;func.&nbsp;The&nbsp;output&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2672278">//&nbsp;semantically&nbsp;equivalent&nbsp;to&nbsp;the&nbsp;input&nbsp;as&nbsp;far&nbsp;as&nbsp;the&nbsp;user&nbsp;of&nbsp;package</span><br>
<span class="lineno">85</span><span class="comment" id="2672348">//&nbsp;reflect&nbsp;can&nbsp;tell,&nbsp;but&nbsp;the&nbsp;true&nbsp;func&nbsp;representation&nbsp;can&nbsp;be&nbsp;handled</span><br>
<span class="lineno"></span><span class="comment" id="2672417">//&nbsp;by&nbsp;code&nbsp;like&nbsp;Convert&nbsp;and&nbsp;Interface&nbsp;and&nbsp;Assign.</span><br>
<span class="lineno"></span><span class="keyword" id="2672467">func</span>&nbsp;<span class="ident" id="2672472">makeMethodValue</span><span class="op" id="2672487">(</span><span class="ident" id="2672488">op</span>&nbsp;<span class="builtintype" id="2672491">string</span><span class="op" id="2672497">,</span>&nbsp;<span class="ident" id="2672499">v</span>&nbsp;<span class="ident" id="2672501">Value</span><span class="op" id="2672506">)</span>&nbsp;<span class="ident" id="2672508">Value</span>&nbsp;<span class="op" id="2672514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2672517">if</span>&nbsp;<span class="ident" id="2672520">v</span><span class="op" id="2672521">.</span><span class="ident" id="2672522">flag</span><span class="op" id="2672526">&amp;</span><span class="ident" id="2672527">flagMethod</span>&nbsp;<span class="op" id="2672538">==</span>&nbsp;<span class="num" id="2672541">0</span>&nbsp;<span class="op" id="2672543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2672547">panic</span><span class="op" id="2672552">(</span><span class="string" id="2672553">&#34;reflect:&nbsp;internal&nbsp;error:&nbsp;invalid&nbsp;use&nbsp;of&nbsp;makeMethodValue&#34;</span><span class="op" id="2672610">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2672613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2672617">//&nbsp;Ignoring&nbsp;the&nbsp;flagMethod&nbsp;bit,&nbsp;v&nbsp;describes&nbsp;the&nbsp;receiver,&nbsp;not&nbsp;the&nbsp;method&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2672697">fl</span>&nbsp;<span class="op" id="2672700">:=</span>&nbsp;<span class="ident" id="2672703">v</span><span class="op" id="2672704">.</span><span class="ident" id="2672705">flag</span>&nbsp;<span class="op" id="2672710">&amp;</span>&nbsp;<span class="op" id="2672712">(</span><span class="ident" id="2672713">flagRO</span>&nbsp;<span class="op" id="2672720">|</span>&nbsp;<span class="ident" id="2672722">flagAddr</span>&nbsp;<span class="op" id="2672731">|</span>&nbsp;<span class="ident" id="2672733">flagIndir</span><span class="op" id="2672742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2672745">fl</span>&nbsp;<span class="op" id="2672748">|=</span>&nbsp;<span class="ident" id="2672751">flag</span><span class="op" id="2672755">(</span><span class="ident" id="2672756">v</span><span class="op" id="2672757">.</span><span class="ident" id="2672758">typ</span><span class="op" id="2672761">.</span><span class="ident" id="2672762">Kind</span><span class="op" id="2672766">(</span><span class="op" id="2672767">)</span><span class="op" id="2672768">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2672771">rcvr</span>&nbsp;<span class="op" id="2672776">:=</span>&nbsp;<span class="ident" id="2672779">Value</span><span class="op" id="2672784">{</span><span class="ident" id="2672785">v</span><span class="op" id="2672786">.</span><span class="ident" id="2672787">typ</span><span class="op" id="2672790">,</span>&nbsp;<span class="ident" id="2672792">v</span><span class="op" id="2672793">.</span><span class="ident" id="2672794">ptr</span><span class="op" id="2672797">,</span>&nbsp;<span class="ident" id="2672799">fl</span><span class="op" id="2672801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2672805">//&nbsp;v.Type&nbsp;returns&nbsp;the&nbsp;actual&nbsp;type&nbsp;of&nbsp;the&nbsp;method&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2672861">funcType</span>&nbsp;<span class="op" id="2672870">:=</span>&nbsp;<span class="ident" id="2672873">v</span><span class="op" id="2672874">.</span><span class="ident" id="2672875">Type</span><span class="op" id="2672879">(</span><span class="op" id="2672880">)</span><span class="op" id="2672881">.</span><span class="op" id="2672882">(</span><span class="op" id="2672883">*</span><span class="ident" id="2672884">rtype</span><span class="op" id="2672889">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2672893">//&nbsp;Indirect&nbsp;Go&nbsp;func&nbsp;value&nbsp;(dummy)&nbsp;to&nbsp;obtain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2672938">//&nbsp;actual&nbsp;code&nbsp;address.&nbsp;(A&nbsp;Go&nbsp;func&nbsp;value&nbsp;is&nbsp;a&nbsp;pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2672993">//&nbsp;to&nbsp;a&nbsp;C&nbsp;function&nbsp;pointer.&nbsp;http://golang.org/s/go11func.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2673053">dummy</span>&nbsp;<span class="op" id="2673059">:=</span>&nbsp;<span class="ident" id="2673062">methodValueCall</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2673079">code</span>&nbsp;<span class="op" id="2673084">:=</span>&nbsp;<span class="op" id="2673087">*</span><span class="op" id="2673088">*</span><span class="op" id="2673089">(</span><span class="op" id="2673090">*</span><span class="op" id="2673091">*</span><span class="builtintype" id="2673092">uintptr</span><span class="op" id="2673099">)</span><span class="op" id="2673100">(</span><span class="ident" id="2673101">unsafe</span><span class="op" id="2673107">.</span><span class="ident" id="2673108">Pointer</span><span class="op" id="2673115">(</span><span class="op" id="2673116">&amp;</span><span class="ident" id="2673117">dummy</span><span class="op" id="2673122">)</span><span class="op" id="2673123">)</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2673127">//&nbsp;methodValue&nbsp;contains&nbsp;a&nbsp;stack&nbsp;map&nbsp;for&nbsp;use&nbsp;by&nbsp;the&nbsp;runtime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2673187">_</span><span class="op" id="2673188">,</span>&nbsp;<span class="ident" id="2673190">_</span><span class="op" id="2673191">,</span>&nbsp;<span class="ident" id="2673193">_</span><span class="op" id="2673194">,</span>&nbsp;<span class="ident" id="2673196">stack</span>&nbsp;<span class="op" id="2673202">:=</span>&nbsp;<span class="ident" id="2673205">funcLayout</span><span class="op" id="2673215">(</span><span class="ident" id="2673216">funcType</span><span class="op" id="2673224">,</span>&nbsp;<span class="builtintype" id="2673226">nil</span><span class="op" id="2673229">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2673233">fv</span>&nbsp;<span class="op" id="2673236">:=</span>&nbsp;<span class="op" id="2673239">&amp;</span><span class="ident" id="2673240">methodValue</span><span class="op" id="2673251">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2673255">fn</span><span class="op" id="2673257">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2673263">code</span><span class="op" id="2673267">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2673271">stack</span><span class="op" id="2673276">:</span>&nbsp;&nbsp;<span class="ident" id="2673279">stack</span><span class="op" id="2673284">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2673288">method</span><span class="op" id="2673294">:</span>&nbsp;<span class="builtintype" id="2673296">int</span><span class="op" id="2673299">(</span><span class="ident" id="2673300">v</span><span class="op" id="2673301">.</span><span class="ident" id="2673302">flag</span><span class="op" id="2673306">)</span>&nbsp;<span class="op" id="2673308">&gt;&gt;</span>&nbsp;<span class="ident" id="2673311">flagMethodShift</span><span class="op" id="2673326">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2673330">rcvr</span><span class="op" id="2673334">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2673338">rcvr</span><span class="op" id="2673342">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2673345">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2673349">//&nbsp;Cause&nbsp;panic&nbsp;if&nbsp;method&nbsp;is&nbsp;not&nbsp;appropriate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2673395">//&nbsp;The&nbsp;panic&nbsp;would&nbsp;still&nbsp;happen&nbsp;during&nbsp;the&nbsp;call&nbsp;if&nbsp;we&nbsp;omit&nbsp;this,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2673461">//&nbsp;but&nbsp;we&nbsp;want&nbsp;Interface()&nbsp;and&nbsp;other&nbsp;operations&nbsp;to&nbsp;fail&nbsp;early.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2673525">methodReceiver</span><span class="op" id="2673539">(</span><span class="ident" id="2673540">op</span><span class="op" id="2673542">,</span>&nbsp;<span class="ident" id="2673544">fv</span><span class="op" id="2673546">.</span><span class="ident" id="2673547">rcvr</span><span class="op" id="2673551">,</span>&nbsp;<span class="ident" id="2673553">fv</span><span class="op" id="2673555">.</span><span class="ident" id="2673556">method</span><span class="op" id="2673562">)</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2673566">return</span>&nbsp;<span class="ident" id="2673573">Value</span><span class="op" id="2673578">{</span><span class="ident" id="2673579">funcType</span><span class="op" id="2673587">,</span>&nbsp;<span class="ident" id="2673589">unsafe</span><span class="op" id="2673595">.</span><span class="ident" id="2673596">Pointer</span><span class="op" id="2673603">(</span><span class="ident" id="2673604">fv</span><span class="op" id="2673606">)</span><span class="op" id="2673607">,</span>&nbsp;<span class="ident" id="2673609">v</span><span class="op" id="2673610">.</span><span class="ident" id="2673611">flag</span><span class="op" id="2673615">&amp;</span><span class="ident" id="2673616">flagRO</span>&nbsp;<span class="op" id="2673623">|</span>&nbsp;<span class="ident" id="2673625">flag</span><span class="op" id="2673629">(</span><span class="ident" id="2673630">Func</span><span class="op" id="2673634">)</span><span class="op" id="2673635">}</span><br>
<span class="lineno"></span><span class="op" id="2673637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2673640">//&nbsp;methodValueCall&nbsp;is&nbsp;an&nbsp;assembly&nbsp;function&nbsp;that&nbsp;is&nbsp;the&nbsp;code&nbsp;half&nbsp;of</span><br>
<span class="lineno">125</span><span class="comment" id="2673708">//&nbsp;the&nbsp;function&nbsp;returned&nbsp;from&nbsp;makeMethodValue.&nbsp;It&nbsp;expects&nbsp;a&nbsp;*methodValue</span><br>
<span class="lineno"></span><span class="comment" id="2673781">//&nbsp;as&nbsp;its&nbsp;context&nbsp;register,&nbsp;and&nbsp;its&nbsp;job&nbsp;is&nbsp;to&nbsp;invoke&nbsp;callMethod(ctxt,&nbsp;frame)</span><br>
<span class="lineno"></span><span class="comment" id="2673858">//&nbsp;where&nbsp;ctxt&nbsp;is&nbsp;the&nbsp;context&nbsp;register&nbsp;and&nbsp;frame&nbsp;is&nbsp;a&nbsp;pointer&nbsp;to&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="2673932">//&nbsp;word&nbsp;in&nbsp;the&nbsp;passed-in&nbsp;argument&nbsp;frame.</span><br>
<span class="lineno"></span><span class="keyword" id="2673973">func</span>&nbsp;<span class="ident" id="2673978">methodValueCall</span><span class="op" id="2673993">(</span><span class="op" id="2673994">)</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
