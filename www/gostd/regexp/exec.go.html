<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5196940">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5196995">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5197049">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5197100">package</span>&nbsp;<span class="ident" id="5197108">regexp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5197116">import</span>&nbsp;<span class="op" id="5197123">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5197126">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5197132">&#34;regexp/syntax&#34;</span><br>
<span class="lineno">10</span><span class="op" id="5197148">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5197151">//&nbsp;A&nbsp;queue&nbsp;is&nbsp;a&nbsp;&#39;sparse&nbsp;array&#39;&nbsp;holding&nbsp;pending&nbsp;threads&nbsp;of&nbsp;execution.</span><br>
<span class="lineno"></span><span class="comment" id="5197220">//&nbsp;See&nbsp;http://research.swtch.com/2008/03/using-uninitialized-memory-for-fun-and.html</span><br>
<span class="lineno"></span><span class="keyword" id="5197305">type</span>&nbsp;<span class="ident" id="5197310">queue</span>&nbsp;<span class="keyword" id="5197316">struct</span>&nbsp;<span class="op" id="5197323">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5197326">sparse</span>&nbsp;<span class="op" id="5197333">[</span><span class="op" id="5197334">]</span><span class="builtintype" id="5197335">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5197343">dense</span>&nbsp;&nbsp;<span class="op" id="5197350">[</span><span class="op" id="5197351">]</span><span class="ident" id="5197352">entry</span><br>
<span class="lineno"></span><span class="op" id="5197358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5197361">//&nbsp;A&nbsp;entry&nbsp;is&nbsp;an&nbsp;entry&nbsp;on&nbsp;a&nbsp;queue.</span><br>
<span class="lineno">20</span><span class="comment" id="5197396">//&nbsp;It&nbsp;holds&nbsp;both&nbsp;the&nbsp;instruction&nbsp;pc&nbsp;and&nbsp;the&nbsp;actual&nbsp;thread.</span><br>
<span class="lineno"></span><span class="comment" id="5197455">//&nbsp;Some&nbsp;queue&nbsp;entries&nbsp;are&nbsp;just&nbsp;place&nbsp;holders&nbsp;so&nbsp;that&nbsp;the&nbsp;machine</span><br>
<span class="lineno"></span><span class="comment" id="5197520">//&nbsp;knows&nbsp;it&nbsp;has&nbsp;considered&nbsp;that&nbsp;pc.&nbsp;&nbsp;Such&nbsp;entries&nbsp;have&nbsp;t&nbsp;==&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="5197585">type</span>&nbsp;<span class="ident" id="5197590">entry</span>&nbsp;<span class="keyword" id="5197596">struct</span>&nbsp;<span class="op" id="5197603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5197606">pc</span>&nbsp;<span class="builtintype" id="5197609">uint32</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5197617">t</span>&nbsp;&nbsp;<span class="op" id="5197620">*</span><span class="ident" id="5197621">thread</span><br>
<span class="lineno"></span><span class="op" id="5197628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5197631">//&nbsp;A&nbsp;thread&nbsp;is&nbsp;the&nbsp;state&nbsp;of&nbsp;a&nbsp;single&nbsp;path&nbsp;through&nbsp;the&nbsp;machine:</span><br>
<span class="lineno"></span><span class="comment" id="5197694">//&nbsp;an&nbsp;instruction&nbsp;and&nbsp;a&nbsp;corresponding&nbsp;capture&nbsp;array.</span><br>
<span class="lineno">30</span><span class="comment" id="5197747">//&nbsp;See&nbsp;http://swtch.com/~rsc/regexp/regexp2.html</span><br>
<span class="lineno"></span><span class="keyword" id="5197796">type</span>&nbsp;<span class="ident" id="5197801">thread</span>&nbsp;<span class="keyword" id="5197808">struct</span>&nbsp;<span class="op" id="5197815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5197818">inst</span>&nbsp;<span class="op" id="5197823">*</span><span class="ident" id="5197824">syntax</span><span class="op" id="5197830">.</span><span class="ident" id="5197831">Inst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5197837">cap</span>&nbsp;&nbsp;<span class="op" id="5197842">[</span><span class="op" id="5197843">]</span><span class="builtintype" id="5197844">int</span><br>
<span class="lineno"></span><span class="op" id="5197848">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="5197851">//&nbsp;A&nbsp;machine&nbsp;holds&nbsp;all&nbsp;the&nbsp;state&nbsp;during&nbsp;an&nbsp;NFA&nbsp;simulation&nbsp;for&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword" id="5197916">type</span>&nbsp;<span class="ident" id="5197921">machine</span>&nbsp;<span class="keyword" id="5197929">struct</span>&nbsp;<span class="op" id="5197936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5197939">re</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5197948">*</span><span class="ident" id="5197949">Regexp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5197961">//&nbsp;corresponding&nbsp;Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5197986">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5197995">*</span><span class="ident" id="5197996">syntax</span><span class="op" id="5198002">.</span><span class="ident" id="5198003">Prog</span>&nbsp;<span class="comment" id="5198008">//&nbsp;compiled&nbsp;program</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198029">op</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5198038">*</span><span class="ident" id="5198039">onePassProg</span>&nbsp;<span class="comment" id="5198051">//&nbsp;compiled&nbsp;onepass&nbsp;program,&nbsp;or&nbsp;notOnePass</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198095">q0</span><span class="op" id="5198097">,</span>&nbsp;<span class="ident" id="5198099">q1</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5198104">queue</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5198117">//&nbsp;two&nbsp;queues&nbsp;for&nbsp;runq,&nbsp;nextq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198148">pool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5198157">[</span><span class="op" id="5198158">]</span><span class="op" id="5198159">*</span><span class="ident" id="5198160">thread</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5198170">//&nbsp;pool&nbsp;of&nbsp;available&nbsp;threads</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198200">matched</span>&nbsp;&nbsp;<span class="builtintype" id="5198209">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5198222">//&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198252">matchcap</span>&nbsp;<span class="op" id="5198261">[</span><span class="op" id="5198262">]</span><span class="builtintype" id="5198263">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5198274">//&nbsp;capture&nbsp;information&nbsp;for&nbsp;the&nbsp;match</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5198313">//&nbsp;cached&nbsp;inputs,&nbsp;to&nbsp;avoid&nbsp;allocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198352">inputBytes</span>&nbsp;&nbsp;<span class="ident" id="5198364">inputBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198376">inputString</span>&nbsp;<span class="ident" id="5198388">inputString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198401">inputReader</span>&nbsp;<span class="ident" id="5198413">inputReader</span><br>
<span class="lineno">50</span><span class="op" id="5198425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5198428">func</span>&nbsp;<span class="op" id="5198433">(</span><span class="ident" id="5198434">m</span>&nbsp;<span class="op" id="5198436">*</span><span class="ident" id="5198437">machine</span><span class="op" id="5198444">)</span>&nbsp;<span class="ident" id="5198446">newInputBytes</span><span class="op" id="5198459">(</span><span class="ident" id="5198460">b</span>&nbsp;<span class="op" id="5198462">[</span><span class="op" id="5198463">]</span><span class="builtintype" id="5198464">byte</span><span class="op" id="5198468">)</span>&nbsp;<span class="ident" id="5198470">input</span>&nbsp;<span class="op" id="5198476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198479">m</span><span class="op" id="5198480">.</span><span class="ident" id="5198481">inputBytes</span><span class="op" id="5198491">.</span><span class="ident" id="5198492">str</span>&nbsp;<span class="op" id="5198496">=</span>&nbsp;<span class="ident" id="5198498">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5198501">return</span>&nbsp;<span class="op" id="5198508">&amp;</span><span class="ident" id="5198509">m</span><span class="op" id="5198510">.</span><span class="ident" id="5198511">inputBytes</span><br>
<span class="lineno">55</span><span class="op" id="5198522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5198525">func</span>&nbsp;<span class="op" id="5198530">(</span><span class="ident" id="5198531">m</span>&nbsp;<span class="op" id="5198533">*</span><span class="ident" id="5198534">machine</span><span class="op" id="5198541">)</span>&nbsp;<span class="ident" id="5198543">newInputString</span><span class="op" id="5198557">(</span><span class="ident" id="5198558">s</span>&nbsp;<span class="builtintype" id="5198560">string</span><span class="op" id="5198566">)</span>&nbsp;<span class="ident" id="5198568">input</span>&nbsp;<span class="op" id="5198574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198577">m</span><span class="op" id="5198578">.</span><span class="ident" id="5198579">inputString</span><span class="op" id="5198590">.</span><span class="ident" id="5198591">str</span>&nbsp;<span class="op" id="5198595">=</span>&nbsp;<span class="ident" id="5198597">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5198600">return</span>&nbsp;<span class="op" id="5198607">&amp;</span><span class="ident" id="5198608">m</span><span class="op" id="5198609">.</span><span class="ident" id="5198610">inputString</span><br>
<span class="lineno">60</span><span class="op" id="5198622">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5198625">func</span>&nbsp;<span class="op" id="5198630">(</span><span class="ident" id="5198631">m</span>&nbsp;<span class="op" id="5198633">*</span><span class="ident" id="5198634">machine</span><span class="op" id="5198641">)</span>&nbsp;<span class="ident" id="5198643">newInputReader</span><span class="op" id="5198657">(</span><span class="ident" id="5198658">r</span>&nbsp;<span class="ident" id="5198660">io</span><span class="op" id="5198662">.</span><span class="ident" id="5198663">RuneReader</span><span class="op" id="5198673">)</span>&nbsp;<span class="ident" id="5198675">input</span>&nbsp;<span class="op" id="5198681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198684">m</span><span class="op" id="5198685">.</span><span class="ident" id="5198686">inputReader</span><span class="op" id="5198697">.</span><span class="ident" id="5198698">r</span>&nbsp;<span class="op" id="5198700">=</span>&nbsp;<span class="ident" id="5198702">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198705">m</span><span class="op" id="5198706">.</span><span class="ident" id="5198707">inputReader</span><span class="op" id="5198718">.</span><span class="ident" id="5198719">atEOT</span>&nbsp;<span class="op" id="5198725">=</span>&nbsp;<span class="builtintype" id="5198727">false</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198734">m</span><span class="op" id="5198735">.</span><span class="ident" id="5198736">inputReader</span><span class="op" id="5198747">.</span><span class="ident" id="5198748">pos</span>&nbsp;<span class="op" id="5198752">=</span>&nbsp;<span class="num" id="5198754">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5198757">return</span>&nbsp;<span class="op" id="5198764">&amp;</span><span class="ident" id="5198765">m</span><span class="op" id="5198766">.</span><span class="ident" id="5198767">inputReader</span><br>
<span class="lineno"></span><span class="op" id="5198779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5198782">//&nbsp;progMachine&nbsp;returns&nbsp;a&nbsp;new&nbsp;machine&nbsp;running&nbsp;the&nbsp;prog&nbsp;p.</span><br>
<span class="lineno">70</span><span class="keyword" id="5198839">func</span>&nbsp;<span class="ident" id="5198844">progMachine</span><span class="op" id="5198855">(</span><span class="ident" id="5198856">p</span>&nbsp;<span class="op" id="5198858">*</span><span class="ident" id="5198859">syntax</span><span class="op" id="5198865">.</span><span class="ident" id="5198866">Prog</span><span class="op" id="5198870">,</span>&nbsp;<span class="ident" id="5198872">op</span>&nbsp;<span class="op" id="5198875">*</span><span class="ident" id="5198876">onePassProg</span><span class="op" id="5198887">)</span>&nbsp;<span class="op" id="5198889">*</span><span class="ident" id="5198890">machine</span>&nbsp;<span class="op" id="5198898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198901">m</span>&nbsp;<span class="op" id="5198903">:=</span>&nbsp;<span class="op" id="5198906">&amp;</span><span class="ident" id="5198907">machine</span><span class="op" id="5198914">{</span><span class="ident" id="5198915">p</span><span class="op" id="5198916">:</span>&nbsp;<span class="ident" id="5198918">p</span><span class="op" id="5198919">,</span>&nbsp;<span class="ident" id="5198921">op</span><span class="op" id="5198923">:</span>&nbsp;<span class="ident" id="5198925">op</span><span class="op" id="5198927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198930">n</span>&nbsp;<span class="op" id="5198932">:=</span>&nbsp;<span class="builtinfunc" id="5198935">len</span><span class="op" id="5198938">(</span><span class="ident" id="5198939">m</span><span class="op" id="5198940">.</span><span class="ident" id="5198941">p</span><span class="op" id="5198942">.</span><span class="ident" id="5198943">Inst</span><span class="op" id="5198947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198950">m</span><span class="op" id="5198951">.</span><span class="ident" id="5198952">q0</span>&nbsp;<span class="op" id="5198955">=</span>&nbsp;<span class="ident" id="5198957">queue</span><span class="op" id="5198962">{</span><span class="builtinfunc" id="5198963">make</span><span class="op" id="5198967">(</span><span class="op" id="5198968">[</span><span class="op" id="5198969">]</span><span class="builtintype" id="5198970">uint32</span><span class="op" id="5198976">,</span>&nbsp;<span class="ident" id="5198978">n</span><span class="op" id="5198979">)</span><span class="op" id="5198980">,</span>&nbsp;<span class="builtinfunc" id="5198982">make</span><span class="op" id="5198986">(</span><span class="op" id="5198987">[</span><span class="op" id="5198988">]</span><span class="ident" id="5198989">entry</span><span class="op" id="5198994">,</span>&nbsp;<span class="num" id="5198996">0</span><span class="op" id="5198997">,</span>&nbsp;<span class="ident" id="5198999">n</span><span class="op" id="5199000">)</span><span class="op" id="5199001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199004">m</span><span class="op" id="5199005">.</span><span class="ident" id="5199006">q1</span>&nbsp;<span class="op" id="5199009">=</span>&nbsp;<span class="ident" id="5199011">queue</span><span class="op" id="5199016">{</span><span class="builtinfunc" id="5199017">make</span><span class="op" id="5199021">(</span><span class="op" id="5199022">[</span><span class="op" id="5199023">]</span><span class="builtintype" id="5199024">uint32</span><span class="op" id="5199030">,</span>&nbsp;<span class="ident" id="5199032">n</span><span class="op" id="5199033">)</span><span class="op" id="5199034">,</span>&nbsp;<span class="builtinfunc" id="5199036">make</span><span class="op" id="5199040">(</span><span class="op" id="5199041">[</span><span class="op" id="5199042">]</span><span class="ident" id="5199043">entry</span><span class="op" id="5199048">,</span>&nbsp;<span class="num" id="5199050">0</span><span class="op" id="5199051">,</span>&nbsp;<span class="ident" id="5199053">n</span><span class="op" id="5199054">)</span><span class="op" id="5199055">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199058">ncap</span>&nbsp;<span class="op" id="5199063">:=</span>&nbsp;<span class="ident" id="5199066">p</span><span class="op" id="5199067">.</span><span class="ident" id="5199068">NumCap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5199076">if</span>&nbsp;<span class="ident" id="5199079">ncap</span>&nbsp;<span class="op" id="5199084">&lt;</span>&nbsp;<span class="num" id="5199086">2</span>&nbsp;<span class="op" id="5199088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199092">ncap</span>&nbsp;<span class="op" id="5199097">=</span>&nbsp;<span class="num" id="5199099">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5199102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199105">m</span><span class="op" id="5199106">.</span><span class="ident" id="5199107">matchcap</span>&nbsp;<span class="op" id="5199116">=</span>&nbsp;<span class="builtinfunc" id="5199118">make</span><span class="op" id="5199122">(</span><span class="op" id="5199123">[</span><span class="op" id="5199124">]</span><span class="builtintype" id="5199125">int</span><span class="op" id="5199128">,</span>&nbsp;<span class="ident" id="5199130">ncap</span><span class="op" id="5199134">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5199137">return</span>&nbsp;<span class="ident" id="5199144">m</span><br>
<span class="lineno"></span><span class="op" id="5199146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5199149">func</span>&nbsp;<span class="op" id="5199154">(</span><span class="ident" id="5199155">m</span>&nbsp;<span class="op" id="5199157">*</span><span class="ident" id="5199158">machine</span><span class="op" id="5199165">)</span>&nbsp;<span class="ident" id="5199167">init</span><span class="op" id="5199171">(</span><span class="ident" id="5199172">ncap</span>&nbsp;<span class="builtintype" id="5199177">int</span><span class="op" id="5199180">)</span>&nbsp;<span class="op" id="5199182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5199185">for</span>&nbsp;<span class="ident" id="5199189">_</span><span class="op" id="5199190">,</span>&nbsp;<span class="ident" id="5199192">t</span>&nbsp;<span class="op" id="5199194">:=</span>&nbsp;<span class="keyword" id="5199197">range</span>&nbsp;<span class="ident" id="5199203">m</span><span class="op" id="5199204">.</span><span class="ident" id="5199205">pool</span>&nbsp;<span class="op" id="5199210">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199214">t</span><span class="op" id="5199215">.</span><span class="builtinfunc" id="5199216">cap</span>&nbsp;<span class="op" id="5199220">=</span>&nbsp;<span class="ident" id="5199222">t</span><span class="op" id="5199223">.</span><span class="builtinfunc" id="5199224">cap</span><span class="op" id="5199227">[</span><span class="op" id="5199228">:</span><span class="ident" id="5199229">ncap</span><span class="op" id="5199233">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5199236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199239">m</span><span class="op" id="5199240">.</span><span class="ident" id="5199241">matchcap</span>&nbsp;<span class="op" id="5199250">=</span>&nbsp;<span class="ident" id="5199252">m</span><span class="op" id="5199253">.</span><span class="ident" id="5199254">matchcap</span><span class="op" id="5199262">[</span><span class="op" id="5199263">:</span><span class="ident" id="5199264">ncap</span><span class="op" id="5199268">]</span><br>
<span class="lineno"></span><span class="op" id="5199270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="5199273">//&nbsp;alloc&nbsp;allocates&nbsp;a&nbsp;new&nbsp;thread&nbsp;with&nbsp;the&nbsp;given&nbsp;instruction.</span><br>
<span class="lineno"></span><span class="comment" id="5199333">//&nbsp;It&nbsp;uses&nbsp;the&nbsp;free&nbsp;pool&nbsp;if&nbsp;possible.</span><br>
<span class="lineno"></span><span class="keyword" id="5199371">func</span>&nbsp;<span class="op" id="5199376">(</span><span class="ident" id="5199377">m</span>&nbsp;<span class="op" id="5199379">*</span><span class="ident" id="5199380">machine</span><span class="op" id="5199387">)</span>&nbsp;<span class="ident" id="5199389">alloc</span><span class="op" id="5199394">(</span><span class="ident" id="5199395">i</span>&nbsp;<span class="op" id="5199397">*</span><span class="ident" id="5199398">syntax</span><span class="op" id="5199404">.</span><span class="ident" id="5199405">Inst</span><span class="op" id="5199409">)</span>&nbsp;<span class="op" id="5199411">*</span><span class="ident" id="5199412">thread</span>&nbsp;<span class="op" id="5199419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5199422">var</span>&nbsp;<span class="ident" id="5199426">t</span>&nbsp;<span class="op" id="5199428">*</span><span class="ident" id="5199429">thread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5199437">if</span>&nbsp;<span class="ident" id="5199440">n</span>&nbsp;<span class="op" id="5199442">:=</span>&nbsp;<span class="builtinfunc" id="5199445">len</span><span class="op" id="5199448">(</span><span class="ident" id="5199449">m</span><span class="op" id="5199450">.</span><span class="ident" id="5199451">pool</span><span class="op" id="5199455">)</span><span class="op" id="5199456">;</span>&nbsp;<span class="ident" id="5199458">n</span>&nbsp;<span class="op" id="5199460">&gt;</span>&nbsp;<span class="num" id="5199462">0</span>&nbsp;<span class="op" id="5199464">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199468">t</span>&nbsp;<span class="op" id="5199470">=</span>&nbsp;<span class="ident" id="5199472">m</span><span class="op" id="5199473">.</span><span class="ident" id="5199474">pool</span><span class="op" id="5199478">[</span><span class="ident" id="5199479">n</span><span class="op" id="5199480">-</span><span class="num" id="5199481">1</span><span class="op" id="5199482">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199486">m</span><span class="op" id="5199487">.</span><span class="ident" id="5199488">pool</span>&nbsp;<span class="op" id="5199493">=</span>&nbsp;<span class="ident" id="5199495">m</span><span class="op" id="5199496">.</span><span class="ident" id="5199497">pool</span><span class="op" id="5199501">[</span><span class="op" id="5199502">:</span><span class="ident" id="5199503">n</span><span class="op" id="5199504">-</span><span class="num" id="5199505">1</span><span class="op" id="5199506">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5199509">}</span>&nbsp;<span class="keyword" id="5199511">else</span>&nbsp;<span class="op" id="5199516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199520">t</span>&nbsp;<span class="op" id="5199522">=</span>&nbsp;<span class="builtinfunc" id="5199524">new</span><span class="op" id="5199527">(</span><span class="ident" id="5199528">thread</span><span class="op" id="5199534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199538">t</span><span class="op" id="5199539">.</span><span class="builtinfunc" id="5199540">cap</span>&nbsp;<span class="op" id="5199544">=</span>&nbsp;<span class="builtinfunc" id="5199546">make</span><span class="op" id="5199550">(</span><span class="op" id="5199551">[</span><span class="op" id="5199552">]</span><span class="builtintype" id="5199553">int</span><span class="op" id="5199556">,</span>&nbsp;<span class="builtinfunc" id="5199558">len</span><span class="op" id="5199561">(</span><span class="ident" id="5199562">m</span><span class="op" id="5199563">.</span><span class="ident" id="5199564">matchcap</span><span class="op" id="5199572">)</span><span class="op" id="5199573">,</span>&nbsp;<span class="builtinfunc" id="5199575">cap</span><span class="op" id="5199578">(</span><span class="ident" id="5199579">m</span><span class="op" id="5199580">.</span><span class="ident" id="5199581">matchcap</span><span class="op" id="5199589">)</span><span class="op" id="5199590">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5199593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199596">t</span><span class="op" id="5199597">.</span><span class="ident" id="5199598">inst</span>&nbsp;<span class="op" id="5199603">=</span>&nbsp;<span class="ident" id="5199605">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5199608">return</span>&nbsp;<span class="ident" id="5199615">t</span><br>
<span class="lineno"></span><span class="op" id="5199617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="5199620">//&nbsp;free&nbsp;returns&nbsp;t&nbsp;to&nbsp;the&nbsp;free&nbsp;pool.</span><br>
<span class="lineno"></span><span class="keyword" id="5199656">func</span>&nbsp;<span class="op" id="5199661">(</span><span class="ident" id="5199662">m</span>&nbsp;<span class="op" id="5199664">*</span><span class="ident" id="5199665">machine</span><span class="op" id="5199672">)</span>&nbsp;<span class="ident" id="5199674">free</span><span class="op" id="5199678">(</span><span class="ident" id="5199679">t</span>&nbsp;<span class="op" id="5199681">*</span><span class="ident" id="5199682">thread</span><span class="op" id="5199688">)</span>&nbsp;<span class="op" id="5199690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199693">m</span><span class="op" id="5199694">.</span><span class="ident" id="5199695">inputBytes</span><span class="op" id="5199705">.</span><span class="ident" id="5199706">str</span>&nbsp;<span class="op" id="5199710">=</span>&nbsp;<span class="ident" id="5199712">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199717">m</span><span class="op" id="5199718">.</span><span class="ident" id="5199719">inputString</span><span class="op" id="5199730">.</span><span class="ident" id="5199731">str</span>&nbsp;<span class="op" id="5199735">=</span>&nbsp;<span class="string" id="5199737">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199741">m</span><span class="op" id="5199742">.</span><span class="ident" id="5199743">inputReader</span><span class="op" id="5199754">.</span><span class="ident" id="5199755">r</span>&nbsp;<span class="op" id="5199757">=</span>&nbsp;<span class="ident" id="5199759">nil</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199764">m</span><span class="op" id="5199765">.</span><span class="ident" id="5199766">pool</span>&nbsp;<span class="op" id="5199771">=</span>&nbsp;<span class="builtinfunc" id="5199773">append</span><span class="op" id="5199779">(</span><span class="ident" id="5199780">m</span><span class="op" id="5199781">.</span><span class="ident" id="5199782">pool</span><span class="op" id="5199786">,</span>&nbsp;<span class="ident" id="5199788">t</span><span class="op" id="5199789">)</span><br>
<span class="lineno"></span><span class="op" id="5199791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5199794">//&nbsp;match&nbsp;runs&nbsp;the&nbsp;machine&nbsp;over&nbsp;the&nbsp;input&nbsp;starting&nbsp;at&nbsp;pos.</span><br>
<span class="lineno"></span><span class="comment" id="5199852">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found.</span><br>
<span class="lineno">115</span><span class="comment" id="5199893">//&nbsp;If&nbsp;so,&nbsp;m.matchcap&nbsp;holds&nbsp;the&nbsp;submatch&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="5199946">func</span>&nbsp;<span class="op" id="5199951">(</span><span class="ident" id="5199952">m</span>&nbsp;<span class="op" id="5199954">*</span><span class="ident" id="5199955">machine</span><span class="op" id="5199962">)</span>&nbsp;<span class="ident" id="5199964">match</span><span class="op" id="5199969">(</span><span class="ident" id="5199970">i</span>&nbsp;<span class="ident" id="5199972">input</span><span class="op" id="5199977">,</span>&nbsp;<span class="ident" id="5199979">pos</span>&nbsp;<span class="builtintype" id="5199983">int</span><span class="op" id="5199986">)</span>&nbsp;<span class="builtintype" id="5199988">bool</span>&nbsp;<span class="op" id="5199993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199996">startCond</span>&nbsp;<span class="op" id="5200006">:=</span>&nbsp;<span class="ident" id="5200009">m</span><span class="op" id="5200010">.</span><span class="ident" id="5200011">re</span><span class="op" id="5200013">.</span><span class="ident" id="5200014">cond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200020">if</span>&nbsp;<span class="ident" id="5200023">startCond</span>&nbsp;<span class="op" id="5200033">==</span>&nbsp;<span class="op" id="5200036">^</span><span class="ident" id="5200037">syntax</span><span class="op" id="5200043">.</span><span class="ident" id="5200044">EmptyOp</span><span class="op" id="5200051">(</span><span class="num" id="5200052">0</span><span class="op" id="5200053">)</span>&nbsp;<span class="op" id="5200055">{</span>&nbsp;<span class="comment" id="5200057">//&nbsp;impossible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200073">return</span>&nbsp;<span class="builtintype" id="5200080">false</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5200087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200090">m</span><span class="op" id="5200091">.</span><span class="ident" id="5200092">matched</span>&nbsp;<span class="op" id="5200100">=</span>&nbsp;<span class="builtintype" id="5200102">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200109">for</span>&nbsp;<span class="ident" id="5200113">i</span>&nbsp;<span class="op" id="5200115">:=</span>&nbsp;<span class="keyword" id="5200118">range</span>&nbsp;<span class="ident" id="5200124">m</span><span class="op" id="5200125">.</span><span class="ident" id="5200126">matchcap</span>&nbsp;<span class="op" id="5200135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200139">m</span><span class="op" id="5200140">.</span><span class="ident" id="5200141">matchcap</span><span class="op" id="5200149">[</span><span class="ident" id="5200150">i</span><span class="op" id="5200151">]</span>&nbsp;<span class="op" id="5200153">=</span>&nbsp;<span class="op" id="5200155">-</span><span class="num" id="5200156">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5200159">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200162">runq</span><span class="op" id="5200166">,</span>&nbsp;<span class="ident" id="5200168">nextq</span>&nbsp;<span class="op" id="5200174">:=</span>&nbsp;<span class="op" id="5200177">&amp;</span><span class="ident" id="5200178">m</span><span class="op" id="5200179">.</span><span class="ident" id="5200180">q0</span><span class="op" id="5200182">,</span>&nbsp;<span class="op" id="5200184">&amp;</span><span class="ident" id="5200185">m</span><span class="op" id="5200186">.</span><span class="ident" id="5200187">q1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200191">r</span><span class="op" id="5200192">,</span>&nbsp;<span class="ident" id="5200194">r1</span>&nbsp;<span class="op" id="5200197">:=</span>&nbsp;<span class="ident" id="5200200">endOfText</span><span class="op" id="5200209">,</span>&nbsp;<span class="ident" id="5200211">endOfText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200222">width</span><span class="op" id="5200227">,</span>&nbsp;<span class="ident" id="5200229">width1</span>&nbsp;<span class="op" id="5200236">:=</span>&nbsp;<span class="num" id="5200239">0</span><span class="op" id="5200240">,</span>&nbsp;<span class="num" id="5200242">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200245">r</span><span class="op" id="5200246">,</span>&nbsp;<span class="ident" id="5200248">width</span>&nbsp;<span class="op" id="5200254">=</span>&nbsp;<span class="ident" id="5200256">i</span><span class="op" id="5200257">.</span><span class="ident" id="5200258">step</span><span class="op" id="5200262">(</span><span class="ident" id="5200263">pos</span><span class="op" id="5200266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200269">if</span>&nbsp;<span class="ident" id="5200272">r</span>&nbsp;<span class="op" id="5200274">!=</span>&nbsp;<span class="ident" id="5200277">endOfText</span>&nbsp;<span class="op" id="5200287">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200291">r1</span><span class="op" id="5200293">,</span>&nbsp;<span class="ident" id="5200295">width1</span>&nbsp;<span class="op" id="5200302">=</span>&nbsp;<span class="ident" id="5200304">i</span><span class="op" id="5200305">.</span><span class="ident" id="5200306">step</span><span class="op" id="5200310">(</span><span class="ident" id="5200311">pos</span>&nbsp;<span class="op" id="5200315">+</span>&nbsp;<span class="ident" id="5200317">width</span><span class="op" id="5200322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5200325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200328">var</span>&nbsp;<span class="ident" id="5200332">flag</span>&nbsp;<span class="ident" id="5200337">syntax</span><span class="op" id="5200343">.</span><span class="ident" id="5200344">EmptyOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200353">if</span>&nbsp;<span class="ident" id="5200356">pos</span>&nbsp;<span class="op" id="5200360">==</span>&nbsp;<span class="num" id="5200363">0</span>&nbsp;<span class="op" id="5200365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200369">flag</span>&nbsp;<span class="op" id="5200374">=</span>&nbsp;<span class="ident" id="5200376">syntax</span><span class="op" id="5200382">.</span><span class="ident" id="5200383">EmptyOpContext</span><span class="op" id="5200397">(</span><span class="op" id="5200398">-</span><span class="num" id="5200399">1</span><span class="op" id="5200400">,</span>&nbsp;<span class="ident" id="5200402">r</span><span class="op" id="5200403">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5200406">}</span>&nbsp;<span class="keyword" id="5200408">else</span>&nbsp;<span class="op" id="5200413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200417">flag</span>&nbsp;<span class="op" id="5200422">=</span>&nbsp;<span class="ident" id="5200424">i</span><span class="op" id="5200425">.</span><span class="ident" id="5200426">context</span><span class="op" id="5200433">(</span><span class="ident" id="5200434">pos</span><span class="op" id="5200437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5200440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200443">for</span>&nbsp;<span class="op" id="5200447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200451">if</span>&nbsp;<span class="builtinfunc" id="5200454">len</span><span class="op" id="5200457">(</span><span class="ident" id="5200458">runq</span><span class="op" id="5200462">.</span><span class="ident" id="5200463">dense</span><span class="op" id="5200468">)</span>&nbsp;<span class="op" id="5200470">==</span>&nbsp;<span class="num" id="5200473">0</span>&nbsp;<span class="op" id="5200475">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200480">if</span>&nbsp;<span class="ident" id="5200483">startCond</span><span class="op" id="5200492">&amp;</span><span class="ident" id="5200493">syntax</span><span class="op" id="5200499">.</span><span class="ident" id="5200500">EmptyBeginText</span>&nbsp;<span class="op" id="5200515">!=</span>&nbsp;<span class="num" id="5200518">0</span>&nbsp;<span class="op" id="5200520">&amp;&amp;</span>&nbsp;<span class="ident" id="5200523">pos</span>&nbsp;<span class="op" id="5200527">!=</span>&nbsp;<span class="num" id="5200530">0</span>&nbsp;<span class="op" id="5200532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5200538">//&nbsp;Anchored&nbsp;match,&nbsp;past&nbsp;beginning&nbsp;of&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200585">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5200594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200599">if</span>&nbsp;<span class="ident" id="5200602">m</span><span class="op" id="5200603">.</span><span class="ident" id="5200604">matched</span>&nbsp;<span class="op" id="5200612">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5200618">//&nbsp;Have&nbsp;match;&nbsp;finished&nbsp;exploring&nbsp;alternatives.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200670">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5200679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200684">if</span>&nbsp;<span class="builtinfunc" id="5200687">len</span><span class="op" id="5200690">(</span><span class="ident" id="5200691">m</span><span class="op" id="5200692">.</span><span class="ident" id="5200693">re</span><span class="op" id="5200695">.</span><span class="ident" id="5200696">prefix</span><span class="op" id="5200702">)</span>&nbsp;<span class="op" id="5200704">&gt;</span>&nbsp;<span class="num" id="5200706">0</span>&nbsp;<span class="op" id="5200708">&amp;&amp;</span>&nbsp;<span class="ident" id="5200711">r1</span>&nbsp;<span class="op" id="5200714">!=</span>&nbsp;<span class="ident" id="5200717">m</span><span class="op" id="5200718">.</span><span class="ident" id="5200719">re</span><span class="op" id="5200721">.</span><span class="ident" id="5200722">prefixRune</span>&nbsp;<span class="op" id="5200733">&amp;&amp;</span>&nbsp;<span class="ident" id="5200736">i</span><span class="op" id="5200737">.</span><span class="ident" id="5200738">canCheckPrefix</span><span class="op" id="5200752">(</span><span class="op" id="5200753">)</span>&nbsp;<span class="op" id="5200755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5200761">//&nbsp;Match&nbsp;requires&nbsp;literal&nbsp;prefix;&nbsp;fast&nbsp;search&nbsp;for&nbsp;it.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200819">advance</span>&nbsp;<span class="op" id="5200827">:=</span>&nbsp;<span class="ident" id="5200830">i</span><span class="op" id="5200831">.</span><span class="ident" id="5200832">index</span><span class="op" id="5200837">(</span><span class="ident" id="5200838">m</span><span class="op" id="5200839">.</span><span class="ident" id="5200840">re</span><span class="op" id="5200842">,</span>&nbsp;<span class="ident" id="5200844">pos</span><span class="op" id="5200847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200853">if</span>&nbsp;<span class="ident" id="5200856">advance</span>&nbsp;<span class="op" id="5200864">&lt;</span>&nbsp;<span class="num" id="5200866">0</span>&nbsp;<span class="op" id="5200868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200875">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5200885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200891">pos</span>&nbsp;<span class="op" id="5200895">+=</span>&nbsp;<span class="ident" id="5200898">advance</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200910">r</span><span class="op" id="5200911">,</span>&nbsp;<span class="ident" id="5200913">width</span>&nbsp;<span class="op" id="5200919">=</span>&nbsp;<span class="ident" id="5200921">i</span><span class="op" id="5200922">.</span><span class="ident" id="5200923">step</span><span class="op" id="5200927">(</span><span class="ident" id="5200928">pos</span><span class="op" id="5200931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200937">r1</span><span class="op" id="5200939">,</span>&nbsp;<span class="ident" id="5200941">width1</span>&nbsp;<span class="op" id="5200948">=</span>&nbsp;<span class="ident" id="5200950">i</span><span class="op" id="5200951">.</span><span class="ident" id="5200952">step</span><span class="op" id="5200956">(</span><span class="ident" id="5200957">pos</span>&nbsp;<span class="op" id="5200961">+</span>&nbsp;<span class="ident" id="5200963">width</span><span class="op" id="5200968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5200973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5200977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200981">if</span>&nbsp;<span class="op" id="5200984">!</span><span class="ident" id="5200985">m</span><span class="op" id="5200986">.</span><span class="ident" id="5200987">matched</span>&nbsp;<span class="op" id="5200995">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201000">if</span>&nbsp;<span class="builtinfunc" id="5201003">len</span><span class="op" id="5201006">(</span><span class="ident" id="5201007">m</span><span class="op" id="5201008">.</span><span class="ident" id="5201009">matchcap</span><span class="op" id="5201017">)</span>&nbsp;<span class="op" id="5201019">&gt;</span>&nbsp;<span class="num" id="5201021">0</span>&nbsp;<span class="op" id="5201023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5201029">m</span><span class="op" id="5201030">.</span><span class="ident" id="5201031">matchcap</span><span class="op" id="5201039">[</span><span class="num" id="5201040">0</span><span class="op" id="5201041">]</span>&nbsp;<span class="op" id="5201043">=</span>&nbsp;<span class="ident" id="5201045">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5201052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5201057">m</span><span class="op" id="5201058">.</span><span class="ident" id="5201059">add</span><span class="op" id="5201062">(</span><span class="ident" id="5201063">runq</span><span class="op" id="5201067">,</span>&nbsp;<span class="builtintype" id="5201069">uint32</span><span class="op" id="5201075">(</span><span class="ident" id="5201076">m</span><span class="op" id="5201077">.</span><span class="ident" id="5201078">p</span><span class="op" id="5201079">.</span><span class="ident" id="5201080">Start</span><span class="op" id="5201085">)</span><span class="op" id="5201086">,</span>&nbsp;<span class="ident" id="5201088">pos</span><span class="op" id="5201091">,</span>&nbsp;<span class="ident" id="5201093">m</span><span class="op" id="5201094">.</span><span class="ident" id="5201095">matchcap</span><span class="op" id="5201103">,</span>&nbsp;<span class="ident" id="5201105">flag</span><span class="op" id="5201109">,</span>&nbsp;<span class="ident" id="5201111">nil</span><span class="op" id="5201114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5201118">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5201122">flag</span>&nbsp;<span class="op" id="5201127">=</span>&nbsp;<span class="ident" id="5201129">syntax</span><span class="op" id="5201135">.</span><span class="ident" id="5201136">EmptyOpContext</span><span class="op" id="5201150">(</span><span class="ident" id="5201151">r</span><span class="op" id="5201152">,</span>&nbsp;<span class="ident" id="5201154">r1</span><span class="op" id="5201156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5201160">m</span><span class="op" id="5201161">.</span><span class="ident" id="5201162">step</span><span class="op" id="5201166">(</span><span class="ident" id="5201167">runq</span><span class="op" id="5201171">,</span>&nbsp;<span class="ident" id="5201173">nextq</span><span class="op" id="5201178">,</span>&nbsp;<span class="ident" id="5201180">pos</span><span class="op" id="5201183">,</span>&nbsp;<span class="ident" id="5201185">pos</span><span class="op" id="5201188">+</span><span class="ident" id="5201189">width</span><span class="op" id="5201194">,</span>&nbsp;<span class="ident" id="5201196">r</span><span class="op" id="5201197">,</span>&nbsp;<span class="ident" id="5201199">flag</span><span class="op" id="5201203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201207">if</span>&nbsp;<span class="ident" id="5201210">width</span>&nbsp;<span class="op" id="5201216">==</span>&nbsp;<span class="num" id="5201219">0</span>&nbsp;<span class="op" id="5201221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201226">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5201234">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201238">if</span>&nbsp;<span class="builtinfunc" id="5201241">len</span><span class="op" id="5201244">(</span><span class="ident" id="5201245">m</span><span class="op" id="5201246">.</span><span class="ident" id="5201247">matchcap</span><span class="op" id="5201255">)</span>&nbsp;<span class="op" id="5201257">==</span>&nbsp;<span class="num" id="5201260">0</span>&nbsp;<span class="op" id="5201262">&amp;&amp;</span>&nbsp;<span class="ident" id="5201265">m</span><span class="op" id="5201266">.</span><span class="ident" id="5201267">matched</span>&nbsp;<span class="op" id="5201275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5201280">//&nbsp;Found&nbsp;a&nbsp;match&nbsp;and&nbsp;not&nbsp;paying&nbsp;attention</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5201325">//&nbsp;to&nbsp;where&nbsp;it&nbsp;is,&nbsp;so&nbsp;any&nbsp;match&nbsp;will&nbsp;do.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201369">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5201377">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5201381">pos</span>&nbsp;<span class="op" id="5201385">+=</span>&nbsp;<span class="ident" id="5201388">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5201396">r</span><span class="op" id="5201397">,</span>&nbsp;<span class="ident" id="5201399">width</span>&nbsp;<span class="op" id="5201405">=</span>&nbsp;<span class="ident" id="5201407">r1</span><span class="op" id="5201409">,</span>&nbsp;<span class="ident" id="5201411">width1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201420">if</span>&nbsp;<span class="ident" id="5201423">r</span>&nbsp;<span class="op" id="5201425">!=</span>&nbsp;<span class="ident" id="5201428">endOfText</span>&nbsp;<span class="op" id="5201438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5201443">r1</span><span class="op" id="5201445">,</span>&nbsp;<span class="ident" id="5201447">width1</span>&nbsp;<span class="op" id="5201454">=</span>&nbsp;<span class="ident" id="5201456">i</span><span class="op" id="5201457">.</span><span class="ident" id="5201458">step</span><span class="op" id="5201462">(</span><span class="ident" id="5201463">pos</span>&nbsp;<span class="op" id="5201467">+</span>&nbsp;<span class="ident" id="5201469">width</span><span class="op" id="5201474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5201478">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5201482">runq</span><span class="op" id="5201486">,</span>&nbsp;<span class="ident" id="5201488">nextq</span>&nbsp;<span class="op" id="5201494">=</span>&nbsp;<span class="ident" id="5201496">nextq</span><span class="op" id="5201501">,</span>&nbsp;<span class="ident" id="5201503">runq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5201509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5201512">m</span><span class="op" id="5201513">.</span><span class="ident" id="5201514">clear</span><span class="op" id="5201519">(</span><span class="ident" id="5201520">nextq</span><span class="op" id="5201525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201528">return</span>&nbsp;<span class="ident" id="5201535">m</span><span class="op" id="5201536">.</span><span class="ident" id="5201537">matched</span><br>
<span class="lineno"></span><span class="op" id="5201545">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="comment" id="5201548">//&nbsp;clear&nbsp;frees&nbsp;all&nbsp;threads&nbsp;on&nbsp;the&nbsp;thread&nbsp;queue.</span><br>
<span class="lineno"></span><span class="keyword" id="5201596">func</span>&nbsp;<span class="op" id="5201601">(</span><span class="ident" id="5201602">m</span>&nbsp;<span class="op" id="5201604">*</span><span class="ident" id="5201605">machine</span><span class="op" id="5201612">)</span>&nbsp;<span class="ident" id="5201614">clear</span><span class="op" id="5201619">(</span><span class="ident" id="5201620">q</span>&nbsp;<span class="op" id="5201622">*</span><span class="ident" id="5201623">queue</span><span class="op" id="5201628">)</span>&nbsp;<span class="op" id="5201630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201633">for</span>&nbsp;<span class="ident" id="5201637">_</span><span class="op" id="5201638">,</span>&nbsp;<span class="ident" id="5201640">d</span>&nbsp;<span class="op" id="5201642">:=</span>&nbsp;<span class="keyword" id="5201645">range</span>&nbsp;<span class="ident" id="5201651">q</span><span class="op" id="5201652">.</span><span class="ident" id="5201653">dense</span>&nbsp;<span class="op" id="5201659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201663">if</span>&nbsp;<span class="ident" id="5201666">d</span><span class="op" id="5201667">.</span><span class="ident" id="5201668">t</span>&nbsp;<span class="op" id="5201670">!=</span>&nbsp;<span class="ident" id="5201673">nil</span>&nbsp;<span class="op" id="5201677">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5201682">//&nbsp;m.free(d.t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5201700">m</span><span class="op" id="5201701">.</span><span class="ident" id="5201702">pool</span>&nbsp;<span class="op" id="5201707">=</span>&nbsp;<span class="builtinfunc" id="5201709">append</span><span class="op" id="5201715">(</span><span class="ident" id="5201716">m</span><span class="op" id="5201717">.</span><span class="ident" id="5201718">pool</span><span class="op" id="5201722">,</span>&nbsp;<span class="ident" id="5201724">d</span><span class="op" id="5201725">.</span><span class="ident" id="5201726">t</span><span class="op" id="5201727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5201731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5201734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5201737">q</span><span class="op" id="5201738">.</span><span class="ident" id="5201739">dense</span>&nbsp;<span class="op" id="5201745">=</span>&nbsp;<span class="ident" id="5201747">q</span><span class="op" id="5201748">.</span><span class="ident" id="5201749">dense</span><span class="op" id="5201754">[</span><span class="op" id="5201755">:</span><span class="num" id="5201756">0</span><span class="op" id="5201757">]</span><br>
<span class="lineno">195</span><span class="op" id="5201759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5201762">//&nbsp;step&nbsp;executes&nbsp;one&nbsp;step&nbsp;of&nbsp;the&nbsp;machine,&nbsp;running&nbsp;each&nbsp;of&nbsp;the&nbsp;threads</span><br>
<span class="lineno"></span><span class="comment" id="5201832">//&nbsp;on&nbsp;runq&nbsp;and&nbsp;appending&nbsp;new&nbsp;threads&nbsp;to&nbsp;nextq.</span><br>
<span class="lineno"></span><span class="comment" id="5201879">//&nbsp;The&nbsp;step&nbsp;processes&nbsp;the&nbsp;rune&nbsp;c&nbsp;(which&nbsp;may&nbsp;be&nbsp;endOfText),</span><br>
<span class="lineno">200</span><span class="comment" id="5201938">//&nbsp;which&nbsp;starts&nbsp;at&nbsp;position&nbsp;pos&nbsp;and&nbsp;ends&nbsp;at&nbsp;nextPos.</span><br>
<span class="lineno"></span><span class="comment" id="5201991">//&nbsp;nextCond&nbsp;gives&nbsp;the&nbsp;setting&nbsp;for&nbsp;the&nbsp;empty-width&nbsp;flags&nbsp;after&nbsp;c.</span><br>
<span class="lineno"></span><span class="keyword" id="5202056">func</span>&nbsp;<span class="op" id="5202061">(</span><span class="ident" id="5202062">m</span>&nbsp;<span class="op" id="5202064">*</span><span class="ident" id="5202065">machine</span><span class="op" id="5202072">)</span>&nbsp;<span class="ident" id="5202074">step</span><span class="op" id="5202078">(</span><span class="ident" id="5202079">runq</span><span class="op" id="5202083">,</span>&nbsp;<span class="ident" id="5202085">nextq</span>&nbsp;<span class="op" id="5202091">*</span><span class="ident" id="5202092">queue</span><span class="op" id="5202097">,</span>&nbsp;<span class="ident" id="5202099">pos</span><span class="op" id="5202102">,</span>&nbsp;<span class="ident" id="5202104">nextPos</span>&nbsp;<span class="builtintype" id="5202112">int</span><span class="op" id="5202115">,</span>&nbsp;<span class="ident" id="5202117">c</span>&nbsp;<span class="builtintype" id="5202119">rune</span><span class="op" id="5202123">,</span>&nbsp;<span class="ident" id="5202125">nextCond</span>&nbsp;<span class="ident" id="5202134">syntax</span><span class="op" id="5202140">.</span><span class="ident" id="5202141">EmptyOp</span><span class="op" id="5202148">)</span>&nbsp;<span class="op" id="5202150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202153">longest</span>&nbsp;<span class="op" id="5202161">:=</span>&nbsp;<span class="ident" id="5202164">m</span><span class="op" id="5202165">.</span><span class="ident" id="5202166">re</span><span class="op" id="5202168">.</span><span class="ident" id="5202169">longest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202178">for</span>&nbsp;<span class="ident" id="5202182">j</span>&nbsp;<span class="op" id="5202184">:=</span>&nbsp;<span class="num" id="5202187">0</span><span class="op" id="5202188">;</span>&nbsp;<span class="ident" id="5202190">j</span>&nbsp;<span class="op" id="5202192">&lt;</span>&nbsp;<span class="builtinfunc" id="5202194">len</span><span class="op" id="5202197">(</span><span class="ident" id="5202198">runq</span><span class="op" id="5202202">.</span><span class="ident" id="5202203">dense</span><span class="op" id="5202208">)</span><span class="op" id="5202209">;</span>&nbsp;<span class="ident" id="5202211">j</span><span class="op" id="5202212">++</span>&nbsp;<span class="op" id="5202215">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202219">d</span>&nbsp;<span class="op" id="5202221">:=</span>&nbsp;<span class="op" id="5202224">&amp;</span><span class="ident" id="5202225">runq</span><span class="op" id="5202229">.</span><span class="ident" id="5202230">dense</span><span class="op" id="5202235">[</span><span class="ident" id="5202236">j</span><span class="op" id="5202237">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202241">t</span>&nbsp;<span class="op" id="5202243">:=</span>&nbsp;<span class="ident" id="5202246">d</span><span class="op" id="5202247">.</span><span class="ident" id="5202248">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202252">if</span>&nbsp;<span class="ident" id="5202255">t</span>&nbsp;<span class="op" id="5202257">==</span>&nbsp;<span class="ident" id="5202260">nil</span>&nbsp;<span class="op" id="5202264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202269">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5202280">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202284">if</span>&nbsp;<span class="ident" id="5202287">longest</span>&nbsp;<span class="op" id="5202295">&amp;&amp;</span>&nbsp;<span class="ident" id="5202298">m</span><span class="op" id="5202299">.</span><span class="ident" id="5202300">matched</span>&nbsp;<span class="op" id="5202308">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5202311">len</span><span class="op" id="5202314">(</span><span class="ident" id="5202315">t</span><span class="op" id="5202316">.</span><span class="builtinfunc" id="5202317">cap</span><span class="op" id="5202320">)</span>&nbsp;<span class="op" id="5202322">&gt;</span>&nbsp;<span class="num" id="5202324">0</span>&nbsp;<span class="op" id="5202326">&amp;&amp;</span>&nbsp;<span class="ident" id="5202329">m</span><span class="op" id="5202330">.</span><span class="ident" id="5202331">matchcap</span><span class="op" id="5202339">[</span><span class="num" id="5202340">0</span><span class="op" id="5202341">]</span>&nbsp;<span class="op" id="5202343">&lt;</span>&nbsp;<span class="ident" id="5202345">t</span><span class="op" id="5202346">.</span><span class="builtinfunc" id="5202347">cap</span><span class="op" id="5202350">[</span><span class="num" id="5202351">0</span><span class="op" id="5202352">]</span>&nbsp;<span class="op" id="5202354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5202359">//&nbsp;m.free(t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202375">m</span><span class="op" id="5202376">.</span><span class="ident" id="5202377">pool</span>&nbsp;<span class="op" id="5202382">=</span>&nbsp;<span class="builtinfunc" id="5202384">append</span><span class="op" id="5202390">(</span><span class="ident" id="5202391">m</span><span class="op" id="5202392">.</span><span class="ident" id="5202393">pool</span><span class="op" id="5202397">,</span>&nbsp;<span class="ident" id="5202399">t</span><span class="op" id="5202400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202405">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5202416">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202420">i</span>&nbsp;<span class="op" id="5202422">:=</span>&nbsp;<span class="ident" id="5202425">t</span><span class="op" id="5202426">.</span><span class="ident" id="5202427">inst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202434">add</span>&nbsp;<span class="op" id="5202438">:=</span>&nbsp;<span class="builtintype" id="5202441">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202449">switch</span>&nbsp;<span class="ident" id="5202456">i</span><span class="op" id="5202457">.</span><span class="ident" id="5202458">Op</span>&nbsp;<span class="op" id="5202461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202465">default</span><span class="op" id="5202472">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5202477">panic</span><span class="op" id="5202482">(</span><span class="string" id="5202483">&#34;bad&nbsp;inst&#34;</span><span class="op" id="5202493">)</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202498">case</span>&nbsp;<span class="ident" id="5202503">syntax</span><span class="op" id="5202509">.</span><span class="ident" id="5202510">InstMatch</span><span class="op" id="5202519">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202524">if</span>&nbsp;<span class="builtinfunc" id="5202527">len</span><span class="op" id="5202530">(</span><span class="ident" id="5202531">t</span><span class="op" id="5202532">.</span><span class="builtinfunc" id="5202533">cap</span><span class="op" id="5202536">)</span>&nbsp;<span class="op" id="5202538">&gt;</span>&nbsp;<span class="num" id="5202540">0</span>&nbsp;<span class="op" id="5202542">&amp;&amp;</span>&nbsp;<span class="op" id="5202545">(</span><span class="op" id="5202546">!</span><span class="ident" id="5202547">longest</span>&nbsp;<span class="op" id="5202555">||</span>&nbsp;<span class="op" id="5202558">!</span><span class="ident" id="5202559">m</span><span class="op" id="5202560">.</span><span class="ident" id="5202561">matched</span>&nbsp;<span class="op" id="5202569">||</span>&nbsp;<span class="ident" id="5202572">m</span><span class="op" id="5202573">.</span><span class="ident" id="5202574">matchcap</span><span class="op" id="5202582">[</span><span class="num" id="5202583">1</span><span class="op" id="5202584">]</span>&nbsp;<span class="op" id="5202586">&lt;</span>&nbsp;<span class="ident" id="5202588">pos</span><span class="op" id="5202591">)</span>&nbsp;<span class="op" id="5202593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202599">t</span><span class="op" id="5202600">.</span><span class="builtinfunc" id="5202601">cap</span><span class="op" id="5202604">[</span><span class="num" id="5202605">1</span><span class="op" id="5202606">]</span>&nbsp;<span class="op" id="5202608">=</span>&nbsp;<span class="ident" id="5202610">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5202618">copy</span><span class="op" id="5202622">(</span><span class="ident" id="5202623">m</span><span class="op" id="5202624">.</span><span class="ident" id="5202625">matchcap</span><span class="op" id="5202633">,</span>&nbsp;<span class="ident" id="5202635">t</span><span class="op" id="5202636">.</span><span class="builtinfunc" id="5202637">cap</span><span class="op" id="5202640">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5202645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202650">if</span>&nbsp;<span class="op" id="5202653">!</span><span class="ident" id="5202654">longest</span>&nbsp;<span class="op" id="5202662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5202668">//&nbsp;First-match&nbsp;mode:&nbsp;cut&nbsp;off&nbsp;all&nbsp;lower-priority&nbsp;threads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202729">for</span>&nbsp;<span class="ident" id="5202733">_</span><span class="op" id="5202734">,</span>&nbsp;<span class="ident" id="5202736">d</span>&nbsp;<span class="op" id="5202738">:=</span>&nbsp;<span class="keyword" id="5202741">range</span>&nbsp;<span class="ident" id="5202747">runq</span><span class="op" id="5202751">.</span><span class="ident" id="5202752">dense</span><span class="op" id="5202757">[</span><span class="ident" id="5202758">j</span><span class="op" id="5202759">+</span><span class="num" id="5202760">1</span><span class="op" id="5202761">:</span><span class="op" id="5202762">]</span>&nbsp;<span class="op" id="5202764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202771">if</span>&nbsp;<span class="ident" id="5202774">d</span><span class="op" id="5202775">.</span><span class="ident" id="5202776">t</span>&nbsp;<span class="op" id="5202778">!=</span>&nbsp;<span class="ident" id="5202781">nil</span>&nbsp;<span class="op" id="5202785">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5202793">//&nbsp;m.free(d.t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202814">m</span><span class="op" id="5202815">.</span><span class="ident" id="5202816">pool</span>&nbsp;<span class="op" id="5202821">=</span>&nbsp;<span class="builtinfunc" id="5202823">append</span><span class="op" id="5202829">(</span><span class="ident" id="5202830">m</span><span class="op" id="5202831">.</span><span class="ident" id="5202832">pool</span><span class="op" id="5202836">,</span>&nbsp;<span class="ident" id="5202838">d</span><span class="op" id="5202839">.</span><span class="ident" id="5202840">t</span><span class="op" id="5202841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5202848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5202854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202860">runq</span><span class="op" id="5202864">.</span><span class="ident" id="5202865">dense</span>&nbsp;<span class="op" id="5202871">=</span>&nbsp;<span class="ident" id="5202873">runq</span><span class="op" id="5202877">.</span><span class="ident" id="5202878">dense</span><span class="op" id="5202883">[</span><span class="op" id="5202884">:</span><span class="num" id="5202885">0</span><span class="op" id="5202886">]</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5202891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202896">m</span><span class="op" id="5202897">.</span><span class="ident" id="5202898">matched</span>&nbsp;<span class="op" id="5202906">=</span>&nbsp;<span class="builtintype" id="5202908">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202916">case</span>&nbsp;<span class="ident" id="5202921">syntax</span><span class="op" id="5202927">.</span><span class="ident" id="5202928">InstRune</span><span class="op" id="5202936">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202941">add</span>&nbsp;<span class="op" id="5202945">=</span>&nbsp;<span class="ident" id="5202947">i</span><span class="op" id="5202948">.</span><span class="ident" id="5202949">MatchRune</span><span class="op" id="5202958">(</span><span class="ident" id="5202959">c</span><span class="op" id="5202960">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202964">case</span>&nbsp;<span class="ident" id="5202969">syntax</span><span class="op" id="5202975">.</span><span class="ident" id="5202976">InstRune1</span><span class="op" id="5202985">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202990">add</span>&nbsp;<span class="op" id="5202994">=</span>&nbsp;<span class="ident" id="5202996">c</span>&nbsp;<span class="op" id="5202998">==</span>&nbsp;<span class="ident" id="5203001">i</span><span class="op" id="5203002">.</span><span class="ident" id="5203003">Rune</span><span class="op" id="5203007">[</span><span class="num" id="5203008">0</span><span class="op" id="5203009">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5203013">case</span>&nbsp;<span class="ident" id="5203018">syntax</span><span class="op" id="5203024">.</span><span class="ident" id="5203025">InstRuneAny</span><span class="op" id="5203036">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203041">add</span>&nbsp;<span class="op" id="5203045">=</span>&nbsp;<span class="builtintype" id="5203047">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5203054">case</span>&nbsp;<span class="ident" id="5203059">syntax</span><span class="op" id="5203065">.</span><span class="ident" id="5203066">InstRuneAnyNotNL</span><span class="op" id="5203082">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203087">add</span>&nbsp;<span class="op" id="5203091">=</span>&nbsp;<span class="ident" id="5203093">c</span>&nbsp;<span class="op" id="5203095">!=</span>&nbsp;<span class="string" id="5203098">&#39;\n&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5203105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5203109">if</span>&nbsp;<span class="ident" id="5203112">add</span>&nbsp;<span class="op" id="5203116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203121">t</span>&nbsp;<span class="op" id="5203123">=</span>&nbsp;<span class="ident" id="5203125">m</span><span class="op" id="5203126">.</span><span class="ident" id="5203127">add</span><span class="op" id="5203130">(</span><span class="ident" id="5203131">nextq</span><span class="op" id="5203136">,</span>&nbsp;<span class="ident" id="5203138">i</span><span class="op" id="5203139">.</span><span class="ident" id="5203140">Out</span><span class="op" id="5203143">,</span>&nbsp;<span class="ident" id="5203145">nextPos</span><span class="op" id="5203152">,</span>&nbsp;<span class="ident" id="5203154">t</span><span class="op" id="5203155">.</span><span class="builtinfunc" id="5203156">cap</span><span class="op" id="5203159">,</span>&nbsp;<span class="ident" id="5203161">nextCond</span><span class="op" id="5203169">,</span>&nbsp;<span class="ident" id="5203171">t</span><span class="op" id="5203172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5203176">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5203180">if</span>&nbsp;<span class="ident" id="5203183">t</span>&nbsp;<span class="op" id="5203185">!=</span>&nbsp;<span class="ident" id="5203188">nil</span>&nbsp;<span class="op" id="5203192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5203197">//&nbsp;m.free(t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203213">m</span><span class="op" id="5203214">.</span><span class="ident" id="5203215">pool</span>&nbsp;<span class="op" id="5203220">=</span>&nbsp;<span class="builtinfunc" id="5203222">append</span><span class="op" id="5203228">(</span><span class="ident" id="5203229">m</span><span class="op" id="5203230">.</span><span class="ident" id="5203231">pool</span><span class="op" id="5203235">,</span>&nbsp;<span class="ident" id="5203237">t</span><span class="op" id="5203238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5203242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5203245">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203248">runq</span><span class="op" id="5203252">.</span><span class="ident" id="5203253">dense</span>&nbsp;<span class="op" id="5203259">=</span>&nbsp;<span class="ident" id="5203261">runq</span><span class="op" id="5203265">.</span><span class="ident" id="5203266">dense</span><span class="op" id="5203271">[</span><span class="op" id="5203272">:</span><span class="num" id="5203273">0</span><span class="op" id="5203274">]</span><br>
<span class="lineno"></span><span class="op" id="5203276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5203279">//&nbsp;add&nbsp;adds&nbsp;an&nbsp;entry&nbsp;to&nbsp;q&nbsp;for&nbsp;pc,&nbsp;unless&nbsp;the&nbsp;q&nbsp;already&nbsp;has&nbsp;such&nbsp;an&nbsp;entry.</span><br>
<span class="lineno"></span><span class="comment" id="5203353">//&nbsp;It&nbsp;also&nbsp;recursively&nbsp;adds&nbsp;an&nbsp;entry&nbsp;for&nbsp;all&nbsp;instructions&nbsp;reachable&nbsp;from&nbsp;pc&nbsp;by&nbsp;following</span><br>
<span class="lineno">260</span><span class="comment" id="5203442">//&nbsp;empty-width&nbsp;conditions&nbsp;satisfied&nbsp;by&nbsp;cond.&nbsp;&nbsp;pos&nbsp;gives&nbsp;the&nbsp;current&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="5203519">//&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="5203536">func</span>&nbsp;<span class="op" id="5203541">(</span><span class="ident" id="5203542">m</span>&nbsp;<span class="op" id="5203544">*</span><span class="ident" id="5203545">machine</span><span class="op" id="5203552">)</span>&nbsp;<span class="ident" id="5203554">add</span><span class="op" id="5203557">(</span><span class="ident" id="5203558">q</span>&nbsp;<span class="op" id="5203560">*</span><span class="ident" id="5203561">queue</span><span class="op" id="5203566">,</span>&nbsp;<span class="ident" id="5203568">pc</span>&nbsp;<span class="builtintype" id="5203571">uint32</span><span class="op" id="5203577">,</span>&nbsp;<span class="ident" id="5203579">pos</span>&nbsp;<span class="builtintype" id="5203583">int</span><span class="op" id="5203586">,</span>&nbsp;<span class="builtinfunc" id="5203588">cap</span>&nbsp;<span class="op" id="5203592">[</span><span class="op" id="5203593">]</span><span class="builtintype" id="5203594">int</span><span class="op" id="5203597">,</span>&nbsp;<span class="ident" id="5203599">cond</span>&nbsp;<span class="ident" id="5203604">syntax</span><span class="op" id="5203610">.</span><span class="ident" id="5203611">EmptyOp</span><span class="op" id="5203618">,</span>&nbsp;<span class="ident" id="5203620">t</span>&nbsp;<span class="op" id="5203622">*</span><span class="ident" id="5203623">thread</span><span class="op" id="5203629">)</span>&nbsp;<span class="op" id="5203631">*</span><span class="ident" id="5203632">thread</span>&nbsp;<span class="op" id="5203639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5203642">if</span>&nbsp;<span class="ident" id="5203645">pc</span>&nbsp;<span class="op" id="5203648">==</span>&nbsp;<span class="num" id="5203651">0</span>&nbsp;<span class="op" id="5203653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5203657">return</span>&nbsp;<span class="ident" id="5203664">t</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5203667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5203670">if</span>&nbsp;<span class="ident" id="5203673">j</span>&nbsp;<span class="op" id="5203675">:=</span>&nbsp;<span class="ident" id="5203678">q</span><span class="op" id="5203679">.</span><span class="ident" id="5203680">sparse</span><span class="op" id="5203686">[</span><span class="ident" id="5203687">pc</span><span class="op" id="5203689">]</span><span class="op" id="5203690">;</span>&nbsp;<span class="ident" id="5203692">j</span>&nbsp;<span class="op" id="5203694">&lt;</span>&nbsp;<span class="builtintype" id="5203696">uint32</span><span class="op" id="5203702">(</span><span class="builtinfunc" id="5203703">len</span><span class="op" id="5203706">(</span><span class="ident" id="5203707">q</span><span class="op" id="5203708">.</span><span class="ident" id="5203709">dense</span><span class="op" id="5203714">)</span><span class="op" id="5203715">)</span>&nbsp;<span class="op" id="5203717">&amp;&amp;</span>&nbsp;<span class="ident" id="5203720">q</span><span class="op" id="5203721">.</span><span class="ident" id="5203722">dense</span><span class="op" id="5203727">[</span><span class="ident" id="5203728">j</span><span class="op" id="5203729">]</span><span class="op" id="5203730">.</span><span class="ident" id="5203731">pc</span>&nbsp;<span class="op" id="5203734">==</span>&nbsp;<span class="ident" id="5203737">pc</span>&nbsp;<span class="op" id="5203740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5203744">return</span>&nbsp;<span class="ident" id="5203751">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5203754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203758">j</span>&nbsp;<span class="op" id="5203760">:=</span>&nbsp;<span class="builtinfunc" id="5203763">len</span><span class="op" id="5203766">(</span><span class="ident" id="5203767">q</span><span class="op" id="5203768">.</span><span class="ident" id="5203769">dense</span><span class="op" id="5203774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203777">q</span><span class="op" id="5203778">.</span><span class="ident" id="5203779">dense</span>&nbsp;<span class="op" id="5203785">=</span>&nbsp;<span class="ident" id="5203787">q</span><span class="op" id="5203788">.</span><span class="ident" id="5203789">dense</span><span class="op" id="5203794">[</span><span class="op" id="5203795">:</span><span class="ident" id="5203796">j</span><span class="op" id="5203797">+</span><span class="num" id="5203798">1</span><span class="op" id="5203799">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203802">d</span>&nbsp;<span class="op" id="5203804">:=</span>&nbsp;<span class="op" id="5203807">&amp;</span><span class="ident" id="5203808">q</span><span class="op" id="5203809">.</span><span class="ident" id="5203810">dense</span><span class="op" id="5203815">[</span><span class="ident" id="5203816">j</span><span class="op" id="5203817">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203820">d</span><span class="op" id="5203821">.</span><span class="ident" id="5203822">t</span>&nbsp;<span class="op" id="5203824">=</span>&nbsp;<span class="ident" id="5203826">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203831">d</span><span class="op" id="5203832">.</span><span class="ident" id="5203833">pc</span>&nbsp;<span class="op" id="5203836">=</span>&nbsp;<span class="ident" id="5203838">pc</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203842">q</span><span class="op" id="5203843">.</span><span class="ident" id="5203844">sparse</span><span class="op" id="5203850">[</span><span class="ident" id="5203851">pc</span><span class="op" id="5203853">]</span>&nbsp;<span class="op" id="5203855">=</span>&nbsp;<span class="builtintype" id="5203857">uint32</span><span class="op" id="5203863">(</span><span class="ident" id="5203864">j</span><span class="op" id="5203865">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203869">i</span>&nbsp;<span class="op" id="5203871">:=</span>&nbsp;<span class="op" id="5203874">&amp;</span><span class="ident" id="5203875">m</span><span class="op" id="5203876">.</span><span class="ident" id="5203877">p</span><span class="op" id="5203878">.</span><span class="ident" id="5203879">Inst</span><span class="op" id="5203883">[</span><span class="ident" id="5203884">pc</span><span class="op" id="5203886">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5203889">switch</span>&nbsp;<span class="ident" id="5203896">i</span><span class="op" id="5203897">.</span><span class="ident" id="5203898">Op</span>&nbsp;<span class="op" id="5203901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5203904">default</span><span class="op" id="5203911">:</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5203915">panic</span><span class="op" id="5203920">(</span><span class="string" id="5203921">&#34;unhandled&#34;</span><span class="op" id="5203932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5203935">case</span>&nbsp;<span class="ident" id="5203940">syntax</span><span class="op" id="5203946">.</span><span class="ident" id="5203947">InstFail</span><span class="op" id="5203955">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5203959">//&nbsp;nothing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5203971">case</span>&nbsp;<span class="ident" id="5203976">syntax</span><span class="op" id="5203982">.</span><span class="ident" id="5203983">InstAlt</span><span class="op" id="5203990">,</span>&nbsp;<span class="ident" id="5203992">syntax</span><span class="op" id="5203998">.</span><span class="ident" id="5203999">InstAltMatch</span><span class="op" id="5204011">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204015">t</span>&nbsp;<span class="op" id="5204017">=</span>&nbsp;<span class="ident" id="5204019">m</span><span class="op" id="5204020">.</span><span class="ident" id="5204021">add</span><span class="op" id="5204024">(</span><span class="ident" id="5204025">q</span><span class="op" id="5204026">,</span>&nbsp;<span class="ident" id="5204028">i</span><span class="op" id="5204029">.</span><span class="ident" id="5204030">Out</span><span class="op" id="5204033">,</span>&nbsp;<span class="ident" id="5204035">pos</span><span class="op" id="5204038">,</span>&nbsp;<span class="builtinfunc" id="5204040">cap</span><span class="op" id="5204043">,</span>&nbsp;<span class="ident" id="5204045">cond</span><span class="op" id="5204049">,</span>&nbsp;<span class="ident" id="5204051">t</span><span class="op" id="5204052">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204056">t</span>&nbsp;<span class="op" id="5204058">=</span>&nbsp;<span class="ident" id="5204060">m</span><span class="op" id="5204061">.</span><span class="ident" id="5204062">add</span><span class="op" id="5204065">(</span><span class="ident" id="5204066">q</span><span class="op" id="5204067">,</span>&nbsp;<span class="ident" id="5204069">i</span><span class="op" id="5204070">.</span><span class="ident" id="5204071">Arg</span><span class="op" id="5204074">,</span>&nbsp;<span class="ident" id="5204076">pos</span><span class="op" id="5204079">,</span>&nbsp;<span class="builtinfunc" id="5204081">cap</span><span class="op" id="5204084">,</span>&nbsp;<span class="ident" id="5204086">cond</span><span class="op" id="5204090">,</span>&nbsp;<span class="ident" id="5204092">t</span><span class="op" id="5204093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204096">case</span>&nbsp;<span class="ident" id="5204101">syntax</span><span class="op" id="5204107">.</span><span class="ident" id="5204108">InstEmptyWidth</span><span class="op" id="5204122">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204126">if</span>&nbsp;<span class="ident" id="5204129">syntax</span><span class="op" id="5204135">.</span><span class="ident" id="5204136">EmptyOp</span><span class="op" id="5204143">(</span><span class="ident" id="5204144">i</span><span class="op" id="5204145">.</span><span class="ident" id="5204146">Arg</span><span class="op" id="5204149">)</span><span class="op" id="5204150">&amp;^</span><span class="ident" id="5204152">cond</span>&nbsp;<span class="op" id="5204157">==</span>&nbsp;<span class="num" id="5204160">0</span>&nbsp;<span class="op" id="5204162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204167">t</span>&nbsp;<span class="op" id="5204169">=</span>&nbsp;<span class="ident" id="5204171">m</span><span class="op" id="5204172">.</span><span class="ident" id="5204173">add</span><span class="op" id="5204176">(</span><span class="ident" id="5204177">q</span><span class="op" id="5204178">,</span>&nbsp;<span class="ident" id="5204180">i</span><span class="op" id="5204181">.</span><span class="ident" id="5204182">Out</span><span class="op" id="5204185">,</span>&nbsp;<span class="ident" id="5204187">pos</span><span class="op" id="5204190">,</span>&nbsp;<span class="builtinfunc" id="5204192">cap</span><span class="op" id="5204195">,</span>&nbsp;<span class="ident" id="5204197">cond</span><span class="op" id="5204201">,</span>&nbsp;<span class="ident" id="5204203">t</span><span class="op" id="5204204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5204208">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204211">case</span>&nbsp;<span class="ident" id="5204216">syntax</span><span class="op" id="5204222">.</span><span class="ident" id="5204223">InstNop</span><span class="op" id="5204230">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204234">t</span>&nbsp;<span class="op" id="5204236">=</span>&nbsp;<span class="ident" id="5204238">m</span><span class="op" id="5204239">.</span><span class="ident" id="5204240">add</span><span class="op" id="5204243">(</span><span class="ident" id="5204244">q</span><span class="op" id="5204245">,</span>&nbsp;<span class="ident" id="5204247">i</span><span class="op" id="5204248">.</span><span class="ident" id="5204249">Out</span><span class="op" id="5204252">,</span>&nbsp;<span class="ident" id="5204254">pos</span><span class="op" id="5204257">,</span>&nbsp;<span class="builtinfunc" id="5204259">cap</span><span class="op" id="5204262">,</span>&nbsp;<span class="ident" id="5204264">cond</span><span class="op" id="5204268">,</span>&nbsp;<span class="ident" id="5204270">t</span><span class="op" id="5204271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204274">case</span>&nbsp;<span class="ident" id="5204279">syntax</span><span class="op" id="5204285">.</span><span class="ident" id="5204286">InstCapture</span><span class="op" id="5204297">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204301">if</span>&nbsp;<span class="builtintype" id="5204304">int</span><span class="op" id="5204307">(</span><span class="ident" id="5204308">i</span><span class="op" id="5204309">.</span><span class="ident" id="5204310">Arg</span><span class="op" id="5204313">)</span>&nbsp;<span class="op" id="5204315">&lt;</span>&nbsp;<span class="builtinfunc" id="5204317">len</span><span class="op" id="5204320">(</span><span class="builtinfunc" id="5204321">cap</span><span class="op" id="5204324">)</span>&nbsp;<span class="op" id="5204326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204331">opos</span>&nbsp;<span class="op" id="5204336">:=</span>&nbsp;<span class="builtinfunc" id="5204339">cap</span><span class="op" id="5204342">[</span><span class="ident" id="5204343">i</span><span class="op" id="5204344">.</span><span class="ident" id="5204345">Arg</span><span class="op" id="5204348">]</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5204353">cap</span><span class="op" id="5204356">[</span><span class="ident" id="5204357">i</span><span class="op" id="5204358">.</span><span class="ident" id="5204359">Arg</span><span class="op" id="5204362">]</span>&nbsp;<span class="op" id="5204364">=</span>&nbsp;<span class="ident" id="5204366">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204373">m</span><span class="op" id="5204374">.</span><span class="ident" id="5204375">add</span><span class="op" id="5204378">(</span><span class="ident" id="5204379">q</span><span class="op" id="5204380">,</span>&nbsp;<span class="ident" id="5204382">i</span><span class="op" id="5204383">.</span><span class="ident" id="5204384">Out</span><span class="op" id="5204387">,</span>&nbsp;<span class="ident" id="5204389">pos</span><span class="op" id="5204392">,</span>&nbsp;<span class="builtinfunc" id="5204394">cap</span><span class="op" id="5204397">,</span>&nbsp;<span class="ident" id="5204399">cond</span><span class="op" id="5204403">,</span>&nbsp;<span class="ident" id="5204405">nil</span><span class="op" id="5204408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5204413">cap</span><span class="op" id="5204416">[</span><span class="ident" id="5204417">i</span><span class="op" id="5204418">.</span><span class="ident" id="5204419">Arg</span><span class="op" id="5204422">]</span>&nbsp;<span class="op" id="5204424">=</span>&nbsp;<span class="ident" id="5204426">opos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5204433">}</span>&nbsp;<span class="keyword" id="5204435">else</span>&nbsp;<span class="op" id="5204440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204445">t</span>&nbsp;<span class="op" id="5204447">=</span>&nbsp;<span class="ident" id="5204449">m</span><span class="op" id="5204450">.</span><span class="ident" id="5204451">add</span><span class="op" id="5204454">(</span><span class="ident" id="5204455">q</span><span class="op" id="5204456">,</span>&nbsp;<span class="ident" id="5204458">i</span><span class="op" id="5204459">.</span><span class="ident" id="5204460">Out</span><span class="op" id="5204463">,</span>&nbsp;<span class="ident" id="5204465">pos</span><span class="op" id="5204468">,</span>&nbsp;<span class="builtinfunc" id="5204470">cap</span><span class="op" id="5204473">,</span>&nbsp;<span class="ident" id="5204475">cond</span><span class="op" id="5204479">,</span>&nbsp;<span class="ident" id="5204481">t</span><span class="op" id="5204482">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5204486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204489">case</span>&nbsp;<span class="ident" id="5204494">syntax</span><span class="op" id="5204500">.</span><span class="ident" id="5204501">InstMatch</span><span class="op" id="5204510">,</span>&nbsp;<span class="ident" id="5204512">syntax</span><span class="op" id="5204518">.</span><span class="ident" id="5204519">InstRune</span><span class="op" id="5204527">,</span>&nbsp;<span class="ident" id="5204529">syntax</span><span class="op" id="5204535">.</span><span class="ident" id="5204536">InstRune1</span><span class="op" id="5204545">,</span>&nbsp;<span class="ident" id="5204547">syntax</span><span class="op" id="5204553">.</span><span class="ident" id="5204554">InstRuneAny</span><span class="op" id="5204565">,</span>&nbsp;<span class="ident" id="5204567">syntax</span><span class="op" id="5204573">.</span><span class="ident" id="5204574">InstRuneAnyNotNL</span><span class="op" id="5204590">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204594">if</span>&nbsp;<span class="ident" id="5204597">t</span>&nbsp;<span class="op" id="5204599">==</span>&nbsp;<span class="ident" id="5204602">nil</span>&nbsp;<span class="op" id="5204606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204611">t</span>&nbsp;<span class="op" id="5204613">=</span>&nbsp;<span class="ident" id="5204615">m</span><span class="op" id="5204616">.</span><span class="ident" id="5204617">alloc</span><span class="op" id="5204622">(</span><span class="ident" id="5204623">i</span><span class="op" id="5204624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5204628">}</span>&nbsp;<span class="keyword" id="5204630">else</span>&nbsp;<span class="op" id="5204635">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204640">t</span><span class="op" id="5204641">.</span><span class="ident" id="5204642">inst</span>&nbsp;<span class="op" id="5204647">=</span>&nbsp;<span class="ident" id="5204649">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5204653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204657">if</span>&nbsp;<span class="builtinfunc" id="5204660">len</span><span class="op" id="5204663">(</span><span class="builtinfunc" id="5204664">cap</span><span class="op" id="5204667">)</span>&nbsp;<span class="op" id="5204669">&gt;</span>&nbsp;<span class="num" id="5204671">0</span>&nbsp;<span class="op" id="5204673">&amp;&amp;</span>&nbsp;<span class="op" id="5204676">&amp;</span><span class="ident" id="5204677">t</span><span class="op" id="5204678">.</span><span class="builtinfunc" id="5204679">cap</span><span class="op" id="5204682">[</span><span class="num" id="5204683">0</span><span class="op" id="5204684">]</span>&nbsp;<span class="op" id="5204686">!=</span>&nbsp;<span class="op" id="5204689">&amp;</span><span class="builtinfunc" id="5204690">cap</span><span class="op" id="5204693">[</span><span class="num" id="5204694">0</span><span class="op" id="5204695">]</span>&nbsp;<span class="op" id="5204697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5204702">copy</span><span class="op" id="5204706">(</span><span class="ident" id="5204707">t</span><span class="op" id="5204708">.</span><span class="builtinfunc" id="5204709">cap</span><span class="op" id="5204712">,</span>&nbsp;<span class="builtinfunc" id="5204714">cap</span><span class="op" id="5204717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5204721">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204725">d</span><span class="op" id="5204726">.</span><span class="ident" id="5204727">t</span>&nbsp;<span class="op" id="5204729">=</span>&nbsp;<span class="ident" id="5204731">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204735">t</span>&nbsp;<span class="op" id="5204737">=</span>&nbsp;<span class="ident" id="5204739">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5204744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204747">return</span>&nbsp;<span class="ident" id="5204754">t</span><br>
<span class="lineno"></span><span class="op" id="5204756">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="comment" id="5204759">//&nbsp;onepass&nbsp;runs&nbsp;the&nbsp;machine&nbsp;over&nbsp;the&nbsp;input&nbsp;starting&nbsp;at&nbsp;pos.</span><br>
<span class="lineno"></span><span class="comment" id="5204819">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found.</span><br>
<span class="lineno"></span><span class="comment" id="5204860">//&nbsp;If&nbsp;so,&nbsp;m.matchcap&nbsp;holds&nbsp;the&nbsp;submatch&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="5204913">func</span>&nbsp;<span class="op" id="5204918">(</span><span class="ident" id="5204919">m</span>&nbsp;<span class="op" id="5204921">*</span><span class="ident" id="5204922">machine</span><span class="op" id="5204929">)</span>&nbsp;<span class="ident" id="5204931">onepass</span><span class="op" id="5204938">(</span><span class="ident" id="5204939">i</span>&nbsp;<span class="ident" id="5204941">input</span><span class="op" id="5204946">,</span>&nbsp;<span class="ident" id="5204948">pos</span>&nbsp;<span class="builtintype" id="5204952">int</span><span class="op" id="5204955">)</span>&nbsp;<span class="builtintype" id="5204957">bool</span>&nbsp;<span class="op" id="5204962">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204965">startCond</span>&nbsp;<span class="op" id="5204975">:=</span>&nbsp;<span class="ident" id="5204978">m</span><span class="op" id="5204979">.</span><span class="ident" id="5204980">re</span><span class="op" id="5204982">.</span><span class="ident" id="5204983">cond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204989">if</span>&nbsp;<span class="ident" id="5204992">startCond</span>&nbsp;<span class="op" id="5205002">==</span>&nbsp;<span class="op" id="5205005">^</span><span class="ident" id="5205006">syntax</span><span class="op" id="5205012">.</span><span class="ident" id="5205013">EmptyOp</span><span class="op" id="5205020">(</span><span class="num" id="5205021">0</span><span class="op" id="5205022">)</span>&nbsp;<span class="op" id="5205024">{</span>&nbsp;<span class="comment" id="5205026">//&nbsp;impossible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205042">return</span>&nbsp;<span class="builtintype" id="5205049">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5205056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205059">m</span><span class="op" id="5205060">.</span><span class="ident" id="5205061">matched</span>&nbsp;<span class="op" id="5205069">=</span>&nbsp;<span class="builtintype" id="5205071">false</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205078">for</span>&nbsp;<span class="ident" id="5205082">i</span>&nbsp;<span class="op" id="5205084">:=</span>&nbsp;<span class="keyword" id="5205087">range</span>&nbsp;<span class="ident" id="5205093">m</span><span class="op" id="5205094">.</span><span class="ident" id="5205095">matchcap</span>&nbsp;<span class="op" id="5205104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205108">m</span><span class="op" id="5205109">.</span><span class="ident" id="5205110">matchcap</span><span class="op" id="5205118">[</span><span class="ident" id="5205119">i</span><span class="op" id="5205120">]</span>&nbsp;<span class="op" id="5205122">=</span>&nbsp;<span class="op" id="5205124">-</span><span class="num" id="5205125">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5205128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205131">r</span><span class="op" id="5205132">,</span>&nbsp;<span class="ident" id="5205134">r1</span>&nbsp;<span class="op" id="5205137">:=</span>&nbsp;<span class="ident" id="5205140">endOfText</span><span class="op" id="5205149">,</span>&nbsp;<span class="ident" id="5205151">endOfText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205162">width</span><span class="op" id="5205167">,</span>&nbsp;<span class="ident" id="5205169">width1</span>&nbsp;<span class="op" id="5205176">:=</span>&nbsp;<span class="num" id="5205179">0</span><span class="op" id="5205180">,</span>&nbsp;<span class="num" id="5205182">0</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205185">r</span><span class="op" id="5205186">,</span>&nbsp;<span class="ident" id="5205188">width</span>&nbsp;<span class="op" id="5205194">=</span>&nbsp;<span class="ident" id="5205196">i</span><span class="op" id="5205197">.</span><span class="ident" id="5205198">step</span><span class="op" id="5205202">(</span><span class="ident" id="5205203">pos</span><span class="op" id="5205206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205209">if</span>&nbsp;<span class="ident" id="5205212">r</span>&nbsp;<span class="op" id="5205214">!=</span>&nbsp;<span class="ident" id="5205217">endOfText</span>&nbsp;<span class="op" id="5205227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205231">r1</span><span class="op" id="5205233">,</span>&nbsp;<span class="ident" id="5205235">width1</span>&nbsp;<span class="op" id="5205242">=</span>&nbsp;<span class="ident" id="5205244">i</span><span class="op" id="5205245">.</span><span class="ident" id="5205246">step</span><span class="op" id="5205250">(</span><span class="ident" id="5205251">pos</span>&nbsp;<span class="op" id="5205255">+</span>&nbsp;<span class="ident" id="5205257">width</span><span class="op" id="5205262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5205265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205268">var</span>&nbsp;<span class="ident" id="5205272">flag</span>&nbsp;<span class="ident" id="5205277">syntax</span><span class="op" id="5205283">.</span><span class="ident" id="5205284">EmptyOp</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205293">if</span>&nbsp;<span class="ident" id="5205296">pos</span>&nbsp;<span class="op" id="5205300">==</span>&nbsp;<span class="num" id="5205303">0</span>&nbsp;<span class="op" id="5205305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205309">flag</span>&nbsp;<span class="op" id="5205314">=</span>&nbsp;<span class="ident" id="5205316">syntax</span><span class="op" id="5205322">.</span><span class="ident" id="5205323">EmptyOpContext</span><span class="op" id="5205337">(</span><span class="op" id="5205338">-</span><span class="num" id="5205339">1</span><span class="op" id="5205340">,</span>&nbsp;<span class="ident" id="5205342">r</span><span class="op" id="5205343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5205346">}</span>&nbsp;<span class="keyword" id="5205348">else</span>&nbsp;<span class="op" id="5205353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205357">flag</span>&nbsp;<span class="op" id="5205362">=</span>&nbsp;<span class="ident" id="5205364">i</span><span class="op" id="5205365">.</span><span class="ident" id="5205366">context</span><span class="op" id="5205373">(</span><span class="ident" id="5205374">pos</span><span class="op" id="5205377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5205380">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205383">pc</span>&nbsp;<span class="op" id="5205386">:=</span>&nbsp;<span class="ident" id="5205389">m</span><span class="op" id="5205390">.</span><span class="ident" id="5205391">op</span><span class="op" id="5205393">.</span><span class="ident" id="5205394">Start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205401">inst</span>&nbsp;<span class="op" id="5205406">:=</span>&nbsp;<span class="ident" id="5205409">m</span><span class="op" id="5205410">.</span><span class="ident" id="5205411">op</span><span class="op" id="5205413">.</span><span class="ident" id="5205414">Inst</span><span class="op" id="5205418">[</span><span class="ident" id="5205419">pc</span><span class="op" id="5205421">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5205424">//&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;simple&nbsp;literal&nbsp;prefix,&nbsp;skip&nbsp;over&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205479">if</span>&nbsp;<span class="ident" id="5205482">pos</span>&nbsp;<span class="op" id="5205486">==</span>&nbsp;<span class="num" id="5205489">0</span>&nbsp;<span class="op" id="5205491">&amp;&amp;</span>&nbsp;<span class="ident" id="5205494">syntax</span><span class="op" id="5205500">.</span><span class="ident" id="5205501">EmptyOp</span><span class="op" id="5205508">(</span><span class="ident" id="5205509">inst</span><span class="op" id="5205513">.</span><span class="ident" id="5205514">Arg</span><span class="op" id="5205517">)</span><span class="op" id="5205518">&amp;^</span><span class="ident" id="5205520">flag</span>&nbsp;<span class="op" id="5205525">==</span>&nbsp;<span class="num" id="5205528">0</span>&nbsp;<span class="op" id="5205530">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5205535">len</span><span class="op" id="5205538">(</span><span class="ident" id="5205539">m</span><span class="op" id="5205540">.</span><span class="ident" id="5205541">re</span><span class="op" id="5205543">.</span><span class="ident" id="5205544">prefix</span><span class="op" id="5205550">)</span>&nbsp;<span class="op" id="5205552">&gt;</span>&nbsp;<span class="num" id="5205554">0</span>&nbsp;<span class="op" id="5205556">&amp;&amp;</span>&nbsp;<span class="ident" id="5205559">i</span><span class="op" id="5205560">.</span><span class="ident" id="5205561">canCheckPrefix</span><span class="op" id="5205575">(</span><span class="op" id="5205576">)</span>&nbsp;<span class="op" id="5205578">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5205582">//&nbsp;Match&nbsp;requires&nbsp;literal&nbsp;prefix;&nbsp;fast&nbsp;search&nbsp;for&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205638">if</span>&nbsp;<span class="ident" id="5205641">i</span><span class="op" id="5205642">.</span><span class="ident" id="5205643">hasPrefix</span><span class="op" id="5205652">(</span><span class="ident" id="5205653">m</span><span class="op" id="5205654">.</span><span class="ident" id="5205655">re</span><span class="op" id="5205657">)</span>&nbsp;<span class="op" id="5205659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205664">pos</span>&nbsp;<span class="op" id="5205668">+=</span>&nbsp;<span class="builtinfunc" id="5205671">len</span><span class="op" id="5205674">(</span><span class="ident" id="5205675">m</span><span class="op" id="5205676">.</span><span class="ident" id="5205677">re</span><span class="op" id="5205679">.</span><span class="ident" id="5205680">prefix</span><span class="op" id="5205686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205691">r</span><span class="op" id="5205692">,</span>&nbsp;<span class="ident" id="5205694">width</span>&nbsp;<span class="op" id="5205700">=</span>&nbsp;<span class="ident" id="5205702">i</span><span class="op" id="5205703">.</span><span class="ident" id="5205704">step</span><span class="op" id="5205708">(</span><span class="ident" id="5205709">pos</span><span class="op" id="5205712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205717">r1</span><span class="op" id="5205719">,</span>&nbsp;<span class="ident" id="5205721">width1</span>&nbsp;<span class="op" id="5205728">=</span>&nbsp;<span class="ident" id="5205730">i</span><span class="op" id="5205731">.</span><span class="ident" id="5205732">step</span><span class="op" id="5205736">(</span><span class="ident" id="5205737">pos</span>&nbsp;<span class="op" id="5205741">+</span>&nbsp;<span class="ident" id="5205743">width</span><span class="op" id="5205748">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205753">flag</span>&nbsp;<span class="op" id="5205758">=</span>&nbsp;<span class="ident" id="5205760">i</span><span class="op" id="5205761">.</span><span class="ident" id="5205762">context</span><span class="op" id="5205769">(</span><span class="ident" id="5205770">pos</span><span class="op" id="5205773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205778">pc</span>&nbsp;<span class="op" id="5205781">=</span>&nbsp;<span class="builtintype" id="5205783">int</span><span class="op" id="5205786">(</span><span class="ident" id="5205787">m</span><span class="op" id="5205788">.</span><span class="ident" id="5205789">re</span><span class="op" id="5205791">.</span><span class="ident" id="5205792">prefixEnd</span><span class="op" id="5205801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5205805">}</span>&nbsp;<span class="keyword" id="5205807">else</span>&nbsp;<span class="op" id="5205812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205817">return</span>&nbsp;<span class="ident" id="5205824">m</span><span class="op" id="5205825">.</span><span class="ident" id="5205826">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5205836">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5205839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205842">for</span>&nbsp;<span class="op" id="5205846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205850">inst</span>&nbsp;<span class="op" id="5205855">=</span>&nbsp;<span class="ident" id="5205857">m</span><span class="op" id="5205858">.</span><span class="ident" id="5205859">op</span><span class="op" id="5205861">.</span><span class="ident" id="5205862">Inst</span><span class="op" id="5205866">[</span><span class="ident" id="5205867">pc</span><span class="op" id="5205869">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205873">pc</span>&nbsp;<span class="op" id="5205876">=</span>&nbsp;<span class="builtintype" id="5205878">int</span><span class="op" id="5205881">(</span><span class="ident" id="5205882">inst</span><span class="op" id="5205886">.</span><span class="ident" id="5205887">Out</span><span class="op" id="5205890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205894">switch</span>&nbsp;<span class="ident" id="5205901">inst</span><span class="op" id="5205905">.</span><span class="ident" id="5205906">Op</span>&nbsp;<span class="op" id="5205909">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205913">default</span><span class="op" id="5205920">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5205925">panic</span><span class="op" id="5205930">(</span><span class="string" id="5205931">&#34;bad&nbsp;inst&#34;</span><span class="op" id="5205941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205945">case</span>&nbsp;<span class="ident" id="5205950">syntax</span><span class="op" id="5205956">.</span><span class="ident" id="5205957">InstMatch</span><span class="op" id="5205966">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205971">m</span><span class="op" id="5205972">.</span><span class="ident" id="5205973">matched</span>&nbsp;<span class="op" id="5205981">=</span>&nbsp;<span class="builtintype" id="5205983">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205991">if</span>&nbsp;<span class="builtinfunc" id="5205994">len</span><span class="op" id="5205997">(</span><span class="ident" id="5205998">m</span><span class="op" id="5205999">.</span><span class="ident" id="5206000">matchcap</span><span class="op" id="5206008">)</span>&nbsp;<span class="op" id="5206010">&gt;</span>&nbsp;<span class="num" id="5206012">0</span>&nbsp;<span class="op" id="5206014">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5206020">m</span><span class="op" id="5206021">.</span><span class="ident" id="5206022">matchcap</span><span class="op" id="5206030">[</span><span class="num" id="5206031">0</span><span class="op" id="5206032">]</span>&nbsp;<span class="op" id="5206034">=</span>&nbsp;<span class="num" id="5206036">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5206042">m</span><span class="op" id="5206043">.</span><span class="ident" id="5206044">matchcap</span><span class="op" id="5206052">[</span><span class="num" id="5206053">1</span><span class="op" id="5206054">]</span>&nbsp;<span class="op" id="5206056">=</span>&nbsp;<span class="ident" id="5206058">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5206065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206070">return</span>&nbsp;<span class="ident" id="5206077">m</span><span class="op" id="5206078">.</span><span class="ident" id="5206079">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206089">case</span>&nbsp;<span class="ident" id="5206094">syntax</span><span class="op" id="5206100">.</span><span class="ident" id="5206101">InstRune</span><span class="op" id="5206109">:</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206114">if</span>&nbsp;<span class="op" id="5206117">!</span><span class="ident" id="5206118">inst</span><span class="op" id="5206122">.</span><span class="ident" id="5206123">MatchRune</span><span class="op" id="5206132">(</span><span class="ident" id="5206133">r</span><span class="op" id="5206134">)</span>&nbsp;<span class="op" id="5206136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206142">return</span>&nbsp;<span class="ident" id="5206149">m</span><span class="op" id="5206150">.</span><span class="ident" id="5206151">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5206162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206166">case</span>&nbsp;<span class="ident" id="5206171">syntax</span><span class="op" id="5206177">.</span><span class="ident" id="5206178">InstRune1</span><span class="op" id="5206187">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206192">if</span>&nbsp;<span class="ident" id="5206195">r</span>&nbsp;<span class="op" id="5206197">!=</span>&nbsp;<span class="ident" id="5206200">inst</span><span class="op" id="5206204">.</span><span class="ident" id="5206205">Rune</span><span class="op" id="5206209">[</span><span class="num" id="5206210">0</span><span class="op" id="5206211">]</span>&nbsp;<span class="op" id="5206213">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206219">return</span>&nbsp;<span class="ident" id="5206226">m</span><span class="op" id="5206227">.</span><span class="ident" id="5206228">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5206239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206243">case</span>&nbsp;<span class="ident" id="5206248">syntax</span><span class="op" id="5206254">.</span><span class="ident" id="5206255">InstRuneAny</span><span class="op" id="5206266">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5206271">//&nbsp;Nothing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206284">case</span>&nbsp;<span class="ident" id="5206289">syntax</span><span class="op" id="5206295">.</span><span class="ident" id="5206296">InstRuneAnyNotNL</span><span class="op" id="5206312">:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206317">if</span>&nbsp;<span class="ident" id="5206320">r</span>&nbsp;<span class="op" id="5206322">==</span>&nbsp;<span class="string" id="5206325">&#39;\n&#39;</span>&nbsp;<span class="op" id="5206330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206336">return</span>&nbsp;<span class="ident" id="5206343">m</span><span class="op" id="5206344">.</span><span class="ident" id="5206345">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5206356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5206360">//&nbsp;peek&nbsp;at&nbsp;the&nbsp;input&nbsp;rune&nbsp;to&nbsp;see&nbsp;which&nbsp;branch&nbsp;of&nbsp;the&nbsp;Alt&nbsp;to&nbsp;take</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206427">case</span>&nbsp;<span class="ident" id="5206432">syntax</span><span class="op" id="5206438">.</span><span class="ident" id="5206439">InstAlt</span><span class="op" id="5206446">,</span>&nbsp;<span class="ident" id="5206448">syntax</span><span class="op" id="5206454">.</span><span class="ident" id="5206455">InstAltMatch</span><span class="op" id="5206467">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5206472">pc</span>&nbsp;<span class="op" id="5206475">=</span>&nbsp;<span class="builtintype" id="5206477">int</span><span class="op" id="5206480">(</span><span class="ident" id="5206481">onePassNext</span><span class="op" id="5206492">(</span><span class="op" id="5206493">&amp;</span><span class="ident" id="5206494">inst</span><span class="op" id="5206498">,</span>&nbsp;<span class="ident" id="5206500">r</span><span class="op" id="5206501">)</span><span class="op" id="5206502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206507">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206518">case</span>&nbsp;<span class="ident" id="5206523">syntax</span><span class="op" id="5206529">.</span><span class="ident" id="5206530">InstFail</span><span class="op" id="5206538">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206543">return</span>&nbsp;<span class="ident" id="5206550">m</span><span class="op" id="5206551">.</span><span class="ident" id="5206552">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206562">case</span>&nbsp;<span class="ident" id="5206567">syntax</span><span class="op" id="5206573">.</span><span class="ident" id="5206574">InstNop</span><span class="op" id="5206581">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206586">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206597">case</span>&nbsp;<span class="ident" id="5206602">syntax</span><span class="op" id="5206608">.</span><span class="ident" id="5206609">InstEmptyWidth</span><span class="op" id="5206623">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206628">if</span>&nbsp;<span class="ident" id="5206631">syntax</span><span class="op" id="5206637">.</span><span class="ident" id="5206638">EmptyOp</span><span class="op" id="5206645">(</span><span class="ident" id="5206646">inst</span><span class="op" id="5206650">.</span><span class="ident" id="5206651">Arg</span><span class="op" id="5206654">)</span><span class="op" id="5206655">&amp;^</span><span class="ident" id="5206657">flag</span>&nbsp;<span class="op" id="5206662">!=</span>&nbsp;<span class="num" id="5206665">0</span>&nbsp;<span class="op" id="5206667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206673">return</span>&nbsp;<span class="ident" id="5206680">m</span><span class="op" id="5206681">.</span><span class="ident" id="5206682">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5206693">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206698">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206709">case</span>&nbsp;<span class="ident" id="5206714">syntax</span><span class="op" id="5206720">.</span><span class="ident" id="5206721">InstCapture</span><span class="op" id="5206732">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206737">if</span>&nbsp;<span class="builtintype" id="5206740">int</span><span class="op" id="5206743">(</span><span class="ident" id="5206744">inst</span><span class="op" id="5206748">.</span><span class="ident" id="5206749">Arg</span><span class="op" id="5206752">)</span>&nbsp;<span class="op" id="5206754">&lt;</span>&nbsp;<span class="builtinfunc" id="5206756">len</span><span class="op" id="5206759">(</span><span class="ident" id="5206760">m</span><span class="op" id="5206761">.</span><span class="ident" id="5206762">matchcap</span><span class="op" id="5206770">)</span>&nbsp;<span class="op" id="5206772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5206778">m</span><span class="op" id="5206779">.</span><span class="ident" id="5206780">matchcap</span><span class="op" id="5206788">[</span><span class="ident" id="5206789">inst</span><span class="op" id="5206793">.</span><span class="ident" id="5206794">Arg</span><span class="op" id="5206797">]</span>&nbsp;<span class="op" id="5206799">=</span>&nbsp;<span class="ident" id="5206801">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5206808">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206813">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5206824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206828">if</span>&nbsp;<span class="ident" id="5206831">width</span>&nbsp;<span class="op" id="5206837">==</span>&nbsp;<span class="num" id="5206840">0</span>&nbsp;<span class="op" id="5206842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206847">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5206855">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5206859">flag</span>&nbsp;<span class="op" id="5206864">=</span>&nbsp;<span class="ident" id="5206866">syntax</span><span class="op" id="5206872">.</span><span class="ident" id="5206873">EmptyOpContext</span><span class="op" id="5206887">(</span><span class="ident" id="5206888">r</span><span class="op" id="5206889">,</span>&nbsp;<span class="ident" id="5206891">r1</span><span class="op" id="5206893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5206897">pos</span>&nbsp;<span class="op" id="5206901">+=</span>&nbsp;<span class="ident" id="5206904">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5206912">r</span><span class="op" id="5206913">,</span>&nbsp;<span class="ident" id="5206915">width</span>&nbsp;<span class="op" id="5206921">=</span>&nbsp;<span class="ident" id="5206923">r1</span><span class="op" id="5206925">,</span>&nbsp;<span class="ident" id="5206927">width1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206936">if</span>&nbsp;<span class="ident" id="5206939">r</span>&nbsp;<span class="op" id="5206941">!=</span>&nbsp;<span class="ident" id="5206944">endOfText</span>&nbsp;<span class="op" id="5206954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5206959">r1</span><span class="op" id="5206961">,</span>&nbsp;<span class="ident" id="5206963">width1</span>&nbsp;<span class="op" id="5206970">=</span>&nbsp;<span class="ident" id="5206972">i</span><span class="op" id="5206973">.</span><span class="ident" id="5206974">step</span><span class="op" id="5206978">(</span><span class="ident" id="5206979">pos</span>&nbsp;<span class="op" id="5206983">+</span>&nbsp;<span class="ident" id="5206985">width</span><span class="op" id="5206990">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5206994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5206997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5207000">return</span>&nbsp;<span class="ident" id="5207007">m</span><span class="op" id="5207008">.</span><span class="ident" id="5207009">matched</span><br>
<span class="lineno"></span><span class="op" id="5207017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="comment" id="5207020">//&nbsp;empty&nbsp;is&nbsp;a&nbsp;non-nil&nbsp;0-element&nbsp;slice,</span><br>
<span class="lineno"></span><span class="comment" id="5207059">//&nbsp;so&nbsp;doExecute&nbsp;can&nbsp;avoid&nbsp;an&nbsp;allocation</span><br>
<span class="lineno"></span><span class="comment" id="5207099">//&nbsp;when&nbsp;0&nbsp;captures&nbsp;are&nbsp;requested&nbsp;from&nbsp;a&nbsp;successful&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5207157">var</span>&nbsp;<span class="ident" id="5207161">empty</span>&nbsp;<span class="op" id="5207167">=</span>&nbsp;<span class="builtinfunc" id="5207169">make</span><span class="op" id="5207173">(</span><span class="op" id="5207174">[</span><span class="op" id="5207175">]</span><span class="builtintype" id="5207176">int</span><span class="op" id="5207179">,</span>&nbsp;<span class="num" id="5207181">0</span><span class="op" id="5207182">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span><span class="comment" id="5207185">//&nbsp;doExecute&nbsp;finds&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;the&nbsp;input&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="5207248">//&nbsp;the&nbsp;position&nbsp;of&nbsp;its&nbsp;subexpressions.</span><br>
<span class="lineno"></span><span class="keyword" id="5207287">func</span>&nbsp;<span class="op" id="5207292">(</span><span class="ident" id="5207293">re</span>&nbsp;<span class="op" id="5207296">*</span><span class="ident" id="5207297">Regexp</span><span class="op" id="5207303">)</span>&nbsp;<span class="ident" id="5207305">doExecute</span><span class="op" id="5207314">(</span><span class="ident" id="5207315">r</span>&nbsp;<span class="ident" id="5207317">io</span><span class="op" id="5207319">.</span><span class="ident" id="5207320">RuneReader</span><span class="op" id="5207330">,</span>&nbsp;<span class="ident" id="5207332">b</span>&nbsp;<span class="op" id="5207334">[</span><span class="op" id="5207335">]</span><span class="builtintype" id="5207336">byte</span><span class="op" id="5207340">,</span>&nbsp;<span class="ident" id="5207342">s</span>&nbsp;<span class="builtintype" id="5207344">string</span><span class="op" id="5207350">,</span>&nbsp;<span class="ident" id="5207352">pos</span>&nbsp;<span class="builtintype" id="5207356">int</span><span class="op" id="5207359">,</span>&nbsp;<span class="ident" id="5207361">ncap</span>&nbsp;<span class="builtintype" id="5207366">int</span><span class="op" id="5207369">)</span>&nbsp;<span class="op" id="5207371">[</span><span class="op" id="5207372">]</span><span class="builtintype" id="5207373">int</span>&nbsp;<span class="op" id="5207377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207380">m</span>&nbsp;<span class="op" id="5207382">:=</span>&nbsp;<span class="ident" id="5207385">re</span><span class="op" id="5207387">.</span><span class="ident" id="5207388">get</span><span class="op" id="5207391">(</span><span class="op" id="5207392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5207395">var</span>&nbsp;<span class="ident" id="5207399">i</span>&nbsp;<span class="ident" id="5207401">input</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5207408">if</span>&nbsp;<span class="ident" id="5207411">r</span>&nbsp;<span class="op" id="5207413">!=</span>&nbsp;<span class="ident" id="5207416">nil</span>&nbsp;<span class="op" id="5207420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207424">i</span>&nbsp;<span class="op" id="5207426">=</span>&nbsp;<span class="ident" id="5207428">m</span><span class="op" id="5207429">.</span><span class="ident" id="5207430">newInputReader</span><span class="op" id="5207444">(</span><span class="ident" id="5207445">r</span><span class="op" id="5207446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5207449">}</span>&nbsp;<span class="keyword" id="5207451">else</span>&nbsp;<span class="keyword" id="5207456">if</span>&nbsp;<span class="ident" id="5207459">b</span>&nbsp;<span class="op" id="5207461">!=</span>&nbsp;<span class="ident" id="5207464">nil</span>&nbsp;<span class="op" id="5207468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207472">i</span>&nbsp;<span class="op" id="5207474">=</span>&nbsp;<span class="ident" id="5207476">m</span><span class="op" id="5207477">.</span><span class="ident" id="5207478">newInputBytes</span><span class="op" id="5207491">(</span><span class="ident" id="5207492">b</span><span class="op" id="5207493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5207496">}</span>&nbsp;<span class="keyword" id="5207498">else</span>&nbsp;<span class="op" id="5207503">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207507">i</span>&nbsp;<span class="op" id="5207509">=</span>&nbsp;<span class="ident" id="5207511">m</span><span class="op" id="5207512">.</span><span class="ident" id="5207513">newInputString</span><span class="op" id="5207527">(</span><span class="ident" id="5207528">s</span><span class="op" id="5207529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5207532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5207535">if</span>&nbsp;<span class="ident" id="5207538">m</span><span class="op" id="5207539">.</span><span class="ident" id="5207540">op</span>&nbsp;<span class="op" id="5207543">!=</span>&nbsp;<span class="ident" id="5207546">notOnePass</span>&nbsp;<span class="op" id="5207557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5207561">if</span>&nbsp;<span class="op" id="5207564">!</span><span class="ident" id="5207565">m</span><span class="op" id="5207566">.</span><span class="ident" id="5207567">onepass</span><span class="op" id="5207574">(</span><span class="ident" id="5207575">i</span><span class="op" id="5207576">,</span>&nbsp;<span class="ident" id="5207578">pos</span><span class="op" id="5207581">)</span>&nbsp;<span class="op" id="5207583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207588">re</span><span class="op" id="5207590">.</span><span class="ident" id="5207591">put</span><span class="op" id="5207594">(</span><span class="ident" id="5207595">m</span><span class="op" id="5207596">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5207601">return</span>&nbsp;<span class="ident" id="5207608">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5207614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5207617">}</span>&nbsp;<span class="keyword" id="5207619">else</span>&nbsp;<span class="op" id="5207624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207628">m</span><span class="op" id="5207629">.</span><span class="ident" id="5207630">init</span><span class="op" id="5207634">(</span><span class="ident" id="5207635">ncap</span><span class="op" id="5207639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5207643">if</span>&nbsp;<span class="op" id="5207646">!</span><span class="ident" id="5207647">m</span><span class="op" id="5207648">.</span><span class="ident" id="5207649">match</span><span class="op" id="5207654">(</span><span class="ident" id="5207655">i</span><span class="op" id="5207656">,</span>&nbsp;<span class="ident" id="5207658">pos</span><span class="op" id="5207661">)</span>&nbsp;<span class="op" id="5207663">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207668">re</span><span class="op" id="5207670">.</span><span class="ident" id="5207671">put</span><span class="op" id="5207674">(</span><span class="ident" id="5207675">m</span><span class="op" id="5207676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5207681">return</span>&nbsp;<span class="ident" id="5207688">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5207694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5207697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5207700">if</span>&nbsp;<span class="ident" id="5207703">ncap</span>&nbsp;<span class="op" id="5207708">==</span>&nbsp;<span class="num" id="5207711">0</span>&nbsp;<span class="op" id="5207713">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207717">re</span><span class="op" id="5207719">.</span><span class="ident" id="5207720">put</span><span class="op" id="5207723">(</span><span class="ident" id="5207724">m</span><span class="op" id="5207725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5207729">return</span>&nbsp;<span class="ident" id="5207736">empty</span>&nbsp;<span class="comment" id="5207742">//&nbsp;empty&nbsp;but&nbsp;not&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5207764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5207767">cap</span>&nbsp;<span class="op" id="5207771">:=</span>&nbsp;<span class="builtinfunc" id="5207774">make</span><span class="op" id="5207778">(</span><span class="op" id="5207779">[</span><span class="op" id="5207780">]</span><span class="builtintype" id="5207781">int</span><span class="op" id="5207784">,</span>&nbsp;<span class="builtinfunc" id="5207786">len</span><span class="op" id="5207789">(</span><span class="ident" id="5207790">m</span><span class="op" id="5207791">.</span><span class="ident" id="5207792">matchcap</span><span class="op" id="5207800">)</span><span class="op" id="5207801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5207804">copy</span><span class="op" id="5207808">(</span><span class="builtinfunc" id="5207809">cap</span><span class="op" id="5207812">,</span>&nbsp;<span class="ident" id="5207814">m</span><span class="op" id="5207815">.</span><span class="ident" id="5207816">matchcap</span><span class="op" id="5207824">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207827">re</span><span class="op" id="5207829">.</span><span class="ident" id="5207830">put</span><span class="op" id="5207833">(</span><span class="ident" id="5207834">m</span><span class="op" id="5207835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5207838">return</span>&nbsp;<span class="builtinfunc" id="5207845">cap</span><br>
<span class="lineno"></span><span class="op" id="5207849">}</span>
</div>
</body>
</html>
