<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1866847">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1866902">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1866956">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1867007">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1867085">package</span>&nbsp;<span class="ident" id="1867093">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1867102">import</span>&nbsp;<span class="string" id="1867109">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="1867119">//&nbsp;Integrated&nbsp;network&nbsp;poller&nbsp;(platform-independent&nbsp;part).</span><br>
<span class="lineno"></span><span class="comment" id="1867177">//&nbsp;A&nbsp;particular&nbsp;implementation&nbsp;(epoll/kqueue)&nbsp;must&nbsp;define&nbsp;the&nbsp;following&nbsp;functions:</span><br>
<span class="lineno"></span><span class="comment" id="1867260">//&nbsp;func&nbsp;netpollinit()&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;to&nbsp;initialize&nbsp;the&nbsp;poller</span><br>
<span class="lineno"></span><span class="comment" id="1867312">//&nbsp;func&nbsp;netpollopen(fd&nbsp;uintptr,&nbsp;pd&nbsp;*pollDesc)&nbsp;int32&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;to&nbsp;arm&nbsp;edge-triggered&nbsp;notifications</span><br>
<span class="lineno">15</span><span class="comment" id="1867403">//&nbsp;and&nbsp;associate&nbsp;fd&nbsp;with&nbsp;pd.</span><br>
<span class="lineno"></span><span class="comment" id="1867432">//&nbsp;An&nbsp;implementation&nbsp;must&nbsp;call&nbsp;the&nbsp;following&nbsp;function&nbsp;to&nbsp;denote&nbsp;that&nbsp;the&nbsp;pd&nbsp;is&nbsp;ready.</span><br>
<span class="lineno"></span><span class="comment" id="1867518">//&nbsp;func&nbsp;netpollready(gpp&nbsp;**g,&nbsp;pd&nbsp;*pollDesc,&nbsp;mode&nbsp;int32)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1867575">//&nbsp;pollDesc&nbsp;contains&nbsp;2&nbsp;binary&nbsp;semaphores,&nbsp;rg&nbsp;and&nbsp;wg,&nbsp;to&nbsp;park&nbsp;reader&nbsp;and&nbsp;writer</span><br>
<span class="lineno">20</span><span class="comment" id="1867654">//&nbsp;goroutines&nbsp;respectively.&nbsp;The&nbsp;semaphore&nbsp;can&nbsp;be&nbsp;in&nbsp;the&nbsp;following&nbsp;states:</span><br>
<span class="lineno"></span><span class="comment" id="1867728">//&nbsp;pdReady&nbsp;-&nbsp;io&nbsp;readiness&nbsp;notification&nbsp;is&nbsp;pending;</span><br>
<span class="lineno"></span><span class="comment" id="1867779">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;goroutine&nbsp;consumes&nbsp;the&nbsp;notification&nbsp;by&nbsp;changing&nbsp;the&nbsp;state&nbsp;to&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="1867860">//&nbsp;pdWait&nbsp;-&nbsp;a&nbsp;goroutine&nbsp;prepares&nbsp;to&nbsp;park&nbsp;on&nbsp;the&nbsp;semaphore,&nbsp;but&nbsp;not&nbsp;yet&nbsp;parked;</span><br>
<span class="lineno"></span><span class="comment" id="1867939">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;goroutine&nbsp;commits&nbsp;to&nbsp;park&nbsp;by&nbsp;changing&nbsp;the&nbsp;state&nbsp;to&nbsp;G&nbsp;pointer,</span><br>
<span class="lineno">25</span><span class="comment" id="1868017">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or,&nbsp;alternatively,&nbsp;concurrent&nbsp;io&nbsp;notification&nbsp;changes&nbsp;the&nbsp;state&nbsp;to&nbsp;READY,</span><br>
<span class="lineno"></span><span class="comment" id="1868103">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or,&nbsp;alternatively,&nbsp;concurrent&nbsp;timeout/close&nbsp;changes&nbsp;the&nbsp;state&nbsp;to&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="1868185">//&nbsp;G&nbsp;pointer&nbsp;-&nbsp;the&nbsp;goroutine&nbsp;is&nbsp;blocked&nbsp;on&nbsp;the&nbsp;semaphore;</span><br>
<span class="lineno"></span><span class="comment" id="1868243">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io&nbsp;notification&nbsp;or&nbsp;timeout/close&nbsp;changes&nbsp;the&nbsp;state&nbsp;to&nbsp;READY&nbsp;or&nbsp;nil&nbsp;respectively</span><br>
<span class="lineno"></span><span class="comment" id="1868338">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;unparks&nbsp;the&nbsp;goroutine.</span><br>
<span class="lineno">30</span><span class="comment" id="1868380">//&nbsp;nil&nbsp;-&nbsp;nothing&nbsp;of&nbsp;the&nbsp;above.</span><br>
<span class="lineno"></span><span class="keyword" id="1868411">const</span>&nbsp;<span class="op" id="1868417">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1868420">pdReady</span>&nbsp;<span class="builtintype" id="1868428">uintptr</span>&nbsp;<span class="op" id="1868436">=</span>&nbsp;<span class="num" id="1868438">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1868441">pdWait</span>&nbsp;&nbsp;<span class="builtintype" id="1868449">uintptr</span>&nbsp;<span class="op" id="1868457">=</span>&nbsp;<span class="num" id="1868459">2</span><br>
<span class="lineno"></span><span class="op" id="1868461">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="1868464">const</span>&nbsp;<span class="ident" id="1868470">pollBlockSize</span>&nbsp;<span class="op" id="1868484">=</span>&nbsp;<span class="num" id="1868486">4</span>&nbsp;<span class="op" id="1868488">*</span>&nbsp;<span class="num" id="1868490">1024</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1868496">//&nbsp;Network&nbsp;poller&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="keyword" id="1868526">type</span>&nbsp;<span class="ident" id="1868531">pollDesc</span>&nbsp;<span class="keyword" id="1868540">struct</span>&nbsp;<span class="op" id="1868547">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1868550">link</span>&nbsp;<span class="op" id="1868555">*</span><span class="ident" id="1868556"><a href="/runtime/netpoll.go.html#1868531">pollDesc</a></span>&nbsp;<span class="comment" id="1868565">//&nbsp;in&nbsp;pollcache,&nbsp;protected&nbsp;by&nbsp;pollcache.lock</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1868612">//&nbsp;The&nbsp;lock&nbsp;protects&nbsp;pollOpen,&nbsp;pollSetDeadline,&nbsp;pollUnblock&nbsp;and&nbsp;deadlineimpl&nbsp;operations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1868702">//&nbsp;This&nbsp;fully&nbsp;covers&nbsp;seq,&nbsp;rt&nbsp;and&nbsp;wt&nbsp;variables.&nbsp;fd&nbsp;is&nbsp;constant&nbsp;throughout&nbsp;the&nbsp;PollDesc&nbsp;lifetime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1868799">//&nbsp;pollReset,&nbsp;pollWait,&nbsp;pollWaitCanceled&nbsp;and&nbsp;runtimeÂ·netpollready&nbsp;(IO&nbsp;readiness&nbsp;notification)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1868895">//&nbsp;proceed&nbsp;w/o&nbsp;taking&nbsp;the&nbsp;lock.&nbsp;So&nbsp;closing,&nbsp;rg,&nbsp;rd,&nbsp;wg&nbsp;and&nbsp;wd&nbsp;are&nbsp;manipulated</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1868974">//&nbsp;in&nbsp;a&nbsp;lock-free&nbsp;way&nbsp;by&nbsp;all&nbsp;operations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1869016">//&nbsp;NOTE(dvyukov):&nbsp;the&nbsp;following&nbsp;code&nbsp;uses&nbsp;uintptr&nbsp;to&nbsp;store&nbsp;*g&nbsp;(rg/wg),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1869088">//&nbsp;that&nbsp;will&nbsp;blow&nbsp;up&nbsp;when&nbsp;GC&nbsp;starts&nbsp;moving&nbsp;objects.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1869141">lock</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1869149"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2016175">mutex</a></span>&nbsp;<span class="comment" id="1869155">//&nbsp;protectes&nbsp;the&nbsp;following&nbsp;fields</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1869190">fd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1869198">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1869207">closing</span>&nbsp;<span class="builtintype" id="1869215">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1869221">seq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1869229">uintptr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1869244">//&nbsp;protects&nbsp;from&nbsp;stale&nbsp;timers&nbsp;and&nbsp;ready&nbsp;notifications</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1869299">rg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1869307">uintptr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1869322">//&nbsp;pdReady,&nbsp;pdWait,&nbsp;G&nbsp;waiting&nbsp;for&nbsp;read&nbsp;or&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1869369">rt</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1869377"><a href="/runtime/time.go.html#1987190">timer</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1869392">//&nbsp;read&nbsp;deadline&nbsp;timer&nbsp;(set&nbsp;if&nbsp;rt.f&nbsp;!=&nbsp;nil)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1869437">rd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1869445">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1869460">//&nbsp;read&nbsp;deadline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1869478">wg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1869486">uintptr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1869501">//&nbsp;pdReady,&nbsp;pdWait,&nbsp;G&nbsp;waiting&nbsp;for&nbsp;write&nbsp;or&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1869549">wt</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1869557"><a href="/runtime/time.go.html#1987190">timer</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1869572">//&nbsp;write&nbsp;deadline&nbsp;timer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1869597">wd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1869605">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1869620">//&nbsp;write&nbsp;deadline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1869639">user</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1869647"><a href="/runtime/netpoll.go.html#1867109">unsafe</a></span><span class="op" id="1869653">.</span><span class="ident" id="1869654">Pointer</span>&nbsp;<span class="comment" id="1869662">//&nbsp;user&nbsp;settable&nbsp;cookie</span><br>
<span class="lineno">60</span><span class="op" id="1869686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1869689">type</span>&nbsp;<span class="ident" id="1869694">pollCache</span>&nbsp;<span class="keyword" id="1869704">struct</span>&nbsp;<span class="op" id="1869711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1869714">lock</span>&nbsp;&nbsp;<span class="ident" id="1869720"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2016175">mutex</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1869727">first</span>&nbsp;<span class="op" id="1869733">*</span><span class="ident" id="1869734"><a href="/runtime/netpoll.go.html#1868531">pollDesc</a></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1869744">//&nbsp;PollDesc&nbsp;objects&nbsp;must&nbsp;be&nbsp;type-stable,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1869786">//&nbsp;because&nbsp;we&nbsp;can&nbsp;get&nbsp;ready&nbsp;notification&nbsp;from&nbsp;epoll/kqueue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1869846">//&nbsp;after&nbsp;the&nbsp;descriptor&nbsp;is&nbsp;closed/reused.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1869889">//&nbsp;Stale&nbsp;notifications&nbsp;are&nbsp;detected&nbsp;using&nbsp;seq&nbsp;variable,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1869946">//&nbsp;seq&nbsp;is&nbsp;incremented&nbsp;when&nbsp;deadlines&nbsp;are&nbsp;changed&nbsp;or&nbsp;descriptor&nbsp;is&nbsp;reused.</span><br>
<span class="lineno">70</span><span class="op" id="1870020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1870023">var</span>&nbsp;<span class="ident" id="1870027">pollcache</span>&nbsp;<span class="ident" id="1870037"><a href="/runtime/netpoll.go.html#1869694">pollCache</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1870048">func</span>&nbsp;<span class="ident" id="1870053">netpollServerInit</span><span class="op" id="1870070">(</span><span class="op" id="1870071">)</span>&nbsp;<span class="op" id="1870073">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1870076"><a href="/runtime/stubs.go.html#1971002">onM</a></span><span class="op" id="1870079">(</span><span class="ident" id="1870080"><a href="/runtime/netpoll_epoll.go.html#1879074">netpollinit</a></span><span class="op" id="1870091">)</span><br>
<span class="lineno"></span><span class="op" id="1870093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1870096">func</span>&nbsp;<span class="ident" id="1870101">netpollOpen</span><span class="op" id="1870112">(</span><span class="ident" id="1870113">fd</span>&nbsp;<span class="builtintype" id="1870116">uintptr</span><span class="op" id="1870123">)</span>&nbsp;<span class="op" id="1870125">(</span><span class="op" id="1870126">*</span><span class="ident" id="1870127"><a href="/runtime/netpoll.go.html#1868531">pollDesc</a></span><span class="op" id="1870135">,</span>&nbsp;<span class="builtintype" id="1870137">int</span><span class="op" id="1870140">)</span>&nbsp;<span class="op" id="1870142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1870145">pd</span>&nbsp;<span class="op" id="1870148">:=</span>&nbsp;<span class="ident" id="1870151"><a href="/runtime/netpoll.go.html#1870027">pollcache</a></span><span class="op" id="1870160">.</span><span class="ident" id="1870161">alloc</span><span class="op" id="1870166">(</span><span class="op" id="1870167">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1870170"><a href="/runtime/lock_futex.go.html#1815304">lock</a></span><span class="op" id="1870174">(</span><span class="op" id="1870175">&amp;</span><span class="ident" id="1870176"><a href="/runtime/netpoll.go.html#1870145">pd</a></span><span class="op" id="1870178">.</span><span class="ident" id="1870179">lock</span><span class="op" id="1870183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1870186">if</span>&nbsp;<span class="ident" id="1870189"><a href="/runtime/netpoll.go.html#1870145">pd</a></span><span class="op" id="1870191">.</span><span class="ident" id="1870192">wg</span>&nbsp;<span class="op" id="1870195">!=</span>&nbsp;<span class="num" id="1870198">0</span>&nbsp;<span class="op" id="1870200">&amp;&amp;</span>&nbsp;<span class="ident" id="1870203"><a href="/runtime/netpoll.go.html#1870145">pd</a></span><span class="op" id="1870205">.</span><span class="ident" id="1870206">wg</span>&nbsp;<span class="op" id="1870209">!=</span>&nbsp;<span class="ident" id="1870212"><a href="/runtime/netpoll.go.html#1868420">pdReady</a></span>&nbsp;<span class="op" id="1870220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1870224"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1870231">(</span><span class="string" id="1870232">&#34;netpollOpen:&nbsp;blocked&nbsp;write&nbsp;on&nbsp;free&nbsp;descriptor&#34;</span><span class="op" id="1870279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1870282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1870285">if</span>&nbsp;<span class="ident" id="1870288"><a href="/runtime/netpoll.go.html#1870145">pd</a></span><span class="op" id="1870290">.</span><span class="ident" id="1870291">rg</span>&nbsp;<span class="op" id="1870294">!=</span>&nbsp;<span class="num" id="1870297">0</span>&nbsp;<span class="op" id="1870299">&amp;&amp;</span>&nbsp;<span class="ident" id="1870302"><a href="/runtime/netpoll.go.html#1870145">pd</a></span><span class="op" id="1870304">.</span><span class="ident" id="1870305">rg</span>&nbsp;<span class="op" id="1870308">!=</span>&nbsp;<span class="ident" id="1870311"><a href="/runtime/netpoll.go.html#1868420">pdReady</a></span>&nbsp;<span class="op" id="1870319">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1870323"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1870330">(</span><span class="string" id="1870331">&#34;netpollOpen:&nbsp;blocked&nbsp;read&nbsp;on&nbsp;free&nbsp;descriptor&#34;</span><span class="op" id="1870377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1870380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1870383"><a href="/runtime/netpoll.go.html#1870145">pd</a></span><span class="op" id="1870385">.</span><span class="ident" id="1870386">fd</span>&nbsp;<span class="op" id="1870389">=</span>&nbsp;<span class="ident" id="1870391"><a href="/runtime/netpoll.go.html#1870113">fd</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1870395"><a href="/runtime/netpoll.go.html#1870145">pd</a></span><span class="op" id="1870397">.</span><span class="ident" id="1870398">closing</span>&nbsp;<span class="op" id="1870406">=</span>&nbsp;<span class="ident" id="1870408">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1870415"><a href="/runtime/netpoll.go.html#1870145">pd</a></span><span class="op" id="1870417">.</span><span class="ident" id="1870418">seq</span><span class="op" id="1870421">++</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1870425"><a href="/runtime/netpoll.go.html#1870145">pd</a></span><span class="op" id="1870427">.</span><span class="ident" id="1870428">rg</span>&nbsp;<span class="op" id="1870431">=</span>&nbsp;<span class="num" id="1870433">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1870436"><a href="/runtime/netpoll.go.html#1870145">pd</a></span><span class="op" id="1870438">.</span><span class="ident" id="1870439">rd</span>&nbsp;<span class="op" id="1870442">=</span>&nbsp;<span class="num" id="1870444">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1870447"><a href="/runtime/netpoll.go.html#1870145">pd</a></span><span class="op" id="1870449">.</span><span class="ident" id="1870450">wg</span>&nbsp;<span class="op" id="1870453">=</span>&nbsp;<span class="num" id="1870455">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1870458"><a href="/runtime/netpoll.go.html#1870145">pd</a></span><span class="op" id="1870460">.</span><span class="ident" id="1870461">wd</span>&nbsp;<span class="op" id="1870464">=</span>&nbsp;<span class="num" id="1870466">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1870469"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1870475">(</span><span class="op" id="1870476">&amp;</span><span class="ident" id="1870477"><a href="/runtime/netpoll.go.html#1870145">pd</a></span><span class="op" id="1870479">.</span><span class="ident" id="1870480">lock</span><span class="op" id="1870484">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1870488">var</span>&nbsp;<span class="ident" id="1870492">errno</span>&nbsp;<span class="builtintype" id="1870498">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1870505"><a href="/runtime/stubs.go.html#1971002">onM</a></span><span class="op" id="1870508">(</span><span class="keyword" id="1870509">func</span><span class="op" id="1870513">(</span><span class="op" id="1870514">)</span>&nbsp;<span class="op" id="1870516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1870520"><a href="/runtime/netpoll.go.html#1870492">errno</a></span>&nbsp;<span class="op" id="1870526">=</span>&nbsp;<span class="ident" id="1870528"><a href="/runtime/netpoll_epoll.go.html#1879356">netpollopen</a></span><span class="op" id="1870539">(</span><span class="ident" id="1870540"><a href="/runtime/netpoll.go.html#1870113">fd</a></span><span class="op" id="1870542">,</span>&nbsp;<span class="ident" id="1870544"><a href="/runtime/netpoll.go.html#1870145">pd</a></span><span class="op" id="1870546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1870549">}</span><span class="op" id="1870550">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1870553">return</span>&nbsp;<span class="ident" id="1870560"><a href="/runtime/netpoll.go.html#1870145">pd</a></span><span class="op" id="1870562">,</span>&nbsp;<span class="builtintype" id="1870564">int</span><span class="op" id="1870567">(</span><span class="ident" id="1870568"><a href="/runtime/netpoll.go.html#1870492">errno</a></span><span class="op" id="1870573">)</span><br>
<span class="lineno"></span><span class="op" id="1870575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1870578">func</span>&nbsp;<span class="ident" id="1870583">netpollClose</span><span class="op" id="1870595">(</span><span class="ident" id="1870596">pd</span>&nbsp;<span class="op" id="1870599">*</span><span class="ident" id="1870600"><a href="/runtime/netpoll.go.html#1868531">pollDesc</a></span><span class="op" id="1870608">)</span>&nbsp;<span class="op" id="1870610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1870613">if</span>&nbsp;<span class="op" id="1870616">!</span><span class="ident" id="1870617"><a href="/runtime/netpoll.go.html#1870596">pd</a></span><span class="op" id="1870619">.</span><span class="ident" id="1870620">closing</span>&nbsp;<span class="op" id="1870628">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1870632"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1870639">(</span><span class="string" id="1870640">&#34;netpollClose:&nbsp;close&nbsp;w/o&nbsp;unblock&#34;</span><span class="op" id="1870673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1870676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1870679">if</span>&nbsp;<span class="ident" id="1870682"><a href="/runtime/netpoll.go.html#1870596">pd</a></span><span class="op" id="1870684">.</span><span class="ident" id="1870685">wg</span>&nbsp;<span class="op" id="1870688">!=</span>&nbsp;<span class="num" id="1870691">0</span>&nbsp;<span class="op" id="1870693">&amp;&amp;</span>&nbsp;<span class="ident" id="1870696"><a href="/runtime/netpoll.go.html#1870596">pd</a></span><span class="op" id="1870698">.</span><span class="ident" id="1870699">wg</span>&nbsp;<span class="op" id="1870702">!=</span>&nbsp;<span class="ident" id="1870705"><a href="/runtime/netpoll.go.html#1868420">pdReady</a></span>&nbsp;<span class="op" id="1870713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1870717"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1870724">(</span><span class="string" id="1870725">&#34;netpollClose:&nbsp;blocked&nbsp;write&nbsp;on&nbsp;closing&nbsp;descriptor&#34;</span><span class="op" id="1870776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1870779">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1870782">if</span>&nbsp;<span class="ident" id="1870785"><a href="/runtime/netpoll.go.html#1870596">pd</a></span><span class="op" id="1870787">.</span><span class="ident" id="1870788">rg</span>&nbsp;<span class="op" id="1870791">!=</span>&nbsp;<span class="num" id="1870794">0</span>&nbsp;<span class="op" id="1870796">&amp;&amp;</span>&nbsp;<span class="ident" id="1870799"><a href="/runtime/netpoll.go.html#1870596">pd</a></span><span class="op" id="1870801">.</span><span class="ident" id="1870802">rg</span>&nbsp;<span class="op" id="1870805">!=</span>&nbsp;<span class="ident" id="1870808"><a href="/runtime/netpoll.go.html#1868420">pdReady</a></span>&nbsp;<span class="op" id="1870816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1870820"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1870827">(</span><span class="string" id="1870828">&#34;netpollClose:&nbsp;blocked&nbsp;read&nbsp;on&nbsp;closing&nbsp;descriptor&#34;</span><span class="op" id="1870878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1870881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1870884"><a href="/runtime/stubs.go.html#1971002">onM</a></span><span class="op" id="1870887">(</span><span class="keyword" id="1870888">func</span><span class="op" id="1870892">(</span><span class="op" id="1870893">)</span>&nbsp;<span class="op" id="1870895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1870899"><a href="/runtime/netpoll_epoll.go.html#1879590">netpollclose</a></span><span class="op" id="1870911">(</span><span class="builtintype" id="1870912">uintptr</span><span class="op" id="1870919">(</span><span class="ident" id="1870920"><a href="/runtime/netpoll.go.html#1870596">pd</a></span><span class="op" id="1870922">.</span><span class="ident" id="1870923">fd</span><span class="op" id="1870925">)</span><span class="op" id="1870926">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1870929">}</span><span class="op" id="1870930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1870933"><a href="/runtime/netpoll.go.html#1870027">pollcache</a></span><span class="op" id="1870942">.</span><span class="ident" id="1870943">free</span><span class="op" id="1870947">(</span><span class="ident" id="1870948"><a href="/runtime/netpoll.go.html#1870596">pd</a></span><span class="op" id="1870950">)</span><br>
<span class="lineno"></span><span class="op" id="1870952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1870955">func</span>&nbsp;<span class="op" id="1870960">(</span><span class="ident" id="1870961">c</span>&nbsp;<span class="op" id="1870963">*</span><span class="ident" id="1870964"><a href="/runtime/netpoll.go.html#1869694">pollCache</a></span><span class="op" id="1870973">)</span>&nbsp;<span class="ident" id="1870975">free</span><span class="op" id="1870979">(</span><span class="ident" id="1870980">pd</span>&nbsp;<span class="op" id="1870983">*</span><span class="ident" id="1870984"><a href="/runtime/netpoll.go.html#1868531">pollDesc</a></span><span class="op" id="1870992">)</span>&nbsp;<span class="op" id="1870994">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1870997"><a href="/runtime/lock_futex.go.html#1815304">lock</a></span><span class="op" id="1871001">(</span><span class="op" id="1871002">&amp;</span><span class="ident" id="1871003"><a href="/runtime/netpoll.go.html#1870961">c</a></span><span class="op" id="1871004">.</span><span class="ident" id="1871005">lock</span><span class="op" id="1871009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1871012"><a href="/runtime/netpoll.go.html#1870980">pd</a></span><span class="op" id="1871014">.</span><span class="ident" id="1871015">link</span>&nbsp;<span class="op" id="1871020">=</span>&nbsp;<span class="ident" id="1871022"><a href="/runtime/netpoll.go.html#1870961">c</a></span><span class="op" id="1871023">.</span><span class="ident" id="1871024">first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1871031"><a href="/runtime/netpoll.go.html#1870961">c</a></span><span class="op" id="1871032">.</span><span class="ident" id="1871033">first</span>&nbsp;<span class="op" id="1871039">=</span>&nbsp;<span class="ident" id="1871041"><a href="/runtime/netpoll.go.html#1870980">pd</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1871045"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1871051">(</span><span class="op" id="1871052">&amp;</span><span class="ident" id="1871053"><a href="/runtime/netpoll.go.html#1870961">c</a></span><span class="op" id="1871054">.</span><span class="ident" id="1871055">lock</span><span class="op" id="1871059">)</span><br>
<span class="lineno"></span><span class="op" id="1871061">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="1871064">func</span>&nbsp;<span class="ident" id="1871069">netpollReset</span><span class="op" id="1871081">(</span><span class="ident" id="1871082">pd</span>&nbsp;<span class="op" id="1871085">*</span><span class="ident" id="1871086"><a href="/runtime/netpoll.go.html#1868531">pollDesc</a></span><span class="op" id="1871094">,</span>&nbsp;<span class="ident" id="1871096">mode</span>&nbsp;<span class="builtintype" id="1871101">int</span><span class="op" id="1871104">)</span>&nbsp;<span class="builtintype" id="1871106">int</span>&nbsp;<span class="op" id="1871110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1871113">err</span>&nbsp;<span class="op" id="1871117">:=</span>&nbsp;<span class="ident" id="1871120"><a href="/runtime/netpoll.go.html#1874837">netpollcheckerr</a></span><span class="op" id="1871135">(</span><span class="ident" id="1871136"><a href="/runtime/netpoll.go.html#1871082">pd</a></span><span class="op" id="1871138">,</span>&nbsp;<span class="builtintype" id="1871140">int32</span><span class="op" id="1871145">(</span><span class="ident" id="1871146"><a href="/runtime/netpoll.go.html#1871096">mode</a></span><span class="op" id="1871150">)</span><span class="op" id="1871151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1871154">if</span>&nbsp;<span class="ident" id="1871157"><a href="/runtime/netpoll.go.html#1871113">err</a></span>&nbsp;<span class="op" id="1871161">!=</span>&nbsp;<span class="num" id="1871164">0</span>&nbsp;<span class="op" id="1871166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1871170">return</span>&nbsp;<span class="ident" id="1871177"><a href="/runtime/netpoll.go.html#1871113">err</a></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1871182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1871185">if</span>&nbsp;<span class="ident" id="1871188"><a href="/runtime/netpoll.go.html#1871096">mode</a></span>&nbsp;<span class="op" id="1871193">==</span>&nbsp;<span class="string" id="1871196">&#39;r&#39;</span>&nbsp;<span class="op" id="1871200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1871204"><a href="/runtime/netpoll.go.html#1871082">pd</a></span><span class="op" id="1871206">.</span><span class="ident" id="1871207">rg</span>&nbsp;<span class="op" id="1871210">=</span>&nbsp;<span class="num" id="1871212">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1871215">}</span>&nbsp;<span class="keyword" id="1871217">else</span>&nbsp;<span class="keyword" id="1871222">if</span>&nbsp;<span class="ident" id="1871225"><a href="/runtime/netpoll.go.html#1871096">mode</a></span>&nbsp;<span class="op" id="1871230">==</span>&nbsp;<span class="string" id="1871233">&#39;w&#39;</span>&nbsp;<span class="op" id="1871237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1871241"><a href="/runtime/netpoll.go.html#1871082">pd</a></span><span class="op" id="1871243">.</span><span class="ident" id="1871244">wg</span>&nbsp;<span class="op" id="1871247">=</span>&nbsp;<span class="num" id="1871249">0</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1871252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1871255">return</span>&nbsp;<span class="num" id="1871262">0</span><br>
<span class="lineno"></span><span class="op" id="1871264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1871267">func</span>&nbsp;<span class="ident" id="1871272">netpollWait</span><span class="op" id="1871283">(</span><span class="ident" id="1871284">pd</span>&nbsp;<span class="op" id="1871287">*</span><span class="ident" id="1871288"><a href="/runtime/netpoll.go.html#1868531">pollDesc</a></span><span class="op" id="1871296">,</span>&nbsp;<span class="ident" id="1871298">mode</span>&nbsp;<span class="builtintype" id="1871303">int</span><span class="op" id="1871306">)</span>&nbsp;<span class="builtintype" id="1871308">int</span>&nbsp;<span class="op" id="1871312">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1871315">err</span>&nbsp;<span class="op" id="1871319">:=</span>&nbsp;<span class="ident" id="1871322"><a href="/runtime/netpoll.go.html#1874837">netpollcheckerr</a></span><span class="op" id="1871337">(</span><span class="ident" id="1871338"><a href="/runtime/netpoll.go.html#1871284">pd</a></span><span class="op" id="1871340">,</span>&nbsp;<span class="builtintype" id="1871342">int32</span><span class="op" id="1871347">(</span><span class="ident" id="1871348"><a href="/runtime/netpoll.go.html#1871298">mode</a></span><span class="op" id="1871352">)</span><span class="op" id="1871353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1871356">if</span>&nbsp;<span class="ident" id="1871359"><a href="/runtime/netpoll.go.html#1871315">err</a></span>&nbsp;<span class="op" id="1871363">!=</span>&nbsp;<span class="num" id="1871366">0</span>&nbsp;<span class="op" id="1871368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1871372">return</span>&nbsp;<span class="ident" id="1871379"><a href="/runtime/netpoll.go.html#1871315">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1871384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1871387">//&nbsp;As&nbsp;for&nbsp;now&nbsp;only&nbsp;Solaris&nbsp;uses&nbsp;level-triggered&nbsp;IO.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1871440">if</span>&nbsp;<span class="ident" id="1871443"><a href="/runtime/extern.go.html#1763640">GOOS</a></span>&nbsp;<span class="op" id="1871448">==</span>&nbsp;<span class="string" id="1871451">&#34;solaris&#34;</span>&nbsp;<span class="op" id="1871461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1871465"><a href="/runtime/stubs.go.html#1971002">onM</a></span><span class="op" id="1871468">(</span><span class="keyword" id="1871469">func</span><span class="op" id="1871473">(</span><span class="op" id="1871474">)</span>&nbsp;<span class="op" id="1871476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1871481"><a href="/runtime/netpoll_epoll.go.html#1879706">netpollarm</a></span><span class="op" id="1871491">(</span><span class="ident" id="1871492"><a href="/runtime/netpoll.go.html#1871284">pd</a></span><span class="op" id="1871494">,</span>&nbsp;<span class="ident" id="1871496"><a href="/runtime/netpoll.go.html#1871298">mode</a></span><span class="op" id="1871500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1871504">}</span><span class="op" id="1871505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1871508">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1871511">for</span>&nbsp;<span class="op" id="1871515">!</span><span class="ident" id="1871516"><a href="/runtime/netpoll.go.html#1875290">netpollblock</a></span><span class="op" id="1871528">(</span><span class="ident" id="1871529"><a href="/runtime/netpoll.go.html#1871284">pd</a></span><span class="op" id="1871531">,</span>&nbsp;<span class="builtintype" id="1871533">int32</span><span class="op" id="1871538">(</span><span class="ident" id="1871539"><a href="/runtime/netpoll.go.html#1871298">mode</a></span><span class="op" id="1871543">)</span><span class="op" id="1871544">,</span>&nbsp;<span class="ident" id="1871546">false</span><span class="op" id="1871551">)</span>&nbsp;<span class="op" id="1871553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1871557"><a href="/runtime/netpoll.go.html#1871315">err</a></span>&nbsp;<span class="op" id="1871561">=</span>&nbsp;<span class="ident" id="1871563"><a href="/runtime/netpoll.go.html#1874837">netpollcheckerr</a></span><span class="op" id="1871578">(</span><span class="ident" id="1871579"><a href="/runtime/netpoll.go.html#1871284">pd</a></span><span class="op" id="1871581">,</span>&nbsp;<span class="builtintype" id="1871583">int32</span><span class="op" id="1871588">(</span><span class="ident" id="1871589"><a href="/runtime/netpoll.go.html#1871298">mode</a></span><span class="op" id="1871593">)</span><span class="op" id="1871594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1871598">if</span>&nbsp;<span class="ident" id="1871601"><a href="/runtime/netpoll.go.html#1871315">err</a></span>&nbsp;<span class="op" id="1871605">!=</span>&nbsp;<span class="num" id="1871608">0</span>&nbsp;<span class="op" id="1871610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1871615">return</span>&nbsp;<span class="ident" id="1871622"><a href="/runtime/netpoll.go.html#1871315">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1871628">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1871632">//&nbsp;Can&nbsp;happen&nbsp;if&nbsp;timeout&nbsp;has&nbsp;fired&nbsp;and&nbsp;unblocked&nbsp;us,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1871687">//&nbsp;but&nbsp;before&nbsp;we&nbsp;had&nbsp;a&nbsp;chance&nbsp;to&nbsp;run,&nbsp;timeout&nbsp;has&nbsp;been&nbsp;reset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1871751">//&nbsp;Pretend&nbsp;it&nbsp;has&nbsp;not&nbsp;happened&nbsp;and&nbsp;retry.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1871794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1871797">return</span>&nbsp;<span class="num" id="1871804">0</span><br>
<span class="lineno">160</span><span class="op" id="1871806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1871809">func</span>&nbsp;<span class="ident" id="1871814">netpollWaitCanceled</span><span class="op" id="1871833">(</span><span class="ident" id="1871834">pd</span>&nbsp;<span class="op" id="1871837">*</span><span class="ident" id="1871838"><a href="/runtime/netpoll.go.html#1868531">pollDesc</a></span><span class="op" id="1871846">,</span>&nbsp;<span class="ident" id="1871848">mode</span>&nbsp;<span class="builtintype" id="1871853">int</span><span class="op" id="1871856">)</span>&nbsp;<span class="op" id="1871858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1871861">//&nbsp;This&nbsp;function&nbsp;is&nbsp;used&nbsp;only&nbsp;on&nbsp;windows&nbsp;after&nbsp;a&nbsp;failed&nbsp;attempt&nbsp;to&nbsp;cancel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1871936">//&nbsp;a&nbsp;pending&nbsp;async&nbsp;IO&nbsp;operation.&nbsp;Wait&nbsp;for&nbsp;ioready,&nbsp;ignore&nbsp;closing&nbsp;or&nbsp;timeouts.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1872016">for</span>&nbsp;<span class="op" id="1872020">!</span><span class="ident" id="1872021"><a href="/runtime/netpoll.go.html#1875290">netpollblock</a></span><span class="op" id="1872033">(</span><span class="ident" id="1872034"><a href="/runtime/netpoll.go.html#1871834">pd</a></span><span class="op" id="1872036">,</span>&nbsp;<span class="builtintype" id="1872038">int32</span><span class="op" id="1872043">(</span><span class="ident" id="1872044"><a href="/runtime/netpoll.go.html#1871848">mode</a></span><span class="op" id="1872048">)</span><span class="op" id="1872049">,</span>&nbsp;<span class="ident" id="1872051">true</span><span class="op" id="1872055">)</span>&nbsp;<span class="op" id="1872057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1872060">}</span><br>
<span class="lineno"></span><span class="op" id="1872062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1872065">func</span>&nbsp;<span class="ident" id="1872070">netpollSetDeadline</span><span class="op" id="1872088">(</span><span class="ident" id="1872089">pd</span>&nbsp;<span class="op" id="1872092">*</span><span class="ident" id="1872093"><a href="/runtime/netpoll.go.html#1868531">pollDesc</a></span><span class="op" id="1872101">,</span>&nbsp;<span class="ident" id="1872103">d</span>&nbsp;<span class="ident" id="1872105">int64</span><span class="op" id="1872110">,</span>&nbsp;<span class="ident" id="1872112">mode</span>&nbsp;<span class="builtintype" id="1872117">int</span><span class="op" id="1872120">)</span>&nbsp;<span class="op" id="1872122">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1872125"><a href="/runtime/lock_futex.go.html#1815304">lock</a></span><span class="op" id="1872129">(</span><span class="op" id="1872130">&amp;</span><span class="ident" id="1872131"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1872133">.</span><span class="ident" id="1872134">lock</span><span class="op" id="1872138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1872141">if</span>&nbsp;<span class="ident" id="1872144"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1872146">.</span><span class="ident" id="1872147">closing</span>&nbsp;<span class="op" id="1872155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1872159"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1872165">(</span><span class="op" id="1872166">&amp;</span><span class="ident" id="1872167"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1872169">.</span><span class="ident" id="1872170">lock</span><span class="op" id="1872174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1872178">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1872186">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1872189"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1872191">.</span><span class="ident" id="1872192">seq</span><span class="op" id="1872195">++</span>&nbsp;<span class="comment" id="1872198">//&nbsp;invalidate&nbsp;current&nbsp;timers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1872228">//&nbsp;Reset&nbsp;current&nbsp;timers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1872254">if</span>&nbsp;<span class="ident" id="1872257"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1872259">.</span><span class="ident" id="1872260">rt</span><span class="op" id="1872262">.</span><span class="ident" id="1872263">f</span>&nbsp;<span class="op" id="1872265">!=</span>&nbsp;<span class="ident" id="1872268">nil</span>&nbsp;<span class="op" id="1872272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1872276"><a href="/runtime/time.go.html#1989531">deltimer</a></span><span class="op" id="1872284">(</span><span class="op" id="1872285">&amp;</span><span class="ident" id="1872286"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1872288">.</span><span class="ident" id="1872289">rt</span><span class="op" id="1872291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1872295"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1872297">.</span><span class="ident" id="1872298">rt</span><span class="op" id="1872300">.</span><span class="ident" id="1872301">f</span>&nbsp;<span class="op" id="1872303">=</span>&nbsp;<span class="ident" id="1872305">nil</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1872310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1872313">if</span>&nbsp;<span class="ident" id="1872316"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1872318">.</span><span class="ident" id="1872319">wt</span><span class="op" id="1872321">.</span><span class="ident" id="1872322">f</span>&nbsp;<span class="op" id="1872324">!=</span>&nbsp;<span class="ident" id="1872327">nil</span>&nbsp;<span class="op" id="1872331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1872335"><a href="/runtime/time.go.html#1989531">deltimer</a></span><span class="op" id="1872343">(</span><span class="op" id="1872344">&amp;</span><span class="ident" id="1872345"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1872347">.</span><span class="ident" id="1872348">wt</span><span class="op" id="1872350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1872354"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1872356">.</span><span class="ident" id="1872357">wt</span><span class="op" id="1872359">.</span><span class="ident" id="1872360">f</span>&nbsp;<span class="op" id="1872362">=</span>&nbsp;<span class="ident" id="1872364">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1872369">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1872372">//&nbsp;Setup&nbsp;new&nbsp;timers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1872394">if</span>&nbsp;<span class="ident" id="1872397"><a href="/runtime/netpoll.go.html#1872103">d</a></span>&nbsp;<span class="op" id="1872399">!=</span>&nbsp;<span class="num" id="1872402">0</span>&nbsp;<span class="op" id="1872404">&amp;&amp;</span>&nbsp;<span class="ident" id="1872407"><a href="/runtime/netpoll.go.html#1872103">d</a></span>&nbsp;<span class="op" id="1872409">&lt;=</span>&nbsp;<span class="ident" id="1872412"><a href="/runtime/stubs.go.html#1973903">nanotime</a></span><span class="op" id="1872420">(</span><span class="op" id="1872421">)</span>&nbsp;<span class="op" id="1872423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1872427"><a href="/runtime/netpoll.go.html#1872103">d</a></span>&nbsp;<span class="op" id="1872429">=</span>&nbsp;<span class="op" id="1872431">-</span><span class="num" id="1872432">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1872435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1872438">if</span>&nbsp;<span class="ident" id="1872441"><a href="/runtime/netpoll.go.html#1872112">mode</a></span>&nbsp;<span class="op" id="1872446">==</span>&nbsp;<span class="string" id="1872449">&#39;r&#39;</span>&nbsp;<span class="op" id="1872453">||</span>&nbsp;<span class="ident" id="1872456"><a href="/runtime/netpoll.go.html#1872112">mode</a></span>&nbsp;<span class="op" id="1872461">==</span>&nbsp;<span class="string" id="1872464">&#39;r&#39;</span><span class="op" id="1872467">+</span><span class="string" id="1872468">&#39;w&#39;</span>&nbsp;<span class="op" id="1872472">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1872476"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1872478">.</span><span class="ident" id="1872479">rd</span>&nbsp;<span class="op" id="1872482">=</span>&nbsp;<span class="ident" id="1872484"><a href="/runtime/netpoll.go.html#1872103">d</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1872487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1872490">if</span>&nbsp;<span class="ident" id="1872493"><a href="/runtime/netpoll.go.html#1872112">mode</a></span>&nbsp;<span class="op" id="1872498">==</span>&nbsp;<span class="string" id="1872501">&#39;w&#39;</span>&nbsp;<span class="op" id="1872505">||</span>&nbsp;<span class="ident" id="1872508"><a href="/runtime/netpoll.go.html#1872112">mode</a></span>&nbsp;<span class="op" id="1872513">==</span>&nbsp;<span class="string" id="1872516">&#39;r&#39;</span><span class="op" id="1872519">+</span><span class="string" id="1872520">&#39;w&#39;</span>&nbsp;<span class="op" id="1872524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1872528"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1872530">.</span><span class="ident" id="1872531">wd</span>&nbsp;<span class="op" id="1872534">=</span>&nbsp;<span class="ident" id="1872536"><a href="/runtime/netpoll.go.html#1872103">d</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1872539">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1872542">if</span>&nbsp;<span class="ident" id="1872545"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1872547">.</span><span class="ident" id="1872548">rd</span>&nbsp;<span class="op" id="1872551">&gt;</span>&nbsp;<span class="num" id="1872553">0</span>&nbsp;<span class="op" id="1872555">&amp;&amp;</span>&nbsp;<span class="ident" id="1872558"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1872560">.</span><span class="ident" id="1872561">rd</span>&nbsp;<span class="op" id="1872564">==</span>&nbsp;<span class="ident" id="1872567"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1872569">.</span><span class="ident" id="1872570">wd</span>&nbsp;<span class="op" id="1872573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1872577"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1872579">.</span><span class="ident" id="1872580">rt</span><span class="op" id="1872582">.</span><span class="ident" id="1872583">f</span>&nbsp;<span class="op" id="1872585">=</span>&nbsp;<span class="ident" id="1872587"><a href="/runtime/netpoll.go.html#1877670">netpollDeadline</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1872605"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1872607">.</span><span class="ident" id="1872608">rt</span><span class="op" id="1872610">.</span><span class="ident" id="1872611">when</span>&nbsp;<span class="op" id="1872616">=</span>&nbsp;<span class="ident" id="1872618"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1872620">.</span><span class="ident" id="1872621">rd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1872626">//&nbsp;Copy&nbsp;current&nbsp;seq&nbsp;into&nbsp;the&nbsp;timer&nbsp;arg.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1872668">//&nbsp;Timer&nbsp;func&nbsp;will&nbsp;check&nbsp;the&nbsp;seq&nbsp;against&nbsp;current&nbsp;descriptor&nbsp;seq,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1872735">//&nbsp;if&nbsp;they&nbsp;differ&nbsp;the&nbsp;descriptor&nbsp;was&nbsp;reused&nbsp;or&nbsp;timers&nbsp;were&nbsp;reset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1872803"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1872805">.</span><span class="ident" id="1872806">rt</span><span class="op" id="1872808">.</span><span class="ident" id="1872809">arg</span>&nbsp;<span class="op" id="1872813">=</span>&nbsp;<span class="ident" id="1872815"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1872820"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1872822">.</span><span class="ident" id="1872823">rt</span><span class="op" id="1872825">.</span><span class="ident" id="1872826">seq</span>&nbsp;<span class="op" id="1872830">=</span>&nbsp;<span class="ident" id="1872832"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1872834">.</span><span class="ident" id="1872835">seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1872841"><a href="/runtime/time.go.html#1988605">addtimer</a></span><span class="op" id="1872849">(</span><span class="op" id="1872850">&amp;</span><span class="ident" id="1872851"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1872853">.</span><span class="ident" id="1872854">rt</span><span class="op" id="1872856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1872859">}</span>&nbsp;<span class="keyword" id="1872861">else</span>&nbsp;<span class="op" id="1872866">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1872870">if</span>&nbsp;<span class="ident" id="1872873"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1872875">.</span><span class="ident" id="1872876">rd</span>&nbsp;<span class="op" id="1872879">&gt;</span>&nbsp;<span class="num" id="1872881">0</span>&nbsp;<span class="op" id="1872883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1872888"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1872890">.</span><span class="ident" id="1872891">rt</span><span class="op" id="1872893">.</span><span class="ident" id="1872894">f</span>&nbsp;<span class="op" id="1872896">=</span>&nbsp;<span class="ident" id="1872898"><a href="/runtime/netpoll.go.html#1877781">netpollReadDeadline</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1872921"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1872923">.</span><span class="ident" id="1872924">rt</span><span class="op" id="1872926">.</span><span class="ident" id="1872927">when</span>&nbsp;<span class="op" id="1872932">=</span>&nbsp;<span class="ident" id="1872934"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1872936">.</span><span class="ident" id="1872937">rd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1872943"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1872945">.</span><span class="ident" id="1872946">rt</span><span class="op" id="1872948">.</span><span class="ident" id="1872949">arg</span>&nbsp;<span class="op" id="1872953">=</span>&nbsp;<span class="ident" id="1872955"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1872961"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1872963">.</span><span class="ident" id="1872964">rt</span><span class="op" id="1872966">.</span><span class="ident" id="1872967">seq</span>&nbsp;<span class="op" id="1872971">=</span>&nbsp;<span class="ident" id="1872973"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1872975">.</span><span class="ident" id="1872976">seq</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1872983"><a href="/runtime/time.go.html#1988605">addtimer</a></span><span class="op" id="1872991">(</span><span class="op" id="1872992">&amp;</span><span class="ident" id="1872993"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1872995">.</span><span class="ident" id="1872996">rt</span><span class="op" id="1872998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1873002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1873006">if</span>&nbsp;<span class="ident" id="1873009"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1873011">.</span><span class="ident" id="1873012">wd</span>&nbsp;<span class="op" id="1873015">&gt;</span>&nbsp;<span class="num" id="1873017">0</span>&nbsp;<span class="op" id="1873019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873024"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1873026">.</span><span class="ident" id="1873027">wt</span><span class="op" id="1873029">.</span><span class="ident" id="1873030">f</span>&nbsp;<span class="op" id="1873032">=</span>&nbsp;<span class="ident" id="1873034"><a href="/runtime/netpoll.go.html#1877897">netpollWriteDeadline</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873058"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1873060">.</span><span class="ident" id="1873061">wt</span><span class="op" id="1873063">.</span><span class="ident" id="1873064">when</span>&nbsp;<span class="op" id="1873069">=</span>&nbsp;<span class="ident" id="1873071"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1873073">.</span><span class="ident" id="1873074">wd</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873080"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1873082">.</span><span class="ident" id="1873083">wt</span><span class="op" id="1873085">.</span><span class="ident" id="1873086">arg</span>&nbsp;<span class="op" id="1873090">=</span>&nbsp;<span class="ident" id="1873092"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873098"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1873100">.</span><span class="ident" id="1873101">wt</span><span class="op" id="1873103">.</span><span class="ident" id="1873104">seq</span>&nbsp;<span class="op" id="1873108">=</span>&nbsp;<span class="ident" id="1873110"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1873112">.</span><span class="ident" id="1873113">seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873120"><a href="/runtime/time.go.html#1988605">addtimer</a></span><span class="op" id="1873128">(</span><span class="op" id="1873129">&amp;</span><span class="ident" id="1873130"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1873132">.</span><span class="ident" id="1873133">wt</span><span class="op" id="1873135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1873139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1873142">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1873145">//&nbsp;If&nbsp;we&nbsp;set&nbsp;the&nbsp;new&nbsp;deadline&nbsp;in&nbsp;the&nbsp;past,&nbsp;unblock&nbsp;currently&nbsp;pending&nbsp;IO&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1873226">var</span>&nbsp;<span class="ident" id="1873230">rg</span><span class="op" id="1873232">,</span>&nbsp;<span class="ident" id="1873234">wg</span>&nbsp;<span class="op" id="1873237">*</span><span class="ident" id="1873238"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2017238">g</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873241"><a href="/runtime/atomic.go.html#1711698">atomicstorep</a></span><span class="op" id="1873253">(</span><span class="ident" id="1873254"><a href="/runtime/netpoll.go.html#1867109">unsafe</a></span><span class="op" id="1873260">.</span><span class="ident" id="1873261">Pointer</span><span class="op" id="1873268">(</span><span class="op" id="1873269">&amp;</span><span class="ident" id="1873270"><a href="/runtime/netpoll.go.html#1873234">wg</a></span><span class="op" id="1873272">)</span><span class="op" id="1873273">,</span>&nbsp;<span class="ident" id="1873275">nil</span><span class="op" id="1873278">)</span>&nbsp;<span class="comment" id="1873280">//&nbsp;full&nbsp;memory&nbsp;barrier&nbsp;between&nbsp;stores&nbsp;to&nbsp;rd/wd&nbsp;and&nbsp;load&nbsp;of&nbsp;rg/wg&nbsp;in&nbsp;netpollunblock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1873364">if</span>&nbsp;<span class="ident" id="1873367"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1873369">.</span><span class="ident" id="1873370">rd</span>&nbsp;<span class="op" id="1873373">&lt;</span>&nbsp;<span class="num" id="1873375">0</span>&nbsp;<span class="op" id="1873377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873381"><a href="/runtime/netpoll.go.html#1873230">rg</a></span>&nbsp;<span class="op" id="1873384">=</span>&nbsp;<span class="ident" id="1873386"><a href="/runtime/netpoll.go.html#1876177">netpollunblock</a></span><span class="op" id="1873400">(</span><span class="ident" id="1873401"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1873403">,</span>&nbsp;<span class="string" id="1873405">&#39;r&#39;</span><span class="op" id="1873408">,</span>&nbsp;<span class="ident" id="1873410">false</span><span class="op" id="1873415">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1873418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1873421">if</span>&nbsp;<span class="ident" id="1873424"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1873426">.</span><span class="ident" id="1873427">wd</span>&nbsp;<span class="op" id="1873430">&lt;</span>&nbsp;<span class="num" id="1873432">0</span>&nbsp;<span class="op" id="1873434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873438"><a href="/runtime/netpoll.go.html#1873234">wg</a></span>&nbsp;<span class="op" id="1873441">=</span>&nbsp;<span class="ident" id="1873443"><a href="/runtime/netpoll.go.html#1876177">netpollunblock</a></span><span class="op" id="1873457">(</span><span class="ident" id="1873458"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1873460">,</span>&nbsp;<span class="string" id="1873462">&#39;w&#39;</span><span class="op" id="1873465">,</span>&nbsp;<span class="ident" id="1873467">false</span><span class="op" id="1873472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1873475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873478"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1873484">(</span><span class="op" id="1873485">&amp;</span><span class="ident" id="1873486"><a href="/runtime/netpoll.go.html#1872089">pd</a></span><span class="op" id="1873488">.</span><span class="ident" id="1873489">lock</span><span class="op" id="1873493">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1873496">if</span>&nbsp;<span class="ident" id="1873499"><a href="/runtime/netpoll.go.html#1873230">rg</a></span>&nbsp;<span class="op" id="1873502">!=</span>&nbsp;<span class="ident" id="1873505">nil</span>&nbsp;<span class="op" id="1873509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873513"><a href="/runtime/proc.go.html#1903886">goready</a></span><span class="op" id="1873520">(</span><span class="ident" id="1873521"><a href="/runtime/netpoll.go.html#1873230">rg</a></span><span class="op" id="1873523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1873526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1873529">if</span>&nbsp;<span class="ident" id="1873532"><a href="/runtime/netpoll.go.html#1873234">wg</a></span>&nbsp;<span class="op" id="1873535">!=</span>&nbsp;<span class="ident" id="1873538">nil</span>&nbsp;<span class="op" id="1873542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873546"><a href="/runtime/proc.go.html#1903886">goready</a></span><span class="op" id="1873553">(</span><span class="ident" id="1873554"><a href="/runtime/netpoll.go.html#1873234">wg</a></span><span class="op" id="1873556">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1873559">}</span><br>
<span class="lineno"></span><span class="op" id="1873561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1873564">func</span>&nbsp;<span class="ident" id="1873569">netpollUnblock</span><span class="op" id="1873583">(</span><span class="ident" id="1873584">pd</span>&nbsp;<span class="op" id="1873587">*</span><span class="ident" id="1873588"><a href="/runtime/netpoll.go.html#1868531">pollDesc</a></span><span class="op" id="1873596">)</span>&nbsp;<span class="op" id="1873598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873601"><a href="/runtime/lock_futex.go.html#1815304">lock</a></span><span class="op" id="1873605">(</span><span class="op" id="1873606">&amp;</span><span class="ident" id="1873607"><a href="/runtime/netpoll.go.html#1873584">pd</a></span><span class="op" id="1873609">.</span><span class="ident" id="1873610">lock</span><span class="op" id="1873614">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1873617">if</span>&nbsp;<span class="ident" id="1873620"><a href="/runtime/netpoll.go.html#1873584">pd</a></span><span class="op" id="1873622">.</span><span class="ident" id="1873623">closing</span>&nbsp;<span class="op" id="1873631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873635"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1873642">(</span><span class="string" id="1873643">&#34;netpollUnblock:&nbsp;already&nbsp;closing&#34;</span><span class="op" id="1873676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1873679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873682"><a href="/runtime/netpoll.go.html#1873584">pd</a></span><span class="op" id="1873684">.</span><span class="ident" id="1873685">closing</span>&nbsp;<span class="op" id="1873693">=</span>&nbsp;<span class="ident" id="1873695">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873701"><a href="/runtime/netpoll.go.html#1873584">pd</a></span><span class="op" id="1873703">.</span><span class="ident" id="1873704">seq</span><span class="op" id="1873707">++</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1873711">var</span>&nbsp;<span class="ident" id="1873715">rg</span><span class="op" id="1873717">,</span>&nbsp;<span class="ident" id="1873719">wg</span>&nbsp;<span class="op" id="1873722">*</span><span class="ident" id="1873723"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2017238">g</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873726"><a href="/runtime/atomic.go.html#1711698">atomicstorep</a></span><span class="op" id="1873738">(</span><span class="ident" id="1873739"><a href="/runtime/netpoll.go.html#1867109">unsafe</a></span><span class="op" id="1873745">.</span><span class="ident" id="1873746">Pointer</span><span class="op" id="1873753">(</span><span class="op" id="1873754">&amp;</span><span class="ident" id="1873755"><a href="/runtime/netpoll.go.html#1873715">rg</a></span><span class="op" id="1873757">)</span><span class="op" id="1873758">,</span>&nbsp;<span class="ident" id="1873760">nil</span><span class="op" id="1873763">)</span>&nbsp;<span class="comment" id="1873765">//&nbsp;full&nbsp;memory&nbsp;barrier&nbsp;between&nbsp;store&nbsp;to&nbsp;closing&nbsp;and&nbsp;read&nbsp;of&nbsp;rg/wg&nbsp;in&nbsp;netpollunblock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873850"><a href="/runtime/netpoll.go.html#1873715">rg</a></span>&nbsp;<span class="op" id="1873853">=</span>&nbsp;<span class="ident" id="1873855"><a href="/runtime/netpoll.go.html#1876177">netpollunblock</a></span><span class="op" id="1873869">(</span><span class="ident" id="1873870"><a href="/runtime/netpoll.go.html#1873584">pd</a></span><span class="op" id="1873872">,</span>&nbsp;<span class="string" id="1873874">&#39;r&#39;</span><span class="op" id="1873877">,</span>&nbsp;<span class="ident" id="1873879">false</span><span class="op" id="1873884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873887"><a href="/runtime/netpoll.go.html#1873719">wg</a></span>&nbsp;<span class="op" id="1873890">=</span>&nbsp;<span class="ident" id="1873892"><a href="/runtime/netpoll.go.html#1876177">netpollunblock</a></span><span class="op" id="1873906">(</span><span class="ident" id="1873907"><a href="/runtime/netpoll.go.html#1873584">pd</a></span><span class="op" id="1873909">,</span>&nbsp;<span class="string" id="1873911">&#39;w&#39;</span><span class="op" id="1873914">,</span>&nbsp;<span class="ident" id="1873916">false</span><span class="op" id="1873921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1873924">if</span>&nbsp;<span class="ident" id="1873927"><a href="/runtime/netpoll.go.html#1873584">pd</a></span><span class="op" id="1873929">.</span><span class="ident" id="1873930">rt</span><span class="op" id="1873932">.</span><span class="ident" id="1873933">f</span>&nbsp;<span class="op" id="1873935">!=</span>&nbsp;<span class="ident" id="1873938">nil</span>&nbsp;<span class="op" id="1873942">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873946"><a href="/runtime/time.go.html#1989531">deltimer</a></span><span class="op" id="1873954">(</span><span class="op" id="1873955">&amp;</span><span class="ident" id="1873956"><a href="/runtime/netpoll.go.html#1873584">pd</a></span><span class="op" id="1873958">.</span><span class="ident" id="1873959">rt</span><span class="op" id="1873961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1873965"><a href="/runtime/netpoll.go.html#1873584">pd</a></span><span class="op" id="1873967">.</span><span class="ident" id="1873968">rt</span><span class="op" id="1873970">.</span><span class="ident" id="1873971">f</span>&nbsp;<span class="op" id="1873973">=</span>&nbsp;<span class="ident" id="1873975">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1873980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1873983">if</span>&nbsp;<span class="ident" id="1873986"><a href="/runtime/netpoll.go.html#1873584">pd</a></span><span class="op" id="1873988">.</span><span class="ident" id="1873989">wt</span><span class="op" id="1873991">.</span><span class="ident" id="1873992">f</span>&nbsp;<span class="op" id="1873994">!=</span>&nbsp;<span class="ident" id="1873997">nil</span>&nbsp;<span class="op" id="1874001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1874005"><a href="/runtime/time.go.html#1989531">deltimer</a></span><span class="op" id="1874013">(</span><span class="op" id="1874014">&amp;</span><span class="ident" id="1874015"><a href="/runtime/netpoll.go.html#1873584">pd</a></span><span class="op" id="1874017">.</span><span class="ident" id="1874018">wt</span><span class="op" id="1874020">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1874024"><a href="/runtime/netpoll.go.html#1873584">pd</a></span><span class="op" id="1874026">.</span><span class="ident" id="1874027">wt</span><span class="op" id="1874029">.</span><span class="ident" id="1874030">f</span>&nbsp;<span class="op" id="1874032">=</span>&nbsp;<span class="ident" id="1874034">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1874039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1874042"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1874048">(</span><span class="op" id="1874049">&amp;</span><span class="ident" id="1874050"><a href="/runtime/netpoll.go.html#1873584">pd</a></span><span class="op" id="1874052">.</span><span class="ident" id="1874053">lock</span><span class="op" id="1874057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1874060">if</span>&nbsp;<span class="ident" id="1874063"><a href="/runtime/netpoll.go.html#1873715">rg</a></span>&nbsp;<span class="op" id="1874066">!=</span>&nbsp;<span class="ident" id="1874069">nil</span>&nbsp;<span class="op" id="1874073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1874077"><a href="/runtime/proc.go.html#1903886">goready</a></span><span class="op" id="1874084">(</span><span class="ident" id="1874085"><a href="/runtime/netpoll.go.html#1873715">rg</a></span><span class="op" id="1874087">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1874090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1874093">if</span>&nbsp;<span class="ident" id="1874096"><a href="/runtime/netpoll.go.html#1873719">wg</a></span>&nbsp;<span class="op" id="1874099">!=</span>&nbsp;<span class="ident" id="1874102">nil</span>&nbsp;<span class="op" id="1874106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1874110"><a href="/runtime/proc.go.html#1903886">goready</a></span><span class="op" id="1874117">(</span><span class="ident" id="1874118"><a href="/runtime/netpoll.go.html#1873719">wg</a></span><span class="op" id="1874120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1874123">}</span><br>
<span class="lineno"></span><span class="op" id="1874125">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="1874128">func</span>&nbsp;<span class="ident" id="1874133">netpollfd</span><span class="op" id="1874142">(</span><span class="ident" id="1874143">pd</span>&nbsp;<span class="op" id="1874146">*</span><span class="ident" id="1874147"><a href="/runtime/netpoll.go.html#1868531">pollDesc</a></span><span class="op" id="1874155">)</span>&nbsp;<span class="builtintype" id="1874157">uintptr</span>&nbsp;<span class="op" id="1874165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1874168">return</span>&nbsp;<span class="ident" id="1874175"><a href="/runtime/netpoll.go.html#1874143">pd</a></span><span class="op" id="1874177">.</span><span class="ident" id="1874178">fd</span><br>
<span class="lineno"></span><span class="op" id="1874181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="1874184">func</span>&nbsp;<span class="ident" id="1874189">netpolluser</span><span class="op" id="1874200">(</span><span class="ident" id="1874201">pd</span>&nbsp;<span class="op" id="1874204">*</span><span class="ident" id="1874205"><a href="/runtime/netpoll.go.html#1868531">pollDesc</a></span><span class="op" id="1874213">)</span>&nbsp;<span class="op" id="1874215">*</span><span class="ident" id="1874216"><a href="/runtime/netpoll.go.html#1867109">unsafe</a></span><span class="op" id="1874222">.</span><span class="ident" id="1874223">Pointer</span>&nbsp;<span class="op" id="1874231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1874234">return</span>&nbsp;<span class="op" id="1874241">&amp;</span><span class="ident" id="1874242"><a href="/runtime/netpoll.go.html#1874201">pd</a></span><span class="op" id="1874244">.</span><span class="ident" id="1874245">user</span><br>
<span class="lineno"></span><span class="op" id="1874250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1874253">func</span>&nbsp;<span class="ident" id="1874258">netpollclosing</span><span class="op" id="1874272">(</span><span class="ident" id="1874273">pd</span>&nbsp;<span class="op" id="1874276">*</span><span class="ident" id="1874277"><a href="/runtime/netpoll.go.html#1868531">pollDesc</a></span><span class="op" id="1874285">)</span>&nbsp;<span class="builtintype" id="1874287">bool</span>&nbsp;<span class="op" id="1874292">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1874295">return</span>&nbsp;<span class="ident" id="1874302"><a href="/runtime/netpoll.go.html#1874273">pd</a></span><span class="op" id="1874304">.</span><span class="ident" id="1874305">closing</span><br>
<span class="lineno"></span><span class="op" id="1874313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1874316">func</span>&nbsp;<span class="ident" id="1874321">netpolllock</span><span class="op" id="1874332">(</span><span class="ident" id="1874333">pd</span>&nbsp;<span class="op" id="1874336">*</span><span class="ident" id="1874337"><a href="/runtime/netpoll.go.html#1868531">pollDesc</a></span><span class="op" id="1874345">)</span>&nbsp;<span class="op" id="1874347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1874350"><a href="/runtime/lock_futex.go.html#1815304">lock</a></span><span class="op" id="1874354">(</span><span class="op" id="1874355">&amp;</span><span class="ident" id="1874356"><a href="/runtime/netpoll.go.html#1874333">pd</a></span><span class="op" id="1874358">.</span><span class="ident" id="1874359">lock</span><span class="op" id="1874363">)</span><br>
<span class="lineno">280</span><span class="op" id="1874365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1874368">func</span>&nbsp;<span class="ident" id="1874373">netpollunlock</span><span class="op" id="1874386">(</span><span class="ident" id="1874387">pd</span>&nbsp;<span class="op" id="1874390">*</span><span class="ident" id="1874391"><a href="/runtime/netpoll.go.html#1868531">pollDesc</a></span><span class="op" id="1874399">)</span>&nbsp;<span class="op" id="1874401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1874404"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1874410">(</span><span class="op" id="1874411">&amp;</span><span class="ident" id="1874412"><a href="/runtime/netpoll.go.html#1874387">pd</a></span><span class="op" id="1874414">.</span><span class="ident" id="1874415">lock</span><span class="op" id="1874419">)</span><br>
<span class="lineno"></span><span class="op" id="1874421">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="comment" id="1874424">//&nbsp;make&nbsp;pd&nbsp;ready,&nbsp;newly&nbsp;runnable&nbsp;goroutines&nbsp;(if&nbsp;any)&nbsp;are&nbsp;returned&nbsp;in&nbsp;rg/wg</span><br>
<span class="lineno"></span><span class="keyword" id="1874499">func</span>&nbsp;<span class="ident" id="1874504">netpollready</span><span class="op" id="1874516">(</span><span class="ident" id="1874517">gpp</span>&nbsp;<span class="op" id="1874521">*</span><span class="op" id="1874522">*</span><span class="ident" id="1874523"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2017238">g</a></span><span class="op" id="1874524">,</span>&nbsp;<span class="ident" id="1874526">pd</span>&nbsp;<span class="op" id="1874529">*</span><span class="ident" id="1874530"><a href="/runtime/netpoll.go.html#1868531">pollDesc</a></span><span class="op" id="1874538">,</span>&nbsp;<span class="ident" id="1874540">mode</span>&nbsp;<span class="builtintype" id="1874545">int32</span><span class="op" id="1874550">)</span>&nbsp;<span class="op" id="1874552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1874555">var</span>&nbsp;<span class="ident" id="1874559">rg</span><span class="op" id="1874561">,</span>&nbsp;<span class="ident" id="1874563">wg</span>&nbsp;<span class="op" id="1874566">*</span><span class="ident" id="1874567"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2017238">g</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1874570">if</span>&nbsp;<span class="ident" id="1874573"><a href="/runtime/netpoll.go.html#1874540">mode</a></span>&nbsp;<span class="op" id="1874578">==</span>&nbsp;<span class="string" id="1874581">&#39;r&#39;</span>&nbsp;<span class="op" id="1874585">||</span>&nbsp;<span class="ident" id="1874588"><a href="/runtime/netpoll.go.html#1874540">mode</a></span>&nbsp;<span class="op" id="1874593">==</span>&nbsp;<span class="string" id="1874596">&#39;r&#39;</span><span class="op" id="1874599">+</span><span class="string" id="1874600">&#39;w&#39;</span>&nbsp;<span class="op" id="1874604">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1874608"><a href="/runtime/netpoll.go.html#1874559">rg</a></span>&nbsp;<span class="op" id="1874611">=</span>&nbsp;<span class="ident" id="1874613"><a href="/runtime/netpoll.go.html#1876177">netpollunblock</a></span><span class="op" id="1874627">(</span><span class="ident" id="1874628"><a href="/runtime/netpoll.go.html#1874526">pd</a></span><span class="op" id="1874630">,</span>&nbsp;<span class="string" id="1874632">&#39;r&#39;</span><span class="op" id="1874635">,</span>&nbsp;<span class="ident" id="1874637">true</span><span class="op" id="1874641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1874644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1874647">if</span>&nbsp;<span class="ident" id="1874650"><a href="/runtime/netpoll.go.html#1874540">mode</a></span>&nbsp;<span class="op" id="1874655">==</span>&nbsp;<span class="string" id="1874658">&#39;w&#39;</span>&nbsp;<span class="op" id="1874662">||</span>&nbsp;<span class="ident" id="1874665"><a href="/runtime/netpoll.go.html#1874540">mode</a></span>&nbsp;<span class="op" id="1874670">==</span>&nbsp;<span class="string" id="1874673">&#39;r&#39;</span><span class="op" id="1874676">+</span><span class="string" id="1874677">&#39;w&#39;</span>&nbsp;<span class="op" id="1874681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1874685"><a href="/runtime/netpoll.go.html#1874563">wg</a></span>&nbsp;<span class="op" id="1874688">=</span>&nbsp;<span class="ident" id="1874690"><a href="/runtime/netpoll.go.html#1876177">netpollunblock</a></span><span class="op" id="1874704">(</span><span class="ident" id="1874705"><a href="/runtime/netpoll.go.html#1874526">pd</a></span><span class="op" id="1874707">,</span>&nbsp;<span class="string" id="1874709">&#39;w&#39;</span><span class="op" id="1874712">,</span>&nbsp;<span class="ident" id="1874714">true</span><span class="op" id="1874718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1874721">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1874724">if</span>&nbsp;<span class="ident" id="1874727"><a href="/runtime/netpoll.go.html#1874559">rg</a></span>&nbsp;<span class="op" id="1874730">!=</span>&nbsp;<span class="ident" id="1874733">nil</span>&nbsp;<span class="op" id="1874737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1874741"><a href="/runtime/netpoll.go.html#1874559">rg</a></span><span class="op" id="1874743">.</span><span class="ident" id="1874744">schedlink</span>&nbsp;<span class="op" id="1874754">=</span>&nbsp;<span class="op" id="1874756">*</span><span class="ident" id="1874757"><a href="/runtime/netpoll.go.html#1874517">gpp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1874763">*</span><span class="ident" id="1874764"><a href="/runtime/netpoll.go.html#1874517">gpp</a></span>&nbsp;<span class="op" id="1874768">=</span>&nbsp;<span class="ident" id="1874770"><a href="/runtime/netpoll.go.html#1874559">rg</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1874774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1874777">if</span>&nbsp;<span class="ident" id="1874780"><a href="/runtime/netpoll.go.html#1874563">wg</a></span>&nbsp;<span class="op" id="1874783">!=</span>&nbsp;<span class="ident" id="1874786">nil</span>&nbsp;<span class="op" id="1874790">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1874794"><a href="/runtime/netpoll.go.html#1874563">wg</a></span><span class="op" id="1874796">.</span><span class="ident" id="1874797">schedlink</span>&nbsp;<span class="op" id="1874807">=</span>&nbsp;<span class="op" id="1874809">*</span><span class="ident" id="1874810"><a href="/runtime/netpoll.go.html#1874517">gpp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1874816">*</span><span class="ident" id="1874817"><a href="/runtime/netpoll.go.html#1874517">gpp</a></span>&nbsp;<span class="op" id="1874821">=</span>&nbsp;<span class="ident" id="1874823"><a href="/runtime/netpoll.go.html#1874563">wg</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1874827">}</span><br>
<span class="lineno"></span><span class="op" id="1874829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="keyword" id="1874832">func</span>&nbsp;<span class="ident" id="1874837">netpollcheckerr</span><span class="op" id="1874852">(</span><span class="ident" id="1874853">pd</span>&nbsp;<span class="op" id="1874856">*</span><span class="ident" id="1874857"><a href="/runtime/netpoll.go.html#1868531">pollDesc</a></span><span class="op" id="1874865">,</span>&nbsp;<span class="ident" id="1874867">mode</span>&nbsp;<span class="builtintype" id="1874872">int32</span><span class="op" id="1874877">)</span>&nbsp;<span class="builtintype" id="1874879">int</span>&nbsp;<span class="op" id="1874883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1874886">if</span>&nbsp;<span class="ident" id="1874889"><a href="/runtime/netpoll.go.html#1874853">pd</a></span><span class="op" id="1874891">.</span><span class="ident" id="1874892">closing</span>&nbsp;<span class="op" id="1874900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1874904">return</span>&nbsp;<span class="num" id="1874911">1</span>&nbsp;<span class="comment" id="1874913">//&nbsp;errClosing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1874928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1874931">if</span>&nbsp;<span class="op" id="1874934">(</span><span class="ident" id="1874935"><a href="/runtime/netpoll.go.html#1874867">mode</a></span>&nbsp;<span class="op" id="1874940">==</span>&nbsp;<span class="string" id="1874943">&#39;r&#39;</span>&nbsp;<span class="op" id="1874947">&amp;&amp;</span>&nbsp;<span class="ident" id="1874950"><a href="/runtime/netpoll.go.html#1874853">pd</a></span><span class="op" id="1874952">.</span><span class="ident" id="1874953">rd</span>&nbsp;<span class="op" id="1874956">&lt;</span>&nbsp;<span class="num" id="1874958">0</span><span class="op" id="1874959">)</span>&nbsp;<span class="op" id="1874961">||</span>&nbsp;<span class="op" id="1874964">(</span><span class="ident" id="1874965"><a href="/runtime/netpoll.go.html#1874867">mode</a></span>&nbsp;<span class="op" id="1874970">==</span>&nbsp;<span class="string" id="1874973">&#39;w&#39;</span>&nbsp;<span class="op" id="1874977">&amp;&amp;</span>&nbsp;<span class="ident" id="1874980"><a href="/runtime/netpoll.go.html#1874853">pd</a></span><span class="op" id="1874982">.</span><span class="ident" id="1874983">wd</span>&nbsp;<span class="op" id="1874986">&lt;</span>&nbsp;<span class="num" id="1874988">0</span><span class="op" id="1874989">)</span>&nbsp;<span class="op" id="1874991">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1874995">return</span>&nbsp;<span class="num" id="1875002">2</span>&nbsp;<span class="comment" id="1875004">//&nbsp;errTimeout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1875019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1875022">return</span>&nbsp;<span class="num" id="1875029">0</span><br>
<span class="lineno"></span><span class="op" id="1875031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="1875034">func</span>&nbsp;<span class="ident" id="1875039">netpollblockcommit</span><span class="op" id="1875057">(</span><span class="ident" id="1875058">gp</span>&nbsp;<span class="op" id="1875061">*</span><span class="ident" id="1875062"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2017238">g</a></span><span class="op" id="1875063">,</span>&nbsp;<span class="ident" id="1875065">gpp</span>&nbsp;<span class="ident" id="1875069"><a href="/runtime/netpoll.go.html#1867109">unsafe</a></span><span class="op" id="1875075">.</span><span class="ident" id="1875076">Pointer</span><span class="op" id="1875083">)</span>&nbsp;<span class="builtintype" id="1875085">bool</span>&nbsp;<span class="op" id="1875090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1875093">return</span>&nbsp;<span class="ident" id="1875100"><a href="/runtime/stubs.go.html#1974846">casuintptr</a></span><span class="op" id="1875110">(</span><span class="op" id="1875111">(</span><span class="op" id="1875112">*</span><span class="builtintype" id="1875113">uintptr</span><span class="op" id="1875120">)</span><span class="op" id="1875121">(</span><span class="ident" id="1875122"><a href="/runtime/netpoll.go.html#1875065">gpp</a></span><span class="op" id="1875125">)</span><span class="op" id="1875126">,</span>&nbsp;<span class="ident" id="1875128"><a href="/runtime/netpoll.go.html#1868441">pdWait</a></span><span class="op" id="1875134">,</span>&nbsp;<span class="builtintype" id="1875136">uintptr</span><span class="op" id="1875143">(</span><span class="ident" id="1875144"><a href="/runtime/netpoll.go.html#1867109">unsafe</a></span><span class="op" id="1875150">.</span><span class="ident" id="1875151">Pointer</span><span class="op" id="1875158">(</span><span class="ident" id="1875159"><a href="/runtime/netpoll.go.html#1875058">gp</a></span><span class="op" id="1875161">)</span><span class="op" id="1875162">)</span><span class="op" id="1875163">)</span><br>
<span class="lineno"></span><span class="op" id="1875165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1875168">//&nbsp;returns&nbsp;true&nbsp;if&nbsp;IO&nbsp;is&nbsp;ready,&nbsp;or&nbsp;false&nbsp;if&nbsp;timedout&nbsp;or&nbsp;closed</span><br>
<span class="lineno">320</span><span class="comment" id="1875231">//&nbsp;waitio&nbsp;-&nbsp;wait&nbsp;only&nbsp;for&nbsp;completed&nbsp;IO,&nbsp;ignore&nbsp;errors</span><br>
<span class="lineno"></span><span class="keyword" id="1875285">func</span>&nbsp;<span class="ident" id="1875290">netpollblock</span><span class="op" id="1875302">(</span><span class="ident" id="1875303">pd</span>&nbsp;<span class="op" id="1875306">*</span><span class="ident" id="1875307"><a href="/runtime/netpoll.go.html#1868531">pollDesc</a></span><span class="op" id="1875315">,</span>&nbsp;<span class="ident" id="1875317">mode</span>&nbsp;<span class="builtintype" id="1875322">int32</span><span class="op" id="1875327">,</span>&nbsp;<span class="ident" id="1875329">waitio</span>&nbsp;<span class="builtintype" id="1875336">bool</span><span class="op" id="1875340">)</span>&nbsp;<span class="builtintype" id="1875342">bool</span>&nbsp;<span class="op" id="1875347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1875350">gpp</span>&nbsp;<span class="op" id="1875354">:=</span>&nbsp;<span class="op" id="1875357">&amp;</span><span class="ident" id="1875358"><a href="/runtime/netpoll.go.html#1875303">pd</a></span><span class="op" id="1875360">.</span><span class="ident" id="1875361">rg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1875365">if</span>&nbsp;<span class="ident" id="1875368"><a href="/runtime/netpoll.go.html#1875317">mode</a></span>&nbsp;<span class="op" id="1875373">==</span>&nbsp;<span class="string" id="1875376">&#39;w&#39;</span>&nbsp;<span class="op" id="1875380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1875384"><a href="/runtime/netpoll.go.html#1875350">gpp</a></span>&nbsp;<span class="op" id="1875388">=</span>&nbsp;<span class="op" id="1875390">&amp;</span><span class="ident" id="1875391"><a href="/runtime/netpoll.go.html#1875303">pd</a></span><span class="op" id="1875393">.</span><span class="ident" id="1875394">wg</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1875398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1875402">//&nbsp;set&nbsp;the&nbsp;gpp&nbsp;semaphore&nbsp;to&nbsp;WAIT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1875436">for</span>&nbsp;<span class="op" id="1875440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1875444">old</span>&nbsp;<span class="op" id="1875448">:=</span>&nbsp;<span class="op" id="1875451">*</span><span class="ident" id="1875452"><a href="/runtime/netpoll.go.html#1875350">gpp</a></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1875458">if</span>&nbsp;<span class="ident" id="1875461"><a href="/runtime/netpoll.go.html#1875444">old</a></span>&nbsp;<span class="op" id="1875465">==</span>&nbsp;<span class="ident" id="1875468"><a href="/runtime/netpoll.go.html#1868420">pdReady</a></span>&nbsp;<span class="op" id="1875476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1875481">*</span><span class="ident" id="1875482"><a href="/runtime/netpoll.go.html#1875350">gpp</a></span>&nbsp;<span class="op" id="1875486">=</span>&nbsp;<span class="num" id="1875488">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1875493">return</span>&nbsp;<span class="ident" id="1875500">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1875507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1875511">if</span>&nbsp;<span class="ident" id="1875514"><a href="/runtime/netpoll.go.html#1875444">old</a></span>&nbsp;<span class="op" id="1875518">!=</span>&nbsp;<span class="num" id="1875521">0</span>&nbsp;<span class="op" id="1875523">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1875528"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1875535">(</span><span class="string" id="1875536">&#34;netpollblock:&nbsp;double&nbsp;wait&#34;</span><span class="op" id="1875563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1875567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1875571">if</span>&nbsp;<span class="ident" id="1875574"><a href="/runtime/stubs.go.html#1974846">casuintptr</a></span><span class="op" id="1875584">(</span><span class="ident" id="1875585"><a href="/runtime/netpoll.go.html#1875350">gpp</a></span><span class="op" id="1875588">,</span>&nbsp;<span class="num" id="1875590">0</span><span class="op" id="1875591">,</span>&nbsp;<span class="ident" id="1875593"><a href="/runtime/netpoll.go.html#1868441">pdWait</a></span><span class="op" id="1875599">)</span>&nbsp;<span class="op" id="1875601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1875606">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1875614">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1875617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1875621">//&nbsp;need&nbsp;to&nbsp;recheck&nbsp;error&nbsp;states&nbsp;after&nbsp;setting&nbsp;gpp&nbsp;to&nbsp;WAIT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1875680">//&nbsp;this&nbsp;is&nbsp;necessary&nbsp;because&nbsp;runtime_pollUnblock/runtime_pollSetDeadline/deadlineimpl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1875767">//&nbsp;do&nbsp;the&nbsp;opposite:&nbsp;store&nbsp;to&nbsp;closing/rd/wd,&nbsp;membarrier,&nbsp;load&nbsp;of&nbsp;rg/wg</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1875838">if</span>&nbsp;<span class="ident" id="1875841"><a href="/runtime/netpoll.go.html#1875329">waitio</a></span>&nbsp;<span class="op" id="1875848">||</span>&nbsp;<span class="ident" id="1875851"><a href="/runtime/netpoll.go.html#1874837">netpollcheckerr</a></span><span class="op" id="1875866">(</span><span class="ident" id="1875867"><a href="/runtime/netpoll.go.html#1875303">pd</a></span><span class="op" id="1875869">,</span>&nbsp;<span class="ident" id="1875871"><a href="/runtime/netpoll.go.html#1875317">mode</a></span><span class="op" id="1875875">)</span>&nbsp;<span class="op" id="1875877">==</span>&nbsp;<span class="num" id="1875880">0</span>&nbsp;<span class="op" id="1875882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1875886">f</span>&nbsp;<span class="op" id="1875888">:=</span>&nbsp;<span class="ident" id="1875891"><a href="/runtime/netpoll.go.html#1875039">netpollblockcommit</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1875912"><a href="/runtime/proc.go.html#1903238">gopark</a></span><span class="op" id="1875918">(</span><span class="op" id="1875919">*</span><span class="op" id="1875920">*</span><span class="op" id="1875921">(</span><span class="op" id="1875922">*</span><span class="op" id="1875923">*</span><span class="ident" id="1875924"><a href="/runtime/netpoll.go.html#1867109">unsafe</a></span><span class="op" id="1875930">.</span><span class="ident" id="1875931">Pointer</span><span class="op" id="1875938">)</span><span class="op" id="1875939">(</span><span class="ident" id="1875940"><a href="/runtime/netpoll.go.html#1867109">unsafe</a></span><span class="op" id="1875946">.</span><span class="ident" id="1875947">Pointer</span><span class="op" id="1875954">(</span><span class="op" id="1875955">&amp;</span><span class="ident" id="1875956"><a href="/runtime/netpoll.go.html#1875886">f</a></span><span class="op" id="1875957">)</span><span class="op" id="1875958">)</span><span class="op" id="1875959">,</span>&nbsp;<span class="ident" id="1875961"><a href="/runtime/netpoll.go.html#1867109">unsafe</a></span><span class="op" id="1875967">.</span><span class="ident" id="1875968">Pointer</span><span class="op" id="1875975">(</span><span class="ident" id="1875976"><a href="/runtime/netpoll.go.html#1875350">gpp</a></span><span class="op" id="1875979">)</span><span class="op" id="1875980">,</span>&nbsp;<span class="string" id="1875982">&#34;IO&nbsp;wait&#34;</span><span class="op" id="1875991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1875994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1875997">//&nbsp;be&nbsp;careful&nbsp;to&nbsp;not&nbsp;lose&nbsp;concurrent&nbsp;READY&nbsp;notification</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1876054">old</span>&nbsp;<span class="op" id="1876058">:=</span>&nbsp;<span class="ident" id="1876061"><a href="/runtime/atomic.go.html#1711230">xchguintptr</a></span><span class="op" id="1876072">(</span><span class="ident" id="1876073"><a href="/runtime/netpoll.go.html#1875350">gpp</a></span><span class="op" id="1876076">,</span>&nbsp;<span class="num" id="1876078">0</span><span class="op" id="1876079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1876082">if</span>&nbsp;<span class="ident" id="1876085"><a href="/runtime/netpoll.go.html#1876054">old</a></span>&nbsp;<span class="op" id="1876089">&gt;</span>&nbsp;<span class="ident" id="1876091"><a href="/runtime/netpoll.go.html#1868441">pdWait</a></span>&nbsp;<span class="op" id="1876098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1876102"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1876109">(</span><span class="string" id="1876110">&#34;netpollblock:&nbsp;corrupted&nbsp;state&#34;</span><span class="op" id="1876141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1876144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1876147">return</span>&nbsp;<span class="ident" id="1876154"><a href="/runtime/netpoll.go.html#1876054">old</a></span>&nbsp;<span class="op" id="1876158">==</span>&nbsp;<span class="ident" id="1876161"><a href="/runtime/netpoll.go.html#1868420">pdReady</a></span><br>
<span class="lineno">355</span><span class="op" id="1876169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1876172">func</span>&nbsp;<span class="ident" id="1876177">netpollunblock</span><span class="op" id="1876191">(</span><span class="ident" id="1876192">pd</span>&nbsp;<span class="op" id="1876195">*</span><span class="ident" id="1876196"><a href="/runtime/netpoll.go.html#1868531">pollDesc</a></span><span class="op" id="1876204">,</span>&nbsp;<span class="ident" id="1876206">mode</span>&nbsp;<span class="builtintype" id="1876211">int32</span><span class="op" id="1876216">,</span>&nbsp;<span class="ident" id="1876218">ioready</span>&nbsp;<span class="builtintype" id="1876226">bool</span><span class="op" id="1876230">)</span>&nbsp;<span class="op" id="1876232">*</span><span class="ident" id="1876233"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2017238">g</a></span>&nbsp;<span class="op" id="1876235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1876238">gpp</span>&nbsp;<span class="op" id="1876242">:=</span>&nbsp;<span class="op" id="1876245">&amp;</span><span class="ident" id="1876246"><a href="/runtime/netpoll.go.html#1876192">pd</a></span><span class="op" id="1876248">.</span><span class="ident" id="1876249">rg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1876253">if</span>&nbsp;<span class="ident" id="1876256"><a href="/runtime/netpoll.go.html#1876206">mode</a></span>&nbsp;<span class="op" id="1876261">==</span>&nbsp;<span class="string" id="1876264">&#39;w&#39;</span>&nbsp;<span class="op" id="1876268">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1876272"><a href="/runtime/netpoll.go.html#1876238">gpp</a></span>&nbsp;<span class="op" id="1876276">=</span>&nbsp;<span class="op" id="1876278">&amp;</span><span class="ident" id="1876279"><a href="/runtime/netpoll.go.html#1876192">pd</a></span><span class="op" id="1876281">.</span><span class="ident" id="1876282">wg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1876286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1876290">for</span>&nbsp;<span class="op" id="1876294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1876298">old</span>&nbsp;<span class="op" id="1876302">:=</span>&nbsp;<span class="op" id="1876305">*</span><span class="ident" id="1876306"><a href="/runtime/netpoll.go.html#1876238">gpp</a></span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1876312">if</span>&nbsp;<span class="ident" id="1876315"><a href="/runtime/netpoll.go.html#1876298">old</a></span>&nbsp;<span class="op" id="1876319">==</span>&nbsp;<span class="ident" id="1876322"><a href="/runtime/netpoll.go.html#1868420">pdReady</a></span>&nbsp;<span class="op" id="1876330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1876335">return</span>&nbsp;<span class="ident" id="1876342">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1876348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1876352">if</span>&nbsp;<span class="ident" id="1876355"><a href="/runtime/netpoll.go.html#1876298">old</a></span>&nbsp;<span class="op" id="1876359">==</span>&nbsp;<span class="num" id="1876362">0</span>&nbsp;<span class="op" id="1876364">&amp;&amp;</span>&nbsp;<span class="op" id="1876367">!</span><span class="ident" id="1876368"><a href="/runtime/netpoll.go.html#1876218">ioready</a></span>&nbsp;<span class="op" id="1876376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1876381">//&nbsp;Only&nbsp;set&nbsp;READY&nbsp;for&nbsp;ioready.&nbsp;runtime_pollWait</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1876432">//&nbsp;will&nbsp;check&nbsp;for&nbsp;timeout/cancel&nbsp;before&nbsp;waiting.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1876484">return</span>&nbsp;<span class="ident" id="1876491">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1876497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1876501">var</span>&nbsp;<span class="builtinfunc" id="1876505">new</span>&nbsp;<span class="builtintype" id="1876509">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1876519">if</span>&nbsp;<span class="ident" id="1876522"><a href="/runtime/netpoll.go.html#1876218">ioready</a></span>&nbsp;<span class="op" id="1876530">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1876535"><a href="/runtime/netpoll.go.html#1876505">new</a></span>&nbsp;<span class="op" id="1876539">=</span>&nbsp;<span class="ident" id="1876541"><a href="/runtime/netpoll.go.html#1868420">pdReady</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1876551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1876555">if</span>&nbsp;<span class="ident" id="1876558"><a href="/runtime/stubs.go.html#1974846">casuintptr</a></span><span class="op" id="1876568">(</span><span class="ident" id="1876569"><a href="/runtime/netpoll.go.html#1876238">gpp</a></span><span class="op" id="1876572">,</span>&nbsp;<span class="ident" id="1876574"><a href="/runtime/netpoll.go.html#1876298">old</a></span><span class="op" id="1876577">,</span>&nbsp;<span class="builtinfunc" id="1876579"><a href="/runtime/netpoll.go.html#1876505">new</a></span><span class="op" id="1876582">)</span>&nbsp;<span class="op" id="1876584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1876589">if</span>&nbsp;<span class="ident" id="1876592"><a href="/runtime/netpoll.go.html#1876298">old</a></span>&nbsp;<span class="op" id="1876596">==</span>&nbsp;<span class="ident" id="1876599"><a href="/runtime/netpoll.go.html#1868420">pdReady</a></span>&nbsp;<span class="op" id="1876607">||</span>&nbsp;<span class="ident" id="1876610"><a href="/runtime/netpoll.go.html#1876298">old</a></span>&nbsp;<span class="op" id="1876614">==</span>&nbsp;<span class="ident" id="1876617"><a href="/runtime/netpoll.go.html#1868441">pdWait</a></span>&nbsp;<span class="op" id="1876624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1876630"><a href="/runtime/netpoll.go.html#1876298">old</a></span>&nbsp;<span class="op" id="1876634">=</span>&nbsp;<span class="num" id="1876636">0</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1876641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1876646">return</span>&nbsp;<span class="op" id="1876653">(</span><span class="op" id="1876654">*</span><span class="ident" id="1876655"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2017238">g</a></span><span class="op" id="1876656">)</span><span class="op" id="1876657">(</span><span class="ident" id="1876658"><a href="/runtime/netpoll.go.html#1867109">unsafe</a></span><span class="op" id="1876664">.</span><span class="ident" id="1876665">Pointer</span><span class="op" id="1876672">(</span><span class="ident" id="1876673"><a href="/runtime/netpoll.go.html#1876298">old</a></span><span class="op" id="1876676">)</span><span class="op" id="1876677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1876681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1876684">}</span><br>
<span class="lineno"></span><span class="op" id="1876686">}</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span><span class="keyword" id="1876689">func</span>&nbsp;<span class="ident" id="1876694">netpolldeadlineimpl</span><span class="op" id="1876713">(</span><span class="ident" id="1876714">pd</span>&nbsp;<span class="op" id="1876717">*</span><span class="ident" id="1876718"><a href="/runtime/netpoll.go.html#1868531">pollDesc</a></span><span class="op" id="1876726">,</span>&nbsp;<span class="ident" id="1876728">seq</span>&nbsp;<span class="builtintype" id="1876732">uintptr</span><span class="op" id="1876739">,</span>&nbsp;<span class="ident" id="1876741">read</span><span class="op" id="1876745">,</span>&nbsp;<span class="ident" id="1876747">write</span>&nbsp;<span class="builtintype" id="1876753">bool</span><span class="op" id="1876757">)</span>&nbsp;<span class="op" id="1876759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1876762"><a href="/runtime/lock_futex.go.html#1815304">lock</a></span><span class="op" id="1876766">(</span><span class="op" id="1876767">&amp;</span><span class="ident" id="1876768"><a href="/runtime/netpoll.go.html#1876714">pd</a></span><span class="op" id="1876770">.</span><span class="ident" id="1876771">lock</span><span class="op" id="1876775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1876778">//&nbsp;Seq&nbsp;arg&nbsp;is&nbsp;seq&nbsp;when&nbsp;the&nbsp;timer&nbsp;was&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1876821">//&nbsp;If&nbsp;it&#39;s&nbsp;stale,&nbsp;ignore&nbsp;the&nbsp;timer&nbsp;event.</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1876864">if</span>&nbsp;<span class="ident" id="1876867"><a href="/runtime/netpoll.go.html#1876728">seq</a></span>&nbsp;<span class="op" id="1876871">!=</span>&nbsp;<span class="ident" id="1876874"><a href="/runtime/netpoll.go.html#1876714">pd</a></span><span class="op" id="1876876">.</span><span class="ident" id="1876877">seq</span>&nbsp;<span class="op" id="1876881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1876885">//&nbsp;The&nbsp;descriptor&nbsp;was&nbsp;reused&nbsp;or&nbsp;timers&nbsp;were&nbsp;reset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1876938"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1876944">(</span><span class="op" id="1876945">&amp;</span><span class="ident" id="1876946"><a href="/runtime/netpoll.go.html#1876714">pd</a></span><span class="op" id="1876948">.</span><span class="ident" id="1876949">lock</span><span class="op" id="1876953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1876957">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1876965">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1876968">var</span>&nbsp;<span class="ident" id="1876972">rg</span>&nbsp;<span class="op" id="1876975">*</span><span class="ident" id="1876976"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2017238">g</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1876979">if</span>&nbsp;<span class="ident" id="1876982"><a href="/runtime/netpoll.go.html#1876741">read</a></span>&nbsp;<span class="op" id="1876987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1876991">if</span>&nbsp;<span class="ident" id="1876994"><a href="/runtime/netpoll.go.html#1876714">pd</a></span><span class="op" id="1876996">.</span><span class="ident" id="1876997">rd</span>&nbsp;<span class="op" id="1877000">&lt;=</span>&nbsp;<span class="num" id="1877003">0</span>&nbsp;<span class="op" id="1877005">||</span>&nbsp;<span class="ident" id="1877008"><a href="/runtime/netpoll.go.html#1876714">pd</a></span><span class="op" id="1877010">.</span><span class="ident" id="1877011">rt</span><span class="op" id="1877013">.</span><span class="ident" id="1877014">f</span>&nbsp;<span class="op" id="1877016">==</span>&nbsp;<span class="ident" id="1877019">nil</span>&nbsp;<span class="op" id="1877023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1877028"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1877035">(</span><span class="string" id="1877036">&#34;netpolldeadlineimpl:&nbsp;inconsistent&nbsp;read&nbsp;deadline&#34;</span><span class="op" id="1877085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1877089">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1877093"><a href="/runtime/netpoll.go.html#1876714">pd</a></span><span class="op" id="1877095">.</span><span class="ident" id="1877096">rd</span>&nbsp;<span class="op" id="1877099">=</span>&nbsp;<span class="op" id="1877101">-</span><span class="num" id="1877102">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1877106"><a href="/runtime/atomic.go.html#1711698">atomicstorep</a></span><span class="op" id="1877118">(</span><span class="ident" id="1877119"><a href="/runtime/netpoll.go.html#1867109">unsafe</a></span><span class="op" id="1877125">.</span><span class="ident" id="1877126">Pointer</span><span class="op" id="1877133">(</span><span class="op" id="1877134">&amp;</span><span class="ident" id="1877135"><a href="/runtime/netpoll.go.html#1876714">pd</a></span><span class="op" id="1877137">.</span><span class="ident" id="1877138">rt</span><span class="op" id="1877140">.</span><span class="ident" id="1877141">f</span><span class="op" id="1877142">)</span><span class="op" id="1877143">,</span>&nbsp;<span class="ident" id="1877145">nil</span><span class="op" id="1877148">)</span>&nbsp;<span class="comment" id="1877150">//&nbsp;full&nbsp;memory&nbsp;barrier&nbsp;between&nbsp;store&nbsp;to&nbsp;rd&nbsp;and&nbsp;load&nbsp;of&nbsp;rg&nbsp;in&nbsp;netpollunblock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1877228"><a href="/runtime/netpoll.go.html#1876972">rg</a></span>&nbsp;<span class="op" id="1877231">=</span>&nbsp;<span class="ident" id="1877233"><a href="/runtime/netpoll.go.html#1876177">netpollunblock</a></span><span class="op" id="1877247">(</span><span class="ident" id="1877248"><a href="/runtime/netpoll.go.html#1876714">pd</a></span><span class="op" id="1877250">,</span>&nbsp;<span class="string" id="1877252">&#39;r&#39;</span><span class="op" id="1877255">,</span>&nbsp;<span class="ident" id="1877257">false</span><span class="op" id="1877262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1877265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1877268">var</span>&nbsp;<span class="ident" id="1877272">wg</span>&nbsp;<span class="op" id="1877275">*</span><span class="ident" id="1877276"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2017238">g</a></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1877279">if</span>&nbsp;<span class="ident" id="1877282"><a href="/runtime/netpoll.go.html#1876747">write</a></span>&nbsp;<span class="op" id="1877288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1877292">if</span>&nbsp;<span class="ident" id="1877295"><a href="/runtime/netpoll.go.html#1876714">pd</a></span><span class="op" id="1877297">.</span><span class="ident" id="1877298">wd</span>&nbsp;<span class="op" id="1877301">&lt;=</span>&nbsp;<span class="num" id="1877304">0</span>&nbsp;<span class="op" id="1877306">||</span>&nbsp;<span class="ident" id="1877309"><a href="/runtime/netpoll.go.html#1876714">pd</a></span><span class="op" id="1877311">.</span><span class="ident" id="1877312">wt</span><span class="op" id="1877314">.</span><span class="ident" id="1877315">f</span>&nbsp;<span class="op" id="1877317">==</span>&nbsp;<span class="ident" id="1877320">nil</span>&nbsp;<span class="op" id="1877324">&amp;&amp;</span>&nbsp;<span class="op" id="1877327">!</span><span class="ident" id="1877328"><a href="/runtime/netpoll.go.html#1876741">read</a></span>&nbsp;<span class="op" id="1877333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1877338"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1877345">(</span><span class="string" id="1877346">&#34;netpolldeadlineimpl:&nbsp;inconsistent&nbsp;write&nbsp;deadline&#34;</span><span class="op" id="1877396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1877400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1877404"><a href="/runtime/netpoll.go.html#1876714">pd</a></span><span class="op" id="1877406">.</span><span class="ident" id="1877407">wd</span>&nbsp;<span class="op" id="1877410">=</span>&nbsp;<span class="op" id="1877412">-</span><span class="num" id="1877413">1</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1877417"><a href="/runtime/atomic.go.html#1711698">atomicstorep</a></span><span class="op" id="1877429">(</span><span class="ident" id="1877430"><a href="/runtime/netpoll.go.html#1867109">unsafe</a></span><span class="op" id="1877436">.</span><span class="ident" id="1877437">Pointer</span><span class="op" id="1877444">(</span><span class="op" id="1877445">&amp;</span><span class="ident" id="1877446"><a href="/runtime/netpoll.go.html#1876714">pd</a></span><span class="op" id="1877448">.</span><span class="ident" id="1877449">wt</span><span class="op" id="1877451">.</span><span class="ident" id="1877452">f</span><span class="op" id="1877453">)</span><span class="op" id="1877454">,</span>&nbsp;<span class="ident" id="1877456">nil</span><span class="op" id="1877459">)</span>&nbsp;<span class="comment" id="1877461">//&nbsp;full&nbsp;memory&nbsp;barrier&nbsp;between&nbsp;store&nbsp;to&nbsp;wd&nbsp;and&nbsp;load&nbsp;of&nbsp;wg&nbsp;in&nbsp;netpollunblock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1877539"><a href="/runtime/netpoll.go.html#1877272">wg</a></span>&nbsp;<span class="op" id="1877542">=</span>&nbsp;<span class="ident" id="1877544"><a href="/runtime/netpoll.go.html#1876177">netpollunblock</a></span><span class="op" id="1877558">(</span><span class="ident" id="1877559"><a href="/runtime/netpoll.go.html#1876714">pd</a></span><span class="op" id="1877561">,</span>&nbsp;<span class="string" id="1877563">&#39;w&#39;</span><span class="op" id="1877566">,</span>&nbsp;<span class="ident" id="1877568">false</span><span class="op" id="1877573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1877576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1877579"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1877585">(</span><span class="op" id="1877586">&amp;</span><span class="ident" id="1877587"><a href="/runtime/netpoll.go.html#1876714">pd</a></span><span class="op" id="1877589">.</span><span class="ident" id="1877590">lock</span><span class="op" id="1877594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1877597">if</span>&nbsp;<span class="ident" id="1877600"><a href="/runtime/netpoll.go.html#1876972">rg</a></span>&nbsp;<span class="op" id="1877603">!=</span>&nbsp;<span class="ident" id="1877606">nil</span>&nbsp;<span class="op" id="1877610">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1877614"><a href="/runtime/proc.go.html#1903886">goready</a></span><span class="op" id="1877621">(</span><span class="ident" id="1877622"><a href="/runtime/netpoll.go.html#1876972">rg</a></span><span class="op" id="1877624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1877627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1877630">if</span>&nbsp;<span class="ident" id="1877633"><a href="/runtime/netpoll.go.html#1877272">wg</a></span>&nbsp;<span class="op" id="1877636">!=</span>&nbsp;<span class="ident" id="1877639">nil</span>&nbsp;<span class="op" id="1877643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1877647"><a href="/runtime/proc.go.html#1903886">goready</a></span><span class="op" id="1877654">(</span><span class="ident" id="1877655"><a href="/runtime/netpoll.go.html#1877272">wg</a></span><span class="op" id="1877657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1877660">}</span><br>
<span class="lineno">420</span><span class="op" id="1877662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1877665">func</span>&nbsp;<span class="ident" id="1877670">netpollDeadline</span><span class="op" id="1877685">(</span><span class="ident" id="1877686">arg</span>&nbsp;<span class="keyword" id="1877690">interface</span><span class="op" id="1877699">{</span><span class="op" id="1877700">}</span><span class="op" id="1877701">,</span>&nbsp;<span class="ident" id="1877703">seq</span>&nbsp;<span class="builtintype" id="1877707">uintptr</span><span class="op" id="1877714">)</span>&nbsp;<span class="op" id="1877716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1877719"><a href="/runtime/netpoll.go.html#1876694">netpolldeadlineimpl</a></span><span class="op" id="1877738">(</span><span class="ident" id="1877739"><a href="/runtime/netpoll.go.html#1877686">arg</a></span><span class="op" id="1877742">.</span><span class="op" id="1877743">(</span><span class="op" id="1877744">*</span><span class="ident" id="1877745"><a href="/runtime/netpoll.go.html#1868531">pollDesc</a></span><span class="op" id="1877753">)</span><span class="op" id="1877754">,</span>&nbsp;<span class="ident" id="1877756"><a href="/runtime/netpoll.go.html#1877703">seq</a></span><span class="op" id="1877759">,</span>&nbsp;<span class="ident" id="1877761">true</span><span class="op" id="1877765">,</span>&nbsp;<span class="ident" id="1877767">true</span><span class="op" id="1877771">)</span><br>
<span class="lineno"></span><span class="op" id="1877773">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="keyword" id="1877776">func</span>&nbsp;<span class="ident" id="1877781">netpollReadDeadline</span><span class="op" id="1877800">(</span><span class="ident" id="1877801">arg</span>&nbsp;<span class="keyword" id="1877805">interface</span><span class="op" id="1877814">{</span><span class="op" id="1877815">}</span><span class="op" id="1877816">,</span>&nbsp;<span class="ident" id="1877818">seq</span>&nbsp;<span class="builtintype" id="1877822">uintptr</span><span class="op" id="1877829">)</span>&nbsp;<span class="op" id="1877831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1877834"><a href="/runtime/netpoll.go.html#1876694">netpolldeadlineimpl</a></span><span class="op" id="1877853">(</span><span class="ident" id="1877854"><a href="/runtime/netpoll.go.html#1877801">arg</a></span><span class="op" id="1877857">.</span><span class="op" id="1877858">(</span><span class="op" id="1877859">*</span><span class="ident" id="1877860"><a href="/runtime/netpoll.go.html#1868531">pollDesc</a></span><span class="op" id="1877868">)</span><span class="op" id="1877869">,</span>&nbsp;<span class="ident" id="1877871"><a href="/runtime/netpoll.go.html#1877818">seq</a></span><span class="op" id="1877874">,</span>&nbsp;<span class="ident" id="1877876">true</span><span class="op" id="1877880">,</span>&nbsp;<span class="ident" id="1877882">false</span><span class="op" id="1877887">)</span><br>
<span class="lineno"></span><span class="op" id="1877889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="1877892">func</span>&nbsp;<span class="ident" id="1877897">netpollWriteDeadline</span><span class="op" id="1877917">(</span><span class="ident" id="1877918">arg</span>&nbsp;<span class="keyword" id="1877922">interface</span><span class="op" id="1877931">{</span><span class="op" id="1877932">}</span><span class="op" id="1877933">,</span>&nbsp;<span class="ident" id="1877935">seq</span>&nbsp;<span class="builtintype" id="1877939">uintptr</span><span class="op" id="1877946">)</span>&nbsp;<span class="op" id="1877948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1877951"><a href="/runtime/netpoll.go.html#1876694">netpolldeadlineimpl</a></span><span class="op" id="1877970">(</span><span class="ident" id="1877971"><a href="/runtime/netpoll.go.html#1877918">arg</a></span><span class="op" id="1877974">.</span><span class="op" id="1877975">(</span><span class="op" id="1877976">*</span><span class="ident" id="1877977"><a href="/runtime/netpoll.go.html#1868531">pollDesc</a></span><span class="op" id="1877985">)</span><span class="op" id="1877986">,</span>&nbsp;<span class="ident" id="1877988"><a href="/runtime/netpoll.go.html#1877935">seq</a></span><span class="op" id="1877991">,</span>&nbsp;<span class="ident" id="1877993">false</span><span class="op" id="1877998">,</span>&nbsp;<span class="ident" id="1878000">true</span><span class="op" id="1878004">)</span><br>
<span class="lineno"></span><span class="op" id="1878006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1878009">func</span>&nbsp;<span class="op" id="1878014">(</span><span class="ident" id="1878015">c</span>&nbsp;<span class="op" id="1878017">*</span><span class="ident" id="1878018"><a href="/runtime/netpoll.go.html#1869694">pollCache</a></span><span class="op" id="1878027">)</span>&nbsp;<span class="ident" id="1878029">alloc</span><span class="op" id="1878034">(</span><span class="op" id="1878035">)</span>&nbsp;<span class="op" id="1878037">*</span><span class="ident" id="1878038"><a href="/runtime/netpoll.go.html#1868531">pollDesc</a></span>&nbsp;<span class="op" id="1878047">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1878050"><a href="/runtime/lock_futex.go.html#1815304">lock</a></span><span class="op" id="1878054">(</span><span class="op" id="1878055">&amp;</span><span class="ident" id="1878056"><a href="/runtime/netpoll.go.html#1878015">c</a></span><span class="op" id="1878057">.</span><span class="ident" id="1878058">lock</span><span class="op" id="1878062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1878065">if</span>&nbsp;<span class="ident" id="1878068"><a href="/runtime/netpoll.go.html#1878015">c</a></span><span class="op" id="1878069">.</span><span class="ident" id="1878070">first</span>&nbsp;<span class="op" id="1878076">==</span>&nbsp;<span class="ident" id="1878079">nil</span>&nbsp;<span class="op" id="1878083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1878087">const</span>&nbsp;<span class="ident" id="1878093">pdSize</span>&nbsp;<span class="op" id="1878100">=</span>&nbsp;<span class="ident" id="1878102"><a href="/runtime/netpoll.go.html#1867109">unsafe</a></span><span class="op" id="1878108">.</span><span class="ident" id="1878109">Sizeof</span><span class="op" id="1878115">(</span><span class="ident" id="1878116"><a href="/runtime/netpoll.go.html#1868531">pollDesc</a></span><span class="op" id="1878124">{</span><span class="op" id="1878125">}</span><span class="op" id="1878126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1878130">n</span>&nbsp;<span class="op" id="1878132">:=</span>&nbsp;<span class="ident" id="1878135"><a href="/runtime/netpoll.go.html#1868470">pollBlockSize</a></span>&nbsp;<span class="op" id="1878149">/</span>&nbsp;<span class="ident" id="1878151"><a href="/runtime/netpoll.go.html#1878093">pdSize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1878160">if</span>&nbsp;<span class="ident" id="1878163"><a href="/runtime/netpoll.go.html#1878130">n</a></span>&nbsp;<span class="op" id="1878165">==</span>&nbsp;<span class="num" id="1878168">0</span>&nbsp;<span class="op" id="1878170">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1878175"><a href="/runtime/netpoll.go.html#1878130">n</a></span>&nbsp;<span class="op" id="1878177">=</span>&nbsp;<span class="num" id="1878179">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1878183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1878187">//&nbsp;Must&nbsp;be&nbsp;in&nbsp;non-GC&nbsp;memory&nbsp;because&nbsp;can&nbsp;be&nbsp;referenced</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1878243">//&nbsp;only&nbsp;from&nbsp;epoll/kqueue&nbsp;internals.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1878282">mem</span>&nbsp;<span class="op" id="1878286">:=</span>&nbsp;<span class="ident" id="1878289"><a href="/runtime/malloc.go.html#1842049">persistentalloc</a></span><span class="op" id="1878304">(</span><span class="ident" id="1878305"><a href="/runtime/netpoll.go.html#1878130">n</a></span><span class="op" id="1878306">*</span><span class="ident" id="1878307"><a href="/runtime/netpoll.go.html#1878093">pdSize</a></span><span class="op" id="1878313">,</span>&nbsp;<span class="num" id="1878315">0</span><span class="op" id="1878316">,</span>&nbsp;<span class="op" id="1878318">&amp;</span><span class="ident" id="1878319"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2023037">memstats</a></span><span class="op" id="1878327">.</span><span class="ident" id="1878328">other_sys</span><span class="op" id="1878337">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1878341">for</span>&nbsp;<span class="ident" id="1878345">i</span>&nbsp;<span class="op" id="1878347">:=</span>&nbsp;<span class="builtintype" id="1878350">uintptr</span><span class="op" id="1878357">(</span><span class="num" id="1878358">0</span><span class="op" id="1878359">)</span><span class="op" id="1878360">;</span>&nbsp;<span class="ident" id="1878362"><a href="/runtime/netpoll.go.html#1878345">i</a></span>&nbsp;<span class="op" id="1878364">&lt;</span>&nbsp;<span class="ident" id="1878366"><a href="/runtime/netpoll.go.html#1878130">n</a></span><span class="op" id="1878367">;</span>&nbsp;<span class="ident" id="1878369"><a href="/runtime/netpoll.go.html#1878345">i</a></span><span class="op" id="1878370">++</span>&nbsp;<span class="op" id="1878373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1878378">pd</span>&nbsp;<span class="op" id="1878381">:=</span>&nbsp;<span class="op" id="1878384">(</span><span class="op" id="1878385">*</span><span class="ident" id="1878386"><a href="/runtime/netpoll.go.html#1868531">pollDesc</a></span><span class="op" id="1878394">)</span><span class="op" id="1878395">(</span><span class="ident" id="1878396"><a href="/runtime/stubs.go.html#1968610">add</a></span><span class="op" id="1878399">(</span><span class="ident" id="1878400"><a href="/runtime/netpoll.go.html#1878282">mem</a></span><span class="op" id="1878403">,</span>&nbsp;<span class="ident" id="1878405"><a href="/runtime/netpoll.go.html#1878345">i</a></span><span class="op" id="1878406">*</span><span class="ident" id="1878407"><a href="/runtime/netpoll.go.html#1878093">pdSize</a></span><span class="op" id="1878413">)</span><span class="op" id="1878414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1878419"><a href="/runtime/netpoll.go.html#1878378">pd</a></span><span class="op" id="1878421">.</span><span class="ident" id="1878422">link</span>&nbsp;<span class="op" id="1878427">=</span>&nbsp;<span class="ident" id="1878429"><a href="/runtime/netpoll.go.html#1878015">c</a></span><span class="op" id="1878430">.</span><span class="ident" id="1878431">first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1878440"><a href="/runtime/netpoll.go.html#1878015">c</a></span><span class="op" id="1878441">.</span><span class="ident" id="1878442">first</span>&nbsp;<span class="op" id="1878448">=</span>&nbsp;<span class="ident" id="1878450"><a href="/runtime/netpoll.go.html#1878378">pd</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1878455">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1878458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1878461">pd</span>&nbsp;<span class="op" id="1878464">:=</span>&nbsp;<span class="ident" id="1878467"><a href="/runtime/netpoll.go.html#1878015">c</a></span><span class="op" id="1878468">.</span><span class="ident" id="1878469">first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1878476"><a href="/runtime/netpoll.go.html#1878015">c</a></span><span class="op" id="1878477">.</span><span class="ident" id="1878478">first</span>&nbsp;<span class="op" id="1878484">=</span>&nbsp;<span class="ident" id="1878486"><a href="/runtime/netpoll.go.html#1878461">pd</a></span><span class="op" id="1878488">.</span><span class="ident" id="1878489">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1878495"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1878501">(</span><span class="op" id="1878502">&amp;</span><span class="ident" id="1878503"><a href="/runtime/netpoll.go.html#1878015">c</a></span><span class="op" id="1878504">.</span><span class="ident" id="1878505">lock</span><span class="op" id="1878509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1878512">return</span>&nbsp;<span class="ident" id="1878519"><a href="/runtime/netpoll.go.html#1878461">pd</a></span><br>
<span class="lineno">455</span><span class="op" id="1878522">}</span>
</div>
</body>
</html>
