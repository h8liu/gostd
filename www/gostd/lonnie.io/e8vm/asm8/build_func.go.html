<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/asm8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/asm8/bare_func.go.html">bare_func.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/build_file.go.html">build_file.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/build_func.go.html">build_func.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/build_lib.go.html">build_lib.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/build_var.go.html">build_var.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/builder.go.html">builder.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/check_type.go.html">check_type.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/data_hex.go.html">data_hex.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/data_nums.go.html">data_nums.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/data_str.go.html">data_str.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/file.go.html">file.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/func_decl.go.html">func_decl.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/func_stmt.go.html">func_stmt.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/inst.go.html">inst.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/inst_all.go.html">inst_all.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/inst_br.go.html">inst_br.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/inst_imm.go.html">inst_imm.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/inst_jmp.go.html">inst_jmp.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/inst_reg.go.html">inst_reg.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/inst_sys.go.html">inst_sys.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/lex_all.go.html">lex_all.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/lex_all_test.go.html">lex_all_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/lex_comment.go.html">lex_comment.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/lex_operand.go.html">lex_operand.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/lex_string.go.html">lex_string.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/lib.go.html">lib.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/package.go.html">package.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parse_arg.go.html">parse_arg.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parse_file.go.html">parse_file.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parse_func.go.html">parse_func.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parse_func_stmt.go.html">parse_func_stmt.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parse_func_test.go.html">parse_func_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parse_inst.go.html">parse_inst.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parse_label.go.html">parse_label.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parse_reg.go.html">parse_reg.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parse_sym.go.html">parse_sym.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parse_var.go.html">parse_var.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parse_var_stmt.go.html">parse_var_stmt.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/parser.go.html">parser.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/single_file.go.html">single_file.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/stmt_lexer.go.html">stmt_lexer.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/sym_scope.go.html">sym_scope.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/sym_table.go.html">sym_table.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/symbol.go.html">symbol.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/token.go.html">token.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/var_decl.go.html">var_decl.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/asm8/var_stmt.go.html">var_stmt.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="4854379">package</span>&nbsp;<span class="ident" id="4854387">asm8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4854393">import</span>&nbsp;<span class="op" id="4854400">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4854403">&#34;lonnie.io/e8vm/lex8&#34;</span><br>
<span class="lineno">5</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4854426">&#34;lonnie.io/e8vm/link8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4854449">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4854452">//&nbsp;buildFunc&nbsp;builds&nbsp;a&nbsp;function&nbsp;object&nbsp;from&nbsp;a&nbsp;function&nbsp;AST&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="4854516">func</span>&nbsp;<span class="ident" id="4854521">buildFunc</span><span class="op" id="4854530">(</span><span class="ident" id="4854531">b</span>&nbsp;<span class="op" id="4854533">*</span><span class="ident" id="4854534">builder</span><span class="op" id="4854541">,</span>&nbsp;<span class="ident" id="4854543">f</span>&nbsp;<span class="op" id="4854545">*</span><span class="ident" id="4854546">funcDecl</span><span class="op" id="4854554">)</span>&nbsp;<span class="op" id="4854556">*</span><span class="ident" id="4854557">link8</span><span class="op" id="4854562">.</span><span class="ident" id="4854563">Func</span>&nbsp;<span class="op" id="4854568">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4854571">b</span><span class="op" id="4854572">.</span><span class="ident" id="4854573">scope</span><span class="op" id="4854578">.</span><span class="ident" id="4854579">Push</span><span class="op" id="4854583">(</span><span class="op" id="4854584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4854587">defer</span>&nbsp;<span class="ident" id="4854593">b</span><span class="op" id="4854594">.</span><span class="ident" id="4854595">scope</span><span class="op" id="4854600">.</span><span class="ident" id="4854601">Pop</span><span class="op" id="4854604">(</span><span class="op" id="4854605">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4854609">b</span><span class="op" id="4854610">.</span><span class="ident" id="4854611">clearErr</span><span class="op" id="4854619">(</span><span class="op" id="4854620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4854623">declareLabels</span><span class="op" id="4854636">(</span><span class="ident" id="4854637">b</span><span class="op" id="4854638">,</span>&nbsp;<span class="ident" id="4854640">f</span><span class="op" id="4854641">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4854644">if</span>&nbsp;<span class="op" id="4854647">!</span><span class="ident" id="4854648">b</span><span class="op" id="4854649">.</span><span class="ident" id="4854650">hasError</span>&nbsp;<span class="op" id="4854659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4854663">setOffsets</span><span class="op" id="4854673">(</span><span class="ident" id="4854674">b</span><span class="op" id="4854675">,</span>&nbsp;<span class="ident" id="4854677">f</span><span class="op" id="4854678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4854682">fillLabels</span><span class="op" id="4854692">(</span><span class="ident" id="4854693">b</span><span class="op" id="4854694">,</span>&nbsp;<span class="ident" id="4854696">f</span><span class="op" id="4854697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4854700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4854704">return</span>&nbsp;<span class="ident" id="4854711">makeFuncObj</span><span class="op" id="4854722">(</span><span class="ident" id="4854723">b</span><span class="op" id="4854724">,</span>&nbsp;<span class="ident" id="4854726">f</span><span class="op" id="4854727">)</span><br>
<span class="lineno"></span><span class="op" id="4854729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4854732">//&nbsp;declareLabels&nbsp;adds&nbsp;the&nbsp;labels&nbsp;into&nbsp;the&nbsp;scope,</span><br>
<span class="lineno"></span><span class="comment" id="4854781">//&nbsp;so&nbsp;that&nbsp;later&nbsp;they&nbsp;can&nbsp;be&nbsp;queried&nbsp;for&nbsp;filling.</span><br>
<span class="lineno">25</span><span class="keyword" id="4854831">func</span>&nbsp;<span class="ident" id="4854836">declareLabels</span><span class="op" id="4854849">(</span><span class="ident" id="4854850">b</span>&nbsp;<span class="op" id="4854852">*</span><span class="ident" id="4854853">builder</span><span class="op" id="4854860">,</span>&nbsp;<span class="ident" id="4854862">f</span>&nbsp;<span class="op" id="4854864">*</span><span class="ident" id="4854865">funcDecl</span><span class="op" id="4854873">)</span>&nbsp;<span class="op" id="4854875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4854878">for</span>&nbsp;<span class="ident" id="4854882">_</span><span class="op" id="4854883">,</span>&nbsp;<span class="ident" id="4854885">stmt</span>&nbsp;<span class="op" id="4854890">:=</span>&nbsp;<span class="keyword" id="4854893">range</span>&nbsp;<span class="ident" id="4854899">f</span><span class="op" id="4854900">.</span><span class="ident" id="4854901">stmts</span>&nbsp;<span class="op" id="4854907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4854911">if</span>&nbsp;<span class="op" id="4854914">!</span><span class="ident" id="4854915">stmt</span><span class="op" id="4854919">.</span><span class="ident" id="4854920">isLabel</span><span class="op" id="4854927">(</span><span class="op" id="4854928">)</span>&nbsp;<span class="op" id="4854930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4854935">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4854946">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4854951">lab</span>&nbsp;<span class="op" id="4854955">:=</span>&nbsp;<span class="ident" id="4854958">stmt</span><span class="op" id="4854962">.</span><span class="ident" id="4854963">label</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4854971">op</span>&nbsp;<span class="op" id="4854974">:=</span>&nbsp;<span class="ident" id="4854977">stmt</span><span class="op" id="4854981">.</span><span class="ident" id="4854982">ops</span><span class="op" id="4854985">[</span><span class="num" id="4854986">0</span><span class="op" id="4854987">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4854991">sym</span>&nbsp;<span class="op" id="4854995">:=</span>&nbsp;<span class="op" id="4854998">&amp;</span><span class="ident" id="4854999">symbol</span><span class="op" id="4855005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855010">Name</span><span class="op" id="4855014">:</span>&nbsp;<span class="ident" id="4855016">lab</span><span class="op" id="4855019">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855024">Type</span><span class="op" id="4855028">:</span>&nbsp;<span class="ident" id="4855030">SymLabel</span><span class="op" id="4855038">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855043">Item</span><span class="op" id="4855047">:</span>&nbsp;<span class="ident" id="4855049">stmt</span><span class="op" id="4855053">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855058">Pos</span><span class="op" id="4855061">:</span>&nbsp;&nbsp;<span class="ident" id="4855064">op</span><span class="op" id="4855066">.</span><span class="ident" id="4855067">Pos</span><span class="op" id="4855070">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855079">decl</span>&nbsp;<span class="op" id="4855084">:=</span>&nbsp;<span class="ident" id="4855087">b</span><span class="op" id="4855088">.</span><span class="ident" id="4855089">scope</span><span class="op" id="4855094">.</span><span class="ident" id="4855095">Declare</span><span class="op" id="4855102">(</span><span class="ident" id="4855103">sym</span><span class="op" id="4855106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855110">if</span>&nbsp;<span class="ident" id="4855113">decl</span>&nbsp;<span class="op" id="4855118">!=</span>&nbsp;<span class="ident" id="4855121">nil</span>&nbsp;<span class="op" id="4855125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855130">b</span><span class="op" id="4855131">.</span><span class="ident" id="4855132">err</span><span class="op" id="4855135">(</span><span class="ident" id="4855136">op</span><span class="op" id="4855138">.</span><span class="ident" id="4855139">Pos</span><span class="op" id="4855142">,</span>&nbsp;<span class="string" id="4855144">&#34;%q&nbsp;already&nbsp;declared&#34;</span><span class="op" id="4855165">,</span>&nbsp;<span class="ident" id="4855167">lab</span><span class="op" id="4855170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855175">b</span><span class="op" id="4855176">.</span><span class="ident" id="4855177">err</span><span class="op" id="4855180">(</span><span class="ident" id="4855181">decl</span><span class="op" id="4855185">.</span><span class="ident" id="4855186">Pos</span><span class="op" id="4855189">,</span>&nbsp;<span class="string" id="4855191">&#34;&nbsp;&nbsp;here&nbsp;as&nbsp;a&nbsp;%s&#34;</span><span class="op" id="4855207">,</span>&nbsp;<span class="ident" id="4855209">symStr</span><span class="op" id="4855215">(</span><span class="ident" id="4855216">decl</span><span class="op" id="4855220">.</span><span class="ident" id="4855221">Type</span><span class="op" id="4855225">)</span><span class="op" id="4855226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855231">continue</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855245">}</span><br>
<span class="lineno"></span><span class="op" id="4855247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4855250">//&nbsp;setOffsets&nbsp;calculates&nbsp;the&nbsp;offset&nbsp;in&nbsp;function&nbsp;for&nbsp;each&nbsp;instruction.</span><br>
<span class="lineno">50</span><span class="keyword" id="4855320">func</span>&nbsp;<span class="ident" id="4855325">setOffsets</span><span class="op" id="4855335">(</span><span class="ident" id="4855336">b</span>&nbsp;<span class="op" id="4855338">*</span><span class="ident" id="4855339">builder</span><span class="op" id="4855346">,</span>&nbsp;<span class="ident" id="4855348">f</span>&nbsp;<span class="op" id="4855350">*</span><span class="ident" id="4855351">funcDecl</span><span class="op" id="4855359">)</span>&nbsp;<span class="op" id="4855361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855364">offset</span>&nbsp;<span class="op" id="4855371">:=</span>&nbsp;<span class="builtintype" id="4855374">uint32</span><span class="op" id="4855380">(</span><span class="num" id="4855381">0</span><span class="op" id="4855382">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855386">for</span>&nbsp;<span class="ident" id="4855390">_</span><span class="op" id="4855391">,</span>&nbsp;<span class="ident" id="4855393">s</span>&nbsp;<span class="op" id="4855395">:=</span>&nbsp;<span class="keyword" id="4855398">range</span>&nbsp;<span class="ident" id="4855404">f</span><span class="op" id="4855405">.</span><span class="ident" id="4855406">stmts</span>&nbsp;<span class="op" id="4855412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855416">s</span><span class="op" id="4855417">.</span><span class="ident" id="4855418">offset</span>&nbsp;<span class="op" id="4855425">=</span>&nbsp;<span class="ident" id="4855427">offset</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855436">if</span>&nbsp;<span class="ident" id="4855439">s</span><span class="op" id="4855440">.</span><span class="ident" id="4855441">isLabel</span><span class="op" id="4855448">(</span><span class="op" id="4855449">)</span>&nbsp;<span class="op" id="4855451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855456">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855472">offset</span>&nbsp;<span class="op" id="4855479">+=</span>&nbsp;<span class="num" id="4855482">4</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855485">}</span><br>
<span class="lineno"></span><span class="op" id="4855487">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4855490">//&nbsp;fillDelta&nbsp;will&nbsp;fill&nbsp;the&nbsp;particular&nbsp;instruction</span><br>
<span class="lineno"></span><span class="comment" id="4855540">//&nbsp;with&nbsp;a&nbsp;jumping/branching&nbsp;offset&nbsp;d.</span><br>
<span class="lineno">65</span><span class="keyword" id="4855578">func</span>&nbsp;<span class="ident" id="4855583">fillDelta</span><span class="op" id="4855592">(</span><span class="ident" id="4855593">b</span>&nbsp;<span class="op" id="4855595">*</span><span class="ident" id="4855596">builder</span><span class="op" id="4855603">,</span>&nbsp;<span class="ident" id="4855605">t</span>&nbsp;<span class="op" id="4855607">*</span><span class="ident" id="4855608">lex8</span><span class="op" id="4855612">.</span><span class="ident" id="4855613">Token</span><span class="op" id="4855618">,</span>&nbsp;<span class="ident" id="4855620">inst</span>&nbsp;<span class="op" id="4855625">*</span><span class="builtintype" id="4855626">uint32</span><span class="op" id="4855632">,</span>&nbsp;<span class="ident" id="4855634">d</span>&nbsp;<span class="builtintype" id="4855636">uint32</span><span class="op" id="4855642">)</span>&nbsp;<span class="op" id="4855644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855647">if</span>&nbsp;<span class="ident" id="4855650">isJump</span><span class="op" id="4855656">(</span><span class="op" id="4855657">*</span><span class="ident" id="4855658">inst</span><span class="op" id="4855662">)</span>&nbsp;<span class="op" id="4855664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855668">*</span><span class="ident" id="4855669">inst</span>&nbsp;<span class="op" id="4855674">|=</span>&nbsp;<span class="ident" id="4855677">d</span>&nbsp;<span class="op" id="4855679">&amp;</span>&nbsp;<span class="num" id="4855681">0x3fffffff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855693">}</span>&nbsp;<span class="keyword" id="4855695">else</span>&nbsp;<span class="op" id="4855700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4855704">//&nbsp;it&nbsp;is&nbsp;a&nbsp;branch</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855724">if</span>&nbsp;<span class="op" id="4855727">!</span><span class="ident" id="4855728">inBrRange</span><span class="op" id="4855737">(</span><span class="ident" id="4855738">d</span><span class="op" id="4855739">)</span>&nbsp;<span class="op" id="4855741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855746">b</span><span class="op" id="4855747">.</span><span class="ident" id="4855748">err</span><span class="op" id="4855751">(</span><span class="ident" id="4855752">t</span><span class="op" id="4855753">.</span><span class="ident" id="4855754">Pos</span><span class="op" id="4855757">,</span>&nbsp;<span class="string" id="4855759">&#34;%q&nbsp;is&nbsp;out&nbsp;of&nbsp;branch&nbsp;range&#34;</span><span class="op" id="4855786">,</span>&nbsp;<span class="ident" id="4855788">t</span><span class="op" id="4855789">.</span><span class="ident" id="4855790">Lit</span><span class="op" id="4855793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855801">*</span><span class="ident" id="4855802">inst</span>&nbsp;<span class="op" id="4855807">|=</span>&nbsp;<span class="ident" id="4855810">d</span>&nbsp;<span class="op" id="4855812">&amp;</span>&nbsp;<span class="num" id="4855814">0x3ffff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855823">}</span><br>
<span class="lineno">75</span><span class="op" id="4855825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4855828">//&nbsp;fillLabels&nbsp;fills&nbsp;all&nbsp;the&nbsp;labels&nbsp;in&nbsp;the&nbsp;function.&nbsp;After&nbsp;the&nbsp;filling,&nbsp;all&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4855907">//&nbsp;symbols&nbsp;left&nbsp;will&nbsp;be&nbsp;fillLink,&nbsp;fillHigh&nbsp;and&nbsp;fillLow&nbsp;and&nbsp;all&nbsp;branches&nbsp;(which</span><br>
<span class="lineno"></span><span class="comment" id="4855986">//&nbsp;must&nbsp;use&nbsp;labels)&nbsp;will&nbsp;be&nbsp;filled.</span><br>
<span class="lineno">80</span><span class="keyword" id="4856022">func</span>&nbsp;<span class="ident" id="4856027">fillLabels</span><span class="op" id="4856037">(</span><span class="ident" id="4856038">b</span>&nbsp;<span class="op" id="4856040">*</span><span class="ident" id="4856041">builder</span><span class="op" id="4856048">,</span>&nbsp;<span class="ident" id="4856050">f</span>&nbsp;<span class="op" id="4856052">*</span><span class="ident" id="4856053">funcDecl</span><span class="op" id="4856061">)</span>&nbsp;<span class="op" id="4856063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856066">for</span>&nbsp;<span class="ident" id="4856070">_</span><span class="op" id="4856071">,</span>&nbsp;<span class="ident" id="4856073">s</span>&nbsp;<span class="op" id="4856075">:=</span>&nbsp;<span class="keyword" id="4856078">range</span>&nbsp;<span class="ident" id="4856084">f</span><span class="op" id="4856085">.</span><span class="ident" id="4856086">stmts</span>&nbsp;<span class="op" id="4856092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856096">if</span>&nbsp;<span class="ident" id="4856099">s</span><span class="op" id="4856100">.</span><span class="ident" id="4856101">isLabel</span><span class="op" id="4856108">(</span><span class="op" id="4856109">)</span>&nbsp;<span class="op" id="4856111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856116">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4856127">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856131">if</span>&nbsp;<span class="ident" id="4856134">s</span><span class="op" id="4856135">.</span><span class="ident" id="4856136">fill</span>&nbsp;<span class="op" id="4856141">!=</span>&nbsp;<span class="ident" id="4856144">fillLabel</span>&nbsp;<span class="op" id="4856154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856159">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4856170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856174">if</span>&nbsp;<span class="ident" id="4856177">s</span><span class="op" id="4856178">.</span><span class="ident" id="4856179">pack</span>&nbsp;<span class="op" id="4856184">!=</span>&nbsp;<span class="string" id="4856187">&#34;&#34;</span>&nbsp;<span class="op" id="4856190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4856195">panic</span><span class="op" id="4856200">(</span><span class="string" id="4856201">&#34;fill&nbsp;label&nbsp;with&nbsp;pack&nbsp;symbol&#34;</span><span class="op" id="4856230">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4856234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856239">t</span>&nbsp;<span class="op" id="4856241">:=</span>&nbsp;<span class="ident" id="4856244">s</span><span class="op" id="4856245">.</span><span class="ident" id="4856246">symTok</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856256">sym</span>&nbsp;<span class="op" id="4856260">:=</span>&nbsp;<span class="ident" id="4856263">b</span><span class="op" id="4856264">.</span><span class="ident" id="4856265">scope</span><span class="op" id="4856270">.</span><span class="ident" id="4856271">Query</span><span class="op" id="4856276">(</span><span class="ident" id="4856277">s</span><span class="op" id="4856278">.</span><span class="ident" id="4856279">symbol</span><span class="op" id="4856285">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856289">if</span>&nbsp;<span class="ident" id="4856292">sym</span>&nbsp;<span class="op" id="4856296">==</span>&nbsp;<span class="ident" id="4856299">nil</span>&nbsp;<span class="op" id="4856303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856308">b</span><span class="op" id="4856309">.</span><span class="ident" id="4856310">err</span><span class="op" id="4856313">(</span><span class="ident" id="4856314">t</span><span class="op" id="4856315">.</span><span class="ident" id="4856316">Pos</span><span class="op" id="4856319">,</span>&nbsp;<span class="string" id="4856321">&#34;label&nbsp;%q&nbsp;not&nbsp;declared&#34;</span><span class="op" id="4856344">,</span>&nbsp;<span class="ident" id="4856346">t</span><span class="op" id="4856347">.</span><span class="ident" id="4856348">Lit</span><span class="op" id="4856351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856356">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4856367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856372">if</span>&nbsp;<span class="ident" id="4856375">sym</span><span class="op" id="4856378">.</span><span class="ident" id="4856379">Type</span>&nbsp;<span class="op" id="4856384">!=</span>&nbsp;<span class="ident" id="4856387">SymLabel</span>&nbsp;<span class="op" id="4856396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4856401">panic</span><span class="op" id="4856406">(</span><span class="string" id="4856407">&#34;not&nbsp;a&nbsp;label&#34;</span><span class="op" id="4856420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4856424">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856429">lab</span>&nbsp;<span class="op" id="4856433">:=</span>&nbsp;<span class="ident" id="4856436">sym</span><span class="op" id="4856439">.</span><span class="ident" id="4856440">Item</span><span class="op" id="4856444">.</span><span class="op" id="4856445">(</span><span class="op" id="4856446">*</span><span class="ident" id="4856447">funcStmt</span><span class="op" id="4856455">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856459">delta</span>&nbsp;<span class="op" id="4856465">:=</span>&nbsp;<span class="builtintype" id="4856468">uint32</span><span class="op" id="4856474">(</span><span class="builtintype" id="4856475">int32</span><span class="op" id="4856480">(</span><span class="ident" id="4856481">lab</span><span class="op" id="4856484">.</span><span class="ident" id="4856485">offset</span><span class="op" id="4856491">-</span><span class="ident" id="4856492">s</span><span class="op" id="4856493">.</span><span class="ident" id="4856494">offset</span><span class="op" id="4856500">-</span><span class="num" id="4856501">4</span><span class="op" id="4856502">)</span>&nbsp;<span class="op" id="4856504">&gt;&gt;</span>&nbsp;<span class="num" id="4856507">2</span><span class="op" id="4856508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856512">fillDelta</span><span class="op" id="4856521">(</span><span class="ident" id="4856522">b</span><span class="op" id="4856523">,</span>&nbsp;<span class="ident" id="4856525">t</span><span class="op" id="4856526">,</span>&nbsp;<span class="op" id="4856528">&amp;</span><span class="ident" id="4856529">s</span><span class="op" id="4856530">.</span><span class="ident" id="4856531">inst</span><span class="op" id="4856535">.</span><span class="ident" id="4856536">inst</span><span class="op" id="4856540">,</span>&nbsp;<span class="ident" id="4856542">delta</span><span class="op" id="4856547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4856550">}</span><br>
<span class="lineno"></span><span class="op" id="4856552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="4856555">func</span>&nbsp;<span class="ident" id="4856560">queryPkg</span><span class="op" id="4856568">(</span><span class="ident" id="4856569">b</span>&nbsp;<span class="op" id="4856571">*</span><span class="ident" id="4856572">builder</span><span class="op" id="4856579">,</span>&nbsp;<span class="ident" id="4856581">t</span>&nbsp;<span class="op" id="4856583">*</span><span class="ident" id="4856584">lex8</span><span class="op" id="4856588">.</span><span class="ident" id="4856589">Token</span><span class="op" id="4856594">,</span>&nbsp;<span class="ident" id="4856596">pack</span>&nbsp;<span class="builtintype" id="4856601">string</span><span class="op" id="4856607">)</span>&nbsp;<span class="op" id="4856609">*</span><span class="ident" id="4856610">lib</span>&nbsp;<span class="op" id="4856614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856617">sym</span>&nbsp;<span class="op" id="4856621">:=</span>&nbsp;<span class="ident" id="4856624">b</span><span class="op" id="4856625">.</span><span class="ident" id="4856626">scope</span><span class="op" id="4856631">.</span><span class="ident" id="4856632">Query</span><span class="op" id="4856637">(</span><span class="ident" id="4856638">pack</span><span class="op" id="4856642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856645">if</span>&nbsp;<span class="ident" id="4856648">sym</span>&nbsp;<span class="op" id="4856652">==</span>&nbsp;<span class="ident" id="4856655">nil</span>&nbsp;<span class="op" id="4856659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856663">b</span><span class="op" id="4856664">.</span><span class="ident" id="4856665">err</span><span class="op" id="4856668">(</span><span class="ident" id="4856669">t</span><span class="op" id="4856670">.</span><span class="ident" id="4856671">Pos</span><span class="op" id="4856674">,</span>&nbsp;<span class="string" id="4856676">&#34;package&nbsp;%q&nbsp;not&nbsp;found&#34;</span><span class="op" id="4856698">,</span>&nbsp;<span class="ident" id="4856700">pack</span><span class="op" id="4856704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856708">return</span>&nbsp;<span class="ident" id="4856715">nil</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4856720">}</span>&nbsp;<span class="keyword" id="4856722">else</span>&nbsp;<span class="keyword" id="4856727">if</span>&nbsp;<span class="ident" id="4856730">sym</span><span class="op" id="4856733">.</span><span class="ident" id="4856734">Type</span>&nbsp;<span class="op" id="4856739">!=</span>&nbsp;<span class="ident" id="4856742">SymImport</span>&nbsp;<span class="op" id="4856752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856756">b</span><span class="op" id="4856757">.</span><span class="ident" id="4856758">err</span><span class="op" id="4856761">(</span><span class="ident" id="4856762">t</span><span class="op" id="4856763">.</span><span class="ident" id="4856764">Pos</span><span class="op" id="4856767">,</span>&nbsp;<span class="string" id="4856769">&#34;%q&nbsp;is&nbsp;a&nbsp;%s,&nbsp;not&nbsp;a&nbsp;package&#34;</span><span class="op" id="4856796">,</span>&nbsp;<span class="ident" id="4856798">t</span><span class="op" id="4856799">.</span><span class="ident" id="4856800">Lit</span><span class="op" id="4856803">,</span>&nbsp;<span class="ident" id="4856805">symStr</span><span class="op" id="4856811">(</span><span class="ident" id="4856812">sym</span><span class="op" id="4856815">.</span><span class="ident" id="4856816">Type</span><span class="op" id="4856820">)</span><span class="op" id="4856821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856825">return</span>&nbsp;<span class="ident" id="4856832">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4856837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856840">return</span>&nbsp;<span class="ident" id="4856847">sym</span><span class="op" id="4856850">.</span><span class="ident" id="4856851">Item</span><span class="op" id="4856855">.</span><span class="op" id="4856856">(</span><span class="op" id="4856857">*</span><span class="ident" id="4856858">lib</span><span class="op" id="4856861">)</span><br>
<span class="lineno">120</span><span class="op" id="4856863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4856866">func</span>&nbsp;<span class="ident" id="4856871">init</span><span class="op" id="4856875">(</span><span class="op" id="4856876">)</span>&nbsp;<span class="op" id="4856878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856881">as</span>&nbsp;<span class="op" id="4856884">:=</span>&nbsp;<span class="keyword" id="4856887">func</span><span class="op" id="4856891">(</span><span class="ident" id="4856892">b</span>&nbsp;<span class="builtintype" id="4856894">bool</span><span class="op" id="4856898">)</span>&nbsp;<span class="op" id="4856900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856904">if</span>&nbsp;<span class="op" id="4856907">!</span><span class="ident" id="4856908">b</span>&nbsp;<span class="op" id="4856910">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4856915">panic</span><span class="op" id="4856920">(</span><span class="string" id="4856921">&#34;bug&#34;</span><span class="op" id="4856926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4856930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4856933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856936">as</span><span class="op" id="4856938">(</span><span class="ident" id="4856939">fillNone</span>&nbsp;<span class="op" id="4856948">==</span>&nbsp;<span class="num" id="4856951">0</span>&nbsp;<span class="op" id="4856953">&amp;&amp;</span>&nbsp;<span class="ident" id="4856956">fillLabel</span>&nbsp;<span class="op" id="4856966">==</span>&nbsp;<span class="num" id="4856969">4</span><span class="op" id="4856970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856973">as</span><span class="op" id="4856975">(</span><span class="ident" id="4856976">fillLink</span>&nbsp;<span class="op" id="4856985">==</span>&nbsp;<span class="ident" id="4856988">link8</span><span class="op" id="4856993">.</span><span class="ident" id="4856994">FillLink</span><span class="op" id="4857002">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857005">as</span><span class="op" id="4857007">(</span><span class="ident" id="4857008">fillHigh</span>&nbsp;<span class="op" id="4857017">==</span>&nbsp;<span class="ident" id="4857020">link8</span><span class="op" id="4857025">.</span><span class="ident" id="4857026">FillHigh</span><span class="op" id="4857034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857037">as</span><span class="op" id="4857039">(</span><span class="ident" id="4857040">fillLow</span>&nbsp;<span class="op" id="4857048">==</span>&nbsp;<span class="ident" id="4857051">link8</span><span class="op" id="4857056">.</span><span class="ident" id="4857057">FillLow</span><span class="op" id="4857064">)</span><br>
<span class="lineno"></span><span class="op" id="4857066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4857069">//&nbsp;resolveSymbol&nbsp;resolves&nbsp;the&nbsp;symbol&nbsp;in&nbsp;the&nbsp;statement,</span><br>
<span class="lineno">135</span><span class="comment" id="4857124">//&nbsp;returns&nbsp;the&nbsp;symbol&nbsp;linking&nbsp;object&nbsp;and&nbsp;its&nbsp;&lt;sym,&nbsp;pkg&gt;&nbsp;index&nbsp;pair</span><br>
<span class="lineno"></span><span class="comment" id="4857191">//&nbsp;in&nbsp;the&nbsp;current&nbsp;package&nbsp;context.</span><br>
<span class="lineno"></span><span class="keyword" id="4857226">func</span>&nbsp;<span class="ident" id="4857231">resolveSymbol</span><span class="op" id="4857244">(</span><span class="ident" id="4857245">b</span>&nbsp;<span class="op" id="4857247">*</span><span class="ident" id="4857248">builder</span><span class="op" id="4857255">,</span>&nbsp;<span class="ident" id="4857257">s</span>&nbsp;<span class="op" id="4857259">*</span><span class="ident" id="4857260">funcStmt</span><span class="op" id="4857268">)</span>&nbsp;<span class="op" id="4857270">(</span><span class="ident" id="4857271">ret</span>&nbsp;<span class="op" id="4857275">*</span><span class="ident" id="4857276">symbol</span><span class="op" id="4857282">,</span>&nbsp;<span class="ident" id="4857284">pkg</span><span class="op" id="4857287">,</span>&nbsp;<span class="ident" id="4857289">index</span>&nbsp;<span class="builtintype" id="4857295">uint32</span><span class="op" id="4857301">)</span>&nbsp;<span class="op" id="4857303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857306">t</span>&nbsp;<span class="op" id="4857308">:=</span>&nbsp;<span class="ident" id="4857311">s</span><span class="op" id="4857312">.</span><span class="ident" id="4857313">symTok</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857322">if</span>&nbsp;<span class="ident" id="4857325">s</span><span class="op" id="4857326">.</span><span class="ident" id="4857327">pack</span>&nbsp;<span class="op" id="4857332">==</span>&nbsp;<span class="string" id="4857335">&#34;&#34;</span>&nbsp;<span class="op" id="4857338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857342">ret</span>&nbsp;<span class="op" id="4857346">=</span>&nbsp;<span class="ident" id="4857348">b</span><span class="op" id="4857349">.</span><span class="ident" id="4857350">scope</span><span class="op" id="4857355">.</span><span class="ident" id="4857356">Query</span><span class="op" id="4857361">(</span><span class="ident" id="4857362">s</span><span class="op" id="4857363">.</span><span class="ident" id="4857364">symbol</span><span class="op" id="4857370">)</span>&nbsp;<span class="comment" id="4857372">//&nbsp;find&nbsp;the&nbsp;symbol&nbsp;in&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857402">if</span>&nbsp;<span class="ident" id="4857405">ret</span>&nbsp;<span class="op" id="4857409">!=</span>&nbsp;<span class="ident" id="4857412">nil</span>&nbsp;<span class="op" id="4857416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857421">var</span>&nbsp;<span class="ident" id="4857425">p</span>&nbsp;<span class="op" id="4857427">*</span><span class="ident" id="4857428">lib</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857435">p</span><span class="op" id="4857436">,</span>&nbsp;<span class="ident" id="4857438">pkg</span>&nbsp;<span class="op" id="4857442">=</span>&nbsp;<span class="ident" id="4857444">b</span><span class="op" id="4857445">.</span><span class="ident" id="4857446">curPkg</span><span class="op" id="4857452">.</span><span class="ident" id="4857453">LibIndex</span><span class="op" id="4857461">(</span><span class="ident" id="4857462">ret</span><span class="op" id="4857465">.</span><span class="ident" id="4857466">Package</span><span class="op" id="4857473">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857478">index</span>&nbsp;<span class="op" id="4857484">=</span>&nbsp;<span class="ident" id="4857486">p</span><span class="op" id="4857487">.</span><span class="ident" id="4857488">SymIndex</span><span class="op" id="4857496">(</span><span class="ident" id="4857497">ret</span><span class="op" id="4857500">.</span><span class="ident" id="4857501">Name</span><span class="op" id="4857505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4857509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4857512">}</span>&nbsp;<span class="keyword" id="4857514">else</span>&nbsp;<span class="op" id="4857519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857523">p</span>&nbsp;<span class="op" id="4857525">:=</span>&nbsp;<span class="ident" id="4857528">queryPkg</span><span class="op" id="4857536">(</span><span class="ident" id="4857537">b</span><span class="op" id="4857538">,</span>&nbsp;<span class="ident" id="4857540">t</span><span class="op" id="4857541">,</span>&nbsp;<span class="ident" id="4857543">s</span><span class="op" id="4857544">.</span><span class="ident" id="4857545">pack</span><span class="op" id="4857549">)</span>&nbsp;<span class="comment" id="4857551">//&nbsp;find&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857573">if</span>&nbsp;<span class="ident" id="4857576">p</span>&nbsp;<span class="op" id="4857578">==</span>&nbsp;<span class="ident" id="4857581">nil</span>&nbsp;<span class="op" id="4857585">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857590">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4857599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857604">path</span>&nbsp;<span class="op" id="4857609">:=</span>&nbsp;<span class="ident" id="4857612">p</span><span class="op" id="4857613">.</span><span class="ident" id="4857614">Path</span><span class="op" id="4857618">(</span><span class="op" id="4857619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857623">_</span><span class="op" id="4857624">,</span>&nbsp;<span class="ident" id="4857626">pkg</span>&nbsp;<span class="op" id="4857630">=</span>&nbsp;<span class="ident" id="4857632">b</span><span class="op" id="4857633">.</span><span class="ident" id="4857634">curPkg</span><span class="op" id="4857640">.</span><span class="ident" id="4857641">LibIndex</span><span class="op" id="4857649">(</span><span class="ident" id="4857650">path</span><span class="op" id="4857654">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857658">ret</span><span class="op" id="4857661">,</span>&nbsp;<span class="ident" id="4857663">index</span>&nbsp;<span class="op" id="4857669">=</span>&nbsp;<span class="ident" id="4857671">p</span><span class="op" id="4857672">.</span><span class="ident" id="4857673">Query</span><span class="op" id="4857678">(</span><span class="ident" id="4857679">s</span><span class="op" id="4857680">.</span><span class="ident" id="4857681">symbol</span><span class="op" id="4857687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857691">if</span>&nbsp;<span class="ident" id="4857694">ret</span>&nbsp;<span class="op" id="4857698">!=</span>&nbsp;<span class="ident" id="4857701">nil</span>&nbsp;<span class="op" id="4857705">&amp;&amp;</span>&nbsp;<span class="ident" id="4857708">ret</span><span class="op" id="4857711">.</span><span class="ident" id="4857712">Package</span>&nbsp;<span class="op" id="4857720">!=</span>&nbsp;<span class="ident" id="4857723">path</span>&nbsp;<span class="op" id="4857728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4857733">panic</span><span class="op" id="4857738">(</span><span class="string" id="4857739">&#34;bug&#34;</span><span class="op" id="4857744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4857748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4857751">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857755">if</span>&nbsp;<span class="ident" id="4857758">ret</span>&nbsp;<span class="op" id="4857762">==</span>&nbsp;<span class="ident" id="4857765">nil</span>&nbsp;<span class="op" id="4857769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857773">b</span><span class="op" id="4857774">.</span><span class="ident" id="4857775">err</span><span class="op" id="4857778">(</span><span class="ident" id="4857779">t</span><span class="op" id="4857780">.</span><span class="ident" id="4857781">Pos</span><span class="op" id="4857784">,</span>&nbsp;<span class="string" id="4857786">&#34;%q&nbsp;not&nbsp;found&#34;</span><span class="op" id="4857800">,</span>&nbsp;<span class="ident" id="4857802">t</span><span class="op" id="4857803">.</span><span class="ident" id="4857804">Lit</span><span class="op" id="4857807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857811">return</span>&nbsp;<span class="ident" id="4857818">nil</span><span class="op" id="4857821">,</span>&nbsp;<span class="num" id="4857823">0</span><span class="op" id="4857824">,</span>&nbsp;<span class="num" id="4857826">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4857829">}</span>&nbsp;<span class="keyword" id="4857831">else</span>&nbsp;<span class="keyword" id="4857836">if</span>&nbsp;<span class="ident" id="4857839">ret</span><span class="op" id="4857842">.</span><span class="ident" id="4857843">Type</span>&nbsp;<span class="op" id="4857848">==</span>&nbsp;<span class="ident" id="4857851">SymConst</span>&nbsp;<span class="op" id="4857860">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857864">return</span>&nbsp;<span class="ident" id="4857871">nil</span><span class="op" id="4857874">,</span>&nbsp;<span class="num" id="4857876">0</span><span class="op" id="4857877">,</span>&nbsp;<span class="num" id="4857879">0</span>&nbsp;<span class="comment" id="4857881">//&nbsp;not&nbsp;my&nbsp;job&nbsp;to&nbsp;fill&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4857909">}</span>&nbsp;<span class="keyword" id="4857911">else</span>&nbsp;<span class="keyword" id="4857916">if</span>&nbsp;<span class="ident" id="4857919">ret</span><span class="op" id="4857922">.</span><span class="ident" id="4857923">Type</span>&nbsp;<span class="op" id="4857928">==</span>&nbsp;<span class="ident" id="4857931">SymImport</span>&nbsp;<span class="op" id="4857941">||</span>&nbsp;<span class="ident" id="4857944">ret</span><span class="op" id="4857947">.</span><span class="ident" id="4857948">Type</span>&nbsp;<span class="op" id="4857953">==</span>&nbsp;<span class="ident" id="4857956">SymLabel</span>&nbsp;<span class="op" id="4857965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857969">b</span><span class="op" id="4857970">.</span><span class="ident" id="4857971">err</span><span class="op" id="4857974">(</span><span class="ident" id="4857975">t</span><span class="op" id="4857976">.</span><span class="ident" id="4857977">Pos</span><span class="op" id="4857980">,</span>&nbsp;<span class="string" id="4857982">&#34;%s&nbsp;%q&nbsp;not&nbsp;a&nbsp;symbol&#34;</span><span class="op" id="4858002">,</span>&nbsp;<span class="ident" id="4858004">symStr</span><span class="op" id="4858010">(</span><span class="ident" id="4858011">ret</span><span class="op" id="4858014">.</span><span class="ident" id="4858015">Type</span><span class="op" id="4858019">)</span><span class="op" id="4858020">,</span>&nbsp;<span class="ident" id="4858022">t</span><span class="op" id="4858023">.</span><span class="ident" id="4858024">Lit</span><span class="op" id="4858027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858031">return</span>&nbsp;<span class="ident" id="4858038">nil</span><span class="op" id="4858041">,</span>&nbsp;<span class="num" id="4858043">0</span><span class="op" id="4858044">,</span>&nbsp;<span class="num" id="4858046">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4858049">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858053">return</span><br>
<span class="lineno"></span><span class="op" id="4858060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4858063">func</span>&nbsp;<span class="ident" id="4858068">linkSymbol</span><span class="op" id="4858078">(</span><span class="ident" id="4858079">b</span>&nbsp;<span class="op" id="4858081">*</span><span class="ident" id="4858082">builder</span><span class="op" id="4858089">,</span>&nbsp;<span class="ident" id="4858091">s</span>&nbsp;<span class="op" id="4858093">*</span><span class="ident" id="4858094">funcStmt</span><span class="op" id="4858102">,</span>&nbsp;<span class="ident" id="4858104">f</span>&nbsp;<span class="op" id="4858106">*</span><span class="ident" id="4858107">link8</span><span class="op" id="4858112">.</span><span class="ident" id="4858113">Func</span><span class="op" id="4858117">)</span>&nbsp;<span class="op" id="4858119">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858122">t</span>&nbsp;<span class="op" id="4858124">:=</span>&nbsp;<span class="ident" id="4858127">s</span><span class="op" id="4858128">.</span><span class="ident" id="4858129">symTok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858137">if</span>&nbsp;<span class="ident" id="4858140">b</span><span class="op" id="4858141">.</span><span class="ident" id="4858142">curPkg</span>&nbsp;<span class="op" id="4858149">==</span>&nbsp;<span class="ident" id="4858152">nil</span>&nbsp;<span class="op" id="4858156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858160">b</span><span class="op" id="4858161">.</span><span class="ident" id="4858162">err</span><span class="op" id="4858165">(</span><span class="ident" id="4858166">t</span><span class="op" id="4858167">.</span><span class="ident" id="4858168">Pos</span><span class="op" id="4858171">,</span>&nbsp;<span class="string" id="4858173">&#34;no&nbsp;context&nbsp;for&nbsp;resolving&nbsp;%q&#34;</span><span class="op" id="4858202">,</span>&nbsp;<span class="ident" id="4858204">t</span><span class="op" id="4858205">.</span><span class="ident" id="4858206">Lit</span><span class="op" id="4858209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858213">return</span>&nbsp;<span class="comment" id="4858220">//&nbsp;this&nbsp;may&nbsp;happen&nbsp;for&nbsp;bare&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4858258">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858262">sym</span><span class="op" id="4858265">,</span>&nbsp;<span class="ident" id="4858267">pkg</span><span class="op" id="4858270">,</span>&nbsp;<span class="ident" id="4858272">index</span>&nbsp;<span class="op" id="4858278">:=</span>&nbsp;<span class="ident" id="4858281">resolveSymbol</span><span class="op" id="4858294">(</span><span class="ident" id="4858295">b</span><span class="op" id="4858296">,</span>&nbsp;<span class="ident" id="4858298">s</span><span class="op" id="4858299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858302">if</span>&nbsp;<span class="ident" id="4858305">sym</span>&nbsp;<span class="op" id="4858309">==</span>&nbsp;<span class="ident" id="4858312">nil</span>&nbsp;<span class="op" id="4858316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858320">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4858328">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858332">if</span>&nbsp;<span class="ident" id="4858335">s</span><span class="op" id="4858336">.</span><span class="ident" id="4858337">fill</span>&nbsp;<span class="op" id="4858342">==</span>&nbsp;<span class="ident" id="4858345">fillLink</span>&nbsp;<span class="op" id="4858354">&amp;&amp;</span>&nbsp;<span class="ident" id="4858357">sym</span><span class="op" id="4858360">.</span><span class="ident" id="4858361">Type</span>&nbsp;<span class="op" id="4858366">!=</span>&nbsp;<span class="ident" id="4858369">SymFunc</span>&nbsp;<span class="op" id="4858377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858381">b</span><span class="op" id="4858382">.</span><span class="ident" id="4858383">err</span><span class="op" id="4858386">(</span><span class="ident" id="4858387">t</span><span class="op" id="4858388">.</span><span class="ident" id="4858389">Pos</span><span class="op" id="4858392">,</span>&nbsp;<span class="string" id="4858394">&#34;%s&nbsp;%q&nbsp;is&nbsp;not&nbsp;a&nbsp;function&#34;</span><span class="op" id="4858419">,</span>&nbsp;<span class="ident" id="4858421">symStr</span><span class="op" id="4858427">(</span><span class="ident" id="4858428">sym</span><span class="op" id="4858431">.</span><span class="ident" id="4858432">Type</span><span class="op" id="4858436">)</span><span class="op" id="4858437">,</span>&nbsp;<span class="ident" id="4858439">t</span><span class="op" id="4858440">.</span><span class="ident" id="4858441">Lit</span><span class="op" id="4858444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858448">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4858456">}</span>&nbsp;<span class="keyword" id="4858458">else</span>&nbsp;<span class="keyword" id="4858463">if</span>&nbsp;<span class="ident" id="4858466">pkg</span>&nbsp;<span class="op" id="4858470">&gt;</span>&nbsp;<span class="num" id="4858472">0</span>&nbsp;<span class="op" id="4858474">&amp;&amp;</span>&nbsp;<span class="op" id="4858477">!</span><span class="ident" id="4858478">isPublic</span><span class="op" id="4858486">(</span><span class="ident" id="4858487">sym</span><span class="op" id="4858490">.</span><span class="ident" id="4858491">Name</span><span class="op" id="4858495">)</span>&nbsp;<span class="op" id="4858497">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4858501">//&nbsp;for&nbsp;imported&nbsp;package,&nbsp;check&nbsp;if&nbsp;it&nbsp;is&nbsp;public</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858550">b</span><span class="op" id="4858551">.</span><span class="ident" id="4858552">err</span><span class="op" id="4858555">(</span><span class="ident" id="4858556">t</span><span class="op" id="4858557">.</span><span class="ident" id="4858558">Pos</span><span class="op" id="4858561">,</span>&nbsp;<span class="string" id="4858563">&#34;%q&nbsp;is&nbsp;not&nbsp;public&#34;</span><span class="op" id="4858581">,</span>&nbsp;<span class="ident" id="4858583">t</span><span class="op" id="4858584">.</span><span class="ident" id="4858585">Lit</span><span class="op" id="4858588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858592">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4858600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4858604">//&nbsp;save&nbsp;the&nbsp;link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858622">f</span><span class="op" id="4858623">.</span><span class="ident" id="4858624">AddLink</span><span class="op" id="4858631">(</span><span class="ident" id="4858632">s</span><span class="op" id="4858633">.</span><span class="ident" id="4858634">fill</span><span class="op" id="4858638">,</span>&nbsp;<span class="ident" id="4858640">pkg</span><span class="op" id="4858643">,</span>&nbsp;<span class="ident" id="4858645">index</span><span class="op" id="4858650">)</span><br>
<span class="lineno"></span><span class="op" id="4858652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4858655">//&nbsp;makeFuncObj&nbsp;converts&nbsp;a&nbsp;function&nbsp;AST&nbsp;node&nbsp;f&nbsp;into&nbsp;a&nbsp;function&nbsp;object.&nbsp;It</span><br>
<span class="lineno">200</span><span class="comment" id="4858728">//&nbsp;resolves&nbsp;the&nbsp;symbols&nbsp;of&nbsp;fillLink,&nbsp;fillHigh&nbsp;and&nbsp;fillLow&nbsp;into&nbsp;&lt;pack,&nbsp;sym&gt;</span><br>
<span class="lineno"></span><span class="comment" id="4858803">//&nbsp;index&nbsp;pairs,&nbsp;using&nbsp;the&nbsp;symbol&nbsp;scope&nbsp;and&nbsp;the&nbsp;curPkg&nbsp;context&nbsp;in&nbsp;the&nbsp;Builder&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="4858883">func</span>&nbsp;<span class="ident" id="4858888">makeFuncObj</span><span class="op" id="4858899">(</span><span class="ident" id="4858900">b</span>&nbsp;<span class="op" id="4858902">*</span><span class="ident" id="4858903">builder</span><span class="op" id="4858910">,</span>&nbsp;<span class="ident" id="4858912">f</span>&nbsp;<span class="op" id="4858914">*</span><span class="ident" id="4858915">funcDecl</span><span class="op" id="4858923">)</span>&nbsp;<span class="op" id="4858925">*</span><span class="ident" id="4858926">link8</span><span class="op" id="4858931">.</span><span class="ident" id="4858932">Func</span>&nbsp;<span class="op" id="4858937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858940">ret</span>&nbsp;<span class="op" id="4858944">:=</span>&nbsp;<span class="ident" id="4858947">link8</span><span class="op" id="4858952">.</span><span class="ident" id="4858953">NewFunc</span><span class="op" id="4858960">(</span><span class="op" id="4858961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858964">for</span>&nbsp;<span class="ident" id="4858968">_</span><span class="op" id="4858969">,</span>&nbsp;<span class="ident" id="4858971">s</span>&nbsp;<span class="op" id="4858973">:=</span>&nbsp;<span class="keyword" id="4858976">range</span>&nbsp;<span class="ident" id="4858982">f</span><span class="op" id="4858983">.</span><span class="ident" id="4858984">stmts</span>&nbsp;<span class="op" id="4858990">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858994">if</span>&nbsp;<span class="ident" id="4858997">s</span><span class="op" id="4858998">.</span><span class="ident" id="4858999">isLabel</span><span class="op" id="4859006">(</span><span class="op" id="4859007">)</span>&nbsp;<span class="op" id="4859009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859014">continue</span>&nbsp;<span class="comment" id="4859023">//&nbsp;skip&nbsp;labels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4859040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4859044">ret</span><span class="op" id="4859047">.</span><span class="ident" id="4859048">AddInst</span><span class="op" id="4859055">(</span><span class="ident" id="4859056">s</span><span class="op" id="4859057">.</span><span class="ident" id="4859058">inst</span><span class="op" id="4859062">.</span><span class="ident" id="4859063">inst</span><span class="op" id="4859067">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859072">if</span>&nbsp;<span class="op" id="4859075">!</span><span class="op" id="4859076">(</span><span class="ident" id="4859077">s</span><span class="op" id="4859078">.</span><span class="ident" id="4859079">fill</span>&nbsp;<span class="op" id="4859084">&gt;</span>&nbsp;<span class="ident" id="4859086">fillNone</span>&nbsp;<span class="op" id="4859095">&amp;&amp;</span>&nbsp;<span class="ident" id="4859098">s</span><span class="op" id="4859099">.</span><span class="ident" id="4859100">fill</span>&nbsp;<span class="op" id="4859105">&lt;</span>&nbsp;<span class="ident" id="4859107">fillLabel</span><span class="op" id="4859116">)</span>&nbsp;<span class="op" id="4859118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859123">continue</span>&nbsp;<span class="comment" id="4859132">//&nbsp;only&nbsp;care&nbsp;about&nbsp;fillHigh,&nbsp;fillLow&nbsp;and&nbsp;fillLink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4859184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4859189">linkSymbol</span><span class="op" id="4859199">(</span><span class="ident" id="4859200">b</span><span class="op" id="4859201">,</span>&nbsp;<span class="ident" id="4859203">s</span><span class="op" id="4859204">,</span>&nbsp;<span class="ident" id="4859206">ret</span><span class="op" id="4859209">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4859212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859216">if</span>&nbsp;<span class="ident" id="4859219">ret</span><span class="op" id="4859222">.</span><span class="ident" id="4859223">TooLarge</span><span class="op" id="4859231">(</span><span class="op" id="4859232">)</span>&nbsp;<span class="op" id="4859234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4859238">b</span><span class="op" id="4859239">.</span><span class="ident" id="4859240">err</span><span class="op" id="4859243">(</span><span class="ident" id="4859244">f</span><span class="op" id="4859245">.</span><span class="ident" id="4859246">name</span><span class="op" id="4859250">.</span><span class="ident" id="4859251">Pos</span><span class="op" id="4859254">,</span>&nbsp;<span class="string" id="4859256">&#34;too&nbsp;many&nbsp;instructions&nbsp;in&nbsp;func&#34;</span><span class="op" id="4859287">,</span>&nbsp;<span class="ident" id="4859289">f</span><span class="op" id="4859290">.</span><span class="ident" id="4859291">name</span><span class="op" id="4859295">.</span><span class="ident" id="4859296">Lit</span><span class="op" id="4859299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4859302">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859306">return</span>&nbsp;<span class="ident" id="4859313">ret</span><br>
<span class="lineno"></span><span class="op" id="4859317">}</span>
</div>
</body>
</html>
