<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5941771">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5941826">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5941880">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5941931">package</span>&nbsp;<span class="ident" id="5941939">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5941944">import</span>&nbsp;<span class="op" id="5941951">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5941954">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5941963">&#34;encoding/binary&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5941982">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5941992">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5942000">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5942014">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5942020">&#34;os&#34;</span><br>
<span class="lineno">15</span><span class="op" id="5942025">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5942028">var</span>&nbsp;<span class="op" id="5942032">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942035">ErrFormat</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5942048">=</span>&nbsp;<span class="ident" id="5942050">errors</span><span class="op" id="5942056">.</span><span class="ident" id="5942057">New</span><span class="op" id="5942060">(</span><span class="string" id="5942061">&#34;zip:&nbsp;not&nbsp;a&nbsp;valid&nbsp;zip&nbsp;file&#34;</span><span class="op" id="5942088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942091">ErrAlgorithm</span>&nbsp;<span class="op" id="5942104">=</span>&nbsp;<span class="ident" id="5942106">errors</span><span class="op" id="5942112">.</span><span class="ident" id="5942113">New</span><span class="op" id="5942116">(</span><span class="string" id="5942117">&#34;zip:&nbsp;unsupported&nbsp;compression&nbsp;algorithm&#34;</span><span class="op" id="5942157">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942160">ErrChecksum</span>&nbsp;&nbsp;<span class="op" id="5942173">=</span>&nbsp;<span class="ident" id="5942175">errors</span><span class="op" id="5942181">.</span><span class="ident" id="5942182">New</span><span class="op" id="5942185">(</span><span class="string" id="5942186">&#34;zip:&nbsp;checksum&nbsp;error&#34;</span><span class="op" id="5942207">)</span><br>
<span class="lineno"></span><span class="op" id="5942209">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5942212">type</span>&nbsp;<span class="ident" id="5942217">Reader</span>&nbsp;<span class="keyword" id="5942224">struct</span>&nbsp;<span class="op" id="5942231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942234">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5942242">io</span><span class="op" id="5942244">.</span><span class="ident" id="5942245">ReaderAt</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942255">File</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5942263">[</span><span class="op" id="5942264">]</span><span class="op" id="5942265">*</span><span class="ident" id="5942266">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942272">Comment</span>&nbsp;<span class="builtintype" id="5942280">string</span><br>
<span class="lineno"></span><span class="op" id="5942287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5942290">type</span>&nbsp;<span class="ident" id="5942295">ReadCloser</span>&nbsp;<span class="keyword" id="5942306">struct</span>&nbsp;<span class="op" id="5942313">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942316">f</span>&nbsp;<span class="op" id="5942318">*</span><span class="ident" id="5942319">os</span><span class="op" id="5942321">.</span><span class="ident" id="5942322">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942328">Reader</span><br>
<span class="lineno"></span><span class="op" id="5942335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5942338">type</span>&nbsp;<span class="ident" id="5942343">File</span>&nbsp;<span class="keyword" id="5942348">struct</span>&nbsp;<span class="op" id="5942355">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942358">FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942370">zipr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5942383">io</span><span class="op" id="5942385">.</span><span class="ident" id="5942386">ReaderAt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942396">zipsize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5942409">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942416">headerOffset</span>&nbsp;<span class="ident" id="5942429">int64</span><br>
<span class="lineno"></span><span class="op" id="5942435">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="5942438">func</span>&nbsp;<span class="op" id="5942443">(</span><span class="ident" id="5942444">f</span>&nbsp;<span class="op" id="5942446">*</span><span class="ident" id="5942447">File</span><span class="op" id="5942451">)</span>&nbsp;<span class="ident" id="5942453">hasDataDescriptor</span><span class="op" id="5942470">(</span><span class="op" id="5942471">)</span>&nbsp;<span class="builtintype" id="5942473">bool</span>&nbsp;<span class="op" id="5942478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942481">return</span>&nbsp;<span class="ident" id="5942488">f</span><span class="op" id="5942489">.</span><span class="ident" id="5942490">Flags</span><span class="op" id="5942495">&amp;</span><span class="num" id="5942496">0x8</span>&nbsp;<span class="op" id="5942500">!=</span>&nbsp;<span class="num" id="5942503">0</span><br>
<span class="lineno"></span><span class="op" id="5942505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="5942508">//&nbsp;OpenReader&nbsp;will&nbsp;open&nbsp;the&nbsp;Zip&nbsp;file&nbsp;specified&nbsp;by&nbsp;name&nbsp;and&nbsp;return&nbsp;a&nbsp;ReadCloser.</span><br>
<span class="lineno"></span><span class="keyword" id="5942588">func</span>&nbsp;<span class="ident" id="5942593">OpenReader</span><span class="op" id="5942603">(</span><span class="ident" id="5942604">name</span>&nbsp;<span class="builtintype" id="5942609">string</span><span class="op" id="5942615">)</span>&nbsp;<span class="op" id="5942617">(</span><span class="op" id="5942618">*</span><span class="ident" id="5942619">ReadCloser</span><span class="op" id="5942629">,</span>&nbsp;<span class="builtintype" id="5942631">error</span><span class="op" id="5942636">)</span>&nbsp;<span class="op" id="5942638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942641">f</span><span class="op" id="5942642">,</span>&nbsp;<span class="ident" id="5942644">err</span>&nbsp;<span class="op" id="5942648">:=</span>&nbsp;<span class="ident" id="5942651">os</span><span class="op" id="5942653">.</span><span class="ident" id="5942654">Open</span><span class="op" id="5942658">(</span><span class="ident" id="5942659">name</span><span class="op" id="5942663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942666">if</span>&nbsp;<span class="ident" id="5942669">err</span>&nbsp;<span class="op" id="5942673">!=</span>&nbsp;<span class="ident" id="5942676">nil</span>&nbsp;<span class="op" id="5942680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942684">return</span>&nbsp;<span class="ident" id="5942691">nil</span><span class="op" id="5942694">,</span>&nbsp;<span class="ident" id="5942696">err</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5942701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942704">fi</span><span class="op" id="5942706">,</span>&nbsp;<span class="ident" id="5942708">err</span>&nbsp;<span class="op" id="5942712">:=</span>&nbsp;<span class="ident" id="5942715">f</span><span class="op" id="5942716">.</span><span class="ident" id="5942717">Stat</span><span class="op" id="5942721">(</span><span class="op" id="5942722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942725">if</span>&nbsp;<span class="ident" id="5942728">err</span>&nbsp;<span class="op" id="5942732">!=</span>&nbsp;<span class="ident" id="5942735">nil</span>&nbsp;<span class="op" id="5942739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942743">f</span><span class="op" id="5942744">.</span><span class="ident" id="5942745">Close</span><span class="op" id="5942750">(</span><span class="op" id="5942751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942755">return</span>&nbsp;<span class="ident" id="5942762">nil</span><span class="op" id="5942765">,</span>&nbsp;<span class="ident" id="5942767">err</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5942772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942775">r</span>&nbsp;<span class="op" id="5942777">:=</span>&nbsp;<span class="builtinfunc" id="5942780">new</span><span class="op" id="5942783">(</span><span class="ident" id="5942784">ReadCloser</span><span class="op" id="5942794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942797">if</span>&nbsp;<span class="ident" id="5942800">err</span>&nbsp;<span class="op" id="5942804">:=</span>&nbsp;<span class="ident" id="5942807">r</span><span class="op" id="5942808">.</span><span class="ident" id="5942809">init</span><span class="op" id="5942813">(</span><span class="ident" id="5942814">f</span><span class="op" id="5942815">,</span>&nbsp;<span class="ident" id="5942817">fi</span><span class="op" id="5942819">.</span><span class="ident" id="5942820">Size</span><span class="op" id="5942824">(</span><span class="op" id="5942825">)</span><span class="op" id="5942826">)</span><span class="op" id="5942827">;</span>&nbsp;<span class="ident" id="5942829">err</span>&nbsp;<span class="op" id="5942833">!=</span>&nbsp;<span class="ident" id="5942836">nil</span>&nbsp;<span class="op" id="5942840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942844">f</span><span class="op" id="5942845">.</span><span class="ident" id="5942846">Close</span><span class="op" id="5942851">(</span><span class="op" id="5942852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942856">return</span>&nbsp;<span class="ident" id="5942863">nil</span><span class="op" id="5942866">,</span>&nbsp;<span class="ident" id="5942868">err</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5942873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942876">r</span><span class="op" id="5942877">.</span><span class="ident" id="5942878">f</span>&nbsp;<span class="op" id="5942880">=</span>&nbsp;<span class="ident" id="5942882">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942885">return</span>&nbsp;<span class="ident" id="5942892">r</span><span class="op" id="5942893">,</span>&nbsp;<span class="ident" id="5942895">nil</span><br>
<span class="lineno"></span><span class="op" id="5942899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="5942902">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r,&nbsp;which&nbsp;is&nbsp;assumed&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5942972">//&nbsp;have&nbsp;the&nbsp;given&nbsp;size&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="5943005">func</span>&nbsp;<span class="ident" id="5943010">NewReader</span><span class="op" id="5943019">(</span><span class="ident" id="5943020">r</span>&nbsp;<span class="ident" id="5943022">io</span><span class="op" id="5943024">.</span><span class="ident" id="5943025">ReaderAt</span><span class="op" id="5943033">,</span>&nbsp;<span class="ident" id="5943035">size</span>&nbsp;<span class="ident" id="5943040">int64</span><span class="op" id="5943045">)</span>&nbsp;<span class="op" id="5943047">(</span><span class="op" id="5943048">*</span><span class="ident" id="5943049">Reader</span><span class="op" id="5943055">,</span>&nbsp;<span class="builtintype" id="5943057">error</span><span class="op" id="5943062">)</span>&nbsp;<span class="op" id="5943064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943067">zr</span>&nbsp;<span class="op" id="5943070">:=</span>&nbsp;<span class="builtinfunc" id="5943073">new</span><span class="op" id="5943076">(</span><span class="ident" id="5943077">Reader</span><span class="op" id="5943083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943086">if</span>&nbsp;<span class="ident" id="5943089">err</span>&nbsp;<span class="op" id="5943093">:=</span>&nbsp;<span class="ident" id="5943096">zr</span><span class="op" id="5943098">.</span><span class="ident" id="5943099">init</span><span class="op" id="5943103">(</span><span class="ident" id="5943104">r</span><span class="op" id="5943105">,</span>&nbsp;<span class="ident" id="5943107">size</span><span class="op" id="5943111">)</span><span class="op" id="5943112">;</span>&nbsp;<span class="ident" id="5943114">err</span>&nbsp;<span class="op" id="5943118">!=</span>&nbsp;<span class="ident" id="5943121">nil</span>&nbsp;<span class="op" id="5943125">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943129">return</span>&nbsp;<span class="ident" id="5943136">nil</span><span class="op" id="5943139">,</span>&nbsp;<span class="ident" id="5943141">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5943146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943149">return</span>&nbsp;<span class="ident" id="5943156">zr</span><span class="op" id="5943158">,</span>&nbsp;<span class="ident" id="5943160">nil</span><br>
<span class="lineno"></span><span class="op" id="5943164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="5943167">func</span>&nbsp;<span class="op" id="5943172">(</span><span class="ident" id="5943173">z</span>&nbsp;<span class="op" id="5943175">*</span><span class="ident" id="5943176">Reader</span><span class="op" id="5943182">)</span>&nbsp;<span class="ident" id="5943184">init</span><span class="op" id="5943188">(</span><span class="ident" id="5943189">r</span>&nbsp;<span class="ident" id="5943191">io</span><span class="op" id="5943193">.</span><span class="ident" id="5943194">ReaderAt</span><span class="op" id="5943202">,</span>&nbsp;<span class="ident" id="5943204">size</span>&nbsp;<span class="ident" id="5943209">int64</span><span class="op" id="5943214">)</span>&nbsp;<span class="builtintype" id="5943216">error</span>&nbsp;<span class="op" id="5943222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943225">end</span><span class="op" id="5943228">,</span>&nbsp;<span class="ident" id="5943230">err</span>&nbsp;<span class="op" id="5943234">:=</span>&nbsp;<span class="ident" id="5943237">readDirectoryEnd</span><span class="op" id="5943253">(</span><span class="ident" id="5943254">r</span><span class="op" id="5943255">,</span>&nbsp;<span class="ident" id="5943257">size</span><span class="op" id="5943261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943264">if</span>&nbsp;<span class="ident" id="5943267">err</span>&nbsp;<span class="op" id="5943271">!=</span>&nbsp;<span class="ident" id="5943274">nil</span>&nbsp;<span class="op" id="5943278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943282">return</span>&nbsp;<span class="ident" id="5943289">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5943294">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943297">z</span><span class="op" id="5943298">.</span><span class="ident" id="5943299">r</span>&nbsp;<span class="op" id="5943301">=</span>&nbsp;<span class="ident" id="5943303">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943306">z</span><span class="op" id="5943307">.</span><span class="ident" id="5943308">File</span>&nbsp;<span class="op" id="5943313">=</span>&nbsp;<span class="builtinfunc" id="5943315">make</span><span class="op" id="5943319">(</span><span class="op" id="5943320">[</span><span class="op" id="5943321">]</span><span class="op" id="5943322">*</span><span class="ident" id="5943323">File</span><span class="op" id="5943327">,</span>&nbsp;<span class="num" id="5943329">0</span><span class="op" id="5943330">,</span>&nbsp;<span class="ident" id="5943332">end</span><span class="op" id="5943335">.</span><span class="ident" id="5943336">directoryRecords</span><span class="op" id="5943352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943355">z</span><span class="op" id="5943356">.</span><span class="ident" id="5943357">Comment</span>&nbsp;<span class="op" id="5943365">=</span>&nbsp;<span class="ident" id="5943367">end</span><span class="op" id="5943370">.</span><span class="ident" id="5943371">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943380">rs</span>&nbsp;<span class="op" id="5943383">:=</span>&nbsp;<span class="ident" id="5943386">io</span><span class="op" id="5943388">.</span><span class="ident" id="5943389">NewSectionReader</span><span class="op" id="5943405">(</span><span class="ident" id="5943406">r</span><span class="op" id="5943407">,</span>&nbsp;<span class="num" id="5943409">0</span><span class="op" id="5943410">,</span>&nbsp;<span class="ident" id="5943412">size</span><span class="op" id="5943416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943419">if</span>&nbsp;<span class="ident" id="5943422">_</span><span class="op" id="5943423">,</span>&nbsp;<span class="ident" id="5943425">err</span>&nbsp;<span class="op" id="5943429">=</span>&nbsp;<span class="ident" id="5943431">rs</span><span class="op" id="5943433">.</span><span class="ident" id="5943434">Seek</span><span class="op" id="5943438">(</span><span class="ident" id="5943439">int64</span><span class="op" id="5943444">(</span><span class="ident" id="5943445">end</span><span class="op" id="5943448">.</span><span class="ident" id="5943449">directoryOffset</span><span class="op" id="5943464">)</span><span class="op" id="5943465">,</span>&nbsp;<span class="ident" id="5943467">os</span><span class="op" id="5943469">.</span><span class="ident" id="5943470">SEEK_SET</span><span class="op" id="5943478">)</span><span class="op" id="5943479">;</span>&nbsp;<span class="ident" id="5943481">err</span>&nbsp;<span class="op" id="5943485">!=</span>&nbsp;<span class="ident" id="5943488">nil</span>&nbsp;<span class="op" id="5943492">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943496">return</span>&nbsp;<span class="ident" id="5943503">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5943508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943511">buf</span>&nbsp;<span class="op" id="5943515">:=</span>&nbsp;<span class="ident" id="5943518">bufio</span><span class="op" id="5943523">.</span><span class="ident" id="5943524">NewReader</span><span class="op" id="5943533">(</span><span class="ident" id="5943534">rs</span><span class="op" id="5943536">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5943540">//&nbsp;The&nbsp;count&nbsp;of&nbsp;files&nbsp;inside&nbsp;a&nbsp;zip&nbsp;is&nbsp;truncated&nbsp;to&nbsp;fit&nbsp;in&nbsp;a&nbsp;uint16.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5943609">//&nbsp;Gloss&nbsp;over&nbsp;this&nbsp;by&nbsp;reading&nbsp;headers&nbsp;until&nbsp;we&nbsp;encounter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5943667">//&nbsp;a&nbsp;bad&nbsp;one,&nbsp;and&nbsp;then&nbsp;only&nbsp;report&nbsp;a&nbsp;ErrFormat&nbsp;or&nbsp;UnexpectedEOF&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5943735">//&nbsp;the&nbsp;file&nbsp;count&nbsp;modulo&nbsp;65536&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943781">for</span>&nbsp;<span class="op" id="5943785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943789">f</span>&nbsp;<span class="op" id="5943791">:=</span>&nbsp;<span class="op" id="5943794">&amp;</span><span class="ident" id="5943795">File</span><span class="op" id="5943799">{</span><span class="ident" id="5943800">zipr</span><span class="op" id="5943804">:</span>&nbsp;<span class="ident" id="5943806">r</span><span class="op" id="5943807">,</span>&nbsp;<span class="ident" id="5943809">zipsize</span><span class="op" id="5943816">:</span>&nbsp;<span class="ident" id="5943818">size</span><span class="op" id="5943822">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943826">err</span>&nbsp;<span class="op" id="5943830">=</span>&nbsp;<span class="ident" id="5943832">readDirectoryHeader</span><span class="op" id="5943851">(</span><span class="ident" id="5943852">f</span><span class="op" id="5943853">,</span>&nbsp;<span class="ident" id="5943855">buf</span><span class="op" id="5943858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943862">if</span>&nbsp;<span class="ident" id="5943865">err</span>&nbsp;<span class="op" id="5943869">==</span>&nbsp;<span class="ident" id="5943872">ErrFormat</span>&nbsp;<span class="op" id="5943882">||</span>&nbsp;<span class="ident" id="5943885">err</span>&nbsp;<span class="op" id="5943889">==</span>&nbsp;<span class="ident" id="5943892">io</span><span class="op" id="5943894">.</span><span class="ident" id="5943895">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="5943912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943917">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5943925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943929">if</span>&nbsp;<span class="ident" id="5943932">err</span>&nbsp;<span class="op" id="5943936">!=</span>&nbsp;<span class="ident" id="5943939">nil</span>&nbsp;<span class="op" id="5943943">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943948">return</span>&nbsp;<span class="ident" id="5943955">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5943961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943965">z</span><span class="op" id="5943966">.</span><span class="ident" id="5943967">File</span>&nbsp;<span class="op" id="5943972">=</span>&nbsp;<span class="builtinfunc" id="5943974">append</span><span class="op" id="5943980">(</span><span class="ident" id="5943981">z</span><span class="op" id="5943982">.</span><span class="ident" id="5943983">File</span><span class="op" id="5943987">,</span>&nbsp;<span class="ident" id="5943989">f</span><span class="op" id="5943990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5943993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943996">if</span>&nbsp;<span class="builtintype" id="5943999">uint16</span><span class="op" id="5944005">(</span><span class="builtinfunc" id="5944006">len</span><span class="op" id="5944009">(</span><span class="ident" id="5944010">z</span><span class="op" id="5944011">.</span><span class="ident" id="5944012">File</span><span class="op" id="5944016">)</span><span class="op" id="5944017">)</span>&nbsp;<span class="op" id="5944019">!=</span>&nbsp;<span class="builtintype" id="5944022">uint16</span><span class="op" id="5944028">(</span><span class="ident" id="5944029">end</span><span class="op" id="5944032">.</span><span class="ident" id="5944033">directoryRecords</span><span class="op" id="5944049">)</span>&nbsp;<span class="op" id="5944051">{</span>&nbsp;<span class="comment" id="5944053">//&nbsp;only&nbsp;compare&nbsp;16&nbsp;bits&nbsp;here</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5944084">//&nbsp;Return&nbsp;the&nbsp;readDirectoryHeader&nbsp;error&nbsp;if&nbsp;we&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5944137">//&nbsp;the&nbsp;wrong&nbsp;number&nbsp;of&nbsp;directory&nbsp;entries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944181">return</span>&nbsp;<span class="ident" id="5944188">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5944193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944196">return</span>&nbsp;<span class="ident" id="5944203">nil</span><br>
<span class="lineno">110</span><span class="op" id="5944207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5944210">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Zip&nbsp;file,&nbsp;rendering&nbsp;it&nbsp;unusable&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="keyword" id="5944271">func</span>&nbsp;<span class="op" id="5944276">(</span><span class="ident" id="5944277">rc</span>&nbsp;<span class="op" id="5944280">*</span><span class="ident" id="5944281">ReadCloser</span><span class="op" id="5944291">)</span>&nbsp;<span class="ident" id="5944293">Close</span><span class="op" id="5944298">(</span><span class="op" id="5944299">)</span>&nbsp;<span class="builtintype" id="5944301">error</span>&nbsp;<span class="op" id="5944307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944310">return</span>&nbsp;<span class="ident" id="5944317">rc</span><span class="op" id="5944319">.</span><span class="ident" id="5944320">f</span><span class="op" id="5944321">.</span><span class="ident" id="5944322">Close</span><span class="op" id="5944327">(</span><span class="op" id="5944328">)</span><br>
<span class="lineno">115</span><span class="op" id="5944330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5944333">//&nbsp;DataOffset&nbsp;returns&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;file&#39;s&nbsp;possibly-compressed</span><br>
<span class="lineno"></span><span class="comment" id="5944400">//&nbsp;data,&nbsp;relative&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;zip&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="5944452">//</span><br>
<span class="lineno">120</span><span class="comment" id="5944455">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;instead&nbsp;use&nbsp;Open,&nbsp;which&nbsp;transparently</span><br>
<span class="lineno"></span><span class="comment" id="5944516">//&nbsp;decompresses&nbsp;data&nbsp;and&nbsp;verifies&nbsp;checksums.</span><br>
<span class="lineno"></span><span class="keyword" id="5944561">func</span>&nbsp;<span class="op" id="5944566">(</span><span class="ident" id="5944567">f</span>&nbsp;<span class="op" id="5944569">*</span><span class="ident" id="5944570">File</span><span class="op" id="5944574">)</span>&nbsp;<span class="ident" id="5944576">DataOffset</span><span class="op" id="5944586">(</span><span class="op" id="5944587">)</span>&nbsp;<span class="op" id="5944589">(</span><span class="ident" id="5944590">offset</span>&nbsp;<span class="ident" id="5944597">int64</span><span class="op" id="5944602">,</span>&nbsp;<span class="ident" id="5944604">err</span>&nbsp;<span class="builtintype" id="5944608">error</span><span class="op" id="5944613">)</span>&nbsp;<span class="op" id="5944615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944618">bodyOffset</span><span class="op" id="5944628">,</span>&nbsp;<span class="ident" id="5944630">err</span>&nbsp;<span class="op" id="5944634">:=</span>&nbsp;<span class="ident" id="5944637">f</span><span class="op" id="5944638">.</span><span class="ident" id="5944639">findBodyOffset</span><span class="op" id="5944653">(</span><span class="op" id="5944654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944657">if</span>&nbsp;<span class="ident" id="5944660">err</span>&nbsp;<span class="op" id="5944664">!=</span>&nbsp;<span class="ident" id="5944667">nil</span>&nbsp;<span class="op" id="5944671">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944675">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5944683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944686">return</span>&nbsp;<span class="ident" id="5944693">f</span><span class="op" id="5944694">.</span><span class="ident" id="5944695">headerOffset</span>&nbsp;<span class="op" id="5944708">+</span>&nbsp;<span class="ident" id="5944710">bodyOffset</span><span class="op" id="5944720">,</span>&nbsp;<span class="ident" id="5944722">nil</span><br>
<span class="lineno"></span><span class="op" id="5944726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="5944729">//&nbsp;Open&nbsp;returns&nbsp;a&nbsp;ReadCloser&nbsp;that&nbsp;provides&nbsp;access&nbsp;to&nbsp;the&nbsp;File&#39;s&nbsp;contents.</span><br>
<span class="lineno"></span><span class="comment" id="5944803">//&nbsp;Multiple&nbsp;files&nbsp;may&nbsp;be&nbsp;read&nbsp;concurrently.</span><br>
<span class="lineno"></span><span class="keyword" id="5944847">func</span>&nbsp;<span class="op" id="5944852">(</span><span class="ident" id="5944853">f</span>&nbsp;<span class="op" id="5944855">*</span><span class="ident" id="5944856">File</span><span class="op" id="5944860">)</span>&nbsp;<span class="ident" id="5944862">Open</span><span class="op" id="5944866">(</span><span class="op" id="5944867">)</span>&nbsp;<span class="op" id="5944869">(</span><span class="ident" id="5944870">rc</span>&nbsp;<span class="ident" id="5944873">io</span><span class="op" id="5944875">.</span><span class="ident" id="5944876">ReadCloser</span><span class="op" id="5944886">,</span>&nbsp;<span class="ident" id="5944888">err</span>&nbsp;<span class="builtintype" id="5944892">error</span><span class="op" id="5944897">)</span>&nbsp;<span class="op" id="5944899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944902">bodyOffset</span><span class="op" id="5944912">,</span>&nbsp;<span class="ident" id="5944914">err</span>&nbsp;<span class="op" id="5944918">:=</span>&nbsp;<span class="ident" id="5944921">f</span><span class="op" id="5944922">.</span><span class="ident" id="5944923">findBodyOffset</span><span class="op" id="5944937">(</span><span class="op" id="5944938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944941">if</span>&nbsp;<span class="ident" id="5944944">err</span>&nbsp;<span class="op" id="5944948">!=</span>&nbsp;<span class="ident" id="5944951">nil</span>&nbsp;<span class="op" id="5944955">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944959">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5944967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944970">size</span>&nbsp;<span class="op" id="5944975">:=</span>&nbsp;<span class="ident" id="5944978">int64</span><span class="op" id="5944983">(</span><span class="ident" id="5944984">f</span><span class="op" id="5944985">.</span><span class="ident" id="5944986">CompressedSize64</span><span class="op" id="5945002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945005">r</span>&nbsp;<span class="op" id="5945007">:=</span>&nbsp;<span class="ident" id="5945010">io</span><span class="op" id="5945012">.</span><span class="ident" id="5945013">NewSectionReader</span><span class="op" id="5945029">(</span><span class="ident" id="5945030">f</span><span class="op" id="5945031">.</span><span class="ident" id="5945032">zipr</span><span class="op" id="5945036">,</span>&nbsp;<span class="ident" id="5945038">f</span><span class="op" id="5945039">.</span><span class="ident" id="5945040">headerOffset</span><span class="op" id="5945052">+</span><span class="ident" id="5945053">bodyOffset</span><span class="op" id="5945063">,</span>&nbsp;<span class="ident" id="5945065">size</span><span class="op" id="5945069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945072">dcomp</span>&nbsp;<span class="op" id="5945078">:=</span>&nbsp;<span class="ident" id="5945081">decompressor</span><span class="op" id="5945093">(</span><span class="ident" id="5945094">f</span><span class="op" id="5945095">.</span><span class="ident" id="5945096">Method</span><span class="op" id="5945102">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945105">if</span>&nbsp;<span class="ident" id="5945108">dcomp</span>&nbsp;<span class="op" id="5945114">==</span>&nbsp;<span class="ident" id="5945117">nil</span>&nbsp;<span class="op" id="5945121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945125">err</span>&nbsp;<span class="op" id="5945129">=</span>&nbsp;<span class="ident" id="5945131">ErrAlgorithm</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945146">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5945154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945157">rc</span>&nbsp;<span class="op" id="5945160">=</span>&nbsp;<span class="ident" id="5945162">dcomp</span><span class="op" id="5945167">(</span><span class="ident" id="5945168">r</span><span class="op" id="5945169">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945172">var</span>&nbsp;<span class="ident" id="5945176">desr</span>&nbsp;<span class="ident" id="5945181">io</span><span class="op" id="5945183">.</span><span class="ident" id="5945184">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945192">if</span>&nbsp;<span class="ident" id="5945195">f</span><span class="op" id="5945196">.</span><span class="ident" id="5945197">hasDataDescriptor</span><span class="op" id="5945214">(</span><span class="op" id="5945215">)</span>&nbsp;<span class="op" id="5945217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945221">desr</span>&nbsp;<span class="op" id="5945226">=</span>&nbsp;<span class="ident" id="5945228">io</span><span class="op" id="5945230">.</span><span class="ident" id="5945231">NewSectionReader</span><span class="op" id="5945247">(</span><span class="ident" id="5945248">f</span><span class="op" id="5945249">.</span><span class="ident" id="5945250">zipr</span><span class="op" id="5945254">,</span>&nbsp;<span class="ident" id="5945256">f</span><span class="op" id="5945257">.</span><span class="ident" id="5945258">headerOffset</span><span class="op" id="5945270">+</span><span class="ident" id="5945271">bodyOffset</span><span class="op" id="5945281">+</span><span class="ident" id="5945282">size</span><span class="op" id="5945286">,</span>&nbsp;<span class="ident" id="5945288">dataDescriptorLen</span><span class="op" id="5945305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5945308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945311">rc</span>&nbsp;<span class="op" id="5945314">=</span>&nbsp;<span class="op" id="5945316">&amp;</span><span class="ident" id="5945317">checksumReader</span><span class="op" id="5945331">{</span><span class="ident" id="5945332">rc</span><span class="op" id="5945334">,</span>&nbsp;<span class="ident" id="5945336">crc32</span><span class="op" id="5945341">.</span><span class="ident" id="5945342">NewIEEE</span><span class="op" id="5945349">(</span><span class="op" id="5945350">)</span><span class="op" id="5945351">,</span>&nbsp;<span class="ident" id="5945353">f</span><span class="op" id="5945354">,</span>&nbsp;<span class="ident" id="5945356">desr</span><span class="op" id="5945360">,</span>&nbsp;<span class="ident" id="5945362">nil</span><span class="op" id="5945365">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945368">return</span><br>
<span class="lineno"></span><span class="op" id="5945375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5945378">type</span>&nbsp;<span class="ident" id="5945383">checksumReader</span>&nbsp;<span class="keyword" id="5945398">struct</span>&nbsp;<span class="op" id="5945405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945408">rc</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5945413">io</span><span class="op" id="5945415">.</span><span class="ident" id="5945416">ReadCloser</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945428">hash</span>&nbsp;<span class="ident" id="5945433">hash</span><span class="op" id="5945437">.</span><span class="ident" id="5945438">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945446">f</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5945451">*</span><span class="ident" id="5945452">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945458">desr</span>&nbsp;<span class="ident" id="5945463">io</span><span class="op" id="5945465">.</span><span class="ident" id="5945466">Reader</span>&nbsp;<span class="comment" id="5945473">//&nbsp;if&nbsp;non-nil,&nbsp;where&nbsp;to&nbsp;read&nbsp;the&nbsp;data&nbsp;descriptor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945523">err</span>&nbsp;&nbsp;<span class="builtintype" id="5945528">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5945538">//&nbsp;sticky&nbsp;error</span><br>
<span class="lineno"></span><span class="op" id="5945554">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="5945557">func</span>&nbsp;<span class="op" id="5945562">(</span><span class="ident" id="5945563">r</span>&nbsp;<span class="op" id="5945565">*</span><span class="ident" id="5945566">checksumReader</span><span class="op" id="5945580">)</span>&nbsp;<span class="ident" id="5945582">Read</span><span class="op" id="5945586">(</span><span class="ident" id="5945587">b</span>&nbsp;<span class="op" id="5945589">[</span><span class="op" id="5945590">]</span><span class="builtintype" id="5945591">byte</span><span class="op" id="5945595">)</span>&nbsp;<span class="op" id="5945597">(</span><span class="ident" id="5945598">n</span>&nbsp;<span class="builtintype" id="5945600">int</span><span class="op" id="5945603">,</span>&nbsp;<span class="ident" id="5945605">err</span>&nbsp;<span class="builtintype" id="5945609">error</span><span class="op" id="5945614">)</span>&nbsp;<span class="op" id="5945616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945619">if</span>&nbsp;<span class="ident" id="5945622">r</span><span class="op" id="5945623">.</span><span class="ident" id="5945624">err</span>&nbsp;<span class="op" id="5945628">!=</span>&nbsp;<span class="ident" id="5945631">nil</span>&nbsp;<span class="op" id="5945635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945639">return</span>&nbsp;<span class="num" id="5945646">0</span><span class="op" id="5945647">,</span>&nbsp;<span class="ident" id="5945649">r</span><span class="op" id="5945650">.</span><span class="ident" id="5945651">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5945656">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945659">n</span><span class="op" id="5945660">,</span>&nbsp;<span class="ident" id="5945662">err</span>&nbsp;<span class="op" id="5945666">=</span>&nbsp;<span class="ident" id="5945668">r</span><span class="op" id="5945669">.</span><span class="ident" id="5945670">rc</span><span class="op" id="5945672">.</span><span class="ident" id="5945673">Read</span><span class="op" id="5945677">(</span><span class="ident" id="5945678">b</span><span class="op" id="5945679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945682">r</span><span class="op" id="5945683">.</span><span class="ident" id="5945684">hash</span><span class="op" id="5945688">.</span><span class="ident" id="5945689">Write</span><span class="op" id="5945694">(</span><span class="ident" id="5945695">b</span><span class="op" id="5945696">[</span><span class="op" id="5945697">:</span><span class="ident" id="5945698">n</span><span class="op" id="5945699">]</span><span class="op" id="5945700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945703">if</span>&nbsp;<span class="ident" id="5945706">err</span>&nbsp;<span class="op" id="5945710">==</span>&nbsp;<span class="ident" id="5945713">nil</span>&nbsp;<span class="op" id="5945717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945721">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5945729">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945732">if</span>&nbsp;<span class="ident" id="5945735">err</span>&nbsp;<span class="op" id="5945739">==</span>&nbsp;<span class="ident" id="5945742">io</span><span class="op" id="5945744">.</span><span class="ident" id="5945745">EOF</span>&nbsp;<span class="op" id="5945749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945753">if</span>&nbsp;<span class="ident" id="5945756">r</span><span class="op" id="5945757">.</span><span class="ident" id="5945758">desr</span>&nbsp;<span class="op" id="5945763">!=</span>&nbsp;<span class="ident" id="5945766">nil</span>&nbsp;<span class="op" id="5945770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945775">if</span>&nbsp;<span class="ident" id="5945778">err1</span>&nbsp;<span class="op" id="5945783">:=</span>&nbsp;<span class="ident" id="5945786">readDataDescriptor</span><span class="op" id="5945804">(</span><span class="ident" id="5945805">r</span><span class="op" id="5945806">.</span><span class="ident" id="5945807">desr</span><span class="op" id="5945811">,</span>&nbsp;<span class="ident" id="5945813">r</span><span class="op" id="5945814">.</span><span class="ident" id="5945815">f</span><span class="op" id="5945816">)</span><span class="op" id="5945817">;</span>&nbsp;<span class="ident" id="5945819">err1</span>&nbsp;<span class="op" id="5945824">!=</span>&nbsp;<span class="ident" id="5945827">nil</span>&nbsp;<span class="op" id="5945831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945837">err</span>&nbsp;<span class="op" id="5945841">=</span>&nbsp;<span class="ident" id="5945843">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5945851">}</span>&nbsp;<span class="keyword" id="5945853">else</span>&nbsp;<span class="keyword" id="5945858">if</span>&nbsp;<span class="ident" id="5945861">r</span><span class="op" id="5945862">.</span><span class="ident" id="5945863">hash</span><span class="op" id="5945867">.</span><span class="ident" id="5945868">Sum32</span><span class="op" id="5945873">(</span><span class="op" id="5945874">)</span>&nbsp;<span class="op" id="5945876">!=</span>&nbsp;<span class="ident" id="5945879">r</span><span class="op" id="5945880">.</span><span class="ident" id="5945881">f</span><span class="op" id="5945882">.</span><span class="ident" id="5945883">CRC32</span>&nbsp;<span class="op" id="5945889">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945895">err</span>&nbsp;<span class="op" id="5945899">=</span>&nbsp;<span class="ident" id="5945901">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5945916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5945920">}</span>&nbsp;<span class="keyword" id="5945922">else</span>&nbsp;<span class="op" id="5945927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5945932">//&nbsp;If&nbsp;there&#39;s&nbsp;not&nbsp;a&nbsp;data&nbsp;descriptor,&nbsp;we&nbsp;still&nbsp;compare</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5945989">//&nbsp;the&nbsp;CRC32&nbsp;of&nbsp;what&nbsp;we&#39;ve&nbsp;read&nbsp;against&nbsp;the&nbsp;file&nbsp;header</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5946048">//&nbsp;or&nbsp;TOC&#39;s&nbsp;CRC32,&nbsp;if&nbsp;it&nbsp;seems&nbsp;like&nbsp;it&nbsp;was&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946099">if</span>&nbsp;<span class="ident" id="5946102">r</span><span class="op" id="5946103">.</span><span class="ident" id="5946104">f</span><span class="op" id="5946105">.</span><span class="ident" id="5946106">CRC32</span>&nbsp;<span class="op" id="5946112">!=</span>&nbsp;<span class="num" id="5946115">0</span>&nbsp;<span class="op" id="5946117">&amp;&amp;</span>&nbsp;<span class="ident" id="5946120">r</span><span class="op" id="5946121">.</span><span class="ident" id="5946122">hash</span><span class="op" id="5946126">.</span><span class="ident" id="5946127">Sum32</span><span class="op" id="5946132">(</span><span class="op" id="5946133">)</span>&nbsp;<span class="op" id="5946135">!=</span>&nbsp;<span class="ident" id="5946138">r</span><span class="op" id="5946139">.</span><span class="ident" id="5946140">f</span><span class="op" id="5946141">.</span><span class="ident" id="5946142">CRC32</span>&nbsp;<span class="op" id="5946148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946154">err</span>&nbsp;<span class="op" id="5946158">=</span>&nbsp;<span class="ident" id="5946160">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5946175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5946179">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5946182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946185">r</span><span class="op" id="5946186">.</span><span class="ident" id="5946187">err</span>&nbsp;<span class="op" id="5946191">=</span>&nbsp;<span class="ident" id="5946193">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946198">return</span><br>
<span class="lineno"></span><span class="op" id="5946205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="5946208">func</span>&nbsp;<span class="op" id="5946213">(</span><span class="ident" id="5946214">r</span>&nbsp;<span class="op" id="5946216">*</span><span class="ident" id="5946217">checksumReader</span><span class="op" id="5946231">)</span>&nbsp;<span class="ident" id="5946233">Close</span><span class="op" id="5946238">(</span><span class="op" id="5946239">)</span>&nbsp;<span class="builtintype" id="5946241">error</span>&nbsp;<span class="op" id="5946247">{</span>&nbsp;<span class="keyword" id="5946249">return</span>&nbsp;<span class="ident" id="5946256">r</span><span class="op" id="5946257">.</span><span class="ident" id="5946258">rc</span><span class="op" id="5946260">.</span><span class="ident" id="5946261">Close</span><span class="op" id="5946266">(</span><span class="op" id="5946267">)</span>&nbsp;<span class="op" id="5946269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5946272">//&nbsp;findBodyOffset&nbsp;does&nbsp;the&nbsp;minimum&nbsp;work&nbsp;to&nbsp;verify&nbsp;the&nbsp;file&nbsp;has&nbsp;a&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="5946344">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;file&nbsp;body&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="5946381">func</span>&nbsp;<span class="op" id="5946386">(</span><span class="ident" id="5946387">f</span>&nbsp;<span class="op" id="5946389">*</span><span class="ident" id="5946390">File</span><span class="op" id="5946394">)</span>&nbsp;<span class="ident" id="5946396">findBodyOffset</span><span class="op" id="5946410">(</span><span class="op" id="5946411">)</span>&nbsp;<span class="op" id="5946413">(</span><span class="ident" id="5946414">int64</span><span class="op" id="5946419">,</span>&nbsp;<span class="builtintype" id="5946421">error</span><span class="op" id="5946426">)</span>&nbsp;<span class="op" id="5946428">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946431">var</span>&nbsp;<span class="ident" id="5946435">buf</span>&nbsp;<span class="op" id="5946439">[</span><span class="ident" id="5946440">fileHeaderLen</span><span class="op" id="5946453">]</span><span class="builtintype" id="5946454">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946460">if</span>&nbsp;<span class="ident" id="5946463">_</span><span class="op" id="5946464">,</span>&nbsp;<span class="ident" id="5946466">err</span>&nbsp;<span class="op" id="5946470">:=</span>&nbsp;<span class="ident" id="5946473">f</span><span class="op" id="5946474">.</span><span class="ident" id="5946475">zipr</span><span class="op" id="5946479">.</span><span class="ident" id="5946480">ReadAt</span><span class="op" id="5946486">(</span><span class="ident" id="5946487">buf</span><span class="op" id="5946490">[</span><span class="op" id="5946491">:</span><span class="op" id="5946492">]</span><span class="op" id="5946493">,</span>&nbsp;<span class="ident" id="5946495">f</span><span class="op" id="5946496">.</span><span class="ident" id="5946497">headerOffset</span><span class="op" id="5946509">)</span><span class="op" id="5946510">;</span>&nbsp;<span class="ident" id="5946512">err</span>&nbsp;<span class="op" id="5946516">!=</span>&nbsp;<span class="ident" id="5946519">nil</span>&nbsp;<span class="op" id="5946523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946527">return</span>&nbsp;<span class="num" id="5946534">0</span><span class="op" id="5946535">,</span>&nbsp;<span class="ident" id="5946537">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5946542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946545">b</span>&nbsp;<span class="op" id="5946547">:=</span>&nbsp;<span class="ident" id="5946550">readBuf</span><span class="op" id="5946557">(</span><span class="ident" id="5946558">buf</span><span class="op" id="5946561">[</span><span class="op" id="5946562">:</span><span class="op" id="5946563">]</span><span class="op" id="5946564">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946567">if</span>&nbsp;<span class="ident" id="5946570">sig</span>&nbsp;<span class="op" id="5946574">:=</span>&nbsp;<span class="ident" id="5946577">b</span><span class="op" id="5946578">.</span><span class="builtintype" id="5946579">uint32</span><span class="op" id="5946585">(</span><span class="op" id="5946586">)</span><span class="op" id="5946587">;</span>&nbsp;<span class="ident" id="5946589">sig</span>&nbsp;<span class="op" id="5946593">!=</span>&nbsp;<span class="ident" id="5946596">fileHeaderSignature</span>&nbsp;<span class="op" id="5946616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946620">return</span>&nbsp;<span class="num" id="5946627">0</span><span class="op" id="5946628">,</span>&nbsp;<span class="ident" id="5946630">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5946641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946644">b</span>&nbsp;<span class="op" id="5946646">=</span>&nbsp;<span class="ident" id="5946648">b</span><span class="op" id="5946649">[</span><span class="num" id="5946650">22</span><span class="op" id="5946652">:</span><span class="op" id="5946653">]</span>&nbsp;<span class="comment" id="5946655">//&nbsp;skip&nbsp;over&nbsp;most&nbsp;of&nbsp;the&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946688">filenameLen</span>&nbsp;<span class="op" id="5946700">:=</span>&nbsp;<span class="builtintype" id="5946703">int</span><span class="op" id="5946706">(</span><span class="ident" id="5946707">b</span><span class="op" id="5946708">.</span><span class="builtintype" id="5946709">uint16</span><span class="op" id="5946715">(</span><span class="op" id="5946716">)</span><span class="op" id="5946717">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946720">extraLen</span>&nbsp;<span class="op" id="5946729">:=</span>&nbsp;<span class="builtintype" id="5946732">int</span><span class="op" id="5946735">(</span><span class="ident" id="5946736">b</span><span class="op" id="5946737">.</span><span class="builtintype" id="5946738">uint16</span><span class="op" id="5946744">(</span><span class="op" id="5946745">)</span><span class="op" id="5946746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946749">return</span>&nbsp;<span class="ident" id="5946756">int64</span><span class="op" id="5946761">(</span><span class="ident" id="5946762">fileHeaderLen</span>&nbsp;<span class="op" id="5946776">+</span>&nbsp;<span class="ident" id="5946778">filenameLen</span>&nbsp;<span class="op" id="5946790">+</span>&nbsp;<span class="ident" id="5946792">extraLen</span><span class="op" id="5946800">)</span><span class="op" id="5946801">,</span>&nbsp;<span class="ident" id="5946803">nil</span><br>
<span class="lineno"></span><span class="op" id="5946807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5946810">//&nbsp;readDirectoryHeader&nbsp;attempts&nbsp;to&nbsp;read&nbsp;a&nbsp;directory&nbsp;header&nbsp;from&nbsp;r.</span><br>
<span class="lineno">210</span><span class="comment" id="5946877">//&nbsp;It&nbsp;returns&nbsp;io.ErrUnexpectedEOF&nbsp;if&nbsp;it&nbsp;cannot&nbsp;read&nbsp;a&nbsp;complete&nbsp;header,</span><br>
<span class="lineno"></span><span class="comment" id="5946948">//&nbsp;and&nbsp;ErrFormat&nbsp;if&nbsp;it&nbsp;doesn&#39;t&nbsp;find&nbsp;a&nbsp;valid&nbsp;header&nbsp;signature.</span><br>
<span class="lineno"></span><span class="keyword" id="5947010">func</span>&nbsp;<span class="ident" id="5947015">readDirectoryHeader</span><span class="op" id="5947034">(</span><span class="ident" id="5947035">f</span>&nbsp;<span class="op" id="5947037">*</span><span class="ident" id="5947038">File</span><span class="op" id="5947042">,</span>&nbsp;<span class="ident" id="5947044">r</span>&nbsp;<span class="ident" id="5947046">io</span><span class="op" id="5947048">.</span><span class="ident" id="5947049">Reader</span><span class="op" id="5947055">)</span>&nbsp;<span class="builtintype" id="5947057">error</span>&nbsp;<span class="op" id="5947063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947066">var</span>&nbsp;<span class="ident" id="5947070">buf</span>&nbsp;<span class="op" id="5947074">[</span><span class="ident" id="5947075">directoryHeaderLen</span><span class="op" id="5947093">]</span><span class="builtintype" id="5947094">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947100">if</span>&nbsp;<span class="ident" id="5947103">_</span><span class="op" id="5947104">,</span>&nbsp;<span class="ident" id="5947106">err</span>&nbsp;<span class="op" id="5947110">:=</span>&nbsp;<span class="ident" id="5947113">io</span><span class="op" id="5947115">.</span><span class="ident" id="5947116">ReadFull</span><span class="op" id="5947124">(</span><span class="ident" id="5947125">r</span><span class="op" id="5947126">,</span>&nbsp;<span class="ident" id="5947128">buf</span><span class="op" id="5947131">[</span><span class="op" id="5947132">:</span><span class="op" id="5947133">]</span><span class="op" id="5947134">)</span><span class="op" id="5947135">;</span>&nbsp;<span class="ident" id="5947137">err</span>&nbsp;<span class="op" id="5947141">!=</span>&nbsp;<span class="ident" id="5947144">nil</span>&nbsp;<span class="op" id="5947148">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947152">return</span>&nbsp;<span class="ident" id="5947159">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5947164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947167">b</span>&nbsp;<span class="op" id="5947169">:=</span>&nbsp;<span class="ident" id="5947172">readBuf</span><span class="op" id="5947179">(</span><span class="ident" id="5947180">buf</span><span class="op" id="5947183">[</span><span class="op" id="5947184">:</span><span class="op" id="5947185">]</span><span class="op" id="5947186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947189">if</span>&nbsp;<span class="ident" id="5947192">sig</span>&nbsp;<span class="op" id="5947196">:=</span>&nbsp;<span class="ident" id="5947199">b</span><span class="op" id="5947200">.</span><span class="builtintype" id="5947201">uint32</span><span class="op" id="5947207">(</span><span class="op" id="5947208">)</span><span class="op" id="5947209">;</span>&nbsp;<span class="ident" id="5947211">sig</span>&nbsp;<span class="op" id="5947215">!=</span>&nbsp;<span class="ident" id="5947218">directoryHeaderSignature</span>&nbsp;<span class="op" id="5947243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947247">return</span>&nbsp;<span class="ident" id="5947254">ErrFormat</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5947265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947268">f</span><span class="op" id="5947269">.</span><span class="ident" id="5947270">CreatorVersion</span>&nbsp;<span class="op" id="5947285">=</span>&nbsp;<span class="ident" id="5947287">b</span><span class="op" id="5947288">.</span><span class="builtintype" id="5947289">uint16</span><span class="op" id="5947295">(</span><span class="op" id="5947296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947299">f</span><span class="op" id="5947300">.</span><span class="ident" id="5947301">ReaderVersion</span>&nbsp;<span class="op" id="5947315">=</span>&nbsp;<span class="ident" id="5947317">b</span><span class="op" id="5947318">.</span><span class="builtintype" id="5947319">uint16</span><span class="op" id="5947325">(</span><span class="op" id="5947326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947329">f</span><span class="op" id="5947330">.</span><span class="ident" id="5947331">Flags</span>&nbsp;<span class="op" id="5947337">=</span>&nbsp;<span class="ident" id="5947339">b</span><span class="op" id="5947340">.</span><span class="builtintype" id="5947341">uint16</span><span class="op" id="5947347">(</span><span class="op" id="5947348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947351">f</span><span class="op" id="5947352">.</span><span class="ident" id="5947353">Method</span>&nbsp;<span class="op" id="5947360">=</span>&nbsp;<span class="ident" id="5947362">b</span><span class="op" id="5947363">.</span><span class="builtintype" id="5947364">uint16</span><span class="op" id="5947370">(</span><span class="op" id="5947371">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947374">f</span><span class="op" id="5947375">.</span><span class="ident" id="5947376">ModifiedTime</span>&nbsp;<span class="op" id="5947389">=</span>&nbsp;<span class="ident" id="5947391">b</span><span class="op" id="5947392">.</span><span class="builtintype" id="5947393">uint16</span><span class="op" id="5947399">(</span><span class="op" id="5947400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947403">f</span><span class="op" id="5947404">.</span><span class="ident" id="5947405">ModifiedDate</span>&nbsp;<span class="op" id="5947418">=</span>&nbsp;<span class="ident" id="5947420">b</span><span class="op" id="5947421">.</span><span class="builtintype" id="5947422">uint16</span><span class="op" id="5947428">(</span><span class="op" id="5947429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947432">f</span><span class="op" id="5947433">.</span><span class="ident" id="5947434">CRC32</span>&nbsp;<span class="op" id="5947440">=</span>&nbsp;<span class="ident" id="5947442">b</span><span class="op" id="5947443">.</span><span class="builtintype" id="5947444">uint32</span><span class="op" id="5947450">(</span><span class="op" id="5947451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947454">f</span><span class="op" id="5947455">.</span><span class="ident" id="5947456">CompressedSize</span>&nbsp;<span class="op" id="5947471">=</span>&nbsp;<span class="ident" id="5947473">b</span><span class="op" id="5947474">.</span><span class="builtintype" id="5947475">uint32</span><span class="op" id="5947481">(</span><span class="op" id="5947482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947485">f</span><span class="op" id="5947486">.</span><span class="ident" id="5947487">UncompressedSize</span>&nbsp;<span class="op" id="5947504">=</span>&nbsp;<span class="ident" id="5947506">b</span><span class="op" id="5947507">.</span><span class="builtintype" id="5947508">uint32</span><span class="op" id="5947514">(</span><span class="op" id="5947515">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947518">f</span><span class="op" id="5947519">.</span><span class="ident" id="5947520">CompressedSize64</span>&nbsp;<span class="op" id="5947537">=</span>&nbsp;<span class="ident" id="5947539">uint64</span><span class="op" id="5947545">(</span><span class="ident" id="5947546">f</span><span class="op" id="5947547">.</span><span class="ident" id="5947548">CompressedSize</span><span class="op" id="5947562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947565">f</span><span class="op" id="5947566">.</span><span class="ident" id="5947567">UncompressedSize64</span>&nbsp;<span class="op" id="5947586">=</span>&nbsp;<span class="ident" id="5947588">uint64</span><span class="op" id="5947594">(</span><span class="ident" id="5947595">f</span><span class="op" id="5947596">.</span><span class="ident" id="5947597">UncompressedSize</span><span class="op" id="5947613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947616">filenameLen</span>&nbsp;<span class="op" id="5947628">:=</span>&nbsp;<span class="builtintype" id="5947631">int</span><span class="op" id="5947634">(</span><span class="ident" id="5947635">b</span><span class="op" id="5947636">.</span><span class="builtintype" id="5947637">uint16</span><span class="op" id="5947643">(</span><span class="op" id="5947644">)</span><span class="op" id="5947645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947648">extraLen</span>&nbsp;<span class="op" id="5947657">:=</span>&nbsp;<span class="builtintype" id="5947660">int</span><span class="op" id="5947663">(</span><span class="ident" id="5947664">b</span><span class="op" id="5947665">.</span><span class="builtintype" id="5947666">uint16</span><span class="op" id="5947672">(</span><span class="op" id="5947673">)</span><span class="op" id="5947674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947677">commentLen</span>&nbsp;<span class="op" id="5947688">:=</span>&nbsp;<span class="builtintype" id="5947691">int</span><span class="op" id="5947694">(</span><span class="ident" id="5947695">b</span><span class="op" id="5947696">.</span><span class="builtintype" id="5947697">uint16</span><span class="op" id="5947703">(</span><span class="op" id="5947704">)</span><span class="op" id="5947705">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947708">b</span>&nbsp;<span class="op" id="5947710">=</span>&nbsp;<span class="ident" id="5947712">b</span><span class="op" id="5947713">[</span><span class="num" id="5947714">4</span><span class="op" id="5947715">:</span><span class="op" id="5947716">]</span>&nbsp;<span class="comment" id="5947718">//&nbsp;skipped&nbsp;start&nbsp;disk&nbsp;number&nbsp;and&nbsp;internal&nbsp;attributes&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947784">f</span><span class="op" id="5947785">.</span><span class="ident" id="5947786">ExternalAttrs</span>&nbsp;<span class="op" id="5947800">=</span>&nbsp;<span class="ident" id="5947802">b</span><span class="op" id="5947803">.</span><span class="builtintype" id="5947804">uint32</span><span class="op" id="5947810">(</span><span class="op" id="5947811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947814">f</span><span class="op" id="5947815">.</span><span class="ident" id="5947816">headerOffset</span>&nbsp;<span class="op" id="5947829">=</span>&nbsp;<span class="ident" id="5947831">int64</span><span class="op" id="5947836">(</span><span class="ident" id="5947837">b</span><span class="op" id="5947838">.</span><span class="builtintype" id="5947839">uint32</span><span class="op" id="5947845">(</span><span class="op" id="5947846">)</span><span class="op" id="5947847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947850">d</span>&nbsp;<span class="op" id="5947852">:=</span>&nbsp;<span class="builtinfunc" id="5947855">make</span><span class="op" id="5947859">(</span><span class="op" id="5947860">[</span><span class="op" id="5947861">]</span><span class="builtintype" id="5947862">byte</span><span class="op" id="5947866">,</span>&nbsp;<span class="ident" id="5947868">filenameLen</span><span class="op" id="5947879">+</span><span class="ident" id="5947880">extraLen</span><span class="op" id="5947888">+</span><span class="ident" id="5947889">commentLen</span><span class="op" id="5947899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947902">if</span>&nbsp;<span class="ident" id="5947905">_</span><span class="op" id="5947906">,</span>&nbsp;<span class="ident" id="5947908">err</span>&nbsp;<span class="op" id="5947912">:=</span>&nbsp;<span class="ident" id="5947915">io</span><span class="op" id="5947917">.</span><span class="ident" id="5947918">ReadFull</span><span class="op" id="5947926">(</span><span class="ident" id="5947927">r</span><span class="op" id="5947928">,</span>&nbsp;<span class="ident" id="5947930">d</span><span class="op" id="5947931">)</span><span class="op" id="5947932">;</span>&nbsp;<span class="ident" id="5947934">err</span>&nbsp;<span class="op" id="5947938">!=</span>&nbsp;<span class="ident" id="5947941">nil</span>&nbsp;<span class="op" id="5947945">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947949">return</span>&nbsp;<span class="ident" id="5947956">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5947961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947964">f</span><span class="op" id="5947965">.</span><span class="ident" id="5947966">Name</span>&nbsp;<span class="op" id="5947971">=</span>&nbsp;<span class="builtintype" id="5947973">string</span><span class="op" id="5947979">(</span><span class="ident" id="5947980">d</span><span class="op" id="5947981">[</span><span class="op" id="5947982">:</span><span class="ident" id="5947983">filenameLen</span><span class="op" id="5947994">]</span><span class="op" id="5947995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947998">f</span><span class="op" id="5947999">.</span><span class="ident" id="5948000">Extra</span>&nbsp;<span class="op" id="5948006">=</span>&nbsp;<span class="ident" id="5948008">d</span><span class="op" id="5948009">[</span><span class="ident" id="5948010">filenameLen</span>&nbsp;<span class="op" id="5948022">:</span>&nbsp;<span class="ident" id="5948024">filenameLen</span><span class="op" id="5948035">+</span><span class="ident" id="5948036">extraLen</span><span class="op" id="5948044">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948047">f</span><span class="op" id="5948048">.</span><span class="ident" id="5948049">Comment</span>&nbsp;<span class="op" id="5948057">=</span>&nbsp;<span class="builtintype" id="5948059">string</span><span class="op" id="5948065">(</span><span class="ident" id="5948066">d</span><span class="op" id="5948067">[</span><span class="ident" id="5948068">filenameLen</span><span class="op" id="5948079">+</span><span class="ident" id="5948080">extraLen</span><span class="op" id="5948088">:</span><span class="op" id="5948089">]</span><span class="op" id="5948090">)</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948094">if</span>&nbsp;<span class="builtinfunc" id="5948097">len</span><span class="op" id="5948100">(</span><span class="ident" id="5948101">f</span><span class="op" id="5948102">.</span><span class="ident" id="5948103">Extra</span><span class="op" id="5948108">)</span>&nbsp;<span class="op" id="5948110">&gt;</span>&nbsp;<span class="num" id="5948112">0</span>&nbsp;<span class="op" id="5948114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948118">b</span>&nbsp;<span class="op" id="5948120">:=</span>&nbsp;<span class="ident" id="5948123">readBuf</span><span class="op" id="5948130">(</span><span class="ident" id="5948131">f</span><span class="op" id="5948132">.</span><span class="ident" id="5948133">Extra</span><span class="op" id="5948138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948142">for</span>&nbsp;<span class="builtinfunc" id="5948146">len</span><span class="op" id="5948149">(</span><span class="ident" id="5948150">b</span><span class="op" id="5948151">)</span>&nbsp;<span class="op" id="5948153">&gt;=</span>&nbsp;<span class="num" id="5948156">4</span>&nbsp;<span class="op" id="5948158">{</span>&nbsp;<span class="comment" id="5948160">//&nbsp;need&nbsp;at&nbsp;least&nbsp;tag&nbsp;and&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948193">tag</span>&nbsp;<span class="op" id="5948197">:=</span>&nbsp;<span class="ident" id="5948200">b</span><span class="op" id="5948201">.</span><span class="builtintype" id="5948202">uint16</span><span class="op" id="5948208">(</span><span class="op" id="5948209">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948214">size</span>&nbsp;<span class="op" id="5948219">:=</span>&nbsp;<span class="ident" id="5948222">b</span><span class="op" id="5948223">.</span><span class="builtintype" id="5948224">uint16</span><span class="op" id="5948230">(</span><span class="op" id="5948231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948236">if</span>&nbsp;<span class="builtintype" id="5948239">int</span><span class="op" id="5948242">(</span><span class="ident" id="5948243">size</span><span class="op" id="5948247">)</span>&nbsp;<span class="op" id="5948249">&gt;</span>&nbsp;<span class="builtinfunc" id="5948251">len</span><span class="op" id="5948254">(</span><span class="ident" id="5948255">b</span><span class="op" id="5948256">)</span>&nbsp;<span class="op" id="5948258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948264">return</span>&nbsp;<span class="ident" id="5948271">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5948284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948289">if</span>&nbsp;<span class="ident" id="5948292">tag</span>&nbsp;<span class="op" id="5948296">==</span>&nbsp;<span class="ident" id="5948299">zip64ExtraId</span>&nbsp;<span class="op" id="5948312">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5948318">//&nbsp;update&nbsp;directory&nbsp;values&nbsp;from&nbsp;the&nbsp;zip64&nbsp;extra&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948376">eb</span>&nbsp;<span class="op" id="5948379">:=</span>&nbsp;<span class="ident" id="5948382">readBuf</span><span class="op" id="5948389">(</span><span class="ident" id="5948390">b</span><span class="op" id="5948391">[</span><span class="op" id="5948392">:</span><span class="ident" id="5948393">size</span><span class="op" id="5948397">]</span><span class="op" id="5948398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948404">if</span>&nbsp;<span class="builtinfunc" id="5948407">len</span><span class="op" id="5948410">(</span><span class="ident" id="5948411">eb</span><span class="op" id="5948413">)</span>&nbsp;<span class="op" id="5948415">&gt;=</span>&nbsp;<span class="num" id="5948418">8</span>&nbsp;<span class="op" id="5948420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948427">f</span><span class="op" id="5948428">.</span><span class="ident" id="5948429">UncompressedSize64</span>&nbsp;<span class="op" id="5948448">=</span>&nbsp;<span class="ident" id="5948450">eb</span><span class="op" id="5948452">.</span><span class="ident" id="5948453">uint64</span><span class="op" id="5948459">(</span><span class="op" id="5948460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5948466">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948472">if</span>&nbsp;<span class="builtinfunc" id="5948475">len</span><span class="op" id="5948478">(</span><span class="ident" id="5948479">eb</span><span class="op" id="5948481">)</span>&nbsp;<span class="op" id="5948483">&gt;=</span>&nbsp;<span class="num" id="5948486">8</span>&nbsp;<span class="op" id="5948488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948495">f</span><span class="op" id="5948496">.</span><span class="ident" id="5948497">CompressedSize64</span>&nbsp;<span class="op" id="5948514">=</span>&nbsp;<span class="ident" id="5948516">eb</span><span class="op" id="5948518">.</span><span class="ident" id="5948519">uint64</span><span class="op" id="5948525">(</span><span class="op" id="5948526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5948532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948538">if</span>&nbsp;<span class="builtinfunc" id="5948541">len</span><span class="op" id="5948544">(</span><span class="ident" id="5948545">eb</span><span class="op" id="5948547">)</span>&nbsp;<span class="op" id="5948549">&gt;=</span>&nbsp;<span class="num" id="5948552">8</span>&nbsp;<span class="op" id="5948554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948561">f</span><span class="op" id="5948562">.</span><span class="ident" id="5948563">headerOffset</span>&nbsp;<span class="op" id="5948576">=</span>&nbsp;<span class="ident" id="5948578">int64</span><span class="op" id="5948583">(</span><span class="ident" id="5948584">eb</span><span class="op" id="5948586">.</span><span class="ident" id="5948587">uint64</span><span class="op" id="5948593">(</span><span class="op" id="5948594">)</span><span class="op" id="5948595">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5948601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5948606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948611">b</span>&nbsp;<span class="op" id="5948613">=</span>&nbsp;<span class="ident" id="5948615">b</span><span class="op" id="5948616">[</span><span class="ident" id="5948617">size</span><span class="op" id="5948621">:</span><span class="op" id="5948622">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5948626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5948630">//&nbsp;Should&nbsp;have&nbsp;consumed&nbsp;the&nbsp;whole&nbsp;header.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5948674">//&nbsp;But&nbsp;popular&nbsp;zip&nbsp;&amp;&nbsp;JAR&nbsp;creation&nbsp;tools&nbsp;are&nbsp;broken&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5948731">//&nbsp;may&nbsp;pad&nbsp;extra&nbsp;zeros&nbsp;at&nbsp;the&nbsp;end,&nbsp;so&nbsp;accept&nbsp;those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5948784">//&nbsp;too.&nbsp;See&nbsp;golang.org/issue/8186.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948821">for</span>&nbsp;<span class="ident" id="5948825">_</span><span class="op" id="5948826">,</span>&nbsp;<span class="ident" id="5948828">v</span>&nbsp;<span class="op" id="5948830">:=</span>&nbsp;<span class="keyword" id="5948833">range</span>&nbsp;<span class="ident" id="5948839">b</span>&nbsp;<span class="op" id="5948841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948846">if</span>&nbsp;<span class="ident" id="5948849">v</span>&nbsp;<span class="op" id="5948851">!=</span>&nbsp;<span class="num" id="5948854">0</span>&nbsp;<span class="op" id="5948856">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948862">return</span>&nbsp;<span class="ident" id="5948869">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5948882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5948886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5948889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948892">return</span>&nbsp;<span class="ident" id="5948899">nil</span><br>
<span class="lineno">280</span><span class="op" id="5948903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5948906">func</span>&nbsp;<span class="ident" id="5948911">readDataDescriptor</span><span class="op" id="5948929">(</span><span class="ident" id="5948930">r</span>&nbsp;<span class="ident" id="5948932">io</span><span class="op" id="5948934">.</span><span class="ident" id="5948935">Reader</span><span class="op" id="5948941">,</span>&nbsp;<span class="ident" id="5948943">f</span>&nbsp;<span class="op" id="5948945">*</span><span class="ident" id="5948946">File</span><span class="op" id="5948950">)</span>&nbsp;<span class="builtintype" id="5948952">error</span>&nbsp;<span class="op" id="5948958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948961">var</span>&nbsp;<span class="ident" id="5948965">buf</span>&nbsp;<span class="op" id="5948969">[</span><span class="ident" id="5948970">dataDescriptorLen</span><span class="op" id="5948987">]</span><span class="builtintype" id="5948988">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5948995">//&nbsp;The&nbsp;spec&nbsp;says:&nbsp;&#34;Although&nbsp;not&nbsp;originally&nbsp;assigned&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5949050">//&nbsp;signature,&nbsp;the&nbsp;value&nbsp;0x08074b50&nbsp;has&nbsp;commonly&nbsp;been&nbsp;adopted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5949112">//&nbsp;as&nbsp;a&nbsp;signature&nbsp;value&nbsp;for&nbsp;the&nbsp;data&nbsp;descriptor&nbsp;record.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5949169">//&nbsp;Implementers&nbsp;should&nbsp;be&nbsp;aware&nbsp;that&nbsp;ZIP&nbsp;files&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5949224">//&nbsp;encountered&nbsp;with&nbsp;or&nbsp;without&nbsp;this&nbsp;signature&nbsp;marking&nbsp;data</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5949284">//&nbsp;descriptors&nbsp;and&nbsp;should&nbsp;account&nbsp;for&nbsp;either&nbsp;case&nbsp;when&nbsp;reading</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5949348">//&nbsp;ZIP&nbsp;files&nbsp;to&nbsp;ensure&nbsp;compatibility.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5949388">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5949392">//&nbsp;dataDescriptorLen&nbsp;includes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;signature&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5949453">//&nbsp;first&nbsp;read&nbsp;just&nbsp;those&nbsp;4&nbsp;bytes&nbsp;to&nbsp;see&nbsp;if&nbsp;it&nbsp;exists.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5949508">if</span>&nbsp;<span class="ident" id="5949511">_</span><span class="op" id="5949512">,</span>&nbsp;<span class="ident" id="5949514">err</span>&nbsp;<span class="op" id="5949518">:=</span>&nbsp;<span class="ident" id="5949521">io</span><span class="op" id="5949523">.</span><span class="ident" id="5949524">ReadFull</span><span class="op" id="5949532">(</span><span class="ident" id="5949533">r</span><span class="op" id="5949534">,</span>&nbsp;<span class="ident" id="5949536">buf</span><span class="op" id="5949539">[</span><span class="op" id="5949540">:</span><span class="num" id="5949541">4</span><span class="op" id="5949542">]</span><span class="op" id="5949543">)</span><span class="op" id="5949544">;</span>&nbsp;<span class="ident" id="5949546">err</span>&nbsp;<span class="op" id="5949550">!=</span>&nbsp;<span class="ident" id="5949553">nil</span>&nbsp;<span class="op" id="5949557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5949561">return</span>&nbsp;<span class="ident" id="5949568">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5949573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949576">off</span>&nbsp;<span class="op" id="5949580">:=</span>&nbsp;<span class="num" id="5949583">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949586">maybeSig</span>&nbsp;<span class="op" id="5949595">:=</span>&nbsp;<span class="ident" id="5949598">readBuf</span><span class="op" id="5949605">(</span><span class="ident" id="5949606">buf</span><span class="op" id="5949609">[</span><span class="op" id="5949610">:</span><span class="num" id="5949611">4</span><span class="op" id="5949612">]</span><span class="op" id="5949613">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5949616">if</span>&nbsp;<span class="ident" id="5949619">maybeSig</span><span class="op" id="5949627">.</span><span class="builtintype" id="5949628">uint32</span><span class="op" id="5949634">(</span><span class="op" id="5949635">)</span>&nbsp;<span class="op" id="5949637">!=</span>&nbsp;<span class="ident" id="5949640">dataDescriptorSignature</span>&nbsp;<span class="op" id="5949664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5949668">//&nbsp;No&nbsp;data&nbsp;descriptor&nbsp;signature.&nbsp;Keep&nbsp;these&nbsp;four</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5949719">//&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949731">off</span>&nbsp;<span class="op" id="5949735">+=</span>&nbsp;<span class="num" id="5949738">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5949741">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5949744">if</span>&nbsp;<span class="ident" id="5949747">_</span><span class="op" id="5949748">,</span>&nbsp;<span class="ident" id="5949750">err</span>&nbsp;<span class="op" id="5949754">:=</span>&nbsp;<span class="ident" id="5949757">io</span><span class="op" id="5949759">.</span><span class="ident" id="5949760">ReadFull</span><span class="op" id="5949768">(</span><span class="ident" id="5949769">r</span><span class="op" id="5949770">,</span>&nbsp;<span class="ident" id="5949772">buf</span><span class="op" id="5949775">[</span><span class="ident" id="5949776">off</span><span class="op" id="5949779">:</span><span class="num" id="5949780">12</span><span class="op" id="5949782">]</span><span class="op" id="5949783">)</span><span class="op" id="5949784">;</span>&nbsp;<span class="ident" id="5949786">err</span>&nbsp;<span class="op" id="5949790">!=</span>&nbsp;<span class="ident" id="5949793">nil</span>&nbsp;<span class="op" id="5949797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5949801">return</span>&nbsp;<span class="ident" id="5949808">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5949813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949816">b</span>&nbsp;<span class="op" id="5949818">:=</span>&nbsp;<span class="ident" id="5949821">readBuf</span><span class="op" id="5949828">(</span><span class="ident" id="5949829">buf</span><span class="op" id="5949832">[</span><span class="op" id="5949833">:</span><span class="num" id="5949834">12</span><span class="op" id="5949836">]</span><span class="op" id="5949837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5949840">if</span>&nbsp;<span class="ident" id="5949843">b</span><span class="op" id="5949844">.</span><span class="builtintype" id="5949845">uint32</span><span class="op" id="5949851">(</span><span class="op" id="5949852">)</span>&nbsp;<span class="op" id="5949854">!=</span>&nbsp;<span class="ident" id="5949857">f</span><span class="op" id="5949858">.</span><span class="ident" id="5949859">CRC32</span>&nbsp;<span class="op" id="5949865">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5949869">return</span>&nbsp;<span class="ident" id="5949876">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5949889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5949893">//&nbsp;The&nbsp;two&nbsp;sizes&nbsp;that&nbsp;follow&nbsp;here&nbsp;can&nbsp;be&nbsp;either&nbsp;32&nbsp;bits&nbsp;or&nbsp;64&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5949961">//&nbsp;but&nbsp;the&nbsp;spec&nbsp;is&nbsp;not&nbsp;very&nbsp;clear&nbsp;on&nbsp;this&nbsp;and&nbsp;different</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5950018">//&nbsp;interpretations&nbsp;has&nbsp;been&nbsp;made&nbsp;causing&nbsp;incompatibilities.&nbsp;We</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5950082">//&nbsp;already&nbsp;have&nbsp;the&nbsp;sizes&nbsp;from&nbsp;the&nbsp;central&nbsp;directory&nbsp;so&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5950146">//&nbsp;just&nbsp;ignore&nbsp;these.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950170">return</span>&nbsp;<span class="ident" id="5950177">nil</span><br>
<span class="lineno">320</span><span class="op" id="5950181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5950184">func</span>&nbsp;<span class="ident" id="5950189">readDirectoryEnd</span><span class="op" id="5950205">(</span><span class="ident" id="5950206">r</span>&nbsp;<span class="ident" id="5950208">io</span><span class="op" id="5950210">.</span><span class="ident" id="5950211">ReaderAt</span><span class="op" id="5950219">,</span>&nbsp;<span class="ident" id="5950221">size</span>&nbsp;<span class="ident" id="5950226">int64</span><span class="op" id="5950231">)</span>&nbsp;<span class="op" id="5950233">(</span><span class="ident" id="5950234">dir</span>&nbsp;<span class="op" id="5950238">*</span><span class="ident" id="5950239">directoryEnd</span><span class="op" id="5950251">,</span>&nbsp;<span class="ident" id="5950253">err</span>&nbsp;<span class="builtintype" id="5950257">error</span><span class="op" id="5950262">)</span>&nbsp;<span class="op" id="5950264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5950267">//&nbsp;look&nbsp;for&nbsp;directoryEndSignature&nbsp;in&nbsp;the&nbsp;last&nbsp;1k,&nbsp;then&nbsp;in&nbsp;the&nbsp;last&nbsp;65k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950339">var</span>&nbsp;<span class="ident" id="5950343">buf</span>&nbsp;<span class="op" id="5950347">[</span><span class="op" id="5950348">]</span><span class="builtintype" id="5950349">byte</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950355">var</span>&nbsp;<span class="ident" id="5950359">directoryEndOffset</span>&nbsp;<span class="ident" id="5950378">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950385">for</span>&nbsp;<span class="ident" id="5950389">i</span><span class="op" id="5950390">,</span>&nbsp;<span class="ident" id="5950392">bLen</span>&nbsp;<span class="op" id="5950397">:=</span>&nbsp;<span class="keyword" id="5950400">range</span>&nbsp;<span class="op" id="5950406">[</span><span class="op" id="5950407">]</span><span class="ident" id="5950408">int64</span><span class="op" id="5950413">{</span><span class="num" id="5950414">1024</span><span class="op" id="5950418">,</span>&nbsp;<span class="num" id="5950420">65</span>&nbsp;<span class="op" id="5950423">*</span>&nbsp;<span class="num" id="5950425">1024</span><span class="op" id="5950429">}</span>&nbsp;<span class="op" id="5950431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950435">if</span>&nbsp;<span class="ident" id="5950438">bLen</span>&nbsp;<span class="op" id="5950443">&gt;</span>&nbsp;<span class="ident" id="5950445">size</span>&nbsp;<span class="op" id="5950450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950455">bLen</span>&nbsp;<span class="op" id="5950460">=</span>&nbsp;<span class="ident" id="5950462">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5950469">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950473">buf</span>&nbsp;<span class="op" id="5950477">=</span>&nbsp;<span class="builtinfunc" id="5950479">make</span><span class="op" id="5950483">(</span><span class="op" id="5950484">[</span><span class="op" id="5950485">]</span><span class="builtintype" id="5950486">byte</span><span class="op" id="5950490">,</span>&nbsp;<span class="builtintype" id="5950492">int</span><span class="op" id="5950495">(</span><span class="ident" id="5950496">bLen</span><span class="op" id="5950500">)</span><span class="op" id="5950501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950505">if</span>&nbsp;<span class="ident" id="5950508">_</span><span class="op" id="5950509">,</span>&nbsp;<span class="ident" id="5950511">err</span>&nbsp;<span class="op" id="5950515">:=</span>&nbsp;<span class="ident" id="5950518">r</span><span class="op" id="5950519">.</span><span class="ident" id="5950520">ReadAt</span><span class="op" id="5950526">(</span><span class="ident" id="5950527">buf</span><span class="op" id="5950530">,</span>&nbsp;<span class="ident" id="5950532">size</span><span class="op" id="5950536">-</span><span class="ident" id="5950537">bLen</span><span class="op" id="5950541">)</span><span class="op" id="5950542">;</span>&nbsp;<span class="ident" id="5950544">err</span>&nbsp;<span class="op" id="5950548">!=</span>&nbsp;<span class="ident" id="5950551">nil</span>&nbsp;<span class="op" id="5950555">&amp;&amp;</span>&nbsp;<span class="ident" id="5950558">err</span>&nbsp;<span class="op" id="5950562">!=</span>&nbsp;<span class="ident" id="5950565">io</span><span class="op" id="5950567">.</span><span class="ident" id="5950568">EOF</span>&nbsp;<span class="op" id="5950572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950577">return</span>&nbsp;<span class="ident" id="5950584">nil</span><span class="op" id="5950587">,</span>&nbsp;<span class="ident" id="5950589">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5950595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950599">if</span>&nbsp;<span class="ident" id="5950602">p</span>&nbsp;<span class="op" id="5950604">:=</span>&nbsp;<span class="ident" id="5950607">findSignatureInBlock</span><span class="op" id="5950627">(</span><span class="ident" id="5950628">buf</span><span class="op" id="5950631">)</span><span class="op" id="5950632">;</span>&nbsp;<span class="ident" id="5950634">p</span>&nbsp;<span class="op" id="5950636">&gt;=</span>&nbsp;<span class="num" id="5950639">0</span>&nbsp;<span class="op" id="5950641">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950646">buf</span>&nbsp;<span class="op" id="5950650">=</span>&nbsp;<span class="ident" id="5950652">buf</span><span class="op" id="5950655">[</span><span class="ident" id="5950656">p</span><span class="op" id="5950657">:</span><span class="op" id="5950658">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950663">directoryEndOffset</span>&nbsp;<span class="op" id="5950682">=</span>&nbsp;<span class="ident" id="5950684">size</span>&nbsp;<span class="op" id="5950689">-</span>&nbsp;<span class="ident" id="5950691">bLen</span>&nbsp;<span class="op" id="5950696">+</span>&nbsp;<span class="ident" id="5950698">int64</span><span class="op" id="5950703">(</span><span class="ident" id="5950704">p</span><span class="op" id="5950705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950710">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5950718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950722">if</span>&nbsp;<span class="ident" id="5950725">i</span>&nbsp;<span class="op" id="5950727">==</span>&nbsp;<span class="num" id="5950730">1</span>&nbsp;<span class="op" id="5950732">||</span>&nbsp;<span class="ident" id="5950735">bLen</span>&nbsp;<span class="op" id="5950740">==</span>&nbsp;<span class="ident" id="5950743">size</span>&nbsp;<span class="op" id="5950748">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950753">return</span>&nbsp;<span class="ident" id="5950760">nil</span><span class="op" id="5950763">,</span>&nbsp;<span class="ident" id="5950765">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5950777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5950780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5950784">//&nbsp;read&nbsp;header&nbsp;into&nbsp;struct</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950812">b</span>&nbsp;<span class="op" id="5950814">:=</span>&nbsp;<span class="ident" id="5950817">readBuf</span><span class="op" id="5950824">(</span><span class="ident" id="5950825">buf</span><span class="op" id="5950828">[</span><span class="num" id="5950829">4</span><span class="op" id="5950830">:</span><span class="op" id="5950831">]</span><span class="op" id="5950832">)</span>&nbsp;<span class="comment" id="5950834">//&nbsp;skip&nbsp;signature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950853">d</span>&nbsp;<span class="op" id="5950855">:=</span>&nbsp;<span class="op" id="5950858">&amp;</span><span class="ident" id="5950859">directoryEnd</span><span class="op" id="5950871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950875">diskNbr</span><span class="op" id="5950882">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5950895">uint32</span><span class="op" id="5950901">(</span><span class="ident" id="5950902">b</span><span class="op" id="5950903">.</span><span class="builtintype" id="5950904">uint16</span><span class="op" id="5950910">(</span><span class="op" id="5950911">)</span><span class="op" id="5950912">)</span><span class="op" id="5950913">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950917">dirDiskNbr</span><span class="op" id="5950927">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5950937">uint32</span><span class="op" id="5950943">(</span><span class="ident" id="5950944">b</span><span class="op" id="5950945">.</span><span class="builtintype" id="5950946">uint16</span><span class="op" id="5950952">(</span><span class="op" id="5950953">)</span><span class="op" id="5950954">)</span><span class="op" id="5950955">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950959">dirRecordsThisDisk</span><span class="op" id="5950977">:</span>&nbsp;<span class="ident" id="5950979">uint64</span><span class="op" id="5950985">(</span><span class="ident" id="5950986">b</span><span class="op" id="5950987">.</span><span class="builtintype" id="5950988">uint16</span><span class="op" id="5950994">(</span><span class="op" id="5950995">)</span><span class="op" id="5950996">)</span><span class="op" id="5950997">,</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951001">directoryRecords</span><span class="op" id="5951017">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5951021">uint64</span><span class="op" id="5951027">(</span><span class="ident" id="5951028">b</span><span class="op" id="5951029">.</span><span class="builtintype" id="5951030">uint16</span><span class="op" id="5951036">(</span><span class="op" id="5951037">)</span><span class="op" id="5951038">)</span><span class="op" id="5951039">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951043">directorySize</span><span class="op" id="5951056">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951063">uint64</span><span class="op" id="5951069">(</span><span class="ident" id="5951070">b</span><span class="op" id="5951071">.</span><span class="builtintype" id="5951072">uint32</span><span class="op" id="5951078">(</span><span class="op" id="5951079">)</span><span class="op" id="5951080">)</span><span class="op" id="5951081">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951085">directoryOffset</span><span class="op" id="5951100">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951105">uint64</span><span class="op" id="5951111">(</span><span class="ident" id="5951112">b</span><span class="op" id="5951113">.</span><span class="builtintype" id="5951114">uint32</span><span class="op" id="5951120">(</span><span class="op" id="5951121">)</span><span class="op" id="5951122">)</span><span class="op" id="5951123">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951127">commentLen</span><span class="op" id="5951137">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951147">b</span><span class="op" id="5951148">.</span><span class="builtintype" id="5951149">uint16</span><span class="op" id="5951155">(</span><span class="op" id="5951156">)</span><span class="op" id="5951157">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5951160">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951163">l</span>&nbsp;<span class="op" id="5951165">:=</span>&nbsp;<span class="builtintype" id="5951168">int</span><span class="op" id="5951171">(</span><span class="ident" id="5951172">d</span><span class="op" id="5951173">.</span><span class="ident" id="5951174">commentLen</span><span class="op" id="5951184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5951187">if</span>&nbsp;<span class="ident" id="5951190">l</span>&nbsp;<span class="op" id="5951192">&gt;</span>&nbsp;<span class="builtinfunc" id="5951194">len</span><span class="op" id="5951197">(</span><span class="ident" id="5951198">b</span><span class="op" id="5951199">)</span>&nbsp;<span class="op" id="5951201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5951205">return</span>&nbsp;<span class="ident" id="5951212">nil</span><span class="op" id="5951215">,</span>&nbsp;<span class="ident" id="5951217">errors</span><span class="op" id="5951223">.</span><span class="ident" id="5951224">New</span><span class="op" id="5951227">(</span><span class="string" id="5951228">&#34;zip:&nbsp;invalid&nbsp;comment&nbsp;length&#34;</span><span class="op" id="5951257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5951260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951263">d</span><span class="op" id="5951264">.</span><span class="ident" id="5951265">comment</span>&nbsp;<span class="op" id="5951273">=</span>&nbsp;<span class="builtintype" id="5951275">string</span><span class="op" id="5951281">(</span><span class="ident" id="5951282">b</span><span class="op" id="5951283">[</span><span class="op" id="5951284">:</span><span class="ident" id="5951285">l</span><span class="op" id="5951286">]</span><span class="op" id="5951287">)</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951291">p</span><span class="op" id="5951292">,</span>&nbsp;<span class="ident" id="5951294">err</span>&nbsp;<span class="op" id="5951298">:=</span>&nbsp;<span class="ident" id="5951301">findDirectory64End</span><span class="op" id="5951319">(</span><span class="ident" id="5951320">r</span><span class="op" id="5951321">,</span>&nbsp;<span class="ident" id="5951323">directoryEndOffset</span><span class="op" id="5951341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5951344">if</span>&nbsp;<span class="ident" id="5951347">err</span>&nbsp;<span class="op" id="5951351">==</span>&nbsp;<span class="ident" id="5951354">nil</span>&nbsp;<span class="op" id="5951358">&amp;&amp;</span>&nbsp;<span class="ident" id="5951361">p</span>&nbsp;<span class="op" id="5951363">&gt;=</span>&nbsp;<span class="num" id="5951366">0</span>&nbsp;<span class="op" id="5951368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951372">err</span>&nbsp;<span class="op" id="5951376">=</span>&nbsp;<span class="ident" id="5951378">readDirectory64End</span><span class="op" id="5951396">(</span><span class="ident" id="5951397">r</span><span class="op" id="5951398">,</span>&nbsp;<span class="ident" id="5951400">p</span><span class="op" id="5951401">,</span>&nbsp;<span class="ident" id="5951403">d</span><span class="op" id="5951404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5951407">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5951410">if</span>&nbsp;<span class="ident" id="5951413">err</span>&nbsp;<span class="op" id="5951417">!=</span>&nbsp;<span class="ident" id="5951420">nil</span>&nbsp;<span class="op" id="5951424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5951428">return</span>&nbsp;<span class="ident" id="5951435">nil</span><span class="op" id="5951438">,</span>&nbsp;<span class="ident" id="5951440">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5951445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5951449">//&nbsp;Make&nbsp;sure&nbsp;directoryOffset&nbsp;points&nbsp;to&nbsp;somewhere&nbsp;in&nbsp;our&nbsp;file.</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5951512">if</span>&nbsp;<span class="ident" id="5951515">o</span>&nbsp;<span class="op" id="5951517">:=</span>&nbsp;<span class="ident" id="5951520">int64</span><span class="op" id="5951525">(</span><span class="ident" id="5951526">d</span><span class="op" id="5951527">.</span><span class="ident" id="5951528">directoryOffset</span><span class="op" id="5951543">)</span><span class="op" id="5951544">;</span>&nbsp;<span class="ident" id="5951546">o</span>&nbsp;<span class="op" id="5951548">&lt;</span>&nbsp;<span class="num" id="5951550">0</span>&nbsp;<span class="op" id="5951552">||</span>&nbsp;<span class="ident" id="5951555">o</span>&nbsp;<span class="op" id="5951557">&gt;=</span>&nbsp;<span class="ident" id="5951560">size</span>&nbsp;<span class="op" id="5951565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5951569">return</span>&nbsp;<span class="ident" id="5951576">nil</span><span class="op" id="5951579">,</span>&nbsp;<span class="ident" id="5951581">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5951592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5951595">return</span>&nbsp;<span class="ident" id="5951602">d</span><span class="op" id="5951603">,</span>&nbsp;<span class="ident" id="5951605">nil</span><br>
<span class="lineno"></span><span class="op" id="5951609">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="comment" id="5951612">//&nbsp;findDirectory64End&nbsp;tries&nbsp;to&nbsp;read&nbsp;the&nbsp;zip64&nbsp;locator&nbsp;just&nbsp;before&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5951682">//&nbsp;directory&nbsp;end&nbsp;and&nbsp;returns&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="5951752">//&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="5951762">func</span>&nbsp;<span class="ident" id="5951767">findDirectory64End</span><span class="op" id="5951785">(</span><span class="ident" id="5951786">r</span>&nbsp;<span class="ident" id="5951788">io</span><span class="op" id="5951790">.</span><span class="ident" id="5951791">ReaderAt</span><span class="op" id="5951799">,</span>&nbsp;<span class="ident" id="5951801">directoryEndOffset</span>&nbsp;<span class="ident" id="5951820">int64</span><span class="op" id="5951825">)</span>&nbsp;<span class="op" id="5951827">(</span><span class="ident" id="5951828">int64</span><span class="op" id="5951833">,</span>&nbsp;<span class="builtintype" id="5951835">error</span><span class="op" id="5951840">)</span>&nbsp;<span class="op" id="5951842">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951845">locOffset</span>&nbsp;<span class="op" id="5951855">:=</span>&nbsp;<span class="ident" id="5951858">directoryEndOffset</span>&nbsp;<span class="op" id="5951877">-</span>&nbsp;<span class="ident" id="5951879">directory64LocLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5951898">if</span>&nbsp;<span class="ident" id="5951901">locOffset</span>&nbsp;<span class="op" id="5951911">&lt;</span>&nbsp;<span class="num" id="5951913">0</span>&nbsp;<span class="op" id="5951915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5951919">return</span>&nbsp;<span class="op" id="5951926">-</span><span class="num" id="5951927">1</span><span class="op" id="5951928">,</span>&nbsp;<span class="ident" id="5951930">nil</span>&nbsp;<span class="comment" id="5951934">//&nbsp;no&nbsp;need&nbsp;to&nbsp;look&nbsp;for&nbsp;a&nbsp;header&nbsp;outside&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5951984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951987">buf</span>&nbsp;<span class="op" id="5951991">:=</span>&nbsp;<span class="builtinfunc" id="5951994">make</span><span class="op" id="5951998">(</span><span class="op" id="5951999">[</span><span class="op" id="5952000">]</span><span class="builtintype" id="5952001">byte</span><span class="op" id="5952005">,</span>&nbsp;<span class="ident" id="5952007">directory64LocLen</span><span class="op" id="5952024">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952027">if</span>&nbsp;<span class="ident" id="5952030">_</span><span class="op" id="5952031">,</span>&nbsp;<span class="ident" id="5952033">err</span>&nbsp;<span class="op" id="5952037">:=</span>&nbsp;<span class="ident" id="5952040">r</span><span class="op" id="5952041">.</span><span class="ident" id="5952042">ReadAt</span><span class="op" id="5952048">(</span><span class="ident" id="5952049">buf</span><span class="op" id="5952052">,</span>&nbsp;<span class="ident" id="5952054">locOffset</span><span class="op" id="5952063">)</span><span class="op" id="5952064">;</span>&nbsp;<span class="ident" id="5952066">err</span>&nbsp;<span class="op" id="5952070">!=</span>&nbsp;<span class="ident" id="5952073">nil</span>&nbsp;<span class="op" id="5952077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952081">return</span>&nbsp;<span class="op" id="5952088">-</span><span class="num" id="5952089">1</span><span class="op" id="5952090">,</span>&nbsp;<span class="ident" id="5952092">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5952097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952100">b</span>&nbsp;<span class="op" id="5952102">:=</span>&nbsp;<span class="ident" id="5952105">readBuf</span><span class="op" id="5952112">(</span><span class="ident" id="5952113">buf</span><span class="op" id="5952116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952119">if</span>&nbsp;<span class="ident" id="5952122">sig</span>&nbsp;<span class="op" id="5952126">:=</span>&nbsp;<span class="ident" id="5952129">b</span><span class="op" id="5952130">.</span><span class="builtintype" id="5952131">uint32</span><span class="op" id="5952137">(</span><span class="op" id="5952138">)</span><span class="op" id="5952139">;</span>&nbsp;<span class="ident" id="5952141">sig</span>&nbsp;<span class="op" id="5952145">!=</span>&nbsp;<span class="ident" id="5952148">directory64LocSignature</span>&nbsp;<span class="op" id="5952172">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952176">return</span>&nbsp;<span class="op" id="5952183">-</span><span class="num" id="5952184">1</span><span class="op" id="5952185">,</span>&nbsp;<span class="ident" id="5952187">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5952192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952195">b</span>&nbsp;<span class="op" id="5952197">=</span>&nbsp;<span class="ident" id="5952199">b</span><span class="op" id="5952200">[</span><span class="num" id="5952201">4</span><span class="op" id="5952202">:</span><span class="op" id="5952203">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5952211">//&nbsp;skip&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952292">p</span>&nbsp;<span class="op" id="5952294">:=</span>&nbsp;<span class="ident" id="5952297">b</span><span class="op" id="5952298">.</span><span class="ident" id="5952299">uint64</span><span class="op" id="5952305">(</span><span class="op" id="5952306">)</span>&nbsp;<span class="comment" id="5952308">//&nbsp;relative&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952373">return</span>&nbsp;<span class="ident" id="5952380">int64</span><span class="op" id="5952385">(</span><span class="ident" id="5952386">p</span><span class="op" id="5952387">)</span><span class="op" id="5952388">,</span>&nbsp;<span class="ident" id="5952390">nil</span><br>
<span class="lineno">395</span><span class="op" id="5952394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5952397">//&nbsp;readDirectory64End&nbsp;reads&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;and&nbsp;updates&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5952465">//&nbsp;directory&nbsp;end&nbsp;with&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5952519">func</span>&nbsp;<span class="ident" id="5952524">readDirectory64End</span><span class="op" id="5952542">(</span><span class="ident" id="5952543">r</span>&nbsp;<span class="ident" id="5952545">io</span><span class="op" id="5952547">.</span><span class="ident" id="5952548">ReaderAt</span><span class="op" id="5952556">,</span>&nbsp;<span class="ident" id="5952558">offset</span>&nbsp;<span class="ident" id="5952565">int64</span><span class="op" id="5952570">,</span>&nbsp;<span class="ident" id="5952572">d</span>&nbsp;<span class="op" id="5952574">*</span><span class="ident" id="5952575">directoryEnd</span><span class="op" id="5952587">)</span>&nbsp;<span class="op" id="5952589">(</span><span class="ident" id="5952590">err</span>&nbsp;<span class="builtintype" id="5952594">error</span><span class="op" id="5952599">)</span>&nbsp;<span class="op" id="5952601">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952604">buf</span>&nbsp;<span class="op" id="5952608">:=</span>&nbsp;<span class="builtinfunc" id="5952611">make</span><span class="op" id="5952615">(</span><span class="op" id="5952616">[</span><span class="op" id="5952617">]</span><span class="builtintype" id="5952618">byte</span><span class="op" id="5952622">,</span>&nbsp;<span class="ident" id="5952624">directory64EndLen</span><span class="op" id="5952641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952644">if</span>&nbsp;<span class="ident" id="5952647">_</span><span class="op" id="5952648">,</span>&nbsp;<span class="ident" id="5952650">err</span>&nbsp;<span class="op" id="5952654">:=</span>&nbsp;<span class="ident" id="5952657">r</span><span class="op" id="5952658">.</span><span class="ident" id="5952659">ReadAt</span><span class="op" id="5952665">(</span><span class="ident" id="5952666">buf</span><span class="op" id="5952669">,</span>&nbsp;<span class="ident" id="5952671">offset</span><span class="op" id="5952677">)</span><span class="op" id="5952678">;</span>&nbsp;<span class="ident" id="5952680">err</span>&nbsp;<span class="op" id="5952684">!=</span>&nbsp;<span class="ident" id="5952687">nil</span>&nbsp;<span class="op" id="5952691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952695">return</span>&nbsp;<span class="ident" id="5952702">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5952707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952711">b</span>&nbsp;<span class="op" id="5952713">:=</span>&nbsp;<span class="ident" id="5952716">readBuf</span><span class="op" id="5952723">(</span><span class="ident" id="5952724">buf</span><span class="op" id="5952727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952730">if</span>&nbsp;<span class="ident" id="5952733">sig</span>&nbsp;<span class="op" id="5952737">:=</span>&nbsp;<span class="ident" id="5952740">b</span><span class="op" id="5952741">.</span><span class="builtintype" id="5952742">uint32</span><span class="op" id="5952748">(</span><span class="op" id="5952749">)</span><span class="op" id="5952750">;</span>&nbsp;<span class="ident" id="5952752">sig</span>&nbsp;<span class="op" id="5952756">!=</span>&nbsp;<span class="ident" id="5952759">directory64EndSignature</span>&nbsp;<span class="op" id="5952783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952787">return</span>&nbsp;<span class="ident" id="5952794">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5952805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952809">b</span>&nbsp;<span class="op" id="5952811">=</span>&nbsp;<span class="ident" id="5952813">b</span><span class="op" id="5952814">[</span><span class="num" id="5952815">12</span><span class="op" id="5952817">:</span><span class="op" id="5952818">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5952843">//&nbsp;skip&nbsp;dir&nbsp;size,&nbsp;version&nbsp;and&nbsp;version&nbsp;needed&nbsp;(uint64&nbsp;+&nbsp;2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952910">d</span><span class="op" id="5952911">.</span><span class="ident" id="5952912">diskNbr</span>&nbsp;<span class="op" id="5952920">=</span>&nbsp;<span class="ident" id="5952922">b</span><span class="op" id="5952923">.</span><span class="builtintype" id="5952924">uint32</span><span class="op" id="5952930">(</span><span class="op" id="5952931">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5952944">//&nbsp;number&nbsp;of&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952968">d</span><span class="op" id="5952969">.</span><span class="ident" id="5952970">dirDiskNbr</span>&nbsp;<span class="op" id="5952981">=</span>&nbsp;<span class="ident" id="5952983">b</span><span class="op" id="5952984">.</span><span class="builtintype" id="5952985">uint32</span><span class="op" id="5952991">(</span><span class="op" id="5952992">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5953002">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953065">d</span><span class="op" id="5953066">.</span><span class="ident" id="5953067">dirRecordsThisDisk</span>&nbsp;<span class="op" id="5953086">=</span>&nbsp;<span class="ident" id="5953088">b</span><span class="op" id="5953089">.</span><span class="ident" id="5953090">uint64</span><span class="op" id="5953096">(</span><span class="op" id="5953097">)</span>&nbsp;<span class="comment" id="5953099">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory&nbsp;on&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953165">d</span><span class="op" id="5953166">.</span><span class="ident" id="5953167">directoryRecords</span>&nbsp;<span class="op" id="5953184">=</span>&nbsp;<span class="ident" id="5953186">b</span><span class="op" id="5953187">.</span><span class="ident" id="5953188">uint64</span><span class="op" id="5953194">(</span><span class="op" id="5953195">)</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5953199">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953252">d</span><span class="op" id="5953253">.</span><span class="ident" id="5953254">directorySize</span>&nbsp;<span class="op" id="5953268">=</span>&nbsp;<span class="ident" id="5953270">b</span><span class="op" id="5953271">.</span><span class="ident" id="5953272">uint64</span><span class="op" id="5953278">(</span><span class="op" id="5953279">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5953286">//&nbsp;size&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953320">d</span><span class="op" id="5953321">.</span><span class="ident" id="5953322">directoryOffset</span>&nbsp;<span class="op" id="5953338">=</span>&nbsp;<span class="ident" id="5953340">b</span><span class="op" id="5953341">.</span><span class="ident" id="5953342">uint64</span><span class="op" id="5953348">(</span><span class="op" id="5953349">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5953354">//&nbsp;offset&nbsp;of&nbsp;start&nbsp;of&nbsp;central&nbsp;directory&nbsp;with&nbsp;respect&nbsp;to&nbsp;the&nbsp;starting&nbsp;disk&nbsp;number</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953437">return</span>&nbsp;<span class="ident" id="5953444">nil</span><br>
<span class="lineno"></span><span class="op" id="5953448">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span><span class="keyword" id="5953451">func</span>&nbsp;<span class="ident" id="5953456">findSignatureInBlock</span><span class="op" id="5953476">(</span><span class="ident" id="5953477">b</span>&nbsp;<span class="op" id="5953479">[</span><span class="op" id="5953480">]</span><span class="builtintype" id="5953481">byte</span><span class="op" id="5953485">)</span>&nbsp;<span class="builtintype" id="5953487">int</span>&nbsp;<span class="op" id="5953491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953494">for</span>&nbsp;<span class="ident" id="5953498">i</span>&nbsp;<span class="op" id="5953500">:=</span>&nbsp;<span class="builtinfunc" id="5953503">len</span><span class="op" id="5953506">(</span><span class="ident" id="5953507">b</span><span class="op" id="5953508">)</span>&nbsp;<span class="op" id="5953510">-</span>&nbsp;<span class="ident" id="5953512">directoryEndLen</span><span class="op" id="5953527">;</span>&nbsp;<span class="ident" id="5953529">i</span>&nbsp;<span class="op" id="5953531">&gt;=</span>&nbsp;<span class="num" id="5953534">0</span><span class="op" id="5953535">;</span>&nbsp;<span class="ident" id="5953537">i</span><span class="op" id="5953538">--</span>&nbsp;<span class="op" id="5953541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5953545">//&nbsp;defined&nbsp;from&nbsp;directoryEndSignature&nbsp;in&nbsp;struct.go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953598">if</span>&nbsp;<span class="ident" id="5953601">b</span><span class="op" id="5953602">[</span><span class="ident" id="5953603">i</span><span class="op" id="5953604">]</span>&nbsp;<span class="op" id="5953606">==</span>&nbsp;<span class="string" id="5953609">&#39;P&#39;</span>&nbsp;<span class="op" id="5953613">&amp;&amp;</span>&nbsp;<span class="ident" id="5953616">b</span><span class="op" id="5953617">[</span><span class="ident" id="5953618">i</span><span class="op" id="5953619">+</span><span class="num" id="5953620">1</span><span class="op" id="5953621">]</span>&nbsp;<span class="op" id="5953623">==</span>&nbsp;<span class="string" id="5953626">&#39;K&#39;</span>&nbsp;<span class="op" id="5953630">&amp;&amp;</span>&nbsp;<span class="ident" id="5953633">b</span><span class="op" id="5953634">[</span><span class="ident" id="5953635">i</span><span class="op" id="5953636">+</span><span class="num" id="5953637">2</span><span class="op" id="5953638">]</span>&nbsp;<span class="op" id="5953640">==</span>&nbsp;<span class="num" id="5953643">0x05</span>&nbsp;<span class="op" id="5953648">&amp;&amp;</span>&nbsp;<span class="ident" id="5953651">b</span><span class="op" id="5953652">[</span><span class="ident" id="5953653">i</span><span class="op" id="5953654">+</span><span class="num" id="5953655">3</span><span class="op" id="5953656">]</span>&nbsp;<span class="op" id="5953658">==</span>&nbsp;<span class="num" id="5953661">0x06</span>&nbsp;<span class="op" id="5953666">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5953671">//&nbsp;n&nbsp;is&nbsp;length&nbsp;of&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953700">n</span>&nbsp;<span class="op" id="5953702">:=</span>&nbsp;<span class="builtintype" id="5953705">int</span><span class="op" id="5953708">(</span><span class="ident" id="5953709">b</span><span class="op" id="5953710">[</span><span class="ident" id="5953711">i</span><span class="op" id="5953712">+</span><span class="ident" id="5953713">directoryEndLen</span><span class="op" id="5953728">-</span><span class="num" id="5953729">2</span><span class="op" id="5953730">]</span><span class="op" id="5953731">)</span>&nbsp;<span class="op" id="5953733">|</span>&nbsp;<span class="builtintype" id="5953735">int</span><span class="op" id="5953738">(</span><span class="ident" id="5953739">b</span><span class="op" id="5953740">[</span><span class="ident" id="5953741">i</span><span class="op" id="5953742">+</span><span class="ident" id="5953743">directoryEndLen</span><span class="op" id="5953758">-</span><span class="num" id="5953759">1</span><span class="op" id="5953760">]</span><span class="op" id="5953761">)</span><span class="op" id="5953762">&lt;&lt;</span><span class="num" id="5953764">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953769">if</span>&nbsp;<span class="ident" id="5953772">n</span><span class="op" id="5953773">+</span><span class="ident" id="5953774">directoryEndLen</span><span class="op" id="5953789">+</span><span class="ident" id="5953790">i</span>&nbsp;<span class="op" id="5953792">&lt;=</span>&nbsp;<span class="builtinfunc" id="5953795">len</span><span class="op" id="5953798">(</span><span class="ident" id="5953799">b</span><span class="op" id="5953800">)</span>&nbsp;<span class="op" id="5953802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953808">return</span>&nbsp;<span class="ident" id="5953815">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5953820">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5953824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5953827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953830">return</span>&nbsp;<span class="op" id="5953837">-</span><span class="num" id="5953838">1</span><br>
<span class="lineno"></span><span class="op" id="5953840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="5953843">type</span>&nbsp;<span class="ident" id="5953848">readBuf</span>&nbsp;<span class="op" id="5953856">[</span><span class="op" id="5953857">]</span><span class="builtintype" id="5953858">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5953864">func</span>&nbsp;<span class="op" id="5953869">(</span><span class="ident" id="5953870">b</span>&nbsp;<span class="op" id="5953872">*</span><span class="ident" id="5953873">readBuf</span><span class="op" id="5953880">)</span>&nbsp;<span class="builtintype" id="5953882">uint16</span><span class="op" id="5953888">(</span><span class="op" id="5953889">)</span>&nbsp;<span class="builtintype" id="5953891">uint16</span>&nbsp;<span class="op" id="5953898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953901">v</span>&nbsp;<span class="op" id="5953903">:=</span>&nbsp;<span class="ident" id="5953906">binary</span><span class="op" id="5953912">.</span><span class="ident" id="5953913">LittleEndian</span><span class="op" id="5953925">.</span><span class="ident" id="5953926">Uint16</span><span class="op" id="5953932">(</span><span class="op" id="5953933">*</span><span class="ident" id="5953934">b</span><span class="op" id="5953935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5953938">*</span><span class="ident" id="5953939">b</span>&nbsp;<span class="op" id="5953941">=</span>&nbsp;<span class="op" id="5953943">(</span><span class="op" id="5953944">*</span><span class="ident" id="5953945">b</span><span class="op" id="5953946">)</span><span class="op" id="5953947">[</span><span class="num" id="5953948">2</span><span class="op" id="5953949">:</span><span class="op" id="5953950">]</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953953">return</span>&nbsp;<span class="ident" id="5953960">v</span><br>
<span class="lineno"></span><span class="op" id="5953962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5953965">func</span>&nbsp;<span class="op" id="5953970">(</span><span class="ident" id="5953971">b</span>&nbsp;<span class="op" id="5953973">*</span><span class="ident" id="5953974">readBuf</span><span class="op" id="5953981">)</span>&nbsp;<span class="builtintype" id="5953983">uint32</span><span class="op" id="5953989">(</span><span class="op" id="5953990">)</span>&nbsp;<span class="builtintype" id="5953992">uint32</span>&nbsp;<span class="op" id="5953999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954002">v</span>&nbsp;<span class="op" id="5954004">:=</span>&nbsp;<span class="ident" id="5954007">binary</span><span class="op" id="5954013">.</span><span class="ident" id="5954014">LittleEndian</span><span class="op" id="5954026">.</span><span class="ident" id="5954027">Uint32</span><span class="op" id="5954033">(</span><span class="op" id="5954034">*</span><span class="ident" id="5954035">b</span><span class="op" id="5954036">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5954039">*</span><span class="ident" id="5954040">b</span>&nbsp;<span class="op" id="5954042">=</span>&nbsp;<span class="op" id="5954044">(</span><span class="op" id="5954045">*</span><span class="ident" id="5954046">b</span><span class="op" id="5954047">)</span><span class="op" id="5954048">[</span><span class="num" id="5954049">4</span><span class="op" id="5954050">:</span><span class="op" id="5954051">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954054">return</span>&nbsp;<span class="ident" id="5954061">v</span><br>
<span class="lineno"></span><span class="op" id="5954063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5954066">func</span>&nbsp;<span class="op" id="5954071">(</span><span class="ident" id="5954072">b</span>&nbsp;<span class="op" id="5954074">*</span><span class="ident" id="5954075">readBuf</span><span class="op" id="5954082">)</span>&nbsp;<span class="ident" id="5954084">uint64</span><span class="op" id="5954090">(</span><span class="op" id="5954091">)</span>&nbsp;<span class="ident" id="5954093">uint64</span>&nbsp;<span class="op" id="5954100">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954103">v</span>&nbsp;<span class="op" id="5954105">:=</span>&nbsp;<span class="ident" id="5954108">binary</span><span class="op" id="5954114">.</span><span class="ident" id="5954115">LittleEndian</span><span class="op" id="5954127">.</span><span class="ident" id="5954128">Uint64</span><span class="op" id="5954134">(</span><span class="op" id="5954135">*</span><span class="ident" id="5954136">b</span><span class="op" id="5954137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5954140">*</span><span class="ident" id="5954141">b</span>&nbsp;<span class="op" id="5954143">=</span>&nbsp;<span class="op" id="5954145">(</span><span class="op" id="5954146">*</span><span class="ident" id="5954147">b</span><span class="op" id="5954148">)</span><span class="op" id="5954149">[</span><span class="num" id="5954150">8</span><span class="op" id="5954151">:</span><span class="op" id="5954152">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954155">return</span>&nbsp;<span class="ident" id="5954162">v</span><br>
<span class="lineno"></span><span class="op" id="5954164">}</span>
</div>
</body>
</html>
