<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4068534">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4068589">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4068643">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4068694">//&nbsp;Package&nbsp;rsa&nbsp;implements&nbsp;RSA&nbsp;encryption&nbsp;as&nbsp;specified&nbsp;in&nbsp;PKCS#1.</span><br>
<span class="lineno"></span><span class="keyword" id="4068759">package</span>&nbsp;<span class="ident" id="4068767">rsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4068772">import</span>&nbsp;<span class="op" id="4068779">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4068782">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4068792">&#34;crypto/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4068807">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4068824">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4068834">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4068842">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4068848">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4068859">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4068862">var</span>&nbsp;<span class="ident" id="4068866">bigZero</span>&nbsp;<span class="op" id="4068874">=</span>&nbsp;<span class="ident" id="4068876">big</span><span class="op" id="4068879">.</span><span class="ident" id="4068880">NewInt</span><span class="op" id="4068886">(</span><span class="num" id="4068887">0</span><span class="op" id="4068888">)</span><br>
<span class="lineno"></span><span class="keyword" id="4068890">var</span>&nbsp;<span class="ident" id="4068894">bigOne</span>&nbsp;<span class="op" id="4068901">=</span>&nbsp;<span class="ident" id="4068903">big</span><span class="op" id="4068906">.</span><span class="ident" id="4068907">NewInt</span><span class="op" id="4068913">(</span><span class="num" id="4068914">1</span><span class="op" id="4068915">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="4068918">//&nbsp;A&nbsp;PublicKey&nbsp;represents&nbsp;the&nbsp;public&nbsp;part&nbsp;of&nbsp;an&nbsp;RSA&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4068975">type</span>&nbsp;<span class="ident" id="4068980">PublicKey</span>&nbsp;<span class="keyword" id="4068990">struct</span>&nbsp;<span class="op" id="4068997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4069000">N</span>&nbsp;<span class="op" id="4069002">*</span><span class="ident" id="4069003">big</span><span class="op" id="4069006">.</span><span class="ident" id="4069007">Int</span>&nbsp;<span class="comment" id="4069011">//&nbsp;modulus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4069023">E</span>&nbsp;<span class="builtintype" id="4069025">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4069034">//&nbsp;public&nbsp;exponent</span><br>
<span class="lineno">25</span><span class="op" id="4069053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4069056">var</span>&nbsp;<span class="op" id="4069060">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4069063">errPublicModulus</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4069086">=</span>&nbsp;<span class="ident" id="4069088">errors</span><span class="op" id="4069094">.</span><span class="ident" id="4069095">New</span><span class="op" id="4069098">(</span><span class="string" id="4069099">&#34;crypto/rsa:&nbsp;missing&nbsp;public&nbsp;modulus&#34;</span><span class="op" id="4069135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4069138">errPublicExponentSmall</span>&nbsp;<span class="op" id="4069161">=</span>&nbsp;<span class="ident" id="4069163">errors</span><span class="op" id="4069169">.</span><span class="ident" id="4069170">New</span><span class="op" id="4069173">(</span><span class="string" id="4069174">&#34;crypto/rsa:&nbsp;public&nbsp;exponent&nbsp;too&nbsp;small&#34;</span><span class="op" id="4069213">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4069216">errPublicExponentLarge</span>&nbsp;<span class="op" id="4069239">=</span>&nbsp;<span class="ident" id="4069241">errors</span><span class="op" id="4069247">.</span><span class="ident" id="4069248">New</span><span class="op" id="4069251">(</span><span class="string" id="4069252">&#34;crypto/rsa:&nbsp;public&nbsp;exponent&nbsp;too&nbsp;large&#34;</span><span class="op" id="4069291">)</span><br>
<span class="lineno"></span><span class="op" id="4069293">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4069296">//&nbsp;checkPub&nbsp;sanity&nbsp;checks&nbsp;the&nbsp;public&nbsp;key&nbsp;before&nbsp;we&nbsp;use&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="4069355">//&nbsp;We&nbsp;require&nbsp;pub.E&nbsp;to&nbsp;fit&nbsp;into&nbsp;a&nbsp;32-bit&nbsp;integer&nbsp;so&nbsp;that&nbsp;we</span><br>
<span class="lineno">35</span><span class="comment" id="4069415">//&nbsp;do&nbsp;not&nbsp;have&nbsp;different&nbsp;behavior&nbsp;depending&nbsp;on&nbsp;whether</span><br>
<span class="lineno"></span><span class="comment" id="4069470">//&nbsp;int&nbsp;is&nbsp;32&nbsp;or&nbsp;64&nbsp;bits.&nbsp;See&nbsp;also</span><br>
<span class="lineno"></span><span class="comment" id="4069504">//&nbsp;http://www.imperialviolet.org/2012/03/16/rsae.html.</span><br>
<span class="lineno"></span><span class="keyword" id="4069559">func</span>&nbsp;<span class="ident" id="4069564">checkPub</span><span class="op" id="4069572">(</span><span class="ident" id="4069573">pub</span>&nbsp;<span class="op" id="4069577">*</span><span class="ident" id="4069578">PublicKey</span><span class="op" id="4069587">)</span>&nbsp;<span class="builtintype" id="4069589">error</span>&nbsp;<span class="op" id="4069595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4069598">if</span>&nbsp;<span class="ident" id="4069601">pub</span><span class="op" id="4069604">.</span><span class="ident" id="4069605">N</span>&nbsp;<span class="op" id="4069607">==</span>&nbsp;<span class="ident" id="4069610">nil</span>&nbsp;<span class="op" id="4069614">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4069618">return</span>&nbsp;<span class="ident" id="4069625">errPublicModulus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4069643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4069646">if</span>&nbsp;<span class="ident" id="4069649">pub</span><span class="op" id="4069652">.</span><span class="ident" id="4069653">E</span>&nbsp;<span class="op" id="4069655">&lt;</span>&nbsp;<span class="num" id="4069657">2</span>&nbsp;<span class="op" id="4069659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4069663">return</span>&nbsp;<span class="ident" id="4069670">errPublicExponentSmall</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4069694">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4069697">if</span>&nbsp;<span class="ident" id="4069700">pub</span><span class="op" id="4069703">.</span><span class="ident" id="4069704">E</span>&nbsp;<span class="op" id="4069706">&gt;</span>&nbsp;<span class="num" id="4069708">1</span><span class="op" id="4069709">&lt;&lt;</span><span class="num" id="4069711">31</span><span class="op" id="4069713">-</span><span class="num" id="4069714">1</span>&nbsp;<span class="op" id="4069716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4069720">return</span>&nbsp;<span class="ident" id="4069727">errPublicExponentLarge</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4069751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4069754">return</span>&nbsp;<span class="ident" id="4069761">nil</span><br>
<span class="lineno"></span><span class="op" id="4069765">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="4069768">//&nbsp;A&nbsp;PrivateKey&nbsp;represents&nbsp;an&nbsp;RSA&nbsp;key</span><br>
<span class="lineno"></span><span class="keyword" id="4069806">type</span>&nbsp;<span class="ident" id="4069811">PrivateKey</span>&nbsp;<span class="keyword" id="4069822">struct</span>&nbsp;<span class="op" id="4069829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4069832">PublicKey</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4069853">//&nbsp;public&nbsp;part.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4069870">D</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4069880">*</span><span class="ident" id="4069881">big</span><span class="op" id="4069884">.</span><span class="ident" id="4069885">Int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4069891">//&nbsp;private&nbsp;exponent</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4069912">Primes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4069922">[</span><span class="op" id="4069923">]</span><span class="op" id="4069924">*</span><span class="ident" id="4069925">big</span><span class="op" id="4069928">.</span><span class="ident" id="4069929">Int</span>&nbsp;<span class="comment" id="4069933">//&nbsp;prime&nbsp;factors&nbsp;of&nbsp;N,&nbsp;has&nbsp;&gt;=&nbsp;2&nbsp;elements.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4069977">//&nbsp;Precomputed&nbsp;contains&nbsp;precomputed&nbsp;values&nbsp;that&nbsp;speed&nbsp;up&nbsp;private</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4070043">//&nbsp;operations,&nbsp;if&nbsp;available.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070073">Precomputed</span>&nbsp;<span class="ident" id="4070085">PrecomputedValues</span><br>
<span class="lineno">60</span><span class="op" id="4070103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4070106">//&nbsp;Public&nbsp;returns&nbsp;the&nbsp;public&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;priv.</span><br>
<span class="lineno"></span><span class="keyword" id="4070162">func</span>&nbsp;<span class="op" id="4070167">(</span><span class="ident" id="4070168">priv</span>&nbsp;<span class="op" id="4070173">*</span><span class="ident" id="4070174">PrivateKey</span><span class="op" id="4070184">)</span>&nbsp;<span class="ident" id="4070186">Public</span><span class="op" id="4070192">(</span><span class="op" id="4070193">)</span>&nbsp;<span class="ident" id="4070195">crypto</span><span class="op" id="4070201">.</span><span class="ident" id="4070202">PublicKey</span>&nbsp;<span class="op" id="4070212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4070215">return</span>&nbsp;<span class="op" id="4070222">&amp;</span><span class="ident" id="4070223">priv</span><span class="op" id="4070227">.</span><span class="ident" id="4070228">PublicKey</span><br>
<span class="lineno">65</span><span class="op" id="4070238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4070241">//&nbsp;Sign&nbsp;signs&nbsp;msg&nbsp;with&nbsp;priv,&nbsp;reading&nbsp;randomness&nbsp;from&nbsp;rand.&nbsp;If&nbsp;opts&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4070313">//&nbsp;*PSSOptions&nbsp;then&nbsp;the&nbsp;PSS&nbsp;algorithm&nbsp;will&nbsp;be&nbsp;used,&nbsp;otherwise&nbsp;PKCS#1&nbsp;v1.5&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="4070392">//&nbsp;be&nbsp;used.&nbsp;This&nbsp;method&nbsp;is&nbsp;intended&nbsp;to&nbsp;support&nbsp;keys&nbsp;where&nbsp;the&nbsp;private&nbsp;part&nbsp;is</span><br>
<span class="lineno">70</span><span class="comment" id="4070470">//&nbsp;kept&nbsp;in,&nbsp;for&nbsp;example,&nbsp;a&nbsp;hardware&nbsp;module.&nbsp;Common&nbsp;uses&nbsp;should&nbsp;use&nbsp;the&nbsp;Sign*</span><br>
<span class="lineno"></span><span class="comment" id="4070547">//&nbsp;functions&nbsp;in&nbsp;this&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="4070577">func</span>&nbsp;<span class="op" id="4070582">(</span><span class="ident" id="4070583">priv</span>&nbsp;<span class="op" id="4070588">*</span><span class="ident" id="4070589">PrivateKey</span><span class="op" id="4070599">)</span>&nbsp;<span class="ident" id="4070601">Sign</span><span class="op" id="4070605">(</span><span class="ident" id="4070606">rand</span>&nbsp;<span class="ident" id="4070611">io</span><span class="op" id="4070613">.</span><span class="ident" id="4070614">Reader</span><span class="op" id="4070620">,</span>&nbsp;<span class="ident" id="4070622">msg</span>&nbsp;<span class="op" id="4070626">[</span><span class="op" id="4070627">]</span><span class="builtintype" id="4070628">byte</span><span class="op" id="4070632">,</span>&nbsp;<span class="ident" id="4070634">opts</span>&nbsp;<span class="ident" id="4070639">crypto</span><span class="op" id="4070645">.</span><span class="ident" id="4070646">SignerOpts</span><span class="op" id="4070656">)</span>&nbsp;<span class="op" id="4070658">(</span><span class="op" id="4070659">[</span><span class="op" id="4070660">]</span><span class="builtintype" id="4070661">byte</span><span class="op" id="4070665">,</span>&nbsp;<span class="builtintype" id="4070667">error</span><span class="op" id="4070672">)</span>&nbsp;<span class="op" id="4070674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4070677">if</span>&nbsp;<span class="ident" id="4070680">pssOpts</span><span class="op" id="4070687">,</span>&nbsp;<span class="ident" id="4070689">ok</span>&nbsp;<span class="op" id="4070692">:=</span>&nbsp;<span class="ident" id="4070695">opts</span><span class="op" id="4070699">.</span><span class="op" id="4070700">(</span><span class="op" id="4070701">*</span><span class="ident" id="4070702">PSSOptions</span><span class="op" id="4070712">)</span><span class="op" id="4070713">;</span>&nbsp;<span class="ident" id="4070715">ok</span>&nbsp;<span class="op" id="4070718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4070722">return</span>&nbsp;<span class="ident" id="4070729">SignPSS</span><span class="op" id="4070736">(</span><span class="ident" id="4070737">rand</span><span class="op" id="4070741">,</span>&nbsp;<span class="ident" id="4070743">priv</span><span class="op" id="4070747">,</span>&nbsp;<span class="ident" id="4070749">pssOpts</span><span class="op" id="4070756">.</span><span class="ident" id="4070757">Hash</span><span class="op" id="4070761">,</span>&nbsp;<span class="ident" id="4070763">msg</span><span class="op" id="4070766">,</span>&nbsp;<span class="ident" id="4070768">pssOpts</span><span class="op" id="4070775">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4070778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4070782">return</span>&nbsp;<span class="ident" id="4070789">SignPKCS1v15</span><span class="op" id="4070801">(</span><span class="ident" id="4070802">rand</span><span class="op" id="4070806">,</span>&nbsp;<span class="ident" id="4070808">priv</span><span class="op" id="4070812">,</span>&nbsp;<span class="ident" id="4070814">opts</span><span class="op" id="4070818">.</span><span class="ident" id="4070819">HashFunc</span><span class="op" id="4070827">(</span><span class="op" id="4070828">)</span><span class="op" id="4070829">,</span>&nbsp;<span class="ident" id="4070831">msg</span><span class="op" id="4070834">)</span><br>
<span class="lineno"></span><span class="op" id="4070836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="4070839">type</span>&nbsp;<span class="ident" id="4070844">PrecomputedValues</span>&nbsp;<span class="keyword" id="4070862">struct</span>&nbsp;<span class="op" id="4070869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070872">Dp</span><span class="op" id="4070874">,</span>&nbsp;<span class="ident" id="4070876">Dq</span>&nbsp;<span class="op" id="4070879">*</span><span class="ident" id="4070880">big</span><span class="op" id="4070883">.</span><span class="ident" id="4070884">Int</span>&nbsp;<span class="comment" id="4070888">//&nbsp;D&nbsp;mod&nbsp;(P-1)&nbsp;(or&nbsp;mod&nbsp;Q-1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070917">Qinv</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4070924">*</span><span class="ident" id="4070925">big</span><span class="op" id="4070928">.</span><span class="ident" id="4070929">Int</span>&nbsp;<span class="comment" id="4070933">//&nbsp;Q^-1&nbsp;mod&nbsp;P</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4070949">//&nbsp;CRTValues&nbsp;is&nbsp;used&nbsp;for&nbsp;the&nbsp;3rd&nbsp;and&nbsp;subsequent&nbsp;primes.&nbsp;Due&nbsp;to&nbsp;a</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4071015">//&nbsp;historical&nbsp;accident,&nbsp;the&nbsp;CRT&nbsp;for&nbsp;the&nbsp;first&nbsp;two&nbsp;primes&nbsp;is&nbsp;handled</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4071084">//&nbsp;differently&nbsp;in&nbsp;PKCS#1&nbsp;and&nbsp;interoperability&nbsp;is&nbsp;sufficiently</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4071147">//&nbsp;important&nbsp;that&nbsp;we&nbsp;mirror&nbsp;this.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4071182">CRTValues</span>&nbsp;<span class="op" id="4071192">[</span><span class="op" id="4071193">]</span><span class="ident" id="4071194">CRTValue</span><br>
<span class="lineno"></span><span class="op" id="4071203">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="4071206">//&nbsp;CRTValue&nbsp;contains&nbsp;the&nbsp;precomputed&nbsp;chinese&nbsp;remainder&nbsp;theorem&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4071277">type</span>&nbsp;<span class="ident" id="4071282">CRTValue</span>&nbsp;<span class="keyword" id="4071291">struct</span>&nbsp;<span class="op" id="4071298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4071301">Exp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4071307">*</span><span class="ident" id="4071308">big</span><span class="op" id="4071311">.</span><span class="ident" id="4071312">Int</span>&nbsp;<span class="comment" id="4071316">//&nbsp;D&nbsp;mod&nbsp;(prime-1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4071337">Coeff</span>&nbsp;<span class="op" id="4071343">*</span><span class="ident" id="4071344">big</span><span class="op" id="4071347">.</span><span class="ident" id="4071348">Int</span>&nbsp;<span class="comment" id="4071352">//&nbsp;R·Coeff&nbsp;≡&nbsp;1&nbsp;mod&nbsp;Prime.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4071382">R</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4071388">*</span><span class="ident" id="4071389">big</span><span class="op" id="4071392">.</span><span class="ident" id="4071393">Int</span>&nbsp;<span class="comment" id="4071397">//&nbsp;product&nbsp;of&nbsp;primes&nbsp;prior&nbsp;to&nbsp;this&nbsp;(inc&nbsp;p&nbsp;and&nbsp;q).</span><br>
<span class="lineno"></span><span class="op" id="4071447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4071450">//&nbsp;Validate&nbsp;performs&nbsp;basic&nbsp;sanity&nbsp;checks&nbsp;on&nbsp;the&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="4071503">//&nbsp;It&nbsp;returns&nbsp;nil&nbsp;if&nbsp;the&nbsp;key&nbsp;is&nbsp;valid,&nbsp;or&nbsp;else&nbsp;an&nbsp;error&nbsp;describing&nbsp;a&nbsp;problem.</span><br>
<span class="lineno">100</span><span class="keyword" id="4071581">func</span>&nbsp;<span class="op" id="4071586">(</span><span class="ident" id="4071587">priv</span>&nbsp;<span class="op" id="4071592">*</span><span class="ident" id="4071593">PrivateKey</span><span class="op" id="4071603">)</span>&nbsp;<span class="ident" id="4071605">Validate</span><span class="op" id="4071613">(</span><span class="op" id="4071614">)</span>&nbsp;<span class="builtintype" id="4071616">error</span>&nbsp;<span class="op" id="4071622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4071625">if</span>&nbsp;<span class="ident" id="4071628">err</span>&nbsp;<span class="op" id="4071632">:=</span>&nbsp;<span class="ident" id="4071635">checkPub</span><span class="op" id="4071643">(</span><span class="op" id="4071644">&amp;</span><span class="ident" id="4071645">priv</span><span class="op" id="4071649">.</span><span class="ident" id="4071650">PublicKey</span><span class="op" id="4071659">)</span><span class="op" id="4071660">;</span>&nbsp;<span class="ident" id="4071662">err</span>&nbsp;<span class="op" id="4071666">!=</span>&nbsp;<span class="ident" id="4071669">nil</span>&nbsp;<span class="op" id="4071673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4071677">return</span>&nbsp;<span class="ident" id="4071684">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4071689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4071693">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;prime&nbsp;factors&nbsp;are&nbsp;actually&nbsp;prime.&nbsp;Note&nbsp;that&nbsp;this&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4071764">//&nbsp;just&nbsp;a&nbsp;sanity&nbsp;check.&nbsp;Since&nbsp;the&nbsp;random&nbsp;witnesses&nbsp;chosen&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4071826">//&nbsp;ProbablyPrime&nbsp;are&nbsp;deterministic,&nbsp;given&nbsp;the&nbsp;candidate&nbsp;number,&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4071896">//&nbsp;easy&nbsp;for&nbsp;an&nbsp;attack&nbsp;to&nbsp;generate&nbsp;composites&nbsp;that&nbsp;pass&nbsp;this&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4071963">for</span>&nbsp;<span class="ident" id="4071967">_</span><span class="op" id="4071968">,</span>&nbsp;<span class="ident" id="4071970">prime</span>&nbsp;<span class="op" id="4071976">:=</span>&nbsp;<span class="keyword" id="4071979">range</span>&nbsp;<span class="ident" id="4071985">priv</span><span class="op" id="4071989">.</span><span class="ident" id="4071990">Primes</span>&nbsp;<span class="op" id="4071997">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072001">if</span>&nbsp;<span class="op" id="4072004">!</span><span class="ident" id="4072005">prime</span><span class="op" id="4072010">.</span><span class="ident" id="4072011">ProbablyPrime</span><span class="op" id="4072024">(</span><span class="num" id="4072025">20</span><span class="op" id="4072027">)</span>&nbsp;<span class="op" id="4072029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072034">return</span>&nbsp;<span class="ident" id="4072041">errors</span><span class="op" id="4072047">.</span><span class="ident" id="4072048">New</span><span class="op" id="4072051">(</span><span class="string" id="4072052">&#34;crypto/rsa:&nbsp;prime&nbsp;factor&nbsp;is&nbsp;composite&#34;</span><span class="op" id="4072091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4072095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4072098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4072102">//&nbsp;Check&nbsp;that&nbsp;Πprimes&nbsp;==&nbsp;n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072132">modulus</span>&nbsp;<span class="op" id="4072140">:=</span>&nbsp;<span class="builtinfunc" id="4072143">new</span><span class="op" id="4072146">(</span><span class="ident" id="4072147">big</span><span class="op" id="4072150">.</span><span class="ident" id="4072151">Int</span><span class="op" id="4072154">)</span><span class="op" id="4072155">.</span><span class="ident" id="4072156">Set</span><span class="op" id="4072159">(</span><span class="ident" id="4072160">bigOne</span><span class="op" id="4072166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072169">for</span>&nbsp;<span class="ident" id="4072173">_</span><span class="op" id="4072174">,</span>&nbsp;<span class="ident" id="4072176">prime</span>&nbsp;<span class="op" id="4072182">:=</span>&nbsp;<span class="keyword" id="4072185">range</span>&nbsp;<span class="ident" id="4072191">priv</span><span class="op" id="4072195">.</span><span class="ident" id="4072196">Primes</span>&nbsp;<span class="op" id="4072203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072207">modulus</span><span class="op" id="4072214">.</span><span class="ident" id="4072215">Mul</span><span class="op" id="4072218">(</span><span class="ident" id="4072219">modulus</span><span class="op" id="4072226">,</span>&nbsp;<span class="ident" id="4072228">prime</span><span class="op" id="4072233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4072236">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072239">if</span>&nbsp;<span class="ident" id="4072242">modulus</span><span class="op" id="4072249">.</span><span class="ident" id="4072250">Cmp</span><span class="op" id="4072253">(</span><span class="ident" id="4072254">priv</span><span class="op" id="4072258">.</span><span class="ident" id="4072259">N</span><span class="op" id="4072260">)</span>&nbsp;<span class="op" id="4072262">!=</span>&nbsp;<span class="num" id="4072265">0</span>&nbsp;<span class="op" id="4072267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072271">return</span>&nbsp;<span class="ident" id="4072278">errors</span><span class="op" id="4072284">.</span><span class="ident" id="4072285">New</span><span class="op" id="4072288">(</span><span class="string" id="4072289">&#34;crypto/rsa:&nbsp;invalid&nbsp;modulus&#34;</span><span class="op" id="4072318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4072321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4072325">//&nbsp;Check&nbsp;that&nbsp;de&nbsp;≡&nbsp;1&nbsp;mod&nbsp;p-1,&nbsp;for&nbsp;each&nbsp;prime.</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4072374">//&nbsp;This&nbsp;implies&nbsp;that&nbsp;e&nbsp;is&nbsp;coprime&nbsp;to&nbsp;each&nbsp;p-1&nbsp;as&nbsp;e&nbsp;has&nbsp;a&nbsp;multiplicative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4072447">//&nbsp;inverse.&nbsp;Therefore&nbsp;e&nbsp;is&nbsp;coprime&nbsp;to&nbsp;lcm(p-1,q-1,r-1,...)&nbsp;=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4072509">//&nbsp;exponent(ℤ/nℤ).&nbsp;It&nbsp;also&nbsp;implies&nbsp;that&nbsp;a^de&nbsp;≡&nbsp;a&nbsp;mod&nbsp;p&nbsp;as&nbsp;a^(p-1)&nbsp;≡&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4072588">//&nbsp;mod&nbsp;p.&nbsp;Thus&nbsp;a^de&nbsp;≡&nbsp;a&nbsp;mod&nbsp;n&nbsp;for&nbsp;all&nbsp;a&nbsp;coprime&nbsp;to&nbsp;n,&nbsp;as&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072658">congruence</span>&nbsp;<span class="op" id="4072669">:=</span>&nbsp;<span class="builtinfunc" id="4072672">new</span><span class="op" id="4072675">(</span><span class="ident" id="4072676">big</span><span class="op" id="4072679">.</span><span class="ident" id="4072680">Int</span><span class="op" id="4072683">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072686">de</span>&nbsp;<span class="op" id="4072689">:=</span>&nbsp;<span class="builtinfunc" id="4072692">new</span><span class="op" id="4072695">(</span><span class="ident" id="4072696">big</span><span class="op" id="4072699">.</span><span class="ident" id="4072700">Int</span><span class="op" id="4072703">)</span><span class="op" id="4072704">.</span><span class="ident" id="4072705">SetInt64</span><span class="op" id="4072713">(</span><span class="ident" id="4072714">int64</span><span class="op" id="4072719">(</span><span class="ident" id="4072720">priv</span><span class="op" id="4072724">.</span><span class="ident" id="4072725">E</span><span class="op" id="4072726">)</span><span class="op" id="4072727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072730">de</span><span class="op" id="4072732">.</span><span class="ident" id="4072733">Mul</span><span class="op" id="4072736">(</span><span class="ident" id="4072737">de</span><span class="op" id="4072739">,</span>&nbsp;<span class="ident" id="4072741">priv</span><span class="op" id="4072745">.</span><span class="ident" id="4072746">D</span><span class="op" id="4072747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072750">for</span>&nbsp;<span class="ident" id="4072754">_</span><span class="op" id="4072755">,</span>&nbsp;<span class="ident" id="4072757">prime</span>&nbsp;<span class="op" id="4072763">:=</span>&nbsp;<span class="keyword" id="4072766">range</span>&nbsp;<span class="ident" id="4072772">priv</span><span class="op" id="4072776">.</span><span class="ident" id="4072777">Primes</span>&nbsp;<span class="op" id="4072784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072788">pminus1</span>&nbsp;<span class="op" id="4072796">:=</span>&nbsp;<span class="builtinfunc" id="4072799">new</span><span class="op" id="4072802">(</span><span class="ident" id="4072803">big</span><span class="op" id="4072806">.</span><span class="ident" id="4072807">Int</span><span class="op" id="4072810">)</span><span class="op" id="4072811">.</span><span class="ident" id="4072812">Sub</span><span class="op" id="4072815">(</span><span class="ident" id="4072816">prime</span><span class="op" id="4072821">,</span>&nbsp;<span class="ident" id="4072823">bigOne</span><span class="op" id="4072829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072833">congruence</span><span class="op" id="4072843">.</span><span class="ident" id="4072844">Mod</span><span class="op" id="4072847">(</span><span class="ident" id="4072848">de</span><span class="op" id="4072850">,</span>&nbsp;<span class="ident" id="4072852">pminus1</span><span class="op" id="4072859">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072863">if</span>&nbsp;<span class="ident" id="4072866">congruence</span><span class="op" id="4072876">.</span><span class="ident" id="4072877">Cmp</span><span class="op" id="4072880">(</span><span class="ident" id="4072881">bigOne</span><span class="op" id="4072887">)</span>&nbsp;<span class="op" id="4072889">!=</span>&nbsp;<span class="num" id="4072892">0</span>&nbsp;<span class="op" id="4072894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072899">return</span>&nbsp;<span class="ident" id="4072906">errors</span><span class="op" id="4072912">.</span><span class="ident" id="4072913">New</span><span class="op" id="4072916">(</span><span class="string" id="4072917">&#34;crypto/rsa:&nbsp;invalid&nbsp;exponents&#34;</span><span class="op" id="4072948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4072952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4072955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072958">return</span>&nbsp;<span class="ident" id="4072965">nil</span><br>
<span class="lineno">140</span><span class="op" id="4072969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4072972">//&nbsp;GenerateKey&nbsp;generates&nbsp;an&nbsp;RSA&nbsp;keypair&nbsp;of&nbsp;the&nbsp;given&nbsp;bit&nbsp;size&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4073044">//&nbsp;random&nbsp;source&nbsp;random&nbsp;(for&nbsp;example,&nbsp;crypto/rand.Reader).</span><br>
<span class="lineno"></span><span class="keyword" id="4073103">func</span>&nbsp;<span class="ident" id="4073108">GenerateKey</span><span class="op" id="4073119">(</span><span class="ident" id="4073120">random</span>&nbsp;<span class="ident" id="4073127">io</span><span class="op" id="4073129">.</span><span class="ident" id="4073130">Reader</span><span class="op" id="4073136">,</span>&nbsp;<span class="ident" id="4073138">bits</span>&nbsp;<span class="builtintype" id="4073143">int</span><span class="op" id="4073146">)</span>&nbsp;<span class="op" id="4073148">(</span><span class="ident" id="4073149">priv</span>&nbsp;<span class="op" id="4073154">*</span><span class="ident" id="4073155">PrivateKey</span><span class="op" id="4073165">,</span>&nbsp;<span class="ident" id="4073167">err</span>&nbsp;<span class="builtintype" id="4073171">error</span><span class="op" id="4073176">)</span>&nbsp;<span class="op" id="4073178">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4073181">return</span>&nbsp;<span class="ident" id="4073188">GenerateMultiPrimeKey</span><span class="op" id="4073209">(</span><span class="ident" id="4073210">random</span><span class="op" id="4073216">,</span>&nbsp;<span class="num" id="4073218">2</span><span class="op" id="4073219">,</span>&nbsp;<span class="ident" id="4073221">bits</span><span class="op" id="4073225">)</span><br>
<span class="lineno"></span><span class="op" id="4073227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4073230">//&nbsp;GenerateMultiPrimeKey&nbsp;generates&nbsp;a&nbsp;multi-prime&nbsp;RSA&nbsp;keypair&nbsp;of&nbsp;the&nbsp;given&nbsp;bit</span><br>
<span class="lineno"></span><span class="comment" id="4073308">//&nbsp;size&nbsp;and&nbsp;the&nbsp;given&nbsp;random&nbsp;source,&nbsp;as&nbsp;suggested&nbsp;in&nbsp;[1].&nbsp;Although&nbsp;the&nbsp;public</span><br>
<span class="lineno">150</span><span class="comment" id="4073386">//&nbsp;keys&nbsp;are&nbsp;compatible&nbsp;(actually,&nbsp;indistinguishable)&nbsp;from&nbsp;the&nbsp;2-prime&nbsp;case,</span><br>
<span class="lineno"></span><span class="comment" id="4073462">//&nbsp;the&nbsp;private&nbsp;keys&nbsp;are&nbsp;not.&nbsp;Thus&nbsp;it&nbsp;may&nbsp;not&nbsp;be&nbsp;possible&nbsp;to&nbsp;export&nbsp;multi-prime</span><br>
<span class="lineno"></span><span class="comment" id="4073541">//&nbsp;private&nbsp;keys&nbsp;in&nbsp;certain&nbsp;formats&nbsp;or&nbsp;to&nbsp;subsequently&nbsp;import&nbsp;them&nbsp;into&nbsp;other</span><br>
<span class="lineno"></span><span class="comment" id="4073618">//&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4073627">//</span><br>
<span class="lineno">155</span><span class="comment" id="4073630">//&nbsp;Table&nbsp;1&nbsp;in&nbsp;[2]&nbsp;suggests&nbsp;maximum&nbsp;numbers&nbsp;of&nbsp;primes&nbsp;for&nbsp;a&nbsp;given&nbsp;size.</span><br>
<span class="lineno"></span><span class="comment" id="4073701">//</span><br>
<span class="lineno"></span><span class="comment" id="4073704">//&nbsp;[1]&nbsp;US&nbsp;patent&nbsp;4405829&nbsp;(1972,&nbsp;expired)</span><br>
<span class="lineno"></span><span class="comment" id="4073745">//&nbsp;[2]&nbsp;http://www.cacr.math.uwaterloo.ca/techreports/2006/cacr2006-16.pdf</span><br>
<span class="lineno"></span><span class="keyword" id="4073819">func</span>&nbsp;<span class="ident" id="4073824">GenerateMultiPrimeKey</span><span class="op" id="4073845">(</span><span class="ident" id="4073846">random</span>&nbsp;<span class="ident" id="4073853">io</span><span class="op" id="4073855">.</span><span class="ident" id="4073856">Reader</span><span class="op" id="4073862">,</span>&nbsp;<span class="ident" id="4073864">nprimes</span>&nbsp;<span class="builtintype" id="4073872">int</span><span class="op" id="4073875">,</span>&nbsp;<span class="ident" id="4073877">bits</span>&nbsp;<span class="builtintype" id="4073882">int</span><span class="op" id="4073885">)</span>&nbsp;<span class="op" id="4073887">(</span><span class="ident" id="4073888">priv</span>&nbsp;<span class="op" id="4073893">*</span><span class="ident" id="4073894">PrivateKey</span><span class="op" id="4073904">,</span>&nbsp;<span class="ident" id="4073906">err</span>&nbsp;<span class="builtintype" id="4073910">error</span><span class="op" id="4073915">)</span>&nbsp;<span class="op" id="4073917">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4073920">priv</span>&nbsp;<span class="op" id="4073925">=</span>&nbsp;<span class="builtinfunc" id="4073927">new</span><span class="op" id="4073930">(</span><span class="ident" id="4073931">PrivateKey</span><span class="op" id="4073941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4073944">priv</span><span class="op" id="4073948">.</span><span class="ident" id="4073949">E</span>&nbsp;<span class="op" id="4073951">=</span>&nbsp;<span class="num" id="4073953">65537</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4073961">if</span>&nbsp;<span class="ident" id="4073964">nprimes</span>&nbsp;<span class="op" id="4073972">&lt;</span>&nbsp;<span class="num" id="4073974">2</span>&nbsp;<span class="op" id="4073976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4073980">return</span>&nbsp;<span class="ident" id="4073987">nil</span><span class="op" id="4073990">,</span>&nbsp;<span class="ident" id="4073992">errors</span><span class="op" id="4073998">.</span><span class="ident" id="4073999">New</span><span class="op" id="4074002">(</span><span class="string" id="4074003">&#34;crypto/rsa:&nbsp;GenerateMultiPrimeKey:&nbsp;nprimes&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;2&#34;</span><span class="op" id="4074060">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4074063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074067">primes</span>&nbsp;<span class="op" id="4074074">:=</span>&nbsp;<span class="builtinfunc" id="4074077">make</span><span class="op" id="4074081">(</span><span class="op" id="4074082">[</span><span class="op" id="4074083">]</span><span class="op" id="4074084">*</span><span class="ident" id="4074085">big</span><span class="op" id="4074088">.</span><span class="ident" id="4074089">Int</span><span class="op" id="4074092">,</span>&nbsp;<span class="ident" id="4074094">nprimes</span><span class="op" id="4074101">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="4074104">NextSetOfPrimes</span><span class="op" id="4074119">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074122">for</span>&nbsp;<span class="op" id="4074126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074130">todo</span>&nbsp;<span class="op" id="4074135">:=</span>&nbsp;<span class="ident" id="4074138">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4074145">//&nbsp;crypto/rand&nbsp;should&nbsp;set&nbsp;the&nbsp;top&nbsp;two&nbsp;bits&nbsp;in&nbsp;each&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4074205">//&nbsp;Thus&nbsp;each&nbsp;prime&nbsp;has&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4074239">//&nbsp;&nbsp;&nbsp;p_i&nbsp;=&nbsp;2^bitlen(p_i)&nbsp;×&nbsp;0.11...&nbsp;(in&nbsp;base&nbsp;2).</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4074290">//&nbsp;And&nbsp;the&nbsp;product&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4074315">//&nbsp;&nbsp;&nbsp;P&nbsp;=&nbsp;2^todo&nbsp;×&nbsp;α</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4074339">//&nbsp;where&nbsp;α&nbsp;is&nbsp;the&nbsp;product&nbsp;of&nbsp;nprimes&nbsp;numbers&nbsp;of&nbsp;the&nbsp;form&nbsp;0.11...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4074407">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4074412">//&nbsp;If&nbsp;α&nbsp;&lt;&nbsp;1/2&nbsp;(which&nbsp;can&nbsp;happen&nbsp;for&nbsp;nprimes&nbsp;&gt;&nbsp;2),&nbsp;we&nbsp;need&nbsp;to</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4074476">//&nbsp;shift&nbsp;todo&nbsp;to&nbsp;compensate&nbsp;for&nbsp;lost&nbsp;bits:&nbsp;the&nbsp;mean&nbsp;value&nbsp;of&nbsp;0.11...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4074547">//&nbsp;is&nbsp;7/8,&nbsp;so&nbsp;todo&nbsp;+&nbsp;shift&nbsp;-&nbsp;nprimes&nbsp;*&nbsp;log2(7/8)&nbsp;~=&nbsp;bits&nbsp;-&nbsp;1/2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4074612">//&nbsp;will&nbsp;give&nbsp;good&nbsp;results.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074641">if</span>&nbsp;<span class="ident" id="4074644">nprimes</span>&nbsp;<span class="op" id="4074652">&gt;=</span>&nbsp;<span class="num" id="4074655">7</span>&nbsp;<span class="op" id="4074657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074662">todo</span>&nbsp;<span class="op" id="4074667">+=</span>&nbsp;<span class="op" id="4074670">(</span><span class="ident" id="4074671">nprimes</span>&nbsp;<span class="op" id="4074679">-</span>&nbsp;<span class="num" id="4074681">2</span><span class="op" id="4074682">)</span>&nbsp;<span class="op" id="4074684">/</span>&nbsp;<span class="num" id="4074686">5</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4074690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074694">for</span>&nbsp;<span class="ident" id="4074698">i</span>&nbsp;<span class="op" id="4074700">:=</span>&nbsp;<span class="num" id="4074703">0</span><span class="op" id="4074704">;</span>&nbsp;<span class="ident" id="4074706">i</span>&nbsp;<span class="op" id="4074708">&lt;</span>&nbsp;<span class="ident" id="4074710">nprimes</span><span class="op" id="4074717">;</span>&nbsp;<span class="ident" id="4074719">i</span><span class="op" id="4074720">++</span>&nbsp;<span class="op" id="4074723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074728">primes</span><span class="op" id="4074734">[</span><span class="ident" id="4074735">i</span><span class="op" id="4074736">]</span><span class="op" id="4074737">,</span>&nbsp;<span class="ident" id="4074739">err</span>&nbsp;<span class="op" id="4074743">=</span>&nbsp;<span class="ident" id="4074745">rand</span><span class="op" id="4074749">.</span><span class="ident" id="4074750">Prime</span><span class="op" id="4074755">(</span><span class="ident" id="4074756">random</span><span class="op" id="4074762">,</span>&nbsp;<span class="ident" id="4074764">todo</span><span class="op" id="4074768">/</span><span class="op" id="4074769">(</span><span class="ident" id="4074770">nprimes</span><span class="op" id="4074777">-</span><span class="ident" id="4074778">i</span><span class="op" id="4074779">)</span><span class="op" id="4074780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074785">if</span>&nbsp;<span class="ident" id="4074788">err</span>&nbsp;<span class="op" id="4074792">!=</span>&nbsp;<span class="ident" id="4074795">nil</span>&nbsp;<span class="op" id="4074799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074805">return</span>&nbsp;<span class="ident" id="4074812">nil</span><span class="op" id="4074815">,</span>&nbsp;<span class="ident" id="4074817">err</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4074824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074829">todo</span>&nbsp;<span class="op" id="4074834">-=</span>&nbsp;<span class="ident" id="4074837">primes</span><span class="op" id="4074843">[</span><span class="ident" id="4074844">i</span><span class="op" id="4074845">]</span><span class="op" id="4074846">.</span><span class="ident" id="4074847">BitLen</span><span class="op" id="4074853">(</span><span class="op" id="4074854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4074858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4074863">//&nbsp;Make&nbsp;sure&nbsp;that&nbsp;primes&nbsp;is&nbsp;pairwise&nbsp;unequal.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074911">for</span>&nbsp;<span class="ident" id="4074915">i</span><span class="op" id="4074916">,</span>&nbsp;<span class="ident" id="4074918">prime</span>&nbsp;<span class="op" id="4074924">:=</span>&nbsp;<span class="keyword" id="4074927">range</span>&nbsp;<span class="ident" id="4074933">primes</span>&nbsp;<span class="op" id="4074940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074945">for</span>&nbsp;<span class="ident" id="4074949">j</span>&nbsp;<span class="op" id="4074951">:=</span>&nbsp;<span class="num" id="4074954">0</span><span class="op" id="4074955">;</span>&nbsp;<span class="ident" id="4074957">j</span>&nbsp;<span class="op" id="4074959">&lt;</span>&nbsp;<span class="ident" id="4074961">i</span><span class="op" id="4074962">;</span>&nbsp;<span class="ident" id="4074964">j</span><span class="op" id="4074965">++</span>&nbsp;<span class="op" id="4074968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074974">if</span>&nbsp;<span class="ident" id="4074977">prime</span><span class="op" id="4074982">.</span><span class="ident" id="4074983">Cmp</span><span class="op" id="4074986">(</span><span class="ident" id="4074987">primes</span><span class="op" id="4074993">[</span><span class="ident" id="4074994">j</span><span class="op" id="4074995">]</span><span class="op" id="4074996">)</span>&nbsp;<span class="op" id="4074998">==</span>&nbsp;<span class="num" id="4075001">0</span>&nbsp;<span class="op" id="4075003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075010">continue</span>&nbsp;<span class="ident" id="4075019">NextSetOfPrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4075039">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4075044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4075048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075053">n</span>&nbsp;<span class="op" id="4075055">:=</span>&nbsp;<span class="builtinfunc" id="4075058">new</span><span class="op" id="4075061">(</span><span class="ident" id="4075062">big</span><span class="op" id="4075065">.</span><span class="ident" id="4075066">Int</span><span class="op" id="4075069">)</span><span class="op" id="4075070">.</span><span class="ident" id="4075071">Set</span><span class="op" id="4075074">(</span><span class="ident" id="4075075">bigOne</span><span class="op" id="4075081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075085">totient</span>&nbsp;<span class="op" id="4075093">:=</span>&nbsp;<span class="builtinfunc" id="4075096">new</span><span class="op" id="4075099">(</span><span class="ident" id="4075100">big</span><span class="op" id="4075103">.</span><span class="ident" id="4075104">Int</span><span class="op" id="4075107">)</span><span class="op" id="4075108">.</span><span class="ident" id="4075109">Set</span><span class="op" id="4075112">(</span><span class="ident" id="4075113">bigOne</span><span class="op" id="4075119">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075123">pminus1</span>&nbsp;<span class="op" id="4075131">:=</span>&nbsp;<span class="builtinfunc" id="4075134">new</span><span class="op" id="4075137">(</span><span class="ident" id="4075138">big</span><span class="op" id="4075141">.</span><span class="ident" id="4075142">Int</span><span class="op" id="4075145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075149">for</span>&nbsp;<span class="ident" id="4075153">_</span><span class="op" id="4075154">,</span>&nbsp;<span class="ident" id="4075156">prime</span>&nbsp;<span class="op" id="4075162">:=</span>&nbsp;<span class="keyword" id="4075165">range</span>&nbsp;<span class="ident" id="4075171">primes</span>&nbsp;<span class="op" id="4075178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075183">n</span><span class="op" id="4075184">.</span><span class="ident" id="4075185">Mul</span><span class="op" id="4075188">(</span><span class="ident" id="4075189">n</span><span class="op" id="4075190">,</span>&nbsp;<span class="ident" id="4075192">prime</span><span class="op" id="4075197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075202">pminus1</span><span class="op" id="4075209">.</span><span class="ident" id="4075210">Sub</span><span class="op" id="4075213">(</span><span class="ident" id="4075214">prime</span><span class="op" id="4075219">,</span>&nbsp;<span class="ident" id="4075221">bigOne</span><span class="op" id="4075227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075232">totient</span><span class="op" id="4075239">.</span><span class="ident" id="4075240">Mul</span><span class="op" id="4075243">(</span><span class="ident" id="4075244">totient</span><span class="op" id="4075251">,</span>&nbsp;<span class="ident" id="4075253">pminus1</span><span class="op" id="4075260">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4075264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075268">if</span>&nbsp;<span class="ident" id="4075271">n</span><span class="op" id="4075272">.</span><span class="ident" id="4075273">BitLen</span><span class="op" id="4075279">(</span><span class="op" id="4075280">)</span>&nbsp;<span class="op" id="4075282">!=</span>&nbsp;<span class="ident" id="4075285">bits</span>&nbsp;<span class="op" id="4075290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4075295">//&nbsp;This&nbsp;should&nbsp;never&nbsp;happen&nbsp;for&nbsp;nprimes&nbsp;==&nbsp;2&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4075351">//&nbsp;crypto/rand&nbsp;should&nbsp;set&nbsp;the&nbsp;top&nbsp;two&nbsp;bits&nbsp;in&nbsp;each&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4075412">//&nbsp;For&nbsp;nprimes&nbsp;&gt;&nbsp;2&nbsp;we&nbsp;hope&nbsp;it&nbsp;does&nbsp;not&nbsp;happen&nbsp;often.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075468">continue</span>&nbsp;<span class="ident" id="4075477">NextSetOfPrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4075495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075500">g</span>&nbsp;<span class="op" id="4075502">:=</span>&nbsp;<span class="builtinfunc" id="4075505">new</span><span class="op" id="4075508">(</span><span class="ident" id="4075509">big</span><span class="op" id="4075512">.</span><span class="ident" id="4075513">Int</span><span class="op" id="4075516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075520">priv</span><span class="op" id="4075524">.</span><span class="ident" id="4075525">D</span>&nbsp;<span class="op" id="4075527">=</span>&nbsp;<span class="builtinfunc" id="4075529">new</span><span class="op" id="4075532">(</span><span class="ident" id="4075533">big</span><span class="op" id="4075536">.</span><span class="ident" id="4075537">Int</span><span class="op" id="4075540">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075544">y</span>&nbsp;<span class="op" id="4075546">:=</span>&nbsp;<span class="builtinfunc" id="4075549">new</span><span class="op" id="4075552">(</span><span class="ident" id="4075553">big</span><span class="op" id="4075556">.</span><span class="ident" id="4075557">Int</span><span class="op" id="4075560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075564">e</span>&nbsp;<span class="op" id="4075566">:=</span>&nbsp;<span class="ident" id="4075569">big</span><span class="op" id="4075572">.</span><span class="ident" id="4075573">NewInt</span><span class="op" id="4075579">(</span><span class="ident" id="4075580">int64</span><span class="op" id="4075585">(</span><span class="ident" id="4075586">priv</span><span class="op" id="4075590">.</span><span class="ident" id="4075591">E</span><span class="op" id="4075592">)</span><span class="op" id="4075593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075597">g</span><span class="op" id="4075598">.</span><span class="ident" id="4075599">GCD</span><span class="op" id="4075602">(</span><span class="ident" id="4075603">priv</span><span class="op" id="4075607">.</span><span class="ident" id="4075608">D</span><span class="op" id="4075609">,</span>&nbsp;<span class="ident" id="4075611">y</span><span class="op" id="4075612">,</span>&nbsp;<span class="ident" id="4075614">e</span><span class="op" id="4075615">,</span>&nbsp;<span class="ident" id="4075617">totient</span><span class="op" id="4075624">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075629">if</span>&nbsp;<span class="ident" id="4075632">g</span><span class="op" id="4075633">.</span><span class="ident" id="4075634">Cmp</span><span class="op" id="4075637">(</span><span class="ident" id="4075638">bigOne</span><span class="op" id="4075644">)</span>&nbsp;<span class="op" id="4075646">==</span>&nbsp;<span class="num" id="4075649">0</span>&nbsp;<span class="op" id="4075651">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075656">if</span>&nbsp;<span class="ident" id="4075659">priv</span><span class="op" id="4075663">.</span><span class="ident" id="4075664">D</span><span class="op" id="4075665">.</span><span class="ident" id="4075666">Sign</span><span class="op" id="4075670">(</span><span class="op" id="4075671">)</span>&nbsp;<span class="op" id="4075673">&lt;</span>&nbsp;<span class="num" id="4075675">0</span>&nbsp;<span class="op" id="4075677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075683">priv</span><span class="op" id="4075687">.</span><span class="ident" id="4075688">D</span><span class="op" id="4075689">.</span><span class="ident" id="4075690">Add</span><span class="op" id="4075693">(</span><span class="ident" id="4075694">priv</span><span class="op" id="4075698">.</span><span class="ident" id="4075699">D</span><span class="op" id="4075700">,</span>&nbsp;<span class="ident" id="4075702">totient</span><span class="op" id="4075709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4075714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075719">priv</span><span class="op" id="4075723">.</span><span class="ident" id="4075724">Primes</span>&nbsp;<span class="op" id="4075731">=</span>&nbsp;<span class="ident" id="4075733">primes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075743">priv</span><span class="op" id="4075747">.</span><span class="ident" id="4075748">N</span>&nbsp;<span class="op" id="4075750">=</span>&nbsp;<span class="ident" id="4075752">n</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075758">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4075766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4075769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075773">priv</span><span class="op" id="4075777">.</span><span class="ident" id="4075778">Precompute</span><span class="op" id="4075788">(</span><span class="op" id="4075789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075792">return</span><br>
<span class="lineno"></span><span class="op" id="4075799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4075802">//&nbsp;incCounter&nbsp;increments&nbsp;a&nbsp;four&nbsp;byte,&nbsp;big-endian&nbsp;counter.</span><br>
<span class="lineno">240</span><span class="keyword" id="4075860">func</span>&nbsp;<span class="ident" id="4075865">incCounter</span><span class="op" id="4075875">(</span><span class="ident" id="4075876">c</span>&nbsp;<span class="op" id="4075878">*</span><span class="op" id="4075879">[</span><span class="num" id="4075880">4</span><span class="op" id="4075881">]</span><span class="builtintype" id="4075882">byte</span><span class="op" id="4075886">)</span>&nbsp;<span class="op" id="4075888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075891">if</span>&nbsp;<span class="ident" id="4075894">c</span><span class="op" id="4075895">[</span><span class="num" id="4075896">3</span><span class="op" id="4075897">]</span><span class="op" id="4075898">++</span><span class="op" id="4075900">;</span>&nbsp;<span class="ident" id="4075902">c</span><span class="op" id="4075903">[</span><span class="num" id="4075904">3</span><span class="op" id="4075905">]</span>&nbsp;<span class="op" id="4075907">!=</span>&nbsp;<span class="num" id="4075910">0</span>&nbsp;<span class="op" id="4075912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075916">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4075924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075927">if</span>&nbsp;<span class="ident" id="4075930">c</span><span class="op" id="4075931">[</span><span class="num" id="4075932">2</span><span class="op" id="4075933">]</span><span class="op" id="4075934">++</span><span class="op" id="4075936">;</span>&nbsp;<span class="ident" id="4075938">c</span><span class="op" id="4075939">[</span><span class="num" id="4075940">2</span><span class="op" id="4075941">]</span>&nbsp;<span class="op" id="4075943">!=</span>&nbsp;<span class="num" id="4075946">0</span>&nbsp;<span class="op" id="4075948">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075952">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4075960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075963">if</span>&nbsp;<span class="ident" id="4075966">c</span><span class="op" id="4075967">[</span><span class="num" id="4075968">1</span><span class="op" id="4075969">]</span><span class="op" id="4075970">++</span><span class="op" id="4075972">;</span>&nbsp;<span class="ident" id="4075974">c</span><span class="op" id="4075975">[</span><span class="num" id="4075976">1</span><span class="op" id="4075977">]</span>&nbsp;<span class="op" id="4075979">!=</span>&nbsp;<span class="num" id="4075982">0</span>&nbsp;<span class="op" id="4075984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075988">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4075996">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075999">c</span><span class="op" id="4076000">[</span><span class="num" id="4076001">0</span><span class="op" id="4076002">]</span><span class="op" id="4076003">++</span><br>
<span class="lineno"></span><span class="op" id="4076006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4076009">//&nbsp;mgf1XOR&nbsp;XORs&nbsp;the&nbsp;bytes&nbsp;in&nbsp;out&nbsp;with&nbsp;a&nbsp;mask&nbsp;generated&nbsp;using&nbsp;the&nbsp;MGF1&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="4076088">//&nbsp;specified&nbsp;in&nbsp;PKCS#1&nbsp;v2.1.</span><br>
<span class="lineno">255</span><span class="keyword" id="4076117">func</span>&nbsp;<span class="ident" id="4076122">mgf1XOR</span><span class="op" id="4076129">(</span><span class="ident" id="4076130">out</span>&nbsp;<span class="op" id="4076134">[</span><span class="op" id="4076135">]</span><span class="builtintype" id="4076136">byte</span><span class="op" id="4076140">,</span>&nbsp;<span class="ident" id="4076142">hash</span>&nbsp;<span class="ident" id="4076147">hash</span><span class="op" id="4076151">.</span><span class="ident" id="4076152">Hash</span><span class="op" id="4076156">,</span>&nbsp;<span class="ident" id="4076158">seed</span>&nbsp;<span class="op" id="4076163">[</span><span class="op" id="4076164">]</span><span class="builtintype" id="4076165">byte</span><span class="op" id="4076169">)</span>&nbsp;<span class="op" id="4076171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076174">var</span>&nbsp;<span class="ident" id="4076178">counter</span>&nbsp;<span class="op" id="4076186">[</span><span class="num" id="4076187">4</span><span class="op" id="4076188">]</span><span class="builtintype" id="4076189">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076195">var</span>&nbsp;<span class="ident" id="4076199">digest</span>&nbsp;<span class="op" id="4076206">[</span><span class="op" id="4076207">]</span><span class="builtintype" id="4076208">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076215">done</span>&nbsp;<span class="op" id="4076220">:=</span>&nbsp;<span class="num" id="4076223">0</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076226">for</span>&nbsp;<span class="ident" id="4076230">done</span>&nbsp;<span class="op" id="4076235">&lt;</span>&nbsp;<span class="builtinfunc" id="4076237">len</span><span class="op" id="4076240">(</span><span class="ident" id="4076241">out</span><span class="op" id="4076244">)</span>&nbsp;<span class="op" id="4076246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076250">hash</span><span class="op" id="4076254">.</span><span class="ident" id="4076255">Write</span><span class="op" id="4076260">(</span><span class="ident" id="4076261">seed</span><span class="op" id="4076265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076269">hash</span><span class="op" id="4076273">.</span><span class="ident" id="4076274">Write</span><span class="op" id="4076279">(</span><span class="ident" id="4076280">counter</span><span class="op" id="4076287">[</span><span class="num" id="4076288">0</span><span class="op" id="4076289">:</span><span class="num" id="4076290">4</span><span class="op" id="4076291">]</span><span class="op" id="4076292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076296">digest</span>&nbsp;<span class="op" id="4076303">=</span>&nbsp;<span class="ident" id="4076305">hash</span><span class="op" id="4076309">.</span><span class="ident" id="4076310">Sum</span><span class="op" id="4076313">(</span><span class="ident" id="4076314">digest</span><span class="op" id="4076320">[</span><span class="op" id="4076321">:</span><span class="num" id="4076322">0</span><span class="op" id="4076323">]</span><span class="op" id="4076324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076328">hash</span><span class="op" id="4076332">.</span><span class="ident" id="4076333">Reset</span><span class="op" id="4076338">(</span><span class="op" id="4076339">)</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076344">for</span>&nbsp;<span class="ident" id="4076348">i</span>&nbsp;<span class="op" id="4076350">:=</span>&nbsp;<span class="num" id="4076353">0</span><span class="op" id="4076354">;</span>&nbsp;<span class="ident" id="4076356">i</span>&nbsp;<span class="op" id="4076358">&lt;</span>&nbsp;<span class="builtinfunc" id="4076360">len</span><span class="op" id="4076363">(</span><span class="ident" id="4076364">digest</span><span class="op" id="4076370">)</span>&nbsp;<span class="op" id="4076372">&amp;&amp;</span>&nbsp;<span class="ident" id="4076375">done</span>&nbsp;<span class="op" id="4076380">&lt;</span>&nbsp;<span class="builtinfunc" id="4076382">len</span><span class="op" id="4076385">(</span><span class="ident" id="4076386">out</span><span class="op" id="4076389">)</span><span class="op" id="4076390">;</span>&nbsp;<span class="ident" id="4076392">i</span><span class="op" id="4076393">++</span>&nbsp;<span class="op" id="4076396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076401">out</span><span class="op" id="4076404">[</span><span class="ident" id="4076405">done</span><span class="op" id="4076409">]</span>&nbsp;<span class="op" id="4076411">^=</span>&nbsp;<span class="ident" id="4076414">digest</span><span class="op" id="4076420">[</span><span class="ident" id="4076421">i</span><span class="op" id="4076422">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076427">done</span><span class="op" id="4076431">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4076436">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076440">incCounter</span><span class="op" id="4076450">(</span><span class="op" id="4076451">&amp;</span><span class="ident" id="4076452">counter</span><span class="op" id="4076459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4076462">}</span><br>
<span class="lineno"></span><span class="op" id="4076464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4076467">//&nbsp;ErrMessageTooLong&nbsp;is&nbsp;returned&nbsp;when&nbsp;attempting&nbsp;to&nbsp;encrypt&nbsp;a&nbsp;message&nbsp;which&nbsp;is</span><br>
<span class="lineno">275</span><span class="comment" id="4076546">//&nbsp;too&nbsp;large&nbsp;for&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4076591">var</span>&nbsp;<span class="ident" id="4076595">ErrMessageTooLong</span>&nbsp;<span class="op" id="4076613">=</span>&nbsp;<span class="ident" id="4076615">errors</span><span class="op" id="4076621">.</span><span class="ident" id="4076622">New</span><span class="op" id="4076625">(</span><span class="string" id="4076626">&#34;crypto/rsa:&nbsp;message&nbsp;too&nbsp;long&nbsp;for&nbsp;RSA&nbsp;public&nbsp;key&nbsp;size&#34;</span><span class="op" id="4076680">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4076683">func</span>&nbsp;<span class="ident" id="4076688">encrypt</span><span class="op" id="4076695">(</span><span class="ident" id="4076696">c</span>&nbsp;<span class="op" id="4076698">*</span><span class="ident" id="4076699">big</span><span class="op" id="4076702">.</span><span class="ident" id="4076703">Int</span><span class="op" id="4076706">,</span>&nbsp;<span class="ident" id="4076708">pub</span>&nbsp;<span class="op" id="4076712">*</span><span class="ident" id="4076713">PublicKey</span><span class="op" id="4076722">,</span>&nbsp;<span class="ident" id="4076724">m</span>&nbsp;<span class="op" id="4076726">*</span><span class="ident" id="4076727">big</span><span class="op" id="4076730">.</span><span class="ident" id="4076731">Int</span><span class="op" id="4076734">)</span>&nbsp;<span class="op" id="4076736">*</span><span class="ident" id="4076737">big</span><span class="op" id="4076740">.</span><span class="ident" id="4076741">Int</span>&nbsp;<span class="op" id="4076745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076748">e</span>&nbsp;<span class="op" id="4076750">:=</span>&nbsp;<span class="ident" id="4076753">big</span><span class="op" id="4076756">.</span><span class="ident" id="4076757">NewInt</span><span class="op" id="4076763">(</span><span class="ident" id="4076764">int64</span><span class="op" id="4076769">(</span><span class="ident" id="4076770">pub</span><span class="op" id="4076773">.</span><span class="ident" id="4076774">E</span><span class="op" id="4076775">)</span><span class="op" id="4076776">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076779">c</span><span class="op" id="4076780">.</span><span class="ident" id="4076781">Exp</span><span class="op" id="4076784">(</span><span class="ident" id="4076785">m</span><span class="op" id="4076786">,</span>&nbsp;<span class="ident" id="4076788">e</span><span class="op" id="4076789">,</span>&nbsp;<span class="ident" id="4076791">pub</span><span class="op" id="4076794">.</span><span class="ident" id="4076795">N</span><span class="op" id="4076796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076799">return</span>&nbsp;<span class="ident" id="4076806">c</span><br>
<span class="lineno"></span><span class="op" id="4076808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4076811">//&nbsp;EncryptOAEP&nbsp;encrypts&nbsp;the&nbsp;given&nbsp;message&nbsp;with&nbsp;RSA-OAEP.</span><br>
<span class="lineno">285</span><span class="comment" id="4076868">//&nbsp;The&nbsp;message&nbsp;must&nbsp;be&nbsp;no&nbsp;longer&nbsp;than&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;public&nbsp;modulus&nbsp;less</span><br>
<span class="lineno"></span><span class="comment" id="4076944">//&nbsp;twice&nbsp;the&nbsp;hash&nbsp;length&nbsp;plus&nbsp;2.</span><br>
<span class="lineno"></span><span class="keyword" id="4076977">func</span>&nbsp;<span class="ident" id="4076982">EncryptOAEP</span><span class="op" id="4076993">(</span><span class="ident" id="4076994">hash</span>&nbsp;<span class="ident" id="4076999">hash</span><span class="op" id="4077003">.</span><span class="ident" id="4077004">Hash</span><span class="op" id="4077008">,</span>&nbsp;<span class="ident" id="4077010">random</span>&nbsp;<span class="ident" id="4077017">io</span><span class="op" id="4077019">.</span><span class="ident" id="4077020">Reader</span><span class="op" id="4077026">,</span>&nbsp;<span class="ident" id="4077028">pub</span>&nbsp;<span class="op" id="4077032">*</span><span class="ident" id="4077033">PublicKey</span><span class="op" id="4077042">,</span>&nbsp;<span class="ident" id="4077044">msg</span>&nbsp;<span class="op" id="4077048">[</span><span class="op" id="4077049">]</span><span class="builtintype" id="4077050">byte</span><span class="op" id="4077054">,</span>&nbsp;<span class="ident" id="4077056">label</span>&nbsp;<span class="op" id="4077062">[</span><span class="op" id="4077063">]</span><span class="builtintype" id="4077064">byte</span><span class="op" id="4077068">)</span>&nbsp;<span class="op" id="4077070">(</span><span class="ident" id="4077071">out</span>&nbsp;<span class="op" id="4077075">[</span><span class="op" id="4077076">]</span><span class="builtintype" id="4077077">byte</span><span class="op" id="4077081">,</span>&nbsp;<span class="ident" id="4077083">err</span>&nbsp;<span class="builtintype" id="4077087">error</span><span class="op" id="4077092">)</span>&nbsp;<span class="op" id="4077094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077097">if</span>&nbsp;<span class="ident" id="4077100">err</span>&nbsp;<span class="op" id="4077104">:=</span>&nbsp;<span class="ident" id="4077107">checkPub</span><span class="op" id="4077115">(</span><span class="ident" id="4077116">pub</span><span class="op" id="4077119">)</span><span class="op" id="4077120">;</span>&nbsp;<span class="ident" id="4077122">err</span>&nbsp;<span class="op" id="4077126">!=</span>&nbsp;<span class="ident" id="4077129">nil</span>&nbsp;<span class="op" id="4077133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077137">return</span>&nbsp;<span class="ident" id="4077144">nil</span><span class="op" id="4077147">,</span>&nbsp;<span class="ident" id="4077149">err</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4077154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077157">hash</span><span class="op" id="4077161">.</span><span class="ident" id="4077162">Reset</span><span class="op" id="4077167">(</span><span class="op" id="4077168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077171">k</span>&nbsp;<span class="op" id="4077173">:=</span>&nbsp;<span class="op" id="4077176">(</span><span class="ident" id="4077177">pub</span><span class="op" id="4077180">.</span><span class="ident" id="4077181">N</span><span class="op" id="4077182">.</span><span class="ident" id="4077183">BitLen</span><span class="op" id="4077189">(</span><span class="op" id="4077190">)</span>&nbsp;<span class="op" id="4077192">+</span>&nbsp;<span class="num" id="4077194">7</span><span class="op" id="4077195">)</span>&nbsp;<span class="op" id="4077197">/</span>&nbsp;<span class="num" id="4077199">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077202">if</span>&nbsp;<span class="builtinfunc" id="4077205">len</span><span class="op" id="4077208">(</span><span class="ident" id="4077209">msg</span><span class="op" id="4077212">)</span>&nbsp;<span class="op" id="4077214">&gt;</span>&nbsp;<span class="ident" id="4077216">k</span><span class="op" id="4077217">-</span><span class="num" id="4077218">2</span><span class="op" id="4077219">*</span><span class="ident" id="4077220">hash</span><span class="op" id="4077224">.</span><span class="ident" id="4077225">Size</span><span class="op" id="4077229">(</span><span class="op" id="4077230">)</span><span class="op" id="4077231">-</span><span class="num" id="4077232">2</span>&nbsp;<span class="op" id="4077234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077238">err</span>&nbsp;<span class="op" id="4077242">=</span>&nbsp;<span class="ident" id="4077244">ErrMessageTooLong</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077264">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4077272">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077276">hash</span><span class="op" id="4077280">.</span><span class="ident" id="4077281">Write</span><span class="op" id="4077286">(</span><span class="ident" id="4077287">label</span><span class="op" id="4077292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077295">lHash</span>&nbsp;<span class="op" id="4077301">:=</span>&nbsp;<span class="ident" id="4077304">hash</span><span class="op" id="4077308">.</span><span class="ident" id="4077309">Sum</span><span class="op" id="4077312">(</span><span class="ident" id="4077313">nil</span><span class="op" id="4077316">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077319">hash</span><span class="op" id="4077323">.</span><span class="ident" id="4077324">Reset</span><span class="op" id="4077329">(</span><span class="op" id="4077330">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077334">em</span>&nbsp;<span class="op" id="4077337">:=</span>&nbsp;<span class="builtinfunc" id="4077340">make</span><span class="op" id="4077344">(</span><span class="op" id="4077345">[</span><span class="op" id="4077346">]</span><span class="builtintype" id="4077347">byte</span><span class="op" id="4077351">,</span>&nbsp;<span class="ident" id="4077353">k</span><span class="op" id="4077354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077357">seed</span>&nbsp;<span class="op" id="4077362">:=</span>&nbsp;<span class="ident" id="4077365">em</span><span class="op" id="4077367">[</span><span class="num" id="4077368">1</span>&nbsp;<span class="op" id="4077370">:</span>&nbsp;<span class="num" id="4077372">1</span><span class="op" id="4077373">+</span><span class="ident" id="4077374">hash</span><span class="op" id="4077378">.</span><span class="ident" id="4077379">Size</span><span class="op" id="4077383">(</span><span class="op" id="4077384">)</span><span class="op" id="4077385">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077388">db</span>&nbsp;<span class="op" id="4077391">:=</span>&nbsp;<span class="ident" id="4077394">em</span><span class="op" id="4077396">[</span><span class="num" id="4077397">1</span><span class="op" id="4077398">+</span><span class="ident" id="4077399">hash</span><span class="op" id="4077403">.</span><span class="ident" id="4077404">Size</span><span class="op" id="4077408">(</span><span class="op" id="4077409">)</span><span class="op" id="4077410">:</span><span class="op" id="4077411">]</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4077415">copy</span><span class="op" id="4077419">(</span><span class="ident" id="4077420">db</span><span class="op" id="4077422">[</span><span class="num" id="4077423">0</span><span class="op" id="4077424">:</span><span class="ident" id="4077425">hash</span><span class="op" id="4077429">.</span><span class="ident" id="4077430">Size</span><span class="op" id="4077434">(</span><span class="op" id="4077435">)</span><span class="op" id="4077436">]</span><span class="op" id="4077437">,</span>&nbsp;<span class="ident" id="4077439">lHash</span><span class="op" id="4077444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077447">db</span><span class="op" id="4077449">[</span><span class="builtinfunc" id="4077450">len</span><span class="op" id="4077453">(</span><span class="ident" id="4077454">db</span><span class="op" id="4077456">)</span><span class="op" id="4077457">-</span><span class="builtinfunc" id="4077458">len</span><span class="op" id="4077461">(</span><span class="ident" id="4077462">msg</span><span class="op" id="4077465">)</span><span class="op" id="4077466">-</span><span class="num" id="4077467">1</span><span class="op" id="4077468">]</span>&nbsp;<span class="op" id="4077470">=</span>&nbsp;<span class="num" id="4077472">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4077475">copy</span><span class="op" id="4077479">(</span><span class="ident" id="4077480">db</span><span class="op" id="4077482">[</span><span class="builtinfunc" id="4077483">len</span><span class="op" id="4077486">(</span><span class="ident" id="4077487">db</span><span class="op" id="4077489">)</span><span class="op" id="4077490">-</span><span class="builtinfunc" id="4077491">len</span><span class="op" id="4077494">(</span><span class="ident" id="4077495">msg</span><span class="op" id="4077498">)</span><span class="op" id="4077499">:</span><span class="op" id="4077500">]</span><span class="op" id="4077501">,</span>&nbsp;<span class="ident" id="4077503">msg</span><span class="op" id="4077506">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077510">_</span><span class="op" id="4077511">,</span>&nbsp;<span class="ident" id="4077513">err</span>&nbsp;<span class="op" id="4077517">=</span>&nbsp;<span class="ident" id="4077519">io</span><span class="op" id="4077521">.</span><span class="ident" id="4077522">ReadFull</span><span class="op" id="4077530">(</span><span class="ident" id="4077531">random</span><span class="op" id="4077537">,</span>&nbsp;<span class="ident" id="4077539">seed</span><span class="op" id="4077543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077546">if</span>&nbsp;<span class="ident" id="4077549">err</span>&nbsp;<span class="op" id="4077553">!=</span>&nbsp;<span class="ident" id="4077556">nil</span>&nbsp;<span class="op" id="4077560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077564">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4077572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077576">mgf1XOR</span><span class="op" id="4077583">(</span><span class="ident" id="4077584">db</span><span class="op" id="4077586">,</span>&nbsp;<span class="ident" id="4077588">hash</span><span class="op" id="4077592">,</span>&nbsp;<span class="ident" id="4077594">seed</span><span class="op" id="4077598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077601">mgf1XOR</span><span class="op" id="4077608">(</span><span class="ident" id="4077609">seed</span><span class="op" id="4077613">,</span>&nbsp;<span class="ident" id="4077615">hash</span><span class="op" id="4077619">,</span>&nbsp;<span class="ident" id="4077621">db</span><span class="op" id="4077623">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077627">m</span>&nbsp;<span class="op" id="4077629">:=</span>&nbsp;<span class="builtinfunc" id="4077632">new</span><span class="op" id="4077635">(</span><span class="ident" id="4077636">big</span><span class="op" id="4077639">.</span><span class="ident" id="4077640">Int</span><span class="op" id="4077643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077646">m</span><span class="op" id="4077647">.</span><span class="ident" id="4077648">SetBytes</span><span class="op" id="4077656">(</span><span class="ident" id="4077657">em</span><span class="op" id="4077659">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077662">c</span>&nbsp;<span class="op" id="4077664">:=</span>&nbsp;<span class="ident" id="4077667">encrypt</span><span class="op" id="4077674">(</span><span class="builtinfunc" id="4077675">new</span><span class="op" id="4077678">(</span><span class="ident" id="4077679">big</span><span class="op" id="4077682">.</span><span class="ident" id="4077683">Int</span><span class="op" id="4077686">)</span><span class="op" id="4077687">,</span>&nbsp;<span class="ident" id="4077689">pub</span><span class="op" id="4077692">,</span>&nbsp;<span class="ident" id="4077694">m</span><span class="op" id="4077695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077698">out</span>&nbsp;<span class="op" id="4077702">=</span>&nbsp;<span class="ident" id="4077704">c</span><span class="op" id="4077705">.</span><span class="ident" id="4077706">Bytes</span><span class="op" id="4077711">(</span><span class="op" id="4077712">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077716">if</span>&nbsp;<span class="builtinfunc" id="4077719">len</span><span class="op" id="4077722">(</span><span class="ident" id="4077723">out</span><span class="op" id="4077726">)</span>&nbsp;<span class="op" id="4077728">&lt;</span>&nbsp;<span class="ident" id="4077730">k</span>&nbsp;<span class="op" id="4077732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4077736">//&nbsp;If&nbsp;the&nbsp;output&nbsp;is&nbsp;too&nbsp;small,&nbsp;we&nbsp;need&nbsp;to&nbsp;left-pad&nbsp;with&nbsp;zeros.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077801">t</span>&nbsp;<span class="op" id="4077803">:=</span>&nbsp;<span class="builtinfunc" id="4077806">make</span><span class="op" id="4077810">(</span><span class="op" id="4077811">[</span><span class="op" id="4077812">]</span><span class="builtintype" id="4077813">byte</span><span class="op" id="4077817">,</span>&nbsp;<span class="ident" id="4077819">k</span><span class="op" id="4077820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4077824">copy</span><span class="op" id="4077828">(</span><span class="ident" id="4077829">t</span><span class="op" id="4077830">[</span><span class="ident" id="4077831">k</span><span class="op" id="4077832">-</span><span class="builtinfunc" id="4077833">len</span><span class="op" id="4077836">(</span><span class="ident" id="4077837">out</span><span class="op" id="4077840">)</span><span class="op" id="4077841">:</span><span class="op" id="4077842">]</span><span class="op" id="4077843">,</span>&nbsp;<span class="ident" id="4077845">out</span><span class="op" id="4077848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077852">out</span>&nbsp;<span class="op" id="4077856">=</span>&nbsp;<span class="ident" id="4077858">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4077861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077865">return</span><br>
<span class="lineno"></span><span class="op" id="4077872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4077875">//&nbsp;ErrDecryption&nbsp;represents&nbsp;a&nbsp;failure&nbsp;to&nbsp;decrypt&nbsp;a&nbsp;message.</span><br>
<span class="lineno"></span><span class="comment" id="4077935">//&nbsp;It&nbsp;is&nbsp;deliberately&nbsp;vague&nbsp;to&nbsp;avoid&nbsp;adaptive&nbsp;attacks.</span><br>
<span class="lineno">335</span><span class="keyword" id="4077990">var</span>&nbsp;<span class="ident" id="4077994">ErrDecryption</span>&nbsp;<span class="op" id="4078008">=</span>&nbsp;<span class="ident" id="4078010">errors</span><span class="op" id="4078016">.</span><span class="ident" id="4078017">New</span><span class="op" id="4078020">(</span><span class="string" id="4078021">&#34;crypto/rsa:&nbsp;decryption&nbsp;error&#34;</span><span class="op" id="4078051">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4078054">//&nbsp;ErrVerification&nbsp;represents&nbsp;a&nbsp;failure&nbsp;to&nbsp;verify&nbsp;a&nbsp;signature.</span><br>
<span class="lineno"></span><span class="comment" id="4078117">//&nbsp;It&nbsp;is&nbsp;deliberately&nbsp;vague&nbsp;to&nbsp;avoid&nbsp;adaptive&nbsp;attacks.</span><br>
<span class="lineno"></span><span class="keyword" id="4078172">var</span>&nbsp;<span class="ident" id="4078176">ErrVerification</span>&nbsp;<span class="op" id="4078192">=</span>&nbsp;<span class="ident" id="4078194">errors</span><span class="op" id="4078200">.</span><span class="ident" id="4078201">New</span><span class="op" id="4078204">(</span><span class="string" id="4078205">&#34;crypto/rsa:&nbsp;verification&nbsp;error&#34;</span><span class="op" id="4078237">)</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span><span class="comment" id="4078240">//&nbsp;modInverse&nbsp;returns&nbsp;ia,&nbsp;the&nbsp;inverse&nbsp;of&nbsp;a&nbsp;in&nbsp;the&nbsp;multiplicative&nbsp;group&nbsp;of&nbsp;prime</span><br>
<span class="lineno"></span><span class="comment" id="4078320">//&nbsp;order&nbsp;n.&nbsp;It&nbsp;requires&nbsp;that&nbsp;a&nbsp;be&nbsp;a&nbsp;member&nbsp;of&nbsp;the&nbsp;group&nbsp;(i.e.&nbsp;less&nbsp;than&nbsp;n).</span><br>
<span class="lineno"></span><span class="keyword" id="4078396">func</span>&nbsp;<span class="ident" id="4078401">modInverse</span><span class="op" id="4078411">(</span><span class="ident" id="4078412">a</span><span class="op" id="4078413">,</span>&nbsp;<span class="ident" id="4078415">n</span>&nbsp;<span class="op" id="4078417">*</span><span class="ident" id="4078418">big</span><span class="op" id="4078421">.</span><span class="ident" id="4078422">Int</span><span class="op" id="4078425">)</span>&nbsp;<span class="op" id="4078427">(</span><span class="ident" id="4078428">ia</span>&nbsp;<span class="op" id="4078431">*</span><span class="ident" id="4078432">big</span><span class="op" id="4078435">.</span><span class="ident" id="4078436">Int</span><span class="op" id="4078439">,</span>&nbsp;<span class="ident" id="4078441">ok</span>&nbsp;<span class="builtintype" id="4078444">bool</span><span class="op" id="4078448">)</span>&nbsp;<span class="op" id="4078450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4078453">g</span>&nbsp;<span class="op" id="4078455">:=</span>&nbsp;<span class="builtinfunc" id="4078458">new</span><span class="op" id="4078461">(</span><span class="ident" id="4078462">big</span><span class="op" id="4078465">.</span><span class="ident" id="4078466">Int</span><span class="op" id="4078469">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4078472">x</span>&nbsp;<span class="op" id="4078474">:=</span>&nbsp;<span class="builtinfunc" id="4078477">new</span><span class="op" id="4078480">(</span><span class="ident" id="4078481">big</span><span class="op" id="4078484">.</span><span class="ident" id="4078485">Int</span><span class="op" id="4078488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4078491">y</span>&nbsp;<span class="op" id="4078493">:=</span>&nbsp;<span class="builtinfunc" id="4078496">new</span><span class="op" id="4078499">(</span><span class="ident" id="4078500">big</span><span class="op" id="4078503">.</span><span class="ident" id="4078504">Int</span><span class="op" id="4078507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4078510">g</span><span class="op" id="4078511">.</span><span class="ident" id="4078512">GCD</span><span class="op" id="4078515">(</span><span class="ident" id="4078516">x</span><span class="op" id="4078517">,</span>&nbsp;<span class="ident" id="4078519">y</span><span class="op" id="4078520">,</span>&nbsp;<span class="ident" id="4078522">a</span><span class="op" id="4078523">,</span>&nbsp;<span class="ident" id="4078525">n</span><span class="op" id="4078526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4078529">if</span>&nbsp;<span class="ident" id="4078532">g</span><span class="op" id="4078533">.</span><span class="ident" id="4078534">Cmp</span><span class="op" id="4078537">(</span><span class="ident" id="4078538">bigOne</span><span class="op" id="4078544">)</span>&nbsp;<span class="op" id="4078546">!=</span>&nbsp;<span class="num" id="4078549">0</span>&nbsp;<span class="op" id="4078551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4078555">//&nbsp;In&nbsp;this&nbsp;case,&nbsp;a&nbsp;and&nbsp;n&nbsp;aren&#39;t&nbsp;coprime&nbsp;and&nbsp;we&nbsp;cannot&nbsp;calculate</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4078621">//&nbsp;the&nbsp;inverse.&nbsp;This&nbsp;happens&nbsp;because&nbsp;the&nbsp;values&nbsp;of&nbsp;n&nbsp;are&nbsp;nearly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4078687">//&nbsp;prime&nbsp;(being&nbsp;the&nbsp;product&nbsp;of&nbsp;two&nbsp;primes)&nbsp;rather&nbsp;than&nbsp;truly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4078750">//&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4078762">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4078770">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4078774">if</span>&nbsp;<span class="ident" id="4078777">x</span><span class="op" id="4078778">.</span><span class="ident" id="4078779">Cmp</span><span class="op" id="4078782">(</span><span class="ident" id="4078783">bigOne</span><span class="op" id="4078789">)</span>&nbsp;<span class="op" id="4078791">&lt;</span>&nbsp;<span class="num" id="4078793">0</span>&nbsp;<span class="op" id="4078795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4078799">//&nbsp;0&nbsp;is&nbsp;not&nbsp;the&nbsp;multiplicative&nbsp;inverse&nbsp;of&nbsp;any&nbsp;element&nbsp;so,&nbsp;if&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4078864">//&nbsp;&lt;&nbsp;1,&nbsp;then&nbsp;x&nbsp;is&nbsp;negative.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4078894">x</span><span class="op" id="4078895">.</span><span class="ident" id="4078896">Add</span><span class="op" id="4078899">(</span><span class="ident" id="4078900">x</span><span class="op" id="4078901">,</span>&nbsp;<span class="ident" id="4078903">n</span><span class="op" id="4078904">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4078907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4078911">return</span>&nbsp;<span class="ident" id="4078918">x</span><span class="op" id="4078919">,</span>&nbsp;<span class="builtintype" id="4078921">true</span><br>
<span class="lineno"></span><span class="op" id="4078926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="4078929">//&nbsp;Precompute&nbsp;performs&nbsp;some&nbsp;calculations&nbsp;that&nbsp;speed&nbsp;up&nbsp;private&nbsp;key&nbsp;operations</span><br>
<span class="lineno"></span><span class="comment" id="4079007">//&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno"></span><span class="keyword" id="4079025">func</span>&nbsp;<span class="op" id="4079030">(</span><span class="ident" id="4079031">priv</span>&nbsp;<span class="op" id="4079036">*</span><span class="ident" id="4079037">PrivateKey</span><span class="op" id="4079047">)</span>&nbsp;<span class="ident" id="4079049">Precompute</span><span class="op" id="4079059">(</span><span class="op" id="4079060">)</span>&nbsp;<span class="op" id="4079062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4079065">if</span>&nbsp;<span class="ident" id="4079068">priv</span><span class="op" id="4079072">.</span><span class="ident" id="4079073">Precomputed</span><span class="op" id="4079084">.</span><span class="ident" id="4079085">Dp</span>&nbsp;<span class="op" id="4079088">!=</span>&nbsp;<span class="ident" id="4079091">nil</span>&nbsp;<span class="op" id="4079095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4079099">return</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4079107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079111">priv</span><span class="op" id="4079115">.</span><span class="ident" id="4079116">Precomputed</span><span class="op" id="4079127">.</span><span class="ident" id="4079128">Dp</span>&nbsp;<span class="op" id="4079131">=</span>&nbsp;<span class="builtinfunc" id="4079133">new</span><span class="op" id="4079136">(</span><span class="ident" id="4079137">big</span><span class="op" id="4079140">.</span><span class="ident" id="4079141">Int</span><span class="op" id="4079144">)</span><span class="op" id="4079145">.</span><span class="ident" id="4079146">Sub</span><span class="op" id="4079149">(</span><span class="ident" id="4079150">priv</span><span class="op" id="4079154">.</span><span class="ident" id="4079155">Primes</span><span class="op" id="4079161">[</span><span class="num" id="4079162">0</span><span class="op" id="4079163">]</span><span class="op" id="4079164">,</span>&nbsp;<span class="ident" id="4079166">bigOne</span><span class="op" id="4079172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079175">priv</span><span class="op" id="4079179">.</span><span class="ident" id="4079180">Precomputed</span><span class="op" id="4079191">.</span><span class="ident" id="4079192">Dp</span><span class="op" id="4079194">.</span><span class="ident" id="4079195">Mod</span><span class="op" id="4079198">(</span><span class="ident" id="4079199">priv</span><span class="op" id="4079203">.</span><span class="ident" id="4079204">D</span><span class="op" id="4079205">,</span>&nbsp;<span class="ident" id="4079207">priv</span><span class="op" id="4079211">.</span><span class="ident" id="4079212">Precomputed</span><span class="op" id="4079223">.</span><span class="ident" id="4079224">Dp</span><span class="op" id="4079226">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079230">priv</span><span class="op" id="4079234">.</span><span class="ident" id="4079235">Precomputed</span><span class="op" id="4079246">.</span><span class="ident" id="4079247">Dq</span>&nbsp;<span class="op" id="4079250">=</span>&nbsp;<span class="builtinfunc" id="4079252">new</span><span class="op" id="4079255">(</span><span class="ident" id="4079256">big</span><span class="op" id="4079259">.</span><span class="ident" id="4079260">Int</span><span class="op" id="4079263">)</span><span class="op" id="4079264">.</span><span class="ident" id="4079265">Sub</span><span class="op" id="4079268">(</span><span class="ident" id="4079269">priv</span><span class="op" id="4079273">.</span><span class="ident" id="4079274">Primes</span><span class="op" id="4079280">[</span><span class="num" id="4079281">1</span><span class="op" id="4079282">]</span><span class="op" id="4079283">,</span>&nbsp;<span class="ident" id="4079285">bigOne</span><span class="op" id="4079291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079294">priv</span><span class="op" id="4079298">.</span><span class="ident" id="4079299">Precomputed</span><span class="op" id="4079310">.</span><span class="ident" id="4079311">Dq</span><span class="op" id="4079313">.</span><span class="ident" id="4079314">Mod</span><span class="op" id="4079317">(</span><span class="ident" id="4079318">priv</span><span class="op" id="4079322">.</span><span class="ident" id="4079323">D</span><span class="op" id="4079324">,</span>&nbsp;<span class="ident" id="4079326">priv</span><span class="op" id="4079330">.</span><span class="ident" id="4079331">Precomputed</span><span class="op" id="4079342">.</span><span class="ident" id="4079343">Dq</span><span class="op" id="4079345">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079349">priv</span><span class="op" id="4079353">.</span><span class="ident" id="4079354">Precomputed</span><span class="op" id="4079365">.</span><span class="ident" id="4079366">Qinv</span>&nbsp;<span class="op" id="4079371">=</span>&nbsp;<span class="builtinfunc" id="4079373">new</span><span class="op" id="4079376">(</span><span class="ident" id="4079377">big</span><span class="op" id="4079380">.</span><span class="ident" id="4079381">Int</span><span class="op" id="4079384">)</span><span class="op" id="4079385">.</span><span class="ident" id="4079386">ModInverse</span><span class="op" id="4079396">(</span><span class="ident" id="4079397">priv</span><span class="op" id="4079401">.</span><span class="ident" id="4079402">Primes</span><span class="op" id="4079408">[</span><span class="num" id="4079409">1</span><span class="op" id="4079410">]</span><span class="op" id="4079411">,</span>&nbsp;<span class="ident" id="4079413">priv</span><span class="op" id="4079417">.</span><span class="ident" id="4079418">Primes</span><span class="op" id="4079424">[</span><span class="num" id="4079425">0</span><span class="op" id="4079426">]</span><span class="op" id="4079427">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079431">r</span>&nbsp;<span class="op" id="4079433">:=</span>&nbsp;<span class="builtinfunc" id="4079436">new</span><span class="op" id="4079439">(</span><span class="ident" id="4079440">big</span><span class="op" id="4079443">.</span><span class="ident" id="4079444">Int</span><span class="op" id="4079447">)</span><span class="op" id="4079448">.</span><span class="ident" id="4079449">Mul</span><span class="op" id="4079452">(</span><span class="ident" id="4079453">priv</span><span class="op" id="4079457">.</span><span class="ident" id="4079458">Primes</span><span class="op" id="4079464">[</span><span class="num" id="4079465">0</span><span class="op" id="4079466">]</span><span class="op" id="4079467">,</span>&nbsp;<span class="ident" id="4079469">priv</span><span class="op" id="4079473">.</span><span class="ident" id="4079474">Primes</span><span class="op" id="4079480">[</span><span class="num" id="4079481">1</span><span class="op" id="4079482">]</span><span class="op" id="4079483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079486">priv</span><span class="op" id="4079490">.</span><span class="ident" id="4079491">Precomputed</span><span class="op" id="4079502">.</span><span class="ident" id="4079503">CRTValues</span>&nbsp;<span class="op" id="4079513">=</span>&nbsp;<span class="builtinfunc" id="4079515">make</span><span class="op" id="4079519">(</span><span class="op" id="4079520">[</span><span class="op" id="4079521">]</span><span class="ident" id="4079522">CRTValue</span><span class="op" id="4079530">,</span>&nbsp;<span class="builtinfunc" id="4079532">len</span><span class="op" id="4079535">(</span><span class="ident" id="4079536">priv</span><span class="op" id="4079540">.</span><span class="ident" id="4079541">Primes</span><span class="op" id="4079547">)</span><span class="op" id="4079548">-</span><span class="num" id="4079549">2</span><span class="op" id="4079550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4079553">for</span>&nbsp;<span class="ident" id="4079557">i</span>&nbsp;<span class="op" id="4079559">:=</span>&nbsp;<span class="num" id="4079562">2</span><span class="op" id="4079563">;</span>&nbsp;<span class="ident" id="4079565">i</span>&nbsp;<span class="op" id="4079567">&lt;</span>&nbsp;<span class="builtinfunc" id="4079569">len</span><span class="op" id="4079572">(</span><span class="ident" id="4079573">priv</span><span class="op" id="4079577">.</span><span class="ident" id="4079578">Primes</span><span class="op" id="4079584">)</span><span class="op" id="4079585">;</span>&nbsp;<span class="ident" id="4079587">i</span><span class="op" id="4079588">++</span>&nbsp;<span class="op" id="4079591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079595">prime</span>&nbsp;<span class="op" id="4079601">:=</span>&nbsp;<span class="ident" id="4079604">priv</span><span class="op" id="4079608">.</span><span class="ident" id="4079609">Primes</span><span class="op" id="4079615">[</span><span class="ident" id="4079616">i</span><span class="op" id="4079617">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079621">values</span>&nbsp;<span class="op" id="4079628">:=</span>&nbsp;<span class="op" id="4079631">&amp;</span><span class="ident" id="4079632">priv</span><span class="op" id="4079636">.</span><span class="ident" id="4079637">Precomputed</span><span class="op" id="4079648">.</span><span class="ident" id="4079649">CRTValues</span><span class="op" id="4079658">[</span><span class="ident" id="4079659">i</span><span class="op" id="4079660">-</span><span class="num" id="4079661">2</span><span class="op" id="4079662">]</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079667">values</span><span class="op" id="4079673">.</span><span class="ident" id="4079674">Exp</span>&nbsp;<span class="op" id="4079678">=</span>&nbsp;<span class="builtinfunc" id="4079680">new</span><span class="op" id="4079683">(</span><span class="ident" id="4079684">big</span><span class="op" id="4079687">.</span><span class="ident" id="4079688">Int</span><span class="op" id="4079691">)</span><span class="op" id="4079692">.</span><span class="ident" id="4079693">Sub</span><span class="op" id="4079696">(</span><span class="ident" id="4079697">prime</span><span class="op" id="4079702">,</span>&nbsp;<span class="ident" id="4079704">bigOne</span><span class="op" id="4079710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079714">values</span><span class="op" id="4079720">.</span><span class="ident" id="4079721">Exp</span><span class="op" id="4079724">.</span><span class="ident" id="4079725">Mod</span><span class="op" id="4079728">(</span><span class="ident" id="4079729">priv</span><span class="op" id="4079733">.</span><span class="ident" id="4079734">D</span><span class="op" id="4079735">,</span>&nbsp;<span class="ident" id="4079737">values</span><span class="op" id="4079743">.</span><span class="ident" id="4079744">Exp</span><span class="op" id="4079747">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079752">values</span><span class="op" id="4079758">.</span><span class="ident" id="4079759">R</span>&nbsp;<span class="op" id="4079761">=</span>&nbsp;<span class="builtinfunc" id="4079763">new</span><span class="op" id="4079766">(</span><span class="ident" id="4079767">big</span><span class="op" id="4079770">.</span><span class="ident" id="4079771">Int</span><span class="op" id="4079774">)</span><span class="op" id="4079775">.</span><span class="ident" id="4079776">Set</span><span class="op" id="4079779">(</span><span class="ident" id="4079780">r</span><span class="op" id="4079781">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079785">values</span><span class="op" id="4079791">.</span><span class="ident" id="4079792">Coeff</span>&nbsp;<span class="op" id="4079798">=</span>&nbsp;<span class="builtinfunc" id="4079800">new</span><span class="op" id="4079803">(</span><span class="ident" id="4079804">big</span><span class="op" id="4079807">.</span><span class="ident" id="4079808">Int</span><span class="op" id="4079811">)</span><span class="op" id="4079812">.</span><span class="ident" id="4079813">ModInverse</span><span class="op" id="4079823">(</span><span class="ident" id="4079824">r</span><span class="op" id="4079825">,</span>&nbsp;<span class="ident" id="4079827">prime</span><span class="op" id="4079832">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079837">r</span><span class="op" id="4079838">.</span><span class="ident" id="4079839">Mul</span><span class="op" id="4079842">(</span><span class="ident" id="4079843">r</span><span class="op" id="4079844">,</span>&nbsp;<span class="ident" id="4079846">prime</span><span class="op" id="4079851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4079854">}</span><br>
<span class="lineno"></span><span class="op" id="4079856">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="comment" id="4079859">//&nbsp;decrypt&nbsp;performs&nbsp;an&nbsp;RSA&nbsp;decryption,&nbsp;resulting&nbsp;in&nbsp;a&nbsp;plaintext&nbsp;integer.&nbsp;If&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4079937">//&nbsp;random&nbsp;source&nbsp;is&nbsp;given,&nbsp;RSA&nbsp;blinding&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="4079986">func</span>&nbsp;<span class="ident" id="4079991">decrypt</span><span class="op" id="4079998">(</span><span class="ident" id="4079999">random</span>&nbsp;<span class="ident" id="4080006">io</span><span class="op" id="4080008">.</span><span class="ident" id="4080009">Reader</span><span class="op" id="4080015">,</span>&nbsp;<span class="ident" id="4080017">priv</span>&nbsp;<span class="op" id="4080022">*</span><span class="ident" id="4080023">PrivateKey</span><span class="op" id="4080033">,</span>&nbsp;<span class="ident" id="4080035">c</span>&nbsp;<span class="op" id="4080037">*</span><span class="ident" id="4080038">big</span><span class="op" id="4080041">.</span><span class="ident" id="4080042">Int</span><span class="op" id="4080045">)</span>&nbsp;<span class="op" id="4080047">(</span><span class="ident" id="4080048">m</span>&nbsp;<span class="op" id="4080050">*</span><span class="ident" id="4080051">big</span><span class="op" id="4080054">.</span><span class="ident" id="4080055">Int</span><span class="op" id="4080058">,</span>&nbsp;<span class="ident" id="4080060">err</span>&nbsp;<span class="builtintype" id="4080064">error</span><span class="op" id="4080069">)</span>&nbsp;<span class="op" id="4080071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4080074">//&nbsp;TODO(agl):&nbsp;can&nbsp;we&nbsp;get&nbsp;away&nbsp;with&nbsp;reusing&nbsp;blinds?</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4080126">if</span>&nbsp;<span class="ident" id="4080129">c</span><span class="op" id="4080130">.</span><span class="ident" id="4080131">Cmp</span><span class="op" id="4080134">(</span><span class="ident" id="4080135">priv</span><span class="op" id="4080139">.</span><span class="ident" id="4080140">N</span><span class="op" id="4080141">)</span>&nbsp;<span class="op" id="4080143">&gt;</span>&nbsp;<span class="num" id="4080145">0</span>&nbsp;<span class="op" id="4080147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4080151">err</span>&nbsp;<span class="op" id="4080155">=</span>&nbsp;<span class="ident" id="4080157">ErrDecryption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4080173">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4080181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4080185">var</span>&nbsp;<span class="ident" id="4080189">ir</span>&nbsp;<span class="op" id="4080192">*</span><span class="ident" id="4080193">big</span><span class="op" id="4080196">.</span><span class="ident" id="4080197">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4080202">if</span>&nbsp;<span class="ident" id="4080205">random</span>&nbsp;<span class="op" id="4080212">!=</span>&nbsp;<span class="ident" id="4080215">nil</span>&nbsp;<span class="op" id="4080219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4080223">//&nbsp;Blinding&nbsp;enabled.&nbsp;Blinding&nbsp;involves&nbsp;multiplying&nbsp;c&nbsp;by&nbsp;r^e.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4080286">//&nbsp;Then&nbsp;the&nbsp;decryption&nbsp;operation&nbsp;performs&nbsp;(m^e&nbsp;*&nbsp;r^e)^d&nbsp;mod&nbsp;n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4080350">//&nbsp;which&nbsp;equals&nbsp;mr&nbsp;mod&nbsp;n.&nbsp;The&nbsp;factor&nbsp;of&nbsp;r&nbsp;can&nbsp;then&nbsp;be&nbsp;removed</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4080414">//&nbsp;by&nbsp;multiplying&nbsp;by&nbsp;the&nbsp;multiplicative&nbsp;inverse&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4080471">var</span>&nbsp;<span class="ident" id="4080475">r</span>&nbsp;<span class="op" id="4080477">*</span><span class="ident" id="4080478">big</span><span class="op" id="4080481">.</span><span class="ident" id="4080482">Int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4080489">for</span>&nbsp;<span class="op" id="4080493">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4080498">r</span><span class="op" id="4080499">,</span>&nbsp;<span class="ident" id="4080501">err</span>&nbsp;<span class="op" id="4080505">=</span>&nbsp;<span class="ident" id="4080507">rand</span><span class="op" id="4080511">.</span><span class="ident" id="4080512">Int</span><span class="op" id="4080515">(</span><span class="ident" id="4080516">random</span><span class="op" id="4080522">,</span>&nbsp;<span class="ident" id="4080524">priv</span><span class="op" id="4080528">.</span><span class="ident" id="4080529">N</span><span class="op" id="4080530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4080535">if</span>&nbsp;<span class="ident" id="4080538">err</span>&nbsp;<span class="op" id="4080542">!=</span>&nbsp;<span class="ident" id="4080545">nil</span>&nbsp;<span class="op" id="4080549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4080555">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4080565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4080570">if</span>&nbsp;<span class="ident" id="4080573">r</span><span class="op" id="4080574">.</span><span class="ident" id="4080575">Cmp</span><span class="op" id="4080578">(</span><span class="ident" id="4080579">bigZero</span><span class="op" id="4080586">)</span>&nbsp;<span class="op" id="4080588">==</span>&nbsp;<span class="num" id="4080591">0</span>&nbsp;<span class="op" id="4080593">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4080599">r</span>&nbsp;<span class="op" id="4080601">=</span>&nbsp;<span class="ident" id="4080603">bigOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4080613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4080618">var</span>&nbsp;<span class="ident" id="4080622">ok</span>&nbsp;<span class="builtintype" id="4080625">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4080633">ir</span><span class="op" id="4080635">,</span>&nbsp;<span class="ident" id="4080637">ok</span>&nbsp;<span class="op" id="4080640">=</span>&nbsp;<span class="ident" id="4080642">modInverse</span><span class="op" id="4080652">(</span><span class="ident" id="4080653">r</span><span class="op" id="4080654">,</span>&nbsp;<span class="ident" id="4080656">priv</span><span class="op" id="4080660">.</span><span class="ident" id="4080661">N</span><span class="op" id="4080662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4080667">if</span>&nbsp;<span class="ident" id="4080670">ok</span>&nbsp;<span class="op" id="4080673">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4080679">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4080688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4080692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4080696">bigE</span>&nbsp;<span class="op" id="4080701">:=</span>&nbsp;<span class="ident" id="4080704">big</span><span class="op" id="4080707">.</span><span class="ident" id="4080708">NewInt</span><span class="op" id="4080714">(</span><span class="ident" id="4080715">int64</span><span class="op" id="4080720">(</span><span class="ident" id="4080721">priv</span><span class="op" id="4080725">.</span><span class="ident" id="4080726">E</span><span class="op" id="4080727">)</span><span class="op" id="4080728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4080732">rpowe</span>&nbsp;<span class="op" id="4080738">:=</span>&nbsp;<span class="builtinfunc" id="4080741">new</span><span class="op" id="4080744">(</span><span class="ident" id="4080745">big</span><span class="op" id="4080748">.</span><span class="ident" id="4080749">Int</span><span class="op" id="4080752">)</span><span class="op" id="4080753">.</span><span class="ident" id="4080754">Exp</span><span class="op" id="4080757">(</span><span class="ident" id="4080758">r</span><span class="op" id="4080759">,</span>&nbsp;<span class="ident" id="4080761">bigE</span><span class="op" id="4080765">,</span>&nbsp;<span class="ident" id="4080767">priv</span><span class="op" id="4080771">.</span><span class="ident" id="4080772">N</span><span class="op" id="4080773">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4080777">cCopy</span>&nbsp;<span class="op" id="4080783">:=</span>&nbsp;<span class="builtinfunc" id="4080786">new</span><span class="op" id="4080789">(</span><span class="ident" id="4080790">big</span><span class="op" id="4080793">.</span><span class="ident" id="4080794">Int</span><span class="op" id="4080797">)</span><span class="op" id="4080798">.</span><span class="ident" id="4080799">Set</span><span class="op" id="4080802">(</span><span class="ident" id="4080803">c</span><span class="op" id="4080804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4080808">cCopy</span><span class="op" id="4080813">.</span><span class="ident" id="4080814">Mul</span><span class="op" id="4080817">(</span><span class="ident" id="4080818">cCopy</span><span class="op" id="4080823">,</span>&nbsp;<span class="ident" id="4080825">rpowe</span><span class="op" id="4080830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4080834">cCopy</span><span class="op" id="4080839">.</span><span class="ident" id="4080840">Mod</span><span class="op" id="4080843">(</span><span class="ident" id="4080844">cCopy</span><span class="op" id="4080849">,</span>&nbsp;<span class="ident" id="4080851">priv</span><span class="op" id="4080855">.</span><span class="ident" id="4080856">N</span><span class="op" id="4080857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4080861">c</span>&nbsp;<span class="op" id="4080863">=</span>&nbsp;<span class="ident" id="4080865">cCopy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4080872">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4080876">if</span>&nbsp;<span class="ident" id="4080879">priv</span><span class="op" id="4080883">.</span><span class="ident" id="4080884">Precomputed</span><span class="op" id="4080895">.</span><span class="ident" id="4080896">Dp</span>&nbsp;<span class="op" id="4080899">==</span>&nbsp;<span class="ident" id="4080902">nil</span>&nbsp;<span class="op" id="4080906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4080910">m</span>&nbsp;<span class="op" id="4080912">=</span>&nbsp;<span class="builtinfunc" id="4080914">new</span><span class="op" id="4080917">(</span><span class="ident" id="4080918">big</span><span class="op" id="4080921">.</span><span class="ident" id="4080922">Int</span><span class="op" id="4080925">)</span><span class="op" id="4080926">.</span><span class="ident" id="4080927">Exp</span><span class="op" id="4080930">(</span><span class="ident" id="4080931">c</span><span class="op" id="4080932">,</span>&nbsp;<span class="ident" id="4080934">priv</span><span class="op" id="4080938">.</span><span class="ident" id="4080939">D</span><span class="op" id="4080940">,</span>&nbsp;<span class="ident" id="4080942">priv</span><span class="op" id="4080946">.</span><span class="ident" id="4080947">N</span><span class="op" id="4080948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4080951">}</span>&nbsp;<span class="keyword" id="4080953">else</span>&nbsp;<span class="op" id="4080958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4080962">//&nbsp;We&nbsp;have&nbsp;the&nbsp;precalculated&nbsp;values&nbsp;needed&nbsp;for&nbsp;the&nbsp;CRT.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4081020">m</span>&nbsp;<span class="op" id="4081022">=</span>&nbsp;<span class="builtinfunc" id="4081024">new</span><span class="op" id="4081027">(</span><span class="ident" id="4081028">big</span><span class="op" id="4081031">.</span><span class="ident" id="4081032">Int</span><span class="op" id="4081035">)</span><span class="op" id="4081036">.</span><span class="ident" id="4081037">Exp</span><span class="op" id="4081040">(</span><span class="ident" id="4081041">c</span><span class="op" id="4081042">,</span>&nbsp;<span class="ident" id="4081044">priv</span><span class="op" id="4081048">.</span><span class="ident" id="4081049">Precomputed</span><span class="op" id="4081060">.</span><span class="ident" id="4081061">Dp</span><span class="op" id="4081063">,</span>&nbsp;<span class="ident" id="4081065">priv</span><span class="op" id="4081069">.</span><span class="ident" id="4081070">Primes</span><span class="op" id="4081076">[</span><span class="num" id="4081077">0</span><span class="op" id="4081078">]</span><span class="op" id="4081079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4081083">m2</span>&nbsp;<span class="op" id="4081086">:=</span>&nbsp;<span class="builtinfunc" id="4081089">new</span><span class="op" id="4081092">(</span><span class="ident" id="4081093">big</span><span class="op" id="4081096">.</span><span class="ident" id="4081097">Int</span><span class="op" id="4081100">)</span><span class="op" id="4081101">.</span><span class="ident" id="4081102">Exp</span><span class="op" id="4081105">(</span><span class="ident" id="4081106">c</span><span class="op" id="4081107">,</span>&nbsp;<span class="ident" id="4081109">priv</span><span class="op" id="4081113">.</span><span class="ident" id="4081114">Precomputed</span><span class="op" id="4081125">.</span><span class="ident" id="4081126">Dq</span><span class="op" id="4081128">,</span>&nbsp;<span class="ident" id="4081130">priv</span><span class="op" id="4081134">.</span><span class="ident" id="4081135">Primes</span><span class="op" id="4081141">[</span><span class="num" id="4081142">1</span><span class="op" id="4081143">]</span><span class="op" id="4081144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4081148">m</span><span class="op" id="4081149">.</span><span class="ident" id="4081150">Sub</span><span class="op" id="4081153">(</span><span class="ident" id="4081154">m</span><span class="op" id="4081155">,</span>&nbsp;<span class="ident" id="4081157">m2</span><span class="op" id="4081159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4081163">if</span>&nbsp;<span class="ident" id="4081166">m</span><span class="op" id="4081167">.</span><span class="ident" id="4081168">Sign</span><span class="op" id="4081172">(</span><span class="op" id="4081173">)</span>&nbsp;<span class="op" id="4081175">&lt;</span>&nbsp;<span class="num" id="4081177">0</span>&nbsp;<span class="op" id="4081179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4081184">m</span><span class="op" id="4081185">.</span><span class="ident" id="4081186">Add</span><span class="op" id="4081189">(</span><span class="ident" id="4081190">m</span><span class="op" id="4081191">,</span>&nbsp;<span class="ident" id="4081193">priv</span><span class="op" id="4081197">.</span><span class="ident" id="4081198">Primes</span><span class="op" id="4081204">[</span><span class="num" id="4081205">0</span><span class="op" id="4081206">]</span><span class="op" id="4081207">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4081211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4081215">m</span><span class="op" id="4081216">.</span><span class="ident" id="4081217">Mul</span><span class="op" id="4081220">(</span><span class="ident" id="4081221">m</span><span class="op" id="4081222">,</span>&nbsp;<span class="ident" id="4081224">priv</span><span class="op" id="4081228">.</span><span class="ident" id="4081229">Precomputed</span><span class="op" id="4081240">.</span><span class="ident" id="4081241">Qinv</span><span class="op" id="4081245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4081249">m</span><span class="op" id="4081250">.</span><span class="ident" id="4081251">Mod</span><span class="op" id="4081254">(</span><span class="ident" id="4081255">m</span><span class="op" id="4081256">,</span>&nbsp;<span class="ident" id="4081258">priv</span><span class="op" id="4081262">.</span><span class="ident" id="4081263">Primes</span><span class="op" id="4081269">[</span><span class="num" id="4081270">0</span><span class="op" id="4081271">]</span><span class="op" id="4081272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4081276">m</span><span class="op" id="4081277">.</span><span class="ident" id="4081278">Mul</span><span class="op" id="4081281">(</span><span class="ident" id="4081282">m</span><span class="op" id="4081283">,</span>&nbsp;<span class="ident" id="4081285">priv</span><span class="op" id="4081289">.</span><span class="ident" id="4081290">Primes</span><span class="op" id="4081296">[</span><span class="num" id="4081297">1</span><span class="op" id="4081298">]</span><span class="op" id="4081299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4081303">m</span><span class="op" id="4081304">.</span><span class="ident" id="4081305">Add</span><span class="op" id="4081308">(</span><span class="ident" id="4081309">m</span><span class="op" id="4081310">,</span>&nbsp;<span class="ident" id="4081312">m2</span><span class="op" id="4081314">)</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4081319">for</span>&nbsp;<span class="ident" id="4081323">i</span><span class="op" id="4081324">,</span>&nbsp;<span class="ident" id="4081326">values</span>&nbsp;<span class="op" id="4081333">:=</span>&nbsp;<span class="keyword" id="4081336">range</span>&nbsp;<span class="ident" id="4081342">priv</span><span class="op" id="4081346">.</span><span class="ident" id="4081347">Precomputed</span><span class="op" id="4081358">.</span><span class="ident" id="4081359">CRTValues</span>&nbsp;<span class="op" id="4081369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4081374">prime</span>&nbsp;<span class="op" id="4081380">:=</span>&nbsp;<span class="ident" id="4081383">priv</span><span class="op" id="4081387">.</span><span class="ident" id="4081388">Primes</span><span class="op" id="4081394">[</span><span class="num" id="4081395">2</span><span class="op" id="4081396">+</span><span class="ident" id="4081397">i</span><span class="op" id="4081398">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4081403">m2</span><span class="op" id="4081405">.</span><span class="ident" id="4081406">Exp</span><span class="op" id="4081409">(</span><span class="ident" id="4081410">c</span><span class="op" id="4081411">,</span>&nbsp;<span class="ident" id="4081413">values</span><span class="op" id="4081419">.</span><span class="ident" id="4081420">Exp</span><span class="op" id="4081423">,</span>&nbsp;<span class="ident" id="4081425">prime</span><span class="op" id="4081430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4081435">m2</span><span class="op" id="4081437">.</span><span class="ident" id="4081438">Sub</span><span class="op" id="4081441">(</span><span class="ident" id="4081442">m2</span><span class="op" id="4081444">,</span>&nbsp;<span class="ident" id="4081446">m</span><span class="op" id="4081447">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4081452">m2</span><span class="op" id="4081454">.</span><span class="ident" id="4081455">Mul</span><span class="op" id="4081458">(</span><span class="ident" id="4081459">m2</span><span class="op" id="4081461">,</span>&nbsp;<span class="ident" id="4081463">values</span><span class="op" id="4081469">.</span><span class="ident" id="4081470">Coeff</span><span class="op" id="4081475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4081480">m2</span><span class="op" id="4081482">.</span><span class="ident" id="4081483">Mod</span><span class="op" id="4081486">(</span><span class="ident" id="4081487">m2</span><span class="op" id="4081489">,</span>&nbsp;<span class="ident" id="4081491">prime</span><span class="op" id="4081496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4081501">if</span>&nbsp;<span class="ident" id="4081504">m2</span><span class="op" id="4081506">.</span><span class="ident" id="4081507">Sign</span><span class="op" id="4081511">(</span><span class="op" id="4081512">)</span>&nbsp;<span class="op" id="4081514">&lt;</span>&nbsp;<span class="num" id="4081516">0</span>&nbsp;<span class="op" id="4081518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4081524">m2</span><span class="op" id="4081526">.</span><span class="ident" id="4081527">Add</span><span class="op" id="4081530">(</span><span class="ident" id="4081531">m2</span><span class="op" id="4081533">,</span>&nbsp;<span class="ident" id="4081535">prime</span><span class="op" id="4081540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4081545">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4081550">m2</span><span class="op" id="4081552">.</span><span class="ident" id="4081553">Mul</span><span class="op" id="4081556">(</span><span class="ident" id="4081557">m2</span><span class="op" id="4081559">,</span>&nbsp;<span class="ident" id="4081561">values</span><span class="op" id="4081567">.</span><span class="ident" id="4081568">R</span><span class="op" id="4081569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4081574">m</span><span class="op" id="4081575">.</span><span class="ident" id="4081576">Add</span><span class="op" id="4081579">(</span><span class="ident" id="4081580">m</span><span class="op" id="4081581">,</span>&nbsp;<span class="ident" id="4081583">m2</span><span class="op" id="4081585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4081589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4081592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4081596">if</span>&nbsp;<span class="ident" id="4081599">ir</span>&nbsp;<span class="op" id="4081602">!=</span>&nbsp;<span class="ident" id="4081605">nil</span>&nbsp;<span class="op" id="4081609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4081613">//&nbsp;Unblind.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4081627">m</span><span class="op" id="4081628">.</span><span class="ident" id="4081629">Mul</span><span class="op" id="4081632">(</span><span class="ident" id="4081633">m</span><span class="op" id="4081634">,</span>&nbsp;<span class="ident" id="4081636">ir</span><span class="op" id="4081638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4081642">m</span><span class="op" id="4081643">.</span><span class="ident" id="4081644">Mod</span><span class="op" id="4081647">(</span><span class="ident" id="4081648">m</span><span class="op" id="4081649">,</span>&nbsp;<span class="ident" id="4081651">priv</span><span class="op" id="4081655">.</span><span class="ident" id="4081656">N</span><span class="op" id="4081657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4081660">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4081664">return</span><br>
<span class="lineno"></span><span class="op" id="4081671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4081674">//&nbsp;DecryptOAEP&nbsp;decrypts&nbsp;ciphertext&nbsp;using&nbsp;RSA-OAEP.</span><br>
<span class="lineno">475</span><span class="comment" id="4081725">//&nbsp;If&nbsp;random&nbsp;!=&nbsp;nil,&nbsp;DecryptOAEP&nbsp;uses&nbsp;RSA&nbsp;blinding&nbsp;to&nbsp;avoid&nbsp;timing&nbsp;side-channel&nbsp;attacks.</span><br>
<span class="lineno"></span><span class="keyword" id="4081814">func</span>&nbsp;<span class="ident" id="4081819">DecryptOAEP</span><span class="op" id="4081830">(</span><span class="ident" id="4081831">hash</span>&nbsp;<span class="ident" id="4081836">hash</span><span class="op" id="4081840">.</span><span class="ident" id="4081841">Hash</span><span class="op" id="4081845">,</span>&nbsp;<span class="ident" id="4081847">random</span>&nbsp;<span class="ident" id="4081854">io</span><span class="op" id="4081856">.</span><span class="ident" id="4081857">Reader</span><span class="op" id="4081863">,</span>&nbsp;<span class="ident" id="4081865">priv</span>&nbsp;<span class="op" id="4081870">*</span><span class="ident" id="4081871">PrivateKey</span><span class="op" id="4081881">,</span>&nbsp;<span class="ident" id="4081883">ciphertext</span>&nbsp;<span class="op" id="4081894">[</span><span class="op" id="4081895">]</span><span class="builtintype" id="4081896">byte</span><span class="op" id="4081900">,</span>&nbsp;<span class="ident" id="4081902">label</span>&nbsp;<span class="op" id="4081908">[</span><span class="op" id="4081909">]</span><span class="builtintype" id="4081910">byte</span><span class="op" id="4081914">)</span>&nbsp;<span class="op" id="4081916">(</span><span class="ident" id="4081917">msg</span>&nbsp;<span class="op" id="4081921">[</span><span class="op" id="4081922">]</span><span class="builtintype" id="4081923">byte</span><span class="op" id="4081927">,</span>&nbsp;<span class="ident" id="4081929">err</span>&nbsp;<span class="builtintype" id="4081933">error</span><span class="op" id="4081938">)</span>&nbsp;<span class="op" id="4081940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4081943">if</span>&nbsp;<span class="ident" id="4081946">err</span>&nbsp;<span class="op" id="4081950">:=</span>&nbsp;<span class="ident" id="4081953">checkPub</span><span class="op" id="4081961">(</span><span class="op" id="4081962">&amp;</span><span class="ident" id="4081963">priv</span><span class="op" id="4081967">.</span><span class="ident" id="4081968">PublicKey</span><span class="op" id="4081977">)</span><span class="op" id="4081978">;</span>&nbsp;<span class="ident" id="4081980">err</span>&nbsp;<span class="op" id="4081984">!=</span>&nbsp;<span class="ident" id="4081987">nil</span>&nbsp;<span class="op" id="4081991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4081995">return</span>&nbsp;<span class="ident" id="4082002">nil</span><span class="op" id="4082005">,</span>&nbsp;<span class="ident" id="4082007">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4082012">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4082015">k</span>&nbsp;<span class="op" id="4082017">:=</span>&nbsp;<span class="op" id="4082020">(</span><span class="ident" id="4082021">priv</span><span class="op" id="4082025">.</span><span class="ident" id="4082026">N</span><span class="op" id="4082027">.</span><span class="ident" id="4082028">BitLen</span><span class="op" id="4082034">(</span><span class="op" id="4082035">)</span>&nbsp;<span class="op" id="4082037">+</span>&nbsp;<span class="num" id="4082039">7</span><span class="op" id="4082040">)</span>&nbsp;<span class="op" id="4082042">/</span>&nbsp;<span class="num" id="4082044">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4082047">if</span>&nbsp;<span class="builtinfunc" id="4082050">len</span><span class="op" id="4082053">(</span><span class="ident" id="4082054">ciphertext</span><span class="op" id="4082064">)</span>&nbsp;<span class="op" id="4082066">&gt;</span>&nbsp;<span class="ident" id="4082068">k</span>&nbsp;<span class="op" id="4082070">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4082075">k</span>&nbsp;<span class="op" id="4082077">&lt;</span>&nbsp;<span class="ident" id="4082079">hash</span><span class="op" id="4082083">.</span><span class="ident" id="4082084">Size</span><span class="op" id="4082088">(</span><span class="op" id="4082089">)</span><span class="op" id="4082090">*</span><span class="num" id="4082091">2</span><span class="op" id="4082092">+</span><span class="num" id="4082093">2</span>&nbsp;<span class="op" id="4082095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4082099">err</span>&nbsp;<span class="op" id="4082103">=</span>&nbsp;<span class="ident" id="4082105">ErrDecryption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4082121">return</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4082129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4082133">c</span>&nbsp;<span class="op" id="4082135">:=</span>&nbsp;<span class="builtinfunc" id="4082138">new</span><span class="op" id="4082141">(</span><span class="ident" id="4082142">big</span><span class="op" id="4082145">.</span><span class="ident" id="4082146">Int</span><span class="op" id="4082149">)</span><span class="op" id="4082150">.</span><span class="ident" id="4082151">SetBytes</span><span class="op" id="4082159">(</span><span class="ident" id="4082160">ciphertext</span><span class="op" id="4082170">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4082174">m</span><span class="op" id="4082175">,</span>&nbsp;<span class="ident" id="4082177">err</span>&nbsp;<span class="op" id="4082181">:=</span>&nbsp;<span class="ident" id="4082184">decrypt</span><span class="op" id="4082191">(</span><span class="ident" id="4082192">random</span><span class="op" id="4082198">,</span>&nbsp;<span class="ident" id="4082200">priv</span><span class="op" id="4082204">,</span>&nbsp;<span class="ident" id="4082206">c</span><span class="op" id="4082207">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4082210">if</span>&nbsp;<span class="ident" id="4082213">err</span>&nbsp;<span class="op" id="4082217">!=</span>&nbsp;<span class="ident" id="4082220">nil</span>&nbsp;<span class="op" id="4082224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4082228">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4082236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4082240">hash</span><span class="op" id="4082244">.</span><span class="ident" id="4082245">Write</span><span class="op" id="4082250">(</span><span class="ident" id="4082251">label</span><span class="op" id="4082256">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4082259">lHash</span>&nbsp;<span class="op" id="4082265">:=</span>&nbsp;<span class="ident" id="4082268">hash</span><span class="op" id="4082272">.</span><span class="ident" id="4082273">Sum</span><span class="op" id="4082276">(</span><span class="ident" id="4082277">nil</span><span class="op" id="4082280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4082283">hash</span><span class="op" id="4082287">.</span><span class="ident" id="4082288">Reset</span><span class="op" id="4082293">(</span><span class="op" id="4082294">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4082298">//&nbsp;Converting&nbsp;the&nbsp;plaintext&nbsp;number&nbsp;to&nbsp;bytes&nbsp;will&nbsp;strip&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4082358">//&nbsp;leading&nbsp;zeros&nbsp;so&nbsp;we&nbsp;may&nbsp;have&nbsp;to&nbsp;left&nbsp;pad.&nbsp;We&nbsp;do&nbsp;this&nbsp;unconditionally</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4082431">//&nbsp;to&nbsp;avoid&nbsp;leaking&nbsp;timing&nbsp;information.&nbsp;(Although&nbsp;we&nbsp;still&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4082500">//&nbsp;leak&nbsp;the&nbsp;number&nbsp;of&nbsp;leading&nbsp;zeros.&nbsp;It&#39;s&nbsp;not&nbsp;clear&nbsp;that&nbsp;we&nbsp;can&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4082568">//&nbsp;anything&nbsp;about&nbsp;this.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4082594">em</span>&nbsp;<span class="op" id="4082597">:=</span>&nbsp;<span class="ident" id="4082600">leftPad</span><span class="op" id="4082607">(</span><span class="ident" id="4082608">m</span><span class="op" id="4082609">.</span><span class="ident" id="4082610">Bytes</span><span class="op" id="4082615">(</span><span class="op" id="4082616">)</span><span class="op" id="4082617">,</span>&nbsp;<span class="ident" id="4082619">k</span><span class="op" id="4082620">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4082624">firstByteIsZero</span>&nbsp;<span class="op" id="4082640">:=</span>&nbsp;<span class="ident" id="4082643">subtle</span><span class="op" id="4082649">.</span><span class="ident" id="4082650">ConstantTimeByteEq</span><span class="op" id="4082668">(</span><span class="ident" id="4082669">em</span><span class="op" id="4082671">[</span><span class="num" id="4082672">0</span><span class="op" id="4082673">]</span><span class="op" id="4082674">,</span>&nbsp;<span class="num" id="4082676">0</span><span class="op" id="4082677">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4082681">seed</span>&nbsp;<span class="op" id="4082686">:=</span>&nbsp;<span class="ident" id="4082689">em</span><span class="op" id="4082691">[</span><span class="num" id="4082692">1</span>&nbsp;<span class="op" id="4082694">:</span>&nbsp;<span class="ident" id="4082696">hash</span><span class="op" id="4082700">.</span><span class="ident" id="4082701">Size</span><span class="op" id="4082705">(</span><span class="op" id="4082706">)</span><span class="op" id="4082707">+</span><span class="num" id="4082708">1</span><span class="op" id="4082709">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4082712">db</span>&nbsp;<span class="op" id="4082715">:=</span>&nbsp;<span class="ident" id="4082718">em</span><span class="op" id="4082720">[</span><span class="ident" id="4082721">hash</span><span class="op" id="4082725">.</span><span class="ident" id="4082726">Size</span><span class="op" id="4082730">(</span><span class="op" id="4082731">)</span><span class="op" id="4082732">+</span><span class="num" id="4082733">1</span><span class="op" id="4082734">:</span><span class="op" id="4082735">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4082739">mgf1XOR</span><span class="op" id="4082746">(</span><span class="ident" id="4082747">seed</span><span class="op" id="4082751">,</span>&nbsp;<span class="ident" id="4082753">hash</span><span class="op" id="4082757">,</span>&nbsp;<span class="ident" id="4082759">db</span><span class="op" id="4082761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4082764">mgf1XOR</span><span class="op" id="4082771">(</span><span class="ident" id="4082772">db</span><span class="op" id="4082774">,</span>&nbsp;<span class="ident" id="4082776">hash</span><span class="op" id="4082780">,</span>&nbsp;<span class="ident" id="4082782">seed</span><span class="op" id="4082786">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4082790">lHash2</span>&nbsp;<span class="op" id="4082797">:=</span>&nbsp;<span class="ident" id="4082800">db</span><span class="op" id="4082802">[</span><span class="num" id="4082803">0</span><span class="op" id="4082804">:</span><span class="ident" id="4082805">hash</span><span class="op" id="4082809">.</span><span class="ident" id="4082810">Size</span><span class="op" id="4082814">(</span><span class="op" id="4082815">)</span><span class="op" id="4082816">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4082820">//&nbsp;We&nbsp;have&nbsp;to&nbsp;validate&nbsp;the&nbsp;plaintext&nbsp;in&nbsp;constant&nbsp;time&nbsp;in&nbsp;order&nbsp;to&nbsp;avoid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4082893">//&nbsp;attacks&nbsp;like:&nbsp;J.&nbsp;Manger.&nbsp;A&nbsp;Chosen&nbsp;Ciphertext&nbsp;Attack&nbsp;on&nbsp;RSA&nbsp;Optimal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4082964">//&nbsp;Asymmetric&nbsp;Encryption&nbsp;Padding&nbsp;(OAEP)&nbsp;as&nbsp;Standardized&nbsp;in&nbsp;PKCS&nbsp;#1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4083032">//&nbsp;v2.0.&nbsp;In&nbsp;J.&nbsp;Kilian,&nbsp;editor,&nbsp;Advances&nbsp;in&nbsp;Cryptology.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4083088">lHash2Good</span>&nbsp;<span class="op" id="4083099">:=</span>&nbsp;<span class="ident" id="4083102">subtle</span><span class="op" id="4083108">.</span><span class="ident" id="4083109">ConstantTimeCompare</span><span class="op" id="4083128">(</span><span class="ident" id="4083129">lHash</span><span class="op" id="4083134">,</span>&nbsp;<span class="ident" id="4083136">lHash2</span><span class="op" id="4083142">)</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4083146">//&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;plaintext&nbsp;must&nbsp;be&nbsp;zero&nbsp;or&nbsp;more&nbsp;0x00,&nbsp;followed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4083217">//&nbsp;by&nbsp;0x01,&nbsp;followed&nbsp;by&nbsp;the&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4083255">//&nbsp;&nbsp;&nbsp;lookingForIndex:&nbsp;1&nbsp;iff&nbsp;we&nbsp;are&nbsp;still&nbsp;looking&nbsp;for&nbsp;the&nbsp;0x01</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4083318">//&nbsp;&nbsp;&nbsp;index:&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;first&nbsp;0x01&nbsp;byte</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4083365">//&nbsp;&nbsp;&nbsp;invalid:&nbsp;1&nbsp;iff&nbsp;we&nbsp;saw&nbsp;a&nbsp;non-zero&nbsp;byte&nbsp;before&nbsp;the&nbsp;0x01.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083426">var</span>&nbsp;<span class="ident" id="4083430">lookingForIndex</span><span class="op" id="4083445">,</span>&nbsp;<span class="ident" id="4083447">index</span><span class="op" id="4083452">,</span>&nbsp;<span class="ident" id="4083454">invalid</span>&nbsp;<span class="builtintype" id="4083462">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4083467">lookingForIndex</span>&nbsp;<span class="op" id="4083483">=</span>&nbsp;<span class="num" id="4083485">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4083488">rest</span>&nbsp;<span class="op" id="4083493">:=</span>&nbsp;<span class="ident" id="4083496">db</span><span class="op" id="4083498">[</span><span class="ident" id="4083499">hash</span><span class="op" id="4083503">.</span><span class="ident" id="4083504">Size</span><span class="op" id="4083508">(</span><span class="op" id="4083509">)</span><span class="op" id="4083510">:</span><span class="op" id="4083511">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083515">for</span>&nbsp;<span class="ident" id="4083519">i</span>&nbsp;<span class="op" id="4083521">:=</span>&nbsp;<span class="num" id="4083524">0</span><span class="op" id="4083525">;</span>&nbsp;<span class="ident" id="4083527">i</span>&nbsp;<span class="op" id="4083529">&lt;</span>&nbsp;<span class="builtinfunc" id="4083531">len</span><span class="op" id="4083534">(</span><span class="ident" id="4083535">rest</span><span class="op" id="4083539">)</span><span class="op" id="4083540">;</span>&nbsp;<span class="ident" id="4083542">i</span><span class="op" id="4083543">++</span>&nbsp;<span class="op" id="4083546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4083550">equals0</span>&nbsp;<span class="op" id="4083558">:=</span>&nbsp;<span class="ident" id="4083561">subtle</span><span class="op" id="4083567">.</span><span class="ident" id="4083568">ConstantTimeByteEq</span><span class="op" id="4083586">(</span><span class="ident" id="4083587">rest</span><span class="op" id="4083591">[</span><span class="ident" id="4083592">i</span><span class="op" id="4083593">]</span><span class="op" id="4083594">,</span>&nbsp;<span class="num" id="4083596">0</span><span class="op" id="4083597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4083601">equals1</span>&nbsp;<span class="op" id="4083609">:=</span>&nbsp;<span class="ident" id="4083612">subtle</span><span class="op" id="4083618">.</span><span class="ident" id="4083619">ConstantTimeByteEq</span><span class="op" id="4083637">(</span><span class="ident" id="4083638">rest</span><span class="op" id="4083642">[</span><span class="ident" id="4083643">i</span><span class="op" id="4083644">]</span><span class="op" id="4083645">,</span>&nbsp;<span class="num" id="4083647">1</span><span class="op" id="4083648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4083652">index</span>&nbsp;<span class="op" id="4083658">=</span>&nbsp;<span class="ident" id="4083660">subtle</span><span class="op" id="4083666">.</span><span class="ident" id="4083667">ConstantTimeSelect</span><span class="op" id="4083685">(</span><span class="ident" id="4083686">lookingForIndex</span><span class="op" id="4083701">&amp;</span><span class="ident" id="4083702">equals1</span><span class="op" id="4083709">,</span>&nbsp;<span class="ident" id="4083711">i</span><span class="op" id="4083712">,</span>&nbsp;<span class="ident" id="4083714">index</span><span class="op" id="4083719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4083723">lookingForIndex</span>&nbsp;<span class="op" id="4083739">=</span>&nbsp;<span class="ident" id="4083741">subtle</span><span class="op" id="4083747">.</span><span class="ident" id="4083748">ConstantTimeSelect</span><span class="op" id="4083766">(</span><span class="ident" id="4083767">equals1</span><span class="op" id="4083774">,</span>&nbsp;<span class="num" id="4083776">0</span><span class="op" id="4083777">,</span>&nbsp;<span class="ident" id="4083779">lookingForIndex</span><span class="op" id="4083794">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4083798">invalid</span>&nbsp;<span class="op" id="4083806">=</span>&nbsp;<span class="ident" id="4083808">subtle</span><span class="op" id="4083814">.</span><span class="ident" id="4083815">ConstantTimeSelect</span><span class="op" id="4083833">(</span><span class="ident" id="4083834">lookingForIndex</span><span class="op" id="4083849">&amp;^</span><span class="ident" id="4083851">equals0</span><span class="op" id="4083858">,</span>&nbsp;<span class="num" id="4083860">1</span><span class="op" id="4083861">,</span>&nbsp;<span class="ident" id="4083863">invalid</span><span class="op" id="4083870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4083873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083877">if</span>&nbsp;<span class="ident" id="4083880">firstByteIsZero</span><span class="op" id="4083895">&amp;</span><span class="ident" id="4083896">lHash2Good</span><span class="op" id="4083906">&amp;^</span><span class="ident" id="4083908">invalid</span><span class="op" id="4083915">&amp;^</span><span class="ident" id="4083917">lookingForIndex</span>&nbsp;<span class="op" id="4083933">!=</span>&nbsp;<span class="num" id="4083936">1</span>&nbsp;<span class="op" id="4083938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4083942">err</span>&nbsp;<span class="op" id="4083946">=</span>&nbsp;<span class="ident" id="4083948">ErrDecryption</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083964">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4083972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4083976">msg</span>&nbsp;<span class="op" id="4083980">=</span>&nbsp;<span class="ident" id="4083982">rest</span><span class="op" id="4083986">[</span><span class="ident" id="4083987">index</span><span class="op" id="4083992">+</span><span class="num" id="4083993">1</span><span class="op" id="4083994">:</span><span class="op" id="4083995">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4083998">return</span><br>
<span class="lineno">545</span><span class="op" id="4084005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4084008">//&nbsp;leftPad&nbsp;returns&nbsp;a&nbsp;new&nbsp;slice&nbsp;of&nbsp;length&nbsp;size.&nbsp;The&nbsp;contents&nbsp;of&nbsp;input&nbsp;are&nbsp;right</span><br>
<span class="lineno"></span><span class="comment" id="4084087">//&nbsp;aligned&nbsp;in&nbsp;the&nbsp;new&nbsp;slice.</span><br>
<span class="lineno"></span><span class="keyword" id="4084116">func</span>&nbsp;<span class="ident" id="4084121">leftPad</span><span class="op" id="4084128">(</span><span class="ident" id="4084129">input</span>&nbsp;<span class="op" id="4084135">[</span><span class="op" id="4084136">]</span><span class="builtintype" id="4084137">byte</span><span class="op" id="4084141">,</span>&nbsp;<span class="ident" id="4084143">size</span>&nbsp;<span class="builtintype" id="4084148">int</span><span class="op" id="4084151">)</span>&nbsp;<span class="op" id="4084153">(</span><span class="ident" id="4084154">out</span>&nbsp;<span class="op" id="4084158">[</span><span class="op" id="4084159">]</span><span class="builtintype" id="4084160">byte</span><span class="op" id="4084164">)</span>&nbsp;<span class="op" id="4084166">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4084169">n</span>&nbsp;<span class="op" id="4084171">:=</span>&nbsp;<span class="builtinfunc" id="4084174">len</span><span class="op" id="4084177">(</span><span class="ident" id="4084178">input</span><span class="op" id="4084183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4084186">if</span>&nbsp;<span class="ident" id="4084189">n</span>&nbsp;<span class="op" id="4084191">&gt;</span>&nbsp;<span class="ident" id="4084193">size</span>&nbsp;<span class="op" id="4084198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4084202">n</span>&nbsp;<span class="op" id="4084204">=</span>&nbsp;<span class="ident" id="4084206">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4084212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4084215">out</span>&nbsp;<span class="op" id="4084219">=</span>&nbsp;<span class="builtinfunc" id="4084221">make</span><span class="op" id="4084225">(</span><span class="op" id="4084226">[</span><span class="op" id="4084227">]</span><span class="builtintype" id="4084228">byte</span><span class="op" id="4084232">,</span>&nbsp;<span class="ident" id="4084234">size</span><span class="op" id="4084238">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4084241">copy</span><span class="op" id="4084245">(</span><span class="ident" id="4084246">out</span><span class="op" id="4084249">[</span><span class="builtinfunc" id="4084250">len</span><span class="op" id="4084253">(</span><span class="ident" id="4084254">out</span><span class="op" id="4084257">)</span><span class="op" id="4084258">-</span><span class="ident" id="4084259">n</span><span class="op" id="4084260">:</span><span class="op" id="4084261">]</span><span class="op" id="4084262">,</span>&nbsp;<span class="ident" id="4084264">input</span><span class="op" id="4084269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4084272">return</span><br>
<span class="lineno"></span><span class="op" id="4084279">}</span>
</div>
</body>
</html>
