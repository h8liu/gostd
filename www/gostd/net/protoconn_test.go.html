<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8459301">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8459357">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8459411">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="8459462">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;API&nbsp;tests&nbsp;across&nbsp;platforms&nbsp;and&nbsp;will&nbsp;never&nbsp;have&nbsp;a&nbsp;build</span><br>
<span class="lineno"></span><span class="comment" id="8459541">//&nbsp;tag.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8459550">package</span>&nbsp;<span class="ident" id="8459558">net</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="8459563">import</span>&nbsp;<span class="op" id="8459570">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8459573">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8459586">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8459592">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8459603">&#34;testing&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8459614">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8459621">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8459624">//&nbsp;testUnixAddr&nbsp;uses&nbsp;ioutil.TempFile&nbsp;to&nbsp;get&nbsp;a&nbsp;name&nbsp;that&nbsp;is&nbsp;unique.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="8459694">//&nbsp;also&nbsp;uses&nbsp;/tmp&nbsp;directory&nbsp;in&nbsp;case&nbsp;it&nbsp;is&nbsp;prohibited&nbsp;to&nbsp;create&nbsp;UNIX</span><br>
<span class="lineno">20</span><span class="comment" id="8459762">//&nbsp;sockets&nbsp;in&nbsp;TMPDIR.</span><br>
<span class="lineno"></span><span class="keyword" id="8459784">func</span>&nbsp;<span class="ident" id="8459789">testUnixAddr</span><span class="op" id="8459801">(</span><span class="op" id="8459802">)</span>&nbsp;<span class="builtintype" id="8459804">string</span>&nbsp;<span class="op" id="8459811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459814">f</span><span class="op" id="8459815">,</span>&nbsp;<span class="ident" id="8459817">err</span>&nbsp;<span class="op" id="8459821">:=</span>&nbsp;<span class="ident" id="8459824">ioutil</span><span class="op" id="8459830">.</span><span class="ident" id="8459831">TempFile</span><span class="op" id="8459839">(</span><span class="string" id="8459840">&#34;&#34;</span><span class="op" id="8459842">,</span>&nbsp;<span class="string" id="8459844">&#34;nettest&#34;</span><span class="op" id="8459853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8459856">if</span>&nbsp;<span class="ident" id="8459859">err</span>&nbsp;<span class="op" id="8459863">!=</span>&nbsp;<span class="ident" id="8459866">nil</span>&nbsp;<span class="op" id="8459870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8459874">panic</span><span class="op" id="8459879">(</span><span class="ident" id="8459880">err</span><span class="op" id="8459883">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8459886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459889">addr</span>&nbsp;<span class="op" id="8459894">:=</span>&nbsp;<span class="ident" id="8459897">f</span><span class="op" id="8459898">.</span><span class="ident" id="8459899">Name</span><span class="op" id="8459903">(</span><span class="op" id="8459904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459907">f</span><span class="op" id="8459908">.</span><span class="ident" id="8459909">Close</span><span class="op" id="8459914">(</span><span class="op" id="8459915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459918">os</span><span class="op" id="8459920">.</span><span class="ident" id="8459921">Remove</span><span class="op" id="8459927">(</span><span class="ident" id="8459928">addr</span><span class="op" id="8459932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8459935">return</span>&nbsp;<span class="ident" id="8459942">addr</span><br>
<span class="lineno">30</span><span class="op" id="8459947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8459950">var</span>&nbsp;<span class="ident" id="8459954">condFatalf</span>&nbsp;<span class="op" id="8459965">=</span>&nbsp;<span class="keyword" id="8459967">func</span><span class="op" id="8459971">(</span><span class="op" id="8459972">)</span>&nbsp;<span class="keyword" id="8459974">func</span><span class="op" id="8459978">(</span><span class="op" id="8459979">*</span><span class="ident" id="8459980">testing</span><span class="op" id="8459987">.</span><span class="ident" id="8459988">T</span><span class="op" id="8459989">,</span>&nbsp;<span class="builtintype" id="8459991">string</span><span class="op" id="8459997">,</span>&nbsp;<span class="op" id="8459999">...</span><span class="keyword" id="8460002">interface</span><span class="op" id="8460011">{</span><span class="op" id="8460012">}</span><span class="op" id="8460013">)</span>&nbsp;<span class="op" id="8460015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8460018">//&nbsp;A&nbsp;few&nbsp;APIs&nbsp;are&nbsp;not&nbsp;implemented&nbsp;yet&nbsp;on&nbsp;both&nbsp;Plan&nbsp;9&nbsp;and&nbsp;Windows.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460085">switch</span>&nbsp;<span class="ident" id="8460092">runtime</span><span class="op" id="8460099">.</span><span class="ident" id="8460100">GOOS</span>&nbsp;<span class="op" id="8460105">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460108">case</span>&nbsp;<span class="string" id="8460113">&#34;plan9&#34;</span><span class="op" id="8460120">,</span>&nbsp;<span class="string" id="8460122">&#34;windows&#34;</span><span class="op" id="8460131">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460135">return</span>&nbsp;<span class="op" id="8460142">(</span><span class="op" id="8460143">*</span><span class="ident" id="8460144">testing</span><span class="op" id="8460151">.</span><span class="ident" id="8460152">T</span><span class="op" id="8460153">)</span><span class="op" id="8460154">.</span><span class="ident" id="8460155">Logf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460164">return</span>&nbsp;<span class="op" id="8460171">(</span><span class="op" id="8460172">*</span><span class="ident" id="8460173">testing</span><span class="op" id="8460180">.</span><span class="ident" id="8460181">T</span><span class="op" id="8460182">)</span><span class="op" id="8460183">.</span><span class="ident" id="8460184">Fatalf</span><br>
<span class="lineno"></span><span class="op" id="8460191">}</span><span class="op" id="8460192">(</span><span class="op" id="8460193">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="8460196">func</span>&nbsp;<span class="ident" id="8460201">TestTCPListenerSpecificMethods</span><span class="op" id="8460231">(</span><span class="ident" id="8460232">t</span>&nbsp;<span class="op" id="8460234">*</span><span class="ident" id="8460235">testing</span><span class="op" id="8460242">.</span><span class="ident" id="8460243">T</span><span class="op" id="8460244">)</span>&nbsp;<span class="op" id="8460246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460249">switch</span>&nbsp;<span class="ident" id="8460256">runtime</span><span class="op" id="8460263">.</span><span class="ident" id="8460264">GOOS</span>&nbsp;<span class="op" id="8460269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460272">case</span>&nbsp;<span class="string" id="8460277">&#34;plan9&#34;</span><span class="op" id="8460284">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460288">t</span><span class="op" id="8460289">.</span><span class="ident" id="8460290">Skipf</span><span class="op" id="8460295">(</span><span class="string" id="8460296">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8460317">,</span>&nbsp;<span class="ident" id="8460319">runtime</span><span class="op" id="8460326">.</span><span class="ident" id="8460327">GOOS</span><span class="op" id="8460331">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460338">la</span><span class="op" id="8460340">,</span>&nbsp;<span class="ident" id="8460342">err</span>&nbsp;<span class="op" id="8460346">:=</span>&nbsp;<span class="ident" id="8460349">ResolveTCPAddr</span><span class="op" id="8460363">(</span><span class="string" id="8460364">&#34;tcp4&#34;</span><span class="op" id="8460370">,</span>&nbsp;<span class="string" id="8460372">&#34;127.0.0.1:0&#34;</span><span class="op" id="8460385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460388">if</span>&nbsp;<span class="ident" id="8460391">err</span>&nbsp;<span class="op" id="8460395">!=</span>&nbsp;<span class="ident" id="8460398">nil</span>&nbsp;<span class="op" id="8460402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460406">t</span><span class="op" id="8460407">.</span><span class="ident" id="8460408">Fatalf</span><span class="op" id="8460414">(</span><span class="string" id="8460415">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8460442">,</span>&nbsp;<span class="ident" id="8460444">err</span><span class="op" id="8460447">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460453">ln</span><span class="op" id="8460455">,</span>&nbsp;<span class="ident" id="8460457">err</span>&nbsp;<span class="op" id="8460461">:=</span>&nbsp;<span class="ident" id="8460464">ListenTCP</span><span class="op" id="8460473">(</span><span class="string" id="8460474">&#34;tcp4&#34;</span><span class="op" id="8460480">,</span>&nbsp;<span class="ident" id="8460482">la</span><span class="op" id="8460484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460487">if</span>&nbsp;<span class="ident" id="8460490">err</span>&nbsp;<span class="op" id="8460494">!=</span>&nbsp;<span class="ident" id="8460497">nil</span>&nbsp;<span class="op" id="8460501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460505">t</span><span class="op" id="8460506">.</span><span class="ident" id="8460507">Fatalf</span><span class="op" id="8460513">(</span><span class="string" id="8460514">&#34;ListenTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8460536">,</span>&nbsp;<span class="ident" id="8460538">err</span><span class="op" id="8460541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460544">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460547">defer</span>&nbsp;<span class="ident" id="8460553">ln</span><span class="op" id="8460555">.</span><span class="ident" id="8460556">Close</span><span class="op" id="8460561">(</span><span class="op" id="8460562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460565">ln</span><span class="op" id="8460567">.</span><span class="ident" id="8460568">Addr</span><span class="op" id="8460572">(</span><span class="op" id="8460573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460576">ln</span><span class="op" id="8460578">.</span><span class="ident" id="8460579">SetDeadline</span><span class="op" id="8460590">(</span><span class="ident" id="8460591">time</span><span class="op" id="8460595">.</span><span class="ident" id="8460596">Now</span><span class="op" id="8460599">(</span><span class="op" id="8460600">)</span><span class="op" id="8460601">.</span><span class="ident" id="8460602">Add</span><span class="op" id="8460605">(</span><span class="num" id="8460606">30</span>&nbsp;<span class="op" id="8460609">*</span>&nbsp;<span class="ident" id="8460611">time</span><span class="op" id="8460615">.</span><span class="ident" id="8460616">Nanosecond</span><span class="op" id="8460626">)</span><span class="op" id="8460627">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460631">if</span>&nbsp;<span class="ident" id="8460634">c</span><span class="op" id="8460635">,</span>&nbsp;<span class="ident" id="8460637">err</span>&nbsp;<span class="op" id="8460641">:=</span>&nbsp;<span class="ident" id="8460644">ln</span><span class="op" id="8460646">.</span><span class="ident" id="8460647">Accept</span><span class="op" id="8460653">(</span><span class="op" id="8460654">)</span><span class="op" id="8460655">;</span>&nbsp;<span class="ident" id="8460657">err</span>&nbsp;<span class="op" id="8460661">!=</span>&nbsp;<span class="ident" id="8460664">nil</span>&nbsp;<span class="op" id="8460668">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460672">if</span>&nbsp;<span class="op" id="8460675">!</span><span class="ident" id="8460676">err</span><span class="op" id="8460679">.</span><span class="op" id="8460680">(</span><span class="ident" id="8460681">Error</span><span class="op" id="8460686">)</span><span class="op" id="8460687">.</span><span class="ident" id="8460688">Timeout</span><span class="op" id="8460695">(</span><span class="op" id="8460696">)</span>&nbsp;<span class="op" id="8460698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460703">t</span><span class="op" id="8460704">.</span><span class="ident" id="8460705">Fatalf</span><span class="op" id="8460711">(</span><span class="string" id="8460712">&#34;TCPListener.Accept&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8460743">,</span>&nbsp;<span class="ident" id="8460745">err</span><span class="op" id="8460748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460755">}</span>&nbsp;<span class="keyword" id="8460757">else</span>&nbsp;<span class="op" id="8460762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460766">c</span><span class="op" id="8460767">.</span><span class="ident" id="8460768">Close</span><span class="op" id="8460773">(</span><span class="op" id="8460774">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460780">if</span>&nbsp;<span class="ident" id="8460783">c</span><span class="op" id="8460784">,</span>&nbsp;<span class="ident" id="8460786">err</span>&nbsp;<span class="op" id="8460790">:=</span>&nbsp;<span class="ident" id="8460793">ln</span><span class="op" id="8460795">.</span><span class="ident" id="8460796">AcceptTCP</span><span class="op" id="8460805">(</span><span class="op" id="8460806">)</span><span class="op" id="8460807">;</span>&nbsp;<span class="ident" id="8460809">err</span>&nbsp;<span class="op" id="8460813">!=</span>&nbsp;<span class="ident" id="8460816">nil</span>&nbsp;<span class="op" id="8460820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460824">if</span>&nbsp;<span class="op" id="8460827">!</span><span class="ident" id="8460828">err</span><span class="op" id="8460831">.</span><span class="op" id="8460832">(</span><span class="ident" id="8460833">Error</span><span class="op" id="8460838">)</span><span class="op" id="8460839">.</span><span class="ident" id="8460840">Timeout</span><span class="op" id="8460847">(</span><span class="op" id="8460848">)</span>&nbsp;<span class="op" id="8460850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460855">t</span><span class="op" id="8460856">.</span><span class="ident" id="8460857">Fatalf</span><span class="op" id="8460863">(</span><span class="string" id="8460864">&#34;TCPListener.AcceptTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8460898">,</span>&nbsp;<span class="ident" id="8460900">err</span><span class="op" id="8460903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460907">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460910">}</span>&nbsp;<span class="keyword" id="8460912">else</span>&nbsp;<span class="op" id="8460917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460921">c</span><span class="op" id="8460922">.</span><span class="ident" id="8460923">Close</span><span class="op" id="8460928">(</span><span class="op" id="8460929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460936">if</span>&nbsp;<span class="ident" id="8460939">f</span><span class="op" id="8460940">,</span>&nbsp;<span class="ident" id="8460942">err</span>&nbsp;<span class="op" id="8460946">:=</span>&nbsp;<span class="ident" id="8460949">ln</span><span class="op" id="8460951">.</span><span class="ident" id="8460952">File</span><span class="op" id="8460956">(</span><span class="op" id="8460957">)</span><span class="op" id="8460958">;</span>&nbsp;<span class="ident" id="8460960">err</span>&nbsp;<span class="op" id="8460964">!=</span>&nbsp;<span class="ident" id="8460967">nil</span>&nbsp;<span class="op" id="8460971">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460975">condFatalf</span><span class="op" id="8460985">(</span><span class="ident" id="8460986">t</span><span class="op" id="8460987">,</span>&nbsp;<span class="string" id="8460989">&#34;TCPListener.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8461018">,</span>&nbsp;<span class="ident" id="8461020">err</span><span class="op" id="8461023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8461026">}</span>&nbsp;<span class="keyword" id="8461028">else</span>&nbsp;<span class="op" id="8461033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461037">f</span><span class="op" id="8461038">.</span><span class="ident" id="8461039">Close</span><span class="op" id="8461044">(</span><span class="op" id="8461045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8461048">}</span><br>
<span class="lineno"></span><span class="op" id="8461050">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="8461053">func</span>&nbsp;<span class="ident" id="8461058">TestTCPConnSpecificMethods</span><span class="op" id="8461084">(</span><span class="ident" id="8461085">t</span>&nbsp;<span class="op" id="8461087">*</span><span class="ident" id="8461088">testing</span><span class="op" id="8461095">.</span><span class="ident" id="8461096">T</span><span class="op" id="8461097">)</span>&nbsp;<span class="op" id="8461099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461102">la</span><span class="op" id="8461104">,</span>&nbsp;<span class="ident" id="8461106">err</span>&nbsp;<span class="op" id="8461110">:=</span>&nbsp;<span class="ident" id="8461113">ResolveTCPAddr</span><span class="op" id="8461127">(</span><span class="string" id="8461128">&#34;tcp4&#34;</span><span class="op" id="8461134">,</span>&nbsp;<span class="string" id="8461136">&#34;127.0.0.1:0&#34;</span><span class="op" id="8461149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8461152">if</span>&nbsp;<span class="ident" id="8461155">err</span>&nbsp;<span class="op" id="8461159">!=</span>&nbsp;<span class="ident" id="8461162">nil</span>&nbsp;<span class="op" id="8461166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461170">t</span><span class="op" id="8461171">.</span><span class="ident" id="8461172">Fatalf</span><span class="op" id="8461178">(</span><span class="string" id="8461179">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8461206">,</span>&nbsp;<span class="ident" id="8461208">err</span><span class="op" id="8461211">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8461214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461217">ln</span><span class="op" id="8461219">,</span>&nbsp;<span class="ident" id="8461221">err</span>&nbsp;<span class="op" id="8461225">:=</span>&nbsp;<span class="ident" id="8461228">ListenTCP</span><span class="op" id="8461237">(</span><span class="string" id="8461238">&#34;tcp4&#34;</span><span class="op" id="8461244">,</span>&nbsp;<span class="ident" id="8461246">la</span><span class="op" id="8461248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8461251">if</span>&nbsp;<span class="ident" id="8461254">err</span>&nbsp;<span class="op" id="8461258">!=</span>&nbsp;<span class="ident" id="8461261">nil</span>&nbsp;<span class="op" id="8461265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461269">t</span><span class="op" id="8461270">.</span><span class="ident" id="8461271">Fatalf</span><span class="op" id="8461277">(</span><span class="string" id="8461278">&#34;ListenTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8461300">,</span>&nbsp;<span class="ident" id="8461302">err</span><span class="op" id="8461305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8461308">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8461311">defer</span>&nbsp;<span class="ident" id="8461317">ln</span><span class="op" id="8461319">.</span><span class="ident" id="8461320">Close</span><span class="op" id="8461325">(</span><span class="op" id="8461326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461329">ln</span><span class="op" id="8461331">.</span><span class="ident" id="8461332">Addr</span><span class="op" id="8461336">(</span><span class="op" id="8461337">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461341">done</span>&nbsp;<span class="op" id="8461346">:=</span>&nbsp;<span class="builtinfunc" id="8461349">make</span><span class="op" id="8461353">(</span><span class="keyword" id="8461354">chan</span>&nbsp;<span class="builtintype" id="8461359">int</span><span class="op" id="8461362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8461365">go</span>&nbsp;<span class="ident" id="8461368">transponder</span><span class="op" id="8461379">(</span><span class="ident" id="8461380">t</span><span class="op" id="8461381">,</span>&nbsp;<span class="ident" id="8461383">ln</span><span class="op" id="8461385">,</span>&nbsp;<span class="ident" id="8461387">done</span><span class="op" id="8461391">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461395">ra</span><span class="op" id="8461397">,</span>&nbsp;<span class="ident" id="8461399">err</span>&nbsp;<span class="op" id="8461403">:=</span>&nbsp;<span class="ident" id="8461406">ResolveTCPAddr</span><span class="op" id="8461420">(</span><span class="string" id="8461421">&#34;tcp4&#34;</span><span class="op" id="8461427">,</span>&nbsp;<span class="ident" id="8461429">ln</span><span class="op" id="8461431">.</span><span class="ident" id="8461432">Addr</span><span class="op" id="8461436">(</span><span class="op" id="8461437">)</span><span class="op" id="8461438">.</span><span class="ident" id="8461439">String</span><span class="op" id="8461445">(</span><span class="op" id="8461446">)</span><span class="op" id="8461447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8461450">if</span>&nbsp;<span class="ident" id="8461453">err</span>&nbsp;<span class="op" id="8461457">!=</span>&nbsp;<span class="ident" id="8461460">nil</span>&nbsp;<span class="op" id="8461464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461468">t</span><span class="op" id="8461469">.</span><span class="ident" id="8461470">Fatalf</span><span class="op" id="8461476">(</span><span class="string" id="8461477">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8461504">,</span>&nbsp;<span class="ident" id="8461506">err</span><span class="op" id="8461509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8461512">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461515">c</span><span class="op" id="8461516">,</span>&nbsp;<span class="ident" id="8461518">err</span>&nbsp;<span class="op" id="8461522">:=</span>&nbsp;<span class="ident" id="8461525">DialTCP</span><span class="op" id="8461532">(</span><span class="string" id="8461533">&#34;tcp4&#34;</span><span class="op" id="8461539">,</span>&nbsp;<span class="ident" id="8461541">nil</span><span class="op" id="8461544">,</span>&nbsp;<span class="ident" id="8461546">ra</span><span class="op" id="8461548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8461551">if</span>&nbsp;<span class="ident" id="8461554">err</span>&nbsp;<span class="op" id="8461558">!=</span>&nbsp;<span class="ident" id="8461561">nil</span>&nbsp;<span class="op" id="8461565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461569">t</span><span class="op" id="8461570">.</span><span class="ident" id="8461571">Fatalf</span><span class="op" id="8461577">(</span><span class="string" id="8461578">&#34;DialTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8461598">,</span>&nbsp;<span class="ident" id="8461600">err</span><span class="op" id="8461603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8461606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8461609">defer</span>&nbsp;<span class="ident" id="8461615">c</span><span class="op" id="8461616">.</span><span class="ident" id="8461617">Close</span><span class="op" id="8461622">(</span><span class="op" id="8461623">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461626">c</span><span class="op" id="8461627">.</span><span class="ident" id="8461628">SetKeepAlive</span><span class="op" id="8461640">(</span><span class="builtintype" id="8461641">false</span><span class="op" id="8461646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461649">c</span><span class="op" id="8461650">.</span><span class="ident" id="8461651">SetKeepAlivePeriod</span><span class="op" id="8461669">(</span><span class="num" id="8461670">3</span>&nbsp;<span class="op" id="8461672">*</span>&nbsp;<span class="ident" id="8461674">time</span><span class="op" id="8461678">.</span><span class="ident" id="8461679">Second</span><span class="op" id="8461685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461688">c</span><span class="op" id="8461689">.</span><span class="ident" id="8461690">SetLinger</span><span class="op" id="8461699">(</span><span class="num" id="8461700">0</span><span class="op" id="8461701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461704">c</span><span class="op" id="8461705">.</span><span class="ident" id="8461706">SetNoDelay</span><span class="op" id="8461716">(</span><span class="builtintype" id="8461717">false</span><span class="op" id="8461722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461725">c</span><span class="op" id="8461726">.</span><span class="ident" id="8461727">LocalAddr</span><span class="op" id="8461736">(</span><span class="op" id="8461737">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461740">c</span><span class="op" id="8461741">.</span><span class="ident" id="8461742">RemoteAddr</span><span class="op" id="8461752">(</span><span class="op" id="8461753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461756">c</span><span class="op" id="8461757">.</span><span class="ident" id="8461758">SetDeadline</span><span class="op" id="8461769">(</span><span class="ident" id="8461770">time</span><span class="op" id="8461774">.</span><span class="ident" id="8461775">Now</span><span class="op" id="8461778">(</span><span class="op" id="8461779">)</span><span class="op" id="8461780">.</span><span class="ident" id="8461781">Add</span><span class="op" id="8461784">(</span><span class="ident" id="8461785">someTimeout</span><span class="op" id="8461796">)</span><span class="op" id="8461797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461800">c</span><span class="op" id="8461801">.</span><span class="ident" id="8461802">SetReadDeadline</span><span class="op" id="8461817">(</span><span class="ident" id="8461818">time</span><span class="op" id="8461822">.</span><span class="ident" id="8461823">Now</span><span class="op" id="8461826">(</span><span class="op" id="8461827">)</span><span class="op" id="8461828">.</span><span class="ident" id="8461829">Add</span><span class="op" id="8461832">(</span><span class="ident" id="8461833">someTimeout</span><span class="op" id="8461844">)</span><span class="op" id="8461845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461848">c</span><span class="op" id="8461849">.</span><span class="ident" id="8461850">SetWriteDeadline</span><span class="op" id="8461866">(</span><span class="ident" id="8461867">time</span><span class="op" id="8461871">.</span><span class="ident" id="8461872">Now</span><span class="op" id="8461875">(</span><span class="op" id="8461876">)</span><span class="op" id="8461877">.</span><span class="ident" id="8461878">Add</span><span class="op" id="8461881">(</span><span class="ident" id="8461882">someTimeout</span><span class="op" id="8461893">)</span><span class="op" id="8461894">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8461898">if</span>&nbsp;<span class="ident" id="8461901">_</span><span class="op" id="8461902">,</span>&nbsp;<span class="ident" id="8461904">err</span>&nbsp;<span class="op" id="8461908">:=</span>&nbsp;<span class="ident" id="8461911">c</span><span class="op" id="8461912">.</span><span class="ident" id="8461913">Write</span><span class="op" id="8461918">(</span><span class="op" id="8461919">[</span><span class="op" id="8461920">]</span><span class="builtintype" id="8461921">byte</span><span class="op" id="8461925">(</span><span class="string" id="8461926">&#34;TCPCONN&nbsp;TEST&#34;</span><span class="op" id="8461940">)</span><span class="op" id="8461941">)</span><span class="op" id="8461942">;</span>&nbsp;<span class="ident" id="8461944">err</span>&nbsp;<span class="op" id="8461948">!=</span>&nbsp;<span class="ident" id="8461951">nil</span>&nbsp;<span class="op" id="8461955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461959">t</span><span class="op" id="8461960">.</span><span class="ident" id="8461961">Fatalf</span><span class="op" id="8461967">(</span><span class="string" id="8461968">&#34;TCPConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8461994">,</span>&nbsp;<span class="ident" id="8461996">err</span><span class="op" id="8461999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8462002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462005">rb</span>&nbsp;<span class="op" id="8462008">:=</span>&nbsp;<span class="builtinfunc" id="8462011">make</span><span class="op" id="8462015">(</span><span class="op" id="8462016">[</span><span class="op" id="8462017">]</span><span class="builtintype" id="8462018">byte</span><span class="op" id="8462022">,</span>&nbsp;<span class="num" id="8462024">128</span><span class="op" id="8462027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8462030">if</span>&nbsp;<span class="ident" id="8462033">_</span><span class="op" id="8462034">,</span>&nbsp;<span class="ident" id="8462036">err</span>&nbsp;<span class="op" id="8462040">:=</span>&nbsp;<span class="ident" id="8462043">c</span><span class="op" id="8462044">.</span><span class="ident" id="8462045">Read</span><span class="op" id="8462049">(</span><span class="ident" id="8462050">rb</span><span class="op" id="8462052">)</span><span class="op" id="8462053">;</span>&nbsp;<span class="ident" id="8462055">err</span>&nbsp;<span class="op" id="8462059">!=</span>&nbsp;<span class="ident" id="8462062">nil</span>&nbsp;<span class="op" id="8462066">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462070">t</span><span class="op" id="8462071">.</span><span class="ident" id="8462072">Fatalf</span><span class="op" id="8462078">(</span><span class="string" id="8462079">&#34;TCPConn.Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8462104">,</span>&nbsp;<span class="ident" id="8462106">err</span><span class="op" id="8462109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8462112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8462116">&lt;-</span><span class="ident" id="8462118">done</span><br>
<span class="lineno"></span><span class="op" id="8462123">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="8462126">func</span>&nbsp;<span class="ident" id="8462131">TestUDPConnSpecificMethods</span><span class="op" id="8462157">(</span><span class="ident" id="8462158">t</span>&nbsp;<span class="op" id="8462160">*</span><span class="ident" id="8462161">testing</span><span class="op" id="8462168">.</span><span class="ident" id="8462169">T</span><span class="op" id="8462170">)</span>&nbsp;<span class="op" id="8462172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462175">la</span><span class="op" id="8462177">,</span>&nbsp;<span class="ident" id="8462179">err</span>&nbsp;<span class="op" id="8462183">:=</span>&nbsp;<span class="ident" id="8462186">ResolveUDPAddr</span><span class="op" id="8462200">(</span><span class="string" id="8462201">&#34;udp4&#34;</span><span class="op" id="8462207">,</span>&nbsp;<span class="string" id="8462209">&#34;127.0.0.1:0&#34;</span><span class="op" id="8462222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8462225">if</span>&nbsp;<span class="ident" id="8462228">err</span>&nbsp;<span class="op" id="8462232">!=</span>&nbsp;<span class="ident" id="8462235">nil</span>&nbsp;<span class="op" id="8462239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462243">t</span><span class="op" id="8462244">.</span><span class="ident" id="8462245">Fatalf</span><span class="op" id="8462251">(</span><span class="string" id="8462252">&#34;ResolveUDPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8462279">,</span>&nbsp;<span class="ident" id="8462281">err</span><span class="op" id="8462284">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8462287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462290">c</span><span class="op" id="8462291">,</span>&nbsp;<span class="ident" id="8462293">err</span>&nbsp;<span class="op" id="8462297">:=</span>&nbsp;<span class="ident" id="8462300">ListenUDP</span><span class="op" id="8462309">(</span><span class="string" id="8462310">&#34;udp4&#34;</span><span class="op" id="8462316">,</span>&nbsp;<span class="ident" id="8462318">la</span><span class="op" id="8462320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8462323">if</span>&nbsp;<span class="ident" id="8462326">err</span>&nbsp;<span class="op" id="8462330">!=</span>&nbsp;<span class="ident" id="8462333">nil</span>&nbsp;<span class="op" id="8462337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462341">t</span><span class="op" id="8462342">.</span><span class="ident" id="8462343">Fatalf</span><span class="op" id="8462349">(</span><span class="string" id="8462350">&#34;ListenUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8462372">,</span>&nbsp;<span class="ident" id="8462374">err</span><span class="op" id="8462377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8462380">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8462383">defer</span>&nbsp;<span class="ident" id="8462389">c</span><span class="op" id="8462390">.</span><span class="ident" id="8462391">Close</span><span class="op" id="8462396">(</span><span class="op" id="8462397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462400">c</span><span class="op" id="8462401">.</span><span class="ident" id="8462402">LocalAddr</span><span class="op" id="8462411">(</span><span class="op" id="8462412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462415">c</span><span class="op" id="8462416">.</span><span class="ident" id="8462417">RemoteAddr</span><span class="op" id="8462427">(</span><span class="op" id="8462428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462431">c</span><span class="op" id="8462432">.</span><span class="ident" id="8462433">SetDeadline</span><span class="op" id="8462444">(</span><span class="ident" id="8462445">time</span><span class="op" id="8462449">.</span><span class="ident" id="8462450">Now</span><span class="op" id="8462453">(</span><span class="op" id="8462454">)</span><span class="op" id="8462455">.</span><span class="ident" id="8462456">Add</span><span class="op" id="8462459">(</span><span class="ident" id="8462460">someTimeout</span><span class="op" id="8462471">)</span><span class="op" id="8462472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462475">c</span><span class="op" id="8462476">.</span><span class="ident" id="8462477">SetReadDeadline</span><span class="op" id="8462492">(</span><span class="ident" id="8462493">time</span><span class="op" id="8462497">.</span><span class="ident" id="8462498">Now</span><span class="op" id="8462501">(</span><span class="op" id="8462502">)</span><span class="op" id="8462503">.</span><span class="ident" id="8462504">Add</span><span class="op" id="8462507">(</span><span class="ident" id="8462508">someTimeout</span><span class="op" id="8462519">)</span><span class="op" id="8462520">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462523">c</span><span class="op" id="8462524">.</span><span class="ident" id="8462525">SetWriteDeadline</span><span class="op" id="8462541">(</span><span class="ident" id="8462542">time</span><span class="op" id="8462546">.</span><span class="ident" id="8462547">Now</span><span class="op" id="8462550">(</span><span class="op" id="8462551">)</span><span class="op" id="8462552">.</span><span class="ident" id="8462553">Add</span><span class="op" id="8462556">(</span><span class="ident" id="8462557">someTimeout</span><span class="op" id="8462568">)</span><span class="op" id="8462569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462572">c</span><span class="op" id="8462573">.</span><span class="ident" id="8462574">SetReadBuffer</span><span class="op" id="8462587">(</span><span class="num" id="8462588">2048</span><span class="op" id="8462592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462595">c</span><span class="op" id="8462596">.</span><span class="ident" id="8462597">SetWriteBuffer</span><span class="op" id="8462611">(</span><span class="num" id="8462612">2048</span><span class="op" id="8462616">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462620">wb</span>&nbsp;<span class="op" id="8462623">:=</span>&nbsp;<span class="op" id="8462626">[</span><span class="op" id="8462627">]</span><span class="builtintype" id="8462628">byte</span><span class="op" id="8462632">(</span><span class="string" id="8462633">&#34;UDPCONN&nbsp;TEST&#34;</span><span class="op" id="8462647">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462650">rb</span>&nbsp;<span class="op" id="8462653">:=</span>&nbsp;<span class="builtinfunc" id="8462656">make</span><span class="op" id="8462660">(</span><span class="op" id="8462661">[</span><span class="op" id="8462662">]</span><span class="builtintype" id="8462663">byte</span><span class="op" id="8462667">,</span>&nbsp;<span class="num" id="8462669">128</span><span class="op" id="8462672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8462675">if</span>&nbsp;<span class="ident" id="8462678">_</span><span class="op" id="8462679">,</span>&nbsp;<span class="ident" id="8462681">err</span>&nbsp;<span class="op" id="8462685">:=</span>&nbsp;<span class="ident" id="8462688">c</span><span class="op" id="8462689">.</span><span class="ident" id="8462690">WriteToUDP</span><span class="op" id="8462700">(</span><span class="ident" id="8462701">wb</span><span class="op" id="8462703">,</span>&nbsp;<span class="ident" id="8462705">c</span><span class="op" id="8462706">.</span><span class="ident" id="8462707">LocalAddr</span><span class="op" id="8462716">(</span><span class="op" id="8462717">)</span><span class="op" id="8462718">.</span><span class="op" id="8462719">(</span><span class="op" id="8462720">*</span><span class="ident" id="8462721">UDPAddr</span><span class="op" id="8462728">)</span><span class="op" id="8462729">)</span><span class="op" id="8462730">;</span>&nbsp;<span class="ident" id="8462732">err</span>&nbsp;<span class="op" id="8462736">!=</span>&nbsp;<span class="ident" id="8462739">nil</span>&nbsp;<span class="op" id="8462743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462747">t</span><span class="op" id="8462748">.</span><span class="ident" id="8462749">Fatalf</span><span class="op" id="8462755">(</span><span class="string" id="8462756">&#34;UDPConn.WriteToUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8462787">,</span>&nbsp;<span class="ident" id="8462789">err</span><span class="op" id="8462792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8462795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8462798">if</span>&nbsp;<span class="ident" id="8462801">_</span><span class="op" id="8462802">,</span>&nbsp;<span class="ident" id="8462804">_</span><span class="op" id="8462805">,</span>&nbsp;<span class="ident" id="8462807">err</span>&nbsp;<span class="op" id="8462811">:=</span>&nbsp;<span class="ident" id="8462814">c</span><span class="op" id="8462815">.</span><span class="ident" id="8462816">ReadFromUDP</span><span class="op" id="8462827">(</span><span class="ident" id="8462828">rb</span><span class="op" id="8462830">)</span><span class="op" id="8462831">;</span>&nbsp;<span class="ident" id="8462833">err</span>&nbsp;<span class="op" id="8462837">!=</span>&nbsp;<span class="ident" id="8462840">nil</span>&nbsp;<span class="op" id="8462844">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462848">t</span><span class="op" id="8462849">.</span><span class="ident" id="8462850">Fatalf</span><span class="op" id="8462856">(</span><span class="string" id="8462857">&#34;UDPConn.ReadFromUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8462889">,</span>&nbsp;<span class="ident" id="8462891">err</span><span class="op" id="8462894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8462897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8462900">if</span>&nbsp;<span class="ident" id="8462903">_</span><span class="op" id="8462904">,</span>&nbsp;<span class="ident" id="8462906">_</span><span class="op" id="8462907">,</span>&nbsp;<span class="ident" id="8462909">err</span>&nbsp;<span class="op" id="8462913">:=</span>&nbsp;<span class="ident" id="8462916">c</span><span class="op" id="8462917">.</span><span class="ident" id="8462918">WriteMsgUDP</span><span class="op" id="8462929">(</span><span class="ident" id="8462930">wb</span><span class="op" id="8462932">,</span>&nbsp;<span class="ident" id="8462934">nil</span><span class="op" id="8462937">,</span>&nbsp;<span class="ident" id="8462939">c</span><span class="op" id="8462940">.</span><span class="ident" id="8462941">LocalAddr</span><span class="op" id="8462950">(</span><span class="op" id="8462951">)</span><span class="op" id="8462952">.</span><span class="op" id="8462953">(</span><span class="op" id="8462954">*</span><span class="ident" id="8462955">UDPAddr</span><span class="op" id="8462962">)</span><span class="op" id="8462963">)</span><span class="op" id="8462964">;</span>&nbsp;<span class="ident" id="8462966">err</span>&nbsp;<span class="op" id="8462970">!=</span>&nbsp;<span class="ident" id="8462973">nil</span>&nbsp;<span class="op" id="8462977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462981">condFatalf</span><span class="op" id="8462991">(</span><span class="ident" id="8462992">t</span><span class="op" id="8462993">,</span>&nbsp;<span class="string" id="8462995">&#34;UDPConn.WriteMsgUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8463027">,</span>&nbsp;<span class="ident" id="8463029">err</span><span class="op" id="8463032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8463035">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8463038">if</span>&nbsp;<span class="ident" id="8463041">_</span><span class="op" id="8463042">,</span>&nbsp;<span class="ident" id="8463044">_</span><span class="op" id="8463045">,</span>&nbsp;<span class="ident" id="8463047">_</span><span class="op" id="8463048">,</span>&nbsp;<span class="ident" id="8463050">_</span><span class="op" id="8463051">,</span>&nbsp;<span class="ident" id="8463053">err</span>&nbsp;<span class="op" id="8463057">:=</span>&nbsp;<span class="ident" id="8463060">c</span><span class="op" id="8463061">.</span><span class="ident" id="8463062">ReadMsgUDP</span><span class="op" id="8463072">(</span><span class="ident" id="8463073">rb</span><span class="op" id="8463075">,</span>&nbsp;<span class="ident" id="8463077">nil</span><span class="op" id="8463080">)</span><span class="op" id="8463081">;</span>&nbsp;<span class="ident" id="8463083">err</span>&nbsp;<span class="op" id="8463087">!=</span>&nbsp;<span class="ident" id="8463090">nil</span>&nbsp;<span class="op" id="8463094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463098">condFatalf</span><span class="op" id="8463108">(</span><span class="ident" id="8463109">t</span><span class="op" id="8463110">,</span>&nbsp;<span class="string" id="8463112">&#34;UDPConn.ReadMsgUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8463143">,</span>&nbsp;<span class="ident" id="8463145">err</span><span class="op" id="8463148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8463151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8463155">if</span>&nbsp;<span class="ident" id="8463158">f</span><span class="op" id="8463159">,</span>&nbsp;<span class="ident" id="8463161">err</span>&nbsp;<span class="op" id="8463165">:=</span>&nbsp;<span class="ident" id="8463168">c</span><span class="op" id="8463169">.</span><span class="ident" id="8463170">File</span><span class="op" id="8463174">(</span><span class="op" id="8463175">)</span><span class="op" id="8463176">;</span>&nbsp;<span class="ident" id="8463178">err</span>&nbsp;<span class="op" id="8463182">!=</span>&nbsp;<span class="ident" id="8463185">nil</span>&nbsp;<span class="op" id="8463189">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463193">condFatalf</span><span class="op" id="8463203">(</span><span class="ident" id="8463204">t</span><span class="op" id="8463205">,</span>&nbsp;<span class="string" id="8463207">&#34;UDPConn.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8463232">,</span>&nbsp;<span class="ident" id="8463234">err</span><span class="op" id="8463237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8463240">}</span>&nbsp;<span class="keyword" id="8463242">else</span>&nbsp;<span class="op" id="8463247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463251">f</span><span class="op" id="8463252">.</span><span class="ident" id="8463253">Close</span><span class="op" id="8463258">(</span><span class="op" id="8463259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8463262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8463266">defer</span>&nbsp;<span class="keyword" id="8463272">func</span><span class="op" id="8463276">(</span><span class="op" id="8463277">)</span>&nbsp;<span class="op" id="8463279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8463283">if</span>&nbsp;<span class="ident" id="8463286">p</span>&nbsp;<span class="op" id="8463288">:=</span>&nbsp;<span class="builtinfunc" id="8463291">recover</span><span class="op" id="8463298">(</span><span class="op" id="8463299">)</span><span class="op" id="8463300">;</span>&nbsp;<span class="ident" id="8463302">p</span>&nbsp;<span class="op" id="8463304">!=</span>&nbsp;<span class="ident" id="8463307">nil</span>&nbsp;<span class="op" id="8463311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463316">t</span><span class="op" id="8463317">.</span><span class="ident" id="8463318">Fatalf</span><span class="op" id="8463324">(</span><span class="string" id="8463325">&#34;UDPConn.WriteToUDP&nbsp;or&nbsp;WriteMsgUDP&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="8463373">,</span>&nbsp;<span class="ident" id="8463375">p</span><span class="op" id="8463376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8463380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8463383">}</span><span class="op" id="8463384">(</span><span class="op" id="8463385">)</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463389">c</span><span class="op" id="8463390">.</span><span class="ident" id="8463391">WriteToUDP</span><span class="op" id="8463401">(</span><span class="ident" id="8463402">wb</span><span class="op" id="8463404">,</span>&nbsp;<span class="ident" id="8463406">nil</span><span class="op" id="8463409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463412">c</span><span class="op" id="8463413">.</span><span class="ident" id="8463414">WriteMsgUDP</span><span class="op" id="8463425">(</span><span class="ident" id="8463426">wb</span><span class="op" id="8463428">,</span>&nbsp;<span class="ident" id="8463430">nil</span><span class="op" id="8463433">,</span>&nbsp;<span class="ident" id="8463435">nil</span><span class="op" id="8463438">)</span><br>
<span class="lineno"></span><span class="op" id="8463440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="8463443">func</span>&nbsp;<span class="ident" id="8463448">TestIPConnSpecificMethods</span><span class="op" id="8463473">(</span><span class="ident" id="8463474">t</span>&nbsp;<span class="op" id="8463476">*</span><span class="ident" id="8463477">testing</span><span class="op" id="8463484">.</span><span class="ident" id="8463485">T</span><span class="op" id="8463486">)</span>&nbsp;<span class="op" id="8463488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8463491">if</span>&nbsp;<span class="ident" id="8463494">skip</span><span class="op" id="8463498">,</span>&nbsp;<span class="ident" id="8463500">skipmsg</span>&nbsp;<span class="op" id="8463508">:=</span>&nbsp;<span class="ident" id="8463511">skipRawSocketTest</span><span class="op" id="8463528">(</span><span class="ident" id="8463529">t</span><span class="op" id="8463530">)</span><span class="op" id="8463531">;</span>&nbsp;<span class="ident" id="8463533">skip</span>&nbsp;<span class="op" id="8463538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463542">t</span><span class="op" id="8463543">.</span><span class="ident" id="8463544">Skip</span><span class="op" id="8463548">(</span><span class="ident" id="8463549">skipmsg</span><span class="op" id="8463556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8463559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463563">la</span><span class="op" id="8463565">,</span>&nbsp;<span class="ident" id="8463567">err</span>&nbsp;<span class="op" id="8463571">:=</span>&nbsp;<span class="ident" id="8463574">ResolveIPAddr</span><span class="op" id="8463587">(</span><span class="string" id="8463588">&#34;ip4&#34;</span><span class="op" id="8463593">,</span>&nbsp;<span class="string" id="8463595">&#34;127.0.0.1&#34;</span><span class="op" id="8463606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8463609">if</span>&nbsp;<span class="ident" id="8463612">err</span>&nbsp;<span class="op" id="8463616">!=</span>&nbsp;<span class="ident" id="8463619">nil</span>&nbsp;<span class="op" id="8463623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463627">t</span><span class="op" id="8463628">.</span><span class="ident" id="8463629">Fatalf</span><span class="op" id="8463635">(</span><span class="string" id="8463636">&#34;ResolveIPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8463662">,</span>&nbsp;<span class="ident" id="8463664">err</span><span class="op" id="8463667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8463670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463673">c</span><span class="op" id="8463674">,</span>&nbsp;<span class="ident" id="8463676">err</span>&nbsp;<span class="op" id="8463680">:=</span>&nbsp;<span class="ident" id="8463683">ListenIP</span><span class="op" id="8463691">(</span><span class="string" id="8463692">&#34;ip4:icmp&#34;</span><span class="op" id="8463702">,</span>&nbsp;<span class="ident" id="8463704">la</span><span class="op" id="8463706">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8463709">if</span>&nbsp;<span class="ident" id="8463712">err</span>&nbsp;<span class="op" id="8463716">!=</span>&nbsp;<span class="ident" id="8463719">nil</span>&nbsp;<span class="op" id="8463723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463727">t</span><span class="op" id="8463728">.</span><span class="ident" id="8463729">Fatalf</span><span class="op" id="8463735">(</span><span class="string" id="8463736">&#34;ListenIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8463757">,</span>&nbsp;<span class="ident" id="8463759">err</span><span class="op" id="8463762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8463765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8463768">defer</span>&nbsp;<span class="ident" id="8463774">c</span><span class="op" id="8463775">.</span><span class="ident" id="8463776">Close</span><span class="op" id="8463781">(</span><span class="op" id="8463782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463785">c</span><span class="op" id="8463786">.</span><span class="ident" id="8463787">LocalAddr</span><span class="op" id="8463796">(</span><span class="op" id="8463797">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463800">c</span><span class="op" id="8463801">.</span><span class="ident" id="8463802">RemoteAddr</span><span class="op" id="8463812">(</span><span class="op" id="8463813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463816">c</span><span class="op" id="8463817">.</span><span class="ident" id="8463818">SetDeadline</span><span class="op" id="8463829">(</span><span class="ident" id="8463830">time</span><span class="op" id="8463834">.</span><span class="ident" id="8463835">Now</span><span class="op" id="8463838">(</span><span class="op" id="8463839">)</span><span class="op" id="8463840">.</span><span class="ident" id="8463841">Add</span><span class="op" id="8463844">(</span><span class="ident" id="8463845">someTimeout</span><span class="op" id="8463856">)</span><span class="op" id="8463857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463860">c</span><span class="op" id="8463861">.</span><span class="ident" id="8463862">SetReadDeadline</span><span class="op" id="8463877">(</span><span class="ident" id="8463878">time</span><span class="op" id="8463882">.</span><span class="ident" id="8463883">Now</span><span class="op" id="8463886">(</span><span class="op" id="8463887">)</span><span class="op" id="8463888">.</span><span class="ident" id="8463889">Add</span><span class="op" id="8463892">(</span><span class="ident" id="8463893">someTimeout</span><span class="op" id="8463904">)</span><span class="op" id="8463905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463908">c</span><span class="op" id="8463909">.</span><span class="ident" id="8463910">SetWriteDeadline</span><span class="op" id="8463926">(</span><span class="ident" id="8463927">time</span><span class="op" id="8463931">.</span><span class="ident" id="8463932">Now</span><span class="op" id="8463935">(</span><span class="op" id="8463936">)</span><span class="op" id="8463937">.</span><span class="ident" id="8463938">Add</span><span class="op" id="8463941">(</span><span class="ident" id="8463942">someTimeout</span><span class="op" id="8463953">)</span><span class="op" id="8463954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463957">c</span><span class="op" id="8463958">.</span><span class="ident" id="8463959">SetReadBuffer</span><span class="op" id="8463972">(</span><span class="num" id="8463973">2048</span><span class="op" id="8463977">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463980">c</span><span class="op" id="8463981">.</span><span class="ident" id="8463982">SetWriteBuffer</span><span class="op" id="8463996">(</span><span class="num" id="8463997">2048</span><span class="op" id="8464001">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464005">wb</span><span class="op" id="8464007">,</span>&nbsp;<span class="ident" id="8464009">err</span>&nbsp;<span class="op" id="8464013">:=</span>&nbsp;<span class="op" id="8464016">(</span><span class="op" id="8464017">&amp;</span><span class="ident" id="8464018">icmpMessage</span><span class="op" id="8464029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464033">Type</span><span class="op" id="8464037">:</span>&nbsp;<span class="ident" id="8464039">icmpv4EchoRequest</span><span class="op" id="8464056">,</span>&nbsp;<span class="ident" id="8464058">Code</span><span class="op" id="8464062">:</span>&nbsp;<span class="num" id="8464064">0</span><span class="op" id="8464065">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464069">Body</span><span class="op" id="8464073">:</span>&nbsp;<span class="op" id="8464075">&amp;</span><span class="ident" id="8464076">icmpEcho</span><span class="op" id="8464084">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464089">ID</span><span class="op" id="8464091">:</span>&nbsp;<span class="ident" id="8464093">os</span><span class="op" id="8464095">.</span><span class="ident" id="8464096">Getpid</span><span class="op" id="8464102">(</span><span class="op" id="8464103">)</span>&nbsp;<span class="op" id="8464105">&amp;</span>&nbsp;<span class="num" id="8464107">0xffff</span><span class="op" id="8464113">,</span>&nbsp;<span class="ident" id="8464115">Seq</span><span class="op" id="8464118">:</span>&nbsp;<span class="num" id="8464120">1</span><span class="op" id="8464121">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464126">Data</span><span class="op" id="8464130">:</span>&nbsp;<span class="op" id="8464132">[</span><span class="op" id="8464133">]</span><span class="builtintype" id="8464134">byte</span><span class="op" id="8464138">(</span><span class="string" id="8464139">&#34;IPCONN&nbsp;TEST&nbsp;&#34;</span><span class="op" id="8464153">)</span><span class="op" id="8464154">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8464158">}</span><span class="op" id="8464159">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8464162">}</span><span class="op" id="8464163">)</span><span class="op" id="8464164">.</span><span class="ident" id="8464165">Marshal</span><span class="op" id="8464172">(</span><span class="op" id="8464173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8464176">if</span>&nbsp;<span class="ident" id="8464179">err</span>&nbsp;<span class="op" id="8464183">!=</span>&nbsp;<span class="ident" id="8464186">nil</span>&nbsp;<span class="op" id="8464190">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464194">t</span><span class="op" id="8464195">.</span><span class="ident" id="8464196">Fatalf</span><span class="op" id="8464202">(</span><span class="string" id="8464203">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8464235">,</span>&nbsp;<span class="ident" id="8464237">err</span><span class="op" id="8464240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8464243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464246">rb</span>&nbsp;<span class="op" id="8464249">:=</span>&nbsp;<span class="builtinfunc" id="8464252">make</span><span class="op" id="8464256">(</span><span class="op" id="8464257">[</span><span class="op" id="8464258">]</span><span class="builtintype" id="8464259">byte</span><span class="op" id="8464263">,</span>&nbsp;<span class="num" id="8464265">20</span><span class="op" id="8464267">+</span><span class="builtinfunc" id="8464268">len</span><span class="op" id="8464271">(</span><span class="ident" id="8464272">wb</span><span class="op" id="8464274">)</span><span class="op" id="8464275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8464278">if</span>&nbsp;<span class="ident" id="8464281">_</span><span class="op" id="8464282">,</span>&nbsp;<span class="ident" id="8464284">err</span>&nbsp;<span class="op" id="8464288">:=</span>&nbsp;<span class="ident" id="8464291">c</span><span class="op" id="8464292">.</span><span class="ident" id="8464293">WriteToIP</span><span class="op" id="8464302">(</span><span class="ident" id="8464303">wb</span><span class="op" id="8464305">,</span>&nbsp;<span class="ident" id="8464307">c</span><span class="op" id="8464308">.</span><span class="ident" id="8464309">LocalAddr</span><span class="op" id="8464318">(</span><span class="op" id="8464319">)</span><span class="op" id="8464320">.</span><span class="op" id="8464321">(</span><span class="op" id="8464322">*</span><span class="ident" id="8464323">IPAddr</span><span class="op" id="8464329">)</span><span class="op" id="8464330">)</span><span class="op" id="8464331">;</span>&nbsp;<span class="ident" id="8464333">err</span>&nbsp;<span class="op" id="8464337">!=</span>&nbsp;<span class="ident" id="8464340">nil</span>&nbsp;<span class="op" id="8464344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464348">t</span><span class="op" id="8464349">.</span><span class="ident" id="8464350">Fatalf</span><span class="op" id="8464356">(</span><span class="string" id="8464357">&#34;IPConn.WriteToIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8464386">,</span>&nbsp;<span class="ident" id="8464388">err</span><span class="op" id="8464391">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8464394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8464397">if</span>&nbsp;<span class="ident" id="8464400">_</span><span class="op" id="8464401">,</span>&nbsp;<span class="ident" id="8464403">_</span><span class="op" id="8464404">,</span>&nbsp;<span class="ident" id="8464406">err</span>&nbsp;<span class="op" id="8464410">:=</span>&nbsp;<span class="ident" id="8464413">c</span><span class="op" id="8464414">.</span><span class="ident" id="8464415">ReadFromIP</span><span class="op" id="8464425">(</span><span class="ident" id="8464426">rb</span><span class="op" id="8464428">)</span><span class="op" id="8464429">;</span>&nbsp;<span class="ident" id="8464431">err</span>&nbsp;<span class="op" id="8464435">!=</span>&nbsp;<span class="ident" id="8464438">nil</span>&nbsp;<span class="op" id="8464442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464446">t</span><span class="op" id="8464447">.</span><span class="ident" id="8464448">Fatalf</span><span class="op" id="8464454">(</span><span class="string" id="8464455">&#34;IPConn.ReadFromIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8464485">,</span>&nbsp;<span class="ident" id="8464487">err</span><span class="op" id="8464490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8464493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8464496">if</span>&nbsp;<span class="ident" id="8464499">_</span><span class="op" id="8464500">,</span>&nbsp;<span class="ident" id="8464502">_</span><span class="op" id="8464503">,</span>&nbsp;<span class="ident" id="8464505">err</span>&nbsp;<span class="op" id="8464509">:=</span>&nbsp;<span class="ident" id="8464512">c</span><span class="op" id="8464513">.</span><span class="ident" id="8464514">WriteMsgIP</span><span class="op" id="8464524">(</span><span class="ident" id="8464525">wb</span><span class="op" id="8464527">,</span>&nbsp;<span class="ident" id="8464529">nil</span><span class="op" id="8464532">,</span>&nbsp;<span class="ident" id="8464534">c</span><span class="op" id="8464535">.</span><span class="ident" id="8464536">LocalAddr</span><span class="op" id="8464545">(</span><span class="op" id="8464546">)</span><span class="op" id="8464547">.</span><span class="op" id="8464548">(</span><span class="op" id="8464549">*</span><span class="ident" id="8464550">IPAddr</span><span class="op" id="8464556">)</span><span class="op" id="8464557">)</span><span class="op" id="8464558">;</span>&nbsp;<span class="ident" id="8464560">err</span>&nbsp;<span class="op" id="8464564">!=</span>&nbsp;<span class="ident" id="8464567">nil</span>&nbsp;<span class="op" id="8464571">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464575">condFatalf</span><span class="op" id="8464585">(</span><span class="ident" id="8464586">t</span><span class="op" id="8464587">,</span>&nbsp;<span class="string" id="8464589">&#34;IPConn.WriteMsgIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8464619">,</span>&nbsp;<span class="ident" id="8464621">err</span><span class="op" id="8464624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8464627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8464630">if</span>&nbsp;<span class="ident" id="8464633">_</span><span class="op" id="8464634">,</span>&nbsp;<span class="ident" id="8464636">_</span><span class="op" id="8464637">,</span>&nbsp;<span class="ident" id="8464639">_</span><span class="op" id="8464640">,</span>&nbsp;<span class="ident" id="8464642">_</span><span class="op" id="8464643">,</span>&nbsp;<span class="ident" id="8464645">err</span>&nbsp;<span class="op" id="8464649">:=</span>&nbsp;<span class="ident" id="8464652">c</span><span class="op" id="8464653">.</span><span class="ident" id="8464654">ReadMsgIP</span><span class="op" id="8464663">(</span><span class="ident" id="8464664">rb</span><span class="op" id="8464666">,</span>&nbsp;<span class="ident" id="8464668">nil</span><span class="op" id="8464671">)</span><span class="op" id="8464672">;</span>&nbsp;<span class="ident" id="8464674">err</span>&nbsp;<span class="op" id="8464678">!=</span>&nbsp;<span class="ident" id="8464681">nil</span>&nbsp;<span class="op" id="8464685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464689">condFatalf</span><span class="op" id="8464699">(</span><span class="ident" id="8464700">t</span><span class="op" id="8464701">,</span>&nbsp;<span class="string" id="8464703">&#34;IPConn.ReadMsgIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8464732">,</span>&nbsp;<span class="ident" id="8464734">err</span><span class="op" id="8464737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8464740">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8464744">if</span>&nbsp;<span class="ident" id="8464747">f</span><span class="op" id="8464748">,</span>&nbsp;<span class="ident" id="8464750">err</span>&nbsp;<span class="op" id="8464754">:=</span>&nbsp;<span class="ident" id="8464757">c</span><span class="op" id="8464758">.</span><span class="ident" id="8464759">File</span><span class="op" id="8464763">(</span><span class="op" id="8464764">)</span><span class="op" id="8464765">;</span>&nbsp;<span class="ident" id="8464767">err</span>&nbsp;<span class="op" id="8464771">!=</span>&nbsp;<span class="ident" id="8464774">nil</span>&nbsp;<span class="op" id="8464778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464782">condFatalf</span><span class="op" id="8464792">(</span><span class="ident" id="8464793">t</span><span class="op" id="8464794">,</span>&nbsp;<span class="string" id="8464796">&#34;IPConn.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8464820">,</span>&nbsp;<span class="ident" id="8464822">err</span><span class="op" id="8464825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8464828">}</span>&nbsp;<span class="keyword" id="8464830">else</span>&nbsp;<span class="op" id="8464835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464839">f</span><span class="op" id="8464840">.</span><span class="ident" id="8464841">Close</span><span class="op" id="8464846">(</span><span class="op" id="8464847">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8464850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8464854">defer</span>&nbsp;<span class="keyword" id="8464860">func</span><span class="op" id="8464864">(</span><span class="op" id="8464865">)</span>&nbsp;<span class="op" id="8464867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8464871">if</span>&nbsp;<span class="ident" id="8464874">p</span>&nbsp;<span class="op" id="8464876">:=</span>&nbsp;<span class="builtinfunc" id="8464879">recover</span><span class="op" id="8464886">(</span><span class="op" id="8464887">)</span><span class="op" id="8464888">;</span>&nbsp;<span class="ident" id="8464890">p</span>&nbsp;<span class="op" id="8464892">!=</span>&nbsp;<span class="ident" id="8464895">nil</span>&nbsp;<span class="op" id="8464899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464904">t</span><span class="op" id="8464905">.</span><span class="ident" id="8464906">Fatalf</span><span class="op" id="8464912">(</span><span class="string" id="8464913">&#34;IPConn.WriteToIP&nbsp;or&nbsp;WriteMsgIP&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="8464958">,</span>&nbsp;<span class="ident" id="8464960">p</span><span class="op" id="8464961">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8464965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8464968">}</span><span class="op" id="8464969">(</span><span class="op" id="8464970">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464974">c</span><span class="op" id="8464975">.</span><span class="ident" id="8464976">WriteToIP</span><span class="op" id="8464985">(</span><span class="ident" id="8464986">wb</span><span class="op" id="8464988">,</span>&nbsp;<span class="ident" id="8464990">nil</span><span class="op" id="8464993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464996">c</span><span class="op" id="8464997">.</span><span class="ident" id="8464998">WriteMsgIP</span><span class="op" id="8465008">(</span><span class="ident" id="8465009">wb</span><span class="op" id="8465011">,</span>&nbsp;<span class="ident" id="8465013">nil</span><span class="op" id="8465016">,</span>&nbsp;<span class="ident" id="8465018">nil</span><span class="op" id="8465021">)</span><br>
<span class="lineno">235</span><span class="op" id="8465023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8465026">func</span>&nbsp;<span class="ident" id="8465031">TestUnixListenerSpecificMethods</span><span class="op" id="8465062">(</span><span class="ident" id="8465063">t</span>&nbsp;<span class="op" id="8465065">*</span><span class="ident" id="8465066">testing</span><span class="op" id="8465073">.</span><span class="ident" id="8465074">T</span><span class="op" id="8465075">)</span>&nbsp;<span class="op" id="8465077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8465080">switch</span>&nbsp;<span class="ident" id="8465087">runtime</span><span class="op" id="8465094">.</span><span class="ident" id="8465095">GOOS</span>&nbsp;<span class="op" id="8465100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8465103">case</span>&nbsp;<span class="string" id="8465108">&#34;nacl&#34;</span><span class="op" id="8465114">,</span>&nbsp;<span class="string" id="8465116">&#34;plan9&#34;</span><span class="op" id="8465123">,</span>&nbsp;<span class="string" id="8465125">&#34;windows&#34;</span><span class="op" id="8465134">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465138">t</span><span class="op" id="8465139">.</span><span class="ident" id="8465140">Skipf</span><span class="op" id="8465145">(</span><span class="string" id="8465146">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8465167">,</span>&nbsp;<span class="ident" id="8465169">runtime</span><span class="op" id="8465176">.</span><span class="ident" id="8465177">GOOS</span><span class="op" id="8465181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8465184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465188">addr</span>&nbsp;<span class="op" id="8465193">:=</span>&nbsp;<span class="ident" id="8465196">testUnixAddr</span><span class="op" id="8465208">(</span><span class="op" id="8465209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465212">la</span><span class="op" id="8465214">,</span>&nbsp;<span class="ident" id="8465216">err</span>&nbsp;<span class="op" id="8465220">:=</span>&nbsp;<span class="ident" id="8465223">ResolveUnixAddr</span><span class="op" id="8465238">(</span><span class="string" id="8465239">&#34;unix&#34;</span><span class="op" id="8465245">,</span>&nbsp;<span class="ident" id="8465247">addr</span><span class="op" id="8465251">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8465254">if</span>&nbsp;<span class="ident" id="8465257">err</span>&nbsp;<span class="op" id="8465261">!=</span>&nbsp;<span class="ident" id="8465264">nil</span>&nbsp;<span class="op" id="8465268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465272">t</span><span class="op" id="8465273">.</span><span class="ident" id="8465274">Fatalf</span><span class="op" id="8465280">(</span><span class="string" id="8465281">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8465309">,</span>&nbsp;<span class="ident" id="8465311">err</span><span class="op" id="8465314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8465317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465320">ln</span><span class="op" id="8465322">,</span>&nbsp;<span class="ident" id="8465324">err</span>&nbsp;<span class="op" id="8465328">:=</span>&nbsp;<span class="ident" id="8465331">ListenUnix</span><span class="op" id="8465341">(</span><span class="string" id="8465342">&#34;unix&#34;</span><span class="op" id="8465348">,</span>&nbsp;<span class="ident" id="8465350">la</span><span class="op" id="8465352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8465355">if</span>&nbsp;<span class="ident" id="8465358">err</span>&nbsp;<span class="op" id="8465362">!=</span>&nbsp;<span class="ident" id="8465365">nil</span>&nbsp;<span class="op" id="8465369">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465373">t</span><span class="op" id="8465374">.</span><span class="ident" id="8465375">Fatalf</span><span class="op" id="8465381">(</span><span class="string" id="8465382">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8465405">,</span>&nbsp;<span class="ident" id="8465407">err</span><span class="op" id="8465410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8465413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8465416">defer</span>&nbsp;<span class="ident" id="8465422">ln</span><span class="op" id="8465424">.</span><span class="ident" id="8465425">Close</span><span class="op" id="8465430">(</span><span class="op" id="8465431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8465434">defer</span>&nbsp;<span class="ident" id="8465440">os</span><span class="op" id="8465442">.</span><span class="ident" id="8465443">Remove</span><span class="op" id="8465449">(</span><span class="ident" id="8465450">addr</span><span class="op" id="8465454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465457">ln</span><span class="op" id="8465459">.</span><span class="ident" id="8465460">Addr</span><span class="op" id="8465464">(</span><span class="op" id="8465465">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465468">ln</span><span class="op" id="8465470">.</span><span class="ident" id="8465471">SetDeadline</span><span class="op" id="8465482">(</span><span class="ident" id="8465483">time</span><span class="op" id="8465487">.</span><span class="ident" id="8465488">Now</span><span class="op" id="8465491">(</span><span class="op" id="8465492">)</span><span class="op" id="8465493">.</span><span class="ident" id="8465494">Add</span><span class="op" id="8465497">(</span><span class="num" id="8465498">30</span>&nbsp;<span class="op" id="8465501">*</span>&nbsp;<span class="ident" id="8465503">time</span><span class="op" id="8465507">.</span><span class="ident" id="8465508">Nanosecond</span><span class="op" id="8465518">)</span><span class="op" id="8465519">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8465523">if</span>&nbsp;<span class="ident" id="8465526">c</span><span class="op" id="8465527">,</span>&nbsp;<span class="ident" id="8465529">err</span>&nbsp;<span class="op" id="8465533">:=</span>&nbsp;<span class="ident" id="8465536">ln</span><span class="op" id="8465538">.</span><span class="ident" id="8465539">Accept</span><span class="op" id="8465545">(</span><span class="op" id="8465546">)</span><span class="op" id="8465547">;</span>&nbsp;<span class="ident" id="8465549">err</span>&nbsp;<span class="op" id="8465553">!=</span>&nbsp;<span class="ident" id="8465556">nil</span>&nbsp;<span class="op" id="8465560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8465564">if</span>&nbsp;<span class="op" id="8465567">!</span><span class="ident" id="8465568">err</span><span class="op" id="8465571">.</span><span class="op" id="8465572">(</span><span class="ident" id="8465573">Error</span><span class="op" id="8465578">)</span><span class="op" id="8465579">.</span><span class="ident" id="8465580">Timeout</span><span class="op" id="8465587">(</span><span class="op" id="8465588">)</span>&nbsp;<span class="op" id="8465590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465595">t</span><span class="op" id="8465596">.</span><span class="ident" id="8465597">Fatalf</span><span class="op" id="8465603">(</span><span class="string" id="8465604">&#34;UnixListener.Accept&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8465636">,</span>&nbsp;<span class="ident" id="8465638">err</span><span class="op" id="8465641">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8465645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8465648">}</span>&nbsp;<span class="keyword" id="8465650">else</span>&nbsp;<span class="op" id="8465655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465659">c</span><span class="op" id="8465660">.</span><span class="ident" id="8465661">Close</span><span class="op" id="8465666">(</span><span class="op" id="8465667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8465670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8465673">if</span>&nbsp;<span class="ident" id="8465676">c</span><span class="op" id="8465677">,</span>&nbsp;<span class="ident" id="8465679">err</span>&nbsp;<span class="op" id="8465683">:=</span>&nbsp;<span class="ident" id="8465686">ln</span><span class="op" id="8465688">.</span><span class="ident" id="8465689">AcceptUnix</span><span class="op" id="8465699">(</span><span class="op" id="8465700">)</span><span class="op" id="8465701">;</span>&nbsp;<span class="ident" id="8465703">err</span>&nbsp;<span class="op" id="8465707">!=</span>&nbsp;<span class="ident" id="8465710">nil</span>&nbsp;<span class="op" id="8465714">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8465718">if</span>&nbsp;<span class="op" id="8465721">!</span><span class="ident" id="8465722">err</span><span class="op" id="8465725">.</span><span class="op" id="8465726">(</span><span class="ident" id="8465727">Error</span><span class="op" id="8465732">)</span><span class="op" id="8465733">.</span><span class="ident" id="8465734">Timeout</span><span class="op" id="8465741">(</span><span class="op" id="8465742">)</span>&nbsp;<span class="op" id="8465744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465749">t</span><span class="op" id="8465750">.</span><span class="ident" id="8465751">Fatalf</span><span class="op" id="8465757">(</span><span class="string" id="8465758">&#34;UnixListener.AcceptUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8465794">,</span>&nbsp;<span class="ident" id="8465796">err</span><span class="op" id="8465799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8465803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8465806">}</span>&nbsp;<span class="keyword" id="8465808">else</span>&nbsp;<span class="op" id="8465813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465817">c</span><span class="op" id="8465818">.</span><span class="ident" id="8465819">Close</span><span class="op" id="8465824">(</span><span class="op" id="8465825">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8465828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8465832">if</span>&nbsp;<span class="ident" id="8465835">f</span><span class="op" id="8465836">,</span>&nbsp;<span class="ident" id="8465838">err</span>&nbsp;<span class="op" id="8465842">:=</span>&nbsp;<span class="ident" id="8465845">ln</span><span class="op" id="8465847">.</span><span class="ident" id="8465848">File</span><span class="op" id="8465852">(</span><span class="op" id="8465853">)</span><span class="op" id="8465854">;</span>&nbsp;<span class="ident" id="8465856">err</span>&nbsp;<span class="op" id="8465860">!=</span>&nbsp;<span class="ident" id="8465863">nil</span>&nbsp;<span class="op" id="8465867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465871">t</span><span class="op" id="8465872">.</span><span class="ident" id="8465873">Fatalf</span><span class="op" id="8465879">(</span><span class="string" id="8465880">&#34;UnixListener.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8465910">,</span>&nbsp;<span class="ident" id="8465912">err</span><span class="op" id="8465915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8465918">}</span>&nbsp;<span class="keyword" id="8465920">else</span>&nbsp;<span class="op" id="8465925">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465929">f</span><span class="op" id="8465930">.</span><span class="ident" id="8465931">Close</span><span class="op" id="8465936">(</span><span class="op" id="8465937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8465940">}</span><br>
<span class="lineno"></span><span class="op" id="8465942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8465945">func</span>&nbsp;<span class="ident" id="8465950">TestUnixConnSpecificMethods</span><span class="op" id="8465977">(</span><span class="ident" id="8465978">t</span>&nbsp;<span class="op" id="8465980">*</span><span class="ident" id="8465981">testing</span><span class="op" id="8465988">.</span><span class="ident" id="8465989">T</span><span class="op" id="8465990">)</span>&nbsp;<span class="op" id="8465992">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8465995">switch</span>&nbsp;<span class="ident" id="8466002">runtime</span><span class="op" id="8466009">.</span><span class="ident" id="8466010">GOOS</span>&nbsp;<span class="op" id="8466015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466018">case</span>&nbsp;<span class="string" id="8466023">&#34;nacl&#34;</span><span class="op" id="8466029">,</span>&nbsp;<span class="string" id="8466031">&#34;plan9&#34;</span><span class="op" id="8466038">,</span>&nbsp;<span class="string" id="8466040">&#34;windows&#34;</span><span class="op" id="8466049">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466053">t</span><span class="op" id="8466054">.</span><span class="ident" id="8466055">Skipf</span><span class="op" id="8466060">(</span><span class="string" id="8466061">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8466082">,</span>&nbsp;<span class="ident" id="8466084">runtime</span><span class="op" id="8466091">.</span><span class="ident" id="8466092">GOOS</span><span class="op" id="8466096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8466099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466103">addr1</span><span class="op" id="8466108">,</span>&nbsp;<span class="ident" id="8466110">addr2</span><span class="op" id="8466115">,</span>&nbsp;<span class="ident" id="8466117">addr3</span>&nbsp;<span class="op" id="8466123">:=</span>&nbsp;<span class="ident" id="8466126">testUnixAddr</span><span class="op" id="8466138">(</span><span class="op" id="8466139">)</span><span class="op" id="8466140">,</span>&nbsp;<span class="ident" id="8466142">testUnixAddr</span><span class="op" id="8466154">(</span><span class="op" id="8466155">)</span><span class="op" id="8466156">,</span>&nbsp;<span class="ident" id="8466158">testUnixAddr</span><span class="op" id="8466170">(</span><span class="op" id="8466171">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466175">a1</span><span class="op" id="8466177">,</span>&nbsp;<span class="ident" id="8466179">err</span>&nbsp;<span class="op" id="8466183">:=</span>&nbsp;<span class="ident" id="8466186">ResolveUnixAddr</span><span class="op" id="8466201">(</span><span class="string" id="8466202">&#34;unixgram&#34;</span><span class="op" id="8466212">,</span>&nbsp;<span class="ident" id="8466214">addr1</span><span class="op" id="8466219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466222">if</span>&nbsp;<span class="ident" id="8466225">err</span>&nbsp;<span class="op" id="8466229">!=</span>&nbsp;<span class="ident" id="8466232">nil</span>&nbsp;<span class="op" id="8466236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466240">t</span><span class="op" id="8466241">.</span><span class="ident" id="8466242">Fatalf</span><span class="op" id="8466248">(</span><span class="string" id="8466249">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8466277">,</span>&nbsp;<span class="ident" id="8466279">err</span><span class="op" id="8466282">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8466285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466288">c1</span><span class="op" id="8466290">,</span>&nbsp;<span class="ident" id="8466292">err</span>&nbsp;<span class="op" id="8466296">:=</span>&nbsp;<span class="ident" id="8466299">DialUnix</span><span class="op" id="8466307">(</span><span class="string" id="8466308">&#34;unixgram&#34;</span><span class="op" id="8466318">,</span>&nbsp;<span class="ident" id="8466320">a1</span><span class="op" id="8466322">,</span>&nbsp;<span class="ident" id="8466324">nil</span><span class="op" id="8466327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466330">if</span>&nbsp;<span class="ident" id="8466333">err</span>&nbsp;<span class="op" id="8466337">!=</span>&nbsp;<span class="ident" id="8466340">nil</span>&nbsp;<span class="op" id="8466344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466348">t</span><span class="op" id="8466349">.</span><span class="ident" id="8466350">Fatalf</span><span class="op" id="8466356">(</span><span class="string" id="8466357">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8466378">,</span>&nbsp;<span class="ident" id="8466380">err</span><span class="op" id="8466383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8466386">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466389">defer</span>&nbsp;<span class="ident" id="8466395">c1</span><span class="op" id="8466397">.</span><span class="ident" id="8466398">Close</span><span class="op" id="8466403">(</span><span class="op" id="8466404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466407">defer</span>&nbsp;<span class="ident" id="8466413">os</span><span class="op" id="8466415">.</span><span class="ident" id="8466416">Remove</span><span class="op" id="8466422">(</span><span class="ident" id="8466423">addr1</span><span class="op" id="8466428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466431">c1</span><span class="op" id="8466433">.</span><span class="ident" id="8466434">LocalAddr</span><span class="op" id="8466443">(</span><span class="op" id="8466444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466447">c1</span><span class="op" id="8466449">.</span><span class="ident" id="8466450">RemoteAddr</span><span class="op" id="8466460">(</span><span class="op" id="8466461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466464">c1</span><span class="op" id="8466466">.</span><span class="ident" id="8466467">SetDeadline</span><span class="op" id="8466478">(</span><span class="ident" id="8466479">time</span><span class="op" id="8466483">.</span><span class="ident" id="8466484">Now</span><span class="op" id="8466487">(</span><span class="op" id="8466488">)</span><span class="op" id="8466489">.</span><span class="ident" id="8466490">Add</span><span class="op" id="8466493">(</span><span class="ident" id="8466494">someTimeout</span><span class="op" id="8466505">)</span><span class="op" id="8466506">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466509">c1</span><span class="op" id="8466511">.</span><span class="ident" id="8466512">SetReadDeadline</span><span class="op" id="8466527">(</span><span class="ident" id="8466528">time</span><span class="op" id="8466532">.</span><span class="ident" id="8466533">Now</span><span class="op" id="8466536">(</span><span class="op" id="8466537">)</span><span class="op" id="8466538">.</span><span class="ident" id="8466539">Add</span><span class="op" id="8466542">(</span><span class="ident" id="8466543">someTimeout</span><span class="op" id="8466554">)</span><span class="op" id="8466555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466558">c1</span><span class="op" id="8466560">.</span><span class="ident" id="8466561">SetWriteDeadline</span><span class="op" id="8466577">(</span><span class="ident" id="8466578">time</span><span class="op" id="8466582">.</span><span class="ident" id="8466583">Now</span><span class="op" id="8466586">(</span><span class="op" id="8466587">)</span><span class="op" id="8466588">.</span><span class="ident" id="8466589">Add</span><span class="op" id="8466592">(</span><span class="ident" id="8466593">someTimeout</span><span class="op" id="8466604">)</span><span class="op" id="8466605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466608">c1</span><span class="op" id="8466610">.</span><span class="ident" id="8466611">SetReadBuffer</span><span class="op" id="8466624">(</span><span class="num" id="8466625">2048</span><span class="op" id="8466629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466632">c1</span><span class="op" id="8466634">.</span><span class="ident" id="8466635">SetWriteBuffer</span><span class="op" id="8466649">(</span><span class="num" id="8466650">2048</span><span class="op" id="8466654">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466658">a2</span><span class="op" id="8466660">,</span>&nbsp;<span class="ident" id="8466662">err</span>&nbsp;<span class="op" id="8466666">:=</span>&nbsp;<span class="ident" id="8466669">ResolveUnixAddr</span><span class="op" id="8466684">(</span><span class="string" id="8466685">&#34;unixgram&#34;</span><span class="op" id="8466695">,</span>&nbsp;<span class="ident" id="8466697">addr2</span><span class="op" id="8466702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466705">if</span>&nbsp;<span class="ident" id="8466708">err</span>&nbsp;<span class="op" id="8466712">!=</span>&nbsp;<span class="ident" id="8466715">nil</span>&nbsp;<span class="op" id="8466719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466723">t</span><span class="op" id="8466724">.</span><span class="ident" id="8466725">Fatalf</span><span class="op" id="8466731">(</span><span class="string" id="8466732">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8466760">,</span>&nbsp;<span class="ident" id="8466762">err</span><span class="op" id="8466765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8466768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466771">c2</span><span class="op" id="8466773">,</span>&nbsp;<span class="ident" id="8466775">err</span>&nbsp;<span class="op" id="8466779">:=</span>&nbsp;<span class="ident" id="8466782">DialUnix</span><span class="op" id="8466790">(</span><span class="string" id="8466791">&#34;unixgram&#34;</span><span class="op" id="8466801">,</span>&nbsp;<span class="ident" id="8466803">a2</span><span class="op" id="8466805">,</span>&nbsp;<span class="ident" id="8466807">nil</span><span class="op" id="8466810">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466813">if</span>&nbsp;<span class="ident" id="8466816">err</span>&nbsp;<span class="op" id="8466820">!=</span>&nbsp;<span class="ident" id="8466823">nil</span>&nbsp;<span class="op" id="8466827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466831">t</span><span class="op" id="8466832">.</span><span class="ident" id="8466833">Fatalf</span><span class="op" id="8466839">(</span><span class="string" id="8466840">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8466861">,</span>&nbsp;<span class="ident" id="8466863">err</span><span class="op" id="8466866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8466869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466872">defer</span>&nbsp;<span class="ident" id="8466878">c2</span><span class="op" id="8466880">.</span><span class="ident" id="8466881">Close</span><span class="op" id="8466886">(</span><span class="op" id="8466887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466890">defer</span>&nbsp;<span class="ident" id="8466896">os</span><span class="op" id="8466898">.</span><span class="ident" id="8466899">Remove</span><span class="op" id="8466905">(</span><span class="ident" id="8466906">addr2</span><span class="op" id="8466911">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466914">c2</span><span class="op" id="8466916">.</span><span class="ident" id="8466917">LocalAddr</span><span class="op" id="8466926">(</span><span class="op" id="8466927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466930">c2</span><span class="op" id="8466932">.</span><span class="ident" id="8466933">RemoteAddr</span><span class="op" id="8466943">(</span><span class="op" id="8466944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466947">c2</span><span class="op" id="8466949">.</span><span class="ident" id="8466950">SetDeadline</span><span class="op" id="8466961">(</span><span class="ident" id="8466962">time</span><span class="op" id="8466966">.</span><span class="ident" id="8466967">Now</span><span class="op" id="8466970">(</span><span class="op" id="8466971">)</span><span class="op" id="8466972">.</span><span class="ident" id="8466973">Add</span><span class="op" id="8466976">(</span><span class="ident" id="8466977">someTimeout</span><span class="op" id="8466988">)</span><span class="op" id="8466989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466992">c2</span><span class="op" id="8466994">.</span><span class="ident" id="8466995">SetReadDeadline</span><span class="op" id="8467010">(</span><span class="ident" id="8467011">time</span><span class="op" id="8467015">.</span><span class="ident" id="8467016">Now</span><span class="op" id="8467019">(</span><span class="op" id="8467020">)</span><span class="op" id="8467021">.</span><span class="ident" id="8467022">Add</span><span class="op" id="8467025">(</span><span class="ident" id="8467026">someTimeout</span><span class="op" id="8467037">)</span><span class="op" id="8467038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467041">c2</span><span class="op" id="8467043">.</span><span class="ident" id="8467044">SetWriteDeadline</span><span class="op" id="8467060">(</span><span class="ident" id="8467061">time</span><span class="op" id="8467065">.</span><span class="ident" id="8467066">Now</span><span class="op" id="8467069">(</span><span class="op" id="8467070">)</span><span class="op" id="8467071">.</span><span class="ident" id="8467072">Add</span><span class="op" id="8467075">(</span><span class="ident" id="8467076">someTimeout</span><span class="op" id="8467087">)</span><span class="op" id="8467088">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467091">c2</span><span class="op" id="8467093">.</span><span class="ident" id="8467094">SetReadBuffer</span><span class="op" id="8467107">(</span><span class="num" id="8467108">2048</span><span class="op" id="8467112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467115">c2</span><span class="op" id="8467117">.</span><span class="ident" id="8467118">SetWriteBuffer</span><span class="op" id="8467132">(</span><span class="num" id="8467133">2048</span><span class="op" id="8467137">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467141">a3</span><span class="op" id="8467143">,</span>&nbsp;<span class="ident" id="8467145">err</span>&nbsp;<span class="op" id="8467149">:=</span>&nbsp;<span class="ident" id="8467152">ResolveUnixAddr</span><span class="op" id="8467167">(</span><span class="string" id="8467168">&#34;unixgram&#34;</span><span class="op" id="8467178">,</span>&nbsp;<span class="ident" id="8467180">addr3</span><span class="op" id="8467185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8467188">if</span>&nbsp;<span class="ident" id="8467191">err</span>&nbsp;<span class="op" id="8467195">!=</span>&nbsp;<span class="ident" id="8467198">nil</span>&nbsp;<span class="op" id="8467202">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467206">t</span><span class="op" id="8467207">.</span><span class="ident" id="8467208">Fatalf</span><span class="op" id="8467214">(</span><span class="string" id="8467215">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8467243">,</span>&nbsp;<span class="ident" id="8467245">err</span><span class="op" id="8467248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8467251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467254">c3</span><span class="op" id="8467256">,</span>&nbsp;<span class="ident" id="8467258">err</span>&nbsp;<span class="op" id="8467262">:=</span>&nbsp;<span class="ident" id="8467265">ListenUnixgram</span><span class="op" id="8467279">(</span><span class="string" id="8467280">&#34;unixgram&#34;</span><span class="op" id="8467290">,</span>&nbsp;<span class="ident" id="8467292">a3</span><span class="op" id="8467294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8467297">if</span>&nbsp;<span class="ident" id="8467300">err</span>&nbsp;<span class="op" id="8467304">!=</span>&nbsp;<span class="ident" id="8467307">nil</span>&nbsp;<span class="op" id="8467311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467315">t</span><span class="op" id="8467316">.</span><span class="ident" id="8467317">Fatalf</span><span class="op" id="8467323">(</span><span class="string" id="8467324">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8467351">,</span>&nbsp;<span class="ident" id="8467353">err</span><span class="op" id="8467356">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8467359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8467362">defer</span>&nbsp;<span class="ident" id="8467368">c3</span><span class="op" id="8467370">.</span><span class="ident" id="8467371">Close</span><span class="op" id="8467376">(</span><span class="op" id="8467377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8467380">defer</span>&nbsp;<span class="ident" id="8467386">os</span><span class="op" id="8467388">.</span><span class="ident" id="8467389">Remove</span><span class="op" id="8467395">(</span><span class="ident" id="8467396">addr3</span><span class="op" id="8467401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467404">c3</span><span class="op" id="8467406">.</span><span class="ident" id="8467407">LocalAddr</span><span class="op" id="8467416">(</span><span class="op" id="8467417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467420">c3</span><span class="op" id="8467422">.</span><span class="ident" id="8467423">RemoteAddr</span><span class="op" id="8467433">(</span><span class="op" id="8467434">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467437">c3</span><span class="op" id="8467439">.</span><span class="ident" id="8467440">SetDeadline</span><span class="op" id="8467451">(</span><span class="ident" id="8467452">time</span><span class="op" id="8467456">.</span><span class="ident" id="8467457">Now</span><span class="op" id="8467460">(</span><span class="op" id="8467461">)</span><span class="op" id="8467462">.</span><span class="ident" id="8467463">Add</span><span class="op" id="8467466">(</span><span class="ident" id="8467467">someTimeout</span><span class="op" id="8467478">)</span><span class="op" id="8467479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467482">c3</span><span class="op" id="8467484">.</span><span class="ident" id="8467485">SetReadDeadline</span><span class="op" id="8467500">(</span><span class="ident" id="8467501">time</span><span class="op" id="8467505">.</span><span class="ident" id="8467506">Now</span><span class="op" id="8467509">(</span><span class="op" id="8467510">)</span><span class="op" id="8467511">.</span><span class="ident" id="8467512">Add</span><span class="op" id="8467515">(</span><span class="ident" id="8467516">someTimeout</span><span class="op" id="8467527">)</span><span class="op" id="8467528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467531">c3</span><span class="op" id="8467533">.</span><span class="ident" id="8467534">SetWriteDeadline</span><span class="op" id="8467550">(</span><span class="ident" id="8467551">time</span><span class="op" id="8467555">.</span><span class="ident" id="8467556">Now</span><span class="op" id="8467559">(</span><span class="op" id="8467560">)</span><span class="op" id="8467561">.</span><span class="ident" id="8467562">Add</span><span class="op" id="8467565">(</span><span class="ident" id="8467566">someTimeout</span><span class="op" id="8467577">)</span><span class="op" id="8467578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467581">c3</span><span class="op" id="8467583">.</span><span class="ident" id="8467584">SetReadBuffer</span><span class="op" id="8467597">(</span><span class="num" id="8467598">2048</span><span class="op" id="8467602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467605">c3</span><span class="op" id="8467607">.</span><span class="ident" id="8467608">SetWriteBuffer</span><span class="op" id="8467622">(</span><span class="num" id="8467623">2048</span><span class="op" id="8467627">)</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467631">wb</span>&nbsp;<span class="op" id="8467634">:=</span>&nbsp;<span class="op" id="8467637">[</span><span class="op" id="8467638">]</span><span class="builtintype" id="8467639">byte</span><span class="op" id="8467643">(</span><span class="string" id="8467644">&#34;UNIXCONN&nbsp;TEST&#34;</span><span class="op" id="8467659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467662">rb1</span>&nbsp;<span class="op" id="8467666">:=</span>&nbsp;<span class="builtinfunc" id="8467669">make</span><span class="op" id="8467673">(</span><span class="op" id="8467674">[</span><span class="op" id="8467675">]</span><span class="builtintype" id="8467676">byte</span><span class="op" id="8467680">,</span>&nbsp;<span class="num" id="8467682">128</span><span class="op" id="8467685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467688">rb2</span>&nbsp;<span class="op" id="8467692">:=</span>&nbsp;<span class="builtinfunc" id="8467695">make</span><span class="op" id="8467699">(</span><span class="op" id="8467700">[</span><span class="op" id="8467701">]</span><span class="builtintype" id="8467702">byte</span><span class="op" id="8467706">,</span>&nbsp;<span class="num" id="8467708">128</span><span class="op" id="8467711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467714">rb3</span>&nbsp;<span class="op" id="8467718">:=</span>&nbsp;<span class="builtinfunc" id="8467721">make</span><span class="op" id="8467725">(</span><span class="op" id="8467726">[</span><span class="op" id="8467727">]</span><span class="builtintype" id="8467728">byte</span><span class="op" id="8467732">,</span>&nbsp;<span class="num" id="8467734">128</span><span class="op" id="8467737">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8467740">if</span>&nbsp;<span class="ident" id="8467743">_</span><span class="op" id="8467744">,</span>&nbsp;<span class="ident" id="8467746">_</span><span class="op" id="8467747">,</span>&nbsp;<span class="ident" id="8467749">err</span>&nbsp;<span class="op" id="8467753">:=</span>&nbsp;<span class="ident" id="8467756">c1</span><span class="op" id="8467758">.</span><span class="ident" id="8467759">WriteMsgUnix</span><span class="op" id="8467771">(</span><span class="ident" id="8467772">wb</span><span class="op" id="8467774">,</span>&nbsp;<span class="ident" id="8467776">nil</span><span class="op" id="8467779">,</span>&nbsp;<span class="ident" id="8467781">a2</span><span class="op" id="8467783">)</span><span class="op" id="8467784">;</span>&nbsp;<span class="ident" id="8467786">err</span>&nbsp;<span class="op" id="8467790">!=</span>&nbsp;<span class="ident" id="8467793">nil</span>&nbsp;<span class="op" id="8467797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467801">t</span><span class="op" id="8467802">.</span><span class="ident" id="8467803">Fatalf</span><span class="op" id="8467809">(</span><span class="string" id="8467810">&#34;UnixConn.WriteMsgUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8467844">,</span>&nbsp;<span class="ident" id="8467846">err</span><span class="op" id="8467849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8467852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8467855">if</span>&nbsp;<span class="ident" id="8467858">_</span><span class="op" id="8467859">,</span>&nbsp;<span class="ident" id="8467861">_</span><span class="op" id="8467862">,</span>&nbsp;<span class="ident" id="8467864">_</span><span class="op" id="8467865">,</span>&nbsp;<span class="ident" id="8467867">_</span><span class="op" id="8467868">,</span>&nbsp;<span class="ident" id="8467870">err</span>&nbsp;<span class="op" id="8467874">:=</span>&nbsp;<span class="ident" id="8467877">c2</span><span class="op" id="8467879">.</span><span class="ident" id="8467880">ReadMsgUnix</span><span class="op" id="8467891">(</span><span class="ident" id="8467892">rb2</span><span class="op" id="8467895">,</span>&nbsp;<span class="ident" id="8467897">nil</span><span class="op" id="8467900">)</span><span class="op" id="8467901">;</span>&nbsp;<span class="ident" id="8467903">err</span>&nbsp;<span class="op" id="8467907">!=</span>&nbsp;<span class="ident" id="8467910">nil</span>&nbsp;<span class="op" id="8467914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467918">t</span><span class="op" id="8467919">.</span><span class="ident" id="8467920">Fatalf</span><span class="op" id="8467926">(</span><span class="string" id="8467927">&#34;UnixConn.ReadMsgUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8467960">,</span>&nbsp;<span class="ident" id="8467962">err</span><span class="op" id="8467965">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8467968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8467971">if</span>&nbsp;<span class="ident" id="8467974">_</span><span class="op" id="8467975">,</span>&nbsp;<span class="ident" id="8467977">err</span>&nbsp;<span class="op" id="8467981">:=</span>&nbsp;<span class="ident" id="8467984">c2</span><span class="op" id="8467986">.</span><span class="ident" id="8467987">WriteToUnix</span><span class="op" id="8467998">(</span><span class="ident" id="8467999">wb</span><span class="op" id="8468001">,</span>&nbsp;<span class="ident" id="8468003">a1</span><span class="op" id="8468005">)</span><span class="op" id="8468006">;</span>&nbsp;<span class="ident" id="8468008">err</span>&nbsp;<span class="op" id="8468012">!=</span>&nbsp;<span class="ident" id="8468015">nil</span>&nbsp;<span class="op" id="8468019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468023">t</span><span class="op" id="8468024">.</span><span class="ident" id="8468025">Fatalf</span><span class="op" id="8468031">(</span><span class="string" id="8468032">&#34;UnixConn.WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8468065">,</span>&nbsp;<span class="ident" id="8468067">err</span><span class="op" id="8468070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8468073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8468076">if</span>&nbsp;<span class="ident" id="8468079">_</span><span class="op" id="8468080">,</span>&nbsp;<span class="ident" id="8468082">_</span><span class="op" id="8468083">,</span>&nbsp;<span class="ident" id="8468085">err</span>&nbsp;<span class="op" id="8468089">:=</span>&nbsp;<span class="ident" id="8468092">c1</span><span class="op" id="8468094">.</span><span class="ident" id="8468095">ReadFromUnix</span><span class="op" id="8468107">(</span><span class="ident" id="8468108">rb1</span><span class="op" id="8468111">)</span><span class="op" id="8468112">;</span>&nbsp;<span class="ident" id="8468114">err</span>&nbsp;<span class="op" id="8468118">!=</span>&nbsp;<span class="ident" id="8468121">nil</span>&nbsp;<span class="op" id="8468125">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468129">t</span><span class="op" id="8468130">.</span><span class="ident" id="8468131">Fatalf</span><span class="op" id="8468137">(</span><span class="string" id="8468138">&#34;UnixConn.ReadFromUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8468172">,</span>&nbsp;<span class="ident" id="8468174">err</span><span class="op" id="8468177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8468180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8468183">if</span>&nbsp;<span class="ident" id="8468186">_</span><span class="op" id="8468187">,</span>&nbsp;<span class="ident" id="8468189">err</span>&nbsp;<span class="op" id="8468193">:=</span>&nbsp;<span class="ident" id="8468196">c3</span><span class="op" id="8468198">.</span><span class="ident" id="8468199">WriteToUnix</span><span class="op" id="8468210">(</span><span class="ident" id="8468211">wb</span><span class="op" id="8468213">,</span>&nbsp;<span class="ident" id="8468215">a1</span><span class="op" id="8468217">)</span><span class="op" id="8468218">;</span>&nbsp;<span class="ident" id="8468220">err</span>&nbsp;<span class="op" id="8468224">!=</span>&nbsp;<span class="ident" id="8468227">nil</span>&nbsp;<span class="op" id="8468231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468235">t</span><span class="op" id="8468236">.</span><span class="ident" id="8468237">Fatalf</span><span class="op" id="8468243">(</span><span class="string" id="8468244">&#34;UnixConn.WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8468277">,</span>&nbsp;<span class="ident" id="8468279">err</span><span class="op" id="8468282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8468285">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8468288">if</span>&nbsp;<span class="ident" id="8468291">_</span><span class="op" id="8468292">,</span>&nbsp;<span class="ident" id="8468294">_</span><span class="op" id="8468295">,</span>&nbsp;<span class="ident" id="8468297">err</span>&nbsp;<span class="op" id="8468301">:=</span>&nbsp;<span class="ident" id="8468304">c1</span><span class="op" id="8468306">.</span><span class="ident" id="8468307">ReadFromUnix</span><span class="op" id="8468319">(</span><span class="ident" id="8468320">rb1</span><span class="op" id="8468323">)</span><span class="op" id="8468324">;</span>&nbsp;<span class="ident" id="8468326">err</span>&nbsp;<span class="op" id="8468330">!=</span>&nbsp;<span class="ident" id="8468333">nil</span>&nbsp;<span class="op" id="8468337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468341">t</span><span class="op" id="8468342">.</span><span class="ident" id="8468343">Fatalf</span><span class="op" id="8468349">(</span><span class="string" id="8468350">&#34;UnixConn.ReadFromUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8468384">,</span>&nbsp;<span class="ident" id="8468386">err</span><span class="op" id="8468389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8468392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8468395">if</span>&nbsp;<span class="ident" id="8468398">_</span><span class="op" id="8468399">,</span>&nbsp;<span class="ident" id="8468401">err</span>&nbsp;<span class="op" id="8468405">:=</span>&nbsp;<span class="ident" id="8468408">c2</span><span class="op" id="8468410">.</span><span class="ident" id="8468411">WriteToUnix</span><span class="op" id="8468422">(</span><span class="ident" id="8468423">wb</span><span class="op" id="8468425">,</span>&nbsp;<span class="ident" id="8468427">a3</span><span class="op" id="8468429">)</span><span class="op" id="8468430">;</span>&nbsp;<span class="ident" id="8468432">err</span>&nbsp;<span class="op" id="8468436">!=</span>&nbsp;<span class="ident" id="8468439">nil</span>&nbsp;<span class="op" id="8468443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468447">t</span><span class="op" id="8468448">.</span><span class="ident" id="8468449">Fatalf</span><span class="op" id="8468455">(</span><span class="string" id="8468456">&#34;UnixConn.WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8468489">,</span>&nbsp;<span class="ident" id="8468491">err</span><span class="op" id="8468494">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8468497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8468500">if</span>&nbsp;<span class="ident" id="8468503">_</span><span class="op" id="8468504">,</span>&nbsp;<span class="ident" id="8468506">_</span><span class="op" id="8468507">,</span>&nbsp;<span class="ident" id="8468509">err</span>&nbsp;<span class="op" id="8468513">:=</span>&nbsp;<span class="ident" id="8468516">c3</span><span class="op" id="8468518">.</span><span class="ident" id="8468519">ReadFromUnix</span><span class="op" id="8468531">(</span><span class="ident" id="8468532">rb3</span><span class="op" id="8468535">)</span><span class="op" id="8468536">;</span>&nbsp;<span class="ident" id="8468538">err</span>&nbsp;<span class="op" id="8468542">!=</span>&nbsp;<span class="ident" id="8468545">nil</span>&nbsp;<span class="op" id="8468549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468553">t</span><span class="op" id="8468554">.</span><span class="ident" id="8468555">Fatalf</span><span class="op" id="8468561">(</span><span class="string" id="8468562">&#34;UnixConn.ReadFromUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8468596">,</span>&nbsp;<span class="ident" id="8468598">err</span><span class="op" id="8468601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8468604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8468608">if</span>&nbsp;<span class="ident" id="8468611">f</span><span class="op" id="8468612">,</span>&nbsp;<span class="ident" id="8468614">err</span>&nbsp;<span class="op" id="8468618">:=</span>&nbsp;<span class="ident" id="8468621">c1</span><span class="op" id="8468623">.</span><span class="ident" id="8468624">File</span><span class="op" id="8468628">(</span><span class="op" id="8468629">)</span><span class="op" id="8468630">;</span>&nbsp;<span class="ident" id="8468632">err</span>&nbsp;<span class="op" id="8468636">!=</span>&nbsp;<span class="ident" id="8468639">nil</span>&nbsp;<span class="op" id="8468643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468647">t</span><span class="op" id="8468648">.</span><span class="ident" id="8468649">Fatalf</span><span class="op" id="8468655">(</span><span class="string" id="8468656">&#34;UnixConn.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8468682">,</span>&nbsp;<span class="ident" id="8468684">err</span><span class="op" id="8468687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8468690">}</span>&nbsp;<span class="keyword" id="8468692">else</span>&nbsp;<span class="op" id="8468697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468701">f</span><span class="op" id="8468702">.</span><span class="ident" id="8468703">Close</span><span class="op" id="8468708">(</span><span class="op" id="8468709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8468712">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8468716">defer</span>&nbsp;<span class="keyword" id="8468722">func</span><span class="op" id="8468726">(</span><span class="op" id="8468727">)</span>&nbsp;<span class="op" id="8468729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8468733">if</span>&nbsp;<span class="ident" id="8468736">p</span>&nbsp;<span class="op" id="8468738">:=</span>&nbsp;<span class="builtinfunc" id="8468741">recover</span><span class="op" id="8468748">(</span><span class="op" id="8468749">)</span><span class="op" id="8468750">;</span>&nbsp;<span class="ident" id="8468752">p</span>&nbsp;<span class="op" id="8468754">!=</span>&nbsp;<span class="ident" id="8468757">nil</span>&nbsp;<span class="op" id="8468761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468766">t</span><span class="op" id="8468767">.</span><span class="ident" id="8468768">Fatalf</span><span class="op" id="8468774">(</span><span class="string" id="8468775">&#34;UnixConn.WriteToUnix&nbsp;or&nbsp;WriteMsgUnix&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="8468826">,</span>&nbsp;<span class="ident" id="8468828">p</span><span class="op" id="8468829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8468833">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8468836">}</span><span class="op" id="8468837">(</span><span class="op" id="8468838">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468842">c1</span><span class="op" id="8468844">.</span><span class="ident" id="8468845">WriteToUnix</span><span class="op" id="8468856">(</span><span class="ident" id="8468857">wb</span><span class="op" id="8468859">,</span>&nbsp;<span class="ident" id="8468861">nil</span><span class="op" id="8468864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468867">c1</span><span class="op" id="8468869">.</span><span class="ident" id="8468870">WriteMsgUnix</span><span class="op" id="8468882">(</span><span class="ident" id="8468883">wb</span><span class="op" id="8468885">,</span>&nbsp;<span class="ident" id="8468887">nil</span><span class="op" id="8468890">,</span>&nbsp;<span class="ident" id="8468892">nil</span><span class="op" id="8468895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468898">c3</span><span class="op" id="8468900">.</span><span class="ident" id="8468901">WriteToUnix</span><span class="op" id="8468912">(</span><span class="ident" id="8468913">wb</span><span class="op" id="8468915">,</span>&nbsp;<span class="ident" id="8468917">nil</span><span class="op" id="8468920">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468923">c3</span><span class="op" id="8468925">.</span><span class="ident" id="8468926">WriteMsgUnix</span><span class="op" id="8468938">(</span><span class="ident" id="8468939">wb</span><span class="op" id="8468941">,</span>&nbsp;<span class="ident" id="8468943">nil</span><span class="op" id="8468946">,</span>&nbsp;<span class="ident" id="8468948">nil</span><span class="op" id="8468951">)</span><br>
<span class="lineno"></span><span class="op" id="8468953">}</span>
</div>
</body>
</html>
