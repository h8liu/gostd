<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6253391">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6253446">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6253500">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6253551">//&nbsp;Package&nbsp;gif&nbsp;implements&nbsp;a&nbsp;GIF&nbsp;image&nbsp;decoder&nbsp;and&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="6253610">//</span><br>
<span class="lineno"></span><span class="comment" id="6253613">//&nbsp;The&nbsp;GIF&nbsp;specification&nbsp;is&nbsp;at&nbsp;http://www.w3.org/Graphics/GIF/spec-gif89a.txt.</span><br>
<span class="lineno"></span><span class="keyword" id="6253692">package</span>&nbsp;<span class="ident" id="6253700">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="6253705">import</span>&nbsp;<span class="op" id="6253712">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6253715">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6253724">&#34;compress/lzw&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6253740">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6253750">&#34;fmt&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6253757">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6253766">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6253781">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="6253786">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6253789">var</span>&nbsp;<span class="op" id="6253793">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6253796">errNotEnough</span>&nbsp;<span class="op" id="6253809">=</span>&nbsp;<span class="ident" id="6253811"><a href="/image/gif/reader.go.html#6253740">errors</a></span><span class="op" id="6253817">.</span><span class="ident" id="6253818">New</span><span class="op" id="6253821">(</span><span class="string" id="6253822">&#34;gif:&nbsp;not&nbsp;enough&nbsp;image&nbsp;data&#34;</span><span class="op" id="6253850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6253853">errTooMuch</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6253866">=</span>&nbsp;<span class="ident" id="6253868"><a href="/image/gif/reader.go.html#6253740">errors</a></span><span class="op" id="6253874">.</span><span class="ident" id="6253875">New</span><span class="op" id="6253878">(</span><span class="string" id="6253879">&#34;gif:&nbsp;too&nbsp;much&nbsp;image&nbsp;data&#34;</span><span class="op" id="6253905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6253908">errBadPixel</span>&nbsp;&nbsp;<span class="op" id="6253921">=</span>&nbsp;<span class="ident" id="6253923"><a href="/image/gif/reader.go.html#6253740">errors</a></span><span class="op" id="6253929">.</span><span class="ident" id="6253930">New</span><span class="op" id="6253933">(</span><span class="string" id="6253934">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><span class="op" id="6253960">)</span><br>
<span class="lineno"></span><span class="op" id="6253962">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="6253965">//&nbsp;If&nbsp;the&nbsp;io.Reader&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;ReadByte,&nbsp;then&nbsp;decode&nbsp;will&nbsp;introduce&nbsp;its&nbsp;own&nbsp;buffering.</span><br>
<span class="lineno"></span><span class="keyword" id="6254060">type</span>&nbsp;<span class="ident" id="6254065">reader</span>&nbsp;<span class="keyword" id="6254072">interface</span>&nbsp;<span class="op" id="6254082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254085"><a href="/image/gif/reader.go.html#6253781">io</a></span><span class="op" id="6254087">.</span><span class="ident" id="6254088">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254096"><a href="/image/gif/reader.go.html#6253781">io</a></span><span class="op" id="6254098">.</span><span class="ident" id="6254099">ByteReader</span><br>
<span class="lineno">30</span><span class="op" id="6254110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6254113">//&nbsp;Masks&nbsp;etc.</span><br>
<span class="lineno"></span><span class="keyword" id="6254127">const</span>&nbsp;<span class="op" id="6254133">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6254136">//&nbsp;Fields.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254148">fColorMapFollows</span>&nbsp;<span class="op" id="6254165">=</span>&nbsp;<span class="num" id="6254167">1</span>&nbsp;<span class="op" id="6254169">&lt;&lt;</span>&nbsp;<span class="num" id="6254172">7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6254176">//&nbsp;Image&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254194">ifLocalColorTable</span>&nbsp;<span class="op" id="6254212">=</span>&nbsp;<span class="num" id="6254214">1</span>&nbsp;<span class="op" id="6254216">&lt;&lt;</span>&nbsp;<span class="num" id="6254219">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254222">ifInterlace</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6254240">=</span>&nbsp;<span class="num" id="6254242">1</span>&nbsp;<span class="op" id="6254244">&lt;&lt;</span>&nbsp;<span class="num" id="6254247">6</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254250">ifPixelSizeMask</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6254268">=</span>&nbsp;<span class="num" id="6254270">7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6254274">//&nbsp;Graphic&nbsp;control&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254301">gcTransparentColorSet</span>&nbsp;<span class="op" id="6254323">=</span>&nbsp;<span class="num" id="6254325">1</span>&nbsp;<span class="op" id="6254327">&lt;&lt;</span>&nbsp;<span class="num" id="6254330">0</span><br>
<span class="lineno"></span><span class="op" id="6254332">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="6254335">//&nbsp;Section&nbsp;indicators.</span><br>
<span class="lineno"></span><span class="keyword" id="6254358">const</span>&nbsp;<span class="op" id="6254364">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254367">sExtension</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6254384">=</span>&nbsp;<span class="num" id="6254386">0x21</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254392">sImageDescriptor</span>&nbsp;<span class="op" id="6254409">=</span>&nbsp;<span class="num" id="6254411">0x2C</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254417">sTrailer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6254434">=</span>&nbsp;<span class="num" id="6254436">0x3B</span><br>
<span class="lineno"></span><span class="op" id="6254441">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6254444">//&nbsp;Extensions.</span><br>
<span class="lineno"></span><span class="keyword" id="6254459">const</span>&nbsp;<span class="op" id="6254465">(</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254468">eText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6254484">=</span>&nbsp;<span class="num" id="6254486">0x01</span>&nbsp;<span class="comment" id="6254491">//&nbsp;Plain&nbsp;Text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254506">eGraphicControl</span>&nbsp;<span class="op" id="6254522">=</span>&nbsp;<span class="num" id="6254524">0xF9</span>&nbsp;<span class="comment" id="6254529">//&nbsp;Graphic&nbsp;Control</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254549">eComment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6254565">=</span>&nbsp;<span class="num" id="6254567">0xFE</span>&nbsp;<span class="comment" id="6254572">//&nbsp;Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254584">eApplication</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6254600">=</span>&nbsp;<span class="num" id="6254602">0xFF</span>&nbsp;<span class="comment" id="6254607">//&nbsp;Application</span><br>
<span class="lineno"></span><span class="op" id="6254622">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="6254625">//&nbsp;decoder&nbsp;is&nbsp;the&nbsp;type&nbsp;used&nbsp;to&nbsp;decode&nbsp;a&nbsp;GIF&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6254675">type</span>&nbsp;<span class="ident" id="6254680">decoder</span>&nbsp;<span class="keyword" id="6254688">struct</span>&nbsp;<span class="op" id="6254695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254698">r</span>&nbsp;<span class="ident" id="6254700"><a href="/image/gif/reader.go.html#6254065">reader</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6254709">//&nbsp;From&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254726">vers</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6254742">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254750">width</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6254766">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254771">height</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6254787">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254792">flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6254808">byte</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254814">headerFields</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6254830">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254836">backgroundIndex</span>&nbsp;<span class="builtintype" id="6254852">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254858">loopCount</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6254874">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254879">delayTime</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6254895">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6254901">//&nbsp;Unused&nbsp;from&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254925">aspect</span>&nbsp;<span class="builtintype" id="6254932">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6254939">//&nbsp;From&nbsp;image&nbsp;descriptor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254966">imageFields</span>&nbsp;<span class="builtintype" id="6254978">byte</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6254985">//&nbsp;From&nbsp;graphics&nbsp;control.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255012">transparentIndex</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6255032">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255038">hasTransparentIndex</span>&nbsp;<span class="builtintype" id="6255058">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6255065">//&nbsp;Computed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255079">pixelSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6255094">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255100">globalColorMap</span>&nbsp;<span class="ident" id="6255115"><a href="/image/gif/reader.go.html#6253766">color</a></span><span class="op" id="6255120">.</span><span class="ident" id="6255121">Palette</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6255131">//&nbsp;Used&nbsp;when&nbsp;decoding.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255155">delay</span>&nbsp;<span class="op" id="6255161">[</span><span class="op" id="6255162">]</span><span class="builtintype" id="6255163">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255168">image</span>&nbsp;<span class="op" id="6255174">[</span><span class="op" id="6255175">]</span><span class="op" id="6255176">*</span><span class="ident" id="6255177"><a href="/image/gif/reader.go.html#6253757">image</a></span><span class="op" id="6255182">.</span><span class="ident" id="6255183">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255193">tmp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6255199">[</span><span class="num" id="6255200">1024</span><span class="op" id="6255204">]</span><span class="builtintype" id="6255205">byte</span>&nbsp;<span class="comment" id="6255210">//&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;768&nbsp;so&nbsp;we&nbsp;can&nbsp;read&nbsp;color&nbsp;map</span><br>
<span class="lineno"></span><span class="op" id="6255259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="6255262">//&nbsp;blockReader&nbsp;parses&nbsp;the&nbsp;block&nbsp;structure&nbsp;of&nbsp;GIF&nbsp;image&nbsp;data,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="6255329">//&nbsp;comprises&nbsp;(n,&nbsp;(n&nbsp;bytes))&nbsp;blocks,&nbsp;with&nbsp;1&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;255.&nbsp;&nbsp;It&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6255396">//&nbsp;reader&nbsp;given&nbsp;to&nbsp;the&nbsp;LZW&nbsp;decoder,&nbsp;which&nbsp;is&nbsp;thus&nbsp;immune&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6255460">//&nbsp;blocking.&nbsp;&nbsp;After&nbsp;the&nbsp;LZW&nbsp;decoder&nbsp;completes,&nbsp;there&nbsp;will&nbsp;be&nbsp;a&nbsp;0-byte</span><br>
<span class="lineno"></span><span class="comment" id="6255530">//&nbsp;block&nbsp;remaining&nbsp;(0,&nbsp;()),&nbsp;which&nbsp;is&nbsp;consumed&nbsp;when&nbsp;checking&nbsp;that&nbsp;the</span><br>
<span class="lineno">100</span><span class="comment" id="6255599">//&nbsp;blockReader&nbsp;is&nbsp;exhausted.</span><br>
<span class="lineno"></span><span class="keyword" id="6255628">type</span>&nbsp;<span class="ident" id="6255633">blockReader</span>&nbsp;<span class="keyword" id="6255645">struct</span>&nbsp;<span class="op" id="6255652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255655">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6255661"><a href="/image/gif/reader.go.html#6254065">reader</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255669">slice</span>&nbsp;<span class="op" id="6255675">[</span><span class="op" id="6255676">]</span><span class="builtintype" id="6255677">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255683">err</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6255689">error</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255696">tmp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6255702">[</span><span class="num" id="6255703">256</span><span class="op" id="6255706">]</span><span class="builtintype" id="6255707">byte</span><br>
<span class="lineno"></span><span class="op" id="6255712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6255715">func</span>&nbsp;<span class="op" id="6255720">(</span><span class="ident" id="6255721">b</span>&nbsp;<span class="op" id="6255723">*</span><span class="ident" id="6255724"><a href="/image/gif/reader.go.html#6255633">blockReader</a></span><span class="op" id="6255735">)</span>&nbsp;<span class="ident" id="6255737">Read</span><span class="op" id="6255741">(</span><span class="ident" id="6255742">p</span>&nbsp;<span class="op" id="6255744">[</span><span class="op" id="6255745">]</span><span class="builtintype" id="6255746">byte</span><span class="op" id="6255750">)</span>&nbsp;<span class="op" id="6255752">(</span><span class="builtintype" id="6255753">int</span><span class="op" id="6255756">,</span>&nbsp;<span class="builtintype" id="6255758">error</span><span class="op" id="6255763">)</span>&nbsp;<span class="op" id="6255765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6255768">if</span>&nbsp;<span class="ident" id="6255771"><a href="/image/gif/reader.go.html#6255721">b</a></span><span class="op" id="6255772">.</span><span class="ident" id="6255773">err</span>&nbsp;<span class="op" id="6255777">!=</span>&nbsp;<span class="ident" id="6255780">nil</span>&nbsp;<span class="op" id="6255784">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6255788">return</span>&nbsp;<span class="num" id="6255795">0</span><span class="op" id="6255796">,</span>&nbsp;<span class="ident" id="6255798"><a href="/image/gif/reader.go.html#6255721">b</a></span><span class="op" id="6255799">.</span><span class="ident" id="6255800">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6255805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6255808">if</span>&nbsp;<span class="builtinfunc" id="6255811">len</span><span class="op" id="6255814">(</span><span class="ident" id="6255815"><a href="/image/gif/reader.go.html#6255742">p</a></span><span class="op" id="6255816">)</span>&nbsp;<span class="op" id="6255818">==</span>&nbsp;<span class="num" id="6255821">0</span>&nbsp;<span class="op" id="6255823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6255827">return</span>&nbsp;<span class="num" id="6255834">0</span><span class="op" id="6255835">,</span>&nbsp;<span class="ident" id="6255837">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6255842">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6255845">if</span>&nbsp;<span class="builtinfunc" id="6255848">len</span><span class="op" id="6255851">(</span><span class="ident" id="6255852"><a href="/image/gif/reader.go.html#6255721">b</a></span><span class="op" id="6255853">.</span><span class="ident" id="6255854">slice</span><span class="op" id="6255859">)</span>&nbsp;<span class="op" id="6255861">==</span>&nbsp;<span class="num" id="6255864">0</span>&nbsp;<span class="op" id="6255866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6255870">var</span>&nbsp;<span class="ident" id="6255874">blockLen</span>&nbsp;<span class="builtintype" id="6255883">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255891"><a href="/image/gif/reader.go.html#6255874">blockLen</a></span><span class="op" id="6255899">,</span>&nbsp;<span class="ident" id="6255901"><a href="/image/gif/reader.go.html#6255721">b</a></span><span class="op" id="6255902">.</span><span class="ident" id="6255903">err</span>&nbsp;<span class="op" id="6255907">=</span>&nbsp;<span class="ident" id="6255909"><a href="/image/gif/reader.go.html#6255721">b</a></span><span class="op" id="6255910">.</span><span class="ident" id="6255911">r</span><span class="op" id="6255912">.</span><span class="ident" id="6255913">ReadByte</span><span class="op" id="6255921">(</span><span class="op" id="6255922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6255926">if</span>&nbsp;<span class="ident" id="6255929"><a href="/image/gif/reader.go.html#6255721">b</a></span><span class="op" id="6255930">.</span><span class="ident" id="6255931">err</span>&nbsp;<span class="op" id="6255935">!=</span>&nbsp;<span class="ident" id="6255938">nil</span>&nbsp;<span class="op" id="6255942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6255947">return</span>&nbsp;<span class="num" id="6255954">0</span><span class="op" id="6255955">,</span>&nbsp;<span class="ident" id="6255957"><a href="/image/gif/reader.go.html#6255721">b</a></span><span class="op" id="6255958">.</span><span class="ident" id="6255959">err</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6255965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6255969">if</span>&nbsp;<span class="ident" id="6255972"><a href="/image/gif/reader.go.html#6255874">blockLen</a></span>&nbsp;<span class="op" id="6255981">==</span>&nbsp;<span class="num" id="6255984">0</span>&nbsp;<span class="op" id="6255986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255991"><a href="/image/gif/reader.go.html#6255721">b</a></span><span class="op" id="6255992">.</span><span class="ident" id="6255993">err</span>&nbsp;<span class="op" id="6255997">=</span>&nbsp;<span class="ident" id="6255999"><a href="/image/gif/reader.go.html#6253781">io</a></span><span class="op" id="6256001">.</span><span class="ident" id="6256002">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256009">return</span>&nbsp;<span class="num" id="6256016">0</span><span class="op" id="6256017">,</span>&nbsp;<span class="ident" id="6256019"><a href="/image/gif/reader.go.html#6255721">b</a></span><span class="op" id="6256020">.</span><span class="ident" id="6256021">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6256027">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6256031"><a href="/image/gif/reader.go.html#6255721">b</a></span><span class="op" id="6256032">.</span><span class="ident" id="6256033">slice</span>&nbsp;<span class="op" id="6256039">=</span>&nbsp;<span class="ident" id="6256041"><a href="/image/gif/reader.go.html#6255721">b</a></span><span class="op" id="6256042">.</span><span class="ident" id="6256043">tmp</span><span class="op" id="6256046">[</span><span class="num" id="6256047">0</span><span class="op" id="6256048">:</span><span class="ident" id="6256049"><a href="/image/gif/reader.go.html#6255874">blockLen</a></span><span class="op" id="6256057">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256061">if</span>&nbsp;<span class="ident" id="6256064">_</span><span class="op" id="6256065">,</span>&nbsp;<span class="ident" id="6256067"><a href="/image/gif/reader.go.html#6255721">b</a></span><span class="op" id="6256068">.</span><span class="ident" id="6256069">err</span>&nbsp;<span class="op" id="6256073">=</span>&nbsp;<span class="ident" id="6256075"><a href="/image/gif/reader.go.html#6253781">io</a></span><span class="op" id="6256077">.</span><span class="ident" id="6256078">ReadFull</span><span class="op" id="6256086">(</span><span class="ident" id="6256087"><a href="/image/gif/reader.go.html#6255721">b</a></span><span class="op" id="6256088">.</span><span class="ident" id="6256089">r</span><span class="op" id="6256090">,</span>&nbsp;<span class="ident" id="6256092"><a href="/image/gif/reader.go.html#6255721">b</a></span><span class="op" id="6256093">.</span><span class="ident" id="6256094">slice</span><span class="op" id="6256099">)</span><span class="op" id="6256100">;</span>&nbsp;<span class="ident" id="6256102"><a href="/image/gif/reader.go.html#6255721">b</a></span><span class="op" id="6256103">.</span><span class="ident" id="6256104">err</span>&nbsp;<span class="op" id="6256108">!=</span>&nbsp;<span class="ident" id="6256111">nil</span>&nbsp;<span class="op" id="6256115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256120">return</span>&nbsp;<span class="num" id="6256127">0</span><span class="op" id="6256128">,</span>&nbsp;<span class="ident" id="6256130"><a href="/image/gif/reader.go.html#6255721">b</a></span><span class="op" id="6256131">.</span><span class="ident" id="6256132">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6256138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6256141">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6256144">n</span>&nbsp;<span class="op" id="6256146">:=</span>&nbsp;<span class="builtinfunc" id="6256149">copy</span><span class="op" id="6256153">(</span><span class="ident" id="6256154"><a href="/image/gif/reader.go.html#6255742">p</a></span><span class="op" id="6256155">,</span>&nbsp;<span class="ident" id="6256157"><a href="/image/gif/reader.go.html#6255721">b</a></span><span class="op" id="6256158">.</span><span class="ident" id="6256159">slice</span><span class="op" id="6256164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6256167"><a href="/image/gif/reader.go.html#6255721">b</a></span><span class="op" id="6256168">.</span><span class="ident" id="6256169">slice</span>&nbsp;<span class="op" id="6256175">=</span>&nbsp;<span class="ident" id="6256177"><a href="/image/gif/reader.go.html#6255721">b</a></span><span class="op" id="6256178">.</span><span class="ident" id="6256179">slice</span><span class="op" id="6256184">[</span><span class="ident" id="6256185"><a href="/image/gif/reader.go.html#6256144">n</a></span><span class="op" id="6256186">:</span><span class="op" id="6256187">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256190">return</span>&nbsp;<span class="ident" id="6256197"><a href="/image/gif/reader.go.html#6256144">n</a></span><span class="op" id="6256198">,</span>&nbsp;<span class="ident" id="6256200">nil</span><br>
<span class="lineno"></span><span class="op" id="6256204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="comment" id="6256207">//&nbsp;decode&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;stores&nbsp;the&nbsp;result&nbsp;in&nbsp;d.</span><br>
<span class="lineno"></span><span class="keyword" id="6256270">func</span>&nbsp;<span class="op" id="6256275">(</span><span class="ident" id="6256276">d</span>&nbsp;<span class="op" id="6256278">*</span><span class="ident" id="6256279"><a href="/image/gif/reader.go.html#6254680">decoder</a></span><span class="op" id="6256286">)</span>&nbsp;<span class="ident" id="6256288">decode</span><span class="op" id="6256294">(</span><span class="ident" id="6256295">r</span>&nbsp;<span class="ident" id="6256297"><a href="/image/gif/reader.go.html#6253781">io</a></span><span class="op" id="6256299">.</span><span class="ident" id="6256300">Reader</span><span class="op" id="6256306">,</span>&nbsp;<span class="ident" id="6256308">configOnly</span>&nbsp;<span class="builtintype" id="6256319">bool</span><span class="op" id="6256323">)</span>&nbsp;<span class="builtintype" id="6256325">error</span>&nbsp;<span class="op" id="6256331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6256334">//&nbsp;Add&nbsp;buffering&nbsp;if&nbsp;r&nbsp;does&nbsp;not&nbsp;provide&nbsp;ReadByte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256384">if</span>&nbsp;<span class="ident" id="6256387">rr</span><span class="op" id="6256389">,</span>&nbsp;<span class="ident" id="6256391">ok</span>&nbsp;<span class="op" id="6256394">:=</span>&nbsp;<span class="ident" id="6256397"><a href="/image/gif/reader.go.html#6256295">r</a></span><span class="op" id="6256398">.</span><span class="op" id="6256399">(</span><span class="ident" id="6256400"><a href="/image/gif/reader.go.html#6254065">reader</a></span><span class="op" id="6256406">)</span><span class="op" id="6256407">;</span>&nbsp;<span class="ident" id="6256409"><a href="/image/gif/reader.go.html#6256391">ok</a></span>&nbsp;<span class="op" id="6256412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6256416"><a href="/image/gif/reader.go.html#6256276">d</a></span><span class="op" id="6256417">.</span><span class="ident" id="6256418">r</span>&nbsp;<span class="op" id="6256420">=</span>&nbsp;<span class="ident" id="6256422"><a href="/image/gif/reader.go.html#6256387">rr</a></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6256426">}</span>&nbsp;<span class="keyword" id="6256428">else</span>&nbsp;<span class="op" id="6256433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6256437"><a href="/image/gif/reader.go.html#6256276">d</a></span><span class="op" id="6256438">.</span><span class="ident" id="6256439">r</span>&nbsp;<span class="op" id="6256441">=</span>&nbsp;<span class="ident" id="6256443"><a href="/image/gif/reader.go.html#6253715">bufio</a></span><span class="op" id="6256448">.</span><span class="ident" id="6256449">NewReader</span><span class="op" id="6256458">(</span><span class="ident" id="6256459"><a href="/image/gif/reader.go.html#6256295">r</a></span><span class="op" id="6256460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6256463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6256467">err</span>&nbsp;<span class="op" id="6256471">:=</span>&nbsp;<span class="ident" id="6256474"><a href="/image/gif/reader.go.html#6256276">d</a></span><span class="op" id="6256475">.</span><span class="ident" id="6256476">readHeaderAndScreenDescriptor</span><span class="op" id="6256505">(</span><span class="op" id="6256506">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256509">if</span>&nbsp;<span class="ident" id="6256512"><a href="/image/gif/reader.go.html#6256467">err</a></span>&nbsp;<span class="op" id="6256516">!=</span>&nbsp;<span class="ident" id="6256519">nil</span>&nbsp;<span class="op" id="6256523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256527">return</span>&nbsp;<span class="ident" id="6256534"><a href="/image/gif/reader.go.html#6256467">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6256539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256542">if</span>&nbsp;<span class="ident" id="6256545"><a href="/image/gif/reader.go.html#6256308">configOnly</a></span>&nbsp;<span class="op" id="6256556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256560">return</span>&nbsp;<span class="ident" id="6256567">nil</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6256572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256576">if</span>&nbsp;<span class="ident" id="6256579"><a href="/image/gif/reader.go.html#6256276">d</a></span><span class="op" id="6256580">.</span><span class="ident" id="6256581">headerFields</span><span class="op" id="6256593">&amp;</span><span class="ident" id="6256594"><a href="/image/gif/reader.go.html#6254148">fColorMapFollows</a></span>&nbsp;<span class="op" id="6256611">!=</span>&nbsp;<span class="num" id="6256614">0</span>&nbsp;<span class="op" id="6256616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256620">if</span>&nbsp;<span class="ident" id="6256623"><a href="/image/gif/reader.go.html#6256276">d</a></span><span class="op" id="6256624">.</span><span class="ident" id="6256625">globalColorMap</span><span class="op" id="6256639">,</span>&nbsp;<span class="ident" id="6256641"><a href="/image/gif/reader.go.html#6256467">err</a></span>&nbsp;<span class="op" id="6256645">=</span>&nbsp;<span class="ident" id="6256647"><a href="/image/gif/reader.go.html#6256276">d</a></span><span class="op" id="6256648">.</span><span class="ident" id="6256649">readColorMap</span><span class="op" id="6256661">(</span><span class="op" id="6256662">)</span><span class="op" id="6256663">;</span>&nbsp;<span class="ident" id="6256665"><a href="/image/gif/reader.go.html#6256467">err</a></span>&nbsp;<span class="op" id="6256669">!=</span>&nbsp;<span class="ident" id="6256672">nil</span>&nbsp;<span class="op" id="6256676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256681">return</span>&nbsp;<span class="ident" id="6256688"><a href="/image/gif/reader.go.html#6256467">err</a></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6256694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6256697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256701">for</span>&nbsp;<span class="op" id="6256705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6256709">c</span><span class="op" id="6256710">,</span>&nbsp;<span class="ident" id="6256712">err</span>&nbsp;<span class="op" id="6256716">:=</span>&nbsp;<span class="ident" id="6256719"><a href="/image/gif/reader.go.html#6256276">d</a></span><span class="op" id="6256720">.</span><span class="ident" id="6256721">r</span><span class="op" id="6256722">.</span><span class="ident" id="6256723">ReadByte</span><span class="op" id="6256731">(</span><span class="op" id="6256732">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256736">if</span>&nbsp;<span class="ident" id="6256739"><a href="/image/gif/reader.go.html#6256712">err</a></span>&nbsp;<span class="op" id="6256743">!=</span>&nbsp;<span class="ident" id="6256746">nil</span>&nbsp;<span class="op" id="6256750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256755">return</span>&nbsp;<span class="ident" id="6256762"><a href="/image/gif/reader.go.html#6256712">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6256768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256772">switch</span>&nbsp;<span class="ident" id="6256779"><a href="/image/gif/reader.go.html#6256709">c</a></span>&nbsp;<span class="op" id="6256781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256785">case</span>&nbsp;<span class="ident" id="6256790"><a href="/image/gif/reader.go.html#6254367">sExtension</a></span><span class="op" id="6256800">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256805">if</span>&nbsp;<span class="ident" id="6256808"><a href="/image/gif/reader.go.html#6256712">err</a></span>&nbsp;<span class="op" id="6256812">=</span>&nbsp;<span class="ident" id="6256814"><a href="/image/gif/reader.go.html#6256276">d</a></span><span class="op" id="6256815">.</span><span class="ident" id="6256816">readExtension</span><span class="op" id="6256829">(</span><span class="op" id="6256830">)</span><span class="op" id="6256831">;</span>&nbsp;<span class="ident" id="6256833"><a href="/image/gif/reader.go.html#6256712">err</a></span>&nbsp;<span class="op" id="6256837">!=</span>&nbsp;<span class="ident" id="6256840">nil</span>&nbsp;<span class="op" id="6256844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256850">return</span>&nbsp;<span class="ident" id="6256857"><a href="/image/gif/reader.go.html#6256712">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6256864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256869">case</span>&nbsp;<span class="ident" id="6256874"><a href="/image/gif/reader.go.html#6254392">sImageDescriptor</a></span><span class="op" id="6256890">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6256895">m</span><span class="op" id="6256896">,</span>&nbsp;<span class="ident" id="6256898">err</span>&nbsp;<span class="op" id="6256902">:=</span>&nbsp;<span class="ident" id="6256905"><a href="/image/gif/reader.go.html#6256276">d</a></span><span class="op" id="6256906">.</span><span class="ident" id="6256907">newImageFromDescriptor</span><span class="op" id="6256929">(</span><span class="op" id="6256930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256935">if</span>&nbsp;<span class="ident" id="6256938"><a href="/image/gif/reader.go.html#6256898">err</a></span>&nbsp;<span class="op" id="6256942">!=</span>&nbsp;<span class="ident" id="6256945">nil</span>&nbsp;<span class="op" id="6256949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256955">return</span>&nbsp;<span class="ident" id="6256962"><a href="/image/gif/reader.go.html#6256898">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6256969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6256974">useLocalColorMap</span>&nbsp;<span class="op" id="6256991">:=</span>&nbsp;<span class="ident" id="6256994"><a href="/image/gif/reader.go.html#6256276">d</a></span><span class="op" id="6256995">.</span><span class="ident" id="6256996">imageFields</span><span class="op" id="6257007">&amp;</span><span class="ident" id="6257008"><a href="/image/gif/reader.go.html#6254148">fColorMapFollows</a></span>&nbsp;<span class="op" id="6257025">!=</span>&nbsp;<span class="num" id="6257028">0</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6257033">if</span>&nbsp;<span class="ident" id="6257036"><a href="/image/gif/reader.go.html#6256974">useLocalColorMap</a></span>&nbsp;<span class="op" id="6257053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6257059"><a href="/image/gif/reader.go.html#6256895">m</a></span><span class="op" id="6257060">.</span><span class="ident" id="6257061">Palette</span><span class="op" id="6257068">,</span>&nbsp;<span class="ident" id="6257070"><a href="/image/gif/reader.go.html#6256898">err</a></span>&nbsp;<span class="op" id="6257074">=</span>&nbsp;<span class="ident" id="6257076"><a href="/image/gif/reader.go.html#6256276">d</a></span><span class="op" id="6257077">.</span><span class="ident" id="6257078">readColorMap</span><span class="op" id="6257090">(</span><span class="op" id="6257091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6257097">if</span>&nbsp;<span class="ident" id="6257100"><a href="/image/gif/reader.go.html#6256898">err</a></span>&nbsp;<span class="op" id="6257104">!=</span>&nbsp;<span class="ident" id="6257107">nil</span>&nbsp;<span class="op" id="6257111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6257118">return</span>&nbsp;<span class="ident" id="6257125"><a href="/image/gif/reader.go.html#6256898">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6257133">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6257138">}</span>&nbsp;<span class="keyword" id="6257140">else</span>&nbsp;<span class="op" id="6257145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6257151"><a href="/image/gif/reader.go.html#6256895">m</a></span><span class="op" id="6257152">.</span><span class="ident" id="6257153">Palette</span>&nbsp;<span class="op" id="6257161">=</span>&nbsp;<span class="ident" id="6257163"><a href="/image/gif/reader.go.html#6256276">d</a></span><span class="op" id="6257164">.</span><span class="ident" id="6257165">globalColorMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6257183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6257188">if</span>&nbsp;<span class="ident" id="6257191"><a href="/image/gif/reader.go.html#6256276">d</a></span><span class="op" id="6257192">.</span><span class="ident" id="6257193">hasTransparentIndex</span>&nbsp;<span class="op" id="6257213">&amp;&amp;</span>&nbsp;<span class="builtintype" id="6257216">int</span><span class="op" id="6257219">(</span><span class="ident" id="6257220"><a href="/image/gif/reader.go.html#6256276">d</a></span><span class="op" id="6257221">.</span><span class="ident" id="6257222">transparentIndex</span><span class="op" id="6257238">)</span>&nbsp;<span class="op" id="6257240">&lt;</span>&nbsp;<span class="builtinfunc" id="6257242">len</span><span class="op" id="6257245">(</span><span class="ident" id="6257246"><a href="/image/gif/reader.go.html#6256895">m</a></span><span class="op" id="6257247">.</span><span class="ident" id="6257248">Palette</span><span class="op" id="6257255">)</span>&nbsp;<span class="op" id="6257257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6257263">if</span>&nbsp;<span class="op" id="6257266">!</span><span class="ident" id="6257267"><a href="/image/gif/reader.go.html#6256974">useLocalColorMap</a></span>&nbsp;<span class="op" id="6257284">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6257291">//&nbsp;Clone&nbsp;the&nbsp;global&nbsp;color&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6257327"><a href="/image/gif/reader.go.html#6256895">m</a></span><span class="op" id="6257328">.</span><span class="ident" id="6257329">Palette</span>&nbsp;<span class="op" id="6257337">=</span>&nbsp;<span class="builtinfunc" id="6257339">append</span><span class="op" id="6257345">(</span><span class="ident" id="6257346"><a href="/image/gif/reader.go.html#6253766">color</a></span><span class="op" id="6257351">.</span><span class="ident" id="6257352">Palette</span><span class="op" id="6257359">(</span><span class="ident" id="6257360">nil</span><span class="op" id="6257363">)</span><span class="op" id="6257364">,</span>&nbsp;<span class="ident" id="6257366"><a href="/image/gif/reader.go.html#6256276">d</a></span><span class="op" id="6257367">.</span><span class="ident" id="6257368">globalColorMap</span><span class="op" id="6257382">...</span><span class="op" id="6257385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6257391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6257397"><a href="/image/gif/reader.go.html#6256895">m</a></span><span class="op" id="6257398">.</span><span class="ident" id="6257399">Palette</span><span class="op" id="6257406">[</span><span class="ident" id="6257407"><a href="/image/gif/reader.go.html#6256276">d</a></span><span class="op" id="6257408">.</span><span class="ident" id="6257409">transparentIndex</span><span class="op" id="6257425">]</span>&nbsp;<span class="op" id="6257427">=</span>&nbsp;<span class="ident" id="6257429"><a href="/image/gif/reader.go.html#6253766">color</a></span><span class="op" id="6257434">.</span><span class="ident" id="6257435">RGBA</span><span class="op" id="6257439">{</span><span class="op" id="6257440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6257445">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6257450">litWidth</span><span class="op" id="6257458">,</span>&nbsp;<span class="ident" id="6257460"><a href="/image/gif/reader.go.html#6256898">err</a></span>&nbsp;<span class="op" id="6257464">:=</span>&nbsp;<span class="ident" id="6257467"><a href="/image/gif/reader.go.html#6256276">d</a></span><span class="op" id="6257468">.</span><span class="ident" id="6257469">r</span><span class="op" id="6257470">.</span><span class="ident" id="6257471">ReadByte</span><span class="op" id="6257479">(</span><span class="op" id="6257480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6257485">if</span>&nbsp;<span class="ident" id="6257488"><a href="/image/gif/reader.go.html#6256898">err</a></span>&nbsp;<span class="op" id="6257492">!=</span>&nbsp;<span class="ident" id="6257495">nil</span>&nbsp;<span class="op" id="6257499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6257505">return</span>&nbsp;<span class="ident" id="6257512"><a href="/image/gif/reader.go.html#6256898">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6257519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6257524">if</span>&nbsp;<span class="ident" id="6257527"><a href="/image/gif/reader.go.html#6257450">litWidth</a></span>&nbsp;<span class="op" id="6257536">&lt;</span>&nbsp;<span class="num" id="6257538">2</span>&nbsp;<span class="op" id="6257540">||</span>&nbsp;<span class="ident" id="6257543"><a href="/image/gif/reader.go.html#6257450">litWidth</a></span>&nbsp;<span class="op" id="6257552">&gt;</span>&nbsp;<span class="num" id="6257554">8</span>&nbsp;<span class="op" id="6257556">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6257562">return</span>&nbsp;<span class="ident" id="6257569"><a href="/image/gif/reader.go.html#6253750">fmt</a></span><span class="op" id="6257572">.</span><span class="ident" id="6257573">Errorf</span><span class="op" id="6257579">(</span><span class="string" id="6257580">&#34;gif:&nbsp;pixel&nbsp;size&nbsp;in&nbsp;decode&nbsp;out&nbsp;of&nbsp;range:&nbsp;%d&#34;</span><span class="op" id="6257624">,</span>&nbsp;<span class="ident" id="6257626"><a href="/image/gif/reader.go.html#6257450">litWidth</a></span><span class="op" id="6257634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6257639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6257644">//&nbsp;A&nbsp;wonderfully&nbsp;Go-like&nbsp;piece&nbsp;of&nbsp;magic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6257688">br</span>&nbsp;<span class="op" id="6257691">:=</span>&nbsp;<span class="op" id="6257694">&amp;</span><span class="ident" id="6257695"><a href="/image/gif/reader.go.html#6255633">blockReader</a></span><span class="op" id="6257706">{</span><span class="ident" id="6257707">r</span><span class="op" id="6257708">:</span>&nbsp;<span class="ident" id="6257710"><a href="/image/gif/reader.go.html#6256276">d</a></span><span class="op" id="6257711">.</span><span class="ident" id="6257712">r</span><span class="op" id="6257713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6257718">lzwr</span>&nbsp;<span class="op" id="6257723">:=</span>&nbsp;<span class="ident" id="6257726"><a href="/image/gif/reader.go.html#6253724">lzw</a></span><span class="op" id="6257729">.</span><span class="ident" id="6257730">NewReader</span><span class="op" id="6257739">(</span><span class="ident" id="6257740"><a href="/image/gif/reader.go.html#6257688">br</a></span><span class="op" id="6257742">,</span>&nbsp;<span class="ident" id="6257744"><a href="/image/gif/reader.go.html#6253724">lzw</a></span><span class="op" id="6257747">.</span><span class="ident" id="6257748">LSB</span><span class="op" id="6257751">,</span>&nbsp;<span class="builtintype" id="6257753">int</span><span class="op" id="6257756">(</span><span class="ident" id="6257757"><a href="/image/gif/reader.go.html#6257450">litWidth</a></span><span class="op" id="6257765">)</span><span class="op" id="6257766">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6257771">defer</span>&nbsp;<span class="ident" id="6257777"><a href="/image/gif/reader.go.html#6257718">lzwr</a></span><span class="op" id="6257781">.</span><span class="ident" id="6257782">Close</span><span class="op" id="6257787">(</span><span class="op" id="6257788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6257793">if</span>&nbsp;<span class="ident" id="6257796">_</span><span class="op" id="6257797">,</span>&nbsp;<span class="ident" id="6257799"><a href="/image/gif/reader.go.html#6256898">err</a></span>&nbsp;<span class="op" id="6257803">=</span>&nbsp;<span class="ident" id="6257805"><a href="/image/gif/reader.go.html#6253781">io</a></span><span class="op" id="6257807">.</span><span class="ident" id="6257808">ReadFull</span><span class="op" id="6257816">(</span><span class="ident" id="6257817"><a href="/image/gif/reader.go.html#6257718">lzwr</a></span><span class="op" id="6257821">,</span>&nbsp;<span class="ident" id="6257823"><a href="/image/gif/reader.go.html#6256895">m</a></span><span class="op" id="6257824">.</span><span class="ident" id="6257825">Pix</span><span class="op" id="6257828">)</span><span class="op" id="6257829">;</span>&nbsp;<span class="ident" id="6257831"><a href="/image/gif/reader.go.html#6256898">err</a></span>&nbsp;<span class="op" id="6257835">!=</span>&nbsp;<span class="ident" id="6257838">nil</span>&nbsp;<span class="op" id="6257842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6257848">if</span>&nbsp;<span class="ident" id="6257851"><a href="/image/gif/reader.go.html#6256898">err</a></span>&nbsp;<span class="op" id="6257855">!=</span>&nbsp;<span class="ident" id="6257858"><a href="/image/gif/reader.go.html#6253781">io</a></span><span class="op" id="6257860">.</span><span class="ident" id="6257861">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="6257878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6257885">return</span>&nbsp;<span class="ident" id="6257892"><a href="/image/gif/reader.go.html#6256898">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6257900">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6257906">return</span>&nbsp;<span class="ident" id="6257913"><a href="/image/gif/reader.go.html#6253796">errNotEnough</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6257929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6257934">//&nbsp;Both&nbsp;lzwr&nbsp;and&nbsp;br&nbsp;should&nbsp;be&nbsp;exhausted.&nbsp;Reading&nbsp;from&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6257996">//&nbsp;should&nbsp;yield&nbsp;(0,&nbsp;io.EOF).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258028">if</span>&nbsp;<span class="ident" id="6258031">n</span><span class="op" id="6258032">,</span>&nbsp;<span class="ident" id="6258034">err</span>&nbsp;<span class="op" id="6258038">:=</span>&nbsp;<span class="ident" id="6258041"><a href="/image/gif/reader.go.html#6257718">lzwr</a></span><span class="op" id="6258045">.</span><span class="ident" id="6258046">Read</span><span class="op" id="6258050">(</span><span class="ident" id="6258051"><a href="/image/gif/reader.go.html#6256276">d</a></span><span class="op" id="6258052">.</span><span class="ident" id="6258053">tmp</span><span class="op" id="6258056">[</span><span class="op" id="6258057">:</span><span class="num" id="6258058">1</span><span class="op" id="6258059">]</span><span class="op" id="6258060">)</span><span class="op" id="6258061">;</span>&nbsp;<span class="ident" id="6258063"><a href="/image/gif/reader.go.html#6258031">n</a></span>&nbsp;<span class="op" id="6258065">!=</span>&nbsp;<span class="num" id="6258068">0</span>&nbsp;<span class="op" id="6258070">||</span>&nbsp;<span class="ident" id="6258073"><a href="/image/gif/reader.go.html#6258034">err</a></span>&nbsp;<span class="op" id="6258077">!=</span>&nbsp;<span class="ident" id="6258080"><a href="/image/gif/reader.go.html#6253781">io</a></span><span class="op" id="6258082">.</span><span class="ident" id="6258083">EOF</span>&nbsp;<span class="op" id="6258087">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258093">if</span>&nbsp;<span class="ident" id="6258096"><a href="/image/gif/reader.go.html#6258034">err</a></span>&nbsp;<span class="op" id="6258100">!=</span>&nbsp;<span class="ident" id="6258103">nil</span>&nbsp;<span class="op" id="6258107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258114">return</span>&nbsp;<span class="ident" id="6258121"><a href="/image/gif/reader.go.html#6258034">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6258129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258135">return</span>&nbsp;<span class="ident" id="6258142"><a href="/image/gif/reader.go.html#6253853">errTooMuch</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6258156">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258161">if</span>&nbsp;<span class="ident" id="6258164">n</span><span class="op" id="6258165">,</span>&nbsp;<span class="ident" id="6258167">err</span>&nbsp;<span class="op" id="6258171">:=</span>&nbsp;<span class="ident" id="6258174"><a href="/image/gif/reader.go.html#6257688">br</a></span><span class="op" id="6258176">.</span><span class="ident" id="6258177">Read</span><span class="op" id="6258181">(</span><span class="ident" id="6258182"><a href="/image/gif/reader.go.html#6256276">d</a></span><span class="op" id="6258183">.</span><span class="ident" id="6258184">tmp</span><span class="op" id="6258187">[</span><span class="op" id="6258188">:</span><span class="num" id="6258189">1</span><span class="op" id="6258190">]</span><span class="op" id="6258191">)</span><span class="op" id="6258192">;</span>&nbsp;<span class="ident" id="6258194"><a href="/image/gif/reader.go.html#6258164">n</a></span>&nbsp;<span class="op" id="6258196">!=</span>&nbsp;<span class="num" id="6258199">0</span>&nbsp;<span class="op" id="6258201">||</span>&nbsp;<span class="ident" id="6258204"><a href="/image/gif/reader.go.html#6258167">err</a></span>&nbsp;<span class="op" id="6258208">!=</span>&nbsp;<span class="ident" id="6258211"><a href="/image/gif/reader.go.html#6253781">io</a></span><span class="op" id="6258213">.</span><span class="ident" id="6258214">EOF</span>&nbsp;<span class="op" id="6258218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258224">if</span>&nbsp;<span class="ident" id="6258227"><a href="/image/gif/reader.go.html#6258167">err</a></span>&nbsp;<span class="op" id="6258231">!=</span>&nbsp;<span class="ident" id="6258234">nil</span>&nbsp;<span class="op" id="6258238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258245">return</span>&nbsp;<span class="ident" id="6258252"><a href="/image/gif/reader.go.html#6258167">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6258260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258266">return</span>&nbsp;<span class="ident" id="6258273"><a href="/image/gif/reader.go.html#6253853">errTooMuch</a></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6258287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6258293">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;color&nbsp;indexes&nbsp;are&nbsp;inside&nbsp;the&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258352">if</span>&nbsp;<span class="builtinfunc" id="6258355">len</span><span class="op" id="6258358">(</span><span class="ident" id="6258359"><a href="/image/gif/reader.go.html#6256895">m</a></span><span class="op" id="6258360">.</span><span class="ident" id="6258361">Palette</span><span class="op" id="6258368">)</span>&nbsp;<span class="op" id="6258370">&lt;</span>&nbsp;<span class="num" id="6258372">256</span>&nbsp;<span class="op" id="6258376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258382">for</span>&nbsp;<span class="ident" id="6258386">_</span><span class="op" id="6258387">,</span>&nbsp;<span class="ident" id="6258389">pixel</span>&nbsp;<span class="op" id="6258395">:=</span>&nbsp;<span class="keyword" id="6258398">range</span>&nbsp;<span class="ident" id="6258404"><a href="/image/gif/reader.go.html#6256895">m</a></span><span class="op" id="6258405">.</span><span class="ident" id="6258406">Pix</span>&nbsp;<span class="op" id="6258410">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258417">if</span>&nbsp;<span class="builtintype" id="6258420">int</span><span class="op" id="6258423">(</span><span class="ident" id="6258424"><a href="/image/gif/reader.go.html#6258389">pixel</a></span><span class="op" id="6258429">)</span>&nbsp;<span class="op" id="6258431">&gt;=</span>&nbsp;<span class="builtinfunc" id="6258434">len</span><span class="op" id="6258437">(</span><span class="ident" id="6258438"><a href="/image/gif/reader.go.html#6256895">m</a></span><span class="op" id="6258439">.</span><span class="ident" id="6258440">Palette</span><span class="op" id="6258447">)</span>&nbsp;<span class="op" id="6258449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258457">return</span>&nbsp;<span class="ident" id="6258464"><a href="/image/gif/reader.go.html#6253908">errBadPixel</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6258481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6258487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6258492">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6258498">//&nbsp;Undo&nbsp;the&nbsp;interlacing&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258539">if</span>&nbsp;<span class="ident" id="6258542"><a href="/image/gif/reader.go.html#6256276">d</a></span><span class="op" id="6258543">.</span><span class="ident" id="6258544">imageFields</span><span class="op" id="6258555">&amp;</span><span class="ident" id="6258556"><a href="/image/gif/reader.go.html#6254222">ifInterlace</a></span>&nbsp;<span class="op" id="6258568">!=</span>&nbsp;<span class="num" id="6258571">0</span>&nbsp;<span class="op" id="6258573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6258579"><a href="/image/gif/reader.go.html#6263199">uninterlace</a></span><span class="op" id="6258590">(</span><span class="ident" id="6258591"><a href="/image/gif/reader.go.html#6256895">m</a></span><span class="op" id="6258592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6258597">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6258603"><a href="/image/gif/reader.go.html#6256276">d</a></span><span class="op" id="6258604">.</span><span class="ident" id="6258605">image</span>&nbsp;<span class="op" id="6258611">=</span>&nbsp;<span class="builtinfunc" id="6258613">append</span><span class="op" id="6258619">(</span><span class="ident" id="6258620"><a href="/image/gif/reader.go.html#6256276">d</a></span><span class="op" id="6258621">.</span><span class="ident" id="6258622">image</span><span class="op" id="6258627">,</span>&nbsp;<span class="ident" id="6258629"><a href="/image/gif/reader.go.html#6256895">m</a></span><span class="op" id="6258630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6258635"><a href="/image/gif/reader.go.html#6256276">d</a></span><span class="op" id="6258636">.</span><span class="ident" id="6258637">delay</span>&nbsp;<span class="op" id="6258643">=</span>&nbsp;<span class="builtinfunc" id="6258645">append</span><span class="op" id="6258651">(</span><span class="ident" id="6258652"><a href="/image/gif/reader.go.html#6256276">d</a></span><span class="op" id="6258653">.</span><span class="ident" id="6258654">delay</span><span class="op" id="6258659">,</span>&nbsp;<span class="ident" id="6258661"><a href="/image/gif/reader.go.html#6256276">d</a></span><span class="op" id="6258662">.</span><span class="ident" id="6258663">delayTime</span><span class="op" id="6258672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6258677">//&nbsp;The&nbsp;GIF89a&nbsp;spec,&nbsp;Section&nbsp;23&nbsp;(Graphic&nbsp;Control&nbsp;Extension)&nbsp;says:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6258745">//&nbsp;&#34;The&nbsp;scope&nbsp;of&nbsp;this&nbsp;extension&nbsp;is&nbsp;the&nbsp;first&nbsp;graphic&nbsp;rendering&nbsp;block</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6258817">//&nbsp;to&nbsp;follow.&#34;&nbsp;We&nbsp;therefore&nbsp;reset&nbsp;the&nbsp;GCE&nbsp;fields&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6258878"><a href="/image/gif/reader.go.html#6256276">d</a></span><span class="op" id="6258879">.</span><span class="ident" id="6258880">delayTime</span>&nbsp;<span class="op" id="6258890">=</span>&nbsp;<span class="num" id="6258892">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6258897"><a href="/image/gif/reader.go.html#6256276">d</a></span><span class="op" id="6258898">.</span><span class="ident" id="6258899">hasTransparentIndex</span>&nbsp;<span class="op" id="6258919">=</span>&nbsp;<span class="builtintype" id="6258921">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258930">case</span>&nbsp;<span class="ident" id="6258935"><a href="/image/gif/reader.go.html#6254417">sTrailer</a></span><span class="op" id="6258943">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258948">if</span>&nbsp;<span class="builtinfunc" id="6258951">len</span><span class="op" id="6258954">(</span><span class="ident" id="6258955"><a href="/image/gif/reader.go.html#6256276">d</a></span><span class="op" id="6258956">.</span><span class="ident" id="6258957">image</span><span class="op" id="6258962">)</span>&nbsp;<span class="op" id="6258964">==</span>&nbsp;<span class="num" id="6258967">0</span>&nbsp;<span class="op" id="6258969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258975">return</span>&nbsp;<span class="ident" id="6258982"><a href="/image/gif/reader.go.html#6253781">io</a></span><span class="op" id="6258984">.</span><span class="ident" id="6258985">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6259005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259010">return</span>&nbsp;<span class="ident" id="6259017">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259024">default</span><span class="op" id="6259031">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259036">return</span>&nbsp;<span class="ident" id="6259043"><a href="/image/gif/reader.go.html#6253750">fmt</a></span><span class="op" id="6259046">.</span><span class="ident" id="6259047">Errorf</span><span class="op" id="6259053">(</span><span class="string" id="6259054">&#34;gif:&nbsp;unknown&nbsp;block&nbsp;type:&nbsp;0x%.2x&#34;</span><span class="op" id="6259087">,</span>&nbsp;<span class="ident" id="6259089"><a href="/image/gif/reader.go.html#6256709">c</a></span><span class="op" id="6259090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6259094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6259097">}</span><br>
<span class="lineno"></span><span class="op" id="6259099">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span><span class="keyword" id="6259102">func</span>&nbsp;<span class="op" id="6259107">(</span><span class="ident" id="6259108">d</span>&nbsp;<span class="op" id="6259110">*</span><span class="ident" id="6259111"><a href="/image/gif/reader.go.html#6254680">decoder</a></span><span class="op" id="6259118">)</span>&nbsp;<span class="ident" id="6259120">readHeaderAndScreenDescriptor</span><span class="op" id="6259149">(</span><span class="op" id="6259150">)</span>&nbsp;<span class="builtintype" id="6259152">error</span>&nbsp;<span class="op" id="6259158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259161">_</span><span class="op" id="6259162">,</span>&nbsp;<span class="ident" id="6259164">err</span>&nbsp;<span class="op" id="6259168">:=</span>&nbsp;<span class="ident" id="6259171"><a href="/image/gif/reader.go.html#6253781">io</a></span><span class="op" id="6259173">.</span><span class="ident" id="6259174">ReadFull</span><span class="op" id="6259182">(</span><span class="ident" id="6259183"><a href="/image/gif/reader.go.html#6259108">d</a></span><span class="op" id="6259184">.</span><span class="ident" id="6259185">r</span><span class="op" id="6259186">,</span>&nbsp;<span class="ident" id="6259188"><a href="/image/gif/reader.go.html#6259108">d</a></span><span class="op" id="6259189">.</span><span class="ident" id="6259190">tmp</span><span class="op" id="6259193">[</span><span class="num" id="6259194">0</span><span class="op" id="6259195">:</span><span class="num" id="6259196">13</span><span class="op" id="6259198">]</span><span class="op" id="6259199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259202">if</span>&nbsp;<span class="ident" id="6259205"><a href="/image/gif/reader.go.html#6259164">err</a></span>&nbsp;<span class="op" id="6259209">!=</span>&nbsp;<span class="ident" id="6259212">nil</span>&nbsp;<span class="op" id="6259216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259220">return</span>&nbsp;<span class="ident" id="6259227"><a href="/image/gif/reader.go.html#6259164">err</a></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6259232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259235"><a href="/image/gif/reader.go.html#6259108">d</a></span><span class="op" id="6259236">.</span><span class="ident" id="6259237">vers</span>&nbsp;<span class="op" id="6259242">=</span>&nbsp;<span class="builtintype" id="6259244">string</span><span class="op" id="6259250">(</span><span class="ident" id="6259251"><a href="/image/gif/reader.go.html#6259108">d</a></span><span class="op" id="6259252">.</span><span class="ident" id="6259253">tmp</span><span class="op" id="6259256">[</span><span class="num" id="6259257">0</span><span class="op" id="6259258">:</span><span class="num" id="6259259">6</span><span class="op" id="6259260">]</span><span class="op" id="6259261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259264">if</span>&nbsp;<span class="ident" id="6259267"><a href="/image/gif/reader.go.html#6259108">d</a></span><span class="op" id="6259268">.</span><span class="ident" id="6259269">vers</span>&nbsp;<span class="op" id="6259274">!=</span>&nbsp;<span class="string" id="6259277">&#34;GIF87a&#34;</span>&nbsp;<span class="op" id="6259286">&amp;&amp;</span>&nbsp;<span class="ident" id="6259289"><a href="/image/gif/reader.go.html#6259108">d</a></span><span class="op" id="6259290">.</span><span class="ident" id="6259291">vers</span>&nbsp;<span class="op" id="6259296">!=</span>&nbsp;<span class="string" id="6259299">&#34;GIF89a&#34;</span>&nbsp;<span class="op" id="6259308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259312">return</span>&nbsp;<span class="ident" id="6259319"><a href="/image/gif/reader.go.html#6253750">fmt</a></span><span class="op" id="6259322">.</span><span class="ident" id="6259323">Errorf</span><span class="op" id="6259329">(</span><span class="string" id="6259330">&#34;gif:&nbsp;can&#39;t&nbsp;recognize&nbsp;format&nbsp;%s&#34;</span><span class="op" id="6259362">,</span>&nbsp;<span class="ident" id="6259364"><a href="/image/gif/reader.go.html#6259108">d</a></span><span class="op" id="6259365">.</span><span class="ident" id="6259366">vers</span><span class="op" id="6259370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6259373">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259376"><a href="/image/gif/reader.go.html#6259108">d</a></span><span class="op" id="6259377">.</span><span class="ident" id="6259378">width</span>&nbsp;<span class="op" id="6259384">=</span>&nbsp;<span class="builtintype" id="6259386">int</span><span class="op" id="6259389">(</span><span class="ident" id="6259390"><a href="/image/gif/reader.go.html#6259108">d</a></span><span class="op" id="6259391">.</span><span class="ident" id="6259392">tmp</span><span class="op" id="6259395">[</span><span class="num" id="6259396">6</span><span class="op" id="6259397">]</span><span class="op" id="6259398">)</span>&nbsp;<span class="op" id="6259400">+</span>&nbsp;<span class="builtintype" id="6259402">int</span><span class="op" id="6259405">(</span><span class="ident" id="6259406"><a href="/image/gif/reader.go.html#6259108">d</a></span><span class="op" id="6259407">.</span><span class="ident" id="6259408">tmp</span><span class="op" id="6259411">[</span><span class="num" id="6259412">7</span><span class="op" id="6259413">]</span><span class="op" id="6259414">)</span><span class="op" id="6259415">&lt;&lt;</span><span class="num" id="6259417">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259420"><a href="/image/gif/reader.go.html#6259108">d</a></span><span class="op" id="6259421">.</span><span class="ident" id="6259422">height</span>&nbsp;<span class="op" id="6259429">=</span>&nbsp;<span class="builtintype" id="6259431">int</span><span class="op" id="6259434">(</span><span class="ident" id="6259435"><a href="/image/gif/reader.go.html#6259108">d</a></span><span class="op" id="6259436">.</span><span class="ident" id="6259437">tmp</span><span class="op" id="6259440">[</span><span class="num" id="6259441">8</span><span class="op" id="6259442">]</span><span class="op" id="6259443">)</span>&nbsp;<span class="op" id="6259445">+</span>&nbsp;<span class="builtintype" id="6259447">int</span><span class="op" id="6259450">(</span><span class="ident" id="6259451"><a href="/image/gif/reader.go.html#6259108">d</a></span><span class="op" id="6259452">.</span><span class="ident" id="6259453">tmp</span><span class="op" id="6259456">[</span><span class="num" id="6259457">9</span><span class="op" id="6259458">]</span><span class="op" id="6259459">)</span><span class="op" id="6259460">&lt;&lt;</span><span class="num" id="6259462">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259465"><a href="/image/gif/reader.go.html#6259108">d</a></span><span class="op" id="6259466">.</span><span class="ident" id="6259467">headerFields</span>&nbsp;<span class="op" id="6259480">=</span>&nbsp;<span class="ident" id="6259482"><a href="/image/gif/reader.go.html#6259108">d</a></span><span class="op" id="6259483">.</span><span class="ident" id="6259484">tmp</span><span class="op" id="6259487">[</span><span class="num" id="6259488">10</span><span class="op" id="6259490">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259493"><a href="/image/gif/reader.go.html#6259108">d</a></span><span class="op" id="6259494">.</span><span class="ident" id="6259495">backgroundIndex</span>&nbsp;<span class="op" id="6259511">=</span>&nbsp;<span class="ident" id="6259513"><a href="/image/gif/reader.go.html#6259108">d</a></span><span class="op" id="6259514">.</span><span class="ident" id="6259515">tmp</span><span class="op" id="6259518">[</span><span class="num" id="6259519">11</span><span class="op" id="6259521">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259524"><a href="/image/gif/reader.go.html#6259108">d</a></span><span class="op" id="6259525">.</span><span class="ident" id="6259526">aspect</span>&nbsp;<span class="op" id="6259533">=</span>&nbsp;<span class="ident" id="6259535"><a href="/image/gif/reader.go.html#6259108">d</a></span><span class="op" id="6259536">.</span><span class="ident" id="6259537">tmp</span><span class="op" id="6259540">[</span><span class="num" id="6259541">12</span><span class="op" id="6259543">]</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259546"><a href="/image/gif/reader.go.html#6259108">d</a></span><span class="op" id="6259547">.</span><span class="ident" id="6259548">loopCount</span>&nbsp;<span class="op" id="6259558">=</span>&nbsp;<span class="op" id="6259560">-</span><span class="num" id="6259561">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259564"><a href="/image/gif/reader.go.html#6259108">d</a></span><span class="op" id="6259565">.</span><span class="ident" id="6259566">pixelSize</span>&nbsp;<span class="op" id="6259576">=</span>&nbsp;<span class="builtintype" id="6259578">uint</span><span class="op" id="6259582">(</span><span class="ident" id="6259583"><a href="/image/gif/reader.go.html#6259108">d</a></span><span class="op" id="6259584">.</span><span class="ident" id="6259585">headerFields</span><span class="op" id="6259597">&amp;</span><span class="num" id="6259598">7</span><span class="op" id="6259599">)</span>&nbsp;<span class="op" id="6259601">+</span>&nbsp;<span class="num" id="6259603">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259606">return</span>&nbsp;<span class="ident" id="6259613">nil</span><br>
<span class="lineno"></span><span class="op" id="6259617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="6259620">func</span>&nbsp;<span class="op" id="6259625">(</span><span class="ident" id="6259626">d</span>&nbsp;<span class="op" id="6259628">*</span><span class="ident" id="6259629"><a href="/image/gif/reader.go.html#6254680">decoder</a></span><span class="op" id="6259636">)</span>&nbsp;<span class="ident" id="6259638">readColorMap</span><span class="op" id="6259650">(</span><span class="op" id="6259651">)</span>&nbsp;<span class="op" id="6259653">(</span><span class="ident" id="6259654"><a href="/image/gif/reader.go.html#6253766">color</a></span><span class="op" id="6259659">.</span><span class="ident" id="6259660">Palette</span><span class="op" id="6259667">,</span>&nbsp;<span class="builtintype" id="6259669">error</span><span class="op" id="6259674">)</span>&nbsp;<span class="op" id="6259676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259679">if</span>&nbsp;<span class="ident" id="6259682"><a href="/image/gif/reader.go.html#6259626">d</a></span><span class="op" id="6259683">.</span><span class="ident" id="6259684">pixelSize</span>&nbsp;<span class="op" id="6259694">&gt;</span>&nbsp;<span class="num" id="6259696">8</span>&nbsp;<span class="op" id="6259698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259702">return</span>&nbsp;<span class="ident" id="6259709">nil</span><span class="op" id="6259712">,</span>&nbsp;<span class="ident" id="6259714"><a href="/image/gif/reader.go.html#6253750">fmt</a></span><span class="op" id="6259717">.</span><span class="ident" id="6259718">Errorf</span><span class="op" id="6259724">(</span><span class="string" id="6259725">&#34;gif:&nbsp;can&#39;t&nbsp;handle&nbsp;%d&nbsp;bits&nbsp;per&nbsp;pixel&#34;</span><span class="op" id="6259762">,</span>&nbsp;<span class="ident" id="6259764"><a href="/image/gif/reader.go.html#6259626">d</a></span><span class="op" id="6259765">.</span><span class="ident" id="6259766">pixelSize</span><span class="op" id="6259775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6259778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259781">numColors</span>&nbsp;<span class="op" id="6259791">:=</span>&nbsp;<span class="num" id="6259794">1</span>&nbsp;<span class="op" id="6259796">&lt;&lt;</span>&nbsp;<span class="ident" id="6259799"><a href="/image/gif/reader.go.html#6259626">d</a></span><span class="op" id="6259800">.</span><span class="ident" id="6259801">pixelSize</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259812">if</span>&nbsp;<span class="ident" id="6259815"><a href="/image/gif/reader.go.html#6259626">d</a></span><span class="op" id="6259816">.</span><span class="ident" id="6259817">imageFields</span><span class="op" id="6259828">&amp;</span><span class="ident" id="6259829"><a href="/image/gif/reader.go.html#6254194">ifLocalColorTable</a></span>&nbsp;<span class="op" id="6259847">!=</span>&nbsp;<span class="num" id="6259850">0</span>&nbsp;<span class="op" id="6259852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259856"><a href="/image/gif/reader.go.html#6259781">numColors</a></span>&nbsp;<span class="op" id="6259866">=</span>&nbsp;<span class="num" id="6259868">1</span>&nbsp;<span class="op" id="6259870">&lt;&lt;</span>&nbsp;<span class="op" id="6259873">(</span><span class="op" id="6259874">(</span><span class="ident" id="6259875"><a href="/image/gif/reader.go.html#6259626">d</a></span><span class="op" id="6259876">.</span><span class="ident" id="6259877">imageFields</span>&nbsp;<span class="op" id="6259889">&amp;</span>&nbsp;<span class="ident" id="6259891"><a href="/image/gif/reader.go.html#6254250">ifPixelSizeMask</a></span><span class="op" id="6259906">)</span>&nbsp;<span class="op" id="6259908">+</span>&nbsp;<span class="num" id="6259910">1</span><span class="op" id="6259911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6259914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259917">numValues</span>&nbsp;<span class="op" id="6259927">:=</span>&nbsp;<span class="num" id="6259930">3</span>&nbsp;<span class="op" id="6259932">*</span>&nbsp;<span class="ident" id="6259934"><a href="/image/gif/reader.go.html#6259781">numColors</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259945">_</span><span class="op" id="6259946">,</span>&nbsp;<span class="ident" id="6259948">err</span>&nbsp;<span class="op" id="6259952">:=</span>&nbsp;<span class="ident" id="6259955"><a href="/image/gif/reader.go.html#6253781">io</a></span><span class="op" id="6259957">.</span><span class="ident" id="6259958">ReadFull</span><span class="op" id="6259966">(</span><span class="ident" id="6259967"><a href="/image/gif/reader.go.html#6259626">d</a></span><span class="op" id="6259968">.</span><span class="ident" id="6259969">r</span><span class="op" id="6259970">,</span>&nbsp;<span class="ident" id="6259972"><a href="/image/gif/reader.go.html#6259626">d</a></span><span class="op" id="6259973">.</span><span class="ident" id="6259974">tmp</span><span class="op" id="6259977">[</span><span class="num" id="6259978">0</span><span class="op" id="6259979">:</span><span class="ident" id="6259980"><a href="/image/gif/reader.go.html#6259917">numValues</a></span><span class="op" id="6259989">]</span><span class="op" id="6259990">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259993">if</span>&nbsp;<span class="ident" id="6259996"><a href="/image/gif/reader.go.html#6259948">err</a></span>&nbsp;<span class="op" id="6260000">!=</span>&nbsp;<span class="ident" id="6260003">nil</span>&nbsp;<span class="op" id="6260007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260011">return</span>&nbsp;<span class="ident" id="6260018">nil</span><span class="op" id="6260021">,</span>&nbsp;<span class="ident" id="6260023"><a href="/image/gif/reader.go.html#6253750">fmt</a></span><span class="op" id="6260026">.</span><span class="ident" id="6260027">Errorf</span><span class="op" id="6260033">(</span><span class="string" id="6260034">&#34;gif:&nbsp;short&nbsp;read&nbsp;on&nbsp;color&nbsp;map:&nbsp;%s&#34;</span><span class="op" id="6260068">,</span>&nbsp;<span class="ident" id="6260070"><a href="/image/gif/reader.go.html#6259948">err</a></span><span class="op" id="6260073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6260076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260079">colorMap</span>&nbsp;<span class="op" id="6260088">:=</span>&nbsp;<span class="builtinfunc" id="6260091">make</span><span class="op" id="6260095">(</span><span class="ident" id="6260096"><a href="/image/gif/reader.go.html#6253766">color</a></span><span class="op" id="6260101">.</span><span class="ident" id="6260102">Palette</span><span class="op" id="6260109">,</span>&nbsp;<span class="ident" id="6260111"><a href="/image/gif/reader.go.html#6259781">numColors</a></span><span class="op" id="6260120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260123">j</span>&nbsp;<span class="op" id="6260125">:=</span>&nbsp;<span class="num" id="6260128">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260131">for</span>&nbsp;<span class="ident" id="6260135">i</span>&nbsp;<span class="op" id="6260137">:=</span>&nbsp;<span class="keyword" id="6260140">range</span>&nbsp;<span class="ident" id="6260146"><a href="/image/gif/reader.go.html#6260079">colorMap</a></span>&nbsp;<span class="op" id="6260155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260159"><a href="/image/gif/reader.go.html#6260079">colorMap</a></span><span class="op" id="6260167">[</span><span class="ident" id="6260168"><a href="/image/gif/reader.go.html#6260135">i</a></span><span class="op" id="6260169">]</span>&nbsp;<span class="op" id="6260171">=</span>&nbsp;<span class="ident" id="6260173"><a href="/image/gif/reader.go.html#6253766">color</a></span><span class="op" id="6260178">.</span><span class="ident" id="6260179">RGBA</span><span class="op" id="6260183">{</span><span class="ident" id="6260184"><a href="/image/gif/reader.go.html#6259626">d</a></span><span class="op" id="6260185">.</span><span class="ident" id="6260186">tmp</span><span class="op" id="6260189">[</span><span class="ident" id="6260190"><a href="/image/gif/reader.go.html#6260123">j</a></span><span class="op" id="6260191">+</span><span class="num" id="6260192">0</span><span class="op" id="6260193">]</span><span class="op" id="6260194">,</span>&nbsp;<span class="ident" id="6260196"><a href="/image/gif/reader.go.html#6259626">d</a></span><span class="op" id="6260197">.</span><span class="ident" id="6260198">tmp</span><span class="op" id="6260201">[</span><span class="ident" id="6260202"><a href="/image/gif/reader.go.html#6260123">j</a></span><span class="op" id="6260203">+</span><span class="num" id="6260204">1</span><span class="op" id="6260205">]</span><span class="op" id="6260206">,</span>&nbsp;<span class="ident" id="6260208"><a href="/image/gif/reader.go.html#6259626">d</a></span><span class="op" id="6260209">.</span><span class="ident" id="6260210">tmp</span><span class="op" id="6260213">[</span><span class="ident" id="6260214"><a href="/image/gif/reader.go.html#6260123">j</a></span><span class="op" id="6260215">+</span><span class="num" id="6260216">2</span><span class="op" id="6260217">]</span><span class="op" id="6260218">,</span>&nbsp;<span class="num" id="6260220">0xFF</span><span class="op" id="6260224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260228"><a href="/image/gif/reader.go.html#6260123">j</a></span>&nbsp;<span class="op" id="6260230">+=</span>&nbsp;<span class="num" id="6260233">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6260236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260239">return</span>&nbsp;<span class="ident" id="6260246"><a href="/image/gif/reader.go.html#6260079">colorMap</a></span><span class="op" id="6260254">,</span>&nbsp;<span class="ident" id="6260256">nil</span><br>
<span class="lineno">295</span><span class="op" id="6260260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6260263">func</span>&nbsp;<span class="op" id="6260268">(</span><span class="ident" id="6260269">d</span>&nbsp;<span class="op" id="6260271">*</span><span class="ident" id="6260272"><a href="/image/gif/reader.go.html#6254680">decoder</a></span><span class="op" id="6260279">)</span>&nbsp;<span class="ident" id="6260281">readExtension</span><span class="op" id="6260294">(</span><span class="op" id="6260295">)</span>&nbsp;<span class="builtintype" id="6260297">error</span>&nbsp;<span class="op" id="6260303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260306">extension</span><span class="op" id="6260315">,</span>&nbsp;<span class="ident" id="6260317">err</span>&nbsp;<span class="op" id="6260321">:=</span>&nbsp;<span class="ident" id="6260324"><a href="/image/gif/reader.go.html#6260269">d</a></span><span class="op" id="6260325">.</span><span class="ident" id="6260326">r</span><span class="op" id="6260327">.</span><span class="ident" id="6260328">ReadByte</span><span class="op" id="6260336">(</span><span class="op" id="6260337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260340">if</span>&nbsp;<span class="ident" id="6260343"><a href="/image/gif/reader.go.html#6260317">err</a></span>&nbsp;<span class="op" id="6260347">!=</span>&nbsp;<span class="ident" id="6260350">nil</span>&nbsp;<span class="op" id="6260354">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260358">return</span>&nbsp;<span class="ident" id="6260365"><a href="/image/gif/reader.go.html#6260317">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6260370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260373">size</span>&nbsp;<span class="op" id="6260378">:=</span>&nbsp;<span class="num" id="6260381">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260384">switch</span>&nbsp;<span class="ident" id="6260391"><a href="/image/gif/reader.go.html#6260306">extension</a></span>&nbsp;<span class="op" id="6260401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260404">case</span>&nbsp;<span class="ident" id="6260409"><a href="/image/gif/reader.go.html#6254468">eText</a></span><span class="op" id="6260414">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260418"><a href="/image/gif/reader.go.html#6260373">size</a></span>&nbsp;<span class="op" id="6260423">=</span>&nbsp;<span class="num" id="6260425">13</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260429">case</span>&nbsp;<span class="ident" id="6260434"><a href="/image/gif/reader.go.html#6254506">eGraphicControl</a></span><span class="op" id="6260449">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260453">return</span>&nbsp;<span class="ident" id="6260460"><a href="/image/gif/reader.go.html#6260269">d</a></span><span class="op" id="6260461">.</span><span class="ident" id="6260462">readGraphicControl</span><span class="op" id="6260480">(</span><span class="op" id="6260481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260484">case</span>&nbsp;<span class="ident" id="6260489"><a href="/image/gif/reader.go.html#6254549">eComment</a></span><span class="op" id="6260497">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6260501">//&nbsp;nothing&nbsp;to&nbsp;do&nbsp;but&nbsp;read&nbsp;the&nbsp;data.</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260538">case</span>&nbsp;<span class="ident" id="6260543"><a href="/image/gif/reader.go.html#6254584">eApplication</a></span><span class="op" id="6260555">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260559">b</span><span class="op" id="6260560">,</span>&nbsp;<span class="ident" id="6260562">err</span>&nbsp;<span class="op" id="6260566">:=</span>&nbsp;<span class="ident" id="6260569"><a href="/image/gif/reader.go.html#6260269">d</a></span><span class="op" id="6260570">.</span><span class="ident" id="6260571">r</span><span class="op" id="6260572">.</span><span class="ident" id="6260573">ReadByte</span><span class="op" id="6260581">(</span><span class="op" id="6260582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260586">if</span>&nbsp;<span class="ident" id="6260589"><a href="/image/gif/reader.go.html#6260562">err</a></span>&nbsp;<span class="op" id="6260593">!=</span>&nbsp;<span class="ident" id="6260596">nil</span>&nbsp;<span class="op" id="6260600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260605">return</span>&nbsp;<span class="ident" id="6260612"><a href="/image/gif/reader.go.html#6260562">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6260618">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6260622">//&nbsp;The&nbsp;spec&nbsp;requires&nbsp;size&nbsp;be&nbsp;11,&nbsp;but&nbsp;Adobe&nbsp;sometimes&nbsp;uses&nbsp;10.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260686"><a href="/image/gif/reader.go.html#6260373">size</a></span>&nbsp;<span class="op" id="6260691">=</span>&nbsp;<span class="builtintype" id="6260693">int</span><span class="op" id="6260696">(</span><span class="ident" id="6260697"><a href="/image/gif/reader.go.html#6260559">b</a></span><span class="op" id="6260698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260701">default</span><span class="op" id="6260708">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260712">return</span>&nbsp;<span class="ident" id="6260719"><a href="/image/gif/reader.go.html#6253750">fmt</a></span><span class="op" id="6260722">.</span><span class="ident" id="6260723">Errorf</span><span class="op" id="6260729">(</span><span class="string" id="6260730">&#34;gif:&nbsp;unknown&nbsp;extension&nbsp;0x%.2x&#34;</span><span class="op" id="6260761">,</span>&nbsp;<span class="ident" id="6260763"><a href="/image/gif/reader.go.html#6260306">extension</a></span><span class="op" id="6260772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6260775">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260778">if</span>&nbsp;<span class="ident" id="6260781"><a href="/image/gif/reader.go.html#6260373">size</a></span>&nbsp;<span class="op" id="6260786">&gt;</span>&nbsp;<span class="num" id="6260788">0</span>&nbsp;<span class="op" id="6260790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260794">if</span>&nbsp;<span class="ident" id="6260797">_</span><span class="op" id="6260798">,</span>&nbsp;<span class="ident" id="6260800">err</span>&nbsp;<span class="op" id="6260804">:=</span>&nbsp;<span class="ident" id="6260807"><a href="/image/gif/reader.go.html#6253781">io</a></span><span class="op" id="6260809">.</span><span class="ident" id="6260810">ReadFull</span><span class="op" id="6260818">(</span><span class="ident" id="6260819"><a href="/image/gif/reader.go.html#6260269">d</a></span><span class="op" id="6260820">.</span><span class="ident" id="6260821">r</span><span class="op" id="6260822">,</span>&nbsp;<span class="ident" id="6260824"><a href="/image/gif/reader.go.html#6260269">d</a></span><span class="op" id="6260825">.</span><span class="ident" id="6260826">tmp</span><span class="op" id="6260829">[</span><span class="num" id="6260830">0</span><span class="op" id="6260831">:</span><span class="ident" id="6260832"><a href="/image/gif/reader.go.html#6260373">size</a></span><span class="op" id="6260836">]</span><span class="op" id="6260837">)</span><span class="op" id="6260838">;</span>&nbsp;<span class="ident" id="6260840"><a href="/image/gif/reader.go.html#6260800">err</a></span>&nbsp;<span class="op" id="6260844">!=</span>&nbsp;<span class="ident" id="6260847">nil</span>&nbsp;<span class="op" id="6260851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260856">return</span>&nbsp;<span class="ident" id="6260863"><a href="/image/gif/reader.go.html#6260800">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6260869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6260872">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6260876">//&nbsp;Application&nbsp;Extension&nbsp;with&nbsp;&#34;NETSCAPE2.0&#34;&nbsp;as&nbsp;string&nbsp;and&nbsp;1&nbsp;in&nbsp;data&nbsp;means</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6260951">//&nbsp;this&nbsp;extension&nbsp;defines&nbsp;a&nbsp;loop&nbsp;count.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260992">if</span>&nbsp;<span class="ident" id="6260995"><a href="/image/gif/reader.go.html#6260306">extension</a></span>&nbsp;<span class="op" id="6261005">==</span>&nbsp;<span class="ident" id="6261008"><a href="/image/gif/reader.go.html#6254584">eApplication</a></span>&nbsp;<span class="op" id="6261021">&amp;&amp;</span>&nbsp;<span class="builtintype" id="6261024">string</span><span class="op" id="6261030">(</span><span class="ident" id="6261031"><a href="/image/gif/reader.go.html#6260269">d</a></span><span class="op" id="6261032">.</span><span class="ident" id="6261033">tmp</span><span class="op" id="6261036">[</span><span class="op" id="6261037">:</span><span class="ident" id="6261038"><a href="/image/gif/reader.go.html#6260373">size</a></span><span class="op" id="6261042">]</span><span class="op" id="6261043">)</span>&nbsp;<span class="op" id="6261045">==</span>&nbsp;<span class="string" id="6261048">&#34;NETSCAPE2.0&#34;</span>&nbsp;<span class="op" id="6261062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261066">n</span><span class="op" id="6261067">,</span>&nbsp;<span class="ident" id="6261069">err</span>&nbsp;<span class="op" id="6261073">:=</span>&nbsp;<span class="ident" id="6261076"><a href="/image/gif/reader.go.html#6260269">d</a></span><span class="op" id="6261077">.</span><span class="ident" id="6261078">readBlock</span><span class="op" id="6261087">(</span><span class="op" id="6261088">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261092">if</span>&nbsp;<span class="ident" id="6261095"><a href="/image/gif/reader.go.html#6261066">n</a></span>&nbsp;<span class="op" id="6261097">==</span>&nbsp;<span class="num" id="6261100">0</span>&nbsp;<span class="op" id="6261102">||</span>&nbsp;<span class="ident" id="6261105"><a href="/image/gif/reader.go.html#6261069">err</a></span>&nbsp;<span class="op" id="6261109">!=</span>&nbsp;<span class="ident" id="6261112">nil</span>&nbsp;<span class="op" id="6261116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261121">return</span>&nbsp;<span class="ident" id="6261128"><a href="/image/gif/reader.go.html#6261069">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6261134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261138">if</span>&nbsp;<span class="ident" id="6261141"><a href="/image/gif/reader.go.html#6261066">n</a></span>&nbsp;<span class="op" id="6261143">==</span>&nbsp;<span class="num" id="6261146">3</span>&nbsp;<span class="op" id="6261148">&amp;&amp;</span>&nbsp;<span class="ident" id="6261151"><a href="/image/gif/reader.go.html#6260269">d</a></span><span class="op" id="6261152">.</span><span class="ident" id="6261153">tmp</span><span class="op" id="6261156">[</span><span class="num" id="6261157">0</span><span class="op" id="6261158">]</span>&nbsp;<span class="op" id="6261160">==</span>&nbsp;<span class="num" id="6261163">1</span>&nbsp;<span class="op" id="6261165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261170"><a href="/image/gif/reader.go.html#6260269">d</a></span><span class="op" id="6261171">.</span><span class="ident" id="6261172">loopCount</span>&nbsp;<span class="op" id="6261182">=</span>&nbsp;<span class="builtintype" id="6261184">int</span><span class="op" id="6261187">(</span><span class="ident" id="6261188"><a href="/image/gif/reader.go.html#6260269">d</a></span><span class="op" id="6261189">.</span><span class="ident" id="6261190">tmp</span><span class="op" id="6261193">[</span><span class="num" id="6261194">1</span><span class="op" id="6261195">]</span><span class="op" id="6261196">)</span>&nbsp;<span class="op" id="6261198">|</span>&nbsp;<span class="builtintype" id="6261200">int</span><span class="op" id="6261203">(</span><span class="ident" id="6261204"><a href="/image/gif/reader.go.html#6260269">d</a></span><span class="op" id="6261205">.</span><span class="ident" id="6261206">tmp</span><span class="op" id="6261209">[</span><span class="num" id="6261210">2</span><span class="op" id="6261211">]</span><span class="op" id="6261212">)</span><span class="op" id="6261213">&lt;&lt;</span><span class="num" id="6261215">8</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6261219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6261222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261225">for</span>&nbsp;<span class="op" id="6261229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261233">n</span><span class="op" id="6261234">,</span>&nbsp;<span class="ident" id="6261236">err</span>&nbsp;<span class="op" id="6261240">:=</span>&nbsp;<span class="ident" id="6261243"><a href="/image/gif/reader.go.html#6260269">d</a></span><span class="op" id="6261244">.</span><span class="ident" id="6261245">readBlock</span><span class="op" id="6261254">(</span><span class="op" id="6261255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261259">if</span>&nbsp;<span class="ident" id="6261262"><a href="/image/gif/reader.go.html#6261233">n</a></span>&nbsp;<span class="op" id="6261264">==</span>&nbsp;<span class="num" id="6261267">0</span>&nbsp;<span class="op" id="6261269">||</span>&nbsp;<span class="ident" id="6261272"><a href="/image/gif/reader.go.html#6261236">err</a></span>&nbsp;<span class="op" id="6261276">!=</span>&nbsp;<span class="ident" id="6261279">nil</span>&nbsp;<span class="op" id="6261283">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261288">return</span>&nbsp;<span class="ident" id="6261295"><a href="/image/gif/reader.go.html#6261236">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6261301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6261304">}</span><br>
<span class="lineno"></span><span class="op" id="6261306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="keyword" id="6261309">func</span>&nbsp;<span class="op" id="6261314">(</span><span class="ident" id="6261315">d</span>&nbsp;<span class="op" id="6261317">*</span><span class="ident" id="6261318"><a href="/image/gif/reader.go.html#6254680">decoder</a></span><span class="op" id="6261325">)</span>&nbsp;<span class="ident" id="6261327">readGraphicControl</span><span class="op" id="6261345">(</span><span class="op" id="6261346">)</span>&nbsp;<span class="builtintype" id="6261348">error</span>&nbsp;<span class="op" id="6261354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261357">if</span>&nbsp;<span class="ident" id="6261360">_</span><span class="op" id="6261361">,</span>&nbsp;<span class="ident" id="6261363">err</span>&nbsp;<span class="op" id="6261367">:=</span>&nbsp;<span class="ident" id="6261370"><a href="/image/gif/reader.go.html#6253781">io</a></span><span class="op" id="6261372">.</span><span class="ident" id="6261373">ReadFull</span><span class="op" id="6261381">(</span><span class="ident" id="6261382"><a href="/image/gif/reader.go.html#6261315">d</a></span><span class="op" id="6261383">.</span><span class="ident" id="6261384">r</span><span class="op" id="6261385">,</span>&nbsp;<span class="ident" id="6261387"><a href="/image/gif/reader.go.html#6261315">d</a></span><span class="op" id="6261388">.</span><span class="ident" id="6261389">tmp</span><span class="op" id="6261392">[</span><span class="num" id="6261393">0</span><span class="op" id="6261394">:</span><span class="num" id="6261395">6</span><span class="op" id="6261396">]</span><span class="op" id="6261397">)</span><span class="op" id="6261398">;</span>&nbsp;<span class="ident" id="6261400"><a href="/image/gif/reader.go.html#6261363">err</a></span>&nbsp;<span class="op" id="6261404">!=</span>&nbsp;<span class="ident" id="6261407">nil</span>&nbsp;<span class="op" id="6261411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261415">return</span>&nbsp;<span class="ident" id="6261422"><a href="/image/gif/reader.go.html#6253750">fmt</a></span><span class="op" id="6261425">.</span><span class="ident" id="6261426">Errorf</span><span class="op" id="6261432">(</span><span class="string" id="6261433">&#34;gif:&nbsp;can&#39;t&nbsp;read&nbsp;graphic&nbsp;control:&nbsp;%s&#34;</span><span class="op" id="6261470">,</span>&nbsp;<span class="ident" id="6261472"><a href="/image/gif/reader.go.html#6261363">err</a></span><span class="op" id="6261475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6261478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261481"><a href="/image/gif/reader.go.html#6261315">d</a></span><span class="op" id="6261482">.</span><span class="ident" id="6261483">flags</span>&nbsp;<span class="op" id="6261489">=</span>&nbsp;<span class="ident" id="6261491"><a href="/image/gif/reader.go.html#6261315">d</a></span><span class="op" id="6261492">.</span><span class="ident" id="6261493">tmp</span><span class="op" id="6261496">[</span><span class="num" id="6261497">1</span><span class="op" id="6261498">]</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261501"><a href="/image/gif/reader.go.html#6261315">d</a></span><span class="op" id="6261502">.</span><span class="ident" id="6261503">delayTime</span>&nbsp;<span class="op" id="6261513">=</span>&nbsp;<span class="builtintype" id="6261515">int</span><span class="op" id="6261518">(</span><span class="ident" id="6261519"><a href="/image/gif/reader.go.html#6261315">d</a></span><span class="op" id="6261520">.</span><span class="ident" id="6261521">tmp</span><span class="op" id="6261524">[</span><span class="num" id="6261525">2</span><span class="op" id="6261526">]</span><span class="op" id="6261527">)</span>&nbsp;<span class="op" id="6261529">|</span>&nbsp;<span class="builtintype" id="6261531">int</span><span class="op" id="6261534">(</span><span class="ident" id="6261535"><a href="/image/gif/reader.go.html#6261315">d</a></span><span class="op" id="6261536">.</span><span class="ident" id="6261537">tmp</span><span class="op" id="6261540">[</span><span class="num" id="6261541">3</span><span class="op" id="6261542">]</span><span class="op" id="6261543">)</span><span class="op" id="6261544">&lt;&lt;</span><span class="num" id="6261546">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261549">if</span>&nbsp;<span class="ident" id="6261552"><a href="/image/gif/reader.go.html#6261315">d</a></span><span class="op" id="6261553">.</span><span class="ident" id="6261554">flags</span><span class="op" id="6261559">&amp;</span><span class="ident" id="6261560"><a href="/image/gif/reader.go.html#6254301">gcTransparentColorSet</a></span>&nbsp;<span class="op" id="6261582">!=</span>&nbsp;<span class="num" id="6261585">0</span>&nbsp;<span class="op" id="6261587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261591"><a href="/image/gif/reader.go.html#6261315">d</a></span><span class="op" id="6261592">.</span><span class="ident" id="6261593">transparentIndex</span>&nbsp;<span class="op" id="6261610">=</span>&nbsp;<span class="ident" id="6261612"><a href="/image/gif/reader.go.html#6261315">d</a></span><span class="op" id="6261613">.</span><span class="ident" id="6261614">tmp</span><span class="op" id="6261617">[</span><span class="num" id="6261618">4</span><span class="op" id="6261619">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261623"><a href="/image/gif/reader.go.html#6261315">d</a></span><span class="op" id="6261624">.</span><span class="ident" id="6261625">hasTransparentIndex</span>&nbsp;<span class="op" id="6261645">=</span>&nbsp;<span class="builtintype" id="6261647">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6261653">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261656">return</span>&nbsp;<span class="ident" id="6261663">nil</span><br>
<span class="lineno"></span><span class="op" id="6261667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6261670">func</span>&nbsp;<span class="op" id="6261675">(</span><span class="ident" id="6261676">d</span>&nbsp;<span class="op" id="6261678">*</span><span class="ident" id="6261679"><a href="/image/gif/reader.go.html#6254680">decoder</a></span><span class="op" id="6261686">)</span>&nbsp;<span class="ident" id="6261688">newImageFromDescriptor</span><span class="op" id="6261710">(</span><span class="op" id="6261711">)</span>&nbsp;<span class="op" id="6261713">(</span><span class="op" id="6261714">*</span><span class="ident" id="6261715"><a href="/image/gif/reader.go.html#6253757">image</a></span><span class="op" id="6261720">.</span><span class="ident" id="6261721">Paletted</span><span class="op" id="6261729">,</span>&nbsp;<span class="builtintype" id="6261731">error</span><span class="op" id="6261736">)</span>&nbsp;<span class="op" id="6261738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261741">if</span>&nbsp;<span class="ident" id="6261744">_</span><span class="op" id="6261745">,</span>&nbsp;<span class="ident" id="6261747">err</span>&nbsp;<span class="op" id="6261751">:=</span>&nbsp;<span class="ident" id="6261754"><a href="/image/gif/reader.go.html#6253781">io</a></span><span class="op" id="6261756">.</span><span class="ident" id="6261757">ReadFull</span><span class="op" id="6261765">(</span><span class="ident" id="6261766"><a href="/image/gif/reader.go.html#6261676">d</a></span><span class="op" id="6261767">.</span><span class="ident" id="6261768">r</span><span class="op" id="6261769">,</span>&nbsp;<span class="ident" id="6261771"><a href="/image/gif/reader.go.html#6261676">d</a></span><span class="op" id="6261772">.</span><span class="ident" id="6261773">tmp</span><span class="op" id="6261776">[</span><span class="num" id="6261777">0</span><span class="op" id="6261778">:</span><span class="num" id="6261779">9</span><span class="op" id="6261780">]</span><span class="op" id="6261781">)</span><span class="op" id="6261782">;</span>&nbsp;<span class="ident" id="6261784"><a href="/image/gif/reader.go.html#6261747">err</a></span>&nbsp;<span class="op" id="6261788">!=</span>&nbsp;<span class="ident" id="6261791">nil</span>&nbsp;<span class="op" id="6261795">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6261799">return</span>&nbsp;<span class="ident" id="6261806">nil</span><span class="op" id="6261809">,</span>&nbsp;<span class="ident" id="6261811"><a href="/image/gif/reader.go.html#6253750">fmt</a></span><span class="op" id="6261814">.</span><span class="ident" id="6261815">Errorf</span><span class="op" id="6261821">(</span><span class="string" id="6261822">&#34;gif:&nbsp;can&#39;t&nbsp;read&nbsp;image&nbsp;descriptor:&nbsp;%s&#34;</span><span class="op" id="6261860">,</span>&nbsp;<span class="ident" id="6261862"><a href="/image/gif/reader.go.html#6261747">err</a></span><span class="op" id="6261865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6261868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261871">left</span>&nbsp;<span class="op" id="6261876">:=</span>&nbsp;<span class="builtintype" id="6261879">int</span><span class="op" id="6261882">(</span><span class="ident" id="6261883"><a href="/image/gif/reader.go.html#6261676">d</a></span><span class="op" id="6261884">.</span><span class="ident" id="6261885">tmp</span><span class="op" id="6261888">[</span><span class="num" id="6261889">0</span><span class="op" id="6261890">]</span><span class="op" id="6261891">)</span>&nbsp;<span class="op" id="6261893">+</span>&nbsp;<span class="builtintype" id="6261895">int</span><span class="op" id="6261898">(</span><span class="ident" id="6261899"><a href="/image/gif/reader.go.html#6261676">d</a></span><span class="op" id="6261900">.</span><span class="ident" id="6261901">tmp</span><span class="op" id="6261904">[</span><span class="num" id="6261905">1</span><span class="op" id="6261906">]</span><span class="op" id="6261907">)</span><span class="op" id="6261908">&lt;&lt;</span><span class="num" id="6261910">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261913">top</span>&nbsp;<span class="op" id="6261917">:=</span>&nbsp;<span class="builtintype" id="6261920">int</span><span class="op" id="6261923">(</span><span class="ident" id="6261924"><a href="/image/gif/reader.go.html#6261676">d</a></span><span class="op" id="6261925">.</span><span class="ident" id="6261926">tmp</span><span class="op" id="6261929">[</span><span class="num" id="6261930">2</span><span class="op" id="6261931">]</span><span class="op" id="6261932">)</span>&nbsp;<span class="op" id="6261934">+</span>&nbsp;<span class="builtintype" id="6261936">int</span><span class="op" id="6261939">(</span><span class="ident" id="6261940"><a href="/image/gif/reader.go.html#6261676">d</a></span><span class="op" id="6261941">.</span><span class="ident" id="6261942">tmp</span><span class="op" id="6261945">[</span><span class="num" id="6261946">3</span><span class="op" id="6261947">]</span><span class="op" id="6261948">)</span><span class="op" id="6261949">&lt;&lt;</span><span class="num" id="6261951">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261954">width</span>&nbsp;<span class="op" id="6261960">:=</span>&nbsp;<span class="builtintype" id="6261963">int</span><span class="op" id="6261966">(</span><span class="ident" id="6261967"><a href="/image/gif/reader.go.html#6261676">d</a></span><span class="op" id="6261968">.</span><span class="ident" id="6261969">tmp</span><span class="op" id="6261972">[</span><span class="num" id="6261973">4</span><span class="op" id="6261974">]</span><span class="op" id="6261975">)</span>&nbsp;<span class="op" id="6261977">+</span>&nbsp;<span class="builtintype" id="6261979">int</span><span class="op" id="6261982">(</span><span class="ident" id="6261983"><a href="/image/gif/reader.go.html#6261676">d</a></span><span class="op" id="6261984">.</span><span class="ident" id="6261985">tmp</span><span class="op" id="6261988">[</span><span class="num" id="6261989">5</span><span class="op" id="6261990">]</span><span class="op" id="6261991">)</span><span class="op" id="6261992">&lt;&lt;</span><span class="num" id="6261994">8</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6261997">height</span>&nbsp;<span class="op" id="6262004">:=</span>&nbsp;<span class="builtintype" id="6262007">int</span><span class="op" id="6262010">(</span><span class="ident" id="6262011"><a href="/image/gif/reader.go.html#6261676">d</a></span><span class="op" id="6262012">.</span><span class="ident" id="6262013">tmp</span><span class="op" id="6262016">[</span><span class="num" id="6262017">6</span><span class="op" id="6262018">]</span><span class="op" id="6262019">)</span>&nbsp;<span class="op" id="6262021">+</span>&nbsp;<span class="builtintype" id="6262023">int</span><span class="op" id="6262026">(</span><span class="ident" id="6262027"><a href="/image/gif/reader.go.html#6261676">d</a></span><span class="op" id="6262028">.</span><span class="ident" id="6262029">tmp</span><span class="op" id="6262032">[</span><span class="num" id="6262033">7</span><span class="op" id="6262034">]</span><span class="op" id="6262035">)</span><span class="op" id="6262036">&lt;&lt;</span><span class="num" id="6262038">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6262041"><a href="/image/gif/reader.go.html#6261676">d</a></span><span class="op" id="6262042">.</span><span class="ident" id="6262043">imageFields</span>&nbsp;<span class="op" id="6262055">=</span>&nbsp;<span class="ident" id="6262057"><a href="/image/gif/reader.go.html#6261676">d</a></span><span class="op" id="6262058">.</span><span class="ident" id="6262059">tmp</span><span class="op" id="6262062">[</span><span class="num" id="6262063">8</span><span class="op" id="6262064">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6262068">//&nbsp;The&nbsp;GIF89a&nbsp;spec,&nbsp;Section&nbsp;20&nbsp;(Image&nbsp;Descriptor)&nbsp;says:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6262125">//&nbsp;&#34;Each&nbsp;image&nbsp;must&nbsp;fit&nbsp;within&nbsp;the&nbsp;boundaries&nbsp;of&nbsp;the&nbsp;Logical</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6262187">//&nbsp;Screen,&nbsp;as&nbsp;defined&nbsp;in&nbsp;the&nbsp;Logical&nbsp;Screen&nbsp;Descriptor.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6262245">bounds</span>&nbsp;<span class="op" id="6262252">:=</span>&nbsp;<span class="ident" id="6262255"><a href="/image/gif/reader.go.html#6253757">image</a></span><span class="op" id="6262260">.</span><span class="ident" id="6262261">Rect</span><span class="op" id="6262265">(</span><span class="ident" id="6262266"><a href="/image/gif/reader.go.html#6261871">left</a></span><span class="op" id="6262270">,</span>&nbsp;<span class="ident" id="6262272"><a href="/image/gif/reader.go.html#6261913">top</a></span><span class="op" id="6262275">,</span>&nbsp;<span class="ident" id="6262277"><a href="/image/gif/reader.go.html#6261871">left</a></span><span class="op" id="6262281">+</span><span class="ident" id="6262282"><a href="/image/gif/reader.go.html#6261954">width</a></span><span class="op" id="6262287">,</span>&nbsp;<span class="ident" id="6262289"><a href="/image/gif/reader.go.html#6261913">top</a></span><span class="op" id="6262292">+</span><span class="ident" id="6262293"><a href="/image/gif/reader.go.html#6261997">height</a></span><span class="op" id="6262299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262302">if</span>&nbsp;<span class="ident" id="6262305"><a href="/image/gif/reader.go.html#6262245">bounds</a></span>&nbsp;<span class="op" id="6262312">!=</span>&nbsp;<span class="ident" id="6262315"><a href="/image/gif/reader.go.html#6262245">bounds</a></span><span class="op" id="6262321">.</span><span class="ident" id="6262322">Intersect</span><span class="op" id="6262331">(</span><span class="ident" id="6262332"><a href="/image/gif/reader.go.html#6253757">image</a></span><span class="op" id="6262337">.</span><span class="ident" id="6262338">Rect</span><span class="op" id="6262342">(</span><span class="num" id="6262343">0</span><span class="op" id="6262344">,</span>&nbsp;<span class="num" id="6262346">0</span><span class="op" id="6262347">,</span>&nbsp;<span class="ident" id="6262349"><a href="/image/gif/reader.go.html#6261676">d</a></span><span class="op" id="6262350">.</span><span class="ident" id="6262351">width</span><span class="op" id="6262356">,</span>&nbsp;<span class="ident" id="6262358"><a href="/image/gif/reader.go.html#6261676">d</a></span><span class="op" id="6262359">.</span><span class="ident" id="6262360">height</span><span class="op" id="6262366">)</span><span class="op" id="6262367">)</span>&nbsp;<span class="op" id="6262369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262373">return</span>&nbsp;<span class="ident" id="6262380">nil</span><span class="op" id="6262383">,</span>&nbsp;<span class="ident" id="6262385"><a href="/image/gif/reader.go.html#6253740">errors</a></span><span class="op" id="6262391">.</span><span class="ident" id="6262392">New</span><span class="op" id="6262395">(</span><span class="string" id="6262396">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><span class="op" id="6262440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6262443">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262446">return</span>&nbsp;<span class="ident" id="6262453"><a href="/image/gif/reader.go.html#6253757">image</a></span><span class="op" id="6262458">.</span><span class="ident" id="6262459">NewPaletted</span><span class="op" id="6262470">(</span><span class="ident" id="6262471"><a href="/image/gif/reader.go.html#6262245">bounds</a></span><span class="op" id="6262477">,</span>&nbsp;<span class="ident" id="6262479">nil</span><span class="op" id="6262482">)</span><span class="op" id="6262483">,</span>&nbsp;<span class="ident" id="6262485">nil</span><br>
<span class="lineno"></span><span class="op" id="6262489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6262492">func</span>&nbsp;<span class="op" id="6262497">(</span><span class="ident" id="6262498">d</span>&nbsp;<span class="op" id="6262500">*</span><span class="ident" id="6262501"><a href="/image/gif/reader.go.html#6254680">decoder</a></span><span class="op" id="6262508">)</span>&nbsp;<span class="ident" id="6262510">readBlock</span><span class="op" id="6262519">(</span><span class="op" id="6262520">)</span>&nbsp;<span class="op" id="6262522">(</span><span class="builtintype" id="6262523">int</span><span class="op" id="6262526">,</span>&nbsp;<span class="builtintype" id="6262528">error</span><span class="op" id="6262533">)</span>&nbsp;<span class="op" id="6262535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6262538">n</span><span class="op" id="6262539">,</span>&nbsp;<span class="ident" id="6262541">err</span>&nbsp;<span class="op" id="6262545">:=</span>&nbsp;<span class="ident" id="6262548"><a href="/image/gif/reader.go.html#6262498">d</a></span><span class="op" id="6262549">.</span><span class="ident" id="6262550">r</span><span class="op" id="6262551">.</span><span class="ident" id="6262552">ReadByte</span><span class="op" id="6262560">(</span><span class="op" id="6262561">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262564">if</span>&nbsp;<span class="ident" id="6262567"><a href="/image/gif/reader.go.html#6262538">n</a></span>&nbsp;<span class="op" id="6262569">==</span>&nbsp;<span class="num" id="6262572">0</span>&nbsp;<span class="op" id="6262574">||</span>&nbsp;<span class="ident" id="6262577"><a href="/image/gif/reader.go.html#6262541">err</a></span>&nbsp;<span class="op" id="6262581">!=</span>&nbsp;<span class="ident" id="6262584">nil</span>&nbsp;<span class="op" id="6262588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262592">return</span>&nbsp;<span class="num" id="6262599">0</span><span class="op" id="6262600">,</span>&nbsp;<span class="ident" id="6262602"><a href="/image/gif/reader.go.html#6262541">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6262607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6262610">return</span>&nbsp;<span class="ident" id="6262617"><a href="/image/gif/reader.go.html#6253781">io</a></span><span class="op" id="6262619">.</span><span class="ident" id="6262620">ReadFull</span><span class="op" id="6262628">(</span><span class="ident" id="6262629"><a href="/image/gif/reader.go.html#6262498">d</a></span><span class="op" id="6262630">.</span><span class="ident" id="6262631">r</span><span class="op" id="6262632">,</span>&nbsp;<span class="ident" id="6262634"><a href="/image/gif/reader.go.html#6262498">d</a></span><span class="op" id="6262635">.</span><span class="ident" id="6262636">tmp</span><span class="op" id="6262639">[</span><span class="num" id="6262640">0</span><span class="op" id="6262641">:</span><span class="ident" id="6262642"><a href="/image/gif/reader.go.html#6262538">n</a></span><span class="op" id="6262643">]</span><span class="op" id="6262644">)</span><br>
<span class="lineno"></span><span class="op" id="6262646">}</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span><span class="comment" id="6262649">//&nbsp;interlaceScan&nbsp;defines&nbsp;the&nbsp;ordering&nbsp;for&nbsp;a&nbsp;pass&nbsp;of&nbsp;the&nbsp;interlace&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="6262726">type</span>&nbsp;<span class="ident" id="6262731">interlaceScan</span>&nbsp;<span class="keyword" id="6262745">struct</span>&nbsp;<span class="op" id="6262752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6262755">skip</span><span class="op" id="6262759">,</span>&nbsp;<span class="ident" id="6262761">start</span>&nbsp;<span class="builtintype" id="6262767">int</span><br>
<span class="lineno"></span><span class="op" id="6262771">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span><span class="comment" id="6262774">//&nbsp;interlacing&nbsp;represents&nbsp;the&nbsp;set&nbsp;of&nbsp;scans&nbsp;in&nbsp;an&nbsp;interlaced&nbsp;GIF&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="6262845">var</span>&nbsp;<span class="ident" id="6262849">interlacing</span>&nbsp;<span class="op" id="6262861">=</span>&nbsp;<span class="op" id="6262863">[</span><span class="op" id="6262864">]</span><span class="ident" id="6262865"><a href="/image/gif/reader.go.html#6262731">interlaceScan</a></span><span class="op" id="6262878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6262881">{</span><span class="num" id="6262882">8</span><span class="op" id="6262883">,</span>&nbsp;<span class="num" id="6262885">0</span><span class="op" id="6262886">}</span><span class="op" id="6262887">,</span>&nbsp;<span class="comment" id="6262889">//&nbsp;Group&nbsp;1&nbsp;:&nbsp;Every&nbsp;8th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6262940">{</span><span class="num" id="6262941">8</span><span class="op" id="6262942">,</span>&nbsp;<span class="num" id="6262944">4</span><span class="op" id="6262945">}</span><span class="op" id="6262946">,</span>&nbsp;<span class="comment" id="6262948">//&nbsp;Group&nbsp;2&nbsp;:&nbsp;Every&nbsp;8th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;4.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6262999">{</span><span class="num" id="6263000">4</span><span class="op" id="6263001">,</span>&nbsp;<span class="num" id="6263003">2</span><span class="op" id="6263004">}</span><span class="op" id="6263005">,</span>&nbsp;<span class="comment" id="6263007">//&nbsp;Group&nbsp;3&nbsp;:&nbsp;Every&nbsp;4th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6263058">{</span><span class="num" id="6263059">2</span><span class="op" id="6263060">,</span>&nbsp;<span class="num" id="6263062">1</span><span class="op" id="6263063">}</span><span class="op" id="6263064">,</span>&nbsp;<span class="comment" id="6263066">//&nbsp;Group&nbsp;4&nbsp;:&nbsp;Every&nbsp;2nd.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;1.</span><br>
<span class="lineno"></span><span class="op" id="6263116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6263119">//&nbsp;uninterlace&nbsp;rearranges&nbsp;the&nbsp;pixels&nbsp;in&nbsp;m&nbsp;to&nbsp;account&nbsp;for&nbsp;interlaced&nbsp;input.</span><br>
<span class="lineno">400</span><span class="keyword" id="6263194">func</span>&nbsp;<span class="ident" id="6263199">uninterlace</span><span class="op" id="6263210">(</span><span class="ident" id="6263211">m</span>&nbsp;<span class="op" id="6263213">*</span><span class="ident" id="6263214"><a href="/image/gif/reader.go.html#6253757">image</a></span><span class="op" id="6263219">.</span><span class="ident" id="6263220">Paletted</span><span class="op" id="6263228">)</span>&nbsp;<span class="op" id="6263230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6263233">var</span>&nbsp;<span class="ident" id="6263237">nPix</span>&nbsp;<span class="op" id="6263242">[</span><span class="op" id="6263243">]</span><span class="builtintype" id="6263244">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263251">dx</span>&nbsp;<span class="op" id="6263254">:=</span>&nbsp;<span class="ident" id="6263257"><a href="/image/gif/reader.go.html#6263211">m</a></span><span class="op" id="6263258">.</span><span class="ident" id="6263259">Bounds</span><span class="op" id="6263265">(</span><span class="op" id="6263266">)</span><span class="op" id="6263267">.</span><span class="ident" id="6263268">Dx</span><span class="op" id="6263270">(</span><span class="op" id="6263271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263274">dy</span>&nbsp;<span class="op" id="6263277">:=</span>&nbsp;<span class="ident" id="6263280"><a href="/image/gif/reader.go.html#6263211">m</a></span><span class="op" id="6263281">.</span><span class="ident" id="6263282">Bounds</span><span class="op" id="6263288">(</span><span class="op" id="6263289">)</span><span class="op" id="6263290">.</span><span class="ident" id="6263291">Dy</span><span class="op" id="6263293">(</span><span class="op" id="6263294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263297"><a href="/image/gif/reader.go.html#6263237">nPix</a></span>&nbsp;<span class="op" id="6263302">=</span>&nbsp;<span class="builtinfunc" id="6263304">make</span><span class="op" id="6263308">(</span><span class="op" id="6263309">[</span><span class="op" id="6263310">]</span><span class="builtintype" id="6263311">uint8</span><span class="op" id="6263316">,</span>&nbsp;<span class="ident" id="6263318"><a href="/image/gif/reader.go.html#6263251">dx</a></span><span class="op" id="6263320">*</span><span class="ident" id="6263321"><a href="/image/gif/reader.go.html#6263274">dy</a></span><span class="op" id="6263323">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263326">offset</span>&nbsp;<span class="op" id="6263333">:=</span>&nbsp;<span class="num" id="6263336">0</span>&nbsp;<span class="comment" id="6263338">//&nbsp;steps&nbsp;through&nbsp;the&nbsp;input&nbsp;by&nbsp;sequential&nbsp;scan&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6263392">for</span>&nbsp;<span class="ident" id="6263396">_</span><span class="op" id="6263397">,</span>&nbsp;<span class="ident" id="6263399">pass</span>&nbsp;<span class="op" id="6263404">:=</span>&nbsp;<span class="keyword" id="6263407">range</span>&nbsp;<span class="ident" id="6263413"><a href="/image/gif/reader.go.html#6262849">interlacing</a></span>&nbsp;<span class="op" id="6263425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263429">nOffset</span>&nbsp;<span class="op" id="6263437">:=</span>&nbsp;<span class="ident" id="6263440"><a href="/image/gif/reader.go.html#6263399">pass</a></span><span class="op" id="6263444">.</span><span class="ident" id="6263445">start</span>&nbsp;<span class="op" id="6263451">*</span>&nbsp;<span class="ident" id="6263453"><a href="/image/gif/reader.go.html#6263251">dx</a></span>&nbsp;<span class="comment" id="6263456">//&nbsp;steps&nbsp;through&nbsp;the&nbsp;output&nbsp;as&nbsp;defined&nbsp;by&nbsp;pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6263506">for</span>&nbsp;<span class="ident" id="6263510">y</span>&nbsp;<span class="op" id="6263512">:=</span>&nbsp;<span class="ident" id="6263515"><a href="/image/gif/reader.go.html#6263399">pass</a></span><span class="op" id="6263519">.</span><span class="ident" id="6263520">start</span><span class="op" id="6263525">;</span>&nbsp;<span class="ident" id="6263527"><a href="/image/gif/reader.go.html#6263510">y</a></span>&nbsp;<span class="op" id="6263529">&lt;</span>&nbsp;<span class="ident" id="6263531"><a href="/image/gif/reader.go.html#6263274">dy</a></span><span class="op" id="6263533">;</span>&nbsp;<span class="ident" id="6263535"><a href="/image/gif/reader.go.html#6263510">y</a></span>&nbsp;<span class="op" id="6263537">+=</span>&nbsp;<span class="ident" id="6263540"><a href="/image/gif/reader.go.html#6263399">pass</a></span><span class="op" id="6263544">.</span><span class="ident" id="6263545">skip</span>&nbsp;<span class="op" id="6263550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6263555">copy</span><span class="op" id="6263559">(</span><span class="ident" id="6263560"><a href="/image/gif/reader.go.html#6263237">nPix</a></span><span class="op" id="6263564">[</span><span class="ident" id="6263565"><a href="/image/gif/reader.go.html#6263429">nOffset</a></span><span class="op" id="6263572">:</span><span class="ident" id="6263573"><a href="/image/gif/reader.go.html#6263429">nOffset</a></span><span class="op" id="6263580">+</span><span class="ident" id="6263581"><a href="/image/gif/reader.go.html#6263251">dx</a></span><span class="op" id="6263583">]</span><span class="op" id="6263584">,</span>&nbsp;<span class="ident" id="6263586"><a href="/image/gif/reader.go.html#6263211">m</a></span><span class="op" id="6263587">.</span><span class="ident" id="6263588">Pix</span><span class="op" id="6263591">[</span><span class="ident" id="6263592"><a href="/image/gif/reader.go.html#6263326">offset</a></span><span class="op" id="6263598">:</span><span class="ident" id="6263599"><a href="/image/gif/reader.go.html#6263326">offset</a></span><span class="op" id="6263605">+</span><span class="ident" id="6263606"><a href="/image/gif/reader.go.html#6263251">dx</a></span><span class="op" id="6263608">]</span><span class="op" id="6263609">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263614"><a href="/image/gif/reader.go.html#6263326">offset</a></span>&nbsp;<span class="op" id="6263621">+=</span>&nbsp;<span class="ident" id="6263624"><a href="/image/gif/reader.go.html#6263251">dx</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263630"><a href="/image/gif/reader.go.html#6263429">nOffset</a></span>&nbsp;<span class="op" id="6263638">+=</span>&nbsp;<span class="ident" id="6263641"><a href="/image/gif/reader.go.html#6263251">dx</a></span>&nbsp;<span class="op" id="6263644">*</span>&nbsp;<span class="ident" id="6263646"><a href="/image/gif/reader.go.html#6263399">pass</a></span><span class="op" id="6263650">.</span><span class="ident" id="6263651">skip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6263658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6263661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6263664"><a href="/image/gif/reader.go.html#6263211">m</a></span><span class="op" id="6263665">.</span><span class="ident" id="6263666">Pix</span>&nbsp;<span class="op" id="6263670">=</span>&nbsp;<span class="ident" id="6263672"><a href="/image/gif/reader.go.html#6263237">nPix</a></span><br>
<span class="lineno">415</span><span class="op" id="6263677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6263680">//&nbsp;Decode&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;the&nbsp;first&nbsp;embedded</span><br>
<span class="lineno"></span><span class="comment" id="6263746">//&nbsp;image&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="keyword" id="6263774">func</span>&nbsp;<span class="ident" id="6263779">Decode</span><span class="op" id="6263785">(</span><span class="ident" id="6263786">r</span>&nbsp;<span class="ident" id="6263788"><a href="/image/gif/reader.go.html#6253781">io</a></span><span class="op" id="6263790">.</span><span class="ident" id="6263791">Reader</span><span class="op" id="6263797">)</span>&nbsp;<span class="op" id="6263799">(</span><span class="ident" id="6263800"><a href="/image/gif/reader.go.html#6253757">image</a></span><span class="op" id="6263805">.</span><span class="ident" id="6263806">Image</span><span class="op" id="6263811">,</span>&nbsp;<span class="builtintype" id="6263813">error</span><span class="op" id="6263818">)</span>&nbsp;<span class="op" id="6263820">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6263823">var</span>&nbsp;<span class="ident" id="6263827">d</span>&nbsp;<span class="ident" id="6263829"><a href="/image/gif/reader.go.html#6254680">decoder</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6263838">if</span>&nbsp;<span class="ident" id="6263841">err</span>&nbsp;<span class="op" id="6263845">:=</span>&nbsp;<span class="ident" id="6263848"><a href="/image/gif/reader.go.html#6263827">d</a></span><span class="op" id="6263849">.</span><span class="ident" id="6263850">decode</span><span class="op" id="6263856">(</span><span class="ident" id="6263857"><a href="/image/gif/reader.go.html#6263786">r</a></span><span class="op" id="6263858">,</span>&nbsp;<span class="builtintype" id="6263860">false</span><span class="op" id="6263865">)</span><span class="op" id="6263866">;</span>&nbsp;<span class="ident" id="6263868"><a href="/image/gif/reader.go.html#6263841">err</a></span>&nbsp;<span class="op" id="6263872">!=</span>&nbsp;<span class="ident" id="6263875">nil</span>&nbsp;<span class="op" id="6263879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6263883">return</span>&nbsp;<span class="ident" id="6263890">nil</span><span class="op" id="6263893">,</span>&nbsp;<span class="ident" id="6263895"><a href="/image/gif/reader.go.html#6263841">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6263900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6263903">return</span>&nbsp;<span class="ident" id="6263910"><a href="/image/gif/reader.go.html#6263827">d</a></span><span class="op" id="6263911">.</span><span class="ident" id="6263912">image</span><span class="op" id="6263917">[</span><span class="num" id="6263918">0</span><span class="op" id="6263919">]</span><span class="op" id="6263920">,</span>&nbsp;<span class="ident" id="6263922">nil</span><br>
<span class="lineno">425</span><span class="op" id="6263926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6263929">//&nbsp;GIF&nbsp;represents&nbsp;the&nbsp;possibly&nbsp;multiple&nbsp;images&nbsp;stored&nbsp;in&nbsp;a&nbsp;GIF&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6263998">type</span>&nbsp;<span class="ident" id="6264003">GIF</span>&nbsp;<span class="keyword" id="6264007">struct</span>&nbsp;<span class="op" id="6264014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264017">Image</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6264027">[</span><span class="op" id="6264028">]</span><span class="op" id="6264029">*</span><span class="ident" id="6264030"><a href="/image/gif/reader.go.html#6253757">image</a></span><span class="op" id="6264035">.</span><span class="ident" id="6264036">Paletted</span>&nbsp;<span class="comment" id="6264045">//&nbsp;The&nbsp;successive&nbsp;images.</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264072">Delay</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6264082">[</span><span class="op" id="6264083">]</span><span class="builtintype" id="6264084">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6264100">//&nbsp;The&nbsp;successive&nbsp;delay&nbsp;times,&nbsp;one&nbsp;per&nbsp;frame,&nbsp;in&nbsp;100ths&nbsp;of&nbsp;a&nbsp;second.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264170">LoopCount</span>&nbsp;<span class="builtintype" id="6264180">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6264198">//&nbsp;The&nbsp;loop&nbsp;count.</span><br>
<span class="lineno"></span><span class="op" id="6264217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6264220">//&nbsp;DecodeAll&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;the&nbsp;sequential&nbsp;frames</span><br>
<span class="lineno">435</span><span class="comment" id="6264292">//&nbsp;and&nbsp;timing&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="6264319">func</span>&nbsp;<span class="ident" id="6264324">DecodeAll</span><span class="op" id="6264333">(</span><span class="ident" id="6264334">r</span>&nbsp;<span class="ident" id="6264336"><a href="/image/gif/reader.go.html#6253781">io</a></span><span class="op" id="6264338">.</span><span class="ident" id="6264339">Reader</span><span class="op" id="6264345">)</span>&nbsp;<span class="op" id="6264347">(</span><span class="op" id="6264348">*</span><span class="ident" id="6264349"><a href="/image/gif/reader.go.html#6264003">GIF</a></span><span class="op" id="6264352">,</span>&nbsp;<span class="builtintype" id="6264354">error</span><span class="op" id="6264359">)</span>&nbsp;<span class="op" id="6264361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6264364">var</span>&nbsp;<span class="ident" id="6264368">d</span>&nbsp;<span class="ident" id="6264370"><a href="/image/gif/reader.go.html#6254680">decoder</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6264379">if</span>&nbsp;<span class="ident" id="6264382">err</span>&nbsp;<span class="op" id="6264386">:=</span>&nbsp;<span class="ident" id="6264389"><a href="/image/gif/reader.go.html#6264368">d</a></span><span class="op" id="6264390">.</span><span class="ident" id="6264391">decode</span><span class="op" id="6264397">(</span><span class="ident" id="6264398"><a href="/image/gif/reader.go.html#6264334">r</a></span><span class="op" id="6264399">,</span>&nbsp;<span class="builtintype" id="6264401">false</span><span class="op" id="6264406">)</span><span class="op" id="6264407">;</span>&nbsp;<span class="ident" id="6264409"><a href="/image/gif/reader.go.html#6264382">err</a></span>&nbsp;<span class="op" id="6264413">!=</span>&nbsp;<span class="ident" id="6264416">nil</span>&nbsp;<span class="op" id="6264420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6264424">return</span>&nbsp;<span class="ident" id="6264431">nil</span><span class="op" id="6264434">,</span>&nbsp;<span class="ident" id="6264436"><a href="/image/gif/reader.go.html#6264382">err</a></span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6264441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264444">gif</span>&nbsp;<span class="op" id="6264448">:=</span>&nbsp;<span class="op" id="6264451">&amp;</span><span class="ident" id="6264452"><a href="/image/gif/reader.go.html#6264003">GIF</a></span><span class="op" id="6264455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264459">Image</span><span class="op" id="6264464">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6264470"><a href="/image/gif/reader.go.html#6264368">d</a></span><span class="op" id="6264471">.</span><span class="ident" id="6264472">image</span><span class="op" id="6264477">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264481">LoopCount</span><span class="op" id="6264490">:</span>&nbsp;<span class="ident" id="6264492"><a href="/image/gif/reader.go.html#6264368">d</a></span><span class="op" id="6264493">.</span><span class="ident" id="6264494">loopCount</span><span class="op" id="6264503">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264507">Delay</span><span class="op" id="6264512">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6264518"><a href="/image/gif/reader.go.html#6264368">d</a></span><span class="op" id="6264519">.</span><span class="ident" id="6264520">delay</span><span class="op" id="6264525">,</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6264528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6264531">return</span>&nbsp;<span class="ident" id="6264538"><a href="/image/gif/reader.go.html#6264444">gif</a></span><span class="op" id="6264541">,</span>&nbsp;<span class="ident" id="6264543">nil</span><br>
<span class="lineno"></span><span class="op" id="6264547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6264550">//&nbsp;DecodeConfig&nbsp;returns&nbsp;the&nbsp;global&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions&nbsp;of&nbsp;a&nbsp;GIF&nbsp;image</span><br>
<span class="lineno">450</span><span class="comment" id="6264627">//&nbsp;without&nbsp;decoding&nbsp;the&nbsp;entire&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="6264665">func</span>&nbsp;<span class="ident" id="6264670">DecodeConfig</span><span class="op" id="6264682">(</span><span class="ident" id="6264683">r</span>&nbsp;<span class="ident" id="6264685"><a href="/image/gif/reader.go.html#6253781">io</a></span><span class="op" id="6264687">.</span><span class="ident" id="6264688">Reader</span><span class="op" id="6264694">)</span>&nbsp;<span class="op" id="6264696">(</span><span class="ident" id="6264697"><a href="/image/gif/reader.go.html#6253757">image</a></span><span class="op" id="6264702">.</span><span class="ident" id="6264703">Config</span><span class="op" id="6264709">,</span>&nbsp;<span class="builtintype" id="6264711">error</span><span class="op" id="6264716">)</span>&nbsp;<span class="op" id="6264718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6264721">var</span>&nbsp;<span class="ident" id="6264725">d</span>&nbsp;<span class="ident" id="6264727"><a href="/image/gif/reader.go.html#6254680">decoder</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6264736">if</span>&nbsp;<span class="ident" id="6264739">err</span>&nbsp;<span class="op" id="6264743">:=</span>&nbsp;<span class="ident" id="6264746"><a href="/image/gif/reader.go.html#6264725">d</a></span><span class="op" id="6264747">.</span><span class="ident" id="6264748">decode</span><span class="op" id="6264754">(</span><span class="ident" id="6264755"><a href="/image/gif/reader.go.html#6264683">r</a></span><span class="op" id="6264756">,</span>&nbsp;<span class="builtintype" id="6264758">true</span><span class="op" id="6264762">)</span><span class="op" id="6264763">;</span>&nbsp;<span class="ident" id="6264765"><a href="/image/gif/reader.go.html#6264739">err</a></span>&nbsp;<span class="op" id="6264769">!=</span>&nbsp;<span class="ident" id="6264772">nil</span>&nbsp;<span class="op" id="6264776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6264780">return</span>&nbsp;<span class="ident" id="6264787"><a href="/image/gif/reader.go.html#6253757">image</a></span><span class="op" id="6264792">.</span><span class="ident" id="6264793">Config</span><span class="op" id="6264799">{</span><span class="op" id="6264800">}</span><span class="op" id="6264801">,</span>&nbsp;<span class="ident" id="6264803"><a href="/image/gif/reader.go.html#6264739">err</a></span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6264808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6264811">return</span>&nbsp;<span class="ident" id="6264818"><a href="/image/gif/reader.go.html#6253757">image</a></span><span class="op" id="6264823">.</span><span class="ident" id="6264824">Config</span><span class="op" id="6264830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264834">ColorModel</span><span class="op" id="6264844">:</span>&nbsp;<span class="ident" id="6264846"><a href="/image/gif/reader.go.html#6264725">d</a></span><span class="op" id="6264847">.</span><span class="ident" id="6264848">globalColorMap</span><span class="op" id="6264862">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264866">Width</span><span class="op" id="6264871">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6264878"><a href="/image/gif/reader.go.html#6264725">d</a></span><span class="op" id="6264879">.</span><span class="ident" id="6264880">width</span><span class="op" id="6264885">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264889">Height</span><span class="op" id="6264895">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6264901"><a href="/image/gif/reader.go.html#6264725">d</a></span><span class="op" id="6264902">.</span><span class="ident" id="6264903">height</span><span class="op" id="6264909">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6264912">}</span><span class="op" id="6264913">,</span>&nbsp;<span class="ident" id="6264915">nil</span><br>
<span class="lineno"></span><span class="op" id="6264919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6264922">func</span>&nbsp;<span class="ident" id="6264927">init</span><span class="op" id="6264931">(</span><span class="op" id="6264932">)</span>&nbsp;<span class="op" id="6264934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6264937"><a href="/image/gif/reader.go.html#6253757">image</a></span><span class="op" id="6264942">.</span><span class="ident" id="6264943">RegisterFormat</span><span class="op" id="6264957">(</span><span class="string" id="6264958">&#34;gif&#34;</span><span class="op" id="6264963">,</span>&nbsp;<span class="string" id="6264965">&#34;GIF8?a&#34;</span><span class="op" id="6264973">,</span>&nbsp;<span class="ident" id="6264975"><a href="/image/gif/reader.go.html#6263779">Decode</a></span><span class="op" id="6264981">,</span>&nbsp;<span class="ident" id="6264983"><a href="/image/gif/reader.go.html#6264670">DecodeConfig</a></span><span class="op" id="6264995">)</span><br>
<span class="lineno">465</span><span class="op" id="6264997">}</span>
</div>
</body>
</html>
