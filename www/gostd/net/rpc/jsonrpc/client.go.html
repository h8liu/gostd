<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc/jsonrpc</h2>
<ul>
<li><a href="/gostd/net/rpc/jsonrpc/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/net/rpc/jsonrpc/client.go.html" class="current">client.go</a></li>
<li><a href="/gostd/net/rpc/jsonrpc/server.go.html">server.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5610523">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5610579">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5610633">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5610684">//&nbsp;Package&nbsp;jsonrpc&nbsp;implements&nbsp;a&nbsp;JSON-RPC&nbsp;ClientCodec&nbsp;and&nbsp;ServerCodec</span><br>
<span class="lineno"></span><span class="comment" id="5610753">//&nbsp;for&nbsp;the&nbsp;rpc&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="5610777">package</span>&nbsp;<span class="ident" id="5610785">jsonrpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5610794">import</span>&nbsp;<span class="op" id="5610801">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5610804">&#34;encoding/json&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5610821">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5610828">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5610834">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5610841">&#34;net/rpc&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5610852">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5610859">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5610862">type</span>&nbsp;<span class="ident" id="5610867">clientCodec</span>&nbsp;<span class="keyword" id="5610879">struct</span>&nbsp;<span class="op" id="5610886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610889">dec</span>&nbsp;<span class="op" id="5610893">*</span><span class="ident" id="5610894">json</span><span class="op" id="5610898">.</span><span class="ident" id="5610899">Decoder</span>&nbsp;<span class="comment" id="5610907">//&nbsp;for&nbsp;reading&nbsp;JSON&nbsp;values</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610935">enc</span>&nbsp;<span class="op" id="5610939">*</span><span class="ident" id="5610940">json</span><span class="op" id="5610944">.</span><span class="ident" id="5610945">Encoder</span>&nbsp;<span class="comment" id="5610953">//&nbsp;for&nbsp;writing&nbsp;JSON&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610981">c</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5610985">io</span><span class="op" id="5610987">.</span><span class="ident" id="5610988">Closer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5610997">//&nbsp;temporary&nbsp;work&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611022">req</span>&nbsp;&nbsp;<span class="ident" id="5611027">clientRequest</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611042">resp</span>&nbsp;<span class="ident" id="5611047">clientResponse</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5611064">//&nbsp;JSON-RPC&nbsp;responses&nbsp;include&nbsp;the&nbsp;request&nbsp;id&nbsp;but&nbsp;not&nbsp;the&nbsp;request&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5611138">//&nbsp;Package&nbsp;rpc&nbsp;expects&nbsp;both.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5611168">//&nbsp;We&nbsp;save&nbsp;the&nbsp;request&nbsp;method&nbsp;in&nbsp;pending&nbsp;when&nbsp;sending&nbsp;a&nbsp;request</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5611233">//&nbsp;and&nbsp;then&nbsp;look&nbsp;it&nbsp;up&nbsp;by&nbsp;request&nbsp;ID&nbsp;when&nbsp;filling&nbsp;out&nbsp;the&nbsp;rpc&nbsp;Response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611306">mutex</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5611314">sync</span><span class="op" id="5611318">.</span><span class="ident" id="5611319">Mutex</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5611332">//&nbsp;protects&nbsp;pending</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611353">pending</span>&nbsp;<span class="keyword" id="5611361">map</span><span class="op" id="5611364">[</span><span class="ident" id="5611365">uint64</span><span class="op" id="5611371">]</span><span class="builtintype" id="5611372">string</span>&nbsp;<span class="comment" id="5611379">//&nbsp;map&nbsp;request&nbsp;id&nbsp;to&nbsp;method&nbsp;name</span><br>
<span class="lineno"></span><span class="op" id="5611412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="5611415">//&nbsp;NewClientCodec&nbsp;returns&nbsp;a&nbsp;new&nbsp;rpc.ClientCodec&nbsp;using&nbsp;JSON-RPC&nbsp;on&nbsp;conn.</span><br>
<span class="lineno"></span><span class="keyword" id="5611487">func</span>&nbsp;<span class="ident" id="5611492">NewClientCodec</span><span class="op" id="5611506">(</span><span class="ident" id="5611507">conn</span>&nbsp;<span class="ident" id="5611512">io</span><span class="op" id="5611514">.</span><span class="ident" id="5611515">ReadWriteCloser</span><span class="op" id="5611530">)</span>&nbsp;<span class="ident" id="5611532">rpc</span><span class="op" id="5611535">.</span><span class="ident" id="5611536">ClientCodec</span>&nbsp;<span class="op" id="5611548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611551">return</span>&nbsp;<span class="op" id="5611558">&amp;</span><span class="ident" id="5611559">clientCodec</span><span class="op" id="5611570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611574">dec</span><span class="op" id="5611577">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5611583">json</span><span class="op" id="5611587">.</span><span class="ident" id="5611588">NewDecoder</span><span class="op" id="5611598">(</span><span class="ident" id="5611599">conn</span><span class="op" id="5611603">)</span><span class="op" id="5611604">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611608">enc</span><span class="op" id="5611611">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5611617">json</span><span class="op" id="5611621">.</span><span class="ident" id="5611622">NewEncoder</span><span class="op" id="5611632">(</span><span class="ident" id="5611633">conn</span><span class="op" id="5611637">)</span><span class="op" id="5611638">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611642">c</span><span class="op" id="5611643">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5611651">conn</span><span class="op" id="5611655">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611659">pending</span><span class="op" id="5611666">:</span>&nbsp;<span class="builtinfunc" id="5611668">make</span><span class="op" id="5611672">(</span><span class="keyword" id="5611673">map</span><span class="op" id="5611676">[</span><span class="ident" id="5611677">uint64</span><span class="op" id="5611683">]</span><span class="builtintype" id="5611684">string</span><span class="op" id="5611690">)</span><span class="op" id="5611691">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5611694">}</span><br>
<span class="lineno"></span><span class="op" id="5611696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="5611699">type</span>&nbsp;<span class="ident" id="5611704">clientRequest</span>&nbsp;<span class="keyword" id="5611718">struct</span>&nbsp;<span class="op" id="5611725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611728">Method</span>&nbsp;<span class="builtintype" id="5611735">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5611750">`json:&#34;method&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611767">Params</span>&nbsp;<span class="op" id="5611774">[</span><span class="num" id="5611775">1</span><span class="op" id="5611776">]</span><span class="keyword" id="5611777">interface</span><span class="op" id="5611786">{</span><span class="op" id="5611787">}</span>&nbsp;<span class="string" id="5611789">`json:&#34;params&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611806">Id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5611813">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5611828">`json:&#34;id&#34;`</span><br>
<span class="lineno"></span><span class="op" id="5611840">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="5611843">func</span>&nbsp;<span class="op" id="5611848">(</span><span class="ident" id="5611849">c</span>&nbsp;<span class="op" id="5611851">*</span><span class="ident" id="5611852">clientCodec</span><span class="op" id="5611863">)</span>&nbsp;<span class="ident" id="5611865">WriteRequest</span><span class="op" id="5611877">(</span><span class="ident" id="5611878">r</span>&nbsp;<span class="op" id="5611880">*</span><span class="ident" id="5611881">rpc</span><span class="op" id="5611884">.</span><span class="ident" id="5611885">Request</span><span class="op" id="5611892">,</span>&nbsp;<span class="ident" id="5611894">param</span>&nbsp;<span class="keyword" id="5611900">interface</span><span class="op" id="5611909">{</span><span class="op" id="5611910">}</span><span class="op" id="5611911">)</span>&nbsp;<span class="builtintype" id="5611913">error</span>&nbsp;<span class="op" id="5611919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611922">c</span><span class="op" id="5611923">.</span><span class="ident" id="5611924">mutex</span><span class="op" id="5611929">.</span><span class="ident" id="5611930">Lock</span><span class="op" id="5611934">(</span><span class="op" id="5611935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611938">c</span><span class="op" id="5611939">.</span><span class="ident" id="5611940">pending</span><span class="op" id="5611947">[</span><span class="ident" id="5611948">r</span><span class="op" id="5611949">.</span><span class="ident" id="5611950">Seq</span><span class="op" id="5611953">]</span>&nbsp;<span class="op" id="5611955">=</span>&nbsp;<span class="ident" id="5611957">r</span><span class="op" id="5611958">.</span><span class="ident" id="5611959">ServiceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611974">c</span><span class="op" id="5611975">.</span><span class="ident" id="5611976">mutex</span><span class="op" id="5611981">.</span><span class="ident" id="5611982">Unlock</span><span class="op" id="5611988">(</span><span class="op" id="5611989">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611992">c</span><span class="op" id="5611993">.</span><span class="ident" id="5611994">req</span><span class="op" id="5611997">.</span><span class="ident" id="5611998">Method</span>&nbsp;<span class="op" id="5612005">=</span>&nbsp;<span class="ident" id="5612007">r</span><span class="op" id="5612008">.</span><span class="ident" id="5612009">ServiceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612024">c</span><span class="op" id="5612025">.</span><span class="ident" id="5612026">req</span><span class="op" id="5612029">.</span><span class="ident" id="5612030">Params</span><span class="op" id="5612036">[</span><span class="num" id="5612037">0</span><span class="op" id="5612038">]</span>&nbsp;<span class="op" id="5612040">=</span>&nbsp;<span class="ident" id="5612042">param</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612049">c</span><span class="op" id="5612050">.</span><span class="ident" id="5612051">req</span><span class="op" id="5612054">.</span><span class="ident" id="5612055">Id</span>&nbsp;<span class="op" id="5612058">=</span>&nbsp;<span class="ident" id="5612060">r</span><span class="op" id="5612061">.</span><span class="ident" id="5612062">Seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5612067">return</span>&nbsp;<span class="ident" id="5612074">c</span><span class="op" id="5612075">.</span><span class="ident" id="5612076">enc</span><span class="op" id="5612079">.</span><span class="ident" id="5612080">Encode</span><span class="op" id="5612086">(</span><span class="op" id="5612087">&amp;</span><span class="ident" id="5612088">c</span><span class="op" id="5612089">.</span><span class="ident" id="5612090">req</span><span class="op" id="5612093">)</span><br>
<span class="lineno"></span><span class="op" id="5612095">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="5612098">type</span>&nbsp;<span class="ident" id="5612103">clientResponse</span>&nbsp;<span class="keyword" id="5612118">struct</span>&nbsp;<span class="op" id="5612125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612128">Id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5612135">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5612152">`json:&#34;id&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612165">Result</span>&nbsp;<span class="op" id="5612172">*</span><span class="ident" id="5612173">json</span><span class="op" id="5612177">.</span><span class="ident" id="5612178">RawMessage</span>&nbsp;<span class="string" id="5612189">`json:&#34;result&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612206">Error</span>&nbsp;&nbsp;<span class="keyword" id="5612213">interface</span><span class="op" id="5612222">{</span><span class="op" id="5612223">}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5612230">`json:&#34;error&#34;`</span><br>
<span class="lineno">65</span><span class="op" id="5612245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5612248">func</span>&nbsp;<span class="op" id="5612253">(</span><span class="ident" id="5612254">r</span>&nbsp;<span class="op" id="5612256">*</span><span class="ident" id="5612257">clientResponse</span><span class="op" id="5612271">)</span>&nbsp;<span class="ident" id="5612273">reset</span><span class="op" id="5612278">(</span><span class="op" id="5612279">)</span>&nbsp;<span class="op" id="5612281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612284">r</span><span class="op" id="5612285">.</span><span class="ident" id="5612286">Id</span>&nbsp;<span class="op" id="5612289">=</span>&nbsp;<span class="num" id="5612291">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612294">r</span><span class="op" id="5612295">.</span><span class="ident" id="5612296">Result</span>&nbsp;<span class="op" id="5612303">=</span>&nbsp;<span class="ident" id="5612305">nil</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612310">r</span><span class="op" id="5612311">.</span><span class="ident" id="5612312">Error</span>&nbsp;<span class="op" id="5612318">=</span>&nbsp;<span class="ident" id="5612320">nil</span><br>
<span class="lineno"></span><span class="op" id="5612324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5612327">func</span>&nbsp;<span class="op" id="5612332">(</span><span class="ident" id="5612333">c</span>&nbsp;<span class="op" id="5612335">*</span><span class="ident" id="5612336">clientCodec</span><span class="op" id="5612347">)</span>&nbsp;<span class="ident" id="5612349">ReadResponseHeader</span><span class="op" id="5612367">(</span><span class="ident" id="5612368">r</span>&nbsp;<span class="op" id="5612370">*</span><span class="ident" id="5612371">rpc</span><span class="op" id="5612374">.</span><span class="ident" id="5612375">Response</span><span class="op" id="5612383">)</span>&nbsp;<span class="builtintype" id="5612385">error</span>&nbsp;<span class="op" id="5612391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612394">c</span><span class="op" id="5612395">.</span><span class="ident" id="5612396">resp</span><span class="op" id="5612400">.</span><span class="ident" id="5612401">reset</span><span class="op" id="5612406">(</span><span class="op" id="5612407">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5612410">if</span>&nbsp;<span class="ident" id="5612413">err</span>&nbsp;<span class="op" id="5612417">:=</span>&nbsp;<span class="ident" id="5612420">c</span><span class="op" id="5612421">.</span><span class="ident" id="5612422">dec</span><span class="op" id="5612425">.</span><span class="ident" id="5612426">Decode</span><span class="op" id="5612432">(</span><span class="op" id="5612433">&amp;</span><span class="ident" id="5612434">c</span><span class="op" id="5612435">.</span><span class="ident" id="5612436">resp</span><span class="op" id="5612440">)</span><span class="op" id="5612441">;</span>&nbsp;<span class="ident" id="5612443">err</span>&nbsp;<span class="op" id="5612447">!=</span>&nbsp;<span class="ident" id="5612450">nil</span>&nbsp;<span class="op" id="5612454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5612458">return</span>&nbsp;<span class="ident" id="5612465">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5612470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612474">c</span><span class="op" id="5612475">.</span><span class="ident" id="5612476">mutex</span><span class="op" id="5612481">.</span><span class="ident" id="5612482">Lock</span><span class="op" id="5612486">(</span><span class="op" id="5612487">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612490">r</span><span class="op" id="5612491">.</span><span class="ident" id="5612492">ServiceMethod</span>&nbsp;<span class="op" id="5612506">=</span>&nbsp;<span class="ident" id="5612508">c</span><span class="op" id="5612509">.</span><span class="ident" id="5612510">pending</span><span class="op" id="5612517">[</span><span class="ident" id="5612518">c</span><span class="op" id="5612519">.</span><span class="ident" id="5612520">resp</span><span class="op" id="5612524">.</span><span class="ident" id="5612525">Id</span><span class="op" id="5612527">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5612530">delete</span><span class="op" id="5612536">(</span><span class="ident" id="5612537">c</span><span class="op" id="5612538">.</span><span class="ident" id="5612539">pending</span><span class="op" id="5612546">,</span>&nbsp;<span class="ident" id="5612548">c</span><span class="op" id="5612549">.</span><span class="ident" id="5612550">resp</span><span class="op" id="5612554">.</span><span class="ident" id="5612555">Id</span><span class="op" id="5612557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612560">c</span><span class="op" id="5612561">.</span><span class="ident" id="5612562">mutex</span><span class="op" id="5612567">.</span><span class="ident" id="5612568">Unlock</span><span class="op" id="5612574">(</span><span class="op" id="5612575">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612579">r</span><span class="op" id="5612580">.</span><span class="ident" id="5612581">Error</span>&nbsp;<span class="op" id="5612587">=</span>&nbsp;<span class="string" id="5612589">&#34;&#34;</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612593">r</span><span class="op" id="5612594">.</span><span class="ident" id="5612595">Seq</span>&nbsp;<span class="op" id="5612599">=</span>&nbsp;<span class="ident" id="5612601">c</span><span class="op" id="5612602">.</span><span class="ident" id="5612603">resp</span><span class="op" id="5612607">.</span><span class="ident" id="5612608">Id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5612612">if</span>&nbsp;<span class="ident" id="5612615">c</span><span class="op" id="5612616">.</span><span class="ident" id="5612617">resp</span><span class="op" id="5612621">.</span><span class="ident" id="5612622">Error</span>&nbsp;<span class="op" id="5612628">!=</span>&nbsp;<span class="ident" id="5612631">nil</span>&nbsp;<span class="op" id="5612635">||</span>&nbsp;<span class="ident" id="5612638">c</span><span class="op" id="5612639">.</span><span class="ident" id="5612640">resp</span><span class="op" id="5612644">.</span><span class="ident" id="5612645">Result</span>&nbsp;<span class="op" id="5612652">==</span>&nbsp;<span class="ident" id="5612655">nil</span>&nbsp;<span class="op" id="5612659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612663">x</span><span class="op" id="5612664">,</span>&nbsp;<span class="ident" id="5612666">ok</span>&nbsp;<span class="op" id="5612669">:=</span>&nbsp;<span class="ident" id="5612672">c</span><span class="op" id="5612673">.</span><span class="ident" id="5612674">resp</span><span class="op" id="5612678">.</span><span class="ident" id="5612679">Error</span><span class="op" id="5612684">.</span><span class="op" id="5612685">(</span><span class="builtintype" id="5612686">string</span><span class="op" id="5612692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5612696">if</span>&nbsp;<span class="op" id="5612699">!</span><span class="ident" id="5612700">ok</span>&nbsp;<span class="op" id="5612703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5612708">return</span>&nbsp;<span class="ident" id="5612715">fmt</span><span class="op" id="5612718">.</span><span class="ident" id="5612719">Errorf</span><span class="op" id="5612725">(</span><span class="string" id="5612726">&#34;invalid&nbsp;error&nbsp;%v&#34;</span><span class="op" id="5612744">,</span>&nbsp;<span class="ident" id="5612746">c</span><span class="op" id="5612747">.</span><span class="ident" id="5612748">resp</span><span class="op" id="5612752">.</span><span class="ident" id="5612753">Error</span><span class="op" id="5612758">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5612762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5612766">if</span>&nbsp;<span class="ident" id="5612769">x</span>&nbsp;<span class="op" id="5612771">==</span>&nbsp;<span class="string" id="5612774">&#34;&#34;</span>&nbsp;<span class="op" id="5612777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612782">x</span>&nbsp;<span class="op" id="5612784">=</span>&nbsp;<span class="string" id="5612786">&#34;unspecified&nbsp;error&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5612808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612812">r</span><span class="op" id="5612813">.</span><span class="ident" id="5612814">Error</span>&nbsp;<span class="op" id="5612820">=</span>&nbsp;<span class="ident" id="5612822">x</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5612825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5612828">return</span>&nbsp;<span class="ident" id="5612835">nil</span><br>
<span class="lineno"></span><span class="op" id="5612839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5612842">func</span>&nbsp;<span class="op" id="5612847">(</span><span class="ident" id="5612848">c</span>&nbsp;<span class="op" id="5612850">*</span><span class="ident" id="5612851">clientCodec</span><span class="op" id="5612862">)</span>&nbsp;<span class="ident" id="5612864">ReadResponseBody</span><span class="op" id="5612880">(</span><span class="ident" id="5612881">x</span>&nbsp;<span class="keyword" id="5612883">interface</span><span class="op" id="5612892">{</span><span class="op" id="5612893">}</span><span class="op" id="5612894">)</span>&nbsp;<span class="builtintype" id="5612896">error</span>&nbsp;<span class="op" id="5612902">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5612905">if</span>&nbsp;<span class="ident" id="5612908">x</span>&nbsp;<span class="op" id="5612910">==</span>&nbsp;<span class="ident" id="5612913">nil</span>&nbsp;<span class="op" id="5612917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5612921">return</span>&nbsp;<span class="ident" id="5612928">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5612933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5612936">return</span>&nbsp;<span class="ident" id="5612943">json</span><span class="op" id="5612947">.</span><span class="ident" id="5612948">Unmarshal</span><span class="op" id="5612957">(</span><span class="op" id="5612958">*</span><span class="ident" id="5612959">c</span><span class="op" id="5612960">.</span><span class="ident" id="5612961">resp</span><span class="op" id="5612965">.</span><span class="ident" id="5612966">Result</span><span class="op" id="5612972">,</span>&nbsp;<span class="ident" id="5612974">x</span><span class="op" id="5612975">)</span><br>
<span class="lineno"></span><span class="op" id="5612977">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="5612980">func</span>&nbsp;<span class="op" id="5612985">(</span><span class="ident" id="5612986">c</span>&nbsp;<span class="op" id="5612988">*</span><span class="ident" id="5612989">clientCodec</span><span class="op" id="5613000">)</span>&nbsp;<span class="ident" id="5613002">Close</span><span class="op" id="5613007">(</span><span class="op" id="5613008">)</span>&nbsp;<span class="builtintype" id="5613010">error</span>&nbsp;<span class="op" id="5613016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613019">return</span>&nbsp;<span class="ident" id="5613026">c</span><span class="op" id="5613027">.</span><span class="ident" id="5613028">c</span><span class="op" id="5613029">.</span><span class="ident" id="5613030">Close</span><span class="op" id="5613035">(</span><span class="op" id="5613036">)</span><br>
<span class="lineno"></span><span class="op" id="5613038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="5613041">//&nbsp;NewClient&nbsp;returns&nbsp;a&nbsp;new&nbsp;rpc.Client&nbsp;to&nbsp;handle&nbsp;requests&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5613105">//&nbsp;set&nbsp;of&nbsp;services&nbsp;at&nbsp;the&nbsp;other&nbsp;end&nbsp;of&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="5613160">func</span>&nbsp;<span class="ident" id="5613165">NewClient</span><span class="op" id="5613174">(</span><span class="ident" id="5613175">conn</span>&nbsp;<span class="ident" id="5613180">io</span><span class="op" id="5613182">.</span><span class="ident" id="5613183">ReadWriteCloser</span><span class="op" id="5613198">)</span>&nbsp;<span class="op" id="5613200">*</span><span class="ident" id="5613201">rpc</span><span class="op" id="5613204">.</span><span class="ident" id="5613205">Client</span>&nbsp;<span class="op" id="5613212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613215">return</span>&nbsp;<span class="ident" id="5613222">rpc</span><span class="op" id="5613225">.</span><span class="ident" id="5613226">NewClientWithCodec</span><span class="op" id="5613244">(</span><span class="ident" id="5613245">NewClientCodec</span><span class="op" id="5613259">(</span><span class="ident" id="5613260">conn</span><span class="op" id="5613264">)</span><span class="op" id="5613265">)</span><br>
<span class="lineno"></span><span class="op" id="5613267">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="5613270">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;a&nbsp;JSON-RPC&nbsp;server&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="5613342">func</span>&nbsp;<span class="ident" id="5613347">Dial</span><span class="op" id="5613351">(</span><span class="ident" id="5613352">network</span><span class="op" id="5613359">,</span>&nbsp;<span class="ident" id="5613361">address</span>&nbsp;<span class="builtintype" id="5613369">string</span><span class="op" id="5613375">)</span>&nbsp;<span class="op" id="5613377">(</span><span class="op" id="5613378">*</span><span class="ident" id="5613379">rpc</span><span class="op" id="5613382">.</span><span class="ident" id="5613383">Client</span><span class="op" id="5613389">,</span>&nbsp;<span class="builtintype" id="5613391">error</span><span class="op" id="5613396">)</span>&nbsp;<span class="op" id="5613398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5613401">conn</span><span class="op" id="5613405">,</span>&nbsp;<span class="ident" id="5613407">err</span>&nbsp;<span class="op" id="5613411">:=</span>&nbsp;<span class="ident" id="5613414">net</span><span class="op" id="5613417">.</span><span class="ident" id="5613418">Dial</span><span class="op" id="5613422">(</span><span class="ident" id="5613423">network</span><span class="op" id="5613430">,</span>&nbsp;<span class="ident" id="5613432">address</span><span class="op" id="5613439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613442">if</span>&nbsp;<span class="ident" id="5613445">err</span>&nbsp;<span class="op" id="5613449">!=</span>&nbsp;<span class="ident" id="5613452">nil</span>&nbsp;<span class="op" id="5613456">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613460">return</span>&nbsp;<span class="ident" id="5613467">nil</span><span class="op" id="5613470">,</span>&nbsp;<span class="ident" id="5613472">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5613477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613480">return</span>&nbsp;<span class="ident" id="5613487">NewClient</span><span class="op" id="5613496">(</span><span class="ident" id="5613497">conn</span><span class="op" id="5613501">)</span><span class="op" id="5613502">,</span>&nbsp;<span class="ident" id="5613504">err</span><br>
<span class="lineno"></span><span class="op" id="5613508">}</span>
</div>
</body>
</html>
