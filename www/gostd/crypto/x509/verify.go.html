<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4254115">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4254170">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4254224">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4254275">package</span>&nbsp;<span class="ident" id="4254283">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4254289">import</span>&nbsp;<span class="op" id="4254296">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4254299">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4254306">&#34;net&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4254313">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4254324">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4254335">&#34;time&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4254343">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4254358">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="4254361">type</span>&nbsp;<span class="ident" id="4254366">InvalidReason</span>&nbsp;<span class="builtintype" id="4254380">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4254385">const</span>&nbsp;<span class="op" id="4254391">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4254394">//&nbsp;NotAuthorizedToSign&nbsp;results&nbsp;when&nbsp;a&nbsp;certificate&nbsp;is&nbsp;signed&nbsp;by&nbsp;another</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4254466">//&nbsp;which&nbsp;isn&#39;t&nbsp;marked&nbsp;as&nbsp;a&nbsp;CA&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4254510">NotAuthorizedToSign</span>&nbsp;<span class="ident" id="4254530">InvalidReason</span>&nbsp;<span class="op" id="4254544">=</span>&nbsp;<span class="ident" id="4254546">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4254552">//&nbsp;Expired&nbsp;results&nbsp;when&nbsp;a&nbsp;certificate&nbsp;has&nbsp;expired,&nbsp;based&nbsp;on&nbsp;the&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4254622">//&nbsp;given&nbsp;in&nbsp;the&nbsp;VerifyOptions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4254654">Expired</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4254663">//&nbsp;CANotAuthorizedForThisName&nbsp;results&nbsp;when&nbsp;an&nbsp;intermediate&nbsp;or&nbsp;root</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4254731">//&nbsp;certificate&nbsp;has&nbsp;a&nbsp;name&nbsp;constraint&nbsp;which&nbsp;doesn&#39;t&nbsp;include&nbsp;the&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4254800">//&nbsp;being&nbsp;checked.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4254819">CANotAuthorizedForThisName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4254847">//&nbsp;TooManyIntermediates&nbsp;results&nbsp;when&nbsp;a&nbsp;path&nbsp;length&nbsp;constraint&nbsp;is</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4254913">//&nbsp;violated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4254927">TooManyIntermediates</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4254949">//&nbsp;IncompatibleUsage&nbsp;results&nbsp;when&nbsp;the&nbsp;certificate&#39;s&nbsp;key&nbsp;usage&nbsp;indicates</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4255022">//&nbsp;that&nbsp;it&nbsp;may&nbsp;only&nbsp;be&nbsp;used&nbsp;for&nbsp;a&nbsp;different&nbsp;purpose.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4255076">IncompatibleUsage</span><br>
<span class="lineno">35</span><span class="op" id="4255094">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4255097">//&nbsp;CertificateInvalidError&nbsp;results&nbsp;when&nbsp;an&nbsp;odd&nbsp;error&nbsp;occurs.&nbsp;Users&nbsp;of&nbsp;this</span><br>
<span class="lineno"></span><span class="comment" id="4255172">//&nbsp;library&nbsp;probably&nbsp;want&nbsp;to&nbsp;handle&nbsp;all&nbsp;these&nbsp;errors&nbsp;uniformly.</span><br>
<span class="lineno"></span><span class="keyword" id="4255235">type</span>&nbsp;<span class="ident" id="4255240">CertificateInvalidError</span>&nbsp;<span class="keyword" id="4255264">struct</span>&nbsp;<span class="op" id="4255271">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4255274">Cert</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4255281">*</span><span class="ident" id="4255282">Certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4255295">Reason</span>&nbsp;<span class="ident" id="4255302">InvalidReason</span><br>
<span class="lineno"></span><span class="op" id="4255316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4255319">func</span>&nbsp;<span class="op" id="4255324">(</span><span class="ident" id="4255325">e</span>&nbsp;<span class="ident" id="4255327">CertificateInvalidError</span><span class="op" id="4255350">)</span>&nbsp;<span class="ident" id="4255352">Error</span><span class="op" id="4255357">(</span><span class="op" id="4255358">)</span>&nbsp;<span class="builtintype" id="4255360">string</span>&nbsp;<span class="op" id="4255367">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255370">switch</span>&nbsp;<span class="ident" id="4255377">e</span><span class="op" id="4255378">.</span><span class="ident" id="4255379">Reason</span>&nbsp;<span class="op" id="4255386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255389">case</span>&nbsp;<span class="ident" id="4255394">NotAuthorizedToSign</span><span class="op" id="4255413">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255417">return</span>&nbsp;<span class="string" id="4255424">&#34;x509:&nbsp;certificate&nbsp;is&nbsp;not&nbsp;authorized&nbsp;to&nbsp;sign&nbsp;other&nbsp;certificates&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255490">case</span>&nbsp;<span class="ident" id="4255495">Expired</span><span class="op" id="4255502">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255506">return</span>&nbsp;<span class="string" id="4255513">&#34;x509:&nbsp;certificate&nbsp;has&nbsp;expired&nbsp;or&nbsp;is&nbsp;not&nbsp;yet&nbsp;valid&#34;</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255566">case</span>&nbsp;<span class="ident" id="4255571">CANotAuthorizedForThisName</span><span class="op" id="4255597">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255601">return</span>&nbsp;<span class="string" id="4255608">&#34;x509:&nbsp;a&nbsp;root&nbsp;or&nbsp;intermediate&nbsp;certificate&nbsp;is&nbsp;not&nbsp;authorized&nbsp;to&nbsp;sign&nbsp;in&nbsp;this&nbsp;domain&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255693">case</span>&nbsp;<span class="ident" id="4255698">TooManyIntermediates</span><span class="op" id="4255718">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255722">return</span>&nbsp;<span class="string" id="4255729">&#34;x509:&nbsp;too&nbsp;many&nbsp;intermediates&nbsp;for&nbsp;path&nbsp;length&nbsp;constraint&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255788">case</span>&nbsp;<span class="ident" id="4255793">IncompatibleUsage</span><span class="op" id="4255810">:</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255814">return</span>&nbsp;<span class="string" id="4255821">&#34;x509:&nbsp;certificate&nbsp;specifies&nbsp;an&nbsp;incompatible&nbsp;key&nbsp;usage&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4255878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255881">return</span>&nbsp;<span class="string" id="4255888">&#34;x509:&nbsp;unknown&nbsp;error&#34;</span><br>
<span class="lineno"></span><span class="op" id="4255910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="4255913">//&nbsp;HostnameError&nbsp;results&nbsp;when&nbsp;the&nbsp;set&nbsp;of&nbsp;authorized&nbsp;names&nbsp;doesn&#39;t&nbsp;match&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4255989">//&nbsp;requested&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="4256008">type</span>&nbsp;<span class="ident" id="4256013">HostnameError</span>&nbsp;<span class="keyword" id="4256027">struct</span>&nbsp;<span class="op" id="4256034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4256037">Certificate</span>&nbsp;<span class="op" id="4256049">*</span><span class="ident" id="4256050">Certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4256063">Host</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4256075">string</span><br>
<span class="lineno">65</span><span class="op" id="4256082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4256085">func</span>&nbsp;<span class="op" id="4256090">(</span><span class="ident" id="4256091">h</span>&nbsp;<span class="ident" id="4256093">HostnameError</span><span class="op" id="4256106">)</span>&nbsp;<span class="ident" id="4256108">Error</span><span class="op" id="4256113">(</span><span class="op" id="4256114">)</span>&nbsp;<span class="builtintype" id="4256116">string</span>&nbsp;<span class="op" id="4256123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4256126">c</span>&nbsp;<span class="op" id="4256128">:=</span>&nbsp;<span class="ident" id="4256131">h</span><span class="op" id="4256132">.</span><span class="ident" id="4256133">Certificate</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256147">var</span>&nbsp;<span class="ident" id="4256151">valid</span>&nbsp;<span class="builtintype" id="4256157">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256165">if</span>&nbsp;<span class="ident" id="4256168">ip</span>&nbsp;<span class="op" id="4256171">:=</span>&nbsp;<span class="ident" id="4256174">net</span><span class="op" id="4256177">.</span><span class="ident" id="4256178">ParseIP</span><span class="op" id="4256185">(</span><span class="ident" id="4256186">h</span><span class="op" id="4256187">.</span><span class="ident" id="4256188">Host</span><span class="op" id="4256192">)</span><span class="op" id="4256193">;</span>&nbsp;<span class="ident" id="4256195">ip</span>&nbsp;<span class="op" id="4256198">!=</span>&nbsp;<span class="ident" id="4256201">nil</span>&nbsp;<span class="op" id="4256205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4256209">//&nbsp;Trying&nbsp;to&nbsp;validate&nbsp;an&nbsp;IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256239">if</span>&nbsp;<span class="builtinfunc" id="4256242">len</span><span class="op" id="4256245">(</span><span class="ident" id="4256246">c</span><span class="op" id="4256247">.</span><span class="ident" id="4256248">IPAddresses</span><span class="op" id="4256259">)</span>&nbsp;<span class="op" id="4256261">==</span>&nbsp;<span class="num" id="4256264">0</span>&nbsp;<span class="op" id="4256266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256271">return</span>&nbsp;<span class="string" id="4256278">&#34;x509:&nbsp;cannot&nbsp;validate&nbsp;certificate&nbsp;for&nbsp;&#34;</span>&nbsp;<span class="op" id="4256319">+</span>&nbsp;<span class="ident" id="4256321">h</span><span class="op" id="4256322">.</span><span class="ident" id="4256323">Host</span>&nbsp;<span class="op" id="4256328">+</span>&nbsp;<span class="string" id="4256330">&#34;&nbsp;because&nbsp;it&nbsp;doesn&#39;t&nbsp;contain&nbsp;any&nbsp;IP&nbsp;SANs&#34;</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4256374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256378">for</span>&nbsp;<span class="ident" id="4256382">_</span><span class="op" id="4256383">,</span>&nbsp;<span class="ident" id="4256385">san</span>&nbsp;<span class="op" id="4256389">:=</span>&nbsp;<span class="keyword" id="4256392">range</span>&nbsp;<span class="ident" id="4256398">c</span><span class="op" id="4256399">.</span><span class="ident" id="4256400">IPAddresses</span>&nbsp;<span class="op" id="4256412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256417">if</span>&nbsp;<span class="builtinfunc" id="4256420">len</span><span class="op" id="4256423">(</span><span class="ident" id="4256424">valid</span><span class="op" id="4256429">)</span>&nbsp;<span class="op" id="4256431">&gt;</span>&nbsp;<span class="num" id="4256433">0</span>&nbsp;<span class="op" id="4256435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4256441">valid</span>&nbsp;<span class="op" id="4256447">+=</span>&nbsp;<span class="string" id="4256450">&#34;,&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4256458">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4256463">valid</span>&nbsp;<span class="op" id="4256469">+=</span>&nbsp;<span class="ident" id="4256472">san</span><span class="op" id="4256475">.</span><span class="ident" id="4256476">String</span><span class="op" id="4256482">(</span><span class="op" id="4256483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4256487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4256490">}</span>&nbsp;<span class="keyword" id="4256492">else</span>&nbsp;<span class="op" id="4256497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256501">if</span>&nbsp;<span class="builtinfunc" id="4256504">len</span><span class="op" id="4256507">(</span><span class="ident" id="4256508">c</span><span class="op" id="4256509">.</span><span class="ident" id="4256510">DNSNames</span><span class="op" id="4256518">)</span>&nbsp;<span class="op" id="4256520">&gt;</span>&nbsp;<span class="num" id="4256522">0</span>&nbsp;<span class="op" id="4256524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4256529">valid</span>&nbsp;<span class="op" id="4256535">=</span>&nbsp;<span class="ident" id="4256537">strings</span><span class="op" id="4256544">.</span><span class="ident" id="4256545">Join</span><span class="op" id="4256549">(</span><span class="ident" id="4256550">c</span><span class="op" id="4256551">.</span><span class="ident" id="4256552">DNSNames</span><span class="op" id="4256560">,</span>&nbsp;<span class="string" id="4256562">&#34;,&nbsp;&#34;</span><span class="op" id="4256566">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4256570">}</span>&nbsp;<span class="keyword" id="4256572">else</span>&nbsp;<span class="op" id="4256577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4256582">valid</span>&nbsp;<span class="op" id="4256588">=</span>&nbsp;<span class="ident" id="4256590">c</span><span class="op" id="4256591">.</span><span class="ident" id="4256592">Subject</span><span class="op" id="4256599">.</span><span class="ident" id="4256600">CommonName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4256613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4256616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256619">return</span>&nbsp;<span class="string" id="4256626">&#34;x509:&nbsp;certificate&nbsp;is&nbsp;valid&nbsp;for&nbsp;&#34;</span>&nbsp;<span class="op" id="4256660">+</span>&nbsp;<span class="ident" id="4256662">valid</span>&nbsp;<span class="op" id="4256668">+</span>&nbsp;<span class="string" id="4256670">&#34;,&nbsp;not&nbsp;&#34;</span>&nbsp;<span class="op" id="4256679">+</span>&nbsp;<span class="ident" id="4256681">h</span><span class="op" id="4256682">.</span><span class="ident" id="4256683">Host</span><br>
<span class="lineno">90</span><span class="op" id="4256688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4256691">//&nbsp;UnknownAuthorityError&nbsp;results&nbsp;when&nbsp;the&nbsp;certificate&nbsp;issuer&nbsp;is&nbsp;unknown</span><br>
<span class="lineno"></span><span class="keyword" id="4256763">type</span>&nbsp;<span class="ident" id="4256768">UnknownAuthorityError</span>&nbsp;<span class="keyword" id="4256790">struct</span>&nbsp;<span class="op" id="4256797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4256800">cert</span>&nbsp;<span class="op" id="4256805">*</span><span class="ident" id="4256806">Certificate</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4256819">//&nbsp;hintErr&nbsp;contains&nbsp;an&nbsp;error&nbsp;that&nbsp;may&nbsp;be&nbsp;helpful&nbsp;in&nbsp;determining&nbsp;why&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4256891">//&nbsp;authority&nbsp;wasn&#39;t&nbsp;found.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4256919">hintErr</span>&nbsp;<span class="builtintype" id="4256927">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4256934">//&nbsp;hintCert&nbsp;contains&nbsp;a&nbsp;possible&nbsp;authority&nbsp;certificate&nbsp;that&nbsp;was&nbsp;rejected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4257007">//&nbsp;because&nbsp;of&nbsp;the&nbsp;error&nbsp;in&nbsp;hintErr.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4257044">hintCert</span>&nbsp;<span class="op" id="4257053">*</span><span class="ident" id="4257054">Certificate</span><br>
<span class="lineno"></span><span class="op" id="4257066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4257069">func</span>&nbsp;<span class="op" id="4257074">(</span><span class="ident" id="4257075">e</span>&nbsp;<span class="ident" id="4257077">UnknownAuthorityError</span><span class="op" id="4257098">)</span>&nbsp;<span class="ident" id="4257100">Error</span><span class="op" id="4257105">(</span><span class="op" id="4257106">)</span>&nbsp;<span class="builtintype" id="4257108">string</span>&nbsp;<span class="op" id="4257115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4257118">s</span>&nbsp;<span class="op" id="4257120">:=</span>&nbsp;<span class="string" id="4257123">&#34;x509:&nbsp;certificate&nbsp;signed&nbsp;by&nbsp;unknown&nbsp;authority&#34;</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4257172">if</span>&nbsp;<span class="ident" id="4257175">e</span><span class="op" id="4257176">.</span><span class="ident" id="4257177">hintErr</span>&nbsp;<span class="op" id="4257185">!=</span>&nbsp;<span class="ident" id="4257188">nil</span>&nbsp;<span class="op" id="4257192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4257196">certName</span>&nbsp;<span class="op" id="4257205">:=</span>&nbsp;<span class="ident" id="4257208">e</span><span class="op" id="4257209">.</span><span class="ident" id="4257210">hintCert</span><span class="op" id="4257218">.</span><span class="ident" id="4257219">Subject</span><span class="op" id="4257226">.</span><span class="ident" id="4257227">CommonName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4257240">if</span>&nbsp;<span class="builtinfunc" id="4257243">len</span><span class="op" id="4257246">(</span><span class="ident" id="4257247">certName</span><span class="op" id="4257255">)</span>&nbsp;<span class="op" id="4257257">==</span>&nbsp;<span class="num" id="4257260">0</span>&nbsp;<span class="op" id="4257262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4257267">if</span>&nbsp;<span class="builtinfunc" id="4257270">len</span><span class="op" id="4257273">(</span><span class="ident" id="4257274">e</span><span class="op" id="4257275">.</span><span class="ident" id="4257276">hintCert</span><span class="op" id="4257284">.</span><span class="ident" id="4257285">Subject</span><span class="op" id="4257292">.</span><span class="ident" id="4257293">Organization</span><span class="op" id="4257305">)</span>&nbsp;<span class="op" id="4257307">&gt;</span>&nbsp;<span class="num" id="4257309">0</span>&nbsp;<span class="op" id="4257311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4257317">certName</span>&nbsp;<span class="op" id="4257326">=</span>&nbsp;<span class="ident" id="4257328">e</span><span class="op" id="4257329">.</span><span class="ident" id="4257330">hintCert</span><span class="op" id="4257338">.</span><span class="ident" id="4257339">Subject</span><span class="op" id="4257346">.</span><span class="ident" id="4257347">Organization</span><span class="op" id="4257359">[</span><span class="num" id="4257360">0</span><span class="op" id="4257361">]</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4257366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4257371">certName</span>&nbsp;<span class="op" id="4257380">=</span>&nbsp;<span class="string" id="4257382">&#34;serial:&#34;</span>&nbsp;<span class="op" id="4257392">+</span>&nbsp;<span class="ident" id="4257394">e</span><span class="op" id="4257395">.</span><span class="ident" id="4257396">hintCert</span><span class="op" id="4257404">.</span><span class="ident" id="4257405">SerialNumber</span><span class="op" id="4257417">.</span><span class="ident" id="4257418">String</span><span class="op" id="4257424">(</span><span class="op" id="4257425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4257429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4257433">s</span>&nbsp;<span class="op" id="4257435">+=</span>&nbsp;<span class="ident" id="4257438">fmt</span><span class="op" id="4257441">.</span><span class="ident" id="4257442">Sprintf</span><span class="op" id="4257449">(</span><span class="string" id="4257450">&#34;&nbsp;(possibly&nbsp;because&nbsp;of&nbsp;%q&nbsp;while&nbsp;trying&nbsp;to&nbsp;verify&nbsp;candidate&nbsp;authority&nbsp;certificate&nbsp;%q)&#34;</span><span class="op" id="4257535">,</span>&nbsp;<span class="ident" id="4257537">e</span><span class="op" id="4257538">.</span><span class="ident" id="4257539">hintErr</span><span class="op" id="4257546">,</span>&nbsp;<span class="ident" id="4257548">certName</span><span class="op" id="4257556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4257559">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4257562">return</span>&nbsp;<span class="ident" id="4257569">s</span><br>
<span class="lineno"></span><span class="op" id="4257571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4257574">//&nbsp;SystemRootsError&nbsp;results&nbsp;when&nbsp;we&nbsp;fail&nbsp;to&nbsp;load&nbsp;the&nbsp;system&nbsp;root&nbsp;certificates.</span><br>
<span class="lineno"></span><span class="keyword" id="4257653">type</span>&nbsp;<span class="ident" id="4257658">SystemRootsError</span>&nbsp;<span class="keyword" id="4257675">struct</span><span class="op" id="4257681">{</span><span class="op" id="4257682">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="4257685">func</span>&nbsp;<span class="op" id="4257690">(</span><span class="ident" id="4257691">SystemRootsError</span><span class="op" id="4257707">)</span>&nbsp;<span class="ident" id="4257709">Error</span><span class="op" id="4257714">(</span><span class="op" id="4257715">)</span>&nbsp;<span class="builtintype" id="4257717">string</span>&nbsp;<span class="op" id="4257724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4257727">return</span>&nbsp;<span class="string" id="4257734">&#34;x509:&nbsp;failed&nbsp;to&nbsp;load&nbsp;system&nbsp;roots&nbsp;and&nbsp;no&nbsp;roots&nbsp;provided&#34;</span><br>
<span class="lineno"></span><span class="op" id="4257792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="4257795">//&nbsp;VerifyOptions&nbsp;contains&nbsp;parameters&nbsp;for&nbsp;Certificate.Verify.&nbsp;It&#39;s&nbsp;a&nbsp;structure</span><br>
<span class="lineno"></span><span class="comment" id="4257873">//&nbsp;because&nbsp;other&nbsp;PKIX&nbsp;verification&nbsp;APIs&nbsp;have&nbsp;ended&nbsp;up&nbsp;needing&nbsp;many&nbsp;options.</span><br>
<span class="lineno"></span><span class="keyword" id="4257949">type</span>&nbsp;<span class="ident" id="4257954">VerifyOptions</span>&nbsp;<span class="keyword" id="4257968">struct</span>&nbsp;<span class="op" id="4257975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4257978">DNSName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4257992">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258000">Intermediates</span>&nbsp;<span class="op" id="4258014">*</span><span class="ident" id="4258015">CertPool</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258025">Roots</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4258039">*</span><span class="ident" id="4258040">CertPool</span>&nbsp;<span class="comment" id="4258049">//&nbsp;if&nbsp;nil,&nbsp;the&nbsp;system&nbsp;roots&nbsp;are&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258087">CurrentTime</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4258101">time</span><span class="op" id="4258105">.</span><span class="ident" id="4258106">Time</span>&nbsp;<span class="comment" id="4258111">//&nbsp;if&nbsp;zero,&nbsp;the&nbsp;current&nbsp;time&nbsp;is&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4258149">//&nbsp;KeyUsage&nbsp;specifies&nbsp;which&nbsp;Extended&nbsp;Key&nbsp;Usage&nbsp;values&nbsp;are&nbsp;acceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4258220">//&nbsp;An&nbsp;empty&nbsp;list&nbsp;means&nbsp;ExtKeyUsageServerAuth.&nbsp;Key&nbsp;usage&nbsp;is&nbsp;considered&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4258293">//&nbsp;constraint&nbsp;down&nbsp;the&nbsp;chain&nbsp;which&nbsp;mirrors&nbsp;Windows&nbsp;CryptoAPI&nbsp;behaviour,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4258366">//&nbsp;but&nbsp;not&nbsp;the&nbsp;spec.&nbsp;To&nbsp;accept&nbsp;any&nbsp;key&nbsp;usage,&nbsp;include&nbsp;ExtKeyUsageAny.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258437">KeyUsages</span>&nbsp;<span class="op" id="4258447">[</span><span class="op" id="4258448">]</span><span class="ident" id="4258449">ExtKeyUsage</span><br>
<span class="lineno"></span><span class="op" id="4258461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4258464">const</span>&nbsp;<span class="op" id="4258470">(</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258473">leafCertificate</span>&nbsp;<span class="op" id="4258489">=</span>&nbsp;<span class="ident" id="4258491">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258497">intermediateCertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258522">rootCertificate</span><br>
<span class="lineno"></span><span class="op" id="4258538">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="4258541">//&nbsp;isValid&nbsp;performs&nbsp;validity&nbsp;checks&nbsp;on&nbsp;the&nbsp;c.</span><br>
<span class="lineno"></span><span class="keyword" id="4258587">func</span>&nbsp;<span class="op" id="4258592">(</span><span class="ident" id="4258593">c</span>&nbsp;<span class="op" id="4258595">*</span><span class="ident" id="4258596">Certificate</span><span class="op" id="4258607">)</span>&nbsp;<span class="ident" id="4258609">isValid</span><span class="op" id="4258616">(</span><span class="ident" id="4258617">certType</span>&nbsp;<span class="builtintype" id="4258626">int</span><span class="op" id="4258629">,</span>&nbsp;<span class="ident" id="4258631">currentChain</span>&nbsp;<span class="op" id="4258644">[</span><span class="op" id="4258645">]</span><span class="op" id="4258646">*</span><span class="ident" id="4258647">Certificate</span><span class="op" id="4258658">,</span>&nbsp;<span class="ident" id="4258660">opts</span>&nbsp;<span class="op" id="4258665">*</span><span class="ident" id="4258666">VerifyOptions</span><span class="op" id="4258679">)</span>&nbsp;<span class="builtintype" id="4258681">error</span>&nbsp;<span class="op" id="4258687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258690">now</span>&nbsp;<span class="op" id="4258694">:=</span>&nbsp;<span class="ident" id="4258697">opts</span><span class="op" id="4258701">.</span><span class="ident" id="4258702">CurrentTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4258715">if</span>&nbsp;<span class="ident" id="4258718">now</span><span class="op" id="4258721">.</span><span class="ident" id="4258722">IsZero</span><span class="op" id="4258728">(</span><span class="op" id="4258729">)</span>&nbsp;<span class="op" id="4258731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258735">now</span>&nbsp;<span class="op" id="4258739">=</span>&nbsp;<span class="ident" id="4258741">time</span><span class="op" id="4258745">.</span><span class="ident" id="4258746">Now</span><span class="op" id="4258749">(</span><span class="op" id="4258750">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4258753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4258756">if</span>&nbsp;<span class="ident" id="4258759">now</span><span class="op" id="4258762">.</span><span class="ident" id="4258763">Before</span><span class="op" id="4258769">(</span><span class="ident" id="4258770">c</span><span class="op" id="4258771">.</span><span class="ident" id="4258772">NotBefore</span><span class="op" id="4258781">)</span>&nbsp;<span class="op" id="4258783">||</span>&nbsp;<span class="ident" id="4258786">now</span><span class="op" id="4258789">.</span><span class="ident" id="4258790">After</span><span class="op" id="4258795">(</span><span class="ident" id="4258796">c</span><span class="op" id="4258797">.</span><span class="ident" id="4258798">NotAfter</span><span class="op" id="4258806">)</span>&nbsp;<span class="op" id="4258808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4258812">return</span>&nbsp;<span class="ident" id="4258819">CertificateInvalidError</span><span class="op" id="4258842">{</span><span class="ident" id="4258843">c</span><span class="op" id="4258844">,</span>&nbsp;<span class="ident" id="4258846">Expired</span><span class="op" id="4258853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4258856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4258860">if</span>&nbsp;<span class="builtinfunc" id="4258863">len</span><span class="op" id="4258866">(</span><span class="ident" id="4258867">c</span><span class="op" id="4258868">.</span><span class="ident" id="4258869">PermittedDNSDomains</span><span class="op" id="4258888">)</span>&nbsp;<span class="op" id="4258890">&gt;</span>&nbsp;<span class="num" id="4258892">0</span>&nbsp;<span class="op" id="4258894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258898">ok</span>&nbsp;<span class="op" id="4258901">:=</span>&nbsp;<span class="builtintype" id="4258904">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4258912">for</span>&nbsp;<span class="ident" id="4258916">_</span><span class="op" id="4258917">,</span>&nbsp;<span class="ident" id="4258919">domain</span>&nbsp;<span class="op" id="4258926">:=</span>&nbsp;<span class="keyword" id="4258929">range</span>&nbsp;<span class="ident" id="4258935">c</span><span class="op" id="4258936">.</span><span class="ident" id="4258937">PermittedDNSDomains</span>&nbsp;<span class="op" id="4258957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4258962">if</span>&nbsp;<span class="ident" id="4258965">opts</span><span class="op" id="4258969">.</span><span class="ident" id="4258970">DNSName</span>&nbsp;<span class="op" id="4258978">==</span>&nbsp;<span class="ident" id="4258981">domain</span>&nbsp;<span class="op" id="4258988">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4258995">(</span><span class="ident" id="4258996">strings</span><span class="op" id="4259003">.</span><span class="ident" id="4259004">HasSuffix</span><span class="op" id="4259013">(</span><span class="ident" id="4259014">opts</span><span class="op" id="4259018">.</span><span class="ident" id="4259019">DNSName</span><span class="op" id="4259026">,</span>&nbsp;<span class="ident" id="4259028">domain</span><span class="op" id="4259034">)</span>&nbsp;<span class="op" id="4259036">&amp;&amp;</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4259044">len</span><span class="op" id="4259047">(</span><span class="ident" id="4259048">opts</span><span class="op" id="4259052">.</span><span class="ident" id="4259053">DNSName</span><span class="op" id="4259060">)</span>&nbsp;<span class="op" id="4259062">&gt;=</span>&nbsp;<span class="num" id="4259065">1</span><span class="op" id="4259066">+</span><span class="builtinfunc" id="4259067">len</span><span class="op" id="4259070">(</span><span class="ident" id="4259071">domain</span><span class="op" id="4259077">)</span>&nbsp;<span class="op" id="4259079">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4259087">opts</span><span class="op" id="4259091">.</span><span class="ident" id="4259092">DNSName</span><span class="op" id="4259099">[</span><span class="builtinfunc" id="4259100">len</span><span class="op" id="4259103">(</span><span class="ident" id="4259104">opts</span><span class="op" id="4259108">.</span><span class="ident" id="4259109">DNSName</span><span class="op" id="4259116">)</span><span class="op" id="4259117">-</span><span class="builtinfunc" id="4259118">len</span><span class="op" id="4259121">(</span><span class="ident" id="4259122">domain</span><span class="op" id="4259128">)</span><span class="op" id="4259129">-</span><span class="num" id="4259130">1</span><span class="op" id="4259131">]</span>&nbsp;<span class="op" id="4259133">==</span>&nbsp;<span class="string" id="4259136">&#39;.&#39;</span><span class="op" id="4259139">)</span>&nbsp;<span class="op" id="4259141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4259147">ok</span>&nbsp;<span class="op" id="4259150">=</span>&nbsp;<span class="builtintype" id="4259152">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4259161">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4259170">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4259174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4259179">if</span>&nbsp;<span class="op" id="4259182">!</span><span class="ident" id="4259183">ok</span>&nbsp;<span class="op" id="4259186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4259191">return</span>&nbsp;<span class="ident" id="4259198">CertificateInvalidError</span><span class="op" id="4259221">{</span><span class="ident" id="4259222">c</span><span class="op" id="4259223">,</span>&nbsp;<span class="ident" id="4259225">CANotAuthorizedForThisName</span><span class="op" id="4259251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4259255">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4259258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4259262">//&nbsp;KeyUsage&nbsp;status&nbsp;flags&nbsp;are&nbsp;ignored.&nbsp;From&nbsp;Engineering&nbsp;Security,&nbsp;Peter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4259334">//&nbsp;Gutmann:&nbsp;A&nbsp;European&nbsp;government&nbsp;CA&nbsp;marked&nbsp;its&nbsp;signing&nbsp;certificates&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4259407">//&nbsp;being&nbsp;valid&nbsp;for&nbsp;encryption&nbsp;only,&nbsp;but&nbsp;no-one&nbsp;noticed.&nbsp;Another</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4259472">//&nbsp;European&nbsp;CA&nbsp;marked&nbsp;its&nbsp;signature&nbsp;keys&nbsp;as&nbsp;not&nbsp;being&nbsp;valid&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4259537">//&nbsp;signatures.&nbsp;A&nbsp;different&nbsp;CA&nbsp;marked&nbsp;its&nbsp;own&nbsp;trusted&nbsp;root&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4259608">//&nbsp;as&nbsp;being&nbsp;invalid&nbsp;for&nbsp;certificate&nbsp;signing.&nbsp;&nbsp;Another&nbsp;national&nbsp;CA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4259675">//&nbsp;distributed&nbsp;a&nbsp;certificate&nbsp;to&nbsp;be&nbsp;used&nbsp;to&nbsp;encrypt&nbsp;data&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4259740">//&nbsp;country’s&nbsp;tax&nbsp;authority&nbsp;that&nbsp;was&nbsp;marked&nbsp;as&nbsp;only&nbsp;being&nbsp;usable&nbsp;for</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4259811">//&nbsp;digital&nbsp;signatures&nbsp;but&nbsp;not&nbsp;for&nbsp;encryption.&nbsp;Yet&nbsp;another&nbsp;CA&nbsp;reversed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4259882">//&nbsp;the&nbsp;order&nbsp;of&nbsp;the&nbsp;bit&nbsp;flags&nbsp;in&nbsp;the&nbsp;keyUsage&nbsp;due&nbsp;to&nbsp;confusion&nbsp;over</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4259951">//&nbsp;encoding&nbsp;endianness,&nbsp;essentially&nbsp;setting&nbsp;a&nbsp;random&nbsp;keyUsage&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4260017">//&nbsp;certificates&nbsp;that&nbsp;it&nbsp;issued.&nbsp;Another&nbsp;CA&nbsp;created&nbsp;a&nbsp;self-invalidating</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4260089">//&nbsp;certificate&nbsp;by&nbsp;adding&nbsp;a&nbsp;certificate&nbsp;policy&nbsp;statement&nbsp;stipulating</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4260158">//&nbsp;that&nbsp;the&nbsp;certificate&nbsp;had&nbsp;to&nbsp;be&nbsp;used&nbsp;strictly&nbsp;as&nbsp;specified&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4260227">//&nbsp;keyUsage,&nbsp;and&nbsp;a&nbsp;keyUsage&nbsp;containing&nbsp;a&nbsp;flag&nbsp;indicating&nbsp;that&nbsp;the&nbsp;RSA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4260298">//&nbsp;encryption&nbsp;key&nbsp;could&nbsp;only&nbsp;be&nbsp;used&nbsp;for&nbsp;Diffie-Hellman&nbsp;key&nbsp;agreement.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260371">if</span>&nbsp;<span class="ident" id="4260374">certType</span>&nbsp;<span class="op" id="4260383">==</span>&nbsp;<span class="ident" id="4260386">intermediateCertificate</span>&nbsp;<span class="op" id="4260410">&amp;&amp;</span>&nbsp;<span class="op" id="4260413">(</span><span class="op" id="4260414">!</span><span class="ident" id="4260415">c</span><span class="op" id="4260416">.</span><span class="ident" id="4260417">BasicConstraintsValid</span>&nbsp;<span class="op" id="4260439">||</span>&nbsp;<span class="op" id="4260442">!</span><span class="ident" id="4260443">c</span><span class="op" id="4260444">.</span><span class="ident" id="4260445">IsCA</span><span class="op" id="4260449">)</span>&nbsp;<span class="op" id="4260451">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260455">return</span>&nbsp;<span class="ident" id="4260462">CertificateInvalidError</span><span class="op" id="4260485">{</span><span class="ident" id="4260486">c</span><span class="op" id="4260487">,</span>&nbsp;<span class="ident" id="4260489">NotAuthorizedToSign</span><span class="op" id="4260508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4260511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260515">if</span>&nbsp;<span class="ident" id="4260518">c</span><span class="op" id="4260519">.</span><span class="ident" id="4260520">BasicConstraintsValid</span>&nbsp;<span class="op" id="4260542">&amp;&amp;</span>&nbsp;<span class="ident" id="4260545">c</span><span class="op" id="4260546">.</span><span class="ident" id="4260547">MaxPathLen</span>&nbsp;<span class="op" id="4260558">&gt;=</span>&nbsp;<span class="num" id="4260561">0</span>&nbsp;<span class="op" id="4260563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4260567">numIntermediates</span>&nbsp;<span class="op" id="4260584">:=</span>&nbsp;<span class="builtinfunc" id="4260587">len</span><span class="op" id="4260590">(</span><span class="ident" id="4260591">currentChain</span><span class="op" id="4260603">)</span>&nbsp;<span class="op" id="4260605">-</span>&nbsp;<span class="num" id="4260607">1</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260611">if</span>&nbsp;<span class="ident" id="4260614">numIntermediates</span>&nbsp;<span class="op" id="4260631">&gt;</span>&nbsp;<span class="ident" id="4260633">c</span><span class="op" id="4260634">.</span><span class="ident" id="4260635">MaxPathLen</span>&nbsp;<span class="op" id="4260646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260651">return</span>&nbsp;<span class="ident" id="4260658">CertificateInvalidError</span><span class="op" id="4260681">{</span><span class="ident" id="4260682">c</span><span class="op" id="4260683">,</span>&nbsp;<span class="ident" id="4260685">TooManyIntermediates</span><span class="op" id="4260705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4260709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4260712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260716">return</span>&nbsp;<span class="ident" id="4260723">nil</span><br>
<span class="lineno"></span><span class="op" id="4260727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4260730">//&nbsp;Verify&nbsp;attempts&nbsp;to&nbsp;verify&nbsp;c&nbsp;by&nbsp;building&nbsp;one&nbsp;or&nbsp;more&nbsp;chains&nbsp;from&nbsp;c&nbsp;to&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4260804">//&nbsp;certificate&nbsp;in&nbsp;opts.Roots,&nbsp;using&nbsp;certificates&nbsp;in&nbsp;opts.Intermediates&nbsp;if</span><br>
<span class="lineno">205</span><span class="comment" id="4260878">//&nbsp;needed.&nbsp;If&nbsp;successful,&nbsp;it&nbsp;returns&nbsp;one&nbsp;or&nbsp;more&nbsp;chains&nbsp;where&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="4260950">//&nbsp;element&nbsp;of&nbsp;the&nbsp;chain&nbsp;is&nbsp;c&nbsp;and&nbsp;the&nbsp;last&nbsp;element&nbsp;is&nbsp;from&nbsp;opts.Roots.</span><br>
<span class="lineno"></span><span class="comment" id="4261020">//</span><br>
<span class="lineno"></span><span class="comment" id="4261023">//&nbsp;If&nbsp;opts.Roots&nbsp;is&nbsp;nil&nbsp;and&nbsp;system&nbsp;roots&nbsp;are&nbsp;unavailable&nbsp;the&nbsp;returned&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="4261099">//&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;SystemRootsError.</span><br>
<span class="lineno">210</span><span class="comment" id="4261136">//</span><br>
<span class="lineno"></span><span class="comment" id="4261139">//&nbsp;WARNING:&nbsp;this&nbsp;doesn&#39;t&nbsp;do&nbsp;any&nbsp;revocation&nbsp;checking.</span><br>
<span class="lineno"></span><span class="keyword" id="4261192">func</span>&nbsp;<span class="op" id="4261197">(</span><span class="ident" id="4261198">c</span>&nbsp;<span class="op" id="4261200">*</span><span class="ident" id="4261201">Certificate</span><span class="op" id="4261212">)</span>&nbsp;<span class="ident" id="4261214">Verify</span><span class="op" id="4261220">(</span><span class="ident" id="4261221">opts</span>&nbsp;<span class="ident" id="4261226">VerifyOptions</span><span class="op" id="4261239">)</span>&nbsp;<span class="op" id="4261241">(</span><span class="ident" id="4261242">chains</span>&nbsp;<span class="op" id="4261249">[</span><span class="op" id="4261250">]</span><span class="op" id="4261251">[</span><span class="op" id="4261252">]</span><span class="op" id="4261253">*</span><span class="ident" id="4261254">Certificate</span><span class="op" id="4261265">,</span>&nbsp;<span class="ident" id="4261267">err</span>&nbsp;<span class="builtintype" id="4261271">error</span><span class="op" id="4261276">)</span>&nbsp;<span class="op" id="4261278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4261281">//&nbsp;Use&nbsp;Windows&#39;s&nbsp;own&nbsp;verification&nbsp;and&nbsp;chain&nbsp;building.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4261336">if</span>&nbsp;<span class="ident" id="4261339">opts</span><span class="op" id="4261343">.</span><span class="ident" id="4261344">Roots</span>&nbsp;<span class="op" id="4261350">==</span>&nbsp;<span class="ident" id="4261353">nil</span>&nbsp;<span class="op" id="4261357">&amp;&amp;</span>&nbsp;<span class="ident" id="4261360">runtime</span><span class="op" id="4261367">.</span><span class="ident" id="4261368">GOOS</span>&nbsp;<span class="op" id="4261373">==</span>&nbsp;<span class="string" id="4261376">&#34;windows&#34;</span>&nbsp;<span class="op" id="4261386">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4261390">return</span>&nbsp;<span class="ident" id="4261397">c</span><span class="op" id="4261398">.</span><span class="ident" id="4261399">systemVerify</span><span class="op" id="4261411">(</span><span class="op" id="4261412">&amp;</span><span class="ident" id="4261413">opts</span><span class="op" id="4261417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4261420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4261424">if</span>&nbsp;<span class="ident" id="4261427">opts</span><span class="op" id="4261431">.</span><span class="ident" id="4261432">Roots</span>&nbsp;<span class="op" id="4261438">==</span>&nbsp;<span class="ident" id="4261441">nil</span>&nbsp;<span class="op" id="4261445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261449">opts</span><span class="op" id="4261453">.</span><span class="ident" id="4261454">Roots</span>&nbsp;<span class="op" id="4261460">=</span>&nbsp;<span class="ident" id="4261462">systemRootsPool</span><span class="op" id="4261477">(</span><span class="op" id="4261478">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4261482">if</span>&nbsp;<span class="ident" id="4261485">opts</span><span class="op" id="4261489">.</span><span class="ident" id="4261490">Roots</span>&nbsp;<span class="op" id="4261496">==</span>&nbsp;<span class="ident" id="4261499">nil</span>&nbsp;<span class="op" id="4261503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4261508">return</span>&nbsp;<span class="ident" id="4261515">nil</span><span class="op" id="4261518">,</span>&nbsp;<span class="ident" id="4261520">SystemRootsError</span><span class="op" id="4261536">{</span><span class="op" id="4261537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4261541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4261544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261548">err</span>&nbsp;<span class="op" id="4261552">=</span>&nbsp;<span class="ident" id="4261554">c</span><span class="op" id="4261555">.</span><span class="ident" id="4261556">isValid</span><span class="op" id="4261563">(</span><span class="ident" id="4261564">leafCertificate</span><span class="op" id="4261579">,</span>&nbsp;<span class="ident" id="4261581">nil</span><span class="op" id="4261584">,</span>&nbsp;<span class="op" id="4261586">&amp;</span><span class="ident" id="4261587">opts</span><span class="op" id="4261591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4261594">if</span>&nbsp;<span class="ident" id="4261597">err</span>&nbsp;<span class="op" id="4261601">!=</span>&nbsp;<span class="ident" id="4261604">nil</span>&nbsp;<span class="op" id="4261608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4261612">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4261620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4261624">if</span>&nbsp;<span class="builtinfunc" id="4261627">len</span><span class="op" id="4261630">(</span><span class="ident" id="4261631">opts</span><span class="op" id="4261635">.</span><span class="ident" id="4261636">DNSName</span><span class="op" id="4261643">)</span>&nbsp;<span class="op" id="4261645">&gt;</span>&nbsp;<span class="num" id="4261647">0</span>&nbsp;<span class="op" id="4261649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261653">err</span>&nbsp;<span class="op" id="4261657">=</span>&nbsp;<span class="ident" id="4261659">c</span><span class="op" id="4261660">.</span><span class="ident" id="4261661">VerifyHostname</span><span class="op" id="4261675">(</span><span class="ident" id="4261676">opts</span><span class="op" id="4261680">.</span><span class="ident" id="4261681">DNSName</span><span class="op" id="4261688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4261692">if</span>&nbsp;<span class="ident" id="4261695">err</span>&nbsp;<span class="op" id="4261699">!=</span>&nbsp;<span class="ident" id="4261702">nil</span>&nbsp;<span class="op" id="4261706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4261711">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4261720">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4261723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261727">candidateChains</span><span class="op" id="4261742">,</span>&nbsp;<span class="ident" id="4261744">err</span>&nbsp;<span class="op" id="4261748">:=</span>&nbsp;<span class="ident" id="4261751">c</span><span class="op" id="4261752">.</span><span class="ident" id="4261753">buildChains</span><span class="op" id="4261764">(</span><span class="builtinfunc" id="4261765">make</span><span class="op" id="4261769">(</span><span class="keyword" id="4261770">map</span><span class="op" id="4261773">[</span><span class="builtintype" id="4261774">int</span><span class="op" id="4261777">]</span><span class="op" id="4261778">[</span><span class="op" id="4261779">]</span><span class="op" id="4261780">[</span><span class="op" id="4261781">]</span><span class="op" id="4261782">*</span><span class="ident" id="4261783">Certificate</span><span class="op" id="4261794">)</span><span class="op" id="4261795">,</span>&nbsp;<span class="op" id="4261797">[</span><span class="op" id="4261798">]</span><span class="op" id="4261799">*</span><span class="ident" id="4261800">Certificate</span><span class="op" id="4261811">{</span><span class="ident" id="4261812">c</span><span class="op" id="4261813">}</span><span class="op" id="4261814">,</span>&nbsp;<span class="op" id="4261816">&amp;</span><span class="ident" id="4261817">opts</span><span class="op" id="4261821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4261824">if</span>&nbsp;<span class="ident" id="4261827">err</span>&nbsp;<span class="op" id="4261831">!=</span>&nbsp;<span class="ident" id="4261834">nil</span>&nbsp;<span class="op" id="4261838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4261842">return</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4261850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261854">keyUsages</span>&nbsp;<span class="op" id="4261864">:=</span>&nbsp;<span class="ident" id="4261867">opts</span><span class="op" id="4261871">.</span><span class="ident" id="4261872">KeyUsages</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4261883">if</span>&nbsp;<span class="builtinfunc" id="4261886">len</span><span class="op" id="4261889">(</span><span class="ident" id="4261890">keyUsages</span><span class="op" id="4261899">)</span>&nbsp;<span class="op" id="4261901">==</span>&nbsp;<span class="num" id="4261904">0</span>&nbsp;<span class="op" id="4261906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261910">keyUsages</span>&nbsp;<span class="op" id="4261920">=</span>&nbsp;<span class="op" id="4261922">[</span><span class="op" id="4261923">]</span><span class="ident" id="4261924">ExtKeyUsage</span><span class="op" id="4261935">{</span><span class="ident" id="4261936">ExtKeyUsageServerAuth</span><span class="op" id="4261957">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4261960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4261964">//&nbsp;If&nbsp;any&nbsp;key&nbsp;usage&nbsp;is&nbsp;acceptable&nbsp;then&nbsp;we&#39;re&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4262016">for</span>&nbsp;<span class="ident" id="4262020">_</span><span class="op" id="4262021">,</span>&nbsp;<span class="ident" id="4262023">usage</span>&nbsp;<span class="op" id="4262029">:=</span>&nbsp;<span class="keyword" id="4262032">range</span>&nbsp;<span class="ident" id="4262038">keyUsages</span>&nbsp;<span class="op" id="4262048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4262052">if</span>&nbsp;<span class="ident" id="4262055">usage</span>&nbsp;<span class="op" id="4262061">==</span>&nbsp;<span class="ident" id="4262064">ExtKeyUsageAny</span>&nbsp;<span class="op" id="4262079">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262084">chains</span>&nbsp;<span class="op" id="4262091">=</span>&nbsp;<span class="ident" id="4262093">candidateChains</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4262112">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4262121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4262124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4262128">for</span>&nbsp;<span class="ident" id="4262132">_</span><span class="op" id="4262133">,</span>&nbsp;<span class="ident" id="4262135">candidate</span>&nbsp;<span class="op" id="4262145">:=</span>&nbsp;<span class="keyword" id="4262148">range</span>&nbsp;<span class="ident" id="4262154">candidateChains</span>&nbsp;<span class="op" id="4262170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4262174">if</span>&nbsp;<span class="ident" id="4262177">checkChainForKeyUsage</span><span class="op" id="4262198">(</span><span class="ident" id="4262199">candidate</span><span class="op" id="4262208">,</span>&nbsp;<span class="ident" id="4262210">keyUsages</span><span class="op" id="4262219">)</span>&nbsp;<span class="op" id="4262221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262226">chains</span>&nbsp;<span class="op" id="4262233">=</span>&nbsp;<span class="builtinfunc" id="4262235">append</span><span class="op" id="4262241">(</span><span class="ident" id="4262242">chains</span><span class="op" id="4262248">,</span>&nbsp;<span class="ident" id="4262250">candidate</span><span class="op" id="4262259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4262263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4262266">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4262270">if</span>&nbsp;<span class="builtinfunc" id="4262273">len</span><span class="op" id="4262276">(</span><span class="ident" id="4262277">chains</span><span class="op" id="4262283">)</span>&nbsp;<span class="op" id="4262285">==</span>&nbsp;<span class="num" id="4262288">0</span>&nbsp;<span class="op" id="4262290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262294">err</span>&nbsp;<span class="op" id="4262298">=</span>&nbsp;<span class="ident" id="4262300">CertificateInvalidError</span><span class="op" id="4262323">{</span><span class="ident" id="4262324">c</span><span class="op" id="4262325">,</span>&nbsp;<span class="ident" id="4262327">IncompatibleUsage</span><span class="op" id="4262344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4262347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4262351">return</span><br>
<span class="lineno"></span><span class="op" id="4262358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4262361">func</span>&nbsp;<span class="ident" id="4262366">appendToFreshChain</span><span class="op" id="4262384">(</span><span class="ident" id="4262385">chain</span>&nbsp;<span class="op" id="4262391">[</span><span class="op" id="4262392">]</span><span class="op" id="4262393">*</span><span class="ident" id="4262394">Certificate</span><span class="op" id="4262405">,</span>&nbsp;<span class="ident" id="4262407">cert</span>&nbsp;<span class="op" id="4262412">*</span><span class="ident" id="4262413">Certificate</span><span class="op" id="4262424">)</span>&nbsp;<span class="op" id="4262426">[</span><span class="op" id="4262427">]</span><span class="op" id="4262428">*</span><span class="ident" id="4262429">Certificate</span>&nbsp;<span class="op" id="4262441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262444">n</span>&nbsp;<span class="op" id="4262446">:=</span>&nbsp;<span class="builtinfunc" id="4262449">make</span><span class="op" id="4262453">(</span><span class="op" id="4262454">[</span><span class="op" id="4262455">]</span><span class="op" id="4262456">*</span><span class="ident" id="4262457">Certificate</span><span class="op" id="4262468">,</span>&nbsp;<span class="builtinfunc" id="4262470">len</span><span class="op" id="4262473">(</span><span class="ident" id="4262474">chain</span><span class="op" id="4262479">)</span><span class="op" id="4262480">+</span><span class="num" id="4262481">1</span><span class="op" id="4262482">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4262485">copy</span><span class="op" id="4262489">(</span><span class="ident" id="4262490">n</span><span class="op" id="4262491">,</span>&nbsp;<span class="ident" id="4262493">chain</span><span class="op" id="4262498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262501">n</span><span class="op" id="4262502">[</span><span class="builtinfunc" id="4262503">len</span><span class="op" id="4262506">(</span><span class="ident" id="4262507">chain</span><span class="op" id="4262512">)</span><span class="op" id="4262513">]</span>&nbsp;<span class="op" id="4262515">=</span>&nbsp;<span class="ident" id="4262517">cert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4262523">return</span>&nbsp;<span class="ident" id="4262530">n</span><br>
<span class="lineno"></span><span class="op" id="4262532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="4262535">func</span>&nbsp;<span class="op" id="4262540">(</span><span class="ident" id="4262541">c</span>&nbsp;<span class="op" id="4262543">*</span><span class="ident" id="4262544">Certificate</span><span class="op" id="4262555">)</span>&nbsp;<span class="ident" id="4262557">buildChains</span><span class="op" id="4262568">(</span><span class="ident" id="4262569">cache</span>&nbsp;<span class="keyword" id="4262575">map</span><span class="op" id="4262578">[</span><span class="builtintype" id="4262579">int</span><span class="op" id="4262582">]</span><span class="op" id="4262583">[</span><span class="op" id="4262584">]</span><span class="op" id="4262585">[</span><span class="op" id="4262586">]</span><span class="op" id="4262587">*</span><span class="ident" id="4262588">Certificate</span><span class="op" id="4262599">,</span>&nbsp;<span class="ident" id="4262601">currentChain</span>&nbsp;<span class="op" id="4262614">[</span><span class="op" id="4262615">]</span><span class="op" id="4262616">*</span><span class="ident" id="4262617">Certificate</span><span class="op" id="4262628">,</span>&nbsp;<span class="ident" id="4262630">opts</span>&nbsp;<span class="op" id="4262635">*</span><span class="ident" id="4262636">VerifyOptions</span><span class="op" id="4262649">)</span>&nbsp;<span class="op" id="4262651">(</span><span class="ident" id="4262652">chains</span>&nbsp;<span class="op" id="4262659">[</span><span class="op" id="4262660">]</span><span class="op" id="4262661">[</span><span class="op" id="4262662">]</span><span class="op" id="4262663">*</span><span class="ident" id="4262664">Certificate</span><span class="op" id="4262675">,</span>&nbsp;<span class="ident" id="4262677">err</span>&nbsp;<span class="builtintype" id="4262681">error</span><span class="op" id="4262686">)</span>&nbsp;<span class="op" id="4262688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262691">possibleRoots</span><span class="op" id="4262704">,</span>&nbsp;<span class="ident" id="4262706">failedRoot</span><span class="op" id="4262716">,</span>&nbsp;<span class="ident" id="4262718">rootErr</span>&nbsp;<span class="op" id="4262726">:=</span>&nbsp;<span class="ident" id="4262729">opts</span><span class="op" id="4262733">.</span><span class="ident" id="4262734">Roots</span><span class="op" id="4262739">.</span><span class="ident" id="4262740">findVerifiedParents</span><span class="op" id="4262759">(</span><span class="ident" id="4262760">c</span><span class="op" id="4262761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4262764">for</span>&nbsp;<span class="ident" id="4262768">_</span><span class="op" id="4262769">,</span>&nbsp;<span class="ident" id="4262771">rootNum</span>&nbsp;<span class="op" id="4262779">:=</span>&nbsp;<span class="keyword" id="4262782">range</span>&nbsp;<span class="ident" id="4262788">possibleRoots</span>&nbsp;<span class="op" id="4262802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262806">root</span>&nbsp;<span class="op" id="4262811">:=</span>&nbsp;<span class="ident" id="4262814">opts</span><span class="op" id="4262818">.</span><span class="ident" id="4262819">Roots</span><span class="op" id="4262824">.</span><span class="ident" id="4262825">certs</span><span class="op" id="4262830">[</span><span class="ident" id="4262831">rootNum</span><span class="op" id="4262838">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262842">err</span>&nbsp;<span class="op" id="4262846">=</span>&nbsp;<span class="ident" id="4262848">root</span><span class="op" id="4262852">.</span><span class="ident" id="4262853">isValid</span><span class="op" id="4262860">(</span><span class="ident" id="4262861">rootCertificate</span><span class="op" id="4262876">,</span>&nbsp;<span class="ident" id="4262878">currentChain</span><span class="op" id="4262890">,</span>&nbsp;<span class="ident" id="4262892">opts</span><span class="op" id="4262896">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4262900">if</span>&nbsp;<span class="ident" id="4262903">err</span>&nbsp;<span class="op" id="4262907">!=</span>&nbsp;<span class="ident" id="4262910">nil</span>&nbsp;<span class="op" id="4262914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4262919">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4262930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262934">chains</span>&nbsp;<span class="op" id="4262941">=</span>&nbsp;<span class="builtinfunc" id="4262943">append</span><span class="op" id="4262949">(</span><span class="ident" id="4262950">chains</span><span class="op" id="4262956">,</span>&nbsp;<span class="ident" id="4262958">appendToFreshChain</span><span class="op" id="4262976">(</span><span class="ident" id="4262977">currentChain</span><span class="op" id="4262989">,</span>&nbsp;<span class="ident" id="4262991">root</span><span class="op" id="4262995">)</span><span class="op" id="4262996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4262999">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263003">possibleIntermediates</span><span class="op" id="4263024">,</span>&nbsp;<span class="ident" id="4263026">failedIntermediate</span><span class="op" id="4263044">,</span>&nbsp;<span class="ident" id="4263046">intermediateErr</span>&nbsp;<span class="op" id="4263062">:=</span>&nbsp;<span class="ident" id="4263065">opts</span><span class="op" id="4263069">.</span><span class="ident" id="4263070">Intermediates</span><span class="op" id="4263083">.</span><span class="ident" id="4263084">findVerifiedParents</span><span class="op" id="4263103">(</span><span class="ident" id="4263104">c</span><span class="op" id="4263105">)</span><br>
<span class="lineno"></span><span class="ident" id="4263107">nextIntermediate</span><span class="op" id="4263123">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4263126">for</span>&nbsp;<span class="ident" id="4263130">_</span><span class="op" id="4263131">,</span>&nbsp;<span class="ident" id="4263133">intermediateNum</span>&nbsp;<span class="op" id="4263149">:=</span>&nbsp;<span class="keyword" id="4263152">range</span>&nbsp;<span class="ident" id="4263158">possibleIntermediates</span>&nbsp;<span class="op" id="4263180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263184">intermediate</span>&nbsp;<span class="op" id="4263197">:=</span>&nbsp;<span class="ident" id="4263200">opts</span><span class="op" id="4263204">.</span><span class="ident" id="4263205">Intermediates</span><span class="op" id="4263218">.</span><span class="ident" id="4263219">certs</span><span class="op" id="4263224">[</span><span class="ident" id="4263225">intermediateNum</span><span class="op" id="4263240">]</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4263244">for</span>&nbsp;<span class="ident" id="4263248">_</span><span class="op" id="4263249">,</span>&nbsp;<span class="ident" id="4263251">cert</span>&nbsp;<span class="op" id="4263256">:=</span>&nbsp;<span class="keyword" id="4263259">range</span>&nbsp;<span class="ident" id="4263265">currentChain</span>&nbsp;<span class="op" id="4263278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4263283">if</span>&nbsp;<span class="ident" id="4263286">cert</span>&nbsp;<span class="op" id="4263291">==</span>&nbsp;<span class="ident" id="4263294">intermediate</span>&nbsp;<span class="op" id="4263307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4263313">continue</span>&nbsp;<span class="ident" id="4263322">nextIntermediate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4263342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4263346">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263350">err</span>&nbsp;<span class="op" id="4263354">=</span>&nbsp;<span class="ident" id="4263356">intermediate</span><span class="op" id="4263368">.</span><span class="ident" id="4263369">isValid</span><span class="op" id="4263376">(</span><span class="ident" id="4263377">intermediateCertificate</span><span class="op" id="4263400">,</span>&nbsp;<span class="ident" id="4263402">currentChain</span><span class="op" id="4263414">,</span>&nbsp;<span class="ident" id="4263416">opts</span><span class="op" id="4263420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4263424">if</span>&nbsp;<span class="ident" id="4263427">err</span>&nbsp;<span class="op" id="4263431">!=</span>&nbsp;<span class="ident" id="4263434">nil</span>&nbsp;<span class="op" id="4263438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4263443">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4263454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4263458">var</span>&nbsp;<span class="ident" id="4263462">childChains</span>&nbsp;<span class="op" id="4263474">[</span><span class="op" id="4263475">]</span><span class="op" id="4263476">[</span><span class="op" id="4263477">]</span><span class="op" id="4263478">*</span><span class="ident" id="4263479">Certificate</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263493">childChains</span><span class="op" id="4263504">,</span>&nbsp;<span class="ident" id="4263506">ok</span>&nbsp;<span class="op" id="4263509">:=</span>&nbsp;<span class="ident" id="4263512">cache</span><span class="op" id="4263517">[</span><span class="ident" id="4263518">intermediateNum</span><span class="op" id="4263533">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4263537">if</span>&nbsp;<span class="op" id="4263540">!</span><span class="ident" id="4263541">ok</span>&nbsp;<span class="op" id="4263544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263549">childChains</span><span class="op" id="4263560">,</span>&nbsp;<span class="ident" id="4263562">err</span>&nbsp;<span class="op" id="4263566">=</span>&nbsp;<span class="ident" id="4263568">intermediate</span><span class="op" id="4263580">.</span><span class="ident" id="4263581">buildChains</span><span class="op" id="4263592">(</span><span class="ident" id="4263593">cache</span><span class="op" id="4263598">,</span>&nbsp;<span class="ident" id="4263600">appendToFreshChain</span><span class="op" id="4263618">(</span><span class="ident" id="4263619">currentChain</span><span class="op" id="4263631">,</span>&nbsp;<span class="ident" id="4263633">intermediate</span><span class="op" id="4263645">)</span><span class="op" id="4263646">,</span>&nbsp;<span class="ident" id="4263648">opts</span><span class="op" id="4263652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263657">cache</span><span class="op" id="4263662">[</span><span class="ident" id="4263663">intermediateNum</span><span class="op" id="4263678">]</span>&nbsp;<span class="op" id="4263680">=</span>&nbsp;<span class="ident" id="4263682">childChains</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4263696">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263700">chains</span>&nbsp;<span class="op" id="4263707">=</span>&nbsp;<span class="builtinfunc" id="4263709">append</span><span class="op" id="4263715">(</span><span class="ident" id="4263716">chains</span><span class="op" id="4263722">,</span>&nbsp;<span class="ident" id="4263724">childChains</span><span class="op" id="4263735">...</span><span class="op" id="4263738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4263741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4263745">if</span>&nbsp;<span class="builtinfunc" id="4263748">len</span><span class="op" id="4263751">(</span><span class="ident" id="4263752">chains</span><span class="op" id="4263758">)</span>&nbsp;<span class="op" id="4263760">&gt;</span>&nbsp;<span class="num" id="4263762">0</span>&nbsp;<span class="op" id="4263764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263768">err</span>&nbsp;<span class="op" id="4263772">=</span>&nbsp;<span class="ident" id="4263774">nil</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4263779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4263783">if</span>&nbsp;<span class="builtinfunc" id="4263786">len</span><span class="op" id="4263789">(</span><span class="ident" id="4263790">chains</span><span class="op" id="4263796">)</span>&nbsp;<span class="op" id="4263798">==</span>&nbsp;<span class="num" id="4263801">0</span>&nbsp;<span class="op" id="4263803">&amp;&amp;</span>&nbsp;<span class="ident" id="4263806">err</span>&nbsp;<span class="op" id="4263810">==</span>&nbsp;<span class="ident" id="4263813">nil</span>&nbsp;<span class="op" id="4263817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263821">hintErr</span>&nbsp;<span class="op" id="4263829">:=</span>&nbsp;<span class="ident" id="4263832">rootErr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263842">hintCert</span>&nbsp;<span class="op" id="4263851">:=</span>&nbsp;<span class="ident" id="4263854">failedRoot</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4263867">if</span>&nbsp;<span class="ident" id="4263870">hintErr</span>&nbsp;<span class="op" id="4263878">==</span>&nbsp;<span class="ident" id="4263881">nil</span>&nbsp;<span class="op" id="4263885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263890">hintErr</span>&nbsp;<span class="op" id="4263898">=</span>&nbsp;<span class="ident" id="4263900">intermediateErr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263919">hintCert</span>&nbsp;<span class="op" id="4263928">=</span>&nbsp;<span class="ident" id="4263930">failedIntermediate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4263951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263955">err</span>&nbsp;<span class="op" id="4263959">=</span>&nbsp;<span class="ident" id="4263961">UnknownAuthorityError</span><span class="op" id="4263982">{</span><span class="ident" id="4263983">c</span><span class="op" id="4263984">,</span>&nbsp;<span class="ident" id="4263986">hintErr</span><span class="op" id="4263993">,</span>&nbsp;<span class="ident" id="4263995">hintCert</span><span class="op" id="4264003">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4264006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264010">return</span><br>
<span class="lineno"></span><span class="op" id="4264017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="4264020">func</span>&nbsp;<span class="ident" id="4264025">matchHostnames</span><span class="op" id="4264039">(</span><span class="ident" id="4264040">pattern</span><span class="op" id="4264047">,</span>&nbsp;<span class="ident" id="4264049">host</span>&nbsp;<span class="builtintype" id="4264054">string</span><span class="op" id="4264060">)</span>&nbsp;<span class="builtintype" id="4264062">bool</span>&nbsp;<span class="op" id="4264067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264070">if</span>&nbsp;<span class="builtinfunc" id="4264073">len</span><span class="op" id="4264076">(</span><span class="ident" id="4264077">pattern</span><span class="op" id="4264084">)</span>&nbsp;<span class="op" id="4264086">==</span>&nbsp;<span class="num" id="4264089">0</span>&nbsp;<span class="op" id="4264091">||</span>&nbsp;<span class="builtinfunc" id="4264094">len</span><span class="op" id="4264097">(</span><span class="ident" id="4264098">host</span><span class="op" id="4264102">)</span>&nbsp;<span class="op" id="4264104">==</span>&nbsp;<span class="num" id="4264107">0</span>&nbsp;<span class="op" id="4264109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264113">return</span>&nbsp;<span class="builtintype" id="4264120">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4264127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4264131">patternParts</span>&nbsp;<span class="op" id="4264144">:=</span>&nbsp;<span class="ident" id="4264147">strings</span><span class="op" id="4264154">.</span><span class="ident" id="4264155">Split</span><span class="op" id="4264160">(</span><span class="ident" id="4264161">pattern</span><span class="op" id="4264168">,</span>&nbsp;<span class="string" id="4264170">&#34;.&#34;</span><span class="op" id="4264173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4264176">hostParts</span>&nbsp;<span class="op" id="4264186">:=</span>&nbsp;<span class="ident" id="4264189">strings</span><span class="op" id="4264196">.</span><span class="ident" id="4264197">Split</span><span class="op" id="4264202">(</span><span class="ident" id="4264203">host</span><span class="op" id="4264207">,</span>&nbsp;<span class="string" id="4264209">&#34;.&#34;</span><span class="op" id="4264212">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264216">if</span>&nbsp;<span class="builtinfunc" id="4264219">len</span><span class="op" id="4264222">(</span><span class="ident" id="4264223">patternParts</span><span class="op" id="4264235">)</span>&nbsp;<span class="op" id="4264237">!=</span>&nbsp;<span class="builtinfunc" id="4264240">len</span><span class="op" id="4264243">(</span><span class="ident" id="4264244">hostParts</span><span class="op" id="4264253">)</span>&nbsp;<span class="op" id="4264255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264259">return</span>&nbsp;<span class="builtintype" id="4264266">false</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4264273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264277">for</span>&nbsp;<span class="ident" id="4264281">i</span><span class="op" id="4264282">,</span>&nbsp;<span class="ident" id="4264284">patternPart</span>&nbsp;<span class="op" id="4264296">:=</span>&nbsp;<span class="keyword" id="4264299">range</span>&nbsp;<span class="ident" id="4264305">patternParts</span>&nbsp;<span class="op" id="4264318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264322">if</span>&nbsp;<span class="ident" id="4264325">patternPart</span>&nbsp;<span class="op" id="4264337">==</span>&nbsp;<span class="string" id="4264340">&#34;*&#34;</span>&nbsp;<span class="op" id="4264344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264349">continue</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4264360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264364">if</span>&nbsp;<span class="ident" id="4264367">patternPart</span>&nbsp;<span class="op" id="4264379">!=</span>&nbsp;<span class="ident" id="4264382">hostParts</span><span class="op" id="4264391">[</span><span class="ident" id="4264392">i</span><span class="op" id="4264393">]</span>&nbsp;<span class="op" id="4264395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264400">return</span>&nbsp;<span class="builtintype" id="4264407">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4264415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4264418">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264422">return</span>&nbsp;<span class="builtintype" id="4264429">true</span><br>
<span class="lineno"></span><span class="op" id="4264434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4264437">//&nbsp;toLowerCaseASCII&nbsp;returns&nbsp;a&nbsp;lower-case&nbsp;version&nbsp;of&nbsp;in.&nbsp;See&nbsp;RFC&nbsp;6125&nbsp;6.4.1.&nbsp;We&nbsp;use</span><br>
<span class="lineno">350</span><span class="comment" id="4264520">//&nbsp;an&nbsp;explicitly&nbsp;ASCII&nbsp;function&nbsp;to&nbsp;avoid&nbsp;any&nbsp;sharp&nbsp;corners&nbsp;resulting&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="4264594">//&nbsp;performing&nbsp;Unicode&nbsp;operations&nbsp;on&nbsp;DNS&nbsp;labels.</span><br>
<span class="lineno"></span><span class="keyword" id="4264642">func</span>&nbsp;<span class="ident" id="4264647">toLowerCaseASCII</span><span class="op" id="4264663">(</span><span class="ident" id="4264664">in</span>&nbsp;<span class="builtintype" id="4264667">string</span><span class="op" id="4264673">)</span>&nbsp;<span class="builtintype" id="4264675">string</span>&nbsp;<span class="op" id="4264682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4264685">//&nbsp;If&nbsp;the&nbsp;string&nbsp;is&nbsp;already&nbsp;lower-case&nbsp;then&nbsp;there&#39;s&nbsp;nothing&nbsp;to&nbsp;do.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4264753">isAlreadyLowerCase</span>&nbsp;<span class="op" id="4264772">:=</span>&nbsp;<span class="builtintype" id="4264775">true</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264781">for</span>&nbsp;<span class="ident" id="4264785">_</span><span class="op" id="4264786">,</span>&nbsp;<span class="ident" id="4264788">c</span>&nbsp;<span class="op" id="4264790">:=</span>&nbsp;<span class="keyword" id="4264793">range</span>&nbsp;<span class="ident" id="4264799">in</span>&nbsp;<span class="op" id="4264802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264806">if</span>&nbsp;<span class="ident" id="4264809">c</span>&nbsp;<span class="op" id="4264811">==</span>&nbsp;<span class="ident" id="4264814">utf8</span><span class="op" id="4264818">.</span><span class="ident" id="4264819">RuneError</span>&nbsp;<span class="op" id="4264829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4264834">//&nbsp;If&nbsp;we&nbsp;get&nbsp;a&nbsp;UTF-8&nbsp;error&nbsp;then&nbsp;there&nbsp;might&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4264884">//&nbsp;upper-case&nbsp;ASCII&nbsp;bytes&nbsp;in&nbsp;the&nbsp;invalid&nbsp;sequence.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4264938">isAlreadyLowerCase</span>&nbsp;<span class="op" id="4264957">=</span>&nbsp;<span class="builtintype" id="4264959">false</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264968">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4264976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264980">if</span>&nbsp;<span class="string" id="4264983">&#39;A&#39;</span>&nbsp;<span class="op" id="4264987">&lt;=</span>&nbsp;<span class="ident" id="4264990">c</span>&nbsp;<span class="op" id="4264992">&amp;&amp;</span>&nbsp;<span class="ident" id="4264995">c</span>&nbsp;<span class="op" id="4264997">&lt;=</span>&nbsp;<span class="string" id="4265000">&#39;Z&#39;</span>&nbsp;<span class="op" id="4265004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4265009">isAlreadyLowerCase</span>&nbsp;<span class="op" id="4265028">=</span>&nbsp;<span class="builtintype" id="4265030">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4265039">break</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4265047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4265050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4265054">if</span>&nbsp;<span class="ident" id="4265057">isAlreadyLowerCase</span>&nbsp;<span class="op" id="4265076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4265080">return</span>&nbsp;<span class="ident" id="4265087">in</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4265091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4265095">out</span>&nbsp;<span class="op" id="4265099">:=</span>&nbsp;<span class="op" id="4265102">[</span><span class="op" id="4265103">]</span><span class="builtintype" id="4265104">byte</span><span class="op" id="4265108">(</span><span class="ident" id="4265109">in</span><span class="op" id="4265111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4265114">for</span>&nbsp;<span class="ident" id="4265118">i</span><span class="op" id="4265119">,</span>&nbsp;<span class="ident" id="4265121">c</span>&nbsp;<span class="op" id="4265123">:=</span>&nbsp;<span class="keyword" id="4265126">range</span>&nbsp;<span class="ident" id="4265132">out</span>&nbsp;<span class="op" id="4265136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4265140">if</span>&nbsp;<span class="string" id="4265143">&#39;A&#39;</span>&nbsp;<span class="op" id="4265147">&lt;=</span>&nbsp;<span class="ident" id="4265150">c</span>&nbsp;<span class="op" id="4265152">&amp;&amp;</span>&nbsp;<span class="ident" id="4265155">c</span>&nbsp;<span class="op" id="4265157">&lt;=</span>&nbsp;<span class="string" id="4265160">&#39;Z&#39;</span>&nbsp;<span class="op" id="4265164">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4265169">out</span><span class="op" id="4265172">[</span><span class="ident" id="4265173">i</span><span class="op" id="4265174">]</span>&nbsp;<span class="op" id="4265176">+=</span>&nbsp;<span class="string" id="4265179">&#39;a&#39;</span>&nbsp;<span class="op" id="4265183">-</span>&nbsp;<span class="string" id="4265185">&#39;A&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4265191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4265194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4265197">return</span>&nbsp;<span class="builtintype" id="4265204">string</span><span class="op" id="4265210">(</span><span class="ident" id="4265211">out</span><span class="op" id="4265214">)</span><br>
<span class="lineno"></span><span class="op" id="4265216">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span><span class="comment" id="4265219">//&nbsp;VerifyHostname&nbsp;returns&nbsp;nil&nbsp;if&nbsp;c&nbsp;is&nbsp;a&nbsp;valid&nbsp;certificate&nbsp;for&nbsp;the&nbsp;named&nbsp;host.</span><br>
<span class="lineno"></span><span class="comment" id="4265297">//&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;an&nbsp;error&nbsp;describing&nbsp;the&nbsp;mismatch.</span><br>
<span class="lineno"></span><span class="keyword" id="4265355">func</span>&nbsp;<span class="op" id="4265360">(</span><span class="ident" id="4265361">c</span>&nbsp;<span class="op" id="4265363">*</span><span class="ident" id="4265364">Certificate</span><span class="op" id="4265375">)</span>&nbsp;<span class="ident" id="4265377">VerifyHostname</span><span class="op" id="4265391">(</span><span class="ident" id="4265392">h</span>&nbsp;<span class="builtintype" id="4265394">string</span><span class="op" id="4265400">)</span>&nbsp;<span class="builtintype" id="4265402">error</span>&nbsp;<span class="op" id="4265408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4265411">//&nbsp;IP&nbsp;addresses&nbsp;may&nbsp;be&nbsp;written&nbsp;in&nbsp;[&nbsp;].</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4265451">candidateIP</span>&nbsp;<span class="op" id="4265463">:=</span>&nbsp;<span class="ident" id="4265466">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4265469">if</span>&nbsp;<span class="builtinfunc" id="4265472">len</span><span class="op" id="4265475">(</span><span class="ident" id="4265476">h</span><span class="op" id="4265477">)</span>&nbsp;<span class="op" id="4265479">&gt;=</span>&nbsp;<span class="num" id="4265482">3</span>&nbsp;<span class="op" id="4265484">&amp;&amp;</span>&nbsp;<span class="ident" id="4265487">h</span><span class="op" id="4265488">[</span><span class="num" id="4265489">0</span><span class="op" id="4265490">]</span>&nbsp;<span class="op" id="4265492">==</span>&nbsp;<span class="string" id="4265495">&#39;[&#39;</span>&nbsp;<span class="op" id="4265499">&amp;&amp;</span>&nbsp;<span class="ident" id="4265502">h</span><span class="op" id="4265503">[</span><span class="builtinfunc" id="4265504">len</span><span class="op" id="4265507">(</span><span class="ident" id="4265508">h</span><span class="op" id="4265509">)</span><span class="op" id="4265510">-</span><span class="num" id="4265511">1</span><span class="op" id="4265512">]</span>&nbsp;<span class="op" id="4265514">==</span>&nbsp;<span class="string" id="4265517">&#39;]&#39;</span>&nbsp;<span class="op" id="4265521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4265525">candidateIP</span>&nbsp;<span class="op" id="4265537">=</span>&nbsp;<span class="ident" id="4265539">h</span><span class="op" id="4265540">[</span><span class="num" id="4265541">1</span>&nbsp;<span class="op" id="4265543">:</span>&nbsp;<span class="builtinfunc" id="4265545">len</span><span class="op" id="4265548">(</span><span class="ident" id="4265549">h</span><span class="op" id="4265550">)</span><span class="op" id="4265551">-</span><span class="num" id="4265552">1</span><span class="op" id="4265553">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4265556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4265559">if</span>&nbsp;<span class="ident" id="4265562">ip</span>&nbsp;<span class="op" id="4265565">:=</span>&nbsp;<span class="ident" id="4265568">net</span><span class="op" id="4265571">.</span><span class="ident" id="4265572">ParseIP</span><span class="op" id="4265579">(</span><span class="ident" id="4265580">candidateIP</span><span class="op" id="4265591">)</span><span class="op" id="4265592">;</span>&nbsp;<span class="ident" id="4265594">ip</span>&nbsp;<span class="op" id="4265597">!=</span>&nbsp;<span class="ident" id="4265600">nil</span>&nbsp;<span class="op" id="4265604">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4265608">//&nbsp;We&nbsp;only&nbsp;match&nbsp;IP&nbsp;addresses&nbsp;against&nbsp;IP&nbsp;SANs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4265657">//&nbsp;https://tools.ietf.org/html/rfc6125#appendix-B.2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4265711">for</span>&nbsp;<span class="ident" id="4265715">_</span><span class="op" id="4265716">,</span>&nbsp;<span class="ident" id="4265718">candidate</span>&nbsp;<span class="op" id="4265728">:=</span>&nbsp;<span class="keyword" id="4265731">range</span>&nbsp;<span class="ident" id="4265737">c</span><span class="op" id="4265738">.</span><span class="ident" id="4265739">IPAddresses</span>&nbsp;<span class="op" id="4265751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4265756">if</span>&nbsp;<span class="ident" id="4265759">ip</span><span class="op" id="4265761">.</span><span class="ident" id="4265762">Equal</span><span class="op" id="4265767">(</span><span class="ident" id="4265768">candidate</span><span class="op" id="4265777">)</span>&nbsp;<span class="op" id="4265779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4265785">return</span>&nbsp;<span class="ident" id="4265792">nil</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4265799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4265803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4265807">return</span>&nbsp;<span class="ident" id="4265814">HostnameError</span><span class="op" id="4265827">{</span><span class="ident" id="4265828">c</span><span class="op" id="4265829">,</span>&nbsp;<span class="ident" id="4265831">candidateIP</span><span class="op" id="4265842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4265845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4265849">lowered</span>&nbsp;<span class="op" id="4265857">:=</span>&nbsp;<span class="ident" id="4265860">toLowerCaseASCII</span><span class="op" id="4265876">(</span><span class="ident" id="4265877">h</span><span class="op" id="4265878">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4265882">if</span>&nbsp;<span class="builtinfunc" id="4265885">len</span><span class="op" id="4265888">(</span><span class="ident" id="4265889">c</span><span class="op" id="4265890">.</span><span class="ident" id="4265891">DNSNames</span><span class="op" id="4265899">)</span>&nbsp;<span class="op" id="4265901">&gt;</span>&nbsp;<span class="num" id="4265903">0</span>&nbsp;<span class="op" id="4265905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4265909">for</span>&nbsp;<span class="ident" id="4265913">_</span><span class="op" id="4265914">,</span>&nbsp;<span class="ident" id="4265916">match</span>&nbsp;<span class="op" id="4265922">:=</span>&nbsp;<span class="keyword" id="4265925">range</span>&nbsp;<span class="ident" id="4265931">c</span><span class="op" id="4265932">.</span><span class="ident" id="4265933">DNSNames</span>&nbsp;<span class="op" id="4265942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4265947">if</span>&nbsp;<span class="ident" id="4265950">matchHostnames</span><span class="op" id="4265964">(</span><span class="ident" id="4265965">toLowerCaseASCII</span><span class="op" id="4265981">(</span><span class="ident" id="4265982">match</span><span class="op" id="4265987">)</span><span class="op" id="4265988">,</span>&nbsp;<span class="ident" id="4265990">lowered</span><span class="op" id="4265997">)</span>&nbsp;<span class="op" id="4265999">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4266005">return</span>&nbsp;<span class="ident" id="4266012">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4266019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4266023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4266027">//&nbsp;If&nbsp;Subject&nbsp;Alt&nbsp;Name&nbsp;is&nbsp;given,&nbsp;we&nbsp;ignore&nbsp;the&nbsp;common&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4266088">}</span>&nbsp;<span class="keyword" id="4266090">else</span>&nbsp;<span class="keyword" id="4266095">if</span>&nbsp;<span class="ident" id="4266098">matchHostnames</span><span class="op" id="4266112">(</span><span class="ident" id="4266113">toLowerCaseASCII</span><span class="op" id="4266129">(</span><span class="ident" id="4266130">c</span><span class="op" id="4266131">.</span><span class="ident" id="4266132">Subject</span><span class="op" id="4266139">.</span><span class="ident" id="4266140">CommonName</span><span class="op" id="4266150">)</span><span class="op" id="4266151">,</span>&nbsp;<span class="ident" id="4266153">lowered</span><span class="op" id="4266160">)</span>&nbsp;<span class="op" id="4266162">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4266166">return</span>&nbsp;<span class="ident" id="4266173">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4266178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4266182">return</span>&nbsp;<span class="ident" id="4266189">HostnameError</span><span class="op" id="4266202">{</span><span class="ident" id="4266203">c</span><span class="op" id="4266204">,</span>&nbsp;<span class="ident" id="4266206">h</span><span class="op" id="4266207">}</span><br>
<span class="lineno"></span><span class="op" id="4266209">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="keyword" id="4266212">func</span>&nbsp;<span class="ident" id="4266217">checkChainForKeyUsage</span><span class="op" id="4266238">(</span><span class="ident" id="4266239">chain</span>&nbsp;<span class="op" id="4266245">[</span><span class="op" id="4266246">]</span><span class="op" id="4266247">*</span><span class="ident" id="4266248">Certificate</span><span class="op" id="4266259">,</span>&nbsp;<span class="ident" id="4266261">keyUsages</span>&nbsp;<span class="op" id="4266271">[</span><span class="op" id="4266272">]</span><span class="ident" id="4266273">ExtKeyUsage</span><span class="op" id="4266284">)</span>&nbsp;<span class="builtintype" id="4266286">bool</span>&nbsp;<span class="op" id="4266291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4266294">usages</span>&nbsp;<span class="op" id="4266301">:=</span>&nbsp;<span class="builtinfunc" id="4266304">make</span><span class="op" id="4266308">(</span><span class="op" id="4266309">[</span><span class="op" id="4266310">]</span><span class="ident" id="4266311">ExtKeyUsage</span><span class="op" id="4266322">,</span>&nbsp;<span class="builtinfunc" id="4266324">len</span><span class="op" id="4266327">(</span><span class="ident" id="4266328">keyUsages</span><span class="op" id="4266337">)</span><span class="op" id="4266338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4266341">copy</span><span class="op" id="4266345">(</span><span class="ident" id="4266346">usages</span><span class="op" id="4266352">,</span>&nbsp;<span class="ident" id="4266354">keyUsages</span><span class="op" id="4266363">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4266367">if</span>&nbsp;<span class="builtinfunc" id="4266370">len</span><span class="op" id="4266373">(</span><span class="ident" id="4266374">chain</span><span class="op" id="4266379">)</span>&nbsp;<span class="op" id="4266381">==</span>&nbsp;<span class="num" id="4266384">0</span>&nbsp;<span class="op" id="4266386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4266390">return</span>&nbsp;<span class="builtintype" id="4266397">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4266404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4266408">usagesRemaining</span>&nbsp;<span class="op" id="4266424">:=</span>&nbsp;<span class="builtinfunc" id="4266427">len</span><span class="op" id="4266430">(</span><span class="ident" id="4266431">usages</span><span class="op" id="4266437">)</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4266441">//&nbsp;We&nbsp;walk&nbsp;down&nbsp;the&nbsp;list&nbsp;and&nbsp;cross&nbsp;out&nbsp;any&nbsp;usages&nbsp;that&nbsp;aren&#39;t&nbsp;supported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4266514">//&nbsp;by&nbsp;each&nbsp;certificate.&nbsp;If&nbsp;we&nbsp;cross&nbsp;out&nbsp;all&nbsp;the&nbsp;usages,&nbsp;then&nbsp;the&nbsp;chain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4266586">//&nbsp;is&nbsp;unacceptable.</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="ident" id="4266607">NextCert</span><span class="op" id="4266615">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4266618">for</span>&nbsp;<span class="ident" id="4266622">i</span>&nbsp;<span class="op" id="4266624">:=</span>&nbsp;<span class="builtinfunc" id="4266627">len</span><span class="op" id="4266630">(</span><span class="ident" id="4266631">chain</span><span class="op" id="4266636">)</span>&nbsp;<span class="op" id="4266638">-</span>&nbsp;<span class="num" id="4266640">1</span><span class="op" id="4266641">;</span>&nbsp;<span class="ident" id="4266643">i</span>&nbsp;<span class="op" id="4266645">&gt;=</span>&nbsp;<span class="num" id="4266648">0</span><span class="op" id="4266649">;</span>&nbsp;<span class="ident" id="4266651">i</span><span class="op" id="4266652">--</span>&nbsp;<span class="op" id="4266655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4266659">cert</span>&nbsp;<span class="op" id="4266664">:=</span>&nbsp;<span class="ident" id="4266667">chain</span><span class="op" id="4266672">[</span><span class="ident" id="4266673">i</span><span class="op" id="4266674">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4266678">if</span>&nbsp;<span class="builtinfunc" id="4266681">len</span><span class="op" id="4266684">(</span><span class="ident" id="4266685">cert</span><span class="op" id="4266689">.</span><span class="ident" id="4266690">ExtKeyUsage</span><span class="op" id="4266701">)</span>&nbsp;<span class="op" id="4266703">==</span>&nbsp;<span class="num" id="4266706">0</span>&nbsp;<span class="op" id="4266708">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4266711">len</span><span class="op" id="4266714">(</span><span class="ident" id="4266715">cert</span><span class="op" id="4266719">.</span><span class="ident" id="4266720">UnknownExtKeyUsage</span><span class="op" id="4266738">)</span>&nbsp;<span class="op" id="4266740">==</span>&nbsp;<span class="num" id="4266743">0</span>&nbsp;<span class="op" id="4266745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4266750">//&nbsp;The&nbsp;certificate&nbsp;doesn&#39;t&nbsp;have&nbsp;any&nbsp;extended&nbsp;key&nbsp;usage&nbsp;specified.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4266819">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4266830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4266835">for</span>&nbsp;<span class="ident" id="4266839">_</span><span class="op" id="4266840">,</span>&nbsp;<span class="ident" id="4266842">usage</span>&nbsp;<span class="op" id="4266848">:=</span>&nbsp;<span class="keyword" id="4266851">range</span>&nbsp;<span class="ident" id="4266857">cert</span><span class="op" id="4266861">.</span><span class="ident" id="4266862">ExtKeyUsage</span>&nbsp;<span class="op" id="4266874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4266879">if</span>&nbsp;<span class="ident" id="4266882">usage</span>&nbsp;<span class="op" id="4266888">==</span>&nbsp;<span class="ident" id="4266891">ExtKeyUsageAny</span>&nbsp;<span class="op" id="4266906">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4266912">//&nbsp;The&nbsp;certificate&nbsp;is&nbsp;explicitly&nbsp;good&nbsp;for&nbsp;any&nbsp;usage.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4266969">continue</span>&nbsp;<span class="ident" id="4266978">NextCert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4266990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4266994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4266999">const</span>&nbsp;<span class="ident" id="4267005">invalidUsage</span>&nbsp;<span class="ident" id="4267018">ExtKeyUsage</span>&nbsp;<span class="op" id="4267030">=</span>&nbsp;<span class="op" id="4267032">-</span><span class="num" id="4267033">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267037">NextRequestedUsage</span><span class="op" id="4267055">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4267059">for</span>&nbsp;<span class="ident" id="4267063">i</span><span class="op" id="4267064">,</span>&nbsp;<span class="ident" id="4267066">requestedUsage</span>&nbsp;<span class="op" id="4267081">:=</span>&nbsp;<span class="keyword" id="4267084">range</span>&nbsp;<span class="ident" id="4267090">usages</span>&nbsp;<span class="op" id="4267097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4267102">if</span>&nbsp;<span class="ident" id="4267105">requestedUsage</span>&nbsp;<span class="op" id="4267120">==</span>&nbsp;<span class="ident" id="4267123">invalidUsage</span>&nbsp;<span class="op" id="4267136">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4267142">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4267154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4267160">for</span>&nbsp;<span class="ident" id="4267164">_</span><span class="op" id="4267165">,</span>&nbsp;<span class="ident" id="4267167">usage</span>&nbsp;<span class="op" id="4267173">:=</span>&nbsp;<span class="keyword" id="4267176">range</span>&nbsp;<span class="ident" id="4267182">cert</span><span class="op" id="4267186">.</span><span class="ident" id="4267187">ExtKeyUsage</span>&nbsp;<span class="op" id="4267199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4267205">if</span>&nbsp;<span class="ident" id="4267208">requestedUsage</span>&nbsp;<span class="op" id="4267223">==</span>&nbsp;<span class="ident" id="4267226">usage</span>&nbsp;<span class="op" id="4267232">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4267239">continue</span>&nbsp;<span class="ident" id="4267248">NextRequestedUsage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4267271">}</span>&nbsp;<span class="keyword" id="4267273">else</span>&nbsp;<span class="keyword" id="4267278">if</span>&nbsp;<span class="ident" id="4267281">requestedUsage</span>&nbsp;<span class="op" id="4267296">==</span>&nbsp;<span class="ident" id="4267299">ExtKeyUsageServerAuth</span>&nbsp;<span class="op" id="4267321">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4267329">(</span><span class="ident" id="4267330">usage</span>&nbsp;<span class="op" id="4267336">==</span>&nbsp;<span class="ident" id="4267339">ExtKeyUsageNetscapeServerGatedCrypto</span>&nbsp;<span class="op" id="4267376">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267385">usage</span>&nbsp;<span class="op" id="4267391">==</span>&nbsp;<span class="ident" id="4267394">ExtKeyUsageMicrosoftServerGatedCrypto</span><span class="op" id="4267431">)</span>&nbsp;<span class="op" id="4267433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4267440">//&nbsp;In&nbsp;order&nbsp;to&nbsp;support&nbsp;COMODO</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4267475">//&nbsp;certificate&nbsp;chains,&nbsp;we&nbsp;have&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4267514">//&nbsp;accept&nbsp;Netscape&nbsp;or&nbsp;Microsoft&nbsp;SGC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4267555">//&nbsp;usages&nbsp;as&nbsp;equal&nbsp;to&nbsp;ServerAuth.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4267594">continue</span>&nbsp;<span class="ident" id="4267603">NextRequestedUsage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4267626">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4267631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267637">usages</span><span class="op" id="4267643">[</span><span class="ident" id="4267644">i</span><span class="op" id="4267645">]</span>&nbsp;<span class="op" id="4267647">=</span>&nbsp;<span class="ident" id="4267649">invalidUsage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267665">usagesRemaining</span><span class="op" id="4267680">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4267686">if</span>&nbsp;<span class="ident" id="4267689">usagesRemaining</span>&nbsp;<span class="op" id="4267705">==</span>&nbsp;<span class="num" id="4267708">0</span>&nbsp;<span class="op" id="4267710">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4267716">return</span>&nbsp;<span class="builtintype" id="4267723">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4267732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4267736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4267739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4267743">return</span>&nbsp;<span class="builtintype" id="4267750">true</span><br>
<span class="lineno"></span><span class="op" id="4267755">}</span>
</div>
</body>
</html>
