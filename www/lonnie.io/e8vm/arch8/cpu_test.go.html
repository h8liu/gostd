<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="7511759">package</span>&nbsp;<span class="ident" id="7511767">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7511774">import</span>&nbsp;<span class="op" id="7511781">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7511784">&#34;testing&#34;</span><br>
<span class="lineno">5</span><span class="op" id="7511794">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7511797">type</span>&nbsp;<span class="ident" id="7511802">ti1</span>&nbsp;<span class="builtintype" id="7511806">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7511811">func</span>&nbsp;<span class="op" id="7511816">(</span><span class="ident" id="7511817">i</span>&nbsp;<span class="ident" id="7511819"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7511802">ti1</a></span><span class="op" id="7511822">)</span>&nbsp;<span class="ident" id="7511824">I</span><span class="op" id="7511825">(</span><span class="ident" id="7511826">cpu</span>&nbsp;<span class="op" id="7511830">*</span><span class="ident" id="7511831"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5285853">cpu</a></span><span class="op" id="7511834">,</span>&nbsp;<span class="ident" id="7511836">in</span>&nbsp;<span class="builtintype" id="7511839">uint32</span><span class="op" id="7511845">)</span>&nbsp;<span class="op" id="7511847">*</span><span class="ident" id="7511848"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5290324">Excep</a></span>&nbsp;<span class="op" id="7511854">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7511857">switch</span>&nbsp;<span class="ident" id="7511864"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7511836">in</a></span>&nbsp;<span class="op" id="7511867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7511870">case</span>&nbsp;<span class="num" id="7511875">0</span><span class="op" id="7511876">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7511880">return</span>&nbsp;<span class="ident" id="7511887"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5290806">errHalt</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7511896">case</span>&nbsp;<span class="num" id="7511901">1</span><span class="op" id="7511902">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7511906">return</span>&nbsp;<span class="ident" id="7511913"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5290850">errTimeInt</a></span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7511925">case</span>&nbsp;<span class="num" id="7511930">2</span><span class="op" id="7511931">:</span>&nbsp;<span class="comment" id="7511933">//&nbsp;iret</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7511943">if</span>&nbsp;<span class="ident" id="7511946"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7511826">cpu</a></span><span class="op" id="7511949">.</span><span class="ident" id="7511950">UserMode</span><span class="op" id="7511958">(</span><span class="op" id="7511959">)</span>&nbsp;<span class="op" id="7511961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7511966">return</span>&nbsp;<span class="ident" id="7511973"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5290905">errInvalidInst</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7511990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7511994">return</span>&nbsp;<span class="ident" id="7512001"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7511826">cpu</a></span><span class="op" id="7512004">.</span><span class="ident" id="7512005">Iret</span><span class="op" id="7512009">(</span><span class="op" id="7512010">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7512013">default</span><span class="op" id="7512020">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7512024">return</span>&nbsp;<span class="ident" id="7512031"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5290905">errInvalidInst</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7512047">}</span><br>
<span class="lineno"></span><span class="op" id="7512049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="7512052">func</span>&nbsp;<span class="ident" id="7512057">TestCPU</span><span class="op" id="7512064">(</span><span class="ident" id="7512065">t</span>&nbsp;<span class="op" id="7512067">*</span><span class="ident" id="7512068"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7511784">testing</a></span><span class="op" id="7512075">.</span><span class="ident" id="7512076">T</span><span class="op" id="7512077">)</span>&nbsp;<span class="op" id="7512079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512082">as</span>&nbsp;<span class="op" id="7512085">:=</span>&nbsp;<span class="keyword" id="7512088">func</span><span class="op" id="7512092">(</span><span class="ident" id="7512093">cond</span>&nbsp;<span class="builtintype" id="7512098">bool</span><span class="op" id="7512102">,</span>&nbsp;<span class="ident" id="7512104">s</span>&nbsp;<span class="builtintype" id="7512106">string</span><span class="op" id="7512112">,</span>&nbsp;<span class="ident" id="7512114">args</span>&nbsp;<span class="op" id="7512119">...</span><span class="keyword" id="7512122">interface</span><span class="op" id="7512131">{</span><span class="op" id="7512132">}</span><span class="op" id="7512133">)</span>&nbsp;<span class="op" id="7512135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7512139">if</span>&nbsp;<span class="op" id="7512142">!</span><span class="ident" id="7512143"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512093">cond</a></span>&nbsp;<span class="op" id="7512148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512153"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512065">t</a></span><span class="op" id="7512154">.</span><span class="ident" id="7512155">Fatalf</span><span class="op" id="7512161">(</span><span class="ident" id="7512162"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512104">s</a></span><span class="op" id="7512163">,</span>&nbsp;<span class="ident" id="7512165"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512114">args</a></span><span class="op" id="7512169">...</span><span class="op" id="7512172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7512176">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7512179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512183">m</span>&nbsp;<span class="op" id="7512185">:=</span>&nbsp;<span class="ident" id="7512188"><a href="/lonnie.io/e8vm/arch8/phy_memory.go.html#5309431">newPhyMemory</a></span><span class="op" id="7512200">(</span><span class="ident" id="7512201"><a href="/lonnie.io/e8vm/arch8/page.go.html#5304619">PageSize</a></span>&nbsp;<span class="op" id="7512210">*</span>&nbsp;<span class="num" id="7512212">32</span><span class="op" id="7512214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512217">cpu</span>&nbsp;<span class="op" id="7512221">:=</span>&nbsp;<span class="ident" id="7512224"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286144">newCPU</a></span><span class="op" id="7512230">(</span><span class="ident" id="7512231"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512183">m</a></span><span class="op" id="7512232">,</span>&nbsp;<span class="ident" id="7512234"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7511802">ti1</a></span><span class="op" id="7512237">(</span><span class="num" id="7512238">0</span><span class="op" id="7512239">)</span><span class="op" id="7512240">,</span>&nbsp;<span class="num" id="7512242">0</span><span class="op" id="7512243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512246">e</span>&nbsp;<span class="op" id="7512248">:=</span>&nbsp;<span class="ident" id="7512251"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512217">cpu</a></span><span class="op" id="7512254">.</span><span class="ident" id="7512255">Tick</span><span class="op" id="7512259">(</span><span class="op" id="7512260">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512263"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512082">as</a></span><span class="op" id="7512265">(</span><span class="ident" id="7512266"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512246">e</a></span>&nbsp;<span class="op" id="7512268">==</span>&nbsp;<span class="ident" id="7512271"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5290806">errHalt</a></span><span class="op" id="7512278">,</span>&nbsp;<span class="string" id="7512280">&#34;not&nbsp;halting&#34;</span><span class="op" id="7512293">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512297"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512217">cpu</a></span><span class="op" id="7512300">.</span><span class="ident" id="7512301">Reset</span><span class="op" id="7512306">(</span><span class="op" id="7512307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512310"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512183">m</a></span><span class="op" id="7512311">.</span><span class="ident" id="7512312">WriteWord</span><span class="op" id="7512321">(</span><span class="ident" id="7512322"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5286062">InitPC</a></span><span class="op" id="7512328">,</span>&nbsp;<span class="num" id="7512330">1</span><span class="op" id="7512331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512334"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512246">e</a></span>&nbsp;<span class="op" id="7512336">=</span>&nbsp;<span class="ident" id="7512338"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512217">cpu</a></span><span class="op" id="7512341">.</span><span class="ident" id="7512342">Tick</span><span class="op" id="7512346">(</span><span class="op" id="7512347">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512350"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512082">as</a></span><span class="op" id="7512352">(</span><span class="ident" id="7512353"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512246">e</a></span>&nbsp;<span class="op" id="7512355">==</span>&nbsp;<span class="ident" id="7512358"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5290850">errTimeInt</a></span><span class="op" id="7512368">,</span>&nbsp;<span class="string" id="7512370">&#34;not&nbsp;time&nbsp;interrupt&#34;</span><span class="op" id="7512390">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512394"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512217">cpu</a></span><span class="op" id="7512397">.</span><span class="ident" id="7512398">Reset</span><span class="op" id="7512403">(</span><span class="op" id="7512404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512407"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512217">cpu</a></span><span class="op" id="7512410">.</span><span class="ident" id="7512411">interrupt</span><span class="op" id="7512420">.</span><span class="ident" id="7512421">Enable</span><span class="op" id="7512427">(</span><span class="op" id="7512428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512431"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512217">cpu</a></span><span class="op" id="7512434">.</span><span class="ident" id="7512435">interrupt</span><span class="op" id="7512444">.</span><span class="ident" id="7512445">EnableInt</span><span class="op" id="7512454">(</span><span class="ident" id="7512455"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5290850">errTimeInt</a></span><span class="op" id="7512465">.</span><span class="ident" id="7512466">Code</span><span class="op" id="7512470">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512473"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512217">cpu</a></span><span class="op" id="7512476">.</span><span class="ident" id="7512477">interrupt</span><span class="op" id="7512486">.</span><span class="ident" id="7512487">writeWord</span><span class="op" id="7512496">(</span><span class="ident" id="7512497"><a href="/lonnie.io/e8vm/arch8/interrupt.go.html#5297707">intKernelSP</a></span><span class="op" id="7512508">,</span>&nbsp;<span class="num" id="7512510">0x10000</span><span class="op" id="7512517">)</span>&nbsp;&nbsp;<span class="comment" id="7512520">//&nbsp;page&nbsp;16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512532"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512217">cpu</a></span><span class="op" id="7512535">.</span><span class="ident" id="7512536">interrupt</span><span class="op" id="7512545">.</span><span class="ident" id="7512546">writeWord</span><span class="op" id="7512555">(</span><span class="ident" id="7512556"><a href="/lonnie.io/e8vm/arch8/interrupt.go.html#5297772">intHandlerPC</a></span><span class="op" id="7512568">,</span>&nbsp;<span class="num" id="7512570">0x10000</span><span class="op" id="7512577">)</span>&nbsp;<span class="comment" id="7512579">//&nbsp;page&nbsp;16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512591"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512217">cpu</a></span><span class="op" id="7512594">.</span><span class="ident" id="7512595">ring</span>&nbsp;<span class="op" id="7512600">=</span>&nbsp;<span class="num" id="7512602">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512606"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512246">e</a></span>&nbsp;<span class="op" id="7512608">=</span>&nbsp;<span class="ident" id="7512610"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512217">cpu</a></span><span class="op" id="7512613">.</span><span class="ident" id="7512614">Tick</span><span class="op" id="7512618">(</span><span class="op" id="7512619">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512622"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512082">as</a></span><span class="op" id="7512624">(</span><span class="ident" id="7512625"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512246">e</a></span>&nbsp;<span class="op" id="7512627">==</span>&nbsp;<span class="ident" id="7512630">nil</span><span class="op" id="7512633">,</span>&nbsp;<span class="string" id="7512635">&#34;should&nbsp;have&nbsp;no&nbsp;error&#34;</span><span class="op" id="7512657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512660"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512082">as</a></span><span class="op" id="7512662">(</span><span class="ident" id="7512663"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512217">cpu</a></span><span class="op" id="7512666">.</span><span class="ident" id="7512667">regs</span><span class="op" id="7512671">[</span><span class="ident" id="7512672"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5311636">PC</a></span><span class="op" id="7512674">]</span>&nbsp;<span class="op" id="7512676">==</span>&nbsp;<span class="num" id="7512679">0x10000</span><span class="op" id="7512686">,</span>&nbsp;<span class="string" id="7512688">&#34;pc&nbsp;incorrect&#34;</span><span class="op" id="7512702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512705"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512082">as</a></span><span class="op" id="7512707">(</span><span class="ident" id="7512708"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512217">cpu</a></span><span class="op" id="7512711">.</span><span class="ident" id="7512712">regs</span><span class="op" id="7512716">[</span><span class="ident" id="7512717"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5311618">SP</a></span><span class="op" id="7512719">]</span>&nbsp;<span class="op" id="7512721">==</span>&nbsp;<span class="num" id="7512724">0x10000</span><span class="op" id="7512731">,</span>&nbsp;<span class="string" id="7512733">&#34;sp&nbsp;incorrect&#34;</span><span class="op" id="7512747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512750"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512082">as</a></span><span class="op" id="7512752">(</span><span class="ident" id="7512753"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512217">cpu</a></span><span class="op" id="7512756">.</span><span class="ident" id="7512757">regs</span><span class="op" id="7512761">[</span><span class="ident" id="7512762"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5311627">RET</a></span><span class="op" id="7512765">]</span>&nbsp;<span class="op" id="7512767">==</span>&nbsp;<span class="num" id="7512770">0x8000</span><span class="op" id="7512776">,</span>&nbsp;<span class="string" id="7512778">&#34;ret&nbsp;incorrect&#34;</span><span class="op" id="7512793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512796"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512082">as</a></span><span class="op" id="7512798">(</span><span class="op" id="7512799">!</span><span class="ident" id="7512800"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512217">cpu</a></span><span class="op" id="7512803">.</span><span class="ident" id="7512804">UserMode</span><span class="op" id="7512812">(</span><span class="op" id="7512813">)</span><span class="op" id="7512814">,</span>&nbsp;<span class="string" id="7512816">&#34;not&nbsp;in&nbsp;kernel&#34;</span><span class="op" id="7512831">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512834">b</span><span class="op" id="7512835">,</span>&nbsp;<span class="ident" id="7512837"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512246">e</a></span>&nbsp;<span class="op" id="7512839">:=</span>&nbsp;<span class="ident" id="7512842"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512183">m</a></span><span class="op" id="7512843">.</span><span class="ident" id="7512844">ReadByte</span><span class="op" id="7512852">(</span><span class="num" id="7512853">0x10000</span>&nbsp;<span class="op" id="7512861">-</span>&nbsp;<span class="ident" id="7512863"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287325">intFrameSize</a></span>&nbsp;<span class="op" id="7512876">+</span>&nbsp;<span class="ident" id="7512878"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287286">intFrameCode</a></span><span class="op" id="7512890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512893"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512082">as</a></span><span class="op" id="7512895">(</span><span class="ident" id="7512896"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512246">e</a></span>&nbsp;<span class="op" id="7512898">==</span>&nbsp;<span class="ident" id="7512901">nil</span><span class="op" id="7512904">,</span>&nbsp;<span class="string" id="7512906">&#34;read&nbsp;byte&nbsp;error&#34;</span><span class="op" id="7512923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512926"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512082">as</a></span><span class="op" id="7512928">(</span><span class="ident" id="7512929"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512834">b</a></span>&nbsp;<span class="op" id="7512931">==</span>&nbsp;<span class="ident" id="7512934"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5290850">errTimeInt</a></span><span class="op" id="7512944">.</span><span class="ident" id="7512945">Code</span><span class="op" id="7512949">,</span>&nbsp;<span class="string" id="7512951">&#34;not&nbsp;time&nbsp;interrupt&#34;</span><span class="op" id="7512971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7512974"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512834">b</a></span><span class="op" id="7512975">,</span>&nbsp;<span class="ident" id="7512977"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512246">e</a></span>&nbsp;<span class="op" id="7512979">=</span>&nbsp;<span class="ident" id="7512981"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512183">m</a></span><span class="op" id="7512982">.</span><span class="ident" id="7512983">ReadByte</span><span class="op" id="7512991">(</span><span class="num" id="7512992">0x10000</span>&nbsp;<span class="op" id="7513000">-</span>&nbsp;<span class="ident" id="7513002"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287325">intFrameSize</a></span>&nbsp;<span class="op" id="7513015">+</span>&nbsp;<span class="ident" id="7513017"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5287305">intFrameRing</a></span><span class="op" id="7513029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513032"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512082">as</a></span><span class="op" id="7513034">(</span><span class="ident" id="7513035"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512834">b</a></span>&nbsp;<span class="op" id="7513037">==</span>&nbsp;<span class="num" id="7513040">1</span><span class="op" id="7513041">,</span>&nbsp;<span class="string" id="7513043">&#34;was&nbsp;not&nbsp;in&nbsp;user&#34;</span><span class="op" id="7513060">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513063"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512082">as</a></span><span class="op" id="7513065">(</span><span class="op" id="7513066">!</span><span class="ident" id="7513067"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512217">cpu</a></span><span class="op" id="7513070">.</span><span class="ident" id="7513071">interrupt</span><span class="op" id="7513080">.</span><span class="ident" id="7513081">Enabled</span><span class="op" id="7513088">(</span><span class="op" id="7513089">)</span><span class="op" id="7513090">,</span>&nbsp;<span class="string" id="7513092">&#34;interrupt&nbsp;not&nbsp;disabled&#34;</span><span class="op" id="7513116">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513120"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512246">e</a></span>&nbsp;<span class="op" id="7513122">=</span>&nbsp;<span class="ident" id="7513124"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512217">cpu</a></span><span class="op" id="7513127">.</span><span class="ident" id="7513128">Tick</span><span class="op" id="7513132">(</span><span class="op" id="7513133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513136"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512082">as</a></span><span class="op" id="7513138">(</span><span class="ident" id="7513139"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512246">e</a></span>&nbsp;<span class="op" id="7513141">==</span>&nbsp;<span class="ident" id="7513144"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5290806">errHalt</a></span><span class="op" id="7513151">,</span>&nbsp;<span class="string" id="7513153">&#34;should&nbsp;halt&nbsp;now&#34;</span><span class="op" id="7513170">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513174"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512217">cpu</a></span><span class="op" id="7513177">.</span><span class="ident" id="7513178">Reset</span><span class="op" id="7513183">(</span><span class="op" id="7513184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513187"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512217">cpu</a></span><span class="op" id="7513190">.</span><span class="ident" id="7513191">interrupt</span><span class="op" id="7513200">.</span><span class="ident" id="7513201">Enable</span><span class="op" id="7513207">(</span><span class="op" id="7513208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513211"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512217">cpu</a></span><span class="op" id="7513214">.</span><span class="ident" id="7513215">ring</span>&nbsp;<span class="op" id="7513220">=</span>&nbsp;<span class="num" id="7513222">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513225"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512183">m</a></span><span class="op" id="7513226">.</span><span class="ident" id="7513227">WriteWord</span><span class="op" id="7513236">(</span><span class="num" id="7513237">0x10000</span><span class="op" id="7513244">,</span>&nbsp;<span class="num" id="7513246">2</span><span class="op" id="7513247">)</span>&nbsp;<span class="comment" id="7513249">//&nbsp;write&nbsp;an&nbsp;iret</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513267"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512246">e</a></span>&nbsp;<span class="op" id="7513269">=</span>&nbsp;<span class="ident" id="7513271"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512217">cpu</a></span><span class="op" id="7513274">.</span><span class="ident" id="7513275">Tick</span><span class="op" id="7513279">(</span><span class="op" id="7513280">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513283"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512082">as</a></span><span class="op" id="7513285">(</span><span class="ident" id="7513286"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512246">e</a></span>&nbsp;<span class="op" id="7513288">==</span>&nbsp;<span class="ident" id="7513291">nil</span><span class="op" id="7513294">,</span>&nbsp;<span class="string" id="7513296">&#34;unexpected&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7513318">,</span>&nbsp;<span class="ident" id="7513320"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512246">e</a></span><span class="op" id="7513321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513324"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512082">as</a></span><span class="op" id="7513326">(</span><span class="op" id="7513327">!</span><span class="ident" id="7513328"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512217">cpu</a></span><span class="op" id="7513331">.</span><span class="ident" id="7513332">interrupt</span><span class="op" id="7513341">.</span><span class="ident" id="7513342">Enabled</span><span class="op" id="7513349">(</span><span class="op" id="7513350">)</span><span class="op" id="7513351">,</span>&nbsp;<span class="string" id="7513353">&#34;interrupt&nbsp;not&nbsp;disabled&#34;</span><span class="op" id="7513377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513380"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512246">e</a></span>&nbsp;<span class="op" id="7513382">=</span>&nbsp;<span class="ident" id="7513384"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512217">cpu</a></span><span class="op" id="7513387">.</span><span class="ident" id="7513388">Tick</span><span class="op" id="7513392">(</span><span class="op" id="7513393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513396"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512082">as</a></span><span class="op" id="7513398">(</span><span class="ident" id="7513399"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512246">e</a></span>&nbsp;<span class="op" id="7513401">==</span>&nbsp;<span class="ident" id="7513404">nil</span><span class="op" id="7513407">,</span>&nbsp;<span class="string" id="7513409">&#34;unexpected&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7513431">,</span>&nbsp;<span class="ident" id="7513433"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512246">e</a></span><span class="op" id="7513434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513437"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512082">as</a></span><span class="op" id="7513439">(</span><span class="ident" id="7513440"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512217">cpu</a></span><span class="op" id="7513443">.</span><span class="ident" id="7513444">regs</span><span class="op" id="7513448">[</span><span class="ident" id="7513449"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5311636">PC</a></span><span class="op" id="7513451">]</span>&nbsp;<span class="op" id="7513453">==</span>&nbsp;<span class="num" id="7513456">0x8000</span><span class="op" id="7513462">,</span>&nbsp;<span class="string" id="7513464">&#34;pc&nbsp;not&nbsp;iret&#39;ed&#34;</span><span class="op" id="7513480">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513483"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512082">as</a></span><span class="op" id="7513485">(</span><span class="ident" id="7513486"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512217">cpu</a></span><span class="op" id="7513489">.</span><span class="ident" id="7513490">regs</span><span class="op" id="7513494">[</span><span class="ident" id="7513495"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5311618">SP</a></span><span class="op" id="7513497">]</span>&nbsp;<span class="op" id="7513499">==</span>&nbsp;<span class="num" id="7513502">0</span><span class="op" id="7513503">,</span>&nbsp;<span class="string" id="7513505">&#34;sp&nbsp;not&nbsp;restored&#34;</span><span class="op" id="7513522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513525"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512082">as</a></span><span class="op" id="7513527">(</span><span class="ident" id="7513528"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512217">cpu</a></span><span class="op" id="7513531">.</span><span class="ident" id="7513532">ring</span>&nbsp;<span class="op" id="7513537">==</span>&nbsp;<span class="num" id="7513540">1</span><span class="op" id="7513541">,</span>&nbsp;<span class="string" id="7513543">&#34;ring&nbsp;not&nbsp;restored&#34;</span><span class="op" id="7513562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513565"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512082">as</a></span><span class="op" id="7513567">(</span><span class="ident" id="7513568"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512217">cpu</a></span><span class="op" id="7513571">.</span><span class="ident" id="7513572">interrupt</span><span class="op" id="7513581">.</span><span class="ident" id="7513582">Enabled</span><span class="op" id="7513589">(</span><span class="op" id="7513590">)</span><span class="op" id="7513591">,</span>&nbsp;<span class="string" id="7513593">&#34;interrupt&nbsp;not&nbsp;enabled&nbsp;again&#34;</span><span class="op" id="7513622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513625">has</span><span class="op" id="7513628">,</span>&nbsp;<span class="ident" id="7513630">code</span>&nbsp;<span class="op" id="7513635">:=</span>&nbsp;<span class="ident" id="7513638"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512217">cpu</a></span><span class="op" id="7513641">.</span><span class="ident" id="7513642">interrupt</span><span class="op" id="7513651">.</span><span class="ident" id="7513652">Poll</span><span class="op" id="7513656">(</span><span class="op" id="7513657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7513660"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7512082">as</a></span><span class="op" id="7513662">(</span><span class="op" id="7513663">!</span><span class="ident" id="7513664"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7513625">has</a></span>&nbsp;<span class="op" id="7513668">&amp;&amp;</span>&nbsp;<span class="ident" id="7513671"><a href="/lonnie.io/e8vm/arch8/cpu_test.go.html#7513630">code</a></span>&nbsp;<span class="op" id="7513676">==</span>&nbsp;<span class="num" id="7513679">0</span><span class="op" id="7513680">,</span>&nbsp;<span class="string" id="7513682">&#34;interrupt&nbsp;was&nbsp;not&nbsp;cleared&#34;</span><span class="op" id="7513709">)</span><br>
<span class="lineno">80</span><span class="op" id="7513711">}</span>
</div>
</body>
</html>
