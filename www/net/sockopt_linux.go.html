<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2684743">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2684799">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2684853">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2684904">package</span>&nbsp;<span class="ident" id="2684912">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2684917">import</span>&nbsp;<span class="op" id="2684924">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2684927">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2684933">&#34;syscall&#34;</span><br>
<span class="lineno">10</span><span class="op" id="2684943">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2684946">func</span>&nbsp;<span class="ident" id="2684951">setDefaultSockopts</span><span class="op" id="2684969">(</span><span class="ident" id="2684970">s</span><span class="op" id="2684971">,</span>&nbsp;<span class="ident" id="2684973">family</span><span class="op" id="2684979">,</span>&nbsp;<span class="ident" id="2684981">sotype</span>&nbsp;<span class="builtintype" id="2684988">int</span><span class="op" id="2684991">,</span>&nbsp;<span class="ident" id="2684993">ipv6only</span>&nbsp;<span class="builtintype" id="2685002">bool</span><span class="op" id="2685006">)</span>&nbsp;<span class="builtintype" id="2685008">error</span>&nbsp;<span class="op" id="2685014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2685017">if</span>&nbsp;<span class="ident" id="2685020"><a href="/net/sockopt_linux.go.html#2684973">family</a></span>&nbsp;<span class="op" id="2685027">==</span>&nbsp;<span class="ident" id="2685030"><a href="/net/sockopt_linux.go.html#2684933">syscall</a></span><span class="op" id="2685037">.</span><span class="ident" id="2685038">AF_INET6</span>&nbsp;<span class="op" id="2685047">&amp;&amp;</span>&nbsp;<span class="ident" id="2685050"><a href="/net/sockopt_linux.go.html#2684981">sotype</a></span>&nbsp;<span class="op" id="2685057">!=</span>&nbsp;<span class="ident" id="2685060"><a href="/net/sockopt_linux.go.html#2684933">syscall</a></span><span class="op" id="2685067">.</span><span class="ident" id="2685068">SOCK_RAW</span>&nbsp;<span class="op" id="2685077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2685081">//&nbsp;Allow&nbsp;both&nbsp;IP&nbsp;versions&nbsp;even&nbsp;if&nbsp;the&nbsp;OS&nbsp;default</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2685132">//&nbsp;is&nbsp;otherwise.&nbsp;&nbsp;Note&nbsp;that&nbsp;some&nbsp;operating&nbsp;systems</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2685185">//&nbsp;never&nbsp;admit&nbsp;this&nbsp;option.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2685215"><a href="/net/sockopt_linux.go.html#2684933">syscall</a></span><span class="op" id="2685222">.</span><span class="ident" id="2685223">SetsockoptInt</span><span class="op" id="2685236">(</span><span class="ident" id="2685237"><a href="/net/sockopt_linux.go.html#2684970">s</a></span><span class="op" id="2685238">,</span>&nbsp;<span class="ident" id="2685240"><a href="/net/sockopt_linux.go.html#2684933">syscall</a></span><span class="op" id="2685247">.</span><span class="ident" id="2685248">IPPROTO_IPV6</span><span class="op" id="2685260">,</span>&nbsp;<span class="ident" id="2685262"><a href="/net/sockopt_linux.go.html#2684933">syscall</a></span><span class="op" id="2685269">.</span><span class="ident" id="2685270">IPV6_V6ONLY</span><span class="op" id="2685281">,</span>&nbsp;<span class="ident" id="2685283"><a href="/net/sockopt_posix.go.html#2686216">boolint</a></span><span class="op" id="2685290">(</span><span class="ident" id="2685291"><a href="/net/sockopt_linux.go.html#2684993">ipv6only</a></span><span class="op" id="2685299">)</span><span class="op" id="2685300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2685303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2685306">//&nbsp;Allow&nbsp;broadcast.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2685327">return</span>&nbsp;<span class="ident" id="2685334"><a href="/net/sockopt_linux.go.html#2684927">os</a></span><span class="op" id="2685336">.</span><span class="ident" id="2685337">NewSyscallError</span><span class="op" id="2685352">(</span><span class="string" id="2685353">&#34;setsockopt&#34;</span><span class="op" id="2685365">,</span>&nbsp;<span class="ident" id="2685367"><a href="/net/sockopt_linux.go.html#2684933">syscall</a></span><span class="op" id="2685374">.</span><span class="ident" id="2685375">SetsockoptInt</span><span class="op" id="2685388">(</span><span class="ident" id="2685389"><a href="/net/sockopt_linux.go.html#2684970">s</a></span><span class="op" id="2685390">,</span>&nbsp;<span class="ident" id="2685392"><a href="/net/sockopt_linux.go.html#2684933">syscall</a></span><span class="op" id="2685399">.</span><span class="ident" id="2685400">SOL_SOCKET</span><span class="op" id="2685410">,</span>&nbsp;<span class="ident" id="2685412"><a href="/net/sockopt_linux.go.html#2684933">syscall</a></span><span class="op" id="2685419">.</span><span class="ident" id="2685420">SO_BROADCAST</span><span class="op" id="2685432">,</span>&nbsp;<span class="num" id="2685434">1</span><span class="op" id="2685435">)</span><span class="op" id="2685436">)</span><br>
<span class="lineno"></span><span class="op" id="2685438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2685441">func</span>&nbsp;<span class="ident" id="2685446">setDefaultListenerSockopts</span><span class="op" id="2685472">(</span><span class="ident" id="2685473">s</span>&nbsp;<span class="builtintype" id="2685475">int</span><span class="op" id="2685478">)</span>&nbsp;<span class="builtintype" id="2685480">error</span>&nbsp;<span class="op" id="2685486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2685489">//&nbsp;Allow&nbsp;reuse&nbsp;of&nbsp;recently-used&nbsp;addresses.</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2685533">return</span>&nbsp;<span class="ident" id="2685540"><a href="/net/sockopt_linux.go.html#2684927">os</a></span><span class="op" id="2685542">.</span><span class="ident" id="2685543">NewSyscallError</span><span class="op" id="2685558">(</span><span class="string" id="2685559">&#34;setsockopt&#34;</span><span class="op" id="2685571">,</span>&nbsp;<span class="ident" id="2685573"><a href="/net/sockopt_linux.go.html#2684933">syscall</a></span><span class="op" id="2685580">.</span><span class="ident" id="2685581">SetsockoptInt</span><span class="op" id="2685594">(</span><span class="ident" id="2685595"><a href="/net/sockopt_linux.go.html#2685473">s</a></span><span class="op" id="2685596">,</span>&nbsp;<span class="ident" id="2685598"><a href="/net/sockopt_linux.go.html#2684933">syscall</a></span><span class="op" id="2685605">.</span><span class="ident" id="2685606">SOL_SOCKET</span><span class="op" id="2685616">,</span>&nbsp;<span class="ident" id="2685618"><a href="/net/sockopt_linux.go.html#2684933">syscall</a></span><span class="op" id="2685625">.</span><span class="ident" id="2685626">SO_REUSEADDR</span><span class="op" id="2685638">,</span>&nbsp;<span class="num" id="2685640">1</span><span class="op" id="2685641">)</span><span class="op" id="2685642">)</span><br>
<span class="lineno"></span><span class="op" id="2685644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2685647">func</span>&nbsp;<span class="ident" id="2685652">setDefaultMulticastSockopts</span><span class="op" id="2685679">(</span><span class="ident" id="2685680">s</span>&nbsp;<span class="builtintype" id="2685682">int</span><span class="op" id="2685685">)</span>&nbsp;<span class="builtintype" id="2685687">error</span>&nbsp;<span class="op" id="2685693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2685696">//&nbsp;Allow&nbsp;multicast&nbsp;UDP&nbsp;and&nbsp;raw&nbsp;IP&nbsp;datagram&nbsp;sockets&nbsp;to&nbsp;listen</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2685758">//&nbsp;concurrently&nbsp;across&nbsp;multiple&nbsp;listeners.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2685802">return</span>&nbsp;<span class="ident" id="2685809"><a href="/net/sockopt_linux.go.html#2684927">os</a></span><span class="op" id="2685811">.</span><span class="ident" id="2685812">NewSyscallError</span><span class="op" id="2685827">(</span><span class="string" id="2685828">&#34;setsockopt&#34;</span><span class="op" id="2685840">,</span>&nbsp;<span class="ident" id="2685842"><a href="/net/sockopt_linux.go.html#2684933">syscall</a></span><span class="op" id="2685849">.</span><span class="ident" id="2685850">SetsockoptInt</span><span class="op" id="2685863">(</span><span class="ident" id="2685864"><a href="/net/sockopt_linux.go.html#2685680">s</a></span><span class="op" id="2685865">,</span>&nbsp;<span class="ident" id="2685867"><a href="/net/sockopt_linux.go.html#2684933">syscall</a></span><span class="op" id="2685874">.</span><span class="ident" id="2685875">SOL_SOCKET</span><span class="op" id="2685885">,</span>&nbsp;<span class="ident" id="2685887"><a href="/net/sockopt_linux.go.html#2684933">syscall</a></span><span class="op" id="2685894">.</span><span class="ident" id="2685895">SO_REUSEADDR</span><span class="op" id="2685907">,</span>&nbsp;<span class="num" id="2685909">1</span><span class="op" id="2685910">)</span><span class="op" id="2685911">)</span><br>
<span class="lineno"></span><span class="op" id="2685913">}</span>
</div>
</body>
</html>
