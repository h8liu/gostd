<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1768706">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1768761">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1768815">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1768866">//&nbsp;Pipe&nbsp;adapter&nbsp;to&nbsp;connect&nbsp;code&nbsp;expecting&nbsp;an&nbsp;io.Reader</span><br>
<span class="lineno"></span><span class="comment" id="1768921">//&nbsp;with&nbsp;code&nbsp;expecting&nbsp;an&nbsp;io.Writer.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1768959">package</span>&nbsp;<span class="ident" id="1768967">io</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="1768971">import</span>&nbsp;<span class="op" id="1768978">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1768981">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1768991">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="1768998">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="1769001">//&nbsp;ErrClosedPipe&nbsp;is&nbsp;the&nbsp;error&nbsp;used&nbsp;for&nbsp;read&nbsp;or&nbsp;write&nbsp;operations&nbsp;on&nbsp;a&nbsp;closed&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="keyword" id="1769083">var</span>&nbsp;<span class="ident" id="1769087">ErrClosedPipe</span>&nbsp;<span class="op" id="1769101">=</span>&nbsp;<span class="ident" id="1769103">errors</span><span class="op" id="1769109">.</span><span class="ident" id="1769110">New</span><span class="op" id="1769113">(</span><span class="string" id="1769114">&#34;io:&nbsp;read/write&nbsp;on&nbsp;closed&nbsp;pipe&#34;</span><span class="op" id="1769145">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1769148">type</span>&nbsp;<span class="ident" id="1769153">pipeResult</span>&nbsp;<span class="keyword" id="1769164">struct</span>&nbsp;<span class="op" id="1769171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769174">n</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1769178">int</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769183">err</span>&nbsp;<span class="builtintype" id="1769187">error</span><br>
<span class="lineno"></span><span class="op" id="1769193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1769196">//&nbsp;A&nbsp;pipe&nbsp;is&nbsp;the&nbsp;shared&nbsp;pipe&nbsp;structure&nbsp;underlying&nbsp;PipeReader&nbsp;and&nbsp;PipeWriter.</span><br>
<span class="lineno"></span><span class="keyword" id="1769273">type</span>&nbsp;<span class="ident" id="1769278">pipe</span>&nbsp;<span class="keyword" id="1769283">struct</span>&nbsp;<span class="op" id="1769290">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769293">rl</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1769299">sync</span><span class="op" id="1769303">.</span><span class="ident" id="1769304">Mutex</span>&nbsp;<span class="comment" id="1769310">//&nbsp;gates&nbsp;readers&nbsp;one&nbsp;at&nbsp;a&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769342">wl</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1769348">sync</span><span class="op" id="1769352">.</span><span class="ident" id="1769353">Mutex</span>&nbsp;<span class="comment" id="1769359">//&nbsp;gates&nbsp;writers&nbsp;one&nbsp;at&nbsp;a&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769391">l</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1769397">sync</span><span class="op" id="1769401">.</span><span class="ident" id="1769402">Mutex</span>&nbsp;<span class="comment" id="1769408">//&nbsp;protects&nbsp;remaining&nbsp;fields</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769438">data</span>&nbsp;&nbsp;<span class="op" id="1769444">[</span><span class="op" id="1769445">]</span><span class="builtintype" id="1769446">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1769455">//&nbsp;data&nbsp;remaining&nbsp;in&nbsp;pending&nbsp;write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769491">rwait</span>&nbsp;<span class="ident" id="1769497">sync</span><span class="op" id="1769501">.</span><span class="ident" id="1769502">Cond</span>&nbsp;&nbsp;<span class="comment" id="1769508">//&nbsp;waiting&nbsp;reader</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769527">wwait</span>&nbsp;<span class="ident" id="1769533">sync</span><span class="op" id="1769537">.</span><span class="ident" id="1769538">Cond</span>&nbsp;&nbsp;<span class="comment" id="1769544">//&nbsp;waiting&nbsp;writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769563">rerr</span>&nbsp;&nbsp;<span class="builtintype" id="1769569">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1769580">//&nbsp;if&nbsp;reader&nbsp;closed,&nbsp;error&nbsp;to&nbsp;give&nbsp;writes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769623">werr</span>&nbsp;&nbsp;<span class="builtintype" id="1769629">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1769640">//&nbsp;if&nbsp;writer&nbsp;closed,&nbsp;error&nbsp;to&nbsp;give&nbsp;reads</span><br>
<span class="lineno"></span><span class="op" id="1769681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="1769684">func</span>&nbsp;<span class="op" id="1769689">(</span><span class="ident" id="1769690">p</span>&nbsp;<span class="op" id="1769692">*</span><span class="ident" id="1769693">pipe</span><span class="op" id="1769697">)</span>&nbsp;<span class="ident" id="1769699">read</span><span class="op" id="1769703">(</span><span class="ident" id="1769704">b</span>&nbsp;<span class="op" id="1769706">[</span><span class="op" id="1769707">]</span><span class="builtintype" id="1769708">byte</span><span class="op" id="1769712">)</span>&nbsp;<span class="op" id="1769714">(</span><span class="ident" id="1769715">n</span>&nbsp;<span class="builtintype" id="1769717">int</span><span class="op" id="1769720">,</span>&nbsp;<span class="ident" id="1769722">err</span>&nbsp;<span class="builtintype" id="1769726">error</span><span class="op" id="1769731">)</span>&nbsp;<span class="op" id="1769733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1769736">//&nbsp;One&nbsp;reader&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769762">p</span><span class="op" id="1769763">.</span><span class="ident" id="1769764">rl</span><span class="op" id="1769766">.</span><span class="ident" id="1769767">Lock</span><span class="op" id="1769771">(</span><span class="op" id="1769772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769775">defer</span>&nbsp;<span class="ident" id="1769781">p</span><span class="op" id="1769782">.</span><span class="ident" id="1769783">rl</span><span class="op" id="1769785">.</span><span class="ident" id="1769786">Unlock</span><span class="op" id="1769792">(</span><span class="op" id="1769793">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769797">p</span><span class="op" id="1769798">.</span><span class="ident" id="1769799">l</span><span class="op" id="1769800">.</span><span class="ident" id="1769801">Lock</span><span class="op" id="1769805">(</span><span class="op" id="1769806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769809">defer</span>&nbsp;<span class="ident" id="1769815">p</span><span class="op" id="1769816">.</span><span class="ident" id="1769817">l</span><span class="op" id="1769818">.</span><span class="ident" id="1769819">Unlock</span><span class="op" id="1769825">(</span><span class="op" id="1769826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769829">for</span>&nbsp;<span class="op" id="1769833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769837">if</span>&nbsp;<span class="ident" id="1769840">p</span><span class="op" id="1769841">.</span><span class="ident" id="1769842">rerr</span>&nbsp;<span class="op" id="1769847">!=</span>&nbsp;<span class="ident" id="1769850">nil</span>&nbsp;<span class="op" id="1769854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769859">return</span>&nbsp;<span class="num" id="1769866">0</span><span class="op" id="1769867">,</span>&nbsp;<span class="ident" id="1769869">ErrClosedPipe</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1769885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769889">if</span>&nbsp;<span class="ident" id="1769892">p</span><span class="op" id="1769893">.</span><span class="ident" id="1769894">data</span>&nbsp;<span class="op" id="1769899">!=</span>&nbsp;<span class="ident" id="1769902">nil</span>&nbsp;<span class="op" id="1769906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769911">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1769919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769923">if</span>&nbsp;<span class="ident" id="1769926">p</span><span class="op" id="1769927">.</span><span class="ident" id="1769928">werr</span>&nbsp;<span class="op" id="1769933">!=</span>&nbsp;<span class="ident" id="1769936">nil</span>&nbsp;<span class="op" id="1769940">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769945">return</span>&nbsp;<span class="num" id="1769952">0</span><span class="op" id="1769953">,</span>&nbsp;<span class="ident" id="1769955">p</span><span class="op" id="1769956">.</span><span class="ident" id="1769957">werr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1769964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769968">p</span><span class="op" id="1769969">.</span><span class="ident" id="1769970">rwait</span><span class="op" id="1769975">.</span><span class="ident" id="1769976">Wait</span><span class="op" id="1769980">(</span><span class="op" id="1769981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1769984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769987">n</span>&nbsp;<span class="op" id="1769989">=</span>&nbsp;<span class="builtinfunc" id="1769991">copy</span><span class="op" id="1769995">(</span><span class="ident" id="1769996">b</span><span class="op" id="1769997">,</span>&nbsp;<span class="ident" id="1769999">p</span><span class="op" id="1770000">.</span><span class="ident" id="1770001">data</span><span class="op" id="1770005">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770008">p</span><span class="op" id="1770009">.</span><span class="ident" id="1770010">data</span>&nbsp;<span class="op" id="1770015">=</span>&nbsp;<span class="ident" id="1770017">p</span><span class="op" id="1770018">.</span><span class="ident" id="1770019">data</span><span class="op" id="1770023">[</span><span class="ident" id="1770024">n</span><span class="op" id="1770025">:</span><span class="op" id="1770026">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770029">if</span>&nbsp;<span class="builtinfunc" id="1770032">len</span><span class="op" id="1770035">(</span><span class="ident" id="1770036">p</span><span class="op" id="1770037">.</span><span class="ident" id="1770038">data</span><span class="op" id="1770042">)</span>&nbsp;<span class="op" id="1770044">==</span>&nbsp;<span class="num" id="1770047">0</span>&nbsp;<span class="op" id="1770049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770053">p</span><span class="op" id="1770054">.</span><span class="ident" id="1770055">data</span>&nbsp;<span class="op" id="1770060">=</span>&nbsp;<span class="ident" id="1770062">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770068">p</span><span class="op" id="1770069">.</span><span class="ident" id="1770070">wwait</span><span class="op" id="1770075">.</span><span class="ident" id="1770076">Signal</span><span class="op" id="1770082">(</span><span class="op" id="1770083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1770086">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770089">return</span><br>
<span class="lineno"></span><span class="op" id="1770096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1770099">var</span>&nbsp;<span class="ident" id="1770103">zero</span>&nbsp;<span class="op" id="1770108">[</span><span class="num" id="1770109">0</span><span class="op" id="1770110">]</span><span class="builtintype" id="1770111">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="1770117">func</span>&nbsp;<span class="op" id="1770122">(</span><span class="ident" id="1770123">p</span>&nbsp;<span class="op" id="1770125">*</span><span class="ident" id="1770126">pipe</span><span class="op" id="1770130">)</span>&nbsp;<span class="ident" id="1770132">write</span><span class="op" id="1770137">(</span><span class="ident" id="1770138">b</span>&nbsp;<span class="op" id="1770140">[</span><span class="op" id="1770141">]</span><span class="builtintype" id="1770142">byte</span><span class="op" id="1770146">)</span>&nbsp;<span class="op" id="1770148">(</span><span class="ident" id="1770149">n</span>&nbsp;<span class="builtintype" id="1770151">int</span><span class="op" id="1770154">,</span>&nbsp;<span class="ident" id="1770156">err</span>&nbsp;<span class="builtintype" id="1770160">error</span><span class="op" id="1770165">)</span>&nbsp;<span class="op" id="1770167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1770170">//&nbsp;pipe&nbsp;uses&nbsp;nil&nbsp;to&nbsp;mean&nbsp;not&nbsp;available</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770210">if</span>&nbsp;<span class="ident" id="1770213">b</span>&nbsp;<span class="op" id="1770215">==</span>&nbsp;<span class="ident" id="1770218">nil</span>&nbsp;<span class="op" id="1770222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770226">b</span>&nbsp;<span class="op" id="1770228">=</span>&nbsp;<span class="ident" id="1770230">zero</span><span class="op" id="1770234">[</span><span class="op" id="1770235">:</span><span class="op" id="1770236">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1770239">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1770243">//&nbsp;One&nbsp;writer&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770269">p</span><span class="op" id="1770270">.</span><span class="ident" id="1770271">wl</span><span class="op" id="1770273">.</span><span class="ident" id="1770274">Lock</span><span class="op" id="1770278">(</span><span class="op" id="1770279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770282">defer</span>&nbsp;<span class="ident" id="1770288">p</span><span class="op" id="1770289">.</span><span class="ident" id="1770290">wl</span><span class="op" id="1770292">.</span><span class="ident" id="1770293">Unlock</span><span class="op" id="1770299">(</span><span class="op" id="1770300">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770304">p</span><span class="op" id="1770305">.</span><span class="ident" id="1770306">l</span><span class="op" id="1770307">.</span><span class="ident" id="1770308">Lock</span><span class="op" id="1770312">(</span><span class="op" id="1770313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770316">defer</span>&nbsp;<span class="ident" id="1770322">p</span><span class="op" id="1770323">.</span><span class="ident" id="1770324">l</span><span class="op" id="1770325">.</span><span class="ident" id="1770326">Unlock</span><span class="op" id="1770332">(</span><span class="op" id="1770333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770336">if</span>&nbsp;<span class="ident" id="1770339">p</span><span class="op" id="1770340">.</span><span class="ident" id="1770341">werr</span>&nbsp;<span class="op" id="1770346">!=</span>&nbsp;<span class="ident" id="1770349">nil</span>&nbsp;<span class="op" id="1770353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770357">err</span>&nbsp;<span class="op" id="1770361">=</span>&nbsp;<span class="ident" id="1770363">ErrClosedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770379">return</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1770387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770390">p</span><span class="op" id="1770391">.</span><span class="ident" id="1770392">data</span>&nbsp;<span class="op" id="1770397">=</span>&nbsp;<span class="ident" id="1770399">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770402">p</span><span class="op" id="1770403">.</span><span class="ident" id="1770404">rwait</span><span class="op" id="1770409">.</span><span class="ident" id="1770410">Signal</span><span class="op" id="1770416">(</span><span class="op" id="1770417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770420">for</span>&nbsp;<span class="op" id="1770424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770428">if</span>&nbsp;<span class="ident" id="1770431">p</span><span class="op" id="1770432">.</span><span class="ident" id="1770433">data</span>&nbsp;<span class="op" id="1770438">==</span>&nbsp;<span class="ident" id="1770441">nil</span>&nbsp;<span class="op" id="1770445">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770450">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1770458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770462">if</span>&nbsp;<span class="ident" id="1770465">p</span><span class="op" id="1770466">.</span><span class="ident" id="1770467">rerr</span>&nbsp;<span class="op" id="1770472">!=</span>&nbsp;<span class="ident" id="1770475">nil</span>&nbsp;<span class="op" id="1770479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770484">err</span>&nbsp;<span class="op" id="1770488">=</span>&nbsp;<span class="ident" id="1770490">p</span><span class="op" id="1770491">.</span><span class="ident" id="1770492">rerr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770500">break</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1770508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770512">if</span>&nbsp;<span class="ident" id="1770515">p</span><span class="op" id="1770516">.</span><span class="ident" id="1770517">werr</span>&nbsp;<span class="op" id="1770522">!=</span>&nbsp;<span class="ident" id="1770525">nil</span>&nbsp;<span class="op" id="1770529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770534">err</span>&nbsp;<span class="op" id="1770538">=</span>&nbsp;<span class="ident" id="1770540">ErrClosedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1770556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770560">p</span><span class="op" id="1770561">.</span><span class="ident" id="1770562">wwait</span><span class="op" id="1770567">.</span><span class="ident" id="1770568">Wait</span><span class="op" id="1770572">(</span><span class="op" id="1770573">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1770576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770579">n</span>&nbsp;<span class="op" id="1770581">=</span>&nbsp;<span class="builtinfunc" id="1770583">len</span><span class="op" id="1770586">(</span><span class="ident" id="1770587">b</span><span class="op" id="1770588">)</span>&nbsp;<span class="op" id="1770590">-</span>&nbsp;<span class="builtinfunc" id="1770592">len</span><span class="op" id="1770595">(</span><span class="ident" id="1770596">p</span><span class="op" id="1770597">.</span><span class="ident" id="1770598">data</span><span class="op" id="1770602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770605">p</span><span class="op" id="1770606">.</span><span class="ident" id="1770607">data</span>&nbsp;<span class="op" id="1770612">=</span>&nbsp;<span class="ident" id="1770614">nil</span>&nbsp;<span class="comment" id="1770618">//&nbsp;in&nbsp;case&nbsp;of&nbsp;rerr&nbsp;or&nbsp;werr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770646">return</span><br>
<span class="lineno"></span><span class="op" id="1770653">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="1770656">func</span>&nbsp;<span class="op" id="1770661">(</span><span class="ident" id="1770662">p</span>&nbsp;<span class="op" id="1770664">*</span><span class="ident" id="1770665">pipe</span><span class="op" id="1770669">)</span>&nbsp;<span class="ident" id="1770671">rclose</span><span class="op" id="1770677">(</span><span class="ident" id="1770678">err</span>&nbsp;<span class="builtintype" id="1770682">error</span><span class="op" id="1770687">)</span>&nbsp;<span class="op" id="1770689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770692">if</span>&nbsp;<span class="ident" id="1770695">err</span>&nbsp;<span class="op" id="1770699">==</span>&nbsp;<span class="ident" id="1770702">nil</span>&nbsp;<span class="op" id="1770706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770710">err</span>&nbsp;<span class="op" id="1770714">=</span>&nbsp;<span class="ident" id="1770716">ErrClosedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1770731">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770734">p</span><span class="op" id="1770735">.</span><span class="ident" id="1770736">l</span><span class="op" id="1770737">.</span><span class="ident" id="1770738">Lock</span><span class="op" id="1770742">(</span><span class="op" id="1770743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770746">defer</span>&nbsp;<span class="ident" id="1770752">p</span><span class="op" id="1770753">.</span><span class="ident" id="1770754">l</span><span class="op" id="1770755">.</span><span class="ident" id="1770756">Unlock</span><span class="op" id="1770762">(</span><span class="op" id="1770763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770766">p</span><span class="op" id="1770767">.</span><span class="ident" id="1770768">rerr</span>&nbsp;<span class="op" id="1770773">=</span>&nbsp;<span class="ident" id="1770775">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770780">p</span><span class="op" id="1770781">.</span><span class="ident" id="1770782">rwait</span><span class="op" id="1770787">.</span><span class="ident" id="1770788">Signal</span><span class="op" id="1770794">(</span><span class="op" id="1770795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770798">p</span><span class="op" id="1770799">.</span><span class="ident" id="1770800">wwait</span><span class="op" id="1770805">.</span><span class="ident" id="1770806">Signal</span><span class="op" id="1770812">(</span><span class="op" id="1770813">)</span><br>
<span class="lineno">110</span><span class="op" id="1770815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1770818">func</span>&nbsp;<span class="op" id="1770823">(</span><span class="ident" id="1770824">p</span>&nbsp;<span class="op" id="1770826">*</span><span class="ident" id="1770827">pipe</span><span class="op" id="1770831">)</span>&nbsp;<span class="ident" id="1770833">wclose</span><span class="op" id="1770839">(</span><span class="ident" id="1770840">err</span>&nbsp;<span class="builtintype" id="1770844">error</span><span class="op" id="1770849">)</span>&nbsp;<span class="op" id="1770851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770854">if</span>&nbsp;<span class="ident" id="1770857">err</span>&nbsp;<span class="op" id="1770861">==</span>&nbsp;<span class="ident" id="1770864">nil</span>&nbsp;<span class="op" id="1770868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770872">err</span>&nbsp;<span class="op" id="1770876">=</span>&nbsp;<span class="ident" id="1770878">EOF</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1770883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770886">p</span><span class="op" id="1770887">.</span><span class="ident" id="1770888">l</span><span class="op" id="1770889">.</span><span class="ident" id="1770890">Lock</span><span class="op" id="1770894">(</span><span class="op" id="1770895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770898">defer</span>&nbsp;<span class="ident" id="1770904">p</span><span class="op" id="1770905">.</span><span class="ident" id="1770906">l</span><span class="op" id="1770907">.</span><span class="ident" id="1770908">Unlock</span><span class="op" id="1770914">(</span><span class="op" id="1770915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770918">p</span><span class="op" id="1770919">.</span><span class="ident" id="1770920">werr</span>&nbsp;<span class="op" id="1770925">=</span>&nbsp;<span class="ident" id="1770927">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770932">p</span><span class="op" id="1770933">.</span><span class="ident" id="1770934">rwait</span><span class="op" id="1770939">.</span><span class="ident" id="1770940">Signal</span><span class="op" id="1770946">(</span><span class="op" id="1770947">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770950">p</span><span class="op" id="1770951">.</span><span class="ident" id="1770952">wwait</span><span class="op" id="1770957">.</span><span class="ident" id="1770958">Signal</span><span class="op" id="1770964">(</span><span class="op" id="1770965">)</span><br>
<span class="lineno"></span><span class="op" id="1770967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1770970">//&nbsp;A&nbsp;PipeReader&nbsp;is&nbsp;the&nbsp;read&nbsp;half&nbsp;of&nbsp;a&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="keyword" id="1771014">type</span>&nbsp;<span class="ident" id="1771019">PipeReader</span>&nbsp;<span class="keyword" id="1771030">struct</span>&nbsp;<span class="op" id="1771037">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771040">p</span>&nbsp;<span class="op" id="1771042">*</span><span class="ident" id="1771043">pipe</span><br>
<span class="lineno"></span><span class="op" id="1771048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1771051">//&nbsp;Read&nbsp;implements&nbsp;the&nbsp;standard&nbsp;Read&nbsp;interface:</span><br>
<span class="lineno"></span><span class="comment" id="1771099">//&nbsp;it&nbsp;reads&nbsp;data&nbsp;from&nbsp;the&nbsp;pipe,&nbsp;blocking&nbsp;until&nbsp;a&nbsp;writer</span><br>
<span class="lineno">130</span><span class="comment" id="1771155">//&nbsp;arrives&nbsp;or&nbsp;the&nbsp;write&nbsp;end&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="comment" id="1771194">//&nbsp;If&nbsp;the&nbsp;write&nbsp;end&nbsp;is&nbsp;closed&nbsp;with&nbsp;an&nbsp;error,&nbsp;that&nbsp;error&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1771253">//&nbsp;returned&nbsp;as&nbsp;err;&nbsp;otherwise&nbsp;err&nbsp;is&nbsp;EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="1771295">func</span>&nbsp;<span class="op" id="1771300">(</span><span class="ident" id="1771301">r</span>&nbsp;<span class="op" id="1771303">*</span><span class="ident" id="1771304">PipeReader</span><span class="op" id="1771314">)</span>&nbsp;<span class="ident" id="1771316">Read</span><span class="op" id="1771320">(</span><span class="ident" id="1771321">data</span>&nbsp;<span class="op" id="1771326">[</span><span class="op" id="1771327">]</span><span class="builtintype" id="1771328">byte</span><span class="op" id="1771332">)</span>&nbsp;<span class="op" id="1771334">(</span><span class="ident" id="1771335">n</span>&nbsp;<span class="builtintype" id="1771337">int</span><span class="op" id="1771340">,</span>&nbsp;<span class="ident" id="1771342">err</span>&nbsp;<span class="builtintype" id="1771346">error</span><span class="op" id="1771351">)</span>&nbsp;<span class="op" id="1771353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1771356">return</span>&nbsp;<span class="ident" id="1771363">r</span><span class="op" id="1771364">.</span><span class="ident" id="1771365">p</span><span class="op" id="1771366">.</span><span class="ident" id="1771367">read</span><span class="op" id="1771371">(</span><span class="ident" id="1771372">data</span><span class="op" id="1771376">)</span><br>
<span class="lineno">135</span><span class="op" id="1771378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1771381">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;reader;&nbsp;subsequent&nbsp;writes&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1771434">//&nbsp;write&nbsp;half&nbsp;of&nbsp;the&nbsp;pipe&nbsp;will&nbsp;return&nbsp;the&nbsp;error&nbsp;ErrClosedPipe.</span><br>
<span class="lineno"></span><span class="keyword" id="1771497">func</span>&nbsp;<span class="op" id="1771502">(</span><span class="ident" id="1771503">r</span>&nbsp;<span class="op" id="1771505">*</span><span class="ident" id="1771506">PipeReader</span><span class="op" id="1771516">)</span>&nbsp;<span class="ident" id="1771518">Close</span><span class="op" id="1771523">(</span><span class="op" id="1771524">)</span>&nbsp;<span class="builtintype" id="1771526">error</span>&nbsp;<span class="op" id="1771532">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1771535">return</span>&nbsp;<span class="ident" id="1771542">r</span><span class="op" id="1771543">.</span><span class="ident" id="1771544">CloseWithError</span><span class="op" id="1771558">(</span><span class="ident" id="1771559">nil</span><span class="op" id="1771562">)</span><br>
<span class="lineno"></span><span class="op" id="1771564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1771567">//&nbsp;CloseWithError&nbsp;closes&nbsp;the&nbsp;reader;&nbsp;subsequent&nbsp;writes</span><br>
<span class="lineno"></span><span class="comment" id="1771622">//&nbsp;to&nbsp;the&nbsp;write&nbsp;half&nbsp;of&nbsp;the&nbsp;pipe&nbsp;will&nbsp;return&nbsp;the&nbsp;error&nbsp;err.</span><br>
<span class="lineno">145</span><span class="keyword" id="1771682">func</span>&nbsp;<span class="op" id="1771687">(</span><span class="ident" id="1771688">r</span>&nbsp;<span class="op" id="1771690">*</span><span class="ident" id="1771691">PipeReader</span><span class="op" id="1771701">)</span>&nbsp;<span class="ident" id="1771703">CloseWithError</span><span class="op" id="1771717">(</span><span class="ident" id="1771718">err</span>&nbsp;<span class="builtintype" id="1771722">error</span><span class="op" id="1771727">)</span>&nbsp;<span class="builtintype" id="1771729">error</span>&nbsp;<span class="op" id="1771735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771738">r</span><span class="op" id="1771739">.</span><span class="ident" id="1771740">p</span><span class="op" id="1771741">.</span><span class="ident" id="1771742">rclose</span><span class="op" id="1771748">(</span><span class="ident" id="1771749">err</span><span class="op" id="1771752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1771755">return</span>&nbsp;<span class="ident" id="1771762">nil</span><br>
<span class="lineno"></span><span class="op" id="1771766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="1771769">//&nbsp;A&nbsp;PipeWriter&nbsp;is&nbsp;the&nbsp;write&nbsp;half&nbsp;of&nbsp;a&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="keyword" id="1771814">type</span>&nbsp;<span class="ident" id="1771819">PipeWriter</span>&nbsp;<span class="keyword" id="1771830">struct</span>&nbsp;<span class="op" id="1771837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771840">p</span>&nbsp;<span class="op" id="1771842">*</span><span class="ident" id="1771843">pipe</span><br>
<span class="lineno"></span><span class="op" id="1771848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="comment" id="1771851">//&nbsp;Write&nbsp;implements&nbsp;the&nbsp;standard&nbsp;Write&nbsp;interface:</span><br>
<span class="lineno"></span><span class="comment" id="1771901">//&nbsp;it&nbsp;writes&nbsp;data&nbsp;to&nbsp;the&nbsp;pipe,&nbsp;blocking&nbsp;until&nbsp;readers</span><br>
<span class="lineno"></span><span class="comment" id="1771955">//&nbsp;have&nbsp;consumed&nbsp;all&nbsp;the&nbsp;data&nbsp;or&nbsp;the&nbsp;read&nbsp;end&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="comment" id="1772012">//&nbsp;If&nbsp;the&nbsp;read&nbsp;end&nbsp;is&nbsp;closed&nbsp;with&nbsp;an&nbsp;error,&nbsp;that&nbsp;err&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1772068">//&nbsp;returned&nbsp;as&nbsp;err;&nbsp;otherwise&nbsp;err&nbsp;is&nbsp;ErrClosedPipe.</span><br>
<span class="lineno">160</span><span class="keyword" id="1772120">func</span>&nbsp;<span class="op" id="1772125">(</span><span class="ident" id="1772126">w</span>&nbsp;<span class="op" id="1772128">*</span><span class="ident" id="1772129">PipeWriter</span><span class="op" id="1772139">)</span>&nbsp;<span class="ident" id="1772141">Write</span><span class="op" id="1772146">(</span><span class="ident" id="1772147">data</span>&nbsp;<span class="op" id="1772152">[</span><span class="op" id="1772153">]</span><span class="builtintype" id="1772154">byte</span><span class="op" id="1772158">)</span>&nbsp;<span class="op" id="1772160">(</span><span class="ident" id="1772161">n</span>&nbsp;<span class="builtintype" id="1772163">int</span><span class="op" id="1772166">,</span>&nbsp;<span class="ident" id="1772168">err</span>&nbsp;<span class="builtintype" id="1772172">error</span><span class="op" id="1772177">)</span>&nbsp;<span class="op" id="1772179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1772182">return</span>&nbsp;<span class="ident" id="1772189">w</span><span class="op" id="1772190">.</span><span class="ident" id="1772191">p</span><span class="op" id="1772192">.</span><span class="ident" id="1772193">write</span><span class="op" id="1772198">(</span><span class="ident" id="1772199">data</span><span class="op" id="1772203">)</span><br>
<span class="lineno"></span><span class="op" id="1772205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1772208">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;writer;&nbsp;subsequent&nbsp;reads&nbsp;from&nbsp;the</span><br>
<span class="lineno">165</span><span class="comment" id="1772262">//&nbsp;read&nbsp;half&nbsp;of&nbsp;the&nbsp;pipe&nbsp;will&nbsp;return&nbsp;no&nbsp;bytes&nbsp;and&nbsp;EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="1772317">func</span>&nbsp;<span class="op" id="1772322">(</span><span class="ident" id="1772323">w</span>&nbsp;<span class="op" id="1772325">*</span><span class="ident" id="1772326">PipeWriter</span><span class="op" id="1772336">)</span>&nbsp;<span class="ident" id="1772338">Close</span><span class="op" id="1772343">(</span><span class="op" id="1772344">)</span>&nbsp;<span class="builtintype" id="1772346">error</span>&nbsp;<span class="op" id="1772352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1772355">return</span>&nbsp;<span class="ident" id="1772362">w</span><span class="op" id="1772363">.</span><span class="ident" id="1772364">CloseWithError</span><span class="op" id="1772378">(</span><span class="ident" id="1772379">nil</span><span class="op" id="1772382">)</span><br>
<span class="lineno"></span><span class="op" id="1772384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="1772387">//&nbsp;CloseWithError&nbsp;closes&nbsp;the&nbsp;writer;&nbsp;subsequent&nbsp;reads&nbsp;from&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1772450">//&nbsp;read&nbsp;half&nbsp;of&nbsp;the&nbsp;pipe&nbsp;will&nbsp;return&nbsp;no&nbsp;bytes&nbsp;and&nbsp;the&nbsp;error&nbsp;err.</span><br>
<span class="lineno"></span><span class="keyword" id="1772515">func</span>&nbsp;<span class="op" id="1772520">(</span><span class="ident" id="1772521">w</span>&nbsp;<span class="op" id="1772523">*</span><span class="ident" id="1772524">PipeWriter</span><span class="op" id="1772534">)</span>&nbsp;<span class="ident" id="1772536">CloseWithError</span><span class="op" id="1772550">(</span><span class="ident" id="1772551">err</span>&nbsp;<span class="builtintype" id="1772555">error</span><span class="op" id="1772560">)</span>&nbsp;<span class="builtintype" id="1772562">error</span>&nbsp;<span class="op" id="1772568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1772571">w</span><span class="op" id="1772572">.</span><span class="ident" id="1772573">p</span><span class="op" id="1772574">.</span><span class="ident" id="1772575">wclose</span><span class="op" id="1772581">(</span><span class="ident" id="1772582">err</span><span class="op" id="1772585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1772588">return</span>&nbsp;<span class="ident" id="1772595">nil</span><br>
<span class="lineno">175</span><span class="op" id="1772599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1772602">//&nbsp;Pipe&nbsp;creates&nbsp;a&nbsp;synchronous&nbsp;in-memory&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="comment" id="1772648">//&nbsp;It&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;connect&nbsp;code&nbsp;expecting&nbsp;an&nbsp;io.Reader</span><br>
<span class="lineno"></span><span class="comment" id="1772705">//&nbsp;with&nbsp;code&nbsp;expecting&nbsp;an&nbsp;io.Writer.</span><br>
<span class="lineno">180</span><span class="comment" id="1772742">//&nbsp;Reads&nbsp;on&nbsp;one&nbsp;end&nbsp;are&nbsp;matched&nbsp;with&nbsp;writes&nbsp;on&nbsp;the&nbsp;other,</span><br>
<span class="lineno"></span><span class="comment" id="1772800">//&nbsp;copying&nbsp;data&nbsp;directly&nbsp;between&nbsp;the&nbsp;two;&nbsp;there&nbsp;is&nbsp;no&nbsp;internal&nbsp;buffering.</span><br>
<span class="lineno"></span><span class="comment" id="1772874">//&nbsp;It&nbsp;is&nbsp;safe&nbsp;to&nbsp;call&nbsp;Read&nbsp;and&nbsp;Write&nbsp;in&nbsp;parallel&nbsp;with&nbsp;each&nbsp;other&nbsp;or&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="1772947">//&nbsp;Close.&nbsp;Close&nbsp;will&nbsp;complete&nbsp;once&nbsp;pending&nbsp;I/O&nbsp;is&nbsp;done.&nbsp;Parallel&nbsp;calls&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1773021">//&nbsp;Read,&nbsp;and&nbsp;parallel&nbsp;calls&nbsp;to&nbsp;Write,&nbsp;are&nbsp;also&nbsp;safe:</span><br>
<span class="lineno">185</span><span class="comment" id="1773074">//&nbsp;the&nbsp;individual&nbsp;calls&nbsp;will&nbsp;be&nbsp;gated&nbsp;sequentially.</span><br>
<span class="lineno"></span><span class="keyword" id="1773126">func</span>&nbsp;<span class="ident" id="1773131">Pipe</span><span class="op" id="1773135">(</span><span class="op" id="1773136">)</span>&nbsp;<span class="op" id="1773138">(</span><span class="op" id="1773139">*</span><span class="ident" id="1773140">PipeReader</span><span class="op" id="1773150">,</span>&nbsp;<span class="op" id="1773152">*</span><span class="ident" id="1773153">PipeWriter</span><span class="op" id="1773163">)</span>&nbsp;<span class="op" id="1773165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1773168">p</span>&nbsp;<span class="op" id="1773170">:=</span>&nbsp;<span class="builtinfunc" id="1773173">new</span><span class="op" id="1773176">(</span><span class="ident" id="1773177">pipe</span><span class="op" id="1773181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1773184">p</span><span class="op" id="1773185">.</span><span class="ident" id="1773186">rwait</span><span class="op" id="1773191">.</span><span class="ident" id="1773192">L</span>&nbsp;<span class="op" id="1773194">=</span>&nbsp;<span class="op" id="1773196">&amp;</span><span class="ident" id="1773197">p</span><span class="op" id="1773198">.</span><span class="ident" id="1773199">l</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1773202">p</span><span class="op" id="1773203">.</span><span class="ident" id="1773204">wwait</span><span class="op" id="1773209">.</span><span class="ident" id="1773210">L</span>&nbsp;<span class="op" id="1773212">=</span>&nbsp;<span class="op" id="1773214">&amp;</span><span class="ident" id="1773215">p</span><span class="op" id="1773216">.</span><span class="ident" id="1773217">l</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1773220">r</span>&nbsp;<span class="op" id="1773222">:=</span>&nbsp;<span class="op" id="1773225">&amp;</span><span class="ident" id="1773226">PipeReader</span><span class="op" id="1773236">{</span><span class="ident" id="1773237">p</span><span class="op" id="1773238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1773241">w</span>&nbsp;<span class="op" id="1773243">:=</span>&nbsp;<span class="op" id="1773246">&amp;</span><span class="ident" id="1773247">PipeWriter</span><span class="op" id="1773257">{</span><span class="ident" id="1773258">p</span><span class="op" id="1773259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1773262">return</span>&nbsp;<span class="ident" id="1773269">r</span><span class="op" id="1773270">,</span>&nbsp;<span class="ident" id="1773272">w</span><br>
<span class="lineno"></span><span class="op" id="1773274">}</span>
</div>
</body>
</html>
