<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3294112">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3294167">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3294221">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3294272">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3294337">package</span>&nbsp;<span class="ident" id="3294345">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3294350">import</span>&nbsp;<span class="op" id="3294357">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3294360">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3294366">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="3294376">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3294379">func</span>&nbsp;<span class="ident" id="3294384">newFileFD</span><span class="op" id="3294393">(</span><span class="ident" id="3294394">f</span>&nbsp;<span class="op" id="3294396">*</span><span class="ident" id="3294397">os</span><span class="op" id="3294399">.</span><span class="ident" id="3294400">File</span><span class="op" id="3294404">)</span>&nbsp;<span class="op" id="3294406">(</span><span class="op" id="3294407">*</span><span class="ident" id="3294408">netFD</span><span class="op" id="3294413">,</span>&nbsp;<span class="builtintype" id="3294415">error</span><span class="op" id="3294420">)</span>&nbsp;<span class="op" id="3294422">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3294425">fd</span><span class="op" id="3294427">,</span>&nbsp;<span class="ident" id="3294429">err</span>&nbsp;<span class="op" id="3294433">:=</span>&nbsp;<span class="ident" id="3294436">dupCloseOnExec</span><span class="op" id="3294450">(</span><span class="builtintype" id="3294451">int</span><span class="op" id="3294454">(</span><span class="ident" id="3294455">f</span><span class="op" id="3294456">.</span><span class="ident" id="3294457">Fd</span><span class="op" id="3294459">(</span><span class="op" id="3294460">)</span><span class="op" id="3294461">)</span><span class="op" id="3294462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3294465">if</span>&nbsp;<span class="ident" id="3294468">err</span>&nbsp;<span class="op" id="3294472">!=</span>&nbsp;<span class="ident" id="3294475">nil</span>&nbsp;<span class="op" id="3294479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3294483">return</span>&nbsp;<span class="ident" id="3294490">nil</span><span class="op" id="3294493">,</span>&nbsp;<span class="ident" id="3294495">os</span><span class="op" id="3294497">.</span><span class="ident" id="3294498">NewSyscallError</span><span class="op" id="3294513">(</span><span class="string" id="3294514">&#34;dup&#34;</span><span class="op" id="3294519">,</span>&nbsp;<span class="ident" id="3294521">err</span><span class="op" id="3294524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3294527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3294531">if</span>&nbsp;<span class="ident" id="3294534">err</span>&nbsp;<span class="op" id="3294538">=</span>&nbsp;<span class="ident" id="3294540">syscall</span><span class="op" id="3294547">.</span><span class="ident" id="3294548">SetNonblock</span><span class="op" id="3294559">(</span><span class="ident" id="3294560">fd</span><span class="op" id="3294562">,</span>&nbsp;<span class="builtintype" id="3294564">true</span><span class="op" id="3294568">)</span><span class="op" id="3294569">;</span>&nbsp;<span class="ident" id="3294571">err</span>&nbsp;<span class="op" id="3294575">!=</span>&nbsp;<span class="ident" id="3294578">nil</span>&nbsp;<span class="op" id="3294582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3294586">closesocket</span><span class="op" id="3294597">(</span><span class="ident" id="3294598">fd</span><span class="op" id="3294600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3294604">return</span>&nbsp;<span class="ident" id="3294611">nil</span><span class="op" id="3294614">,</span>&nbsp;<span class="ident" id="3294616">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3294621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3294625">sotype</span><span class="op" id="3294631">,</span>&nbsp;<span class="ident" id="3294633">err</span>&nbsp;<span class="op" id="3294637">:=</span>&nbsp;<span class="ident" id="3294640">syscall</span><span class="op" id="3294647">.</span><span class="ident" id="3294648">GetsockoptInt</span><span class="op" id="3294661">(</span><span class="ident" id="3294662">fd</span><span class="op" id="3294664">,</span>&nbsp;<span class="ident" id="3294666">syscall</span><span class="op" id="3294673">.</span><span class="ident" id="3294674">SOL_SOCKET</span><span class="op" id="3294684">,</span>&nbsp;<span class="ident" id="3294686">syscall</span><span class="op" id="3294693">.</span><span class="ident" id="3294694">SO_TYPE</span><span class="op" id="3294701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3294704">if</span>&nbsp;<span class="ident" id="3294707">err</span>&nbsp;<span class="op" id="3294711">!=</span>&nbsp;<span class="ident" id="3294714">nil</span>&nbsp;<span class="op" id="3294718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3294722">closesocket</span><span class="op" id="3294733">(</span><span class="ident" id="3294734">fd</span><span class="op" id="3294736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3294740">return</span>&nbsp;<span class="ident" id="3294747">nil</span><span class="op" id="3294750">,</span>&nbsp;<span class="ident" id="3294752">os</span><span class="op" id="3294754">.</span><span class="ident" id="3294755">NewSyscallError</span><span class="op" id="3294770">(</span><span class="string" id="3294771">&#34;getsockopt&#34;</span><span class="op" id="3294783">,</span>&nbsp;<span class="ident" id="3294785">err</span><span class="op" id="3294788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3294791">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3294795">family</span>&nbsp;<span class="op" id="3294802">:=</span>&nbsp;<span class="ident" id="3294805">syscall</span><span class="op" id="3294812">.</span><span class="ident" id="3294813">AF_UNSPEC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3294824">toAddr</span>&nbsp;<span class="op" id="3294831">:=</span>&nbsp;<span class="ident" id="3294834">sockaddrToTCP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3294849">lsa</span><span class="op" id="3294852">,</span>&nbsp;<span class="ident" id="3294854">_</span>&nbsp;<span class="op" id="3294856">:=</span>&nbsp;<span class="ident" id="3294859">syscall</span><span class="op" id="3294866">.</span><span class="ident" id="3294867">Getsockname</span><span class="op" id="3294878">(</span><span class="ident" id="3294879">fd</span><span class="op" id="3294881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3294884">switch</span>&nbsp;<span class="ident" id="3294891">lsa</span><span class="op" id="3294894">.</span><span class="op" id="3294895">(</span><span class="keyword" id="3294896">type</span><span class="op" id="3294900">)</span>&nbsp;<span class="op" id="3294902">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3294905">default</span><span class="op" id="3294912">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3294916">closesocket</span><span class="op" id="3294927">(</span><span class="ident" id="3294928">fd</span><span class="op" id="3294930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3294934">return</span>&nbsp;<span class="ident" id="3294941">nil</span><span class="op" id="3294944">,</span>&nbsp;<span class="ident" id="3294946">syscall</span><span class="op" id="3294953">.</span><span class="ident" id="3294954">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3294962">case</span>&nbsp;<span class="op" id="3294967">*</span><span class="ident" id="3294968">syscall</span><span class="op" id="3294975">.</span><span class="ident" id="3294976">SockaddrInet4</span><span class="op" id="3294989">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3294993">family</span>&nbsp;<span class="op" id="3295000">=</span>&nbsp;<span class="ident" id="3295002">syscall</span><span class="op" id="3295009">.</span><span class="ident" id="3295010">AF_INET</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3295020">if</span>&nbsp;<span class="ident" id="3295023">sotype</span>&nbsp;<span class="op" id="3295030">==</span>&nbsp;<span class="ident" id="3295033">syscall</span><span class="op" id="3295040">.</span><span class="ident" id="3295041">SOCK_DGRAM</span>&nbsp;<span class="op" id="3295052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3295057">toAddr</span>&nbsp;<span class="op" id="3295064">=</span>&nbsp;<span class="ident" id="3295066">sockaddrToUDP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3295082">}</span>&nbsp;<span class="keyword" id="3295084">else</span>&nbsp;<span class="keyword" id="3295089">if</span>&nbsp;<span class="ident" id="3295092">sotype</span>&nbsp;<span class="op" id="3295099">==</span>&nbsp;<span class="ident" id="3295102">syscall</span><span class="op" id="3295109">.</span><span class="ident" id="3295110">SOCK_RAW</span>&nbsp;<span class="op" id="3295119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3295124">toAddr</span>&nbsp;<span class="op" id="3295131">=</span>&nbsp;<span class="ident" id="3295133">sockaddrToIP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3295148">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3295151">case</span>&nbsp;<span class="op" id="3295156">*</span><span class="ident" id="3295157">syscall</span><span class="op" id="3295164">.</span><span class="ident" id="3295165">SockaddrInet6</span><span class="op" id="3295178">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3295182">family</span>&nbsp;<span class="op" id="3295189">=</span>&nbsp;<span class="ident" id="3295191">syscall</span><span class="op" id="3295198">.</span><span class="ident" id="3295199">AF_INET6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3295210">if</span>&nbsp;<span class="ident" id="3295213">sotype</span>&nbsp;<span class="op" id="3295220">==</span>&nbsp;<span class="ident" id="3295223">syscall</span><span class="op" id="3295230">.</span><span class="ident" id="3295231">SOCK_DGRAM</span>&nbsp;<span class="op" id="3295242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3295247">toAddr</span>&nbsp;<span class="op" id="3295254">=</span>&nbsp;<span class="ident" id="3295256">sockaddrToUDP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3295272">}</span>&nbsp;<span class="keyword" id="3295274">else</span>&nbsp;<span class="keyword" id="3295279">if</span>&nbsp;<span class="ident" id="3295282">sotype</span>&nbsp;<span class="op" id="3295289">==</span>&nbsp;<span class="ident" id="3295292">syscall</span><span class="op" id="3295299">.</span><span class="ident" id="3295300">SOCK_RAW</span>&nbsp;<span class="op" id="3295309">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3295314">toAddr</span>&nbsp;<span class="op" id="3295321">=</span>&nbsp;<span class="ident" id="3295323">sockaddrToIP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3295338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3295341">case</span>&nbsp;<span class="op" id="3295346">*</span><span class="ident" id="3295347">syscall</span><span class="op" id="3295354">.</span><span class="ident" id="3295355">SockaddrUnix</span><span class="op" id="3295367">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3295371">family</span>&nbsp;<span class="op" id="3295378">=</span>&nbsp;<span class="ident" id="3295380">syscall</span><span class="op" id="3295387">.</span><span class="ident" id="3295388">AF_UNIX</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3295398">toAddr</span>&nbsp;<span class="op" id="3295405">=</span>&nbsp;<span class="ident" id="3295407">sockaddrToUnix</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3295424">if</span>&nbsp;<span class="ident" id="3295427">sotype</span>&nbsp;<span class="op" id="3295434">==</span>&nbsp;<span class="ident" id="3295437">syscall</span><span class="op" id="3295444">.</span><span class="ident" id="3295445">SOCK_DGRAM</span>&nbsp;<span class="op" id="3295456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3295461">toAddr</span>&nbsp;<span class="op" id="3295468">=</span>&nbsp;<span class="ident" id="3295470">sockaddrToUnixgram</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3295491">}</span>&nbsp;<span class="keyword" id="3295493">else</span>&nbsp;<span class="keyword" id="3295498">if</span>&nbsp;<span class="ident" id="3295501">sotype</span>&nbsp;<span class="op" id="3295508">==</span>&nbsp;<span class="ident" id="3295511">syscall</span><span class="op" id="3295518">.</span><span class="ident" id="3295519">SOCK_SEQPACKET</span>&nbsp;<span class="op" id="3295534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3295539">toAddr</span>&nbsp;<span class="op" id="3295546">=</span>&nbsp;<span class="ident" id="3295548">sockaddrToUnixpacket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3295571">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3295574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3295577">laddr</span>&nbsp;<span class="op" id="3295583">:=</span>&nbsp;<span class="ident" id="3295586">toAddr</span><span class="op" id="3295592">(</span><span class="ident" id="3295593">lsa</span><span class="op" id="3295596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3295599">rsa</span><span class="op" id="3295602">,</span>&nbsp;<span class="ident" id="3295604">_</span>&nbsp;<span class="op" id="3295606">:=</span>&nbsp;<span class="ident" id="3295609">syscall</span><span class="op" id="3295616">.</span><span class="ident" id="3295617">Getpeername</span><span class="op" id="3295628">(</span><span class="ident" id="3295629">fd</span><span class="op" id="3295631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3295634">raddr</span>&nbsp;<span class="op" id="3295640">:=</span>&nbsp;<span class="ident" id="3295643">toAddr</span><span class="op" id="3295649">(</span><span class="ident" id="3295650">rsa</span><span class="op" id="3295653">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3295657">netfd</span><span class="op" id="3295662">,</span>&nbsp;<span class="ident" id="3295664">err</span>&nbsp;<span class="op" id="3295668">:=</span>&nbsp;<span class="ident" id="3295671">newFD</span><span class="op" id="3295676">(</span><span class="ident" id="3295677">fd</span><span class="op" id="3295679">,</span>&nbsp;<span class="ident" id="3295681">family</span><span class="op" id="3295687">,</span>&nbsp;<span class="ident" id="3295689">sotype</span><span class="op" id="3295695">,</span>&nbsp;<span class="ident" id="3295697">laddr</span><span class="op" id="3295702">.</span><span class="ident" id="3295703">Network</span><span class="op" id="3295710">(</span><span class="op" id="3295711">)</span><span class="op" id="3295712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3295715">if</span>&nbsp;<span class="ident" id="3295718">err</span>&nbsp;<span class="op" id="3295722">!=</span>&nbsp;<span class="ident" id="3295725">nil</span>&nbsp;<span class="op" id="3295729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3295733">closesocket</span><span class="op" id="3295744">(</span><span class="ident" id="3295745">fd</span><span class="op" id="3295747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3295751">return</span>&nbsp;<span class="ident" id="3295758">nil</span><span class="op" id="3295761">,</span>&nbsp;<span class="ident" id="3295763">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3295768">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3295771">if</span>&nbsp;<span class="ident" id="3295774">err</span>&nbsp;<span class="op" id="3295778">:=</span>&nbsp;<span class="ident" id="3295781">netfd</span><span class="op" id="3295786">.</span><span class="ident" id="3295787">init</span><span class="op" id="3295791">(</span><span class="op" id="3295792">)</span><span class="op" id="3295793">;</span>&nbsp;<span class="ident" id="3295795">err</span>&nbsp;<span class="op" id="3295799">!=</span>&nbsp;<span class="ident" id="3295802">nil</span>&nbsp;<span class="op" id="3295806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3295810">netfd</span><span class="op" id="3295815">.</span><span class="ident" id="3295816">Close</span><span class="op" id="3295821">(</span><span class="op" id="3295822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3295826">return</span>&nbsp;<span class="ident" id="3295833">nil</span><span class="op" id="3295836">,</span>&nbsp;<span class="ident" id="3295838">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3295843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3295846">netfd</span><span class="op" id="3295851">.</span><span class="ident" id="3295852">setAddr</span><span class="op" id="3295859">(</span><span class="ident" id="3295860">laddr</span><span class="op" id="3295865">,</span>&nbsp;<span class="ident" id="3295867">raddr</span><span class="op" id="3295872">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3295875">return</span>&nbsp;<span class="ident" id="3295882">netfd</span><span class="op" id="3295887">,</span>&nbsp;<span class="ident" id="3295889">nil</span><br>
<span class="lineno"></span><span class="op" id="3295893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3295896">//&nbsp;FileConn&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;network&nbsp;connection&nbsp;corresponding&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3295966">//&nbsp;the&nbsp;open&nbsp;file&nbsp;f.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;close&nbsp;f&nbsp;when</span><br>
<span class="lineno">80</span><span class="comment" id="3296037">//&nbsp;finished.&nbsp;&nbsp;Closing&nbsp;c&nbsp;does&nbsp;not&nbsp;affect&nbsp;f,&nbsp;and&nbsp;closing&nbsp;f&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3296103">//&nbsp;affect&nbsp;c.</span><br>
<span class="lineno"></span><span class="keyword" id="3296116">func</span>&nbsp;<span class="ident" id="3296121">FileConn</span><span class="op" id="3296129">(</span><span class="ident" id="3296130">f</span>&nbsp;<span class="op" id="3296132">*</span><span class="ident" id="3296133">os</span><span class="op" id="3296135">.</span><span class="ident" id="3296136">File</span><span class="op" id="3296140">)</span>&nbsp;<span class="op" id="3296142">(</span><span class="ident" id="3296143">c</span>&nbsp;<span class="ident" id="3296145">Conn</span><span class="op" id="3296149">,</span>&nbsp;<span class="ident" id="3296151">err</span>&nbsp;<span class="builtintype" id="3296155">error</span><span class="op" id="3296160">)</span>&nbsp;<span class="op" id="3296162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3296165">fd</span><span class="op" id="3296167">,</span>&nbsp;<span class="ident" id="3296169">err</span>&nbsp;<span class="op" id="3296173">:=</span>&nbsp;<span class="ident" id="3296176">newFileFD</span><span class="op" id="3296185">(</span><span class="ident" id="3296186">f</span><span class="op" id="3296187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3296190">if</span>&nbsp;<span class="ident" id="3296193">err</span>&nbsp;<span class="op" id="3296197">!=</span>&nbsp;<span class="ident" id="3296200">nil</span>&nbsp;<span class="op" id="3296204">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3296208">return</span>&nbsp;<span class="ident" id="3296215">nil</span><span class="op" id="3296218">,</span>&nbsp;<span class="ident" id="3296220">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3296225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3296228">switch</span>&nbsp;<span class="ident" id="3296235">fd</span><span class="op" id="3296237">.</span><span class="ident" id="3296238">laddr</span><span class="op" id="3296243">.</span><span class="op" id="3296244">(</span><span class="keyword" id="3296245">type</span><span class="op" id="3296249">)</span>&nbsp;<span class="op" id="3296251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3296254">case</span>&nbsp;<span class="op" id="3296259">*</span><span class="ident" id="3296260">TCPAddr</span><span class="op" id="3296267">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3296271">return</span>&nbsp;<span class="ident" id="3296278">newTCPConn</span><span class="op" id="3296288">(</span><span class="ident" id="3296289">fd</span><span class="op" id="3296291">)</span><span class="op" id="3296292">,</span>&nbsp;<span class="ident" id="3296294">nil</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3296299">case</span>&nbsp;<span class="op" id="3296304">*</span><span class="ident" id="3296305">UDPAddr</span><span class="op" id="3296312">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3296316">return</span>&nbsp;<span class="ident" id="3296323">newUDPConn</span><span class="op" id="3296333">(</span><span class="ident" id="3296334">fd</span><span class="op" id="3296336">)</span><span class="op" id="3296337">,</span>&nbsp;<span class="ident" id="3296339">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3296344">case</span>&nbsp;<span class="op" id="3296349">*</span><span class="ident" id="3296350">IPAddr</span><span class="op" id="3296356">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3296360">return</span>&nbsp;<span class="ident" id="3296367">newIPConn</span><span class="op" id="3296376">(</span><span class="ident" id="3296377">fd</span><span class="op" id="3296379">)</span><span class="op" id="3296380">,</span>&nbsp;<span class="ident" id="3296382">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3296387">case</span>&nbsp;<span class="op" id="3296392">*</span><span class="ident" id="3296393">UnixAddr</span><span class="op" id="3296401">:</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3296405">return</span>&nbsp;<span class="ident" id="3296412">newUnixConn</span><span class="op" id="3296423">(</span><span class="ident" id="3296424">fd</span><span class="op" id="3296426">)</span><span class="op" id="3296427">,</span>&nbsp;<span class="ident" id="3296429">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3296434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3296437">fd</span><span class="op" id="3296439">.</span><span class="ident" id="3296440">Close</span><span class="op" id="3296445">(</span><span class="op" id="3296446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3296449">return</span>&nbsp;<span class="ident" id="3296456">nil</span><span class="op" id="3296459">,</span>&nbsp;<span class="ident" id="3296461">syscall</span><span class="op" id="3296468">.</span><span class="ident" id="3296469">EINVAL</span><br>
<span class="lineno"></span><span class="op" id="3296476">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="3296479">//&nbsp;FileListener&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;network&nbsp;listener&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="3296548">//&nbsp;to&nbsp;the&nbsp;open&nbsp;file&nbsp;f.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;close&nbsp;l</span><br>
<span class="lineno"></span><span class="comment" id="3296617">//&nbsp;when&nbsp;finished.&nbsp;&nbsp;Closing&nbsp;l&nbsp;does&nbsp;not&nbsp;affect&nbsp;f,&nbsp;and&nbsp;closing&nbsp;f&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3296688">//&nbsp;affect&nbsp;l.</span><br>
<span class="lineno">105</span><span class="keyword" id="3296701">func</span>&nbsp;<span class="ident" id="3296706">FileListener</span><span class="op" id="3296718">(</span><span class="ident" id="3296719">f</span>&nbsp;<span class="op" id="3296721">*</span><span class="ident" id="3296722">os</span><span class="op" id="3296724">.</span><span class="ident" id="3296725">File</span><span class="op" id="3296729">)</span>&nbsp;<span class="op" id="3296731">(</span><span class="ident" id="3296732">l</span>&nbsp;<span class="ident" id="3296734">Listener</span><span class="op" id="3296742">,</span>&nbsp;<span class="ident" id="3296744">err</span>&nbsp;<span class="builtintype" id="3296748">error</span><span class="op" id="3296753">)</span>&nbsp;<span class="op" id="3296755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3296758">fd</span><span class="op" id="3296760">,</span>&nbsp;<span class="ident" id="3296762">err</span>&nbsp;<span class="op" id="3296766">:=</span>&nbsp;<span class="ident" id="3296769">newFileFD</span><span class="op" id="3296778">(</span><span class="ident" id="3296779">f</span><span class="op" id="3296780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3296783">if</span>&nbsp;<span class="ident" id="3296786">err</span>&nbsp;<span class="op" id="3296790">!=</span>&nbsp;<span class="ident" id="3296793">nil</span>&nbsp;<span class="op" id="3296797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3296801">return</span>&nbsp;<span class="ident" id="3296808">nil</span><span class="op" id="3296811">,</span>&nbsp;<span class="ident" id="3296813">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3296818">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3296821">switch</span>&nbsp;<span class="ident" id="3296828">laddr</span>&nbsp;<span class="op" id="3296834">:=</span>&nbsp;<span class="ident" id="3296837">fd</span><span class="op" id="3296839">.</span><span class="ident" id="3296840">laddr</span><span class="op" id="3296845">.</span><span class="op" id="3296846">(</span><span class="keyword" id="3296847">type</span><span class="op" id="3296851">)</span>&nbsp;<span class="op" id="3296853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3296856">case</span>&nbsp;<span class="op" id="3296861">*</span><span class="ident" id="3296862">TCPAddr</span><span class="op" id="3296869">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3296873">return</span>&nbsp;<span class="op" id="3296880">&amp;</span><span class="ident" id="3296881">TCPListener</span><span class="op" id="3296892">{</span><span class="ident" id="3296893">fd</span><span class="op" id="3296895">}</span><span class="op" id="3296896">,</span>&nbsp;<span class="ident" id="3296898">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3296903">case</span>&nbsp;<span class="op" id="3296908">*</span><span class="ident" id="3296909">UnixAddr</span><span class="op" id="3296917">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3296921">return</span>&nbsp;<span class="op" id="3296928">&amp;</span><span class="ident" id="3296929">UnixListener</span><span class="op" id="3296941">{</span><span class="ident" id="3296942">fd</span><span class="op" id="3296944">,</span>&nbsp;<span class="ident" id="3296946">laddr</span><span class="op" id="3296951">.</span><span class="ident" id="3296952">Name</span><span class="op" id="3296956">}</span><span class="op" id="3296957">,</span>&nbsp;<span class="ident" id="3296959">nil</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3296964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3296967">fd</span><span class="op" id="3296969">.</span><span class="ident" id="3296970">Close</span><span class="op" id="3296975">(</span><span class="op" id="3296976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3296979">return</span>&nbsp;<span class="ident" id="3296986">nil</span><span class="op" id="3296989">,</span>&nbsp;<span class="ident" id="3296991">syscall</span><span class="op" id="3296998">.</span><span class="ident" id="3296999">EINVAL</span><br>
<span class="lineno"></span><span class="op" id="3297006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="comment" id="3297009">//&nbsp;FilePacketConn&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;packet&nbsp;network&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="3297075">//&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;open&nbsp;file&nbsp;f.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3297132">//&nbsp;responsibility&nbsp;to&nbsp;close&nbsp;f&nbsp;when&nbsp;finished.&nbsp;&nbsp;Closing&nbsp;c&nbsp;does&nbsp;not&nbsp;affect</span><br>
<span class="lineno"></span><span class="comment" id="3297203">//&nbsp;f,&nbsp;and&nbsp;closing&nbsp;f&nbsp;does&nbsp;not&nbsp;affect&nbsp;c.</span><br>
<span class="lineno"></span><span class="keyword" id="3297242">func</span>&nbsp;<span class="ident" id="3297247">FilePacketConn</span><span class="op" id="3297261">(</span><span class="ident" id="3297262">f</span>&nbsp;<span class="op" id="3297264">*</span><span class="ident" id="3297265">os</span><span class="op" id="3297267">.</span><span class="ident" id="3297268">File</span><span class="op" id="3297272">)</span>&nbsp;<span class="op" id="3297274">(</span><span class="ident" id="3297275">c</span>&nbsp;<span class="ident" id="3297277">PacketConn</span><span class="op" id="3297287">,</span>&nbsp;<span class="ident" id="3297289">err</span>&nbsp;<span class="builtintype" id="3297293">error</span><span class="op" id="3297298">)</span>&nbsp;<span class="op" id="3297300">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3297303">fd</span><span class="op" id="3297305">,</span>&nbsp;<span class="ident" id="3297307">err</span>&nbsp;<span class="op" id="3297311">:=</span>&nbsp;<span class="ident" id="3297314">newFileFD</span><span class="op" id="3297323">(</span><span class="ident" id="3297324">f</span><span class="op" id="3297325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3297328">if</span>&nbsp;<span class="ident" id="3297331">err</span>&nbsp;<span class="op" id="3297335">!=</span>&nbsp;<span class="ident" id="3297338">nil</span>&nbsp;<span class="op" id="3297342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3297346">return</span>&nbsp;<span class="ident" id="3297353">nil</span><span class="op" id="3297356">,</span>&nbsp;<span class="ident" id="3297358">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3297363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3297366">switch</span>&nbsp;<span class="ident" id="3297373">fd</span><span class="op" id="3297375">.</span><span class="ident" id="3297376">laddr</span><span class="op" id="3297381">.</span><span class="op" id="3297382">(</span><span class="keyword" id="3297383">type</span><span class="op" id="3297387">)</span>&nbsp;<span class="op" id="3297389">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3297392">case</span>&nbsp;<span class="op" id="3297397">*</span><span class="ident" id="3297398">UDPAddr</span><span class="op" id="3297405">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3297409">return</span>&nbsp;<span class="ident" id="3297416">newUDPConn</span><span class="op" id="3297426">(</span><span class="ident" id="3297427">fd</span><span class="op" id="3297429">)</span><span class="op" id="3297430">,</span>&nbsp;<span class="ident" id="3297432">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3297437">case</span>&nbsp;<span class="op" id="3297442">*</span><span class="ident" id="3297443">IPAddr</span><span class="op" id="3297449">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3297453">return</span>&nbsp;<span class="ident" id="3297460">newIPConn</span><span class="op" id="3297469">(</span><span class="ident" id="3297470">fd</span><span class="op" id="3297472">)</span><span class="op" id="3297473">,</span>&nbsp;<span class="ident" id="3297475">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3297480">case</span>&nbsp;<span class="op" id="3297485">*</span><span class="ident" id="3297486">UnixAddr</span><span class="op" id="3297494">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3297498">return</span>&nbsp;<span class="ident" id="3297505">newUnixConn</span><span class="op" id="3297516">(</span><span class="ident" id="3297517">fd</span><span class="op" id="3297519">)</span><span class="op" id="3297520">,</span>&nbsp;<span class="ident" id="3297522">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3297527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3297530">fd</span><span class="op" id="3297532">.</span><span class="ident" id="3297533">Close</span><span class="op" id="3297538">(</span><span class="op" id="3297539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3297542">return</span>&nbsp;<span class="ident" id="3297549">nil</span><span class="op" id="3297552">,</span>&nbsp;<span class="ident" id="3297554">syscall</span><span class="op" id="3297561">.</span><span class="ident" id="3297562">EINVAL</span><br>
<span class="lineno"></span><span class="op" id="3297569">}</span>
</div>
</body>
</html>
