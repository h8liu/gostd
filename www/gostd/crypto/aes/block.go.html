<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/aes</h2>
<ul>
<li><a href="/gostd/crypto/aes/aes_test.go.html">aes_test.go</a></li>
<li><a href="/gostd/crypto/aes/block.go.html">block.go</a></li>
<li><a href="/gostd/crypto/aes/cipher.go.html">cipher.go</a></li>
<li><a href="/gostd/crypto/aes/cipher_asm.go.html">cipher_asm.go</a></li>
<li><a href="/gostd/crypto/aes/const.go.html">const.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3880420">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3880475">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3880529">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3880580">//&nbsp;This&nbsp;Go&nbsp;implementation&nbsp;is&nbsp;derived&nbsp;in&nbsp;part&nbsp;from&nbsp;the&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="3880644">//&nbsp;ANSI&nbsp;C&nbsp;implementation,&nbsp;which&nbsp;carries&nbsp;the&nbsp;following&nbsp;notice:</span><br>
<span class="lineno"></span><span class="comment" id="3880706">//</span><br>
<span class="lineno"></span><span class="comment" id="3880709">//&nbsp;&nbsp;&nbsp;&nbsprijndael-alg-fst.c</span><br>
<span class="lineno"></span><span class="comment" id="3880731">//</span><br>
<span class="lineno">10</span><span class="comment" id="3880734">//&nbsp;&nbsp;&nbsp;&nbsp@version&nbsp;3.0&nbsp;(December&nbsp;2000)</span><br>
<span class="lineno"></span><span class="comment" id="3880766">//</span><br>
<span class="lineno"></span><span class="comment" id="3880769">//&nbsp;&nbsp;&nbsp;&nbspOptimised&nbsp;ANSI&nbsp;C&nbsp;code&nbsp;for&nbsp;the&nbsp;Rijndael&nbsp;cipher&nbsp;(now&nbsp;AES)</span><br>
<span class="lineno"></span><span class="comment" id="3880828">//</span><br>
<span class="lineno"></span><span class="comment" id="3880831">//&nbsp;&nbsp;&nbsp;&nbsp@author&nbsp;Vincent&nbsp;Rijmen&nbsp;&lt;vincent.rijmen@esat.kuleuven.ac.be&gt;</span><br>
<span class="lineno">15</span><span class="comment" id="3880894">//&nbsp;&nbsp;&nbsp;&nbsp@author&nbsp;Antoon&nbsp;Bosselaers&nbsp;&lt;antoon.bosselaers@esat.kuleuven.ac.be&gt;</span><br>
<span class="lineno"></span><span class="comment" id="3880963">//&nbsp;&nbsp;&nbsp;&nbsp@author&nbsp;Paulo&nbsp;Barreto&nbsp;&lt;paulo.barreto@terra.com.br&gt;</span><br>
<span class="lineno"></span><span class="comment" id="3881017">//</span><br>
<span class="lineno"></span><span class="comment" id="3881020">//&nbsp;&nbsp;&nbsp;&nbspThis&nbsp;code&nbsp;is&nbsp;hereby&nbsp;placed&nbsp;in&nbsp;the&nbsp;public&nbsp;domain.</span><br>
<span class="lineno"></span><span class="comment" id="3881072">//</span><br>
<span class="lineno">20</span><span class="comment" id="3881075">//&nbsp;&nbsp;&nbsp;&nbspTHIS&nbsp;SOFTWARE&nbsp;IS&nbsp;PROVIDED&nbsp;BY&nbsp;THE&nbsp;AUTHORS&nbsp;&#39;&#39;AS&nbsp;IS&#39;&#39;&nbsp;AND&nbsp;ANY&nbsp;EXPRESS</span><br>
<span class="lineno"></span><span class="comment" id="3881145">//&nbsp;&nbsp;&nbsp;&nbspOR&nbsp;IMPLIED&nbsp;WARRANTIES,&nbsp;INCLUDING,&nbsp;BUT&nbsp;NOT&nbsp;LIMITED&nbsp;TO,&nbsp;THE&nbsp;IMPLIED</span><br>
<span class="lineno"></span><span class="comment" id="3881214">//&nbsp;&nbsp;&nbsp;&nbspWARRANTIES&nbsp;OF&nbsp;MERCHANTABILITY&nbsp;AND&nbsp;FITNESS&nbsp;FOR&nbsp;A&nbsp;PARTICULAR&nbsp;PURPOSE</span><br>
<span class="lineno"></span><span class="comment" id="3881284">//&nbsp;&nbsp;&nbsp;&nbspARE&nbsp;DISCLAIMED.&nbsp;&nbsp;IN&nbsp;NO&nbsp;EVENT&nbsp;SHALL&nbsp;THE&nbsp;AUTHORS&nbsp;OR&nbsp;CONTRIBUTORS&nbsp;BE</span><br>
<span class="lineno"></span><span class="comment" id="3881353">//&nbsp;&nbsp;&nbsp;&nbspLIABLE&nbsp;FOR&nbsp;ANY&nbsp;DIRECT,&nbsp;INDIRECT,&nbsp;INCIDENTAL,&nbsp;SPECIAL,&nbsp;EXEMPLARY,&nbsp;OR</span><br>
<span class="lineno">25</span><span class="comment" id="3881424">//&nbsp;&nbsp;&nbsp;&nbspCONSEQUENTIAL&nbsp;DAMAGES&nbsp;(INCLUDING,&nbsp;BUT&nbsp;NOT&nbsp;LIMITED&nbsp;TO,&nbsp;PROCUREMENT&nbsp;OF</span><br>
<span class="lineno"></span><span class="comment" id="3881496">//&nbsp;&nbsp;&nbsp;&nbspSUBSTITUTE&nbsp;GOODS&nbsp;OR&nbsp;SERVICES;&nbsp;LOSS&nbsp;OF&nbsp;USE,&nbsp;DATA,&nbsp;OR&nbsp;PROFITS;&nbsp;OR</span><br>
<span class="lineno"></span><span class="comment" id="3881563">//&nbsp;&nbsp;&nbsp;&nbspBUSINESS&nbsp;INTERRUPTION)&nbsp;HOWEVER&nbsp;CAUSED&nbsp;AND&nbsp;ON&nbsp;ANY&nbsp;THEORY&nbsp;OF&nbsp;LIABILITY,</span><br>
<span class="lineno"></span><span class="comment" id="3881636">//&nbsp;&nbsp;&nbsp;&nbspWHETHER&nbsp;IN&nbsp;CONTRACT,&nbsp;STRICT&nbsp;LIABILITY,&nbsp;OR&nbsp;TORT&nbsp;(INCLUDING&nbsp;NEGLIGENCE</span><br>
<span class="lineno"></span><span class="comment" id="3881708">//&nbsp;&nbsp;&nbsp;&nbspOR&nbsp;OTHERWISE)&nbsp;ARISING&nbsp;IN&nbsp;ANY&nbsp;WAY&nbsp;OUT&nbsp;OF&nbsp;THE&nbsp;USE&nbsp;OF&nbsp;THIS&nbsp;SOFTWARE,</span><br>
<span class="lineno">30</span><span class="comment" id="3881777">//&nbsp;&nbsp;&nbsp;&nbspEVEN&nbsp;IF&nbsp;ADVISED&nbsp;OF&nbsp;THE&nbsp;POSSIBILITY&nbsp;OF&nbsp;SUCH&nbsp;DAMAGE.</span><br>
<span class="lineno"></span><span class="comment" id="3881831">//</span><br>
<span class="lineno"></span><span class="comment" id="3881834">//&nbsp;See&nbsp;FIPS&nbsp;197&nbsp;for&nbsp;specification,&nbsp;and&nbsp;see&nbsp;Daemen&nbsp;and&nbsp;Rijmen&#39;s&nbsp;Rijndael&nbsp;submission</span><br>
<span class="lineno"></span><span class="comment" id="3881917">//&nbsp;for&nbsp;implementation&nbsp;details.</span><br>
<span class="lineno"></span><span class="comment" id="3881948">//&nbsp;&nbsp;&nbsp;&nbsphttp://www.csrc.nist.gov/publications/fips/fips197/fips-197.pdf</span><br>
<span class="lineno">35</span><span class="comment" id="3882015">//&nbsp;&nbsp;&nbsp;&nbsphttp://csrc.nist.gov/archive/aes/rijndael/Rijndael-ammended.pdf</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3882083">package</span>&nbsp;<span class="ident" id="3882091">aes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3882096">//&nbsp;Encrypt&nbsp;one&nbsp;block&nbsp;from&nbsp;src&nbsp;into&nbsp;dst,&nbsp;using&nbsp;the&nbsp;expanded&nbsp;key&nbsp;xk.</span><br>
<span class="lineno">40</span><span class="keyword" id="3882163">func</span>&nbsp;<span class="ident" id="3882168">encryptBlockGo</span><span class="op" id="3882182">(</span><span class="ident" id="3882183">xk</span>&nbsp;<span class="op" id="3882186">[</span><span class="op" id="3882187">]</span><span class="builtintype" id="3882188">uint32</span><span class="op" id="3882194">,</span>&nbsp;<span class="ident" id="3882196">dst</span><span class="op" id="3882199">,</span>&nbsp;<span class="ident" id="3882201">src</span>&nbsp;<span class="op" id="3882205">[</span><span class="op" id="3882206">]</span><span class="builtintype" id="3882207">byte</span><span class="op" id="3882211">)</span>&nbsp;<span class="op" id="3882213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3882216">var</span>&nbsp;<span class="ident" id="3882220">s0</span><span class="op" id="3882222">,</span>&nbsp;<span class="ident" id="3882224">s1</span><span class="op" id="3882226">,</span>&nbsp;<span class="ident" id="3882228">s2</span><span class="op" id="3882230">,</span>&nbsp;<span class="ident" id="3882232">s3</span><span class="op" id="3882234">,</span>&nbsp;<span class="ident" id="3882236">t0</span><span class="op" id="3882238">,</span>&nbsp;<span class="ident" id="3882240">t1</span><span class="op" id="3882242">,</span>&nbsp;<span class="ident" id="3882244">t2</span><span class="op" id="3882246">,</span>&nbsp;<span class="ident" id="3882248">t3</span>&nbsp;<span class="builtintype" id="3882251">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3882260">s0</span>&nbsp;<span class="op" id="3882263">=</span>&nbsp;<span class="builtintype" id="3882265">uint32</span><span class="op" id="3882271">(</span><span class="ident" id="3882272">src</span><span class="op" id="3882275">[</span><span class="num" id="3882276">0</span><span class="op" id="3882277">]</span><span class="op" id="3882278">)</span><span class="op" id="3882279">&lt;&lt;</span><span class="num" id="3882281">24</span>&nbsp;<span class="op" id="3882284">|</span>&nbsp;<span class="builtintype" id="3882286">uint32</span><span class="op" id="3882292">(</span><span class="ident" id="3882293">src</span><span class="op" id="3882296">[</span><span class="num" id="3882297">1</span><span class="op" id="3882298">]</span><span class="op" id="3882299">)</span><span class="op" id="3882300">&lt;&lt;</span><span class="num" id="3882302">16</span>&nbsp;<span class="op" id="3882305">|</span>&nbsp;<span class="builtintype" id="3882307">uint32</span><span class="op" id="3882313">(</span><span class="ident" id="3882314">src</span><span class="op" id="3882317">[</span><span class="num" id="3882318">2</span><span class="op" id="3882319">]</span><span class="op" id="3882320">)</span><span class="op" id="3882321">&lt;&lt;</span><span class="num" id="3882323">8</span>&nbsp;<span class="op" id="3882325">|</span>&nbsp;<span class="builtintype" id="3882327">uint32</span><span class="op" id="3882333">(</span><span class="ident" id="3882334">src</span><span class="op" id="3882337">[</span><span class="num" id="3882338">3</span><span class="op" id="3882339">]</span><span class="op" id="3882340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3882343">s1</span>&nbsp;<span class="op" id="3882346">=</span>&nbsp;<span class="builtintype" id="3882348">uint32</span><span class="op" id="3882354">(</span><span class="ident" id="3882355">src</span><span class="op" id="3882358">[</span><span class="num" id="3882359">4</span><span class="op" id="3882360">]</span><span class="op" id="3882361">)</span><span class="op" id="3882362">&lt;&lt;</span><span class="num" id="3882364">24</span>&nbsp;<span class="op" id="3882367">|</span>&nbsp;<span class="builtintype" id="3882369">uint32</span><span class="op" id="3882375">(</span><span class="ident" id="3882376">src</span><span class="op" id="3882379">[</span><span class="num" id="3882380">5</span><span class="op" id="3882381">]</span><span class="op" id="3882382">)</span><span class="op" id="3882383">&lt;&lt;</span><span class="num" id="3882385">16</span>&nbsp;<span class="op" id="3882388">|</span>&nbsp;<span class="builtintype" id="3882390">uint32</span><span class="op" id="3882396">(</span><span class="ident" id="3882397">src</span><span class="op" id="3882400">[</span><span class="num" id="3882401">6</span><span class="op" id="3882402">]</span><span class="op" id="3882403">)</span><span class="op" id="3882404">&lt;&lt;</span><span class="num" id="3882406">8</span>&nbsp;<span class="op" id="3882408">|</span>&nbsp;<span class="builtintype" id="3882410">uint32</span><span class="op" id="3882416">(</span><span class="ident" id="3882417">src</span><span class="op" id="3882420">[</span><span class="num" id="3882421">7</span><span class="op" id="3882422">]</span><span class="op" id="3882423">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3882426">s2</span>&nbsp;<span class="op" id="3882429">=</span>&nbsp;<span class="builtintype" id="3882431">uint32</span><span class="op" id="3882437">(</span><span class="ident" id="3882438">src</span><span class="op" id="3882441">[</span><span class="num" id="3882442">8</span><span class="op" id="3882443">]</span><span class="op" id="3882444">)</span><span class="op" id="3882445">&lt;&lt;</span><span class="num" id="3882447">24</span>&nbsp;<span class="op" id="3882450">|</span>&nbsp;<span class="builtintype" id="3882452">uint32</span><span class="op" id="3882458">(</span><span class="ident" id="3882459">src</span><span class="op" id="3882462">[</span><span class="num" id="3882463">9</span><span class="op" id="3882464">]</span><span class="op" id="3882465">)</span><span class="op" id="3882466">&lt;&lt;</span><span class="num" id="3882468">16</span>&nbsp;<span class="op" id="3882471">|</span>&nbsp;<span class="builtintype" id="3882473">uint32</span><span class="op" id="3882479">(</span><span class="ident" id="3882480">src</span><span class="op" id="3882483">[</span><span class="num" id="3882484">10</span><span class="op" id="3882486">]</span><span class="op" id="3882487">)</span><span class="op" id="3882488">&lt;&lt;</span><span class="num" id="3882490">8</span>&nbsp;<span class="op" id="3882492">|</span>&nbsp;<span class="builtintype" id="3882494">uint32</span><span class="op" id="3882500">(</span><span class="ident" id="3882501">src</span><span class="op" id="3882504">[</span><span class="num" id="3882505">11</span><span class="op" id="3882507">]</span><span class="op" id="3882508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3882511">s3</span>&nbsp;<span class="op" id="3882514">=</span>&nbsp;<span class="builtintype" id="3882516">uint32</span><span class="op" id="3882522">(</span><span class="ident" id="3882523">src</span><span class="op" id="3882526">[</span><span class="num" id="3882527">12</span><span class="op" id="3882529">]</span><span class="op" id="3882530">)</span><span class="op" id="3882531">&lt;&lt;</span><span class="num" id="3882533">24</span>&nbsp;<span class="op" id="3882536">|</span>&nbsp;<span class="builtintype" id="3882538">uint32</span><span class="op" id="3882544">(</span><span class="ident" id="3882545">src</span><span class="op" id="3882548">[</span><span class="num" id="3882549">13</span><span class="op" id="3882551">]</span><span class="op" id="3882552">)</span><span class="op" id="3882553">&lt;&lt;</span><span class="num" id="3882555">16</span>&nbsp;<span class="op" id="3882558">|</span>&nbsp;<span class="builtintype" id="3882560">uint32</span><span class="op" id="3882566">(</span><span class="ident" id="3882567">src</span><span class="op" id="3882570">[</span><span class="num" id="3882571">14</span><span class="op" id="3882573">]</span><span class="op" id="3882574">)</span><span class="op" id="3882575">&lt;&lt;</span><span class="num" id="3882577">8</span>&nbsp;<span class="op" id="3882579">|</span>&nbsp;<span class="builtintype" id="3882581">uint32</span><span class="op" id="3882587">(</span><span class="ident" id="3882588">src</span><span class="op" id="3882591">[</span><span class="num" id="3882592">15</span><span class="op" id="3882594">]</span><span class="op" id="3882595">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3882599">//&nbsp;First&nbsp;round&nbsp;just&nbsp;XORs&nbsp;input&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3882641">s0</span>&nbsp;<span class="op" id="3882644">^=</span>&nbsp;<span class="ident" id="3882647">xk</span><span class="op" id="3882649">[</span><span class="num" id="3882650">0</span><span class="op" id="3882651">]</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3882654">s1</span>&nbsp;<span class="op" id="3882657">^=</span>&nbsp;<span class="ident" id="3882660">xk</span><span class="op" id="3882662">[</span><span class="num" id="3882663">1</span><span class="op" id="3882664">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3882667">s2</span>&nbsp;<span class="op" id="3882670">^=</span>&nbsp;<span class="ident" id="3882673">xk</span><span class="op" id="3882675">[</span><span class="num" id="3882676">2</span><span class="op" id="3882677">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3882680">s3</span>&nbsp;<span class="op" id="3882683">^=</span>&nbsp;<span class="ident" id="3882686">xk</span><span class="op" id="3882688">[</span><span class="num" id="3882689">3</span><span class="op" id="3882690">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3882694">//&nbsp;Middle&nbsp;rounds&nbsp;shuffle&nbsp;using&nbsp;tables.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3882734">//&nbsp;Number&nbsp;of&nbsp;rounds&nbsp;is&nbsp;set&nbsp;by&nbsp;length&nbsp;of&nbsp;expanded&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3882789">nr</span>&nbsp;<span class="op" id="3882792">:=</span>&nbsp;<span class="builtinfunc" id="3882795">len</span><span class="op" id="3882798">(</span><span class="ident" id="3882799">xk</span><span class="op" id="3882801">)</span><span class="op" id="3882802">/</span><span class="num" id="3882803">4</span>&nbsp;<span class="op" id="3882805">-</span>&nbsp;<span class="num" id="3882807">2</span>&nbsp;<span class="comment" id="3882809">//&nbsp;-&nbsp;2:&nbsp;one&nbsp;above,&nbsp;one&nbsp;more&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3882844">k</span>&nbsp;<span class="op" id="3882846">:=</span>&nbsp;<span class="num" id="3882849">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3882852">for</span>&nbsp;<span class="ident" id="3882856">r</span>&nbsp;<span class="op" id="3882858">:=</span>&nbsp;<span class="num" id="3882861">0</span><span class="op" id="3882862">;</span>&nbsp;<span class="ident" id="3882864">r</span>&nbsp;<span class="op" id="3882866">&lt;</span>&nbsp;<span class="ident" id="3882868">nr</span><span class="op" id="3882870">;</span>&nbsp;<span class="ident" id="3882872">r</span><span class="op" id="3882873">++</span>&nbsp;<span class="op" id="3882876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3882880">t0</span>&nbsp;<span class="op" id="3882883">=</span>&nbsp;<span class="ident" id="3882885">xk</span><span class="op" id="3882887">[</span><span class="ident" id="3882888">k</span><span class="op" id="3882889">+</span><span class="num" id="3882890">0</span><span class="op" id="3882891">]</span>&nbsp;<span class="op" id="3882893">^</span>&nbsp;<span class="ident" id="3882895">te0</span><span class="op" id="3882898">[</span><span class="builtintype" id="3882899">uint8</span><span class="op" id="3882904">(</span><span class="ident" id="3882905">s0</span><span class="op" id="3882907">&gt;&gt;</span><span class="num" id="3882909">24</span><span class="op" id="3882911">)</span><span class="op" id="3882912">]</span>&nbsp;<span class="op" id="3882914">^</span>&nbsp;<span class="ident" id="3882916">te1</span><span class="op" id="3882919">[</span><span class="builtintype" id="3882920">uint8</span><span class="op" id="3882925">(</span><span class="ident" id="3882926">s1</span><span class="op" id="3882928">&gt;&gt;</span><span class="num" id="3882930">16</span><span class="op" id="3882932">)</span><span class="op" id="3882933">]</span>&nbsp;<span class="op" id="3882935">^</span>&nbsp;<span class="ident" id="3882937">te2</span><span class="op" id="3882940">[</span><span class="builtintype" id="3882941">uint8</span><span class="op" id="3882946">(</span><span class="ident" id="3882947">s2</span><span class="op" id="3882949">&gt;&gt;</span><span class="num" id="3882951">8</span><span class="op" id="3882952">)</span><span class="op" id="3882953">]</span>&nbsp;<span class="op" id="3882955">^</span>&nbsp;<span class="ident" id="3882957">te3</span><span class="op" id="3882960">[</span><span class="builtintype" id="3882961">uint8</span><span class="op" id="3882966">(</span><span class="ident" id="3882967">s3</span><span class="op" id="3882969">)</span><span class="op" id="3882970">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3882974">t1</span>&nbsp;<span class="op" id="3882977">=</span>&nbsp;<span class="ident" id="3882979">xk</span><span class="op" id="3882981">[</span><span class="ident" id="3882982">k</span><span class="op" id="3882983">+</span><span class="num" id="3882984">1</span><span class="op" id="3882985">]</span>&nbsp;<span class="op" id="3882987">^</span>&nbsp;<span class="ident" id="3882989">te0</span><span class="op" id="3882992">[</span><span class="builtintype" id="3882993">uint8</span><span class="op" id="3882998">(</span><span class="ident" id="3882999">s1</span><span class="op" id="3883001">&gt;&gt;</span><span class="num" id="3883003">24</span><span class="op" id="3883005">)</span><span class="op" id="3883006">]</span>&nbsp;<span class="op" id="3883008">^</span>&nbsp;<span class="ident" id="3883010">te1</span><span class="op" id="3883013">[</span><span class="builtintype" id="3883014">uint8</span><span class="op" id="3883019">(</span><span class="ident" id="3883020">s2</span><span class="op" id="3883022">&gt;&gt;</span><span class="num" id="3883024">16</span><span class="op" id="3883026">)</span><span class="op" id="3883027">]</span>&nbsp;<span class="op" id="3883029">^</span>&nbsp;<span class="ident" id="3883031">te2</span><span class="op" id="3883034">[</span><span class="builtintype" id="3883035">uint8</span><span class="op" id="3883040">(</span><span class="ident" id="3883041">s3</span><span class="op" id="3883043">&gt;&gt;</span><span class="num" id="3883045">8</span><span class="op" id="3883046">)</span><span class="op" id="3883047">]</span>&nbsp;<span class="op" id="3883049">^</span>&nbsp;<span class="ident" id="3883051">te3</span><span class="op" id="3883054">[</span><span class="builtintype" id="3883055">uint8</span><span class="op" id="3883060">(</span><span class="ident" id="3883061">s0</span><span class="op" id="3883063">)</span><span class="op" id="3883064">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883068">t2</span>&nbsp;<span class="op" id="3883071">=</span>&nbsp;<span class="ident" id="3883073">xk</span><span class="op" id="3883075">[</span><span class="ident" id="3883076">k</span><span class="op" id="3883077">+</span><span class="num" id="3883078">2</span><span class="op" id="3883079">]</span>&nbsp;<span class="op" id="3883081">^</span>&nbsp;<span class="ident" id="3883083">te0</span><span class="op" id="3883086">[</span><span class="builtintype" id="3883087">uint8</span><span class="op" id="3883092">(</span><span class="ident" id="3883093">s2</span><span class="op" id="3883095">&gt;&gt;</span><span class="num" id="3883097">24</span><span class="op" id="3883099">)</span><span class="op" id="3883100">]</span>&nbsp;<span class="op" id="3883102">^</span>&nbsp;<span class="ident" id="3883104">te1</span><span class="op" id="3883107">[</span><span class="builtintype" id="3883108">uint8</span><span class="op" id="3883113">(</span><span class="ident" id="3883114">s3</span><span class="op" id="3883116">&gt;&gt;</span><span class="num" id="3883118">16</span><span class="op" id="3883120">)</span><span class="op" id="3883121">]</span>&nbsp;<span class="op" id="3883123">^</span>&nbsp;<span class="ident" id="3883125">te2</span><span class="op" id="3883128">[</span><span class="builtintype" id="3883129">uint8</span><span class="op" id="3883134">(</span><span class="ident" id="3883135">s0</span><span class="op" id="3883137">&gt;&gt;</span><span class="num" id="3883139">8</span><span class="op" id="3883140">)</span><span class="op" id="3883141">]</span>&nbsp;<span class="op" id="3883143">^</span>&nbsp;<span class="ident" id="3883145">te3</span><span class="op" id="3883148">[</span><span class="builtintype" id="3883149">uint8</span><span class="op" id="3883154">(</span><span class="ident" id="3883155">s1</span><span class="op" id="3883157">)</span><span class="op" id="3883158">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883162">t3</span>&nbsp;<span class="op" id="3883165">=</span>&nbsp;<span class="ident" id="3883167">xk</span><span class="op" id="3883169">[</span><span class="ident" id="3883170">k</span><span class="op" id="3883171">+</span><span class="num" id="3883172">3</span><span class="op" id="3883173">]</span>&nbsp;<span class="op" id="3883175">^</span>&nbsp;<span class="ident" id="3883177">te0</span><span class="op" id="3883180">[</span><span class="builtintype" id="3883181">uint8</span><span class="op" id="3883186">(</span><span class="ident" id="3883187">s3</span><span class="op" id="3883189">&gt;&gt;</span><span class="num" id="3883191">24</span><span class="op" id="3883193">)</span><span class="op" id="3883194">]</span>&nbsp;<span class="op" id="3883196">^</span>&nbsp;<span class="ident" id="3883198">te1</span><span class="op" id="3883201">[</span><span class="builtintype" id="3883202">uint8</span><span class="op" id="3883207">(</span><span class="ident" id="3883208">s0</span><span class="op" id="3883210">&gt;&gt;</span><span class="num" id="3883212">16</span><span class="op" id="3883214">)</span><span class="op" id="3883215">]</span>&nbsp;<span class="op" id="3883217">^</span>&nbsp;<span class="ident" id="3883219">te2</span><span class="op" id="3883222">[</span><span class="builtintype" id="3883223">uint8</span><span class="op" id="3883228">(</span><span class="ident" id="3883229">s1</span><span class="op" id="3883231">&gt;&gt;</span><span class="num" id="3883233">8</span><span class="op" id="3883234">)</span><span class="op" id="3883235">]</span>&nbsp;<span class="op" id="3883237">^</span>&nbsp;<span class="ident" id="3883239">te3</span><span class="op" id="3883242">[</span><span class="builtintype" id="3883243">uint8</span><span class="op" id="3883248">(</span><span class="ident" id="3883249">s2</span><span class="op" id="3883251">)</span><span class="op" id="3883252">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883256">k</span>&nbsp;<span class="op" id="3883258">+=</span>&nbsp;<span class="num" id="3883261">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883265">s0</span><span class="op" id="3883267">,</span>&nbsp;<span class="ident" id="3883269">s1</span><span class="op" id="3883271">,</span>&nbsp;<span class="ident" id="3883273">s2</span><span class="op" id="3883275">,</span>&nbsp;<span class="ident" id="3883277">s3</span>&nbsp;<span class="op" id="3883280">=</span>&nbsp;<span class="ident" id="3883282">t0</span><span class="op" id="3883284">,</span>&nbsp;<span class="ident" id="3883286">t1</span><span class="op" id="3883288">,</span>&nbsp;<span class="ident" id="3883290">t2</span><span class="op" id="3883292">,</span>&nbsp;<span class="ident" id="3883294">t3</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3883298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3883302">//&nbsp;Last&nbsp;round&nbsp;uses&nbsp;s-box&nbsp;directly&nbsp;and&nbsp;XORs&nbsp;to&nbsp;produce&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883365">s0</span>&nbsp;<span class="op" id="3883368">=</span>&nbsp;<span class="builtintype" id="3883370">uint32</span><span class="op" id="3883376">(</span><span class="ident" id="3883377">sbox0</span><span class="op" id="3883382">[</span><span class="ident" id="3883383">t0</span><span class="op" id="3883385">&gt;&gt;</span><span class="num" id="3883387">24</span><span class="op" id="3883389">]</span><span class="op" id="3883390">)</span><span class="op" id="3883391">&lt;&lt;</span><span class="num" id="3883393">24</span>&nbsp;<span class="op" id="3883396">|</span>&nbsp;<span class="builtintype" id="3883398">uint32</span><span class="op" id="3883404">(</span><span class="ident" id="3883405">sbox0</span><span class="op" id="3883410">[</span><span class="ident" id="3883411">t1</span><span class="op" id="3883413">&gt;&gt;</span><span class="num" id="3883415">16</span><span class="op" id="3883417">&amp;</span><span class="num" id="3883418">0xff</span><span class="op" id="3883422">]</span><span class="op" id="3883423">)</span><span class="op" id="3883424">&lt;&lt;</span><span class="num" id="3883426">16</span>&nbsp;<span class="op" id="3883429">|</span>&nbsp;<span class="builtintype" id="3883431">uint32</span><span class="op" id="3883437">(</span><span class="ident" id="3883438">sbox0</span><span class="op" id="3883443">[</span><span class="ident" id="3883444">t2</span><span class="op" id="3883446">&gt;&gt;</span><span class="num" id="3883448">8</span><span class="op" id="3883449">&amp;</span><span class="num" id="3883450">0xff</span><span class="op" id="3883454">]</span><span class="op" id="3883455">)</span><span class="op" id="3883456">&lt;&lt;</span><span class="num" id="3883458">8</span>&nbsp;<span class="op" id="3883460">|</span>&nbsp;<span class="builtintype" id="3883462">uint32</span><span class="op" id="3883468">(</span><span class="ident" id="3883469">sbox0</span><span class="op" id="3883474">[</span><span class="ident" id="3883475">t3</span><span class="op" id="3883477">&amp;</span><span class="num" id="3883478">0xff</span><span class="op" id="3883482">]</span><span class="op" id="3883483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883486">s1</span>&nbsp;<span class="op" id="3883489">=</span>&nbsp;<span class="builtintype" id="3883491">uint32</span><span class="op" id="3883497">(</span><span class="ident" id="3883498">sbox0</span><span class="op" id="3883503">[</span><span class="ident" id="3883504">t1</span><span class="op" id="3883506">&gt;&gt;</span><span class="num" id="3883508">24</span><span class="op" id="3883510">]</span><span class="op" id="3883511">)</span><span class="op" id="3883512">&lt;&lt;</span><span class="num" id="3883514">24</span>&nbsp;<span class="op" id="3883517">|</span>&nbsp;<span class="builtintype" id="3883519">uint32</span><span class="op" id="3883525">(</span><span class="ident" id="3883526">sbox0</span><span class="op" id="3883531">[</span><span class="ident" id="3883532">t2</span><span class="op" id="3883534">&gt;&gt;</span><span class="num" id="3883536">16</span><span class="op" id="3883538">&amp;</span><span class="num" id="3883539">0xff</span><span class="op" id="3883543">]</span><span class="op" id="3883544">)</span><span class="op" id="3883545">&lt;&lt;</span><span class="num" id="3883547">16</span>&nbsp;<span class="op" id="3883550">|</span>&nbsp;<span class="builtintype" id="3883552">uint32</span><span class="op" id="3883558">(</span><span class="ident" id="3883559">sbox0</span><span class="op" id="3883564">[</span><span class="ident" id="3883565">t3</span><span class="op" id="3883567">&gt;&gt;</span><span class="num" id="3883569">8</span><span class="op" id="3883570">&amp;</span><span class="num" id="3883571">0xff</span><span class="op" id="3883575">]</span><span class="op" id="3883576">)</span><span class="op" id="3883577">&lt;&lt;</span><span class="num" id="3883579">8</span>&nbsp;<span class="op" id="3883581">|</span>&nbsp;<span class="builtintype" id="3883583">uint32</span><span class="op" id="3883589">(</span><span class="ident" id="3883590">sbox0</span><span class="op" id="3883595">[</span><span class="ident" id="3883596">t0</span><span class="op" id="3883598">&amp;</span><span class="num" id="3883599">0xff</span><span class="op" id="3883603">]</span><span class="op" id="3883604">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883607">s2</span>&nbsp;<span class="op" id="3883610">=</span>&nbsp;<span class="builtintype" id="3883612">uint32</span><span class="op" id="3883618">(</span><span class="ident" id="3883619">sbox0</span><span class="op" id="3883624">[</span><span class="ident" id="3883625">t2</span><span class="op" id="3883627">&gt;&gt;</span><span class="num" id="3883629">24</span><span class="op" id="3883631">]</span><span class="op" id="3883632">)</span><span class="op" id="3883633">&lt;&lt;</span><span class="num" id="3883635">24</span>&nbsp;<span class="op" id="3883638">|</span>&nbsp;<span class="builtintype" id="3883640">uint32</span><span class="op" id="3883646">(</span><span class="ident" id="3883647">sbox0</span><span class="op" id="3883652">[</span><span class="ident" id="3883653">t3</span><span class="op" id="3883655">&gt;&gt;</span><span class="num" id="3883657">16</span><span class="op" id="3883659">&amp;</span><span class="num" id="3883660">0xff</span><span class="op" id="3883664">]</span><span class="op" id="3883665">)</span><span class="op" id="3883666">&lt;&lt;</span><span class="num" id="3883668">16</span>&nbsp;<span class="op" id="3883671">|</span>&nbsp;<span class="builtintype" id="3883673">uint32</span><span class="op" id="3883679">(</span><span class="ident" id="3883680">sbox0</span><span class="op" id="3883685">[</span><span class="ident" id="3883686">t0</span><span class="op" id="3883688">&gt;&gt;</span><span class="num" id="3883690">8</span><span class="op" id="3883691">&amp;</span><span class="num" id="3883692">0xff</span><span class="op" id="3883696">]</span><span class="op" id="3883697">)</span><span class="op" id="3883698">&lt;&lt;</span><span class="num" id="3883700">8</span>&nbsp;<span class="op" id="3883702">|</span>&nbsp;<span class="builtintype" id="3883704">uint32</span><span class="op" id="3883710">(</span><span class="ident" id="3883711">sbox0</span><span class="op" id="3883716">[</span><span class="ident" id="3883717">t1</span><span class="op" id="3883719">&amp;</span><span class="num" id="3883720">0xff</span><span class="op" id="3883724">]</span><span class="op" id="3883725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883728">s3</span>&nbsp;<span class="op" id="3883731">=</span>&nbsp;<span class="builtintype" id="3883733">uint32</span><span class="op" id="3883739">(</span><span class="ident" id="3883740">sbox0</span><span class="op" id="3883745">[</span><span class="ident" id="3883746">t3</span><span class="op" id="3883748">&gt;&gt;</span><span class="num" id="3883750">24</span><span class="op" id="3883752">]</span><span class="op" id="3883753">)</span><span class="op" id="3883754">&lt;&lt;</span><span class="num" id="3883756">24</span>&nbsp;<span class="op" id="3883759">|</span>&nbsp;<span class="builtintype" id="3883761">uint32</span><span class="op" id="3883767">(</span><span class="ident" id="3883768">sbox0</span><span class="op" id="3883773">[</span><span class="ident" id="3883774">t0</span><span class="op" id="3883776">&gt;&gt;</span><span class="num" id="3883778">16</span><span class="op" id="3883780">&amp;</span><span class="num" id="3883781">0xff</span><span class="op" id="3883785">]</span><span class="op" id="3883786">)</span><span class="op" id="3883787">&lt;&lt;</span><span class="num" id="3883789">16</span>&nbsp;<span class="op" id="3883792">|</span>&nbsp;<span class="builtintype" id="3883794">uint32</span><span class="op" id="3883800">(</span><span class="ident" id="3883801">sbox0</span><span class="op" id="3883806">[</span><span class="ident" id="3883807">t1</span><span class="op" id="3883809">&gt;&gt;</span><span class="num" id="3883811">8</span><span class="op" id="3883812">&amp;</span><span class="num" id="3883813">0xff</span><span class="op" id="3883817">]</span><span class="op" id="3883818">)</span><span class="op" id="3883819">&lt;&lt;</span><span class="num" id="3883821">8</span>&nbsp;<span class="op" id="3883823">|</span>&nbsp;<span class="builtintype" id="3883825">uint32</span><span class="op" id="3883831">(</span><span class="ident" id="3883832">sbox0</span><span class="op" id="3883837">[</span><span class="ident" id="3883838">t2</span><span class="op" id="3883840">&amp;</span><span class="num" id="3883841">0xff</span><span class="op" id="3883845">]</span><span class="op" id="3883846">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883850">s0</span>&nbsp;<span class="op" id="3883853">^=</span>&nbsp;<span class="ident" id="3883856">xk</span><span class="op" id="3883858">[</span><span class="ident" id="3883859">k</span><span class="op" id="3883860">+</span><span class="num" id="3883861">0</span><span class="op" id="3883862">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883865">s1</span>&nbsp;<span class="op" id="3883868">^=</span>&nbsp;<span class="ident" id="3883871">xk</span><span class="op" id="3883873">[</span><span class="ident" id="3883874">k</span><span class="op" id="3883875">+</span><span class="num" id="3883876">1</span><span class="op" id="3883877">]</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883880">s2</span>&nbsp;<span class="op" id="3883883">^=</span>&nbsp;<span class="ident" id="3883886">xk</span><span class="op" id="3883888">[</span><span class="ident" id="3883889">k</span><span class="op" id="3883890">+</span><span class="num" id="3883891">2</span><span class="op" id="3883892">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883895">s3</span>&nbsp;<span class="op" id="3883898">^=</span>&nbsp;<span class="ident" id="3883901">xk</span><span class="op" id="3883903">[</span><span class="ident" id="3883904">k</span><span class="op" id="3883905">+</span><span class="num" id="3883906">3</span><span class="op" id="3883907">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883911">dst</span><span class="op" id="3883914">[</span><span class="num" id="3883915">0</span><span class="op" id="3883916">]</span><span class="op" id="3883917">,</span>&nbsp;<span class="ident" id="3883919">dst</span><span class="op" id="3883922">[</span><span class="num" id="3883923">1</span><span class="op" id="3883924">]</span><span class="op" id="3883925">,</span>&nbsp;<span class="ident" id="3883927">dst</span><span class="op" id="3883930">[</span><span class="num" id="3883931">2</span><span class="op" id="3883932">]</span><span class="op" id="3883933">,</span>&nbsp;<span class="ident" id="3883935">dst</span><span class="op" id="3883938">[</span><span class="num" id="3883939">3</span><span class="op" id="3883940">]</span>&nbsp;<span class="op" id="3883942">=</span>&nbsp;<span class="builtintype" id="3883944">byte</span><span class="op" id="3883948">(</span><span class="ident" id="3883949">s0</span><span class="op" id="3883951">&gt;&gt;</span><span class="num" id="3883953">24</span><span class="op" id="3883955">)</span><span class="op" id="3883956">,</span>&nbsp;<span class="builtintype" id="3883958">byte</span><span class="op" id="3883962">(</span><span class="ident" id="3883963">s0</span><span class="op" id="3883965">&gt;&gt;</span><span class="num" id="3883967">16</span><span class="op" id="3883969">)</span><span class="op" id="3883970">,</span>&nbsp;<span class="builtintype" id="3883972">byte</span><span class="op" id="3883976">(</span><span class="ident" id="3883977">s0</span><span class="op" id="3883979">&gt;&gt;</span><span class="num" id="3883981">8</span><span class="op" id="3883982">)</span><span class="op" id="3883983">,</span>&nbsp;<span class="builtintype" id="3883985">byte</span><span class="op" id="3883989">(</span><span class="ident" id="3883990">s0</span><span class="op" id="3883992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3883995">dst</span><span class="op" id="3883998">[</span><span class="num" id="3883999">4</span><span class="op" id="3884000">]</span><span class="op" id="3884001">,</span>&nbsp;<span class="ident" id="3884003">dst</span><span class="op" id="3884006">[</span><span class="num" id="3884007">5</span><span class="op" id="3884008">]</span><span class="op" id="3884009">,</span>&nbsp;<span class="ident" id="3884011">dst</span><span class="op" id="3884014">[</span><span class="num" id="3884015">6</span><span class="op" id="3884016">]</span><span class="op" id="3884017">,</span>&nbsp;<span class="ident" id="3884019">dst</span><span class="op" id="3884022">[</span><span class="num" id="3884023">7</span><span class="op" id="3884024">]</span>&nbsp;<span class="op" id="3884026">=</span>&nbsp;<span class="builtintype" id="3884028">byte</span><span class="op" id="3884032">(</span><span class="ident" id="3884033">s1</span><span class="op" id="3884035">&gt;&gt;</span><span class="num" id="3884037">24</span><span class="op" id="3884039">)</span><span class="op" id="3884040">,</span>&nbsp;<span class="builtintype" id="3884042">byte</span><span class="op" id="3884046">(</span><span class="ident" id="3884047">s1</span><span class="op" id="3884049">&gt;&gt;</span><span class="num" id="3884051">16</span><span class="op" id="3884053">)</span><span class="op" id="3884054">,</span>&nbsp;<span class="builtintype" id="3884056">byte</span><span class="op" id="3884060">(</span><span class="ident" id="3884061">s1</span><span class="op" id="3884063">&gt;&gt;</span><span class="num" id="3884065">8</span><span class="op" id="3884066">)</span><span class="op" id="3884067">,</span>&nbsp;<span class="builtintype" id="3884069">byte</span><span class="op" id="3884073">(</span><span class="ident" id="3884074">s1</span><span class="op" id="3884076">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884079">dst</span><span class="op" id="3884082">[</span><span class="num" id="3884083">8</span><span class="op" id="3884084">]</span><span class="op" id="3884085">,</span>&nbsp;<span class="ident" id="3884087">dst</span><span class="op" id="3884090">[</span><span class="num" id="3884091">9</span><span class="op" id="3884092">]</span><span class="op" id="3884093">,</span>&nbsp;<span class="ident" id="3884095">dst</span><span class="op" id="3884098">[</span><span class="num" id="3884099">10</span><span class="op" id="3884101">]</span><span class="op" id="3884102">,</span>&nbsp;<span class="ident" id="3884104">dst</span><span class="op" id="3884107">[</span><span class="num" id="3884108">11</span><span class="op" id="3884110">]</span>&nbsp;<span class="op" id="3884112">=</span>&nbsp;<span class="builtintype" id="3884114">byte</span><span class="op" id="3884118">(</span><span class="ident" id="3884119">s2</span><span class="op" id="3884121">&gt;&gt;</span><span class="num" id="3884123">24</span><span class="op" id="3884125">)</span><span class="op" id="3884126">,</span>&nbsp;<span class="builtintype" id="3884128">byte</span><span class="op" id="3884132">(</span><span class="ident" id="3884133">s2</span><span class="op" id="3884135">&gt;&gt;</span><span class="num" id="3884137">16</span><span class="op" id="3884139">)</span><span class="op" id="3884140">,</span>&nbsp;<span class="builtintype" id="3884142">byte</span><span class="op" id="3884146">(</span><span class="ident" id="3884147">s2</span><span class="op" id="3884149">&gt;&gt;</span><span class="num" id="3884151">8</span><span class="op" id="3884152">)</span><span class="op" id="3884153">,</span>&nbsp;<span class="builtintype" id="3884155">byte</span><span class="op" id="3884159">(</span><span class="ident" id="3884160">s2</span><span class="op" id="3884162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884165">dst</span><span class="op" id="3884168">[</span><span class="num" id="3884169">12</span><span class="op" id="3884171">]</span><span class="op" id="3884172">,</span>&nbsp;<span class="ident" id="3884174">dst</span><span class="op" id="3884177">[</span><span class="num" id="3884178">13</span><span class="op" id="3884180">]</span><span class="op" id="3884181">,</span>&nbsp;<span class="ident" id="3884183">dst</span><span class="op" id="3884186">[</span><span class="num" id="3884187">14</span><span class="op" id="3884189">]</span><span class="op" id="3884190">,</span>&nbsp;<span class="ident" id="3884192">dst</span><span class="op" id="3884195">[</span><span class="num" id="3884196">15</span><span class="op" id="3884198">]</span>&nbsp;<span class="op" id="3884200">=</span>&nbsp;<span class="builtintype" id="3884202">byte</span><span class="op" id="3884206">(</span><span class="ident" id="3884207">s3</span><span class="op" id="3884209">&gt;&gt;</span><span class="num" id="3884211">24</span><span class="op" id="3884213">)</span><span class="op" id="3884214">,</span>&nbsp;<span class="builtintype" id="3884216">byte</span><span class="op" id="3884220">(</span><span class="ident" id="3884221">s3</span><span class="op" id="3884223">&gt;&gt;</span><span class="num" id="3884225">16</span><span class="op" id="3884227">)</span><span class="op" id="3884228">,</span>&nbsp;<span class="builtintype" id="3884230">byte</span><span class="op" id="3884234">(</span><span class="ident" id="3884235">s3</span><span class="op" id="3884237">&gt;&gt;</span><span class="num" id="3884239">8</span><span class="op" id="3884240">)</span><span class="op" id="3884241">,</span>&nbsp;<span class="builtintype" id="3884243">byte</span><span class="op" id="3884247">(</span><span class="ident" id="3884248">s3</span><span class="op" id="3884250">)</span><br>
<span class="lineno"></span><span class="op" id="3884252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3884255">//&nbsp;Decrypt&nbsp;one&nbsp;block&nbsp;from&nbsp;src&nbsp;into&nbsp;dst,&nbsp;using&nbsp;the&nbsp;expanded&nbsp;key&nbsp;xk.</span><br>
<span class="lineno">85</span><span class="keyword" id="3884322">func</span>&nbsp;<span class="ident" id="3884327">decryptBlockGo</span><span class="op" id="3884341">(</span><span class="ident" id="3884342">xk</span>&nbsp;<span class="op" id="3884345">[</span><span class="op" id="3884346">]</span><span class="builtintype" id="3884347">uint32</span><span class="op" id="3884353">,</span>&nbsp;<span class="ident" id="3884355">dst</span><span class="op" id="3884358">,</span>&nbsp;<span class="ident" id="3884360">src</span>&nbsp;<span class="op" id="3884364">[</span><span class="op" id="3884365">]</span><span class="builtintype" id="3884366">byte</span><span class="op" id="3884370">)</span>&nbsp;<span class="op" id="3884372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3884375">var</span>&nbsp;<span class="ident" id="3884379">s0</span><span class="op" id="3884381">,</span>&nbsp;<span class="ident" id="3884383">s1</span><span class="op" id="3884385">,</span>&nbsp;<span class="ident" id="3884387">s2</span><span class="op" id="3884389">,</span>&nbsp;<span class="ident" id="3884391">s3</span><span class="op" id="3884393">,</span>&nbsp;<span class="ident" id="3884395">t0</span><span class="op" id="3884397">,</span>&nbsp;<span class="ident" id="3884399">t1</span><span class="op" id="3884401">,</span>&nbsp;<span class="ident" id="3884403">t2</span><span class="op" id="3884405">,</span>&nbsp;<span class="ident" id="3884407">t3</span>&nbsp;<span class="builtintype" id="3884410">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884419">s0</span>&nbsp;<span class="op" id="3884422">=</span>&nbsp;<span class="builtintype" id="3884424">uint32</span><span class="op" id="3884430">(</span><span class="ident" id="3884431">src</span><span class="op" id="3884434">[</span><span class="num" id="3884435">0</span><span class="op" id="3884436">]</span><span class="op" id="3884437">)</span><span class="op" id="3884438">&lt;&lt;</span><span class="num" id="3884440">24</span>&nbsp;<span class="op" id="3884443">|</span>&nbsp;<span class="builtintype" id="3884445">uint32</span><span class="op" id="3884451">(</span><span class="ident" id="3884452">src</span><span class="op" id="3884455">[</span><span class="num" id="3884456">1</span><span class="op" id="3884457">]</span><span class="op" id="3884458">)</span><span class="op" id="3884459">&lt;&lt;</span><span class="num" id="3884461">16</span>&nbsp;<span class="op" id="3884464">|</span>&nbsp;<span class="builtintype" id="3884466">uint32</span><span class="op" id="3884472">(</span><span class="ident" id="3884473">src</span><span class="op" id="3884476">[</span><span class="num" id="3884477">2</span><span class="op" id="3884478">]</span><span class="op" id="3884479">)</span><span class="op" id="3884480">&lt;&lt;</span><span class="num" id="3884482">8</span>&nbsp;<span class="op" id="3884484">|</span>&nbsp;<span class="builtintype" id="3884486">uint32</span><span class="op" id="3884492">(</span><span class="ident" id="3884493">src</span><span class="op" id="3884496">[</span><span class="num" id="3884497">3</span><span class="op" id="3884498">]</span><span class="op" id="3884499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884502">s1</span>&nbsp;<span class="op" id="3884505">=</span>&nbsp;<span class="builtintype" id="3884507">uint32</span><span class="op" id="3884513">(</span><span class="ident" id="3884514">src</span><span class="op" id="3884517">[</span><span class="num" id="3884518">4</span><span class="op" id="3884519">]</span><span class="op" id="3884520">)</span><span class="op" id="3884521">&lt;&lt;</span><span class="num" id="3884523">24</span>&nbsp;<span class="op" id="3884526">|</span>&nbsp;<span class="builtintype" id="3884528">uint32</span><span class="op" id="3884534">(</span><span class="ident" id="3884535">src</span><span class="op" id="3884538">[</span><span class="num" id="3884539">5</span><span class="op" id="3884540">]</span><span class="op" id="3884541">)</span><span class="op" id="3884542">&lt;&lt;</span><span class="num" id="3884544">16</span>&nbsp;<span class="op" id="3884547">|</span>&nbsp;<span class="builtintype" id="3884549">uint32</span><span class="op" id="3884555">(</span><span class="ident" id="3884556">src</span><span class="op" id="3884559">[</span><span class="num" id="3884560">6</span><span class="op" id="3884561">]</span><span class="op" id="3884562">)</span><span class="op" id="3884563">&lt;&lt;</span><span class="num" id="3884565">8</span>&nbsp;<span class="op" id="3884567">|</span>&nbsp;<span class="builtintype" id="3884569">uint32</span><span class="op" id="3884575">(</span><span class="ident" id="3884576">src</span><span class="op" id="3884579">[</span><span class="num" id="3884580">7</span><span class="op" id="3884581">]</span><span class="op" id="3884582">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884585">s2</span>&nbsp;<span class="op" id="3884588">=</span>&nbsp;<span class="builtintype" id="3884590">uint32</span><span class="op" id="3884596">(</span><span class="ident" id="3884597">src</span><span class="op" id="3884600">[</span><span class="num" id="3884601">8</span><span class="op" id="3884602">]</span><span class="op" id="3884603">)</span><span class="op" id="3884604">&lt;&lt;</span><span class="num" id="3884606">24</span>&nbsp;<span class="op" id="3884609">|</span>&nbsp;<span class="builtintype" id="3884611">uint32</span><span class="op" id="3884617">(</span><span class="ident" id="3884618">src</span><span class="op" id="3884621">[</span><span class="num" id="3884622">9</span><span class="op" id="3884623">]</span><span class="op" id="3884624">)</span><span class="op" id="3884625">&lt;&lt;</span><span class="num" id="3884627">16</span>&nbsp;<span class="op" id="3884630">|</span>&nbsp;<span class="builtintype" id="3884632">uint32</span><span class="op" id="3884638">(</span><span class="ident" id="3884639">src</span><span class="op" id="3884642">[</span><span class="num" id="3884643">10</span><span class="op" id="3884645">]</span><span class="op" id="3884646">)</span><span class="op" id="3884647">&lt;&lt;</span><span class="num" id="3884649">8</span>&nbsp;<span class="op" id="3884651">|</span>&nbsp;<span class="builtintype" id="3884653">uint32</span><span class="op" id="3884659">(</span><span class="ident" id="3884660">src</span><span class="op" id="3884663">[</span><span class="num" id="3884664">11</span><span class="op" id="3884666">]</span><span class="op" id="3884667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884670">s3</span>&nbsp;<span class="op" id="3884673">=</span>&nbsp;<span class="builtintype" id="3884675">uint32</span><span class="op" id="3884681">(</span><span class="ident" id="3884682">src</span><span class="op" id="3884685">[</span><span class="num" id="3884686">12</span><span class="op" id="3884688">]</span><span class="op" id="3884689">)</span><span class="op" id="3884690">&lt;&lt;</span><span class="num" id="3884692">24</span>&nbsp;<span class="op" id="3884695">|</span>&nbsp;<span class="builtintype" id="3884697">uint32</span><span class="op" id="3884703">(</span><span class="ident" id="3884704">src</span><span class="op" id="3884707">[</span><span class="num" id="3884708">13</span><span class="op" id="3884710">]</span><span class="op" id="3884711">)</span><span class="op" id="3884712">&lt;&lt;</span><span class="num" id="3884714">16</span>&nbsp;<span class="op" id="3884717">|</span>&nbsp;<span class="builtintype" id="3884719">uint32</span><span class="op" id="3884725">(</span><span class="ident" id="3884726">src</span><span class="op" id="3884729">[</span><span class="num" id="3884730">14</span><span class="op" id="3884732">]</span><span class="op" id="3884733">)</span><span class="op" id="3884734">&lt;&lt;</span><span class="num" id="3884736">8</span>&nbsp;<span class="op" id="3884738">|</span>&nbsp;<span class="builtintype" id="3884740">uint32</span><span class="op" id="3884746">(</span><span class="ident" id="3884747">src</span><span class="op" id="3884750">[</span><span class="num" id="3884751">15</span><span class="op" id="3884753">]</span><span class="op" id="3884754">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3884758">//&nbsp;First&nbsp;round&nbsp;just&nbsp;XORs&nbsp;input&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884800">s0</span>&nbsp;<span class="op" id="3884803">^=</span>&nbsp;<span class="ident" id="3884806">xk</span><span class="op" id="3884808">[</span><span class="num" id="3884809">0</span><span class="op" id="3884810">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884813">s1</span>&nbsp;<span class="op" id="3884816">^=</span>&nbsp;<span class="ident" id="3884819">xk</span><span class="op" id="3884821">[</span><span class="num" id="3884822">1</span><span class="op" id="3884823">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884826">s2</span>&nbsp;<span class="op" id="3884829">^=</span>&nbsp;<span class="ident" id="3884832">xk</span><span class="op" id="3884834">[</span><span class="num" id="3884835">2</span><span class="op" id="3884836">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884839">s3</span>&nbsp;<span class="op" id="3884842">^=</span>&nbsp;<span class="ident" id="3884845">xk</span><span class="op" id="3884847">[</span><span class="num" id="3884848">3</span><span class="op" id="3884849">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3884853">//&nbsp;Middle&nbsp;rounds&nbsp;shuffle&nbsp;using&nbsp;tables.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3884893">//&nbsp;Number&nbsp;of&nbsp;rounds&nbsp;is&nbsp;set&nbsp;by&nbsp;length&nbsp;of&nbsp;expanded&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3884948">nr</span>&nbsp;<span class="op" id="3884951">:=</span>&nbsp;<span class="builtinfunc" id="3884954">len</span><span class="op" id="3884957">(</span><span class="ident" id="3884958">xk</span><span class="op" id="3884960">)</span><span class="op" id="3884961">/</span><span class="num" id="3884962">4</span>&nbsp;<span class="op" id="3884964">-</span>&nbsp;<span class="num" id="3884966">2</span>&nbsp;<span class="comment" id="3884968">//&nbsp;-&nbsp;2:&nbsp;one&nbsp;above,&nbsp;one&nbsp;more&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885003">k</span>&nbsp;<span class="op" id="3885005">:=</span>&nbsp;<span class="num" id="3885008">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3885011">for</span>&nbsp;<span class="ident" id="3885015">r</span>&nbsp;<span class="op" id="3885017">:=</span>&nbsp;<span class="num" id="3885020">0</span><span class="op" id="3885021">;</span>&nbsp;<span class="ident" id="3885023">r</span>&nbsp;<span class="op" id="3885025">&lt;</span>&nbsp;<span class="ident" id="3885027">nr</span><span class="op" id="3885029">;</span>&nbsp;<span class="ident" id="3885031">r</span><span class="op" id="3885032">++</span>&nbsp;<span class="op" id="3885035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885039">t0</span>&nbsp;<span class="op" id="3885042">=</span>&nbsp;<span class="ident" id="3885044">xk</span><span class="op" id="3885046">[</span><span class="ident" id="3885047">k</span><span class="op" id="3885048">+</span><span class="num" id="3885049">0</span><span class="op" id="3885050">]</span>&nbsp;<span class="op" id="3885052">^</span>&nbsp;<span class="ident" id="3885054">td0</span><span class="op" id="3885057">[</span><span class="builtintype" id="3885058">uint8</span><span class="op" id="3885063">(</span><span class="ident" id="3885064">s0</span><span class="op" id="3885066">&gt;&gt;</span><span class="num" id="3885068">24</span><span class="op" id="3885070">)</span><span class="op" id="3885071">]</span>&nbsp;<span class="op" id="3885073">^</span>&nbsp;<span class="ident" id="3885075">td1</span><span class="op" id="3885078">[</span><span class="builtintype" id="3885079">uint8</span><span class="op" id="3885084">(</span><span class="ident" id="3885085">s3</span><span class="op" id="3885087">&gt;&gt;</span><span class="num" id="3885089">16</span><span class="op" id="3885091">)</span><span class="op" id="3885092">]</span>&nbsp;<span class="op" id="3885094">^</span>&nbsp;<span class="ident" id="3885096">td2</span><span class="op" id="3885099">[</span><span class="builtintype" id="3885100">uint8</span><span class="op" id="3885105">(</span><span class="ident" id="3885106">s2</span><span class="op" id="3885108">&gt;&gt;</span><span class="num" id="3885110">8</span><span class="op" id="3885111">)</span><span class="op" id="3885112">]</span>&nbsp;<span class="op" id="3885114">^</span>&nbsp;<span class="ident" id="3885116">td3</span><span class="op" id="3885119">[</span><span class="builtintype" id="3885120">uint8</span><span class="op" id="3885125">(</span><span class="ident" id="3885126">s1</span><span class="op" id="3885128">)</span><span class="op" id="3885129">]</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885133">t1</span>&nbsp;<span class="op" id="3885136">=</span>&nbsp;<span class="ident" id="3885138">xk</span><span class="op" id="3885140">[</span><span class="ident" id="3885141">k</span><span class="op" id="3885142">+</span><span class="num" id="3885143">1</span><span class="op" id="3885144">]</span>&nbsp;<span class="op" id="3885146">^</span>&nbsp;<span class="ident" id="3885148">td0</span><span class="op" id="3885151">[</span><span class="builtintype" id="3885152">uint8</span><span class="op" id="3885157">(</span><span class="ident" id="3885158">s1</span><span class="op" id="3885160">&gt;&gt;</span><span class="num" id="3885162">24</span><span class="op" id="3885164">)</span><span class="op" id="3885165">]</span>&nbsp;<span class="op" id="3885167">^</span>&nbsp;<span class="ident" id="3885169">td1</span><span class="op" id="3885172">[</span><span class="builtintype" id="3885173">uint8</span><span class="op" id="3885178">(</span><span class="ident" id="3885179">s0</span><span class="op" id="3885181">&gt;&gt;</span><span class="num" id="3885183">16</span><span class="op" id="3885185">)</span><span class="op" id="3885186">]</span>&nbsp;<span class="op" id="3885188">^</span>&nbsp;<span class="ident" id="3885190">td2</span><span class="op" id="3885193">[</span><span class="builtintype" id="3885194">uint8</span><span class="op" id="3885199">(</span><span class="ident" id="3885200">s3</span><span class="op" id="3885202">&gt;&gt;</span><span class="num" id="3885204">8</span><span class="op" id="3885205">)</span><span class="op" id="3885206">]</span>&nbsp;<span class="op" id="3885208">^</span>&nbsp;<span class="ident" id="3885210">td3</span><span class="op" id="3885213">[</span><span class="builtintype" id="3885214">uint8</span><span class="op" id="3885219">(</span><span class="ident" id="3885220">s2</span><span class="op" id="3885222">)</span><span class="op" id="3885223">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885227">t2</span>&nbsp;<span class="op" id="3885230">=</span>&nbsp;<span class="ident" id="3885232">xk</span><span class="op" id="3885234">[</span><span class="ident" id="3885235">k</span><span class="op" id="3885236">+</span><span class="num" id="3885237">2</span><span class="op" id="3885238">]</span>&nbsp;<span class="op" id="3885240">^</span>&nbsp;<span class="ident" id="3885242">td0</span><span class="op" id="3885245">[</span><span class="builtintype" id="3885246">uint8</span><span class="op" id="3885251">(</span><span class="ident" id="3885252">s2</span><span class="op" id="3885254">&gt;&gt;</span><span class="num" id="3885256">24</span><span class="op" id="3885258">)</span><span class="op" id="3885259">]</span>&nbsp;<span class="op" id="3885261">^</span>&nbsp;<span class="ident" id="3885263">td1</span><span class="op" id="3885266">[</span><span class="builtintype" id="3885267">uint8</span><span class="op" id="3885272">(</span><span class="ident" id="3885273">s1</span><span class="op" id="3885275">&gt;&gt;</span><span class="num" id="3885277">16</span><span class="op" id="3885279">)</span><span class="op" id="3885280">]</span>&nbsp;<span class="op" id="3885282">^</span>&nbsp;<span class="ident" id="3885284">td2</span><span class="op" id="3885287">[</span><span class="builtintype" id="3885288">uint8</span><span class="op" id="3885293">(</span><span class="ident" id="3885294">s0</span><span class="op" id="3885296">&gt;&gt;</span><span class="num" id="3885298">8</span><span class="op" id="3885299">)</span><span class="op" id="3885300">]</span>&nbsp;<span class="op" id="3885302">^</span>&nbsp;<span class="ident" id="3885304">td3</span><span class="op" id="3885307">[</span><span class="builtintype" id="3885308">uint8</span><span class="op" id="3885313">(</span><span class="ident" id="3885314">s3</span><span class="op" id="3885316">)</span><span class="op" id="3885317">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885321">t3</span>&nbsp;<span class="op" id="3885324">=</span>&nbsp;<span class="ident" id="3885326">xk</span><span class="op" id="3885328">[</span><span class="ident" id="3885329">k</span><span class="op" id="3885330">+</span><span class="num" id="3885331">3</span><span class="op" id="3885332">]</span>&nbsp;<span class="op" id="3885334">^</span>&nbsp;<span class="ident" id="3885336">td0</span><span class="op" id="3885339">[</span><span class="builtintype" id="3885340">uint8</span><span class="op" id="3885345">(</span><span class="ident" id="3885346">s3</span><span class="op" id="3885348">&gt;&gt;</span><span class="num" id="3885350">24</span><span class="op" id="3885352">)</span><span class="op" id="3885353">]</span>&nbsp;<span class="op" id="3885355">^</span>&nbsp;<span class="ident" id="3885357">td1</span><span class="op" id="3885360">[</span><span class="builtintype" id="3885361">uint8</span><span class="op" id="3885366">(</span><span class="ident" id="3885367">s2</span><span class="op" id="3885369">&gt;&gt;</span><span class="num" id="3885371">16</span><span class="op" id="3885373">)</span><span class="op" id="3885374">]</span>&nbsp;<span class="op" id="3885376">^</span>&nbsp;<span class="ident" id="3885378">td2</span><span class="op" id="3885381">[</span><span class="builtintype" id="3885382">uint8</span><span class="op" id="3885387">(</span><span class="ident" id="3885388">s1</span><span class="op" id="3885390">&gt;&gt;</span><span class="num" id="3885392">8</span><span class="op" id="3885393">)</span><span class="op" id="3885394">]</span>&nbsp;<span class="op" id="3885396">^</span>&nbsp;<span class="ident" id="3885398">td3</span><span class="op" id="3885401">[</span><span class="builtintype" id="3885402">uint8</span><span class="op" id="3885407">(</span><span class="ident" id="3885408">s0</span><span class="op" id="3885410">)</span><span class="op" id="3885411">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885415">k</span>&nbsp;<span class="op" id="3885417">+=</span>&nbsp;<span class="num" id="3885420">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885424">s0</span><span class="op" id="3885426">,</span>&nbsp;<span class="ident" id="3885428">s1</span><span class="op" id="3885430">,</span>&nbsp;<span class="ident" id="3885432">s2</span><span class="op" id="3885434">,</span>&nbsp;<span class="ident" id="3885436">s3</span>&nbsp;<span class="op" id="3885439">=</span>&nbsp;<span class="ident" id="3885441">t0</span><span class="op" id="3885443">,</span>&nbsp;<span class="ident" id="3885445">t1</span><span class="op" id="3885447">,</span>&nbsp;<span class="ident" id="3885449">t2</span><span class="op" id="3885451">,</span>&nbsp;<span class="ident" id="3885453">t3</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3885457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3885461">//&nbsp;Last&nbsp;round&nbsp;uses&nbsp;s-box&nbsp;directly&nbsp;and&nbsp;XORs&nbsp;to&nbsp;produce&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885524">s0</span>&nbsp;<span class="op" id="3885527">=</span>&nbsp;<span class="builtintype" id="3885529">uint32</span><span class="op" id="3885535">(</span><span class="ident" id="3885536">sbox1</span><span class="op" id="3885541">[</span><span class="ident" id="3885542">t0</span><span class="op" id="3885544">&gt;&gt;</span><span class="num" id="3885546">24</span><span class="op" id="3885548">]</span><span class="op" id="3885549">)</span><span class="op" id="3885550">&lt;&lt;</span><span class="num" id="3885552">24</span>&nbsp;<span class="op" id="3885555">|</span>&nbsp;<span class="builtintype" id="3885557">uint32</span><span class="op" id="3885563">(</span><span class="ident" id="3885564">sbox1</span><span class="op" id="3885569">[</span><span class="ident" id="3885570">t3</span><span class="op" id="3885572">&gt;&gt;</span><span class="num" id="3885574">16</span><span class="op" id="3885576">&amp;</span><span class="num" id="3885577">0xff</span><span class="op" id="3885581">]</span><span class="op" id="3885582">)</span><span class="op" id="3885583">&lt;&lt;</span><span class="num" id="3885585">16</span>&nbsp;<span class="op" id="3885588">|</span>&nbsp;<span class="builtintype" id="3885590">uint32</span><span class="op" id="3885596">(</span><span class="ident" id="3885597">sbox1</span><span class="op" id="3885602">[</span><span class="ident" id="3885603">t2</span><span class="op" id="3885605">&gt;&gt;</span><span class="num" id="3885607">8</span><span class="op" id="3885608">&amp;</span><span class="num" id="3885609">0xff</span><span class="op" id="3885613">]</span><span class="op" id="3885614">)</span><span class="op" id="3885615">&lt;&lt;</span><span class="num" id="3885617">8</span>&nbsp;<span class="op" id="3885619">|</span>&nbsp;<span class="builtintype" id="3885621">uint32</span><span class="op" id="3885627">(</span><span class="ident" id="3885628">sbox1</span><span class="op" id="3885633">[</span><span class="ident" id="3885634">t1</span><span class="op" id="3885636">&amp;</span><span class="num" id="3885637">0xff</span><span class="op" id="3885641">]</span><span class="op" id="3885642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885645">s1</span>&nbsp;<span class="op" id="3885648">=</span>&nbsp;<span class="builtintype" id="3885650">uint32</span><span class="op" id="3885656">(</span><span class="ident" id="3885657">sbox1</span><span class="op" id="3885662">[</span><span class="ident" id="3885663">t1</span><span class="op" id="3885665">&gt;&gt;</span><span class="num" id="3885667">24</span><span class="op" id="3885669">]</span><span class="op" id="3885670">)</span><span class="op" id="3885671">&lt;&lt;</span><span class="num" id="3885673">24</span>&nbsp;<span class="op" id="3885676">|</span>&nbsp;<span class="builtintype" id="3885678">uint32</span><span class="op" id="3885684">(</span><span class="ident" id="3885685">sbox1</span><span class="op" id="3885690">[</span><span class="ident" id="3885691">t0</span><span class="op" id="3885693">&gt;&gt;</span><span class="num" id="3885695">16</span><span class="op" id="3885697">&amp;</span><span class="num" id="3885698">0xff</span><span class="op" id="3885702">]</span><span class="op" id="3885703">)</span><span class="op" id="3885704">&lt;&lt;</span><span class="num" id="3885706">16</span>&nbsp;<span class="op" id="3885709">|</span>&nbsp;<span class="builtintype" id="3885711">uint32</span><span class="op" id="3885717">(</span><span class="ident" id="3885718">sbox1</span><span class="op" id="3885723">[</span><span class="ident" id="3885724">t3</span><span class="op" id="3885726">&gt;&gt;</span><span class="num" id="3885728">8</span><span class="op" id="3885729">&amp;</span><span class="num" id="3885730">0xff</span><span class="op" id="3885734">]</span><span class="op" id="3885735">)</span><span class="op" id="3885736">&lt;&lt;</span><span class="num" id="3885738">8</span>&nbsp;<span class="op" id="3885740">|</span>&nbsp;<span class="builtintype" id="3885742">uint32</span><span class="op" id="3885748">(</span><span class="ident" id="3885749">sbox1</span><span class="op" id="3885754">[</span><span class="ident" id="3885755">t2</span><span class="op" id="3885757">&amp;</span><span class="num" id="3885758">0xff</span><span class="op" id="3885762">]</span><span class="op" id="3885763">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885766">s2</span>&nbsp;<span class="op" id="3885769">=</span>&nbsp;<span class="builtintype" id="3885771">uint32</span><span class="op" id="3885777">(</span><span class="ident" id="3885778">sbox1</span><span class="op" id="3885783">[</span><span class="ident" id="3885784">t2</span><span class="op" id="3885786">&gt;&gt;</span><span class="num" id="3885788">24</span><span class="op" id="3885790">]</span><span class="op" id="3885791">)</span><span class="op" id="3885792">&lt;&lt;</span><span class="num" id="3885794">24</span>&nbsp;<span class="op" id="3885797">|</span>&nbsp;<span class="builtintype" id="3885799">uint32</span><span class="op" id="3885805">(</span><span class="ident" id="3885806">sbox1</span><span class="op" id="3885811">[</span><span class="ident" id="3885812">t1</span><span class="op" id="3885814">&gt;&gt;</span><span class="num" id="3885816">16</span><span class="op" id="3885818">&amp;</span><span class="num" id="3885819">0xff</span><span class="op" id="3885823">]</span><span class="op" id="3885824">)</span><span class="op" id="3885825">&lt;&lt;</span><span class="num" id="3885827">16</span>&nbsp;<span class="op" id="3885830">|</span>&nbsp;<span class="builtintype" id="3885832">uint32</span><span class="op" id="3885838">(</span><span class="ident" id="3885839">sbox1</span><span class="op" id="3885844">[</span><span class="ident" id="3885845">t0</span><span class="op" id="3885847">&gt;&gt;</span><span class="num" id="3885849">8</span><span class="op" id="3885850">&amp;</span><span class="num" id="3885851">0xff</span><span class="op" id="3885855">]</span><span class="op" id="3885856">)</span><span class="op" id="3885857">&lt;&lt;</span><span class="num" id="3885859">8</span>&nbsp;<span class="op" id="3885861">|</span>&nbsp;<span class="builtintype" id="3885863">uint32</span><span class="op" id="3885869">(</span><span class="ident" id="3885870">sbox1</span><span class="op" id="3885875">[</span><span class="ident" id="3885876">t3</span><span class="op" id="3885878">&amp;</span><span class="num" id="3885879">0xff</span><span class="op" id="3885883">]</span><span class="op" id="3885884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3885887">s3</span>&nbsp;<span class="op" id="3885890">=</span>&nbsp;<span class="builtintype" id="3885892">uint32</span><span class="op" id="3885898">(</span><span class="ident" id="3885899">sbox1</span><span class="op" id="3885904">[</span><span class="ident" id="3885905">t3</span><span class="op" id="3885907">&gt;&gt;</span><span class="num" id="3885909">24</span><span class="op" id="3885911">]</span><span class="op" id="3885912">)</span><span class="op" id="3885913">&lt;&lt;</span><span class="num" id="3885915">24</span>&nbsp;<span class="op" id="3885918">|</span>&nbsp;<span class="builtintype" id="3885920">uint32</span><span class="op" id="3885926">(</span><span class="ident" id="3885927">sbox1</span><span class="op" id="3885932">[</span><span class="ident" id="3885933">t2</span><span class="op" id="3885935">&gt;&gt;</span><span class="num" id="3885937">16</span><span class="op" id="3885939">&amp;</span><span class="num" id="3885940">0xff</span><span class="op" id="3885944">]</span><span class="op" id="3885945">)</span><span class="op" id="3885946">&lt;&lt;</span><span class="num" id="3885948">16</span>&nbsp;<span class="op" id="3885951">|</span>&nbsp;<span class="builtintype" id="3885953">uint32</span><span class="op" id="3885959">(</span><span class="ident" id="3885960">sbox1</span><span class="op" id="3885965">[</span><span class="ident" id="3885966">t1</span><span class="op" id="3885968">&gt;&gt;</span><span class="num" id="3885970">8</span><span class="op" id="3885971">&amp;</span><span class="num" id="3885972">0xff</span><span class="op" id="3885976">]</span><span class="op" id="3885977">)</span><span class="op" id="3885978">&lt;&lt;</span><span class="num" id="3885980">8</span>&nbsp;<span class="op" id="3885982">|</span>&nbsp;<span class="builtintype" id="3885984">uint32</span><span class="op" id="3885990">(</span><span class="ident" id="3885991">sbox1</span><span class="op" id="3885996">[</span><span class="ident" id="3885997">t0</span><span class="op" id="3885999">&amp;</span><span class="num" id="3886000">0xff</span><span class="op" id="3886004">]</span><span class="op" id="3886005">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3886009">s0</span>&nbsp;<span class="op" id="3886012">^=</span>&nbsp;<span class="ident" id="3886015">xk</span><span class="op" id="3886017">[</span><span class="ident" id="3886018">k</span><span class="op" id="3886019">+</span><span class="num" id="3886020">0</span><span class="op" id="3886021">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3886024">s1</span>&nbsp;<span class="op" id="3886027">^=</span>&nbsp;<span class="ident" id="3886030">xk</span><span class="op" id="3886032">[</span><span class="ident" id="3886033">k</span><span class="op" id="3886034">+</span><span class="num" id="3886035">1</span><span class="op" id="3886036">]</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3886039">s2</span>&nbsp;<span class="op" id="3886042">^=</span>&nbsp;<span class="ident" id="3886045">xk</span><span class="op" id="3886047">[</span><span class="ident" id="3886048">k</span><span class="op" id="3886049">+</span><span class="num" id="3886050">2</span><span class="op" id="3886051">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3886054">s3</span>&nbsp;<span class="op" id="3886057">^=</span>&nbsp;<span class="ident" id="3886060">xk</span><span class="op" id="3886062">[</span><span class="ident" id="3886063">k</span><span class="op" id="3886064">+</span><span class="num" id="3886065">3</span><span class="op" id="3886066">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3886070">dst</span><span class="op" id="3886073">[</span><span class="num" id="3886074">0</span><span class="op" id="3886075">]</span><span class="op" id="3886076">,</span>&nbsp;<span class="ident" id="3886078">dst</span><span class="op" id="3886081">[</span><span class="num" id="3886082">1</span><span class="op" id="3886083">]</span><span class="op" id="3886084">,</span>&nbsp;<span class="ident" id="3886086">dst</span><span class="op" id="3886089">[</span><span class="num" id="3886090">2</span><span class="op" id="3886091">]</span><span class="op" id="3886092">,</span>&nbsp;<span class="ident" id="3886094">dst</span><span class="op" id="3886097">[</span><span class="num" id="3886098">3</span><span class="op" id="3886099">]</span>&nbsp;<span class="op" id="3886101">=</span>&nbsp;<span class="builtintype" id="3886103">byte</span><span class="op" id="3886107">(</span><span class="ident" id="3886108">s0</span><span class="op" id="3886110">&gt;&gt;</span><span class="num" id="3886112">24</span><span class="op" id="3886114">)</span><span class="op" id="3886115">,</span>&nbsp;<span class="builtintype" id="3886117">byte</span><span class="op" id="3886121">(</span><span class="ident" id="3886122">s0</span><span class="op" id="3886124">&gt;&gt;</span><span class="num" id="3886126">16</span><span class="op" id="3886128">)</span><span class="op" id="3886129">,</span>&nbsp;<span class="builtintype" id="3886131">byte</span><span class="op" id="3886135">(</span><span class="ident" id="3886136">s0</span><span class="op" id="3886138">&gt;&gt;</span><span class="num" id="3886140">8</span><span class="op" id="3886141">)</span><span class="op" id="3886142">,</span>&nbsp;<span class="builtintype" id="3886144">byte</span><span class="op" id="3886148">(</span><span class="ident" id="3886149">s0</span><span class="op" id="3886151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3886154">dst</span><span class="op" id="3886157">[</span><span class="num" id="3886158">4</span><span class="op" id="3886159">]</span><span class="op" id="3886160">,</span>&nbsp;<span class="ident" id="3886162">dst</span><span class="op" id="3886165">[</span><span class="num" id="3886166">5</span><span class="op" id="3886167">]</span><span class="op" id="3886168">,</span>&nbsp;<span class="ident" id="3886170">dst</span><span class="op" id="3886173">[</span><span class="num" id="3886174">6</span><span class="op" id="3886175">]</span><span class="op" id="3886176">,</span>&nbsp;<span class="ident" id="3886178">dst</span><span class="op" id="3886181">[</span><span class="num" id="3886182">7</span><span class="op" id="3886183">]</span>&nbsp;<span class="op" id="3886185">=</span>&nbsp;<span class="builtintype" id="3886187">byte</span><span class="op" id="3886191">(</span><span class="ident" id="3886192">s1</span><span class="op" id="3886194">&gt;&gt;</span><span class="num" id="3886196">24</span><span class="op" id="3886198">)</span><span class="op" id="3886199">,</span>&nbsp;<span class="builtintype" id="3886201">byte</span><span class="op" id="3886205">(</span><span class="ident" id="3886206">s1</span><span class="op" id="3886208">&gt;&gt;</span><span class="num" id="3886210">16</span><span class="op" id="3886212">)</span><span class="op" id="3886213">,</span>&nbsp;<span class="builtintype" id="3886215">byte</span><span class="op" id="3886219">(</span><span class="ident" id="3886220">s1</span><span class="op" id="3886222">&gt;&gt;</span><span class="num" id="3886224">8</span><span class="op" id="3886225">)</span><span class="op" id="3886226">,</span>&nbsp;<span class="builtintype" id="3886228">byte</span><span class="op" id="3886232">(</span><span class="ident" id="3886233">s1</span><span class="op" id="3886235">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3886238">dst</span><span class="op" id="3886241">[</span><span class="num" id="3886242">8</span><span class="op" id="3886243">]</span><span class="op" id="3886244">,</span>&nbsp;<span class="ident" id="3886246">dst</span><span class="op" id="3886249">[</span><span class="num" id="3886250">9</span><span class="op" id="3886251">]</span><span class="op" id="3886252">,</span>&nbsp;<span class="ident" id="3886254">dst</span><span class="op" id="3886257">[</span><span class="num" id="3886258">10</span><span class="op" id="3886260">]</span><span class="op" id="3886261">,</span>&nbsp;<span class="ident" id="3886263">dst</span><span class="op" id="3886266">[</span><span class="num" id="3886267">11</span><span class="op" id="3886269">]</span>&nbsp;<span class="op" id="3886271">=</span>&nbsp;<span class="builtintype" id="3886273">byte</span><span class="op" id="3886277">(</span><span class="ident" id="3886278">s2</span><span class="op" id="3886280">&gt;&gt;</span><span class="num" id="3886282">24</span><span class="op" id="3886284">)</span><span class="op" id="3886285">,</span>&nbsp;<span class="builtintype" id="3886287">byte</span><span class="op" id="3886291">(</span><span class="ident" id="3886292">s2</span><span class="op" id="3886294">&gt;&gt;</span><span class="num" id="3886296">16</span><span class="op" id="3886298">)</span><span class="op" id="3886299">,</span>&nbsp;<span class="builtintype" id="3886301">byte</span><span class="op" id="3886305">(</span><span class="ident" id="3886306">s2</span><span class="op" id="3886308">&gt;&gt;</span><span class="num" id="3886310">8</span><span class="op" id="3886311">)</span><span class="op" id="3886312">,</span>&nbsp;<span class="builtintype" id="3886314">byte</span><span class="op" id="3886318">(</span><span class="ident" id="3886319">s2</span><span class="op" id="3886321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3886324">dst</span><span class="op" id="3886327">[</span><span class="num" id="3886328">12</span><span class="op" id="3886330">]</span><span class="op" id="3886331">,</span>&nbsp;<span class="ident" id="3886333">dst</span><span class="op" id="3886336">[</span><span class="num" id="3886337">13</span><span class="op" id="3886339">]</span><span class="op" id="3886340">,</span>&nbsp;<span class="ident" id="3886342">dst</span><span class="op" id="3886345">[</span><span class="num" id="3886346">14</span><span class="op" id="3886348">]</span><span class="op" id="3886349">,</span>&nbsp;<span class="ident" id="3886351">dst</span><span class="op" id="3886354">[</span><span class="num" id="3886355">15</span><span class="op" id="3886357">]</span>&nbsp;<span class="op" id="3886359">=</span>&nbsp;<span class="builtintype" id="3886361">byte</span><span class="op" id="3886365">(</span><span class="ident" id="3886366">s3</span><span class="op" id="3886368">&gt;&gt;</span><span class="num" id="3886370">24</span><span class="op" id="3886372">)</span><span class="op" id="3886373">,</span>&nbsp;<span class="builtintype" id="3886375">byte</span><span class="op" id="3886379">(</span><span class="ident" id="3886380">s3</span><span class="op" id="3886382">&gt;&gt;</span><span class="num" id="3886384">16</span><span class="op" id="3886386">)</span><span class="op" id="3886387">,</span>&nbsp;<span class="builtintype" id="3886389">byte</span><span class="op" id="3886393">(</span><span class="ident" id="3886394">s3</span><span class="op" id="3886396">&gt;&gt;</span><span class="num" id="3886398">8</span><span class="op" id="3886399">)</span><span class="op" id="3886400">,</span>&nbsp;<span class="builtintype" id="3886402">byte</span><span class="op" id="3886406">(</span><span class="ident" id="3886407">s3</span><span class="op" id="3886409">)</span><br>
<span class="lineno"></span><span class="op" id="3886411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3886414">//&nbsp;Apply&nbsp;sbox0&nbsp;to&nbsp;each&nbsp;byte&nbsp;in&nbsp;w.</span><br>
<span class="lineno">130</span><span class="keyword" id="3886448">func</span>&nbsp;<span class="ident" id="3886453">subw</span><span class="op" id="3886457">(</span><span class="ident" id="3886458">w</span>&nbsp;<span class="builtintype" id="3886460">uint32</span><span class="op" id="3886466">)</span>&nbsp;<span class="builtintype" id="3886468">uint32</span>&nbsp;<span class="op" id="3886475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3886478">return</span>&nbsp;<span class="builtintype" id="3886485">uint32</span><span class="op" id="3886491">(</span><span class="ident" id="3886492">sbox0</span><span class="op" id="3886497">[</span><span class="ident" id="3886498">w</span><span class="op" id="3886499">&gt;&gt;</span><span class="num" id="3886501">24</span><span class="op" id="3886503">]</span><span class="op" id="3886504">)</span><span class="op" id="3886505">&lt;&lt;</span><span class="num" id="3886507">24</span>&nbsp;<span class="op" id="3886510">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3886514">uint32</span><span class="op" id="3886520">(</span><span class="ident" id="3886521">sbox0</span><span class="op" id="3886526">[</span><span class="ident" id="3886527">w</span><span class="op" id="3886528">&gt;&gt;</span><span class="num" id="3886530">16</span><span class="op" id="3886532">&amp;</span><span class="num" id="3886533">0xff</span><span class="op" id="3886537">]</span><span class="op" id="3886538">)</span><span class="op" id="3886539">&lt;&lt;</span><span class="num" id="3886541">16</span>&nbsp;<span class="op" id="3886544">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3886548">uint32</span><span class="op" id="3886554">(</span><span class="ident" id="3886555">sbox0</span><span class="op" id="3886560">[</span><span class="ident" id="3886561">w</span><span class="op" id="3886562">&gt;&gt;</span><span class="num" id="3886564">8</span><span class="op" id="3886565">&amp;</span><span class="num" id="3886566">0xff</span><span class="op" id="3886570">]</span><span class="op" id="3886571">)</span><span class="op" id="3886572">&lt;&lt;</span><span class="num" id="3886574">8</span>&nbsp;<span class="op" id="3886576">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3886580">uint32</span><span class="op" id="3886586">(</span><span class="ident" id="3886587">sbox0</span><span class="op" id="3886592">[</span><span class="ident" id="3886593">w</span><span class="op" id="3886594">&amp;</span><span class="num" id="3886595">0xff</span><span class="op" id="3886599">]</span><span class="op" id="3886600">)</span><br>
<span class="lineno">135</span><span class="op" id="3886602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3886605">//&nbsp;Rotate</span><br>
<span class="lineno"></span><span class="keyword" id="3886615">func</span>&nbsp;<span class="ident" id="3886620">rotw</span><span class="op" id="3886624">(</span><span class="ident" id="3886625">w</span>&nbsp;<span class="builtintype" id="3886627">uint32</span><span class="op" id="3886633">)</span>&nbsp;<span class="builtintype" id="3886635">uint32</span>&nbsp;<span class="op" id="3886642">{</span>&nbsp;<span class="keyword" id="3886644">return</span>&nbsp;<span class="ident" id="3886651">w</span><span class="op" id="3886652">&lt;&lt;</span><span class="num" id="3886654">8</span>&nbsp;<span class="op" id="3886656">|</span>&nbsp;<span class="ident" id="3886658">w</span><span class="op" id="3886659">&gt;&gt;</span><span class="num" id="3886661">24</span>&nbsp;<span class="op" id="3886664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="3886667">//&nbsp;Key&nbsp;expansion&nbsp;algorithm.&nbsp;&nbsp;See&nbsp;FIPS-197,&nbsp;Figure&nbsp;11.</span><br>
<span class="lineno"></span><span class="comment" id="3886721">//&nbsp;Their&nbsp;rcon[i]&nbsp;is&nbsp;our&nbsp;powx[i-1]&nbsp;&lt;&lt;&nbsp;24.</span><br>
<span class="lineno"></span><span class="keyword" id="3886762">func</span>&nbsp;<span class="ident" id="3886767">expandKeyGo</span><span class="op" id="3886778">(</span><span class="ident" id="3886779">key</span>&nbsp;<span class="op" id="3886783">[</span><span class="op" id="3886784">]</span><span class="builtintype" id="3886785">byte</span><span class="op" id="3886789">,</span>&nbsp;<span class="ident" id="3886791">enc</span><span class="op" id="3886794">,</span>&nbsp;<span class="ident" id="3886796">dec</span>&nbsp;<span class="op" id="3886800">[</span><span class="op" id="3886801">]</span><span class="builtintype" id="3886802">uint32</span><span class="op" id="3886808">)</span>&nbsp;<span class="op" id="3886810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3886813">//&nbsp;Encryption&nbsp;key&nbsp;setup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3886839">var</span>&nbsp;<span class="ident" id="3886843">i</span>&nbsp;<span class="builtintype" id="3886845">int</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3886850">nk</span>&nbsp;<span class="op" id="3886853">:=</span>&nbsp;<span class="builtinfunc" id="3886856">len</span><span class="op" id="3886859">(</span><span class="ident" id="3886860">key</span><span class="op" id="3886863">)</span>&nbsp;<span class="op" id="3886865">/</span>&nbsp;<span class="num" id="3886867">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3886870">for</span>&nbsp;<span class="ident" id="3886874">i</span>&nbsp;<span class="op" id="3886876">=</span>&nbsp;<span class="num" id="3886878">0</span><span class="op" id="3886879">;</span>&nbsp;<span class="ident" id="3886881">i</span>&nbsp;<span class="op" id="3886883">&lt;</span>&nbsp;<span class="ident" id="3886885">nk</span><span class="op" id="3886887">;</span>&nbsp;<span class="ident" id="3886889">i</span><span class="op" id="3886890">++</span>&nbsp;<span class="op" id="3886893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3886897">enc</span><span class="op" id="3886900">[</span><span class="ident" id="3886901">i</span><span class="op" id="3886902">]</span>&nbsp;<span class="op" id="3886904">=</span>&nbsp;<span class="builtintype" id="3886906">uint32</span><span class="op" id="3886912">(</span><span class="ident" id="3886913">key</span><span class="op" id="3886916">[</span><span class="num" id="3886917">4</span><span class="op" id="3886918">*</span><span class="ident" id="3886919">i</span><span class="op" id="3886920">]</span><span class="op" id="3886921">)</span><span class="op" id="3886922">&lt;&lt;</span><span class="num" id="3886924">24</span>&nbsp;<span class="op" id="3886927">|</span>&nbsp;<span class="builtintype" id="3886929">uint32</span><span class="op" id="3886935">(</span><span class="ident" id="3886936">key</span><span class="op" id="3886939">[</span><span class="num" id="3886940">4</span><span class="op" id="3886941">*</span><span class="ident" id="3886942">i</span><span class="op" id="3886943">+</span><span class="num" id="3886944">1</span><span class="op" id="3886945">]</span><span class="op" id="3886946">)</span><span class="op" id="3886947">&lt;&lt;</span><span class="num" id="3886949">16</span>&nbsp;<span class="op" id="3886952">|</span>&nbsp;<span class="builtintype" id="3886954">uint32</span><span class="op" id="3886960">(</span><span class="ident" id="3886961">key</span><span class="op" id="3886964">[</span><span class="num" id="3886965">4</span><span class="op" id="3886966">*</span><span class="ident" id="3886967">i</span><span class="op" id="3886968">+</span><span class="num" id="3886969">2</span><span class="op" id="3886970">]</span><span class="op" id="3886971">)</span><span class="op" id="3886972">&lt;&lt;</span><span class="num" id="3886974">8</span>&nbsp;<span class="op" id="3886976">|</span>&nbsp;<span class="builtintype" id="3886978">uint32</span><span class="op" id="3886984">(</span><span class="ident" id="3886985">key</span><span class="op" id="3886988">[</span><span class="num" id="3886989">4</span><span class="op" id="3886990">*</span><span class="ident" id="3886991">i</span><span class="op" id="3886992">+</span><span class="num" id="3886993">3</span><span class="op" id="3886994">]</span><span class="op" id="3886995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3886998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3887001">for</span>&nbsp;<span class="op" id="3887005">;</span>&nbsp;<span class="ident" id="3887007">i</span>&nbsp;<span class="op" id="3887009">&lt;</span>&nbsp;<span class="builtinfunc" id="3887011">len</span><span class="op" id="3887014">(</span><span class="ident" id="3887015">enc</span><span class="op" id="3887018">)</span><span class="op" id="3887019">;</span>&nbsp;<span class="ident" id="3887021">i</span><span class="op" id="3887022">++</span>&nbsp;<span class="op" id="3887025">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3887029">t</span>&nbsp;<span class="op" id="3887031">:=</span>&nbsp;<span class="ident" id="3887034">enc</span><span class="op" id="3887037">[</span><span class="ident" id="3887038">i</span><span class="op" id="3887039">-</span><span class="num" id="3887040">1</span><span class="op" id="3887041">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3887045">if</span>&nbsp;<span class="ident" id="3887048">i</span><span class="op" id="3887049">%</span><span class="ident" id="3887050">nk</span>&nbsp;<span class="op" id="3887053">==</span>&nbsp;<span class="num" id="3887056">0</span>&nbsp;<span class="op" id="3887058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3887063">t</span>&nbsp;<span class="op" id="3887065">=</span>&nbsp;<span class="ident" id="3887067">subw</span><span class="op" id="3887071">(</span><span class="ident" id="3887072">rotw</span><span class="op" id="3887076">(</span><span class="ident" id="3887077">t</span><span class="op" id="3887078">)</span><span class="op" id="3887079">)</span>&nbsp;<span class="op" id="3887081">^</span>&nbsp;<span class="op" id="3887083">(</span><span class="builtintype" id="3887084">uint32</span><span class="op" id="3887090">(</span><span class="ident" id="3887091">powx</span><span class="op" id="3887095">[</span><span class="ident" id="3887096">i</span><span class="op" id="3887097">/</span><span class="ident" id="3887098">nk</span><span class="op" id="3887100">-</span><span class="num" id="3887101">1</span><span class="op" id="3887102">]</span><span class="op" id="3887103">)</span>&nbsp;<span class="op" id="3887105">&lt;&lt;</span>&nbsp;<span class="num" id="3887108">24</span><span class="op" id="3887110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3887114">}</span>&nbsp;<span class="keyword" id="3887116">else</span>&nbsp;<span class="keyword" id="3887121">if</span>&nbsp;<span class="ident" id="3887124">nk</span>&nbsp;<span class="op" id="3887127">&gt;</span>&nbsp;<span class="num" id="3887129">6</span>&nbsp;<span class="op" id="3887131">&amp;&amp;</span>&nbsp;<span class="ident" id="3887134">i</span><span class="op" id="3887135">%</span><span class="ident" id="3887136">nk</span>&nbsp;<span class="op" id="3887139">==</span>&nbsp;<span class="num" id="3887142">4</span>&nbsp;<span class="op" id="3887144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3887149">t</span>&nbsp;<span class="op" id="3887151">=</span>&nbsp;<span class="ident" id="3887153">subw</span><span class="op" id="3887157">(</span><span class="ident" id="3887158">t</span><span class="op" id="3887159">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3887163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3887167">enc</span><span class="op" id="3887170">[</span><span class="ident" id="3887171">i</span><span class="op" id="3887172">]</span>&nbsp;<span class="op" id="3887174">=</span>&nbsp;<span class="ident" id="3887176">enc</span><span class="op" id="3887179">[</span><span class="ident" id="3887180">i</span><span class="op" id="3887181">-</span><span class="ident" id="3887182">nk</span><span class="op" id="3887184">]</span>&nbsp;<span class="op" id="3887186">^</span>&nbsp;<span class="ident" id="3887188">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3887191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3887195">//&nbsp;Derive&nbsp;decryption&nbsp;key&nbsp;from&nbsp;encryption&nbsp;key.</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3887242">//&nbsp;Reverse&nbsp;the&nbsp;4-word&nbsp;round&nbsp;key&nbsp;sets&nbsp;from&nbsp;enc&nbsp;to&nbsp;produce&nbsp;dec.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3887305">//&nbsp;All&nbsp;sets&nbsp;but&nbsp;the&nbsp;first&nbsp;and&nbsp;last&nbsp;get&nbsp;the&nbsp;MixColumn&nbsp;transform&nbsp;applied.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3887378">if</span>&nbsp;<span class="ident" id="3887381">dec</span>&nbsp;<span class="op" id="3887385">==</span>&nbsp;<span class="ident" id="3887388">nil</span>&nbsp;<span class="op" id="3887392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3887396">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3887404">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3887407">n</span>&nbsp;<span class="op" id="3887409">:=</span>&nbsp;<span class="builtinfunc" id="3887412">len</span><span class="op" id="3887415">(</span><span class="ident" id="3887416">enc</span><span class="op" id="3887419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3887422">for</span>&nbsp;<span class="ident" id="3887426">i</span>&nbsp;<span class="op" id="3887428">:=</span>&nbsp;<span class="num" id="3887431">0</span><span class="op" id="3887432">;</span>&nbsp;<span class="ident" id="3887434">i</span>&nbsp;<span class="op" id="3887436">&lt;</span>&nbsp;<span class="ident" id="3887438">n</span><span class="op" id="3887439">;</span>&nbsp;<span class="ident" id="3887441">i</span>&nbsp;<span class="op" id="3887443">+=</span>&nbsp;<span class="num" id="3887446">4</span>&nbsp;<span class="op" id="3887448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3887452">ei</span>&nbsp;<span class="op" id="3887455">:=</span>&nbsp;<span class="ident" id="3887458">n</span>&nbsp;<span class="op" id="3887460">-</span>&nbsp;<span class="ident" id="3887462">i</span>&nbsp;<span class="op" id="3887464">-</span>&nbsp;<span class="num" id="3887466">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3887470">for</span>&nbsp;<span class="ident" id="3887474">j</span>&nbsp;<span class="op" id="3887476">:=</span>&nbsp;<span class="num" id="3887479">0</span><span class="op" id="3887480">;</span>&nbsp;<span class="ident" id="3887482">j</span>&nbsp;<span class="op" id="3887484">&lt;</span>&nbsp;<span class="num" id="3887486">4</span><span class="op" id="3887487">;</span>&nbsp;<span class="ident" id="3887489">j</span><span class="op" id="3887490">++</span>&nbsp;<span class="op" id="3887493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3887498">x</span>&nbsp;<span class="op" id="3887500">:=</span>&nbsp;<span class="ident" id="3887503">enc</span><span class="op" id="3887506">[</span><span class="ident" id="3887507">ei</span><span class="op" id="3887509">+</span><span class="ident" id="3887510">j</span><span class="op" id="3887511">]</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3887516">if</span>&nbsp;<span class="ident" id="3887519">i</span>&nbsp;<span class="op" id="3887521">&gt;</span>&nbsp;<span class="num" id="3887523">0</span>&nbsp;<span class="op" id="3887525">&amp;&amp;</span>&nbsp;<span class="ident" id="3887528">i</span><span class="op" id="3887529">+</span><span class="num" id="3887530">4</span>&nbsp;<span class="op" id="3887532">&lt;</span>&nbsp;<span class="ident" id="3887534">n</span>&nbsp;<span class="op" id="3887536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3887542">x</span>&nbsp;<span class="op" id="3887544">=</span>&nbsp;<span class="ident" id="3887546">td0</span><span class="op" id="3887549">[</span><span class="ident" id="3887550">sbox0</span><span class="op" id="3887555">[</span><span class="ident" id="3887556">x</span><span class="op" id="3887557">&gt;&gt;</span><span class="num" id="3887559">24</span><span class="op" id="3887561">]</span><span class="op" id="3887562">]</span>&nbsp;<span class="op" id="3887564">^</span>&nbsp;<span class="ident" id="3887566">td1</span><span class="op" id="3887569">[</span><span class="ident" id="3887570">sbox0</span><span class="op" id="3887575">[</span><span class="ident" id="3887576">x</span><span class="op" id="3887577">&gt;&gt;</span><span class="num" id="3887579">16</span><span class="op" id="3887581">&amp;</span><span class="num" id="3887582">0xff</span><span class="op" id="3887586">]</span><span class="op" id="3887587">]</span>&nbsp;<span class="op" id="3887589">^</span>&nbsp;<span class="ident" id="3887591">td2</span><span class="op" id="3887594">[</span><span class="ident" id="3887595">sbox0</span><span class="op" id="3887600">[</span><span class="ident" id="3887601">x</span><span class="op" id="3887602">&gt;&gt;</span><span class="num" id="3887604">8</span><span class="op" id="3887605">&amp;</span><span class="num" id="3887606">0xff</span><span class="op" id="3887610">]</span><span class="op" id="3887611">]</span>&nbsp;<span class="op" id="3887613">^</span>&nbsp;<span class="ident" id="3887615">td3</span><span class="op" id="3887618">[</span><span class="ident" id="3887619">sbox0</span><span class="op" id="3887624">[</span><span class="ident" id="3887625">x</span><span class="op" id="3887626">&amp;</span><span class="num" id="3887627">0xff</span><span class="op" id="3887631">]</span><span class="op" id="3887632">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3887637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3887642">dec</span><span class="op" id="3887645">[</span><span class="ident" id="3887646">i</span><span class="op" id="3887647">+</span><span class="ident" id="3887648">j</span><span class="op" id="3887649">]</span>&nbsp;<span class="op" id="3887651">=</span>&nbsp;<span class="ident" id="3887653">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3887657">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3887660">}</span><br>
<span class="lineno"></span><span class="op" id="3887662">}</span>
</div>
</body>
</html>
