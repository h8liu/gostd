<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/ast</h2>
<ul>
<li><a href="/gostd/go/ast/ast.go.html">ast.go</a></li>
<li><a href="/gostd/go/ast/ast_test.go.html">ast_test.go</a></li>
<li><a href="/gostd/go/ast/commentmap.go.html">commentmap.go</a></li>
<li><a href="/gostd/go/ast/commentmap_test.go.html">commentmap_test.go</a></li>
<li><a href="/gostd/go/ast/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/ast/filter.go.html" class="current">filter.go</a></li>
<li><a href="/gostd/go/ast/filter_test.go.html">filter_test.go</a></li>
<li><a href="/gostd/go/ast/import.go.html">import.go</a></li>
<li><a href="/gostd/go/ast/print.go.html">print.go</a></li>
<li><a href="/gostd/go/ast/print_test.go.html">print_test.go</a></li>
<li><a href="/gostd/go/ast/resolve.go.html">resolve.go</a></li>
<li><a href="/gostd/go/ast/scope.go.html">scope.go</a></li>
<li><a href="/gostd/go/ast/walk.go.html">walk.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4934171">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4934226">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4934280">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4934331">package</span>&nbsp;<span class="ident" id="4934339">ast</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4934344">import</span>&nbsp;<span class="op" id="4934351">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4934354">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4934366">&#34;sort&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4934373">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4934376">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4934456">//&nbsp;Export&nbsp;filtering</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="4934477">//&nbsp;exportFilter&nbsp;is&nbsp;a&nbsp;special&nbsp;filter&nbsp;function&nbsp;to&nbsp;extract&nbsp;exported&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="4934549">func</span>&nbsp;<span class="ident" id="4934554">exportFilter</span><span class="op" id="4934566">(</span><span class="ident" id="4934567">name</span>&nbsp;<span class="builtintype" id="4934572">string</span><span class="op" id="4934578">)</span>&nbsp;<span class="builtintype" id="4934580">bool</span>&nbsp;<span class="op" id="4934585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4934588">return</span>&nbsp;<span class="ident" id="4934595">IsExported</span><span class="op" id="4934605">(</span><span class="ident" id="4934606">name</span><span class="op" id="4934610">)</span><br>
<span class="lineno"></span><span class="op" id="4934612">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="4934615">//&nbsp;FileExports&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;in&nbsp;place&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4934684">//&nbsp;only&nbsp;exported&nbsp;nodes&nbsp;remain:&nbsp;all&nbsp;top-level&nbsp;identifiers&nbsp;which&nbsp;are&nbsp;not&nbsp;exported</span><br>
<span class="lineno"></span><span class="comment" id="4934764">//&nbsp;and&nbsp;their&nbsp;associated&nbsp;information&nbsp;(such&nbsp;as&nbsp;type,&nbsp;initial&nbsp;value,&nbsp;or&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="4934842">//&nbsp;body)&nbsp;are&nbsp;removed.&nbsp;Non-exported&nbsp;fields&nbsp;and&nbsp;methods&nbsp;of&nbsp;exported&nbsp;types&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4934918">//&nbsp;stripped.&nbsp;The&nbsp;File.Comments&nbsp;list&nbsp;is&nbsp;not&nbsp;changed.</span><br>
<span class="lineno">25</span><span class="comment" id="4934970">//</span><br>
<span class="lineno"></span><span class="comment" id="4934973">//&nbsp;FileExports&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;exported&nbsp;declarations;</span><br>
<span class="lineno"></span><span class="comment" id="4935037">//&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="4935068">//</span><br>
<span class="lineno"></span><span class="keyword" id="4935071">func</span>&nbsp;<span class="ident" id="4935076">FileExports</span><span class="op" id="4935087">(</span><span class="ident" id="4935088">src</span>&nbsp;<span class="op" id="4935092">*</span><span class="ident" id="4935093">File</span><span class="op" id="4935097">)</span>&nbsp;<span class="builtintype" id="4935099">bool</span>&nbsp;<span class="op" id="4935104">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4935107">return</span>&nbsp;<span class="ident" id="4935114">filterFile</span><span class="op" id="4935124">(</span><span class="ident" id="4935125">src</span><span class="op" id="4935128">,</span>&nbsp;<span class="ident" id="4935130">exportFilter</span><span class="op" id="4935142">,</span>&nbsp;<span class="builtintype" id="4935144">true</span><span class="op" id="4935148">)</span><br>
<span class="lineno"></span><span class="op" id="4935150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4935153">//&nbsp;PackageExports&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;package&nbsp;in&nbsp;place&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4935221">//&nbsp;only&nbsp;exported&nbsp;nodes&nbsp;remain.&nbsp;The&nbsp;pkg.Files&nbsp;list&nbsp;is&nbsp;not&nbsp;changed,&nbsp;so&nbsp;that</span><br>
<span class="lineno">35</span><span class="comment" id="4935295">//&nbsp;file&nbsp;names&nbsp;and&nbsp;top-level&nbsp;package&nbsp;comments&nbsp;don&#39;t&nbsp;get&nbsp;lost.</span><br>
<span class="lineno"></span><span class="comment" id="4935356">//</span><br>
<span class="lineno"></span><span class="comment" id="4935359">//&nbsp;PackageExports&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;exported&nbsp;declarations;</span><br>
<span class="lineno"></span><span class="comment" id="4935426">//&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="4935457">//</span><br>
<span class="lineno">40</span><span class="keyword" id="4935460">func</span>&nbsp;<span class="ident" id="4935465">PackageExports</span><span class="op" id="4935479">(</span><span class="ident" id="4935480">pkg</span>&nbsp;<span class="op" id="4935484">*</span><span class="ident" id="4935485">Package</span><span class="op" id="4935492">)</span>&nbsp;<span class="builtintype" id="4935494">bool</span>&nbsp;<span class="op" id="4935499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4935502">return</span>&nbsp;<span class="ident" id="4935509">filterPackage</span><span class="op" id="4935522">(</span><span class="ident" id="4935523">pkg</span><span class="op" id="4935526">,</span>&nbsp;<span class="ident" id="4935528">exportFilter</span><span class="op" id="4935540">,</span>&nbsp;<span class="builtintype" id="4935542">true</span><span class="op" id="4935546">)</span><br>
<span class="lineno"></span><span class="op" id="4935548">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4935551">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">45</span><span class="comment" id="4935631">//&nbsp;General&nbsp;filtering</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4935653">type</span>&nbsp;<span class="ident" id="4935658">Filter</span>&nbsp;<span class="keyword" id="4935665">func</span><span class="op" id="4935669">(</span><span class="builtintype" id="4935670">string</span><span class="op" id="4935676">)</span>&nbsp;<span class="builtintype" id="4935678">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4935684">func</span>&nbsp;<span class="ident" id="4935689">filterIdentList</span><span class="op" id="4935704">(</span><span class="ident" id="4935705">list</span>&nbsp;<span class="op" id="4935710">[</span><span class="op" id="4935711">]</span><span class="op" id="4935712">*</span><span class="ident" id="4935713">Ident</span><span class="op" id="4935718">,</span>&nbsp;<span class="ident" id="4935720">f</span>&nbsp;<span class="ident" id="4935722">Filter</span><span class="op" id="4935728">)</span>&nbsp;<span class="op" id="4935730">[</span><span class="op" id="4935731">]</span><span class="op" id="4935732">*</span><span class="ident" id="4935733">Ident</span>&nbsp;<span class="op" id="4935739">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4935742">j</span>&nbsp;<span class="op" id="4935744">:=</span>&nbsp;<span class="num" id="4935747">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4935750">for</span>&nbsp;<span class="ident" id="4935754">_</span><span class="op" id="4935755">,</span>&nbsp;<span class="ident" id="4935757">x</span>&nbsp;<span class="op" id="4935759">:=</span>&nbsp;<span class="keyword" id="4935762">range</span>&nbsp;<span class="ident" id="4935768">list</span>&nbsp;<span class="op" id="4935773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4935777">if</span>&nbsp;<span class="ident" id="4935780">f</span><span class="op" id="4935781">(</span><span class="ident" id="4935782">x</span><span class="op" id="4935783">.</span><span class="ident" id="4935784">Name</span><span class="op" id="4935788">)</span>&nbsp;<span class="op" id="4935790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4935795">list</span><span class="op" id="4935799">[</span><span class="ident" id="4935800">j</span><span class="op" id="4935801">]</span>&nbsp;<span class="op" id="4935803">=</span>&nbsp;<span class="ident" id="4935805">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4935810">j</span><span class="op" id="4935811">++</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4935816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4935819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4935822">return</span>&nbsp;<span class="ident" id="4935829">list</span><span class="op" id="4935833">[</span><span class="num" id="4935834">0</span><span class="op" id="4935835">:</span><span class="ident" id="4935836">j</span><span class="op" id="4935837">]</span><br>
<span class="lineno"></span><span class="op" id="4935839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="4935842">//&nbsp;fieldName&nbsp;assumes&nbsp;that&nbsp;x&nbsp;is&nbsp;the&nbsp;type&nbsp;of&nbsp;an&nbsp;anonymous&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4935908">//&nbsp;returns&nbsp;the&nbsp;corresponding&nbsp;field&nbsp;name.&nbsp;If&nbsp;x&nbsp;is&nbsp;not&nbsp;an&nbsp;acceptable</span><br>
<span class="lineno"></span><span class="comment" id="4935975">//&nbsp;anonymous&nbsp;field,&nbsp;the&nbsp;result&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="4936014">//</span><br>
<span class="lineno"></span><span class="keyword" id="4936017">func</span>&nbsp;<span class="ident" id="4936022">fieldName</span><span class="op" id="4936031">(</span><span class="ident" id="4936032">x</span>&nbsp;<span class="ident" id="4936034">Expr</span><span class="op" id="4936038">)</span>&nbsp;<span class="op" id="4936040">*</span><span class="ident" id="4936041">Ident</span>&nbsp;<span class="op" id="4936047">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4936050">switch</span>&nbsp;<span class="ident" id="4936057">t</span>&nbsp;<span class="op" id="4936059">:=</span>&nbsp;<span class="ident" id="4936062">x</span><span class="op" id="4936063">.</span><span class="op" id="4936064">(</span><span class="keyword" id="4936065">type</span><span class="op" id="4936069">)</span>&nbsp;<span class="op" id="4936071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4936074">case</span>&nbsp;<span class="op" id="4936079">*</span><span class="ident" id="4936080">Ident</span><span class="op" id="4936085">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4936089">return</span>&nbsp;<span class="ident" id="4936096">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4936099">case</span>&nbsp;<span class="op" id="4936104">*</span><span class="ident" id="4936105">SelectorExpr</span><span class="op" id="4936117">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4936121">if</span>&nbsp;<span class="ident" id="4936124">_</span><span class="op" id="4936125">,</span>&nbsp;<span class="ident" id="4936127">ok</span>&nbsp;<span class="op" id="4936130">:=</span>&nbsp;<span class="ident" id="4936133">t</span><span class="op" id="4936134">.</span><span class="ident" id="4936135">X</span><span class="op" id="4936136">.</span><span class="op" id="4936137">(</span><span class="op" id="4936138">*</span><span class="ident" id="4936139">Ident</span><span class="op" id="4936144">)</span><span class="op" id="4936145">;</span>&nbsp;<span class="ident" id="4936147">ok</span>&nbsp;<span class="op" id="4936150">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4936155">return</span>&nbsp;<span class="ident" id="4936162">t</span><span class="op" id="4936163">.</span><span class="ident" id="4936164">Sel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4936170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4936173">case</span>&nbsp;<span class="op" id="4936178">*</span><span class="ident" id="4936179">StarExpr</span><span class="op" id="4936187">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4936191">return</span>&nbsp;<span class="ident" id="4936198">fieldName</span><span class="op" id="4936207">(</span><span class="ident" id="4936208">t</span><span class="op" id="4936209">.</span><span class="ident" id="4936210">X</span><span class="op" id="4936211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4936214">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4936217">return</span>&nbsp;<span class="builtintype" id="4936224">nil</span><br>
<span class="lineno"></span><span class="op" id="4936228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4936231">func</span>&nbsp;<span class="ident" id="4936236">filterFieldList</span><span class="op" id="4936251">(</span><span class="ident" id="4936252">fields</span>&nbsp;<span class="op" id="4936259">*</span><span class="ident" id="4936260">FieldList</span><span class="op" id="4936269">,</span>&nbsp;<span class="ident" id="4936271">filter</span>&nbsp;<span class="ident" id="4936278">Filter</span><span class="op" id="4936284">,</span>&nbsp;<span class="ident" id="4936286">export</span>&nbsp;<span class="builtintype" id="4936293">bool</span><span class="op" id="4936297">)</span>&nbsp;<span class="op" id="4936299">(</span><span class="ident" id="4936300">removedFields</span>&nbsp;<span class="builtintype" id="4936314">bool</span><span class="op" id="4936318">)</span>&nbsp;<span class="op" id="4936320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4936323">if</span>&nbsp;<span class="ident" id="4936326">fields</span>&nbsp;<span class="op" id="4936333">==</span>&nbsp;<span class="builtintype" id="4936336">nil</span>&nbsp;<span class="op" id="4936340">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4936344">return</span>&nbsp;<span class="builtintype" id="4936351">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4936358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4936361">list</span>&nbsp;<span class="op" id="4936366">:=</span>&nbsp;<span class="ident" id="4936369">fields</span><span class="op" id="4936375">.</span><span class="ident" id="4936376">List</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4936382">j</span>&nbsp;<span class="op" id="4936384">:=</span>&nbsp;<span class="num" id="4936387">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4936390">for</span>&nbsp;<span class="ident" id="4936394">_</span><span class="op" id="4936395">,</span>&nbsp;<span class="ident" id="4936397">f</span>&nbsp;<span class="op" id="4936399">:=</span>&nbsp;<span class="keyword" id="4936402">range</span>&nbsp;<span class="ident" id="4936408">list</span>&nbsp;<span class="op" id="4936413">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4936417">keepField</span>&nbsp;<span class="op" id="4936427">:=</span>&nbsp;<span class="builtintype" id="4936430">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4936438">if</span>&nbsp;<span class="builtinfunc" id="4936441">len</span><span class="op" id="4936444">(</span><span class="ident" id="4936445">f</span><span class="op" id="4936446">.</span><span class="ident" id="4936447">Names</span><span class="op" id="4936452">)</span>&nbsp;<span class="op" id="4936454">==</span>&nbsp;<span class="num" id="4936457">0</span>&nbsp;<span class="op" id="4936459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4936464">//&nbsp;anonymous&nbsp;field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4936486">name</span>&nbsp;<span class="op" id="4936491">:=</span>&nbsp;<span class="ident" id="4936494">fieldName</span><span class="op" id="4936503">(</span><span class="ident" id="4936504">f</span><span class="op" id="4936505">.</span><span class="ident" id="4936506">Type</span><span class="op" id="4936510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4936515">keepField</span>&nbsp;<span class="op" id="4936525">=</span>&nbsp;<span class="ident" id="4936527">name</span>&nbsp;<span class="op" id="4936532">!=</span>&nbsp;<span class="builtintype" id="4936535">nil</span>&nbsp;<span class="op" id="4936539">&amp;&amp;</span>&nbsp;<span class="ident" id="4936542">filter</span><span class="op" id="4936548">(</span><span class="ident" id="4936549">name</span><span class="op" id="4936553">.</span><span class="ident" id="4936554">Name</span><span class="op" id="4936558">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4936562">}</span>&nbsp;<span class="keyword" id="4936564">else</span>&nbsp;<span class="op" id="4936569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4936574">n</span>&nbsp;<span class="op" id="4936576">:=</span>&nbsp;<span class="builtinfunc" id="4936579">len</span><span class="op" id="4936582">(</span><span class="ident" id="4936583">f</span><span class="op" id="4936584">.</span><span class="ident" id="4936585">Names</span><span class="op" id="4936590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4936595">f</span><span class="op" id="4936596">.</span><span class="ident" id="4936597">Names</span>&nbsp;<span class="op" id="4936603">=</span>&nbsp;<span class="ident" id="4936605">filterIdentList</span><span class="op" id="4936620">(</span><span class="ident" id="4936621">f</span><span class="op" id="4936622">.</span><span class="ident" id="4936623">Names</span><span class="op" id="4936628">,</span>&nbsp;<span class="ident" id="4936630">filter</span><span class="op" id="4936636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4936641">if</span>&nbsp;<span class="builtinfunc" id="4936644">len</span><span class="op" id="4936647">(</span><span class="ident" id="4936648">f</span><span class="op" id="4936649">.</span><span class="ident" id="4936650">Names</span><span class="op" id="4936655">)</span>&nbsp;<span class="op" id="4936657">&lt;</span>&nbsp;<span class="ident" id="4936659">n</span>&nbsp;<span class="op" id="4936661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4936667">removedFields</span>&nbsp;<span class="op" id="4936681">=</span>&nbsp;<span class="builtintype" id="4936683">true</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4936691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4936696">keepField</span>&nbsp;<span class="op" id="4936706">=</span>&nbsp;<span class="builtinfunc" id="4936708">len</span><span class="op" id="4936711">(</span><span class="ident" id="4936712">f</span><span class="op" id="4936713">.</span><span class="ident" id="4936714">Names</span><span class="op" id="4936719">)</span>&nbsp;<span class="op" id="4936721">&gt;</span>&nbsp;<span class="num" id="4936723">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4936727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4936731">if</span>&nbsp;<span class="ident" id="4936734">keepField</span>&nbsp;<span class="op" id="4936744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4936749">if</span>&nbsp;<span class="ident" id="4936752">export</span>&nbsp;<span class="op" id="4936759">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4936765">filterType</span><span class="op" id="4936775">(</span><span class="ident" id="4936776">f</span><span class="op" id="4936777">.</span><span class="ident" id="4936778">Type</span><span class="op" id="4936782">,</span>&nbsp;<span class="ident" id="4936784">filter</span><span class="op" id="4936790">,</span>&nbsp;<span class="ident" id="4936792">export</span><span class="op" id="4936798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4936803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4936808">list</span><span class="op" id="4936812">[</span><span class="ident" id="4936813">j</span><span class="op" id="4936814">]</span>&nbsp;<span class="op" id="4936816">=</span>&nbsp;<span class="ident" id="4936818">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4936823">j</span><span class="op" id="4936824">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4936829">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4936832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4936835">if</span>&nbsp;<span class="ident" id="4936838">j</span>&nbsp;<span class="op" id="4936840">&lt;</span>&nbsp;<span class="builtinfunc" id="4936842">len</span><span class="op" id="4936845">(</span><span class="ident" id="4936846">list</span><span class="op" id="4936850">)</span>&nbsp;<span class="op" id="4936852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4936856">removedFields</span>&nbsp;<span class="op" id="4936870">=</span>&nbsp;<span class="builtintype" id="4936872">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4936878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4936881">fields</span><span class="op" id="4936887">.</span><span class="ident" id="4936888">List</span>&nbsp;<span class="op" id="4936893">=</span>&nbsp;<span class="ident" id="4936895">list</span><span class="op" id="4936899">[</span><span class="num" id="4936900">0</span><span class="op" id="4936901">:</span><span class="ident" id="4936902">j</span><span class="op" id="4936903">]</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4936906">return</span><br>
<span class="lineno"></span><span class="op" id="4936913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4936916">func</span>&nbsp;<span class="ident" id="4936921">filterParamList</span><span class="op" id="4936936">(</span><span class="ident" id="4936937">fields</span>&nbsp;<span class="op" id="4936944">*</span><span class="ident" id="4936945">FieldList</span><span class="op" id="4936954">,</span>&nbsp;<span class="ident" id="4936956">filter</span>&nbsp;<span class="ident" id="4936963">Filter</span><span class="op" id="4936969">,</span>&nbsp;<span class="ident" id="4936971">export</span>&nbsp;<span class="builtintype" id="4936978">bool</span><span class="op" id="4936982">)</span>&nbsp;<span class="builtintype" id="4936984">bool</span>&nbsp;<span class="op" id="4936989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4936992">if</span>&nbsp;<span class="ident" id="4936995">fields</span>&nbsp;<span class="op" id="4937002">==</span>&nbsp;<span class="builtintype" id="4937005">nil</span>&nbsp;<span class="op" id="4937009">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4937013">return</span>&nbsp;<span class="builtintype" id="4937020">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4937027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4937030">var</span>&nbsp;<span class="ident" id="4937034">b</span>&nbsp;<span class="builtintype" id="4937036">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4937042">for</span>&nbsp;<span class="ident" id="4937046">_</span><span class="op" id="4937047">,</span>&nbsp;<span class="ident" id="4937049">f</span>&nbsp;<span class="op" id="4937051">:=</span>&nbsp;<span class="keyword" id="4937054">range</span>&nbsp;<span class="ident" id="4937060">fields</span><span class="op" id="4937066">.</span><span class="ident" id="4937067">List</span>&nbsp;<span class="op" id="4937072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4937076">if</span>&nbsp;<span class="ident" id="4937079">filterType</span><span class="op" id="4937089">(</span><span class="ident" id="4937090">f</span><span class="op" id="4937091">.</span><span class="ident" id="4937092">Type</span><span class="op" id="4937096">,</span>&nbsp;<span class="ident" id="4937098">filter</span><span class="op" id="4937104">,</span>&nbsp;<span class="ident" id="4937106">export</span><span class="op" id="4937112">)</span>&nbsp;<span class="op" id="4937114">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4937119">b</span>&nbsp;<span class="op" id="4937121">=</span>&nbsp;<span class="builtintype" id="4937123">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4937130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4937133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4937136">return</span>&nbsp;<span class="ident" id="4937143">b</span><br>
<span class="lineno"></span><span class="op" id="4937145">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="4937148">func</span>&nbsp;<span class="ident" id="4937153">filterType</span><span class="op" id="4937163">(</span><span class="ident" id="4937164">typ</span>&nbsp;<span class="ident" id="4937168">Expr</span><span class="op" id="4937172">,</span>&nbsp;<span class="ident" id="4937174">f</span>&nbsp;<span class="ident" id="4937176">Filter</span><span class="op" id="4937182">,</span>&nbsp;<span class="ident" id="4937184">export</span>&nbsp;<span class="builtintype" id="4937191">bool</span><span class="op" id="4937195">)</span>&nbsp;<span class="builtintype" id="4937197">bool</span>&nbsp;<span class="op" id="4937202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4937205">switch</span>&nbsp;<span class="ident" id="4937212">t</span>&nbsp;<span class="op" id="4937214">:=</span>&nbsp;<span class="ident" id="4937217">typ</span><span class="op" id="4937220">.</span><span class="op" id="4937221">(</span><span class="keyword" id="4937222">type</span><span class="op" id="4937226">)</span>&nbsp;<span class="op" id="4937228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4937231">case</span>&nbsp;<span class="op" id="4937236">*</span><span class="ident" id="4937237">Ident</span><span class="op" id="4937242">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4937246">return</span>&nbsp;<span class="ident" id="4937253">f</span><span class="op" id="4937254">(</span><span class="ident" id="4937255">t</span><span class="op" id="4937256">.</span><span class="ident" id="4937257">Name</span><span class="op" id="4937261">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4937264">case</span>&nbsp;<span class="op" id="4937269">*</span><span class="ident" id="4937270">ParenExpr</span><span class="op" id="4937279">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4937283">return</span>&nbsp;<span class="ident" id="4937290">filterType</span><span class="op" id="4937300">(</span><span class="ident" id="4937301">t</span><span class="op" id="4937302">.</span><span class="ident" id="4937303">X</span><span class="op" id="4937304">,</span>&nbsp;<span class="ident" id="4937306">f</span><span class="op" id="4937307">,</span>&nbsp;<span class="ident" id="4937309">export</span><span class="op" id="4937315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4937318">case</span>&nbsp;<span class="op" id="4937323">*</span><span class="ident" id="4937324">ArrayType</span><span class="op" id="4937333">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4937337">return</span>&nbsp;<span class="ident" id="4937344">filterType</span><span class="op" id="4937354">(</span><span class="ident" id="4937355">t</span><span class="op" id="4937356">.</span><span class="ident" id="4937357">Elt</span><span class="op" id="4937360">,</span>&nbsp;<span class="ident" id="4937362">f</span><span class="op" id="4937363">,</span>&nbsp;<span class="ident" id="4937365">export</span><span class="op" id="4937371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4937374">case</span>&nbsp;<span class="op" id="4937379">*</span><span class="ident" id="4937380">StructType</span><span class="op" id="4937390">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4937394">if</span>&nbsp;<span class="ident" id="4937397">filterFieldList</span><span class="op" id="4937412">(</span><span class="ident" id="4937413">t</span><span class="op" id="4937414">.</span><span class="ident" id="4937415">Fields</span><span class="op" id="4937421">,</span>&nbsp;<span class="ident" id="4937423">f</span><span class="op" id="4937424">,</span>&nbsp;<span class="ident" id="4937426">export</span><span class="op" id="4937432">)</span>&nbsp;<span class="op" id="4937434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4937439">t</span><span class="op" id="4937440">.</span><span class="ident" id="4937441">Incomplete</span>&nbsp;<span class="op" id="4937452">=</span>&nbsp;<span class="builtintype" id="4937454">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4937461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4937465">return</span>&nbsp;<span class="builtinfunc" id="4937472">len</span><span class="op" id="4937475">(</span><span class="ident" id="4937476">t</span><span class="op" id="4937477">.</span><span class="ident" id="4937478">Fields</span><span class="op" id="4937484">.</span><span class="ident" id="4937485">List</span><span class="op" id="4937489">)</span>&nbsp;<span class="op" id="4937491">&gt;</span>&nbsp;<span class="num" id="4937493">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4937496">case</span>&nbsp;<span class="op" id="4937501">*</span><span class="ident" id="4937502">FuncType</span><span class="op" id="4937510">:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4937514">b1</span>&nbsp;<span class="op" id="4937517">:=</span>&nbsp;<span class="ident" id="4937520">filterParamList</span><span class="op" id="4937535">(</span><span class="ident" id="4937536">t</span><span class="op" id="4937537">.</span><span class="ident" id="4937538">Params</span><span class="op" id="4937544">,</span>&nbsp;<span class="ident" id="4937546">f</span><span class="op" id="4937547">,</span>&nbsp;<span class="ident" id="4937549">export</span><span class="op" id="4937555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4937559">b2</span>&nbsp;<span class="op" id="4937562">:=</span>&nbsp;<span class="ident" id="4937565">filterParamList</span><span class="op" id="4937580">(</span><span class="ident" id="4937581">t</span><span class="op" id="4937582">.</span><span class="ident" id="4937583">Results</span><span class="op" id="4937590">,</span>&nbsp;<span class="ident" id="4937592">f</span><span class="op" id="4937593">,</span>&nbsp;<span class="ident" id="4937595">export</span><span class="op" id="4937601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4937605">return</span>&nbsp;<span class="ident" id="4937612">b1</span>&nbsp;<span class="op" id="4937615">||</span>&nbsp;<span class="ident" id="4937618">b2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4937622">case</span>&nbsp;<span class="op" id="4937627">*</span><span class="ident" id="4937628">InterfaceType</span><span class="op" id="4937641">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4937645">if</span>&nbsp;<span class="ident" id="4937648">filterFieldList</span><span class="op" id="4937663">(</span><span class="ident" id="4937664">t</span><span class="op" id="4937665">.</span><span class="ident" id="4937666">Methods</span><span class="op" id="4937673">,</span>&nbsp;<span class="ident" id="4937675">f</span><span class="op" id="4937676">,</span>&nbsp;<span class="ident" id="4937678">export</span><span class="op" id="4937684">)</span>&nbsp;<span class="op" id="4937686">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4937691">t</span><span class="op" id="4937692">.</span><span class="ident" id="4937693">Incomplete</span>&nbsp;<span class="op" id="4937704">=</span>&nbsp;<span class="builtintype" id="4937706">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4937713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4937717">return</span>&nbsp;<span class="builtinfunc" id="4937724">len</span><span class="op" id="4937727">(</span><span class="ident" id="4937728">t</span><span class="op" id="4937729">.</span><span class="ident" id="4937730">Methods</span><span class="op" id="4937737">.</span><span class="ident" id="4937738">List</span><span class="op" id="4937742">)</span>&nbsp;<span class="op" id="4937744">&gt;</span>&nbsp;<span class="num" id="4937746">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4937749">case</span>&nbsp;<span class="op" id="4937754">*</span><span class="ident" id="4937755">MapType</span><span class="op" id="4937762">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4937766">b1</span>&nbsp;<span class="op" id="4937769">:=</span>&nbsp;<span class="ident" id="4937772">filterType</span><span class="op" id="4937782">(</span><span class="ident" id="4937783">t</span><span class="op" id="4937784">.</span><span class="ident" id="4937785">Key</span><span class="op" id="4937788">,</span>&nbsp;<span class="ident" id="4937790">f</span><span class="op" id="4937791">,</span>&nbsp;<span class="ident" id="4937793">export</span><span class="op" id="4937799">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4937803">b2</span>&nbsp;<span class="op" id="4937806">:=</span>&nbsp;<span class="ident" id="4937809">filterType</span><span class="op" id="4937819">(</span><span class="ident" id="4937820">t</span><span class="op" id="4937821">.</span><span class="ident" id="4937822">Value</span><span class="op" id="4937827">,</span>&nbsp;<span class="ident" id="4937829">f</span><span class="op" id="4937830">,</span>&nbsp;<span class="ident" id="4937832">export</span><span class="op" id="4937838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4937842">return</span>&nbsp;<span class="ident" id="4937849">b1</span>&nbsp;<span class="op" id="4937852">||</span>&nbsp;<span class="ident" id="4937855">b2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4937859">case</span>&nbsp;<span class="op" id="4937864">*</span><span class="ident" id="4937865">ChanType</span><span class="op" id="4937873">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4937877">return</span>&nbsp;<span class="ident" id="4937884">filterType</span><span class="op" id="4937894">(</span><span class="ident" id="4937895">t</span><span class="op" id="4937896">.</span><span class="ident" id="4937897">Value</span><span class="op" id="4937902">,</span>&nbsp;<span class="ident" id="4937904">f</span><span class="op" id="4937905">,</span>&nbsp;<span class="ident" id="4937907">export</span><span class="op" id="4937913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4937916">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4937919">return</span>&nbsp;<span class="builtintype" id="4937926">false</span><br>
<span class="lineno"></span><span class="op" id="4937932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4937935">func</span>&nbsp;<span class="ident" id="4937940">filterSpec</span><span class="op" id="4937950">(</span><span class="ident" id="4937951">spec</span>&nbsp;<span class="ident" id="4937956">Spec</span><span class="op" id="4937960">,</span>&nbsp;<span class="ident" id="4937962">f</span>&nbsp;<span class="ident" id="4937964">Filter</span><span class="op" id="4937970">,</span>&nbsp;<span class="ident" id="4937972">export</span>&nbsp;<span class="builtintype" id="4937979">bool</span><span class="op" id="4937983">)</span>&nbsp;<span class="builtintype" id="4937985">bool</span>&nbsp;<span class="op" id="4937990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4937993">switch</span>&nbsp;<span class="ident" id="4938000">s</span>&nbsp;<span class="op" id="4938002">:=</span>&nbsp;<span class="ident" id="4938005">spec</span><span class="op" id="4938009">.</span><span class="op" id="4938010">(</span><span class="keyword" id="4938011">type</span><span class="op" id="4938015">)</span>&nbsp;<span class="op" id="4938017">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4938020">case</span>&nbsp;<span class="op" id="4938025">*</span><span class="ident" id="4938026">ValueSpec</span><span class="op" id="4938035">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4938039">s</span><span class="op" id="4938040">.</span><span class="ident" id="4938041">Names</span>&nbsp;<span class="op" id="4938047">=</span>&nbsp;<span class="ident" id="4938049">filterIdentList</span><span class="op" id="4938064">(</span><span class="ident" id="4938065">s</span><span class="op" id="4938066">.</span><span class="ident" id="4938067">Names</span><span class="op" id="4938072">,</span>&nbsp;<span class="ident" id="4938074">f</span><span class="op" id="4938075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4938079">if</span>&nbsp;<span class="builtinfunc" id="4938082">len</span><span class="op" id="4938085">(</span><span class="ident" id="4938086">s</span><span class="op" id="4938087">.</span><span class="ident" id="4938088">Names</span><span class="op" id="4938093">)</span>&nbsp;<span class="op" id="4938095">&gt;</span>&nbsp;<span class="num" id="4938097">0</span>&nbsp;<span class="op" id="4938099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4938104">if</span>&nbsp;<span class="ident" id="4938107">export</span>&nbsp;<span class="op" id="4938114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4938120">filterType</span><span class="op" id="4938130">(</span><span class="ident" id="4938131">s</span><span class="op" id="4938132">.</span><span class="ident" id="4938133">Type</span><span class="op" id="4938137">,</span>&nbsp;<span class="ident" id="4938139">f</span><span class="op" id="4938140">,</span>&nbsp;<span class="ident" id="4938142">export</span><span class="op" id="4938148">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4938153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4938158">return</span>&nbsp;<span class="builtintype" id="4938165">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4938172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4938175">case</span>&nbsp;<span class="op" id="4938180">*</span><span class="ident" id="4938181">TypeSpec</span><span class="op" id="4938189">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4938193">if</span>&nbsp;<span class="ident" id="4938196">f</span><span class="op" id="4938197">(</span><span class="ident" id="4938198">s</span><span class="op" id="4938199">.</span><span class="ident" id="4938200">Name</span><span class="op" id="4938204">.</span><span class="ident" id="4938205">Name</span><span class="op" id="4938209">)</span>&nbsp;<span class="op" id="4938211">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4938216">if</span>&nbsp;<span class="ident" id="4938219">export</span>&nbsp;<span class="op" id="4938226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4938232">filterType</span><span class="op" id="4938242">(</span><span class="ident" id="4938243">s</span><span class="op" id="4938244">.</span><span class="ident" id="4938245">Type</span><span class="op" id="4938249">,</span>&nbsp;<span class="ident" id="4938251">f</span><span class="op" id="4938252">,</span>&nbsp;<span class="ident" id="4938254">export</span><span class="op" id="4938260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4938265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4938270">return</span>&nbsp;<span class="builtintype" id="4938277">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4938284">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4938288">if</span>&nbsp;<span class="op" id="4938291">!</span><span class="ident" id="4938292">export</span>&nbsp;<span class="op" id="4938299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4938304">//&nbsp;For&nbsp;general&nbsp;filtering&nbsp;(not&nbsp;just&nbsp;exports),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4938352">//&nbsp;filter&nbsp;type&nbsp;even&nbsp;if&nbsp;name&nbsp;is&nbsp;not&nbsp;filtered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4938399">//&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4938410">//&nbsp;If&nbsp;the&nbsp;type&nbsp;contains&nbsp;filtered&nbsp;elements,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4938456">//&nbsp;keep&nbsp;the&nbsp;declaration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4938484">return</span>&nbsp;<span class="ident" id="4938491">filterType</span><span class="op" id="4938501">(</span><span class="ident" id="4938502">s</span><span class="op" id="4938503">.</span><span class="ident" id="4938504">Type</span><span class="op" id="4938508">,</span>&nbsp;<span class="ident" id="4938510">f</span><span class="op" id="4938511">,</span>&nbsp;<span class="ident" id="4938513">export</span><span class="op" id="4938519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4938523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4938526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4938529">return</span>&nbsp;<span class="builtintype" id="4938536">false</span><br>
<span class="lineno">185</span><span class="op" id="4938542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4938545">func</span>&nbsp;<span class="ident" id="4938550">filterSpecList</span><span class="op" id="4938564">(</span><span class="ident" id="4938565">list</span>&nbsp;<span class="op" id="4938570">[</span><span class="op" id="4938571">]</span><span class="ident" id="4938572">Spec</span><span class="op" id="4938576">,</span>&nbsp;<span class="ident" id="4938578">f</span>&nbsp;<span class="ident" id="4938580">Filter</span><span class="op" id="4938586">,</span>&nbsp;<span class="ident" id="4938588">export</span>&nbsp;<span class="builtintype" id="4938595">bool</span><span class="op" id="4938599">)</span>&nbsp;<span class="op" id="4938601">[</span><span class="op" id="4938602">]</span><span class="ident" id="4938603">Spec</span>&nbsp;<span class="op" id="4938608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4938611">j</span>&nbsp;<span class="op" id="4938613">:=</span>&nbsp;<span class="num" id="4938616">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4938619">for</span>&nbsp;<span class="ident" id="4938623">_</span><span class="op" id="4938624">,</span>&nbsp;<span class="ident" id="4938626">s</span>&nbsp;<span class="op" id="4938628">:=</span>&nbsp;<span class="keyword" id="4938631">range</span>&nbsp;<span class="ident" id="4938637">list</span>&nbsp;<span class="op" id="4938642">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4938646">if</span>&nbsp;<span class="ident" id="4938649">filterSpec</span><span class="op" id="4938659">(</span><span class="ident" id="4938660">s</span><span class="op" id="4938661">,</span>&nbsp;<span class="ident" id="4938663">f</span><span class="op" id="4938664">,</span>&nbsp;<span class="ident" id="4938666">export</span><span class="op" id="4938672">)</span>&nbsp;<span class="op" id="4938674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4938679">list</span><span class="op" id="4938683">[</span><span class="ident" id="4938684">j</span><span class="op" id="4938685">]</span>&nbsp;<span class="op" id="4938687">=</span>&nbsp;<span class="ident" id="4938689">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4938694">j</span><span class="op" id="4938695">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4938700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4938703">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4938706">return</span>&nbsp;<span class="ident" id="4938713">list</span><span class="op" id="4938717">[</span><span class="num" id="4938718">0</span><span class="op" id="4938719">:</span><span class="ident" id="4938720">j</span><span class="op" id="4938721">]</span><br>
<span class="lineno"></span><span class="op" id="4938723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4938726">//&nbsp;FilterDecl&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;declaration&nbsp;in&nbsp;place&nbsp;by&nbsp;removing</span><br>
<span class="lineno"></span><span class="comment" id="4938796">//&nbsp;all&nbsp;names&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but</span><br>
<span class="lineno">200</span><span class="comment" id="4938865">//&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="4938932">//</span><br>
<span class="lineno"></span><span class="comment" id="4938935">//&nbsp;FilterDecl&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;declared&nbsp;names&nbsp;left&nbsp;after</span><br>
<span class="lineno"></span><span class="comment" id="4939005">//&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="4939047">//</span><br>
<span class="lineno">205</span><span class="keyword" id="4939050">func</span>&nbsp;<span class="ident" id="4939055">FilterDecl</span><span class="op" id="4939065">(</span><span class="ident" id="4939066">decl</span>&nbsp;<span class="ident" id="4939071">Decl</span><span class="op" id="4939075">,</span>&nbsp;<span class="ident" id="4939077">f</span>&nbsp;<span class="ident" id="4939079">Filter</span><span class="op" id="4939085">)</span>&nbsp;<span class="builtintype" id="4939087">bool</span>&nbsp;<span class="op" id="4939092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4939095">return</span>&nbsp;<span class="ident" id="4939102">filterDecl</span><span class="op" id="4939112">(</span><span class="ident" id="4939113">decl</span><span class="op" id="4939117">,</span>&nbsp;<span class="ident" id="4939119">f</span><span class="op" id="4939120">,</span>&nbsp;<span class="builtintype" id="4939122">false</span><span class="op" id="4939127">)</span><br>
<span class="lineno"></span><span class="op" id="4939129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4939132">func</span>&nbsp;<span class="ident" id="4939137">filterDecl</span><span class="op" id="4939147">(</span><span class="ident" id="4939148">decl</span>&nbsp;<span class="ident" id="4939153">Decl</span><span class="op" id="4939157">,</span>&nbsp;<span class="ident" id="4939159">f</span>&nbsp;<span class="ident" id="4939161">Filter</span><span class="op" id="4939167">,</span>&nbsp;<span class="ident" id="4939169">export</span>&nbsp;<span class="builtintype" id="4939176">bool</span><span class="op" id="4939180">)</span>&nbsp;<span class="builtintype" id="4939182">bool</span>&nbsp;<span class="op" id="4939187">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4939190">switch</span>&nbsp;<span class="ident" id="4939197">d</span>&nbsp;<span class="op" id="4939199">:=</span>&nbsp;<span class="ident" id="4939202">decl</span><span class="op" id="4939206">.</span><span class="op" id="4939207">(</span><span class="keyword" id="4939208">type</span><span class="op" id="4939212">)</span>&nbsp;<span class="op" id="4939214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4939217">case</span>&nbsp;<span class="op" id="4939222">*</span><span class="ident" id="4939223">GenDecl</span><span class="op" id="4939230">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4939234">d</span><span class="op" id="4939235">.</span><span class="ident" id="4939236">Specs</span>&nbsp;<span class="op" id="4939242">=</span>&nbsp;<span class="ident" id="4939244">filterSpecList</span><span class="op" id="4939258">(</span><span class="ident" id="4939259">d</span><span class="op" id="4939260">.</span><span class="ident" id="4939261">Specs</span><span class="op" id="4939266">,</span>&nbsp;<span class="ident" id="4939268">f</span><span class="op" id="4939269">,</span>&nbsp;<span class="ident" id="4939271">export</span><span class="op" id="4939277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4939281">return</span>&nbsp;<span class="builtinfunc" id="4939288">len</span><span class="op" id="4939291">(</span><span class="ident" id="4939292">d</span><span class="op" id="4939293">.</span><span class="ident" id="4939294">Specs</span><span class="op" id="4939299">)</span>&nbsp;<span class="op" id="4939301">&gt;</span>&nbsp;<span class="num" id="4939303">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4939306">case</span>&nbsp;<span class="op" id="4939311">*</span><span class="ident" id="4939312">FuncDecl</span><span class="op" id="4939320">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4939324">return</span>&nbsp;<span class="ident" id="4939331">f</span><span class="op" id="4939332">(</span><span class="ident" id="4939333">d</span><span class="op" id="4939334">.</span><span class="ident" id="4939335">Name</span><span class="op" id="4939339">.</span><span class="ident" id="4939340">Name</span><span class="op" id="4939344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4939347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4939350">return</span>&nbsp;<span class="builtintype" id="4939357">false</span><br>
<span class="lineno"></span><span class="op" id="4939363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="4939366">//&nbsp;FilterFile&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;file&nbsp;in&nbsp;place&nbsp;by&nbsp;removing&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="4939433">//&nbsp;names&nbsp;from&nbsp;top-level&nbsp;declarations&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4939498">//&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="4939566">//&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.&nbsp;If&nbsp;the&nbsp;declaration&nbsp;is&nbsp;empty&nbsp;afterwards,</span><br>
<span class="lineno"></span><span class="comment" id="4939636">//&nbsp;the&nbsp;declaration&nbsp;is&nbsp;removed&nbsp;from&nbsp;the&nbsp;AST.&nbsp;The&nbsp;File.Comments&nbsp;list</span><br>
<span class="lineno">225</span><span class="comment" id="4939703">//&nbsp;is&nbsp;not&nbsp;changed.</span><br>
<span class="lineno"></span><span class="comment" id="4939722">//</span><br>
<span class="lineno"></span><span class="comment" id="4939725">//&nbsp;FilterFile&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;top-level&nbsp;declarations</span><br>
<span class="lineno"></span><span class="comment" id="4939792">//&nbsp;left&nbsp;after&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="4939845">//</span><br>
<span class="lineno">230</span><span class="keyword" id="4939848">func</span>&nbsp;<span class="ident" id="4939853">FilterFile</span><span class="op" id="4939863">(</span><span class="ident" id="4939864">src</span>&nbsp;<span class="op" id="4939868">*</span><span class="ident" id="4939869">File</span><span class="op" id="4939873">,</span>&nbsp;<span class="ident" id="4939875">f</span>&nbsp;<span class="ident" id="4939877">Filter</span><span class="op" id="4939883">)</span>&nbsp;<span class="builtintype" id="4939885">bool</span>&nbsp;<span class="op" id="4939890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4939893">return</span>&nbsp;<span class="ident" id="4939900">filterFile</span><span class="op" id="4939910">(</span><span class="ident" id="4939911">src</span><span class="op" id="4939914">,</span>&nbsp;<span class="ident" id="4939916">f</span><span class="op" id="4939917">,</span>&nbsp;<span class="builtintype" id="4939919">false</span><span class="op" id="4939924">)</span><br>
<span class="lineno"></span><span class="op" id="4939926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4939929">func</span>&nbsp;<span class="ident" id="4939934">filterFile</span><span class="op" id="4939944">(</span><span class="ident" id="4939945">src</span>&nbsp;<span class="op" id="4939949">*</span><span class="ident" id="4939950">File</span><span class="op" id="4939954">,</span>&nbsp;<span class="ident" id="4939956">f</span>&nbsp;<span class="ident" id="4939958">Filter</span><span class="op" id="4939964">,</span>&nbsp;<span class="ident" id="4939966">export</span>&nbsp;<span class="builtintype" id="4939973">bool</span><span class="op" id="4939977">)</span>&nbsp;<span class="builtintype" id="4939979">bool</span>&nbsp;<span class="op" id="4939984">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4939987">j</span>&nbsp;<span class="op" id="4939989">:=</span>&nbsp;<span class="num" id="4939992">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4939995">for</span>&nbsp;<span class="ident" id="4939999">_</span><span class="op" id="4940000">,</span>&nbsp;<span class="ident" id="4940002">d</span>&nbsp;<span class="op" id="4940004">:=</span>&nbsp;<span class="keyword" id="4940007">range</span>&nbsp;<span class="ident" id="4940013">src</span><span class="op" id="4940016">.</span><span class="ident" id="4940017">Decls</span>&nbsp;<span class="op" id="4940023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4940027">if</span>&nbsp;<span class="ident" id="4940030">filterDecl</span><span class="op" id="4940040">(</span><span class="ident" id="4940041">d</span><span class="op" id="4940042">,</span>&nbsp;<span class="ident" id="4940044">f</span><span class="op" id="4940045">,</span>&nbsp;<span class="ident" id="4940047">export</span><span class="op" id="4940053">)</span>&nbsp;<span class="op" id="4940055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4940060">src</span><span class="op" id="4940063">.</span><span class="ident" id="4940064">Decls</span><span class="op" id="4940069">[</span><span class="ident" id="4940070">j</span><span class="op" id="4940071">]</span>&nbsp;<span class="op" id="4940073">=</span>&nbsp;<span class="ident" id="4940075">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4940080">j</span><span class="op" id="4940081">++</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4940086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4940089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4940092">src</span><span class="op" id="4940095">.</span><span class="ident" id="4940096">Decls</span>&nbsp;<span class="op" id="4940102">=</span>&nbsp;<span class="ident" id="4940104">src</span><span class="op" id="4940107">.</span><span class="ident" id="4940108">Decls</span><span class="op" id="4940113">[</span><span class="num" id="4940114">0</span><span class="op" id="4940115">:</span><span class="ident" id="4940116">j</span><span class="op" id="4940117">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4940120">return</span>&nbsp;<span class="ident" id="4940127">j</span>&nbsp;<span class="op" id="4940129">&gt;</span>&nbsp;<span class="num" id="4940131">0</span><br>
<span class="lineno"></span><span class="op" id="4940133">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="4940136">//&nbsp;FilterPackage&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;package&nbsp;in&nbsp;place&nbsp;by&nbsp;removing</span><br>
<span class="lineno"></span><span class="comment" id="4940205">//&nbsp;all&nbsp;names&nbsp;from&nbsp;top-level&nbsp;declarations&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4940274">//&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="4940342">//&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.&nbsp;If&nbsp;the&nbsp;declaration&nbsp;is&nbsp;empty&nbsp;afterwards,</span><br>
<span class="lineno">250</span><span class="comment" id="4940412">//&nbsp;the&nbsp;declaration&nbsp;is&nbsp;removed&nbsp;from&nbsp;the&nbsp;AST.&nbsp;The&nbsp;pkg.Files&nbsp;list&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="4940482">//&nbsp;changed,&nbsp;so&nbsp;that&nbsp;file&nbsp;names&nbsp;and&nbsp;top-level&nbsp;package&nbsp;comments&nbsp;don&#39;t&nbsp;get</span><br>
<span class="lineno"></span><span class="comment" id="4940554">//&nbsp;lost.</span><br>
<span class="lineno"></span><span class="comment" id="4940563">//</span><br>
<span class="lineno"></span><span class="comment" id="4940566">//&nbsp;FilterPackage&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;top-level&nbsp;declarations</span><br>
<span class="lineno">255</span><span class="comment" id="4940636">//&nbsp;left&nbsp;after&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="4940689">//</span><br>
<span class="lineno"></span><span class="keyword" id="4940692">func</span>&nbsp;<span class="ident" id="4940697">FilterPackage</span><span class="op" id="4940710">(</span><span class="ident" id="4940711">pkg</span>&nbsp;<span class="op" id="4940715">*</span><span class="ident" id="4940716">Package</span><span class="op" id="4940723">,</span>&nbsp;<span class="ident" id="4940725">f</span>&nbsp;<span class="ident" id="4940727">Filter</span><span class="op" id="4940733">)</span>&nbsp;<span class="builtintype" id="4940735">bool</span>&nbsp;<span class="op" id="4940740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4940743">return</span>&nbsp;<span class="ident" id="4940750">filterPackage</span><span class="op" id="4940763">(</span><span class="ident" id="4940764">pkg</span><span class="op" id="4940767">,</span>&nbsp;<span class="ident" id="4940769">f</span><span class="op" id="4940770">,</span>&nbsp;<span class="builtintype" id="4940772">false</span><span class="op" id="4940777">)</span><br>
<span class="lineno"></span><span class="op" id="4940779">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="keyword" id="4940782">func</span>&nbsp;<span class="ident" id="4940787">filterPackage</span><span class="op" id="4940800">(</span><span class="ident" id="4940801">pkg</span>&nbsp;<span class="op" id="4940805">*</span><span class="ident" id="4940806">Package</span><span class="op" id="4940813">,</span>&nbsp;<span class="ident" id="4940815">f</span>&nbsp;<span class="ident" id="4940817">Filter</span><span class="op" id="4940823">,</span>&nbsp;<span class="ident" id="4940825">export</span>&nbsp;<span class="builtintype" id="4940832">bool</span><span class="op" id="4940836">)</span>&nbsp;<span class="builtintype" id="4940838">bool</span>&nbsp;<span class="op" id="4940843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4940846">hasDecls</span>&nbsp;<span class="op" id="4940855">:=</span>&nbsp;<span class="builtintype" id="4940858">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4940865">for</span>&nbsp;<span class="ident" id="4940869">_</span><span class="op" id="4940870">,</span>&nbsp;<span class="ident" id="4940872">src</span>&nbsp;<span class="op" id="4940876">:=</span>&nbsp;<span class="keyword" id="4940879">range</span>&nbsp;<span class="ident" id="4940885">pkg</span><span class="op" id="4940888">.</span><span class="ident" id="4940889">Files</span>&nbsp;<span class="op" id="4940895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4940899">if</span>&nbsp;<span class="ident" id="4940902">filterFile</span><span class="op" id="4940912">(</span><span class="ident" id="4940913">src</span><span class="op" id="4940916">,</span>&nbsp;<span class="ident" id="4940918">f</span><span class="op" id="4940919">,</span>&nbsp;<span class="ident" id="4940921">export</span><span class="op" id="4940927">)</span>&nbsp;<span class="op" id="4940929">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4940934">hasDecls</span>&nbsp;<span class="op" id="4940943">=</span>&nbsp;<span class="builtintype" id="4940945">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4940952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4940955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4940958">return</span>&nbsp;<span class="ident" id="4940965">hasDecls</span><br>
<span class="lineno"></span><span class="op" id="4940974">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="comment" id="4940977">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4941057">//&nbsp;Merging&nbsp;of&nbsp;package&nbsp;files</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4941086">//&nbsp;The&nbsp;MergeMode&nbsp;flags&nbsp;control&nbsp;the&nbsp;behavior&nbsp;of&nbsp;MergePackageFiles.</span><br>
<span class="lineno">275</span><span class="keyword" id="4941152">type</span>&nbsp;<span class="ident" id="4941157">MergeMode</span>&nbsp;<span class="builtintype" id="4941167">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4941173">const</span>&nbsp;<span class="op" id="4941179">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4941182">//&nbsp;If&nbsp;set,&nbsp;duplicate&nbsp;function&nbsp;declarations&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4941240">FilterFuncDuplicates</span>&nbsp;<span class="ident" id="4941261">MergeMode</span>&nbsp;<span class="op" id="4941271">=</span>&nbsp;<span class="num" id="4941273">1</span>&nbsp;<span class="op" id="4941275">&lt;&lt;</span>&nbsp;<span class="ident" id="4941278">iota</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4941284">//&nbsp;If&nbsp;set,&nbsp;comments&nbsp;that&nbsp;are&nbsp;not&nbsp;associated&nbsp;with&nbsp;a&nbsp;specific</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4941345">//&nbsp;AST&nbsp;node&nbsp;(as&nbsp;Doc&nbsp;or&nbsp;Comment)&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4941392">FilterUnassociatedComments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4941420">//&nbsp;If&nbsp;set,&nbsp;duplicate&nbsp;import&nbsp;declarations&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4941476">FilterImportDuplicates</span><br>
<span class="lineno">285</span><span class="op" id="4941499">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4941502">//&nbsp;nameOf&nbsp;returns&nbsp;the&nbsp;function&nbsp;(foo)&nbsp;or&nbsp;method&nbsp;name&nbsp;(foo.bar)&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4941568">//&nbsp;the&nbsp;given&nbsp;function&nbsp;declaration.&nbsp;If&nbsp;the&nbsp;AST&nbsp;is&nbsp;incorrect&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4941635">//&nbsp;receiver,&nbsp;it&nbsp;assumes&nbsp;a&nbsp;function&nbsp;instead.</span><br>
<span class="lineno">290</span><span class="comment" id="4941679">//</span><br>
<span class="lineno"></span><span class="keyword" id="4941682">func</span>&nbsp;<span class="ident" id="4941687">nameOf</span><span class="op" id="4941693">(</span><span class="ident" id="4941694">f</span>&nbsp;<span class="op" id="4941696">*</span><span class="ident" id="4941697">FuncDecl</span><span class="op" id="4941705">)</span>&nbsp;<span class="builtintype" id="4941707">string</span>&nbsp;<span class="op" id="4941714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4941717">if</span>&nbsp;<span class="ident" id="4941720">r</span>&nbsp;<span class="op" id="4941722">:=</span>&nbsp;<span class="ident" id="4941725">f</span><span class="op" id="4941726">.</span><span class="ident" id="4941727">Recv</span><span class="op" id="4941731">;</span>&nbsp;<span class="ident" id="4941733">r</span>&nbsp;<span class="op" id="4941735">!=</span>&nbsp;<span class="builtintype" id="4941738">nil</span>&nbsp;<span class="op" id="4941742">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4941745">len</span><span class="op" id="4941748">(</span><span class="ident" id="4941749">r</span><span class="op" id="4941750">.</span><span class="ident" id="4941751">List</span><span class="op" id="4941755">)</span>&nbsp;<span class="op" id="4941757">==</span>&nbsp;<span class="num" id="4941760">1</span>&nbsp;<span class="op" id="4941762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4941766">//&nbsp;looks&nbsp;like&nbsp;a&nbsp;correct&nbsp;receiver&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4941813">t</span>&nbsp;<span class="op" id="4941815">:=</span>&nbsp;<span class="ident" id="4941818">r</span><span class="op" id="4941819">.</span><span class="ident" id="4941820">List</span><span class="op" id="4941824">[</span><span class="num" id="4941825">0</span><span class="op" id="4941826">]</span><span class="op" id="4941827">.</span><span class="ident" id="4941828">Type</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4941835">//&nbsp;dereference&nbsp;pointer&nbsp;receiver&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4941875">if</span>&nbsp;<span class="ident" id="4941878">p</span><span class="op" id="4941879">,</span>&nbsp;<span class="ident" id="4941881">_</span>&nbsp;<span class="op" id="4941883">:=</span>&nbsp;<span class="ident" id="4941886">t</span><span class="op" id="4941887">.</span><span class="op" id="4941888">(</span><span class="op" id="4941889">*</span><span class="ident" id="4941890">StarExpr</span><span class="op" id="4941898">)</span><span class="op" id="4941899">;</span>&nbsp;<span class="ident" id="4941901">p</span>&nbsp;<span class="op" id="4941903">!=</span>&nbsp;<span class="builtintype" id="4941906">nil</span>&nbsp;<span class="op" id="4941910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4941915">t</span>&nbsp;<span class="op" id="4941917">=</span>&nbsp;<span class="ident" id="4941919">p</span><span class="op" id="4941920">.</span><span class="ident" id="4941921">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4941925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4941929">//&nbsp;the&nbsp;receiver&nbsp;type&nbsp;must&nbsp;be&nbsp;a&nbsp;type&nbsp;name</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4941972">if</span>&nbsp;<span class="ident" id="4941975">p</span><span class="op" id="4941976">,</span>&nbsp;<span class="ident" id="4941978">_</span>&nbsp;<span class="op" id="4941980">:=</span>&nbsp;<span class="ident" id="4941983">t</span><span class="op" id="4941984">.</span><span class="op" id="4941985">(</span><span class="op" id="4941986">*</span><span class="ident" id="4941987">Ident</span><span class="op" id="4941992">)</span><span class="op" id="4941993">;</span>&nbsp;<span class="ident" id="4941995">p</span>&nbsp;<span class="op" id="4941997">!=</span>&nbsp;<span class="builtintype" id="4942000">nil</span>&nbsp;<span class="op" id="4942004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4942009">return</span>&nbsp;<span class="ident" id="4942016">p</span><span class="op" id="4942017">.</span><span class="ident" id="4942018">Name</span>&nbsp;<span class="op" id="4942023">+</span>&nbsp;<span class="string" id="4942025">&#34;.&#34;</span>&nbsp;<span class="op" id="4942029">+</span>&nbsp;<span class="ident" id="4942031">f</span><span class="op" id="4942032">.</span><span class="ident" id="4942033">Name</span><span class="op" id="4942037">.</span><span class="ident" id="4942038">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4942045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4942049">//&nbsp;otherwise&nbsp;assume&nbsp;a&nbsp;function&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4942089">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4942092">return</span>&nbsp;<span class="ident" id="4942099">f</span><span class="op" id="4942100">.</span><span class="ident" id="4942101">Name</span><span class="op" id="4942105">.</span><span class="ident" id="4942106">Name</span><br>
<span class="lineno"></span><span class="op" id="4942111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4942114">//&nbsp;separator&nbsp;is&nbsp;an&nbsp;empty&nbsp;//-style&nbsp;comment&nbsp;that&nbsp;is&nbsp;interspersed&nbsp;between</span><br>
<span class="lineno"></span><span class="comment" id="4942185">//&nbsp;different&nbsp;comment&nbsp;groups&nbsp;when&nbsp;they&nbsp;are&nbsp;concatenated&nbsp;into&nbsp;a&nbsp;single&nbsp;group</span><br>
<span class="lineno">310</span><span class="comment" id="4942260">//</span><br>
<span class="lineno"></span><span class="keyword" id="4942263">var</span>&nbsp;<span class="ident" id="4942267">separator</span>&nbsp;<span class="op" id="4942277">=</span>&nbsp;<span class="op" id="4942279">&amp;</span><span class="ident" id="4942280">Comment</span><span class="op" id="4942287">{</span><span class="ident" id="4942288">token</span><span class="op" id="4942293">.</span><span class="ident" id="4942294">NoPos</span><span class="op" id="4942299">,</span>&nbsp;<span class="string" id="4942301">&#34;//&#34;</span><span class="op" id="4942305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4942308">//&nbsp;MergePackageFiles&nbsp;creates&nbsp;a&nbsp;file&nbsp;AST&nbsp;by&nbsp;merging&nbsp;the&nbsp;ASTs&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4942375">//&nbsp;files&nbsp;belonging&nbsp;to&nbsp;a&nbsp;package.&nbsp;The&nbsp;mode&nbsp;flags&nbsp;control&nbsp;merging&nbsp;behavior.</span><br>
<span class="lineno">315</span><span class="comment" id="4942449">//</span><br>
<span class="lineno"></span><span class="keyword" id="4942452">func</span>&nbsp;<span class="ident" id="4942457">MergePackageFiles</span><span class="op" id="4942474">(</span><span class="ident" id="4942475">pkg</span>&nbsp;<span class="op" id="4942479">*</span><span class="ident" id="4942480">Package</span><span class="op" id="4942487">,</span>&nbsp;<span class="ident" id="4942489">mode</span>&nbsp;<span class="ident" id="4942494">MergeMode</span><span class="op" id="4942503">)</span>&nbsp;<span class="op" id="4942505">*</span><span class="ident" id="4942506">File</span>&nbsp;<span class="op" id="4942511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4942514">//&nbsp;Count&nbsp;the&nbsp;number&nbsp;of&nbsp;package&nbsp;docs,&nbsp;comments&nbsp;and&nbsp;declarations&nbsp;across</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4942585">//&nbsp;all&nbsp;package&nbsp;files.&nbsp;Also,&nbsp;compute&nbsp;sorted&nbsp;list&nbsp;of&nbsp;filenames,&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4942656">//&nbsp;subsequent&nbsp;iterations&nbsp;can&nbsp;always&nbsp;iterate&nbsp;in&nbsp;the&nbsp;same&nbsp;order.</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4942720">ndocs</span>&nbsp;<span class="op" id="4942726">:=</span>&nbsp;<span class="num" id="4942729">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4942732">ncomments</span>&nbsp;<span class="op" id="4942742">:=</span>&nbsp;<span class="num" id="4942745">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4942748">ndecls</span>&nbsp;<span class="op" id="4942755">:=</span>&nbsp;<span class="num" id="4942758">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4942761">filenames</span>&nbsp;<span class="op" id="4942771">:=</span>&nbsp;<span class="builtinfunc" id="4942774">make</span><span class="op" id="4942778">(</span><span class="op" id="4942779">[</span><span class="op" id="4942780">]</span><span class="builtintype" id="4942781">string</span><span class="op" id="4942787">,</span>&nbsp;<span class="builtinfunc" id="4942789">len</span><span class="op" id="4942792">(</span><span class="ident" id="4942793">pkg</span><span class="op" id="4942796">.</span><span class="ident" id="4942797">Files</span><span class="op" id="4942802">)</span><span class="op" id="4942803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4942806">i</span>&nbsp;<span class="op" id="4942808">:=</span>&nbsp;<span class="num" id="4942811">0</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4942814">for</span>&nbsp;<span class="ident" id="4942818">filename</span><span class="op" id="4942826">,</span>&nbsp;<span class="ident" id="4942828">f</span>&nbsp;<span class="op" id="4942830">:=</span>&nbsp;<span class="keyword" id="4942833">range</span>&nbsp;<span class="ident" id="4942839">pkg</span><span class="op" id="4942842">.</span><span class="ident" id="4942843">Files</span>&nbsp;<span class="op" id="4942849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4942853">filenames</span><span class="op" id="4942862">[</span><span class="ident" id="4942863">i</span><span class="op" id="4942864">]</span>&nbsp;<span class="op" id="4942866">=</span>&nbsp;<span class="ident" id="4942868">filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4942879">i</span><span class="op" id="4942880">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4942885">if</span>&nbsp;<span class="ident" id="4942888">f</span><span class="op" id="4942889">.</span><span class="ident" id="4942890">Doc</span>&nbsp;<span class="op" id="4942894">!=</span>&nbsp;<span class="builtintype" id="4942897">nil</span>&nbsp;<span class="op" id="4942901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4942906">ndocs</span>&nbsp;<span class="op" id="4942912">+=</span>&nbsp;<span class="builtinfunc" id="4942915">len</span><span class="op" id="4942918">(</span><span class="ident" id="4942919">f</span><span class="op" id="4942920">.</span><span class="ident" id="4942921">Doc</span><span class="op" id="4942924">.</span><span class="ident" id="4942925">List</span><span class="op" id="4942929">)</span>&nbsp;<span class="op" id="4942931">+</span>&nbsp;<span class="num" id="4942933">1</span>&nbsp;<span class="comment" id="4942935">//&nbsp;+1&nbsp;for&nbsp;separator</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4942957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4942961">ncomments</span>&nbsp;<span class="op" id="4942971">+=</span>&nbsp;<span class="builtinfunc" id="4942974">len</span><span class="op" id="4942977">(</span><span class="ident" id="4942978">f</span><span class="op" id="4942979">.</span><span class="ident" id="4942980">Comments</span><span class="op" id="4942988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4942992">ndecls</span>&nbsp;<span class="op" id="4942999">+=</span>&nbsp;<span class="builtinfunc" id="4943002">len</span><span class="op" id="4943005">(</span><span class="ident" id="4943006">f</span><span class="op" id="4943007">.</span><span class="ident" id="4943008">Decls</span><span class="op" id="4943013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4943016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4943019">sort</span><span class="op" id="4943023">.</span><span class="ident" id="4943024">Strings</span><span class="op" id="4943031">(</span><span class="ident" id="4943032">filenames</span><span class="op" id="4943041">)</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4943045">//&nbsp;Collect&nbsp;package&nbsp;comments&nbsp;from&nbsp;all&nbsp;package&nbsp;files&nbsp;into&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4943111">//&nbsp;CommentGroup&nbsp;-&nbsp;the&nbsp;collected&nbsp;package&nbsp;documentation.&nbsp;In&nbsp;general</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4943178">//&nbsp;there&nbsp;should&nbsp;be&nbsp;only&nbsp;one&nbsp;file&nbsp;with&nbsp;a&nbsp;package&nbsp;comment;&nbsp;but&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4943245">//&nbsp;better&nbsp;to&nbsp;collect&nbsp;extra&nbsp;comments&nbsp;than&nbsp;drop&nbsp;them&nbsp;on&nbsp;the&nbsp;floor.</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4943311">var</span>&nbsp;<span class="ident" id="4943315">doc</span>&nbsp;<span class="op" id="4943319">*</span><span class="ident" id="4943320">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4943334">var</span>&nbsp;<span class="ident" id="4943338">pos</span>&nbsp;<span class="ident" id="4943342">token</span><span class="op" id="4943347">.</span><span class="ident" id="4943348">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4943353">if</span>&nbsp;<span class="ident" id="4943356">ndocs</span>&nbsp;<span class="op" id="4943362">&gt;</span>&nbsp;<span class="num" id="4943364">0</span>&nbsp;<span class="op" id="4943366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4943370">list</span>&nbsp;<span class="op" id="4943375">:=</span>&nbsp;<span class="builtinfunc" id="4943378">make</span><span class="op" id="4943382">(</span><span class="op" id="4943383">[</span><span class="op" id="4943384">]</span><span class="op" id="4943385">*</span><span class="ident" id="4943386">Comment</span><span class="op" id="4943393">,</span>&nbsp;<span class="ident" id="4943395">ndocs</span><span class="op" id="4943400">-</span><span class="num" id="4943401">1</span><span class="op" id="4943402">)</span>&nbsp;<span class="comment" id="4943404">//&nbsp;-1:&nbsp;no&nbsp;separator&nbsp;before&nbsp;first&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4943445">i</span>&nbsp;<span class="op" id="4943447">:=</span>&nbsp;<span class="num" id="4943450">0</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4943454">for</span>&nbsp;<span class="ident" id="4943458">_</span><span class="op" id="4943459">,</span>&nbsp;<span class="ident" id="4943461">filename</span>&nbsp;<span class="op" id="4943470">:=</span>&nbsp;<span class="keyword" id="4943473">range</span>&nbsp;<span class="ident" id="4943479">filenames</span>&nbsp;<span class="op" id="4943489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4943494">f</span>&nbsp;<span class="op" id="4943496">:=</span>&nbsp;<span class="ident" id="4943499">pkg</span><span class="op" id="4943502">.</span><span class="ident" id="4943503">Files</span><span class="op" id="4943508">[</span><span class="ident" id="4943509">filename</span><span class="op" id="4943517">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4943522">if</span>&nbsp;<span class="ident" id="4943525">f</span><span class="op" id="4943526">.</span><span class="ident" id="4943527">Doc</span>&nbsp;<span class="op" id="4943531">!=</span>&nbsp;<span class="builtintype" id="4943534">nil</span>&nbsp;<span class="op" id="4943538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4943544">if</span>&nbsp;<span class="ident" id="4943547">i</span>&nbsp;<span class="op" id="4943549">&gt;</span>&nbsp;<span class="num" id="4943551">0</span>&nbsp;<span class="op" id="4943553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4943560">//&nbsp;not&nbsp;the&nbsp;first&nbsp;group&nbsp;-&nbsp;add&nbsp;separator</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4943604">list</span><span class="op" id="4943608">[</span><span class="ident" id="4943609">i</span><span class="op" id="4943610">]</span>&nbsp;<span class="op" id="4943612">=</span>&nbsp;<span class="ident" id="4943614">separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4943629">i</span><span class="op" id="4943630">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4943637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4943643">for</span>&nbsp;<span class="ident" id="4943647">_</span><span class="op" id="4943648">,</span>&nbsp;<span class="ident" id="4943650">c</span>&nbsp;<span class="op" id="4943652">:=</span>&nbsp;<span class="keyword" id="4943655">range</span>&nbsp;<span class="ident" id="4943661">f</span><span class="op" id="4943662">.</span><span class="ident" id="4943663">Doc</span><span class="op" id="4943666">.</span><span class="ident" id="4943667">List</span>&nbsp;<span class="op" id="4943672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4943679">list</span><span class="op" id="4943683">[</span><span class="ident" id="4943684">i</span><span class="op" id="4943685">]</span>&nbsp;<span class="op" id="4943687">=</span>&nbsp;<span class="ident" id="4943689">c</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4943696">i</span><span class="op" id="4943697">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4943704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4943710">if</span>&nbsp;<span class="ident" id="4943713">f</span><span class="op" id="4943714">.</span><span class="ident" id="4943715">Package</span>&nbsp;<span class="op" id="4943723">&gt;</span>&nbsp;<span class="ident" id="4943725">pos</span>&nbsp;<span class="op" id="4943729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4943736">//&nbsp;Keep&nbsp;the&nbsp;maximum&nbsp;package&nbsp;clause&nbsp;position&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4943788">//&nbsp;position&nbsp;for&nbsp;the&nbsp;package&nbsp;clause&nbsp;of&nbsp;the&nbsp;merged</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4943842">//&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4943857">pos</span>&nbsp;<span class="op" id="4943861">=</span>&nbsp;<span class="ident" id="4943863">f</span><span class="op" id="4943864">.</span><span class="ident" id="4943865">Package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4943877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4943882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4943886">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4943890">doc</span>&nbsp;<span class="op" id="4943894">=</span>&nbsp;<span class="op" id="4943896">&amp;</span><span class="ident" id="4943897">CommentGroup</span><span class="op" id="4943909">{</span><span class="ident" id="4943910">list</span><span class="op" id="4943914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4943917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4943921">//&nbsp;Collect&nbsp;declarations&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4943970">var</span>&nbsp;<span class="ident" id="4943974">decls</span>&nbsp;<span class="op" id="4943980">[</span><span class="op" id="4943981">]</span><span class="ident" id="4943982">Decl</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4943988">if</span>&nbsp;<span class="ident" id="4943991">ndecls</span>&nbsp;<span class="op" id="4943998">&gt;</span>&nbsp;<span class="num" id="4944000">0</span>&nbsp;<span class="op" id="4944002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4944006">decls</span>&nbsp;<span class="op" id="4944012">=</span>&nbsp;<span class="builtinfunc" id="4944014">make</span><span class="op" id="4944018">(</span><span class="op" id="4944019">[</span><span class="op" id="4944020">]</span><span class="ident" id="4944021">Decl</span><span class="op" id="4944025">,</span>&nbsp;<span class="ident" id="4944027">ndecls</span><span class="op" id="4944033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4944037">funcs</span>&nbsp;<span class="op" id="4944043">:=</span>&nbsp;<span class="builtinfunc" id="4944046">make</span><span class="op" id="4944050">(</span><span class="keyword" id="4944051">map</span><span class="op" id="4944054">[</span><span class="builtintype" id="4944055">string</span><span class="op" id="4944061">]</span><span class="builtintype" id="4944062">int</span><span class="op" id="4944065">)</span>&nbsp;<span class="comment" id="4944067">//&nbsp;map&nbsp;of&nbsp;func&nbsp;name&nbsp;-&gt;&nbsp;decls&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4944104">i</span>&nbsp;<span class="op" id="4944106">:=</span>&nbsp;<span class="num" id="4944109">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4944134">//&nbsp;current&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4944153">n</span>&nbsp;<span class="op" id="4944155">:=</span>&nbsp;<span class="num" id="4944158">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4944183">//&nbsp;number&nbsp;of&nbsp;filtered&nbsp;entries</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4944215">for</span>&nbsp;<span class="ident" id="4944219">_</span><span class="op" id="4944220">,</span>&nbsp;<span class="ident" id="4944222">filename</span>&nbsp;<span class="op" id="4944231">:=</span>&nbsp;<span class="keyword" id="4944234">range</span>&nbsp;<span class="ident" id="4944240">filenames</span>&nbsp;<span class="op" id="4944250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4944255">f</span>&nbsp;<span class="op" id="4944257">:=</span>&nbsp;<span class="ident" id="4944260">pkg</span><span class="op" id="4944263">.</span><span class="ident" id="4944264">Files</span><span class="op" id="4944269">[</span><span class="ident" id="4944270">filename</span><span class="op" id="4944278">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4944283">for</span>&nbsp;<span class="ident" id="4944287">_</span><span class="op" id="4944288">,</span>&nbsp;<span class="ident" id="4944290">d</span>&nbsp;<span class="op" id="4944292">:=</span>&nbsp;<span class="keyword" id="4944295">range</span>&nbsp;<span class="ident" id="4944301">f</span><span class="op" id="4944302">.</span><span class="ident" id="4944303">Decls</span>&nbsp;<span class="op" id="4944309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4944315">if</span>&nbsp;<span class="ident" id="4944318">mode</span><span class="op" id="4944322">&amp;</span><span class="ident" id="4944323">FilterFuncDuplicates</span>&nbsp;<span class="op" id="4944344">!=</span>&nbsp;<span class="num" id="4944347">0</span>&nbsp;<span class="op" id="4944349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4944356">//&nbsp;A&nbsp;language&nbsp;entity&nbsp;may&nbsp;be&nbsp;declared&nbsp;multiple</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4944407">//&nbsp;times&nbsp;in&nbsp;different&nbsp;package&nbsp;files;&nbsp;only&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4944457">//&nbsp;build&nbsp;time&nbsp;declarations&nbsp;must&nbsp;be&nbsp;unique.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4944505">//&nbsp;For&nbsp;now,&nbsp;exclude&nbsp;multiple&nbsp;declarations&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4944555">//&nbsp;functions&nbsp;-&nbsp;keep&nbsp;the&nbsp;one&nbsp;with&nbsp;documentation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4944608">//</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4944616">//&nbsp;TODO(gri):&nbsp;Expand&nbsp;this&nbsp;filtering&nbsp;to&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4944666">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entities&nbsp;(const,&nbsp;type,&nbsp;vars)&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4944717">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multiple&nbsp;declarations&nbsp;are&nbsp;common.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4944770">if</span>&nbsp;<span class="ident" id="4944773">f</span><span class="op" id="4944774">,</span>&nbsp;<span class="ident" id="4944776">isFun</span>&nbsp;<span class="op" id="4944782">:=</span>&nbsp;<span class="ident" id="4944785">d</span><span class="op" id="4944786">.</span><span class="op" id="4944787">(</span><span class="op" id="4944788">*</span><span class="ident" id="4944789">FuncDecl</span><span class="op" id="4944797">)</span><span class="op" id="4944798">;</span>&nbsp;<span class="ident" id="4944800">isFun</span>&nbsp;<span class="op" id="4944806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4944814">name</span>&nbsp;<span class="op" id="4944819">:=</span>&nbsp;<span class="ident" id="4944822">nameOf</span><span class="op" id="4944828">(</span><span class="ident" id="4944829">f</span><span class="op" id="4944830">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4944838">if</span>&nbsp;<span class="ident" id="4944841">j</span><span class="op" id="4944842">,</span>&nbsp;<span class="ident" id="4944844">exists</span>&nbsp;<span class="op" id="4944851">:=</span>&nbsp;<span class="ident" id="4944854">funcs</span><span class="op" id="4944859">[</span><span class="ident" id="4944860">name</span><span class="op" id="4944864">]</span><span class="op" id="4944865">;</span>&nbsp;<span class="ident" id="4944867">exists</span>&nbsp;<span class="op" id="4944874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4944883">//&nbsp;function&nbsp;declared&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4944919">if</span>&nbsp;<span class="ident" id="4944922">decls</span><span class="op" id="4944927">[</span><span class="ident" id="4944928">j</span><span class="op" id="4944929">]</span>&nbsp;<span class="op" id="4944931">!=</span>&nbsp;<span class="builtintype" id="4944934">nil</span>&nbsp;<span class="op" id="4944938">&amp;&amp;</span>&nbsp;<span class="ident" id="4944941">decls</span><span class="op" id="4944946">[</span><span class="ident" id="4944947">j</span><span class="op" id="4944948">]</span><span class="op" id="4944949">.</span><span class="op" id="4944950">(</span><span class="op" id="4944951">*</span><span class="ident" id="4944952">FuncDecl</span><span class="op" id="4944960">)</span><span class="op" id="4944961">.</span><span class="ident" id="4944962">Doc</span>&nbsp;<span class="op" id="4944966">==</span>&nbsp;<span class="builtintype" id="4944969">nil</span>&nbsp;<span class="op" id="4944973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4944983">//&nbsp;existing&nbsp;declaration&nbsp;has&nbsp;no&nbsp;documentation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4945037">//&nbsp;ignore&nbsp;the&nbsp;existing&nbsp;declaration</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4945080">decls</span><span class="op" id="4945085">[</span><span class="ident" id="4945086">j</span><span class="op" id="4945087">]</span>&nbsp;<span class="op" id="4945089">=</span>&nbsp;<span class="builtintype" id="4945091">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4945102">}</span>&nbsp;<span class="keyword" id="4945104">else</span>&nbsp;<span class="op" id="4945109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4945119">//&nbsp;ignore&nbsp;the&nbsp;new&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4945157">d</span>&nbsp;<span class="op" id="4945159">=</span>&nbsp;<span class="builtintype" id="4945161">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4945172">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4945181">n</span><span class="op" id="4945182">++</span>&nbsp;<span class="comment" id="4945185">//&nbsp;filtered&nbsp;an&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4945212">}</span>&nbsp;<span class="keyword" id="4945214">else</span>&nbsp;<span class="op" id="4945219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4945228">funcs</span><span class="op" id="4945233">[</span><span class="ident" id="4945234">name</span><span class="op" id="4945238">]</span>&nbsp;<span class="op" id="4945240">=</span>&nbsp;<span class="ident" id="4945242">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4945250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4945257">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4945263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4945269">decls</span><span class="op" id="4945274">[</span><span class="ident" id="4945275">i</span><span class="op" id="4945276">]</span>&nbsp;<span class="op" id="4945278">=</span>&nbsp;<span class="ident" id="4945280">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4945286">i</span><span class="op" id="4945287">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4945293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4945297">}</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4945302">//&nbsp;Eliminate&nbsp;nil&nbsp;entries&nbsp;from&nbsp;the&nbsp;decls&nbsp;list&nbsp;if&nbsp;entries&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4945365">//&nbsp;filtered.&nbsp;We&nbsp;do&nbsp;this&nbsp;using&nbsp;a&nbsp;2nd&nbsp;pass&nbsp;in&nbsp;order&nbsp;to&nbsp;not&nbsp;disturb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4945432">//&nbsp;the&nbsp;original&nbsp;declaration&nbsp;order&nbsp;in&nbsp;the&nbsp;source&nbsp;(otherwise,&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4945499">//&nbsp;would&nbsp;also&nbsp;invalidate&nbsp;the&nbsp;monotonically&nbsp;increasing&nbsp;position</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4945564">//&nbsp;info&nbsp;within&nbsp;a&nbsp;single&nbsp;file).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4945597">if</span>&nbsp;<span class="ident" id="4945600">n</span>&nbsp;<span class="op" id="4945602">&gt;</span>&nbsp;<span class="num" id="4945604">0</span>&nbsp;<span class="op" id="4945606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4945611">i</span>&nbsp;<span class="op" id="4945613">=</span>&nbsp;<span class="num" id="4945615">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4945620">for</span>&nbsp;<span class="ident" id="4945624">_</span><span class="op" id="4945625">,</span>&nbsp;<span class="ident" id="4945627">d</span>&nbsp;<span class="op" id="4945629">:=</span>&nbsp;<span class="keyword" id="4945632">range</span>&nbsp;<span class="ident" id="4945638">decls</span>&nbsp;<span class="op" id="4945644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4945650">if</span>&nbsp;<span class="ident" id="4945653">d</span>&nbsp;<span class="op" id="4945655">!=</span>&nbsp;<span class="builtintype" id="4945658">nil</span>&nbsp;<span class="op" id="4945662">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4945669">decls</span><span class="op" id="4945674">[</span><span class="ident" id="4945675">i</span><span class="op" id="4945676">]</span>&nbsp;<span class="op" id="4945678">=</span>&nbsp;<span class="ident" id="4945680">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4945687">i</span><span class="op" id="4945688">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4945695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4945700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4945705">decls</span>&nbsp;<span class="op" id="4945711">=</span>&nbsp;<span class="ident" id="4945713">decls</span><span class="op" id="4945718">[</span><span class="num" id="4945719">0</span><span class="op" id="4945720">:</span><span class="ident" id="4945721">i</span><span class="op" id="4945722">]</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4945726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4945729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4945733">//&nbsp;Collect&nbsp;import&nbsp;specs&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4945782">var</span>&nbsp;<span class="ident" id="4945786">imports</span>&nbsp;<span class="op" id="4945794">[</span><span class="op" id="4945795">]</span><span class="op" id="4945796">*</span><span class="ident" id="4945797">ImportSpec</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4945809">if</span>&nbsp;<span class="ident" id="4945812">mode</span><span class="op" id="4945816">&amp;</span><span class="ident" id="4945817">FilterImportDuplicates</span>&nbsp;<span class="op" id="4945840">!=</span>&nbsp;<span class="num" id="4945843">0</span>&nbsp;<span class="op" id="4945845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4945849">seen</span>&nbsp;<span class="op" id="4945854">:=</span>&nbsp;<span class="builtinfunc" id="4945857">make</span><span class="op" id="4945861">(</span><span class="keyword" id="4945862">map</span><span class="op" id="4945865">[</span><span class="builtintype" id="4945866">string</span><span class="op" id="4945872">]</span><span class="builtintype" id="4945873">bool</span><span class="op" id="4945877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4945881">for</span>&nbsp;<span class="ident" id="4945885">_</span><span class="op" id="4945886">,</span>&nbsp;<span class="ident" id="4945888">filename</span>&nbsp;<span class="op" id="4945897">:=</span>&nbsp;<span class="keyword" id="4945900">range</span>&nbsp;<span class="ident" id="4945906">filenames</span>&nbsp;<span class="op" id="4945916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4945921">f</span>&nbsp;<span class="op" id="4945923">:=</span>&nbsp;<span class="ident" id="4945926">pkg</span><span class="op" id="4945929">.</span><span class="ident" id="4945930">Files</span><span class="op" id="4945935">[</span><span class="ident" id="4945936">filename</span><span class="op" id="4945944">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4945949">for</span>&nbsp;<span class="ident" id="4945953">_</span><span class="op" id="4945954">,</span>&nbsp;<span class="ident" id="4945956">imp</span>&nbsp;<span class="op" id="4945960">:=</span>&nbsp;<span class="keyword" id="4945963">range</span>&nbsp;<span class="ident" id="4945969">f</span><span class="op" id="4945970">.</span><span class="ident" id="4945971">Imports</span>&nbsp;<span class="op" id="4945979">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4945985">if</span>&nbsp;<span class="ident" id="4945988">path</span>&nbsp;<span class="op" id="4945993">:=</span>&nbsp;<span class="ident" id="4945996">imp</span><span class="op" id="4945999">.</span><span class="ident" id="4946000">Path</span><span class="op" id="4946004">.</span><span class="ident" id="4946005">Value</span><span class="op" id="4946010">;</span>&nbsp;<span class="op" id="4946012">!</span><span class="ident" id="4946013">seen</span><span class="op" id="4946017">[</span><span class="ident" id="4946018">path</span><span class="op" id="4946022">]</span>&nbsp;<span class="op" id="4946024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4946031">//&nbsp;TODO:&nbsp;consider&nbsp;handling&nbsp;cases&nbsp;where:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4946076">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;with&nbsp;the&nbsp;same&nbsp;import&nbsp;path&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4946132">//&nbsp;&nbsp;&nbsp;have&nbsp;different&nbsp;local&nbsp;names&nbsp;(one&nbsp;should&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4946190">//&nbsp;&nbsp;&nbsp;keep&nbsp;both&nbsp;of&nbsp;them)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4946219">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;but&nbsp;only&nbsp;one&nbsp;has&nbsp;a&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4946272">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;and&nbsp;they&nbsp;both&nbsp;have&nbsp;(possibly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4946327">//&nbsp;&nbsp;&nbsp;different)&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4946357">imports</span>&nbsp;<span class="op" id="4946365">=</span>&nbsp;<span class="builtinfunc" id="4946367">append</span><span class="op" id="4946373">(</span><span class="ident" id="4946374">imports</span><span class="op" id="4946381">,</span>&nbsp;<span class="ident" id="4946383">imp</span><span class="op" id="4946386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4946393">seen</span><span class="op" id="4946397">[</span><span class="ident" id="4946398">path</span><span class="op" id="4946402">]</span>&nbsp;<span class="op" id="4946404">=</span>&nbsp;<span class="builtintype" id="4946406">true</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4946415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4946420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4946424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4946427">}</span>&nbsp;<span class="keyword" id="4946429">else</span>&nbsp;<span class="op" id="4946434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4946438">for</span>&nbsp;<span class="ident" id="4946442">_</span><span class="op" id="4946443">,</span>&nbsp;<span class="ident" id="4946445">f</span>&nbsp;<span class="op" id="4946447">:=</span>&nbsp;<span class="keyword" id="4946450">range</span>&nbsp;<span class="ident" id="4946456">pkg</span><span class="op" id="4946459">.</span><span class="ident" id="4946460">Files</span>&nbsp;<span class="op" id="4946466">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4946471">imports</span>&nbsp;<span class="op" id="4946479">=</span>&nbsp;<span class="builtinfunc" id="4946481">append</span><span class="op" id="4946487">(</span><span class="ident" id="4946488">imports</span><span class="op" id="4946495">,</span>&nbsp;<span class="ident" id="4946497">f</span><span class="op" id="4946498">.</span><span class="ident" id="4946499">Imports</span><span class="op" id="4946506">...</span><span class="op" id="4946509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4946513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4946516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4946520">//&nbsp;Collect&nbsp;comments&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4946565">var</span>&nbsp;<span class="ident" id="4946569">comments</span>&nbsp;<span class="op" id="4946578">[</span><span class="op" id="4946579">]</span><span class="op" id="4946580">*</span><span class="ident" id="4946581">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4946595">if</span>&nbsp;<span class="ident" id="4946598">mode</span><span class="op" id="4946602">&amp;</span><span class="ident" id="4946603">FilterUnassociatedComments</span>&nbsp;<span class="op" id="4946630">==</span>&nbsp;<span class="num" id="4946633">0</span>&nbsp;<span class="op" id="4946635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4946639">comments</span>&nbsp;<span class="op" id="4946648">=</span>&nbsp;<span class="builtinfunc" id="4946650">make</span><span class="op" id="4946654">(</span><span class="op" id="4946655">[</span><span class="op" id="4946656">]</span><span class="op" id="4946657">*</span><span class="ident" id="4946658">CommentGroup</span><span class="op" id="4946670">,</span>&nbsp;<span class="ident" id="4946672">ncomments</span><span class="op" id="4946681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4946685">i</span>&nbsp;<span class="op" id="4946687">:=</span>&nbsp;<span class="num" id="4946690">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4946694">for</span>&nbsp;<span class="ident" id="4946698">_</span><span class="op" id="4946699">,</span>&nbsp;<span class="ident" id="4946701">f</span>&nbsp;<span class="op" id="4946703">:=</span>&nbsp;<span class="keyword" id="4946706">range</span>&nbsp;<span class="ident" id="4946712">pkg</span><span class="op" id="4946715">.</span><span class="ident" id="4946716">Files</span>&nbsp;<span class="op" id="4946722">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4946727">i</span>&nbsp;<span class="op" id="4946729">+=</span>&nbsp;<span class="builtinfunc" id="4946732">copy</span><span class="op" id="4946736">(</span><span class="ident" id="4946737">comments</span><span class="op" id="4946745">[</span><span class="ident" id="4946746">i</span><span class="op" id="4946747">:</span><span class="op" id="4946748">]</span><span class="op" id="4946749">,</span>&nbsp;<span class="ident" id="4946751">f</span><span class="op" id="4946752">.</span><span class="ident" id="4946753">Comments</span><span class="op" id="4946761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4946765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4946768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4946772">//&nbsp;TODO(gri)&nbsp;need&nbsp;to&nbsp;compute&nbsp;unresolved&nbsp;identifiers!</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4946826">return</span>&nbsp;<span class="op" id="4946833">&amp;</span><span class="ident" id="4946834">File</span><span class="op" id="4946838">{</span><span class="ident" id="4946839">doc</span><span class="op" id="4946842">,</span>&nbsp;<span class="ident" id="4946844">pos</span><span class="op" id="4946847">,</span>&nbsp;<span class="ident" id="4946849">NewIdent</span><span class="op" id="4946857">(</span><span class="ident" id="4946858">pkg</span><span class="op" id="4946861">.</span><span class="ident" id="4946862">Name</span><span class="op" id="4946866">)</span><span class="op" id="4946867">,</span>&nbsp;<span class="ident" id="4946869">decls</span><span class="op" id="4946874">,</span>&nbsp;<span class="ident" id="4946876">pkg</span><span class="op" id="4946879">.</span><span class="ident" id="4946880">Scope</span><span class="op" id="4946885">,</span>&nbsp;<span class="ident" id="4946887">imports</span><span class="op" id="4946894">,</span>&nbsp;<span class="builtintype" id="4946896">nil</span><span class="op" id="4946899">,</span>&nbsp;<span class="ident" id="4946901">comments</span><span class="op" id="4946909">}</span><br>
<span class="lineno"></span><span class="op" id="4946911">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
