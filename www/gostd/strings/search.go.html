<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>strings</h2>
<ul>
<li><a href="/gostd/strings/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/strings/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/strings/reader.go.html">reader.go</a></li>
<li><a href="/gostd/strings/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/strings/replace.go.html">replace.go</a></li>
<li><a href="/gostd/strings/replace_test.go.html">replace_test.go</a></li>
<li><a href="/gostd/strings/search.go.html">search.go</a></li>
<li><a href="/gostd/strings/search_test.go.html">search_test.go</a></li>
<li><a href="/gostd/strings/strings.go.html">strings.go</a></li>
<li><a href="/gostd/strings/strings_decl.go.html">strings_decl.go</a></li>
<li><a href="/gostd/strings/strings_test.go.html">strings_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2414918">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2414973">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2415027">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2415078">package</span>&nbsp;<span class="ident" id="2415086">strings</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2415095">//&nbsp;stringFinder&nbsp;efficiently&nbsp;finds&nbsp;strings&nbsp;in&nbsp;a&nbsp;source&nbsp;text.&nbsp;It&#39;s&nbsp;implemented</span><br>
<span class="lineno"></span><span class="comment" id="2415172">//&nbsp;using&nbsp;the&nbsp;Boyer-Moore&nbsp;string&nbsp;search&nbsp;algorithm:</span><br>
<span class="lineno"></span><span class="comment" id="2415222">//&nbsp;http://en.wikipedia.org/wiki/Boyer-Moore_string_search_algorithm</span><br>
<span class="lineno">10</span><span class="comment" id="2415290">//&nbsp;http://www.cs.utexas.edu/~moore/publications/fstrpos.pdf&nbsp;(note:&nbsp;this&nbsp;aged</span><br>
<span class="lineno"></span><span class="comment" id="2415367">//&nbsp;document&nbsp;uses&nbsp;1-based&nbsp;indexing)</span><br>
<span class="lineno"></span><span class="keyword" id="2415402">type</span>&nbsp;<span class="ident" id="2415407">stringFinder</span>&nbsp;<span class="keyword" id="2415420">struct</span>&nbsp;<span class="op" id="2415427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2415430">//&nbsp;pattern&nbsp;is&nbsp;the&nbsp;string&nbsp;that&nbsp;we&nbsp;are&nbsp;searching&nbsp;for&nbsp;in&nbsp;the&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2415495">pattern</span>&nbsp;<span class="builtintype" id="2415503">string</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2415512">//&nbsp;badCharSkip[b]&nbsp;contains&nbsp;the&nbsp;distance&nbsp;between&nbsp;the&nbsp;last&nbsp;byte&nbsp;of&nbsp;pattern</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2415586">//&nbsp;and&nbsp;the&nbsp;rightmost&nbsp;occurrence&nbsp;of&nbsp;b&nbsp;in&nbsp;pattern.&nbsp;If&nbsp;b&nbsp;is&nbsp;not&nbsp;in&nbsp;pattern,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2415660">//&nbsp;badCharSkip[b]&nbsp;is&nbsp;len(pattern).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2415696">//</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2415700">//&nbsp;Whenever&nbsp;a&nbsp;mismatch&nbsp;is&nbsp;found&nbsp;with&nbsp;byte&nbsp;b&nbsp;in&nbsp;the&nbsp;text,&nbsp;we&nbsp;can&nbsp;safely</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2415772">//&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;at&nbsp;least&nbsp;badCharSkip[b]&nbsp;until&nbsp;the&nbsp;next&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2415845">//&nbsp;the&nbsp;matching&nbsp;char&nbsp;could&nbsp;be&nbsp;in&nbsp;alignment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2415890">badCharSkip</span>&nbsp;<span class="op" id="2415902">[</span><span class="num" id="2415903">256</span><span class="op" id="2415906">]</span><span class="builtintype" id="2415907">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2415913">//&nbsp;goodSuffixSkip[i]&nbsp;defines&nbsp;how&nbsp;far&nbsp;we&nbsp;can&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2415989">//&nbsp;that&nbsp;the&nbsp;suffix&nbsp;pattern[i+1:]&nbsp;matches,&nbsp;but&nbsp;the&nbsp;byte&nbsp;pattern[i]&nbsp;does</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2416061">//&nbsp;not.&nbsp;There&nbsp;are&nbsp;two&nbsp;cases&nbsp;to&nbsp;consider:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2416103">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2416107">//&nbsp;1.&nbsp;The&nbsp;matched&nbsp;suffix&nbsp;occurs&nbsp;elsewhere&nbsp;in&nbsp;pattern&nbsp;(with&nbsp;a&nbsp;different</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2416179">//&nbsp;byte&nbsp;preceding&nbsp;it&nbsp;that&nbsp;we&nbsp;might&nbsp;possibly&nbsp;match).&nbsp;In&nbsp;this&nbsp;case,&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2416253">//&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;to&nbsp;align&nbsp;with&nbsp;the&nbsp;next&nbsp;suffix&nbsp;chunk.&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2416323">//&nbsp;example,&nbsp;the&nbsp;pattern&nbsp;&#34;mississi&#34;&nbsp;has&nbsp;the&nbsp;suffix&nbsp;&#34;issi&#34;&nbsp;next&nbsp;occurring</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2416396">//&nbsp;(in&nbsp;right-to-left&nbsp;order)&nbsp;at&nbsp;index&nbsp;1,&nbsp;so&nbsp;goodSuffixSkip[3]&nbsp;==</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2416461">//&nbsp;shift+len(suffix)&nbsp;==&nbsp;3+4&nbsp;==&nbsp;7.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2416496">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2416500">//&nbsp;2.&nbsp;If&nbsp;the&nbsp;matched&nbsp;suffix&nbsp;does&nbsp;not&nbsp;occur&nbsp;elsewhere&nbsp;in&nbsp;pattern,&nbsp;then&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2416575">//&nbsp;matching&nbsp;frame&nbsp;may&nbsp;share&nbsp;part&nbsp;of&nbsp;its&nbsp;prefix&nbsp;with&nbsp;the&nbsp;end&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2416643">//&nbsp;matching&nbsp;suffix.&nbsp;In&nbsp;this&nbsp;case,&nbsp;goodSuffixSkip[i]&nbsp;will&nbsp;contain&nbsp;how&nbsp;far</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2416717">//&nbsp;to&nbsp;shift&nbsp;the&nbsp;frame&nbsp;to&nbsp;align&nbsp;this&nbsp;portion&nbsp;of&nbsp;the&nbsp;prefix&nbsp;to&nbsp;the</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2416783">//&nbsp;suffix.&nbsp;For&nbsp;example,&nbsp;in&nbsp;the&nbsp;pattern&nbsp;&#34;abcxxxabc&#34;,&nbsp;when&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2416851">//&nbsp;mismatch&nbsp;from&nbsp;the&nbsp;back&nbsp;is&nbsp;found&nbsp;to&nbsp;be&nbsp;in&nbsp;position&nbsp;3,&nbsp;the&nbsp;matching</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2416921">//&nbsp;suffix&nbsp;&#34;xxabc&#34;&nbsp;is&nbsp;not&nbsp;found&nbsp;elsewhere&nbsp;in&nbsp;the&nbsp;pattern.&nbsp;However,&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2416992">//&nbsp;rightmost&nbsp;&#34;abc&#34;&nbsp;(at&nbsp;position&nbsp;6)&nbsp;is&nbsp;a&nbsp;prefix&nbsp;of&nbsp;the&nbsp;whole&nbsp;pattern,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2417065">//&nbsp;goodSuffixSkip[3]&nbsp;==&nbsp;shift+len(suffix)&nbsp;==&nbsp;6+5&nbsp;==&nbsp;11.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2417122">goodSuffixSkip</span>&nbsp;<span class="op" id="2417137">[</span><span class="op" id="2417138">]</span><span class="builtintype" id="2417139">int</span><br>
<span class="lineno"></span><span class="op" id="2417143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2417146">func</span>&nbsp;<span class="ident" id="2417151">makeStringFinder</span><span class="op" id="2417167">(</span><span class="ident" id="2417168">pattern</span>&nbsp;<span class="builtintype" id="2417176">string</span><span class="op" id="2417182">)</span>&nbsp;<span class="op" id="2417184">*</span><span class="ident" id="2417185">stringFinder</span>&nbsp;<span class="op" id="2417198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2417201">f</span>&nbsp;<span class="op" id="2417203">:=</span>&nbsp;<span class="op" id="2417206">&amp;</span><span class="ident" id="2417207">stringFinder</span><span class="op" id="2417219">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2417223">pattern</span><span class="op" id="2417230">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2417239">pattern</span><span class="op" id="2417246">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2417250">goodSuffixSkip</span><span class="op" id="2417264">:</span>&nbsp;<span class="builtinfunc" id="2417266">make</span><span class="op" id="2417270">(</span><span class="op" id="2417271">[</span><span class="op" id="2417272">]</span><span class="builtintype" id="2417273">int</span><span class="op" id="2417276">,</span>&nbsp;<span class="builtinfunc" id="2417278">len</span><span class="op" id="2417281">(</span><span class="ident" id="2417282">pattern</span><span class="op" id="2417289">)</span><span class="op" id="2417290">)</span><span class="op" id="2417291">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2417294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2417297">//&nbsp;last&nbsp;is&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;character&nbsp;in&nbsp;the&nbsp;pattern.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2417357">last</span>&nbsp;<span class="op" id="2417362">:=</span>&nbsp;<span class="builtinfunc" id="2417365">len</span><span class="op" id="2417368">(</span><span class="ident" id="2417369">pattern</span><span class="op" id="2417376">)</span>&nbsp;<span class="op" id="2417378">-</span>&nbsp;<span class="num" id="2417380">1</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2417384">//&nbsp;Build&nbsp;bad&nbsp;character&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2417415">//&nbsp;Bytes&nbsp;not&nbsp;in&nbsp;the&nbsp;pattern&nbsp;can&nbsp;skip&nbsp;one&nbsp;pattern&#39;s&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2417475">for</span>&nbsp;<span class="ident" id="2417479">i</span>&nbsp;<span class="op" id="2417481">:=</span>&nbsp;<span class="keyword" id="2417484">range</span>&nbsp;<span class="ident" id="2417490">f</span><span class="op" id="2417491">.</span><span class="ident" id="2417492">badCharSkip</span>&nbsp;<span class="op" id="2417504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2417508">f</span><span class="op" id="2417509">.</span><span class="ident" id="2417510">badCharSkip</span><span class="op" id="2417521">[</span><span class="ident" id="2417522">i</span><span class="op" id="2417523">]</span>&nbsp;<span class="op" id="2417525">=</span>&nbsp;<span class="builtinfunc" id="2417527">len</span><span class="op" id="2417530">(</span><span class="ident" id="2417531">pattern</span><span class="op" id="2417538">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2417541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2417544">//&nbsp;The&nbsp;loop&nbsp;condition&nbsp;is&nbsp;&lt;&nbsp;instead&nbsp;of&nbsp;&lt;=&nbsp;so&nbsp;that&nbsp;the&nbsp;last&nbsp;byte&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2417617">//&nbsp;have&nbsp;a&nbsp;zero&nbsp;distance&nbsp;to&nbsp;itself.&nbsp;Finding&nbsp;this&nbsp;byte&nbsp;out&nbsp;of&nbsp;place&nbsp;implies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2417692">//&nbsp;that&nbsp;it&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;last&nbsp;position.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2417733">for</span>&nbsp;<span class="ident" id="2417737">i</span>&nbsp;<span class="op" id="2417739">:=</span>&nbsp;<span class="num" id="2417742">0</span><span class="op" id="2417743">;</span>&nbsp;<span class="ident" id="2417745">i</span>&nbsp;<span class="op" id="2417747">&lt;</span>&nbsp;<span class="ident" id="2417749">last</span><span class="op" id="2417753">;</span>&nbsp;<span class="ident" id="2417755">i</span><span class="op" id="2417756">++</span>&nbsp;<span class="op" id="2417759">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2417763">f</span><span class="op" id="2417764">.</span><span class="ident" id="2417765">badCharSkip</span><span class="op" id="2417776">[</span><span class="ident" id="2417777">pattern</span><span class="op" id="2417784">[</span><span class="ident" id="2417785">i</span><span class="op" id="2417786">]</span><span class="op" id="2417787">]</span>&nbsp;<span class="op" id="2417789">=</span>&nbsp;<span class="ident" id="2417791">last</span>&nbsp;<span class="op" id="2417796">-</span>&nbsp;<span class="ident" id="2417798">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2417801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2417805">//&nbsp;Build&nbsp;good&nbsp;suffix&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2417834">//&nbsp;First&nbsp;pass:&nbsp;set&nbsp;each&nbsp;value&nbsp;to&nbsp;the&nbsp;next&nbsp;index&nbsp;which&nbsp;starts&nbsp;a&nbsp;prefix&nbsp;of</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2417908">//&nbsp;pattern.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2417921">lastPrefix</span>&nbsp;<span class="op" id="2417932">:=</span>&nbsp;<span class="ident" id="2417935">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2417941">for</span>&nbsp;<span class="ident" id="2417945">i</span>&nbsp;<span class="op" id="2417947">:=</span>&nbsp;<span class="ident" id="2417950">last</span><span class="op" id="2417954">;</span>&nbsp;<span class="ident" id="2417956">i</span>&nbsp;<span class="op" id="2417958">&gt;=</span>&nbsp;<span class="num" id="2417961">0</span><span class="op" id="2417962">;</span>&nbsp;<span class="ident" id="2417964">i</span><span class="op" id="2417965">--</span>&nbsp;<span class="op" id="2417968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2417972">if</span>&nbsp;<span class="ident" id="2417975">HasPrefix</span><span class="op" id="2417984">(</span><span class="ident" id="2417985">pattern</span><span class="op" id="2417992">,</span>&nbsp;<span class="ident" id="2417994">pattern</span><span class="op" id="2418001">[</span><span class="ident" id="2418002">i</span><span class="op" id="2418003">+</span><span class="num" id="2418004">1</span><span class="op" id="2418005">:</span><span class="op" id="2418006">]</span><span class="op" id="2418007">)</span>&nbsp;<span class="op" id="2418009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2418014">lastPrefix</span>&nbsp;<span class="op" id="2418025">=</span>&nbsp;<span class="ident" id="2418027">i</span>&nbsp;<span class="op" id="2418029">+</span>&nbsp;<span class="num" id="2418031">1</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2418035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2418039">//&nbsp;lastPrefix&nbsp;is&nbsp;the&nbsp;shift,&nbsp;and&nbsp;(last-i)&nbsp;is&nbsp;len(suffix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2418098">f</span><span class="op" id="2418099">.</span><span class="ident" id="2418100">goodSuffixSkip</span><span class="op" id="2418114">[</span><span class="ident" id="2418115">i</span><span class="op" id="2418116">]</span>&nbsp;<span class="op" id="2418118">=</span>&nbsp;<span class="ident" id="2418120">lastPrefix</span>&nbsp;<span class="op" id="2418131">+</span>&nbsp;<span class="ident" id="2418133">last</span>&nbsp;<span class="op" id="2418138">-</span>&nbsp;<span class="ident" id="2418140">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2418143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2418146">//&nbsp;Second&nbsp;pass:&nbsp;find&nbsp;repeats&nbsp;of&nbsp;pattern&#39;s&nbsp;suffix&nbsp;starting&nbsp;from&nbsp;the&nbsp;front.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2418221">for</span>&nbsp;<span class="ident" id="2418225">i</span>&nbsp;<span class="op" id="2418227">:=</span>&nbsp;<span class="num" id="2418230">0</span><span class="op" id="2418231">;</span>&nbsp;<span class="ident" id="2418233">i</span>&nbsp;<span class="op" id="2418235">&lt;</span>&nbsp;<span class="ident" id="2418237">last</span><span class="op" id="2418241">;</span>&nbsp;<span class="ident" id="2418243">i</span><span class="op" id="2418244">++</span>&nbsp;<span class="op" id="2418247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2418251">lenSuffix</span>&nbsp;<span class="op" id="2418261">:=</span>&nbsp;<span class="ident" id="2418264">longestCommonSuffix</span><span class="op" id="2418283">(</span><span class="ident" id="2418284">pattern</span><span class="op" id="2418291">,</span>&nbsp;<span class="ident" id="2418293">pattern</span><span class="op" id="2418300">[</span><span class="num" id="2418301">1</span><span class="op" id="2418302">:</span><span class="ident" id="2418303">i</span><span class="op" id="2418304">+</span><span class="num" id="2418305">1</span><span class="op" id="2418306">]</span><span class="op" id="2418307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2418311">if</span>&nbsp;<span class="ident" id="2418314">pattern</span><span class="op" id="2418321">[</span><span class="ident" id="2418322">i</span><span class="op" id="2418323">-</span><span class="ident" id="2418324">lenSuffix</span><span class="op" id="2418333">]</span>&nbsp;<span class="op" id="2418335">!=</span>&nbsp;<span class="ident" id="2418338">pattern</span><span class="op" id="2418345">[</span><span class="ident" id="2418346">last</span><span class="op" id="2418350">-</span><span class="ident" id="2418351">lenSuffix</span><span class="op" id="2418360">]</span>&nbsp;<span class="op" id="2418362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2418367">//&nbsp;(last-i)&nbsp;is&nbsp;the&nbsp;shift,&nbsp;and&nbsp;lenSuffix&nbsp;is&nbsp;len(suffix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2418426">f</span><span class="op" id="2418427">.</span><span class="ident" id="2418428">goodSuffixSkip</span><span class="op" id="2418442">[</span><span class="ident" id="2418443">last</span><span class="op" id="2418447">-</span><span class="ident" id="2418448">lenSuffix</span><span class="op" id="2418457">]</span>&nbsp;<span class="op" id="2418459">=</span>&nbsp;<span class="ident" id="2418461">lenSuffix</span>&nbsp;<span class="op" id="2418471">+</span>&nbsp;<span class="ident" id="2418473">last</span>&nbsp;<span class="op" id="2418478">-</span>&nbsp;<span class="ident" id="2418480">i</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2418484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2418487">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2418491">return</span>&nbsp;<span class="ident" id="2418498">f</span><br>
<span class="lineno"></span><span class="op" id="2418500">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="2418503">func</span>&nbsp;<span class="ident" id="2418508">longestCommonSuffix</span><span class="op" id="2418527">(</span><span class="ident" id="2418528">a</span><span class="op" id="2418529">,</span>&nbsp;<span class="ident" id="2418531">b</span>&nbsp;<span class="builtintype" id="2418533">string</span><span class="op" id="2418539">)</span>&nbsp;<span class="op" id="2418541">(</span><span class="ident" id="2418542">i</span>&nbsp;<span class="builtintype" id="2418544">int</span><span class="op" id="2418547">)</span>&nbsp;<span class="op" id="2418549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2418552">for</span>&nbsp;<span class="op" id="2418556">;</span>&nbsp;<span class="ident" id="2418558">i</span>&nbsp;<span class="op" id="2418560">&lt;</span>&nbsp;<span class="builtinfunc" id="2418562">len</span><span class="op" id="2418565">(</span><span class="ident" id="2418566">a</span><span class="op" id="2418567">)</span>&nbsp;<span class="op" id="2418569">&amp;&amp;</span>&nbsp;<span class="ident" id="2418572">i</span>&nbsp;<span class="op" id="2418574">&lt;</span>&nbsp;<span class="builtinfunc" id="2418576">len</span><span class="op" id="2418579">(</span><span class="ident" id="2418580">b</span><span class="op" id="2418581">)</span><span class="op" id="2418582">;</span>&nbsp;<span class="ident" id="2418584">i</span><span class="op" id="2418585">++</span>&nbsp;<span class="op" id="2418588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2418592">if</span>&nbsp;<span class="ident" id="2418595">a</span><span class="op" id="2418596">[</span><span class="builtinfunc" id="2418597">len</span><span class="op" id="2418600">(</span><span class="ident" id="2418601">a</span><span class="op" id="2418602">)</span><span class="op" id="2418603">-</span><span class="num" id="2418604">1</span><span class="op" id="2418605">-</span><span class="ident" id="2418606">i</span><span class="op" id="2418607">]</span>&nbsp;<span class="op" id="2418609">!=</span>&nbsp;<span class="ident" id="2418612">b</span><span class="op" id="2418613">[</span><span class="builtinfunc" id="2418614">len</span><span class="op" id="2418617">(</span><span class="ident" id="2418618">b</span><span class="op" id="2418619">)</span><span class="op" id="2418620">-</span><span class="num" id="2418621">1</span><span class="op" id="2418622">-</span><span class="ident" id="2418623">i</span><span class="op" id="2418624">]</span>&nbsp;<span class="op" id="2418626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2418631">break</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2418639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2418642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2418645">return</span><br>
<span class="lineno"></span><span class="op" id="2418652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="2418655">//&nbsp;next&nbsp;returns&nbsp;the&nbsp;index&nbsp;in&nbsp;text&nbsp;of&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;the&nbsp;pattern.&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="2418732">//&nbsp;the&nbsp;pattern&nbsp;is&nbsp;not&nbsp;found,&nbsp;it&nbsp;returns&nbsp;-1.</span><br>
<span class="lineno"></span><span class="keyword" id="2418776">func</span>&nbsp;<span class="op" id="2418781">(</span><span class="ident" id="2418782">f</span>&nbsp;<span class="op" id="2418784">*</span><span class="ident" id="2418785">stringFinder</span><span class="op" id="2418797">)</span>&nbsp;<span class="ident" id="2418799">next</span><span class="op" id="2418803">(</span><span class="ident" id="2418804">text</span>&nbsp;<span class="builtintype" id="2418809">string</span><span class="op" id="2418815">)</span>&nbsp;<span class="builtintype" id="2418817">int</span>&nbsp;<span class="op" id="2418821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2418824">i</span>&nbsp;<span class="op" id="2418826">:=</span>&nbsp;<span class="builtinfunc" id="2418829">len</span><span class="op" id="2418832">(</span><span class="ident" id="2418833">f</span><span class="op" id="2418834">.</span><span class="ident" id="2418835">pattern</span><span class="op" id="2418842">)</span>&nbsp;<span class="op" id="2418844">-</span>&nbsp;<span class="num" id="2418846">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2418849">for</span>&nbsp;<span class="ident" id="2418853">i</span>&nbsp;<span class="op" id="2418855">&lt;</span>&nbsp;<span class="builtinfunc" id="2418857">len</span><span class="op" id="2418860">(</span><span class="ident" id="2418861">text</span><span class="op" id="2418865">)</span>&nbsp;<span class="op" id="2418867">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2418871">//&nbsp;Compare&nbsp;backwards&nbsp;from&nbsp;the&nbsp;end&nbsp;until&nbsp;the&nbsp;first&nbsp;unmatching&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2418945">j</span>&nbsp;<span class="op" id="2418947">:=</span>&nbsp;<span class="builtinfunc" id="2418950">len</span><span class="op" id="2418953">(</span><span class="ident" id="2418954">f</span><span class="op" id="2418955">.</span><span class="ident" id="2418956">pattern</span><span class="op" id="2418963">)</span>&nbsp;<span class="op" id="2418965">-</span>&nbsp;<span class="num" id="2418967">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2418971">for</span>&nbsp;<span class="ident" id="2418975">j</span>&nbsp;<span class="op" id="2418977">&gt;=</span>&nbsp;<span class="num" id="2418980">0</span>&nbsp;<span class="op" id="2418982">&amp;&amp;</span>&nbsp;<span class="ident" id="2418985">text</span><span class="op" id="2418989">[</span><span class="ident" id="2418990">i</span><span class="op" id="2418991">]</span>&nbsp;<span class="op" id="2418993">==</span>&nbsp;<span class="ident" id="2418996">f</span><span class="op" id="2418997">.</span><span class="ident" id="2418998">pattern</span><span class="op" id="2419005">[</span><span class="ident" id="2419006">j</span><span class="op" id="2419007">]</span>&nbsp;<span class="op" id="2419009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2419014">i</span><span class="op" id="2419015">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2419021">j</span><span class="op" id="2419022">--</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2419027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2419031">if</span>&nbsp;<span class="ident" id="2419034">j</span>&nbsp;<span class="op" id="2419036">&lt;</span>&nbsp;<span class="num" id="2419038">0</span>&nbsp;<span class="op" id="2419040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2419045">return</span>&nbsp;<span class="ident" id="2419052">i</span>&nbsp;<span class="op" id="2419054">+</span>&nbsp;<span class="num" id="2419056">1</span>&nbsp;<span class="comment" id="2419058">//&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2419069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2419073">i</span>&nbsp;<span class="op" id="2419075">+=</span>&nbsp;<span class="ident" id="2419078">max</span><span class="op" id="2419081">(</span><span class="ident" id="2419082">f</span><span class="op" id="2419083">.</span><span class="ident" id="2419084">badCharSkip</span><span class="op" id="2419095">[</span><span class="ident" id="2419096">text</span><span class="op" id="2419100">[</span><span class="ident" id="2419101">i</span><span class="op" id="2419102">]</span><span class="op" id="2419103">]</span><span class="op" id="2419104">,</span>&nbsp;<span class="ident" id="2419106">f</span><span class="op" id="2419107">.</span><span class="ident" id="2419108">goodSuffixSkip</span><span class="op" id="2419122">[</span><span class="ident" id="2419123">j</span><span class="op" id="2419124">]</span><span class="op" id="2419125">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2419128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2419131">return</span>&nbsp;<span class="op" id="2419138">-</span><span class="num" id="2419139">1</span><br>
<span class="lineno"></span><span class="op" id="2419141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2419144">func</span>&nbsp;<span class="ident" id="2419149">max</span><span class="op" id="2419152">(</span><span class="ident" id="2419153">a</span><span class="op" id="2419154">,</span>&nbsp;<span class="ident" id="2419156">b</span>&nbsp;<span class="builtintype" id="2419158">int</span><span class="op" id="2419161">)</span>&nbsp;<span class="builtintype" id="2419163">int</span>&nbsp;<span class="op" id="2419167">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2419170">if</span>&nbsp;<span class="ident" id="2419173">a</span>&nbsp;<span class="op" id="2419175">&gt;</span>&nbsp;<span class="ident" id="2419177">b</span>&nbsp;<span class="op" id="2419179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2419183">return</span>&nbsp;<span class="ident" id="2419190">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2419193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2419196">return</span>&nbsp;<span class="ident" id="2419203">b</span><br>
<span class="lineno"></span><span class="op" id="2419205">}</span>
</div>
</body>
</html>
