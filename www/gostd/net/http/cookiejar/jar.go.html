<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/cookiejar</h2>
<ul>
<li><a href="/gostd/net/http/cookiejar/jar.go.html" class="current">jar.go</a></li>
<li><a href="/gostd/net/http/cookiejar/jar_test.go.html">jar_test.go</a></li>
<li><a href="/gostd/net/http/cookiejar/punycode.go.html">punycode.go</a></li>
<li><a href="/gostd/net/http/cookiejar/punycode_test.go.html">punycode_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5191638">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5191693">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5191747">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5191798">//&nbsp;Package&nbsp;cookiejar&nbsp;implements&nbsp;an&nbsp;in-memory&nbsp;RFC&nbsp;6265-compliant&nbsp;http.CookieJar.</span><br>
<span class="lineno"></span><span class="keyword" id="5191878">package</span>&nbsp;<span class="ident" id="5191886">cookiejar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5191897">import</span>&nbsp;<span class="op" id="5191904">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5191907">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5191917">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5191924">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5191931">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5191943">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5191954">&#34;sort&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5191962">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5191973">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5191981">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="5191988">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="5191991">//&nbsp;PublicSuffixList&nbsp;provides&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;a&nbsp;domain.&nbsp;For&nbsp;example:</span><br>
<span class="lineno"></span><span class="comment" id="5192064">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;example.com&#34;&nbsp;is&nbsp;&#34;com&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5192119">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;foo1.foo2.foo3.co.uk&#34;&nbsp;is&nbsp;&#34;co.uk&#34;,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5192189">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;bar.pvt.k12.ma.us&#34;&nbsp;is&nbsp;&#34;pvt.k12.ma.us&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="5192260">//</span><br>
<span class="lineno">25</span><span class="comment" id="5192263">//&nbsp;Implementations&nbsp;of&nbsp;PublicSuffixList&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5192337">//&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="comment" id="5192361">//</span><br>
<span class="lineno"></span><span class="comment" id="5192364">//&nbsp;An&nbsp;implementation&nbsp;that&nbsp;always&nbsp;returns&nbsp;&#34;&#34;&nbsp;is&nbsp;valid&nbsp;and&nbsp;may&nbsp;be&nbsp;useful&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5192439">//&nbsp;testing&nbsp;but&nbsp;it&nbsp;is&nbsp;not&nbsp;secure:&nbsp;it&nbsp;means&nbsp;that&nbsp;the&nbsp;HTTP&nbsp;server&nbsp;for&nbsp;foo.com&nbsp;can</span><br>
<span class="lineno">30</span><span class="comment" id="5192518">//&nbsp;set&nbsp;a&nbsp;cookie&nbsp;for&nbsp;bar.com.</span><br>
<span class="lineno"></span><span class="comment" id="5192547">//</span><br>
<span class="lineno"></span><span class="comment" id="5192550">//&nbsp;A&nbsp;public&nbsp;suffix&nbsp;list&nbsp;implementation&nbsp;is&nbsp;in&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="5192607">//&nbsp;golang.org/x/net/publicsuffix.</span><br>
<span class="lineno"></span><span class="keyword" id="5192641">type</span>&nbsp;<span class="ident" id="5192646">PublicSuffixList</span>&nbsp;<span class="keyword" id="5192663">interface</span>&nbsp;<span class="op" id="5192673">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5192676">//&nbsp;PublicSuffix&nbsp;returns&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;domain.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5192730">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5192734">//&nbsp;TODO:&nbsp;specify&nbsp;which&nbsp;of&nbsp;the&nbsp;caller&nbsp;and&nbsp;callee&nbsp;is&nbsp;responsible&nbsp;for&nbsp;IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5192805">//&nbsp;addresses,&nbsp;for&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;dots,&nbsp;for&nbsp;case&nbsp;sensitivity,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5192877">//&nbsp;for&nbsp;IDN/Punycode.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5192899">PublicSuffix</span><span class="op" id="5192911">(</span><span class="ident" id="5192912">domain</span>&nbsp;<span class="builtintype" id="5192919">string</span><span class="op" id="5192925">)</span>&nbsp;<span class="builtintype" id="5192927">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5192936">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;source&nbsp;of&nbsp;this&nbsp;public&nbsp;suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5193005">//&nbsp;list.&nbsp;The&nbsp;description&nbsp;will&nbsp;typically&nbsp;contain&nbsp;something&nbsp;like&nbsp;a&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5193076">//&nbsp;stamp&nbsp;or&nbsp;version&nbsp;number.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5193105">String</span><span class="op" id="5193111">(</span><span class="op" id="5193112">)</span>&nbsp;<span class="builtintype" id="5193114">string</span><br>
<span class="lineno"></span><span class="op" id="5193121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5193124">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;options&nbsp;for&nbsp;creating&nbsp;a&nbsp;new&nbsp;Jar.</span><br>
<span class="lineno"></span><span class="keyword" id="5193175">type</span>&nbsp;<span class="ident" id="5193180">Options</span>&nbsp;<span class="keyword" id="5193188">struct</span>&nbsp;<span class="op" id="5193195">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5193198">//&nbsp;PublicSuffixList&nbsp;is&nbsp;the&nbsp;public&nbsp;suffix&nbsp;list&nbsp;that&nbsp;determines&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5193269">//&nbsp;an&nbsp;HTTP&nbsp;server&nbsp;can&nbsp;set&nbsp;a&nbsp;cookie&nbsp;for&nbsp;a&nbsp;domain.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5193319">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5193323">//&nbsp;A&nbsp;nil&nbsp;value&nbsp;is&nbsp;valid&nbsp;and&nbsp;may&nbsp;be&nbsp;useful&nbsp;for&nbsp;testing&nbsp;but&nbsp;it&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5193392">//&nbsp;secure:&nbsp;it&nbsp;means&nbsp;that&nbsp;the&nbsp;HTTP&nbsp;server&nbsp;for&nbsp;foo.co.uk&nbsp;can&nbsp;set&nbsp;a&nbsp;cookie</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5193465">//&nbsp;for&nbsp;bar.co.uk.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5193484">PublicSuffixList</span>&nbsp;<span class="ident" id="5193501">PublicSuffixList</span><br>
<span class="lineno"></span><span class="op" id="5193518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5193521">//&nbsp;Jar&nbsp;implements&nbsp;the&nbsp;http.CookieJar&nbsp;interface&nbsp;from&nbsp;the&nbsp;net/http&nbsp;package.</span><br>
<span class="lineno">60</span><span class="keyword" id="5193595">type</span>&nbsp;<span class="ident" id="5193600">Jar</span>&nbsp;<span class="keyword" id="5193604">struct</span>&nbsp;<span class="op" id="5193611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5193614">psList</span>&nbsp;<span class="ident" id="5193621">PublicSuffixList</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5193640">//&nbsp;mu&nbsp;locks&nbsp;the&nbsp;remaining&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5193675">mu</span>&nbsp;<span class="ident" id="5193678">sync</span><span class="op" id="5193682">.</span><span class="ident" id="5193683">Mutex</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5193691">//&nbsp;entries&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;entries,&nbsp;keyed&nbsp;by&nbsp;their&nbsp;eTLD+1&nbsp;and&nbsp;subkeyed&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5193762">//&nbsp;their&nbsp;name/domain/path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5193790">entries</span>&nbsp;<span class="keyword" id="5193798">map</span><span class="op" id="5193801">[</span><span class="builtintype" id="5193802">string</span><span class="op" id="5193808">]</span><span class="keyword" id="5193809">map</span><span class="op" id="5193812">[</span><span class="builtintype" id="5193813">string</span><span class="op" id="5193819">]</span><span class="ident" id="5193820">entry</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5193828">//&nbsp;nextSeqNum&nbsp;is&nbsp;the&nbsp;next&nbsp;sequence&nbsp;number&nbsp;assigned&nbsp;to&nbsp;a&nbsp;new&nbsp;cookie</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5193896">//&nbsp;created&nbsp;SetCookies.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5193920">nextSeqNum</span>&nbsp;<span class="builtintype" id="5193931">uint64</span><br>
<span class="lineno"></span><span class="op" id="5193938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="5193941">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;cookie&nbsp;jar.&nbsp;A&nbsp;nil&nbsp;*Options&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;a&nbsp;zero</span><br>
<span class="lineno"></span><span class="comment" id="5194013">//&nbsp;Options.</span><br>
<span class="lineno"></span><span class="keyword" id="5194025">func</span>&nbsp;<span class="ident" id="5194030">New</span><span class="op" id="5194033">(</span><span class="ident" id="5194034">o</span>&nbsp;<span class="op" id="5194036">*</span><span class="ident" id="5194037">Options</span><span class="op" id="5194044">)</span>&nbsp;<span class="op" id="5194046">(</span><span class="op" id="5194047">*</span><span class="ident" id="5194048">Jar</span><span class="op" id="5194051">,</span>&nbsp;<span class="builtintype" id="5194053">error</span><span class="op" id="5194058">)</span>&nbsp;<span class="op" id="5194060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5194063">jar</span>&nbsp;<span class="op" id="5194067">:=</span>&nbsp;<span class="op" id="5194070">&amp;</span><span class="ident" id="5194071">Jar</span><span class="op" id="5194074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5194078">entries</span><span class="op" id="5194085">:</span>&nbsp;<span class="builtinfunc" id="5194087">make</span><span class="op" id="5194091">(</span><span class="keyword" id="5194092">map</span><span class="op" id="5194095">[</span><span class="builtintype" id="5194096">string</span><span class="op" id="5194102">]</span><span class="keyword" id="5194103">map</span><span class="op" id="5194106">[</span><span class="builtintype" id="5194107">string</span><span class="op" id="5194113">]</span><span class="ident" id="5194114">entry</span><span class="op" id="5194119">)</span><span class="op" id="5194120">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5194123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5194126">if</span>&nbsp;<span class="ident" id="5194129">o</span>&nbsp;<span class="op" id="5194131">!=</span>&nbsp;<span class="builtintype" id="5194134">nil</span>&nbsp;<span class="op" id="5194138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5194142">jar</span><span class="op" id="5194145">.</span><span class="ident" id="5194146">psList</span>&nbsp;<span class="op" id="5194153">=</span>&nbsp;<span class="ident" id="5194155">o</span><span class="op" id="5194156">.</span><span class="ident" id="5194157">PublicSuffixList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5194175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5194178">return</span>&nbsp;<span class="ident" id="5194185">jar</span><span class="op" id="5194188">,</span>&nbsp;<span class="builtintype" id="5194190">nil</span><br>
<span class="lineno">85</span><span class="op" id="5194194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5194197">//&nbsp;entry&nbsp;is&nbsp;the&nbsp;internal&nbsp;representation&nbsp;of&nbsp;a&nbsp;cookie.</span><br>
<span class="lineno"></span><span class="comment" id="5194250">//</span><br>
<span class="lineno"></span><span class="comment" id="5194253">//&nbsp;This&nbsp;struct&nbsp;type&nbsp;is&nbsp;not&nbsp;used&nbsp;outside&nbsp;of&nbsp;this&nbsp;package&nbsp;per&nbsp;se,&nbsp;but&nbsp;the&nbsp;exported</span><br>
<span class="lineno">90</span><span class="comment" id="5194334">//&nbsp;fields&nbsp;are&nbsp;those&nbsp;of&nbsp;RFC&nbsp;6265.</span><br>
<span class="lineno"></span><span class="keyword" id="5194367">type</span>&nbsp;<span class="ident" id="5194372">entry</span>&nbsp;<span class="keyword" id="5194378">struct</span>&nbsp;<span class="op" id="5194385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5194388">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5194399">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5194407">Value</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5194418">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5194426">Domain</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5194437">string</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5194445">Path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5194456">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5194464">Secure</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5194475">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5194481">HttpOnly</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5194492">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5194498">Persistent</span>&nbsp;<span class="builtintype" id="5194509">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5194515">HostOnly</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5194526">bool</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5194532">Expires</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5194543">time</span><span class="op" id="5194547">.</span><span class="ident" id="5194548">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5194554">Creation</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5194565">time</span><span class="op" id="5194569">.</span><span class="ident" id="5194570">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5194576">LastAccess</span>&nbsp;<span class="ident" id="5194587">time</span><span class="op" id="5194591">.</span><span class="ident" id="5194592">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5194599">//&nbsp;seqNum&nbsp;is&nbsp;a&nbsp;sequence&nbsp;number&nbsp;so&nbsp;that&nbsp;Cookies&nbsp;returns&nbsp;cookies&nbsp;in&nbsp;a</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5194668">//&nbsp;deterministic&nbsp;order,&nbsp;even&nbsp;for&nbsp;cookies&nbsp;that&nbsp;have&nbsp;equal&nbsp;Path&nbsp;length&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5194742">//&nbsp;equal&nbsp;Creation&nbsp;time.&nbsp;This&nbsp;simplifies&nbsp;testing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5194792">seqNum</span>&nbsp;<span class="builtintype" id="5194799">uint64</span><br>
<span class="lineno"></span><span class="op" id="5194806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="5194809">//&nbsp;Id&nbsp;returns&nbsp;the&nbsp;domain;path;name&nbsp;triple&nbsp;of&nbsp;e&nbsp;as&nbsp;an&nbsp;id.</span><br>
<span class="lineno"></span><span class="keyword" id="5194866">func</span>&nbsp;<span class="op" id="5194871">(</span><span class="ident" id="5194872">e</span>&nbsp;<span class="op" id="5194874">*</span><span class="ident" id="5194875">entry</span><span class="op" id="5194880">)</span>&nbsp;<span class="ident" id="5194882">id</span><span class="op" id="5194884">(</span><span class="op" id="5194885">)</span>&nbsp;<span class="builtintype" id="5194887">string</span>&nbsp;<span class="op" id="5194894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5194897">return</span>&nbsp;<span class="ident" id="5194904">fmt</span><span class="op" id="5194907">.</span><span class="ident" id="5194908">Sprintf</span><span class="op" id="5194915">(</span><span class="string" id="5194916">&#34;%s;%s;%s&#34;</span><span class="op" id="5194926">,</span>&nbsp;<span class="ident" id="5194928">e</span><span class="op" id="5194929">.</span><span class="ident" id="5194930">Domain</span><span class="op" id="5194936">,</span>&nbsp;<span class="ident" id="5194938">e</span><span class="op" id="5194939">.</span><span class="ident" id="5194940">Path</span><span class="op" id="5194944">,</span>&nbsp;<span class="ident" id="5194946">e</span><span class="op" id="5194947">.</span><span class="ident" id="5194948">Name</span><span class="op" id="5194952">)</span><br>
<span class="lineno"></span><span class="op" id="5194954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="5194957">//&nbsp;shouldSend&nbsp;determines&nbsp;whether&nbsp;e&#39;s&nbsp;cookie&nbsp;qualifies&nbsp;to&nbsp;be&nbsp;included&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5195031">//&nbsp;request&nbsp;to&nbsp;host/path.&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;check&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5195106">//&nbsp;cookie&nbsp;is&nbsp;expired.</span><br>
<span class="lineno"></span><span class="keyword" id="5195128">func</span>&nbsp;<span class="op" id="5195133">(</span><span class="ident" id="5195134">e</span>&nbsp;<span class="op" id="5195136">*</span><span class="ident" id="5195137">entry</span><span class="op" id="5195142">)</span>&nbsp;<span class="ident" id="5195144">shouldSend</span><span class="op" id="5195154">(</span><span class="ident" id="5195155">https</span>&nbsp;<span class="builtintype" id="5195161">bool</span><span class="op" id="5195165">,</span>&nbsp;<span class="ident" id="5195167">host</span><span class="op" id="5195171">,</span>&nbsp;<span class="ident" id="5195173">path</span>&nbsp;<span class="builtintype" id="5195178">string</span><span class="op" id="5195184">)</span>&nbsp;<span class="builtintype" id="5195186">bool</span>&nbsp;<span class="op" id="5195191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5195194">return</span>&nbsp;<span class="ident" id="5195201">e</span><span class="op" id="5195202">.</span><span class="ident" id="5195203">domainMatch</span><span class="op" id="5195214">(</span><span class="ident" id="5195215">host</span><span class="op" id="5195219">)</span>&nbsp;<span class="op" id="5195221">&amp;&amp;</span>&nbsp;<span class="ident" id="5195224">e</span><span class="op" id="5195225">.</span><span class="ident" id="5195226">pathMatch</span><span class="op" id="5195235">(</span><span class="ident" id="5195236">path</span><span class="op" id="5195240">)</span>&nbsp;<span class="op" id="5195242">&amp;&amp;</span>&nbsp;<span class="op" id="5195245">(</span><span class="ident" id="5195246">https</span>&nbsp;<span class="op" id="5195252">||</span>&nbsp;<span class="op" id="5195255">!</span><span class="ident" id="5195256">e</span><span class="op" id="5195257">.</span><span class="ident" id="5195258">Secure</span><span class="op" id="5195264">)</span><br>
<span class="lineno">120</span><span class="op" id="5195266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5195269">//&nbsp;domainMatch&nbsp;implements&nbsp;&#34;domain-match&#34;&nbsp;of&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.3.</span><br>
<span class="lineno"></span><span class="keyword" id="5195337">func</span>&nbsp;<span class="op" id="5195342">(</span><span class="ident" id="5195343">e</span>&nbsp;<span class="op" id="5195345">*</span><span class="ident" id="5195346">entry</span><span class="op" id="5195351">)</span>&nbsp;<span class="ident" id="5195353">domainMatch</span><span class="op" id="5195364">(</span><span class="ident" id="5195365">host</span>&nbsp;<span class="builtintype" id="5195370">string</span><span class="op" id="5195376">)</span>&nbsp;<span class="builtintype" id="5195378">bool</span>&nbsp;<span class="op" id="5195383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5195386">if</span>&nbsp;<span class="ident" id="5195389">e</span><span class="op" id="5195390">.</span><span class="ident" id="5195391">Domain</span>&nbsp;<span class="op" id="5195398">==</span>&nbsp;<span class="ident" id="5195401">host</span>&nbsp;<span class="op" id="5195406">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5195410">return</span>&nbsp;<span class="builtintype" id="5195417">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5195423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5195426">return</span>&nbsp;<span class="op" id="5195433">!</span><span class="ident" id="5195434">e</span><span class="op" id="5195435">.</span><span class="ident" id="5195436">HostOnly</span>&nbsp;<span class="op" id="5195445">&amp;&amp;</span>&nbsp;<span class="ident" id="5195448">hasDotSuffix</span><span class="op" id="5195460">(</span><span class="ident" id="5195461">host</span><span class="op" id="5195465">,</span>&nbsp;<span class="ident" id="5195467">e</span><span class="op" id="5195468">.</span><span class="ident" id="5195469">Domain</span><span class="op" id="5195475">)</span><br>
<span class="lineno"></span><span class="op" id="5195477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="5195480">//&nbsp;pathMatch&nbsp;implements&nbsp;&#34;path-match&#34;&nbsp;according&nbsp;to&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.4.</span><br>
<span class="lineno"></span><span class="keyword" id="5195554">func</span>&nbsp;<span class="op" id="5195559">(</span><span class="ident" id="5195560">e</span>&nbsp;<span class="op" id="5195562">*</span><span class="ident" id="5195563">entry</span><span class="op" id="5195568">)</span>&nbsp;<span class="ident" id="5195570">pathMatch</span><span class="op" id="5195579">(</span><span class="ident" id="5195580">requestPath</span>&nbsp;<span class="builtintype" id="5195592">string</span><span class="op" id="5195598">)</span>&nbsp;<span class="builtintype" id="5195600">bool</span>&nbsp;<span class="op" id="5195605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5195608">if</span>&nbsp;<span class="ident" id="5195611">requestPath</span>&nbsp;<span class="op" id="5195623">==</span>&nbsp;<span class="ident" id="5195626">e</span><span class="op" id="5195627">.</span><span class="ident" id="5195628">Path</span>&nbsp;<span class="op" id="5195633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5195637">return</span>&nbsp;<span class="builtintype" id="5195644">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5195650">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5195653">if</span>&nbsp;<span class="ident" id="5195656">strings</span><span class="op" id="5195663">.</span><span class="ident" id="5195664">HasPrefix</span><span class="op" id="5195673">(</span><span class="ident" id="5195674">requestPath</span><span class="op" id="5195685">,</span>&nbsp;<span class="ident" id="5195687">e</span><span class="op" id="5195688">.</span><span class="ident" id="5195689">Path</span><span class="op" id="5195693">)</span>&nbsp;<span class="op" id="5195695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5195699">if</span>&nbsp;<span class="ident" id="5195702">e</span><span class="op" id="5195703">.</span><span class="ident" id="5195704">Path</span><span class="op" id="5195708">[</span><span class="builtinfunc" id="5195709">len</span><span class="op" id="5195712">(</span><span class="ident" id="5195713">e</span><span class="op" id="5195714">.</span><span class="ident" id="5195715">Path</span><span class="op" id="5195719">)</span><span class="op" id="5195720">-</span><span class="num" id="5195721">1</span><span class="op" id="5195722">]</span>&nbsp;<span class="op" id="5195724">==</span>&nbsp;<span class="string" id="5195727">&#39;/&#39;</span>&nbsp;<span class="op" id="5195731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5195736">return</span>&nbsp;<span class="builtintype" id="5195743">true</span>&nbsp;<span class="comment" id="5195748">//&nbsp;The&nbsp;&#34;/any/&#34;&nbsp;matches&nbsp;&#34;/any/path&#34;&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5195791">}</span>&nbsp;<span class="keyword" id="5195793">else</span>&nbsp;<span class="keyword" id="5195798">if</span>&nbsp;<span class="ident" id="5195801">requestPath</span><span class="op" id="5195812">[</span><span class="builtinfunc" id="5195813">len</span><span class="op" id="5195816">(</span><span class="ident" id="5195817">e</span><span class="op" id="5195818">.</span><span class="ident" id="5195819">Path</span><span class="op" id="5195823">)</span><span class="op" id="5195824">]</span>&nbsp;<span class="op" id="5195826">==</span>&nbsp;<span class="string" id="5195829">&#39;/&#39;</span>&nbsp;<span class="op" id="5195833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5195838">return</span>&nbsp;<span class="builtintype" id="5195845">true</span>&nbsp;<span class="comment" id="5195850">//&nbsp;The&nbsp;&#34;/any&#34;&nbsp;matches&nbsp;&#34;/any/path&#34;&nbsp;case.</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5195892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5195895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5195898">return</span>&nbsp;<span class="builtintype" id="5195905">false</span><br>
<span class="lineno"></span><span class="op" id="5195911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="5195914">//&nbsp;hasDotSuffix&nbsp;reports&nbsp;whether&nbsp;s&nbsp;ends&nbsp;in&nbsp;&#34;.&#34;+suffix.</span><br>
<span class="lineno"></span><span class="keyword" id="5195968">func</span>&nbsp;<span class="ident" id="5195973">hasDotSuffix</span><span class="op" id="5195985">(</span><span class="ident" id="5195986">s</span><span class="op" id="5195987">,</span>&nbsp;<span class="ident" id="5195989">suffix</span>&nbsp;<span class="builtintype" id="5195996">string</span><span class="op" id="5196002">)</span>&nbsp;<span class="builtintype" id="5196004">bool</span>&nbsp;<span class="op" id="5196009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5196012">return</span>&nbsp;<span class="builtinfunc" id="5196019">len</span><span class="op" id="5196022">(</span><span class="ident" id="5196023">s</span><span class="op" id="5196024">)</span>&nbsp;<span class="op" id="5196026">&gt;</span>&nbsp;<span class="builtinfunc" id="5196028">len</span><span class="op" id="5196031">(</span><span class="ident" id="5196032">suffix</span><span class="op" id="5196038">)</span>&nbsp;<span class="op" id="5196040">&amp;&amp;</span>&nbsp;<span class="ident" id="5196043">s</span><span class="op" id="5196044">[</span><span class="builtinfunc" id="5196045">len</span><span class="op" id="5196048">(</span><span class="ident" id="5196049">s</span><span class="op" id="5196050">)</span><span class="op" id="5196051">-</span><span class="builtinfunc" id="5196052">len</span><span class="op" id="5196055">(</span><span class="ident" id="5196056">suffix</span><span class="op" id="5196062">)</span><span class="op" id="5196063">-</span><span class="num" id="5196064">1</span><span class="op" id="5196065">]</span>&nbsp;<span class="op" id="5196067">==</span>&nbsp;<span class="string" id="5196070">&#39;.&#39;</span>&nbsp;<span class="op" id="5196074">&amp;&amp;</span>&nbsp;<span class="ident" id="5196077">s</span><span class="op" id="5196078">[</span><span class="builtinfunc" id="5196079">len</span><span class="op" id="5196082">(</span><span class="ident" id="5196083">s</span><span class="op" id="5196084">)</span><span class="op" id="5196085">-</span><span class="builtinfunc" id="5196086">len</span><span class="op" id="5196089">(</span><span class="ident" id="5196090">suffix</span><span class="op" id="5196096">)</span><span class="op" id="5196097">:</span><span class="op" id="5196098">]</span>&nbsp;<span class="op" id="5196100">==</span>&nbsp;<span class="ident" id="5196103">suffix</span><br>
<span class="lineno"></span><span class="op" id="5196110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="5196113">//&nbsp;byPathLength&nbsp;is&nbsp;a&nbsp;[]entry&nbsp;sort.Interface&nbsp;that&nbsp;sorts&nbsp;according&nbsp;to&nbsp;RFC&nbsp;6265</span><br>
<span class="lineno"></span><span class="comment" id="5196190">//&nbsp;section&nbsp;5.4&nbsp;point&nbsp;2:&nbsp;by&nbsp;longest&nbsp;path&nbsp;and&nbsp;then&nbsp;by&nbsp;earliest&nbsp;creation&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="5196266">type</span>&nbsp;<span class="ident" id="5196271">byPathLength</span>&nbsp;<span class="op" id="5196284">[</span><span class="op" id="5196285">]</span><span class="ident" id="5196286">entry</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5196293">func</span>&nbsp;<span class="op" id="5196298">(</span><span class="ident" id="5196299">s</span>&nbsp;<span class="ident" id="5196301">byPathLength</span><span class="op" id="5196313">)</span>&nbsp;<span class="ident" id="5196315">Len</span><span class="op" id="5196318">(</span><span class="op" id="5196319">)</span>&nbsp;<span class="builtintype" id="5196321">int</span>&nbsp;<span class="op" id="5196325">{</span>&nbsp;<span class="keyword" id="5196327">return</span>&nbsp;<span class="builtinfunc" id="5196334">len</span><span class="op" id="5196337">(</span><span class="ident" id="5196338">s</span><span class="op" id="5196339">)</span>&nbsp;<span class="op" id="5196341">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="5196344">func</span>&nbsp;<span class="op" id="5196349">(</span><span class="ident" id="5196350">s</span>&nbsp;<span class="ident" id="5196352">byPathLength</span><span class="op" id="5196364">)</span>&nbsp;<span class="ident" id="5196366">Less</span><span class="op" id="5196370">(</span><span class="ident" id="5196371">i</span><span class="op" id="5196372">,</span>&nbsp;<span class="ident" id="5196374">j</span>&nbsp;<span class="builtintype" id="5196376">int</span><span class="op" id="5196379">)</span>&nbsp;<span class="builtintype" id="5196381">bool</span>&nbsp;<span class="op" id="5196386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5196389">if</span>&nbsp;<span class="builtinfunc" id="5196392">len</span><span class="op" id="5196395">(</span><span class="ident" id="5196396">s</span><span class="op" id="5196397">[</span><span class="ident" id="5196398">i</span><span class="op" id="5196399">]</span><span class="op" id="5196400">.</span><span class="ident" id="5196401">Path</span><span class="op" id="5196405">)</span>&nbsp;<span class="op" id="5196407">!=</span>&nbsp;<span class="builtinfunc" id="5196410">len</span><span class="op" id="5196413">(</span><span class="ident" id="5196414">s</span><span class="op" id="5196415">[</span><span class="ident" id="5196416">j</span><span class="op" id="5196417">]</span><span class="op" id="5196418">.</span><span class="ident" id="5196419">Path</span><span class="op" id="5196423">)</span>&nbsp;<span class="op" id="5196425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5196429">return</span>&nbsp;<span class="builtinfunc" id="5196436">len</span><span class="op" id="5196439">(</span><span class="ident" id="5196440">s</span><span class="op" id="5196441">[</span><span class="ident" id="5196442">i</span><span class="op" id="5196443">]</span><span class="op" id="5196444">.</span><span class="ident" id="5196445">Path</span><span class="op" id="5196449">)</span>&nbsp;<span class="op" id="5196451">&gt;</span>&nbsp;<span class="builtinfunc" id="5196453">len</span><span class="op" id="5196456">(</span><span class="ident" id="5196457">s</span><span class="op" id="5196458">[</span><span class="ident" id="5196459">j</span><span class="op" id="5196460">]</span><span class="op" id="5196461">.</span><span class="ident" id="5196462">Path</span><span class="op" id="5196466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5196469">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5196472">if</span>&nbsp;<span class="op" id="5196475">!</span><span class="ident" id="5196476">s</span><span class="op" id="5196477">[</span><span class="ident" id="5196478">i</span><span class="op" id="5196479">]</span><span class="op" id="5196480">.</span><span class="ident" id="5196481">Creation</span><span class="op" id="5196489">.</span><span class="ident" id="5196490">Equal</span><span class="op" id="5196495">(</span><span class="ident" id="5196496">s</span><span class="op" id="5196497">[</span><span class="ident" id="5196498">j</span><span class="op" id="5196499">]</span><span class="op" id="5196500">.</span><span class="ident" id="5196501">Creation</span><span class="op" id="5196509">)</span>&nbsp;<span class="op" id="5196511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5196515">return</span>&nbsp;<span class="ident" id="5196522">s</span><span class="op" id="5196523">[</span><span class="ident" id="5196524">i</span><span class="op" id="5196525">]</span><span class="op" id="5196526">.</span><span class="ident" id="5196527">Creation</span><span class="op" id="5196535">.</span><span class="ident" id="5196536">Before</span><span class="op" id="5196542">(</span><span class="ident" id="5196543">s</span><span class="op" id="5196544">[</span><span class="ident" id="5196545">j</span><span class="op" id="5196546">]</span><span class="op" id="5196547">.</span><span class="ident" id="5196548">Creation</span><span class="op" id="5196556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5196559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5196562">return</span>&nbsp;<span class="ident" id="5196569">s</span><span class="op" id="5196570">[</span><span class="ident" id="5196571">i</span><span class="op" id="5196572">]</span><span class="op" id="5196573">.</span><span class="ident" id="5196574">seqNum</span>&nbsp;<span class="op" id="5196581">&lt;</span>&nbsp;<span class="ident" id="5196583">s</span><span class="op" id="5196584">[</span><span class="ident" id="5196585">j</span><span class="op" id="5196586">]</span><span class="op" id="5196587">.</span><span class="ident" id="5196588">seqNum</span><br>
<span class="lineno"></span><span class="op" id="5196595">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="5196598">func</span>&nbsp;<span class="op" id="5196603">(</span><span class="ident" id="5196604">s</span>&nbsp;<span class="ident" id="5196606">byPathLength</span><span class="op" id="5196618">)</span>&nbsp;<span class="ident" id="5196620">Swap</span><span class="op" id="5196624">(</span><span class="ident" id="5196625">i</span><span class="op" id="5196626">,</span>&nbsp;<span class="ident" id="5196628">j</span>&nbsp;<span class="builtintype" id="5196630">int</span><span class="op" id="5196633">)</span>&nbsp;<span class="op" id="5196635">{</span>&nbsp;<span class="ident" id="5196637">s</span><span class="op" id="5196638">[</span><span class="ident" id="5196639">i</span><span class="op" id="5196640">]</span><span class="op" id="5196641">,</span>&nbsp;<span class="ident" id="5196643">s</span><span class="op" id="5196644">[</span><span class="ident" id="5196645">j</span><span class="op" id="5196646">]</span>&nbsp;<span class="op" id="5196648">=</span>&nbsp;<span class="ident" id="5196650">s</span><span class="op" id="5196651">[</span><span class="ident" id="5196652">j</span><span class="op" id="5196653">]</span><span class="op" id="5196654">,</span>&nbsp;<span class="ident" id="5196656">s</span><span class="op" id="5196657">[</span><span class="ident" id="5196658">i</span><span class="op" id="5196659">]</span>&nbsp;<span class="op" id="5196661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5196664">//&nbsp;Cookies&nbsp;implements&nbsp;the&nbsp;Cookies&nbsp;method&nbsp;of&nbsp;the&nbsp;http.CookieJar&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="5196738">//</span><br>
<span class="lineno">170</span><span class="comment" id="5196741">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;empty&nbsp;slice&nbsp;if&nbsp;the&nbsp;URL&#39;s&nbsp;scheme&nbsp;is&nbsp;not&nbsp;HTTP&nbsp;or&nbsp;HTTPS.</span><br>
<span class="lineno"></span><span class="keyword" id="5196812">func</span>&nbsp;<span class="op" id="5196817">(</span><span class="ident" id="5196818">j</span>&nbsp;<span class="op" id="5196820">*</span><span class="ident" id="5196821">Jar</span><span class="op" id="5196824">)</span>&nbsp;<span class="ident" id="5196826">Cookies</span><span class="op" id="5196833">(</span><span class="ident" id="5196834">u</span>&nbsp;<span class="op" id="5196836">*</span><span class="ident" id="5196837">url</span><span class="op" id="5196840">.</span><span class="ident" id="5196841">URL</span><span class="op" id="5196844">)</span>&nbsp;<span class="op" id="5196846">(</span><span class="ident" id="5196847">cookies</span>&nbsp;<span class="op" id="5196855">[</span><span class="op" id="5196856">]</span><span class="op" id="5196857">*</span><span class="ident" id="5196858">http</span><span class="op" id="5196862">.</span><span class="ident" id="5196863">Cookie</span><span class="op" id="5196869">)</span>&nbsp;<span class="op" id="5196871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5196874">return</span>&nbsp;<span class="ident" id="5196881">j</span><span class="op" id="5196882">.</span><span class="ident" id="5196883">cookies</span><span class="op" id="5196890">(</span><span class="ident" id="5196891">u</span><span class="op" id="5196892">,</span>&nbsp;<span class="ident" id="5196894">time</span><span class="op" id="5196898">.</span><span class="ident" id="5196899">Now</span><span class="op" id="5196902">(</span><span class="op" id="5196903">)</span><span class="op" id="5196904">)</span><br>
<span class="lineno"></span><span class="op" id="5196906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="5196909">//&nbsp;cookies&nbsp;is&nbsp;like&nbsp;Cookies&nbsp;but&nbsp;takes&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;a&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="keyword" id="5196979">func</span>&nbsp;<span class="op" id="5196984">(</span><span class="ident" id="5196985">j</span>&nbsp;<span class="op" id="5196987">*</span><span class="ident" id="5196988">Jar</span><span class="op" id="5196991">)</span>&nbsp;<span class="ident" id="5196993">cookies</span><span class="op" id="5197000">(</span><span class="ident" id="5197001">u</span>&nbsp;<span class="op" id="5197003">*</span><span class="ident" id="5197004">url</span><span class="op" id="5197007">.</span><span class="ident" id="5197008">URL</span><span class="op" id="5197011">,</span>&nbsp;<span class="ident" id="5197013">now</span>&nbsp;<span class="ident" id="5197017">time</span><span class="op" id="5197021">.</span><span class="ident" id="5197022">Time</span><span class="op" id="5197026">)</span>&nbsp;<span class="op" id="5197028">(</span><span class="ident" id="5197029">cookies</span>&nbsp;<span class="op" id="5197037">[</span><span class="op" id="5197038">]</span><span class="op" id="5197039">*</span><span class="ident" id="5197040">http</span><span class="op" id="5197044">.</span><span class="ident" id="5197045">Cookie</span><span class="op" id="5197051">)</span>&nbsp;<span class="op" id="5197053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5197056">if</span>&nbsp;<span class="ident" id="5197059">u</span><span class="op" id="5197060">.</span><span class="ident" id="5197061">Scheme</span>&nbsp;<span class="op" id="5197068">!=</span>&nbsp;<span class="string" id="5197071">&#34;http&#34;</span>&nbsp;<span class="op" id="5197078">&amp;&amp;</span>&nbsp;<span class="ident" id="5197081">u</span><span class="op" id="5197082">.</span><span class="ident" id="5197083">Scheme</span>&nbsp;<span class="op" id="5197090">!=</span>&nbsp;<span class="string" id="5197093">&#34;https&#34;</span>&nbsp;<span class="op" id="5197101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5197105">return</span>&nbsp;<span class="ident" id="5197112">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5197121">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5197124">host</span><span class="op" id="5197128">,</span>&nbsp;<span class="ident" id="5197130">err</span>&nbsp;<span class="op" id="5197134">:=</span>&nbsp;<span class="ident" id="5197137">canonicalHost</span><span class="op" id="5197150">(</span><span class="ident" id="5197151">u</span><span class="op" id="5197152">.</span><span class="ident" id="5197153">Host</span><span class="op" id="5197157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5197160">if</span>&nbsp;<span class="ident" id="5197163">err</span>&nbsp;<span class="op" id="5197167">!=</span>&nbsp;<span class="builtintype" id="5197170">nil</span>&nbsp;<span class="op" id="5197174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5197178">return</span>&nbsp;<span class="ident" id="5197185">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5197194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5197197">key</span>&nbsp;<span class="op" id="5197201">:=</span>&nbsp;<span class="ident" id="5197204">jarKey</span><span class="op" id="5197210">(</span><span class="ident" id="5197211">host</span><span class="op" id="5197215">,</span>&nbsp;<span class="ident" id="5197217">j</span><span class="op" id="5197218">.</span><span class="ident" id="5197219">psList</span><span class="op" id="5197225">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5197229">j</span><span class="op" id="5197230">.</span><span class="ident" id="5197231">mu</span><span class="op" id="5197233">.</span><span class="ident" id="5197234">Lock</span><span class="op" id="5197238">(</span><span class="op" id="5197239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5197242">defer</span>&nbsp;<span class="ident" id="5197248">j</span><span class="op" id="5197249">.</span><span class="ident" id="5197250">mu</span><span class="op" id="5197252">.</span><span class="ident" id="5197253">Unlock</span><span class="op" id="5197259">(</span><span class="op" id="5197260">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5197264">submap</span>&nbsp;<span class="op" id="5197271">:=</span>&nbsp;<span class="ident" id="5197274">j</span><span class="op" id="5197275">.</span><span class="ident" id="5197276">entries</span><span class="op" id="5197283">[</span><span class="ident" id="5197284">key</span><span class="op" id="5197287">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5197290">if</span>&nbsp;<span class="ident" id="5197293">submap</span>&nbsp;<span class="op" id="5197300">==</span>&nbsp;<span class="builtintype" id="5197303">nil</span>&nbsp;<span class="op" id="5197307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5197311">return</span>&nbsp;<span class="ident" id="5197318">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5197327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5197331">https</span>&nbsp;<span class="op" id="5197337">:=</span>&nbsp;<span class="ident" id="5197340">u</span><span class="op" id="5197341">.</span><span class="ident" id="5197342">Scheme</span>&nbsp;<span class="op" id="5197349">==</span>&nbsp;<span class="string" id="5197352">&#34;https&#34;</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5197361">path</span>&nbsp;<span class="op" id="5197366">:=</span>&nbsp;<span class="ident" id="5197369">u</span><span class="op" id="5197370">.</span><span class="ident" id="5197371">Path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5197377">if</span>&nbsp;<span class="ident" id="5197380">path</span>&nbsp;<span class="op" id="5197385">==</span>&nbsp;<span class="string" id="5197388">&#34;&#34;</span>&nbsp;<span class="op" id="5197391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5197395">path</span>&nbsp;<span class="op" id="5197400">=</span>&nbsp;<span class="string" id="5197402">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5197407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5197411">modified</span>&nbsp;<span class="op" id="5197420">:=</span>&nbsp;<span class="builtintype" id="5197423">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5197430">var</span>&nbsp;<span class="ident" id="5197434">selected</span>&nbsp;<span class="op" id="5197443">[</span><span class="op" id="5197444">]</span><span class="ident" id="5197445">entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5197452">for</span>&nbsp;<span class="ident" id="5197456">id</span><span class="op" id="5197458">,</span>&nbsp;<span class="ident" id="5197460">e</span>&nbsp;<span class="op" id="5197462">:=</span>&nbsp;<span class="keyword" id="5197465">range</span>&nbsp;<span class="ident" id="5197471">submap</span>&nbsp;<span class="op" id="5197478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5197482">if</span>&nbsp;<span class="ident" id="5197485">e</span><span class="op" id="5197486">.</span><span class="ident" id="5197487">Persistent</span>&nbsp;<span class="op" id="5197498">&amp;&amp;</span>&nbsp;<span class="op" id="5197501">!</span><span class="ident" id="5197502">e</span><span class="op" id="5197503">.</span><span class="ident" id="5197504">Expires</span><span class="op" id="5197511">.</span><span class="ident" id="5197512">After</span><span class="op" id="5197517">(</span><span class="ident" id="5197518">now</span><span class="op" id="5197521">)</span>&nbsp;<span class="op" id="5197523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5197528">delete</span><span class="op" id="5197534">(</span><span class="ident" id="5197535">submap</span><span class="op" id="5197541">,</span>&nbsp;<span class="ident" id="5197543">id</span><span class="op" id="5197545">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5197550">modified</span>&nbsp;<span class="op" id="5197559">=</span>&nbsp;<span class="builtintype" id="5197561">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5197569">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5197580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5197584">if</span>&nbsp;<span class="op" id="5197587">!</span><span class="ident" id="5197588">e</span><span class="op" id="5197589">.</span><span class="ident" id="5197590">shouldSend</span><span class="op" id="5197600">(</span><span class="ident" id="5197601">https</span><span class="op" id="5197606">,</span>&nbsp;<span class="ident" id="5197608">host</span><span class="op" id="5197612">,</span>&nbsp;<span class="ident" id="5197614">path</span><span class="op" id="5197618">)</span>&nbsp;<span class="op" id="5197620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5197625">continue</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5197636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5197640">e</span><span class="op" id="5197641">.</span><span class="ident" id="5197642">LastAccess</span>&nbsp;<span class="op" id="5197653">=</span>&nbsp;<span class="ident" id="5197655">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5197661">submap</span><span class="op" id="5197667">[</span><span class="ident" id="5197668">id</span><span class="op" id="5197670">]</span>&nbsp;<span class="op" id="5197672">=</span>&nbsp;<span class="ident" id="5197674">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5197678">selected</span>&nbsp;<span class="op" id="5197687">=</span>&nbsp;<span class="builtinfunc" id="5197689">append</span><span class="op" id="5197695">(</span><span class="ident" id="5197696">selected</span><span class="op" id="5197704">,</span>&nbsp;<span class="ident" id="5197706">e</span><span class="op" id="5197707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5197711">modified</span>&nbsp;<span class="op" id="5197720">=</span>&nbsp;<span class="builtintype" id="5197722">true</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5197728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5197731">if</span>&nbsp;<span class="ident" id="5197734">modified</span>&nbsp;<span class="op" id="5197743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5197747">if</span>&nbsp;<span class="builtinfunc" id="5197750">len</span><span class="op" id="5197753">(</span><span class="ident" id="5197754">submap</span><span class="op" id="5197760">)</span>&nbsp;<span class="op" id="5197762">==</span>&nbsp;<span class="num" id="5197765">0</span>&nbsp;<span class="op" id="5197767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5197772">delete</span><span class="op" id="5197778">(</span><span class="ident" id="5197779">j</span><span class="op" id="5197780">.</span><span class="ident" id="5197781">entries</span><span class="op" id="5197788">,</span>&nbsp;<span class="ident" id="5197790">key</span><span class="op" id="5197793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5197797">}</span>&nbsp;<span class="keyword" id="5197799">else</span>&nbsp;<span class="op" id="5197804">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5197809">j</span><span class="op" id="5197810">.</span><span class="ident" id="5197811">entries</span><span class="op" id="5197818">[</span><span class="ident" id="5197819">key</span><span class="op" id="5197822">]</span>&nbsp;<span class="op" id="5197824">=</span>&nbsp;<span class="ident" id="5197826">submap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5197835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5197838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5197842">sort</span><span class="op" id="5197846">.</span><span class="ident" id="5197847">Sort</span><span class="op" id="5197851">(</span><span class="ident" id="5197852">byPathLength</span><span class="op" id="5197864">(</span><span class="ident" id="5197865">selected</span><span class="op" id="5197873">)</span><span class="op" id="5197874">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5197877">for</span>&nbsp;<span class="ident" id="5197881">_</span><span class="op" id="5197882">,</span>&nbsp;<span class="ident" id="5197884">e</span>&nbsp;<span class="op" id="5197886">:=</span>&nbsp;<span class="keyword" id="5197889">range</span>&nbsp;<span class="ident" id="5197895">selected</span>&nbsp;<span class="op" id="5197904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5197908">cookies</span>&nbsp;<span class="op" id="5197916">=</span>&nbsp;<span class="builtinfunc" id="5197918">append</span><span class="op" id="5197924">(</span><span class="ident" id="5197925">cookies</span><span class="op" id="5197932">,</span>&nbsp;<span class="op" id="5197934">&amp;</span><span class="ident" id="5197935">http</span><span class="op" id="5197939">.</span><span class="ident" id="5197940">Cookie</span><span class="op" id="5197946">{</span><span class="ident" id="5197947">Name</span><span class="op" id="5197951">:</span>&nbsp;<span class="ident" id="5197953">e</span><span class="op" id="5197954">.</span><span class="ident" id="5197955">Name</span><span class="op" id="5197959">,</span>&nbsp;<span class="ident" id="5197961">Value</span><span class="op" id="5197966">:</span>&nbsp;<span class="ident" id="5197968">e</span><span class="op" id="5197969">.</span><span class="ident" id="5197970">Value</span><span class="op" id="5197975">}</span><span class="op" id="5197976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5197979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5197983">return</span>&nbsp;<span class="ident" id="5197990">cookies</span><br>
<span class="lineno">230</span><span class="op" id="5197998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5198001">//&nbsp;SetCookies&nbsp;implements&nbsp;the&nbsp;SetCookies&nbsp;method&nbsp;of&nbsp;the&nbsp;http.CookieJar&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="5198081">//</span><br>
<span class="lineno"></span><span class="comment" id="5198084">//&nbsp;It&nbsp;does&nbsp;nothing&nbsp;if&nbsp;the&nbsp;URL&#39;s&nbsp;scheme&nbsp;is&nbsp;not&nbsp;HTTP&nbsp;or&nbsp;HTTPS.</span><br>
<span class="lineno">235</span><span class="keyword" id="5198145">func</span>&nbsp;<span class="op" id="5198150">(</span><span class="ident" id="5198151">j</span>&nbsp;<span class="op" id="5198153">*</span><span class="ident" id="5198154">Jar</span><span class="op" id="5198157">)</span>&nbsp;<span class="ident" id="5198159">SetCookies</span><span class="op" id="5198169">(</span><span class="ident" id="5198170">u</span>&nbsp;<span class="op" id="5198172">*</span><span class="ident" id="5198173">url</span><span class="op" id="5198176">.</span><span class="ident" id="5198177">URL</span><span class="op" id="5198180">,</span>&nbsp;<span class="ident" id="5198182">cookies</span>&nbsp;<span class="op" id="5198190">[</span><span class="op" id="5198191">]</span><span class="op" id="5198192">*</span><span class="ident" id="5198193">http</span><span class="op" id="5198197">.</span><span class="ident" id="5198198">Cookie</span><span class="op" id="5198204">)</span>&nbsp;<span class="op" id="5198206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5198209">j</span><span class="op" id="5198210">.</span><span class="ident" id="5198211">setCookies</span><span class="op" id="5198221">(</span><span class="ident" id="5198222">u</span><span class="op" id="5198223">,</span>&nbsp;<span class="ident" id="5198225">cookies</span><span class="op" id="5198232">,</span>&nbsp;<span class="ident" id="5198234">time</span><span class="op" id="5198238">.</span><span class="ident" id="5198239">Now</span><span class="op" id="5198242">(</span><span class="op" id="5198243">)</span><span class="op" id="5198244">)</span><br>
<span class="lineno"></span><span class="op" id="5198246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5198249">//&nbsp;setCookies&nbsp;is&nbsp;like&nbsp;SetCookies&nbsp;but&nbsp;takes&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;parameter.</span><br>
<span class="lineno">240</span><span class="keyword" id="5198323">func</span>&nbsp;<span class="op" id="5198328">(</span><span class="ident" id="5198329">j</span>&nbsp;<span class="op" id="5198331">*</span><span class="ident" id="5198332">Jar</span><span class="op" id="5198335">)</span>&nbsp;<span class="ident" id="5198337">setCookies</span><span class="op" id="5198347">(</span><span class="ident" id="5198348">u</span>&nbsp;<span class="op" id="5198350">*</span><span class="ident" id="5198351">url</span><span class="op" id="5198354">.</span><span class="ident" id="5198355">URL</span><span class="op" id="5198358">,</span>&nbsp;<span class="ident" id="5198360">cookies</span>&nbsp;<span class="op" id="5198368">[</span><span class="op" id="5198369">]</span><span class="op" id="5198370">*</span><span class="ident" id="5198371">http</span><span class="op" id="5198375">.</span><span class="ident" id="5198376">Cookie</span><span class="op" id="5198382">,</span>&nbsp;<span class="ident" id="5198384">now</span>&nbsp;<span class="ident" id="5198388">time</span><span class="op" id="5198392">.</span><span class="ident" id="5198393">Time</span><span class="op" id="5198397">)</span>&nbsp;<span class="op" id="5198399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5198402">if</span>&nbsp;<span class="builtinfunc" id="5198405">len</span><span class="op" id="5198408">(</span><span class="ident" id="5198409">cookies</span><span class="op" id="5198416">)</span>&nbsp;<span class="op" id="5198418">==</span>&nbsp;<span class="num" id="5198421">0</span>&nbsp;<span class="op" id="5198423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5198427">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5198435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5198438">if</span>&nbsp;<span class="ident" id="5198441">u</span><span class="op" id="5198442">.</span><span class="ident" id="5198443">Scheme</span>&nbsp;<span class="op" id="5198450">!=</span>&nbsp;<span class="string" id="5198453">&#34;http&#34;</span>&nbsp;<span class="op" id="5198460">&amp;&amp;</span>&nbsp;<span class="ident" id="5198463">u</span><span class="op" id="5198464">.</span><span class="ident" id="5198465">Scheme</span>&nbsp;<span class="op" id="5198472">!=</span>&nbsp;<span class="string" id="5198475">&#34;https&#34;</span>&nbsp;<span class="op" id="5198483">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5198487">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5198495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5198498">host</span><span class="op" id="5198502">,</span>&nbsp;<span class="ident" id="5198504">err</span>&nbsp;<span class="op" id="5198508">:=</span>&nbsp;<span class="ident" id="5198511">canonicalHost</span><span class="op" id="5198524">(</span><span class="ident" id="5198525">u</span><span class="op" id="5198526">.</span><span class="ident" id="5198527">Host</span><span class="op" id="5198531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5198534">if</span>&nbsp;<span class="ident" id="5198537">err</span>&nbsp;<span class="op" id="5198541">!=</span>&nbsp;<span class="builtintype" id="5198544">nil</span>&nbsp;<span class="op" id="5198548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5198552">return</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5198560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5198563">key</span>&nbsp;<span class="op" id="5198567">:=</span>&nbsp;<span class="ident" id="5198570">jarKey</span><span class="op" id="5198576">(</span><span class="ident" id="5198577">host</span><span class="op" id="5198581">,</span>&nbsp;<span class="ident" id="5198583">j</span><span class="op" id="5198584">.</span><span class="ident" id="5198585">psList</span><span class="op" id="5198591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5198594">defPath</span>&nbsp;<span class="op" id="5198602">:=</span>&nbsp;<span class="ident" id="5198605">defaultPath</span><span class="op" id="5198616">(</span><span class="ident" id="5198617">u</span><span class="op" id="5198618">.</span><span class="ident" id="5198619">Path</span><span class="op" id="5198623">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5198627">j</span><span class="op" id="5198628">.</span><span class="ident" id="5198629">mu</span><span class="op" id="5198631">.</span><span class="ident" id="5198632">Lock</span><span class="op" id="5198636">(</span><span class="op" id="5198637">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5198640">defer</span>&nbsp;<span class="ident" id="5198646">j</span><span class="op" id="5198647">.</span><span class="ident" id="5198648">mu</span><span class="op" id="5198650">.</span><span class="ident" id="5198651">Unlock</span><span class="op" id="5198657">(</span><span class="op" id="5198658">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5198662">submap</span>&nbsp;<span class="op" id="5198669">:=</span>&nbsp;<span class="ident" id="5198672">j</span><span class="op" id="5198673">.</span><span class="ident" id="5198674">entries</span><span class="op" id="5198681">[</span><span class="ident" id="5198682">key</span><span class="op" id="5198685">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5198689">modified</span>&nbsp;<span class="op" id="5198698">:=</span>&nbsp;<span class="builtintype" id="5198701">false</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5198708">for</span>&nbsp;<span class="ident" id="5198712">_</span><span class="op" id="5198713">,</span>&nbsp;<span class="ident" id="5198715">cookie</span>&nbsp;<span class="op" id="5198722">:=</span>&nbsp;<span class="keyword" id="5198725">range</span>&nbsp;<span class="ident" id="5198731">cookies</span>&nbsp;<span class="op" id="5198739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5198743">e</span><span class="op" id="5198744">,</span>&nbsp;<span class="ident" id="5198746">remove</span><span class="op" id="5198752">,</span>&nbsp;<span class="ident" id="5198754">err</span>&nbsp;<span class="op" id="5198758">:=</span>&nbsp;<span class="ident" id="5198761">j</span><span class="op" id="5198762">.</span><span class="ident" id="5198763">newEntry</span><span class="op" id="5198771">(</span><span class="ident" id="5198772">cookie</span><span class="op" id="5198778">,</span>&nbsp;<span class="ident" id="5198780">now</span><span class="op" id="5198783">,</span>&nbsp;<span class="ident" id="5198785">defPath</span><span class="op" id="5198792">,</span>&nbsp;<span class="ident" id="5198794">host</span><span class="op" id="5198798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5198802">if</span>&nbsp;<span class="ident" id="5198805">err</span>&nbsp;<span class="op" id="5198809">!=</span>&nbsp;<span class="builtintype" id="5198812">nil</span>&nbsp;<span class="op" id="5198816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5198821">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5198832">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5198836">id</span>&nbsp;<span class="op" id="5198839">:=</span>&nbsp;<span class="ident" id="5198842">e</span><span class="op" id="5198843">.</span><span class="ident" id="5198844">id</span><span class="op" id="5198846">(</span><span class="op" id="5198847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5198851">if</span>&nbsp;<span class="ident" id="5198854">remove</span>&nbsp;<span class="op" id="5198861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5198866">if</span>&nbsp;<span class="ident" id="5198869">submap</span>&nbsp;<span class="op" id="5198876">!=</span>&nbsp;<span class="builtintype" id="5198879">nil</span>&nbsp;<span class="op" id="5198883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5198889">if</span>&nbsp;<span class="ident" id="5198892">_</span><span class="op" id="5198893">,</span>&nbsp;<span class="ident" id="5198895">ok</span>&nbsp;<span class="op" id="5198898">:=</span>&nbsp;<span class="ident" id="5198901">submap</span><span class="op" id="5198907">[</span><span class="ident" id="5198908">id</span><span class="op" id="5198910">]</span><span class="op" id="5198911">;</span>&nbsp;<span class="ident" id="5198913">ok</span>&nbsp;<span class="op" id="5198916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5198923">delete</span><span class="op" id="5198929">(</span><span class="ident" id="5198930">submap</span><span class="op" id="5198936">,</span>&nbsp;<span class="ident" id="5198938">id</span><span class="op" id="5198940">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5198947">modified</span>&nbsp;<span class="op" id="5198956">=</span>&nbsp;<span class="builtintype" id="5198958">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5198967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5198972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5198977">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5198988">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5198992">if</span>&nbsp;<span class="ident" id="5198995">submap</span>&nbsp;<span class="op" id="5199002">==</span>&nbsp;<span class="builtintype" id="5199005">nil</span>&nbsp;<span class="op" id="5199009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5199014">submap</span>&nbsp;<span class="op" id="5199021">=</span>&nbsp;<span class="builtinfunc" id="5199023">make</span><span class="op" id="5199027">(</span><span class="keyword" id="5199028">map</span><span class="op" id="5199031">[</span><span class="builtintype" id="5199032">string</span><span class="op" id="5199038">]</span><span class="ident" id="5199039">entry</span><span class="op" id="5199044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5199048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5199053">if</span>&nbsp;<span class="ident" id="5199056">old</span><span class="op" id="5199059">,</span>&nbsp;<span class="ident" id="5199061">ok</span>&nbsp;<span class="op" id="5199064">:=</span>&nbsp;<span class="ident" id="5199067">submap</span><span class="op" id="5199073">[</span><span class="ident" id="5199074">id</span><span class="op" id="5199076">]</span><span class="op" id="5199077">;</span>&nbsp;<span class="ident" id="5199079">ok</span>&nbsp;<span class="op" id="5199082">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5199087">e</span><span class="op" id="5199088">.</span><span class="ident" id="5199089">Creation</span>&nbsp;<span class="op" id="5199098">=</span>&nbsp;<span class="ident" id="5199100">old</span><span class="op" id="5199103">.</span><span class="ident" id="5199104">Creation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5199116">e</span><span class="op" id="5199117">.</span><span class="ident" id="5199118">seqNum</span>&nbsp;<span class="op" id="5199125">=</span>&nbsp;<span class="ident" id="5199127">old</span><span class="op" id="5199130">.</span><span class="ident" id="5199131">seqNum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5199140">}</span>&nbsp;<span class="keyword" id="5199142">else</span>&nbsp;<span class="op" id="5199147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5199152">e</span><span class="op" id="5199153">.</span><span class="ident" id="5199154">Creation</span>&nbsp;<span class="op" id="5199163">=</span>&nbsp;<span class="ident" id="5199165">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5199172">e</span><span class="op" id="5199173">.</span><span class="ident" id="5199174">seqNum</span>&nbsp;<span class="op" id="5199181">=</span>&nbsp;<span class="ident" id="5199183">j</span><span class="op" id="5199184">.</span><span class="ident" id="5199185">nextSeqNum</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5199199">j</span><span class="op" id="5199200">.</span><span class="ident" id="5199201">nextSeqNum</span><span class="op" id="5199211">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5199216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5199220">e</span><span class="op" id="5199221">.</span><span class="ident" id="5199222">LastAccess</span>&nbsp;<span class="op" id="5199233">=</span>&nbsp;<span class="ident" id="5199235">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5199241">submap</span><span class="op" id="5199247">[</span><span class="ident" id="5199248">id</span><span class="op" id="5199250">]</span>&nbsp;<span class="op" id="5199252">=</span>&nbsp;<span class="ident" id="5199254">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5199258">modified</span>&nbsp;<span class="op" id="5199267">=</span>&nbsp;<span class="builtintype" id="5199269">true</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5199275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5199279">if</span>&nbsp;<span class="ident" id="5199282">modified</span>&nbsp;<span class="op" id="5199291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5199295">if</span>&nbsp;<span class="builtinfunc" id="5199298">len</span><span class="op" id="5199301">(</span><span class="ident" id="5199302">submap</span><span class="op" id="5199308">)</span>&nbsp;<span class="op" id="5199310">==</span>&nbsp;<span class="num" id="5199313">0</span>&nbsp;<span class="op" id="5199315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5199320">delete</span><span class="op" id="5199326">(</span><span class="ident" id="5199327">j</span><span class="op" id="5199328">.</span><span class="ident" id="5199329">entries</span><span class="op" id="5199336">,</span>&nbsp;<span class="ident" id="5199338">key</span><span class="op" id="5199341">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5199345">}</span>&nbsp;<span class="keyword" id="5199347">else</span>&nbsp;<span class="op" id="5199352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5199357">j</span><span class="op" id="5199358">.</span><span class="ident" id="5199359">entries</span><span class="op" id="5199366">[</span><span class="ident" id="5199367">key</span><span class="op" id="5199370">]</span>&nbsp;<span class="op" id="5199372">=</span>&nbsp;<span class="ident" id="5199374">submap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5199383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5199386">}</span><br>
<span class="lineno"></span><span class="op" id="5199388">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="comment" id="5199391">//&nbsp;canonicalHost&nbsp;strips&nbsp;port&nbsp;from&nbsp;host&nbsp;if&nbsp;present&nbsp;and&nbsp;returns&nbsp;the&nbsp;canonicalized</span><br>
<span class="lineno"></span><span class="comment" id="5199471">//&nbsp;host&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="5199485">func</span>&nbsp;<span class="ident" id="5199490">canonicalHost</span><span class="op" id="5199503">(</span><span class="ident" id="5199504">host</span>&nbsp;<span class="builtintype" id="5199509">string</span><span class="op" id="5199515">)</span>&nbsp;<span class="op" id="5199517">(</span><span class="builtintype" id="5199518">string</span><span class="op" id="5199524">,</span>&nbsp;<span class="builtintype" id="5199526">error</span><span class="op" id="5199531">)</span>&nbsp;<span class="op" id="5199533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5199536">var</span>&nbsp;<span class="ident" id="5199540">err</span>&nbsp;<span class="builtintype" id="5199544">error</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5199551">host</span>&nbsp;<span class="op" id="5199556">=</span>&nbsp;<span class="ident" id="5199558">strings</span><span class="op" id="5199565">.</span><span class="ident" id="5199566">ToLower</span><span class="op" id="5199573">(</span><span class="ident" id="5199574">host</span><span class="op" id="5199578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5199581">if</span>&nbsp;<span class="ident" id="5199584">hasPort</span><span class="op" id="5199591">(</span><span class="ident" id="5199592">host</span><span class="op" id="5199596">)</span>&nbsp;<span class="op" id="5199598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5199602">host</span><span class="op" id="5199606">,</span>&nbsp;<span class="ident" id="5199608">_</span><span class="op" id="5199609">,</span>&nbsp;<span class="ident" id="5199611">err</span>&nbsp;<span class="op" id="5199615">=</span>&nbsp;<span class="ident" id="5199617">net</span><span class="op" id="5199620">.</span><span class="ident" id="5199621">SplitHostPort</span><span class="op" id="5199634">(</span><span class="ident" id="5199635">host</span><span class="op" id="5199639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5199643">if</span>&nbsp;<span class="ident" id="5199646">err</span>&nbsp;<span class="op" id="5199650">!=</span>&nbsp;<span class="builtintype" id="5199653">nil</span>&nbsp;<span class="op" id="5199657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5199662">return</span>&nbsp;<span class="string" id="5199669">&#34;&#34;</span><span class="op" id="5199671">,</span>&nbsp;<span class="ident" id="5199673">err</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5199679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5199682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5199685">if</span>&nbsp;<span class="ident" id="5199688">strings</span><span class="op" id="5199695">.</span><span class="ident" id="5199696">HasSuffix</span><span class="op" id="5199705">(</span><span class="ident" id="5199706">host</span><span class="op" id="5199710">,</span>&nbsp;<span class="string" id="5199712">&#34;.&#34;</span><span class="op" id="5199715">)</span>&nbsp;<span class="op" id="5199717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5199721">//&nbsp;Strip&nbsp;trailing&nbsp;dot&nbsp;from&nbsp;fully&nbsp;qualified&nbsp;domain&nbsp;names.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5199780">host</span>&nbsp;<span class="op" id="5199785">=</span>&nbsp;<span class="ident" id="5199787">host</span><span class="op" id="5199791">[</span><span class="op" id="5199792">:</span><span class="builtinfunc" id="5199793">len</span><span class="op" id="5199796">(</span><span class="ident" id="5199797">host</span><span class="op" id="5199801">)</span><span class="op" id="5199802">-</span><span class="num" id="5199803">1</span><span class="op" id="5199804">]</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5199807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5199810">return</span>&nbsp;<span class="ident" id="5199817">toASCII</span><span class="op" id="5199824">(</span><span class="ident" id="5199825">host</span><span class="op" id="5199829">)</span><br>
<span class="lineno"></span><span class="op" id="5199831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5199834">//&nbsp;hasPort&nbsp;reports&nbsp;whether&nbsp;host&nbsp;contains&nbsp;a&nbsp;port&nbsp;number.&nbsp;host&nbsp;may&nbsp;be&nbsp;a&nbsp;host</span><br>
<span class="lineno">320</span><span class="comment" id="5199909">//&nbsp;name,&nbsp;an&nbsp;IPv4&nbsp;or&nbsp;an&nbsp;IPv6&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="5199946">func</span>&nbsp;<span class="ident" id="5199951">hasPort</span><span class="op" id="5199958">(</span><span class="ident" id="5199959">host</span>&nbsp;<span class="builtintype" id="5199964">string</span><span class="op" id="5199970">)</span>&nbsp;<span class="builtintype" id="5199972">bool</span>&nbsp;<span class="op" id="5199977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5199980">colons</span>&nbsp;<span class="op" id="5199987">:=</span>&nbsp;<span class="ident" id="5199990">strings</span><span class="op" id="5199997">.</span><span class="ident" id="5199998">Count</span><span class="op" id="5200003">(</span><span class="ident" id="5200004">host</span><span class="op" id="5200008">,</span>&nbsp;<span class="string" id="5200010">&#34;:&#34;</span><span class="op" id="5200013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5200016">if</span>&nbsp;<span class="ident" id="5200019">colons</span>&nbsp;<span class="op" id="5200026">==</span>&nbsp;<span class="num" id="5200029">0</span>&nbsp;<span class="op" id="5200031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5200035">return</span>&nbsp;<span class="builtintype" id="5200042">false</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5200049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5200052">if</span>&nbsp;<span class="ident" id="5200055">colons</span>&nbsp;<span class="op" id="5200062">==</span>&nbsp;<span class="num" id="5200065">1</span>&nbsp;<span class="op" id="5200067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5200071">return</span>&nbsp;<span class="builtintype" id="5200078">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5200084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5200087">return</span>&nbsp;<span class="ident" id="5200094">host</span><span class="op" id="5200098">[</span><span class="num" id="5200099">0</span><span class="op" id="5200100">]</span>&nbsp;<span class="op" id="5200102">==</span>&nbsp;<span class="string" id="5200105">&#39;[&#39;</span>&nbsp;<span class="op" id="5200109">&amp;&amp;</span>&nbsp;<span class="ident" id="5200112">strings</span><span class="op" id="5200119">.</span><span class="ident" id="5200120">Contains</span><span class="op" id="5200128">(</span><span class="ident" id="5200129">host</span><span class="op" id="5200133">,</span>&nbsp;<span class="string" id="5200135">&#34;]:&#34;</span><span class="op" id="5200139">)</span><br>
<span class="lineno">330</span><span class="op" id="5200141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5200144">//&nbsp;jarKey&nbsp;returns&nbsp;the&nbsp;key&nbsp;to&nbsp;use&nbsp;for&nbsp;a&nbsp;jar.</span><br>
<span class="lineno"></span><span class="keyword" id="5200188">func</span>&nbsp;<span class="ident" id="5200193">jarKey</span><span class="op" id="5200199">(</span><span class="ident" id="5200200">host</span>&nbsp;<span class="builtintype" id="5200205">string</span><span class="op" id="5200211">,</span>&nbsp;<span class="ident" id="5200213">psl</span>&nbsp;<span class="ident" id="5200217">PublicSuffixList</span><span class="op" id="5200233">)</span>&nbsp;<span class="builtintype" id="5200235">string</span>&nbsp;<span class="op" id="5200242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5200245">if</span>&nbsp;<span class="ident" id="5200248">isIP</span><span class="op" id="5200252">(</span><span class="ident" id="5200253">host</span><span class="op" id="5200257">)</span>&nbsp;<span class="op" id="5200259">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5200263">return</span>&nbsp;<span class="ident" id="5200270">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5200276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5200280">var</span>&nbsp;<span class="ident" id="5200284">i</span>&nbsp;<span class="builtintype" id="5200286">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5200291">if</span>&nbsp;<span class="ident" id="5200294">psl</span>&nbsp;<span class="op" id="5200298">==</span>&nbsp;<span class="builtintype" id="5200301">nil</span>&nbsp;<span class="op" id="5200305">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5200309">i</span>&nbsp;<span class="op" id="5200311">=</span>&nbsp;<span class="ident" id="5200313">strings</span><span class="op" id="5200320">.</span><span class="ident" id="5200321">LastIndex</span><span class="op" id="5200330">(</span><span class="ident" id="5200331">host</span><span class="op" id="5200335">,</span>&nbsp;<span class="string" id="5200337">&#34;.&#34;</span><span class="op" id="5200340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5200344">if</span>&nbsp;<span class="ident" id="5200347">i</span>&nbsp;<span class="op" id="5200349">==</span>&nbsp;<span class="op" id="5200352">-</span><span class="num" id="5200353">1</span>&nbsp;<span class="op" id="5200355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5200360">return</span>&nbsp;<span class="ident" id="5200367">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5200374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5200377">}</span>&nbsp;<span class="keyword" id="5200379">else</span>&nbsp;<span class="op" id="5200384">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5200388">suffix</span>&nbsp;<span class="op" id="5200395">:=</span>&nbsp;<span class="ident" id="5200398">psl</span><span class="op" id="5200401">.</span><span class="ident" id="5200402">PublicSuffix</span><span class="op" id="5200414">(</span><span class="ident" id="5200415">host</span><span class="op" id="5200419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5200423">if</span>&nbsp;<span class="ident" id="5200426">suffix</span>&nbsp;<span class="op" id="5200433">==</span>&nbsp;<span class="ident" id="5200436">host</span>&nbsp;<span class="op" id="5200441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5200446">return</span>&nbsp;<span class="ident" id="5200453">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5200460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5200464">i</span>&nbsp;<span class="op" id="5200466">=</span>&nbsp;<span class="builtinfunc" id="5200468">len</span><span class="op" id="5200471">(</span><span class="ident" id="5200472">host</span><span class="op" id="5200476">)</span>&nbsp;<span class="op" id="5200478">-</span>&nbsp;<span class="builtinfunc" id="5200480">len</span><span class="op" id="5200483">(</span><span class="ident" id="5200484">suffix</span><span class="op" id="5200490">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5200494">if</span>&nbsp;<span class="ident" id="5200497">i</span>&nbsp;<span class="op" id="5200499">&lt;=</span>&nbsp;<span class="num" id="5200502">0</span>&nbsp;<span class="op" id="5200504">||</span>&nbsp;<span class="ident" id="5200507">host</span><span class="op" id="5200511">[</span><span class="ident" id="5200512">i</span><span class="op" id="5200513">-</span><span class="num" id="5200514">1</span><span class="op" id="5200515">]</span>&nbsp;<span class="op" id="5200517">!=</span>&nbsp;<span class="string" id="5200520">&#39;.&#39;</span>&nbsp;<span class="op" id="5200524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5200529">//&nbsp;The&nbsp;provided&nbsp;public&nbsp;suffix&nbsp;list&nbsp;psl&nbsp;is&nbsp;broken.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5200582">//&nbsp;Storing&nbsp;cookies&nbsp;under&nbsp;host&nbsp;is&nbsp;a&nbsp;safe&nbsp;stopgap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5200634">return</span>&nbsp;<span class="ident" id="5200641">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5200648">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5200651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5200654">prevDot</span>&nbsp;<span class="op" id="5200662">:=</span>&nbsp;<span class="ident" id="5200665">strings</span><span class="op" id="5200672">.</span><span class="ident" id="5200673">LastIndex</span><span class="op" id="5200682">(</span><span class="ident" id="5200683">host</span><span class="op" id="5200687">[</span><span class="op" id="5200688">:</span><span class="ident" id="5200689">i</span><span class="op" id="5200690">-</span><span class="num" id="5200691">1</span><span class="op" id="5200692">]</span><span class="op" id="5200693">,</span>&nbsp;<span class="string" id="5200695">&#34;.&#34;</span><span class="op" id="5200698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5200701">return</span>&nbsp;<span class="ident" id="5200708">host</span><span class="op" id="5200712">[</span><span class="ident" id="5200713">prevDot</span><span class="op" id="5200720">+</span><span class="num" id="5200721">1</span><span class="op" id="5200722">:</span><span class="op" id="5200723">]</span><br>
<span class="lineno"></span><span class="op" id="5200725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="comment" id="5200728">//&nbsp;isIP&nbsp;reports&nbsp;whether&nbsp;host&nbsp;is&nbsp;an&nbsp;IP&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="5200775">func</span>&nbsp;<span class="ident" id="5200780">isIP</span><span class="op" id="5200784">(</span><span class="ident" id="5200785">host</span>&nbsp;<span class="builtintype" id="5200790">string</span><span class="op" id="5200796">)</span>&nbsp;<span class="builtintype" id="5200798">bool</span>&nbsp;<span class="op" id="5200803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5200806">return</span>&nbsp;<span class="ident" id="5200813">net</span><span class="op" id="5200816">.</span><span class="ident" id="5200817">ParseIP</span><span class="op" id="5200824">(</span><span class="ident" id="5200825">host</span><span class="op" id="5200829">)</span>&nbsp;<span class="op" id="5200831">!=</span>&nbsp;<span class="builtintype" id="5200834">nil</span><br>
<span class="lineno"></span><span class="op" id="5200838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="5200841">//&nbsp;defaultPath&nbsp;returns&nbsp;the&nbsp;directory&nbsp;part&nbsp;of&nbsp;an&nbsp;URL&#39;s&nbsp;path&nbsp;according&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5200913">//&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.4.</span><br>
<span class="lineno"></span><span class="keyword" id="5200940">func</span>&nbsp;<span class="ident" id="5200945">defaultPath</span><span class="op" id="5200956">(</span><span class="ident" id="5200957">path</span>&nbsp;<span class="builtintype" id="5200962">string</span><span class="op" id="5200968">)</span>&nbsp;<span class="builtintype" id="5200970">string</span>&nbsp;<span class="op" id="5200977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5200980">if</span>&nbsp;<span class="builtinfunc" id="5200983">len</span><span class="op" id="5200986">(</span><span class="ident" id="5200987">path</span><span class="op" id="5200991">)</span>&nbsp;<span class="op" id="5200993">==</span>&nbsp;<span class="num" id="5200996">0</span>&nbsp;<span class="op" id="5200998">||</span>&nbsp;<span class="ident" id="5201001">path</span><span class="op" id="5201005">[</span><span class="num" id="5201006">0</span><span class="op" id="5201007">]</span>&nbsp;<span class="op" id="5201009">!=</span>&nbsp;<span class="string" id="5201012">&#39;/&#39;</span>&nbsp;<span class="op" id="5201016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5201020">return</span>&nbsp;<span class="string" id="5201027">&#34;/&#34;</span>&nbsp;<span class="comment" id="5201031">//&nbsp;Path&nbsp;is&nbsp;empty&nbsp;or&nbsp;malformed.</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5201063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5201067">i</span>&nbsp;<span class="op" id="5201069">:=</span>&nbsp;<span class="ident" id="5201072">strings</span><span class="op" id="5201079">.</span><span class="ident" id="5201080">LastIndex</span><span class="op" id="5201089">(</span><span class="ident" id="5201090">path</span><span class="op" id="5201094">,</span>&nbsp;<span class="string" id="5201096">&#34;/&#34;</span><span class="op" id="5201099">)</span>&nbsp;<span class="comment" id="5201101">//&nbsp;Path&nbsp;starts&nbsp;with&nbsp;&#34;/&#34;,&nbsp;so&nbsp;i&nbsp;!=&nbsp;-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5201139">if</span>&nbsp;<span class="ident" id="5201142">i</span>&nbsp;<span class="op" id="5201144">==</span>&nbsp;<span class="num" id="5201147">0</span>&nbsp;<span class="op" id="5201149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5201153">return</span>&nbsp;<span class="string" id="5201160">&#34;/&#34;</span>&nbsp;<span class="comment" id="5201164">//&nbsp;Path&nbsp;has&nbsp;the&nbsp;form&nbsp;&#34;/abc&#34;.</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5201194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5201197">return</span>&nbsp;<span class="ident" id="5201204">path</span><span class="op" id="5201208">[</span><span class="op" id="5201209">:</span><span class="ident" id="5201210">i</span><span class="op" id="5201211">]</span>&nbsp;<span class="comment" id="5201213">//&nbsp;Path&nbsp;is&nbsp;either&nbsp;of&nbsp;form&nbsp;&#34;/abc/xyz&#34;&nbsp;or&nbsp;&#34;/abc/xyz/&#34;.</span><br>
<span class="lineno"></span><span class="op" id="5201266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5201269">//&nbsp;newEntry&nbsp;creates&nbsp;an&nbsp;entry&nbsp;from&nbsp;a&nbsp;http.Cookie&nbsp;c.&nbsp;now&nbsp;is&nbsp;the&nbsp;current&nbsp;time&nbsp;and</span><br>
<span class="lineno">380</span><span class="comment" id="5201348">//&nbsp;is&nbsp;compared&nbsp;to&nbsp;c.Expires&nbsp;to&nbsp;determine&nbsp;deletion&nbsp;of&nbsp;c.&nbsp;defPath&nbsp;and&nbsp;host&nbsp;are&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5201429">//&nbsp;default-path&nbsp;and&nbsp;the&nbsp;canonical&nbsp;host&nbsp;name&nbsp;of&nbsp;the&nbsp;URL&nbsp;c&nbsp;was&nbsp;received&nbsp;from.</span><br>
<span class="lineno"></span><span class="comment" id="5201505">//</span><br>
<span class="lineno"></span><span class="comment" id="5201508">//&nbsp;remove&nbsp;records&nbsp;whether&nbsp;the&nbsp;jar&nbsp;should&nbsp;delete&nbsp;this&nbsp;cookie,&nbsp;as&nbsp;it&nbsp;has&nbsp;already</span><br>
<span class="lineno"></span><span class="comment" id="5201587">//&nbsp;expired&nbsp;with&nbsp;respect&nbsp;to&nbsp;now.&nbsp;In&nbsp;this&nbsp;case,&nbsp;e&nbsp;may&nbsp;be&nbsp;incomplete,&nbsp;but&nbsp;it&nbsp;will</span><br>
<span class="lineno">385</span><span class="comment" id="5201666">//&nbsp;be&nbsp;valid&nbsp;to&nbsp;call&nbsp;e.id&nbsp;(which&nbsp;depends&nbsp;on&nbsp;e&#39;s&nbsp;Name,&nbsp;Domain&nbsp;and&nbsp;Path).</span><br>
<span class="lineno"></span><span class="comment" id="5201737">//</span><br>
<span class="lineno"></span><span class="comment" id="5201740">//&nbsp;A&nbsp;malformed&nbsp;c.Domain&nbsp;will&nbsp;result&nbsp;in&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="5201789">func</span>&nbsp;<span class="op" id="5201794">(</span><span class="ident" id="5201795">j</span>&nbsp;<span class="op" id="5201797">*</span><span class="ident" id="5201798">Jar</span><span class="op" id="5201801">)</span>&nbsp;<span class="ident" id="5201803">newEntry</span><span class="op" id="5201811">(</span><span class="ident" id="5201812">c</span>&nbsp;<span class="op" id="5201814">*</span><span class="ident" id="5201815">http</span><span class="op" id="5201819">.</span><span class="ident" id="5201820">Cookie</span><span class="op" id="5201826">,</span>&nbsp;<span class="ident" id="5201828">now</span>&nbsp;<span class="ident" id="5201832">time</span><span class="op" id="5201836">.</span><span class="ident" id="5201837">Time</span><span class="op" id="5201841">,</span>&nbsp;<span class="ident" id="5201843">defPath</span><span class="op" id="5201850">,</span>&nbsp;<span class="ident" id="5201852">host</span>&nbsp;<span class="builtintype" id="5201857">string</span><span class="op" id="5201863">)</span>&nbsp;<span class="op" id="5201865">(</span><span class="ident" id="5201866">e</span>&nbsp;<span class="ident" id="5201868">entry</span><span class="op" id="5201873">,</span>&nbsp;<span class="ident" id="5201875">remove</span>&nbsp;<span class="builtintype" id="5201882">bool</span><span class="op" id="5201886">,</span>&nbsp;<span class="ident" id="5201888">err</span>&nbsp;<span class="builtintype" id="5201892">error</span><span class="op" id="5201897">)</span>&nbsp;<span class="op" id="5201899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5201902">e</span><span class="op" id="5201903">.</span><span class="ident" id="5201904">Name</span>&nbsp;<span class="op" id="5201909">=</span>&nbsp;<span class="ident" id="5201911">c</span><span class="op" id="5201912">.</span><span class="ident" id="5201913">Name</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5201920">if</span>&nbsp;<span class="ident" id="5201923">c</span><span class="op" id="5201924">.</span><span class="ident" id="5201925">Path</span>&nbsp;<span class="op" id="5201930">==</span>&nbsp;<span class="string" id="5201933">&#34;&#34;</span>&nbsp;<span class="op" id="5201936">||</span>&nbsp;<span class="ident" id="5201939">c</span><span class="op" id="5201940">.</span><span class="ident" id="5201941">Path</span><span class="op" id="5201945">[</span><span class="num" id="5201946">0</span><span class="op" id="5201947">]</span>&nbsp;<span class="op" id="5201949">!=</span>&nbsp;<span class="string" id="5201952">&#39;/&#39;</span>&nbsp;<span class="op" id="5201956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5201960">e</span><span class="op" id="5201961">.</span><span class="ident" id="5201962">Path</span>&nbsp;<span class="op" id="5201967">=</span>&nbsp;<span class="ident" id="5201969">defPath</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5201978">}</span>&nbsp;<span class="keyword" id="5201980">else</span>&nbsp;<span class="op" id="5201985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5201989">e</span><span class="op" id="5201990">.</span><span class="ident" id="5201991">Path</span>&nbsp;<span class="op" id="5201996">=</span>&nbsp;<span class="ident" id="5201998">c</span><span class="op" id="5201999">.</span><span class="ident" id="5202000">Path</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5202006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202010">e</span><span class="op" id="5202011">.</span><span class="ident" id="5202012">Domain</span><span class="op" id="5202018">,</span>&nbsp;<span class="ident" id="5202020">e</span><span class="op" id="5202021">.</span><span class="ident" id="5202022">HostOnly</span><span class="op" id="5202030">,</span>&nbsp;<span class="ident" id="5202032">err</span>&nbsp;<span class="op" id="5202036">=</span>&nbsp;<span class="ident" id="5202038">j</span><span class="op" id="5202039">.</span><span class="ident" id="5202040">domainAndType</span><span class="op" id="5202053">(</span><span class="ident" id="5202054">host</span><span class="op" id="5202058">,</span>&nbsp;<span class="ident" id="5202060">c</span><span class="op" id="5202061">.</span><span class="ident" id="5202062">Domain</span><span class="op" id="5202068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5202071">if</span>&nbsp;<span class="ident" id="5202074">err</span>&nbsp;<span class="op" id="5202078">!=</span>&nbsp;<span class="builtintype" id="5202081">nil</span>&nbsp;<span class="op" id="5202085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5202089">return</span>&nbsp;<span class="ident" id="5202096">e</span><span class="op" id="5202097">,</span>&nbsp;<span class="builtintype" id="5202099">false</span><span class="op" id="5202104">,</span>&nbsp;<span class="ident" id="5202106">err</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5202111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5202115">//&nbsp;MaxAge&nbsp;takes&nbsp;precedence&nbsp;over&nbsp;Expires.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5202157">if</span>&nbsp;<span class="ident" id="5202160">c</span><span class="op" id="5202161">.</span><span class="ident" id="5202162">MaxAge</span>&nbsp;<span class="op" id="5202169">&lt;</span>&nbsp;<span class="num" id="5202171">0</span>&nbsp;<span class="op" id="5202173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5202177">return</span>&nbsp;<span class="ident" id="5202184">e</span><span class="op" id="5202185">,</span>&nbsp;<span class="builtintype" id="5202187">true</span><span class="op" id="5202191">,</span>&nbsp;<span class="builtintype" id="5202193">nil</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5202198">}</span>&nbsp;<span class="keyword" id="5202200">else</span>&nbsp;<span class="keyword" id="5202205">if</span>&nbsp;<span class="ident" id="5202208">c</span><span class="op" id="5202209">.</span><span class="ident" id="5202210">MaxAge</span>&nbsp;<span class="op" id="5202217">&gt;</span>&nbsp;<span class="num" id="5202219">0</span>&nbsp;<span class="op" id="5202221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202225">e</span><span class="op" id="5202226">.</span><span class="ident" id="5202227">Expires</span>&nbsp;<span class="op" id="5202235">=</span>&nbsp;<span class="ident" id="5202237">now</span><span class="op" id="5202240">.</span><span class="ident" id="5202241">Add</span><span class="op" id="5202244">(</span><span class="ident" id="5202245">time</span><span class="op" id="5202249">.</span><span class="ident" id="5202250">Duration</span><span class="op" id="5202258">(</span><span class="ident" id="5202259">c</span><span class="op" id="5202260">.</span><span class="ident" id="5202261">MaxAge</span><span class="op" id="5202267">)</span>&nbsp;<span class="op" id="5202269">*</span>&nbsp;<span class="ident" id="5202271">time</span><span class="op" id="5202275">.</span><span class="ident" id="5202276">Second</span><span class="op" id="5202282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202286">e</span><span class="op" id="5202287">.</span><span class="ident" id="5202288">Persistent</span>&nbsp;<span class="op" id="5202299">=</span>&nbsp;<span class="builtintype" id="5202301">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5202307">}</span>&nbsp;<span class="keyword" id="5202309">else</span>&nbsp;<span class="op" id="5202314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5202318">if</span>&nbsp;<span class="ident" id="5202321">c</span><span class="op" id="5202322">.</span><span class="ident" id="5202323">Expires</span><span class="op" id="5202330">.</span><span class="ident" id="5202331">IsZero</span><span class="op" id="5202337">(</span><span class="op" id="5202338">)</span>&nbsp;<span class="op" id="5202340">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202345">e</span><span class="op" id="5202346">.</span><span class="ident" id="5202347">Expires</span>&nbsp;<span class="op" id="5202355">=</span>&nbsp;<span class="ident" id="5202357">endOfTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202370">e</span><span class="op" id="5202371">.</span><span class="ident" id="5202372">Persistent</span>&nbsp;<span class="op" id="5202383">=</span>&nbsp;<span class="builtintype" id="5202385">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5202393">}</span>&nbsp;<span class="keyword" id="5202395">else</span>&nbsp;<span class="op" id="5202400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5202405">if</span>&nbsp;<span class="op" id="5202408">!</span><span class="ident" id="5202409">c</span><span class="op" id="5202410">.</span><span class="ident" id="5202411">Expires</span><span class="op" id="5202418">.</span><span class="ident" id="5202419">After</span><span class="op" id="5202424">(</span><span class="ident" id="5202425">now</span><span class="op" id="5202428">)</span>&nbsp;<span class="op" id="5202430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5202436">return</span>&nbsp;<span class="ident" id="5202443">e</span><span class="op" id="5202444">,</span>&nbsp;<span class="builtintype" id="5202446">true</span><span class="op" id="5202450">,</span>&nbsp;<span class="builtintype" id="5202452">nil</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5202459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202464">e</span><span class="op" id="5202465">.</span><span class="ident" id="5202466">Expires</span>&nbsp;<span class="op" id="5202474">=</span>&nbsp;<span class="ident" id="5202476">c</span><span class="op" id="5202477">.</span><span class="ident" id="5202478">Expires</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202489">e</span><span class="op" id="5202490">.</span><span class="ident" id="5202491">Persistent</span>&nbsp;<span class="op" id="5202502">=</span>&nbsp;<span class="builtintype" id="5202504">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5202511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5202514">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202518">e</span><span class="op" id="5202519">.</span><span class="ident" id="5202520">Value</span>&nbsp;<span class="op" id="5202526">=</span>&nbsp;<span class="ident" id="5202528">c</span><span class="op" id="5202529">.</span><span class="ident" id="5202530">Value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202537">e</span><span class="op" id="5202538">.</span><span class="ident" id="5202539">Secure</span>&nbsp;<span class="op" id="5202546">=</span>&nbsp;<span class="ident" id="5202548">c</span><span class="op" id="5202549">.</span><span class="ident" id="5202550">Secure</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202558">e</span><span class="op" id="5202559">.</span><span class="ident" id="5202560">HttpOnly</span>&nbsp;<span class="op" id="5202569">=</span>&nbsp;<span class="ident" id="5202571">c</span><span class="op" id="5202572">.</span><span class="ident" id="5202573">HttpOnly</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5202584">return</span>&nbsp;<span class="ident" id="5202591">e</span><span class="op" id="5202592">,</span>&nbsp;<span class="builtintype" id="5202594">false</span><span class="op" id="5202599">,</span>&nbsp;<span class="builtintype" id="5202601">nil</span><br>
<span class="lineno"></span><span class="op" id="5202605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5202608">var</span>&nbsp;<span class="op" id="5202612">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202615">errIllegalDomain</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5202634">=</span>&nbsp;<span class="ident" id="5202636">errors</span><span class="op" id="5202642">.</span><span class="ident" id="5202643">New</span><span class="op" id="5202646">(</span><span class="string" id="5202647">&#34;cookiejar:&nbsp;illegal&nbsp;cookie&nbsp;domain&nbsp;attribute&#34;</span><span class="op" id="5202691">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202694">errMalformedDomain</span>&nbsp;<span class="op" id="5202713">=</span>&nbsp;<span class="ident" id="5202715">errors</span><span class="op" id="5202721">.</span><span class="ident" id="5202722">New</span><span class="op" id="5202725">(</span><span class="string" id="5202726">&#34;cookiejar:&nbsp;malformed&nbsp;cookie&nbsp;domain&nbsp;attribute&#34;</span><span class="op" id="5202772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202775">errNoHostname</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5202794">=</span>&nbsp;<span class="ident" id="5202796">errors</span><span class="op" id="5202802">.</span><span class="ident" id="5202803">New</span><span class="op" id="5202806">(</span><span class="string" id="5202807">&#34;cookiejar:&nbsp;no&nbsp;host&nbsp;name&nbsp;available&nbsp;(IP&nbsp;only)&#34;</span><span class="op" id="5202852">)</span><br>
<span class="lineno"></span><span class="op" id="5202854">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5202857">//&nbsp;endOfTime&nbsp;is&nbsp;the&nbsp;time&nbsp;when&nbsp;session&nbsp;(non-persistent)&nbsp;cookies&nbsp;expire.</span><br>
<span class="lineno">435</span><span class="comment" id="5202928">//&nbsp;This&nbsp;instant&nbsp;is&nbsp;representable&nbsp;in&nbsp;most&nbsp;date/time&nbsp;formats&nbsp;(not&nbsp;just</span><br>
<span class="lineno"></span><span class="comment" id="5202997">//&nbsp;Go&#39;s&nbsp;time.Time)&nbsp;and&nbsp;should&nbsp;be&nbsp;far&nbsp;enough&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno"></span><span class="keyword" id="5203056">var</span>&nbsp;<span class="ident" id="5203060">endOfTime</span>&nbsp;<span class="op" id="5203070">=</span>&nbsp;<span class="ident" id="5203072">time</span><span class="op" id="5203076">.</span><span class="ident" id="5203077">Date</span><span class="op" id="5203081">(</span><span class="num" id="5203082">9999</span><span class="op" id="5203086">,</span>&nbsp;<span class="num" id="5203088">12</span><span class="op" id="5203090">,</span>&nbsp;<span class="num" id="5203092">31</span><span class="op" id="5203094">,</span>&nbsp;<span class="num" id="5203096">23</span><span class="op" id="5203098">,</span>&nbsp;<span class="num" id="5203100">59</span><span class="op" id="5203102">,</span>&nbsp;<span class="num" id="5203104">59</span><span class="op" id="5203106">,</span>&nbsp;<span class="num" id="5203108">0</span><span class="op" id="5203109">,</span>&nbsp;<span class="ident" id="5203111">time</span><span class="op" id="5203115">.</span><span class="ident" id="5203116">UTC</span><span class="op" id="5203119">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5203122">//&nbsp;domainAndType&nbsp;determines&nbsp;the&nbsp;cookie&#39;s&nbsp;domain&nbsp;and&nbsp;hostOnly&nbsp;attribute.</span><br>
<span class="lineno">440</span><span class="keyword" id="5203194">func</span>&nbsp;<span class="op" id="5203199">(</span><span class="ident" id="5203200">j</span>&nbsp;<span class="op" id="5203202">*</span><span class="ident" id="5203203">Jar</span><span class="op" id="5203206">)</span>&nbsp;<span class="ident" id="5203208">domainAndType</span><span class="op" id="5203221">(</span><span class="ident" id="5203222">host</span><span class="op" id="5203226">,</span>&nbsp;<span class="ident" id="5203228">domain</span>&nbsp;<span class="builtintype" id="5203235">string</span><span class="op" id="5203241">)</span>&nbsp;<span class="op" id="5203243">(</span><span class="builtintype" id="5203244">string</span><span class="op" id="5203250">,</span>&nbsp;<span class="builtintype" id="5203252">bool</span><span class="op" id="5203256">,</span>&nbsp;<span class="builtintype" id="5203258">error</span><span class="op" id="5203263">)</span>&nbsp;<span class="op" id="5203265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203268">if</span>&nbsp;<span class="ident" id="5203271">domain</span>&nbsp;<span class="op" id="5203278">==</span>&nbsp;<span class="string" id="5203281">&#34;&#34;</span>&nbsp;<span class="op" id="5203284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5203288">//&nbsp;No&nbsp;domain&nbsp;attribute&nbsp;in&nbsp;the&nbsp;SetCookie&nbsp;header&nbsp;indicates&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5203349">//&nbsp;host&nbsp;cookie.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203367">return</span>&nbsp;<span class="ident" id="5203374">host</span><span class="op" id="5203378">,</span>&nbsp;<span class="builtintype" id="5203380">true</span><span class="op" id="5203384">,</span>&nbsp;<span class="builtintype" id="5203386">nil</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5203391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203395">if</span>&nbsp;<span class="ident" id="5203398">isIP</span><span class="op" id="5203402">(</span><span class="ident" id="5203403">host</span><span class="op" id="5203407">)</span>&nbsp;<span class="op" id="5203409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5203413">//&nbsp;According&nbsp;to&nbsp;RFC&nbsp;6265&nbsp;domain-matching&nbsp;includes&nbsp;not&nbsp;being</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5203475">//&nbsp;an&nbsp;IP&nbsp;address.</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5203495">//&nbsp;TODO:&nbsp;This&nbsp;might&nbsp;be&nbsp;relaxed&nbsp;as&nbsp;in&nbsp;common&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203551">return</span>&nbsp;<span class="string" id="5203558">&#34;&#34;</span><span class="op" id="5203560">,</span>&nbsp;<span class="builtintype" id="5203562">false</span><span class="op" id="5203567">,</span>&nbsp;<span class="ident" id="5203569">errNoHostname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5203584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5203588">//&nbsp;From&nbsp;here&nbsp;on:&nbsp;If&nbsp;the&nbsp;cookie&nbsp;is&nbsp;valid,&nbsp;it&nbsp;is&nbsp;a&nbsp;domain&nbsp;cookie&nbsp;(with</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5203658">//&nbsp;the&nbsp;one&nbsp;exception&nbsp;of&nbsp;a&nbsp;public&nbsp;suffix&nbsp;below).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5203707">//&nbsp;See&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.2.3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203739">if</span>&nbsp;<span class="ident" id="5203742">domain</span><span class="op" id="5203748">[</span><span class="num" id="5203749">0</span><span class="op" id="5203750">]</span>&nbsp;<span class="op" id="5203752">==</span>&nbsp;<span class="string" id="5203755">&#39;.&#39;</span>&nbsp;<span class="op" id="5203759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203763">domain</span>&nbsp;<span class="op" id="5203770">=</span>&nbsp;<span class="ident" id="5203772">domain</span><span class="op" id="5203778">[</span><span class="num" id="5203779">1</span><span class="op" id="5203780">:</span><span class="op" id="5203781">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5203784">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203788">if</span>&nbsp;<span class="builtinfunc" id="5203791">len</span><span class="op" id="5203794">(</span><span class="ident" id="5203795">domain</span><span class="op" id="5203801">)</span>&nbsp;<span class="op" id="5203803">==</span>&nbsp;<span class="num" id="5203806">0</span>&nbsp;<span class="op" id="5203808">||</span>&nbsp;<span class="ident" id="5203811">domain</span><span class="op" id="5203817">[</span><span class="num" id="5203818">0</span><span class="op" id="5203819">]</span>&nbsp;<span class="op" id="5203821">==</span>&nbsp;<span class="string" id="5203824">&#39;.&#39;</span>&nbsp;<span class="op" id="5203828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5203832">//&nbsp;Received&nbsp;either&nbsp;&#34;Domain=.&#34;&nbsp;or&nbsp;&#34;Domain=..some.thing&#34;,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5203890">//&nbsp;both&nbsp;are&nbsp;illegal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203913">return</span>&nbsp;<span class="string" id="5203920">&#34;&#34;</span><span class="op" id="5203922">,</span>&nbsp;<span class="builtintype" id="5203924">false</span><span class="op" id="5203929">,</span>&nbsp;<span class="ident" id="5203931">errMalformedDomain</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5203951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203954">domain</span>&nbsp;<span class="op" id="5203961">=</span>&nbsp;<span class="ident" id="5203963">strings</span><span class="op" id="5203970">.</span><span class="ident" id="5203971">ToLower</span><span class="op" id="5203978">(</span><span class="ident" id="5203979">domain</span><span class="op" id="5203985">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203989">if</span>&nbsp;<span class="ident" id="5203992">domain</span><span class="op" id="5203998">[</span><span class="builtinfunc" id="5203999">len</span><span class="op" id="5204002">(</span><span class="ident" id="5204003">domain</span><span class="op" id="5204009">)</span><span class="op" id="5204010">-</span><span class="num" id="5204011">1</span><span class="op" id="5204012">]</span>&nbsp;<span class="op" id="5204014">==</span>&nbsp;<span class="string" id="5204017">&#39;.&#39;</span>&nbsp;<span class="op" id="5204021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5204025">//&nbsp;We&nbsp;received&nbsp;stuff&nbsp;like&nbsp;&#34;Domain=www.example.com.&#34;.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5204080">//&nbsp;Browsers&nbsp;do&nbsp;handle&nbsp;such&nbsp;stuff&nbsp;(actually&nbsp;differently)&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5204142">//&nbsp;RFC&nbsp;6265&nbsp;seems&nbsp;to&nbsp;be&nbsp;clear&nbsp;here&nbsp;(e.g.&nbsp;section&nbsp;4.1.2.3)&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5204205">//&nbsp;requiring&nbsp;a&nbsp;reject.&nbsp;&nbsp;4.1.2.3&nbsp;is&nbsp;not&nbsp;normative,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5204261">//&nbsp;&#34;Domain&nbsp;Matching&#34;&nbsp;(5.1.3)&nbsp;and&nbsp;&#34;Canonicalized&nbsp;Host&nbsp;Names&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5204323">//&nbsp;(5.1.2)&nbsp;are.</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204341">return</span>&nbsp;<span class="string" id="5204348">&#34;&#34;</span><span class="op" id="5204350">,</span>&nbsp;<span class="builtintype" id="5204352">false</span><span class="op" id="5204357">,</span>&nbsp;<span class="ident" id="5204359">errMalformedDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5204379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5204383">//&nbsp;See&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.3&nbsp;#5.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204416">if</span>&nbsp;<span class="ident" id="5204419">j</span><span class="op" id="5204420">.</span><span class="ident" id="5204421">psList</span>&nbsp;<span class="op" id="5204428">!=</span>&nbsp;<span class="builtintype" id="5204431">nil</span>&nbsp;<span class="op" id="5204435">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204439">if</span>&nbsp;<span class="ident" id="5204442">ps</span>&nbsp;<span class="op" id="5204445">:=</span>&nbsp;<span class="ident" id="5204448">j</span><span class="op" id="5204449">.</span><span class="ident" id="5204450">psList</span><span class="op" id="5204456">.</span><span class="ident" id="5204457">PublicSuffix</span><span class="op" id="5204469">(</span><span class="ident" id="5204470">domain</span><span class="op" id="5204476">)</span><span class="op" id="5204477">;</span>&nbsp;<span class="ident" id="5204479">ps</span>&nbsp;<span class="op" id="5204482">!=</span>&nbsp;<span class="string" id="5204485">&#34;&#34;</span>&nbsp;<span class="op" id="5204488">&amp;&amp;</span>&nbsp;<span class="op" id="5204491">!</span><span class="ident" id="5204492">hasDotSuffix</span><span class="op" id="5204504">(</span><span class="ident" id="5204505">domain</span><span class="op" id="5204511">,</span>&nbsp;<span class="ident" id="5204513">ps</span><span class="op" id="5204515">)</span>&nbsp;<span class="op" id="5204517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204522">if</span>&nbsp;<span class="ident" id="5204525">host</span>&nbsp;<span class="op" id="5204530">==</span>&nbsp;<span class="ident" id="5204533">domain</span>&nbsp;<span class="op" id="5204540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5204546">//&nbsp;This&nbsp;is&nbsp;the&nbsp;one&nbsp;exception&nbsp;in&nbsp;which&nbsp;a&nbsp;cookie</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5204597">//&nbsp;with&nbsp;a&nbsp;domain&nbsp;attribute&nbsp;is&nbsp;a&nbsp;host&nbsp;cookie.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204646">return</span>&nbsp;<span class="ident" id="5204653">host</span><span class="op" id="5204657">,</span>&nbsp;<span class="builtintype" id="5204659">true</span><span class="op" id="5204663">,</span>&nbsp;<span class="builtintype" id="5204665">nil</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5204672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204677">return</span>&nbsp;<span class="string" id="5204684">&#34;&#34;</span><span class="op" id="5204686">,</span>&nbsp;<span class="builtintype" id="5204688">false</span><span class="op" id="5204693">,</span>&nbsp;<span class="ident" id="5204695">errIllegalDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5204714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5204717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5204721">//&nbsp;The&nbsp;domain&nbsp;must&nbsp;domain-match&nbsp;host:&nbsp;www.mycompany.com&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5204785">//&nbsp;set&nbsp;cookies&nbsp;for&nbsp;.ourcompetitors.com.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204826">if</span>&nbsp;<span class="ident" id="5204829">host</span>&nbsp;<span class="op" id="5204834">!=</span>&nbsp;<span class="ident" id="5204837">domain</span>&nbsp;<span class="op" id="5204844">&amp;&amp;</span>&nbsp;<span class="op" id="5204847">!</span><span class="ident" id="5204848">hasDotSuffix</span><span class="op" id="5204860">(</span><span class="ident" id="5204861">host</span><span class="op" id="5204865">,</span>&nbsp;<span class="ident" id="5204867">domain</span><span class="op" id="5204873">)</span>&nbsp;<span class="op" id="5204875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204879">return</span>&nbsp;<span class="string" id="5204886">&#34;&#34;</span><span class="op" id="5204888">,</span>&nbsp;<span class="builtintype" id="5204890">false</span><span class="op" id="5204895">,</span>&nbsp;<span class="ident" id="5204897">errIllegalDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5204915">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204919">return</span>&nbsp;<span class="ident" id="5204926">domain</span><span class="op" id="5204932">,</span>&nbsp;<span class="builtintype" id="5204934">false</span><span class="op" id="5204939">,</span>&nbsp;<span class="builtintype" id="5204941">nil</span><br>
<span class="lineno"></span><span class="op" id="5204945">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
