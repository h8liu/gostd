<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/json</h2>
<ul>
<li><a href="/gostd/encoding/json/bench_test.go.html">bench_test.go</a></li>
<li><a href="/gostd/encoding/json/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/json/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/encoding/json/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/json/encode_test.go.html">encode_test.go</a></li>
<li><a href="/gostd/encoding/json/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/json/fold.go.html">fold.go</a></li>
<li><a href="/gostd/encoding/json/fold_test.go.html">fold_test.go</a></li>
<li><a href="/gostd/encoding/json/indent.go.html">indent.go</a></li>
<li><a href="/gostd/encoding/json/scanner.go.html">scanner.go</a></li>
<li><a href="/gostd/encoding/json/scanner_test.go.html">scanner_test.go</a></li>
<li><a href="/gostd/encoding/json/stream.go.html">stream.go</a></li>
<li><a href="/gostd/encoding/json/stream_test.go.html">stream_test.go</a></li>
<li><a href="/gostd/encoding/json/tagkey_test.go.html">tagkey_test.go</a></li>
<li><a href="/gostd/encoding/json/tags.go.html">tags.go</a></li>
<li><a href="/gostd/encoding/json/tags_test.go.html">tags_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8299817">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8299872">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8299926">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8299977">package</span>&nbsp;<span class="ident" id="8299985">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8299991">import</span>&nbsp;<span class="op" id="8299998">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8300001">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8300010">&#34;math&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8300018">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8300029">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8300040">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="8300050">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="8300053">type</span>&nbsp;<span class="ident" id="8300058">Optionals</span>&nbsp;<span class="keyword" id="8300068">struct</span>&nbsp;<span class="op" id="8300075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300078">Sr</span>&nbsp;<span class="builtintype" id="8300081">string</span>&nbsp;<span class="string" id="8300088">`json:&#34;sr&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300101">So</span>&nbsp;<span class="builtintype" id="8300104">string</span>&nbsp;<span class="string" id="8300111">`json:&#34;so,omitempty&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300134">Sw</span>&nbsp;<span class="builtintype" id="8300137">string</span>&nbsp;<span class="string" id="8300144">`json:&#34;-&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300157">Ir</span>&nbsp;<span class="builtintype" id="8300160">int</span>&nbsp;<span class="string" id="8300164">`json:&#34;omitempty&#34;`</span>&nbsp;<span class="comment" id="8300183">//&nbsp;actually&nbsp;named&nbsp;omitempty,&nbsp;not&nbsp;an&nbsp;option</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300227">Io</span>&nbsp;<span class="builtintype" id="8300230">int</span>&nbsp;<span class="string" id="8300234">`json:&#34;io,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300258">Slr</span>&nbsp;<span class="op" id="8300262">[</span><span class="op" id="8300263">]</span><span class="builtintype" id="8300264">string</span>&nbsp;<span class="string" id="8300271">`json:&#34;slr,random&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300292">Slo</span>&nbsp;<span class="op" id="8300296">[</span><span class="op" id="8300297">]</span><span class="builtintype" id="8300298">string</span>&nbsp;<span class="string" id="8300305">`json:&#34;slo,omitempty&#34;`</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300330">Mr</span>&nbsp;<span class="keyword" id="8300333">map</span><span class="op" id="8300336">[</span><span class="builtintype" id="8300337">string</span><span class="op" id="8300343">]</span><span class="keyword" id="8300344">interface</span><span class="op" id="8300353">{</span><span class="op" id="8300354">}</span>&nbsp;<span class="string" id="8300356">`json:&#34;mr&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300369">Mo</span>&nbsp;<span class="keyword" id="8300372">map</span><span class="op" id="8300375">[</span><span class="builtintype" id="8300376">string</span><span class="op" id="8300382">]</span><span class="keyword" id="8300383">interface</span><span class="op" id="8300392">{</span><span class="op" id="8300393">}</span>&nbsp;<span class="string" id="8300395">`json:&#34;,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300417">Fr</span>&nbsp;<span class="builtintype" id="8300420">float64</span>&nbsp;<span class="string" id="8300428">`json:&#34;fr&#34;`</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300441">Fo</span>&nbsp;<span class="builtintype" id="8300444">float64</span>&nbsp;<span class="string" id="8300452">`json:&#34;fo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300476">Br</span>&nbsp;<span class="builtintype" id="8300479">bool</span>&nbsp;<span class="string" id="8300484">`json:&#34;br&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300497">Bo</span>&nbsp;<span class="builtintype" id="8300500">bool</span>&nbsp;<span class="string" id="8300505">`json:&#34;bo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300529">Ur</span>&nbsp;<span class="builtintype" id="8300532">uint</span>&nbsp;<span class="string" id="8300537">`json:&#34;ur&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300550">Uo</span>&nbsp;<span class="builtintype" id="8300553">uint</span>&nbsp;<span class="string" id="8300558">`json:&#34;uo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300582">Str</span>&nbsp;<span class="keyword" id="8300586">struct</span><span class="op" id="8300592">{</span><span class="op" id="8300593">}</span>&nbsp;<span class="string" id="8300595">`json:&#34;str&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300609">Sto</span>&nbsp;<span class="keyword" id="8300613">struct</span><span class="op" id="8300619">{</span><span class="op" id="8300620">}</span>&nbsp;<span class="string" id="8300622">`json:&#34;sto,omitempty&#34;`</span><br>
<span class="lineno">40</span><span class="op" id="8300645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8300648">var</span>&nbsp;<span class="ident" id="8300652">optionalsExpected</span>&nbsp;<span class="op" id="8300670">=</span>&nbsp;<span class="string" id="8300672">`{<br>
<span class="lineno"></span>&nbsp;&#34;sr&#34;:&nbsp;&#34;&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;omitempty&#34;:&nbsp;0,<br>
<span class="lineno">45</span>&nbsp;&#34;slr&#34;:&nbsp;null,<br>
<span class="lineno"></span>&nbsp;&#34;mr&#34;:&nbsp;{},<br>
<span class="lineno"></span>&nbsp;&#34;fr&#34;:&nbsp;0,<br>
<span class="lineno"></span>&nbsp;&#34;br&#34;:&nbsp;false,<br>
<span class="lineno"></span>&nbsp;&#34;ur&#34;:&nbsp;0,<br>
<span class="lineno">50</span>&nbsp;&#34;str&#34;:&nbsp;{},<br>
<span class="lineno"></span>&nbsp;&#34;sto&#34;:&nbsp;{}<br>
<span class="lineno"></span>}`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8300789">func</span>&nbsp;<span class="ident" id="8300794">TestOmitEmpty</span><span class="op" id="8300807">(</span><span class="ident" id="8300808">t</span>&nbsp;<span class="op" id="8300810">*</span><span class="ident" id="8300811">testing</span><span class="op" id="8300818">.</span><span class="ident" id="8300819">T</span><span class="op" id="8300820">)</span>&nbsp;<span class="op" id="8300822">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8300825">var</span>&nbsp;<span class="ident" id="8300829">o</span>&nbsp;<span class="ident" id="8300831">Optionals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300842">o</span><span class="op" id="8300843">.</span><span class="ident" id="8300844">Sw</span>&nbsp;<span class="op" id="8300847">=</span>&nbsp;<span class="string" id="8300849">&#34;something&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300862">o</span><span class="op" id="8300863">.</span><span class="ident" id="8300864">Mr</span>&nbsp;<span class="op" id="8300867">=</span>&nbsp;<span class="keyword" id="8300869">map</span><span class="op" id="8300872">[</span><span class="builtintype" id="8300873">string</span><span class="op" id="8300879">]</span><span class="keyword" id="8300880">interface</span><span class="op" id="8300889">{</span><span class="op" id="8300890">}</span><span class="op" id="8300891">{</span><span class="op" id="8300892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300895">o</span><span class="op" id="8300896">.</span><span class="ident" id="8300897">Mo</span>&nbsp;<span class="op" id="8300900">=</span>&nbsp;<span class="keyword" id="8300902">map</span><span class="op" id="8300905">[</span><span class="builtintype" id="8300906">string</span><span class="op" id="8300912">]</span><span class="keyword" id="8300913">interface</span><span class="op" id="8300922">{</span><span class="op" id="8300923">}</span><span class="op" id="8300924">{</span><span class="op" id="8300925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300929">got</span><span class="op" id="8300932">,</span>&nbsp;<span class="ident" id="8300934">err</span>&nbsp;<span class="op" id="8300938">:=</span>&nbsp;<span class="ident" id="8300941">MarshalIndent</span><span class="op" id="8300954">(</span><span class="op" id="8300955">&amp;</span><span class="ident" id="8300956">o</span><span class="op" id="8300957">,</span>&nbsp;<span class="string" id="8300959">&#34;&#34;</span><span class="op" id="8300961">,</span>&nbsp;<span class="string" id="8300963">&#34;&nbsp;&#34;</span><span class="op" id="8300966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8300969">if</span>&nbsp;<span class="ident" id="8300972">err</span>&nbsp;<span class="op" id="8300976">!=</span>&nbsp;<span class="ident" id="8300979">nil</span>&nbsp;<span class="op" id="8300983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300987">t</span><span class="op" id="8300988">.</span><span class="ident" id="8300989">Fatal</span><span class="op" id="8300994">(</span><span class="ident" id="8300995">err</span><span class="op" id="8300998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8301001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8301004">if</span>&nbsp;<span class="ident" id="8301007">got</span>&nbsp;<span class="op" id="8301011">:=</span>&nbsp;<span class="builtintype" id="8301014">string</span><span class="op" id="8301020">(</span><span class="ident" id="8301021">got</span><span class="op" id="8301024">)</span><span class="op" id="8301025">;</span>&nbsp;<span class="ident" id="8301027">got</span>&nbsp;<span class="op" id="8301031">!=</span>&nbsp;<span class="ident" id="8301034">optionalsExpected</span>&nbsp;<span class="op" id="8301052">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301056">t</span><span class="op" id="8301057">.</span><span class="ident" id="8301058">Errorf</span><span class="op" id="8301064">(</span><span class="string" id="8301065">&#34;&nbsp;got:&nbsp;%s\nwant:&nbsp;%s\n&#34;</span><span class="op" id="8301087">,</span>&nbsp;<span class="ident" id="8301089">got</span><span class="op" id="8301092">,</span>&nbsp;<span class="ident" id="8301094">optionalsExpected</span><span class="op" id="8301111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8301114">}</span><br>
<span class="lineno"></span><span class="op" id="8301116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8301119">type</span>&nbsp;<span class="ident" id="8301124">StringTag</span>&nbsp;<span class="keyword" id="8301134">struct</span>&nbsp;<span class="op" id="8301141">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301144">BoolStr</span>&nbsp;<span class="builtintype" id="8301152">bool</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8301159">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301177">IntStr</span>&nbsp;&nbsp;<span class="ident" id="8301185">int64</span>&nbsp;&nbsp;<span class="string" id="8301192">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301210">StrStr</span>&nbsp;&nbsp;<span class="builtintype" id="8301218">string</span>&nbsp;<span class="string" id="8301225">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span><span class="op" id="8301242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="8301245">var</span>&nbsp;<span class="ident" id="8301249">stringTagExpected</span>&nbsp;<span class="op" id="8301267">=</span>&nbsp;<span class="string" id="8301269">`{<br>
<span class="lineno"></span>&nbsp;&#34;BoolStr&#34;:&nbsp;&#34;true&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;IntStr&#34;:&nbsp;&#34;42&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;StrStr&#34;:&nbsp;&#34;\&#34;xzbit\&#34;&#34;<br>
<span class="lineno"></span>}`</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="8301336">func</span>&nbsp;<span class="ident" id="8301341">TestStringTag</span><span class="op" id="8301354">(</span><span class="ident" id="8301355">t</span>&nbsp;<span class="op" id="8301357">*</span><span class="ident" id="8301358">testing</span><span class="op" id="8301365">.</span><span class="ident" id="8301366">T</span><span class="op" id="8301367">)</span>&nbsp;<span class="op" id="8301369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8301372">var</span>&nbsp;<span class="ident" id="8301376">s</span>&nbsp;<span class="ident" id="8301378">StringTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301389">s</span><span class="op" id="8301390">.</span><span class="ident" id="8301391">BoolStr</span>&nbsp;<span class="op" id="8301399">=</span>&nbsp;<span class="builtintype" id="8301401">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301407">s</span><span class="op" id="8301408">.</span><span class="ident" id="8301409">IntStr</span>&nbsp;<span class="op" id="8301416">=</span>&nbsp;<span class="num" id="8301418">42</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301422">s</span><span class="op" id="8301423">.</span><span class="ident" id="8301424">StrStr</span>&nbsp;<span class="op" id="8301431">=</span>&nbsp;<span class="string" id="8301433">&#34;xzbit&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301442">got</span><span class="op" id="8301445">,</span>&nbsp;<span class="ident" id="8301447">err</span>&nbsp;<span class="op" id="8301451">:=</span>&nbsp;<span class="ident" id="8301454">MarshalIndent</span><span class="op" id="8301467">(</span><span class="op" id="8301468">&amp;</span><span class="ident" id="8301469">s</span><span class="op" id="8301470">,</span>&nbsp;<span class="string" id="8301472">&#34;&#34;</span><span class="op" id="8301474">,</span>&nbsp;<span class="string" id="8301476">&#34;&nbsp;&#34;</span><span class="op" id="8301479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8301482">if</span>&nbsp;<span class="ident" id="8301485">err</span>&nbsp;<span class="op" id="8301489">!=</span>&nbsp;<span class="ident" id="8301492">nil</span>&nbsp;<span class="op" id="8301496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301500">t</span><span class="op" id="8301501">.</span><span class="ident" id="8301502">Fatal</span><span class="op" id="8301507">(</span><span class="ident" id="8301508">err</span><span class="op" id="8301511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8301514">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8301517">if</span>&nbsp;<span class="ident" id="8301520">got</span>&nbsp;<span class="op" id="8301524">:=</span>&nbsp;<span class="builtintype" id="8301527">string</span><span class="op" id="8301533">(</span><span class="ident" id="8301534">got</span><span class="op" id="8301537">)</span><span class="op" id="8301538">;</span>&nbsp;<span class="ident" id="8301540">got</span>&nbsp;<span class="op" id="8301544">!=</span>&nbsp;<span class="ident" id="8301547">stringTagExpected</span>&nbsp;<span class="op" id="8301565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301569">t</span><span class="op" id="8301570">.</span><span class="ident" id="8301571">Fatalf</span><span class="op" id="8301577">(</span><span class="string" id="8301578">&#34;&nbsp;got:&nbsp;%s\nwant:&nbsp;%s\n&#34;</span><span class="op" id="8301600">,</span>&nbsp;<span class="ident" id="8301602">got</span><span class="op" id="8301605">,</span>&nbsp;<span class="ident" id="8301607">stringTagExpected</span><span class="op" id="8301624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8301627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8301631">//&nbsp;Verify&nbsp;that&nbsp;it&nbsp;round-trips.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8301663">var</span>&nbsp;<span class="ident" id="8301667">s2</span>&nbsp;<span class="ident" id="8301670">StringTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301681">err</span>&nbsp;<span class="op" id="8301685">=</span>&nbsp;<span class="ident" id="8301687">NewDecoder</span><span class="op" id="8301697">(</span><span class="ident" id="8301698">bytes</span><span class="op" id="8301703">.</span><span class="ident" id="8301704">NewReader</span><span class="op" id="8301713">(</span><span class="ident" id="8301714">got</span><span class="op" id="8301717">)</span><span class="op" id="8301718">)</span><span class="op" id="8301719">.</span><span class="ident" id="8301720">Decode</span><span class="op" id="8301726">(</span><span class="op" id="8301727">&amp;</span><span class="ident" id="8301728">s2</span><span class="op" id="8301730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8301733">if</span>&nbsp;<span class="ident" id="8301736">err</span>&nbsp;<span class="op" id="8301740">!=</span>&nbsp;<span class="ident" id="8301743">nil</span>&nbsp;<span class="op" id="8301747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301751">t</span><span class="op" id="8301752">.</span><span class="ident" id="8301753">Fatalf</span><span class="op" id="8301759">(</span><span class="string" id="8301760">&#34;Decode:&nbsp;%v&#34;</span><span class="op" id="8301772">,</span>&nbsp;<span class="ident" id="8301774">err</span><span class="op" id="8301777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8301780">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8301783">if</span>&nbsp;<span class="op" id="8301786">!</span><span class="ident" id="8301787">reflect</span><span class="op" id="8301794">.</span><span class="ident" id="8301795">DeepEqual</span><span class="op" id="8301804">(</span><span class="ident" id="8301805">s</span><span class="op" id="8301806">,</span>&nbsp;<span class="ident" id="8301808">s2</span><span class="op" id="8301810">)</span>&nbsp;<span class="op" id="8301812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301816">t</span><span class="op" id="8301817">.</span><span class="ident" id="8301818">Fatalf</span><span class="op" id="8301824">(</span><span class="string" id="8301825">&#34;decode&nbsp;didn&#39;t&nbsp;match.\nsource:&nbsp;%#v\nEncoded&nbsp;as:\n%s\ndecode:&nbsp;%#v&#34;</span><span class="op" id="8301890">,</span>&nbsp;<span class="ident" id="8301892">s</span><span class="op" id="8301893">,</span>&nbsp;<span class="builtintype" id="8301895">string</span><span class="op" id="8301901">(</span><span class="ident" id="8301902">got</span><span class="op" id="8301905">)</span><span class="op" id="8301906">,</span>&nbsp;<span class="ident" id="8301908">s2</span><span class="op" id="8301910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8301913">}</span><br>
<span class="lineno"></span><span class="op" id="8301915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="8301918">//&nbsp;byte&nbsp;slices&nbsp;are&nbsp;special&nbsp;even&nbsp;if&nbsp;they&#39;re&nbsp;renamed&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="8301976">type</span>&nbsp;<span class="ident" id="8301981">renamedByte</span>&nbsp;<span class="builtintype" id="8301993">byte</span><br>
<span class="lineno"></span><span class="keyword" id="8301998">type</span>&nbsp;<span class="ident" id="8302003">renamedByteSlice</span>&nbsp;<span class="op" id="8302020">[</span><span class="op" id="8302021">]</span><span class="builtintype" id="8302022">byte</span><br>
<span class="lineno"></span><span class="keyword" id="8302027">type</span>&nbsp;<span class="ident" id="8302032">renamedRenamedByteSlice</span>&nbsp;<span class="op" id="8302056">[</span><span class="op" id="8302057">]</span><span class="ident" id="8302058">renamedByte</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="8302071">func</span>&nbsp;<span class="ident" id="8302076">TestEncodeRenamedByteSlice</span><span class="op" id="8302102">(</span><span class="ident" id="8302103">t</span>&nbsp;<span class="op" id="8302105">*</span><span class="ident" id="8302106">testing</span><span class="op" id="8302113">.</span><span class="ident" id="8302114">T</span><span class="op" id="8302115">)</span>&nbsp;<span class="op" id="8302117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8302120">s</span>&nbsp;<span class="op" id="8302122">:=</span>&nbsp;<span class="ident" id="8302125">renamedByteSlice</span><span class="op" id="8302141">(</span><span class="string" id="8302142">&#34;abc&#34;</span><span class="op" id="8302147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8302150">result</span><span class="op" id="8302156">,</span>&nbsp;<span class="ident" id="8302158">err</span>&nbsp;<span class="op" id="8302162">:=</span>&nbsp;<span class="ident" id="8302165">Marshal</span><span class="op" id="8302172">(</span><span class="ident" id="8302173">s</span><span class="op" id="8302174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8302177">if</span>&nbsp;<span class="ident" id="8302180">err</span>&nbsp;<span class="op" id="8302184">!=</span>&nbsp;<span class="ident" id="8302187">nil</span>&nbsp;<span class="op" id="8302191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8302195">t</span><span class="op" id="8302196">.</span><span class="ident" id="8302197">Fatal</span><span class="op" id="8302202">(</span><span class="ident" id="8302203">err</span><span class="op" id="8302206">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8302209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8302212">expect</span>&nbsp;<span class="op" id="8302219">:=</span>&nbsp;<span class="string" id="8302222">`&#34;YWJj&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8302232">if</span>&nbsp;<span class="builtintype" id="8302235">string</span><span class="op" id="8302241">(</span><span class="ident" id="8302242">result</span><span class="op" id="8302248">)</span>&nbsp;<span class="op" id="8302250">!=</span>&nbsp;<span class="ident" id="8302253">expect</span>&nbsp;<span class="op" id="8302260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8302264">t</span><span class="op" id="8302265">.</span><span class="ident" id="8302266">Errorf</span><span class="op" id="8302272">(</span><span class="string" id="8302273">&#34;&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8302290">,</span>&nbsp;<span class="ident" id="8302292">result</span><span class="op" id="8302298">,</span>&nbsp;<span class="ident" id="8302300">expect</span><span class="op" id="8302306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8302309">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8302312">r</span>&nbsp;<span class="op" id="8302314">:=</span>&nbsp;<span class="ident" id="8302317">renamedRenamedByteSlice</span><span class="op" id="8302340">(</span><span class="string" id="8302341">&#34;abc&#34;</span><span class="op" id="8302346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8302349">result</span><span class="op" id="8302355">,</span>&nbsp;<span class="ident" id="8302357">err</span>&nbsp;<span class="op" id="8302361">=</span>&nbsp;<span class="ident" id="8302363">Marshal</span><span class="op" id="8302370">(</span><span class="ident" id="8302371">r</span><span class="op" id="8302372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8302375">if</span>&nbsp;<span class="ident" id="8302378">err</span>&nbsp;<span class="op" id="8302382">!=</span>&nbsp;<span class="ident" id="8302385">nil</span>&nbsp;<span class="op" id="8302389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8302393">t</span><span class="op" id="8302394">.</span><span class="ident" id="8302395">Fatal</span><span class="op" id="8302400">(</span><span class="ident" id="8302401">err</span><span class="op" id="8302404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8302407">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8302410">if</span>&nbsp;<span class="builtintype" id="8302413">string</span><span class="op" id="8302419">(</span><span class="ident" id="8302420">result</span><span class="op" id="8302426">)</span>&nbsp;<span class="op" id="8302428">!=</span>&nbsp;<span class="ident" id="8302431">expect</span>&nbsp;<span class="op" id="8302438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8302442">t</span><span class="op" id="8302443">.</span><span class="ident" id="8302444">Errorf</span><span class="op" id="8302450">(</span><span class="string" id="8302451">&#34;&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8302468">,</span>&nbsp;<span class="ident" id="8302470">result</span><span class="op" id="8302476">,</span>&nbsp;<span class="ident" id="8302478">expect</span><span class="op" id="8302484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8302487">}</span><br>
<span class="lineno"></span><span class="op" id="8302489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="8302492">var</span>&nbsp;<span class="ident" id="8302496">unsupportedValues</span>&nbsp;<span class="op" id="8302514">=</span>&nbsp;<span class="op" id="8302516">[</span><span class="op" id="8302517">]</span><span class="keyword" id="8302518">interface</span><span class="op" id="8302527">{</span><span class="op" id="8302528">}</span><span class="op" id="8302529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8302532">math</span><span class="op" id="8302536">.</span><span class="ident" id="8302537">NaN</span><span class="op" id="8302540">(</span><span class="op" id="8302541">)</span><span class="op" id="8302542">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8302545">math</span><span class="op" id="8302549">.</span><span class="ident" id="8302550">Inf</span><span class="op" id="8302553">(</span><span class="op" id="8302554">-</span><span class="num" id="8302555">1</span><span class="op" id="8302556">)</span><span class="op" id="8302557">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8302560">math</span><span class="op" id="8302564">.</span><span class="ident" id="8302565">Inf</span><span class="op" id="8302568">(</span><span class="num" id="8302569">1</span><span class="op" id="8302570">)</span><span class="op" id="8302571">,</span><br>
<span class="lineno"></span><span class="op" id="8302573">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="8302576">func</span>&nbsp;<span class="ident" id="8302581">TestUnsupportedValues</span><span class="op" id="8302602">(</span><span class="ident" id="8302603">t</span>&nbsp;<span class="op" id="8302605">*</span><span class="ident" id="8302606">testing</span><span class="op" id="8302613">.</span><span class="ident" id="8302614">T</span><span class="op" id="8302615">)</span>&nbsp;<span class="op" id="8302617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8302620">for</span>&nbsp;<span class="ident" id="8302624">_</span><span class="op" id="8302625">,</span>&nbsp;<span class="ident" id="8302627">v</span>&nbsp;<span class="op" id="8302629">:=</span>&nbsp;<span class="keyword" id="8302632">range</span>&nbsp;<span class="ident" id="8302638">unsupportedValues</span>&nbsp;<span class="op" id="8302656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8302660">if</span>&nbsp;<span class="ident" id="8302663">_</span><span class="op" id="8302664">,</span>&nbsp;<span class="ident" id="8302666">err</span>&nbsp;<span class="op" id="8302670">:=</span>&nbsp;<span class="ident" id="8302673">Marshal</span><span class="op" id="8302680">(</span><span class="ident" id="8302681">v</span><span class="op" id="8302682">)</span><span class="op" id="8302683">;</span>&nbsp;<span class="ident" id="8302685">err</span>&nbsp;<span class="op" id="8302689">!=</span>&nbsp;<span class="ident" id="8302692">nil</span>&nbsp;<span class="op" id="8302696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8302701">if</span>&nbsp;<span class="ident" id="8302704">_</span><span class="op" id="8302705">,</span>&nbsp;<span class="ident" id="8302707">ok</span>&nbsp;<span class="op" id="8302710">:=</span>&nbsp;<span class="ident" id="8302713">err</span><span class="op" id="8302716">.</span><span class="op" id="8302717">(</span><span class="op" id="8302718">*</span><span class="ident" id="8302719">UnsupportedValueError</span><span class="op" id="8302740">)</span><span class="op" id="8302741">;</span>&nbsp;<span class="op" id="8302743">!</span><span class="ident" id="8302744">ok</span>&nbsp;<span class="op" id="8302747">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8302753">t</span><span class="op" id="8302754">.</span><span class="ident" id="8302755">Errorf</span><span class="op" id="8302761">(</span><span class="string" id="8302762">&#34;for&nbsp;%v,&nbsp;got&nbsp;%T&nbsp;want&nbsp;UnsupportedValueError&#34;</span><span class="op" id="8302805">,</span>&nbsp;<span class="ident" id="8302807">v</span><span class="op" id="8302808">,</span>&nbsp;<span class="ident" id="8302810">err</span><span class="op" id="8302813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8302818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8302822">}</span>&nbsp;<span class="keyword" id="8302824">else</span>&nbsp;<span class="op" id="8302829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8302834">t</span><span class="op" id="8302835">.</span><span class="ident" id="8302836">Errorf</span><span class="op" id="8302842">(</span><span class="string" id="8302843">&#34;for&nbsp;%v,&nbsp;expected&nbsp;error&#34;</span><span class="op" id="8302867">,</span>&nbsp;<span class="ident" id="8302869">v</span><span class="op" id="8302870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8302874">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8302877">}</span><br>
<span class="lineno"></span><span class="op" id="8302879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8302882">//&nbsp;Ref&nbsp;has&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;methods&nbsp;with&nbsp;pointer&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="8302950">type</span>&nbsp;<span class="ident" id="8302955">Ref</span>&nbsp;<span class="builtintype" id="8302959">int</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="8302964">func</span>&nbsp;<span class="op" id="8302969">(</span><span class="op" id="8302970">*</span><span class="ident" id="8302971">Ref</span><span class="op" id="8302974">)</span>&nbsp;<span class="ident" id="8302976">MarshalJSON</span><span class="op" id="8302987">(</span><span class="op" id="8302988">)</span>&nbsp;<span class="op" id="8302990">(</span><span class="op" id="8302991">[</span><span class="op" id="8302992">]</span><span class="builtintype" id="8302993">byte</span><span class="op" id="8302997">,</span>&nbsp;<span class="builtintype" id="8302999">error</span><span class="op" id="8303004">)</span>&nbsp;<span class="op" id="8303006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8303009">return</span>&nbsp;<span class="op" id="8303016">[</span><span class="op" id="8303017">]</span><span class="builtintype" id="8303018">byte</span><span class="op" id="8303022">(</span><span class="string" id="8303023">`&#34;ref&#34;`</span><span class="op" id="8303030">)</span><span class="op" id="8303031">,</span>&nbsp;<span class="ident" id="8303033">nil</span><br>
<span class="lineno"></span><span class="op" id="8303037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="8303040">func</span>&nbsp;<span class="op" id="8303045">(</span><span class="ident" id="8303046">r</span>&nbsp;<span class="op" id="8303048">*</span><span class="ident" id="8303049">Ref</span><span class="op" id="8303052">)</span>&nbsp;<span class="ident" id="8303054">UnmarshalJSON</span><span class="op" id="8303067">(</span><span class="op" id="8303068">[</span><span class="op" id="8303069">]</span><span class="builtintype" id="8303070">byte</span><span class="op" id="8303074">)</span>&nbsp;<span class="builtintype" id="8303076">error</span>&nbsp;<span class="op" id="8303082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8303085">*</span><span class="ident" id="8303086">r</span>&nbsp;<span class="op" id="8303088">=</span>&nbsp;<span class="num" id="8303090">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8303094">return</span>&nbsp;<span class="ident" id="8303101">nil</span><br>
<span class="lineno"></span><span class="op" id="8303105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="8303108">//&nbsp;Val&nbsp;has&nbsp;Marshaler&nbsp;methods&nbsp;with&nbsp;value&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="8303158">type</span>&nbsp;<span class="ident" id="8303163">Val</span>&nbsp;<span class="builtintype" id="8303167">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8303172">func</span>&nbsp;<span class="op" id="8303177">(</span><span class="ident" id="8303178">Val</span><span class="op" id="8303181">)</span>&nbsp;<span class="ident" id="8303183">MarshalJSON</span><span class="op" id="8303194">(</span><span class="op" id="8303195">)</span>&nbsp;<span class="op" id="8303197">(</span><span class="op" id="8303198">[</span><span class="op" id="8303199">]</span><span class="builtintype" id="8303200">byte</span><span class="op" id="8303204">,</span>&nbsp;<span class="builtintype" id="8303206">error</span><span class="op" id="8303211">)</span>&nbsp;<span class="op" id="8303213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8303216">return</span>&nbsp;<span class="op" id="8303223">[</span><span class="op" id="8303224">]</span><span class="builtintype" id="8303225">byte</span><span class="op" id="8303229">(</span><span class="string" id="8303230">`&#34;val&#34;`</span><span class="op" id="8303237">)</span><span class="op" id="8303238">,</span>&nbsp;<span class="ident" id="8303240">nil</span><br>
<span class="lineno">165</span><span class="op" id="8303244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8303247">//&nbsp;RefText&nbsp;has&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;methods&nbsp;with&nbsp;pointer&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="8303319">type</span>&nbsp;<span class="ident" id="8303324">RefText</span>&nbsp;<span class="builtintype" id="8303332">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="8303337">func</span>&nbsp;<span class="op" id="8303342">(</span><span class="op" id="8303343">*</span><span class="ident" id="8303344">RefText</span><span class="op" id="8303351">)</span>&nbsp;<span class="ident" id="8303353">MarshalText</span><span class="op" id="8303364">(</span><span class="op" id="8303365">)</span>&nbsp;<span class="op" id="8303367">(</span><span class="op" id="8303368">[</span><span class="op" id="8303369">]</span><span class="builtintype" id="8303370">byte</span><span class="op" id="8303374">,</span>&nbsp;<span class="builtintype" id="8303376">error</span><span class="op" id="8303381">)</span>&nbsp;<span class="op" id="8303383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8303386">return</span>&nbsp;<span class="op" id="8303393">[</span><span class="op" id="8303394">]</span><span class="builtintype" id="8303395">byte</span><span class="op" id="8303399">(</span><span class="string" id="8303400">`&#34;ref&#34;`</span><span class="op" id="8303407">)</span><span class="op" id="8303408">,</span>&nbsp;<span class="ident" id="8303410">nil</span><br>
<span class="lineno"></span><span class="op" id="8303414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8303417">func</span>&nbsp;<span class="op" id="8303422">(</span><span class="ident" id="8303423">r</span>&nbsp;<span class="op" id="8303425">*</span><span class="ident" id="8303426">RefText</span><span class="op" id="8303433">)</span>&nbsp;<span class="ident" id="8303435">UnmarshalText</span><span class="op" id="8303448">(</span><span class="op" id="8303449">[</span><span class="op" id="8303450">]</span><span class="builtintype" id="8303451">byte</span><span class="op" id="8303455">)</span>&nbsp;<span class="builtintype" id="8303457">error</span>&nbsp;<span class="op" id="8303463">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8303466">*</span><span class="ident" id="8303467">r</span>&nbsp;<span class="op" id="8303469">=</span>&nbsp;<span class="num" id="8303471">13</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8303475">return</span>&nbsp;<span class="ident" id="8303482">nil</span><br>
<span class="lineno"></span><span class="op" id="8303486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8303489">//&nbsp;ValText&nbsp;has&nbsp;Marshaler&nbsp;methods&nbsp;with&nbsp;value&nbsp;receiver.</span><br>
<span class="lineno">180</span><span class="keyword" id="8303543">type</span>&nbsp;<span class="ident" id="8303548">ValText</span>&nbsp;<span class="builtintype" id="8303556">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8303561">func</span>&nbsp;<span class="op" id="8303566">(</span><span class="ident" id="8303567">ValText</span><span class="op" id="8303574">)</span>&nbsp;<span class="ident" id="8303576">MarshalText</span><span class="op" id="8303587">(</span><span class="op" id="8303588">)</span>&nbsp;<span class="op" id="8303590">(</span><span class="op" id="8303591">[</span><span class="op" id="8303592">]</span><span class="builtintype" id="8303593">byte</span><span class="op" id="8303597">,</span>&nbsp;<span class="builtintype" id="8303599">error</span><span class="op" id="8303604">)</span>&nbsp;<span class="op" id="8303606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8303609">return</span>&nbsp;<span class="op" id="8303616">[</span><span class="op" id="8303617">]</span><span class="builtintype" id="8303618">byte</span><span class="op" id="8303622">(</span><span class="string" id="8303623">`&#34;val&#34;`</span><span class="op" id="8303630">)</span><span class="op" id="8303631">,</span>&nbsp;<span class="ident" id="8303633">nil</span><br>
<span class="lineno"></span><span class="op" id="8303637">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="keyword" id="8303640">func</span>&nbsp;<span class="ident" id="8303645">TestRefValMarshal</span><span class="op" id="8303662">(</span><span class="ident" id="8303663">t</span>&nbsp;<span class="op" id="8303665">*</span><span class="ident" id="8303666">testing</span><span class="op" id="8303673">.</span><span class="ident" id="8303674">T</span><span class="op" id="8303675">)</span>&nbsp;<span class="op" id="8303677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8303680">var</span>&nbsp;<span class="ident" id="8303684">s</span>&nbsp;<span class="op" id="8303686">=</span>&nbsp;<span class="keyword" id="8303688">struct</span>&nbsp;<span class="op" id="8303695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8303699">R0</span>&nbsp;<span class="ident" id="8303702">Ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8303708">R1</span>&nbsp;<span class="op" id="8303711">*</span><span class="ident" id="8303712">Ref</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8303718">R2</span>&nbsp;<span class="ident" id="8303721">RefText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8303731">R3</span>&nbsp;<span class="op" id="8303734">*</span><span class="ident" id="8303735">RefText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8303745">V0</span>&nbsp;<span class="ident" id="8303748">Val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8303754">V1</span>&nbsp;<span class="op" id="8303757">*</span><span class="ident" id="8303758">Val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8303764">V2</span>&nbsp;<span class="ident" id="8303767">ValText</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8303777">V3</span>&nbsp;<span class="op" id="8303780">*</span><span class="ident" id="8303781">ValText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8303790">}</span><span class="op" id="8303791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8303795">R0</span><span class="op" id="8303797">:</span>&nbsp;<span class="num" id="8303799">12</span><span class="op" id="8303801">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8303805">R1</span><span class="op" id="8303807">:</span>&nbsp;<span class="builtinfunc" id="8303809">new</span><span class="op" id="8303812">(</span><span class="ident" id="8303813">Ref</span><span class="op" id="8303816">)</span><span class="op" id="8303817">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8303821">R2</span><span class="op" id="8303823">:</span>&nbsp;<span class="num" id="8303825">14</span><span class="op" id="8303827">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8303831">R3</span><span class="op" id="8303833">:</span>&nbsp;<span class="builtinfunc" id="8303835">new</span><span class="op" id="8303838">(</span><span class="ident" id="8303839">RefText</span><span class="op" id="8303846">)</span><span class="op" id="8303847">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8303851">V0</span><span class="op" id="8303853">:</span>&nbsp;<span class="num" id="8303855">13</span><span class="op" id="8303857">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8303861">V1</span><span class="op" id="8303863">:</span>&nbsp;<span class="builtinfunc" id="8303865">new</span><span class="op" id="8303868">(</span><span class="ident" id="8303869">Val</span><span class="op" id="8303872">)</span><span class="op" id="8303873">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8303877">V2</span><span class="op" id="8303879">:</span>&nbsp;<span class="num" id="8303881">15</span><span class="op" id="8303883">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8303887">V3</span><span class="op" id="8303889">:</span>&nbsp;<span class="builtinfunc" id="8303891">new</span><span class="op" id="8303894">(</span><span class="ident" id="8303895">ValText</span><span class="op" id="8303902">)</span><span class="op" id="8303903">,</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8303906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8303909">const</span>&nbsp;<span class="ident" id="8303915">want</span>&nbsp;<span class="op" id="8303920">=</span>&nbsp;<span class="string" id="8303922">`{&#34;R0&#34;:&#34;ref&#34;,&#34;R1&#34;:&#34;ref&#34;,&#34;R2&#34;:&#34;\&#34;ref\&#34;&#34;,&#34;R3&#34;:&#34;\&#34;ref\&#34;&#34;,&#34;V0&#34;:&#34;val&#34;,&#34;V1&#34;:&#34;val&#34;,&#34;V2&#34;:&#34;\&#34;val\&#34;&#34;,&#34;V3&#34;:&#34;\&#34;val\&#34;&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8304031">b</span><span class="op" id="8304032">,</span>&nbsp;<span class="ident" id="8304034">err</span>&nbsp;<span class="op" id="8304038">:=</span>&nbsp;<span class="ident" id="8304041">Marshal</span><span class="op" id="8304048">(</span><span class="op" id="8304049">&amp;</span><span class="ident" id="8304050">s</span><span class="op" id="8304051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8304054">if</span>&nbsp;<span class="ident" id="8304057">err</span>&nbsp;<span class="op" id="8304061">!=</span>&nbsp;<span class="ident" id="8304064">nil</span>&nbsp;<span class="op" id="8304068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8304072">t</span><span class="op" id="8304073">.</span><span class="ident" id="8304074">Fatalf</span><span class="op" id="8304080">(</span><span class="string" id="8304081">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="8304094">,</span>&nbsp;<span class="ident" id="8304096">err</span><span class="op" id="8304099">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8304102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8304105">if</span>&nbsp;<span class="ident" id="8304108">got</span>&nbsp;<span class="op" id="8304112">:=</span>&nbsp;<span class="builtintype" id="8304115">string</span><span class="op" id="8304121">(</span><span class="ident" id="8304122">b</span><span class="op" id="8304123">)</span><span class="op" id="8304124">;</span>&nbsp;<span class="ident" id="8304126">got</span>&nbsp;<span class="op" id="8304130">!=</span>&nbsp;<span class="ident" id="8304133">want</span>&nbsp;<span class="op" id="8304138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8304142">t</span><span class="op" id="8304143">.</span><span class="ident" id="8304144">Errorf</span><span class="op" id="8304150">(</span><span class="string" id="8304151">&#34;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8304168">,</span>&nbsp;<span class="ident" id="8304170">got</span><span class="op" id="8304173">,</span>&nbsp;<span class="ident" id="8304175">want</span><span class="op" id="8304179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8304182">}</span><br>
<span class="lineno"></span><span class="op" id="8304184">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="comment" id="8304187">//&nbsp;C&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;returns&nbsp;unescaped&nbsp;JSON.</span><br>
<span class="lineno"></span><span class="keyword" id="8304241">type</span>&nbsp;<span class="ident" id="8304246">C</span>&nbsp;<span class="builtintype" id="8304248">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8304253">func</span>&nbsp;<span class="op" id="8304258">(</span><span class="ident" id="8304259">C</span><span class="op" id="8304260">)</span>&nbsp;<span class="ident" id="8304262">MarshalJSON</span><span class="op" id="8304273">(</span><span class="op" id="8304274">)</span>&nbsp;<span class="op" id="8304276">(</span><span class="op" id="8304277">[</span><span class="op" id="8304278">]</span><span class="builtintype" id="8304279">byte</span><span class="op" id="8304283">,</span>&nbsp;<span class="builtintype" id="8304285">error</span><span class="op" id="8304290">)</span>&nbsp;<span class="op" id="8304292">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8304295">return</span>&nbsp;<span class="op" id="8304302">[</span><span class="op" id="8304303">]</span><span class="builtintype" id="8304304">byte</span><span class="op" id="8304308">(</span><span class="string" id="8304309">`&#34;&lt;&amp;&gt;&#34;`</span><span class="op" id="8304316">)</span><span class="op" id="8304317">,</span>&nbsp;<span class="ident" id="8304319">nil</span><br>
<span class="lineno"></span><span class="op" id="8304323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8304326">//&nbsp;CText&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;returns&nbsp;unescaped&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="8304384">type</span>&nbsp;<span class="ident" id="8304389">CText</span>&nbsp;<span class="builtintype" id="8304395">int</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="keyword" id="8304400">func</span>&nbsp;<span class="op" id="8304405">(</span><span class="ident" id="8304406">CText</span><span class="op" id="8304411">)</span>&nbsp;<span class="ident" id="8304413">MarshalText</span><span class="op" id="8304424">(</span><span class="op" id="8304425">)</span>&nbsp;<span class="op" id="8304427">(</span><span class="op" id="8304428">[</span><span class="op" id="8304429">]</span><span class="builtintype" id="8304430">byte</span><span class="op" id="8304434">,</span>&nbsp;<span class="builtintype" id="8304436">error</span><span class="op" id="8304441">)</span>&nbsp;<span class="op" id="8304443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8304446">return</span>&nbsp;<span class="op" id="8304453">[</span><span class="op" id="8304454">]</span><span class="builtintype" id="8304455">byte</span><span class="op" id="8304459">(</span><span class="string" id="8304460">`&#34;&lt;&amp;&gt;&#34;`</span><span class="op" id="8304467">)</span><span class="op" id="8304468">,</span>&nbsp;<span class="ident" id="8304470">nil</span><br>
<span class="lineno"></span><span class="op" id="8304474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="8304477">func</span>&nbsp;<span class="ident" id="8304482">TestMarshalerEscaping</span><span class="op" id="8304503">(</span><span class="ident" id="8304504">t</span>&nbsp;<span class="op" id="8304506">*</span><span class="ident" id="8304507">testing</span><span class="op" id="8304514">.</span><span class="ident" id="8304515">T</span><span class="op" id="8304516">)</span>&nbsp;<span class="op" id="8304518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8304521">var</span>&nbsp;<span class="ident" id="8304525">c</span>&nbsp;<span class="ident" id="8304527">C</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8304530">want</span>&nbsp;<span class="op" id="8304535">:=</span>&nbsp;<span class="string" id="8304538">`&#34;\u003c\u0026\u003e&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8304562">b</span><span class="op" id="8304563">,</span>&nbsp;<span class="ident" id="8304565">err</span>&nbsp;<span class="op" id="8304569">:=</span>&nbsp;<span class="ident" id="8304572">Marshal</span><span class="op" id="8304579">(</span><span class="ident" id="8304580">c</span><span class="op" id="8304581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8304584">if</span>&nbsp;<span class="ident" id="8304587">err</span>&nbsp;<span class="op" id="8304591">!=</span>&nbsp;<span class="ident" id="8304594">nil</span>&nbsp;<span class="op" id="8304598">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8304602">t</span><span class="op" id="8304603">.</span><span class="ident" id="8304604">Fatalf</span><span class="op" id="8304610">(</span><span class="string" id="8304611">&#34;Marshal(c):&nbsp;%v&#34;</span><span class="op" id="8304627">,</span>&nbsp;<span class="ident" id="8304629">err</span><span class="op" id="8304632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8304635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8304638">if</span>&nbsp;<span class="ident" id="8304641">got</span>&nbsp;<span class="op" id="8304645">:=</span>&nbsp;<span class="builtintype" id="8304648">string</span><span class="op" id="8304654">(</span><span class="ident" id="8304655">b</span><span class="op" id="8304656">)</span><span class="op" id="8304657">;</span>&nbsp;<span class="ident" id="8304659">got</span>&nbsp;<span class="op" id="8304663">!=</span>&nbsp;<span class="ident" id="8304666">want</span>&nbsp;<span class="op" id="8304671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8304675">t</span><span class="op" id="8304676">.</span><span class="ident" id="8304677">Errorf</span><span class="op" id="8304683">(</span><span class="string" id="8304684">&#34;Marshal(c)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="8304712">,</span>&nbsp;<span class="ident" id="8304714">got</span><span class="op" id="8304717">,</span>&nbsp;<span class="ident" id="8304719">want</span><span class="op" id="8304723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8304726">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8304730">var</span>&nbsp;<span class="ident" id="8304734">ct</span>&nbsp;<span class="ident" id="8304737">CText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8304744">want</span>&nbsp;<span class="op" id="8304749">=</span>&nbsp;<span class="string" id="8304751">`&#34;\&#34;\u003c\u0026\u003e\&#34;&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8304779">b</span><span class="op" id="8304780">,</span>&nbsp;<span class="ident" id="8304782">err</span>&nbsp;<span class="op" id="8304786">=</span>&nbsp;<span class="ident" id="8304788">Marshal</span><span class="op" id="8304795">(</span><span class="ident" id="8304796">ct</span><span class="op" id="8304798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8304801">if</span>&nbsp;<span class="ident" id="8304804">err</span>&nbsp;<span class="op" id="8304808">!=</span>&nbsp;<span class="ident" id="8304811">nil</span>&nbsp;<span class="op" id="8304815">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8304819">t</span><span class="op" id="8304820">.</span><span class="ident" id="8304821">Fatalf</span><span class="op" id="8304827">(</span><span class="string" id="8304828">&#34;Marshal(ct):&nbsp;%v&#34;</span><span class="op" id="8304845">,</span>&nbsp;<span class="ident" id="8304847">err</span><span class="op" id="8304850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8304853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8304856">if</span>&nbsp;<span class="ident" id="8304859">got</span>&nbsp;<span class="op" id="8304863">:=</span>&nbsp;<span class="builtintype" id="8304866">string</span><span class="op" id="8304872">(</span><span class="ident" id="8304873">b</span><span class="op" id="8304874">)</span><span class="op" id="8304875">;</span>&nbsp;<span class="ident" id="8304877">got</span>&nbsp;<span class="op" id="8304881">!=</span>&nbsp;<span class="ident" id="8304884">want</span>&nbsp;<span class="op" id="8304889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8304893">t</span><span class="op" id="8304894">.</span><span class="ident" id="8304895">Errorf</span><span class="op" id="8304901">(</span><span class="string" id="8304902">&#34;Marshal(ct)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="8304931">,</span>&nbsp;<span class="ident" id="8304933">got</span><span class="op" id="8304936">,</span>&nbsp;<span class="ident" id="8304938">want</span><span class="op" id="8304942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8304945">}</span><br>
<span class="lineno">250</span><span class="op" id="8304947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8304950">type</span>&nbsp;<span class="ident" id="8304955">IntType</span>&nbsp;<span class="builtintype" id="8304963">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8304968">type</span>&nbsp;<span class="ident" id="8304973">MyStruct</span>&nbsp;<span class="keyword" id="8304982">struct</span>&nbsp;<span class="op" id="8304989">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8304992">IntType</span><br>
<span class="lineno"></span><span class="op" id="8305000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8305003">func</span>&nbsp;<span class="ident" id="8305008">TestAnonymousNonstruct</span><span class="op" id="8305030">(</span><span class="ident" id="8305031">t</span>&nbsp;<span class="op" id="8305033">*</span><span class="ident" id="8305034">testing</span><span class="op" id="8305041">.</span><span class="ident" id="8305042">T</span><span class="op" id="8305043">)</span>&nbsp;<span class="op" id="8305045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8305048">var</span>&nbsp;<span class="ident" id="8305052">i</span>&nbsp;<span class="ident" id="8305054">IntType</span>&nbsp;<span class="op" id="8305062">=</span>&nbsp;<span class="num" id="8305064">11</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8305068">a</span>&nbsp;<span class="op" id="8305070">:=</span>&nbsp;<span class="ident" id="8305073">MyStruct</span><span class="op" id="8305081">{</span><span class="ident" id="8305082">i</span><span class="op" id="8305083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8305086">const</span>&nbsp;<span class="ident" id="8305092">want</span>&nbsp;<span class="op" id="8305097">=</span>&nbsp;<span class="string" id="8305099">`{&#34;IntType&#34;:11}`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8305118">b</span><span class="op" id="8305119">,</span>&nbsp;<span class="ident" id="8305121">err</span>&nbsp;<span class="op" id="8305125">:=</span>&nbsp;<span class="ident" id="8305128">Marshal</span><span class="op" id="8305135">(</span><span class="ident" id="8305136">a</span><span class="op" id="8305137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8305140">if</span>&nbsp;<span class="ident" id="8305143">err</span>&nbsp;<span class="op" id="8305147">!=</span>&nbsp;<span class="ident" id="8305150">nil</span>&nbsp;<span class="op" id="8305154">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8305158">t</span><span class="op" id="8305159">.</span><span class="ident" id="8305160">Fatalf</span><span class="op" id="8305166">(</span><span class="string" id="8305167">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="8305180">,</span>&nbsp;<span class="ident" id="8305182">err</span><span class="op" id="8305185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8305188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8305191">if</span>&nbsp;<span class="ident" id="8305194">got</span>&nbsp;<span class="op" id="8305198">:=</span>&nbsp;<span class="builtintype" id="8305201">string</span><span class="op" id="8305207">(</span><span class="ident" id="8305208">b</span><span class="op" id="8305209">)</span><span class="op" id="8305210">;</span>&nbsp;<span class="ident" id="8305212">got</span>&nbsp;<span class="op" id="8305216">!=</span>&nbsp;<span class="ident" id="8305219">want</span>&nbsp;<span class="op" id="8305224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8305228">t</span><span class="op" id="8305229">.</span><span class="ident" id="8305230">Errorf</span><span class="op" id="8305236">(</span><span class="string" id="8305237">&#34;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8305254">,</span>&nbsp;<span class="ident" id="8305256">got</span><span class="op" id="8305259">,</span>&nbsp;<span class="ident" id="8305261">want</span><span class="op" id="8305265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8305268">}</span><br>
<span class="lineno">270</span><span class="op" id="8305270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8305273">type</span>&nbsp;<span class="ident" id="8305278">BugA</span>&nbsp;<span class="keyword" id="8305283">struct</span>&nbsp;<span class="op" id="8305290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8305293">S</span>&nbsp;<span class="builtintype" id="8305295">string</span><br>
<span class="lineno"></span><span class="op" id="8305302">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="keyword" id="8305305">type</span>&nbsp;<span class="ident" id="8305310">BugB</span>&nbsp;<span class="keyword" id="8305315">struct</span>&nbsp;<span class="op" id="8305322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8305325">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8305331">S</span>&nbsp;<span class="builtintype" id="8305333">string</span><br>
<span class="lineno"></span><span class="op" id="8305340">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="8305343">type</span>&nbsp;<span class="ident" id="8305348">BugC</span>&nbsp;<span class="keyword" id="8305353">struct</span>&nbsp;<span class="op" id="8305360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8305363">S</span>&nbsp;<span class="builtintype" id="8305365">string</span><br>
<span class="lineno"></span><span class="op" id="8305372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="comment" id="8305375">//&nbsp;Legal&nbsp;Go:&nbsp;We&nbsp;never&nbsp;use&nbsp;the&nbsp;repeated&nbsp;embedded&nbsp;field&nbsp;(S).</span><br>
<span class="lineno"></span><span class="keyword" id="8305434">type</span>&nbsp;<span class="ident" id="8305439">BugX</span>&nbsp;<span class="keyword" id="8305444">struct</span>&nbsp;<span class="op" id="8305451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8305454">A</span>&nbsp;<span class="builtintype" id="8305456">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8305461">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8305467">BugB</span><br>
<span class="lineno">290</span><span class="op" id="8305472">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8305475">//&nbsp;Issue&nbsp;5245.</span><br>
<span class="lineno"></span><span class="keyword" id="8305490">func</span>&nbsp;<span class="ident" id="8305495">TestEmbeddedBug</span><span class="op" id="8305510">(</span><span class="ident" id="8305511">t</span>&nbsp;<span class="op" id="8305513">*</span><span class="ident" id="8305514">testing</span><span class="op" id="8305521">.</span><span class="ident" id="8305522">T</span><span class="op" id="8305523">)</span>&nbsp;<span class="op" id="8305525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8305528">v</span>&nbsp;<span class="op" id="8305530">:=</span>&nbsp;<span class="ident" id="8305533">BugB</span><span class="op" id="8305537">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8305541">BugA</span><span class="op" id="8305545">{</span><span class="string" id="8305546">&#34;A&#34;</span><span class="op" id="8305549">}</span><span class="op" id="8305550">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8305554">&#34;B&#34;</span><span class="op" id="8305557">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8305560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8305563">b</span><span class="op" id="8305564">,</span>&nbsp;<span class="ident" id="8305566">err</span>&nbsp;<span class="op" id="8305570">:=</span>&nbsp;<span class="ident" id="8305573">Marshal</span><span class="op" id="8305580">(</span><span class="ident" id="8305581">v</span><span class="op" id="8305582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8305585">if</span>&nbsp;<span class="ident" id="8305588">err</span>&nbsp;<span class="op" id="8305592">!=</span>&nbsp;<span class="ident" id="8305595">nil</span>&nbsp;<span class="op" id="8305599">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8305603">t</span><span class="op" id="8305604">.</span><span class="ident" id="8305605">Fatal</span><span class="op" id="8305610">(</span><span class="string" id="8305611">&#34;Marshal:&#34;</span><span class="op" id="8305621">,</span>&nbsp;<span class="ident" id="8305623">err</span><span class="op" id="8305626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8305629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8305632">want</span>&nbsp;<span class="op" id="8305637">:=</span>&nbsp;<span class="string" id="8305640">`{&#34;S&#34;:&#34;B&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8305653">got</span>&nbsp;<span class="op" id="8305657">:=</span>&nbsp;<span class="builtintype" id="8305660">string</span><span class="op" id="8305666">(</span><span class="ident" id="8305667">b</span><span class="op" id="8305668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8305671">if</span>&nbsp;<span class="ident" id="8305674">got</span>&nbsp;<span class="op" id="8305678">!=</span>&nbsp;<span class="ident" id="8305681">want</span>&nbsp;<span class="op" id="8305686">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8305690">t</span><span class="op" id="8305691">.</span><span class="ident" id="8305692">Fatalf</span><span class="op" id="8305698">(</span><span class="string" id="8305699">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8305724">,</span>&nbsp;<span class="ident" id="8305726">got</span><span class="op" id="8305729">,</span>&nbsp;<span class="ident" id="8305731">want</span><span class="op" id="8305735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8305738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8305741">//&nbsp;Now&nbsp;check&nbsp;that&nbsp;the&nbsp;duplicate&nbsp;field,&nbsp;S,&nbsp;does&nbsp;not&nbsp;appear.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8305801">x</span>&nbsp;<span class="op" id="8305803">:=</span>&nbsp;<span class="ident" id="8305806">BugX</span><span class="op" id="8305810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8305814">A</span><span class="op" id="8305815">:</span>&nbsp;<span class="num" id="8305817">23</span><span class="op" id="8305819">,</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8305822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8305825">b</span><span class="op" id="8305826">,</span>&nbsp;<span class="ident" id="8305828">err</span>&nbsp;<span class="op" id="8305832">=</span>&nbsp;<span class="ident" id="8305834">Marshal</span><span class="op" id="8305841">(</span><span class="ident" id="8305842">x</span><span class="op" id="8305843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8305846">if</span>&nbsp;<span class="ident" id="8305849">err</span>&nbsp;<span class="op" id="8305853">!=</span>&nbsp;<span class="ident" id="8305856">nil</span>&nbsp;<span class="op" id="8305860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8305864">t</span><span class="op" id="8305865">.</span><span class="ident" id="8305866">Fatal</span><span class="op" id="8305871">(</span><span class="string" id="8305872">&#34;Marshal:&#34;</span><span class="op" id="8305882">,</span>&nbsp;<span class="ident" id="8305884">err</span><span class="op" id="8305887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8305890">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8305893">want</span>&nbsp;<span class="op" id="8305898">=</span>&nbsp;<span class="string" id="8305900">`{&#34;A&#34;:23}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8305912">got</span>&nbsp;<span class="op" id="8305916">=</span>&nbsp;<span class="builtintype" id="8305918">string</span><span class="op" id="8305924">(</span><span class="ident" id="8305925">b</span><span class="op" id="8305926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8305929">if</span>&nbsp;<span class="ident" id="8305932">got</span>&nbsp;<span class="op" id="8305936">!=</span>&nbsp;<span class="ident" id="8305939">want</span>&nbsp;<span class="op" id="8305944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8305948">t</span><span class="op" id="8305949">.</span><span class="ident" id="8305950">Fatalf</span><span class="op" id="8305956">(</span><span class="string" id="8305957">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8305982">,</span>&nbsp;<span class="ident" id="8305984">got</span><span class="op" id="8305987">,</span>&nbsp;<span class="ident" id="8305989">want</span><span class="op" id="8305993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8305996">}</span><br>
<span class="lineno">320</span><span class="op" id="8305998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8306001">type</span>&nbsp;<span class="ident" id="8306006">BugD</span>&nbsp;<span class="keyword" id="8306011">struct</span>&nbsp;<span class="op" id="8306018">{</span>&nbsp;<span class="comment" id="8306020">//&nbsp;Same&nbsp;as&nbsp;BugA&nbsp;after&nbsp;tagging.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306052">XXX</span>&nbsp;<span class="builtintype" id="8306056">string</span>&nbsp;<span class="string" id="8306063">`json:&#34;S&#34;`</span><br>
<span class="lineno"></span><span class="op" id="8306074">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="8306077">//&nbsp;BugD&#39;s&nbsp;tagged&nbsp;S&nbsp;field&nbsp;should&nbsp;dominate&nbsp;BugA&#39;s.</span><br>
<span class="lineno"></span><span class="keyword" id="8306126">type</span>&nbsp;<span class="ident" id="8306131">BugY</span>&nbsp;<span class="keyword" id="8306136">struct</span>&nbsp;<span class="op" id="8306143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306146">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306152">BugD</span><br>
<span class="lineno">330</span><span class="op" id="8306157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8306160">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;field&nbsp;with&nbsp;a&nbsp;tag&nbsp;dominates&nbsp;untagged&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="8306219">func</span>&nbsp;<span class="ident" id="8306224">TestTaggedFieldDominates</span><span class="op" id="8306248">(</span><span class="ident" id="8306249">t</span>&nbsp;<span class="op" id="8306251">*</span><span class="ident" id="8306252">testing</span><span class="op" id="8306259">.</span><span class="ident" id="8306260">T</span><span class="op" id="8306261">)</span>&nbsp;<span class="op" id="8306263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306266">v</span>&nbsp;<span class="op" id="8306268">:=</span>&nbsp;<span class="ident" id="8306271">BugY</span><span class="op" id="8306275">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306279">BugA</span><span class="op" id="8306283">{</span><span class="string" id="8306284">&#34;BugA&#34;</span><span class="op" id="8306290">}</span><span class="op" id="8306291">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306295">BugD</span><span class="op" id="8306299">{</span><span class="string" id="8306300">&#34;BugD&#34;</span><span class="op" id="8306306">}</span><span class="op" id="8306307">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8306310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306313">b</span><span class="op" id="8306314">,</span>&nbsp;<span class="ident" id="8306316">err</span>&nbsp;<span class="op" id="8306320">:=</span>&nbsp;<span class="ident" id="8306323">Marshal</span><span class="op" id="8306330">(</span><span class="ident" id="8306331">v</span><span class="op" id="8306332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8306335">if</span>&nbsp;<span class="ident" id="8306338">err</span>&nbsp;<span class="op" id="8306342">!=</span>&nbsp;<span class="ident" id="8306345">nil</span>&nbsp;<span class="op" id="8306349">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306353">t</span><span class="op" id="8306354">.</span><span class="ident" id="8306355">Fatal</span><span class="op" id="8306360">(</span><span class="string" id="8306361">&#34;Marshal:&#34;</span><span class="op" id="8306371">,</span>&nbsp;<span class="ident" id="8306373">err</span><span class="op" id="8306376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8306379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306382">want</span>&nbsp;<span class="op" id="8306387">:=</span>&nbsp;<span class="string" id="8306390">`{&#34;S&#34;:&#34;BugD&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306406">got</span>&nbsp;<span class="op" id="8306410">:=</span>&nbsp;<span class="builtintype" id="8306413">string</span><span class="op" id="8306419">(</span><span class="ident" id="8306420">b</span><span class="op" id="8306421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8306424">if</span>&nbsp;<span class="ident" id="8306427">got</span>&nbsp;<span class="op" id="8306431">!=</span>&nbsp;<span class="ident" id="8306434">want</span>&nbsp;<span class="op" id="8306439">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306443">t</span><span class="op" id="8306444">.</span><span class="ident" id="8306445">Fatalf</span><span class="op" id="8306451">(</span><span class="string" id="8306452">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8306477">,</span>&nbsp;<span class="ident" id="8306479">got</span><span class="op" id="8306482">,</span>&nbsp;<span class="ident" id="8306484">want</span><span class="op" id="8306488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8306491">}</span><br>
<span class="lineno"></span><span class="op" id="8306493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8306496">//&nbsp;There&nbsp;are&nbsp;no&nbsp;tags&nbsp;here,&nbsp;so&nbsp;S&nbsp;should&nbsp;not&nbsp;appear.</span><br>
<span class="lineno">350</span><span class="keyword" id="8306547">type</span>&nbsp;<span class="ident" id="8306552">BugZ</span>&nbsp;<span class="keyword" id="8306557">struct</span>&nbsp;<span class="op" id="8306564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306567">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306573">BugC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306579">BugY</span>&nbsp;<span class="comment" id="8306584">//&nbsp;Contains&nbsp;a&nbsp;tagged&nbsp;S&nbsp;field&nbsp;through&nbsp;BugD;&nbsp;should&nbsp;not&nbsp;dominate.</span><br>
<span class="lineno"></span><span class="op" id="8306648">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="keyword" id="8306651">func</span>&nbsp;<span class="ident" id="8306656">TestDuplicatedFieldDisappears</span><span class="op" id="8306685">(</span><span class="ident" id="8306686">t</span>&nbsp;<span class="op" id="8306688">*</span><span class="ident" id="8306689">testing</span><span class="op" id="8306696">.</span><span class="ident" id="8306697">T</span><span class="op" id="8306698">)</span>&nbsp;<span class="op" id="8306700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306703">v</span>&nbsp;<span class="op" id="8306705">:=</span>&nbsp;<span class="ident" id="8306708">BugZ</span><span class="op" id="8306712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306716">BugA</span><span class="op" id="8306720">{</span><span class="string" id="8306721">&#34;BugA&#34;</span><span class="op" id="8306727">}</span><span class="op" id="8306728">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306732">BugC</span><span class="op" id="8306736">{</span><span class="string" id="8306737">&#34;BugC&#34;</span><span class="op" id="8306743">}</span><span class="op" id="8306744">,</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306748">BugY</span><span class="op" id="8306752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306757">BugA</span><span class="op" id="8306761">{</span><span class="string" id="8306762">&#34;nested&nbsp;BugA&#34;</span><span class="op" id="8306775">}</span><span class="op" id="8306776">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306781">BugD</span><span class="op" id="8306785">{</span><span class="string" id="8306786">&#34;nested&nbsp;BugD&#34;</span><span class="op" id="8306799">}</span><span class="op" id="8306800">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8306804">}</span><span class="op" id="8306805">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8306808">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306811">b</span><span class="op" id="8306812">,</span>&nbsp;<span class="ident" id="8306814">err</span>&nbsp;<span class="op" id="8306818">:=</span>&nbsp;<span class="ident" id="8306821">Marshal</span><span class="op" id="8306828">(</span><span class="ident" id="8306829">v</span><span class="op" id="8306830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8306833">if</span>&nbsp;<span class="ident" id="8306836">err</span>&nbsp;<span class="op" id="8306840">!=</span>&nbsp;<span class="ident" id="8306843">nil</span>&nbsp;<span class="op" id="8306847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306851">t</span><span class="op" id="8306852">.</span><span class="ident" id="8306853">Fatal</span><span class="op" id="8306858">(</span><span class="string" id="8306859">&#34;Marshal:&#34;</span><span class="op" id="8306869">,</span>&nbsp;<span class="ident" id="8306871">err</span><span class="op" id="8306874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8306877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306880">want</span>&nbsp;<span class="op" id="8306885">:=</span>&nbsp;<span class="string" id="8306888">`{}`</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306894">got</span>&nbsp;<span class="op" id="8306898">:=</span>&nbsp;<span class="builtintype" id="8306901">string</span><span class="op" id="8306907">(</span><span class="ident" id="8306908">b</span><span class="op" id="8306909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8306912">if</span>&nbsp;<span class="ident" id="8306915">got</span>&nbsp;<span class="op" id="8306919">!=</span>&nbsp;<span class="ident" id="8306922">want</span>&nbsp;<span class="op" id="8306927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306931">t</span><span class="op" id="8306932">.</span><span class="ident" id="8306933">Fatalf</span><span class="op" id="8306939">(</span><span class="string" id="8306940">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8306965">,</span>&nbsp;<span class="ident" id="8306967">got</span><span class="op" id="8306970">,</span>&nbsp;<span class="ident" id="8306972">want</span><span class="op" id="8306976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8306979">}</span><br>
<span class="lineno"></span><span class="op" id="8306981">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="keyword" id="8306984">func</span>&nbsp;<span class="ident" id="8306989">TestStringBytes</span><span class="op" id="8307004">(</span><span class="ident" id="8307005">t</span>&nbsp;<span class="op" id="8307007">*</span><span class="ident" id="8307008">testing</span><span class="op" id="8307015">.</span><span class="ident" id="8307016">T</span><span class="op" id="8307017">)</span>&nbsp;<span class="op" id="8307019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8307022">//&nbsp;Test&nbsp;that&nbsp;encodeState.stringBytes&nbsp;and&nbsp;encodeState.string&nbsp;use&nbsp;the&nbsp;same&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307106">es</span>&nbsp;<span class="op" id="8307109">:=</span>&nbsp;<span class="op" id="8307112">&amp;</span><span class="ident" id="8307113">encodeState</span><span class="op" id="8307124">{</span><span class="op" id="8307125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8307128">var</span>&nbsp;<span class="ident" id="8307132">r</span>&nbsp;<span class="op" id="8307134">[</span><span class="op" id="8307135">]</span><span class="builtintype" id="8307136">rune</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8307142">for</span>&nbsp;<span class="ident" id="8307146">i</span>&nbsp;<span class="op" id="8307148">:=</span>&nbsp;<span class="string" id="8307151">&#39;\u0000&#39;</span><span class="op" id="8307159">;</span>&nbsp;<span class="ident" id="8307161">i</span>&nbsp;<span class="op" id="8307163">&lt;=</span>&nbsp;<span class="ident" id="8307166">unicode</span><span class="op" id="8307173">.</span><span class="ident" id="8307174">MaxRune</span><span class="op" id="8307181">;</span>&nbsp;<span class="ident" id="8307183">i</span><span class="op" id="8307184">++</span>&nbsp;<span class="op" id="8307187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307191">r</span>&nbsp;<span class="op" id="8307193">=</span>&nbsp;<span class="builtinfunc" id="8307195">append</span><span class="op" id="8307201">(</span><span class="ident" id="8307202">r</span><span class="op" id="8307203">,</span>&nbsp;<span class="ident" id="8307205">i</span><span class="op" id="8307206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8307209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307212">s</span>&nbsp;<span class="op" id="8307214">:=</span>&nbsp;<span class="builtintype" id="8307217">string</span><span class="op" id="8307223">(</span><span class="ident" id="8307224">r</span><span class="op" id="8307225">)</span>&nbsp;<span class="op" id="8307227">+</span>&nbsp;<span class="string" id="8307229">&#34;\xff\xff\xffhello&#34;</span>&nbsp;<span class="comment" id="8307249">//&nbsp;some&nbsp;invalid&nbsp;UTF-8&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307276">_</span><span class="op" id="8307277">,</span>&nbsp;<span class="ident" id="8307279">err</span>&nbsp;<span class="op" id="8307283">:=</span>&nbsp;<span class="ident" id="8307286">es</span><span class="op" id="8307288">.</span><span class="builtintype" id="8307289">string</span><span class="op" id="8307295">(</span><span class="ident" id="8307296">s</span><span class="op" id="8307297">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8307300">if</span>&nbsp;<span class="ident" id="8307303">err</span>&nbsp;<span class="op" id="8307307">!=</span>&nbsp;<span class="ident" id="8307310">nil</span>&nbsp;<span class="op" id="8307314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307318">t</span><span class="op" id="8307319">.</span><span class="ident" id="8307320">Fatal</span><span class="op" id="8307325">(</span><span class="ident" id="8307326">err</span><span class="op" id="8307329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8307332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307336">esBytes</span>&nbsp;<span class="op" id="8307344">:=</span>&nbsp;<span class="op" id="8307347">&amp;</span><span class="ident" id="8307348">encodeState</span><span class="op" id="8307359">{</span><span class="op" id="8307360">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307363">_</span><span class="op" id="8307364">,</span>&nbsp;<span class="ident" id="8307366">err</span>&nbsp;<span class="op" id="8307370">=</span>&nbsp;<span class="ident" id="8307372">esBytes</span><span class="op" id="8307379">.</span><span class="ident" id="8307380">stringBytes</span><span class="op" id="8307391">(</span><span class="op" id="8307392">[</span><span class="op" id="8307393">]</span><span class="builtintype" id="8307394">byte</span><span class="op" id="8307398">(</span><span class="ident" id="8307399">s</span><span class="op" id="8307400">)</span><span class="op" id="8307401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8307404">if</span>&nbsp;<span class="ident" id="8307407">err</span>&nbsp;<span class="op" id="8307411">!=</span>&nbsp;<span class="ident" id="8307414">nil</span>&nbsp;<span class="op" id="8307418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307422">t</span><span class="op" id="8307423">.</span><span class="ident" id="8307424">Fatal</span><span class="op" id="8307429">(</span><span class="ident" id="8307430">err</span><span class="op" id="8307433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8307436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307440">enc</span>&nbsp;<span class="op" id="8307444">:=</span>&nbsp;<span class="ident" id="8307447">es</span><span class="op" id="8307449">.</span><span class="ident" id="8307450">Buffer</span><span class="op" id="8307456">.</span><span class="ident" id="8307457">String</span><span class="op" id="8307463">(</span><span class="op" id="8307464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307467">encBytes</span>&nbsp;<span class="op" id="8307476">:=</span>&nbsp;<span class="ident" id="8307479">esBytes</span><span class="op" id="8307486">.</span><span class="ident" id="8307487">Buffer</span><span class="op" id="8307493">.</span><span class="ident" id="8307494">String</span><span class="op" id="8307500">(</span><span class="op" id="8307501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8307504">if</span>&nbsp;<span class="ident" id="8307507">enc</span>&nbsp;<span class="op" id="8307511">!=</span>&nbsp;<span class="ident" id="8307514">encBytes</span>&nbsp;<span class="op" id="8307523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307527">i</span>&nbsp;<span class="op" id="8307529">:=</span>&nbsp;<span class="num" id="8307532">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8307536">for</span>&nbsp;<span class="ident" id="8307540">i</span>&nbsp;<span class="op" id="8307542">&lt;</span>&nbsp;<span class="builtinfunc" id="8307544">len</span><span class="op" id="8307547">(</span><span class="ident" id="8307548">enc</span><span class="op" id="8307551">)</span>&nbsp;<span class="op" id="8307553">&amp;&amp;</span>&nbsp;<span class="ident" id="8307556">i</span>&nbsp;<span class="op" id="8307558">&lt;</span>&nbsp;<span class="builtinfunc" id="8307560">len</span><span class="op" id="8307563">(</span><span class="ident" id="8307564">encBytes</span><span class="op" id="8307572">)</span>&nbsp;<span class="op" id="8307574">&amp;&amp;</span>&nbsp;<span class="ident" id="8307577">enc</span><span class="op" id="8307580">[</span><span class="ident" id="8307581">i</span><span class="op" id="8307582">]</span>&nbsp;<span class="op" id="8307584">==</span>&nbsp;<span class="ident" id="8307587">encBytes</span><span class="op" id="8307595">[</span><span class="ident" id="8307596">i</span><span class="op" id="8307597">]</span>&nbsp;<span class="op" id="8307599">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307604">i</span><span class="op" id="8307605">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8307610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307614">enc</span>&nbsp;<span class="op" id="8307618">=</span>&nbsp;<span class="ident" id="8307620">enc</span><span class="op" id="8307623">[</span><span class="ident" id="8307624">i</span><span class="op" id="8307625">:</span><span class="op" id="8307626">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307630">encBytes</span>&nbsp;<span class="op" id="8307639">=</span>&nbsp;<span class="ident" id="8307641">encBytes</span><span class="op" id="8307649">[</span><span class="ident" id="8307650">i</span><span class="op" id="8307651">:</span><span class="op" id="8307652">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307656">i</span>&nbsp;<span class="op" id="8307658">=</span>&nbsp;<span class="num" id="8307660">0</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8307664">for</span>&nbsp;<span class="ident" id="8307668">i</span>&nbsp;<span class="op" id="8307670">&lt;</span>&nbsp;<span class="builtinfunc" id="8307672">len</span><span class="op" id="8307675">(</span><span class="ident" id="8307676">enc</span><span class="op" id="8307679">)</span>&nbsp;<span class="op" id="8307681">&amp;&amp;</span>&nbsp;<span class="ident" id="8307684">i</span>&nbsp;<span class="op" id="8307686">&lt;</span>&nbsp;<span class="builtinfunc" id="8307688">len</span><span class="op" id="8307691">(</span><span class="ident" id="8307692">encBytes</span><span class="op" id="8307700">)</span>&nbsp;<span class="op" id="8307702">&amp;&amp;</span>&nbsp;<span class="ident" id="8307705">enc</span><span class="op" id="8307708">[</span><span class="builtinfunc" id="8307709">len</span><span class="op" id="8307712">(</span><span class="ident" id="8307713">enc</span><span class="op" id="8307716">)</span><span class="op" id="8307717">-</span><span class="ident" id="8307718">i</span><span class="op" id="8307719">-</span><span class="num" id="8307720">1</span><span class="op" id="8307721">]</span>&nbsp;<span class="op" id="8307723">==</span>&nbsp;<span class="ident" id="8307726">encBytes</span><span class="op" id="8307734">[</span><span class="builtinfunc" id="8307735">len</span><span class="op" id="8307738">(</span><span class="ident" id="8307739">encBytes</span><span class="op" id="8307747">)</span><span class="op" id="8307748">-</span><span class="ident" id="8307749">i</span><span class="op" id="8307750">-</span><span class="num" id="8307751">1</span><span class="op" id="8307752">]</span>&nbsp;<span class="op" id="8307754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307759">i</span><span class="op" id="8307760">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8307765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307769">enc</span>&nbsp;<span class="op" id="8307773">=</span>&nbsp;<span class="ident" id="8307775">enc</span><span class="op" id="8307778">[</span><span class="op" id="8307779">:</span><span class="builtinfunc" id="8307780">len</span><span class="op" id="8307783">(</span><span class="ident" id="8307784">enc</span><span class="op" id="8307787">)</span><span class="op" id="8307788">-</span><span class="ident" id="8307789">i</span><span class="op" id="8307790">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307794">encBytes</span>&nbsp;<span class="op" id="8307803">=</span>&nbsp;<span class="ident" id="8307805">encBytes</span><span class="op" id="8307813">[</span><span class="op" id="8307814">:</span><span class="builtinfunc" id="8307815">len</span><span class="op" id="8307818">(</span><span class="ident" id="8307819">encBytes</span><span class="op" id="8307827">)</span><span class="op" id="8307828">-</span><span class="ident" id="8307829">i</span><span class="op" id="8307830">]</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8307835">if</span>&nbsp;<span class="builtinfunc" id="8307838">len</span><span class="op" id="8307841">(</span><span class="ident" id="8307842">enc</span><span class="op" id="8307845">)</span>&nbsp;<span class="op" id="8307847">&gt;</span>&nbsp;<span class="num" id="8307849">20</span>&nbsp;<span class="op" id="8307852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307857">enc</span>&nbsp;<span class="op" id="8307861">=</span>&nbsp;<span class="ident" id="8307863">enc</span><span class="op" id="8307866">[</span><span class="op" id="8307867">:</span><span class="num" id="8307868">20</span><span class="op" id="8307870">]</span>&nbsp;<span class="op" id="8307872">+</span>&nbsp;<span class="string" id="8307874">&#34;...&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8307882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8307886">if</span>&nbsp;<span class="builtinfunc" id="8307889">len</span><span class="op" id="8307892">(</span><span class="ident" id="8307893">encBytes</span><span class="op" id="8307901">)</span>&nbsp;<span class="op" id="8307903">&gt;</span>&nbsp;<span class="num" id="8307905">20</span>&nbsp;<span class="op" id="8307908">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307913">encBytes</span>&nbsp;<span class="op" id="8307922">=</span>&nbsp;<span class="ident" id="8307924">encBytes</span><span class="op" id="8307932">[</span><span class="op" id="8307933">:</span><span class="num" id="8307934">20</span><span class="op" id="8307936">]</span>&nbsp;<span class="op" id="8307938">+</span>&nbsp;<span class="string" id="8307940">&#34;...&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8307948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307953">t</span><span class="op" id="8307954">.</span><span class="ident" id="8307955">Errorf</span><span class="op" id="8307961">(</span><span class="string" id="8307962">&#34;encodings&nbsp;differ&nbsp;at&nbsp;%#q&nbsp;vs&nbsp;%#q&#34;</span><span class="op" id="8307994">,</span>&nbsp;<span class="ident" id="8307996">enc</span><span class="op" id="8307999">,</span>&nbsp;<span class="ident" id="8308001">encBytes</span><span class="op" id="8308009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8308012">}</span><br>
<span class="lineno">420</span><span class="op" id="8308014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8308017">func</span>&nbsp;<span class="ident" id="8308022">TestIssue6458</span><span class="op" id="8308035">(</span><span class="ident" id="8308036">t</span>&nbsp;<span class="op" id="8308038">*</span><span class="ident" id="8308039">testing</span><span class="op" id="8308046">.</span><span class="ident" id="8308047">T</span><span class="op" id="8308048">)</span>&nbsp;<span class="op" id="8308050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8308053">type</span>&nbsp;<span class="ident" id="8308058">Foo</span>&nbsp;<span class="keyword" id="8308062">struct</span>&nbsp;<span class="op" id="8308069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308073">M</span>&nbsp;<span class="ident" id="8308075">RawMessage</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8308087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308090">x</span>&nbsp;<span class="op" id="8308092">:=</span>&nbsp;<span class="ident" id="8308095">Foo</span><span class="op" id="8308098">{</span><span class="ident" id="8308099">RawMessage</span><span class="op" id="8308109">(</span><span class="string" id="8308110">`&#34;foo&#34;`</span><span class="op" id="8308117">)</span><span class="op" id="8308118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308122">b</span><span class="op" id="8308123">,</span>&nbsp;<span class="ident" id="8308125">err</span>&nbsp;<span class="op" id="8308129">:=</span>&nbsp;<span class="ident" id="8308132">Marshal</span><span class="op" id="8308139">(</span><span class="op" id="8308140">&amp;</span><span class="ident" id="8308141">x</span><span class="op" id="8308142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8308145">if</span>&nbsp;<span class="ident" id="8308148">err</span>&nbsp;<span class="op" id="8308152">!=</span>&nbsp;<span class="ident" id="8308155">nil</span>&nbsp;<span class="op" id="8308159">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308163">t</span><span class="op" id="8308164">.</span><span class="ident" id="8308165">Fatal</span><span class="op" id="8308170">(</span><span class="ident" id="8308171">err</span><span class="op" id="8308174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8308177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8308180">if</span>&nbsp;<span class="ident" id="8308183">want</span>&nbsp;<span class="op" id="8308188">:=</span>&nbsp;<span class="string" id="8308191">`{&#34;M&#34;:&#34;foo&#34;}`</span><span class="op" id="8308204">;</span>&nbsp;<span class="builtintype" id="8308206">string</span><span class="op" id="8308212">(</span><span class="ident" id="8308213">b</span><span class="op" id="8308214">)</span>&nbsp;<span class="op" id="8308216">!=</span>&nbsp;<span class="ident" id="8308219">want</span>&nbsp;<span class="op" id="8308224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308228">t</span><span class="op" id="8308229">.</span><span class="ident" id="8308230">Errorf</span><span class="op" id="8308236">(</span><span class="string" id="8308237">&#34;Marshal(&amp;x)&nbsp;=&nbsp;%#q;&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="8308266">,</span>&nbsp;<span class="ident" id="8308268">b</span><span class="op" id="8308269">,</span>&nbsp;<span class="ident" id="8308271">want</span><span class="op" id="8308275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8308278">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308282">b</span><span class="op" id="8308283">,</span>&nbsp;<span class="ident" id="8308285">err</span>&nbsp;<span class="op" id="8308289">=</span>&nbsp;<span class="ident" id="8308291">Marshal</span><span class="op" id="8308298">(</span><span class="ident" id="8308299">x</span><span class="op" id="8308300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8308303">if</span>&nbsp;<span class="ident" id="8308306">err</span>&nbsp;<span class="op" id="8308310">!=</span>&nbsp;<span class="ident" id="8308313">nil</span>&nbsp;<span class="op" id="8308317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308321">t</span><span class="op" id="8308322">.</span><span class="ident" id="8308323">Fatal</span><span class="op" id="8308328">(</span><span class="ident" id="8308329">err</span><span class="op" id="8308332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8308335">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8308339">if</span>&nbsp;<span class="ident" id="8308342">want</span>&nbsp;<span class="op" id="8308347">:=</span>&nbsp;<span class="string" id="8308350">`{&#34;M&#34;:&#34;ImZvbyI=&#34;}`</span><span class="op" id="8308368">;</span>&nbsp;<span class="builtintype" id="8308370">string</span><span class="op" id="8308376">(</span><span class="ident" id="8308377">b</span><span class="op" id="8308378">)</span>&nbsp;<span class="op" id="8308380">!=</span>&nbsp;<span class="ident" id="8308383">want</span>&nbsp;<span class="op" id="8308388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308392">t</span><span class="op" id="8308393">.</span><span class="ident" id="8308394">Errorf</span><span class="op" id="8308400">(</span><span class="string" id="8308401">&#34;Marshal(x)&nbsp;=&nbsp;%#q;&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="8308429">,</span>&nbsp;<span class="ident" id="8308431">b</span><span class="op" id="8308432">,</span>&nbsp;<span class="ident" id="8308434">want</span><span class="op" id="8308438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8308441">}</span><br>
<span class="lineno"></span><span class="op" id="8308443">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="8308446">func</span>&nbsp;<span class="ident" id="8308451">TestHTMLEscape</span><span class="op" id="8308465">(</span><span class="ident" id="8308466">t</span>&nbsp;<span class="op" id="8308468">*</span><span class="ident" id="8308469">testing</span><span class="op" id="8308476">.</span><span class="ident" id="8308477">T</span><span class="op" id="8308478">)</span>&nbsp;<span class="op" id="8308480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8308483">var</span>&nbsp;<span class="ident" id="8308487">b</span><span class="op" id="8308488">,</span>&nbsp;<span class="ident" id="8308490">want</span>&nbsp;<span class="ident" id="8308495">bytes</span><span class="op" id="8308500">.</span><span class="ident" id="8308501">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308509">m</span>&nbsp;<span class="op" id="8308511">:=</span>&nbsp;<span class="string" id="8308514">`{&#34;M&#34;:&#34;&lt;html&gt;foo&nbsp;&amp;`</span>&nbsp;<span class="op" id="8308534">+</span>&nbsp;<span class="string" id="8308536">&#34;\xe2\x80\xa8&nbsp;\xe2\x80\xa9&#34;</span>&nbsp;<span class="op" id="8308564">+</span>&nbsp;<span class="string" id="8308566">`&lt;/html&gt;&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308579">want</span><span class="op" id="8308583">.</span><span class="ident" id="8308584">Write</span><span class="op" id="8308589">(</span><span class="op" id="8308590">[</span><span class="op" id="8308591">]</span><span class="builtintype" id="8308592">byte</span><span class="op" id="8308596">(</span><span class="string" id="8308597">`{&#34;M&#34;:&#34;\u003chtml\u003efoo&nbsp;\u0026\u2028&nbsp;\u2029\u003c/html\u003e&#34;}`</span><span class="op" id="8308663">)</span><span class="op" id="8308664">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308667">HTMLEscape</span><span class="op" id="8308677">(</span><span class="op" id="8308678">&amp;</span><span class="ident" id="8308679">b</span><span class="op" id="8308680">,</span>&nbsp;<span class="op" id="8308682">[</span><span class="op" id="8308683">]</span><span class="builtintype" id="8308684">byte</span><span class="op" id="8308688">(</span><span class="ident" id="8308689">m</span><span class="op" id="8308690">)</span><span class="op" id="8308691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8308694">if</span>&nbsp;<span class="op" id="8308697">!</span><span class="ident" id="8308698">bytes</span><span class="op" id="8308703">.</span><span class="ident" id="8308704">Equal</span><span class="op" id="8308709">(</span><span class="ident" id="8308710">b</span><span class="op" id="8308711">.</span><span class="ident" id="8308712">Bytes</span><span class="op" id="8308717">(</span><span class="op" id="8308718">)</span><span class="op" id="8308719">,</span>&nbsp;<span class="ident" id="8308721">want</span><span class="op" id="8308725">.</span><span class="ident" id="8308726">Bytes</span><span class="op" id="8308731">(</span><span class="op" id="8308732">)</span><span class="op" id="8308733">)</span>&nbsp;<span class="op" id="8308735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308739">t</span><span class="op" id="8308740">.</span><span class="ident" id="8308741">Errorf</span><span class="op" id="8308747">(</span><span class="string" id="8308748">&#34;HTMLEscape(&amp;b,&nbsp;[]byte(m))&nbsp;=&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8308789">,</span>&nbsp;<span class="ident" id="8308791">b</span><span class="op" id="8308792">.</span><span class="ident" id="8308793">Bytes</span><span class="op" id="8308798">(</span><span class="op" id="8308799">)</span><span class="op" id="8308800">,</span>&nbsp;<span class="ident" id="8308802">want</span><span class="op" id="8308806">.</span><span class="ident" id="8308807">Bytes</span><span class="op" id="8308812">(</span><span class="op" id="8308813">)</span><span class="op" id="8308814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8308817">}</span><br>
<span class="lineno"></span><span class="op" id="8308819">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="8308822">//&nbsp;golang.org/issue/8582</span><br>
<span class="lineno"></span><span class="keyword" id="8308847">func</span>&nbsp;<span class="ident" id="8308852">TestEncodePointerString</span><span class="op" id="8308875">(</span><span class="ident" id="8308876">t</span>&nbsp;<span class="op" id="8308878">*</span><span class="ident" id="8308879">testing</span><span class="op" id="8308886">.</span><span class="ident" id="8308887">T</span><span class="op" id="8308888">)</span>&nbsp;<span class="op" id="8308890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8308893">type</span>&nbsp;<span class="ident" id="8308898">stringPointer</span>&nbsp;<span class="keyword" id="8308912">struct</span>&nbsp;<span class="op" id="8308919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308923">N</span>&nbsp;<span class="op" id="8308925">*</span><span class="ident" id="8308926">int64</span>&nbsp;<span class="string" id="8308932">`json:&#34;n,string&#34;`</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8308951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8308954">var</span>&nbsp;<span class="ident" id="8308958">n</span>&nbsp;<span class="ident" id="8308960">int64</span>&nbsp;<span class="op" id="8308966">=</span>&nbsp;<span class="num" id="8308968">42</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308972">b</span><span class="op" id="8308973">,</span>&nbsp;<span class="ident" id="8308975">err</span>&nbsp;<span class="op" id="8308979">:=</span>&nbsp;<span class="ident" id="8308982">Marshal</span><span class="op" id="8308989">(</span><span class="ident" id="8308990">stringPointer</span><span class="op" id="8309003">{</span><span class="ident" id="8309004">N</span><span class="op" id="8309005">:</span>&nbsp;<span class="op" id="8309007">&amp;</span><span class="ident" id="8309008">n</span><span class="op" id="8309009">}</span><span class="op" id="8309010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309013">if</span>&nbsp;<span class="ident" id="8309016">err</span>&nbsp;<span class="op" id="8309020">!=</span>&nbsp;<span class="ident" id="8309023">nil</span>&nbsp;<span class="op" id="8309027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309031">t</span><span class="op" id="8309032">.</span><span class="ident" id="8309033">Fatalf</span><span class="op" id="8309039">(</span><span class="string" id="8309040">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="8309053">,</span>&nbsp;<span class="ident" id="8309055">err</span><span class="op" id="8309058">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309064">if</span>&nbsp;<span class="ident" id="8309067">got</span><span class="op" id="8309070">,</span>&nbsp;<span class="ident" id="8309072">want</span>&nbsp;<span class="op" id="8309077">:=</span>&nbsp;<span class="builtintype" id="8309080">string</span><span class="op" id="8309086">(</span><span class="ident" id="8309087">b</span><span class="op" id="8309088">)</span><span class="op" id="8309089">,</span>&nbsp;<span class="string" id="8309091">`{&#34;n&#34;:&#34;42&#34;}`</span><span class="op" id="8309103">;</span>&nbsp;<span class="ident" id="8309105">got</span>&nbsp;<span class="op" id="8309109">!=</span>&nbsp;<span class="ident" id="8309112">want</span>&nbsp;<span class="op" id="8309117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309121">t</span><span class="op" id="8309122">.</span><span class="ident" id="8309123">Errorf</span><span class="op" id="8309129">(</span><span class="string" id="8309130">&#34;Marshal&nbsp;=&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8309153">,</span>&nbsp;<span class="ident" id="8309155">got</span><span class="op" id="8309158">,</span>&nbsp;<span class="ident" id="8309160">want</span><span class="op" id="8309164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309170">var</span>&nbsp;<span class="ident" id="8309174">back</span>&nbsp;<span class="ident" id="8309179">stringPointer</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309194">err</span>&nbsp;<span class="op" id="8309198">=</span>&nbsp;<span class="ident" id="8309200">Unmarshal</span><span class="op" id="8309209">(</span><span class="ident" id="8309210">b</span><span class="op" id="8309211">,</span>&nbsp;<span class="op" id="8309213">&amp;</span><span class="ident" id="8309214">back</span><span class="op" id="8309218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309221">if</span>&nbsp;<span class="ident" id="8309224">err</span>&nbsp;<span class="op" id="8309228">!=</span>&nbsp;<span class="ident" id="8309231">nil</span>&nbsp;<span class="op" id="8309235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309239">t</span><span class="op" id="8309240">.</span><span class="ident" id="8309241">Fatalf</span><span class="op" id="8309247">(</span><span class="string" id="8309248">&#34;Unmarshal:&nbsp;%v&#34;</span><span class="op" id="8309263">,</span>&nbsp;<span class="ident" id="8309265">err</span><span class="op" id="8309268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309274">if</span>&nbsp;<span class="ident" id="8309277">back</span><span class="op" id="8309281">.</span><span class="ident" id="8309282">N</span>&nbsp;<span class="op" id="8309284">==</span>&nbsp;<span class="ident" id="8309287">nil</span>&nbsp;<span class="op" id="8309291">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309295">t</span><span class="op" id="8309296">.</span><span class="ident" id="8309297">Fatalf</span><span class="op" id="8309303">(</span><span class="string" id="8309304">&#34;Unmarshalled&nbsp;nil&nbsp;N&nbsp;field&#34;</span><span class="op" id="8309330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309336">if</span>&nbsp;<span class="op" id="8309339">*</span><span class="ident" id="8309340">back</span><span class="op" id="8309344">.</span><span class="ident" id="8309345">N</span>&nbsp;<span class="op" id="8309347">!=</span>&nbsp;<span class="num" id="8309350">42</span>&nbsp;<span class="op" id="8309353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309357">t</span><span class="op" id="8309358">.</span><span class="ident" id="8309359">Fatalf</span><span class="op" id="8309365">(</span><span class="string" id="8309366">&#34;*N&nbsp;=&nbsp;%d;&nbsp;want&nbsp;42&#34;</span><span class="op" id="8309384">,</span>&nbsp;<span class="op" id="8309386">*</span><span class="ident" id="8309387">back</span><span class="op" id="8309391">.</span><span class="ident" id="8309392">N</span><span class="op" id="8309393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309396">}</span><br>
<span class="lineno">480</span><span class="op" id="8309398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8309401">var</span>&nbsp;<span class="ident" id="8309405">encodeStringTests</span>&nbsp;<span class="op" id="8309423">=</span>&nbsp;<span class="op" id="8309425">[</span><span class="op" id="8309426">]</span><span class="keyword" id="8309427">struct</span>&nbsp;<span class="op" id="8309434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309437">in</span>&nbsp;&nbsp;<span class="builtintype" id="8309441">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309449">out</span>&nbsp;<span class="builtintype" id="8309453">string</span><br>
<span class="lineno">485</span><span class="op" id="8309460">}</span><span class="op" id="8309461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309464">{</span><span class="string" id="8309465">&#34;\x00&#34;</span><span class="op" id="8309471">,</span>&nbsp;<span class="string" id="8309473">`&#34;\u0000&#34;`</span><span class="op" id="8309483">}</span><span class="op" id="8309484">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309487">{</span><span class="string" id="8309488">&#34;\x01&#34;</span><span class="op" id="8309494">,</span>&nbsp;<span class="string" id="8309496">`&#34;\u0001&#34;`</span><span class="op" id="8309506">}</span><span class="op" id="8309507">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309510">{</span><span class="string" id="8309511">&#34;\x02&#34;</span><span class="op" id="8309517">,</span>&nbsp;<span class="string" id="8309519">`&#34;\u0002&#34;`</span><span class="op" id="8309529">}</span><span class="op" id="8309530">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309533">{</span><span class="string" id="8309534">&#34;\x03&#34;</span><span class="op" id="8309540">,</span>&nbsp;<span class="string" id="8309542">`&#34;\u0003&#34;`</span><span class="op" id="8309552">}</span><span class="op" id="8309553">,</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309556">{</span><span class="string" id="8309557">&#34;\x04&#34;</span><span class="op" id="8309563">,</span>&nbsp;<span class="string" id="8309565">`&#34;\u0004&#34;`</span><span class="op" id="8309575">}</span><span class="op" id="8309576">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309579">{</span><span class="string" id="8309580">&#34;\x05&#34;</span><span class="op" id="8309586">,</span>&nbsp;<span class="string" id="8309588">`&#34;\u0005&#34;`</span><span class="op" id="8309598">}</span><span class="op" id="8309599">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309602">{</span><span class="string" id="8309603">&#34;\x06&#34;</span><span class="op" id="8309609">,</span>&nbsp;<span class="string" id="8309611">`&#34;\u0006&#34;`</span><span class="op" id="8309621">}</span><span class="op" id="8309622">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309625">{</span><span class="string" id="8309626">&#34;\x07&#34;</span><span class="op" id="8309632">,</span>&nbsp;<span class="string" id="8309634">`&#34;\u0007&#34;`</span><span class="op" id="8309644">}</span><span class="op" id="8309645">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309648">{</span><span class="string" id="8309649">&#34;\x08&#34;</span><span class="op" id="8309655">,</span>&nbsp;<span class="string" id="8309657">`&#34;\u0008&#34;`</span><span class="op" id="8309667">}</span><span class="op" id="8309668">,</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309671">{</span><span class="string" id="8309672">&#34;\x09&#34;</span><span class="op" id="8309678">,</span>&nbsp;<span class="string" id="8309680">`&#34;\t&#34;`</span><span class="op" id="8309686">}</span><span class="op" id="8309687">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309690">{</span><span class="string" id="8309691">&#34;\x0a&#34;</span><span class="op" id="8309697">,</span>&nbsp;<span class="string" id="8309699">`&#34;\n&#34;`</span><span class="op" id="8309705">}</span><span class="op" id="8309706">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309709">{</span><span class="string" id="8309710">&#34;\x0b&#34;</span><span class="op" id="8309716">,</span>&nbsp;<span class="string" id="8309718">`&#34;\u000b&#34;`</span><span class="op" id="8309728">}</span><span class="op" id="8309729">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309732">{</span><span class="string" id="8309733">&#34;\x0c&#34;</span><span class="op" id="8309739">,</span>&nbsp;<span class="string" id="8309741">`&#34;\u000c&#34;`</span><span class="op" id="8309751">}</span><span class="op" id="8309752">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309755">{</span><span class="string" id="8309756">&#34;\x0d&#34;</span><span class="op" id="8309762">,</span>&nbsp;<span class="string" id="8309764">`&#34;\r&#34;`</span><span class="op" id="8309770">}</span><span class="op" id="8309771">,</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309774">{</span><span class="string" id="8309775">&#34;\x0e&#34;</span><span class="op" id="8309781">,</span>&nbsp;<span class="string" id="8309783">`&#34;\u000e&#34;`</span><span class="op" id="8309793">}</span><span class="op" id="8309794">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309797">{</span><span class="string" id="8309798">&#34;\x0f&#34;</span><span class="op" id="8309804">,</span>&nbsp;<span class="string" id="8309806">`&#34;\u000f&#34;`</span><span class="op" id="8309816">}</span><span class="op" id="8309817">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309820">{</span><span class="string" id="8309821">&#34;\x10&#34;</span><span class="op" id="8309827">,</span>&nbsp;<span class="string" id="8309829">`&#34;\u0010&#34;`</span><span class="op" id="8309839">}</span><span class="op" id="8309840">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309843">{</span><span class="string" id="8309844">&#34;\x11&#34;</span><span class="op" id="8309850">,</span>&nbsp;<span class="string" id="8309852">`&#34;\u0011&#34;`</span><span class="op" id="8309862">}</span><span class="op" id="8309863">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309866">{</span><span class="string" id="8309867">&#34;\x12&#34;</span><span class="op" id="8309873">,</span>&nbsp;<span class="string" id="8309875">`&#34;\u0012&#34;`</span><span class="op" id="8309885">}</span><span class="op" id="8309886">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309889">{</span><span class="string" id="8309890">&#34;\x13&#34;</span><span class="op" id="8309896">,</span>&nbsp;<span class="string" id="8309898">`&#34;\u0013&#34;`</span><span class="op" id="8309908">}</span><span class="op" id="8309909">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309912">{</span><span class="string" id="8309913">&#34;\x14&#34;</span><span class="op" id="8309919">,</span>&nbsp;<span class="string" id="8309921">`&#34;\u0014&#34;`</span><span class="op" id="8309931">}</span><span class="op" id="8309932">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309935">{</span><span class="string" id="8309936">&#34;\x15&#34;</span><span class="op" id="8309942">,</span>&nbsp;<span class="string" id="8309944">`&#34;\u0015&#34;`</span><span class="op" id="8309954">}</span><span class="op" id="8309955">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309958">{</span><span class="string" id="8309959">&#34;\x16&#34;</span><span class="op" id="8309965">,</span>&nbsp;<span class="string" id="8309967">`&#34;\u0016&#34;`</span><span class="op" id="8309977">}</span><span class="op" id="8309978">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309981">{</span><span class="string" id="8309982">&#34;\x17&#34;</span><span class="op" id="8309988">,</span>&nbsp;<span class="string" id="8309990">`&#34;\u0017&#34;`</span><span class="op" id="8310000">}</span><span class="op" id="8310001">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8310004">{</span><span class="string" id="8310005">&#34;\x18&#34;</span><span class="op" id="8310011">,</span>&nbsp;<span class="string" id="8310013">`&#34;\u0018&#34;`</span><span class="op" id="8310023">}</span><span class="op" id="8310024">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8310027">{</span><span class="string" id="8310028">&#34;\x19&#34;</span><span class="op" id="8310034">,</span>&nbsp;<span class="string" id="8310036">`&#34;\u0019&#34;`</span><span class="op" id="8310046">}</span><span class="op" id="8310047">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8310050">{</span><span class="string" id="8310051">&#34;\x1a&#34;</span><span class="op" id="8310057">,</span>&nbsp;<span class="string" id="8310059">`&#34;\u001a&#34;`</span><span class="op" id="8310069">}</span><span class="op" id="8310070">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8310073">{</span><span class="string" id="8310074">&#34;\x1b&#34;</span><span class="op" id="8310080">,</span>&nbsp;<span class="string" id="8310082">`&#34;\u001b&#34;`</span><span class="op" id="8310092">}</span><span class="op" id="8310093">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8310096">{</span><span class="string" id="8310097">&#34;\x1c&#34;</span><span class="op" id="8310103">,</span>&nbsp;<span class="string" id="8310105">`&#34;\u001c&#34;`</span><span class="op" id="8310115">}</span><span class="op" id="8310116">,</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8310119">{</span><span class="string" id="8310120">&#34;\x1d&#34;</span><span class="op" id="8310126">,</span>&nbsp;<span class="string" id="8310128">`&#34;\u001d&#34;`</span><span class="op" id="8310138">}</span><span class="op" id="8310139">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8310142">{</span><span class="string" id="8310143">&#34;\x1e&#34;</span><span class="op" id="8310149">,</span>&nbsp;<span class="string" id="8310151">`&#34;\u001e&#34;`</span><span class="op" id="8310161">}</span><span class="op" id="8310162">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8310165">{</span><span class="string" id="8310166">&#34;\x1f&#34;</span><span class="op" id="8310172">,</span>&nbsp;<span class="string" id="8310174">`&#34;\u001f&#34;`</span><span class="op" id="8310184">}</span><span class="op" id="8310185">,</span><br>
<span class="lineno"></span><span class="op" id="8310187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">520</span><span class="keyword" id="8310190">func</span>&nbsp;<span class="ident" id="8310195">TestEncodeString</span><span class="op" id="8310211">(</span><span class="ident" id="8310212">t</span>&nbsp;<span class="op" id="8310214">*</span><span class="ident" id="8310215">testing</span><span class="op" id="8310222">.</span><span class="ident" id="8310223">T</span><span class="op" id="8310224">)</span>&nbsp;<span class="op" id="8310226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8310229">for</span>&nbsp;<span class="ident" id="8310233">_</span><span class="op" id="8310234">,</span>&nbsp;<span class="ident" id="8310236">tt</span>&nbsp;<span class="op" id="8310239">:=</span>&nbsp;<span class="keyword" id="8310242">range</span>&nbsp;<span class="ident" id="8310248">encodeStringTests</span>&nbsp;<span class="op" id="8310266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310270">b</span><span class="op" id="8310271">,</span>&nbsp;<span class="ident" id="8310273">err</span>&nbsp;<span class="op" id="8310277">:=</span>&nbsp;<span class="ident" id="8310280">Marshal</span><span class="op" id="8310287">(</span><span class="ident" id="8310288">tt</span><span class="op" id="8310290">.</span><span class="ident" id="8310291">in</span><span class="op" id="8310293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8310297">if</span>&nbsp;<span class="ident" id="8310300">err</span>&nbsp;<span class="op" id="8310304">!=</span>&nbsp;<span class="ident" id="8310307">nil</span>&nbsp;<span class="op" id="8310311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310316">t</span><span class="op" id="8310317">.</span><span class="ident" id="8310318">Errorf</span><span class="op" id="8310324">(</span><span class="string" id="8310325">&#34;Marshal(%q):&nbsp;%v&#34;</span><span class="op" id="8310342">,</span>&nbsp;<span class="ident" id="8310344">tt</span><span class="op" id="8310346">.</span><span class="ident" id="8310347">in</span><span class="op" id="8310349">,</span>&nbsp;<span class="ident" id="8310351">err</span><span class="op" id="8310354">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8310359">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8310370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310374">out</span>&nbsp;<span class="op" id="8310378">:=</span>&nbsp;<span class="builtintype" id="8310381">string</span><span class="op" id="8310387">(</span><span class="ident" id="8310388">b</span><span class="op" id="8310389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8310393">if</span>&nbsp;<span class="ident" id="8310396">out</span>&nbsp;<span class="op" id="8310400">!=</span>&nbsp;<span class="ident" id="8310403">tt</span><span class="op" id="8310405">.</span><span class="ident" id="8310406">out</span>&nbsp;<span class="op" id="8310410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310415">t</span><span class="op" id="8310416">.</span><span class="ident" id="8310417">Errorf</span><span class="op" id="8310423">(</span><span class="string" id="8310424">&#34;Marshal(%q)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="8310453">,</span>&nbsp;<span class="ident" id="8310455">tt</span><span class="op" id="8310457">.</span><span class="ident" id="8310458">in</span><span class="op" id="8310460">,</span>&nbsp;<span class="ident" id="8310462">out</span><span class="op" id="8310465">,</span>&nbsp;<span class="ident" id="8310467">tt</span><span class="op" id="8310469">.</span><span class="ident" id="8310470">out</span><span class="op" id="8310473">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8310477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8310480">}</span><br>
<span class="lineno"></span><span class="op" id="8310482">}</span>
</div>
</body>
</html>
