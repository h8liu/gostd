<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/build</h2>
<ul>
<li><a href="/gostd/go/build/build.go.html">build.go</a></li>
<li><a href="/gostd/go/build/build_test.go.html">build_test.go</a></li>
<li><a href="/gostd/go/build/deps_test.go.html">deps_test.go</a></li>
<li><a href="/gostd/go/build/doc.go.html">doc.go</a></li>
<li><a href="/gostd/go/build/read.go.html">read.go</a></li>
<li><a href="/gostd/go/build/read_test.go.html">read_test.go</a></li>
<li><a href="/gostd/go/build/syslist.go.html">syslist.go</a></li>
<li><a href="/gostd/go/build/syslist_test.go.html">syslist_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7655001">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7655057">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7655111">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7655162">package</span>&nbsp;<span class="ident" id="7655170">build</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7655177">import</span>&nbsp;<span class="op" id="7655184">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7655187">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7655193">&#34;os&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7655199">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7655216">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7655227">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7655238">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7655249">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="7655259">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7655262">func</span>&nbsp;<span class="ident" id="7655267">TestMatch</span><span class="op" id="7655276">(</span><span class="ident" id="7655277">t</span>&nbsp;<span class="op" id="7655279">*</span><span class="ident" id="7655280">testing</span><span class="op" id="7655287">.</span><span class="ident" id="7655288">T</span><span class="op" id="7655289">)</span>&nbsp;<span class="op" id="7655291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7655294">ctxt</span>&nbsp;<span class="op" id="7655299">:=</span>&nbsp;<span class="ident" id="7655302">Default</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7655311">what</span>&nbsp;<span class="op" id="7655316">:=</span>&nbsp;<span class="string" id="7655319">&#34;default&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7655330">match</span>&nbsp;<span class="op" id="7655336">:=</span>&nbsp;<span class="keyword" id="7655339">func</span><span class="op" id="7655343">(</span><span class="ident" id="7655344">tag</span>&nbsp;<span class="builtintype" id="7655348">string</span><span class="op" id="7655354">,</span>&nbsp;<span class="ident" id="7655356">want</span>&nbsp;<span class="keyword" id="7655361">map</span><span class="op" id="7655364">[</span><span class="builtintype" id="7655365">string</span><span class="op" id="7655371">]</span><span class="builtintype" id="7655372">bool</span><span class="op" id="7655376">)</span>&nbsp;<span class="op" id="7655378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7655382">m</span>&nbsp;<span class="op" id="7655384">:=</span>&nbsp;<span class="builtinfunc" id="7655387">make</span><span class="op" id="7655391">(</span><span class="keyword" id="7655392">map</span><span class="op" id="7655395">[</span><span class="builtintype" id="7655396">string</span><span class="op" id="7655402">]</span><span class="builtintype" id="7655403">bool</span><span class="op" id="7655407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7655411">if</span>&nbsp;<span class="op" id="7655414">!</span><span class="ident" id="7655415">ctxt</span><span class="op" id="7655419">.</span><span class="ident" id="7655420">match</span><span class="op" id="7655425">(</span><span class="ident" id="7655426">tag</span><span class="op" id="7655429">,</span>&nbsp;<span class="ident" id="7655431">m</span><span class="op" id="7655432">)</span>&nbsp;<span class="op" id="7655434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7655439">t</span><span class="op" id="7655440">.</span><span class="ident" id="7655441">Errorf</span><span class="op" id="7655447">(</span><span class="string" id="7655448">&#34;%s&nbsp;context&nbsp;should&nbsp;match&nbsp;%s,&nbsp;does&nbsp;not&#34;</span><span class="op" id="7655486">,</span>&nbsp;<span class="ident" id="7655488">what</span><span class="op" id="7655492">,</span>&nbsp;<span class="ident" id="7655494">tag</span><span class="op" id="7655497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7655501">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7655505">if</span>&nbsp;<span class="op" id="7655508">!</span><span class="ident" id="7655509">reflect</span><span class="op" id="7655516">.</span><span class="ident" id="7655517">DeepEqual</span><span class="op" id="7655526">(</span><span class="ident" id="7655527">m</span><span class="op" id="7655528">,</span>&nbsp;<span class="ident" id="7655530">want</span><span class="op" id="7655534">)</span>&nbsp;<span class="op" id="7655536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7655541">t</span><span class="op" id="7655542">.</span><span class="ident" id="7655543">Errorf</span><span class="op" id="7655549">(</span><span class="string" id="7655550">&#34;%s&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7655573">,</span>&nbsp;<span class="ident" id="7655575">tag</span><span class="op" id="7655578">,</span>&nbsp;<span class="ident" id="7655580">m</span><span class="op" id="7655581">,</span>&nbsp;<span class="ident" id="7655583">want</span><span class="op" id="7655587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7655591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7655594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7655597">nomatch</span>&nbsp;<span class="op" id="7655605">:=</span>&nbsp;<span class="keyword" id="7655608">func</span><span class="op" id="7655612">(</span><span class="ident" id="7655613">tag</span>&nbsp;<span class="builtintype" id="7655617">string</span><span class="op" id="7655623">,</span>&nbsp;<span class="ident" id="7655625">want</span>&nbsp;<span class="keyword" id="7655630">map</span><span class="op" id="7655633">[</span><span class="builtintype" id="7655634">string</span><span class="op" id="7655640">]</span><span class="builtintype" id="7655641">bool</span><span class="op" id="7655645">)</span>&nbsp;<span class="op" id="7655647">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7655651">m</span>&nbsp;<span class="op" id="7655653">:=</span>&nbsp;<span class="builtinfunc" id="7655656">make</span><span class="op" id="7655660">(</span><span class="keyword" id="7655661">map</span><span class="op" id="7655664">[</span><span class="builtintype" id="7655665">string</span><span class="op" id="7655671">]</span><span class="builtintype" id="7655672">bool</span><span class="op" id="7655676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7655680">if</span>&nbsp;<span class="ident" id="7655683">ctxt</span><span class="op" id="7655687">.</span><span class="ident" id="7655688">match</span><span class="op" id="7655693">(</span><span class="ident" id="7655694">tag</span><span class="op" id="7655697">,</span>&nbsp;<span class="ident" id="7655699">m</span><span class="op" id="7655700">)</span>&nbsp;<span class="op" id="7655702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7655707">t</span><span class="op" id="7655708">.</span><span class="ident" id="7655709">Errorf</span><span class="op" id="7655715">(</span><span class="string" id="7655716">&#34;%s&nbsp;context&nbsp;should&nbsp;NOT&nbsp;match&nbsp;%s,&nbsp;does&#34;</span><span class="op" id="7655754">,</span>&nbsp;<span class="ident" id="7655756">what</span><span class="op" id="7655760">,</span>&nbsp;<span class="ident" id="7655762">tag</span><span class="op" id="7655765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7655769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7655773">if</span>&nbsp;<span class="op" id="7655776">!</span><span class="ident" id="7655777">reflect</span><span class="op" id="7655784">.</span><span class="ident" id="7655785">DeepEqual</span><span class="op" id="7655794">(</span><span class="ident" id="7655795">m</span><span class="op" id="7655796">,</span>&nbsp;<span class="ident" id="7655798">want</span><span class="op" id="7655802">)</span>&nbsp;<span class="op" id="7655804">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7655809">t</span><span class="op" id="7655810">.</span><span class="ident" id="7655811">Errorf</span><span class="op" id="7655817">(</span><span class="string" id="7655818">&#34;%s&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7655841">,</span>&nbsp;<span class="ident" id="7655843">tag</span><span class="op" id="7655846">,</span>&nbsp;<span class="ident" id="7655848">m</span><span class="op" id="7655849">,</span>&nbsp;<span class="ident" id="7655851">want</span><span class="op" id="7655855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7655859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7655862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7655866">match</span><span class="op" id="7655871">(</span><span class="ident" id="7655872">runtime</span><span class="op" id="7655879">.</span><span class="ident" id="7655880">GOOS</span><span class="op" id="7655884">+</span><span class="string" id="7655885">&#34;,&#34;</span><span class="op" id="7655888">+</span><span class="ident" id="7655889">runtime</span><span class="op" id="7655896">.</span><span class="ident" id="7655897">GOARCH</span><span class="op" id="7655903">,</span>&nbsp;<span class="keyword" id="7655905">map</span><span class="op" id="7655908">[</span><span class="builtintype" id="7655909">string</span><span class="op" id="7655915">]</span><span class="builtintype" id="7655916">bool</span><span class="op" id="7655920">{</span><span class="ident" id="7655921">runtime</span><span class="op" id="7655928">.</span><span class="ident" id="7655929">GOOS</span><span class="op" id="7655933">:</span>&nbsp;<span class="builtintype" id="7655935">true</span><span class="op" id="7655939">,</span>&nbsp;<span class="ident" id="7655941">runtime</span><span class="op" id="7655948">.</span><span class="ident" id="7655949">GOARCH</span><span class="op" id="7655955">:</span>&nbsp;<span class="builtintype" id="7655957">true</span><span class="op" id="7655961">}</span><span class="op" id="7655962">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7655965">match</span><span class="op" id="7655970">(</span><span class="ident" id="7655971">runtime</span><span class="op" id="7655978">.</span><span class="ident" id="7655979">GOOS</span><span class="op" id="7655983">+</span><span class="string" id="7655984">&#34;,&#34;</span><span class="op" id="7655987">+</span><span class="ident" id="7655988">runtime</span><span class="op" id="7655995">.</span><span class="ident" id="7655996">GOARCH</span><span class="op" id="7656002">+</span><span class="string" id="7656003">&#34;,!foo&#34;</span><span class="op" id="7656010">,</span>&nbsp;<span class="keyword" id="7656012">map</span><span class="op" id="7656015">[</span><span class="builtintype" id="7656016">string</span><span class="op" id="7656022">]</span><span class="builtintype" id="7656023">bool</span><span class="op" id="7656027">{</span><span class="ident" id="7656028">runtime</span><span class="op" id="7656035">.</span><span class="ident" id="7656036">GOOS</span><span class="op" id="7656040">:</span>&nbsp;<span class="builtintype" id="7656042">true</span><span class="op" id="7656046">,</span>&nbsp;<span class="ident" id="7656048">runtime</span><span class="op" id="7656055">.</span><span class="ident" id="7656056">GOARCH</span><span class="op" id="7656062">:</span>&nbsp;<span class="builtintype" id="7656064">true</span><span class="op" id="7656068">,</span>&nbsp;<span class="string" id="7656070">&#34;foo&#34;</span><span class="op" id="7656075">:</span>&nbsp;<span class="builtintype" id="7656077">true</span><span class="op" id="7656081">}</span><span class="op" id="7656082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7656085">nomatch</span><span class="op" id="7656092">(</span><span class="ident" id="7656093">runtime</span><span class="op" id="7656100">.</span><span class="ident" id="7656101">GOOS</span><span class="op" id="7656105">+</span><span class="string" id="7656106">&#34;,&#34;</span><span class="op" id="7656109">+</span><span class="ident" id="7656110">runtime</span><span class="op" id="7656117">.</span><span class="ident" id="7656118">GOARCH</span><span class="op" id="7656124">+</span><span class="string" id="7656125">&#34;,foo&#34;</span><span class="op" id="7656131">,</span>&nbsp;<span class="keyword" id="7656133">map</span><span class="op" id="7656136">[</span><span class="builtintype" id="7656137">string</span><span class="op" id="7656143">]</span><span class="builtintype" id="7656144">bool</span><span class="op" id="7656148">{</span><span class="ident" id="7656149">runtime</span><span class="op" id="7656156">.</span><span class="ident" id="7656157">GOOS</span><span class="op" id="7656161">:</span>&nbsp;<span class="builtintype" id="7656163">true</span><span class="op" id="7656167">,</span>&nbsp;<span class="ident" id="7656169">runtime</span><span class="op" id="7656176">.</span><span class="ident" id="7656177">GOARCH</span><span class="op" id="7656183">:</span>&nbsp;<span class="builtintype" id="7656185">true</span><span class="op" id="7656189">,</span>&nbsp;<span class="string" id="7656191">&#34;foo&#34;</span><span class="op" id="7656196">:</span>&nbsp;<span class="builtintype" id="7656198">true</span><span class="op" id="7656202">}</span><span class="op" id="7656203">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7656207">what</span>&nbsp;<span class="op" id="7656212">=</span>&nbsp;<span class="string" id="7656214">&#34;modified&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7656226">ctxt</span><span class="op" id="7656230">.</span><span class="ident" id="7656231">BuildTags</span>&nbsp;<span class="op" id="7656241">=</span>&nbsp;<span class="op" id="7656243">[</span><span class="op" id="7656244">]</span><span class="builtintype" id="7656245">string</span><span class="op" id="7656251">{</span><span class="string" id="7656252">&#34;foo&#34;</span><span class="op" id="7656257">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7656260">match</span><span class="op" id="7656265">(</span><span class="ident" id="7656266">runtime</span><span class="op" id="7656273">.</span><span class="ident" id="7656274">GOOS</span><span class="op" id="7656278">+</span><span class="string" id="7656279">&#34;,&#34;</span><span class="op" id="7656282">+</span><span class="ident" id="7656283">runtime</span><span class="op" id="7656290">.</span><span class="ident" id="7656291">GOARCH</span><span class="op" id="7656297">,</span>&nbsp;<span class="keyword" id="7656299">map</span><span class="op" id="7656302">[</span><span class="builtintype" id="7656303">string</span><span class="op" id="7656309">]</span><span class="builtintype" id="7656310">bool</span><span class="op" id="7656314">{</span><span class="ident" id="7656315">runtime</span><span class="op" id="7656322">.</span><span class="ident" id="7656323">GOOS</span><span class="op" id="7656327">:</span>&nbsp;<span class="builtintype" id="7656329">true</span><span class="op" id="7656333">,</span>&nbsp;<span class="ident" id="7656335">runtime</span><span class="op" id="7656342">.</span><span class="ident" id="7656343">GOARCH</span><span class="op" id="7656349">:</span>&nbsp;<span class="builtintype" id="7656351">true</span><span class="op" id="7656355">}</span><span class="op" id="7656356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7656359">match</span><span class="op" id="7656364">(</span><span class="ident" id="7656365">runtime</span><span class="op" id="7656372">.</span><span class="ident" id="7656373">GOOS</span><span class="op" id="7656377">+</span><span class="string" id="7656378">&#34;,&#34;</span><span class="op" id="7656381">+</span><span class="ident" id="7656382">runtime</span><span class="op" id="7656389">.</span><span class="ident" id="7656390">GOARCH</span><span class="op" id="7656396">+</span><span class="string" id="7656397">&#34;,foo&#34;</span><span class="op" id="7656403">,</span>&nbsp;<span class="keyword" id="7656405">map</span><span class="op" id="7656408">[</span><span class="builtintype" id="7656409">string</span><span class="op" id="7656415">]</span><span class="builtintype" id="7656416">bool</span><span class="op" id="7656420">{</span><span class="ident" id="7656421">runtime</span><span class="op" id="7656428">.</span><span class="ident" id="7656429">GOOS</span><span class="op" id="7656433">:</span>&nbsp;<span class="builtintype" id="7656435">true</span><span class="op" id="7656439">,</span>&nbsp;<span class="ident" id="7656441">runtime</span><span class="op" id="7656448">.</span><span class="ident" id="7656449">GOARCH</span><span class="op" id="7656455">:</span>&nbsp;<span class="builtintype" id="7656457">true</span><span class="op" id="7656461">,</span>&nbsp;<span class="string" id="7656463">&#34;foo&#34;</span><span class="op" id="7656468">:</span>&nbsp;<span class="builtintype" id="7656470">true</span><span class="op" id="7656474">}</span><span class="op" id="7656475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7656478">nomatch</span><span class="op" id="7656485">(</span><span class="ident" id="7656486">runtime</span><span class="op" id="7656493">.</span><span class="ident" id="7656494">GOOS</span><span class="op" id="7656498">+</span><span class="string" id="7656499">&#34;,&#34;</span><span class="op" id="7656502">+</span><span class="ident" id="7656503">runtime</span><span class="op" id="7656510">.</span><span class="ident" id="7656511">GOARCH</span><span class="op" id="7656517">+</span><span class="string" id="7656518">&#34;,!foo&#34;</span><span class="op" id="7656525">,</span>&nbsp;<span class="keyword" id="7656527">map</span><span class="op" id="7656530">[</span><span class="builtintype" id="7656531">string</span><span class="op" id="7656537">]</span><span class="builtintype" id="7656538">bool</span><span class="op" id="7656542">{</span><span class="ident" id="7656543">runtime</span><span class="op" id="7656550">.</span><span class="ident" id="7656551">GOOS</span><span class="op" id="7656555">:</span>&nbsp;<span class="builtintype" id="7656557">true</span><span class="op" id="7656561">,</span>&nbsp;<span class="ident" id="7656563">runtime</span><span class="op" id="7656570">.</span><span class="ident" id="7656571">GOARCH</span><span class="op" id="7656577">:</span>&nbsp;<span class="builtintype" id="7656579">true</span><span class="op" id="7656583">,</span>&nbsp;<span class="string" id="7656585">&#34;foo&#34;</span><span class="op" id="7656590">:</span>&nbsp;<span class="builtintype" id="7656592">true</span><span class="op" id="7656596">}</span><span class="op" id="7656597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7656600">match</span><span class="op" id="7656605">(</span><span class="ident" id="7656606">runtime</span><span class="op" id="7656613">.</span><span class="ident" id="7656614">GOOS</span><span class="op" id="7656618">+</span><span class="string" id="7656619">&#34;,&#34;</span><span class="op" id="7656622">+</span><span class="ident" id="7656623">runtime</span><span class="op" id="7656630">.</span><span class="ident" id="7656631">GOARCH</span><span class="op" id="7656637">+</span><span class="string" id="7656638">&#34;,!bar&#34;</span><span class="op" id="7656645">,</span>&nbsp;<span class="keyword" id="7656647">map</span><span class="op" id="7656650">[</span><span class="builtintype" id="7656651">string</span><span class="op" id="7656657">]</span><span class="builtintype" id="7656658">bool</span><span class="op" id="7656662">{</span><span class="ident" id="7656663">runtime</span><span class="op" id="7656670">.</span><span class="ident" id="7656671">GOOS</span><span class="op" id="7656675">:</span>&nbsp;<span class="builtintype" id="7656677">true</span><span class="op" id="7656681">,</span>&nbsp;<span class="ident" id="7656683">runtime</span><span class="op" id="7656690">.</span><span class="ident" id="7656691">GOARCH</span><span class="op" id="7656697">:</span>&nbsp;<span class="builtintype" id="7656699">true</span><span class="op" id="7656703">,</span>&nbsp;<span class="string" id="7656705">&#34;bar&#34;</span><span class="op" id="7656710">:</span>&nbsp;<span class="builtintype" id="7656712">true</span><span class="op" id="7656716">}</span><span class="op" id="7656717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7656720">nomatch</span><span class="op" id="7656727">(</span><span class="ident" id="7656728">runtime</span><span class="op" id="7656735">.</span><span class="ident" id="7656736">GOOS</span><span class="op" id="7656740">+</span><span class="string" id="7656741">&#34;,&#34;</span><span class="op" id="7656744">+</span><span class="ident" id="7656745">runtime</span><span class="op" id="7656752">.</span><span class="ident" id="7656753">GOARCH</span><span class="op" id="7656759">+</span><span class="string" id="7656760">&#34;,bar&#34;</span><span class="op" id="7656766">,</span>&nbsp;<span class="keyword" id="7656768">map</span><span class="op" id="7656771">[</span><span class="builtintype" id="7656772">string</span><span class="op" id="7656778">]</span><span class="builtintype" id="7656779">bool</span><span class="op" id="7656783">{</span><span class="ident" id="7656784">runtime</span><span class="op" id="7656791">.</span><span class="ident" id="7656792">GOOS</span><span class="op" id="7656796">:</span>&nbsp;<span class="builtintype" id="7656798">true</span><span class="op" id="7656802">,</span>&nbsp;<span class="ident" id="7656804">runtime</span><span class="op" id="7656811">.</span><span class="ident" id="7656812">GOARCH</span><span class="op" id="7656818">:</span>&nbsp;<span class="builtintype" id="7656820">true</span><span class="op" id="7656824">,</span>&nbsp;<span class="string" id="7656826">&#34;bar&#34;</span><span class="op" id="7656831">:</span>&nbsp;<span class="builtintype" id="7656833">true</span><span class="op" id="7656837">}</span><span class="op" id="7656838">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7656841">nomatch</span><span class="op" id="7656848">(</span><span class="string" id="7656849">&#34;!&#34;</span><span class="op" id="7656852">,</span>&nbsp;<span class="keyword" id="7656854">map</span><span class="op" id="7656857">[</span><span class="builtintype" id="7656858">string</span><span class="op" id="7656864">]</span><span class="builtintype" id="7656865">bool</span><span class="op" id="7656869">{</span><span class="op" id="7656870">}</span><span class="op" id="7656871">)</span><br>
<span class="lineno"></span><span class="op" id="7656873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7656876">func</span>&nbsp;<span class="ident" id="7656881">TestDotSlashImport</span><span class="op" id="7656899">(</span><span class="ident" id="7656900">t</span>&nbsp;<span class="op" id="7656902">*</span><span class="ident" id="7656903">testing</span><span class="op" id="7656910">.</span><span class="ident" id="7656911">T</span><span class="op" id="7656912">)</span>&nbsp;<span class="op" id="7656914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7656917">p</span><span class="op" id="7656918">,</span>&nbsp;<span class="ident" id="7656920">err</span>&nbsp;<span class="op" id="7656924">:=</span>&nbsp;<span class="ident" id="7656927">ImportDir</span><span class="op" id="7656936">(</span><span class="string" id="7656937">&#34;testdata/other&#34;</span><span class="op" id="7656953">,</span>&nbsp;<span class="num" id="7656955">0</span><span class="op" id="7656956">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7656959">if</span>&nbsp;<span class="ident" id="7656962">err</span>&nbsp;<span class="op" id="7656966">!=</span>&nbsp;<span class="ident" id="7656969">nil</span>&nbsp;<span class="op" id="7656973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7656977">t</span><span class="op" id="7656978">.</span><span class="ident" id="7656979">Fatal</span><span class="op" id="7656984">(</span><span class="ident" id="7656985">err</span><span class="op" id="7656988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7656991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7656994">if</span>&nbsp;<span class="builtinfunc" id="7656997">len</span><span class="op" id="7657000">(</span><span class="ident" id="7657001">p</span><span class="op" id="7657002">.</span><span class="ident" id="7657003">Imports</span><span class="op" id="7657010">)</span>&nbsp;<span class="op" id="7657012">!=</span>&nbsp;<span class="num" id="7657015">1</span>&nbsp;<span class="op" id="7657017">||</span>&nbsp;<span class="ident" id="7657020">p</span><span class="op" id="7657021">.</span><span class="ident" id="7657022">Imports</span><span class="op" id="7657029">[</span><span class="num" id="7657030">0</span><span class="op" id="7657031">]</span>&nbsp;<span class="op" id="7657033">!=</span>&nbsp;<span class="string" id="7657036">&#34;./file&#34;</span>&nbsp;<span class="op" id="7657045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7657049">t</span><span class="op" id="7657050">.</span><span class="ident" id="7657051">Fatalf</span><span class="op" id="7657057">(</span><span class="string" id="7657058">&#34;testdata/other:&nbsp;Imports=%v,&nbsp;want&nbsp;[./file]&#34;</span><span class="op" id="7657101">,</span>&nbsp;<span class="ident" id="7657103">p</span><span class="op" id="7657104">.</span><span class="ident" id="7657105">Imports</span><span class="op" id="7657112">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7657115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7657119">p1</span><span class="op" id="7657121">,</span>&nbsp;<span class="ident" id="7657123">err</span>&nbsp;<span class="op" id="7657127">:=</span>&nbsp;<span class="ident" id="7657130">Import</span><span class="op" id="7657136">(</span><span class="string" id="7657137">&#34;./file&#34;</span><span class="op" id="7657145">,</span>&nbsp;<span class="string" id="7657147">&#34;testdata/other&#34;</span><span class="op" id="7657163">,</span>&nbsp;<span class="num" id="7657165">0</span><span class="op" id="7657166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7657169">if</span>&nbsp;<span class="ident" id="7657172">err</span>&nbsp;<span class="op" id="7657176">!=</span>&nbsp;<span class="ident" id="7657179">nil</span>&nbsp;<span class="op" id="7657183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7657187">t</span><span class="op" id="7657188">.</span><span class="ident" id="7657189">Fatal</span><span class="op" id="7657194">(</span><span class="ident" id="7657195">err</span><span class="op" id="7657198">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7657201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7657204">if</span>&nbsp;<span class="ident" id="7657207">p1</span><span class="op" id="7657209">.</span><span class="ident" id="7657210">Name</span>&nbsp;<span class="op" id="7657215">!=</span>&nbsp;<span class="string" id="7657218">&#34;file&#34;</span>&nbsp;<span class="op" id="7657225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7657229">t</span><span class="op" id="7657230">.</span><span class="ident" id="7657231">Fatalf</span><span class="op" id="7657237">(</span><span class="string" id="7657238">&#34;./file:&nbsp;Name=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7657264">,</span>&nbsp;<span class="ident" id="7657266">p1</span><span class="op" id="7657268">.</span><span class="ident" id="7657269">Name</span><span class="op" id="7657273">,</span>&nbsp;<span class="string" id="7657275">&#34;file&#34;</span><span class="op" id="7657281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7657284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7657287">dir</span>&nbsp;<span class="op" id="7657291">:=</span>&nbsp;<span class="ident" id="7657294">filepath</span><span class="op" id="7657302">.</span><span class="ident" id="7657303">Clean</span><span class="op" id="7657308">(</span><span class="string" id="7657309">&#34;testdata/other/file&#34;</span><span class="op" id="7657330">)</span>&nbsp;<span class="comment" id="7657332">//&nbsp;Clean&nbsp;to&nbsp;use&nbsp;\&nbsp;on&nbsp;Windows</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7657362">if</span>&nbsp;<span class="ident" id="7657365">p1</span><span class="op" id="7657367">.</span><span class="ident" id="7657368">Dir</span>&nbsp;<span class="op" id="7657372">!=</span>&nbsp;<span class="ident" id="7657375">dir</span>&nbsp;<span class="op" id="7657379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7657383">t</span><span class="op" id="7657384">.</span><span class="ident" id="7657385">Fatalf</span><span class="op" id="7657391">(</span><span class="string" id="7657392">&#34;./file:&nbsp;Dir=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7657417">,</span>&nbsp;<span class="ident" id="7657419">p1</span><span class="op" id="7657421">.</span><span class="ident" id="7657422">Name</span><span class="op" id="7657426">,</span>&nbsp;<span class="ident" id="7657428">dir</span><span class="op" id="7657431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7657434">}</span><br>
<span class="lineno"></span><span class="op" id="7657436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="7657439">func</span>&nbsp;<span class="ident" id="7657444">TestEmptyImport</span><span class="op" id="7657459">(</span><span class="ident" id="7657460">t</span>&nbsp;<span class="op" id="7657462">*</span><span class="ident" id="7657463">testing</span><span class="op" id="7657470">.</span><span class="ident" id="7657471">T</span><span class="op" id="7657472">)</span>&nbsp;<span class="op" id="7657474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7657477">p</span><span class="op" id="7657478">,</span>&nbsp;<span class="ident" id="7657480">err</span>&nbsp;<span class="op" id="7657484">:=</span>&nbsp;<span class="ident" id="7657487">Import</span><span class="op" id="7657493">(</span><span class="string" id="7657494">&#34;&#34;</span><span class="op" id="7657496">,</span>&nbsp;<span class="ident" id="7657498">Default</span><span class="op" id="7657505">.</span><span class="ident" id="7657506">GOROOT</span><span class="op" id="7657512">,</span>&nbsp;<span class="ident" id="7657514">FindOnly</span><span class="op" id="7657522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7657525">if</span>&nbsp;<span class="ident" id="7657528">err</span>&nbsp;<span class="op" id="7657532">==</span>&nbsp;<span class="ident" id="7657535">nil</span>&nbsp;<span class="op" id="7657539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7657543">t</span><span class="op" id="7657544">.</span><span class="ident" id="7657545">Fatal</span><span class="op" id="7657550">(</span><span class="string" id="7657551">`Import(&#34;&#34;)&nbsp;returned&nbsp;nil&nbsp;error.`</span><span class="op" id="7657583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7657586">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7657589">if</span>&nbsp;<span class="ident" id="7657592">p</span>&nbsp;<span class="op" id="7657594">==</span>&nbsp;<span class="ident" id="7657597">nil</span>&nbsp;<span class="op" id="7657601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7657605">t</span><span class="op" id="7657606">.</span><span class="ident" id="7657607">Fatal</span><span class="op" id="7657612">(</span><span class="string" id="7657613">`Import(&#34;&#34;)&nbsp;returned&nbsp;nil&nbsp;package.`</span><span class="op" id="7657647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7657650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7657653">if</span>&nbsp;<span class="ident" id="7657656">p</span><span class="op" id="7657657">.</span><span class="ident" id="7657658">ImportPath</span>&nbsp;<span class="op" id="7657669">!=</span>&nbsp;<span class="string" id="7657672">&#34;&#34;</span>&nbsp;<span class="op" id="7657675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7657679">t</span><span class="op" id="7657680">.</span><span class="ident" id="7657681">Fatalf</span><span class="op" id="7657687">(</span><span class="string" id="7657688">&#34;ImportPath=%q,&nbsp;want&nbsp;%q.&#34;</span><span class="op" id="7657713">,</span>&nbsp;<span class="ident" id="7657715">p</span><span class="op" id="7657716">.</span><span class="ident" id="7657717">ImportPath</span><span class="op" id="7657727">,</span>&nbsp;<span class="string" id="7657729">&#34;&#34;</span><span class="op" id="7657731">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7657734">}</span><br>
<span class="lineno"></span><span class="op" id="7657736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7657739">func</span>&nbsp;<span class="ident" id="7657744">TestEmptyFolderImport</span><span class="op" id="7657765">(</span><span class="ident" id="7657766">t</span>&nbsp;<span class="op" id="7657768">*</span><span class="ident" id="7657769">testing</span><span class="op" id="7657776">.</span><span class="ident" id="7657777">T</span><span class="op" id="7657778">)</span>&nbsp;<span class="op" id="7657780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7657783">_</span><span class="op" id="7657784">,</span>&nbsp;<span class="ident" id="7657786">err</span>&nbsp;<span class="op" id="7657790">:=</span>&nbsp;<span class="ident" id="7657793">Import</span><span class="op" id="7657799">(</span><span class="string" id="7657800">&#34;.&#34;</span><span class="op" id="7657803">,</span>&nbsp;<span class="string" id="7657805">&#34;testdata/empty&#34;</span><span class="op" id="7657821">,</span>&nbsp;<span class="num" id="7657823">0</span><span class="op" id="7657824">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7657827">if</span>&nbsp;<span class="ident" id="7657830">_</span><span class="op" id="7657831">,</span>&nbsp;<span class="ident" id="7657833">ok</span>&nbsp;<span class="op" id="7657836">:=</span>&nbsp;<span class="ident" id="7657839">err</span><span class="op" id="7657842">.</span><span class="op" id="7657843">(</span><span class="op" id="7657844">*</span><span class="ident" id="7657845">NoGoError</span><span class="op" id="7657854">)</span><span class="op" id="7657855">;</span>&nbsp;<span class="op" id="7657857">!</span><span class="ident" id="7657858">ok</span>&nbsp;<span class="op" id="7657861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7657865">t</span><span class="op" id="7657866">.</span><span class="ident" id="7657867">Fatal</span><span class="op" id="7657872">(</span><span class="string" id="7657873">`Import(&#34;testdata/empty&#34;)&nbsp;did&nbsp;not&nbsp;return&nbsp;NoGoError.`</span><span class="op" id="7657925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7657928">}</span><br>
<span class="lineno"></span><span class="op" id="7657930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="7657933">func</span>&nbsp;<span class="ident" id="7657938">TestMultiplePackageImport</span><span class="op" id="7657963">(</span><span class="ident" id="7657964">t</span>&nbsp;<span class="op" id="7657966">*</span><span class="ident" id="7657967">testing</span><span class="op" id="7657974">.</span><span class="ident" id="7657975">T</span><span class="op" id="7657976">)</span>&nbsp;<span class="op" id="7657978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7657981">_</span><span class="op" id="7657982">,</span>&nbsp;<span class="ident" id="7657984">err</span>&nbsp;<span class="op" id="7657988">:=</span>&nbsp;<span class="ident" id="7657991">Import</span><span class="op" id="7657997">(</span><span class="string" id="7657998">&#34;.&#34;</span><span class="op" id="7658001">,</span>&nbsp;<span class="string" id="7658003">&#34;testdata/multi&#34;</span><span class="op" id="7658019">,</span>&nbsp;<span class="num" id="7658021">0</span><span class="op" id="7658022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7658025">if</span>&nbsp;<span class="ident" id="7658028">_</span><span class="op" id="7658029">,</span>&nbsp;<span class="ident" id="7658031">ok</span>&nbsp;<span class="op" id="7658034">:=</span>&nbsp;<span class="ident" id="7658037">err</span><span class="op" id="7658040">.</span><span class="op" id="7658041">(</span><span class="op" id="7658042">*</span><span class="ident" id="7658043">MultiplePackageError</span><span class="op" id="7658063">)</span><span class="op" id="7658064">;</span>&nbsp;<span class="op" id="7658066">!</span><span class="ident" id="7658067">ok</span>&nbsp;<span class="op" id="7658070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7658074">t</span><span class="op" id="7658075">.</span><span class="ident" id="7658076">Fatal</span><span class="op" id="7658081">(</span><span class="string" id="7658082">`Import(&#34;testdata/multi&#34;)&nbsp;did&nbsp;not&nbsp;return&nbsp;MultiplePackageError.`</span><span class="op" id="7658145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7658148">}</span><br>
<span class="lineno">100</span><span class="op" id="7658150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7658153">func</span>&nbsp;<span class="ident" id="7658158">TestLocalDirectory</span><span class="op" id="7658176">(</span><span class="ident" id="7658177">t</span>&nbsp;<span class="op" id="7658179">*</span><span class="ident" id="7658180">testing</span><span class="op" id="7658187">.</span><span class="ident" id="7658188">T</span><span class="op" id="7658189">)</span>&nbsp;<span class="op" id="7658191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7658194">cwd</span><span class="op" id="7658197">,</span>&nbsp;<span class="ident" id="7658199">err</span>&nbsp;<span class="op" id="7658203">:=</span>&nbsp;<span class="ident" id="7658206">os</span><span class="op" id="7658208">.</span><span class="ident" id="7658209">Getwd</span><span class="op" id="7658214">(</span><span class="op" id="7658215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7658218">if</span>&nbsp;<span class="ident" id="7658221">err</span>&nbsp;<span class="op" id="7658225">!=</span>&nbsp;<span class="ident" id="7658228">nil</span>&nbsp;<span class="op" id="7658232">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7658236">t</span><span class="op" id="7658237">.</span><span class="ident" id="7658238">Fatal</span><span class="op" id="7658243">(</span><span class="ident" id="7658244">err</span><span class="op" id="7658247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7658250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7658254">p</span><span class="op" id="7658255">,</span>&nbsp;<span class="ident" id="7658257">err</span>&nbsp;<span class="op" id="7658261">:=</span>&nbsp;<span class="ident" id="7658264">ImportDir</span><span class="op" id="7658273">(</span><span class="ident" id="7658274">cwd</span><span class="op" id="7658277">,</span>&nbsp;<span class="num" id="7658279">0</span><span class="op" id="7658280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7658283">if</span>&nbsp;<span class="ident" id="7658286">err</span>&nbsp;<span class="op" id="7658290">!=</span>&nbsp;<span class="ident" id="7658293">nil</span>&nbsp;<span class="op" id="7658297">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7658301">t</span><span class="op" id="7658302">.</span><span class="ident" id="7658303">Fatal</span><span class="op" id="7658308">(</span><span class="ident" id="7658309">err</span><span class="op" id="7658312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7658315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7658318">if</span>&nbsp;<span class="ident" id="7658321">p</span><span class="op" id="7658322">.</span><span class="ident" id="7658323">ImportPath</span>&nbsp;<span class="op" id="7658334">!=</span>&nbsp;<span class="string" id="7658337">&#34;go/build&#34;</span>&nbsp;<span class="op" id="7658348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7658352">t</span><span class="op" id="7658353">.</span><span class="ident" id="7658354">Fatalf</span><span class="op" id="7658360">(</span><span class="string" id="7658361">&#34;ImportPath=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7658385">,</span>&nbsp;<span class="ident" id="7658387">p</span><span class="op" id="7658388">.</span><span class="ident" id="7658389">ImportPath</span><span class="op" id="7658399">,</span>&nbsp;<span class="string" id="7658401">&#34;go/build&#34;</span><span class="op" id="7658411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7658414">}</span><br>
<span class="lineno">115</span><span class="op" id="7658416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7658419">func</span>&nbsp;<span class="ident" id="7658424">TestShouldBuild</span><span class="op" id="7658439">(</span><span class="ident" id="7658440">t</span>&nbsp;<span class="op" id="7658442">*</span><span class="ident" id="7658443">testing</span><span class="op" id="7658450">.</span><span class="ident" id="7658451">T</span><span class="op" id="7658452">)</span>&nbsp;<span class="op" id="7658454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7658457">const</span>&nbsp;<span class="ident" id="7658463">file1</span>&nbsp;<span class="op" id="7658469">=</span>&nbsp;<span class="string" id="7658471">&#34;//&nbsp;+build&nbsp;tag1\n\n&#34;</span>&nbsp;<span class="op" id="7658492">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7658496">&#34;package&nbsp;main\n&#34;</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7658514">want1</span>&nbsp;<span class="op" id="7658520">:=</span>&nbsp;<span class="keyword" id="7658523">map</span><span class="op" id="7658526">[</span><span class="builtintype" id="7658527">string</span><span class="op" id="7658533">]</span><span class="builtintype" id="7658534">bool</span><span class="op" id="7658538">{</span><span class="string" id="7658539">&#34;tag1&#34;</span><span class="op" id="7658545">:</span>&nbsp;<span class="builtintype" id="7658547">true</span><span class="op" id="7658551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7658555">const</span>&nbsp;<span class="ident" id="7658561">file2</span>&nbsp;<span class="op" id="7658567">=</span>&nbsp;<span class="string" id="7658569">&#34;//&nbsp;+build&nbsp;cgo\n\n&#34;</span>&nbsp;<span class="op" id="7658589">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7658593">&#34;//&nbsp;This&nbsp;package&nbsp;implements&nbsp;parsing&nbsp;of&nbsp;tags&nbsp;like\n&#34;</span>&nbsp;<span class="op" id="7658645">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7658649">&#34;//&nbsp;+build&nbsp;tag1\n&#34;</span>&nbsp;<span class="op" id="7658668">+</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7658672">&#34;package&nbsp;build&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7658689">want2</span>&nbsp;<span class="op" id="7658695">:=</span>&nbsp;<span class="keyword" id="7658698">map</span><span class="op" id="7658701">[</span><span class="builtintype" id="7658702">string</span><span class="op" id="7658708">]</span><span class="builtintype" id="7658709">bool</span><span class="op" id="7658713">{</span><span class="string" id="7658714">&#34;cgo&#34;</span><span class="op" id="7658719">:</span>&nbsp;<span class="builtintype" id="7658721">true</span><span class="op" id="7658725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7658729">const</span>&nbsp;<span class="ident" id="7658735">file3</span>&nbsp;<span class="op" id="7658741">=</span>&nbsp;<span class="string" id="7658743">&#34;//&nbsp;Copyright&nbsp;The&nbsp;Go&nbsp;Authors.\n\n&#34;</span>&nbsp;<span class="op" id="7658778">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7658782">&#34;package&nbsp;build\n\n&#34;</span>&nbsp;<span class="op" id="7658802">+</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7658806">&#34;//&nbsp;shouldBuild&nbsp;checks&nbsp;tags&nbsp;given&nbsp;by&nbsp;lines&nbsp;of&nbsp;the&nbsp;form\n&#34;</span>&nbsp;<span class="op" id="7658864">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7658868">&#34;//&nbsp;+build&nbsp;tag\n&#34;</span>&nbsp;<span class="op" id="7658886">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7658890">&#34;func&nbsp;shouldBuild(content&nbsp;[]byte)\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7658928">want3</span>&nbsp;<span class="op" id="7658934">:=</span>&nbsp;<span class="keyword" id="7658937">map</span><span class="op" id="7658940">[</span><span class="builtintype" id="7658941">string</span><span class="op" id="7658947">]</span><span class="builtintype" id="7658948">bool</span><span class="op" id="7658952">{</span><span class="op" id="7658953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7658957">ctx</span>&nbsp;<span class="op" id="7658961">:=</span>&nbsp;<span class="op" id="7658964">&amp;</span><span class="ident" id="7658965">Context</span><span class="op" id="7658972">{</span><span class="ident" id="7658973">BuildTags</span><span class="op" id="7658982">:</span>&nbsp;<span class="op" id="7658984">[</span><span class="op" id="7658985">]</span><span class="builtintype" id="7658986">string</span><span class="op" id="7658992">{</span><span class="string" id="7658993">&#34;tag1&#34;</span><span class="op" id="7658999">}</span><span class="op" id="7659000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7659003">m</span>&nbsp;<span class="op" id="7659005">:=</span>&nbsp;<span class="keyword" id="7659008">map</span><span class="op" id="7659011">[</span><span class="builtintype" id="7659012">string</span><span class="op" id="7659018">]</span><span class="builtintype" id="7659019">bool</span><span class="op" id="7659023">{</span><span class="op" id="7659024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7659027">if</span>&nbsp;<span class="op" id="7659030">!</span><span class="ident" id="7659031">ctx</span><span class="op" id="7659034">.</span><span class="ident" id="7659035">shouldBuild</span><span class="op" id="7659046">(</span><span class="op" id="7659047">[</span><span class="op" id="7659048">]</span><span class="builtintype" id="7659049">byte</span><span class="op" id="7659053">(</span><span class="ident" id="7659054">file1</span><span class="op" id="7659059">)</span><span class="op" id="7659060">,</span>&nbsp;<span class="ident" id="7659062">m</span><span class="op" id="7659063">)</span>&nbsp;<span class="op" id="7659065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7659069">t</span><span class="op" id="7659070">.</span><span class="ident" id="7659071">Errorf</span><span class="op" id="7659077">(</span><span class="string" id="7659078">&#34;shouldBuild(file1)&nbsp;=&nbsp;false,&nbsp;want&nbsp;true&#34;</span><span class="op" id="7659117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7659120">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7659123">if</span>&nbsp;<span class="op" id="7659126">!</span><span class="ident" id="7659127">reflect</span><span class="op" id="7659134">.</span><span class="ident" id="7659135">DeepEqual</span><span class="op" id="7659144">(</span><span class="ident" id="7659145">m</span><span class="op" id="7659146">,</span>&nbsp;<span class="ident" id="7659148">want1</span><span class="op" id="7659153">)</span>&nbsp;<span class="op" id="7659155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7659159">t</span><span class="op" id="7659160">.</span><span class="ident" id="7659161">Errorf</span><span class="op" id="7659167">(</span><span class="string" id="7659168">&#34;shoudBuild(file1)&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7659206">,</span>&nbsp;<span class="ident" id="7659208">m</span><span class="op" id="7659209">,</span>&nbsp;<span class="ident" id="7659211">want1</span><span class="op" id="7659216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7659219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7659223">m</span>&nbsp;<span class="op" id="7659225">=</span>&nbsp;<span class="keyword" id="7659227">map</span><span class="op" id="7659230">[</span><span class="builtintype" id="7659231">string</span><span class="op" id="7659237">]</span><span class="builtintype" id="7659238">bool</span><span class="op" id="7659242">{</span><span class="op" id="7659243">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7659246">if</span>&nbsp;<span class="ident" id="7659249">ctx</span><span class="op" id="7659252">.</span><span class="ident" id="7659253">shouldBuild</span><span class="op" id="7659264">(</span><span class="op" id="7659265">[</span><span class="op" id="7659266">]</span><span class="builtintype" id="7659267">byte</span><span class="op" id="7659271">(</span><span class="ident" id="7659272">file2</span><span class="op" id="7659277">)</span><span class="op" id="7659278">,</span>&nbsp;<span class="ident" id="7659280">m</span><span class="op" id="7659281">)</span>&nbsp;<span class="op" id="7659283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7659287">t</span><span class="op" id="7659288">.</span><span class="ident" id="7659289">Errorf</span><span class="op" id="7659295">(</span><span class="string" id="7659296">&#34;shouldBuild(file2)&nbsp;=&nbsp;true,&nbsp;want&nbsp;fakse&#34;</span><span class="op" id="7659335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7659338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7659341">if</span>&nbsp;<span class="op" id="7659344">!</span><span class="ident" id="7659345">reflect</span><span class="op" id="7659352">.</span><span class="ident" id="7659353">DeepEqual</span><span class="op" id="7659362">(</span><span class="ident" id="7659363">m</span><span class="op" id="7659364">,</span>&nbsp;<span class="ident" id="7659366">want2</span><span class="op" id="7659371">)</span>&nbsp;<span class="op" id="7659373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7659377">t</span><span class="op" id="7659378">.</span><span class="ident" id="7659379">Errorf</span><span class="op" id="7659385">(</span><span class="string" id="7659386">&#34;shoudBuild(file2)&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7659424">,</span>&nbsp;<span class="ident" id="7659426">m</span><span class="op" id="7659427">,</span>&nbsp;<span class="ident" id="7659429">want2</span><span class="op" id="7659434">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7659437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7659441">m</span>&nbsp;<span class="op" id="7659443">=</span>&nbsp;<span class="keyword" id="7659445">map</span><span class="op" id="7659448">[</span><span class="builtintype" id="7659449">string</span><span class="op" id="7659455">]</span><span class="builtintype" id="7659456">bool</span><span class="op" id="7659460">{</span><span class="op" id="7659461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7659464">ctx</span>&nbsp;<span class="op" id="7659468">=</span>&nbsp;<span class="op" id="7659470">&amp;</span><span class="ident" id="7659471">Context</span><span class="op" id="7659478">{</span><span class="ident" id="7659479">BuildTags</span><span class="op" id="7659488">:</span>&nbsp;<span class="ident" id="7659490">nil</span><span class="op" id="7659493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7659496">if</span>&nbsp;<span class="op" id="7659499">!</span><span class="ident" id="7659500">ctx</span><span class="op" id="7659503">.</span><span class="ident" id="7659504">shouldBuild</span><span class="op" id="7659515">(</span><span class="op" id="7659516">[</span><span class="op" id="7659517">]</span><span class="builtintype" id="7659518">byte</span><span class="op" id="7659522">(</span><span class="ident" id="7659523">file3</span><span class="op" id="7659528">)</span><span class="op" id="7659529">,</span>&nbsp;<span class="ident" id="7659531">m</span><span class="op" id="7659532">)</span>&nbsp;<span class="op" id="7659534">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7659538">t</span><span class="op" id="7659539">.</span><span class="ident" id="7659540">Errorf</span><span class="op" id="7659546">(</span><span class="string" id="7659547">&#34;shouldBuild(file3)&nbsp;=&nbsp;false,&nbsp;want&nbsp;true&#34;</span><span class="op" id="7659586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7659589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7659592">if</span>&nbsp;<span class="op" id="7659595">!</span><span class="ident" id="7659596">reflect</span><span class="op" id="7659603">.</span><span class="ident" id="7659604">DeepEqual</span><span class="op" id="7659613">(</span><span class="ident" id="7659614">m</span><span class="op" id="7659615">,</span>&nbsp;<span class="ident" id="7659617">want3</span><span class="op" id="7659622">)</span>&nbsp;<span class="op" id="7659624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7659628">t</span><span class="op" id="7659629">.</span><span class="ident" id="7659630">Errorf</span><span class="op" id="7659636">(</span><span class="string" id="7659637">&#34;shoudBuild(file3)&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7659675">,</span>&nbsp;<span class="ident" id="7659677">m</span><span class="op" id="7659678">,</span>&nbsp;<span class="ident" id="7659680">want3</span><span class="op" id="7659685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7659688">}</span><br>
<span class="lineno">160</span><span class="op" id="7659690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7659693">type</span>&nbsp;<span class="ident" id="7659698">readNopCloser</span>&nbsp;<span class="keyword" id="7659712">struct</span>&nbsp;<span class="op" id="7659719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7659722">io</span><span class="op" id="7659724">.</span><span class="ident" id="7659725">Reader</span><br>
<span class="lineno"></span><span class="op" id="7659732">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="7659735">func</span>&nbsp;<span class="op" id="7659740">(</span><span class="ident" id="7659741">r</span>&nbsp;<span class="ident" id="7659743">readNopCloser</span><span class="op" id="7659756">)</span>&nbsp;<span class="ident" id="7659758">Close</span><span class="op" id="7659763">(</span><span class="op" id="7659764">)</span>&nbsp;<span class="builtintype" id="7659766">error</span>&nbsp;<span class="op" id="7659772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7659775">return</span>&nbsp;<span class="ident" id="7659782">nil</span><br>
<span class="lineno"></span><span class="op" id="7659786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="7659789">var</span>&nbsp;<span class="op" id="7659793">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7659796">ctxtP9</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7659808">=</span>&nbsp;<span class="ident" id="7659810">Context</span><span class="op" id="7659817">{</span><span class="ident" id="7659818">GOARCH</span><span class="op" id="7659824">:</span>&nbsp;<span class="string" id="7659826">&#34;arm&#34;</span><span class="op" id="7659831">,</span>&nbsp;<span class="ident" id="7659833">GOOS</span><span class="op" id="7659837">:</span>&nbsp;<span class="string" id="7659839">&#34;plan9&#34;</span><span class="op" id="7659846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7659849">ctxtAndroid</span>&nbsp;<span class="op" id="7659861">=</span>&nbsp;<span class="ident" id="7659863">Context</span><span class="op" id="7659870">{</span><span class="ident" id="7659871">GOARCH</span><span class="op" id="7659877">:</span>&nbsp;<span class="string" id="7659879">&#34;arm&#34;</span><span class="op" id="7659884">,</span>&nbsp;<span class="ident" id="7659886">GOOS</span><span class="op" id="7659890">:</span>&nbsp;<span class="string" id="7659892">&#34;android&#34;</span><span class="op" id="7659901">}</span><br>
<span class="lineno"></span><span class="op" id="7659903">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="7659906">var</span>&nbsp;<span class="ident" id="7659910">matchFileTests</span>&nbsp;<span class="op" id="7659925">=</span>&nbsp;<span class="op" id="7659927">[</span><span class="op" id="7659928">]</span><span class="keyword" id="7659929">struct</span>&nbsp;<span class="op" id="7659936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7659939">ctxt</span>&nbsp;&nbsp;<span class="ident" id="7659945">Context</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7659954">name</span>&nbsp;&nbsp;<span class="builtintype" id="7659960">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7659968">data</span>&nbsp;&nbsp;<span class="builtintype" id="7659974">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7659982">match</span>&nbsp;<span class="builtintype" id="7659988">bool</span><br>
<span class="lineno">180</span><span class="op" id="7659993">}</span><span class="op" id="7659994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7659997">{</span><span class="ident" id="7659998">ctxtP9</span><span class="op" id="7660004">,</span>&nbsp;<span class="string" id="7660006">&#34;foo_arm.go&#34;</span><span class="op" id="7660018">,</span>&nbsp;<span class="string" id="7660020">&#34;&#34;</span><span class="op" id="7660022">,</span>&nbsp;<span class="builtintype" id="7660024">true</span><span class="op" id="7660028">}</span><span class="op" id="7660029">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7660032">{</span><span class="ident" id="7660033">ctxtP9</span><span class="op" id="7660039">,</span>&nbsp;<span class="string" id="7660041">&#34;foo1_arm.go&#34;</span><span class="op" id="7660054">,</span>&nbsp;<span class="string" id="7660056">&#34;//&nbsp;+build&nbsp;linux\n\npackage&nbsp;main\n&#34;</span><span class="op" id="7660091">,</span>&nbsp;<span class="builtintype" id="7660093">false</span><span class="op" id="7660098">}</span><span class="op" id="7660099">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7660102">{</span><span class="ident" id="7660103">ctxtP9</span><span class="op" id="7660109">,</span>&nbsp;<span class="string" id="7660111">&#34;foo_darwin.go&#34;</span><span class="op" id="7660126">,</span>&nbsp;<span class="string" id="7660128">&#34;&#34;</span><span class="op" id="7660130">,</span>&nbsp;<span class="builtintype" id="7660132">false</span><span class="op" id="7660137">}</span><span class="op" id="7660138">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7660141">{</span><span class="ident" id="7660142">ctxtP9</span><span class="op" id="7660148">,</span>&nbsp;<span class="string" id="7660150">&#34;foo.go&#34;</span><span class="op" id="7660158">,</span>&nbsp;<span class="string" id="7660160">&#34;&#34;</span><span class="op" id="7660162">,</span>&nbsp;<span class="builtintype" id="7660164">true</span><span class="op" id="7660168">}</span><span class="op" id="7660169">,</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7660172">{</span><span class="ident" id="7660173">ctxtP9</span><span class="op" id="7660179">,</span>&nbsp;<span class="string" id="7660181">&#34;foo1.go&#34;</span><span class="op" id="7660190">,</span>&nbsp;<span class="string" id="7660192">&#34;//&nbsp;+build&nbsp;linux\n\npackage&nbsp;main\n&#34;</span><span class="op" id="7660227">,</span>&nbsp;<span class="builtintype" id="7660229">false</span><span class="op" id="7660234">}</span><span class="op" id="7660235">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7660238">{</span><span class="ident" id="7660239">ctxtP9</span><span class="op" id="7660245">,</span>&nbsp;<span class="string" id="7660247">&#34;foo.badsuffix&#34;</span><span class="op" id="7660262">,</span>&nbsp;<span class="string" id="7660264">&#34;&#34;</span><span class="op" id="7660266">,</span>&nbsp;<span class="builtintype" id="7660268">false</span><span class="op" id="7660273">}</span><span class="op" id="7660274">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7660277">{</span><span class="ident" id="7660278">ctxtAndroid</span><span class="op" id="7660289">,</span>&nbsp;<span class="string" id="7660291">&#34;foo_linux.go&#34;</span><span class="op" id="7660305">,</span>&nbsp;<span class="string" id="7660307">&#34;&#34;</span><span class="op" id="7660309">,</span>&nbsp;<span class="builtintype" id="7660311">true</span><span class="op" id="7660315">}</span><span class="op" id="7660316">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7660319">{</span><span class="ident" id="7660320">ctxtAndroid</span><span class="op" id="7660331">,</span>&nbsp;<span class="string" id="7660333">&#34;foo_android.go&#34;</span><span class="op" id="7660349">,</span>&nbsp;<span class="string" id="7660351">&#34;&#34;</span><span class="op" id="7660353">,</span>&nbsp;<span class="builtintype" id="7660355">true</span><span class="op" id="7660359">}</span><span class="op" id="7660360">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7660363">{</span><span class="ident" id="7660364">ctxtAndroid</span><span class="op" id="7660375">,</span>&nbsp;<span class="string" id="7660377">&#34;foo_plan9.go&#34;</span><span class="op" id="7660391">,</span>&nbsp;<span class="string" id="7660393">&#34;&#34;</span><span class="op" id="7660395">,</span>&nbsp;<span class="builtintype" id="7660397">false</span><span class="op" id="7660402">}</span><span class="op" id="7660403">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7660406">{</span><span class="ident" id="7660407">ctxtAndroid</span><span class="op" id="7660418">,</span>&nbsp;<span class="string" id="7660420">&#34;android.go&#34;</span><span class="op" id="7660432">,</span>&nbsp;<span class="string" id="7660434">&#34;&#34;</span><span class="op" id="7660436">,</span>&nbsp;<span class="builtintype" id="7660438">true</span><span class="op" id="7660442">}</span><span class="op" id="7660443">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7660446">{</span><span class="ident" id="7660447">ctxtAndroid</span><span class="op" id="7660458">,</span>&nbsp;<span class="string" id="7660460">&#34;plan9.go&#34;</span><span class="op" id="7660470">,</span>&nbsp;<span class="string" id="7660472">&#34;&#34;</span><span class="op" id="7660474">,</span>&nbsp;<span class="builtintype" id="7660476">true</span><span class="op" id="7660480">}</span><span class="op" id="7660481">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7660484">{</span><span class="ident" id="7660485">ctxtAndroid</span><span class="op" id="7660496">,</span>&nbsp;<span class="string" id="7660498">&#34;plan9_test.go&#34;</span><span class="op" id="7660513">,</span>&nbsp;<span class="string" id="7660515">&#34;&#34;</span><span class="op" id="7660517">,</span>&nbsp;<span class="builtintype" id="7660519">true</span><span class="op" id="7660523">}</span><span class="op" id="7660524">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7660527">{</span><span class="ident" id="7660528">ctxtAndroid</span><span class="op" id="7660539">,</span>&nbsp;<span class="string" id="7660541">&#34;arm.s&#34;</span><span class="op" id="7660548">,</span>&nbsp;<span class="string" id="7660550">&#34;&#34;</span><span class="op" id="7660552">,</span>&nbsp;<span class="builtintype" id="7660554">true</span><span class="op" id="7660558">}</span><span class="op" id="7660559">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7660562">{</span><span class="ident" id="7660563">ctxtAndroid</span><span class="op" id="7660574">,</span>&nbsp;<span class="string" id="7660576">&#34;amd64.s&#34;</span><span class="op" id="7660585">,</span>&nbsp;<span class="string" id="7660587">&#34;&#34;</span><span class="op" id="7660589">,</span>&nbsp;<span class="builtintype" id="7660591">true</span><span class="op" id="7660595">}</span><span class="op" id="7660596">,</span><br>
<span class="lineno">195</span><span class="op" id="7660598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7660601">func</span>&nbsp;<span class="ident" id="7660606">TestMatchFile</span><span class="op" id="7660619">(</span><span class="ident" id="7660620">t</span>&nbsp;<span class="op" id="7660622">*</span><span class="ident" id="7660623">testing</span><span class="op" id="7660630">.</span><span class="ident" id="7660631">T</span><span class="op" id="7660632">)</span>&nbsp;<span class="op" id="7660634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7660637">for</span>&nbsp;<span class="ident" id="7660641">_</span><span class="op" id="7660642">,</span>&nbsp;<span class="ident" id="7660644">tt</span>&nbsp;<span class="op" id="7660647">:=</span>&nbsp;<span class="keyword" id="7660650">range</span>&nbsp;<span class="ident" id="7660656">matchFileTests</span>&nbsp;<span class="op" id="7660671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7660675">ctxt</span>&nbsp;<span class="op" id="7660680">:=</span>&nbsp;<span class="ident" id="7660683">tt</span><span class="op" id="7660685">.</span><span class="ident" id="7660686">ctxt</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7660693">ctxt</span><span class="op" id="7660697">.</span><span class="ident" id="7660698">OpenFile</span>&nbsp;<span class="op" id="7660707">=</span>&nbsp;<span class="keyword" id="7660709">func</span><span class="op" id="7660713">(</span><span class="ident" id="7660714">path</span>&nbsp;<span class="builtintype" id="7660719">string</span><span class="op" id="7660725">)</span>&nbsp;<span class="op" id="7660727">(</span><span class="ident" id="7660728">r</span>&nbsp;<span class="ident" id="7660730">io</span><span class="op" id="7660732">.</span><span class="ident" id="7660733">ReadCloser</span><span class="op" id="7660743">,</span>&nbsp;<span class="ident" id="7660745">err</span>&nbsp;<span class="builtintype" id="7660749">error</span><span class="op" id="7660754">)</span>&nbsp;<span class="op" id="7660756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7660761">if</span>&nbsp;<span class="ident" id="7660764">path</span>&nbsp;<span class="op" id="7660769">!=</span>&nbsp;<span class="string" id="7660772">&#34;x+&#34;</span><span class="op" id="7660776">+</span><span class="ident" id="7660777">tt</span><span class="op" id="7660779">.</span><span class="ident" id="7660780">name</span>&nbsp;<span class="op" id="7660785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7660791">t</span><span class="op" id="7660792">.</span><span class="ident" id="7660793">Fatalf</span><span class="op" id="7660799">(</span><span class="string" id="7660800">&#34;OpenFile&nbsp;asked&nbsp;for&nbsp;%q,&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="7660836">,</span>&nbsp;<span class="ident" id="7660838">path</span><span class="op" id="7660842">,</span>&nbsp;<span class="string" id="7660844">&#34;x+&#34;</span><span class="op" id="7660848">+</span><span class="ident" id="7660849">tt</span><span class="op" id="7660851">.</span><span class="ident" id="7660852">name</span><span class="op" id="7660856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7660861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7660866">return</span>&nbsp;<span class="op" id="7660873">&amp;</span><span class="ident" id="7660874">readNopCloser</span><span class="op" id="7660887">{</span><span class="ident" id="7660888">strings</span><span class="op" id="7660895">.</span><span class="ident" id="7660896">NewReader</span><span class="op" id="7660905">(</span><span class="ident" id="7660906">tt</span><span class="op" id="7660908">.</span><span class="ident" id="7660909">data</span><span class="op" id="7660913">)</span><span class="op" id="7660914">}</span><span class="op" id="7660915">,</span>&nbsp;<span class="ident" id="7660917">nil</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7660923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7660927">ctxt</span><span class="op" id="7660931">.</span><span class="ident" id="7660932">JoinPath</span>&nbsp;<span class="op" id="7660941">=</span>&nbsp;<span class="keyword" id="7660943">func</span><span class="op" id="7660947">(</span><span class="ident" id="7660948">elem</span>&nbsp;<span class="op" id="7660953">...</span><span class="builtintype" id="7660956">string</span><span class="op" id="7660962">)</span>&nbsp;<span class="builtintype" id="7660964">string</span>&nbsp;<span class="op" id="7660971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7660976">return</span>&nbsp;<span class="ident" id="7660983">strings</span><span class="op" id="7660990">.</span><span class="ident" id="7660991">Join</span><span class="op" id="7660995">(</span><span class="ident" id="7660996">elem</span><span class="op" id="7661000">,</span>&nbsp;<span class="string" id="7661002">&#34;+&#34;</span><span class="op" id="7661005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7661009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7661013">match</span><span class="op" id="7661018">,</span>&nbsp;<span class="ident" id="7661020">err</span>&nbsp;<span class="op" id="7661024">:=</span>&nbsp;<span class="ident" id="7661027">ctxt</span><span class="op" id="7661031">.</span><span class="ident" id="7661032">MatchFile</span><span class="op" id="7661041">(</span><span class="string" id="7661042">&#34;x&#34;</span><span class="op" id="7661045">,</span>&nbsp;<span class="ident" id="7661047">tt</span><span class="op" id="7661049">.</span><span class="ident" id="7661050">name</span><span class="op" id="7661054">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7661058">if</span>&nbsp;<span class="ident" id="7661061">match</span>&nbsp;<span class="op" id="7661067">!=</span>&nbsp;<span class="ident" id="7661070">tt</span><span class="op" id="7661072">.</span><span class="ident" id="7661073">match</span>&nbsp;<span class="op" id="7661079">||</span>&nbsp;<span class="ident" id="7661082">err</span>&nbsp;<span class="op" id="7661086">!=</span>&nbsp;<span class="ident" id="7661089">nil</span>&nbsp;<span class="op" id="7661093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7661098">t</span><span class="op" id="7661099">.</span><span class="ident" id="7661100">Fatalf</span><span class="op" id="7661106">(</span><span class="string" id="7661107">&#34;MatchFile(%q)&nbsp;=&nbsp;%v,&nbsp;%v,&nbsp;want&nbsp;%v,&nbsp;nil&#34;</span><span class="op" id="7661145">,</span>&nbsp;<span class="ident" id="7661147">tt</span><span class="op" id="7661149">.</span><span class="ident" id="7661150">name</span><span class="op" id="7661154">,</span>&nbsp;<span class="ident" id="7661156">match</span><span class="op" id="7661161">,</span>&nbsp;<span class="ident" id="7661163">err</span><span class="op" id="7661166">,</span>&nbsp;<span class="ident" id="7661168">tt</span><span class="op" id="7661170">.</span><span class="ident" id="7661171">match</span><span class="op" id="7661176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7661180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7661183">}</span><br>
<span class="lineno"></span><span class="op" id="7661185">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="keyword" id="7661188">func</span>&nbsp;<span class="ident" id="7661193">TestImportCmd</span><span class="op" id="7661206">(</span><span class="ident" id="7661207">t</span>&nbsp;<span class="op" id="7661209">*</span><span class="ident" id="7661210">testing</span><span class="op" id="7661217">.</span><span class="ident" id="7661218">T</span><span class="op" id="7661219">)</span>&nbsp;<span class="op" id="7661221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7661224">p</span><span class="op" id="7661225">,</span>&nbsp;<span class="ident" id="7661227">err</span>&nbsp;<span class="op" id="7661231">:=</span>&nbsp;<span class="ident" id="7661234">Import</span><span class="op" id="7661240">(</span><span class="string" id="7661241">&#34;cmd/internal/objfile&#34;</span><span class="op" id="7661263">,</span>&nbsp;<span class="string" id="7661265">&#34;&#34;</span><span class="op" id="7661267">,</span>&nbsp;<span class="num" id="7661269">0</span><span class="op" id="7661270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7661273">if</span>&nbsp;<span class="ident" id="7661276">err</span>&nbsp;<span class="op" id="7661280">!=</span>&nbsp;<span class="ident" id="7661283">nil</span>&nbsp;<span class="op" id="7661287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7661291">t</span><span class="op" id="7661292">.</span><span class="ident" id="7661293">Fatal</span><span class="op" id="7661298">(</span><span class="ident" id="7661299">err</span><span class="op" id="7661302">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7661305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7661308">if</span>&nbsp;<span class="op" id="7661311">!</span><span class="ident" id="7661312">strings</span><span class="op" id="7661319">.</span><span class="ident" id="7661320">HasSuffix</span><span class="op" id="7661329">(</span><span class="ident" id="7661330">filepath</span><span class="op" id="7661338">.</span><span class="ident" id="7661339">ToSlash</span><span class="op" id="7661346">(</span><span class="ident" id="7661347">p</span><span class="op" id="7661348">.</span><span class="ident" id="7661349">Dir</span><span class="op" id="7661352">)</span><span class="op" id="7661353">,</span>&nbsp;<span class="string" id="7661355">&#34;src/cmd/internal/objfile&#34;</span><span class="op" id="7661381">)</span>&nbsp;<span class="op" id="7661383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7661387">t</span><span class="op" id="7661388">.</span><span class="ident" id="7661389">Fatalf</span><span class="op" id="7661395">(</span><span class="string" id="7661396">&#34;Import&nbsp;cmd/internal/objfile&nbsp;returned&nbsp;Dir=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7661450">,</span>&nbsp;<span class="ident" id="7661452">filepath</span><span class="op" id="7661460">.</span><span class="ident" id="7661461">ToSlash</span><span class="op" id="7661468">(</span><span class="ident" id="7661469">p</span><span class="op" id="7661470">.</span><span class="ident" id="7661471">Dir</span><span class="op" id="7661474">)</span><span class="op" id="7661475">,</span>&nbsp;<span class="string" id="7661477">&#34;.../src/cmd/internal/objfile&#34;</span><span class="op" id="7661507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7661510">}</span><br>
<span class="lineno"></span><span class="op" id="7661512">}</span>
</div>
</body>
</html>
