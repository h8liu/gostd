<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/xml</h2>
<ul>
<li><a href="/gostd/encoding/xml/atom_test.go.html">atom_test.go</a></li>
<li><a href="/gostd/encoding/xml/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/xml/marshal.go.html">marshal.go</a></li>
<li><a href="/gostd/encoding/xml/marshal_test.go.html">marshal_test.go</a></li>
<li><a href="/gostd/encoding/xml/read.go.html">read.go</a></li>
<li><a href="/gostd/encoding/xml/read_test.go.html">read_test.go</a></li>
<li><a href="/gostd/encoding/xml/typeinfo.go.html">typeinfo.go</a></li>
<li><a href="/gostd/encoding/xml/xml.go.html">xml.go</a></li>
<li><a href="/gostd/encoding/xml/xml_test.go.html">xml_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4968083">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4968138">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4968192">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4968243">package</span>&nbsp;<span class="ident" id="4968251">xml</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4968256">import</span>&nbsp;<span class="op" id="4968263">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4968266">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4968275">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4968284">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4968296">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4968303">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4968309">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4968320">&#34;strconv&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4968331">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="4968341">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4968344">const</span>&nbsp;<span class="op" id="4968350">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4968353">//&nbsp;A&nbsp;generic&nbsp;XML&nbsp;header&nbsp;suitable&nbsp;for&nbsp;use&nbsp;with&nbsp;the&nbsp;output&nbsp;of&nbsp;Marshal.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4968423">//&nbsp;This&nbsp;is&nbsp;not&nbsp;automatically&nbsp;added&nbsp;to&nbsp;any&nbsp;output&nbsp;of&nbsp;this&nbsp;package,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4968490">//&nbsp;it&nbsp;is&nbsp;provided&nbsp;as&nbsp;a&nbsp;convenience.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4968527">Header</span>&nbsp;<span class="op" id="4968534">=</span>&nbsp;<span class="string" id="4968536">`&lt;?xml&nbsp;version=&#34;1.0&#34;&nbsp;encoding=&#34;UTF-8&#34;?&gt;`</span>&nbsp;<span class="op" id="4968577">+</span>&nbsp;<span class="string" id="4968579">&#34;\n&#34;</span><br>
<span class="lineno"></span><span class="op" id="4968584">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4968587">//&nbsp;Marshal&nbsp;returns&nbsp;the&nbsp;XML&nbsp;encoding&nbsp;of&nbsp;v.</span><br>
<span class="lineno"></span><span class="comment" id="4968629">//</span><br>
<span class="lineno"></span><span class="comment" id="4968632">//&nbsp;Marshal&nbsp;handles&nbsp;an&nbsp;array&nbsp;or&nbsp;slice&nbsp;by&nbsp;marshalling&nbsp;each&nbsp;of&nbsp;the&nbsp;elements.</span><br>
<span class="lineno"></span><span class="comment" id="4968706">//&nbsp;Marshal&nbsp;handles&nbsp;a&nbsp;pointer&nbsp;by&nbsp;marshalling&nbsp;the&nbsp;value&nbsp;it&nbsp;points&nbsp;at&nbsp;or,&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4968784">//&nbsp;pointer&nbsp;is&nbsp;nil,&nbsp;by&nbsp;writing&nbsp;nothing.&nbsp;&nbsp;Marshal&nbsp;handles&nbsp;an&nbsp;interface&nbsp;value&nbsp;by</span><br>
<span class="lineno">30</span><span class="comment" id="4968862">//&nbsp;marshalling&nbsp;the&nbsp;value&nbsp;it&nbsp;contains&nbsp;or,&nbsp;if&nbsp;the&nbsp;interface&nbsp;value&nbsp;is&nbsp;nil,&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="4968937">//&nbsp;writing&nbsp;nothing.&nbsp;&nbsp;Marshal&nbsp;handles&nbsp;all&nbsp;other&nbsp;data&nbsp;by&nbsp;writing&nbsp;one&nbsp;or&nbsp;more&nbsp;XML</span><br>
<span class="lineno"></span><span class="comment" id="4969016">//&nbsp;elements&nbsp;containing&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="4969049">//</span><br>
<span class="lineno"></span><span class="comment" id="4969052">//&nbsp;The&nbsp;name&nbsp;for&nbsp;the&nbsp;XML&nbsp;elements&nbsp;is&nbsp;taken&nbsp;from,&nbsp;in&nbsp;order&nbsp;of&nbsp;preference:</span><br>
<span class="lineno">35</span><span class="comment" id="4969124">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;tag&nbsp;on&nbsp;the&nbsp;XMLName&nbsp;field,&nbsp;if&nbsp;the&nbsp;data&nbsp;is&nbsp;a&nbsp;struct</span><br>
<span class="lineno"></span><span class="comment" id="4969187">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;XMLName&nbsp;field&nbsp;of&nbsp;type&nbsp;xml.Name</span><br>
<span class="lineno"></span><span class="comment" id="4969244">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;tag&nbsp;of&nbsp;the&nbsp;struct&nbsp;field&nbsp;used&nbsp;to&nbsp;obtain&nbsp;the&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="4969305">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;struct&nbsp;field&nbsp;used&nbsp;to&nbsp;obtain&nbsp;the&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="4969367">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;marshalled&nbsp;type</span><br>
<span class="lineno">40</span><span class="comment" id="4969408">//</span><br>
<span class="lineno"></span><span class="comment" id="4969411">//&nbsp;The&nbsp;XML&nbsp;element&nbsp;for&nbsp;a&nbsp;struct&nbsp;contains&nbsp;marshalled&nbsp;elements&nbsp;for&nbsp;each&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4969488">//&nbsp;exported&nbsp;fields&nbsp;of&nbsp;the&nbsp;struct,&nbsp;with&nbsp;these&nbsp;exceptions:</span><br>
<span class="lineno"></span><span class="comment" id="4969545">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;XMLName&nbsp;field,&nbsp;described&nbsp;above,&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="4969602">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;-&#34;&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno">45</span><span class="comment" id="4969644">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;name,attr&#34;&nbsp;becomes&nbsp;an&nbsp;attribute&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="4969708">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;given&nbsp;name&nbsp;in&nbsp;the&nbsp;XML&nbsp;element.</span><br>
<span class="lineno"></span><span class="comment" id="4969752">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;,attr&#34;&nbsp;becomes&nbsp;an&nbsp;attribute&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4969816">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;field&nbsp;name&nbsp;in&nbsp;the&nbsp;XML&nbsp;element.</span><br>
<span class="lineno"></span><span class="comment" id="4969856">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;,chardata&#34;&nbsp;is&nbsp;written&nbsp;as&nbsp;character&nbsp;data,</span><br>
<span class="lineno">50</span><span class="comment" id="4969924">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;not&nbsp;as&nbsp;an&nbsp;XML&nbsp;element.</span><br>
<span class="lineno"></span><span class="comment" id="4969956">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;,innerxml&#34;&nbsp;is&nbsp;written&nbsp;verbatim,&nbsp;not&nbsp;subject</span><br>
<span class="lineno"></span><span class="comment" id="4970027">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;the&nbsp;usual&nbsp;marshalling&nbsp;procedure.</span><br>
<span class="lineno"></span><span class="comment" id="4970072">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;,comment&#34;&nbsp;is&nbsp;written&nbsp;as&nbsp;an&nbsp;XML&nbsp;comment,&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="4970143">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subject&nbsp;to&nbsp;the&nbsp;usual&nbsp;marshalling&nbsp;procedure.&nbsp;It&nbsp;must&nbsp;not&nbsp;contain</span><br>
<span class="lineno">55</span><span class="comment" id="4970216">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;&#34;--&#34;&nbsp;string&nbsp;within&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="4970252">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;a&nbsp;tag&nbsp;including&nbsp;the&nbsp;&#34;omitempty&#34;&nbsp;option&nbsp;is&nbsp;omitted</span><br>
<span class="lineno"></span><span class="comment" id="4970324">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;the&nbsp;field&nbsp;value&nbsp;is&nbsp;empty.&nbsp;The&nbsp;empty&nbsp;values&nbsp;are&nbsp;false,&nbsp;0,&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="4970397">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nil&nbsp;pointer&nbsp;or&nbsp;interface&nbsp;value,&nbsp;and&nbsp;any&nbsp;array,&nbsp;slice,&nbsp;map,&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="4970468">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string&nbsp;of&nbsp;length&nbsp;zero.</span><br>
<span class="lineno">60</span><span class="comment" id="4970500">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;an&nbsp;anonymous&nbsp;struct&nbsp;field&nbsp;is&nbsp;handled&nbsp;as&nbsp;if&nbsp;the&nbsp;fields&nbsp;of&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="4970570">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value&nbsp;were&nbsp;part&nbsp;of&nbsp;the&nbsp;outer&nbsp;struct.</span><br>
<span class="lineno"></span><span class="comment" id="4970616">//</span><br>
<span class="lineno"></span><span class="comment" id="4970619">//&nbsp;If&nbsp;a&nbsp;field&nbsp;uses&nbsp;a&nbsp;tag&nbsp;&#34;a&gt;b&gt;c&#34;,&nbsp;then&nbsp;the&nbsp;element&nbsp;c&nbsp;will&nbsp;be&nbsp;nested&nbsp;inside</span><br>
<span class="lineno"></span><span class="comment" id="4970694">//&nbsp;parent&nbsp;elements&nbsp;a&nbsp;and&nbsp;b.&nbsp;&nbsp;Fields&nbsp;that&nbsp;appear&nbsp;next&nbsp;to&nbsp;each&nbsp;other&nbsp;that&nbsp;name</span><br>
<span class="lineno">65</span><span class="comment" id="4970771">//&nbsp;the&nbsp;same&nbsp;parent&nbsp;will&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;one&nbsp;XML&nbsp;element.</span><br>
<span class="lineno"></span><span class="comment" id="4970827">//</span><br>
<span class="lineno"></span><span class="comment" id="4970830">//&nbsp;See&nbsp;MarshalIndent&nbsp;for&nbsp;an&nbsp;example.</span><br>
<span class="lineno"></span><span class="comment" id="4970867">//</span><br>
<span class="lineno"></span><span class="comment" id="4970870">//&nbsp;Marshal&nbsp;will&nbsp;return&nbsp;an&nbsp;error&nbsp;if&nbsp;asked&nbsp;to&nbsp;marshal&nbsp;a&nbsp;channel,&nbsp;function,&nbsp;or&nbsp;map.</span><br>
<span class="lineno">70</span><span class="keyword" id="4970951">func</span>&nbsp;<span class="ident" id="4970956">Marshal</span><span class="op" id="4970963">(</span><span class="ident" id="4970964">v</span>&nbsp;<span class="keyword" id="4970966">interface</span><span class="op" id="4970975">{</span><span class="op" id="4970976">}</span><span class="op" id="4970977">)</span>&nbsp;<span class="op" id="4970979">(</span><span class="op" id="4970980">[</span><span class="op" id="4970981">]</span><span class="builtintype" id="4970982">byte</span><span class="op" id="4970986">,</span>&nbsp;<span class="builtintype" id="4970988">error</span><span class="op" id="4970993">)</span>&nbsp;<span class="op" id="4970995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970998">var</span>&nbsp;<span class="ident" id="4971002">b</span>&nbsp;<span class="ident" id="4971004">bytes</span><span class="op" id="4971009">.</span><span class="ident" id="4971010">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4971018">if</span>&nbsp;<span class="ident" id="4971021">err</span>&nbsp;<span class="op" id="4971025">:=</span>&nbsp;<span class="ident" id="4971028">NewEncoder</span><span class="op" id="4971038">(</span><span class="op" id="4971039">&amp;</span><span class="ident" id="4971040">b</span><span class="op" id="4971041">)</span><span class="op" id="4971042">.</span><span class="ident" id="4971043">Encode</span><span class="op" id="4971049">(</span><span class="ident" id="4971050">v</span><span class="op" id="4971051">)</span><span class="op" id="4971052">;</span>&nbsp;<span class="ident" id="4971054">err</span>&nbsp;<span class="op" id="4971058">!=</span>&nbsp;<span class="ident" id="4971061">nil</span>&nbsp;<span class="op" id="4971065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4971069">return</span>&nbsp;<span class="ident" id="4971076">nil</span><span class="op" id="4971079">,</span>&nbsp;<span class="ident" id="4971081">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4971086">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4971089">return</span>&nbsp;<span class="ident" id="4971096">b</span><span class="op" id="4971097">.</span><span class="ident" id="4971098">Bytes</span><span class="op" id="4971103">(</span><span class="op" id="4971104">)</span><span class="op" id="4971105">,</span>&nbsp;<span class="ident" id="4971107">nil</span><br>
<span class="lineno"></span><span class="op" id="4971111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4971114">//&nbsp;Marshaler&nbsp;is&nbsp;the&nbsp;interface&nbsp;implemented&nbsp;by&nbsp;objects&nbsp;that&nbsp;can&nbsp;marshal</span><br>
<span class="lineno"></span><span class="comment" id="4971184">//&nbsp;themselves&nbsp;into&nbsp;valid&nbsp;XML&nbsp;elements.</span><br>
<span class="lineno">80</span><span class="comment" id="4971223">//</span><br>
<span class="lineno"></span><span class="comment" id="4971226">//&nbsp;MarshalXML&nbsp;encodes&nbsp;the&nbsp;receiver&nbsp;as&nbsp;zero&nbsp;or&nbsp;more&nbsp;XML&nbsp;elements.</span><br>
<span class="lineno"></span><span class="comment" id="4971291">//&nbsp;By&nbsp;convention,&nbsp;arrays&nbsp;or&nbsp;slices&nbsp;are&nbsp;typically&nbsp;encoded&nbsp;as&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="4971362">//&nbsp;of&nbsp;elements,&nbsp;one&nbsp;per&nbsp;entry.</span><br>
<span class="lineno"></span><span class="comment" id="4971393">//&nbsp;Using&nbsp;start&nbsp;as&nbsp;the&nbsp;element&nbsp;tag&nbsp;is&nbsp;not&nbsp;required,&nbsp;but&nbsp;doing&nbsp;so</span><br>
<span class="lineno">85</span><span class="comment" id="4971457">//&nbsp;will&nbsp;enable&nbsp;Unmarshal&nbsp;to&nbsp;match&nbsp;the&nbsp;XML&nbsp;elements&nbsp;to&nbsp;the&nbsp;correct</span><br>
<span class="lineno"></span><span class="comment" id="4971523">//&nbsp;struct&nbsp;field.</span><br>
<span class="lineno"></span><span class="comment" id="4971540">//&nbsp;One&nbsp;common&nbsp;implementation&nbsp;strategy&nbsp;is&nbsp;to&nbsp;construct&nbsp;a&nbsp;separate</span><br>
<span class="lineno"></span><span class="comment" id="4971605">//&nbsp;value&nbsp;with&nbsp;a&nbsp;layout&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;desired&nbsp;XML&nbsp;and&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="4971670">//&nbsp;to&nbsp;encode&nbsp;it&nbsp;using&nbsp;e.EncodeElement.</span><br>
<span class="lineno">90</span><span class="comment" id="4971709">//&nbsp;Another&nbsp;common&nbsp;strategy&nbsp;is&nbsp;to&nbsp;use&nbsp;repeated&nbsp;calls&nbsp;to&nbsp;e.EncodeToken</span><br>
<span class="lineno"></span><span class="comment" id="4971778">//&nbsp;to&nbsp;generate&nbsp;the&nbsp;XML&nbsp;output&nbsp;one&nbsp;token&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="comment" id="4971829">//&nbsp;The&nbsp;sequence&nbsp;of&nbsp;encoded&nbsp;tokens&nbsp;must&nbsp;make&nbsp;up&nbsp;zero&nbsp;or&nbsp;more&nbsp;valid</span><br>
<span class="lineno"></span><span class="comment" id="4971895">//&nbsp;XML&nbsp;elements.</span><br>
<span class="lineno"></span><span class="keyword" id="4971912">type</span>&nbsp;<span class="ident" id="4971917">Marshaler</span>&nbsp;<span class="keyword" id="4971927">interface</span>&nbsp;<span class="op" id="4971937">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971940">MarshalXML</span><span class="op" id="4971950">(</span><span class="ident" id="4971951">e</span>&nbsp;<span class="op" id="4971953">*</span><span class="ident" id="4971954">Encoder</span><span class="op" id="4971961">,</span>&nbsp;<span class="ident" id="4971963">start</span>&nbsp;<span class="ident" id="4971969">StartElement</span><span class="op" id="4971981">)</span>&nbsp;<span class="builtintype" id="4971983">error</span><br>
<span class="lineno"></span><span class="op" id="4971989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4971992">//&nbsp;MarshalerAttr&nbsp;is&nbsp;the&nbsp;interface&nbsp;implemented&nbsp;by&nbsp;objects&nbsp;that&nbsp;can&nbsp;marshal</span><br>
<span class="lineno"></span><span class="comment" id="4972066">//&nbsp;themselves&nbsp;into&nbsp;valid&nbsp;XML&nbsp;attributes.</span><br>
<span class="lineno">100</span><span class="comment" id="4972107">//</span><br>
<span class="lineno"></span><span class="comment" id="4972110">//&nbsp;MarshalXMLAttr&nbsp;returns&nbsp;an&nbsp;XML&nbsp;attribute&nbsp;with&nbsp;the&nbsp;encoded&nbsp;value&nbsp;of&nbsp;the&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="comment" id="4972193">//&nbsp;Using&nbsp;name&nbsp;as&nbsp;the&nbsp;attribute&nbsp;name&nbsp;is&nbsp;not&nbsp;required,&nbsp;but&nbsp;doing&nbsp;so</span><br>
<span class="lineno"></span><span class="comment" id="4972259">//&nbsp;will&nbsp;enable&nbsp;Unmarshal&nbsp;to&nbsp;match&nbsp;the&nbsp;attribute&nbsp;to&nbsp;the&nbsp;correct</span><br>
<span class="lineno"></span><span class="comment" id="4972322">//&nbsp;struct&nbsp;field.</span><br>
<span class="lineno">105</span><span class="comment" id="4972339">//&nbsp;If&nbsp;MarshalXMLAttr&nbsp;returns&nbsp;the&nbsp;zero&nbsp;attribute&nbsp;Attr{},&nbsp;no&nbsp;attribute</span><br>
<span class="lineno"></span><span class="comment" id="4972408">//&nbsp;will&nbsp;be&nbsp;generated&nbsp;in&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="4972444">//&nbsp;MarshalXMLAttr&nbsp;is&nbsp;used&nbsp;only&nbsp;for&nbsp;struct&nbsp;fields&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4972502">//&nbsp;&#34;attr&#34;&nbsp;option&nbsp;in&nbsp;the&nbsp;field&nbsp;tag.</span><br>
<span class="lineno"></span><span class="keyword" id="4972537">type</span>&nbsp;<span class="ident" id="4972542">MarshalerAttr</span>&nbsp;<span class="keyword" id="4972556">interface</span>&nbsp;<span class="op" id="4972566">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972569">MarshalXMLAttr</span><span class="op" id="4972583">(</span><span class="ident" id="4972584">name</span>&nbsp;<span class="ident" id="4972589">Name</span><span class="op" id="4972593">)</span>&nbsp;<span class="op" id="4972595">(</span><span class="ident" id="4972596">Attr</span><span class="op" id="4972600">,</span>&nbsp;<span class="builtintype" id="4972602">error</span><span class="op" id="4972607">)</span><br>
<span class="lineno"></span><span class="op" id="4972609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4972612">//&nbsp;MarshalIndent&nbsp;works&nbsp;like&nbsp;Marshal,&nbsp;but&nbsp;each&nbsp;XML&nbsp;element&nbsp;begins&nbsp;on&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="4972686">//&nbsp;indented&nbsp;line&nbsp;that&nbsp;starts&nbsp;with&nbsp;prefix&nbsp;and&nbsp;is&nbsp;followed&nbsp;by&nbsp;one&nbsp;or&nbsp;more</span><br>
<span class="lineno">115</span><span class="comment" id="4972758">//&nbsp;copies&nbsp;of&nbsp;indent&nbsp;according&nbsp;to&nbsp;the&nbsp;nesting&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="4972810">func</span>&nbsp;<span class="ident" id="4972815">MarshalIndent</span><span class="op" id="4972828">(</span><span class="ident" id="4972829">v</span>&nbsp;<span class="keyword" id="4972831">interface</span><span class="op" id="4972840">{</span><span class="op" id="4972841">}</span><span class="op" id="4972842">,</span>&nbsp;<span class="ident" id="4972844">prefix</span><span class="op" id="4972850">,</span>&nbsp;<span class="ident" id="4972852">indent</span>&nbsp;<span class="builtintype" id="4972859">string</span><span class="op" id="4972865">)</span>&nbsp;<span class="op" id="4972867">(</span><span class="op" id="4972868">[</span><span class="op" id="4972869">]</span><span class="builtintype" id="4972870">byte</span><span class="op" id="4972874">,</span>&nbsp;<span class="builtintype" id="4972876">error</span><span class="op" id="4972881">)</span>&nbsp;<span class="op" id="4972883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4972886">var</span>&nbsp;<span class="ident" id="4972890">b</span>&nbsp;<span class="ident" id="4972892">bytes</span><span class="op" id="4972897">.</span><span class="ident" id="4972898">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972906">enc</span>&nbsp;<span class="op" id="4972910">:=</span>&nbsp;<span class="ident" id="4972913">NewEncoder</span><span class="op" id="4972923">(</span><span class="op" id="4972924">&amp;</span><span class="ident" id="4972925">b</span><span class="op" id="4972926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972929">enc</span><span class="op" id="4972932">.</span><span class="ident" id="4972933">Indent</span><span class="op" id="4972939">(</span><span class="ident" id="4972940">prefix</span><span class="op" id="4972946">,</span>&nbsp;<span class="ident" id="4972948">indent</span><span class="op" id="4972954">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4972957">if</span>&nbsp;<span class="ident" id="4972960">err</span>&nbsp;<span class="op" id="4972964">:=</span>&nbsp;<span class="ident" id="4972967">enc</span><span class="op" id="4972970">.</span><span class="ident" id="4972971">Encode</span><span class="op" id="4972977">(</span><span class="ident" id="4972978">v</span><span class="op" id="4972979">)</span><span class="op" id="4972980">;</span>&nbsp;<span class="ident" id="4972982">err</span>&nbsp;<span class="op" id="4972986">!=</span>&nbsp;<span class="ident" id="4972989">nil</span>&nbsp;<span class="op" id="4972993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4972997">return</span>&nbsp;<span class="ident" id="4973004">nil</span><span class="op" id="4973007">,</span>&nbsp;<span class="ident" id="4973009">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4973014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4973017">return</span>&nbsp;<span class="ident" id="4973024">b</span><span class="op" id="4973025">.</span><span class="ident" id="4973026">Bytes</span><span class="op" id="4973031">(</span><span class="op" id="4973032">)</span><span class="op" id="4973033">,</span>&nbsp;<span class="ident" id="4973035">nil</span><br>
<span class="lineno"></span><span class="op" id="4973039">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="comment" id="4973042">//&nbsp;An&nbsp;Encoder&nbsp;writes&nbsp;XML&nbsp;data&nbsp;to&nbsp;an&nbsp;output&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="4973093">type</span>&nbsp;<span class="ident" id="4973098">Encoder</span>&nbsp;<span class="keyword" id="4973106">struct</span>&nbsp;<span class="op" id="4973113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973116">p</span>&nbsp;<span class="ident" id="4973118">printer</span><br>
<span class="lineno"></span><span class="op" id="4973126">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="4973129">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;encoder&nbsp;that&nbsp;writes&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4973183">func</span>&nbsp;<span class="ident" id="4973188">NewEncoder</span><span class="op" id="4973198">(</span><span class="ident" id="4973199">w</span>&nbsp;<span class="ident" id="4973201">io</span><span class="op" id="4973203">.</span><span class="ident" id="4973204">Writer</span><span class="op" id="4973210">)</span>&nbsp;<span class="op" id="4973212">*</span><span class="ident" id="4973213">Encoder</span>&nbsp;<span class="op" id="4973221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973224">e</span>&nbsp;<span class="op" id="4973226">:=</span>&nbsp;<span class="op" id="4973229">&amp;</span><span class="ident" id="4973230">Encoder</span><span class="op" id="4973237">{</span><span class="ident" id="4973238">printer</span><span class="op" id="4973245">{</span><span class="ident" id="4973246">Writer</span><span class="op" id="4973252">:</span>&nbsp;<span class="ident" id="4973254">bufio</span><span class="op" id="4973259">.</span><span class="ident" id="4973260">NewWriter</span><span class="op" id="4973269">(</span><span class="ident" id="4973270">w</span><span class="op" id="4973271">)</span><span class="op" id="4973272">}</span><span class="op" id="4973273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973276">e</span><span class="op" id="4973277">.</span><span class="ident" id="4973278">p</span><span class="op" id="4973279">.</span><span class="ident" id="4973280">encoder</span>&nbsp;<span class="op" id="4973288">=</span>&nbsp;<span class="ident" id="4973290">e</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4973293">return</span>&nbsp;<span class="ident" id="4973300">e</span><br>
<span class="lineno"></span><span class="op" id="4973302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4973305">//&nbsp;Indent&nbsp;sets&nbsp;the&nbsp;encoder&nbsp;to&nbsp;generate&nbsp;XML&nbsp;in&nbsp;which&nbsp;each&nbsp;element</span><br>
<span class="lineno"></span><span class="comment" id="4973370">//&nbsp;begins&nbsp;on&nbsp;a&nbsp;new&nbsp;indented&nbsp;line&nbsp;that&nbsp;starts&nbsp;with&nbsp;prefix&nbsp;and&nbsp;is&nbsp;followed&nbsp;by</span><br>
<span class="lineno">140</span><span class="comment" id="4973446">//&nbsp;one&nbsp;or&nbsp;more&nbsp;copies&nbsp;of&nbsp;indent&nbsp;according&nbsp;to&nbsp;the&nbsp;nesting&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="4973510">func</span>&nbsp;<span class="op" id="4973515">(</span><span class="ident" id="4973516">enc</span>&nbsp;<span class="op" id="4973520">*</span><span class="ident" id="4973521">Encoder</span><span class="op" id="4973528">)</span>&nbsp;<span class="ident" id="4973530">Indent</span><span class="op" id="4973536">(</span><span class="ident" id="4973537">prefix</span><span class="op" id="4973543">,</span>&nbsp;<span class="ident" id="4973545">indent</span>&nbsp;<span class="builtintype" id="4973552">string</span><span class="op" id="4973558">)</span>&nbsp;<span class="op" id="4973560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973563">enc</span><span class="op" id="4973566">.</span><span class="ident" id="4973567">p</span><span class="op" id="4973568">.</span><span class="ident" id="4973569">prefix</span>&nbsp;<span class="op" id="4973576">=</span>&nbsp;<span class="ident" id="4973578">prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973586">enc</span><span class="op" id="4973589">.</span><span class="ident" id="4973590">p</span><span class="op" id="4973591">.</span><span class="ident" id="4973592">indent</span>&nbsp;<span class="op" id="4973599">=</span>&nbsp;<span class="ident" id="4973601">indent</span><br>
<span class="lineno"></span><span class="op" id="4973608">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="4973611">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;XML&nbsp;encoding&nbsp;of&nbsp;v&nbsp;to&nbsp;the&nbsp;stream.</span><br>
<span class="lineno"></span><span class="comment" id="4973665">//</span><br>
<span class="lineno"></span><span class="comment" id="4973668">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Marshal&nbsp;for&nbsp;details&nbsp;about&nbsp;the&nbsp;conversion</span><br>
<span class="lineno"></span><span class="comment" id="4973738">//&nbsp;of&nbsp;Go&nbsp;values&nbsp;to&nbsp;XML.</span><br>
<span class="lineno">150</span><span class="comment" id="4973762">//</span><br>
<span class="lineno"></span><span class="comment" id="4973765">//&nbsp;Encode&nbsp;calls&nbsp;Flush&nbsp;before&nbsp;returning.</span><br>
<span class="lineno"></span><span class="keyword" id="4973805">func</span>&nbsp;<span class="op" id="4973810">(</span><span class="ident" id="4973811">enc</span>&nbsp;<span class="op" id="4973815">*</span><span class="ident" id="4973816">Encoder</span><span class="op" id="4973823">)</span>&nbsp;<span class="ident" id="4973825">Encode</span><span class="op" id="4973831">(</span><span class="ident" id="4973832">v</span>&nbsp;<span class="keyword" id="4973834">interface</span><span class="op" id="4973843">{</span><span class="op" id="4973844">}</span><span class="op" id="4973845">)</span>&nbsp;<span class="builtintype" id="4973847">error</span>&nbsp;<span class="op" id="4973853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973856">err</span>&nbsp;<span class="op" id="4973860">:=</span>&nbsp;<span class="ident" id="4973863">enc</span><span class="op" id="4973866">.</span><span class="ident" id="4973867">p</span><span class="op" id="4973868">.</span><span class="ident" id="4973869">marshalValue</span><span class="op" id="4973881">(</span><span class="ident" id="4973882">reflect</span><span class="op" id="4973889">.</span><span class="ident" id="4973890">ValueOf</span><span class="op" id="4973897">(</span><span class="ident" id="4973898">v</span><span class="op" id="4973899">)</span><span class="op" id="4973900">,</span>&nbsp;<span class="ident" id="4973902">nil</span><span class="op" id="4973905">,</span>&nbsp;<span class="ident" id="4973907">nil</span><span class="op" id="4973910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4973913">if</span>&nbsp;<span class="ident" id="4973916">err</span>&nbsp;<span class="op" id="4973920">!=</span>&nbsp;<span class="ident" id="4973923">nil</span>&nbsp;<span class="op" id="4973927">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4973931">return</span>&nbsp;<span class="ident" id="4973938">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4973943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4973946">return</span>&nbsp;<span class="ident" id="4973953">enc</span><span class="op" id="4973956">.</span><span class="ident" id="4973957">p</span><span class="op" id="4973958">.</span><span class="ident" id="4973959">Flush</span><span class="op" id="4973964">(</span><span class="op" id="4973965">)</span><br>
<span class="lineno"></span><span class="op" id="4973967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="4973970">//&nbsp;EncodeElement&nbsp;writes&nbsp;the&nbsp;XML&nbsp;encoding&nbsp;of&nbsp;v&nbsp;to&nbsp;the&nbsp;stream,</span><br>
<span class="lineno"></span><span class="comment" id="4974031">//&nbsp;using&nbsp;start&nbsp;as&nbsp;the&nbsp;outermost&nbsp;tag&nbsp;in&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="comment" id="4974084">//</span><br>
<span class="lineno"></span><span class="comment" id="4974087">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Marshal&nbsp;for&nbsp;details&nbsp;about&nbsp;the&nbsp;conversion</span><br>
<span class="lineno"></span><span class="comment" id="4974157">//&nbsp;of&nbsp;Go&nbsp;values&nbsp;to&nbsp;XML.</span><br>
<span class="lineno">165</span><span class="comment" id="4974181">//</span><br>
<span class="lineno"></span><span class="comment" id="4974184">//&nbsp;EncodeElement&nbsp;calls&nbsp;Flush&nbsp;before&nbsp;returning.</span><br>
<span class="lineno"></span><span class="keyword" id="4974231">func</span>&nbsp;<span class="op" id="4974236">(</span><span class="ident" id="4974237">enc</span>&nbsp;<span class="op" id="4974241">*</span><span class="ident" id="4974242">Encoder</span><span class="op" id="4974249">)</span>&nbsp;<span class="ident" id="4974251">EncodeElement</span><span class="op" id="4974264">(</span><span class="ident" id="4974265">v</span>&nbsp;<span class="keyword" id="4974267">interface</span><span class="op" id="4974276">{</span><span class="op" id="4974277">}</span><span class="op" id="4974278">,</span>&nbsp;<span class="ident" id="4974280">start</span>&nbsp;<span class="ident" id="4974286">StartElement</span><span class="op" id="4974298">)</span>&nbsp;<span class="builtintype" id="4974300">error</span>&nbsp;<span class="op" id="4974306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4974309">err</span>&nbsp;<span class="op" id="4974313">:=</span>&nbsp;<span class="ident" id="4974316">enc</span><span class="op" id="4974319">.</span><span class="ident" id="4974320">p</span><span class="op" id="4974321">.</span><span class="ident" id="4974322">marshalValue</span><span class="op" id="4974334">(</span><span class="ident" id="4974335">reflect</span><span class="op" id="4974342">.</span><span class="ident" id="4974343">ValueOf</span><span class="op" id="4974350">(</span><span class="ident" id="4974351">v</span><span class="op" id="4974352">)</span><span class="op" id="4974353">,</span>&nbsp;<span class="ident" id="4974355">nil</span><span class="op" id="4974358">,</span>&nbsp;<span class="op" id="4974360">&amp;</span><span class="ident" id="4974361">start</span><span class="op" id="4974366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4974369">if</span>&nbsp;<span class="ident" id="4974372">err</span>&nbsp;<span class="op" id="4974376">!=</span>&nbsp;<span class="ident" id="4974379">nil</span>&nbsp;<span class="op" id="4974383">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4974387">return</span>&nbsp;<span class="ident" id="4974394">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4974399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4974402">return</span>&nbsp;<span class="ident" id="4974409">enc</span><span class="op" id="4974412">.</span><span class="ident" id="4974413">p</span><span class="op" id="4974414">.</span><span class="ident" id="4974415">Flush</span><span class="op" id="4974420">(</span><span class="op" id="4974421">)</span><br>
<span class="lineno"></span><span class="op" id="4974423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="4974426">var</span>&nbsp;<span class="op" id="4974430">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4974433">endComment</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4974446">=</span>&nbsp;<span class="op" id="4974448">[</span><span class="op" id="4974449">]</span><span class="builtintype" id="4974450">byte</span><span class="op" id="4974454">(</span><span class="string" id="4974455">&#34;--&gt;&#34;</span><span class="op" id="4974460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4974463">endProcInst</span>&nbsp;&nbsp;<span class="op" id="4974476">=</span>&nbsp;<span class="op" id="4974478">[</span><span class="op" id="4974479">]</span><span class="builtintype" id="4974480">byte</span><span class="op" id="4974484">(</span><span class="string" id="4974485">&#34;?&gt;&#34;</span><span class="op" id="4974489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4974492">endDirective</span>&nbsp;<span class="op" id="4974505">=</span>&nbsp;<span class="op" id="4974507">[</span><span class="op" id="4974508">]</span><span class="builtintype" id="4974509">byte</span><span class="op" id="4974513">(</span><span class="string" id="4974514">&#34;&gt;&#34;</span><span class="op" id="4974517">)</span><br>
<span class="lineno"></span><span class="op" id="4974519">)</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="comment" id="4974522">//&nbsp;EncodeToken&nbsp;writes&nbsp;the&nbsp;given&nbsp;XML&nbsp;token&nbsp;to&nbsp;the&nbsp;stream.</span><br>
<span class="lineno"></span><span class="comment" id="4974579">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;StartElement&nbsp;and&nbsp;EndElement&nbsp;tokens&nbsp;are&nbsp;not&nbsp;properly&nbsp;matched.</span><br>
<span class="lineno"></span><span class="comment" id="4974666">//</span><br>
<span class="lineno"></span><span class="comment" id="4974669">//&nbsp;EncodeToken&nbsp;does&nbsp;not&nbsp;call&nbsp;Flush,&nbsp;because&nbsp;usually&nbsp;it&nbsp;is&nbsp;part&nbsp;of&nbsp;a&nbsp;larger&nbsp;operation</span><br>
<span class="lineno">185</span><span class="comment" id="4974754">//&nbsp;such&nbsp;as&nbsp;Encode&nbsp;or&nbsp;EncodeElement&nbsp;(or&nbsp;a&nbsp;custom&nbsp;Marshaler&#39;s&nbsp;MarshalXML&nbsp;invoked</span><br>
<span class="lineno"></span><span class="comment" id="4974833">//&nbsp;during&nbsp;those),&nbsp;and&nbsp;those&nbsp;will&nbsp;call&nbsp;Flush&nbsp;when&nbsp;finished.</span><br>
<span class="lineno"></span><span class="comment" id="4974892">//&nbsp;Callers&nbsp;that&nbsp;create&nbsp;an&nbsp;Encoder&nbsp;and&nbsp;then&nbsp;invoke&nbsp;EncodeToken&nbsp;directly,&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="4974972">//&nbsp;using&nbsp;Encode&nbsp;or&nbsp;EncodeElement,&nbsp;need&nbsp;to&nbsp;call&nbsp;Flush&nbsp;when&nbsp;finished&nbsp;to&nbsp;ensure</span><br>
<span class="lineno"></span><span class="comment" id="4975049">//&nbsp;that&nbsp;the&nbsp;XML&nbsp;is&nbsp;written&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno">190</span><span class="comment" id="4975102">//</span><br>
<span class="lineno"></span><span class="comment" id="4975105">//&nbsp;EncodeToken&nbsp;allows&nbsp;writing&nbsp;a&nbsp;ProcInst&nbsp;with&nbsp;Target&nbsp;set&nbsp;to&nbsp;&#34;xml&#34;&nbsp;only&nbsp;as&nbsp;the&nbsp;first&nbsp;token</span><br>
<span class="lineno"></span><span class="comment" id="4975195">//&nbsp;in&nbsp;the&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="4975213">func</span>&nbsp;<span class="op" id="4975218">(</span><span class="ident" id="4975219">enc</span>&nbsp;<span class="op" id="4975223">*</span><span class="ident" id="4975224">Encoder</span><span class="op" id="4975231">)</span>&nbsp;<span class="ident" id="4975233">EncodeToken</span><span class="op" id="4975244">(</span><span class="ident" id="4975245">t</span>&nbsp;<span class="ident" id="4975247">Token</span><span class="op" id="4975252">)</span>&nbsp;<span class="builtintype" id="4975254">error</span>&nbsp;<span class="op" id="4975260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975263">p</span>&nbsp;<span class="op" id="4975265">:=</span>&nbsp;<span class="op" id="4975268">&amp;</span><span class="ident" id="4975269">enc</span><span class="op" id="4975272">.</span><span class="ident" id="4975273">p</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975276">switch</span>&nbsp;<span class="ident" id="4975283">t</span>&nbsp;<span class="op" id="4975285">:=</span>&nbsp;<span class="ident" id="4975288">t</span><span class="op" id="4975289">.</span><span class="op" id="4975290">(</span><span class="keyword" id="4975291">type</span><span class="op" id="4975295">)</span>&nbsp;<span class="op" id="4975297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975300">case</span>&nbsp;<span class="ident" id="4975305">StartElement</span><span class="op" id="4975317">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975321">if</span>&nbsp;<span class="ident" id="4975324">err</span>&nbsp;<span class="op" id="4975328">:=</span>&nbsp;<span class="ident" id="4975331">p</span><span class="op" id="4975332">.</span><span class="ident" id="4975333">writeStart</span><span class="op" id="4975343">(</span><span class="op" id="4975344">&amp;</span><span class="ident" id="4975345">t</span><span class="op" id="4975346">)</span><span class="op" id="4975347">;</span>&nbsp;<span class="ident" id="4975349">err</span>&nbsp;<span class="op" id="4975353">!=</span>&nbsp;<span class="ident" id="4975356">nil</span>&nbsp;<span class="op" id="4975360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975365">return</span>&nbsp;<span class="ident" id="4975372">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4975378">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975381">case</span>&nbsp;<span class="ident" id="4975386">EndElement</span><span class="op" id="4975396">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975400">if</span>&nbsp;<span class="ident" id="4975403">err</span>&nbsp;<span class="op" id="4975407">:=</span>&nbsp;<span class="ident" id="4975410">p</span><span class="op" id="4975411">.</span><span class="ident" id="4975412">writeEnd</span><span class="op" id="4975420">(</span><span class="ident" id="4975421">t</span><span class="op" id="4975422">.</span><span class="ident" id="4975423">Name</span><span class="op" id="4975427">)</span><span class="op" id="4975428">;</span>&nbsp;<span class="ident" id="4975430">err</span>&nbsp;<span class="op" id="4975434">!=</span>&nbsp;<span class="ident" id="4975437">nil</span>&nbsp;<span class="op" id="4975441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975446">return</span>&nbsp;<span class="ident" id="4975453">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4975459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975462">case</span>&nbsp;<span class="ident" id="4975467">CharData</span><span class="op" id="4975475">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975479">EscapeText</span><span class="op" id="4975489">(</span><span class="ident" id="4975490">p</span><span class="op" id="4975491">,</span>&nbsp;<span class="ident" id="4975493">t</span><span class="op" id="4975494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975497">case</span>&nbsp;<span class="ident" id="4975502">Comment</span><span class="op" id="4975509">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975513">if</span>&nbsp;<span class="ident" id="4975516">bytes</span><span class="op" id="4975521">.</span><span class="ident" id="4975522">Contains</span><span class="op" id="4975530">(</span><span class="ident" id="4975531">t</span><span class="op" id="4975532">,</span>&nbsp;<span class="ident" id="4975534">endComment</span><span class="op" id="4975544">)</span>&nbsp;<span class="op" id="4975546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975551">return</span>&nbsp;<span class="ident" id="4975558">fmt</span><span class="op" id="4975561">.</span><span class="ident" id="4975562">Errorf</span><span class="op" id="4975568">(</span><span class="string" id="4975569">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;Comment&nbsp;containing&nbsp;--&gt;&nbsp;marker&#34;</span><span class="op" id="4975620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4975624">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975628">p</span><span class="op" id="4975629">.</span><span class="ident" id="4975630">WriteString</span><span class="op" id="4975641">(</span><span class="string" id="4975642">&#34;&lt;!--&#34;</span><span class="op" id="4975648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975652">p</span><span class="op" id="4975653">.</span><span class="ident" id="4975654">Write</span><span class="op" id="4975659">(</span><span class="ident" id="4975660">t</span><span class="op" id="4975661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975665">p</span><span class="op" id="4975666">.</span><span class="ident" id="4975667">WriteString</span><span class="op" id="4975678">(</span><span class="string" id="4975679">&#34;--&gt;&#34;</span><span class="op" id="4975684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975688">return</span>&nbsp;<span class="ident" id="4975695">p</span><span class="op" id="4975696">.</span><span class="ident" id="4975697">cachedWriteError</span><span class="op" id="4975713">(</span><span class="op" id="4975714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975717">case</span>&nbsp;<span class="ident" id="4975722">ProcInst</span><span class="op" id="4975730">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4975734">//&nbsp;First&nbsp;token&nbsp;to&nbsp;be&nbsp;encoded&nbsp;which&nbsp;is&nbsp;also&nbsp;a&nbsp;ProcInst&nbsp;with&nbsp;target&nbsp;of&nbsp;xml</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4975809">//&nbsp;is&nbsp;the&nbsp;xml&nbsp;declaration.&nbsp;&nbsp;The&nbsp;only&nbsp;ProcInst&nbsp;where&nbsp;target&nbsp;of&nbsp;xml&nbsp;is&nbsp;allowed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975889">if</span>&nbsp;<span class="ident" id="4975892">t</span><span class="op" id="4975893">.</span><span class="ident" id="4975894">Target</span>&nbsp;<span class="op" id="4975901">==</span>&nbsp;<span class="string" id="4975904">&#34;xml&#34;</span>&nbsp;<span class="op" id="4975910">&amp;&amp;</span>&nbsp;<span class="ident" id="4975913">p</span><span class="op" id="4975914">.</span><span class="ident" id="4975915">Buffered</span><span class="op" id="4975923">(</span><span class="op" id="4975924">)</span>&nbsp;<span class="op" id="4975926">!=</span>&nbsp;<span class="num" id="4975929">0</span>&nbsp;<span class="op" id="4975931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975936">return</span>&nbsp;<span class="ident" id="4975943">fmt</span><span class="op" id="4975946">.</span><span class="ident" id="4975947">Errorf</span><span class="op" id="4975953">(</span><span class="string" id="4975954">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;ProcInst&nbsp;xml&nbsp;target&nbsp;only&nbsp;valid&nbsp;for&nbsp;xml&nbsp;declaration,&nbsp;first&nbsp;token&nbsp;encoded&#34;</span><span class="op" id="4976047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976051">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976055">if</span>&nbsp;<span class="op" id="4976058">!</span><span class="ident" id="4976059">isNameString</span><span class="op" id="4976071">(</span><span class="ident" id="4976072">t</span><span class="op" id="4976073">.</span><span class="ident" id="4976074">Target</span><span class="op" id="4976080">)</span>&nbsp;<span class="op" id="4976082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976087">return</span>&nbsp;<span class="ident" id="4976094">fmt</span><span class="op" id="4976097">.</span><span class="ident" id="4976098">Errorf</span><span class="op" id="4976104">(</span><span class="string" id="4976105">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;ProcInst&nbsp;with&nbsp;invalid&nbsp;Target&#34;</span><span class="op" id="4976155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976163">if</span>&nbsp;<span class="ident" id="4976166">bytes</span><span class="op" id="4976171">.</span><span class="ident" id="4976172">Contains</span><span class="op" id="4976180">(</span><span class="ident" id="4976181">t</span><span class="op" id="4976182">.</span><span class="ident" id="4976183">Inst</span><span class="op" id="4976187">,</span>&nbsp;<span class="ident" id="4976189">endProcInst</span><span class="op" id="4976200">)</span>&nbsp;<span class="op" id="4976202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976207">return</span>&nbsp;<span class="ident" id="4976214">fmt</span><span class="op" id="4976217">.</span><span class="ident" id="4976218">Errorf</span><span class="op" id="4976224">(</span><span class="string" id="4976225">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;ProcInst&nbsp;containing&nbsp;?&gt;&nbsp;marker&#34;</span><span class="op" id="4976276">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976284">p</span><span class="op" id="4976285">.</span><span class="ident" id="4976286">WriteString</span><span class="op" id="4976297">(</span><span class="string" id="4976298">&#34;&lt;?&#34;</span><span class="op" id="4976302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976306">p</span><span class="op" id="4976307">.</span><span class="ident" id="4976308">WriteString</span><span class="op" id="4976319">(</span><span class="ident" id="4976320">t</span><span class="op" id="4976321">.</span><span class="ident" id="4976322">Target</span><span class="op" id="4976328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976332">if</span>&nbsp;<span class="builtinfunc" id="4976335">len</span><span class="op" id="4976338">(</span><span class="ident" id="4976339">t</span><span class="op" id="4976340">.</span><span class="ident" id="4976341">Inst</span><span class="op" id="4976345">)</span>&nbsp;<span class="op" id="4976347">&gt;</span>&nbsp;<span class="num" id="4976349">0</span>&nbsp;<span class="op" id="4976351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976356">p</span><span class="op" id="4976357">.</span><span class="ident" id="4976358">WriteByte</span><span class="op" id="4976367">(</span><span class="string" id="4976368">&#39;&nbsp;&#39;</span><span class="op" id="4976371">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976376">p</span><span class="op" id="4976377">.</span><span class="ident" id="4976378">Write</span><span class="op" id="4976383">(</span><span class="ident" id="4976384">t</span><span class="op" id="4976385">.</span><span class="ident" id="4976386">Inst</span><span class="op" id="4976390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976398">p</span><span class="op" id="4976399">.</span><span class="ident" id="4976400">WriteString</span><span class="op" id="4976411">(</span><span class="string" id="4976412">&#34;?&gt;&#34;</span><span class="op" id="4976416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976419">case</span>&nbsp;<span class="ident" id="4976424">Directive</span><span class="op" id="4976433">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976437">if</span>&nbsp;<span class="ident" id="4976440">bytes</span><span class="op" id="4976445">.</span><span class="ident" id="4976446">Contains</span><span class="op" id="4976454">(</span><span class="ident" id="4976455">t</span><span class="op" id="4976456">,</span>&nbsp;<span class="ident" id="4976458">endDirective</span><span class="op" id="4976470">)</span>&nbsp;<span class="op" id="4976472">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976477">return</span>&nbsp;<span class="ident" id="4976484">fmt</span><span class="op" id="4976487">.</span><span class="ident" id="4976488">Errorf</span><span class="op" id="4976494">(</span><span class="string" id="4976495">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;Directive&nbsp;containing&nbsp;&gt;&nbsp;marker&#34;</span><span class="op" id="4976546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976554">p</span><span class="op" id="4976555">.</span><span class="ident" id="4976556">WriteString</span><span class="op" id="4976567">(</span><span class="string" id="4976568">&#34;&lt;!&#34;</span><span class="op" id="4976572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976576">p</span><span class="op" id="4976577">.</span><span class="ident" id="4976578">Write</span><span class="op" id="4976583">(</span><span class="ident" id="4976584">t</span><span class="op" id="4976585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976589">p</span><span class="op" id="4976590">.</span><span class="ident" id="4976591">WriteString</span><span class="op" id="4976602">(</span><span class="string" id="4976603">&#34;&gt;&#34;</span><span class="op" id="4976606">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976612">return</span>&nbsp;<span class="ident" id="4976619">p</span><span class="op" id="4976620">.</span><span class="ident" id="4976621">cachedWriteError</span><span class="op" id="4976637">(</span><span class="op" id="4976638">)</span><br>
<span class="lineno"></span><span class="op" id="4976640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4976643">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;buffered&nbsp;XML&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno">245</span><span class="comment" id="4976703">//&nbsp;See&nbsp;the&nbsp;EncodeToken&nbsp;documentation&nbsp;for&nbsp;details&nbsp;about&nbsp;when&nbsp;it&nbsp;is&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="4976780">func</span>&nbsp;<span class="op" id="4976785">(</span><span class="ident" id="4976786">enc</span>&nbsp;<span class="op" id="4976790">*</span><span class="ident" id="4976791">Encoder</span><span class="op" id="4976798">)</span>&nbsp;<span class="ident" id="4976800">Flush</span><span class="op" id="4976805">(</span><span class="op" id="4976806">)</span>&nbsp;<span class="builtintype" id="4976808">error</span>&nbsp;<span class="op" id="4976814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976817">return</span>&nbsp;<span class="ident" id="4976824">enc</span><span class="op" id="4976827">.</span><span class="ident" id="4976828">p</span><span class="op" id="4976829">.</span><span class="ident" id="4976830">Flush</span><span class="op" id="4976835">(</span><span class="op" id="4976836">)</span><br>
<span class="lineno"></span><span class="op" id="4976838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="4976841">type</span>&nbsp;<span class="ident" id="4976846">printer</span>&nbsp;<span class="keyword" id="4976854">struct</span>&nbsp;<span class="op" id="4976861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976864">*</span><span class="ident" id="4976865">bufio</span><span class="op" id="4976870">.</span><span class="ident" id="4976871">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976879">encoder</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4976890">*</span><span class="ident" id="4976891">Encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976900">seq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4976911">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976916">indent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4976927">string</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976935">prefix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4976946">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976954">depth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4976965">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976970">indentedIn</span>&nbsp;<span class="builtintype" id="4976981">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976987">putNewline</span>&nbsp;<span class="builtintype" id="4976998">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977004">attrNS</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4977015">map</span><span class="op" id="4977018">[</span><span class="builtintype" id="4977019">string</span><span class="op" id="4977025">]</span><span class="builtintype" id="4977026">string</span>&nbsp;<span class="comment" id="4977033">//&nbsp;map&nbsp;prefix&nbsp;-&gt;&nbsp;name&nbsp;space</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977062">attrPrefix</span>&nbsp;<span class="keyword" id="4977073">map</span><span class="op" id="4977076">[</span><span class="builtintype" id="4977077">string</span><span class="op" id="4977083">]</span><span class="builtintype" id="4977084">string</span>&nbsp;<span class="comment" id="4977091">//&nbsp;map&nbsp;name&nbsp;space&nbsp;-&gt;&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977120">prefixes</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4977131">[</span><span class="op" id="4977132">]</span><span class="builtintype" id="4977133">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977141">tags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4977152">[</span><span class="op" id="4977153">]</span><span class="ident" id="4977154">Name</span><br>
<span class="lineno"></span><span class="op" id="4977159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span><span class="comment" id="4977162">//&nbsp;createAttrPrefix&nbsp;finds&nbsp;the&nbsp;name&nbsp;space&nbsp;prefix&nbsp;attribute&nbsp;to&nbsp;use&nbsp;for&nbsp;the&nbsp;given&nbsp;name&nbsp;space,</span><br>
<span class="lineno"></span><span class="comment" id="4977253">//&nbsp;defining&nbsp;a&nbsp;new&nbsp;prefix&nbsp;if&nbsp;necessary.&nbsp;It&nbsp;returns&nbsp;the&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="4977315">func</span>&nbsp;<span class="op" id="4977320">(</span><span class="ident" id="4977321">p</span>&nbsp;<span class="op" id="4977323">*</span><span class="ident" id="4977324">printer</span><span class="op" id="4977331">)</span>&nbsp;<span class="ident" id="4977333">createAttrPrefix</span><span class="op" id="4977349">(</span><span class="ident" id="4977350">url</span>&nbsp;<span class="builtintype" id="4977354">string</span><span class="op" id="4977360">)</span>&nbsp;<span class="builtintype" id="4977362">string</span>&nbsp;<span class="op" id="4977369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977372">if</span>&nbsp;<span class="ident" id="4977375">prefix</span>&nbsp;<span class="op" id="4977382">:=</span>&nbsp;<span class="ident" id="4977385">p</span><span class="op" id="4977386">.</span><span class="ident" id="4977387">attrPrefix</span><span class="op" id="4977397">[</span><span class="ident" id="4977398">url</span><span class="op" id="4977401">]</span><span class="op" id="4977402">;</span>&nbsp;<span class="ident" id="4977404">prefix</span>&nbsp;<span class="op" id="4977411">!=</span>&nbsp;<span class="string" id="4977414">&#34;&#34;</span>&nbsp;<span class="op" id="4977417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977421">return</span>&nbsp;<span class="ident" id="4977428">prefix</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4977436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4977440">//&nbsp;The&nbsp;&#34;http://www.w3.org/XML/1998/namespace&#34;&nbsp;name&nbsp;space&nbsp;is&nbsp;predefined&nbsp;as&nbsp;&#34;xml&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4977521">//&nbsp;and&nbsp;must&nbsp;be&nbsp;referred&nbsp;to&nbsp;that&nbsp;way.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4977559">//&nbsp;(The&nbsp;&#34;http://www.w3.org/2000/xmlns/&#34;&nbsp;name&nbsp;space&nbsp;is&nbsp;also&nbsp;predefined&nbsp;as&nbsp;&#34;xmlns&#34;,</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4977642">//&nbsp;but&nbsp;users&nbsp;should&nbsp;not&nbsp;be&nbsp;trying&nbsp;to&nbsp;use&nbsp;that&nbsp;one&nbsp;directly&nbsp;-&nbsp;that&#39;s&nbsp;our&nbsp;job.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977721">if</span>&nbsp;<span class="ident" id="4977724">url</span>&nbsp;<span class="op" id="4977728">==</span>&nbsp;<span class="ident" id="4977731">xmlURL</span>&nbsp;<span class="op" id="4977738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977742">return</span>&nbsp;<span class="string" id="4977749">&#34;xml&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4977756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4977760">//&nbsp;Need&nbsp;to&nbsp;define&nbsp;a&nbsp;new&nbsp;name&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977797">if</span>&nbsp;<span class="ident" id="4977800">p</span><span class="op" id="4977801">.</span><span class="ident" id="4977802">attrPrefix</span>&nbsp;<span class="op" id="4977813">==</span>&nbsp;<span class="ident" id="4977816">nil</span>&nbsp;<span class="op" id="4977820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977824">p</span><span class="op" id="4977825">.</span><span class="ident" id="4977826">attrPrefix</span>&nbsp;<span class="op" id="4977837">=</span>&nbsp;<span class="builtinfunc" id="4977839">make</span><span class="op" id="4977843">(</span><span class="keyword" id="4977844">map</span><span class="op" id="4977847">[</span><span class="builtintype" id="4977848">string</span><span class="op" id="4977854">]</span><span class="builtintype" id="4977855">string</span><span class="op" id="4977861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977865">p</span><span class="op" id="4977866">.</span><span class="ident" id="4977867">attrNS</span>&nbsp;<span class="op" id="4977874">=</span>&nbsp;<span class="builtinfunc" id="4977876">make</span><span class="op" id="4977880">(</span><span class="keyword" id="4977881">map</span><span class="op" id="4977884">[</span><span class="builtintype" id="4977885">string</span><span class="op" id="4977891">]</span><span class="builtintype" id="4977892">string</span><span class="op" id="4977898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4977901">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4977905">//&nbsp;Pick&nbsp;a&nbsp;name.&nbsp;We&nbsp;try&nbsp;to&nbsp;use&nbsp;the&nbsp;final&nbsp;element&nbsp;of&nbsp;the&nbsp;path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4977966">//&nbsp;but&nbsp;fall&nbsp;back&nbsp;to&nbsp;_.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977990">prefix</span>&nbsp;<span class="op" id="4977997">:=</span>&nbsp;<span class="ident" id="4978000">strings</span><span class="op" id="4978007">.</span><span class="ident" id="4978008">TrimRight</span><span class="op" id="4978017">(</span><span class="ident" id="4978018">url</span><span class="op" id="4978021">,</span>&nbsp;<span class="string" id="4978023">&#34;/&#34;</span><span class="op" id="4978026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4978029">if</span>&nbsp;<span class="ident" id="4978032">i</span>&nbsp;<span class="op" id="4978034">:=</span>&nbsp;<span class="ident" id="4978037">strings</span><span class="op" id="4978044">.</span><span class="ident" id="4978045">LastIndex</span><span class="op" id="4978054">(</span><span class="ident" id="4978055">prefix</span><span class="op" id="4978061">,</span>&nbsp;<span class="string" id="4978063">&#34;/&#34;</span><span class="op" id="4978066">)</span><span class="op" id="4978067">;</span>&nbsp;<span class="ident" id="4978069">i</span>&nbsp;<span class="op" id="4978071">&gt;=</span>&nbsp;<span class="num" id="4978074">0</span>&nbsp;<span class="op" id="4978076">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978080">prefix</span>&nbsp;<span class="op" id="4978087">=</span>&nbsp;<span class="ident" id="4978089">prefix</span><span class="op" id="4978095">[</span><span class="ident" id="4978096">i</span><span class="op" id="4978097">+</span><span class="num" id="4978098">1</span><span class="op" id="4978099">:</span><span class="op" id="4978100">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4978103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4978106">if</span>&nbsp;<span class="ident" id="4978109">prefix</span>&nbsp;<span class="op" id="4978116">==</span>&nbsp;<span class="string" id="4978119">&#34;&#34;</span>&nbsp;<span class="op" id="4978122">||</span>&nbsp;<span class="op" id="4978125">!</span><span class="ident" id="4978126">isName</span><span class="op" id="4978132">(</span><span class="op" id="4978133">[</span><span class="op" id="4978134">]</span><span class="builtintype" id="4978135">byte</span><span class="op" id="4978139">(</span><span class="ident" id="4978140">prefix</span><span class="op" id="4978146">)</span><span class="op" id="4978147">)</span>&nbsp;<span class="op" id="4978149">||</span>&nbsp;<span class="ident" id="4978152">strings</span><span class="op" id="4978159">.</span><span class="ident" id="4978160">Contains</span><span class="op" id="4978168">(</span><span class="ident" id="4978169">prefix</span><span class="op" id="4978175">,</span>&nbsp;<span class="string" id="4978177">&#34;:&#34;</span><span class="op" id="4978180">)</span>&nbsp;<span class="op" id="4978182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978186">prefix</span>&nbsp;<span class="op" id="4978193">=</span>&nbsp;<span class="string" id="4978195">&#34;_&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4978200">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4978203">if</span>&nbsp;<span class="ident" id="4978206">strings</span><span class="op" id="4978213">.</span><span class="ident" id="4978214">HasPrefix</span><span class="op" id="4978223">(</span><span class="ident" id="4978224">prefix</span><span class="op" id="4978230">,</span>&nbsp;<span class="string" id="4978232">&#34;xml&#34;</span><span class="op" id="4978237">)</span>&nbsp;<span class="op" id="4978239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4978243">//&nbsp;xmlanything&nbsp;is&nbsp;reserved.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978273">prefix</span>&nbsp;<span class="op" id="4978280">=</span>&nbsp;<span class="string" id="4978282">&#34;_&#34;</span>&nbsp;<span class="op" id="4978286">+</span>&nbsp;<span class="ident" id="4978288">prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4978296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4978299">if</span>&nbsp;<span class="ident" id="4978302">p</span><span class="op" id="4978303">.</span><span class="ident" id="4978304">attrNS</span><span class="op" id="4978310">[</span><span class="ident" id="4978311">prefix</span><span class="op" id="4978317">]</span>&nbsp;<span class="op" id="4978319">!=</span>&nbsp;<span class="string" id="4978322">&#34;&#34;</span>&nbsp;<span class="op" id="4978325">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4978329">//&nbsp;Name&nbsp;is&nbsp;taken.&nbsp;Find&nbsp;a&nbsp;better&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4978368">for</span>&nbsp;<span class="ident" id="4978372">p</span><span class="op" id="4978373">.</span><span class="ident" id="4978374">seq</span><span class="op" id="4978377">++</span><span class="op" id="4978379">;</span>&nbsp;<span class="op" id="4978381">;</span>&nbsp;<span class="ident" id="4978383">p</span><span class="op" id="4978384">.</span><span class="ident" id="4978385">seq</span><span class="op" id="4978388">++</span>&nbsp;<span class="op" id="4978391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4978396">if</span>&nbsp;<span class="ident" id="4978399">id</span>&nbsp;<span class="op" id="4978402">:=</span>&nbsp;<span class="ident" id="4978405">prefix</span>&nbsp;<span class="op" id="4978412">+</span>&nbsp;<span class="string" id="4978414">&#34;_&#34;</span>&nbsp;<span class="op" id="4978418">+</span>&nbsp;<span class="ident" id="4978420">strconv</span><span class="op" id="4978427">.</span><span class="ident" id="4978428">Itoa</span><span class="op" id="4978432">(</span><span class="ident" id="4978433">p</span><span class="op" id="4978434">.</span><span class="ident" id="4978435">seq</span><span class="op" id="4978438">)</span><span class="op" id="4978439">;</span>&nbsp;<span class="ident" id="4978441">p</span><span class="op" id="4978442">.</span><span class="ident" id="4978443">attrNS</span><span class="op" id="4978449">[</span><span class="ident" id="4978450">id</span><span class="op" id="4978452">]</span>&nbsp;<span class="op" id="4978454">==</span>&nbsp;<span class="string" id="4978457">&#34;&#34;</span>&nbsp;<span class="op" id="4978460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978466">prefix</span>&nbsp;<span class="op" id="4978473">=</span>&nbsp;<span class="ident" id="4978475">id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4978482">break</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4978491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4978495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4978498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978502">p</span><span class="op" id="4978503">.</span><span class="ident" id="4978504">attrPrefix</span><span class="op" id="4978514">[</span><span class="ident" id="4978515">url</span><span class="op" id="4978518">]</span>&nbsp;<span class="op" id="4978520">=</span>&nbsp;<span class="ident" id="4978522">prefix</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978530">p</span><span class="op" id="4978531">.</span><span class="ident" id="4978532">attrNS</span><span class="op" id="4978538">[</span><span class="ident" id="4978539">prefix</span><span class="op" id="4978545">]</span>&nbsp;<span class="op" id="4978547">=</span>&nbsp;<span class="ident" id="4978549">url</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978555">p</span><span class="op" id="4978556">.</span><span class="ident" id="4978557">WriteString</span><span class="op" id="4978568">(</span><span class="string" id="4978569">`xmlns:`</span><span class="op" id="4978577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978580">p</span><span class="op" id="4978581">.</span><span class="ident" id="4978582">WriteString</span><span class="op" id="4978593">(</span><span class="ident" id="4978594">prefix</span><span class="op" id="4978600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978603">p</span><span class="op" id="4978604">.</span><span class="ident" id="4978605">WriteString</span><span class="op" id="4978616">(</span><span class="string" id="4978617">`=&#34;`</span><span class="op" id="4978621">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978624">EscapeText</span><span class="op" id="4978634">(</span><span class="ident" id="4978635">p</span><span class="op" id="4978636">,</span>&nbsp;<span class="op" id="4978638">[</span><span class="op" id="4978639">]</span><span class="builtintype" id="4978640">byte</span><span class="op" id="4978644">(</span><span class="ident" id="4978645">url</span><span class="op" id="4978648">)</span><span class="op" id="4978649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978652">p</span><span class="op" id="4978653">.</span><span class="ident" id="4978654">WriteString</span><span class="op" id="4978665">(</span><span class="string" id="4978666">`&#34;&nbsp;`</span><span class="op" id="4978670">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978674">p</span><span class="op" id="4978675">.</span><span class="ident" id="4978676">prefixes</span>&nbsp;<span class="op" id="4978685">=</span>&nbsp;<span class="builtinfunc" id="4978687">append</span><span class="op" id="4978693">(</span><span class="ident" id="4978694">p</span><span class="op" id="4978695">.</span><span class="ident" id="4978696">prefixes</span><span class="op" id="4978704">,</span>&nbsp;<span class="ident" id="4978706">prefix</span><span class="op" id="4978712">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4978716">return</span>&nbsp;<span class="ident" id="4978723">prefix</span><br>
<span class="lineno"></span><span class="op" id="4978730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4978733">//&nbsp;deleteAttrPrefix&nbsp;removes&nbsp;an&nbsp;attribute&nbsp;name&nbsp;space&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="4978793">func</span>&nbsp;<span class="op" id="4978798">(</span><span class="ident" id="4978799">p</span>&nbsp;<span class="op" id="4978801">*</span><span class="ident" id="4978802">printer</span><span class="op" id="4978809">)</span>&nbsp;<span class="ident" id="4978811">deleteAttrPrefix</span><span class="op" id="4978827">(</span><span class="ident" id="4978828">prefix</span>&nbsp;<span class="builtintype" id="4978835">string</span><span class="op" id="4978841">)</span>&nbsp;<span class="op" id="4978843">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4978846">delete</span><span class="op" id="4978852">(</span><span class="ident" id="4978853">p</span><span class="op" id="4978854">.</span><span class="ident" id="4978855">attrPrefix</span><span class="op" id="4978865">,</span>&nbsp;<span class="ident" id="4978867">p</span><span class="op" id="4978868">.</span><span class="ident" id="4978869">attrNS</span><span class="op" id="4978875">[</span><span class="ident" id="4978876">prefix</span><span class="op" id="4978882">]</span><span class="op" id="4978883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4978886">delete</span><span class="op" id="4978892">(</span><span class="ident" id="4978893">p</span><span class="op" id="4978894">.</span><span class="ident" id="4978895">attrNS</span><span class="op" id="4978901">,</span>&nbsp;<span class="ident" id="4978903">prefix</span><span class="op" id="4978909">)</span><br>
<span class="lineno"></span><span class="op" id="4978911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4978914">func</span>&nbsp;<span class="op" id="4978919">(</span><span class="ident" id="4978920">p</span>&nbsp;<span class="op" id="4978922">*</span><span class="ident" id="4978923">printer</span><span class="op" id="4978930">)</span>&nbsp;<span class="ident" id="4978932">markPrefix</span><span class="op" id="4978942">(</span><span class="op" id="4978943">)</span>&nbsp;<span class="op" id="4978945">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978948">p</span><span class="op" id="4978949">.</span><span class="ident" id="4978950">prefixes</span>&nbsp;<span class="op" id="4978959">=</span>&nbsp;<span class="builtinfunc" id="4978961">append</span><span class="op" id="4978967">(</span><span class="ident" id="4978968">p</span><span class="op" id="4978969">.</span><span class="ident" id="4978970">prefixes</span><span class="op" id="4978978">,</span>&nbsp;<span class="string" id="4978980">&#34;&#34;</span><span class="op" id="4978982">)</span><br>
<span class="lineno"></span><span class="op" id="4978984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4978987">func</span>&nbsp;<span class="op" id="4978992">(</span><span class="ident" id="4978993">p</span>&nbsp;<span class="op" id="4978995">*</span><span class="ident" id="4978996">printer</span><span class="op" id="4979003">)</span>&nbsp;<span class="ident" id="4979005">popPrefix</span><span class="op" id="4979014">(</span><span class="op" id="4979015">)</span>&nbsp;<span class="op" id="4979017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4979020">for</span>&nbsp;<span class="builtinfunc" id="4979024">len</span><span class="op" id="4979027">(</span><span class="ident" id="4979028">p</span><span class="op" id="4979029">.</span><span class="ident" id="4979030">prefixes</span><span class="op" id="4979038">)</span>&nbsp;<span class="op" id="4979040">&gt;</span>&nbsp;<span class="num" id="4979042">0</span>&nbsp;<span class="op" id="4979044">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979048">prefix</span>&nbsp;<span class="op" id="4979055">:=</span>&nbsp;<span class="ident" id="4979058">p</span><span class="op" id="4979059">.</span><span class="ident" id="4979060">prefixes</span><span class="op" id="4979068">[</span><span class="builtinfunc" id="4979069">len</span><span class="op" id="4979072">(</span><span class="ident" id="4979073">p</span><span class="op" id="4979074">.</span><span class="ident" id="4979075">prefixes</span><span class="op" id="4979083">)</span><span class="op" id="4979084">-</span><span class="num" id="4979085">1</span><span class="op" id="4979086">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979090">p</span><span class="op" id="4979091">.</span><span class="ident" id="4979092">prefixes</span>&nbsp;<span class="op" id="4979101">=</span>&nbsp;<span class="ident" id="4979103">p</span><span class="op" id="4979104">.</span><span class="ident" id="4979105">prefixes</span><span class="op" id="4979113">[</span><span class="op" id="4979114">:</span><span class="builtinfunc" id="4979115">len</span><span class="op" id="4979118">(</span><span class="ident" id="4979119">p</span><span class="op" id="4979120">.</span><span class="ident" id="4979121">prefixes</span><span class="op" id="4979129">)</span><span class="op" id="4979130">-</span><span class="num" id="4979131">1</span><span class="op" id="4979132">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4979136">if</span>&nbsp;<span class="ident" id="4979139">prefix</span>&nbsp;<span class="op" id="4979146">==</span>&nbsp;<span class="string" id="4979149">&#34;&#34;</span>&nbsp;<span class="op" id="4979152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4979157">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4979165">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979169">p</span><span class="op" id="4979170">.</span><span class="ident" id="4979171">deleteAttrPrefix</span><span class="op" id="4979187">(</span><span class="ident" id="4979188">prefix</span><span class="op" id="4979194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4979197">}</span><br>
<span class="lineno"></span><span class="op" id="4979199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4979202">var</span>&nbsp;<span class="op" id="4979206">(</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979209">marshalerType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4979227">=</span>&nbsp;<span class="ident" id="4979229">reflect</span><span class="op" id="4979236">.</span><span class="ident" id="4979237">TypeOf</span><span class="op" id="4979243">(</span><span class="op" id="4979244">(</span><span class="op" id="4979245">*</span><span class="ident" id="4979246">Marshaler</span><span class="op" id="4979255">)</span><span class="op" id="4979256">(</span><span class="ident" id="4979257">nil</span><span class="op" id="4979260">)</span><span class="op" id="4979261">)</span><span class="op" id="4979262">.</span><span class="ident" id="4979263">Elem</span><span class="op" id="4979267">(</span><span class="op" id="4979268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979271">marshalerAttrType</span>&nbsp;<span class="op" id="4979289">=</span>&nbsp;<span class="ident" id="4979291">reflect</span><span class="op" id="4979298">.</span><span class="ident" id="4979299">TypeOf</span><span class="op" id="4979305">(</span><span class="op" id="4979306">(</span><span class="op" id="4979307">*</span><span class="ident" id="4979308">MarshalerAttr</span><span class="op" id="4979321">)</span><span class="op" id="4979322">(</span><span class="ident" id="4979323">nil</span><span class="op" id="4979326">)</span><span class="op" id="4979327">)</span><span class="op" id="4979328">.</span><span class="ident" id="4979329">Elem</span><span class="op" id="4979333">(</span><span class="op" id="4979334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979337">textMarshalerType</span>&nbsp;<span class="op" id="4979355">=</span>&nbsp;<span class="ident" id="4979357">reflect</span><span class="op" id="4979364">.</span><span class="ident" id="4979365">TypeOf</span><span class="op" id="4979371">(</span><span class="op" id="4979372">(</span><span class="op" id="4979373">*</span><span class="ident" id="4979374">encoding</span><span class="op" id="4979382">.</span><span class="ident" id="4979383">TextMarshaler</span><span class="op" id="4979396">)</span><span class="op" id="4979397">(</span><span class="ident" id="4979398">nil</span><span class="op" id="4979401">)</span><span class="op" id="4979402">)</span><span class="op" id="4979403">.</span><span class="ident" id="4979404">Elem</span><span class="op" id="4979408">(</span><span class="op" id="4979409">)</span><br>
<span class="lineno"></span><span class="op" id="4979411">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="comment" id="4979414">//&nbsp;marshalValue&nbsp;writes&nbsp;one&nbsp;or&nbsp;more&nbsp;XML&nbsp;elements&nbsp;representing&nbsp;val.</span><br>
<span class="lineno"></span><span class="comment" id="4979480">//&nbsp;If&nbsp;val&nbsp;was&nbsp;obtained&nbsp;from&nbsp;a&nbsp;struct&nbsp;field,&nbsp;finfo&nbsp;must&nbsp;have&nbsp;its&nbsp;details.</span><br>
<span class="lineno"></span><span class="keyword" id="4979553">func</span>&nbsp;<span class="op" id="4979558">(</span><span class="ident" id="4979559">p</span>&nbsp;<span class="op" id="4979561">*</span><span class="ident" id="4979562">printer</span><span class="op" id="4979569">)</span>&nbsp;<span class="ident" id="4979571">marshalValue</span><span class="op" id="4979583">(</span><span class="ident" id="4979584">val</span>&nbsp;<span class="ident" id="4979588">reflect</span><span class="op" id="4979595">.</span><span class="ident" id="4979596">Value</span><span class="op" id="4979601">,</span>&nbsp;<span class="ident" id="4979603">finfo</span>&nbsp;<span class="op" id="4979609">*</span><span class="ident" id="4979610">fieldInfo</span><span class="op" id="4979619">,</span>&nbsp;<span class="ident" id="4979621">startTemplate</span>&nbsp;<span class="op" id="4979635">*</span><span class="ident" id="4979636">StartElement</span><span class="op" id="4979648">)</span>&nbsp;<span class="builtintype" id="4979650">error</span>&nbsp;<span class="op" id="4979656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4979659">if</span>&nbsp;<span class="ident" id="4979662">startTemplate</span>&nbsp;<span class="op" id="4979676">!=</span>&nbsp;<span class="ident" id="4979679">nil</span>&nbsp;<span class="op" id="4979683">&amp;&amp;</span>&nbsp;<span class="ident" id="4979686">startTemplate</span><span class="op" id="4979699">.</span><span class="ident" id="4979700">Name</span><span class="op" id="4979704">.</span><span class="ident" id="4979705">Local</span>&nbsp;<span class="op" id="4979711">==</span>&nbsp;<span class="string" id="4979714">&#34;&#34;</span>&nbsp;<span class="op" id="4979717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4979721">return</span>&nbsp;<span class="ident" id="4979728">fmt</span><span class="op" id="4979731">.</span><span class="ident" id="4979732">Errorf</span><span class="op" id="4979738">(</span><span class="string" id="4979739">&#34;xml:&nbsp;EncodeElement&nbsp;of&nbsp;StartElement&nbsp;with&nbsp;missing&nbsp;name&#34;</span><span class="op" id="4979793">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4979796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4979800">if</span>&nbsp;<span class="op" id="4979803">!</span><span class="ident" id="4979804">val</span><span class="op" id="4979807">.</span><span class="ident" id="4979808">IsValid</span><span class="op" id="4979815">(</span><span class="op" id="4979816">)</span>&nbsp;<span class="op" id="4979818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4979822">return</span>&nbsp;<span class="ident" id="4979829">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4979834">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4979837">if</span>&nbsp;<span class="ident" id="4979840">finfo</span>&nbsp;<span class="op" id="4979846">!=</span>&nbsp;<span class="ident" id="4979849">nil</span>&nbsp;<span class="op" id="4979853">&amp;&amp;</span>&nbsp;<span class="ident" id="4979856">finfo</span><span class="op" id="4979861">.</span><span class="ident" id="4979862">flags</span><span class="op" id="4979867">&amp;</span><span class="ident" id="4979868">fOmitEmpty</span>&nbsp;<span class="op" id="4979879">!=</span>&nbsp;<span class="num" id="4979882">0</span>&nbsp;<span class="op" id="4979884">&amp;&amp;</span>&nbsp;<span class="ident" id="4979887">isEmptyValue</span><span class="op" id="4979899">(</span><span class="ident" id="4979900">val</span><span class="op" id="4979903">)</span>&nbsp;<span class="op" id="4979905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4979909">return</span>&nbsp;<span class="ident" id="4979916">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4979921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4979925">//&nbsp;Drill&nbsp;into&nbsp;interfaces&nbsp;and&nbsp;pointers.</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4979965">//&nbsp;This&nbsp;can&nbsp;turn&nbsp;into&nbsp;an&nbsp;infinite&nbsp;loop&nbsp;given&nbsp;a&nbsp;cyclic&nbsp;chain,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4980027">//&nbsp;but&nbsp;it&nbsp;matches&nbsp;the&nbsp;Go&nbsp;1&nbsp;behavior.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980065">for</span>&nbsp;<span class="ident" id="4980069">val</span><span class="op" id="4980072">.</span><span class="ident" id="4980073">Kind</span><span class="op" id="4980077">(</span><span class="op" id="4980078">)</span>&nbsp;<span class="op" id="4980080">==</span>&nbsp;<span class="ident" id="4980083">reflect</span><span class="op" id="4980090">.</span><span class="ident" id="4980091">Interface</span>&nbsp;<span class="op" id="4980101">||</span>&nbsp;<span class="ident" id="4980104">val</span><span class="op" id="4980107">.</span><span class="ident" id="4980108">Kind</span><span class="op" id="4980112">(</span><span class="op" id="4980113">)</span>&nbsp;<span class="op" id="4980115">==</span>&nbsp;<span class="ident" id="4980118">reflect</span><span class="op" id="4980125">.</span><span class="ident" id="4980126">Ptr</span>&nbsp;<span class="op" id="4980130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980134">if</span>&nbsp;<span class="ident" id="4980137">val</span><span class="op" id="4980140">.</span><span class="ident" id="4980141">IsNil</span><span class="op" id="4980146">(</span><span class="op" id="4980147">)</span>&nbsp;<span class="op" id="4980149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980154">return</span>&nbsp;<span class="ident" id="4980161">nil</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4980167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980171">val</span>&nbsp;<span class="op" id="4980175">=</span>&nbsp;<span class="ident" id="4980177">val</span><span class="op" id="4980180">.</span><span class="ident" id="4980181">Elem</span><span class="op" id="4980185">(</span><span class="op" id="4980186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4980189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980193">kind</span>&nbsp;<span class="op" id="4980198">:=</span>&nbsp;<span class="ident" id="4980201">val</span><span class="op" id="4980204">.</span><span class="ident" id="4980205">Kind</span><span class="op" id="4980209">(</span><span class="op" id="4980210">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980213">typ</span>&nbsp;<span class="op" id="4980217">:=</span>&nbsp;<span class="ident" id="4980220">val</span><span class="op" id="4980223">.</span><span class="ident" id="4980224">Type</span><span class="op" id="4980228">(</span><span class="op" id="4980229">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4980233">//&nbsp;Check&nbsp;for&nbsp;marshaler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980258">if</span>&nbsp;<span class="ident" id="4980261">val</span><span class="op" id="4980264">.</span><span class="ident" id="4980265">CanInterface</span><span class="op" id="4980277">(</span><span class="op" id="4980278">)</span>&nbsp;<span class="op" id="4980280">&amp;&amp;</span>&nbsp;<span class="ident" id="4980283">typ</span><span class="op" id="4980286">.</span><span class="ident" id="4980287">Implements</span><span class="op" id="4980297">(</span><span class="ident" id="4980298">marshalerType</span><span class="op" id="4980311">)</span>&nbsp;<span class="op" id="4980313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980317">return</span>&nbsp;<span class="ident" id="4980324">p</span><span class="op" id="4980325">.</span><span class="ident" id="4980326">marshalInterface</span><span class="op" id="4980342">(</span><span class="ident" id="4980343">val</span><span class="op" id="4980346">.</span><span class="ident" id="4980347">Interface</span><span class="op" id="4980356">(</span><span class="op" id="4980357">)</span><span class="op" id="4980358">.</span><span class="op" id="4980359">(</span><span class="ident" id="4980360">Marshaler</span><span class="op" id="4980369">)</span><span class="op" id="4980370">,</span>&nbsp;<span class="ident" id="4980372">defaultStart</span><span class="op" id="4980384">(</span><span class="ident" id="4980385">typ</span><span class="op" id="4980388">,</span>&nbsp;<span class="ident" id="4980390">finfo</span><span class="op" id="4980395">,</span>&nbsp;<span class="ident" id="4980397">startTemplate</span><span class="op" id="4980410">)</span><span class="op" id="4980411">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4980414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980417">if</span>&nbsp;<span class="ident" id="4980420">val</span><span class="op" id="4980423">.</span><span class="ident" id="4980424">CanAddr</span><span class="op" id="4980431">(</span><span class="op" id="4980432">)</span>&nbsp;<span class="op" id="4980434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980438">pv</span>&nbsp;<span class="op" id="4980441">:=</span>&nbsp;<span class="ident" id="4980444">val</span><span class="op" id="4980447">.</span><span class="ident" id="4980448">Addr</span><span class="op" id="4980452">(</span><span class="op" id="4980453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980457">if</span>&nbsp;<span class="ident" id="4980460">pv</span><span class="op" id="4980462">.</span><span class="ident" id="4980463">CanInterface</span><span class="op" id="4980475">(</span><span class="op" id="4980476">)</span>&nbsp;<span class="op" id="4980478">&amp;&amp;</span>&nbsp;<span class="ident" id="4980481">pv</span><span class="op" id="4980483">.</span><span class="ident" id="4980484">Type</span><span class="op" id="4980488">(</span><span class="op" id="4980489">)</span><span class="op" id="4980490">.</span><span class="ident" id="4980491">Implements</span><span class="op" id="4980501">(</span><span class="ident" id="4980502">marshalerType</span><span class="op" id="4980515">)</span>&nbsp;<span class="op" id="4980517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980522">return</span>&nbsp;<span class="ident" id="4980529">p</span><span class="op" id="4980530">.</span><span class="ident" id="4980531">marshalInterface</span><span class="op" id="4980547">(</span><span class="ident" id="4980548">pv</span><span class="op" id="4980550">.</span><span class="ident" id="4980551">Interface</span><span class="op" id="4980560">(</span><span class="op" id="4980561">)</span><span class="op" id="4980562">.</span><span class="op" id="4980563">(</span><span class="ident" id="4980564">Marshaler</span><span class="op" id="4980573">)</span><span class="op" id="4980574">,</span>&nbsp;<span class="ident" id="4980576">defaultStart</span><span class="op" id="4980588">(</span><span class="ident" id="4980589">pv</span><span class="op" id="4980591">.</span><span class="ident" id="4980592">Type</span><span class="op" id="4980596">(</span><span class="op" id="4980597">)</span><span class="op" id="4980598">,</span>&nbsp;<span class="ident" id="4980600">finfo</span><span class="op" id="4980605">,</span>&nbsp;<span class="ident" id="4980607">startTemplate</span><span class="op" id="4980620">)</span><span class="op" id="4980621">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4980625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4980628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4980632">//&nbsp;Check&nbsp;for&nbsp;text&nbsp;marshaler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980662">if</span>&nbsp;<span class="ident" id="4980665">val</span><span class="op" id="4980668">.</span><span class="ident" id="4980669">CanInterface</span><span class="op" id="4980681">(</span><span class="op" id="4980682">)</span>&nbsp;<span class="op" id="4980684">&amp;&amp;</span>&nbsp;<span class="ident" id="4980687">typ</span><span class="op" id="4980690">.</span><span class="ident" id="4980691">Implements</span><span class="op" id="4980701">(</span><span class="ident" id="4980702">textMarshalerType</span><span class="op" id="4980719">)</span>&nbsp;<span class="op" id="4980721">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980725">return</span>&nbsp;<span class="ident" id="4980732">p</span><span class="op" id="4980733">.</span><span class="ident" id="4980734">marshalTextInterface</span><span class="op" id="4980754">(</span><span class="ident" id="4980755">val</span><span class="op" id="4980758">.</span><span class="ident" id="4980759">Interface</span><span class="op" id="4980768">(</span><span class="op" id="4980769">)</span><span class="op" id="4980770">.</span><span class="op" id="4980771">(</span><span class="ident" id="4980772">encoding</span><span class="op" id="4980780">.</span><span class="ident" id="4980781">TextMarshaler</span><span class="op" id="4980794">)</span><span class="op" id="4980795">,</span>&nbsp;<span class="ident" id="4980797">defaultStart</span><span class="op" id="4980809">(</span><span class="ident" id="4980810">typ</span><span class="op" id="4980813">,</span>&nbsp;<span class="ident" id="4980815">finfo</span><span class="op" id="4980820">,</span>&nbsp;<span class="ident" id="4980822">startTemplate</span><span class="op" id="4980835">)</span><span class="op" id="4980836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4980839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980842">if</span>&nbsp;<span class="ident" id="4980845">val</span><span class="op" id="4980848">.</span><span class="ident" id="4980849">CanAddr</span><span class="op" id="4980856">(</span><span class="op" id="4980857">)</span>&nbsp;<span class="op" id="4980859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980863">pv</span>&nbsp;<span class="op" id="4980866">:=</span>&nbsp;<span class="ident" id="4980869">val</span><span class="op" id="4980872">.</span><span class="ident" id="4980873">Addr</span><span class="op" id="4980877">(</span><span class="op" id="4980878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980882">if</span>&nbsp;<span class="ident" id="4980885">pv</span><span class="op" id="4980887">.</span><span class="ident" id="4980888">CanInterface</span><span class="op" id="4980900">(</span><span class="op" id="4980901">)</span>&nbsp;<span class="op" id="4980903">&amp;&amp;</span>&nbsp;<span class="ident" id="4980906">pv</span><span class="op" id="4980908">.</span><span class="ident" id="4980909">Type</span><span class="op" id="4980913">(</span><span class="op" id="4980914">)</span><span class="op" id="4980915">.</span><span class="ident" id="4980916">Implements</span><span class="op" id="4980926">(</span><span class="ident" id="4980927">textMarshalerType</span><span class="op" id="4980944">)</span>&nbsp;<span class="op" id="4980946">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980951">return</span>&nbsp;<span class="ident" id="4980958">p</span><span class="op" id="4980959">.</span><span class="ident" id="4980960">marshalTextInterface</span><span class="op" id="4980980">(</span><span class="ident" id="4980981">pv</span><span class="op" id="4980983">.</span><span class="ident" id="4980984">Interface</span><span class="op" id="4980993">(</span><span class="op" id="4980994">)</span><span class="op" id="4980995">.</span><span class="op" id="4980996">(</span><span class="ident" id="4980997">encoding</span><span class="op" id="4981005">.</span><span class="ident" id="4981006">TextMarshaler</span><span class="op" id="4981019">)</span><span class="op" id="4981020">,</span>&nbsp;<span class="ident" id="4981022">defaultStart</span><span class="op" id="4981034">(</span><span class="ident" id="4981035">pv</span><span class="op" id="4981037">.</span><span class="ident" id="4981038">Type</span><span class="op" id="4981042">(</span><span class="op" id="4981043">)</span><span class="op" id="4981044">,</span>&nbsp;<span class="ident" id="4981046">finfo</span><span class="op" id="4981051">,</span>&nbsp;<span class="ident" id="4981053">startTemplate</span><span class="op" id="4981066">)</span><span class="op" id="4981067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4981078">//&nbsp;Slices&nbsp;and&nbsp;arrays&nbsp;iterate&nbsp;over&nbsp;the&nbsp;elements.&nbsp;They&nbsp;do&nbsp;not&nbsp;have&nbsp;an&nbsp;enclosing&nbsp;tag.</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981162">if</span>&nbsp;<span class="op" id="4981165">(</span><span class="ident" id="4981166">kind</span>&nbsp;<span class="op" id="4981171">==</span>&nbsp;<span class="ident" id="4981174">reflect</span><span class="op" id="4981181">.</span><span class="ident" id="4981182">Slice</span>&nbsp;<span class="op" id="4981188">||</span>&nbsp;<span class="ident" id="4981191">kind</span>&nbsp;<span class="op" id="4981196">==</span>&nbsp;<span class="ident" id="4981199">reflect</span><span class="op" id="4981206">.</span><span class="ident" id="4981207">Array</span><span class="op" id="4981212">)</span>&nbsp;<span class="op" id="4981214">&amp;&amp;</span>&nbsp;<span class="ident" id="4981217">typ</span><span class="op" id="4981220">.</span><span class="ident" id="4981221">Elem</span><span class="op" id="4981225">(</span><span class="op" id="4981226">)</span><span class="op" id="4981227">.</span><span class="ident" id="4981228">Kind</span><span class="op" id="4981232">(</span><span class="op" id="4981233">)</span>&nbsp;<span class="op" id="4981235">!=</span>&nbsp;<span class="ident" id="4981238">reflect</span><span class="op" id="4981245">.</span><span class="ident" id="4981246">Uint8</span>&nbsp;<span class="op" id="4981252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981256">for</span>&nbsp;<span class="ident" id="4981260">i</span><span class="op" id="4981261">,</span>&nbsp;<span class="ident" id="4981263">n</span>&nbsp;<span class="op" id="4981265">:=</span>&nbsp;<span class="num" id="4981268">0</span><span class="op" id="4981269">,</span>&nbsp;<span class="ident" id="4981271">val</span><span class="op" id="4981274">.</span><span class="ident" id="4981275">Len</span><span class="op" id="4981278">(</span><span class="op" id="4981279">)</span><span class="op" id="4981280">;</span>&nbsp;<span class="ident" id="4981282">i</span>&nbsp;<span class="op" id="4981284">&lt;</span>&nbsp;<span class="ident" id="4981286">n</span><span class="op" id="4981287">;</span>&nbsp;<span class="ident" id="4981289">i</span><span class="op" id="4981290">++</span>&nbsp;<span class="op" id="4981293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981298">if</span>&nbsp;<span class="ident" id="4981301">err</span>&nbsp;<span class="op" id="4981305">:=</span>&nbsp;<span class="ident" id="4981308">p</span><span class="op" id="4981309">.</span><span class="ident" id="4981310">marshalValue</span><span class="op" id="4981322">(</span><span class="ident" id="4981323">val</span><span class="op" id="4981326">.</span><span class="ident" id="4981327">Index</span><span class="op" id="4981332">(</span><span class="ident" id="4981333">i</span><span class="op" id="4981334">)</span><span class="op" id="4981335">,</span>&nbsp;<span class="ident" id="4981337">finfo</span><span class="op" id="4981342">,</span>&nbsp;<span class="ident" id="4981344">startTemplate</span><span class="op" id="4981357">)</span><span class="op" id="4981358">;</span>&nbsp;<span class="ident" id="4981360">err</span>&nbsp;<span class="op" id="4981364">!=</span>&nbsp;<span class="ident" id="4981367">nil</span>&nbsp;<span class="op" id="4981371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981377">return</span>&nbsp;<span class="ident" id="4981384">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981391">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981399">return</span>&nbsp;<span class="ident" id="4981406">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981415">tinfo</span><span class="op" id="4981420">,</span>&nbsp;<span class="ident" id="4981422">err</span>&nbsp;<span class="op" id="4981426">:=</span>&nbsp;<span class="ident" id="4981429">getTypeInfo</span><span class="op" id="4981440">(</span><span class="ident" id="4981441">typ</span><span class="op" id="4981444">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981447">if</span>&nbsp;<span class="ident" id="4981450">err</span>&nbsp;<span class="op" id="4981454">!=</span>&nbsp;<span class="ident" id="4981457">nil</span>&nbsp;<span class="op" id="4981461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981465">return</span>&nbsp;<span class="ident" id="4981472">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4981481">//&nbsp;Create&nbsp;start&nbsp;element.</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4981507">//&nbsp;Precedence&nbsp;for&nbsp;the&nbsp;XML&nbsp;element&nbsp;name&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4981551">//&nbsp;0.&nbsp;startTemplate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4981572">//&nbsp;1.&nbsp;XMLName&nbsp;field&nbsp;in&nbsp;underlying&nbsp;struct;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4981615">//&nbsp;2.&nbsp;field&nbsp;name/tag&nbsp;in&nbsp;the&nbsp;struct&nbsp;field;&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4981662">//&nbsp;3.&nbsp;type&nbsp;name</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981679">var</span>&nbsp;<span class="ident" id="4981683">start</span>&nbsp;<span class="ident" id="4981689">StartElement</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981704">if</span>&nbsp;<span class="ident" id="4981707">startTemplate</span>&nbsp;<span class="op" id="4981721">!=</span>&nbsp;<span class="ident" id="4981724">nil</span>&nbsp;<span class="op" id="4981728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981732">start</span><span class="op" id="4981737">.</span><span class="ident" id="4981738">Name</span>&nbsp;<span class="op" id="4981743">=</span>&nbsp;<span class="ident" id="4981745">startTemplate</span><span class="op" id="4981758">.</span><span class="ident" id="4981759">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981766">start</span><span class="op" id="4981771">.</span><span class="ident" id="4981772">Attr</span>&nbsp;<span class="op" id="4981777">=</span>&nbsp;<span class="builtinfunc" id="4981779">append</span><span class="op" id="4981785">(</span><span class="ident" id="4981786">start</span><span class="op" id="4981791">.</span><span class="ident" id="4981792">Attr</span><span class="op" id="4981796">,</span>&nbsp;<span class="ident" id="4981798">startTemplate</span><span class="op" id="4981811">.</span><span class="ident" id="4981812">Attr</span><span class="op" id="4981816">...</span><span class="op" id="4981819">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981822">}</span>&nbsp;<span class="keyword" id="4981824">else</span>&nbsp;<span class="keyword" id="4981829">if</span>&nbsp;<span class="ident" id="4981832">tinfo</span><span class="op" id="4981837">.</span><span class="ident" id="4981838">xmlname</span>&nbsp;<span class="op" id="4981846">!=</span>&nbsp;<span class="ident" id="4981849">nil</span>&nbsp;<span class="op" id="4981853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981857">xmlname</span>&nbsp;<span class="op" id="4981865">:=</span>&nbsp;<span class="ident" id="4981868">tinfo</span><span class="op" id="4981873">.</span><span class="ident" id="4981874">xmlname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981884">if</span>&nbsp;<span class="ident" id="4981887">xmlname</span><span class="op" id="4981894">.</span><span class="ident" id="4981895">name</span>&nbsp;<span class="op" id="4981900">!=</span>&nbsp;<span class="string" id="4981903">&#34;&#34;</span>&nbsp;<span class="op" id="4981906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981911">start</span><span class="op" id="4981916">.</span><span class="ident" id="4981917">Name</span><span class="op" id="4981921">.</span><span class="ident" id="4981922">Space</span><span class="op" id="4981927">,</span>&nbsp;<span class="ident" id="4981929">start</span><span class="op" id="4981934">.</span><span class="ident" id="4981935">Name</span><span class="op" id="4981939">.</span><span class="ident" id="4981940">Local</span>&nbsp;<span class="op" id="4981946">=</span>&nbsp;<span class="ident" id="4981948">xmlname</span><span class="op" id="4981955">.</span><span class="ident" id="4981956">xmlns</span><span class="op" id="4981961">,</span>&nbsp;<span class="ident" id="4981963">xmlname</span><span class="op" id="4981970">.</span><span class="ident" id="4981971">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981978">}</span>&nbsp;<span class="keyword" id="4981980">else</span>&nbsp;<span class="keyword" id="4981985">if</span>&nbsp;<span class="ident" id="4981988">v</span><span class="op" id="4981989">,</span>&nbsp;<span class="ident" id="4981991">ok</span>&nbsp;<span class="op" id="4981994">:=</span>&nbsp;<span class="ident" id="4981997">xmlname</span><span class="op" id="4982004">.</span><span class="ident" id="4982005">value</span><span class="op" id="4982010">(</span><span class="ident" id="4982011">val</span><span class="op" id="4982014">)</span><span class="op" id="4982015">.</span><span class="ident" id="4982016">Interface</span><span class="op" id="4982025">(</span><span class="op" id="4982026">)</span><span class="op" id="4982027">.</span><span class="op" id="4982028">(</span><span class="ident" id="4982029">Name</span><span class="op" id="4982033">)</span><span class="op" id="4982034">;</span>&nbsp;<span class="ident" id="4982036">ok</span>&nbsp;<span class="op" id="4982039">&amp;&amp;</span>&nbsp;<span class="ident" id="4982042">v</span><span class="op" id="4982043">.</span><span class="ident" id="4982044">Local</span>&nbsp;<span class="op" id="4982050">!=</span>&nbsp;<span class="string" id="4982053">&#34;&#34;</span>&nbsp;<span class="op" id="4982056">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982061">start</span><span class="op" id="4982066">.</span><span class="ident" id="4982067">Name</span>&nbsp;<span class="op" id="4982072">=</span>&nbsp;<span class="ident" id="4982074">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982084">if</span>&nbsp;<span class="ident" id="4982087">start</span><span class="op" id="4982092">.</span><span class="ident" id="4982093">Name</span><span class="op" id="4982097">.</span><span class="ident" id="4982098">Local</span>&nbsp;<span class="op" id="4982104">==</span>&nbsp;<span class="string" id="4982107">&#34;&#34;</span>&nbsp;<span class="op" id="4982110">&amp;&amp;</span>&nbsp;<span class="ident" id="4982113">finfo</span>&nbsp;<span class="op" id="4982119">!=</span>&nbsp;<span class="ident" id="4982122">nil</span>&nbsp;<span class="op" id="4982126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982130">start</span><span class="op" id="4982135">.</span><span class="ident" id="4982136">Name</span><span class="op" id="4982140">.</span><span class="ident" id="4982141">Space</span><span class="op" id="4982146">,</span>&nbsp;<span class="ident" id="4982148">start</span><span class="op" id="4982153">.</span><span class="ident" id="4982154">Name</span><span class="op" id="4982158">.</span><span class="ident" id="4982159">Local</span>&nbsp;<span class="op" id="4982165">=</span>&nbsp;<span class="ident" id="4982167">finfo</span><span class="op" id="4982172">.</span><span class="ident" id="4982173">xmlns</span><span class="op" id="4982178">,</span>&nbsp;<span class="ident" id="4982180">finfo</span><span class="op" id="4982185">.</span><span class="ident" id="4982186">name</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982195">if</span>&nbsp;<span class="ident" id="4982198">start</span><span class="op" id="4982203">.</span><span class="ident" id="4982204">Name</span><span class="op" id="4982208">.</span><span class="ident" id="4982209">Local</span>&nbsp;<span class="op" id="4982215">==</span>&nbsp;<span class="string" id="4982218">&#34;&#34;</span>&nbsp;<span class="op" id="4982221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982225">name</span>&nbsp;<span class="op" id="4982230">:=</span>&nbsp;<span class="ident" id="4982233">typ</span><span class="op" id="4982236">.</span><span class="ident" id="4982237">Name</span><span class="op" id="4982241">(</span><span class="op" id="4982242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982246">if</span>&nbsp;<span class="ident" id="4982249">name</span>&nbsp;<span class="op" id="4982254">==</span>&nbsp;<span class="string" id="4982257">&#34;&#34;</span>&nbsp;<span class="op" id="4982260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982265">return</span>&nbsp;<span class="op" id="4982272">&amp;</span><span class="ident" id="4982273">UnsupportedTypeError</span><span class="op" id="4982293">{</span><span class="ident" id="4982294">typ</span><span class="op" id="4982297">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982305">start</span><span class="op" id="4982310">.</span><span class="ident" id="4982311">Name</span><span class="op" id="4982315">.</span><span class="ident" id="4982316">Local</span>&nbsp;<span class="op" id="4982322">=</span>&nbsp;<span class="ident" id="4982324">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4982334">//&nbsp;Attributes</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982349">for</span>&nbsp;<span class="ident" id="4982353">i</span>&nbsp;<span class="op" id="4982355">:=</span>&nbsp;<span class="keyword" id="4982358">range</span>&nbsp;<span class="ident" id="4982364">tinfo</span><span class="op" id="4982369">.</span><span class="ident" id="4982370">fields</span>&nbsp;<span class="op" id="4982377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982381">finfo</span>&nbsp;<span class="op" id="4982387">:=</span>&nbsp;<span class="op" id="4982390">&amp;</span><span class="ident" id="4982391">tinfo</span><span class="op" id="4982396">.</span><span class="ident" id="4982397">fields</span><span class="op" id="4982403">[</span><span class="ident" id="4982404">i</span><span class="op" id="4982405">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982409">if</span>&nbsp;<span class="ident" id="4982412">finfo</span><span class="op" id="4982417">.</span><span class="ident" id="4982418">flags</span><span class="op" id="4982423">&amp;</span><span class="ident" id="4982424">fAttr</span>&nbsp;<span class="op" id="4982430">==</span>&nbsp;<span class="num" id="4982433">0</span>&nbsp;<span class="op" id="4982435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982440">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982451">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982455">fv</span>&nbsp;<span class="op" id="4982458">:=</span>&nbsp;<span class="ident" id="4982461">finfo</span><span class="op" id="4982466">.</span><span class="ident" id="4982467">value</span><span class="op" id="4982472">(</span><span class="ident" id="4982473">val</span><span class="op" id="4982476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982480">name</span>&nbsp;<span class="op" id="4982485">:=</span>&nbsp;<span class="ident" id="4982488">Name</span><span class="op" id="4982492">{</span><span class="ident" id="4982493">Space</span><span class="op" id="4982498">:</span>&nbsp;<span class="ident" id="4982500">finfo</span><span class="op" id="4982505">.</span><span class="ident" id="4982506">xmlns</span><span class="op" id="4982511">,</span>&nbsp;<span class="ident" id="4982513">Local</span><span class="op" id="4982518">:</span>&nbsp;<span class="ident" id="4982520">finfo</span><span class="op" id="4982525">.</span><span class="ident" id="4982526">name</span><span class="op" id="4982530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982535">if</span>&nbsp;<span class="ident" id="4982538">finfo</span><span class="op" id="4982543">.</span><span class="ident" id="4982544">flags</span><span class="op" id="4982549">&amp;</span><span class="ident" id="4982550">fOmitEmpty</span>&nbsp;<span class="op" id="4982561">!=</span>&nbsp;<span class="num" id="4982564">0</span>&nbsp;<span class="op" id="4982566">&amp;&amp;</span>&nbsp;<span class="ident" id="4982569">isEmptyValue</span><span class="op" id="4982581">(</span><span class="ident" id="4982582">fv</span><span class="op" id="4982584">)</span>&nbsp;<span class="op" id="4982586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982591">continue</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982607">if</span>&nbsp;<span class="ident" id="4982610">fv</span><span class="op" id="4982612">.</span><span class="ident" id="4982613">Kind</span><span class="op" id="4982617">(</span><span class="op" id="4982618">)</span>&nbsp;<span class="op" id="4982620">==</span>&nbsp;<span class="ident" id="4982623">reflect</span><span class="op" id="4982630">.</span><span class="ident" id="4982631">Interface</span>&nbsp;<span class="op" id="4982641">&amp;&amp;</span>&nbsp;<span class="ident" id="4982644">fv</span><span class="op" id="4982646">.</span><span class="ident" id="4982647">IsNil</span><span class="op" id="4982652">(</span><span class="op" id="4982653">)</span>&nbsp;<span class="op" id="4982655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982660">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982671">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982676">if</span>&nbsp;<span class="ident" id="4982679">fv</span><span class="op" id="4982681">.</span><span class="ident" id="4982682">CanInterface</span><span class="op" id="4982694">(</span><span class="op" id="4982695">)</span>&nbsp;<span class="op" id="4982697">&amp;&amp;</span>&nbsp;<span class="ident" id="4982700">fv</span><span class="op" id="4982702">.</span><span class="ident" id="4982703">Type</span><span class="op" id="4982707">(</span><span class="op" id="4982708">)</span><span class="op" id="4982709">.</span><span class="ident" id="4982710">Implements</span><span class="op" id="4982720">(</span><span class="ident" id="4982721">marshalerAttrType</span><span class="op" id="4982738">)</span>&nbsp;<span class="op" id="4982740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982745">attr</span><span class="op" id="4982749">,</span>&nbsp;<span class="ident" id="4982751">err</span>&nbsp;<span class="op" id="4982755">:=</span>&nbsp;<span class="ident" id="4982758">fv</span><span class="op" id="4982760">.</span><span class="ident" id="4982761">Interface</span><span class="op" id="4982770">(</span><span class="op" id="4982771">)</span><span class="op" id="4982772">.</span><span class="op" id="4982773">(</span><span class="ident" id="4982774">MarshalerAttr</span><span class="op" id="4982787">)</span><span class="op" id="4982788">.</span><span class="ident" id="4982789">MarshalXMLAttr</span><span class="op" id="4982803">(</span><span class="ident" id="4982804">name</span><span class="op" id="4982808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982813">if</span>&nbsp;<span class="ident" id="4982816">err</span>&nbsp;<span class="op" id="4982820">!=</span>&nbsp;<span class="ident" id="4982823">nil</span>&nbsp;<span class="op" id="4982827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982833">return</span>&nbsp;<span class="ident" id="4982840">err</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982852">if</span>&nbsp;<span class="ident" id="4982855">attr</span><span class="op" id="4982859">.</span><span class="ident" id="4982860">Name</span><span class="op" id="4982864">.</span><span class="ident" id="4982865">Local</span>&nbsp;<span class="op" id="4982871">!=</span>&nbsp;<span class="string" id="4982874">&#34;&#34;</span>&nbsp;<span class="op" id="4982877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982883">start</span><span class="op" id="4982888">.</span><span class="ident" id="4982889">Attr</span>&nbsp;<span class="op" id="4982894">=</span>&nbsp;<span class="builtinfunc" id="4982896">append</span><span class="op" id="4982902">(</span><span class="ident" id="4982903">start</span><span class="op" id="4982908">.</span><span class="ident" id="4982909">Attr</span><span class="op" id="4982913">,</span>&nbsp;<span class="ident" id="4982915">attr</span><span class="op" id="4982919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982929">continue</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982945">if</span>&nbsp;<span class="ident" id="4982948">fv</span><span class="op" id="4982950">.</span><span class="ident" id="4982951">CanAddr</span><span class="op" id="4982958">(</span><span class="op" id="4982959">)</span>&nbsp;<span class="op" id="4982961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982966">pv</span>&nbsp;<span class="op" id="4982969">:=</span>&nbsp;<span class="ident" id="4982972">fv</span><span class="op" id="4982974">.</span><span class="ident" id="4982975">Addr</span><span class="op" id="4982979">(</span><span class="op" id="4982980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982985">if</span>&nbsp;<span class="ident" id="4982988">pv</span><span class="op" id="4982990">.</span><span class="ident" id="4982991">CanInterface</span><span class="op" id="4983003">(</span><span class="op" id="4983004">)</span>&nbsp;<span class="op" id="4983006">&amp;&amp;</span>&nbsp;<span class="ident" id="4983009">pv</span><span class="op" id="4983011">.</span><span class="ident" id="4983012">Type</span><span class="op" id="4983016">(</span><span class="op" id="4983017">)</span><span class="op" id="4983018">.</span><span class="ident" id="4983019">Implements</span><span class="op" id="4983029">(</span><span class="ident" id="4983030">marshalerAttrType</span><span class="op" id="4983047">)</span>&nbsp;<span class="op" id="4983049">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983055">attr</span><span class="op" id="4983059">,</span>&nbsp;<span class="ident" id="4983061">err</span>&nbsp;<span class="op" id="4983065">:=</span>&nbsp;<span class="ident" id="4983068">pv</span><span class="op" id="4983070">.</span><span class="ident" id="4983071">Interface</span><span class="op" id="4983080">(</span><span class="op" id="4983081">)</span><span class="op" id="4983082">.</span><span class="op" id="4983083">(</span><span class="ident" id="4983084">MarshalerAttr</span><span class="op" id="4983097">)</span><span class="op" id="4983098">.</span><span class="ident" id="4983099">MarshalXMLAttr</span><span class="op" id="4983113">(</span><span class="ident" id="4983114">name</span><span class="op" id="4983118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983124">if</span>&nbsp;<span class="ident" id="4983127">err</span>&nbsp;<span class="op" id="4983131">!=</span>&nbsp;<span class="ident" id="4983134">nil</span>&nbsp;<span class="op" id="4983138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983145">return</span>&nbsp;<span class="ident" id="4983152">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4983160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983166">if</span>&nbsp;<span class="ident" id="4983169">attr</span><span class="op" id="4983173">.</span><span class="ident" id="4983174">Name</span><span class="op" id="4983178">.</span><span class="ident" id="4983179">Local</span>&nbsp;<span class="op" id="4983185">!=</span>&nbsp;<span class="string" id="4983188">&#34;&#34;</span>&nbsp;<span class="op" id="4983191">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983198">start</span><span class="op" id="4983203">.</span><span class="ident" id="4983204">Attr</span>&nbsp;<span class="op" id="4983209">=</span>&nbsp;<span class="builtinfunc" id="4983211">append</span><span class="op" id="4983217">(</span><span class="ident" id="4983218">start</span><span class="op" id="4983223">.</span><span class="ident" id="4983224">Attr</span><span class="op" id="4983228">,</span>&nbsp;<span class="ident" id="4983230">attr</span><span class="op" id="4983234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4983240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983246">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4983258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4983262">}</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983267">if</span>&nbsp;<span class="ident" id="4983270">fv</span><span class="op" id="4983272">.</span><span class="ident" id="4983273">CanInterface</span><span class="op" id="4983285">(</span><span class="op" id="4983286">)</span>&nbsp;<span class="op" id="4983288">&amp;&amp;</span>&nbsp;<span class="ident" id="4983291">fv</span><span class="op" id="4983293">.</span><span class="ident" id="4983294">Type</span><span class="op" id="4983298">(</span><span class="op" id="4983299">)</span><span class="op" id="4983300">.</span><span class="ident" id="4983301">Implements</span><span class="op" id="4983311">(</span><span class="ident" id="4983312">textMarshalerType</span><span class="op" id="4983329">)</span>&nbsp;<span class="op" id="4983331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983336">text</span><span class="op" id="4983340">,</span>&nbsp;<span class="ident" id="4983342">err</span>&nbsp;<span class="op" id="4983346">:=</span>&nbsp;<span class="ident" id="4983349">fv</span><span class="op" id="4983351">.</span><span class="ident" id="4983352">Interface</span><span class="op" id="4983361">(</span><span class="op" id="4983362">)</span><span class="op" id="4983363">.</span><span class="op" id="4983364">(</span><span class="ident" id="4983365">encoding</span><span class="op" id="4983373">.</span><span class="ident" id="4983374">TextMarshaler</span><span class="op" id="4983387">)</span><span class="op" id="4983388">.</span><span class="ident" id="4983389">MarshalText</span><span class="op" id="4983400">(</span><span class="op" id="4983401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983406">if</span>&nbsp;<span class="ident" id="4983409">err</span>&nbsp;<span class="op" id="4983413">!=</span>&nbsp;<span class="ident" id="4983416">nil</span>&nbsp;<span class="op" id="4983420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983426">return</span>&nbsp;<span class="ident" id="4983433">err</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4983440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983445">start</span><span class="op" id="4983450">.</span><span class="ident" id="4983451">Attr</span>&nbsp;<span class="op" id="4983456">=</span>&nbsp;<span class="builtinfunc" id="4983458">append</span><span class="op" id="4983464">(</span><span class="ident" id="4983465">start</span><span class="op" id="4983470">.</span><span class="ident" id="4983471">Attr</span><span class="op" id="4983475">,</span>&nbsp;<span class="ident" id="4983477">Attr</span><span class="op" id="4983481">{</span><span class="ident" id="4983482">name</span><span class="op" id="4983486">,</span>&nbsp;<span class="builtintype" id="4983488">string</span><span class="op" id="4983494">(</span><span class="ident" id="4983495">text</span><span class="op" id="4983499">)</span><span class="op" id="4983500">}</span><span class="op" id="4983501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983506">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4983517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983522">if</span>&nbsp;<span class="ident" id="4983525">fv</span><span class="op" id="4983527">.</span><span class="ident" id="4983528">CanAddr</span><span class="op" id="4983535">(</span><span class="op" id="4983536">)</span>&nbsp;<span class="op" id="4983538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983543">pv</span>&nbsp;<span class="op" id="4983546">:=</span>&nbsp;<span class="ident" id="4983549">fv</span><span class="op" id="4983551">.</span><span class="ident" id="4983552">Addr</span><span class="op" id="4983556">(</span><span class="op" id="4983557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983562">if</span>&nbsp;<span class="ident" id="4983565">pv</span><span class="op" id="4983567">.</span><span class="ident" id="4983568">CanInterface</span><span class="op" id="4983580">(</span><span class="op" id="4983581">)</span>&nbsp;<span class="op" id="4983583">&amp;&amp;</span>&nbsp;<span class="ident" id="4983586">pv</span><span class="op" id="4983588">.</span><span class="ident" id="4983589">Type</span><span class="op" id="4983593">(</span><span class="op" id="4983594">)</span><span class="op" id="4983595">.</span><span class="ident" id="4983596">Implements</span><span class="op" id="4983606">(</span><span class="ident" id="4983607">textMarshalerType</span><span class="op" id="4983624">)</span>&nbsp;<span class="op" id="4983626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983632">text</span><span class="op" id="4983636">,</span>&nbsp;<span class="ident" id="4983638">err</span>&nbsp;<span class="op" id="4983642">:=</span>&nbsp;<span class="ident" id="4983645">pv</span><span class="op" id="4983647">.</span><span class="ident" id="4983648">Interface</span><span class="op" id="4983657">(</span><span class="op" id="4983658">)</span><span class="op" id="4983659">.</span><span class="op" id="4983660">(</span><span class="ident" id="4983661">encoding</span><span class="op" id="4983669">.</span><span class="ident" id="4983670">TextMarshaler</span><span class="op" id="4983683">)</span><span class="op" id="4983684">.</span><span class="ident" id="4983685">MarshalText</span><span class="op" id="4983696">(</span><span class="op" id="4983697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983703">if</span>&nbsp;<span class="ident" id="4983706">err</span>&nbsp;<span class="op" id="4983710">!=</span>&nbsp;<span class="ident" id="4983713">nil</span>&nbsp;<span class="op" id="4983717">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983724">return</span>&nbsp;<span class="ident" id="4983731">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4983739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983745">start</span><span class="op" id="4983750">.</span><span class="ident" id="4983751">Attr</span>&nbsp;<span class="op" id="4983756">=</span>&nbsp;<span class="builtinfunc" id="4983758">append</span><span class="op" id="4983764">(</span><span class="ident" id="4983765">start</span><span class="op" id="4983770">.</span><span class="ident" id="4983771">Attr</span><span class="op" id="4983775">,</span>&nbsp;<span class="ident" id="4983777">Attr</span><span class="op" id="4983781">{</span><span class="ident" id="4983782">name</span><span class="op" id="4983786">,</span>&nbsp;<span class="builtintype" id="4983788">string</span><span class="op" id="4983794">(</span><span class="ident" id="4983795">text</span><span class="op" id="4983799">)</span><span class="op" id="4983800">}</span><span class="op" id="4983801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983807">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4983819">}</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4983823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4983828">//&nbsp;Dereference&nbsp;or&nbsp;skip&nbsp;nil&nbsp;pointer,&nbsp;interface&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983884">switch</span>&nbsp;<span class="ident" id="4983891">fv</span><span class="op" id="4983893">.</span><span class="ident" id="4983894">Kind</span><span class="op" id="4983898">(</span><span class="op" id="4983899">)</span>&nbsp;<span class="op" id="4983901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983905">case</span>&nbsp;<span class="ident" id="4983910">reflect</span><span class="op" id="4983917">.</span><span class="ident" id="4983918">Ptr</span><span class="op" id="4983921">,</span>&nbsp;<span class="ident" id="4983923">reflect</span><span class="op" id="4983930">.</span><span class="ident" id="4983931">Interface</span><span class="op" id="4983940">:</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983945">if</span>&nbsp;<span class="ident" id="4983948">fv</span><span class="op" id="4983950">.</span><span class="ident" id="4983951">IsNil</span><span class="op" id="4983956">(</span><span class="op" id="4983957">)</span>&nbsp;<span class="op" id="4983959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983965">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4983977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983982">fv</span>&nbsp;<span class="op" id="4983985">=</span>&nbsp;<span class="ident" id="4983987">fv</span><span class="op" id="4983989">.</span><span class="ident" id="4983990">Elem</span><span class="op" id="4983994">(</span><span class="op" id="4983995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4983999">}</span><br>
<span class="lineno">515</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984004">s</span><span class="op" id="4984005">,</span>&nbsp;<span class="ident" id="4984007">b</span><span class="op" id="4984008">,</span>&nbsp;<span class="ident" id="4984010">err</span>&nbsp;<span class="op" id="4984014">:=</span>&nbsp;<span class="ident" id="4984017">p</span><span class="op" id="4984018">.</span><span class="ident" id="4984019">marshalSimple</span><span class="op" id="4984032">(</span><span class="ident" id="4984033">fv</span><span class="op" id="4984035">.</span><span class="ident" id="4984036">Type</span><span class="op" id="4984040">(</span><span class="op" id="4984041">)</span><span class="op" id="4984042">,</span>&nbsp;<span class="ident" id="4984044">fv</span><span class="op" id="4984046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4984050">if</span>&nbsp;<span class="ident" id="4984053">err</span>&nbsp;<span class="op" id="4984057">!=</span>&nbsp;<span class="ident" id="4984060">nil</span>&nbsp;<span class="op" id="4984064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4984069">return</span>&nbsp;<span class="ident" id="4984076">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4984082">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4984086">if</span>&nbsp;<span class="ident" id="4984089">b</span>&nbsp;<span class="op" id="4984091">!=</span>&nbsp;<span class="ident" id="4984094">nil</span>&nbsp;<span class="op" id="4984098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984103">s</span>&nbsp;<span class="op" id="4984105">=</span>&nbsp;<span class="builtintype" id="4984107">string</span><span class="op" id="4984113">(</span><span class="ident" id="4984114">b</span><span class="op" id="4984115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4984119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984123">start</span><span class="op" id="4984128">.</span><span class="ident" id="4984129">Attr</span>&nbsp;<span class="op" id="4984134">=</span>&nbsp;<span class="builtinfunc" id="4984136">append</span><span class="op" id="4984142">(</span><span class="ident" id="4984143">start</span><span class="op" id="4984148">.</span><span class="ident" id="4984149">Attr</span><span class="op" id="4984153">,</span>&nbsp;<span class="ident" id="4984155">Attr</span><span class="op" id="4984159">{</span><span class="ident" id="4984160">name</span><span class="op" id="4984164">,</span>&nbsp;<span class="ident" id="4984166">s</span><span class="op" id="4984167">}</span><span class="op" id="4984168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4984171">}</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4984175">if</span>&nbsp;<span class="ident" id="4984178">err</span>&nbsp;<span class="op" id="4984182">:=</span>&nbsp;<span class="ident" id="4984185">p</span><span class="op" id="4984186">.</span><span class="ident" id="4984187">writeStart</span><span class="op" id="4984197">(</span><span class="op" id="4984198">&amp;</span><span class="ident" id="4984199">start</span><span class="op" id="4984204">)</span><span class="op" id="4984205">;</span>&nbsp;<span class="ident" id="4984207">err</span>&nbsp;<span class="op" id="4984211">!=</span>&nbsp;<span class="ident" id="4984214">nil</span>&nbsp;<span class="op" id="4984218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4984222">return</span>&nbsp;<span class="ident" id="4984229">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4984234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4984238">if</span>&nbsp;<span class="ident" id="4984241">val</span><span class="op" id="4984244">.</span><span class="ident" id="4984245">Kind</span><span class="op" id="4984249">(</span><span class="op" id="4984250">)</span>&nbsp;<span class="op" id="4984252">==</span>&nbsp;<span class="ident" id="4984255">reflect</span><span class="op" id="4984262">.</span><span class="ident" id="4984263">Struct</span>&nbsp;<span class="op" id="4984270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984274">err</span>&nbsp;<span class="op" id="4984278">=</span>&nbsp;<span class="ident" id="4984280">p</span><span class="op" id="4984281">.</span><span class="ident" id="4984282">marshalStruct</span><span class="op" id="4984295">(</span><span class="ident" id="4984296">tinfo</span><span class="op" id="4984301">,</span>&nbsp;<span class="ident" id="4984303">val</span><span class="op" id="4984306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4984309">}</span>&nbsp;<span class="keyword" id="4984311">else</span>&nbsp;<span class="op" id="4984316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984320">s</span><span class="op" id="4984321">,</span>&nbsp;<span class="ident" id="4984323">b</span><span class="op" id="4984324">,</span>&nbsp;<span class="ident" id="4984326">err1</span>&nbsp;<span class="op" id="4984331">:=</span>&nbsp;<span class="ident" id="4984334">p</span><span class="op" id="4984335">.</span><span class="ident" id="4984336">marshalSimple</span><span class="op" id="4984349">(</span><span class="ident" id="4984350">typ</span><span class="op" id="4984353">,</span>&nbsp;<span class="ident" id="4984355">val</span><span class="op" id="4984358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4984362">if</span>&nbsp;<span class="ident" id="4984365">err1</span>&nbsp;<span class="op" id="4984370">!=</span>&nbsp;<span class="ident" id="4984373">nil</span>&nbsp;<span class="op" id="4984377">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984382">err</span>&nbsp;<span class="op" id="4984386">=</span>&nbsp;<span class="ident" id="4984388">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4984395">}</span>&nbsp;<span class="keyword" id="4984397">else</span>&nbsp;<span class="keyword" id="4984402">if</span>&nbsp;<span class="ident" id="4984405">b</span>&nbsp;<span class="op" id="4984407">!=</span>&nbsp;<span class="ident" id="4984410">nil</span>&nbsp;<span class="op" id="4984414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984419">EscapeText</span><span class="op" id="4984429">(</span><span class="ident" id="4984430">p</span><span class="op" id="4984431">,</span>&nbsp;<span class="ident" id="4984433">b</span><span class="op" id="4984434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4984438">}</span>&nbsp;<span class="keyword" id="4984440">else</span>&nbsp;<span class="op" id="4984445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984450">p</span><span class="op" id="4984451">.</span><span class="ident" id="4984452">EscapeString</span><span class="op" id="4984464">(</span><span class="ident" id="4984465">s</span><span class="op" id="4984466">)</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4984470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4984473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4984476">if</span>&nbsp;<span class="ident" id="4984479">err</span>&nbsp;<span class="op" id="4984483">!=</span>&nbsp;<span class="ident" id="4984486">nil</span>&nbsp;<span class="op" id="4984490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4984494">return</span>&nbsp;<span class="ident" id="4984501">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4984506">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4984510">if</span>&nbsp;<span class="ident" id="4984513">err</span>&nbsp;<span class="op" id="4984517">:=</span>&nbsp;<span class="ident" id="4984520">p</span><span class="op" id="4984521">.</span><span class="ident" id="4984522">writeEnd</span><span class="op" id="4984530">(</span><span class="ident" id="4984531">start</span><span class="op" id="4984536">.</span><span class="ident" id="4984537">Name</span><span class="op" id="4984541">)</span><span class="op" id="4984542">;</span>&nbsp;<span class="ident" id="4984544">err</span>&nbsp;<span class="op" id="4984548">!=</span>&nbsp;<span class="ident" id="4984551">nil</span>&nbsp;<span class="op" id="4984555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4984559">return</span>&nbsp;<span class="ident" id="4984566">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4984571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4984575">return</span>&nbsp;<span class="ident" id="4984582">p</span><span class="op" id="4984583">.</span><span class="ident" id="4984584">cachedWriteError</span><span class="op" id="4984600">(</span><span class="op" id="4984601">)</span><br>
<span class="lineno"></span><span class="op" id="4984603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4984606">//&nbsp;defaultStart&nbsp;returns&nbsp;the&nbsp;default&nbsp;start&nbsp;element&nbsp;to&nbsp;use,</span><br>
<span class="lineno"></span><span class="comment" id="4984664">//&nbsp;given&nbsp;the&nbsp;reflect&nbsp;type,&nbsp;field&nbsp;info,&nbsp;and&nbsp;start&nbsp;template.</span><br>
<span class="lineno">555</span><span class="keyword" id="4984723">func</span>&nbsp;<span class="ident" id="4984728">defaultStart</span><span class="op" id="4984740">(</span><span class="ident" id="4984741">typ</span>&nbsp;<span class="ident" id="4984745">reflect</span><span class="op" id="4984752">.</span><span class="ident" id="4984753">Type</span><span class="op" id="4984757">,</span>&nbsp;<span class="ident" id="4984759">finfo</span>&nbsp;<span class="op" id="4984765">*</span><span class="ident" id="4984766">fieldInfo</span><span class="op" id="4984775">,</span>&nbsp;<span class="ident" id="4984777">startTemplate</span>&nbsp;<span class="op" id="4984791">*</span><span class="ident" id="4984792">StartElement</span><span class="op" id="4984804">)</span>&nbsp;<span class="ident" id="4984806">StartElement</span>&nbsp;<span class="op" id="4984819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4984822">var</span>&nbsp;<span class="ident" id="4984826">start</span>&nbsp;<span class="ident" id="4984832">StartElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4984846">//&nbsp;Precedence&nbsp;for&nbsp;the&nbsp;XML&nbsp;element&nbsp;name&nbsp;is&nbsp;as&nbsp;above,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4984899">//&nbsp;except&nbsp;that&nbsp;we&nbsp;do&nbsp;not&nbsp;look&nbsp;inside&nbsp;structs&nbsp;for&nbsp;the&nbsp;first&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4984966">if</span>&nbsp;<span class="ident" id="4984969">startTemplate</span>&nbsp;<span class="op" id="4984983">!=</span>&nbsp;<span class="ident" id="4984986">nil</span>&nbsp;<span class="op" id="4984990">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984994">start</span><span class="op" id="4984999">.</span><span class="ident" id="4985000">Name</span>&nbsp;<span class="op" id="4985005">=</span>&nbsp;<span class="ident" id="4985007">startTemplate</span><span class="op" id="4985020">.</span><span class="ident" id="4985021">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985028">start</span><span class="op" id="4985033">.</span><span class="ident" id="4985034">Attr</span>&nbsp;<span class="op" id="4985039">=</span>&nbsp;<span class="builtinfunc" id="4985041">append</span><span class="op" id="4985047">(</span><span class="ident" id="4985048">start</span><span class="op" id="4985053">.</span><span class="ident" id="4985054">Attr</span><span class="op" id="4985058">,</span>&nbsp;<span class="ident" id="4985060">startTemplate</span><span class="op" id="4985073">.</span><span class="ident" id="4985074">Attr</span><span class="op" id="4985078">...</span><span class="op" id="4985081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4985084">}</span>&nbsp;<span class="keyword" id="4985086">else</span>&nbsp;<span class="keyword" id="4985091">if</span>&nbsp;<span class="ident" id="4985094">finfo</span>&nbsp;<span class="op" id="4985100">!=</span>&nbsp;<span class="ident" id="4985103">nil</span>&nbsp;<span class="op" id="4985107">&amp;&amp;</span>&nbsp;<span class="ident" id="4985110">finfo</span><span class="op" id="4985115">.</span><span class="ident" id="4985116">name</span>&nbsp;<span class="op" id="4985121">!=</span>&nbsp;<span class="string" id="4985124">&#34;&#34;</span>&nbsp;<span class="op" id="4985127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985131">start</span><span class="op" id="4985136">.</span><span class="ident" id="4985137">Name</span><span class="op" id="4985141">.</span><span class="ident" id="4985142">Local</span>&nbsp;<span class="op" id="4985148">=</span>&nbsp;<span class="ident" id="4985150">finfo</span><span class="op" id="4985155">.</span><span class="ident" id="4985156">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985163">start</span><span class="op" id="4985168">.</span><span class="ident" id="4985169">Name</span><span class="op" id="4985173">.</span><span class="ident" id="4985174">Space</span>&nbsp;<span class="op" id="4985180">=</span>&nbsp;<span class="ident" id="4985182">finfo</span><span class="op" id="4985187">.</span><span class="ident" id="4985188">xmlns</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4985195">}</span>&nbsp;<span class="keyword" id="4985197">else</span>&nbsp;<span class="keyword" id="4985202">if</span>&nbsp;<span class="ident" id="4985205">typ</span><span class="op" id="4985208">.</span><span class="ident" id="4985209">Name</span><span class="op" id="4985213">(</span><span class="op" id="4985214">)</span>&nbsp;<span class="op" id="4985216">!=</span>&nbsp;<span class="string" id="4985219">&#34;&#34;</span>&nbsp;<span class="op" id="4985222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985226">start</span><span class="op" id="4985231">.</span><span class="ident" id="4985232">Name</span><span class="op" id="4985236">.</span><span class="ident" id="4985237">Local</span>&nbsp;<span class="op" id="4985243">=</span>&nbsp;<span class="ident" id="4985245">typ</span><span class="op" id="4985248">.</span><span class="ident" id="4985249">Name</span><span class="op" id="4985253">(</span><span class="op" id="4985254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4985257">}</span>&nbsp;<span class="keyword" id="4985259">else</span>&nbsp;<span class="op" id="4985264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4985268">//&nbsp;Must&nbsp;be&nbsp;a&nbsp;pointer&nbsp;to&nbsp;a&nbsp;named&nbsp;type,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4985308">//&nbsp;since&nbsp;it&nbsp;has&nbsp;the&nbsp;Marshaler&nbsp;methods.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985349">start</span><span class="op" id="4985354">.</span><span class="ident" id="4985355">Name</span><span class="op" id="4985359">.</span><span class="ident" id="4985360">Local</span>&nbsp;<span class="op" id="4985366">=</span>&nbsp;<span class="ident" id="4985368">typ</span><span class="op" id="4985371">.</span><span class="ident" id="4985372">Elem</span><span class="op" id="4985376">(</span><span class="op" id="4985377">)</span><span class="op" id="4985378">.</span><span class="ident" id="4985379">Name</span><span class="op" id="4985383">(</span><span class="op" id="4985384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4985387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4985390">return</span>&nbsp;<span class="ident" id="4985397">start</span><br>
<span class="lineno"></span><span class="op" id="4985403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">575</span><span class="comment" id="4985406">//&nbsp;marshalInterface&nbsp;marshals&nbsp;a&nbsp;Marshaler&nbsp;interface&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4985464">func</span>&nbsp;<span class="op" id="4985469">(</span><span class="ident" id="4985470">p</span>&nbsp;<span class="op" id="4985472">*</span><span class="ident" id="4985473">printer</span><span class="op" id="4985480">)</span>&nbsp;<span class="ident" id="4985482">marshalInterface</span><span class="op" id="4985498">(</span><span class="ident" id="4985499">val</span>&nbsp;<span class="ident" id="4985503">Marshaler</span><span class="op" id="4985512">,</span>&nbsp;<span class="ident" id="4985514">start</span>&nbsp;<span class="ident" id="4985520">StartElement</span><span class="op" id="4985532">)</span>&nbsp;<span class="builtintype" id="4985534">error</span>&nbsp;<span class="op" id="4985540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4985543">//&nbsp;Push&nbsp;a&nbsp;marker&nbsp;onto&nbsp;the&nbsp;tag&nbsp;stack&nbsp;so&nbsp;that&nbsp;MarshalXML</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4985599">//&nbsp;cannot&nbsp;close&nbsp;the&nbsp;XML&nbsp;tags&nbsp;that&nbsp;it&nbsp;did&nbsp;not&nbsp;open.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985651">p</span><span class="op" id="4985652">.</span><span class="ident" id="4985653">tags</span>&nbsp;<span class="op" id="4985658">=</span>&nbsp;<span class="builtinfunc" id="4985660">append</span><span class="op" id="4985666">(</span><span class="ident" id="4985667">p</span><span class="op" id="4985668">.</span><span class="ident" id="4985669">tags</span><span class="op" id="4985673">,</span>&nbsp;<span class="ident" id="4985675">Name</span><span class="op" id="4985679">{</span><span class="op" id="4985680">}</span><span class="op" id="4985681">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985684">n</span>&nbsp;<span class="op" id="4985686">:=</span>&nbsp;<span class="builtinfunc" id="4985689">len</span><span class="op" id="4985692">(</span><span class="ident" id="4985693">p</span><span class="op" id="4985694">.</span><span class="ident" id="4985695">tags</span><span class="op" id="4985699">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985703">err</span>&nbsp;<span class="op" id="4985707">:=</span>&nbsp;<span class="ident" id="4985710">val</span><span class="op" id="4985713">.</span><span class="ident" id="4985714">MarshalXML</span><span class="op" id="4985724">(</span><span class="ident" id="4985725">p</span><span class="op" id="4985726">.</span><span class="ident" id="4985727">encoder</span><span class="op" id="4985734">,</span>&nbsp;<span class="ident" id="4985736">start</span><span class="op" id="4985741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4985744">if</span>&nbsp;<span class="ident" id="4985747">err</span>&nbsp;<span class="op" id="4985751">!=</span>&nbsp;<span class="ident" id="4985754">nil</span>&nbsp;<span class="op" id="4985758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4985762">return</span>&nbsp;<span class="ident" id="4985769">err</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4985774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4985778">//&nbsp;Make&nbsp;sure&nbsp;MarshalXML&nbsp;closed&nbsp;all&nbsp;its&nbsp;tags.&nbsp;p.tags[n-1]&nbsp;is&nbsp;the&nbsp;mark.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4985849">if</span>&nbsp;<span class="builtinfunc" id="4985852">len</span><span class="op" id="4985855">(</span><span class="ident" id="4985856">p</span><span class="op" id="4985857">.</span><span class="ident" id="4985858">tags</span><span class="op" id="4985862">)</span>&nbsp;<span class="op" id="4985864">&gt;</span>&nbsp;<span class="ident" id="4985866">n</span>&nbsp;<span class="op" id="4985868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4985872">return</span>&nbsp;<span class="ident" id="4985879">fmt</span><span class="op" id="4985882">.</span><span class="ident" id="4985883">Errorf</span><span class="op" id="4985889">(</span><span class="string" id="4985890">&#34;xml:&nbsp;%s.MarshalXML&nbsp;wrote&nbsp;invalid&nbsp;XML:&nbsp;&lt;%s&gt;&nbsp;not&nbsp;closed&#34;</span><span class="op" id="4985945">,</span>&nbsp;<span class="ident" id="4985947">receiverType</span><span class="op" id="4985959">(</span><span class="ident" id="4985960">val</span><span class="op" id="4985963">)</span><span class="op" id="4985964">,</span>&nbsp;<span class="ident" id="4985966">p</span><span class="op" id="4985967">.</span><span class="ident" id="4985968">tags</span><span class="op" id="4985972">[</span><span class="builtinfunc" id="4985973">len</span><span class="op" id="4985976">(</span><span class="ident" id="4985977">p</span><span class="op" id="4985978">.</span><span class="ident" id="4985979">tags</span><span class="op" id="4985983">)</span><span class="op" id="4985984">-</span><span class="num" id="4985985">1</span><span class="op" id="4985986">]</span><span class="op" id="4985987">.</span><span class="ident" id="4985988">Local</span><span class="op" id="4985993">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4985996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985999">p</span><span class="op" id="4986000">.</span><span class="ident" id="4986001">tags</span>&nbsp;<span class="op" id="4986006">=</span>&nbsp;<span class="ident" id="4986008">p</span><span class="op" id="4986009">.</span><span class="ident" id="4986010">tags</span><span class="op" id="4986014">[</span><span class="op" id="4986015">:</span><span class="ident" id="4986016">n</span><span class="op" id="4986017">-</span><span class="num" id="4986018">1</span><span class="op" id="4986019">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4986022">return</span>&nbsp;<span class="ident" id="4986029">nil</span><br>
<span class="lineno"></span><span class="op" id="4986033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">595</span><span class="comment" id="4986036">//&nbsp;marshalTextInterface&nbsp;marshals&nbsp;a&nbsp;TextMarshaler&nbsp;interface&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4986102">func</span>&nbsp;<span class="op" id="4986107">(</span><span class="ident" id="4986108">p</span>&nbsp;<span class="op" id="4986110">*</span><span class="ident" id="4986111">printer</span><span class="op" id="4986118">)</span>&nbsp;<span class="ident" id="4986120">marshalTextInterface</span><span class="op" id="4986140">(</span><span class="ident" id="4986141">val</span>&nbsp;<span class="ident" id="4986145">encoding</span><span class="op" id="4986153">.</span><span class="ident" id="4986154">TextMarshaler</span><span class="op" id="4986167">,</span>&nbsp;<span class="ident" id="4986169">start</span>&nbsp;<span class="ident" id="4986175">StartElement</span><span class="op" id="4986187">)</span>&nbsp;<span class="builtintype" id="4986189">error</span>&nbsp;<span class="op" id="4986195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4986198">if</span>&nbsp;<span class="ident" id="4986201">err</span>&nbsp;<span class="op" id="4986205">:=</span>&nbsp;<span class="ident" id="4986208">p</span><span class="op" id="4986209">.</span><span class="ident" id="4986210">writeStart</span><span class="op" id="4986220">(</span><span class="op" id="4986221">&amp;</span><span class="ident" id="4986222">start</span><span class="op" id="4986227">)</span><span class="op" id="4986228">;</span>&nbsp;<span class="ident" id="4986230">err</span>&nbsp;<span class="op" id="4986234">!=</span>&nbsp;<span class="ident" id="4986237">nil</span>&nbsp;<span class="op" id="4986241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4986245">return</span>&nbsp;<span class="ident" id="4986252">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4986257">}</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4986260">text</span><span class="op" id="4986264">,</span>&nbsp;<span class="ident" id="4986266">err</span>&nbsp;<span class="op" id="4986270">:=</span>&nbsp;<span class="ident" id="4986273">val</span><span class="op" id="4986276">.</span><span class="ident" id="4986277">MarshalText</span><span class="op" id="4986288">(</span><span class="op" id="4986289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4986292">if</span>&nbsp;<span class="ident" id="4986295">err</span>&nbsp;<span class="op" id="4986299">!=</span>&nbsp;<span class="ident" id="4986302">nil</span>&nbsp;<span class="op" id="4986306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4986310">return</span>&nbsp;<span class="ident" id="4986317">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4986322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4986325">EscapeText</span><span class="op" id="4986335">(</span><span class="ident" id="4986336">p</span><span class="op" id="4986337">,</span>&nbsp;<span class="ident" id="4986339">text</span><span class="op" id="4986343">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4986346">return</span>&nbsp;<span class="ident" id="4986353">p</span><span class="op" id="4986354">.</span><span class="ident" id="4986355">writeEnd</span><span class="op" id="4986363">(</span><span class="ident" id="4986364">start</span><span class="op" id="4986369">.</span><span class="ident" id="4986370">Name</span><span class="op" id="4986374">)</span><br>
<span class="lineno"></span><span class="op" id="4986376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4986379">//&nbsp;writeStart&nbsp;writes&nbsp;the&nbsp;given&nbsp;start&nbsp;element.</span><br>
<span class="lineno"></span><span class="keyword" id="4986425">func</span>&nbsp;<span class="op" id="4986430">(</span><span class="ident" id="4986431">p</span>&nbsp;<span class="op" id="4986433">*</span><span class="ident" id="4986434">printer</span><span class="op" id="4986441">)</span>&nbsp;<span class="ident" id="4986443">writeStart</span><span class="op" id="4986453">(</span><span class="ident" id="4986454">start</span>&nbsp;<span class="op" id="4986460">*</span><span class="ident" id="4986461">StartElement</span><span class="op" id="4986473">)</span>&nbsp;<span class="builtintype" id="4986475">error</span>&nbsp;<span class="op" id="4986481">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4986484">if</span>&nbsp;<span class="ident" id="4986487">start</span><span class="op" id="4986492">.</span><span class="ident" id="4986493">Name</span><span class="op" id="4986497">.</span><span class="ident" id="4986498">Local</span>&nbsp;<span class="op" id="4986504">==</span>&nbsp;<span class="string" id="4986507">&#34;&#34;</span>&nbsp;<span class="op" id="4986510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4986514">return</span>&nbsp;<span class="ident" id="4986521">fmt</span><span class="op" id="4986524">.</span><span class="ident" id="4986525">Errorf</span><span class="op" id="4986531">(</span><span class="string" id="4986532">&#34;xml:&nbsp;start&nbsp;tag&nbsp;with&nbsp;no&nbsp;name&#34;</span><span class="op" id="4986561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4986564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4986568">p</span><span class="op" id="4986569">.</span><span class="ident" id="4986570">tags</span>&nbsp;<span class="op" id="4986575">=</span>&nbsp;<span class="builtinfunc" id="4986577">append</span><span class="op" id="4986583">(</span><span class="ident" id="4986584">p</span><span class="op" id="4986585">.</span><span class="ident" id="4986586">tags</span><span class="op" id="4986590">,</span>&nbsp;<span class="ident" id="4986592">start</span><span class="op" id="4986597">.</span><span class="ident" id="4986598">Name</span><span class="op" id="4986602">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4986605">p</span><span class="op" id="4986606">.</span><span class="ident" id="4986607">markPrefix</span><span class="op" id="4986617">(</span><span class="op" id="4986618">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4986622">p</span><span class="op" id="4986623">.</span><span class="ident" id="4986624">writeIndent</span><span class="op" id="4986635">(</span><span class="num" id="4986636">1</span><span class="op" id="4986637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4986640">p</span><span class="op" id="4986641">.</span><span class="ident" id="4986642">WriteByte</span><span class="op" id="4986651">(</span><span class="string" id="4986652">&#39;&lt;&#39;</span><span class="op" id="4986655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4986658">p</span><span class="op" id="4986659">.</span><span class="ident" id="4986660">WriteString</span><span class="op" id="4986671">(</span><span class="ident" id="4986672">start</span><span class="op" id="4986677">.</span><span class="ident" id="4986678">Name</span><span class="op" id="4986682">.</span><span class="ident" id="4986683">Local</span><span class="op" id="4986688">)</span><br>
<span class="lineno">620</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4986692">if</span>&nbsp;<span class="ident" id="4986695">start</span><span class="op" id="4986700">.</span><span class="ident" id="4986701">Name</span><span class="op" id="4986705">.</span><span class="ident" id="4986706">Space</span>&nbsp;<span class="op" id="4986712">!=</span>&nbsp;<span class="string" id="4986715">&#34;&#34;</span>&nbsp;<span class="op" id="4986718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4986722">p</span><span class="op" id="4986723">.</span><span class="ident" id="4986724">WriteString</span><span class="op" id="4986735">(</span><span class="string" id="4986736">`&nbsp;xmlns=&#34;`</span><span class="op" id="4986746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4986750">p</span><span class="op" id="4986751">.</span><span class="ident" id="4986752">EscapeString</span><span class="op" id="4986764">(</span><span class="ident" id="4986765">start</span><span class="op" id="4986770">.</span><span class="ident" id="4986771">Name</span><span class="op" id="4986775">.</span><span class="ident" id="4986776">Space</span><span class="op" id="4986781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4986785">p</span><span class="op" id="4986786">.</span><span class="ident" id="4986787">WriteByte</span><span class="op" id="4986796">(</span><span class="string" id="4986797">&#39;&#34;&#39;</span><span class="op" id="4986800">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4986803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4986807">//&nbsp;Attributes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4986822">for</span>&nbsp;<span class="ident" id="4986826">_</span><span class="op" id="4986827">,</span>&nbsp;<span class="ident" id="4986829">attr</span>&nbsp;<span class="op" id="4986834">:=</span>&nbsp;<span class="keyword" id="4986837">range</span>&nbsp;<span class="ident" id="4986843">start</span><span class="op" id="4986848">.</span><span class="ident" id="4986849">Attr</span>&nbsp;<span class="op" id="4986854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4986858">name</span>&nbsp;<span class="op" id="4986863">:=</span>&nbsp;<span class="ident" id="4986866">attr</span><span class="op" id="4986870">.</span><span class="ident" id="4986871">Name</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4986878">if</span>&nbsp;<span class="ident" id="4986881">name</span><span class="op" id="4986885">.</span><span class="ident" id="4986886">Local</span>&nbsp;<span class="op" id="4986892">==</span>&nbsp;<span class="string" id="4986895">&#34;&#34;</span>&nbsp;<span class="op" id="4986898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4986903">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4986914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4986918">p</span><span class="op" id="4986919">.</span><span class="ident" id="4986920">WriteByte</span><span class="op" id="4986929">(</span><span class="string" id="4986930">&#39;&nbsp;&#39;</span><span class="op" id="4986933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4986937">if</span>&nbsp;<span class="ident" id="4986940">name</span><span class="op" id="4986944">.</span><span class="ident" id="4986945">Space</span>&nbsp;<span class="op" id="4986951">!=</span>&nbsp;<span class="string" id="4986954">&#34;&#34;</span>&nbsp;<span class="op" id="4986957">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4986962">p</span><span class="op" id="4986963">.</span><span class="ident" id="4986964">WriteString</span><span class="op" id="4986975">(</span><span class="ident" id="4986976">p</span><span class="op" id="4986977">.</span><span class="ident" id="4986978">createAttrPrefix</span><span class="op" id="4986994">(</span><span class="ident" id="4986995">name</span><span class="op" id="4986999">.</span><span class="ident" id="4987000">Space</span><span class="op" id="4987005">)</span><span class="op" id="4987006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987011">p</span><span class="op" id="4987012">.</span><span class="ident" id="4987013">WriteByte</span><span class="op" id="4987022">(</span><span class="string" id="4987023">&#39;:&#39;</span><span class="op" id="4987026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4987030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987034">p</span><span class="op" id="4987035">.</span><span class="ident" id="4987036">WriteString</span><span class="op" id="4987047">(</span><span class="ident" id="4987048">name</span><span class="op" id="4987052">.</span><span class="ident" id="4987053">Local</span><span class="op" id="4987058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987062">p</span><span class="op" id="4987063">.</span><span class="ident" id="4987064">WriteString</span><span class="op" id="4987075">(</span><span class="string" id="4987076">`=&#34;`</span><span class="op" id="4987080">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987084">p</span><span class="op" id="4987085">.</span><span class="ident" id="4987086">EscapeString</span><span class="op" id="4987098">(</span><span class="ident" id="4987099">attr</span><span class="op" id="4987103">.</span><span class="ident" id="4987104">Value</span><span class="op" id="4987109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987113">p</span><span class="op" id="4987114">.</span><span class="ident" id="4987115">WriteByte</span><span class="op" id="4987124">(</span><span class="string" id="4987125">&#39;&#34;&#39;</span><span class="op" id="4987128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4987131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987134">p</span><span class="op" id="4987135">.</span><span class="ident" id="4987136">WriteByte</span><span class="op" id="4987145">(</span><span class="string" id="4987146">&#39;&gt;&#39;</span><span class="op" id="4987149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4987152">return</span>&nbsp;<span class="ident" id="4987159">nil</span><br>
<span class="lineno">645</span><span class="op" id="4987163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4987166">func</span>&nbsp;<span class="op" id="4987171">(</span><span class="ident" id="4987172">p</span>&nbsp;<span class="op" id="4987174">*</span><span class="ident" id="4987175">printer</span><span class="op" id="4987182">)</span>&nbsp;<span class="ident" id="4987184">writeEnd</span><span class="op" id="4987192">(</span><span class="ident" id="4987193">name</span>&nbsp;<span class="ident" id="4987198">Name</span><span class="op" id="4987202">)</span>&nbsp;<span class="builtintype" id="4987204">error</span>&nbsp;<span class="op" id="4987210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4987213">if</span>&nbsp;<span class="ident" id="4987216">name</span><span class="op" id="4987220">.</span><span class="ident" id="4987221">Local</span>&nbsp;<span class="op" id="4987227">==</span>&nbsp;<span class="string" id="4987230">&#34;&#34;</span>&nbsp;<span class="op" id="4987233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4987237">return</span>&nbsp;<span class="ident" id="4987244">fmt</span><span class="op" id="4987247">.</span><span class="ident" id="4987248">Errorf</span><span class="op" id="4987254">(</span><span class="string" id="4987255">&#34;xml:&nbsp;end&nbsp;tag&nbsp;with&nbsp;no&nbsp;name&#34;</span><span class="op" id="4987282">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4987285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4987288">if</span>&nbsp;<span class="builtinfunc" id="4987291">len</span><span class="op" id="4987294">(</span><span class="ident" id="4987295">p</span><span class="op" id="4987296">.</span><span class="ident" id="4987297">tags</span><span class="op" id="4987301">)</span>&nbsp;<span class="op" id="4987303">==</span>&nbsp;<span class="num" id="4987306">0</span>&nbsp;<span class="op" id="4987308">||</span>&nbsp;<span class="ident" id="4987311">p</span><span class="op" id="4987312">.</span><span class="ident" id="4987313">tags</span><span class="op" id="4987317">[</span><span class="builtinfunc" id="4987318">len</span><span class="op" id="4987321">(</span><span class="ident" id="4987322">p</span><span class="op" id="4987323">.</span><span class="ident" id="4987324">tags</span><span class="op" id="4987328">)</span><span class="op" id="4987329">-</span><span class="num" id="4987330">1</span><span class="op" id="4987331">]</span><span class="op" id="4987332">.</span><span class="ident" id="4987333">Local</span>&nbsp;<span class="op" id="4987339">==</span>&nbsp;<span class="string" id="4987342">&#34;&#34;</span>&nbsp;<span class="op" id="4987345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4987349">return</span>&nbsp;<span class="ident" id="4987356">fmt</span><span class="op" id="4987359">.</span><span class="ident" id="4987360">Errorf</span><span class="op" id="4987366">(</span><span class="string" id="4987367">&#34;xml:&nbsp;end&nbsp;tag&nbsp;&lt;/%s&gt;&nbsp;without&nbsp;start&nbsp;tag&#34;</span><span class="op" id="4987405">,</span>&nbsp;<span class="ident" id="4987407">name</span><span class="op" id="4987411">.</span><span class="ident" id="4987412">Local</span><span class="op" id="4987417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4987420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4987423">if</span>&nbsp;<span class="ident" id="4987426">top</span>&nbsp;<span class="op" id="4987430">:=</span>&nbsp;<span class="ident" id="4987433">p</span><span class="op" id="4987434">.</span><span class="ident" id="4987435">tags</span><span class="op" id="4987439">[</span><span class="builtinfunc" id="4987440">len</span><span class="op" id="4987443">(</span><span class="ident" id="4987444">p</span><span class="op" id="4987445">.</span><span class="ident" id="4987446">tags</span><span class="op" id="4987450">)</span><span class="op" id="4987451">-</span><span class="num" id="4987452">1</span><span class="op" id="4987453">]</span><span class="op" id="4987454">;</span>&nbsp;<span class="ident" id="4987456">top</span>&nbsp;<span class="op" id="4987460">!=</span>&nbsp;<span class="ident" id="4987463">name</span>&nbsp;<span class="op" id="4987468">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4987472">if</span>&nbsp;<span class="ident" id="4987475">top</span><span class="op" id="4987478">.</span><span class="ident" id="4987479">Local</span>&nbsp;<span class="op" id="4987485">!=</span>&nbsp;<span class="ident" id="4987488">name</span><span class="op" id="4987492">.</span><span class="ident" id="4987493">Local</span>&nbsp;<span class="op" id="4987499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4987504">return</span>&nbsp;<span class="ident" id="4987511">fmt</span><span class="op" id="4987514">.</span><span class="ident" id="4987515">Errorf</span><span class="op" id="4987521">(</span><span class="string" id="4987522">&#34;xml:&nbsp;end&nbsp;tag&nbsp;&lt;/%s&gt;&nbsp;does&nbsp;not&nbsp;match&nbsp;start&nbsp;tag&nbsp;&lt;%s&gt;&#34;</span><span class="op" id="4987572">,</span>&nbsp;<span class="ident" id="4987574">name</span><span class="op" id="4987578">.</span><span class="ident" id="4987579">Local</span><span class="op" id="4987584">,</span>&nbsp;<span class="ident" id="4987586">top</span><span class="op" id="4987589">.</span><span class="ident" id="4987590">Local</span><span class="op" id="4987595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4987599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4987603">return</span>&nbsp;<span class="ident" id="4987610">fmt</span><span class="op" id="4987613">.</span><span class="ident" id="4987614">Errorf</span><span class="op" id="4987620">(</span><span class="string" id="4987621">&#34;xml:&nbsp;end&nbsp;tag&nbsp;&lt;/%s&gt;&nbsp;in&nbsp;namespace&nbsp;%s&nbsp;does&nbsp;not&nbsp;match&nbsp;start&nbsp;tag&nbsp;&lt;%s&gt;&nbsp;in&nbsp;namespace&nbsp;%s&#34;</span><span class="op" id="4987703">,</span>&nbsp;<span class="ident" id="4987705">name</span><span class="op" id="4987709">.</span><span class="ident" id="4987710">Local</span><span class="op" id="4987715">,</span>&nbsp;<span class="ident" id="4987717">name</span><span class="op" id="4987721">.</span><span class="ident" id="4987722">Space</span><span class="op" id="4987727">,</span>&nbsp;<span class="ident" id="4987729">top</span><span class="op" id="4987732">.</span><span class="ident" id="4987733">Local</span><span class="op" id="4987738">,</span>&nbsp;<span class="ident" id="4987740">top</span><span class="op" id="4987743">.</span><span class="ident" id="4987744">Space</span><span class="op" id="4987749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4987752">}</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987755">p</span><span class="op" id="4987756">.</span><span class="ident" id="4987757">tags</span>&nbsp;<span class="op" id="4987762">=</span>&nbsp;<span class="ident" id="4987764">p</span><span class="op" id="4987765">.</span><span class="ident" id="4987766">tags</span><span class="op" id="4987770">[</span><span class="op" id="4987771">:</span><span class="builtinfunc" id="4987772">len</span><span class="op" id="4987775">(</span><span class="ident" id="4987776">p</span><span class="op" id="4987777">.</span><span class="ident" id="4987778">tags</span><span class="op" id="4987782">)</span><span class="op" id="4987783">-</span><span class="num" id="4987784">1</span><span class="op" id="4987785">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987789">p</span><span class="op" id="4987790">.</span><span class="ident" id="4987791">writeIndent</span><span class="op" id="4987802">(</span><span class="op" id="4987803">-</span><span class="num" id="4987804">1</span><span class="op" id="4987805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987808">p</span><span class="op" id="4987809">.</span><span class="ident" id="4987810">WriteByte</span><span class="op" id="4987819">(</span><span class="string" id="4987820">&#39;&lt;&#39;</span><span class="op" id="4987823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987826">p</span><span class="op" id="4987827">.</span><span class="ident" id="4987828">WriteByte</span><span class="op" id="4987837">(</span><span class="string" id="4987838">&#39;/&#39;</span><span class="op" id="4987841">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987844">p</span><span class="op" id="4987845">.</span><span class="ident" id="4987846">WriteString</span><span class="op" id="4987857">(</span><span class="ident" id="4987858">name</span><span class="op" id="4987862">.</span><span class="ident" id="4987863">Local</span><span class="op" id="4987868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987871">p</span><span class="op" id="4987872">.</span><span class="ident" id="4987873">WriteByte</span><span class="op" id="4987882">(</span><span class="string" id="4987883">&#39;&gt;&#39;</span><span class="op" id="4987886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987889">p</span><span class="op" id="4987890">.</span><span class="ident" id="4987891">popPrefix</span><span class="op" id="4987900">(</span><span class="op" id="4987901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4987904">return</span>&nbsp;<span class="ident" id="4987911">nil</span><br>
<span class="lineno"></span><span class="op" id="4987915">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="keyword" id="4987918">func</span>&nbsp;<span class="op" id="4987923">(</span><span class="ident" id="4987924">p</span>&nbsp;<span class="op" id="4987926">*</span><span class="ident" id="4987927">printer</span><span class="op" id="4987934">)</span>&nbsp;<span class="ident" id="4987936">marshalSimple</span><span class="op" id="4987949">(</span><span class="ident" id="4987950">typ</span>&nbsp;<span class="ident" id="4987954">reflect</span><span class="op" id="4987961">.</span><span class="ident" id="4987962">Type</span><span class="op" id="4987966">,</span>&nbsp;<span class="ident" id="4987968">val</span>&nbsp;<span class="ident" id="4987972">reflect</span><span class="op" id="4987979">.</span><span class="ident" id="4987980">Value</span><span class="op" id="4987985">)</span>&nbsp;<span class="op" id="4987987">(</span><span class="builtintype" id="4987988">string</span><span class="op" id="4987994">,</span>&nbsp;<span class="op" id="4987996">[</span><span class="op" id="4987997">]</span><span class="builtintype" id="4987998">byte</span><span class="op" id="4988002">,</span>&nbsp;<span class="builtintype" id="4988004">error</span><span class="op" id="4988009">)</span>&nbsp;<span class="op" id="4988011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988014">switch</span>&nbsp;<span class="ident" id="4988021">val</span><span class="op" id="4988024">.</span><span class="ident" id="4988025">Kind</span><span class="op" id="4988029">(</span><span class="op" id="4988030">)</span>&nbsp;<span class="op" id="4988032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988035">case</span>&nbsp;<span class="ident" id="4988040">reflect</span><span class="op" id="4988047">.</span><span class="ident" id="4988048">Int</span><span class="op" id="4988051">,</span>&nbsp;<span class="ident" id="4988053">reflect</span><span class="op" id="4988060">.</span><span class="ident" id="4988061">Int8</span><span class="op" id="4988065">,</span>&nbsp;<span class="ident" id="4988067">reflect</span><span class="op" id="4988074">.</span><span class="ident" id="4988075">Int16</span><span class="op" id="4988080">,</span>&nbsp;<span class="ident" id="4988082">reflect</span><span class="op" id="4988089">.</span><span class="ident" id="4988090">Int32</span><span class="op" id="4988095">,</span>&nbsp;<span class="ident" id="4988097">reflect</span><span class="op" id="4988104">.</span><span class="ident" id="4988105">Int64</span><span class="op" id="4988110">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988114">return</span>&nbsp;<span class="ident" id="4988121">strconv</span><span class="op" id="4988128">.</span><span class="ident" id="4988129">FormatInt</span><span class="op" id="4988138">(</span><span class="ident" id="4988139">val</span><span class="op" id="4988142">.</span><span class="ident" id="4988143">Int</span><span class="op" id="4988146">(</span><span class="op" id="4988147">)</span><span class="op" id="4988148">,</span>&nbsp;<span class="num" id="4988150">10</span><span class="op" id="4988152">)</span><span class="op" id="4988153">,</span>&nbsp;<span class="ident" id="4988155">nil</span><span class="op" id="4988158">,</span>&nbsp;<span class="ident" id="4988160">nil</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988165">case</span>&nbsp;<span class="ident" id="4988170">reflect</span><span class="op" id="4988177">.</span><span class="ident" id="4988178">Uint</span><span class="op" id="4988182">,</span>&nbsp;<span class="ident" id="4988184">reflect</span><span class="op" id="4988191">.</span><span class="ident" id="4988192">Uint8</span><span class="op" id="4988197">,</span>&nbsp;<span class="ident" id="4988199">reflect</span><span class="op" id="4988206">.</span><span class="ident" id="4988207">Uint16</span><span class="op" id="4988213">,</span>&nbsp;<span class="ident" id="4988215">reflect</span><span class="op" id="4988222">.</span><span class="ident" id="4988223">Uint32</span><span class="op" id="4988229">,</span>&nbsp;<span class="ident" id="4988231">reflect</span><span class="op" id="4988238">.</span><span class="ident" id="4988239">Uint64</span><span class="op" id="4988245">,</span>&nbsp;<span class="ident" id="4988247">reflect</span><span class="op" id="4988254">.</span><span class="ident" id="4988255">Uintptr</span><span class="op" id="4988262">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988266">return</span>&nbsp;<span class="ident" id="4988273">strconv</span><span class="op" id="4988280">.</span><span class="ident" id="4988281">FormatUint</span><span class="op" id="4988291">(</span><span class="ident" id="4988292">val</span><span class="op" id="4988295">.</span><span class="ident" id="4988296">Uint</span><span class="op" id="4988300">(</span><span class="op" id="4988301">)</span><span class="op" id="4988302">,</span>&nbsp;<span class="num" id="4988304">10</span><span class="op" id="4988306">)</span><span class="op" id="4988307">,</span>&nbsp;<span class="ident" id="4988309">nil</span><span class="op" id="4988312">,</span>&nbsp;<span class="ident" id="4988314">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988319">case</span>&nbsp;<span class="ident" id="4988324">reflect</span><span class="op" id="4988331">.</span><span class="ident" id="4988332">Float32</span><span class="op" id="4988339">,</span>&nbsp;<span class="ident" id="4988341">reflect</span><span class="op" id="4988348">.</span><span class="ident" id="4988349">Float64</span><span class="op" id="4988356">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988360">return</span>&nbsp;<span class="ident" id="4988367">strconv</span><span class="op" id="4988374">.</span><span class="ident" id="4988375">FormatFloat</span><span class="op" id="4988386">(</span><span class="ident" id="4988387">val</span><span class="op" id="4988390">.</span><span class="ident" id="4988391">Float</span><span class="op" id="4988396">(</span><span class="op" id="4988397">)</span><span class="op" id="4988398">,</span>&nbsp;<span class="string" id="4988400">&#39;g&#39;</span><span class="op" id="4988403">,</span>&nbsp;<span class="op" id="4988405">-</span><span class="num" id="4988406">1</span><span class="op" id="4988407">,</span>&nbsp;<span class="ident" id="4988409">val</span><span class="op" id="4988412">.</span><span class="ident" id="4988413">Type</span><span class="op" id="4988417">(</span><span class="op" id="4988418">)</span><span class="op" id="4988419">.</span><span class="ident" id="4988420">Bits</span><span class="op" id="4988424">(</span><span class="op" id="4988425">)</span><span class="op" id="4988426">)</span><span class="op" id="4988427">,</span>&nbsp;<span class="ident" id="4988429">nil</span><span class="op" id="4988432">,</span>&nbsp;<span class="ident" id="4988434">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988439">case</span>&nbsp;<span class="ident" id="4988444">reflect</span><span class="op" id="4988451">.</span><span class="ident" id="4988452">String</span><span class="op" id="4988458">:</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988462">return</span>&nbsp;<span class="ident" id="4988469">val</span><span class="op" id="4988472">.</span><span class="ident" id="4988473">String</span><span class="op" id="4988479">(</span><span class="op" id="4988480">)</span><span class="op" id="4988481">,</span>&nbsp;<span class="ident" id="4988483">nil</span><span class="op" id="4988486">,</span>&nbsp;<span class="ident" id="4988488">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988493">case</span>&nbsp;<span class="ident" id="4988498">reflect</span><span class="op" id="4988505">.</span><span class="ident" id="4988506">Bool</span><span class="op" id="4988510">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988514">return</span>&nbsp;<span class="ident" id="4988521">strconv</span><span class="op" id="4988528">.</span><span class="ident" id="4988529">FormatBool</span><span class="op" id="4988539">(</span><span class="ident" id="4988540">val</span><span class="op" id="4988543">.</span><span class="ident" id="4988544">Bool</span><span class="op" id="4988548">(</span><span class="op" id="4988549">)</span><span class="op" id="4988550">)</span><span class="op" id="4988551">,</span>&nbsp;<span class="ident" id="4988553">nil</span><span class="op" id="4988556">,</span>&nbsp;<span class="ident" id="4988558">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988563">case</span>&nbsp;<span class="ident" id="4988568">reflect</span><span class="op" id="4988575">.</span><span class="ident" id="4988576">Array</span><span class="op" id="4988581">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988585">if</span>&nbsp;<span class="ident" id="4988588">typ</span><span class="op" id="4988591">.</span><span class="ident" id="4988592">Elem</span><span class="op" id="4988596">(</span><span class="op" id="4988597">)</span><span class="op" id="4988598">.</span><span class="ident" id="4988599">Kind</span><span class="op" id="4988603">(</span><span class="op" id="4988604">)</span>&nbsp;<span class="op" id="4988606">!=</span>&nbsp;<span class="ident" id="4988609">reflect</span><span class="op" id="4988616">.</span><span class="ident" id="4988617">Uint8</span>&nbsp;<span class="op" id="4988623">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988628">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4988636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4988640">//&nbsp;[...]byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988655">var</span>&nbsp;<span class="ident" id="4988659">bytes</span>&nbsp;<span class="op" id="4988665">[</span><span class="op" id="4988666">]</span><span class="builtintype" id="4988667">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988674">if</span>&nbsp;<span class="ident" id="4988677">val</span><span class="op" id="4988680">.</span><span class="ident" id="4988681">CanAddr</span><span class="op" id="4988688">(</span><span class="op" id="4988689">)</span>&nbsp;<span class="op" id="4988691">{</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4988696">bytes</span>&nbsp;<span class="op" id="4988702">=</span>&nbsp;<span class="ident" id="4988704">val</span><span class="op" id="4988707">.</span><span class="ident" id="4988708">Slice</span><span class="op" id="4988713">(</span><span class="num" id="4988714">0</span><span class="op" id="4988715">,</span>&nbsp;<span class="ident" id="4988717">val</span><span class="op" id="4988720">.</span><span class="ident" id="4988721">Len</span><span class="op" id="4988724">(</span><span class="op" id="4988725">)</span><span class="op" id="4988726">)</span><span class="op" id="4988727">.</span><span class="ident" id="4988728">Bytes</span><span class="op" id="4988733">(</span><span class="op" id="4988734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4988738">}</span>&nbsp;<span class="keyword" id="4988740">else</span>&nbsp;<span class="op" id="4988745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4988750">bytes</span>&nbsp;<span class="op" id="4988756">=</span>&nbsp;<span class="builtinfunc" id="4988758">make</span><span class="op" id="4988762">(</span><span class="op" id="4988763">[</span><span class="op" id="4988764">]</span><span class="builtintype" id="4988765">byte</span><span class="op" id="4988769">,</span>&nbsp;<span class="ident" id="4988771">val</span><span class="op" id="4988774">.</span><span class="ident" id="4988775">Len</span><span class="op" id="4988778">(</span><span class="op" id="4988779">)</span><span class="op" id="4988780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4988785">reflect</span><span class="op" id="4988792">.</span><span class="ident" id="4988793">Copy</span><span class="op" id="4988797">(</span><span class="ident" id="4988798">reflect</span><span class="op" id="4988805">.</span><span class="ident" id="4988806">ValueOf</span><span class="op" id="4988813">(</span><span class="ident" id="4988814">bytes</span><span class="op" id="4988819">)</span><span class="op" id="4988820">,</span>&nbsp;<span class="ident" id="4988822">val</span><span class="op" id="4988825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4988829">}</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988833">return</span>&nbsp;<span class="string" id="4988840">&#34;&#34;</span><span class="op" id="4988842">,</span>&nbsp;<span class="ident" id="4988844">bytes</span><span class="op" id="4988849">,</span>&nbsp;<span class="ident" id="4988851">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988856">case</span>&nbsp;<span class="ident" id="4988861">reflect</span><span class="op" id="4988868">.</span><span class="ident" id="4988869">Slice</span><span class="op" id="4988874">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988878">if</span>&nbsp;<span class="ident" id="4988881">typ</span><span class="op" id="4988884">.</span><span class="ident" id="4988885">Elem</span><span class="op" id="4988889">(</span><span class="op" id="4988890">)</span><span class="op" id="4988891">.</span><span class="ident" id="4988892">Kind</span><span class="op" id="4988896">(</span><span class="op" id="4988897">)</span>&nbsp;<span class="op" id="4988899">!=</span>&nbsp;<span class="ident" id="4988902">reflect</span><span class="op" id="4988909">.</span><span class="ident" id="4988910">Uint8</span>&nbsp;<span class="op" id="4988916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988921">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4988929">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4988933">//&nbsp;[]byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988945">return</span>&nbsp;<span class="string" id="4988952">&#34;&#34;</span><span class="op" id="4988954">,</span>&nbsp;<span class="ident" id="4988956">val</span><span class="op" id="4988959">.</span><span class="ident" id="4988960">Bytes</span><span class="op" id="4988965">(</span><span class="op" id="4988966">)</span><span class="op" id="4988967">,</span>&nbsp;<span class="ident" id="4988969">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4988974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988977">return</span>&nbsp;<span class="string" id="4988984">&#34;&#34;</span><span class="op" id="4988986">,</span>&nbsp;<span class="ident" id="4988988">nil</span><span class="op" id="4988991">,</span>&nbsp;<span class="op" id="4988993">&amp;</span><span class="ident" id="4988994">UnsupportedTypeError</span><span class="op" id="4989014">{</span><span class="ident" id="4989015">typ</span><span class="op" id="4989018">}</span><br>
<span class="lineno"></span><span class="op" id="4989020">}</span><br>
<span class="lineno">705</span><br>
<span class="lineno"></span><span class="keyword" id="4989023">var</span>&nbsp;<span class="ident" id="4989027">ddBytes</span>&nbsp;<span class="op" id="4989035">=</span>&nbsp;<span class="op" id="4989037">[</span><span class="op" id="4989038">]</span><span class="builtintype" id="4989039">byte</span><span class="op" id="4989043">(</span><span class="string" id="4989044">&#34;--&#34;</span><span class="op" id="4989048">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4989051">func</span>&nbsp;<span class="op" id="4989056">(</span><span class="ident" id="4989057">p</span>&nbsp;<span class="op" id="4989059">*</span><span class="ident" id="4989060">printer</span><span class="op" id="4989067">)</span>&nbsp;<span class="ident" id="4989069">marshalStruct</span><span class="op" id="4989082">(</span><span class="ident" id="4989083">tinfo</span>&nbsp;<span class="op" id="4989089">*</span><span class="ident" id="4989090">typeInfo</span><span class="op" id="4989098">,</span>&nbsp;<span class="ident" id="4989100">val</span>&nbsp;<span class="ident" id="4989104">reflect</span><span class="op" id="4989111">.</span><span class="ident" id="4989112">Value</span><span class="op" id="4989117">)</span>&nbsp;<span class="builtintype" id="4989119">error</span>&nbsp;<span class="op" id="4989125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4989128">s</span>&nbsp;<span class="op" id="4989130">:=</span>&nbsp;<span class="ident" id="4989133">parentStack</span><span class="op" id="4989144">{</span><span class="ident" id="4989145">p</span><span class="op" id="4989146">:</span>&nbsp;<span class="ident" id="4989148">p</span><span class="op" id="4989149">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989152">for</span>&nbsp;<span class="ident" id="4989156">i</span>&nbsp;<span class="op" id="4989158">:=</span>&nbsp;<span class="keyword" id="4989161">range</span>&nbsp;<span class="ident" id="4989167">tinfo</span><span class="op" id="4989172">.</span><span class="ident" id="4989173">fields</span>&nbsp;<span class="op" id="4989180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4989184">finfo</span>&nbsp;<span class="op" id="4989190">:=</span>&nbsp;<span class="op" id="4989193">&amp;</span><span class="ident" id="4989194">tinfo</span><span class="op" id="4989199">.</span><span class="ident" id="4989200">fields</span><span class="op" id="4989206">[</span><span class="ident" id="4989207">i</span><span class="op" id="4989208">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989212">if</span>&nbsp;<span class="ident" id="4989215">finfo</span><span class="op" id="4989220">.</span><span class="ident" id="4989221">flags</span><span class="op" id="4989226">&amp;</span><span class="ident" id="4989227">fAttr</span>&nbsp;<span class="op" id="4989233">!=</span>&nbsp;<span class="num" id="4989236">0</span>&nbsp;<span class="op" id="4989238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989243">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4989254">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4989258">vf</span>&nbsp;<span class="op" id="4989261">:=</span>&nbsp;<span class="ident" id="4989264">finfo</span><span class="op" id="4989269">.</span><span class="ident" id="4989270">value</span><span class="op" id="4989275">(</span><span class="ident" id="4989276">val</span><span class="op" id="4989279">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4989284">//&nbsp;Dereference&nbsp;or&nbsp;skip&nbsp;nil&nbsp;pointer,&nbsp;interface&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989340">switch</span>&nbsp;<span class="ident" id="4989347">vf</span><span class="op" id="4989349">.</span><span class="ident" id="4989350">Kind</span><span class="op" id="4989354">(</span><span class="op" id="4989355">)</span>&nbsp;<span class="op" id="4989357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989361">case</span>&nbsp;<span class="ident" id="4989366">reflect</span><span class="op" id="4989373">.</span><span class="ident" id="4989374">Ptr</span><span class="op" id="4989377">,</span>&nbsp;<span class="ident" id="4989379">reflect</span><span class="op" id="4989386">.</span><span class="ident" id="4989387">Interface</span><span class="op" id="4989396">:</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989401">if</span>&nbsp;<span class="op" id="4989404">!</span><span class="ident" id="4989405">vf</span><span class="op" id="4989407">.</span><span class="ident" id="4989408">IsNil</span><span class="op" id="4989413">(</span><span class="op" id="4989414">)</span>&nbsp;<span class="op" id="4989416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4989422">vf</span>&nbsp;<span class="op" id="4989425">=</span>&nbsp;<span class="ident" id="4989427">vf</span><span class="op" id="4989429">.</span><span class="ident" id="4989430">Elem</span><span class="op" id="4989434">(</span><span class="op" id="4989435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4989440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4989444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989449">switch</span>&nbsp;<span class="ident" id="4989456">finfo</span><span class="op" id="4989461">.</span><span class="ident" id="4989462">flags</span>&nbsp;<span class="op" id="4989468">&amp;</span>&nbsp;<span class="ident" id="4989470">fMode</span>&nbsp;<span class="op" id="4989476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989480">case</span>&nbsp;<span class="ident" id="4989485">fCharData</span><span class="op" id="4989494">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989499">if</span>&nbsp;<span class="ident" id="4989502">vf</span><span class="op" id="4989504">.</span><span class="ident" id="4989505">CanInterface</span><span class="op" id="4989517">(</span><span class="op" id="4989518">)</span>&nbsp;<span class="op" id="4989520">&amp;&amp;</span>&nbsp;<span class="ident" id="4989523">vf</span><span class="op" id="4989525">.</span><span class="ident" id="4989526">Type</span><span class="op" id="4989530">(</span><span class="op" id="4989531">)</span><span class="op" id="4989532">.</span><span class="ident" id="4989533">Implements</span><span class="op" id="4989543">(</span><span class="ident" id="4989544">textMarshalerType</span><span class="op" id="4989561">)</span>&nbsp;<span class="op" id="4989563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4989569">data</span><span class="op" id="4989573">,</span>&nbsp;<span class="ident" id="4989575">err</span>&nbsp;<span class="op" id="4989579">:=</span>&nbsp;<span class="ident" id="4989582">vf</span><span class="op" id="4989584">.</span><span class="ident" id="4989585">Interface</span><span class="op" id="4989594">(</span><span class="op" id="4989595">)</span><span class="op" id="4989596">.</span><span class="op" id="4989597">(</span><span class="ident" id="4989598">encoding</span><span class="op" id="4989606">.</span><span class="ident" id="4989607">TextMarshaler</span><span class="op" id="4989620">)</span><span class="op" id="4989621">.</span><span class="ident" id="4989622">MarshalText</span><span class="op" id="4989633">(</span><span class="op" id="4989634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989640">if</span>&nbsp;<span class="ident" id="4989643">err</span>&nbsp;<span class="op" id="4989647">!=</span>&nbsp;<span class="ident" id="4989650">nil</span>&nbsp;<span class="op" id="4989654">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989661">return</span>&nbsp;<span class="ident" id="4989668">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4989676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4989682">Escape</span><span class="op" id="4989688">(</span><span class="ident" id="4989689">p</span><span class="op" id="4989690">,</span>&nbsp;<span class="ident" id="4989692">data</span><span class="op" id="4989696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989702">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4989714">}</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989719">if</span>&nbsp;<span class="ident" id="4989722">vf</span><span class="op" id="4989724">.</span><span class="ident" id="4989725">CanAddr</span><span class="op" id="4989732">(</span><span class="op" id="4989733">)</span>&nbsp;<span class="op" id="4989735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4989741">pv</span>&nbsp;<span class="op" id="4989744">:=</span>&nbsp;<span class="ident" id="4989747">vf</span><span class="op" id="4989749">.</span><span class="ident" id="4989750">Addr</span><span class="op" id="4989754">(</span><span class="op" id="4989755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989761">if</span>&nbsp;<span class="ident" id="4989764">pv</span><span class="op" id="4989766">.</span><span class="ident" id="4989767">CanInterface</span><span class="op" id="4989779">(</span><span class="op" id="4989780">)</span>&nbsp;<span class="op" id="4989782">&amp;&amp;</span>&nbsp;<span class="ident" id="4989785">pv</span><span class="op" id="4989787">.</span><span class="ident" id="4989788">Type</span><span class="op" id="4989792">(</span><span class="op" id="4989793">)</span><span class="op" id="4989794">.</span><span class="ident" id="4989795">Implements</span><span class="op" id="4989805">(</span><span class="ident" id="4989806">textMarshalerType</span><span class="op" id="4989823">)</span>&nbsp;<span class="op" id="4989825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4989832">data</span><span class="op" id="4989836">,</span>&nbsp;<span class="ident" id="4989838">err</span>&nbsp;<span class="op" id="4989842">:=</span>&nbsp;<span class="ident" id="4989845">pv</span><span class="op" id="4989847">.</span><span class="ident" id="4989848">Interface</span><span class="op" id="4989857">(</span><span class="op" id="4989858">)</span><span class="op" id="4989859">.</span><span class="op" id="4989860">(</span><span class="ident" id="4989861">encoding</span><span class="op" id="4989869">.</span><span class="ident" id="4989870">TextMarshaler</span><span class="op" id="4989883">)</span><span class="op" id="4989884">.</span><span class="ident" id="4989885">MarshalText</span><span class="op" id="4989896">(</span><span class="op" id="4989897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989904">if</span>&nbsp;<span class="ident" id="4989907">err</span>&nbsp;<span class="op" id="4989911">!=</span>&nbsp;<span class="ident" id="4989914">nil</span>&nbsp;<span class="op" id="4989918">{</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989926">return</span>&nbsp;<span class="ident" id="4989933">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4989942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4989949">Escape</span><span class="op" id="4989955">(</span><span class="ident" id="4989956">p</span><span class="op" id="4989957">,</span>&nbsp;<span class="ident" id="4989959">data</span><span class="op" id="4989963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989970">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4989983">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4989988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989993">var</span>&nbsp;<span class="ident" id="4989997">scratch</span>&nbsp;<span class="op" id="4990005">[</span><span class="num" id="4990006">64</span><span class="op" id="4990008">]</span><span class="builtintype" id="4990009">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4990017">switch</span>&nbsp;<span class="ident" id="4990024">vf</span><span class="op" id="4990026">.</span><span class="ident" id="4990027">Kind</span><span class="op" id="4990031">(</span><span class="op" id="4990032">)</span>&nbsp;<span class="op" id="4990034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4990039">case</span>&nbsp;<span class="ident" id="4990044">reflect</span><span class="op" id="4990051">.</span><span class="ident" id="4990052">Int</span><span class="op" id="4990055">,</span>&nbsp;<span class="ident" id="4990057">reflect</span><span class="op" id="4990064">.</span><span class="ident" id="4990065">Int8</span><span class="op" id="4990069">,</span>&nbsp;<span class="ident" id="4990071">reflect</span><span class="op" id="4990078">.</span><span class="ident" id="4990079">Int16</span><span class="op" id="4990084">,</span>&nbsp;<span class="ident" id="4990086">reflect</span><span class="op" id="4990093">.</span><span class="ident" id="4990094">Int32</span><span class="op" id="4990099">,</span>&nbsp;<span class="ident" id="4990101">reflect</span><span class="op" id="4990108">.</span><span class="ident" id="4990109">Int64</span><span class="op" id="4990114">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4990120">Escape</span><span class="op" id="4990126">(</span><span class="ident" id="4990127">p</span><span class="op" id="4990128">,</span>&nbsp;<span class="ident" id="4990130">strconv</span><span class="op" id="4990137">.</span><span class="ident" id="4990138">AppendInt</span><span class="op" id="4990147">(</span><span class="ident" id="4990148">scratch</span><span class="op" id="4990155">[</span><span class="op" id="4990156">:</span><span class="num" id="4990157">0</span><span class="op" id="4990158">]</span><span class="op" id="4990159">,</span>&nbsp;<span class="ident" id="4990161">vf</span><span class="op" id="4990163">.</span><span class="ident" id="4990164">Int</span><span class="op" id="4990167">(</span><span class="op" id="4990168">)</span><span class="op" id="4990169">,</span>&nbsp;<span class="num" id="4990171">10</span><span class="op" id="4990173">)</span><span class="op" id="4990174">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4990179">case</span>&nbsp;<span class="ident" id="4990184">reflect</span><span class="op" id="4990191">.</span><span class="ident" id="4990192">Uint</span><span class="op" id="4990196">,</span>&nbsp;<span class="ident" id="4990198">reflect</span><span class="op" id="4990205">.</span><span class="ident" id="4990206">Uint8</span><span class="op" id="4990211">,</span>&nbsp;<span class="ident" id="4990213">reflect</span><span class="op" id="4990220">.</span><span class="ident" id="4990221">Uint16</span><span class="op" id="4990227">,</span>&nbsp;<span class="ident" id="4990229">reflect</span><span class="op" id="4990236">.</span><span class="ident" id="4990237">Uint32</span><span class="op" id="4990243">,</span>&nbsp;<span class="ident" id="4990245">reflect</span><span class="op" id="4990252">.</span><span class="ident" id="4990253">Uint64</span><span class="op" id="4990259">,</span>&nbsp;<span class="ident" id="4990261">reflect</span><span class="op" id="4990268">.</span><span class="ident" id="4990269">Uintptr</span><span class="op" id="4990276">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4990282">Escape</span><span class="op" id="4990288">(</span><span class="ident" id="4990289">p</span><span class="op" id="4990290">,</span>&nbsp;<span class="ident" id="4990292">strconv</span><span class="op" id="4990299">.</span><span class="ident" id="4990300">AppendUint</span><span class="op" id="4990310">(</span><span class="ident" id="4990311">scratch</span><span class="op" id="4990318">[</span><span class="op" id="4990319">:</span><span class="num" id="4990320">0</span><span class="op" id="4990321">]</span><span class="op" id="4990322">,</span>&nbsp;<span class="ident" id="4990324">vf</span><span class="op" id="4990326">.</span><span class="ident" id="4990327">Uint</span><span class="op" id="4990331">(</span><span class="op" id="4990332">)</span><span class="op" id="4990333">,</span>&nbsp;<span class="num" id="4990335">10</span><span class="op" id="4990337">)</span><span class="op" id="4990338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4990343">case</span>&nbsp;<span class="ident" id="4990348">reflect</span><span class="op" id="4990355">.</span><span class="ident" id="4990356">Float32</span><span class="op" id="4990363">,</span>&nbsp;<span class="ident" id="4990365">reflect</span><span class="op" id="4990372">.</span><span class="ident" id="4990373">Float64</span><span class="op" id="4990380">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4990386">Escape</span><span class="op" id="4990392">(</span><span class="ident" id="4990393">p</span><span class="op" id="4990394">,</span>&nbsp;<span class="ident" id="4990396">strconv</span><span class="op" id="4990403">.</span><span class="ident" id="4990404">AppendFloat</span><span class="op" id="4990415">(</span><span class="ident" id="4990416">scratch</span><span class="op" id="4990423">[</span><span class="op" id="4990424">:</span><span class="num" id="4990425">0</span><span class="op" id="4990426">]</span><span class="op" id="4990427">,</span>&nbsp;<span class="ident" id="4990429">vf</span><span class="op" id="4990431">.</span><span class="ident" id="4990432">Float</span><span class="op" id="4990437">(</span><span class="op" id="4990438">)</span><span class="op" id="4990439">,</span>&nbsp;<span class="string" id="4990441">&#39;g&#39;</span><span class="op" id="4990444">,</span>&nbsp;<span class="op" id="4990446">-</span><span class="num" id="4990447">1</span><span class="op" id="4990448">,</span>&nbsp;<span class="ident" id="4990450">vf</span><span class="op" id="4990452">.</span><span class="ident" id="4990453">Type</span><span class="op" id="4990457">(</span><span class="op" id="4990458">)</span><span class="op" id="4990459">.</span><span class="ident" id="4990460">Bits</span><span class="op" id="4990464">(</span><span class="op" id="4990465">)</span><span class="op" id="4990466">)</span><span class="op" id="4990467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4990472">case</span>&nbsp;<span class="ident" id="4990477">reflect</span><span class="op" id="4990484">.</span><span class="ident" id="4990485">Bool</span><span class="op" id="4990489">:</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4990495">Escape</span><span class="op" id="4990501">(</span><span class="ident" id="4990502">p</span><span class="op" id="4990503">,</span>&nbsp;<span class="ident" id="4990505">strconv</span><span class="op" id="4990512">.</span><span class="ident" id="4990513">AppendBool</span><span class="op" id="4990523">(</span><span class="ident" id="4990524">scratch</span><span class="op" id="4990531">[</span><span class="op" id="4990532">:</span><span class="num" id="4990533">0</span><span class="op" id="4990534">]</span><span class="op" id="4990535">,</span>&nbsp;<span class="ident" id="4990537">vf</span><span class="op" id="4990539">.</span><span class="ident" id="4990540">Bool</span><span class="op" id="4990544">(</span><span class="op" id="4990545">)</span><span class="op" id="4990546">)</span><span class="op" id="4990547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4990552">case</span>&nbsp;<span class="ident" id="4990557">reflect</span><span class="op" id="4990564">.</span><span class="ident" id="4990565">String</span><span class="op" id="4990571">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4990577">if</span>&nbsp;<span class="ident" id="4990580">err</span>&nbsp;<span class="op" id="4990584">:=</span>&nbsp;<span class="ident" id="4990587">EscapeText</span><span class="op" id="4990597">(</span><span class="ident" id="4990598">p</span><span class="op" id="4990599">,</span>&nbsp;<span class="op" id="4990601">[</span><span class="op" id="4990602">]</span><span class="builtintype" id="4990603">byte</span><span class="op" id="4990607">(</span><span class="ident" id="4990608">vf</span><span class="op" id="4990610">.</span><span class="ident" id="4990611">String</span><span class="op" id="4990617">(</span><span class="op" id="4990618">)</span><span class="op" id="4990619">)</span><span class="op" id="4990620">)</span><span class="op" id="4990621">;</span>&nbsp;<span class="ident" id="4990623">err</span>&nbsp;<span class="op" id="4990627">!=</span>&nbsp;<span class="ident" id="4990630">nil</span>&nbsp;<span class="op" id="4990634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4990641">return</span>&nbsp;<span class="ident" id="4990648">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4990656">}</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4990661">case</span>&nbsp;<span class="ident" id="4990666">reflect</span><span class="op" id="4990673">.</span><span class="ident" id="4990674">Slice</span><span class="op" id="4990679">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4990685">if</span>&nbsp;<span class="ident" id="4990688">elem</span><span class="op" id="4990692">,</span>&nbsp;<span class="ident" id="4990694">ok</span>&nbsp;<span class="op" id="4990697">:=</span>&nbsp;<span class="ident" id="4990700">vf</span><span class="op" id="4990702">.</span><span class="ident" id="4990703">Interface</span><span class="op" id="4990712">(</span><span class="op" id="4990713">)</span><span class="op" id="4990714">.</span><span class="op" id="4990715">(</span><span class="op" id="4990716">[</span><span class="op" id="4990717">]</span><span class="builtintype" id="4990718">byte</span><span class="op" id="4990722">)</span><span class="op" id="4990723">;</span>&nbsp;<span class="ident" id="4990725">ok</span>&nbsp;<span class="op" id="4990728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4990735">if</span>&nbsp;<span class="ident" id="4990738">err</span>&nbsp;<span class="op" id="4990742">:=</span>&nbsp;<span class="ident" id="4990745">EscapeText</span><span class="op" id="4990755">(</span><span class="ident" id="4990756">p</span><span class="op" id="4990757">,</span>&nbsp;<span class="ident" id="4990759">elem</span><span class="op" id="4990763">)</span><span class="op" id="4990764">;</span>&nbsp;<span class="ident" id="4990766">err</span>&nbsp;<span class="op" id="4990770">!=</span>&nbsp;<span class="ident" id="4990773">nil</span>&nbsp;<span class="op" id="4990777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4990785">return</span>&nbsp;<span class="ident" id="4990792">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4990801">}</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4990807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4990812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4990817">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4990829">case</span>&nbsp;<span class="ident" id="4990834">fComment</span><span class="op" id="4990842">:</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4990847">k</span>&nbsp;<span class="op" id="4990849">:=</span>&nbsp;<span class="ident" id="4990852">vf</span><span class="op" id="4990854">.</span><span class="ident" id="4990855">Kind</span><span class="op" id="4990859">(</span><span class="op" id="4990860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4990865">if</span>&nbsp;<span class="op" id="4990868">!</span><span class="op" id="4990869">(</span><span class="ident" id="4990870">k</span>&nbsp;<span class="op" id="4990872">==</span>&nbsp;<span class="ident" id="4990875">reflect</span><span class="op" id="4990882">.</span><span class="ident" id="4990883">String</span>&nbsp;<span class="op" id="4990890">||</span>&nbsp;<span class="ident" id="4990893">k</span>&nbsp;<span class="op" id="4990895">==</span>&nbsp;<span class="ident" id="4990898">reflect</span><span class="op" id="4990905">.</span><span class="ident" id="4990906">Slice</span>&nbsp;<span class="op" id="4990912">&amp;&amp;</span>&nbsp;<span class="ident" id="4990915">vf</span><span class="op" id="4990917">.</span><span class="ident" id="4990918">Type</span><span class="op" id="4990922">(</span><span class="op" id="4990923">)</span><span class="op" id="4990924">.</span><span class="ident" id="4990925">Elem</span><span class="op" id="4990929">(</span><span class="op" id="4990930">)</span><span class="op" id="4990931">.</span><span class="ident" id="4990932">Kind</span><span class="op" id="4990936">(</span><span class="op" id="4990937">)</span>&nbsp;<span class="op" id="4990939">==</span>&nbsp;<span class="ident" id="4990942">reflect</span><span class="op" id="4990949">.</span><span class="ident" id="4990950">Uint8</span><span class="op" id="4990955">)</span>&nbsp;<span class="op" id="4990957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4990963">return</span>&nbsp;<span class="ident" id="4990970">fmt</span><span class="op" id="4990973">.</span><span class="ident" id="4990974">Errorf</span><span class="op" id="4990980">(</span><span class="string" id="4990981">&#34;xml:&nbsp;bad&nbsp;type&nbsp;for&nbsp;comment&nbsp;field&nbsp;of&nbsp;%s&#34;</span><span class="op" id="4991020">,</span>&nbsp;<span class="ident" id="4991022">val</span><span class="op" id="4991025">.</span><span class="ident" id="4991026">Type</span><span class="op" id="4991030">(</span><span class="op" id="4991031">)</span><span class="op" id="4991032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4991037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991042">if</span>&nbsp;<span class="ident" id="4991045">vf</span><span class="op" id="4991047">.</span><span class="ident" id="4991048">Len</span><span class="op" id="4991051">(</span><span class="op" id="4991052">)</span>&nbsp;<span class="op" id="4991054">==</span>&nbsp;<span class="num" id="4991057">0</span>&nbsp;<span class="op" id="4991059">{</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991065">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4991077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4991082">p</span><span class="op" id="4991083">.</span><span class="ident" id="4991084">writeIndent</span><span class="op" id="4991095">(</span><span class="num" id="4991096">0</span><span class="op" id="4991097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4991102">p</span><span class="op" id="4991103">.</span><span class="ident" id="4991104">WriteString</span><span class="op" id="4991115">(</span><span class="string" id="4991116">&#34;&lt;!--&#34;</span><span class="op" id="4991122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4991127">dashDash</span>&nbsp;<span class="op" id="4991136">:=</span>&nbsp;<span class="builtintype" id="4991139">false</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4991148">dashLast</span>&nbsp;<span class="op" id="4991157">:=</span>&nbsp;<span class="builtintype" id="4991160">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991169">switch</span>&nbsp;<span class="ident" id="4991176">k</span>&nbsp;<span class="op" id="4991178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991183">case</span>&nbsp;<span class="ident" id="4991188">reflect</span><span class="op" id="4991195">.</span><span class="ident" id="4991196">String</span><span class="op" id="4991202">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4991208">s</span>&nbsp;<span class="op" id="4991210">:=</span>&nbsp;<span class="ident" id="4991213">vf</span><span class="op" id="4991215">.</span><span class="ident" id="4991216">String</span><span class="op" id="4991222">(</span><span class="op" id="4991223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4991229">dashDash</span>&nbsp;<span class="op" id="4991238">=</span>&nbsp;<span class="ident" id="4991240">strings</span><span class="op" id="4991247">.</span><span class="ident" id="4991248">Index</span><span class="op" id="4991253">(</span><span class="ident" id="4991254">s</span><span class="op" id="4991255">,</span>&nbsp;<span class="string" id="4991257">&#34;--&#34;</span><span class="op" id="4991261">)</span>&nbsp;<span class="op" id="4991263">&gt;=</span>&nbsp;<span class="num" id="4991266">0</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4991272">dashLast</span>&nbsp;<span class="op" id="4991281">=</span>&nbsp;<span class="ident" id="4991283">s</span><span class="op" id="4991284">[</span><span class="builtinfunc" id="4991285">len</span><span class="op" id="4991288">(</span><span class="ident" id="4991289">s</span><span class="op" id="4991290">)</span><span class="op" id="4991291">-</span><span class="num" id="4991292">1</span><span class="op" id="4991293">]</span>&nbsp;<span class="op" id="4991295">==</span>&nbsp;<span class="string" id="4991298">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991306">if</span>&nbsp;<span class="op" id="4991309">!</span><span class="ident" id="4991310">dashDash</span>&nbsp;<span class="op" id="4991319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4991326">p</span><span class="op" id="4991327">.</span><span class="ident" id="4991328">WriteString</span><span class="op" id="4991339">(</span><span class="ident" id="4991340">s</span><span class="op" id="4991341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4991347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991352">case</span>&nbsp;<span class="ident" id="4991357">reflect</span><span class="op" id="4991364">.</span><span class="ident" id="4991365">Slice</span><span class="op" id="4991370">:</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4991376">b</span>&nbsp;<span class="op" id="4991378">:=</span>&nbsp;<span class="ident" id="4991381">vf</span><span class="op" id="4991383">.</span><span class="ident" id="4991384">Bytes</span><span class="op" id="4991389">(</span><span class="op" id="4991390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4991396">dashDash</span>&nbsp;<span class="op" id="4991405">=</span>&nbsp;<span class="ident" id="4991407">bytes</span><span class="op" id="4991412">.</span><span class="ident" id="4991413">Index</span><span class="op" id="4991418">(</span><span class="ident" id="4991419">b</span><span class="op" id="4991420">,</span>&nbsp;<span class="ident" id="4991422">ddBytes</span><span class="op" id="4991429">)</span>&nbsp;<span class="op" id="4991431">&gt;=</span>&nbsp;<span class="num" id="4991434">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4991440">dashLast</span>&nbsp;<span class="op" id="4991449">=</span>&nbsp;<span class="ident" id="4991451">b</span><span class="op" id="4991452">[</span><span class="builtinfunc" id="4991453">len</span><span class="op" id="4991456">(</span><span class="ident" id="4991457">b</span><span class="op" id="4991458">)</span><span class="op" id="4991459">-</span><span class="num" id="4991460">1</span><span class="op" id="4991461">]</span>&nbsp;<span class="op" id="4991463">==</span>&nbsp;<span class="string" id="4991466">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991474">if</span>&nbsp;<span class="op" id="4991477">!</span><span class="ident" id="4991478">dashDash</span>&nbsp;<span class="op" id="4991487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4991494">p</span><span class="op" id="4991495">.</span><span class="ident" id="4991496">Write</span><span class="op" id="4991501">(</span><span class="ident" id="4991502">b</span><span class="op" id="4991503">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4991509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991514">default</span><span class="op" id="4991521">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4991527">panic</span><span class="op" id="4991532">(</span><span class="string" id="4991533">&#34;can&#39;t&nbsp;happen&#34;</span><span class="op" id="4991547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4991552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991557">if</span>&nbsp;<span class="ident" id="4991560">dashDash</span>&nbsp;<span class="op" id="4991569">{</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991575">return</span>&nbsp;<span class="ident" id="4991582">fmt</span><span class="op" id="4991585">.</span><span class="ident" id="4991586">Errorf</span><span class="op" id="4991592">(</span><span class="string" id="4991593">`xml:&nbsp;comments&nbsp;must&nbsp;not&nbsp;contain&nbsp;&#34;--&#34;`</span><span class="op" id="4991630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4991635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991640">if</span>&nbsp;<span class="ident" id="4991643">dashLast</span>&nbsp;<span class="op" id="4991652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4991658">//&nbsp;&#34;---&gt;&#34;&nbsp;is&nbsp;invalid&nbsp;grammar.&nbsp;Make&nbsp;it&nbsp;&#34;-&nbsp;--&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4991708">p</span><span class="op" id="4991709">.</span><span class="ident" id="4991710">WriteByte</span><span class="op" id="4991719">(</span><span class="string" id="4991720">&#39;&nbsp;&#39;</span><span class="op" id="4991723">)</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4991728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4991733">p</span><span class="op" id="4991734">.</span><span class="ident" id="4991735">WriteString</span><span class="op" id="4991746">(</span><span class="string" id="4991747">&#34;--&gt;&#34;</span><span class="op" id="4991752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991757">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991769">case</span>&nbsp;<span class="ident" id="4991774">fInnerXml</span><span class="op" id="4991783">:</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4991788">iface</span>&nbsp;<span class="op" id="4991794">:=</span>&nbsp;<span class="ident" id="4991797">vf</span><span class="op" id="4991799">.</span><span class="ident" id="4991800">Interface</span><span class="op" id="4991809">(</span><span class="op" id="4991810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991815">switch</span>&nbsp;<span class="ident" id="4991822">raw</span>&nbsp;<span class="op" id="4991826">:=</span>&nbsp;<span class="ident" id="4991829">iface</span><span class="op" id="4991834">.</span><span class="op" id="4991835">(</span><span class="keyword" id="4991836">type</span><span class="op" id="4991840">)</span>&nbsp;<span class="op" id="4991842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991847">case</span>&nbsp;<span class="op" id="4991852">[</span><span class="op" id="4991853">]</span><span class="builtintype" id="4991854">byte</span><span class="op" id="4991858">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4991864">p</span><span class="op" id="4991865">.</span><span class="ident" id="4991866">Write</span><span class="op" id="4991871">(</span><span class="ident" id="4991872">raw</span><span class="op" id="4991875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991881">continue</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991893">case</span>&nbsp;<span class="builtintype" id="4991898">string</span><span class="op" id="4991904">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4991910">p</span><span class="op" id="4991911">.</span><span class="ident" id="4991912">WriteString</span><span class="op" id="4991923">(</span><span class="ident" id="4991924">raw</span><span class="op" id="4991927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991933">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4991945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991950">case</span>&nbsp;<span class="ident" id="4991955">fElement</span><span class="op" id="4991963">,</span>&nbsp;<span class="ident" id="4991965">fElement</span>&nbsp;<span class="op" id="4991974">|</span>&nbsp;<span class="ident" id="4991976">fAny</span><span class="op" id="4991980">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991985">if</span>&nbsp;<span class="ident" id="4991988">err</span>&nbsp;<span class="op" id="4991992">:=</span>&nbsp;<span class="ident" id="4991995">s</span><span class="op" id="4991996">.</span><span class="ident" id="4991997">trim</span><span class="op" id="4992001">(</span><span class="ident" id="4992002">finfo</span><span class="op" id="4992007">.</span><span class="ident" id="4992008">parents</span><span class="op" id="4992015">)</span><span class="op" id="4992016">;</span>&nbsp;<span class="ident" id="4992018">err</span>&nbsp;<span class="op" id="4992022">!=</span>&nbsp;<span class="ident" id="4992025">nil</span>&nbsp;<span class="op" id="4992029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992035">return</span>&nbsp;<span class="ident" id="4992042">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4992049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992054">if</span>&nbsp;<span class="builtinfunc" id="4992057">len</span><span class="op" id="4992060">(</span><span class="ident" id="4992061">finfo</span><span class="op" id="4992066">.</span><span class="ident" id="4992067">parents</span><span class="op" id="4992074">)</span>&nbsp;<span class="op" id="4992076">&gt;</span>&nbsp;<span class="builtinfunc" id="4992078">len</span><span class="op" id="4992081">(</span><span class="ident" id="4992082">s</span><span class="op" id="4992083">.</span><span class="ident" id="4992084">stack</span><span class="op" id="4992089">)</span>&nbsp;<span class="op" id="4992091">{</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992097">if</span>&nbsp;<span class="ident" id="4992100">vf</span><span class="op" id="4992102">.</span><span class="ident" id="4992103">Kind</span><span class="op" id="4992107">(</span><span class="op" id="4992108">)</span>&nbsp;<span class="op" id="4992110">!=</span>&nbsp;<span class="ident" id="4992113">reflect</span><span class="op" id="4992120">.</span><span class="ident" id="4992121">Ptr</span>&nbsp;<span class="op" id="4992125">&amp;&amp;</span>&nbsp;<span class="ident" id="4992128">vf</span><span class="op" id="4992130">.</span><span class="ident" id="4992131">Kind</span><span class="op" id="4992135">(</span><span class="op" id="4992136">)</span>&nbsp;<span class="op" id="4992138">!=</span>&nbsp;<span class="ident" id="4992141">reflect</span><span class="op" id="4992148">.</span><span class="ident" id="4992149">Interface</span>&nbsp;<span class="op" id="4992159">||</span>&nbsp;<span class="op" id="4992162">!</span><span class="ident" id="4992163">vf</span><span class="op" id="4992165">.</span><span class="ident" id="4992166">IsNil</span><span class="op" id="4992171">(</span><span class="op" id="4992172">)</span>&nbsp;<span class="op" id="4992174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992181">if</span>&nbsp;<span class="ident" id="4992184">err</span>&nbsp;<span class="op" id="4992188">:=</span>&nbsp;<span class="ident" id="4992191">s</span><span class="op" id="4992192">.</span><span class="ident" id="4992193">push</span><span class="op" id="4992197">(</span><span class="ident" id="4992198">finfo</span><span class="op" id="4992203">.</span><span class="ident" id="4992204">parents</span><span class="op" id="4992211">[</span><span class="builtinfunc" id="4992212">len</span><span class="op" id="4992215">(</span><span class="ident" id="4992216">s</span><span class="op" id="4992217">.</span><span class="ident" id="4992218">stack</span><span class="op" id="4992223">)</span><span class="op" id="4992224">:</span><span class="op" id="4992225">]</span><span class="op" id="4992226">)</span><span class="op" id="4992227">;</span>&nbsp;<span class="ident" id="4992229">err</span>&nbsp;<span class="op" id="4992233">!=</span>&nbsp;<span class="ident" id="4992236">nil</span>&nbsp;<span class="op" id="4992240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992248">return</span>&nbsp;<span class="ident" id="4992255">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4992264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4992270">}</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4992275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4992279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992283">if</span>&nbsp;<span class="ident" id="4992286">err</span>&nbsp;<span class="op" id="4992290">:=</span>&nbsp;<span class="ident" id="4992293">p</span><span class="op" id="4992294">.</span><span class="ident" id="4992295">marshalValue</span><span class="op" id="4992307">(</span><span class="ident" id="4992308">vf</span><span class="op" id="4992310">,</span>&nbsp;<span class="ident" id="4992312">finfo</span><span class="op" id="4992317">,</span>&nbsp;<span class="ident" id="4992319">nil</span><span class="op" id="4992322">)</span><span class="op" id="4992323">;</span>&nbsp;<span class="ident" id="4992325">err</span>&nbsp;<span class="op" id="4992329">!=</span>&nbsp;<span class="ident" id="4992332">nil</span>&nbsp;<span class="op" id="4992336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992341">return</span>&nbsp;<span class="ident" id="4992348">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4992354">}</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4992357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4992360">s</span><span class="op" id="4992361">.</span><span class="ident" id="4992362">trim</span><span class="op" id="4992366">(</span><span class="ident" id="4992367">nil</span><span class="op" id="4992370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992373">return</span>&nbsp;<span class="ident" id="4992380">p</span><span class="op" id="4992381">.</span><span class="ident" id="4992382">cachedWriteError</span><span class="op" id="4992398">(</span><span class="op" id="4992399">)</span><br>
<span class="lineno"></span><span class="op" id="4992401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">840</span><span class="comment" id="4992404">//&nbsp;return&nbsp;the&nbsp;bufio&nbsp;Writer&#39;s&nbsp;cached&nbsp;write&nbsp;error</span><br>
<span class="lineno"></span><span class="keyword" id="4992452">func</span>&nbsp;<span class="op" id="4992457">(</span><span class="ident" id="4992458">p</span>&nbsp;<span class="op" id="4992460">*</span><span class="ident" id="4992461">printer</span><span class="op" id="4992468">)</span>&nbsp;<span class="ident" id="4992470">cachedWriteError</span><span class="op" id="4992486">(</span><span class="op" id="4992487">)</span>&nbsp;<span class="builtintype" id="4992489">error</span>&nbsp;<span class="op" id="4992495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4992498">_</span><span class="op" id="4992499">,</span>&nbsp;<span class="ident" id="4992501">err</span>&nbsp;<span class="op" id="4992505">:=</span>&nbsp;<span class="ident" id="4992508">p</span><span class="op" id="4992509">.</span><span class="ident" id="4992510">Write</span><span class="op" id="4992515">(</span><span class="ident" id="4992516">nil</span><span class="op" id="4992519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992522">return</span>&nbsp;<span class="ident" id="4992529">err</span><br>
<span class="lineno"></span><span class="op" id="4992533">}</span><br>
<span class="lineno">845</span><br>
<span class="lineno"></span><span class="keyword" id="4992536">func</span>&nbsp;<span class="op" id="4992541">(</span><span class="ident" id="4992542">p</span>&nbsp;<span class="op" id="4992544">*</span><span class="ident" id="4992545">printer</span><span class="op" id="4992552">)</span>&nbsp;<span class="ident" id="4992554">writeIndent</span><span class="op" id="4992565">(</span><span class="ident" id="4992566">depthDelta</span>&nbsp;<span class="builtintype" id="4992577">int</span><span class="op" id="4992580">)</span>&nbsp;<span class="op" id="4992582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992585">if</span>&nbsp;<span class="builtinfunc" id="4992588">len</span><span class="op" id="4992591">(</span><span class="ident" id="4992592">p</span><span class="op" id="4992593">.</span><span class="ident" id="4992594">prefix</span><span class="op" id="4992600">)</span>&nbsp;<span class="op" id="4992602">==</span>&nbsp;<span class="num" id="4992605">0</span>&nbsp;<span class="op" id="4992607">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4992610">len</span><span class="op" id="4992613">(</span><span class="ident" id="4992614">p</span><span class="op" id="4992615">.</span><span class="ident" id="4992616">indent</span><span class="op" id="4992622">)</span>&nbsp;<span class="op" id="4992624">==</span>&nbsp;<span class="num" id="4992627">0</span>&nbsp;<span class="op" id="4992629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992633">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4992641">}</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992644">if</span>&nbsp;<span class="ident" id="4992647">depthDelta</span>&nbsp;<span class="op" id="4992658">&lt;</span>&nbsp;<span class="num" id="4992660">0</span>&nbsp;<span class="op" id="4992662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4992666">p</span><span class="op" id="4992667">.</span><span class="ident" id="4992668">depth</span><span class="op" id="4992673">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992678">if</span>&nbsp;<span class="ident" id="4992681">p</span><span class="op" id="4992682">.</span><span class="ident" id="4992683">indentedIn</span>&nbsp;<span class="op" id="4992694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4992699">p</span><span class="op" id="4992700">.</span><span class="ident" id="4992701">indentedIn</span>&nbsp;<span class="op" id="4992712">=</span>&nbsp;<span class="builtintype" id="4992714">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992723">return</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4992732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4992736">p</span><span class="op" id="4992737">.</span><span class="ident" id="4992738">indentedIn</span>&nbsp;<span class="op" id="4992749">=</span>&nbsp;<span class="builtintype" id="4992751">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4992758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992761">if</span>&nbsp;<span class="ident" id="4992764">p</span><span class="op" id="4992765">.</span><span class="ident" id="4992766">putNewline</span>&nbsp;<span class="op" id="4992777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4992781">p</span><span class="op" id="4992782">.</span><span class="ident" id="4992783">WriteByte</span><span class="op" id="4992792">(</span><span class="string" id="4992793">&#39;\n&#39;</span><span class="op" id="4992797">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4992800">}</span>&nbsp;<span class="keyword" id="4992802">else</span>&nbsp;<span class="op" id="4992807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4992811">p</span><span class="op" id="4992812">.</span><span class="ident" id="4992813">putNewline</span>&nbsp;<span class="op" id="4992824">=</span>&nbsp;<span class="builtintype" id="4992826">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4992832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992835">if</span>&nbsp;<span class="builtinfunc" id="4992838">len</span><span class="op" id="4992841">(</span><span class="ident" id="4992842">p</span><span class="op" id="4992843">.</span><span class="ident" id="4992844">prefix</span><span class="op" id="4992850">)</span>&nbsp;<span class="op" id="4992852">&gt;</span>&nbsp;<span class="num" id="4992854">0</span>&nbsp;<span class="op" id="4992856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4992860">p</span><span class="op" id="4992861">.</span><span class="ident" id="4992862">WriteString</span><span class="op" id="4992873">(</span><span class="ident" id="4992874">p</span><span class="op" id="4992875">.</span><span class="ident" id="4992876">prefix</span><span class="op" id="4992882">)</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4992885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992888">if</span>&nbsp;<span class="builtinfunc" id="4992891">len</span><span class="op" id="4992894">(</span><span class="ident" id="4992895">p</span><span class="op" id="4992896">.</span><span class="ident" id="4992897">indent</span><span class="op" id="4992903">)</span>&nbsp;<span class="op" id="4992905">&gt;</span>&nbsp;<span class="num" id="4992907">0</span>&nbsp;<span class="op" id="4992909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992913">for</span>&nbsp;<span class="ident" id="4992917">i</span>&nbsp;<span class="op" id="4992919">:=</span>&nbsp;<span class="num" id="4992922">0</span><span class="op" id="4992923">;</span>&nbsp;<span class="ident" id="4992925">i</span>&nbsp;<span class="op" id="4992927">&lt;</span>&nbsp;<span class="ident" id="4992929">p</span><span class="op" id="4992930">.</span><span class="ident" id="4992931">depth</span><span class="op" id="4992936">;</span>&nbsp;<span class="ident" id="4992938">i</span><span class="op" id="4992939">++</span>&nbsp;<span class="op" id="4992942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4992947">p</span><span class="op" id="4992948">.</span><span class="ident" id="4992949">WriteString</span><span class="op" id="4992960">(</span><span class="ident" id="4992961">p</span><span class="op" id="4992962">.</span><span class="ident" id="4992963">indent</span><span class="op" id="4992969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4992973">}</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4992976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992979">if</span>&nbsp;<span class="ident" id="4992982">depthDelta</span>&nbsp;<span class="op" id="4992993">&gt;</span>&nbsp;<span class="num" id="4992995">0</span>&nbsp;<span class="op" id="4992997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4993001">p</span><span class="op" id="4993002">.</span><span class="ident" id="4993003">depth</span><span class="op" id="4993008">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4993013">p</span><span class="op" id="4993014">.</span><span class="ident" id="4993015">indentedIn</span>&nbsp;<span class="op" id="4993026">=</span>&nbsp;<span class="builtintype" id="4993028">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4993034">}</span><br>
<span class="lineno">875</span><span class="op" id="4993036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4993039">type</span>&nbsp;<span class="ident" id="4993044">parentStack</span>&nbsp;<span class="keyword" id="4993056">struct</span>&nbsp;<span class="op" id="4993063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4993066">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4993072">*</span><span class="ident" id="4993073">printer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4993082">stack</span>&nbsp;<span class="op" id="4993088">[</span><span class="op" id="4993089">]</span><span class="builtintype" id="4993090">string</span><br>
<span class="lineno">880</span><span class="op" id="4993097">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4993100">//&nbsp;trim&nbsp;updates&nbsp;the&nbsp;XML&nbsp;context&nbsp;to&nbsp;match&nbsp;the&nbsp;longest&nbsp;common&nbsp;prefix&nbsp;of&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="4993180">//&nbsp;and&nbsp;the&nbsp;given&nbsp;parents.&nbsp;&nbsp;A&nbsp;closing&nbsp;tag&nbsp;will&nbsp;be&nbsp;written&nbsp;for&nbsp;every&nbsp;parent</span><br>
<span class="lineno"></span><span class="comment" id="4993254">//&nbsp;popped.&nbsp;&nbsp;Passing&nbsp;a&nbsp;zero&nbsp;slice&nbsp;or&nbsp;nil&nbsp;will&nbsp;close&nbsp;all&nbsp;the&nbsp;elements.</span><br>
<span class="lineno">885</span><span class="keyword" id="4993323">func</span>&nbsp;<span class="op" id="4993328">(</span><span class="ident" id="4993329">s</span>&nbsp;<span class="op" id="4993331">*</span><span class="ident" id="4993332">parentStack</span><span class="op" id="4993343">)</span>&nbsp;<span class="ident" id="4993345">trim</span><span class="op" id="4993349">(</span><span class="ident" id="4993350">parents</span>&nbsp;<span class="op" id="4993358">[</span><span class="op" id="4993359">]</span><span class="builtintype" id="4993360">string</span><span class="op" id="4993366">)</span>&nbsp;<span class="builtintype" id="4993368">error</span>&nbsp;<span class="op" id="4993374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4993377">split</span>&nbsp;<span class="op" id="4993383">:=</span>&nbsp;<span class="num" id="4993386">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4993389">for</span>&nbsp;<span class="op" id="4993393">;</span>&nbsp;<span class="ident" id="4993395">split</span>&nbsp;<span class="op" id="4993401">&lt;</span>&nbsp;<span class="builtinfunc" id="4993403">len</span><span class="op" id="4993406">(</span><span class="ident" id="4993407">parents</span><span class="op" id="4993414">)</span>&nbsp;<span class="op" id="4993416">&amp;&amp;</span>&nbsp;<span class="ident" id="4993419">split</span>&nbsp;<span class="op" id="4993425">&lt;</span>&nbsp;<span class="builtinfunc" id="4993427">len</span><span class="op" id="4993430">(</span><span class="ident" id="4993431">s</span><span class="op" id="4993432">.</span><span class="ident" id="4993433">stack</span><span class="op" id="4993438">)</span><span class="op" id="4993439">;</span>&nbsp;<span class="ident" id="4993441">split</span><span class="op" id="4993446">++</span>&nbsp;<span class="op" id="4993449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4993453">if</span>&nbsp;<span class="ident" id="4993456">parents</span><span class="op" id="4993463">[</span><span class="ident" id="4993464">split</span><span class="op" id="4993469">]</span>&nbsp;<span class="op" id="4993471">!=</span>&nbsp;<span class="ident" id="4993474">s</span><span class="op" id="4993475">.</span><span class="ident" id="4993476">stack</span><span class="op" id="4993481">[</span><span class="ident" id="4993482">split</span><span class="op" id="4993487">]</span>&nbsp;<span class="op" id="4993489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4993494">break</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4993502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4993505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4993508">for</span>&nbsp;<span class="ident" id="4993512">i</span>&nbsp;<span class="op" id="4993514">:=</span>&nbsp;<span class="builtinfunc" id="4993517">len</span><span class="op" id="4993520">(</span><span class="ident" id="4993521">s</span><span class="op" id="4993522">.</span><span class="ident" id="4993523">stack</span><span class="op" id="4993528">)</span>&nbsp;<span class="op" id="4993530">-</span>&nbsp;<span class="num" id="4993532">1</span><span class="op" id="4993533">;</span>&nbsp;<span class="ident" id="4993535">i</span>&nbsp;<span class="op" id="4993537">&gt;=</span>&nbsp;<span class="ident" id="4993540">split</span><span class="op" id="4993545">;</span>&nbsp;<span class="ident" id="4993547">i</span><span class="op" id="4993548">--</span>&nbsp;<span class="op" id="4993551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4993555">if</span>&nbsp;<span class="ident" id="4993558">err</span>&nbsp;<span class="op" id="4993562">:=</span>&nbsp;<span class="ident" id="4993565">s</span><span class="op" id="4993566">.</span><span class="ident" id="4993567">p</span><span class="op" id="4993568">.</span><span class="ident" id="4993569">writeEnd</span><span class="op" id="4993577">(</span><span class="ident" id="4993578">Name</span><span class="op" id="4993582">{</span><span class="ident" id="4993583">Local</span><span class="op" id="4993588">:</span>&nbsp;<span class="ident" id="4993590">s</span><span class="op" id="4993591">.</span><span class="ident" id="4993592">stack</span><span class="op" id="4993597">[</span><span class="ident" id="4993598">i</span><span class="op" id="4993599">]</span><span class="op" id="4993600">}</span><span class="op" id="4993601">)</span><span class="op" id="4993602">;</span>&nbsp;<span class="ident" id="4993604">err</span>&nbsp;<span class="op" id="4993608">!=</span>&nbsp;<span class="ident" id="4993611">nil</span>&nbsp;<span class="op" id="4993615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4993620">return</span>&nbsp;<span class="ident" id="4993627">err</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4993633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4993636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4993639">s</span><span class="op" id="4993640">.</span><span class="ident" id="4993641">stack</span>&nbsp;<span class="op" id="4993647">=</span>&nbsp;<span class="ident" id="4993649">parents</span><span class="op" id="4993656">[</span><span class="op" id="4993657">:</span><span class="ident" id="4993658">split</span><span class="op" id="4993663">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4993666">return</span>&nbsp;<span class="ident" id="4993673">nil</span><br>
<span class="lineno"></span><span class="op" id="4993677">}</span><br>
<span class="lineno">900</span><br>
<span class="lineno"></span><span class="comment" id="4993680">//&nbsp;push&nbsp;adds&nbsp;parent&nbsp;elements&nbsp;to&nbsp;the&nbsp;stack&nbsp;and&nbsp;writes&nbsp;open&nbsp;tags.</span><br>
<span class="lineno"></span><span class="keyword" id="4993744">func</span>&nbsp;<span class="op" id="4993749">(</span><span class="ident" id="4993750">s</span>&nbsp;<span class="op" id="4993752">*</span><span class="ident" id="4993753">parentStack</span><span class="op" id="4993764">)</span>&nbsp;<span class="ident" id="4993766">push</span><span class="op" id="4993770">(</span><span class="ident" id="4993771">parents</span>&nbsp;<span class="op" id="4993779">[</span><span class="op" id="4993780">]</span><span class="builtintype" id="4993781">string</span><span class="op" id="4993787">)</span>&nbsp;<span class="builtintype" id="4993789">error</span>&nbsp;<span class="op" id="4993795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4993798">for</span>&nbsp;<span class="ident" id="4993802">i</span>&nbsp;<span class="op" id="4993804">:=</span>&nbsp;<span class="num" id="4993807">0</span><span class="op" id="4993808">;</span>&nbsp;<span class="ident" id="4993810">i</span>&nbsp;<span class="op" id="4993812">&lt;</span>&nbsp;<span class="builtinfunc" id="4993814">len</span><span class="op" id="4993817">(</span><span class="ident" id="4993818">parents</span><span class="op" id="4993825">)</span><span class="op" id="4993826">;</span>&nbsp;<span class="ident" id="4993828">i</span><span class="op" id="4993829">++</span>&nbsp;<span class="op" id="4993832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4993836">if</span>&nbsp;<span class="ident" id="4993839">err</span>&nbsp;<span class="op" id="4993843">:=</span>&nbsp;<span class="ident" id="4993846">s</span><span class="op" id="4993847">.</span><span class="ident" id="4993848">p</span><span class="op" id="4993849">.</span><span class="ident" id="4993850">writeStart</span><span class="op" id="4993860">(</span><span class="op" id="4993861">&amp;</span><span class="ident" id="4993862">StartElement</span><span class="op" id="4993874">{</span><span class="ident" id="4993875">Name</span><span class="op" id="4993879">:</span>&nbsp;<span class="ident" id="4993881">Name</span><span class="op" id="4993885">{</span><span class="ident" id="4993886">Local</span><span class="op" id="4993891">:</span>&nbsp;<span class="ident" id="4993893">parents</span><span class="op" id="4993900">[</span><span class="ident" id="4993901">i</span><span class="op" id="4993902">]</span><span class="op" id="4993903">}</span><span class="op" id="4993904">}</span><span class="op" id="4993905">)</span><span class="op" id="4993906">;</span>&nbsp;<span class="ident" id="4993908">err</span>&nbsp;<span class="op" id="4993912">!=</span>&nbsp;<span class="ident" id="4993915">nil</span>&nbsp;<span class="op" id="4993919">{</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4993924">return</span>&nbsp;<span class="ident" id="4993931">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4993937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4993940">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4993943">s</span><span class="op" id="4993944">.</span><span class="ident" id="4993945">stack</span>&nbsp;<span class="op" id="4993951">=</span>&nbsp;<span class="builtinfunc" id="4993953">append</span><span class="op" id="4993959">(</span><span class="ident" id="4993960">s</span><span class="op" id="4993961">.</span><span class="ident" id="4993962">stack</span><span class="op" id="4993967">,</span>&nbsp;<span class="ident" id="4993969">parents</span><span class="op" id="4993976">...</span><span class="op" id="4993979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4993982">return</span>&nbsp;<span class="ident" id="4993989">nil</span><br>
<span class="lineno">910</span><span class="op" id="4993993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4993996">//&nbsp;A&nbsp;MarshalXMLError&nbsp;is&nbsp;returned&nbsp;when&nbsp;Marshal&nbsp;encounters&nbsp;a&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="4994060">//&nbsp;that&nbsp;cannot&nbsp;be&nbsp;converted&nbsp;into&nbsp;XML.</span><br>
<span class="lineno"></span><span class="keyword" id="4994098">type</span>&nbsp;<span class="ident" id="4994103">UnsupportedTypeError</span>&nbsp;<span class="keyword" id="4994124">struct</span>&nbsp;<span class="op" id="4994131">{</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4994134">Type</span>&nbsp;<span class="ident" id="4994139">reflect</span><span class="op" id="4994146">.</span><span class="ident" id="4994147">Type</span><br>
<span class="lineno"></span><span class="op" id="4994152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4994155">func</span>&nbsp;<span class="op" id="4994160">(</span><span class="ident" id="4994161">e</span>&nbsp;<span class="op" id="4994163">*</span><span class="ident" id="4994164">UnsupportedTypeError</span><span class="op" id="4994184">)</span>&nbsp;<span class="ident" id="4994186">Error</span><span class="op" id="4994191">(</span><span class="op" id="4994192">)</span>&nbsp;<span class="builtintype" id="4994194">string</span>&nbsp;<span class="op" id="4994201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994204">return</span>&nbsp;<span class="string" id="4994211">&#34;xml:&nbsp;unsupported&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="4994237">+</span>&nbsp;<span class="ident" id="4994239">e</span><span class="op" id="4994240">.</span><span class="ident" id="4994241">Type</span><span class="op" id="4994245">.</span><span class="ident" id="4994246">String</span><span class="op" id="4994252">(</span><span class="op" id="4994253">)</span><br>
<span class="lineno">920</span><span class="op" id="4994255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4994258">func</span>&nbsp;<span class="ident" id="4994263">isEmptyValue</span><span class="op" id="4994275">(</span><span class="ident" id="4994276">v</span>&nbsp;<span class="ident" id="4994278">reflect</span><span class="op" id="4994285">.</span><span class="ident" id="4994286">Value</span><span class="op" id="4994291">)</span>&nbsp;<span class="builtintype" id="4994293">bool</span>&nbsp;<span class="op" id="4994298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994301">switch</span>&nbsp;<span class="ident" id="4994308">v</span><span class="op" id="4994309">.</span><span class="ident" id="4994310">Kind</span><span class="op" id="4994314">(</span><span class="op" id="4994315">)</span>&nbsp;<span class="op" id="4994317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994320">case</span>&nbsp;<span class="ident" id="4994325">reflect</span><span class="op" id="4994332">.</span><span class="ident" id="4994333">Array</span><span class="op" id="4994338">,</span>&nbsp;<span class="ident" id="4994340">reflect</span><span class="op" id="4994347">.</span><span class="ident" id="4994348">Map</span><span class="op" id="4994351">,</span>&nbsp;<span class="ident" id="4994353">reflect</span><span class="op" id="4994360">.</span><span class="ident" id="4994361">Slice</span><span class="op" id="4994366">,</span>&nbsp;<span class="ident" id="4994368">reflect</span><span class="op" id="4994375">.</span><span class="ident" id="4994376">String</span><span class="op" id="4994382">:</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994386">return</span>&nbsp;<span class="ident" id="4994393">v</span><span class="op" id="4994394">.</span><span class="ident" id="4994395">Len</span><span class="op" id="4994398">(</span><span class="op" id="4994399">)</span>&nbsp;<span class="op" id="4994401">==</span>&nbsp;<span class="num" id="4994404">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994407">case</span>&nbsp;<span class="ident" id="4994412">reflect</span><span class="op" id="4994419">.</span><span class="ident" id="4994420">Bool</span><span class="op" id="4994424">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994428">return</span>&nbsp;<span class="op" id="4994435">!</span><span class="ident" id="4994436">v</span><span class="op" id="4994437">.</span><span class="ident" id="4994438">Bool</span><span class="op" id="4994442">(</span><span class="op" id="4994443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994446">case</span>&nbsp;<span class="ident" id="4994451">reflect</span><span class="op" id="4994458">.</span><span class="ident" id="4994459">Int</span><span class="op" id="4994462">,</span>&nbsp;<span class="ident" id="4994464">reflect</span><span class="op" id="4994471">.</span><span class="ident" id="4994472">Int8</span><span class="op" id="4994476">,</span>&nbsp;<span class="ident" id="4994478">reflect</span><span class="op" id="4994485">.</span><span class="ident" id="4994486">Int16</span><span class="op" id="4994491">,</span>&nbsp;<span class="ident" id="4994493">reflect</span><span class="op" id="4994500">.</span><span class="ident" id="4994501">Int32</span><span class="op" id="4994506">,</span>&nbsp;<span class="ident" id="4994508">reflect</span><span class="op" id="4994515">.</span><span class="ident" id="4994516">Int64</span><span class="op" id="4994521">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994525">return</span>&nbsp;<span class="ident" id="4994532">v</span><span class="op" id="4994533">.</span><span class="ident" id="4994534">Int</span><span class="op" id="4994537">(</span><span class="op" id="4994538">)</span>&nbsp;<span class="op" id="4994540">==</span>&nbsp;<span class="num" id="4994543">0</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994546">case</span>&nbsp;<span class="ident" id="4994551">reflect</span><span class="op" id="4994558">.</span><span class="ident" id="4994559">Uint</span><span class="op" id="4994563">,</span>&nbsp;<span class="ident" id="4994565">reflect</span><span class="op" id="4994572">.</span><span class="ident" id="4994573">Uint8</span><span class="op" id="4994578">,</span>&nbsp;<span class="ident" id="4994580">reflect</span><span class="op" id="4994587">.</span><span class="ident" id="4994588">Uint16</span><span class="op" id="4994594">,</span>&nbsp;<span class="ident" id="4994596">reflect</span><span class="op" id="4994603">.</span><span class="ident" id="4994604">Uint32</span><span class="op" id="4994610">,</span>&nbsp;<span class="ident" id="4994612">reflect</span><span class="op" id="4994619">.</span><span class="ident" id="4994620">Uint64</span><span class="op" id="4994626">,</span>&nbsp;<span class="ident" id="4994628">reflect</span><span class="op" id="4994635">.</span><span class="ident" id="4994636">Uintptr</span><span class="op" id="4994643">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994647">return</span>&nbsp;<span class="ident" id="4994654">v</span><span class="op" id="4994655">.</span><span class="ident" id="4994656">Uint</span><span class="op" id="4994660">(</span><span class="op" id="4994661">)</span>&nbsp;<span class="op" id="4994663">==</span>&nbsp;<span class="num" id="4994666">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994669">case</span>&nbsp;<span class="ident" id="4994674">reflect</span><span class="op" id="4994681">.</span><span class="ident" id="4994682">Float32</span><span class="op" id="4994689">,</span>&nbsp;<span class="ident" id="4994691">reflect</span><span class="op" id="4994698">.</span><span class="ident" id="4994699">Float64</span><span class="op" id="4994706">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994710">return</span>&nbsp;<span class="ident" id="4994717">v</span><span class="op" id="4994718">.</span><span class="ident" id="4994719">Float</span><span class="op" id="4994724">(</span><span class="op" id="4994725">)</span>&nbsp;<span class="op" id="4994727">==</span>&nbsp;<span class="num" id="4994730">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994733">case</span>&nbsp;<span class="ident" id="4994738">reflect</span><span class="op" id="4994745">.</span><span class="ident" id="4994746">Interface</span><span class="op" id="4994755">,</span>&nbsp;<span class="ident" id="4994757">reflect</span><span class="op" id="4994764">.</span><span class="ident" id="4994765">Ptr</span><span class="op" id="4994768">:</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994772">return</span>&nbsp;<span class="ident" id="4994779">v</span><span class="op" id="4994780">.</span><span class="ident" id="4994781">IsNil</span><span class="op" id="4994786">(</span><span class="op" id="4994787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4994790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994793">return</span>&nbsp;<span class="builtintype" id="4994800">false</span><br>
<span class="lineno"></span><span class="op" id="4994806">}</span>
</div>
</body>
</html>
