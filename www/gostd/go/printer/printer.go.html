<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/printer</h2>
<ul>
<li><a href="/gostd/go/printer/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/printer/nodes.go.html">nodes.go</a></li>
<li><a href="/gostd/go/printer/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/printer/printer.go.html">printer.go</a></li>
<li><a href="/gostd/go/printer/printer_test.go.html">printer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5457800">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5457855">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5457909">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5457960">//&nbsp;Package&nbsp;printer&nbsp;implements&nbsp;printing&nbsp;of&nbsp;AST&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="5458013">package</span>&nbsp;<span class="ident" id="5458021">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5458030">import</span>&nbsp;<span class="op" id="5458037">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5458040">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5458047">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5458057">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5458069">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5458075">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5458081">&#34;strconv&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5458092">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5458103">&#34;text/tabwriter&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5458121">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="5458131">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="5458134">const</span>&nbsp;<span class="op" id="5458140">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5458143">maxNewlines</span>&nbsp;<span class="op" id="5458155">=</span>&nbsp;<span class="num" id="5458157">2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5458163">//&nbsp;max.&nbsp;number&nbsp;of&nbsp;newlines&nbsp;between&nbsp;source&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5458211">debug</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5458223">=</span>&nbsp;<span class="builtintype" id="5458225">false</span>&nbsp;<span class="comment" id="5458231">//&nbsp;enable&nbsp;for&nbsp;debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5458256">infinity</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5458268">=</span>&nbsp;<span class="num" id="5458270">1</span>&nbsp;<span class="op" id="5458272">&lt;&lt;</span>&nbsp;<span class="num" id="5458275">30</span><br>
<span class="lineno"></span><span class="op" id="5458278">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="5458281">type</span>&nbsp;<span class="ident" id="5458286">whiteSpace</span>&nbsp;<span class="builtintype" id="5458297">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5458303">const</span>&nbsp;<span class="op" id="5458309">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5458312">ignore</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5458321">=</span>&nbsp;<span class="ident" id="5458323">whiteSpace</span><span class="op" id="5458333">(</span><span class="num" id="5458334">0</span><span class="op" id="5458335">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5458338">blank</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5458347">=</span>&nbsp;<span class="ident" id="5458349">whiteSpace</span><span class="op" id="5458359">(</span><span class="string" id="5458360">&#39;&nbsp;&#39;</span><span class="op" id="5458363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5458366">vtab</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5458375">=</span>&nbsp;<span class="ident" id="5458377">whiteSpace</span><span class="op" id="5458387">(</span><span class="string" id="5458388">&#39;\v&#39;</span><span class="op" id="5458392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5458395">newline</span>&nbsp;&nbsp;<span class="op" id="5458404">=</span>&nbsp;<span class="ident" id="5458406">whiteSpace</span><span class="op" id="5458416">(</span><span class="string" id="5458417">&#39;\n&#39;</span><span class="op" id="5458421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5458424">formfeed</span>&nbsp;<span class="op" id="5458433">=</span>&nbsp;<span class="ident" id="5458435">whiteSpace</span><span class="op" id="5458445">(</span><span class="string" id="5458446">&#39;\f&#39;</span><span class="op" id="5458450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5458453">indent</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5458462">=</span>&nbsp;<span class="ident" id="5458464">whiteSpace</span><span class="op" id="5458474">(</span><span class="string" id="5458475">&#39;&gt;&#39;</span><span class="op" id="5458478">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5458481">unindent</span>&nbsp;<span class="op" id="5458490">=</span>&nbsp;<span class="ident" id="5458492">whiteSpace</span><span class="op" id="5458502">(</span><span class="string" id="5458503">&#39;&lt;&#39;</span><span class="op" id="5458506">)</span><br>
<span class="lineno"></span><span class="op" id="5458508">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5458511">//&nbsp;A&nbsp;pmode&nbsp;value&nbsp;represents&nbsp;the&nbsp;current&nbsp;printer&nbsp;mode.</span><br>
<span class="lineno"></span><span class="keyword" id="5458565">type</span>&nbsp;<span class="ident" id="5458570">pmode</span>&nbsp;<span class="builtintype" id="5458576">int</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="5458581">const</span>&nbsp;<span class="op" id="5458587">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5458590">noExtraBlank</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458607">pmode</span>&nbsp;<span class="op" id="5458613">=</span>&nbsp;<span class="num" id="5458615">1</span>&nbsp;<span class="op" id="5458617">&lt;&lt;</span>&nbsp;<span class="ident" id="5458620">iota</span>&nbsp;<span class="comment" id="5458625">//&nbsp;disables&nbsp;extra&nbsp;blank&nbsp;after&nbsp;/*-style&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5458673">noExtraLinebreak</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5458708">//&nbsp;disables&nbsp;extra&nbsp;line&nbsp;break&nbsp;after&nbsp;/*-style&nbsp;comment</span><br>
<span class="lineno"></span><span class="op" id="5458760">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="5458763">type</span>&nbsp;<span class="ident" id="5458768">commentInfo</span>&nbsp;<span class="keyword" id="5458780">struct</span>&nbsp;<span class="op" id="5458787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5458790">cindex</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5458805">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5458823">//&nbsp;current&nbsp;comment&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5458849">comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5458864">*</span><span class="ident" id="5458865">ast</span><span class="op" id="5458868">.</span><span class="ident" id="5458869">CommentGroup</span>&nbsp;<span class="comment" id="5458882">//&nbsp;=&nbsp;printer.comments[cindex];&nbsp;or&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5458921">commentOffset</span>&nbsp;&nbsp;<span class="builtintype" id="5458936">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5458954">//&nbsp;=&nbsp;printer.posFor(printer.comments[cindex].List[0].Pos()).Offset;&nbsp;or&nbsp;infinity</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5459035">commentNewline</span>&nbsp;<span class="builtintype" id="5459050">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5459068">//&nbsp;true&nbsp;if&nbsp;the&nbsp;comment&nbsp;group&nbsp;contains&nbsp;newlines</span><br>
<span class="lineno"></span><span class="op" id="5459115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5459118">type</span>&nbsp;<span class="ident" id="5459123">printer</span>&nbsp;<span class="keyword" id="5459131">struct</span>&nbsp;<span class="op" id="5459138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5459141">//&nbsp;Configuration&nbsp;(does&nbsp;not&nbsp;change&nbsp;after&nbsp;initialization)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5459198">Config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5459206">fset</span>&nbsp;<span class="op" id="5459211">*</span><span class="ident" id="5459212">token</span><span class="op" id="5459217">.</span><span class="ident" id="5459218">FileSet</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5459228">//&nbsp;Current&nbsp;state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5459246">output</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5459258">[</span><span class="op" id="5459259">]</span><span class="builtintype" id="5459260">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5459271">//&nbsp;raw&nbsp;printer&nbsp;result</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5459294">indent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5459306">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5459319">//&nbsp;current&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5459343">mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5459355">pmode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5459368">//&nbsp;current&nbsp;printer&nbsp;mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5459393">impliedSemi</span>&nbsp;<span class="builtintype" id="5459405">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5459418">//&nbsp;if&nbsp;set,&nbsp;a&nbsp;linebreak&nbsp;implies&nbsp;a&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5459462">lastTok</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5459474">token</span><span class="op" id="5459479">.</span><span class="ident" id="5459480">Token</span>&nbsp;&nbsp;<span class="comment" id="5459487">//&nbsp;last&nbsp;token&nbsp;printed&nbsp;(token.ILLEGAL&nbsp;if&nbsp;it&#39;s&nbsp;whitespace)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5459545">prevOpen</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5459557">token</span><span class="op" id="5459562">.</span><span class="ident" id="5459563">Token</span>&nbsp;&nbsp;<span class="comment" id="5459570">//&nbsp;previous&nbsp;non-brace&nbsp;&#34;open&#34;&nbsp;token&nbsp;(,&nbsp;[,&nbsp;or&nbsp;token.ILLEGAL</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5459629">wsbuf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5459641">[</span><span class="op" id="5459642">]</span><span class="ident" id="5459643">whiteSpace</span>&nbsp;<span class="comment" id="5459654">//&nbsp;delayed&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5459679">//&nbsp;Positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5459693">//&nbsp;The&nbsp;out&nbsp;position&nbsp;differs&nbsp;from&nbsp;the&nbsp;pos&nbsp;position&nbsp;when&nbsp;the&nbsp;result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5459760">//&nbsp;formatting&nbsp;differs&nbsp;from&nbsp;the&nbsp;source&nbsp;formatting&nbsp;(in&nbsp;the&nbsp;amount&nbsp;of</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5459828">//&nbsp;white&nbsp;space).&nbsp;If&nbsp;there&#39;s&nbsp;a&nbsp;difference&nbsp;and&nbsp;SourcePos&nbsp;is&nbsp;set&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5459894">//&nbsp;ConfigMode,&nbsp;//line&nbsp;comments&nbsp;are&nbsp;used&nbsp;in&nbsp;the&nbsp;output&nbsp;to&nbsp;restore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5459960">//&nbsp;original&nbsp;source&nbsp;positions&nbsp;for&nbsp;a&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460004">pos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5460012">token</span><span class="op" id="5460017">.</span><span class="ident" id="5460018">Position</span>&nbsp;<span class="comment" id="5460027">//&nbsp;current&nbsp;position&nbsp;in&nbsp;AST&nbsp;(source)&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460070">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5460078">token</span><span class="op" id="5460083">.</span><span class="ident" id="5460084">Position</span>&nbsp;<span class="comment" id="5460093">//&nbsp;current&nbsp;position&nbsp;in&nbsp;output&nbsp;space</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460130">last</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5460138">token</span><span class="op" id="5460143">.</span><span class="ident" id="5460144">Position</span>&nbsp;<span class="comment" id="5460153">//&nbsp;value&nbsp;of&nbsp;pos&nbsp;after&nbsp;calling&nbsp;writeString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460196">linePtr</span>&nbsp;<span class="op" id="5460204">*</span><span class="builtintype" id="5460205">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5460219">//&nbsp;if&nbsp;set,&nbsp;record&nbsp;out.Line&nbsp;for&nbsp;the&nbsp;next&nbsp;token&nbsp;in&nbsp;*linePtr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5460279">//&nbsp;The&nbsp;list&nbsp;of&nbsp;all&nbsp;source&nbsp;comments,&nbsp;in&nbsp;order&nbsp;of&nbsp;appearance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460340">comments</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5460356">[</span><span class="op" id="5460357">]</span><span class="op" id="5460358">*</span><span class="ident" id="5460359">ast</span><span class="op" id="5460362">.</span><span class="ident" id="5460363">CommentGroup</span>&nbsp;<span class="comment" id="5460376">//&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460391">useNodeComments</span>&nbsp;<span class="builtintype" id="5460407">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5460427">//&nbsp;if&nbsp;not&nbsp;set,&nbsp;ignore&nbsp;lead&nbsp;and&nbsp;line&nbsp;comments&nbsp;of&nbsp;nodes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5460483">//&nbsp;Information&nbsp;about&nbsp;p.comments[p.cindex];&nbsp;set&nbsp;up&nbsp;by&nbsp;nextComment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460550">commentInfo</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5460564">//&nbsp;Cache&nbsp;of&nbsp;already&nbsp;computed&nbsp;node&nbsp;sizes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460606">nodeSizes</span>&nbsp;<span class="keyword" id="5460616">map</span><span class="op" id="5460619">[</span><span class="ident" id="5460620">ast</span><span class="op" id="5460623">.</span><span class="ident" id="5460624">Node</span><span class="op" id="5460628">]</span><span class="builtintype" id="5460629">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5460635">//&nbsp;Cache&nbsp;of&nbsp;most&nbsp;recently&nbsp;computed&nbsp;line&nbsp;position.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460686">cachedPos</span>&nbsp;&nbsp;<span class="ident" id="5460697">token</span><span class="op" id="5460702">.</span><span class="ident" id="5460703">Pos</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460708">cachedLine</span>&nbsp;<span class="builtintype" id="5460719">int</span>&nbsp;<span class="comment" id="5460723">//&nbsp;line&nbsp;corresponding&nbsp;to&nbsp;cachedPos</span><br>
<span class="lineno"></span><span class="op" id="5460758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5460761">func</span>&nbsp;<span class="op" id="5460766">(</span><span class="ident" id="5460767">p</span>&nbsp;<span class="op" id="5460769">*</span><span class="ident" id="5460770">printer</span><span class="op" id="5460777">)</span>&nbsp;<span class="ident" id="5460779">init</span><span class="op" id="5460783">(</span><span class="ident" id="5460784">cfg</span>&nbsp;<span class="op" id="5460788">*</span><span class="ident" id="5460789">Config</span><span class="op" id="5460795">,</span>&nbsp;<span class="ident" id="5460797">fset</span>&nbsp;<span class="op" id="5460802">*</span><span class="ident" id="5460803">token</span><span class="op" id="5460808">.</span><span class="ident" id="5460809">FileSet</span><span class="op" id="5460816">,</span>&nbsp;<span class="ident" id="5460818">nodeSizes</span>&nbsp;<span class="keyword" id="5460828">map</span><span class="op" id="5460831">[</span><span class="ident" id="5460832">ast</span><span class="op" id="5460835">.</span><span class="ident" id="5460836">Node</span><span class="op" id="5460840">]</span><span class="builtintype" id="5460841">int</span><span class="op" id="5460844">)</span>&nbsp;<span class="op" id="5460846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460849">p</span><span class="op" id="5460850">.</span><span class="ident" id="5460851">Config</span>&nbsp;<span class="op" id="5460858">=</span>&nbsp;<span class="op" id="5460860">*</span><span class="ident" id="5460861">cfg</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460866">p</span><span class="op" id="5460867">.</span><span class="ident" id="5460868">fset</span>&nbsp;<span class="op" id="5460873">=</span>&nbsp;<span class="ident" id="5460875">fset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460881">p</span><span class="op" id="5460882">.</span><span class="ident" id="5460883">pos</span>&nbsp;<span class="op" id="5460887">=</span>&nbsp;<span class="ident" id="5460889">token</span><span class="op" id="5460894">.</span><span class="ident" id="5460895">Position</span><span class="op" id="5460903">{</span><span class="ident" id="5460904">Line</span><span class="op" id="5460908">:</span>&nbsp;<span class="num" id="5460910">1</span><span class="op" id="5460911">,</span>&nbsp;<span class="ident" id="5460913">Column</span><span class="op" id="5460919">:</span>&nbsp;<span class="num" id="5460921">1</span><span class="op" id="5460922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460925">p</span><span class="op" id="5460926">.</span><span class="ident" id="5460927">out</span>&nbsp;<span class="op" id="5460931">=</span>&nbsp;<span class="ident" id="5460933">token</span><span class="op" id="5460938">.</span><span class="ident" id="5460939">Position</span><span class="op" id="5460947">{</span><span class="ident" id="5460948">Line</span><span class="op" id="5460952">:</span>&nbsp;<span class="num" id="5460954">1</span><span class="op" id="5460955">,</span>&nbsp;<span class="ident" id="5460957">Column</span><span class="op" id="5460963">:</span>&nbsp;<span class="num" id="5460965">1</span><span class="op" id="5460966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460969">p</span><span class="op" id="5460970">.</span><span class="ident" id="5460971">wsbuf</span>&nbsp;<span class="op" id="5460977">=</span>&nbsp;<span class="builtinfunc" id="5460979">make</span><span class="op" id="5460983">(</span><span class="op" id="5460984">[</span><span class="op" id="5460985">]</span><span class="ident" id="5460986">whiteSpace</span><span class="op" id="5460996">,</span>&nbsp;<span class="num" id="5460998">0</span><span class="op" id="5460999">,</span>&nbsp;<span class="num" id="5461001">16</span><span class="op" id="5461003">)</span>&nbsp;<span class="comment" id="5461005">//&nbsp;whitespace&nbsp;sequences&nbsp;are&nbsp;short</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5461040">p</span><span class="op" id="5461041">.</span><span class="ident" id="5461042">nodeSizes</span>&nbsp;<span class="op" id="5461052">=</span>&nbsp;<span class="ident" id="5461054">nodeSizes</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5461065">p</span><span class="op" id="5461066">.</span><span class="ident" id="5461067">cachedPos</span>&nbsp;<span class="op" id="5461077">=</span>&nbsp;<span class="op" id="5461079">-</span><span class="num" id="5461080">1</span><br>
<span class="lineno"></span><span class="op" id="5461082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5461085">func</span>&nbsp;<span class="op" id="5461090">(</span><span class="ident" id="5461091">p</span>&nbsp;<span class="op" id="5461093">*</span><span class="ident" id="5461094">printer</span><span class="op" id="5461101">)</span>&nbsp;<span class="ident" id="5461103">internalError</span><span class="op" id="5461116">(</span><span class="ident" id="5461117">msg</span>&nbsp;<span class="op" id="5461121">...</span><span class="keyword" id="5461124">interface</span><span class="op" id="5461133">{</span><span class="op" id="5461134">}</span><span class="op" id="5461135">)</span>&nbsp;<span class="op" id="5461137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5461140">if</span>&nbsp;<span class="ident" id="5461143">debug</span>&nbsp;<span class="op" id="5461149">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5461153">fmt</span><span class="op" id="5461156">.</span><span class="ident" id="5461157">Print</span><span class="op" id="5461162">(</span><span class="ident" id="5461163">p</span><span class="op" id="5461164">.</span><span class="ident" id="5461165">pos</span><span class="op" id="5461168">.</span><span class="ident" id="5461169">String</span><span class="op" id="5461175">(</span><span class="op" id="5461176">)</span>&nbsp;<span class="op" id="5461178">+</span>&nbsp;<span class="string" id="5461180">&#34;:&nbsp;&#34;</span><span class="op" id="5461184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5461188">fmt</span><span class="op" id="5461191">.</span><span class="ident" id="5461192">Println</span><span class="op" id="5461199">(</span><span class="ident" id="5461200">msg</span><span class="op" id="5461203">...</span><span class="op" id="5461206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5461210">panic</span><span class="op" id="5461215">(</span><span class="string" id="5461216">&#34;go/printer&#34;</span><span class="op" id="5461228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5461231">}</span><br>
<span class="lineno"></span><span class="op" id="5461233">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="5461236">//&nbsp;commentsHaveNewline&nbsp;reports&nbsp;whether&nbsp;a&nbsp;list&nbsp;of&nbsp;comments&nbsp;belonging&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5461307">//&nbsp;an&nbsp;*ast.CommentGroup&nbsp;contains&nbsp;newlines.&nbsp;Because&nbsp;the&nbsp;position&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="5461383">//&nbsp;may&nbsp;only&nbsp;be&nbsp;partially&nbsp;correct,&nbsp;we&nbsp;also&nbsp;have&nbsp;to&nbsp;read&nbsp;the&nbsp;comment&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="5461456">func</span>&nbsp;<span class="op" id="5461461">(</span><span class="ident" id="5461462">p</span>&nbsp;<span class="op" id="5461464">*</span><span class="ident" id="5461465">printer</span><span class="op" id="5461472">)</span>&nbsp;<span class="ident" id="5461474">commentsHaveNewline</span><span class="op" id="5461493">(</span><span class="ident" id="5461494">list</span>&nbsp;<span class="op" id="5461499">[</span><span class="op" id="5461500">]</span><span class="op" id="5461501">*</span><span class="ident" id="5461502">ast</span><span class="op" id="5461505">.</span><span class="ident" id="5461506">Comment</span><span class="op" id="5461513">)</span>&nbsp;<span class="builtintype" id="5461515">bool</span>&nbsp;<span class="op" id="5461520">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5461523">//&nbsp;len(list)&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5461541">line</span>&nbsp;<span class="op" id="5461546">:=</span>&nbsp;<span class="ident" id="5461549">p</span><span class="op" id="5461550">.</span><span class="ident" id="5461551">lineFor</span><span class="op" id="5461558">(</span><span class="ident" id="5461559">list</span><span class="op" id="5461563">[</span><span class="num" id="5461564">0</span><span class="op" id="5461565">]</span><span class="op" id="5461566">.</span><span class="ident" id="5461567">Pos</span><span class="op" id="5461570">(</span><span class="op" id="5461571">)</span><span class="op" id="5461572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5461575">for</span>&nbsp;<span class="ident" id="5461579">i</span><span class="op" id="5461580">,</span>&nbsp;<span class="ident" id="5461582">c</span>&nbsp;<span class="op" id="5461584">:=</span>&nbsp;<span class="keyword" id="5461587">range</span>&nbsp;<span class="ident" id="5461593">list</span>&nbsp;<span class="op" id="5461598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5461602">if</span>&nbsp;<span class="ident" id="5461605">i</span>&nbsp;<span class="op" id="5461607">&gt;</span>&nbsp;<span class="num" id="5461609">0</span>&nbsp;<span class="op" id="5461611">&amp;&amp;</span>&nbsp;<span class="ident" id="5461614">p</span><span class="op" id="5461615">.</span><span class="ident" id="5461616">lineFor</span><span class="op" id="5461623">(</span><span class="ident" id="5461624">list</span><span class="op" id="5461628">[</span><span class="ident" id="5461629">i</span><span class="op" id="5461630">]</span><span class="op" id="5461631">.</span><span class="ident" id="5461632">Pos</span><span class="op" id="5461635">(</span><span class="op" id="5461636">)</span><span class="op" id="5461637">)</span>&nbsp;<span class="op" id="5461639">!=</span>&nbsp;<span class="ident" id="5461642">line</span>&nbsp;<span class="op" id="5461647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5461652">//&nbsp;not&nbsp;all&nbsp;comments&nbsp;on&nbsp;the&nbsp;same&nbsp;line</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5461692">return</span>&nbsp;<span class="builtintype" id="5461699">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5461706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5461710">if</span>&nbsp;<span class="ident" id="5461713">t</span>&nbsp;<span class="op" id="5461715">:=</span>&nbsp;<span class="ident" id="5461718">c</span><span class="op" id="5461719">.</span><span class="ident" id="5461720">Text</span><span class="op" id="5461724">;</span>&nbsp;<span class="builtinfunc" id="5461726">len</span><span class="op" id="5461729">(</span><span class="ident" id="5461730">t</span><span class="op" id="5461731">)</span>&nbsp;<span class="op" id="5461733">&gt;=</span>&nbsp;<span class="num" id="5461736">2</span>&nbsp;<span class="op" id="5461738">&amp;&amp;</span>&nbsp;<span class="op" id="5461741">(</span><span class="ident" id="5461742">t</span><span class="op" id="5461743">[</span><span class="num" id="5461744">1</span><span class="op" id="5461745">]</span>&nbsp;<span class="op" id="5461747">==</span>&nbsp;<span class="string" id="5461750">&#39;/&#39;</span>&nbsp;<span class="op" id="5461754">||</span>&nbsp;<span class="ident" id="5461757">strings</span><span class="op" id="5461764">.</span><span class="ident" id="5461765">Contains</span><span class="op" id="5461773">(</span><span class="ident" id="5461774">t</span><span class="op" id="5461775">,</span>&nbsp;<span class="string" id="5461777">&#34;\n&#34;</span><span class="op" id="5461781">)</span><span class="op" id="5461782">)</span>&nbsp;<span class="op" id="5461784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5461789">return</span>&nbsp;<span class="builtintype" id="5461796">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5461803">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5461806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5461809">_</span>&nbsp;<span class="op" id="5461811">=</span>&nbsp;<span class="ident" id="5461813">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5461819">return</span>&nbsp;<span class="builtintype" id="5461826">false</span><br>
<span class="lineno"></span><span class="op" id="5461832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="5461835">func</span>&nbsp;<span class="op" id="5461840">(</span><span class="ident" id="5461841">p</span>&nbsp;<span class="op" id="5461843">*</span><span class="ident" id="5461844">printer</span><span class="op" id="5461851">)</span>&nbsp;<span class="ident" id="5461853">nextComment</span><span class="op" id="5461864">(</span><span class="op" id="5461865">)</span>&nbsp;<span class="op" id="5461867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5461870">for</span>&nbsp;<span class="ident" id="5461874">p</span><span class="op" id="5461875">.</span><span class="ident" id="5461876">cindex</span>&nbsp;<span class="op" id="5461883">&lt;</span>&nbsp;<span class="builtinfunc" id="5461885">len</span><span class="op" id="5461888">(</span><span class="ident" id="5461889">p</span><span class="op" id="5461890">.</span><span class="ident" id="5461891">comments</span><span class="op" id="5461899">)</span>&nbsp;<span class="op" id="5461901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5461905">c</span>&nbsp;<span class="op" id="5461907">:=</span>&nbsp;<span class="ident" id="5461910">p</span><span class="op" id="5461911">.</span><span class="ident" id="5461912">comments</span><span class="op" id="5461920">[</span><span class="ident" id="5461921">p</span><span class="op" id="5461922">.</span><span class="ident" id="5461923">cindex</span><span class="op" id="5461929">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5461933">p</span><span class="op" id="5461934">.</span><span class="ident" id="5461935">cindex</span><span class="op" id="5461941">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5461946">if</span>&nbsp;<span class="ident" id="5461949">list</span>&nbsp;<span class="op" id="5461954">:=</span>&nbsp;<span class="ident" id="5461957">c</span><span class="op" id="5461958">.</span><span class="ident" id="5461959">List</span><span class="op" id="5461963">;</span>&nbsp;<span class="builtinfunc" id="5461965">len</span><span class="op" id="5461968">(</span><span class="ident" id="5461969">list</span><span class="op" id="5461973">)</span>&nbsp;<span class="op" id="5461975">&gt;</span>&nbsp;<span class="num" id="5461977">0</span>&nbsp;<span class="op" id="5461979">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5461984">p</span><span class="op" id="5461985">.</span><span class="ident" id="5461986">comment</span>&nbsp;<span class="op" id="5461994">=</span>&nbsp;<span class="ident" id="5461996">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5462001">p</span><span class="op" id="5462002">.</span><span class="ident" id="5462003">commentOffset</span>&nbsp;<span class="op" id="5462017">=</span>&nbsp;<span class="ident" id="5462019">p</span><span class="op" id="5462020">.</span><span class="ident" id="5462021">posFor</span><span class="op" id="5462027">(</span><span class="ident" id="5462028">list</span><span class="op" id="5462032">[</span><span class="num" id="5462033">0</span><span class="op" id="5462034">]</span><span class="op" id="5462035">.</span><span class="ident" id="5462036">Pos</span><span class="op" id="5462039">(</span><span class="op" id="5462040">)</span><span class="op" id="5462041">)</span><span class="op" id="5462042">.</span><span class="ident" id="5462043">Offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5462053">p</span><span class="op" id="5462054">.</span><span class="ident" id="5462055">commentNewline</span>&nbsp;<span class="op" id="5462070">=</span>&nbsp;<span class="ident" id="5462072">p</span><span class="op" id="5462073">.</span><span class="ident" id="5462074">commentsHaveNewline</span><span class="op" id="5462093">(</span><span class="ident" id="5462094">list</span><span class="op" id="5462098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5462103">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5462112">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5462116">//&nbsp;we&nbsp;should&nbsp;not&nbsp;reach&nbsp;here&nbsp;(correct&nbsp;ASTs&nbsp;don&#39;t&nbsp;have&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5462177">//&nbsp;ast.CommentGroup&nbsp;nodes),&nbsp;but&nbsp;be&nbsp;conservative&nbsp;and&nbsp;try&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5462240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5462243">//&nbsp;no&nbsp;more&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5462264">p</span><span class="op" id="5462265">.</span><span class="ident" id="5462266">commentOffset</span>&nbsp;<span class="op" id="5462280">=</span>&nbsp;<span class="ident" id="5462282">infinity</span><br>
<span class="lineno">145</span><span class="op" id="5462291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5462294">//&nbsp;commentBefore&nbsp;returns&nbsp;true&nbsp;iff&nbsp;the&nbsp;current&nbsp;comment&nbsp;group&nbsp;occurs</span><br>
<span class="lineno"></span><span class="comment" id="5462361">//&nbsp;before&nbsp;the&nbsp;next&nbsp;position&nbsp;in&nbsp;the&nbsp;source&nbsp;code&nbsp;and&nbsp;printing&nbsp;it&nbsp;does</span><br>
<span class="lineno"></span><span class="comment" id="5462429">//&nbsp;not&nbsp;introduce&nbsp;implicit&nbsp;semicolons.</span><br>
<span class="lineno">150</span><span class="comment" id="5462467">//</span><br>
<span class="lineno"></span><span class="keyword" id="5462470">func</span>&nbsp;<span class="op" id="5462475">(</span><span class="ident" id="5462476">p</span>&nbsp;<span class="op" id="5462478">*</span><span class="ident" id="5462479">printer</span><span class="op" id="5462486">)</span>&nbsp;<span class="ident" id="5462488">commentBefore</span><span class="op" id="5462501">(</span><span class="ident" id="5462502">next</span>&nbsp;<span class="ident" id="5462507">token</span><span class="op" id="5462512">.</span><span class="ident" id="5462513">Position</span><span class="op" id="5462521">)</span>&nbsp;<span class="builtintype" id="5462523">bool</span>&nbsp;<span class="op" id="5462528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5462531">return</span>&nbsp;<span class="ident" id="5462538">p</span><span class="op" id="5462539">.</span><span class="ident" id="5462540">commentOffset</span>&nbsp;<span class="op" id="5462554">&lt;</span>&nbsp;<span class="ident" id="5462556">next</span><span class="op" id="5462560">.</span><span class="ident" id="5462561">Offset</span>&nbsp;<span class="op" id="5462568">&amp;&amp;</span>&nbsp;<span class="op" id="5462571">(</span><span class="op" id="5462572">!</span><span class="ident" id="5462573">p</span><span class="op" id="5462574">.</span><span class="ident" id="5462575">impliedSemi</span>&nbsp;<span class="op" id="5462587">||</span>&nbsp;<span class="op" id="5462590">!</span><span class="ident" id="5462591">p</span><span class="op" id="5462592">.</span><span class="ident" id="5462593">commentNewline</span><span class="op" id="5462607">)</span><br>
<span class="lineno"></span><span class="op" id="5462609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="comment" id="5462612">//&nbsp;commentSizeBefore&nbsp;returns&nbsp;the&nbsp;estimated&nbsp;size&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5462667">//&nbsp;comments&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;before&nbsp;the&nbsp;next&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="5462722">//</span><br>
<span class="lineno"></span><span class="keyword" id="5462725">func</span>&nbsp;<span class="op" id="5462730">(</span><span class="ident" id="5462731">p</span>&nbsp;<span class="op" id="5462733">*</span><span class="ident" id="5462734">printer</span><span class="op" id="5462741">)</span>&nbsp;<span class="ident" id="5462743">commentSizeBefore</span><span class="op" id="5462760">(</span><span class="ident" id="5462761">next</span>&nbsp;<span class="ident" id="5462766">token</span><span class="op" id="5462771">.</span><span class="ident" id="5462772">Position</span><span class="op" id="5462780">)</span>&nbsp;<span class="builtintype" id="5462782">int</span>&nbsp;<span class="op" id="5462786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5462789">//&nbsp;save/restore&nbsp;current&nbsp;p.commentInfo&nbsp;(p.nextComment()&nbsp;modifies&nbsp;it)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5462858">defer</span>&nbsp;<span class="keyword" id="5462864">func</span><span class="op" id="5462868">(</span><span class="ident" id="5462869">info</span>&nbsp;<span class="ident" id="5462874">commentInfo</span><span class="op" id="5462885">)</span>&nbsp;<span class="op" id="5462887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5462891">p</span><span class="op" id="5462892">.</span><span class="ident" id="5462893">commentInfo</span>&nbsp;<span class="op" id="5462905">=</span>&nbsp;<span class="ident" id="5462907">info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5462913">}</span><span class="op" id="5462914">(</span><span class="ident" id="5462915">p</span><span class="op" id="5462916">.</span><span class="ident" id="5462917">commentInfo</span><span class="op" id="5462928">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5462932">size</span>&nbsp;<span class="op" id="5462937">:=</span>&nbsp;<span class="num" id="5462940">0</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5462943">for</span>&nbsp;<span class="ident" id="5462947">p</span><span class="op" id="5462948">.</span><span class="ident" id="5462949">commentBefore</span><span class="op" id="5462962">(</span><span class="ident" id="5462963">next</span><span class="op" id="5462967">)</span>&nbsp;<span class="op" id="5462969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5462973">for</span>&nbsp;<span class="ident" id="5462977">_</span><span class="op" id="5462978">,</span>&nbsp;<span class="ident" id="5462980">c</span>&nbsp;<span class="op" id="5462982">:=</span>&nbsp;<span class="keyword" id="5462985">range</span>&nbsp;<span class="ident" id="5462991">p</span><span class="op" id="5462992">.</span><span class="ident" id="5462993">comment</span><span class="op" id="5463000">.</span><span class="ident" id="5463001">List</span>&nbsp;<span class="op" id="5463006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5463011">size</span>&nbsp;<span class="op" id="5463016">+=</span>&nbsp;<span class="builtinfunc" id="5463019">len</span><span class="op" id="5463022">(</span><span class="ident" id="5463023">c</span><span class="op" id="5463024">.</span><span class="ident" id="5463025">Text</span><span class="op" id="5463029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5463033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5463037">p</span><span class="op" id="5463038">.</span><span class="ident" id="5463039">nextComment</span><span class="op" id="5463050">(</span><span class="op" id="5463051">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5463054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5463057">return</span>&nbsp;<span class="ident" id="5463064">size</span><br>
<span class="lineno"></span><span class="op" id="5463069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5463072">//&nbsp;recordLine&nbsp;records&nbsp;the&nbsp;output&nbsp;line&nbsp;number&nbsp;for&nbsp;the&nbsp;next&nbsp;non-whitespace</span><br>
<span class="lineno">175</span><span class="comment" id="5463145">//&nbsp;token&nbsp;in&nbsp;*linePtr.&nbsp;It&nbsp;is&nbsp;used&nbsp;to&nbsp;compute&nbsp;an&nbsp;accurate&nbsp;line&nbsp;number&nbsp;for&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5463219">//&nbsp;formatted&nbsp;construct,&nbsp;independent&nbsp;of&nbsp;pending&nbsp;(not&nbsp;yet&nbsp;emitted)&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="5463295">//&nbsp;or&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="5463311">//</span><br>
<span class="lineno"></span><span class="keyword" id="5463314">func</span>&nbsp;<span class="op" id="5463319">(</span><span class="ident" id="5463320">p</span>&nbsp;<span class="op" id="5463322">*</span><span class="ident" id="5463323">printer</span><span class="op" id="5463330">)</span>&nbsp;<span class="ident" id="5463332">recordLine</span><span class="op" id="5463342">(</span><span class="ident" id="5463343">linePtr</span>&nbsp;<span class="op" id="5463351">*</span><span class="builtintype" id="5463352">int</span><span class="op" id="5463355">)</span>&nbsp;<span class="op" id="5463357">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5463360">p</span><span class="op" id="5463361">.</span><span class="ident" id="5463362">linePtr</span>&nbsp;<span class="op" id="5463370">=</span>&nbsp;<span class="ident" id="5463372">linePtr</span><br>
<span class="lineno"></span><span class="op" id="5463380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5463383">//&nbsp;linesFrom&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;output&nbsp;lines&nbsp;between&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="5463451">//&nbsp;output&nbsp;line&nbsp;and&nbsp;the&nbsp;line&nbsp;argument,&nbsp;ignoring&nbsp;any&nbsp;pending&nbsp;(not&nbsp;yet</span><br>
<span class="lineno">185</span><span class="comment" id="5463519">//&nbsp;emitted)&nbsp;whitespace&nbsp;or&nbsp;comments.&nbsp;It&nbsp;is&nbsp;used&nbsp;to&nbsp;compute&nbsp;an&nbsp;accurate</span><br>
<span class="lineno"></span><span class="comment" id="5463589">//&nbsp;size&nbsp;(in&nbsp;number&nbsp;of&nbsp;lines)&nbsp;for&nbsp;a&nbsp;formatted&nbsp;construct.</span><br>
<span class="lineno"></span><span class="comment" id="5463645">//</span><br>
<span class="lineno"></span><span class="keyword" id="5463648">func</span>&nbsp;<span class="op" id="5463653">(</span><span class="ident" id="5463654">p</span>&nbsp;<span class="op" id="5463656">*</span><span class="ident" id="5463657">printer</span><span class="op" id="5463664">)</span>&nbsp;<span class="ident" id="5463666">linesFrom</span><span class="op" id="5463675">(</span><span class="ident" id="5463676">line</span>&nbsp;<span class="builtintype" id="5463681">int</span><span class="op" id="5463684">)</span>&nbsp;<span class="builtintype" id="5463686">int</span>&nbsp;<span class="op" id="5463690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5463693">return</span>&nbsp;<span class="ident" id="5463700">p</span><span class="op" id="5463701">.</span><span class="ident" id="5463702">out</span><span class="op" id="5463705">.</span><span class="ident" id="5463706">Line</span>&nbsp;<span class="op" id="5463711">-</span>&nbsp;<span class="ident" id="5463713">line</span><br>
<span class="lineno">190</span><span class="op" id="5463718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5463721">func</span>&nbsp;<span class="op" id="5463726">(</span><span class="ident" id="5463727">p</span>&nbsp;<span class="op" id="5463729">*</span><span class="ident" id="5463730">printer</span><span class="op" id="5463737">)</span>&nbsp;<span class="ident" id="5463739">posFor</span><span class="op" id="5463745">(</span><span class="ident" id="5463746">pos</span>&nbsp;<span class="ident" id="5463750">token</span><span class="op" id="5463755">.</span><span class="ident" id="5463756">Pos</span><span class="op" id="5463759">)</span>&nbsp;<span class="ident" id="5463761">token</span><span class="op" id="5463766">.</span><span class="ident" id="5463767">Position</span>&nbsp;<span class="op" id="5463776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5463779">//&nbsp;not&nbsp;used&nbsp;frequently&nbsp;enough&nbsp;to&nbsp;cache&nbsp;entire&nbsp;token.Position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5463841">return</span>&nbsp;<span class="ident" id="5463848">p</span><span class="op" id="5463849">.</span><span class="ident" id="5463850">fset</span><span class="op" id="5463854">.</span><span class="ident" id="5463855">Position</span><span class="op" id="5463863">(</span><span class="ident" id="5463864">pos</span><span class="op" id="5463867">)</span><br>
<span class="lineno">195</span><span class="op" id="5463869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5463872">func</span>&nbsp;<span class="op" id="5463877">(</span><span class="ident" id="5463878">p</span>&nbsp;<span class="op" id="5463880">*</span><span class="ident" id="5463881">printer</span><span class="op" id="5463888">)</span>&nbsp;<span class="ident" id="5463890">lineFor</span><span class="op" id="5463897">(</span><span class="ident" id="5463898">pos</span>&nbsp;<span class="ident" id="5463902">token</span><span class="op" id="5463907">.</span><span class="ident" id="5463908">Pos</span><span class="op" id="5463911">)</span>&nbsp;<span class="builtintype" id="5463913">int</span>&nbsp;<span class="op" id="5463917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5463920">if</span>&nbsp;<span class="ident" id="5463923">pos</span>&nbsp;<span class="op" id="5463927">!=</span>&nbsp;<span class="ident" id="5463930">p</span><span class="op" id="5463931">.</span><span class="ident" id="5463932">cachedPos</span>&nbsp;<span class="op" id="5463942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5463946">p</span><span class="op" id="5463947">.</span><span class="ident" id="5463948">cachedPos</span>&nbsp;<span class="op" id="5463958">=</span>&nbsp;<span class="ident" id="5463960">pos</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5463966">p</span><span class="op" id="5463967">.</span><span class="ident" id="5463968">cachedLine</span>&nbsp;<span class="op" id="5463979">=</span>&nbsp;<span class="ident" id="5463981">p</span><span class="op" id="5463982">.</span><span class="ident" id="5463983">fset</span><span class="op" id="5463987">.</span><span class="ident" id="5463988">Position</span><span class="op" id="5463996">(</span><span class="ident" id="5463997">pos</span><span class="op" id="5464000">)</span><span class="op" id="5464001">.</span><span class="ident" id="5464002">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5464008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5464011">return</span>&nbsp;<span class="ident" id="5464018">p</span><span class="op" id="5464019">.</span><span class="ident" id="5464020">cachedLine</span><br>
<span class="lineno"></span><span class="op" id="5464031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="5464034">//&nbsp;atLineBegin&nbsp;emits&nbsp;a&nbsp;//line&nbsp;comment&nbsp;if&nbsp;necessary&nbsp;and&nbsp;prints&nbsp;indentation.</span><br>
<span class="lineno"></span><span class="keyword" id="5464109">func</span>&nbsp;<span class="op" id="5464114">(</span><span class="ident" id="5464115">p</span>&nbsp;<span class="op" id="5464117">*</span><span class="ident" id="5464118">printer</span><span class="op" id="5464125">)</span>&nbsp;<span class="ident" id="5464127">atLineBegin</span><span class="op" id="5464138">(</span><span class="ident" id="5464139">pos</span>&nbsp;<span class="ident" id="5464143">token</span><span class="op" id="5464148">.</span><span class="ident" id="5464149">Position</span><span class="op" id="5464157">)</span>&nbsp;<span class="op" id="5464159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5464162">//&nbsp;write&nbsp;a&nbsp;//line&nbsp;comment&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5464202">if</span>&nbsp;<span class="ident" id="5464205">p</span><span class="op" id="5464206">.</span><span class="ident" id="5464207">Config</span><span class="op" id="5464213">.</span><span class="ident" id="5464214">Mode</span><span class="op" id="5464218">&amp;</span><span class="ident" id="5464219">SourcePos</span>&nbsp;<span class="op" id="5464229">!=</span>&nbsp;<span class="num" id="5464232">0</span>&nbsp;<span class="op" id="5464234">&amp;&amp;</span>&nbsp;<span class="ident" id="5464237">pos</span><span class="op" id="5464240">.</span><span class="ident" id="5464241">IsValid</span><span class="op" id="5464248">(</span><span class="op" id="5464249">)</span>&nbsp;<span class="op" id="5464251">&amp;&amp;</span>&nbsp;<span class="op" id="5464254">(</span><span class="ident" id="5464255">p</span><span class="op" id="5464256">.</span><span class="ident" id="5464257">out</span><span class="op" id="5464260">.</span><span class="ident" id="5464261">Line</span>&nbsp;<span class="op" id="5464266">!=</span>&nbsp;<span class="ident" id="5464269">pos</span><span class="op" id="5464272">.</span><span class="ident" id="5464273">Line</span>&nbsp;<span class="op" id="5464278">||</span>&nbsp;<span class="ident" id="5464281">p</span><span class="op" id="5464282">.</span><span class="ident" id="5464283">out</span><span class="op" id="5464286">.</span><span class="ident" id="5464287">Filename</span>&nbsp;<span class="op" id="5464296">!=</span>&nbsp;<span class="ident" id="5464299">pos</span><span class="op" id="5464302">.</span><span class="ident" id="5464303">Filename</span><span class="op" id="5464311">)</span>&nbsp;<span class="op" id="5464313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5464317">p</span><span class="op" id="5464318">.</span><span class="ident" id="5464319">output</span>&nbsp;<span class="op" id="5464326">=</span>&nbsp;<span class="builtinfunc" id="5464328">append</span><span class="op" id="5464334">(</span><span class="ident" id="5464335">p</span><span class="op" id="5464336">.</span><span class="ident" id="5464337">output</span><span class="op" id="5464343">,</span>&nbsp;<span class="ident" id="5464345">tabwriter</span><span class="op" id="5464354">.</span><span class="ident" id="5464355">Escape</span><span class="op" id="5464361">)</span>&nbsp;<span class="comment" id="5464363">//&nbsp;protect&nbsp;&#39;\n&#39;&nbsp;in&nbsp;//line&nbsp;from&nbsp;tabwriter&nbsp;interpretation</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5464421">p</span><span class="op" id="5464422">.</span><span class="ident" id="5464423">output</span>&nbsp;<span class="op" id="5464430">=</span>&nbsp;<span class="builtinfunc" id="5464432">append</span><span class="op" id="5464438">(</span><span class="ident" id="5464439">p</span><span class="op" id="5464440">.</span><span class="ident" id="5464441">output</span><span class="op" id="5464447">,</span>&nbsp;<span class="ident" id="5464449">fmt</span><span class="op" id="5464452">.</span><span class="ident" id="5464453">Sprintf</span><span class="op" id="5464460">(</span><span class="string" id="5464461">&#34;//line&nbsp;%s:%d\n&#34;</span><span class="op" id="5464477">,</span>&nbsp;<span class="ident" id="5464479">pos</span><span class="op" id="5464482">.</span><span class="ident" id="5464483">Filename</span><span class="op" id="5464491">,</span>&nbsp;<span class="ident" id="5464493">pos</span><span class="op" id="5464496">.</span><span class="ident" id="5464497">Line</span><span class="op" id="5464501">)</span><span class="op" id="5464502">...</span><span class="op" id="5464505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5464509">p</span><span class="op" id="5464510">.</span><span class="ident" id="5464511">output</span>&nbsp;<span class="op" id="5464518">=</span>&nbsp;<span class="builtinfunc" id="5464520">append</span><span class="op" id="5464526">(</span><span class="ident" id="5464527">p</span><span class="op" id="5464528">.</span><span class="ident" id="5464529">output</span><span class="op" id="5464535">,</span>&nbsp;<span class="ident" id="5464537">tabwriter</span><span class="op" id="5464546">.</span><span class="ident" id="5464547">Escape</span><span class="op" id="5464553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5464557">//&nbsp;p.out&nbsp;must&nbsp;match&nbsp;the&nbsp;//line&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5464598">p</span><span class="op" id="5464599">.</span><span class="ident" id="5464600">out</span><span class="op" id="5464603">.</span><span class="ident" id="5464604">Filename</span>&nbsp;<span class="op" id="5464613">=</span>&nbsp;<span class="ident" id="5464615">pos</span><span class="op" id="5464618">.</span><span class="ident" id="5464619">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5464630">p</span><span class="op" id="5464631">.</span><span class="ident" id="5464632">out</span><span class="op" id="5464635">.</span><span class="ident" id="5464636">Line</span>&nbsp;<span class="op" id="5464641">=</span>&nbsp;<span class="ident" id="5464643">pos</span><span class="op" id="5464646">.</span><span class="ident" id="5464647">Line</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5464653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5464657">//&nbsp;write&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5464679">//&nbsp;use&nbsp;&#34;hard&#34;&nbsp;htabs&nbsp;-&nbsp;indentation&nbsp;columns</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5464722">//&nbsp;must&nbsp;not&nbsp;be&nbsp;discarded&nbsp;by&nbsp;the&nbsp;tabwriter</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5464765">n</span>&nbsp;<span class="op" id="5464767">:=</span>&nbsp;<span class="ident" id="5464770">p</span><span class="op" id="5464771">.</span><span class="ident" id="5464772">Config</span><span class="op" id="5464778">.</span><span class="ident" id="5464779">Indent</span>&nbsp;<span class="op" id="5464786">+</span>&nbsp;<span class="ident" id="5464788">p</span><span class="op" id="5464789">.</span><span class="ident" id="5464790">indent</span>&nbsp;<span class="comment" id="5464797">//&nbsp;include&nbsp;base&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5464826">for</span>&nbsp;<span class="ident" id="5464830">i</span>&nbsp;<span class="op" id="5464832">:=</span>&nbsp;<span class="num" id="5464835">0</span><span class="op" id="5464836">;</span>&nbsp;<span class="ident" id="5464838">i</span>&nbsp;<span class="op" id="5464840">&lt;</span>&nbsp;<span class="ident" id="5464842">n</span><span class="op" id="5464843">;</span>&nbsp;<span class="ident" id="5464845">i</span><span class="op" id="5464846">++</span>&nbsp;<span class="op" id="5464849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5464853">p</span><span class="op" id="5464854">.</span><span class="ident" id="5464855">output</span>&nbsp;<span class="op" id="5464862">=</span>&nbsp;<span class="builtinfunc" id="5464864">append</span><span class="op" id="5464870">(</span><span class="ident" id="5464871">p</span><span class="op" id="5464872">.</span><span class="ident" id="5464873">output</span><span class="op" id="5464879">,</span>&nbsp;<span class="string" id="5464881">&#39;\t&#39;</span><span class="op" id="5464885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5464888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5464892">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5464913">p</span><span class="op" id="5464914">.</span><span class="ident" id="5464915">pos</span><span class="op" id="5464918">.</span><span class="ident" id="5464919">Offset</span>&nbsp;<span class="op" id="5464926">+=</span>&nbsp;<span class="ident" id="5464929">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5464932">p</span><span class="op" id="5464933">.</span><span class="ident" id="5464934">pos</span><span class="op" id="5464937">.</span><span class="ident" id="5464938">Column</span>&nbsp;<span class="op" id="5464945">+=</span>&nbsp;<span class="ident" id="5464948">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5464951">p</span><span class="op" id="5464952">.</span><span class="ident" id="5464953">out</span><span class="op" id="5464956">.</span><span class="ident" id="5464957">Column</span>&nbsp;<span class="op" id="5464964">+=</span>&nbsp;<span class="ident" id="5464967">n</span><br>
<span class="lineno"></span><span class="op" id="5464969">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="5464972">//&nbsp;writeByte&nbsp;writes&nbsp;ch&nbsp;n&nbsp;times&nbsp;to&nbsp;p.output&nbsp;and&nbsp;updates&nbsp;p.pos.</span><br>
<span class="lineno"></span><span class="keyword" id="5465034">func</span>&nbsp;<span class="op" id="5465039">(</span><span class="ident" id="5465040">p</span>&nbsp;<span class="op" id="5465042">*</span><span class="ident" id="5465043">printer</span><span class="op" id="5465050">)</span>&nbsp;<span class="ident" id="5465052">writeByte</span><span class="op" id="5465061">(</span><span class="ident" id="5465062">ch</span>&nbsp;<span class="builtintype" id="5465065">byte</span><span class="op" id="5465069">,</span>&nbsp;<span class="ident" id="5465071">n</span>&nbsp;<span class="builtintype" id="5465073">int</span><span class="op" id="5465076">)</span>&nbsp;<span class="op" id="5465078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5465081">if</span>&nbsp;<span class="ident" id="5465084">p</span><span class="op" id="5465085">.</span><span class="ident" id="5465086">out</span><span class="op" id="5465089">.</span><span class="ident" id="5465090">Column</span>&nbsp;<span class="op" id="5465097">==</span>&nbsp;<span class="num" id="5465100">1</span>&nbsp;<span class="op" id="5465102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5465106">p</span><span class="op" id="5465107">.</span><span class="ident" id="5465108">atLineBegin</span><span class="op" id="5465119">(</span><span class="ident" id="5465120">p</span><span class="op" id="5465121">.</span><span class="ident" id="5465122">pos</span><span class="op" id="5465125">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5465128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5465132">for</span>&nbsp;<span class="ident" id="5465136">i</span>&nbsp;<span class="op" id="5465138">:=</span>&nbsp;<span class="num" id="5465141">0</span><span class="op" id="5465142">;</span>&nbsp;<span class="ident" id="5465144">i</span>&nbsp;<span class="op" id="5465146">&lt;</span>&nbsp;<span class="ident" id="5465148">n</span><span class="op" id="5465149">;</span>&nbsp;<span class="ident" id="5465151">i</span><span class="op" id="5465152">++</span>&nbsp;<span class="op" id="5465155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5465159">p</span><span class="op" id="5465160">.</span><span class="ident" id="5465161">output</span>&nbsp;<span class="op" id="5465168">=</span>&nbsp;<span class="builtinfunc" id="5465170">append</span><span class="op" id="5465176">(</span><span class="ident" id="5465177">p</span><span class="op" id="5465178">.</span><span class="ident" id="5465179">output</span><span class="op" id="5465185">,</span>&nbsp;<span class="ident" id="5465187">ch</span><span class="op" id="5465189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5465192">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5465196">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5465217">p</span><span class="op" id="5465218">.</span><span class="ident" id="5465219">pos</span><span class="op" id="5465222">.</span><span class="ident" id="5465223">Offset</span>&nbsp;<span class="op" id="5465230">+=</span>&nbsp;<span class="ident" id="5465233">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5465236">if</span>&nbsp;<span class="ident" id="5465239">ch</span>&nbsp;<span class="op" id="5465242">==</span>&nbsp;<span class="string" id="5465245">&#39;\n&#39;</span>&nbsp;<span class="op" id="5465250">||</span>&nbsp;<span class="ident" id="5465253">ch</span>&nbsp;<span class="op" id="5465256">==</span>&nbsp;<span class="string" id="5465259">&#39;\f&#39;</span>&nbsp;<span class="op" id="5465264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5465268">p</span><span class="op" id="5465269">.</span><span class="ident" id="5465270">pos</span><span class="op" id="5465273">.</span><span class="ident" id="5465274">Line</span>&nbsp;<span class="op" id="5465279">+=</span>&nbsp;<span class="ident" id="5465282">n</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5465286">p</span><span class="op" id="5465287">.</span><span class="ident" id="5465288">out</span><span class="op" id="5465291">.</span><span class="ident" id="5465292">Line</span>&nbsp;<span class="op" id="5465297">+=</span>&nbsp;<span class="ident" id="5465300">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5465304">p</span><span class="op" id="5465305">.</span><span class="ident" id="5465306">pos</span><span class="op" id="5465309">.</span><span class="ident" id="5465310">Column</span>&nbsp;<span class="op" id="5465317">=</span>&nbsp;<span class="num" id="5465319">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5465323">p</span><span class="op" id="5465324">.</span><span class="ident" id="5465325">out</span><span class="op" id="5465328">.</span><span class="ident" id="5465329">Column</span>&nbsp;<span class="op" id="5465336">=</span>&nbsp;<span class="num" id="5465338">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5465342">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5465350">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5465353">p</span><span class="op" id="5465354">.</span><span class="ident" id="5465355">pos</span><span class="op" id="5465358">.</span><span class="ident" id="5465359">Column</span>&nbsp;<span class="op" id="5465366">+=</span>&nbsp;<span class="ident" id="5465369">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5465372">p</span><span class="op" id="5465373">.</span><span class="ident" id="5465374">out</span><span class="op" id="5465377">.</span><span class="ident" id="5465378">Column</span>&nbsp;<span class="op" id="5465385">+=</span>&nbsp;<span class="ident" id="5465388">n</span><br>
<span class="lineno"></span><span class="op" id="5465390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5465393">//&nbsp;writeString&nbsp;writes&nbsp;the&nbsp;string&nbsp;s&nbsp;to&nbsp;p.output&nbsp;and&nbsp;updates&nbsp;p.pos,&nbsp;p.out,</span><br>
<span class="lineno">255</span><span class="comment" id="5465466">//&nbsp;and&nbsp;p.last.&nbsp;If&nbsp;isLit&nbsp;is&nbsp;set,&nbsp;s&nbsp;is&nbsp;escaped&nbsp;w/&nbsp;tabwriter.Escape&nbsp;characters</span><br>
<span class="lineno"></span><span class="comment" id="5465542">//&nbsp;to&nbsp;protect&nbsp;s&nbsp;from&nbsp;being&nbsp;interpreted&nbsp;by&nbsp;the&nbsp;tabwriter.</span><br>
<span class="lineno"></span><span class="comment" id="5465599">//</span><br>
<span class="lineno"></span><span class="comment" id="5465602">//&nbsp;Note:&nbsp;writeString&nbsp;is&nbsp;only&nbsp;used&nbsp;to&nbsp;write&nbsp;Go&nbsp;tokens,&nbsp;literals,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5465670">//&nbsp;comments,&nbsp;all&nbsp;of&nbsp;which&nbsp;must&nbsp;be&nbsp;written&nbsp;literally.&nbsp;Thus,&nbsp;it&nbsp;is&nbsp;correct</span><br>
<span class="lineno">260</span><span class="comment" id="5465743">//&nbsp;to&nbsp;always&nbsp;set&nbsp;isLit&nbsp;=&nbsp;true.&nbsp;However,&nbsp;setting&nbsp;it&nbsp;explicitly&nbsp;only&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="5465815">//&nbsp;needed&nbsp;(i.e.,&nbsp;when&nbsp;we&nbsp;don&#39;t&nbsp;know&nbsp;that&nbsp;s&nbsp;contains&nbsp;no&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks)</span><br>
<span class="lineno"></span><span class="comment" id="5465891">//&nbsp;avoids&nbsp;processing&nbsp;extra&nbsp;escape&nbsp;characters&nbsp;and&nbsp;reduces&nbsp;run&nbsp;time&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5465964">//&nbsp;printer&nbsp;benchmark&nbsp;by&nbsp;up&nbsp;to&nbsp;10%.</span><br>
<span class="lineno"></span><span class="comment" id="5465999">//</span><br>
<span class="lineno">265</span><span class="keyword" id="5466002">func</span>&nbsp;<span class="op" id="5466007">(</span><span class="ident" id="5466008">p</span>&nbsp;<span class="op" id="5466010">*</span><span class="ident" id="5466011">printer</span><span class="op" id="5466018">)</span>&nbsp;<span class="ident" id="5466020">writeString</span><span class="op" id="5466031">(</span><span class="ident" id="5466032">pos</span>&nbsp;<span class="ident" id="5466036">token</span><span class="op" id="5466041">.</span><span class="ident" id="5466042">Position</span><span class="op" id="5466050">,</span>&nbsp;<span class="ident" id="5466052">s</span>&nbsp;<span class="builtintype" id="5466054">string</span><span class="op" id="5466060">,</span>&nbsp;<span class="ident" id="5466062">isLit</span>&nbsp;<span class="builtintype" id="5466068">bool</span><span class="op" id="5466072">)</span>&nbsp;<span class="op" id="5466074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5466077">if</span>&nbsp;<span class="ident" id="5466080">p</span><span class="op" id="5466081">.</span><span class="ident" id="5466082">out</span><span class="op" id="5466085">.</span><span class="ident" id="5466086">Column</span>&nbsp;<span class="op" id="5466093">==</span>&nbsp;<span class="num" id="5466096">1</span>&nbsp;<span class="op" id="5466098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5466102">p</span><span class="op" id="5466103">.</span><span class="ident" id="5466104">atLineBegin</span><span class="op" id="5466115">(</span><span class="ident" id="5466116">pos</span><span class="op" id="5466119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5466122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5466126">if</span>&nbsp;<span class="ident" id="5466129">pos</span><span class="op" id="5466132">.</span><span class="ident" id="5466133">IsValid</span><span class="op" id="5466140">(</span><span class="op" id="5466141">)</span>&nbsp;<span class="op" id="5466143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5466147">//&nbsp;update&nbsp;p.pos&nbsp;(if&nbsp;pos&nbsp;is&nbsp;invalid,&nbsp;continue&nbsp;with&nbsp;existing&nbsp;p.pos)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5466215">//&nbsp;Note:&nbsp;Must&nbsp;do&nbsp;this&nbsp;after&nbsp;handling&nbsp;line&nbsp;beginnings&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5466278">//&nbsp;atLineBegin&nbsp;updates&nbsp;p.pos&nbsp;if&nbsp;there&#39;s&nbsp;indentation,&nbsp;but&nbsp;p.pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5466343">//&nbsp;is&nbsp;the&nbsp;position&nbsp;of&nbsp;s.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5466370">p</span><span class="op" id="5466371">.</span><span class="ident" id="5466372">pos</span>&nbsp;<span class="op" id="5466376">=</span>&nbsp;<span class="ident" id="5466378">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5466383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5466387">if</span>&nbsp;<span class="ident" id="5466390">isLit</span>&nbsp;<span class="op" id="5466396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5466400">//&nbsp;Protect&nbsp;s&nbsp;such&nbsp;that&nbsp;is&nbsp;passes&nbsp;through&nbsp;the&nbsp;tabwriter</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5466457">//&nbsp;unchanged.&nbsp;Note&nbsp;that&nbsp;valid&nbsp;Go&nbsp;programs&nbsp;cannot&nbsp;contain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5466516">//&nbsp;tabwriter.Escape&nbsp;bytes&nbsp;since&nbsp;they&nbsp;do&nbsp;not&nbsp;appear&nbsp;in&nbsp;legal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5466578">//&nbsp;UTF-8&nbsp;sequences.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5466600">p</span><span class="op" id="5466601">.</span><span class="ident" id="5466602">output</span>&nbsp;<span class="op" id="5466609">=</span>&nbsp;<span class="builtinfunc" id="5466611">append</span><span class="op" id="5466617">(</span><span class="ident" id="5466618">p</span><span class="op" id="5466619">.</span><span class="ident" id="5466620">output</span><span class="op" id="5466626">,</span>&nbsp;<span class="ident" id="5466628">tabwriter</span><span class="op" id="5466637">.</span><span class="ident" id="5466638">Escape</span><span class="op" id="5466644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5466647">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5466651">if</span>&nbsp;<span class="ident" id="5466654">debug</span>&nbsp;<span class="op" id="5466660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5466664">p</span><span class="op" id="5466665">.</span><span class="ident" id="5466666">output</span>&nbsp;<span class="op" id="5466673">=</span>&nbsp;<span class="builtinfunc" id="5466675">append</span><span class="op" id="5466681">(</span><span class="ident" id="5466682">p</span><span class="op" id="5466683">.</span><span class="ident" id="5466684">output</span><span class="op" id="5466690">,</span>&nbsp;<span class="ident" id="5466692">fmt</span><span class="op" id="5466695">.</span><span class="ident" id="5466696">Sprintf</span><span class="op" id="5466703">(</span><span class="string" id="5466704">&#34;/*%s*/&#34;</span><span class="op" id="5466712">,</span>&nbsp;<span class="ident" id="5466714">pos</span><span class="op" id="5466717">)</span><span class="op" id="5466718">...</span><span class="op" id="5466721">)</span>&nbsp;<span class="comment" id="5466723">//&nbsp;do&nbsp;not&nbsp;update&nbsp;p.pos!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5466748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5466751">p</span><span class="op" id="5466752">.</span><span class="ident" id="5466753">output</span>&nbsp;<span class="op" id="5466760">=</span>&nbsp;<span class="builtinfunc" id="5466762">append</span><span class="op" id="5466768">(</span><span class="ident" id="5466769">p</span><span class="op" id="5466770">.</span><span class="ident" id="5466771">output</span><span class="op" id="5466777">,</span>&nbsp;<span class="ident" id="5466779">s</span><span class="op" id="5466780">...</span><span class="op" id="5466783">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5466787">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5466808">nlines</span>&nbsp;<span class="op" id="5466815">:=</span>&nbsp;<span class="num" id="5466818">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5466821">var</span>&nbsp;<span class="ident" id="5466825">li</span>&nbsp;<span class="builtintype" id="5466828">int</span>&nbsp;<span class="comment" id="5466832">//&nbsp;index&nbsp;of&nbsp;last&nbsp;newline;&nbsp;valid&nbsp;if&nbsp;nlines&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5466879">for</span>&nbsp;<span class="ident" id="5466883">i</span>&nbsp;<span class="op" id="5466885">:=</span>&nbsp;<span class="num" id="5466888">0</span><span class="op" id="5466889">;</span>&nbsp;<span class="ident" id="5466891">i</span>&nbsp;<span class="op" id="5466893">&lt;</span>&nbsp;<span class="builtinfunc" id="5466895">len</span><span class="op" id="5466898">(</span><span class="ident" id="5466899">s</span><span class="op" id="5466900">)</span><span class="op" id="5466901">;</span>&nbsp;<span class="ident" id="5466903">i</span><span class="op" id="5466904">++</span>&nbsp;<span class="op" id="5466907">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5466911">//&nbsp;Go&nbsp;tokens&nbsp;cannot&nbsp;contain&nbsp;&#39;\f&#39;&nbsp;-&nbsp;no&nbsp;need&nbsp;to&nbsp;look&nbsp;for&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5466971">if</span>&nbsp;<span class="ident" id="5466974">s</span><span class="op" id="5466975">[</span><span class="ident" id="5466976">i</span><span class="op" id="5466977">]</span>&nbsp;<span class="op" id="5466979">==</span>&nbsp;<span class="string" id="5466982">&#39;\n&#39;</span>&nbsp;<span class="op" id="5466987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5466992">nlines</span><span class="op" id="5466998">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467004">li</span>&nbsp;<span class="op" id="5467007">=</span>&nbsp;<span class="ident" id="5467009">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5467013">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5467016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467019">p</span><span class="op" id="5467020">.</span><span class="ident" id="5467021">pos</span><span class="op" id="5467024">.</span><span class="ident" id="5467025">Offset</span>&nbsp;<span class="op" id="5467032">+=</span>&nbsp;<span class="builtinfunc" id="5467035">len</span><span class="op" id="5467038">(</span><span class="ident" id="5467039">s</span><span class="op" id="5467040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467043">if</span>&nbsp;<span class="ident" id="5467046">nlines</span>&nbsp;<span class="op" id="5467053">&gt;</span>&nbsp;<span class="num" id="5467055">0</span>&nbsp;<span class="op" id="5467057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467061">p</span><span class="op" id="5467062">.</span><span class="ident" id="5467063">pos</span><span class="op" id="5467066">.</span><span class="ident" id="5467067">Line</span>&nbsp;<span class="op" id="5467072">+=</span>&nbsp;<span class="ident" id="5467075">nlines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467084">p</span><span class="op" id="5467085">.</span><span class="ident" id="5467086">out</span><span class="op" id="5467089">.</span><span class="ident" id="5467090">Line</span>&nbsp;<span class="op" id="5467095">+=</span>&nbsp;<span class="ident" id="5467098">nlines</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467107">c</span>&nbsp;<span class="op" id="5467109">:=</span>&nbsp;<span class="builtinfunc" id="5467112">len</span><span class="op" id="5467115">(</span><span class="ident" id="5467116">s</span><span class="op" id="5467117">)</span>&nbsp;<span class="op" id="5467119">-</span>&nbsp;<span class="ident" id="5467121">li</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467126">p</span><span class="op" id="5467127">.</span><span class="ident" id="5467128">pos</span><span class="op" id="5467131">.</span><span class="ident" id="5467132">Column</span>&nbsp;<span class="op" id="5467139">=</span>&nbsp;<span class="ident" id="5467141">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467145">p</span><span class="op" id="5467146">.</span><span class="ident" id="5467147">out</span><span class="op" id="5467150">.</span><span class="ident" id="5467151">Column</span>&nbsp;<span class="op" id="5467158">=</span>&nbsp;<span class="ident" id="5467160">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5467163">}</span>&nbsp;<span class="keyword" id="5467165">else</span>&nbsp;<span class="op" id="5467170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467174">p</span><span class="op" id="5467175">.</span><span class="ident" id="5467176">pos</span><span class="op" id="5467179">.</span><span class="ident" id="5467180">Column</span>&nbsp;<span class="op" id="5467187">+=</span>&nbsp;<span class="builtinfunc" id="5467190">len</span><span class="op" id="5467193">(</span><span class="ident" id="5467194">s</span><span class="op" id="5467195">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467199">p</span><span class="op" id="5467200">.</span><span class="ident" id="5467201">out</span><span class="op" id="5467204">.</span><span class="ident" id="5467205">Column</span>&nbsp;<span class="op" id="5467212">+=</span>&nbsp;<span class="builtinfunc" id="5467215">len</span><span class="op" id="5467218">(</span><span class="ident" id="5467219">s</span><span class="op" id="5467220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5467223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467227">if</span>&nbsp;<span class="ident" id="5467230">isLit</span>&nbsp;<span class="op" id="5467236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467240">p</span><span class="op" id="5467241">.</span><span class="ident" id="5467242">output</span>&nbsp;<span class="op" id="5467249">=</span>&nbsp;<span class="builtinfunc" id="5467251">append</span><span class="op" id="5467257">(</span><span class="ident" id="5467258">p</span><span class="op" id="5467259">.</span><span class="ident" id="5467260">output</span><span class="op" id="5467266">,</span>&nbsp;<span class="ident" id="5467268">tabwriter</span><span class="op" id="5467277">.</span><span class="ident" id="5467278">Escape</span><span class="op" id="5467284">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5467287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467291">p</span><span class="op" id="5467292">.</span><span class="ident" id="5467293">last</span>&nbsp;<span class="op" id="5467298">=</span>&nbsp;<span class="ident" id="5467300">p</span><span class="op" id="5467301">.</span><span class="ident" id="5467302">pos</span><br>
<span class="lineno"></span><span class="op" id="5467306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span><span class="comment" id="5467309">//&nbsp;writeCommentPrefix&nbsp;writes&nbsp;the&nbsp;whitespace&nbsp;before&nbsp;a&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5467371">//&nbsp;If&nbsp;there&nbsp;is&nbsp;any&nbsp;pending&nbsp;whitespace,&nbsp;it&nbsp;consumes&nbsp;as&nbsp;much&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5467433">//&nbsp;it&nbsp;as&nbsp;is&nbsp;likely&nbsp;to&nbsp;help&nbsp;position&nbsp;the&nbsp;comment&nbsp;nicely.</span><br>
<span class="lineno"></span><span class="comment" id="5467489">//&nbsp;pos&nbsp;is&nbsp;the&nbsp;comment&nbsp;position,&nbsp;next&nbsp;the&nbsp;position&nbsp;of&nbsp;the&nbsp;item</span><br>
<span class="lineno"></span><span class="comment" id="5467551">//&nbsp;after&nbsp;all&nbsp;pending&nbsp;comments,&nbsp;prev&nbsp;is&nbsp;the&nbsp;previous&nbsp;comment&nbsp;in</span><br>
<span class="lineno">325</span><span class="comment" id="5467614">//&nbsp;a&nbsp;group&nbsp;of&nbsp;comments&nbsp;(or&nbsp;nil),&nbsp;and&nbsp;tok&nbsp;is&nbsp;the&nbsp;next&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="5467674">//</span><br>
<span class="lineno"></span><span class="keyword" id="5467677">func</span>&nbsp;<span class="op" id="5467682">(</span><span class="ident" id="5467683">p</span>&nbsp;<span class="op" id="5467685">*</span><span class="ident" id="5467686">printer</span><span class="op" id="5467693">)</span>&nbsp;<span class="ident" id="5467695">writeCommentPrefix</span><span class="op" id="5467713">(</span><span class="ident" id="5467714">pos</span><span class="op" id="5467717">,</span>&nbsp;<span class="ident" id="5467719">next</span>&nbsp;<span class="ident" id="5467724">token</span><span class="op" id="5467729">.</span><span class="ident" id="5467730">Position</span><span class="op" id="5467738">,</span>&nbsp;<span class="ident" id="5467740">prev</span><span class="op" id="5467744">,</span>&nbsp;<span class="ident" id="5467746">comment</span>&nbsp;<span class="op" id="5467754">*</span><span class="ident" id="5467755">ast</span><span class="op" id="5467758">.</span><span class="ident" id="5467759">Comment</span><span class="op" id="5467766">,</span>&nbsp;<span class="ident" id="5467768">tok</span>&nbsp;<span class="ident" id="5467772">token</span><span class="op" id="5467777">.</span><span class="ident" id="5467778">Token</span><span class="op" id="5467783">)</span>&nbsp;<span class="op" id="5467785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467788">if</span>&nbsp;<span class="builtinfunc" id="5467791">len</span><span class="op" id="5467794">(</span><span class="ident" id="5467795">p</span><span class="op" id="5467796">.</span><span class="ident" id="5467797">output</span><span class="op" id="5467803">)</span>&nbsp;<span class="op" id="5467805">==</span>&nbsp;<span class="num" id="5467808">0</span>&nbsp;<span class="op" id="5467810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5467814">//&nbsp;the&nbsp;comment&nbsp;is&nbsp;the&nbsp;first&nbsp;item&nbsp;to&nbsp;be&nbsp;printed&nbsp;-&nbsp;don&#39;t&nbsp;write&nbsp;any&nbsp;whitespace</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467892">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5467900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467904">if</span>&nbsp;<span class="ident" id="5467907">pos</span><span class="op" id="5467910">.</span><span class="ident" id="5467911">IsValid</span><span class="op" id="5467918">(</span><span class="op" id="5467919">)</span>&nbsp;<span class="op" id="5467921">&amp;&amp;</span>&nbsp;<span class="ident" id="5467924">pos</span><span class="op" id="5467927">.</span><span class="ident" id="5467928">Filename</span>&nbsp;<span class="op" id="5467937">!=</span>&nbsp;<span class="ident" id="5467940">p</span><span class="op" id="5467941">.</span><span class="ident" id="5467942">last</span><span class="op" id="5467946">.</span><span class="ident" id="5467947">Filename</span>&nbsp;<span class="op" id="5467956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5467960">//&nbsp;comment&nbsp;in&nbsp;a&nbsp;different&nbsp;file&nbsp;-&nbsp;separate&nbsp;with&nbsp;newlines</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468018">p</span><span class="op" id="5468019">.</span><span class="ident" id="5468020">writeByte</span><span class="op" id="5468029">(</span><span class="string" id="5468030">&#39;\f&#39;</span><span class="op" id="5468034">,</span>&nbsp;<span class="ident" id="5468036">maxNewlines</span><span class="op" id="5468047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468051">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5468059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468063">if</span>&nbsp;<span class="ident" id="5468066">pos</span><span class="op" id="5468069">.</span><span class="ident" id="5468070">Line</span>&nbsp;<span class="op" id="5468075">==</span>&nbsp;<span class="ident" id="5468078">p</span><span class="op" id="5468079">.</span><span class="ident" id="5468080">last</span><span class="op" id="5468084">.</span><span class="ident" id="5468085">Line</span>&nbsp;<span class="op" id="5468090">&amp;&amp;</span>&nbsp;<span class="op" id="5468093">(</span><span class="ident" id="5468094">prev</span>&nbsp;<span class="op" id="5468099">==</span>&nbsp;<span class="ident" id="5468102">nil</span>&nbsp;<span class="op" id="5468106">||</span>&nbsp;<span class="ident" id="5468109">prev</span><span class="op" id="5468113">.</span><span class="ident" id="5468114">Text</span><span class="op" id="5468118">[</span><span class="num" id="5468119">1</span><span class="op" id="5468120">]</span>&nbsp;<span class="op" id="5468122">!=</span>&nbsp;<span class="string" id="5468125">&#39;/&#39;</span><span class="op" id="5468128">)</span>&nbsp;<span class="op" id="5468130">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5468134">//&nbsp;comment&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;last&nbsp;item:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5468178">//&nbsp;separate&nbsp;with&nbsp;at&nbsp;least&nbsp;one&nbsp;separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468220">hasSep</span>&nbsp;<span class="op" id="5468227">:=</span>&nbsp;<span class="builtintype" id="5468230">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468238">if</span>&nbsp;<span class="ident" id="5468241">prev</span>&nbsp;<span class="op" id="5468246">==</span>&nbsp;<span class="ident" id="5468249">nil</span>&nbsp;<span class="op" id="5468253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5468258">//&nbsp;first&nbsp;comment&nbsp;of&nbsp;a&nbsp;comment&nbsp;group</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468297">j</span>&nbsp;<span class="op" id="5468299">:=</span>&nbsp;<span class="num" id="5468302">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468307">for</span>&nbsp;<span class="ident" id="5468311">i</span><span class="op" id="5468312">,</span>&nbsp;<span class="ident" id="5468314">ch</span>&nbsp;<span class="op" id="5468317">:=</span>&nbsp;<span class="keyword" id="5468320">range</span>&nbsp;<span class="ident" id="5468326">p</span><span class="op" id="5468327">.</span><span class="ident" id="5468328">wsbuf</span>&nbsp;<span class="op" id="5468334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468340">switch</span>&nbsp;<span class="ident" id="5468347">ch</span>&nbsp;<span class="op" id="5468350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468356">case</span>&nbsp;<span class="ident" id="5468361">blank</span><span class="op" id="5468366">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5468373">//&nbsp;ignore&nbsp;any&nbsp;blanks&nbsp;before&nbsp;a&nbsp;comment</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468416">p</span><span class="op" id="5468417">.</span><span class="ident" id="5468418">wsbuf</span><span class="op" id="5468423">[</span><span class="ident" id="5468424">i</span><span class="op" id="5468425">]</span>&nbsp;<span class="op" id="5468427">=</span>&nbsp;<span class="ident" id="5468429">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468441">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468454">case</span>&nbsp;<span class="ident" id="5468459">vtab</span><span class="op" id="5468463">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5468470">//&nbsp;respect&nbsp;existing&nbsp;tabs&nbsp;-&nbsp;important</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5468512">//&nbsp;for&nbsp;proper&nbsp;formatting&nbsp;of&nbsp;commented&nbsp;structs</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468563">hasSep</span>&nbsp;<span class="op" id="5468570">=</span>&nbsp;<span class="builtintype" id="5468572">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468582">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468595">case</span>&nbsp;<span class="ident" id="5468600">indent</span><span class="op" id="5468606">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5468613">//&nbsp;apply&nbsp;pending&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468647">continue</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5468660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468666">j</span>&nbsp;<span class="op" id="5468668">=</span>&nbsp;<span class="ident" id="5468670">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468676">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5468685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468690">p</span><span class="op" id="5468691">.</span><span class="ident" id="5468692">writeWhitespace</span><span class="op" id="5468707">(</span><span class="ident" id="5468708">j</span><span class="op" id="5468709">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5468713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5468717">//&nbsp;make&nbsp;sure&nbsp;there&nbsp;is&nbsp;at&nbsp;least&nbsp;one&nbsp;separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468764">if</span>&nbsp;<span class="op" id="5468767">!</span><span class="ident" id="5468768">hasSep</span>&nbsp;<span class="op" id="5468775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468780">sep</span>&nbsp;<span class="op" id="5468784">:=</span>&nbsp;<span class="builtintype" id="5468787">byte</span><span class="op" id="5468791">(</span><span class="string" id="5468792">&#39;\t&#39;</span><span class="op" id="5468796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468801">if</span>&nbsp;<span class="ident" id="5468804">pos</span><span class="op" id="5468807">.</span><span class="ident" id="5468808">Line</span>&nbsp;<span class="op" id="5468813">==</span>&nbsp;<span class="ident" id="5468816">next</span><span class="op" id="5468820">.</span><span class="ident" id="5468821">Line</span>&nbsp;<span class="op" id="5468826">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5468832">//&nbsp;next&nbsp;item&nbsp;is&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5468884">//&nbsp;(which&nbsp;must&nbsp;be&nbsp;a&nbsp;/*-style&nbsp;comment):&nbsp;separate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5468936">//&nbsp;with&nbsp;a&nbsp;blank&nbsp;instead&nbsp;of&nbsp;a&nbsp;tab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468973">sep</span>&nbsp;<span class="op" id="5468977">=</span>&nbsp;<span class="string" id="5468979">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5468986">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468991">p</span><span class="op" id="5468992">.</span><span class="ident" id="5468993">writeByte</span><span class="op" id="5469002">(</span><span class="ident" id="5469003">sep</span><span class="op" id="5469006">,</span>&nbsp;<span class="num" id="5469008">1</span><span class="op" id="5469009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5469013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5469017">}</span>&nbsp;<span class="keyword" id="5469019">else</span>&nbsp;<span class="op" id="5469024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5469028">//&nbsp;comment&nbsp;on&nbsp;a&nbsp;different&nbsp;line:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5469062">//&nbsp;separate&nbsp;with&nbsp;at&nbsp;least&nbsp;one&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469105">droppedLinebreak</span>&nbsp;<span class="op" id="5469122">:=</span>&nbsp;<span class="builtintype" id="5469125">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469133">j</span>&nbsp;<span class="op" id="5469135">:=</span>&nbsp;<span class="num" id="5469138">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469142">for</span>&nbsp;<span class="ident" id="5469146">i</span><span class="op" id="5469147">,</span>&nbsp;<span class="ident" id="5469149">ch</span>&nbsp;<span class="op" id="5469152">:=</span>&nbsp;<span class="keyword" id="5469155">range</span>&nbsp;<span class="ident" id="5469161">p</span><span class="op" id="5469162">.</span><span class="ident" id="5469163">wsbuf</span>&nbsp;<span class="op" id="5469169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469174">switch</span>&nbsp;<span class="ident" id="5469181">ch</span>&nbsp;<span class="op" id="5469184">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469189">case</span>&nbsp;<span class="ident" id="5469194">blank</span><span class="op" id="5469199">,</span>&nbsp;<span class="ident" id="5469201">vtab</span><span class="op" id="5469205">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5469211">//&nbsp;ignore&nbsp;any&nbsp;horizontal&nbsp;whitespace&nbsp;before&nbsp;line&nbsp;breaks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469270">p</span><span class="op" id="5469271">.</span><span class="ident" id="5469272">wsbuf</span><span class="op" id="5469277">[</span><span class="ident" id="5469278">i</span><span class="op" id="5469279">]</span>&nbsp;<span class="op" id="5469281">=</span>&nbsp;<span class="ident" id="5469283">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469294">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469306">case</span>&nbsp;<span class="ident" id="5469311">indent</span><span class="op" id="5469317">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5469323">//&nbsp;apply&nbsp;pending&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469356">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469368">case</span>&nbsp;<span class="ident" id="5469373">unindent</span><span class="op" id="5469381">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5469387">//&nbsp;if&nbsp;this&nbsp;is&nbsp;not&nbsp;the&nbsp;last&nbsp;unindent,&nbsp;apply&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5469437">//&nbsp;as&nbsp;it&nbsp;is&nbsp;(likely)&nbsp;belonging&nbsp;to&nbsp;the&nbsp;last</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5469484">//&nbsp;construct&nbsp;(e.g.,&nbsp;a&nbsp;multi-line&nbsp;expression&nbsp;list)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5469538">//&nbsp;and&nbsp;is&nbsp;not&nbsp;part&nbsp;of&nbsp;closing&nbsp;a&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469580">if</span>&nbsp;<span class="ident" id="5469583">i</span><span class="op" id="5469584">+</span><span class="num" id="5469585">1</span>&nbsp;<span class="op" id="5469587">&lt;</span>&nbsp;<span class="builtinfunc" id="5469589">len</span><span class="op" id="5469592">(</span><span class="ident" id="5469593">p</span><span class="op" id="5469594">.</span><span class="ident" id="5469595">wsbuf</span><span class="op" id="5469600">)</span>&nbsp;<span class="op" id="5469602">&amp;&amp;</span>&nbsp;<span class="ident" id="5469605">p</span><span class="op" id="5469606">.</span><span class="ident" id="5469607">wsbuf</span><span class="op" id="5469612">[</span><span class="ident" id="5469613">i</span><span class="op" id="5469614">+</span><span class="num" id="5469615">1</span><span class="op" id="5469616">]</span>&nbsp;<span class="op" id="5469618">==</span>&nbsp;<span class="ident" id="5469621">unindent</span>&nbsp;<span class="op" id="5469630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469637">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5469650">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5469656">//&nbsp;if&nbsp;the&nbsp;next&nbsp;token&nbsp;is&nbsp;not&nbsp;a&nbsp;closing&nbsp;},&nbsp;apply&nbsp;the&nbsp;unindent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5469720">//&nbsp;if&nbsp;it&nbsp;appears&nbsp;that&nbsp;the&nbsp;comment&nbsp;is&nbsp;aligned&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5469778">//&nbsp;token;&nbsp;otherwise&nbsp;assume&nbsp;the&nbsp;unindent&nbsp;is&nbsp;part&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5469835">//&nbsp;closing&nbsp;block&nbsp;and&nbsp;stop&nbsp;(this&nbsp;scenario&nbsp;appears&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5469893">//&nbsp;comments&nbsp;before&nbsp;a&nbsp;case&nbsp;label&nbsp;where&nbsp;the&nbsp;comments</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5469948">//&nbsp;apply&nbsp;to&nbsp;the&nbsp;next&nbsp;case&nbsp;instead&nbsp;of&nbsp;the&nbsp;current&nbsp;one)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470006">if</span>&nbsp;<span class="ident" id="5470009">tok</span>&nbsp;<span class="op" id="5470013">!=</span>&nbsp;<span class="ident" id="5470016">token</span><span class="op" id="5470021">.</span><span class="ident" id="5470022">RBRACE</span>&nbsp;<span class="op" id="5470029">&amp;&amp;</span>&nbsp;<span class="ident" id="5470032">pos</span><span class="op" id="5470035">.</span><span class="ident" id="5470036">Column</span>&nbsp;<span class="op" id="5470043">==</span>&nbsp;<span class="ident" id="5470046">next</span><span class="op" id="5470050">.</span><span class="ident" id="5470051">Column</span>&nbsp;<span class="op" id="5470058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470065">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5470078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470083">case</span>&nbsp;<span class="ident" id="5470088">newline</span><span class="op" id="5470095">,</span>&nbsp;<span class="ident" id="5470097">formfeed</span><span class="op" id="5470105">:</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470111">p</span><span class="op" id="5470112">.</span><span class="ident" id="5470113">wsbuf</span><span class="op" id="5470118">[</span><span class="ident" id="5470119">i</span><span class="op" id="5470120">]</span>&nbsp;<span class="op" id="5470122">=</span>&nbsp;<span class="ident" id="5470124">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470135">droppedLinebreak</span>&nbsp;<span class="op" id="5470152">=</span>&nbsp;<span class="ident" id="5470154">prev</span>&nbsp;<span class="op" id="5470159">==</span>&nbsp;<span class="ident" id="5470162">nil</span>&nbsp;<span class="comment" id="5470166">//&nbsp;record&nbsp;only&nbsp;if&nbsp;first&nbsp;comment&nbsp;of&nbsp;a&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5470212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470217">j</span>&nbsp;<span class="op" id="5470219">=</span>&nbsp;<span class="ident" id="5470221">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470226">break</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5470234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470238">p</span><span class="op" id="5470239">.</span><span class="ident" id="5470240">writeWhitespace</span><span class="op" id="5470255">(</span><span class="ident" id="5470256">j</span><span class="op" id="5470257">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5470262">//&nbsp;determine&nbsp;number&nbsp;of&nbsp;linebreaks&nbsp;before&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470317">n</span>&nbsp;<span class="op" id="5470319">:=</span>&nbsp;<span class="num" id="5470322">0</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470326">if</span>&nbsp;<span class="ident" id="5470329">pos</span><span class="op" id="5470332">.</span><span class="ident" id="5470333">IsValid</span><span class="op" id="5470340">(</span><span class="op" id="5470341">)</span>&nbsp;<span class="op" id="5470343">&amp;&amp;</span>&nbsp;<span class="ident" id="5470346">p</span><span class="op" id="5470347">.</span><span class="ident" id="5470348">last</span><span class="op" id="5470352">.</span><span class="ident" id="5470353">IsValid</span><span class="op" id="5470360">(</span><span class="op" id="5470361">)</span>&nbsp;<span class="op" id="5470363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470368">n</span>&nbsp;<span class="op" id="5470370">=</span>&nbsp;<span class="ident" id="5470372">pos</span><span class="op" id="5470375">.</span><span class="ident" id="5470376">Line</span>&nbsp;<span class="op" id="5470381">-</span>&nbsp;<span class="ident" id="5470383">p</span><span class="op" id="5470384">.</span><span class="ident" id="5470385">last</span><span class="op" id="5470389">.</span><span class="ident" id="5470390">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470398">if</span>&nbsp;<span class="ident" id="5470401">n</span>&nbsp;<span class="op" id="5470403">&lt;</span>&nbsp;<span class="num" id="5470405">0</span>&nbsp;<span class="op" id="5470407">{</span>&nbsp;<span class="comment" id="5470409">//&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470436">n</span>&nbsp;<span class="op" id="5470438">=</span>&nbsp;<span class="num" id="5470440">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5470445">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5470449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5470454">//&nbsp;at&nbsp;the&nbsp;package&nbsp;scope&nbsp;level&nbsp;only&nbsp;(p.indent&nbsp;==&nbsp;0),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5470508">//&nbsp;add&nbsp;an&nbsp;extra&nbsp;newline&nbsp;if&nbsp;we&nbsp;dropped&nbsp;one&nbsp;before:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5470560">//&nbsp;this&nbsp;preserves&nbsp;a&nbsp;blank&nbsp;line&nbsp;before&nbsp;documentation</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5470614">//&nbsp;comments&nbsp;at&nbsp;the&nbsp;package&nbsp;scope&nbsp;level&nbsp;(issue&nbsp;2570)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470668">if</span>&nbsp;<span class="ident" id="5470671">p</span><span class="op" id="5470672">.</span><span class="ident" id="5470673">indent</span>&nbsp;<span class="op" id="5470680">==</span>&nbsp;<span class="num" id="5470683">0</span>&nbsp;<span class="op" id="5470685">&amp;&amp;</span>&nbsp;<span class="ident" id="5470688">droppedLinebreak</span>&nbsp;<span class="op" id="5470705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470710">n</span><span class="op" id="5470711">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5470716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5470721">//&nbsp;make&nbsp;sure&nbsp;there&nbsp;is&nbsp;at&nbsp;least&nbsp;one&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5470769">//&nbsp;if&nbsp;the&nbsp;previous&nbsp;comment&nbsp;was&nbsp;a&nbsp;line&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470817">if</span>&nbsp;<span class="ident" id="5470820">n</span>&nbsp;<span class="op" id="5470822">==</span>&nbsp;<span class="num" id="5470825">0</span>&nbsp;<span class="op" id="5470827">&amp;&amp;</span>&nbsp;<span class="ident" id="5470830">prev</span>&nbsp;<span class="op" id="5470835">!=</span>&nbsp;<span class="ident" id="5470838">nil</span>&nbsp;<span class="op" id="5470842">&amp;&amp;</span>&nbsp;<span class="ident" id="5470845">prev</span><span class="op" id="5470849">.</span><span class="ident" id="5470850">Text</span><span class="op" id="5470854">[</span><span class="num" id="5470855">1</span><span class="op" id="5470856">]</span>&nbsp;<span class="op" id="5470858">==</span>&nbsp;<span class="string" id="5470861">&#39;/&#39;</span>&nbsp;<span class="op" id="5470865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470870">n</span>&nbsp;<span class="op" id="5470872">=</span>&nbsp;<span class="num" id="5470874">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5470878">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470883">if</span>&nbsp;<span class="ident" id="5470886">n</span>&nbsp;<span class="op" id="5470888">&gt;</span>&nbsp;<span class="num" id="5470890">0</span>&nbsp;<span class="op" id="5470892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5470897">//&nbsp;use&nbsp;formfeeds&nbsp;to&nbsp;break&nbsp;columns&nbsp;before&nbsp;a&nbsp;comment;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5470952">//&nbsp;this&nbsp;is&nbsp;analogous&nbsp;to&nbsp;using&nbsp;formfeeds&nbsp;to&nbsp;separate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5471007">//&nbsp;individual&nbsp;lines&nbsp;of&nbsp;/*-style&nbsp;comments</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471051">p</span><span class="op" id="5471052">.</span><span class="ident" id="5471053">writeByte</span><span class="op" id="5471062">(</span><span class="string" id="5471063">&#39;\f&#39;</span><span class="op" id="5471067">,</span>&nbsp;<span class="ident" id="5471069">nlimit</span><span class="op" id="5471075">(</span><span class="ident" id="5471076">n</span><span class="op" id="5471077">)</span><span class="op" id="5471078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471085">}</span><br>
<span class="lineno"></span><span class="op" id="5471087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="comment" id="5471090">//&nbsp;Returns&nbsp;true&nbsp;if&nbsp;s&nbsp;contains&nbsp;only&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="5471137">//&nbsp;(only&nbsp;tabs&nbsp;and&nbsp;blanks&nbsp;can&nbsp;appear&nbsp;in&nbsp;the&nbsp;printer&#39;s&nbsp;context).</span><br>
<span class="lineno"></span><span class="comment" id="5471200">//</span><br>
<span class="lineno"></span><span class="keyword" id="5471203">func</span>&nbsp;<span class="ident" id="5471208">isBlank</span><span class="op" id="5471215">(</span><span class="ident" id="5471216">s</span>&nbsp;<span class="builtintype" id="5471218">string</span><span class="op" id="5471224">)</span>&nbsp;<span class="builtintype" id="5471226">bool</span>&nbsp;<span class="op" id="5471231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471234">for</span>&nbsp;<span class="ident" id="5471238">i</span>&nbsp;<span class="op" id="5471240">:=</span>&nbsp;<span class="num" id="5471243">0</span><span class="op" id="5471244">;</span>&nbsp;<span class="ident" id="5471246">i</span>&nbsp;<span class="op" id="5471248">&lt;</span>&nbsp;<span class="builtinfunc" id="5471250">len</span><span class="op" id="5471253">(</span><span class="ident" id="5471254">s</span><span class="op" id="5471255">)</span><span class="op" id="5471256">;</span>&nbsp;<span class="ident" id="5471258">i</span><span class="op" id="5471259">++</span>&nbsp;<span class="op" id="5471262">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471266">if</span>&nbsp;<span class="ident" id="5471269">s</span><span class="op" id="5471270">[</span><span class="ident" id="5471271">i</span><span class="op" id="5471272">]</span>&nbsp;<span class="op" id="5471274">&gt;</span>&nbsp;<span class="string" id="5471276">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5471280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471285">return</span>&nbsp;<span class="builtintype" id="5471292">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471306">return</span>&nbsp;<span class="builtintype" id="5471313">true</span><br>
<span class="lineno">460</span><span class="op" id="5471318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5471321">//&nbsp;commonPrefix&nbsp;returns&nbsp;the&nbsp;common&nbsp;prefix&nbsp;of&nbsp;a&nbsp;and&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="5471375">func</span>&nbsp;<span class="ident" id="5471380">commonPrefix</span><span class="op" id="5471392">(</span><span class="ident" id="5471393">a</span><span class="op" id="5471394">,</span>&nbsp;<span class="ident" id="5471396">b</span>&nbsp;<span class="builtintype" id="5471398">string</span><span class="op" id="5471404">)</span>&nbsp;<span class="builtintype" id="5471406">string</span>&nbsp;<span class="op" id="5471413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471416">i</span>&nbsp;<span class="op" id="5471418">:=</span>&nbsp;<span class="num" id="5471421">0</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471424">for</span>&nbsp;<span class="ident" id="5471428">i</span>&nbsp;<span class="op" id="5471430">&lt;</span>&nbsp;<span class="builtinfunc" id="5471432">len</span><span class="op" id="5471435">(</span><span class="ident" id="5471436">a</span><span class="op" id="5471437">)</span>&nbsp;<span class="op" id="5471439">&amp;&amp;</span>&nbsp;<span class="ident" id="5471442">i</span>&nbsp;<span class="op" id="5471444">&lt;</span>&nbsp;<span class="builtinfunc" id="5471446">len</span><span class="op" id="5471449">(</span><span class="ident" id="5471450">b</span><span class="op" id="5471451">)</span>&nbsp;<span class="op" id="5471453">&amp;&amp;</span>&nbsp;<span class="ident" id="5471456">a</span><span class="op" id="5471457">[</span><span class="ident" id="5471458">i</span><span class="op" id="5471459">]</span>&nbsp;<span class="op" id="5471461">==</span>&nbsp;<span class="ident" id="5471464">b</span><span class="op" id="5471465">[</span><span class="ident" id="5471466">i</span><span class="op" id="5471467">]</span>&nbsp;<span class="op" id="5471469">&amp;&amp;</span>&nbsp;<span class="op" id="5471472">(</span><span class="ident" id="5471473">a</span><span class="op" id="5471474">[</span><span class="ident" id="5471475">i</span><span class="op" id="5471476">]</span>&nbsp;<span class="op" id="5471478">&lt;=</span>&nbsp;<span class="string" id="5471481">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5471485">||</span>&nbsp;<span class="ident" id="5471488">a</span><span class="op" id="5471489">[</span><span class="ident" id="5471490">i</span><span class="op" id="5471491">]</span>&nbsp;<span class="op" id="5471493">==</span>&nbsp;<span class="string" id="5471496">&#39;*&#39;</span><span class="op" id="5471499">)</span>&nbsp;<span class="op" id="5471501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471505">i</span><span class="op" id="5471506">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471513">return</span>&nbsp;<span class="ident" id="5471520">a</span><span class="op" id="5471521">[</span><span class="num" id="5471522">0</span><span class="op" id="5471523">:</span><span class="ident" id="5471524">i</span><span class="op" id="5471525">]</span><br>
<span class="lineno"></span><span class="op" id="5471527">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="5471530">//&nbsp;trimRight&nbsp;returns&nbsp;s&nbsp;with&nbsp;trailing&nbsp;whitespace&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="5471587">func</span>&nbsp;<span class="ident" id="5471592">trimRight</span><span class="op" id="5471601">(</span><span class="ident" id="5471602">s</span>&nbsp;<span class="builtintype" id="5471604">string</span><span class="op" id="5471610">)</span>&nbsp;<span class="builtintype" id="5471612">string</span>&nbsp;<span class="op" id="5471619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471622">return</span>&nbsp;<span class="ident" id="5471629">strings</span><span class="op" id="5471636">.</span><span class="ident" id="5471637">TrimRightFunc</span><span class="op" id="5471650">(</span><span class="ident" id="5471651">s</span><span class="op" id="5471652">,</span>&nbsp;<span class="ident" id="5471654">unicode</span><span class="op" id="5471661">.</span><span class="ident" id="5471662">IsSpace</span><span class="op" id="5471669">)</span><br>
<span class="lineno"></span><span class="op" id="5471671">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="5471674">//&nbsp;stripCommonPrefix&nbsp;removes&nbsp;a&nbsp;common&nbsp;prefix&nbsp;from&nbsp;/*-style&nbsp;comment&nbsp;lines&nbsp;(unless&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="5471758">//&nbsp;comment&nbsp;line&nbsp;is&nbsp;indented,&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;line&nbsp;have&nbsp;some&nbsp;form&nbsp;of&nbsp;space&nbsp;prefix).</span><br>
<span class="lineno"></span><span class="comment" id="5471843">//&nbsp;The&nbsp;prefix&nbsp;is&nbsp;computed&nbsp;using&nbsp;heuristics&nbsp;such&nbsp;that&nbsp;is&nbsp;likely&nbsp;that&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="5471923">//&nbsp;contents&nbsp;are&nbsp;nicely&nbsp;laid&nbsp;out&nbsp;after&nbsp;re-printing&nbsp;each&nbsp;line&nbsp;using&nbsp;the&nbsp;printer&#39;s</span><br>
<span class="lineno">480</span><span class="comment" id="5472003">//&nbsp;current&nbsp;indentation.</span><br>
<span class="lineno"></span><span class="comment" id="5472027">//</span><br>
<span class="lineno"></span><span class="keyword" id="5472030">func</span>&nbsp;<span class="ident" id="5472035">stripCommonPrefix</span><span class="op" id="5472052">(</span><span class="ident" id="5472053">lines</span>&nbsp;<span class="op" id="5472059">[</span><span class="op" id="5472060">]</span><span class="builtintype" id="5472061">string</span><span class="op" id="5472067">)</span>&nbsp;<span class="op" id="5472069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472072">if</span>&nbsp;<span class="builtinfunc" id="5472075">len</span><span class="op" id="5472078">(</span><span class="ident" id="5472079">lines</span><span class="op" id="5472084">)</span>&nbsp;<span class="op" id="5472086">&lt;=</span>&nbsp;<span class="num" id="5472089">1</span>&nbsp;<span class="op" id="5472091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472095">return</span>&nbsp;<span class="comment" id="5472102">//&nbsp;at&nbsp;most&nbsp;one&nbsp;line&nbsp;-&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5472139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472142">//&nbsp;len(lines)&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472162">//&nbsp;The&nbsp;heuristic&nbsp;in&nbsp;this&nbsp;function&nbsp;tries&nbsp;to&nbsp;handle&nbsp;a&nbsp;few</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472219">//&nbsp;common&nbsp;patterns&nbsp;of&nbsp;/*-style&nbsp;comments:&nbsp;Comments&nbsp;where</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472276">//&nbsp;the&nbsp;opening&nbsp;/*&nbsp;and&nbsp;closing&nbsp;*/&nbsp;are&nbsp;aligned&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472330">//&nbsp;rest&nbsp;of&nbsp;the&nbsp;comment&nbsp;text&nbsp;is&nbsp;aligned&nbsp;and&nbsp;indented&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472388">//&nbsp;blanks&nbsp;or&nbsp;tabs,&nbsp;cases&nbsp;with&nbsp;a&nbsp;vertical&nbsp;&#34;line&nbsp;of&nbsp;stars&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472446">//&nbsp;on&nbsp;the&nbsp;left,&nbsp;and&nbsp;cases&nbsp;where&nbsp;the&nbsp;closing&nbsp;*/&nbsp;is&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472504">//&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;last&nbsp;comment&nbsp;text.</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472545">//&nbsp;Compute&nbsp;maximum&nbsp;common&nbsp;white&nbsp;prefix&nbsp;of&nbsp;all&nbsp;but&nbsp;the&nbsp;first,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472607">//&nbsp;last,&nbsp;and&nbsp;blank&nbsp;lines,&nbsp;and&nbsp;replace&nbsp;blank&nbsp;lines&nbsp;with&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472669">//&nbsp;lines&nbsp;(the&nbsp;first&nbsp;line&nbsp;starts&nbsp;with&nbsp;/*&nbsp;and&nbsp;has&nbsp;no&nbsp;prefix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472730">//&nbsp;In&nbsp;case&nbsp;of&nbsp;two-line&nbsp;comments,&nbsp;consider&nbsp;the&nbsp;last&nbsp;line&nbsp;for</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472791">//&nbsp;the&nbsp;prefix&nbsp;computation&nbsp;since&nbsp;otherwise&nbsp;the&nbsp;prefix&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472851">//&nbsp;be&nbsp;empty.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472865">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472869">//&nbsp;Note&nbsp;that&nbsp;the&nbsp;first&nbsp;and&nbsp;last&nbsp;line&nbsp;are&nbsp;never&nbsp;empty&nbsp;(they</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472929">//&nbsp;contain&nbsp;the&nbsp;opening&nbsp;/*&nbsp;and&nbsp;closing&nbsp;*/&nbsp;respectively)&nbsp;and</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472989">//&nbsp;thus&nbsp;they&nbsp;can&nbsp;be&nbsp;ignored&nbsp;by&nbsp;the&nbsp;blank&nbsp;line&nbsp;check.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473043">var</span>&nbsp;<span class="ident" id="5473047">prefix</span>&nbsp;<span class="builtintype" id="5473054">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473062">if</span>&nbsp;<span class="builtinfunc" id="5473065">len</span><span class="op" id="5473068">(</span><span class="ident" id="5473069">lines</span><span class="op" id="5473074">)</span>&nbsp;<span class="op" id="5473076">&gt;</span>&nbsp;<span class="num" id="5473078">2</span>&nbsp;<span class="op" id="5473080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473084">first</span>&nbsp;<span class="op" id="5473090">:=</span>&nbsp;<span class="builtintype" id="5473093">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473100">for</span>&nbsp;<span class="ident" id="5473104">i</span><span class="op" id="5473105">,</span>&nbsp;<span class="ident" id="5473107">line</span>&nbsp;<span class="op" id="5473112">:=</span>&nbsp;<span class="keyword" id="5473115">range</span>&nbsp;<span class="ident" id="5473121">lines</span><span class="op" id="5473126">[</span><span class="num" id="5473127">1</span>&nbsp;<span class="op" id="5473129">:</span>&nbsp;<span class="builtinfunc" id="5473131">len</span><span class="op" id="5473134">(</span><span class="ident" id="5473135">lines</span><span class="op" id="5473140">)</span><span class="op" id="5473141">-</span><span class="num" id="5473142">1</span><span class="op" id="5473143">]</span>&nbsp;<span class="op" id="5473145">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473150">switch</span>&nbsp;<span class="op" id="5473157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473162">case</span>&nbsp;<span class="ident" id="5473167">isBlank</span><span class="op" id="5473174">(</span><span class="ident" id="5473175">line</span><span class="op" id="5473179">)</span><span class="op" id="5473180">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473186">lines</span><span class="op" id="5473191">[</span><span class="num" id="5473192">1</span><span class="op" id="5473193">+</span><span class="ident" id="5473194">i</span><span class="op" id="5473195">]</span>&nbsp;<span class="op" id="5473197">=</span>&nbsp;<span class="string" id="5473199">&#34;&#34;</span>&nbsp;<span class="comment" id="5473202">//&nbsp;range&nbsp;starts&nbsp;with&nbsp;lines[1]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473235">case</span>&nbsp;<span class="ident" id="5473240">first</span><span class="op" id="5473245">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473251">prefix</span>&nbsp;<span class="op" id="5473258">=</span>&nbsp;<span class="ident" id="5473260">commonPrefix</span><span class="op" id="5473272">(</span><span class="ident" id="5473273">line</span><span class="op" id="5473277">,</span>&nbsp;<span class="ident" id="5473279">line</span><span class="op" id="5473283">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473289">first</span>&nbsp;<span class="op" id="5473295">=</span>&nbsp;<span class="builtintype" id="5473297">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473306">default</span><span class="op" id="5473313">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473319">prefix</span>&nbsp;<span class="op" id="5473326">=</span>&nbsp;<span class="ident" id="5473328">commonPrefix</span><span class="op" id="5473340">(</span><span class="ident" id="5473341">prefix</span><span class="op" id="5473347">,</span>&nbsp;<span class="ident" id="5473349">line</span><span class="op" id="5473353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5473358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5473362">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5473365">}</span>&nbsp;<span class="keyword" id="5473367">else</span>&nbsp;<span class="op" id="5473372">{</span>&nbsp;<span class="comment" id="5473374">//&nbsp;len(lines)&nbsp;==&nbsp;2,&nbsp;lines&nbsp;cannot&nbsp;be&nbsp;blank&nbsp;(contain&nbsp;/*&nbsp;and&nbsp;*/)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473438">line</span>&nbsp;<span class="op" id="5473443">:=</span>&nbsp;<span class="ident" id="5473446">lines</span><span class="op" id="5473451">[</span><span class="num" id="5473452">1</span><span class="op" id="5473453">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473457">prefix</span>&nbsp;<span class="op" id="5473464">=</span>&nbsp;<span class="ident" id="5473466">commonPrefix</span><span class="op" id="5473478">(</span><span class="ident" id="5473479">line</span><span class="op" id="5473483">,</span>&nbsp;<span class="ident" id="5473485">line</span><span class="op" id="5473489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5473492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5473496">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;Check&nbsp;for&nbsp;vertical&nbsp;&#34;line&nbsp;of&nbsp;stars&#34;&nbsp;and&nbsp;correct&nbsp;prefix&nbsp;accordingly.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473576">lineOfStars</span>&nbsp;<span class="op" id="5473588">:=</span>&nbsp;<span class="builtintype" id="5473591">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473598">if</span>&nbsp;<span class="ident" id="5473601">i</span>&nbsp;<span class="op" id="5473603">:=</span>&nbsp;<span class="ident" id="5473606">strings</span><span class="op" id="5473613">.</span><span class="ident" id="5473614">Index</span><span class="op" id="5473619">(</span><span class="ident" id="5473620">prefix</span><span class="op" id="5473626">,</span>&nbsp;<span class="string" id="5473628">&#34;*&#34;</span><span class="op" id="5473631">)</span><span class="op" id="5473632">;</span>&nbsp;<span class="ident" id="5473634">i</span>&nbsp;<span class="op" id="5473636">&gt;=</span>&nbsp;<span class="num" id="5473639">0</span>&nbsp;<span class="op" id="5473641">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5473645">//&nbsp;Line&nbsp;of&nbsp;stars&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473673">if</span>&nbsp;<span class="ident" id="5473676">i</span>&nbsp;<span class="op" id="5473678">&gt;</span>&nbsp;<span class="num" id="5473680">0</span>&nbsp;<span class="op" id="5473682">&amp;&amp;</span>&nbsp;<span class="ident" id="5473685">prefix</span><span class="op" id="5473691">[</span><span class="ident" id="5473692">i</span><span class="op" id="5473693">-</span><span class="num" id="5473694">1</span><span class="op" id="5473695">]</span>&nbsp;<span class="op" id="5473697">==</span>&nbsp;<span class="string" id="5473700">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5473704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473709">i</span><span class="op" id="5473710">--</span>&nbsp;<span class="comment" id="5473713">//&nbsp;remove&nbsp;trailing&nbsp;blank&nbsp;from&nbsp;prefix&nbsp;so&nbsp;stars&nbsp;remain&nbsp;aligned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5473776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473780">prefix</span>&nbsp;<span class="op" id="5473787">=</span>&nbsp;<span class="ident" id="5473789">prefix</span><span class="op" id="5473795">[</span><span class="num" id="5473796">0</span><span class="op" id="5473797">:</span><span class="ident" id="5473798">i</span><span class="op" id="5473799">]</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473803">lineOfStars</span>&nbsp;<span class="op" id="5473815">=</span>&nbsp;<span class="builtintype" id="5473817">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5473823">}</span>&nbsp;<span class="keyword" id="5473825">else</span>&nbsp;<span class="op" id="5473830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5473834">//&nbsp;No&nbsp;line&nbsp;of&nbsp;stars&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5473865">//&nbsp;Determine&nbsp;the&nbsp;white&nbsp;space&nbsp;on&nbsp;the&nbsp;first&nbsp;line&nbsp;after&nbsp;the&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5473927">//&nbsp;and&nbsp;before&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;comment&nbsp;text,&nbsp;assume&nbsp;two</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5473989">//&nbsp;blanks&nbsp;instead&nbsp;of&nbsp;the&nbsp;/*&nbsp;unless&nbsp;the&nbsp;first&nbsp;character&nbsp;after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5474052">//&nbsp;the&nbsp;/*&nbsp;is&nbsp;a&nbsp;tab.&nbsp;If&nbsp;the&nbsp;first&nbsp;comment&nbsp;line&nbsp;is&nbsp;empty&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5474113">//&nbsp;for&nbsp;the&nbsp;opening&nbsp;/*,&nbsp;assume&nbsp;up&nbsp;to&nbsp;3&nbsp;blanks&nbsp;or&nbsp;a&nbsp;tab.&nbsp;This</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5474175">//&nbsp;whitespace&nbsp;may&nbsp;be&nbsp;found&nbsp;as&nbsp;suffix&nbsp;in&nbsp;the&nbsp;common&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474236">first</span>&nbsp;<span class="op" id="5474242">:=</span>&nbsp;<span class="ident" id="5474245">lines</span><span class="op" id="5474250">[</span><span class="num" id="5474251">0</span><span class="op" id="5474252">]</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474256">if</span>&nbsp;<span class="ident" id="5474259">isBlank</span><span class="op" id="5474266">(</span><span class="ident" id="5474267">first</span><span class="op" id="5474272">[</span><span class="num" id="5474273">2</span><span class="op" id="5474274">:</span><span class="op" id="5474275">]</span><span class="op" id="5474276">)</span>&nbsp;<span class="op" id="5474278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5474283">//&nbsp;no&nbsp;comment&nbsp;text&nbsp;on&nbsp;the&nbsp;first&nbsp;line:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5474324">//&nbsp;reduce&nbsp;prefix&nbsp;by&nbsp;up&nbsp;to&nbsp;3&nbsp;blanks&nbsp;or&nbsp;a&nbsp;tab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5474371">//&nbsp;if&nbsp;present&nbsp;-&nbsp;this&nbsp;keeps&nbsp;comment&nbsp;text&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5474423">//&nbsp;relative&nbsp;to&nbsp;the&nbsp;/*&nbsp;and&nbsp;*/&#39;s&nbsp;if&nbsp;it&nbsp;was&nbsp;indented</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5474476">//&nbsp;in&nbsp;the&nbsp;first&nbsp;place</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474501">i</span>&nbsp;<span class="op" id="5474503">:=</span>&nbsp;<span class="builtinfunc" id="5474506">len</span><span class="op" id="5474509">(</span><span class="ident" id="5474510">prefix</span><span class="op" id="5474516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474521">for</span>&nbsp;<span class="ident" id="5474525">n</span>&nbsp;<span class="op" id="5474527">:=</span>&nbsp;<span class="num" id="5474530">0</span><span class="op" id="5474531">;</span>&nbsp;<span class="ident" id="5474533">n</span>&nbsp;<span class="op" id="5474535">&lt;</span>&nbsp;<span class="num" id="5474537">3</span>&nbsp;<span class="op" id="5474539">&amp;&amp;</span>&nbsp;<span class="ident" id="5474542">i</span>&nbsp;<span class="op" id="5474544">&gt;</span>&nbsp;<span class="num" id="5474546">0</span>&nbsp;<span class="op" id="5474548">&amp;&amp;</span>&nbsp;<span class="ident" id="5474551">prefix</span><span class="op" id="5474557">[</span><span class="ident" id="5474558">i</span><span class="op" id="5474559">-</span><span class="num" id="5474560">1</span><span class="op" id="5474561">]</span>&nbsp;<span class="op" id="5474563">==</span>&nbsp;<span class="string" id="5474566">&#39;&nbsp;&#39;</span><span class="op" id="5474569">;</span>&nbsp;<span class="ident" id="5474571">n</span><span class="op" id="5474572">++</span>&nbsp;<span class="op" id="5474575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474581">i</span><span class="op" id="5474582">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5474588">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474593">if</span>&nbsp;<span class="ident" id="5474596">i</span>&nbsp;<span class="op" id="5474598">==</span>&nbsp;<span class="builtinfunc" id="5474601">len</span><span class="op" id="5474604">(</span><span class="ident" id="5474605">prefix</span><span class="op" id="5474611">)</span>&nbsp;<span class="op" id="5474613">&amp;&amp;</span>&nbsp;<span class="ident" id="5474616">i</span>&nbsp;<span class="op" id="5474618">&gt;</span>&nbsp;<span class="num" id="5474620">0</span>&nbsp;<span class="op" id="5474622">&amp;&amp;</span>&nbsp;<span class="ident" id="5474625">prefix</span><span class="op" id="5474631">[</span><span class="ident" id="5474632">i</span><span class="op" id="5474633">-</span><span class="num" id="5474634">1</span><span class="op" id="5474635">]</span>&nbsp;<span class="op" id="5474637">==</span>&nbsp;<span class="string" id="5474640">&#39;\t&#39;</span>&nbsp;<span class="op" id="5474645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474651">i</span><span class="op" id="5474652">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5474658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474663">prefix</span>&nbsp;<span class="op" id="5474670">=</span>&nbsp;<span class="ident" id="5474672">prefix</span><span class="op" id="5474678">[</span><span class="num" id="5474679">0</span><span class="op" id="5474680">:</span><span class="ident" id="5474681">i</span><span class="op" id="5474682">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5474686">}</span>&nbsp;<span class="keyword" id="5474688">else</span>&nbsp;<span class="op" id="5474693">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5474698">//&nbsp;comment&nbsp;text&nbsp;on&nbsp;the&nbsp;first&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474735">suffix</span>&nbsp;<span class="op" id="5474742">:=</span>&nbsp;<span class="builtinfunc" id="5474745">make</span><span class="op" id="5474749">(</span><span class="op" id="5474750">[</span><span class="op" id="5474751">]</span><span class="builtintype" id="5474752">byte</span><span class="op" id="5474756">,</span>&nbsp;<span class="builtinfunc" id="5474758">len</span><span class="op" id="5474761">(</span><span class="ident" id="5474762">first</span><span class="op" id="5474767">)</span><span class="op" id="5474768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474773">n</span>&nbsp;<span class="op" id="5474775">:=</span>&nbsp;<span class="num" id="5474778">2</span>&nbsp;<span class="comment" id="5474780">//&nbsp;start&nbsp;after&nbsp;opening&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474809">for</span>&nbsp;<span class="ident" id="5474813">n</span>&nbsp;<span class="op" id="5474815">&lt;</span>&nbsp;<span class="builtinfunc" id="5474817">len</span><span class="op" id="5474820">(</span><span class="ident" id="5474821">first</span><span class="op" id="5474826">)</span>&nbsp;<span class="op" id="5474828">&amp;&amp;</span>&nbsp;<span class="ident" id="5474831">first</span><span class="op" id="5474836">[</span><span class="ident" id="5474837">n</span><span class="op" id="5474838">]</span>&nbsp;<span class="op" id="5474840">&lt;=</span>&nbsp;<span class="string" id="5474843">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5474847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474853">suffix</span><span class="op" id="5474859">[</span><span class="ident" id="5474860">n</span><span class="op" id="5474861">]</span>&nbsp;<span class="op" id="5474863">=</span>&nbsp;<span class="ident" id="5474865">first</span><span class="op" id="5474870">[</span><span class="ident" id="5474871">n</span><span class="op" id="5474872">]</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474878">n</span><span class="op" id="5474879">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5474885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474890">if</span>&nbsp;<span class="ident" id="5474893">n</span>&nbsp;<span class="op" id="5474895">&gt;</span>&nbsp;<span class="num" id="5474897">2</span>&nbsp;<span class="op" id="5474899">&amp;&amp;</span>&nbsp;<span class="ident" id="5474902">suffix</span><span class="op" id="5474908">[</span><span class="num" id="5474909">2</span><span class="op" id="5474910">]</span>&nbsp;<span class="op" id="5474912">==</span>&nbsp;<span class="string" id="5474915">&#39;\t&#39;</span>&nbsp;<span class="op" id="5474920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5474926">//&nbsp;assume&nbsp;the&nbsp;&#39;\t&#39;&nbsp;compensates&nbsp;for&nbsp;the&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474972">suffix</span>&nbsp;<span class="op" id="5474979">=</span>&nbsp;<span class="ident" id="5474981">suffix</span><span class="op" id="5474987">[</span><span class="num" id="5474988">2</span><span class="op" id="5474989">:</span><span class="ident" id="5474990">n</span><span class="op" id="5474991">]</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5474996">}</span>&nbsp;<span class="keyword" id="5474998">else</span>&nbsp;<span class="op" id="5475003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475009">//&nbsp;otherwise&nbsp;assume&nbsp;two&nbsp;blanks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5475044">suffix</span><span class="op" id="5475050">[</span><span class="num" id="5475051">0</span><span class="op" id="5475052">]</span><span class="op" id="5475053">,</span>&nbsp;<span class="ident" id="5475055">suffix</span><span class="op" id="5475061">[</span><span class="num" id="5475062">1</span><span class="op" id="5475063">]</span>&nbsp;<span class="op" id="5475065">=</span>&nbsp;<span class="string" id="5475067">&#39;&nbsp;&#39;</span><span class="op" id="5475070">,</span>&nbsp;<span class="string" id="5475072">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5475080">suffix</span>&nbsp;<span class="op" id="5475087">=</span>&nbsp;<span class="ident" id="5475089">suffix</span><span class="op" id="5475095">[</span><span class="num" id="5475096">0</span><span class="op" id="5475097">:</span><span class="ident" id="5475098">n</span><span class="op" id="5475099">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5475104">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475109">//&nbsp;Shorten&nbsp;the&nbsp;computed&nbsp;common&nbsp;prefix&nbsp;by&nbsp;the&nbsp;length&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475167">//&nbsp;suffix,&nbsp;if&nbsp;it&nbsp;is&nbsp;found&nbsp;as&nbsp;suffix&nbsp;of&nbsp;the&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5475221">prefix</span>&nbsp;<span class="op" id="5475228">=</span>&nbsp;<span class="ident" id="5475230">strings</span><span class="op" id="5475237">.</span><span class="ident" id="5475238">TrimSuffix</span><span class="op" id="5475248">(</span><span class="ident" id="5475249">prefix</span><span class="op" id="5475255">,</span>&nbsp;<span class="builtintype" id="5475257">string</span><span class="op" id="5475263">(</span><span class="ident" id="5475264">suffix</span><span class="op" id="5475270">)</span><span class="op" id="5475271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5475275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5475278">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475282">//&nbsp;Handle&nbsp;last&nbsp;line:&nbsp;If&nbsp;it&nbsp;only&nbsp;contains&nbsp;a&nbsp;closing&nbsp;*/,&nbsp;align&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475347">//&nbsp;with&nbsp;the&nbsp;opening&nbsp;/*,&nbsp;otherwise&nbsp;align&nbsp;the&nbsp;text&nbsp;with&nbsp;the&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475412">//&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5475423">last</span>&nbsp;<span class="op" id="5475428">:=</span>&nbsp;<span class="ident" id="5475431">lines</span><span class="op" id="5475436">[</span><span class="builtinfunc" id="5475437">len</span><span class="op" id="5475440">(</span><span class="ident" id="5475441">lines</span><span class="op" id="5475446">)</span><span class="op" id="5475447">-</span><span class="num" id="5475448">1</span><span class="op" id="5475449">]</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5475452">closing</span>&nbsp;<span class="op" id="5475460">:=</span>&nbsp;<span class="string" id="5475463">&#34;*/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5475469">i</span>&nbsp;<span class="op" id="5475471">:=</span>&nbsp;<span class="ident" id="5475474">strings</span><span class="op" id="5475481">.</span><span class="ident" id="5475482">Index</span><span class="op" id="5475487">(</span><span class="ident" id="5475488">last</span><span class="op" id="5475492">,</span>&nbsp;<span class="ident" id="5475494">closing</span><span class="op" id="5475501">)</span>&nbsp;<span class="comment" id="5475503">//&nbsp;i&nbsp;&gt;=&nbsp;0&nbsp;(closing&nbsp;is&nbsp;always&nbsp;present)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475542">if</span>&nbsp;<span class="ident" id="5475545">isBlank</span><span class="op" id="5475552">(</span><span class="ident" id="5475553">last</span><span class="op" id="5475557">[</span><span class="num" id="5475558">0</span><span class="op" id="5475559">:</span><span class="ident" id="5475560">i</span><span class="op" id="5475561">]</span><span class="op" id="5475562">)</span>&nbsp;<span class="op" id="5475564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475568">//&nbsp;last&nbsp;line&nbsp;only&nbsp;contains&nbsp;closing&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475608">if</span>&nbsp;<span class="ident" id="5475611">lineOfStars</span>&nbsp;<span class="op" id="5475623">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5475628">closing</span>&nbsp;<span class="op" id="5475636">=</span>&nbsp;<span class="string" id="5475638">&#34;&nbsp;*/&#34;</span>&nbsp;<span class="comment" id="5475644">//&nbsp;add&nbsp;blank&nbsp;to&nbsp;align&nbsp;final&nbsp;star</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5475679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5475683">lines</span><span class="op" id="5475688">[</span><span class="builtinfunc" id="5475689">len</span><span class="op" id="5475692">(</span><span class="ident" id="5475693">lines</span><span class="op" id="5475698">)</span><span class="op" id="5475699">-</span><span class="num" id="5475700">1</span><span class="op" id="5475701">]</span>&nbsp;<span class="op" id="5475703">=</span>&nbsp;<span class="ident" id="5475705">prefix</span>&nbsp;<span class="op" id="5475712">+</span>&nbsp;<span class="ident" id="5475714">closing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5475723">}</span>&nbsp;<span class="keyword" id="5475725">else</span>&nbsp;<span class="op" id="5475730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475734">//&nbsp;last&nbsp;line&nbsp;contains&nbsp;more&nbsp;comment&nbsp;text&nbsp;-&nbsp;assume</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475785">//&nbsp;it&nbsp;is&nbsp;aligned&nbsp;like&nbsp;the&nbsp;other&nbsp;lines&nbsp;and&nbsp;include</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475837">//&nbsp;in&nbsp;prefix&nbsp;computation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5475864">prefix</span>&nbsp;<span class="op" id="5475871">=</span>&nbsp;<span class="ident" id="5475873">commonPrefix</span><span class="op" id="5475885">(</span><span class="ident" id="5475886">prefix</span><span class="op" id="5475892">,</span>&nbsp;<span class="ident" id="5475894">last</span><span class="op" id="5475898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5475901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475905">//&nbsp;Remove&nbsp;the&nbsp;common&nbsp;prefix&nbsp;from&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;and&nbsp;empty&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475974">for</span>&nbsp;<span class="ident" id="5475978">i</span><span class="op" id="5475979">,</span>&nbsp;<span class="ident" id="5475981">line</span>&nbsp;<span class="op" id="5475986">:=</span>&nbsp;<span class="keyword" id="5475989">range</span>&nbsp;<span class="ident" id="5475995">lines</span>&nbsp;<span class="op" id="5476001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476005">if</span>&nbsp;<span class="ident" id="5476008">i</span>&nbsp;<span class="op" id="5476010">&gt;</span>&nbsp;<span class="num" id="5476012">0</span>&nbsp;<span class="op" id="5476014">&amp;&amp;</span>&nbsp;<span class="ident" id="5476017">line</span>&nbsp;<span class="op" id="5476022">!=</span>&nbsp;<span class="string" id="5476025">&#34;&#34;</span>&nbsp;<span class="op" id="5476028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476033">lines</span><span class="op" id="5476038">[</span><span class="ident" id="5476039">i</span><span class="op" id="5476040">]</span>&nbsp;<span class="op" id="5476042">=</span>&nbsp;<span class="ident" id="5476044">line</span><span class="op" id="5476048">[</span><span class="builtinfunc" id="5476049">len</span><span class="op" id="5476052">(</span><span class="ident" id="5476053">prefix</span><span class="op" id="5476059">)</span><span class="op" id="5476060">:</span><span class="op" id="5476061">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476065">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476068">}</span><br>
<span class="lineno"></span><span class="op" id="5476070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5476073">func</span>&nbsp;<span class="op" id="5476078">(</span><span class="ident" id="5476079">p</span>&nbsp;<span class="op" id="5476081">*</span><span class="ident" id="5476082">printer</span><span class="op" id="5476089">)</span>&nbsp;<span class="ident" id="5476091">writeComment</span><span class="op" id="5476103">(</span><span class="ident" id="5476104">comment</span>&nbsp;<span class="op" id="5476112">*</span><span class="ident" id="5476113">ast</span><span class="op" id="5476116">.</span><span class="ident" id="5476117">Comment</span><span class="op" id="5476124">)</span>&nbsp;<span class="op" id="5476126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476129">text</span>&nbsp;<span class="op" id="5476134">:=</span>&nbsp;<span class="ident" id="5476137">comment</span><span class="op" id="5476144">.</span><span class="ident" id="5476145">Text</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476151">pos</span>&nbsp;<span class="op" id="5476155">:=</span>&nbsp;<span class="ident" id="5476158">p</span><span class="op" id="5476159">.</span><span class="ident" id="5476160">posFor</span><span class="op" id="5476166">(</span><span class="ident" id="5476167">comment</span><span class="op" id="5476174">.</span><span class="ident" id="5476175">Pos</span><span class="op" id="5476178">(</span><span class="op" id="5476179">)</span><span class="op" id="5476180">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476184">const</span>&nbsp;<span class="ident" id="5476190">linePrefix</span>&nbsp;<span class="op" id="5476201">=</span>&nbsp;<span class="string" id="5476203">&#34;//line&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476214">if</span>&nbsp;<span class="ident" id="5476217">strings</span><span class="op" id="5476224">.</span><span class="ident" id="5476225">HasPrefix</span><span class="op" id="5476234">(</span><span class="ident" id="5476235">text</span><span class="op" id="5476239">,</span>&nbsp;<span class="ident" id="5476241">linePrefix</span><span class="op" id="5476251">)</span>&nbsp;<span class="op" id="5476253">&amp;&amp;</span>&nbsp;<span class="op" id="5476256">(</span><span class="op" id="5476257">!</span><span class="ident" id="5476258">pos</span><span class="op" id="5476261">.</span><span class="ident" id="5476262">IsValid</span><span class="op" id="5476269">(</span><span class="op" id="5476270">)</span>&nbsp;<span class="op" id="5476272">||</span>&nbsp;<span class="ident" id="5476275">pos</span><span class="op" id="5476278">.</span><span class="ident" id="5476279">Column</span>&nbsp;<span class="op" id="5476286">==</span>&nbsp;<span class="num" id="5476289">1</span><span class="op" id="5476290">)</span>&nbsp;<span class="op" id="5476292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5476296">//&nbsp;possibly&nbsp;a&nbsp;line&nbsp;directive</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476327">ldir</span>&nbsp;<span class="op" id="5476332">:=</span>&nbsp;<span class="ident" id="5476335">strings</span><span class="op" id="5476342">.</span><span class="ident" id="5476343">TrimSpace</span><span class="op" id="5476352">(</span><span class="ident" id="5476353">text</span><span class="op" id="5476357">[</span><span class="builtinfunc" id="5476358">len</span><span class="op" id="5476361">(</span><span class="ident" id="5476362">linePrefix</span><span class="op" id="5476372">)</span><span class="op" id="5476373">:</span><span class="op" id="5476374">]</span><span class="op" id="5476375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476379">if</span>&nbsp;<span class="ident" id="5476382">i</span>&nbsp;<span class="op" id="5476384">:=</span>&nbsp;<span class="ident" id="5476387">strings</span><span class="op" id="5476394">.</span><span class="ident" id="5476395">LastIndex</span><span class="op" id="5476404">(</span><span class="ident" id="5476405">ldir</span><span class="op" id="5476409">,</span>&nbsp;<span class="string" id="5476411">&#34;:&#34;</span><span class="op" id="5476414">)</span><span class="op" id="5476415">;</span>&nbsp;<span class="ident" id="5476417">i</span>&nbsp;<span class="op" id="5476419">&gt;=</span>&nbsp;<span class="num" id="5476422">0</span>&nbsp;<span class="op" id="5476424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476429">if</span>&nbsp;<span class="ident" id="5476432">line</span><span class="op" id="5476436">,</span>&nbsp;<span class="ident" id="5476438">err</span>&nbsp;<span class="op" id="5476442">:=</span>&nbsp;<span class="ident" id="5476445">strconv</span><span class="op" id="5476452">.</span><span class="ident" id="5476453">Atoi</span><span class="op" id="5476457">(</span><span class="ident" id="5476458">ldir</span><span class="op" id="5476462">[</span><span class="ident" id="5476463">i</span><span class="op" id="5476464">+</span><span class="num" id="5476465">1</span><span class="op" id="5476466">:</span><span class="op" id="5476467">]</span><span class="op" id="5476468">)</span><span class="op" id="5476469">;</span>&nbsp;<span class="ident" id="5476471">err</span>&nbsp;<span class="op" id="5476475">==</span>&nbsp;<span class="ident" id="5476478">nil</span>&nbsp;<span class="op" id="5476482">&amp;&amp;</span>&nbsp;<span class="ident" id="5476485">line</span>&nbsp;<span class="op" id="5476490">&gt;</span>&nbsp;<span class="num" id="5476492">0</span>&nbsp;<span class="op" id="5476494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5476500">//&nbsp;The&nbsp;line&nbsp;directive&nbsp;we&nbsp;are&nbsp;about&nbsp;to&nbsp;print&nbsp;changed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5476556">//&nbsp;the&nbsp;Filename&nbsp;and&nbsp;Line&nbsp;number&nbsp;used&nbsp;for&nbsp;subsequent</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5476612">//&nbsp;tokens.&nbsp;We&nbsp;have&nbsp;to&nbsp;update&nbsp;our&nbsp;AST-space&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5476668">//&nbsp;accordingly&nbsp;and&nbsp;suspend&nbsp;indentation&nbsp;temporarily.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476724">indent</span>&nbsp;<span class="op" id="5476731">:=</span>&nbsp;<span class="ident" id="5476734">p</span><span class="op" id="5476735">.</span><span class="ident" id="5476736">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476747">p</span><span class="op" id="5476748">.</span><span class="ident" id="5476749">indent</span>&nbsp;<span class="op" id="5476756">=</span>&nbsp;<span class="num" id="5476758">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476764">defer</span>&nbsp;<span class="keyword" id="5476770">func</span><span class="op" id="5476774">(</span><span class="op" id="5476775">)</span>&nbsp;<span class="op" id="5476777">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476784">p</span><span class="op" id="5476785">.</span><span class="ident" id="5476786">pos</span><span class="op" id="5476789">.</span><span class="ident" id="5476790">Filename</span>&nbsp;<span class="op" id="5476799">=</span>&nbsp;<span class="ident" id="5476801">ldir</span><span class="op" id="5476805">[</span><span class="op" id="5476806">:</span><span class="ident" id="5476807">i</span><span class="op" id="5476808">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476815">p</span><span class="op" id="5476816">.</span><span class="ident" id="5476817">pos</span><span class="op" id="5476820">.</span><span class="ident" id="5476821">Line</span>&nbsp;<span class="op" id="5476826">=</span>&nbsp;<span class="ident" id="5476828">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476838">p</span><span class="op" id="5476839">.</span><span class="ident" id="5476840">pos</span><span class="op" id="5476843">.</span><span class="ident" id="5476844">Column</span>&nbsp;<span class="op" id="5476851">=</span>&nbsp;<span class="num" id="5476853">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476860">p</span><span class="op" id="5476861">.</span><span class="ident" id="5476862">indent</span>&nbsp;<span class="op" id="5476869">=</span>&nbsp;<span class="ident" id="5476871">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476882">}</span><span class="op" id="5476883">(</span><span class="op" id="5476884">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5476900">//&nbsp;shortcut&nbsp;common&nbsp;case&nbsp;of&nbsp;//-style&nbsp;comments</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476946">if</span>&nbsp;<span class="ident" id="5476949">text</span><span class="op" id="5476953">[</span><span class="num" id="5476954">1</span><span class="op" id="5476955">]</span>&nbsp;<span class="op" id="5476957">==</span>&nbsp;<span class="string" id="5476960">&#39;/&#39;</span>&nbsp;<span class="op" id="5476964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476968">p</span><span class="op" id="5476969">.</span><span class="ident" id="5476970">writeString</span><span class="op" id="5476981">(</span><span class="ident" id="5476982">pos</span><span class="op" id="5476985">,</span>&nbsp;<span class="ident" id="5476987">trimRight</span><span class="op" id="5476996">(</span><span class="ident" id="5476997">text</span><span class="op" id="5477001">)</span><span class="op" id="5477002">,</span>&nbsp;<span class="builtintype" id="5477004">true</span><span class="op" id="5477008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5477012">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5477020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5477024">//&nbsp;for&nbsp;/*-style&nbsp;comments,&nbsp;print&nbsp;line&nbsp;by&nbsp;line&nbsp;and&nbsp;let&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5477082">//&nbsp;write&nbsp;function&nbsp;take&nbsp;care&nbsp;of&nbsp;the&nbsp;proper&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477137">lines</span>&nbsp;<span class="op" id="5477143">:=</span>&nbsp;<span class="ident" id="5477146">strings</span><span class="op" id="5477153">.</span><span class="ident" id="5477154">Split</span><span class="op" id="5477159">(</span><span class="ident" id="5477160">text</span><span class="op" id="5477164">,</span>&nbsp;<span class="string" id="5477166">&#34;\n&#34;</span><span class="op" id="5477170">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5477174">//&nbsp;The&nbsp;comment&nbsp;started&nbsp;in&nbsp;the&nbsp;first&nbsp;column&nbsp;but&nbsp;is&nbsp;going</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5477231">//&nbsp;to&nbsp;be&nbsp;indented.&nbsp;For&nbsp;an&nbsp;idempotent&nbsp;result,&nbsp;add&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5477293">//&nbsp;to&nbsp;all&nbsp;lines&nbsp;such&nbsp;that&nbsp;they&nbsp;look&nbsp;like&nbsp;they&nbsp;were&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5477354">//&nbsp;before&nbsp;-&nbsp;this&nbsp;will&nbsp;make&nbsp;sure&nbsp;the&nbsp;common&nbsp;prefix&nbsp;computation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5477417">//&nbsp;is&nbsp;the&nbsp;same&nbsp;independent&nbsp;of&nbsp;how&nbsp;many&nbsp;times&nbsp;formatting&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5477477">//&nbsp;applied&nbsp;(was&nbsp;issue&nbsp;1835).</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5477507">if</span>&nbsp;<span class="ident" id="5477510">pos</span><span class="op" id="5477513">.</span><span class="ident" id="5477514">IsValid</span><span class="op" id="5477521">(</span><span class="op" id="5477522">)</span>&nbsp;<span class="op" id="5477524">&amp;&amp;</span>&nbsp;<span class="ident" id="5477527">pos</span><span class="op" id="5477530">.</span><span class="ident" id="5477531">Column</span>&nbsp;<span class="op" id="5477538">==</span>&nbsp;<span class="num" id="5477541">1</span>&nbsp;<span class="op" id="5477543">&amp;&amp;</span>&nbsp;<span class="ident" id="5477546">p</span><span class="op" id="5477547">.</span><span class="ident" id="5477548">indent</span>&nbsp;<span class="op" id="5477555">&gt;</span>&nbsp;<span class="num" id="5477557">0</span>&nbsp;<span class="op" id="5477559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5477563">for</span>&nbsp;<span class="ident" id="5477567">i</span><span class="op" id="5477568">,</span>&nbsp;<span class="ident" id="5477570">line</span>&nbsp;<span class="op" id="5477575">:=</span>&nbsp;<span class="keyword" id="5477578">range</span>&nbsp;<span class="ident" id="5477584">lines</span><span class="op" id="5477589">[</span><span class="num" id="5477590">1</span><span class="op" id="5477591">:</span><span class="op" id="5477592">]</span>&nbsp;<span class="op" id="5477594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477599">lines</span><span class="op" id="5477604">[</span><span class="num" id="5477605">1</span><span class="op" id="5477606">+</span><span class="ident" id="5477607">i</span><span class="op" id="5477608">]</span>&nbsp;<span class="op" id="5477610">=</span>&nbsp;<span class="string" id="5477612">&#34;&nbsp;&nbsp;&nbsp;&#34;</span>&nbsp;<span class="op" id="5477618">+</span>&nbsp;<span class="ident" id="5477620">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5477627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5477630">}</span><br>
<span class="lineno">655</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477634">stripCommonPrefix</span><span class="op" id="5477651">(</span><span class="ident" id="5477652">lines</span><span class="op" id="5477657">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5477661">//&nbsp;write&nbsp;comment&nbsp;lines,&nbsp;separated&nbsp;by&nbsp;formfeed,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5477709">//&nbsp;without&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;the&nbsp;last&nbsp;line</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5477754">for</span>&nbsp;<span class="ident" id="5477758">i</span><span class="op" id="5477759">,</span>&nbsp;<span class="ident" id="5477761">line</span>&nbsp;<span class="op" id="5477766">:=</span>&nbsp;<span class="keyword" id="5477769">range</span>&nbsp;<span class="ident" id="5477775">lines</span>&nbsp;<span class="op" id="5477781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5477785">if</span>&nbsp;<span class="ident" id="5477788">i</span>&nbsp;<span class="op" id="5477790">&gt;</span>&nbsp;<span class="num" id="5477792">0</span>&nbsp;<span class="op" id="5477794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477799">p</span><span class="op" id="5477800">.</span><span class="ident" id="5477801">writeByte</span><span class="op" id="5477810">(</span><span class="string" id="5477811">&#39;\f&#39;</span><span class="op" id="5477815">,</span>&nbsp;<span class="num" id="5477817">1</span><span class="op" id="5477818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477823">pos</span>&nbsp;<span class="op" id="5477827">=</span>&nbsp;<span class="ident" id="5477829">p</span><span class="op" id="5477830">.</span><span class="ident" id="5477831">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5477837">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5477841">if</span>&nbsp;<span class="builtinfunc" id="5477844">len</span><span class="op" id="5477847">(</span><span class="ident" id="5477848">line</span><span class="op" id="5477852">)</span>&nbsp;<span class="op" id="5477854">&gt;</span>&nbsp;<span class="num" id="5477856">0</span>&nbsp;<span class="op" id="5477858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477863">p</span><span class="op" id="5477864">.</span><span class="ident" id="5477865">writeString</span><span class="op" id="5477876">(</span><span class="ident" id="5477877">pos</span><span class="op" id="5477880">,</span>&nbsp;<span class="ident" id="5477882">trimRight</span><span class="op" id="5477891">(</span><span class="ident" id="5477892">line</span><span class="op" id="5477896">)</span><span class="op" id="5477897">,</span>&nbsp;<span class="builtintype" id="5477899">true</span><span class="op" id="5477903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5477907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5477910">}</span><br>
<span class="lineno"></span><span class="op" id="5477912">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="5477915">//&nbsp;writeCommentSuffix&nbsp;writes&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;a&nbsp;comment&nbsp;if&nbsp;indicated</span><br>
<span class="lineno"></span><span class="comment" id="5477986">//&nbsp;and&nbsp;processes&nbsp;any&nbsp;leftover&nbsp;indentation&nbsp;information.&nbsp;If&nbsp;a&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span><span class="comment" id="5478057">//&nbsp;is&nbsp;needed,&nbsp;the&nbsp;kind&nbsp;of&nbsp;break&nbsp;(newline&nbsp;vs&nbsp;formfeed)&nbsp;depends&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5478126">//&nbsp;pending&nbsp;whitespace.&nbsp;The&nbsp;writeCommentSuffix&nbsp;result&nbsp;indicates&nbsp;if&nbsp;a</span><br>
<span class="lineno">675</span><span class="comment" id="5478194">//&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="5478266">//&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="5478277">//</span><br>
<span class="lineno"></span><span class="keyword" id="5478280">func</span>&nbsp;<span class="op" id="5478285">(</span><span class="ident" id="5478286">p</span>&nbsp;<span class="op" id="5478288">*</span><span class="ident" id="5478289">printer</span><span class="op" id="5478296">)</span>&nbsp;<span class="ident" id="5478298">writeCommentSuffix</span><span class="op" id="5478316">(</span><span class="ident" id="5478317">needsLinebreak</span>&nbsp;<span class="builtintype" id="5478332">bool</span><span class="op" id="5478336">)</span>&nbsp;<span class="op" id="5478338">(</span><span class="ident" id="5478339">wroteNewline</span><span class="op" id="5478351">,</span>&nbsp;<span class="ident" id="5478353">droppedFF</span>&nbsp;<span class="builtintype" id="5478363">bool</span><span class="op" id="5478367">)</span>&nbsp;<span class="op" id="5478369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478372">for</span>&nbsp;<span class="ident" id="5478376">i</span><span class="op" id="5478377">,</span>&nbsp;<span class="ident" id="5478379">ch</span>&nbsp;<span class="op" id="5478382">:=</span>&nbsp;<span class="keyword" id="5478385">range</span>&nbsp;<span class="ident" id="5478391">p</span><span class="op" id="5478392">.</span><span class="ident" id="5478393">wsbuf</span>&nbsp;<span class="op" id="5478399">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478403">switch</span>&nbsp;<span class="ident" id="5478410">ch</span>&nbsp;<span class="op" id="5478413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478417">case</span>&nbsp;<span class="ident" id="5478422">blank</span><span class="op" id="5478427">,</span>&nbsp;<span class="ident" id="5478429">vtab</span><span class="op" id="5478433">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478438">//&nbsp;ignore&nbsp;trailing&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478471">p</span><span class="op" id="5478472">.</span><span class="ident" id="5478473">wsbuf</span><span class="op" id="5478478">[</span><span class="ident" id="5478479">i</span><span class="op" id="5478480">]</span>&nbsp;<span class="op" id="5478482">=</span>&nbsp;<span class="ident" id="5478484">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478493">case</span>&nbsp;<span class="ident" id="5478498">indent</span><span class="op" id="5478504">,</span>&nbsp;<span class="ident" id="5478506">unindent</span><span class="op" id="5478514">:</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478519">//&nbsp;don&#39;t&nbsp;lose&nbsp;indentation&nbsp;information</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478559">case</span>&nbsp;<span class="ident" id="5478564">newline</span><span class="op" id="5478571">,</span>&nbsp;<span class="ident" id="5478573">formfeed</span><span class="op" id="5478581">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478586">//&nbsp;if&nbsp;we&nbsp;need&nbsp;a&nbsp;line&nbsp;break,&nbsp;keep&nbsp;exactly&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478634">//&nbsp;but&nbsp;remember&nbsp;if&nbsp;we&nbsp;dropped&nbsp;any&nbsp;formfeeds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478681">if</span>&nbsp;<span class="ident" id="5478684">needsLinebreak</span>&nbsp;<span class="op" id="5478699">{</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478705">needsLinebreak</span>&nbsp;<span class="op" id="5478720">=</span>&nbsp;<span class="builtintype" id="5478722">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478732">wroteNewline</span>&nbsp;<span class="op" id="5478745">=</span>&nbsp;<span class="builtintype" id="5478747">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5478755">}</span>&nbsp;<span class="keyword" id="5478757">else</span>&nbsp;<span class="op" id="5478762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478768">if</span>&nbsp;<span class="ident" id="5478771">ch</span>&nbsp;<span class="op" id="5478774">==</span>&nbsp;<span class="ident" id="5478777">formfeed</span>&nbsp;<span class="op" id="5478786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478793">droppedFF</span>&nbsp;<span class="op" id="5478803">=</span>&nbsp;<span class="builtintype" id="5478805">true</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5478814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478820">p</span><span class="op" id="5478821">.</span><span class="ident" id="5478822">wsbuf</span><span class="op" id="5478827">[</span><span class="ident" id="5478828">i</span><span class="op" id="5478829">]</span>&nbsp;<span class="op" id="5478831">=</span>&nbsp;<span class="ident" id="5478833">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5478843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5478847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5478850">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478853">p</span><span class="op" id="5478854">.</span><span class="ident" id="5478855">writeWhitespace</span><span class="op" id="5478870">(</span><span class="builtinfunc" id="5478871">len</span><span class="op" id="5478874">(</span><span class="ident" id="5478875">p</span><span class="op" id="5478876">.</span><span class="ident" id="5478877">wsbuf</span><span class="op" id="5478882">)</span><span class="op" id="5478883">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478887">//&nbsp;make&nbsp;sure&nbsp;we&nbsp;have&nbsp;a&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478922">if</span>&nbsp;<span class="ident" id="5478925">needsLinebreak</span>&nbsp;<span class="op" id="5478940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478944">p</span><span class="op" id="5478945">.</span><span class="ident" id="5478946">writeByte</span><span class="op" id="5478955">(</span><span class="string" id="5478956">&#39;\n&#39;</span><span class="op" id="5478960">,</span>&nbsp;<span class="num" id="5478962">1</span><span class="op" id="5478963">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478967">wroteNewline</span>&nbsp;<span class="op" id="5478980">=</span>&nbsp;<span class="builtintype" id="5478982">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5478988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478992">return</span><br>
<span class="lineno"></span><span class="op" id="5478999">}</span><br>
<span class="lineno">710</span><br>
<span class="lineno"></span><span class="comment" id="5479002">//&nbsp;intersperseComments&nbsp;consumes&nbsp;all&nbsp;comments&nbsp;that&nbsp;appear&nbsp;before&nbsp;the&nbsp;next&nbsp;token</span><br>
<span class="lineno"></span><span class="comment" id="5479081">//&nbsp;tok&nbsp;and&nbsp;prints&nbsp;it&nbsp;together&nbsp;with&nbsp;the&nbsp;buffered&nbsp;whitespace&nbsp;(i.e.,&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="5479162">//&nbsp;that&nbsp;needs&nbsp;to&nbsp;be&nbsp;written&nbsp;before&nbsp;the&nbsp;next&nbsp;token).&nbsp;A&nbsp;heuristic&nbsp;is&nbsp;used&nbsp;to&nbsp;mix</span><br>
<span class="lineno"></span><span class="comment" id="5479241">//&nbsp;the&nbsp;comments&nbsp;and&nbsp;whitespace.&nbsp;The&nbsp;intersperseComments&nbsp;result&nbsp;indicates&nbsp;if&nbsp;a</span><br>
<span class="lineno">715</span><span class="comment" id="5479319">//&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="5479399">//</span><br>
<span class="lineno"></span><span class="keyword" id="5479402">func</span>&nbsp;<span class="op" id="5479407">(</span><span class="ident" id="5479408">p</span>&nbsp;<span class="op" id="5479410">*</span><span class="ident" id="5479411">printer</span><span class="op" id="5479418">)</span>&nbsp;<span class="ident" id="5479420">intersperseComments</span><span class="op" id="5479439">(</span><span class="ident" id="5479440">next</span>&nbsp;<span class="ident" id="5479445">token</span><span class="op" id="5479450">.</span><span class="ident" id="5479451">Position</span><span class="op" id="5479459">,</span>&nbsp;<span class="ident" id="5479461">tok</span>&nbsp;<span class="ident" id="5479465">token</span><span class="op" id="5479470">.</span><span class="ident" id="5479471">Token</span><span class="op" id="5479476">)</span>&nbsp;<span class="op" id="5479478">(</span><span class="ident" id="5479479">wroteNewline</span><span class="op" id="5479491">,</span>&nbsp;<span class="ident" id="5479493">droppedFF</span>&nbsp;<span class="builtintype" id="5479503">bool</span><span class="op" id="5479507">)</span>&nbsp;<span class="op" id="5479509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479512">var</span>&nbsp;<span class="ident" id="5479516">last</span>&nbsp;<span class="op" id="5479521">*</span><span class="ident" id="5479522">ast</span><span class="op" id="5479525">.</span><span class="ident" id="5479526">Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479535">for</span>&nbsp;<span class="ident" id="5479539">p</span><span class="op" id="5479540">.</span><span class="ident" id="5479541">commentBefore</span><span class="op" id="5479554">(</span><span class="ident" id="5479555">next</span><span class="op" id="5479559">)</span>&nbsp;<span class="op" id="5479561">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479565">for</span>&nbsp;<span class="ident" id="5479569">_</span><span class="op" id="5479570">,</span>&nbsp;<span class="ident" id="5479572">c</span>&nbsp;<span class="op" id="5479574">:=</span>&nbsp;<span class="keyword" id="5479577">range</span>&nbsp;<span class="ident" id="5479583">p</span><span class="op" id="5479584">.</span><span class="ident" id="5479585">comment</span><span class="op" id="5479592">.</span><span class="ident" id="5479593">List</span>&nbsp;<span class="op" id="5479598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479603">p</span><span class="op" id="5479604">.</span><span class="ident" id="5479605">writeCommentPrefix</span><span class="op" id="5479623">(</span><span class="ident" id="5479624">p</span><span class="op" id="5479625">.</span><span class="ident" id="5479626">posFor</span><span class="op" id="5479632">(</span><span class="ident" id="5479633">c</span><span class="op" id="5479634">.</span><span class="ident" id="5479635">Pos</span><span class="op" id="5479638">(</span><span class="op" id="5479639">)</span><span class="op" id="5479640">)</span><span class="op" id="5479641">,</span>&nbsp;<span class="ident" id="5479643">next</span><span class="op" id="5479647">,</span>&nbsp;<span class="ident" id="5479649">last</span><span class="op" id="5479653">,</span>&nbsp;<span class="ident" id="5479655">c</span><span class="op" id="5479656">,</span>&nbsp;<span class="ident" id="5479658">tok</span><span class="op" id="5479661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479666">p</span><span class="op" id="5479667">.</span><span class="ident" id="5479668">writeComment</span><span class="op" id="5479680">(</span><span class="ident" id="5479681">c</span><span class="op" id="5479682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479687">last</span>&nbsp;<span class="op" id="5479692">=</span>&nbsp;<span class="ident" id="5479694">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5479698">}</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479702">p</span><span class="op" id="5479703">.</span><span class="ident" id="5479704">nextComment</span><span class="op" id="5479715">(</span><span class="op" id="5479716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5479719">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479723">if</span>&nbsp;<span class="ident" id="5479726">last</span>&nbsp;<span class="op" id="5479731">!=</span>&nbsp;<span class="ident" id="5479734">nil</span>&nbsp;<span class="op" id="5479738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5479742">//&nbsp;if&nbsp;the&nbsp;last&nbsp;comment&nbsp;is&nbsp;a&nbsp;/*-style&nbsp;comment&nbsp;and&nbsp;the&nbsp;next&nbsp;item</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5479807">//&nbsp;follows&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;but&nbsp;is&nbsp;not&nbsp;a&nbsp;comma,&nbsp;and&nbsp;not&nbsp;a&nbsp;&#34;closing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5479877">//&nbsp;token&nbsp;immediately&nbsp;following&nbsp;its&nbsp;corresponding&nbsp;&#34;opening&#34;&nbsp;token,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5479945">//&nbsp;add&nbsp;an&nbsp;extra&nbsp;blank&nbsp;for&nbsp;separation&nbsp;unless&nbsp;explicitly&nbsp;disabled</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480011">if</span>&nbsp;<span class="ident" id="5480014">p</span><span class="op" id="5480015">.</span><span class="ident" id="5480016">mode</span><span class="op" id="5480020">&amp;</span><span class="ident" id="5480021">noExtraBlank</span>&nbsp;<span class="op" id="5480034">==</span>&nbsp;<span class="num" id="5480037">0</span>&nbsp;<span class="op" id="5480039">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5480045">last</span><span class="op" id="5480049">.</span><span class="ident" id="5480050">Text</span><span class="op" id="5480054">[</span><span class="num" id="5480055">1</span><span class="op" id="5480056">]</span>&nbsp;<span class="op" id="5480058">==</span>&nbsp;<span class="string" id="5480061">&#39;*&#39;</span>&nbsp;<span class="op" id="5480065">&amp;&amp;</span>&nbsp;<span class="ident" id="5480068">p</span><span class="op" id="5480069">.</span><span class="ident" id="5480070">lineFor</span><span class="op" id="5480077">(</span><span class="ident" id="5480078">last</span><span class="op" id="5480082">.</span><span class="ident" id="5480083">Pos</span><span class="op" id="5480086">(</span><span class="op" id="5480087">)</span><span class="op" id="5480088">)</span>&nbsp;<span class="op" id="5480090">==</span>&nbsp;<span class="ident" id="5480093">next</span><span class="op" id="5480097">.</span><span class="ident" id="5480098">Line</span>&nbsp;<span class="op" id="5480103">&amp;&amp;</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5480109">tok</span>&nbsp;<span class="op" id="5480113">!=</span>&nbsp;<span class="ident" id="5480116">token</span><span class="op" id="5480121">.</span><span class="ident" id="5480122">COMMA</span>&nbsp;<span class="op" id="5480128">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5480134">(</span><span class="ident" id="5480135">tok</span>&nbsp;<span class="op" id="5480139">!=</span>&nbsp;<span class="ident" id="5480142">token</span><span class="op" id="5480147">.</span><span class="ident" id="5480148">RPAREN</span>&nbsp;<span class="op" id="5480155">||</span>&nbsp;<span class="ident" id="5480158">p</span><span class="op" id="5480159">.</span><span class="ident" id="5480160">prevOpen</span>&nbsp;<span class="op" id="5480169">==</span>&nbsp;<span class="ident" id="5480172">token</span><span class="op" id="5480177">.</span><span class="ident" id="5480178">LPAREN</span><span class="op" id="5480184">)</span>&nbsp;<span class="op" id="5480186">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5480192">(</span><span class="ident" id="5480193">tok</span>&nbsp;<span class="op" id="5480197">!=</span>&nbsp;<span class="ident" id="5480200">token</span><span class="op" id="5480205">.</span><span class="ident" id="5480206">RBRACK</span>&nbsp;<span class="op" id="5480213">||</span>&nbsp;<span class="ident" id="5480216">p</span><span class="op" id="5480217">.</span><span class="ident" id="5480218">prevOpen</span>&nbsp;<span class="op" id="5480227">==</span>&nbsp;<span class="ident" id="5480230">token</span><span class="op" id="5480235">.</span><span class="ident" id="5480236">LBRACK</span><span class="op" id="5480242">)</span>&nbsp;<span class="op" id="5480244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5480249">p</span><span class="op" id="5480250">.</span><span class="ident" id="5480251">writeByte</span><span class="op" id="5480260">(</span><span class="string" id="5480261">&#39;&nbsp;&#39;</span><span class="op" id="5480264">,</span>&nbsp;<span class="num" id="5480266">1</span><span class="op" id="5480267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5480271">}</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5480275">//&nbsp;ensure&nbsp;that&nbsp;there&nbsp;is&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;a&nbsp;//-style&nbsp;comment,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5480340">//&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#39;}&#39;&nbsp;unless&nbsp;explicitly&nbsp;disabled,&nbsp;or&nbsp;at&nbsp;eof</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5480404">needsLinebreak</span>&nbsp;<span class="op" id="5480419">:=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5480425">last</span><span class="op" id="5480429">.</span><span class="ident" id="5480430">Text</span><span class="op" id="5480434">[</span><span class="num" id="5480435">1</span><span class="op" id="5480436">]</span>&nbsp;<span class="op" id="5480438">==</span>&nbsp;<span class="string" id="5480441">&#39;/&#39;</span>&nbsp;<span class="op" id="5480445">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5480452">tok</span>&nbsp;<span class="op" id="5480456">==</span>&nbsp;<span class="ident" id="5480459">token</span><span class="op" id="5480464">.</span><span class="ident" id="5480465">RBRACE</span>&nbsp;<span class="op" id="5480472">&amp;&amp;</span>&nbsp;<span class="ident" id="5480475">p</span><span class="op" id="5480476">.</span><span class="ident" id="5480477">mode</span><span class="op" id="5480481">&amp;</span><span class="ident" id="5480482">noExtraLinebreak</span>&nbsp;<span class="op" id="5480499">==</span>&nbsp;<span class="num" id="5480502">0</span>&nbsp;<span class="op" id="5480504">||</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5480511">tok</span>&nbsp;<span class="op" id="5480515">==</span>&nbsp;<span class="ident" id="5480518">token</span><span class="op" id="5480523">.</span><span class="ident" id="5480524">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480530">return</span>&nbsp;<span class="ident" id="5480537">p</span><span class="op" id="5480538">.</span><span class="ident" id="5480539">writeCommentSuffix</span><span class="op" id="5480557">(</span><span class="ident" id="5480558">needsLinebreak</span><span class="op" id="5480572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5480575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5480579">//&nbsp;no&nbsp;comment&nbsp;was&nbsp;written&nbsp;-&nbsp;we&nbsp;should&nbsp;never&nbsp;reach&nbsp;here&nbsp;since</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5480641">//&nbsp;intersperseComments&nbsp;should&nbsp;not&nbsp;be&nbsp;called&nbsp;in&nbsp;that&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5480699">p</span><span class="op" id="5480700">.</span><span class="ident" id="5480701">internalError</span><span class="op" id="5480714">(</span><span class="string" id="5480715">&#34;intersperseComments&nbsp;called&nbsp;without&nbsp;pending&nbsp;comments&#34;</span><span class="op" id="5480768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480771">return</span><br>
<span class="lineno"></span><span class="op" id="5480778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">755</span><span class="comment" id="5480781">//&nbsp;whiteWhitespace&nbsp;writes&nbsp;the&nbsp;first&nbsp;n&nbsp;whitespace&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="5480839">func</span>&nbsp;<span class="op" id="5480844">(</span><span class="ident" id="5480845">p</span>&nbsp;<span class="op" id="5480847">*</span><span class="ident" id="5480848">printer</span><span class="op" id="5480855">)</span>&nbsp;<span class="ident" id="5480857">writeWhitespace</span><span class="op" id="5480872">(</span><span class="ident" id="5480873">n</span>&nbsp;<span class="builtintype" id="5480875">int</span><span class="op" id="5480878">)</span>&nbsp;<span class="op" id="5480880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5480883">//&nbsp;write&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480901">for</span>&nbsp;<span class="ident" id="5480905">i</span>&nbsp;<span class="op" id="5480907">:=</span>&nbsp;<span class="num" id="5480910">0</span><span class="op" id="5480911">;</span>&nbsp;<span class="ident" id="5480913">i</span>&nbsp;<span class="op" id="5480915">&lt;</span>&nbsp;<span class="ident" id="5480917">n</span><span class="op" id="5480918">;</span>&nbsp;<span class="ident" id="5480920">i</span><span class="op" id="5480921">++</span>&nbsp;<span class="op" id="5480924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480928">switch</span>&nbsp;<span class="ident" id="5480935">ch</span>&nbsp;<span class="op" id="5480938">:=</span>&nbsp;<span class="ident" id="5480941">p</span><span class="op" id="5480942">.</span><span class="ident" id="5480943">wsbuf</span><span class="op" id="5480948">[</span><span class="ident" id="5480949">i</span><span class="op" id="5480950">]</span><span class="op" id="5480951">;</span>&nbsp;<span class="ident" id="5480953">ch</span>&nbsp;<span class="op" id="5480956">{</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480960">case</span>&nbsp;<span class="ident" id="5480965">ignore</span><span class="op" id="5480971">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5480976">//&nbsp;ignore!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480989">case</span>&nbsp;<span class="ident" id="5480994">indent</span><span class="op" id="5481000">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5481005">p</span><span class="op" id="5481006">.</span><span class="ident" id="5481007">indent</span><span class="op" id="5481013">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5481018">case</span>&nbsp;<span class="ident" id="5481023">unindent</span><span class="op" id="5481031">:</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5481036">p</span><span class="op" id="5481037">.</span><span class="ident" id="5481038">indent</span><span class="op" id="5481044">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5481050">if</span>&nbsp;<span class="ident" id="5481053">p</span><span class="op" id="5481054">.</span><span class="ident" id="5481055">indent</span>&nbsp;<span class="op" id="5481062">&lt;</span>&nbsp;<span class="num" id="5481064">0</span>&nbsp;<span class="op" id="5481066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5481072">p</span><span class="op" id="5481073">.</span><span class="ident" id="5481074">internalError</span><span class="op" id="5481087">(</span><span class="string" id="5481088">&#34;negative&nbsp;indentation:&#34;</span><span class="op" id="5481111">,</span>&nbsp;<span class="ident" id="5481113">p</span><span class="op" id="5481114">.</span><span class="ident" id="5481115">indent</span><span class="op" id="5481121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5481127">p</span><span class="op" id="5481128">.</span><span class="ident" id="5481129">indent</span>&nbsp;<span class="op" id="5481136">=</span>&nbsp;<span class="num" id="5481138">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5481143">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5481147">case</span>&nbsp;<span class="ident" id="5481152">newline</span><span class="op" id="5481159">,</span>&nbsp;<span class="ident" id="5481161">formfeed</span><span class="op" id="5481169">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5481174">//&nbsp;A&nbsp;line&nbsp;break&nbsp;immediately&nbsp;followed&nbsp;by&nbsp;a&nbsp;&#34;correcting&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5481232">//&nbsp;unindent&nbsp;is&nbsp;swapped&nbsp;with&nbsp;the&nbsp;unindent&nbsp;-&nbsp;this&nbsp;permits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5481291">//&nbsp;proper&nbsp;label&nbsp;positioning.&nbsp;If&nbsp;a&nbsp;comment&nbsp;is&nbsp;between</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5481347">//&nbsp;the&nbsp;line&nbsp;break&nbsp;and&nbsp;the&nbsp;label,&nbsp;the&nbsp;unindent&nbsp;is&nbsp;not</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5481403">//&nbsp;part&nbsp;of&nbsp;the&nbsp;comment&nbsp;whitespace&nbsp;prefix&nbsp;and&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5481463">//&nbsp;will&nbsp;be&nbsp;positioned&nbsp;correctly&nbsp;indented.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5481508">if</span>&nbsp;<span class="ident" id="5481511">i</span><span class="op" id="5481512">+</span><span class="num" id="5481513">1</span>&nbsp;<span class="op" id="5481515">&lt;</span>&nbsp;<span class="ident" id="5481517">n</span>&nbsp;<span class="op" id="5481519">&amp;&amp;</span>&nbsp;<span class="ident" id="5481522">p</span><span class="op" id="5481523">.</span><span class="ident" id="5481524">wsbuf</span><span class="op" id="5481529">[</span><span class="ident" id="5481530">i</span><span class="op" id="5481531">+</span><span class="num" id="5481532">1</span><span class="op" id="5481533">]</span>&nbsp;<span class="op" id="5481535">==</span>&nbsp;<span class="ident" id="5481538">unindent</span>&nbsp;<span class="op" id="5481547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5481553">//&nbsp;Use&nbsp;a&nbsp;formfeed&nbsp;to&nbsp;terminate&nbsp;the&nbsp;current&nbsp;section.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5481609">//&nbsp;Otherwise,&nbsp;a&nbsp;long&nbsp;label&nbsp;name&nbsp;on&nbsp;the&nbsp;next&nbsp;line&nbsp;leading</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5481670">//&nbsp;to&nbsp;a&nbsp;wide&nbsp;column&nbsp;may&nbsp;increase&nbsp;the&nbsp;indentation&nbsp;column</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5481730">//&nbsp;of&nbsp;lines&nbsp;before&nbsp;the&nbsp;label;&nbsp;effectively&nbsp;leading&nbsp;to&nbsp;wrong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5481793">//&nbsp;indentation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5481813">p</span><span class="op" id="5481814">.</span><span class="ident" id="5481815">wsbuf</span><span class="op" id="5481820">[</span><span class="ident" id="5481821">i</span><span class="op" id="5481822">]</span><span class="op" id="5481823">,</span>&nbsp;<span class="ident" id="5481825">p</span><span class="op" id="5481826">.</span><span class="ident" id="5481827">wsbuf</span><span class="op" id="5481832">[</span><span class="ident" id="5481833">i</span><span class="op" id="5481834">+</span><span class="num" id="5481835">1</span><span class="op" id="5481836">]</span>&nbsp;<span class="op" id="5481838">=</span>&nbsp;<span class="ident" id="5481840">unindent</span><span class="op" id="5481848">,</span>&nbsp;<span class="ident" id="5481850">formfeed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5481863">i</span><span class="op" id="5481864">--</span>&nbsp;<span class="comment" id="5481867">//&nbsp;do&nbsp;it&nbsp;again</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5481886">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5481898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5481903">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5481917">default</span><span class="op" id="5481924">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5481929">p</span><span class="op" id="5481930">.</span><span class="ident" id="5481931">writeByte</span><span class="op" id="5481940">(</span><span class="builtintype" id="5481941">byte</span><span class="op" id="5481945">(</span><span class="ident" id="5481946">ch</span><span class="op" id="5481948">)</span><span class="op" id="5481949">,</span>&nbsp;<span class="num" id="5481951">1</span><span class="op" id="5481952">)</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5481956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5481959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5481963">//&nbsp;shift&nbsp;remaining&nbsp;entries&nbsp;down</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5481996">l</span>&nbsp;<span class="op" id="5481998">:=</span>&nbsp;<span class="builtinfunc" id="5482001">copy</span><span class="op" id="5482005">(</span><span class="ident" id="5482006">p</span><span class="op" id="5482007">.</span><span class="ident" id="5482008">wsbuf</span><span class="op" id="5482013">,</span>&nbsp;<span class="ident" id="5482015">p</span><span class="op" id="5482016">.</span><span class="ident" id="5482017">wsbuf</span><span class="op" id="5482022">[</span><span class="ident" id="5482023">n</span><span class="op" id="5482024">:</span><span class="op" id="5482025">]</span><span class="op" id="5482026">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482029">p</span><span class="op" id="5482030">.</span><span class="ident" id="5482031">wsbuf</span>&nbsp;<span class="op" id="5482037">=</span>&nbsp;<span class="ident" id="5482039">p</span><span class="op" id="5482040">.</span><span class="ident" id="5482041">wsbuf</span><span class="op" id="5482046">[</span><span class="op" id="5482047">:</span><span class="ident" id="5482048">l</span><span class="op" id="5482049">]</span><br>
<span class="lineno"></span><span class="op" id="5482051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5482054">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5482134">//&nbsp;Printing&nbsp;interface</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span><span class="comment" id="5482157">//&nbsp;nlines&nbsp;limits&nbsp;n&nbsp;to&nbsp;maxNewlines.</span><br>
<span class="lineno"></span><span class="keyword" id="5482192">func</span>&nbsp;<span class="ident" id="5482197">nlimit</span><span class="op" id="5482203">(</span><span class="ident" id="5482204">n</span>&nbsp;<span class="builtintype" id="5482206">int</span><span class="op" id="5482209">)</span>&nbsp;<span class="builtintype" id="5482211">int</span>&nbsp;<span class="op" id="5482215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5482218">if</span>&nbsp;<span class="ident" id="5482221">n</span>&nbsp;<span class="op" id="5482223">&gt;</span>&nbsp;<span class="ident" id="5482225">maxNewlines</span>&nbsp;<span class="op" id="5482237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482241">n</span>&nbsp;<span class="op" id="5482243">=</span>&nbsp;<span class="ident" id="5482245">maxNewlines</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5482258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5482261">return</span>&nbsp;<span class="ident" id="5482268">n</span><br>
<span class="lineno"></span><span class="op" id="5482270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5482273">func</span>&nbsp;<span class="ident" id="5482278">mayCombine</span><span class="op" id="5482288">(</span><span class="ident" id="5482289">prev</span>&nbsp;<span class="ident" id="5482294">token</span><span class="op" id="5482299">.</span><span class="ident" id="5482300">Token</span><span class="op" id="5482305">,</span>&nbsp;<span class="ident" id="5482307">next</span>&nbsp;<span class="builtintype" id="5482312">byte</span><span class="op" id="5482316">)</span>&nbsp;<span class="op" id="5482318">(</span><span class="ident" id="5482319">b</span>&nbsp;<span class="builtintype" id="5482321">bool</span><span class="op" id="5482325">)</span>&nbsp;<span class="op" id="5482327">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5482330">switch</span>&nbsp;<span class="ident" id="5482337">prev</span>&nbsp;<span class="op" id="5482342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5482345">case</span>&nbsp;<span class="ident" id="5482350">token</span><span class="op" id="5482355">.</span><span class="ident" id="5482356">INT</span><span class="op" id="5482359">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482363">b</span>&nbsp;<span class="op" id="5482365">=</span>&nbsp;<span class="ident" id="5482367">next</span>&nbsp;<span class="op" id="5482372">==</span>&nbsp;<span class="string" id="5482375">&#39;.&#39;</span>&nbsp;<span class="comment" id="5482379">//&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5482386">case</span>&nbsp;<span class="ident" id="5482391">token</span><span class="op" id="5482396">.</span><span class="ident" id="5482397">ADD</span><span class="op" id="5482400">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482404">b</span>&nbsp;<span class="op" id="5482406">=</span>&nbsp;<span class="ident" id="5482408">next</span>&nbsp;<span class="op" id="5482413">==</span>&nbsp;<span class="string" id="5482416">&#39;+&#39;</span>&nbsp;<span class="comment" id="5482420">//&nbsp;++</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5482427">case</span>&nbsp;<span class="ident" id="5482432">token</span><span class="op" id="5482437">.</span><span class="ident" id="5482438">SUB</span><span class="op" id="5482441">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482445">b</span>&nbsp;<span class="op" id="5482447">=</span>&nbsp;<span class="ident" id="5482449">next</span>&nbsp;<span class="op" id="5482454">==</span>&nbsp;<span class="string" id="5482457">&#39;-&#39;</span>&nbsp;<span class="comment" id="5482461">//&nbsp;--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5482468">case</span>&nbsp;<span class="ident" id="5482473">token</span><span class="op" id="5482478">.</span><span class="ident" id="5482479">QUO</span><span class="op" id="5482482">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482486">b</span>&nbsp;<span class="op" id="5482488">=</span>&nbsp;<span class="ident" id="5482490">next</span>&nbsp;<span class="op" id="5482495">==</span>&nbsp;<span class="string" id="5482498">&#39;*&#39;</span>&nbsp;<span class="comment" id="5482502">//&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5482509">case</span>&nbsp;<span class="ident" id="5482514">token</span><span class="op" id="5482519">.</span><span class="ident" id="5482520">LSS</span><span class="op" id="5482523">:</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482527">b</span>&nbsp;<span class="op" id="5482529">=</span>&nbsp;<span class="ident" id="5482531">next</span>&nbsp;<span class="op" id="5482536">==</span>&nbsp;<span class="string" id="5482539">&#39;-&#39;</span>&nbsp;<span class="op" id="5482543">||</span>&nbsp;<span class="ident" id="5482546">next</span>&nbsp;<span class="op" id="5482551">==</span>&nbsp;<span class="string" id="5482554">&#39;&lt;&#39;</span>&nbsp;<span class="comment" id="5482558">//&nbsp;&lt;-&nbsp;or&nbsp;&lt;&lt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5482571">case</span>&nbsp;<span class="ident" id="5482576">token</span><span class="op" id="5482581">.</span><span class="ident" id="5482582">AND</span><span class="op" id="5482585">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482589">b</span>&nbsp;<span class="op" id="5482591">=</span>&nbsp;<span class="ident" id="5482593">next</span>&nbsp;<span class="op" id="5482598">==</span>&nbsp;<span class="string" id="5482601">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="5482605">||</span>&nbsp;<span class="ident" id="5482608">next</span>&nbsp;<span class="op" id="5482613">==</span>&nbsp;<span class="string" id="5482616">&#39;^&#39;</span>&nbsp;<span class="comment" id="5482620">//&nbsp;&amp;&amp;&nbsp;or&nbsp;&amp;^</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5482633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5482636">return</span><br>
<span class="lineno">825</span><span class="op" id="5482643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5482646">//&nbsp;print&nbsp;prints&nbsp;a&nbsp;list&nbsp;of&nbsp;&#34;items&#34;&nbsp;(roughly&nbsp;corresponding&nbsp;to&nbsp;syntactic</span><br>
<span class="lineno"></span><span class="comment" id="5482716">//&nbsp;tokens,&nbsp;but&nbsp;also&nbsp;including&nbsp;whitespace&nbsp;and&nbsp;formatting&nbsp;information).</span><br>
<span class="lineno"></span><span class="comment" id="5482786">//&nbsp;It&nbsp;is&nbsp;the&nbsp;only&nbsp;print&nbsp;function&nbsp;that&nbsp;should&nbsp;be&nbsp;called&nbsp;directly&nbsp;from</span><br>
<span class="lineno">830</span><span class="comment" id="5482855">//&nbsp;any&nbsp;of&nbsp;the&nbsp;AST&nbsp;printing&nbsp;functions&nbsp;in&nbsp;nodes.go.</span><br>
<span class="lineno"></span><span class="comment" id="5482905">//</span><br>
<span class="lineno"></span><span class="comment" id="5482908">//&nbsp;Whitespace&nbsp;is&nbsp;accumulated&nbsp;until&nbsp;a&nbsp;non-whitespace&nbsp;token&nbsp;appears.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="5482979">//&nbsp;comments&nbsp;that&nbsp;need&nbsp;to&nbsp;appear&nbsp;before&nbsp;that&nbsp;token&nbsp;are&nbsp;printed&nbsp;first,</span><br>
<span class="lineno"></span><span class="comment" id="5483048">//&nbsp;taking&nbsp;into&nbsp;account&nbsp;the&nbsp;amount&nbsp;and&nbsp;structure&nbsp;of&nbsp;any&nbsp;pending&nbsp;white-</span><br>
<span class="lineno">835</span><span class="comment" id="5483118">//&nbsp;space&nbsp;for&nbsp;best&nbsp;comment&nbsp;placement.&nbsp;Then,&nbsp;any&nbsp;leftover&nbsp;whitespace&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5483188">//&nbsp;printed,&nbsp;followed&nbsp;by&nbsp;the&nbsp;actual&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="5483230">//</span><br>
<span class="lineno"></span><span class="keyword" id="5483233">func</span>&nbsp;<span class="op" id="5483238">(</span><span class="ident" id="5483239">p</span>&nbsp;<span class="op" id="5483241">*</span><span class="ident" id="5483242">printer</span><span class="op" id="5483249">)</span>&nbsp;<span class="builtinfunc" id="5483251">print</span><span class="op" id="5483256">(</span><span class="ident" id="5483257">args</span>&nbsp;<span class="op" id="5483262">...</span><span class="keyword" id="5483265">interface</span><span class="op" id="5483274">{</span><span class="op" id="5483275">}</span><span class="op" id="5483276">)</span>&nbsp;<span class="op" id="5483278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483281">for</span>&nbsp;<span class="ident" id="5483285">_</span><span class="op" id="5483286">,</span>&nbsp;<span class="ident" id="5483288">arg</span>&nbsp;<span class="op" id="5483292">:=</span>&nbsp;<span class="keyword" id="5483295">range</span>&nbsp;<span class="ident" id="5483301">args</span>&nbsp;<span class="op" id="5483306">{</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5483310">//&nbsp;information&nbsp;about&nbsp;the&nbsp;current&nbsp;arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483349">var</span>&nbsp;<span class="ident" id="5483353">data</span>&nbsp;<span class="builtintype" id="5483358">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483367">var</span>&nbsp;<span class="ident" id="5483371">isLit</span>&nbsp;<span class="builtintype" id="5483377">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483384">var</span>&nbsp;<span class="ident" id="5483388">impliedSemi</span>&nbsp;<span class="builtintype" id="5483400">bool</span>&nbsp;<span class="comment" id="5483405">//&nbsp;value&nbsp;for&nbsp;p.impliedSemi&nbsp;after&nbsp;this&nbsp;arg</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5483450">//&nbsp;record&nbsp;previous&nbsp;opening&nbsp;token,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483493">switch</span>&nbsp;<span class="ident" id="5483500">p</span><span class="op" id="5483501">.</span><span class="ident" id="5483502">lastTok</span>&nbsp;<span class="op" id="5483510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483514">case</span>&nbsp;<span class="ident" id="5483519">token</span><span class="op" id="5483524">.</span><span class="ident" id="5483525">ILLEGAL</span><span class="op" id="5483532">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5483537">//&nbsp;ignore&nbsp;(white&nbsp;space)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483563">case</span>&nbsp;<span class="ident" id="5483568">token</span><span class="op" id="5483573">.</span><span class="ident" id="5483574">LPAREN</span><span class="op" id="5483580">,</span>&nbsp;<span class="ident" id="5483582">token</span><span class="op" id="5483587">.</span><span class="ident" id="5483588">LBRACK</span><span class="op" id="5483594">:</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5483599">p</span><span class="op" id="5483600">.</span><span class="ident" id="5483601">prevOpen</span>&nbsp;<span class="op" id="5483610">=</span>&nbsp;<span class="ident" id="5483612">p</span><span class="op" id="5483613">.</span><span class="ident" id="5483614">lastTok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483624">default</span><span class="op" id="5483631">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5483636">//&nbsp;other&nbsp;tokens&nbsp;followed&nbsp;any&nbsp;opening&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5483682">p</span><span class="op" id="5483683">.</span><span class="ident" id="5483684">prevOpen</span>&nbsp;<span class="op" id="5483693">=</span>&nbsp;<span class="ident" id="5483695">token</span><span class="op" id="5483700">.</span><span class="ident" id="5483701">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5483711">}</span><br>
<span class="lineno">855</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483716">switch</span>&nbsp;<span class="ident" id="5483723">x</span>&nbsp;<span class="op" id="5483725">:=</span>&nbsp;<span class="ident" id="5483728">arg</span><span class="op" id="5483731">.</span><span class="op" id="5483732">(</span><span class="keyword" id="5483733">type</span><span class="op" id="5483737">)</span>&nbsp;<span class="op" id="5483739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483743">case</span>&nbsp;<span class="ident" id="5483748">pmode</span><span class="op" id="5483753">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5483758">//&nbsp;toggle&nbsp;printer&nbsp;mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5483784">p</span><span class="op" id="5483785">.</span><span class="ident" id="5483786">mode</span>&nbsp;<span class="op" id="5483791">^=</span>&nbsp;<span class="ident" id="5483794">x</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483799">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483811">case</span>&nbsp;<span class="ident" id="5483816">whiteSpace</span><span class="op" id="5483826">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483831">if</span>&nbsp;<span class="ident" id="5483834">x</span>&nbsp;<span class="op" id="5483836">==</span>&nbsp;<span class="ident" id="5483839">ignore</span>&nbsp;<span class="op" id="5483846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5483852">//&nbsp;don&#39;t&nbsp;add&nbsp;ignore&#39;s&nbsp;to&nbsp;the&nbsp;buffer;&nbsp;they</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5483898">//&nbsp;may&nbsp;screw&nbsp;up&nbsp;&#34;correcting&#34;&nbsp;unindents&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5483946">//&nbsp;LabeledStmt)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483966">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5483978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5483983">i</span>&nbsp;<span class="op" id="5483985">:=</span>&nbsp;<span class="builtinfunc" id="5483988">len</span><span class="op" id="5483991">(</span><span class="ident" id="5483992">p</span><span class="op" id="5483993">.</span><span class="ident" id="5483994">wsbuf</span><span class="op" id="5483999">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484004">if</span>&nbsp;<span class="ident" id="5484007">i</span>&nbsp;<span class="op" id="5484009">==</span>&nbsp;<span class="builtinfunc" id="5484012">cap</span><span class="op" id="5484015">(</span><span class="ident" id="5484016">p</span><span class="op" id="5484017">.</span><span class="ident" id="5484018">wsbuf</span><span class="op" id="5484023">)</span>&nbsp;<span class="op" id="5484025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5484031">//&nbsp;Whitespace&nbsp;sequences&nbsp;are&nbsp;very&nbsp;short&nbsp;so&nbsp;this&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5484089">//&nbsp;never&nbsp;happen.&nbsp;Handle&nbsp;gracefully&nbsp;(but&nbsp;possibly&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5484147">//&nbsp;bad&nbsp;comment&nbsp;placement)&nbsp;if&nbsp;it&nbsp;does&nbsp;happen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5484196">p</span><span class="op" id="5484197">.</span><span class="ident" id="5484198">writeWhitespace</span><span class="op" id="5484213">(</span><span class="ident" id="5484214">i</span><span class="op" id="5484215">)</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5484221">i</span>&nbsp;<span class="op" id="5484223">=</span>&nbsp;<span class="num" id="5484225">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5484230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5484235">p</span><span class="op" id="5484236">.</span><span class="ident" id="5484237">wsbuf</span>&nbsp;<span class="op" id="5484243">=</span>&nbsp;<span class="ident" id="5484245">p</span><span class="op" id="5484246">.</span><span class="ident" id="5484247">wsbuf</span><span class="op" id="5484252">[</span><span class="num" id="5484253">0</span>&nbsp;<span class="op" id="5484255">:</span>&nbsp;<span class="ident" id="5484257">i</span><span class="op" id="5484258">+</span><span class="num" id="5484259">1</span><span class="op" id="5484260">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5484265">p</span><span class="op" id="5484266">.</span><span class="ident" id="5484267">wsbuf</span><span class="op" id="5484272">[</span><span class="ident" id="5484273">i</span><span class="op" id="5484274">]</span>&nbsp;<span class="op" id="5484276">=</span>&nbsp;<span class="ident" id="5484278">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484283">if</span>&nbsp;<span class="ident" id="5484286">x</span>&nbsp;<span class="op" id="5484288">==</span>&nbsp;<span class="ident" id="5484291">newline</span>&nbsp;<span class="op" id="5484299">||</span>&nbsp;<span class="ident" id="5484302">x</span>&nbsp;<span class="op" id="5484304">==</span>&nbsp;<span class="ident" id="5484307">formfeed</span>&nbsp;<span class="op" id="5484316">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5484322">//&nbsp;newlines&nbsp;affect&nbsp;the&nbsp;current&nbsp;state&nbsp;(p.impliedSemi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5484379">//&nbsp;and&nbsp;not&nbsp;the&nbsp;state&nbsp;after&nbsp;printing&nbsp;arg&nbsp;(impliedSemi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5484437">//&nbsp;because&nbsp;comments&nbsp;can&nbsp;be&nbsp;interspersed&nbsp;before&nbsp;the&nbsp;arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5484496">//&nbsp;in&nbsp;this&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5484516">p</span><span class="op" id="5484517">.</span><span class="ident" id="5484518">impliedSemi</span>&nbsp;<span class="op" id="5484530">=</span>&nbsp;<span class="builtintype" id="5484532">false</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5484541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5484546">p</span><span class="op" id="5484547">.</span><span class="ident" id="5484548">lastTok</span>&nbsp;<span class="op" id="5484556">=</span>&nbsp;<span class="ident" id="5484558">token</span><span class="op" id="5484563">.</span><span class="ident" id="5484564">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484575">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484587">case</span>&nbsp;<span class="op" id="5484592">*</span><span class="ident" id="5484593">ast</span><span class="op" id="5484596">.</span><span class="ident" id="5484597">Ident</span><span class="op" id="5484602">:</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5484607">data</span>&nbsp;<span class="op" id="5484612">=</span>&nbsp;<span class="ident" id="5484614">x</span><span class="op" id="5484615">.</span><span class="ident" id="5484616">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5484624">impliedSemi</span>&nbsp;<span class="op" id="5484636">=</span>&nbsp;<span class="builtintype" id="5484638">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5484646">p</span><span class="op" id="5484647">.</span><span class="ident" id="5484648">lastTok</span>&nbsp;<span class="op" id="5484656">=</span>&nbsp;<span class="ident" id="5484658">token</span><span class="op" id="5484663">.</span><span class="ident" id="5484664">IDENT</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484673">case</span>&nbsp;<span class="op" id="5484678">*</span><span class="ident" id="5484679">ast</span><span class="op" id="5484682">.</span><span class="ident" id="5484683">BasicLit</span><span class="op" id="5484691">:</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5484696">data</span>&nbsp;<span class="op" id="5484701">=</span>&nbsp;<span class="ident" id="5484703">x</span><span class="op" id="5484704">.</span><span class="ident" id="5484705">Value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5484714">isLit</span>&nbsp;<span class="op" id="5484720">=</span>&nbsp;<span class="builtintype" id="5484722">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5484730">impliedSemi</span>&nbsp;<span class="op" id="5484742">=</span>&nbsp;<span class="builtintype" id="5484744">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5484752">p</span><span class="op" id="5484753">.</span><span class="ident" id="5484754">lastTok</span>&nbsp;<span class="op" id="5484762">=</span>&nbsp;<span class="ident" id="5484764">x</span><span class="op" id="5484765">.</span><span class="ident" id="5484766">Kind</span><br>
<span class="lineno"></span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484774">case</span>&nbsp;<span class="ident" id="5484779">token</span><span class="op" id="5484784">.</span><span class="ident" id="5484785">Token</span><span class="op" id="5484790">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5484795">s</span>&nbsp;<span class="op" id="5484797">:=</span>&nbsp;<span class="ident" id="5484800">x</span><span class="op" id="5484801">.</span><span class="ident" id="5484802">String</span><span class="op" id="5484808">(</span><span class="op" id="5484809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484814">if</span>&nbsp;<span class="ident" id="5484817">mayCombine</span><span class="op" id="5484827">(</span><span class="ident" id="5484828">p</span><span class="op" id="5484829">.</span><span class="ident" id="5484830">lastTok</span><span class="op" id="5484837">,</span>&nbsp;<span class="ident" id="5484839">s</span><span class="op" id="5484840">[</span><span class="num" id="5484841">0</span><span class="op" id="5484842">]</span><span class="op" id="5484843">)</span>&nbsp;<span class="op" id="5484845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5484851">//&nbsp;the&nbsp;previous&nbsp;and&nbsp;the&nbsp;current&nbsp;token&nbsp;must&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5484901">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;blank&nbsp;otherwise&nbsp;they&nbsp;combine</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5484952">//&nbsp;into&nbsp;a&nbsp;different&nbsp;incorrect&nbsp;token&nbsp;sequence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5485001">//&nbsp;(except&nbsp;for&nbsp;token.INT&nbsp;followed&nbsp;by&nbsp;a&nbsp;&#39;.&#39;&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5485053">//&nbsp;should&nbsp;never&nbsp;happen&nbsp;because&nbsp;it&nbsp;is&nbsp;taken&nbsp;care</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5485105">//&nbsp;of&nbsp;via&nbsp;binary&nbsp;expression&nbsp;formatting)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5485149">if</span>&nbsp;<span class="builtinfunc" id="5485152">len</span><span class="op" id="5485155">(</span><span class="ident" id="5485156">p</span><span class="op" id="5485157">.</span><span class="ident" id="5485158">wsbuf</span><span class="op" id="5485163">)</span>&nbsp;<span class="op" id="5485165">!=</span>&nbsp;<span class="num" id="5485168">0</span>&nbsp;<span class="op" id="5485170">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485177">p</span><span class="op" id="5485178">.</span><span class="ident" id="5485179">internalError</span><span class="op" id="5485192">(</span><span class="string" id="5485193">&#34;whitespace&nbsp;buffer&nbsp;not&nbsp;empty&#34;</span><span class="op" id="5485222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5485228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485234">p</span><span class="op" id="5485235">.</span><span class="ident" id="5485236">wsbuf</span>&nbsp;<span class="op" id="5485242">=</span>&nbsp;<span class="ident" id="5485244">p</span><span class="op" id="5485245">.</span><span class="ident" id="5485246">wsbuf</span><span class="op" id="5485251">[</span><span class="num" id="5485252">0</span><span class="op" id="5485253">:</span><span class="num" id="5485254">1</span><span class="op" id="5485255">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485261">p</span><span class="op" id="5485262">.</span><span class="ident" id="5485263">wsbuf</span><span class="op" id="5485268">[</span><span class="num" id="5485269">0</span><span class="op" id="5485270">]</span>&nbsp;<span class="op" id="5485272">=</span>&nbsp;<span class="string" id="5485274">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5485281">}</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485286">data</span>&nbsp;<span class="op" id="5485291">=</span>&nbsp;<span class="ident" id="5485293">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5485298">//&nbsp;some&nbsp;keywords&nbsp;followed&nbsp;by&nbsp;a&nbsp;newline&nbsp;imply&nbsp;a&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5485358">switch</span>&nbsp;<span class="ident" id="5485365">x</span>&nbsp;<span class="op" id="5485367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5485372">case</span>&nbsp;<span class="ident" id="5485377">token</span><span class="op" id="5485382">.</span><span class="ident" id="5485383">BREAK</span><span class="op" id="5485388">,</span>&nbsp;<span class="ident" id="5485390">token</span><span class="op" id="5485395">.</span><span class="ident" id="5485396">CONTINUE</span><span class="op" id="5485404">,</span>&nbsp;<span class="ident" id="5485406">token</span><span class="op" id="5485411">.</span><span class="ident" id="5485412">FALLTHROUGH</span><span class="op" id="5485423">,</span>&nbsp;<span class="ident" id="5485425">token</span><span class="op" id="5485430">.</span><span class="ident" id="5485431">RETURN</span><span class="op" id="5485437">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485443">token</span><span class="op" id="5485448">.</span><span class="ident" id="5485449">INC</span><span class="op" id="5485452">,</span>&nbsp;<span class="ident" id="5485454">token</span><span class="op" id="5485459">.</span><span class="ident" id="5485460">DEC</span><span class="op" id="5485463">,</span>&nbsp;<span class="ident" id="5485465">token</span><span class="op" id="5485470">.</span><span class="ident" id="5485471">RPAREN</span><span class="op" id="5485477">,</span>&nbsp;<span class="ident" id="5485479">token</span><span class="op" id="5485484">.</span><span class="ident" id="5485485">RBRACK</span><span class="op" id="5485491">,</span>&nbsp;<span class="ident" id="5485493">token</span><span class="op" id="5485498">.</span><span class="ident" id="5485499">RBRACE</span><span class="op" id="5485505">:</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485511">impliedSemi</span>&nbsp;<span class="op" id="5485523">=</span>&nbsp;<span class="builtintype" id="5485525">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5485533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485538">p</span><span class="op" id="5485539">.</span><span class="ident" id="5485540">lastTok</span>&nbsp;<span class="op" id="5485548">=</span>&nbsp;<span class="ident" id="5485550">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5485555">case</span>&nbsp;<span class="ident" id="5485560">token</span><span class="op" id="5485565">.</span><span class="ident" id="5485566">Pos</span><span class="op" id="5485569">:</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5485574">if</span>&nbsp;<span class="ident" id="5485577">x</span><span class="op" id="5485578">.</span><span class="ident" id="5485579">IsValid</span><span class="op" id="5485586">(</span><span class="op" id="5485587">)</span>&nbsp;<span class="op" id="5485589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485595">p</span><span class="op" id="5485596">.</span><span class="ident" id="5485597">pos</span>&nbsp;<span class="op" id="5485601">=</span>&nbsp;<span class="ident" id="5485603">p</span><span class="op" id="5485604">.</span><span class="ident" id="5485605">posFor</span><span class="op" id="5485611">(</span><span class="ident" id="5485612">x</span><span class="op" id="5485613">)</span>&nbsp;<span class="comment" id="5485615">//&nbsp;accurate&nbsp;position&nbsp;of&nbsp;next&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5485652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5485657">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5485669">case</span>&nbsp;<span class="builtintype" id="5485674">string</span><span class="op" id="5485680">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5485685">//&nbsp;incorrect&nbsp;AST&nbsp;-&nbsp;print&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485727">data</span>&nbsp;<span class="op" id="5485732">=</span>&nbsp;<span class="ident" id="5485734">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485739">isLit</span>&nbsp;<span class="op" id="5485745">=</span>&nbsp;<span class="builtintype" id="5485747">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485755">impliedSemi</span>&nbsp;<span class="op" id="5485767">=</span>&nbsp;<span class="builtintype" id="5485769">true</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485777">p</span><span class="op" id="5485778">.</span><span class="ident" id="5485779">lastTok</span>&nbsp;<span class="op" id="5485787">=</span>&nbsp;<span class="ident" id="5485789">token</span><span class="op" id="5485794">.</span><span class="ident" id="5485795">STRING</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5485805">default</span><span class="op" id="5485812">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485817">fmt</span><span class="op" id="5485820">.</span><span class="ident" id="5485821">Fprintf</span><span class="op" id="5485828">(</span><span class="ident" id="5485829">os</span><span class="op" id="5485831">.</span><span class="ident" id="5485832">Stderr</span><span class="op" id="5485838">,</span>&nbsp;<span class="string" id="5485840">&#34;print:&nbsp;unsupported&nbsp;argument&nbsp;%v&nbsp;(%T)\n&#34;</span><span class="op" id="5485879">,</span>&nbsp;<span class="ident" id="5485881">arg</span><span class="op" id="5485884">,</span>&nbsp;<span class="ident" id="5485886">arg</span><span class="op" id="5485889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5485894">panic</span><span class="op" id="5485899">(</span><span class="string" id="5485900">&#34;go/printer&nbsp;type&#34;</span><span class="op" id="5485917">)</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5485921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5485925">//&nbsp;data&nbsp;!=&nbsp;&#34;&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485942">next</span>&nbsp;<span class="op" id="5485947">:=</span>&nbsp;<span class="ident" id="5485950">p</span><span class="op" id="5485951">.</span><span class="ident" id="5485952">pos</span>&nbsp;<span class="comment" id="5485956">//&nbsp;estimated/accurate&nbsp;position&nbsp;of&nbsp;next&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486002">wroteNewline</span><span class="op" id="5486014">,</span>&nbsp;<span class="ident" id="5486016">droppedFF</span>&nbsp;<span class="op" id="5486026">:=</span>&nbsp;<span class="ident" id="5486029">p</span><span class="op" id="5486030">.</span><span class="ident" id="5486031">flush</span><span class="op" id="5486036">(</span><span class="ident" id="5486037">next</span><span class="op" id="5486041">,</span>&nbsp;<span class="ident" id="5486043">p</span><span class="op" id="5486044">.</span><span class="ident" id="5486045">lastTok</span><span class="op" id="5486052">)</span><br>
<span class="lineno">945</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5486057">//&nbsp;intersperse&nbsp;extra&nbsp;newlines&nbsp;if&nbsp;present&nbsp;in&nbsp;the&nbsp;source&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5486118">//&nbsp;if&nbsp;they&nbsp;don&#39;t&nbsp;cause&nbsp;extra&nbsp;semicolons&nbsp;(don&#39;t&nbsp;do&nbsp;this&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5486178">//&nbsp;flush&nbsp;as&nbsp;it&nbsp;will&nbsp;cause&nbsp;extra&nbsp;newlines&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;file)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486243">if</span>&nbsp;<span class="op" id="5486246">!</span><span class="ident" id="5486247">p</span><span class="op" id="5486248">.</span><span class="ident" id="5486249">impliedSemi</span>&nbsp;<span class="op" id="5486261">{</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486266">n</span>&nbsp;<span class="op" id="5486268">:=</span>&nbsp;<span class="ident" id="5486271">nlimit</span><span class="op" id="5486277">(</span><span class="ident" id="5486278">next</span><span class="op" id="5486282">.</span><span class="ident" id="5486283">Line</span>&nbsp;<span class="op" id="5486288">-</span>&nbsp;<span class="ident" id="5486290">p</span><span class="op" id="5486291">.</span><span class="ident" id="5486292">pos</span><span class="op" id="5486295">.</span><span class="ident" id="5486296">Line</span><span class="op" id="5486300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5486305">//&nbsp;don&#39;t&nbsp;exceed&nbsp;maxNewlines&nbsp;if&nbsp;we&nbsp;already&nbsp;wrote&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486360">if</span>&nbsp;<span class="ident" id="5486363">wroteNewline</span>&nbsp;<span class="op" id="5486376">&amp;&amp;</span>&nbsp;<span class="ident" id="5486379">n</span>&nbsp;<span class="op" id="5486381">==</span>&nbsp;<span class="ident" id="5486384">maxNewlines</span>&nbsp;<span class="op" id="5486396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486402">n</span>&nbsp;<span class="op" id="5486404">=</span>&nbsp;<span class="ident" id="5486406">maxNewlines</span>&nbsp;<span class="op" id="5486418">-</span>&nbsp;<span class="num" id="5486420">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5486425">}</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486430">if</span>&nbsp;<span class="ident" id="5486433">n</span>&nbsp;<span class="op" id="5486435">&gt;</span>&nbsp;<span class="num" id="5486437">0</span>&nbsp;<span class="op" id="5486439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486445">ch</span>&nbsp;<span class="op" id="5486448">:=</span>&nbsp;<span class="builtintype" id="5486451">byte</span><span class="op" id="5486455">(</span><span class="string" id="5486456">&#39;\n&#39;</span><span class="op" id="5486460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486466">if</span>&nbsp;<span class="ident" id="5486469">droppedFF</span>&nbsp;<span class="op" id="5486479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486486">ch</span>&nbsp;<span class="op" id="5486489">=</span>&nbsp;<span class="string" id="5486491">&#39;\f&#39;</span>&nbsp;<span class="comment" id="5486496">//&nbsp;use&nbsp;formfeed&nbsp;since&nbsp;we&nbsp;dropped&nbsp;one&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5486544">}</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486550">p</span><span class="op" id="5486551">.</span><span class="ident" id="5486552">writeByte</span><span class="op" id="5486561">(</span><span class="ident" id="5486562">ch</span><span class="op" id="5486564">,</span>&nbsp;<span class="ident" id="5486566">n</span><span class="op" id="5486567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486573">impliedSemi</span>&nbsp;<span class="op" id="5486585">=</span>&nbsp;<span class="builtintype" id="5486587">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5486596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5486600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5486605">//&nbsp;the&nbsp;next&nbsp;token&nbsp;starts&nbsp;now&nbsp;-&nbsp;record&nbsp;its&nbsp;line&nbsp;number&nbsp;if&nbsp;requested</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486674">if</span>&nbsp;<span class="ident" id="5486677">p</span><span class="op" id="5486678">.</span><span class="ident" id="5486679">linePtr</span>&nbsp;<span class="op" id="5486687">!=</span>&nbsp;<span class="ident" id="5486690">nil</span>&nbsp;<span class="op" id="5486694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5486699">*</span><span class="ident" id="5486700">p</span><span class="op" id="5486701">.</span><span class="ident" id="5486702">linePtr</span>&nbsp;<span class="op" id="5486710">=</span>&nbsp;<span class="ident" id="5486712">p</span><span class="op" id="5486713">.</span><span class="ident" id="5486714">out</span><span class="op" id="5486717">.</span><span class="ident" id="5486718">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486726">p</span><span class="op" id="5486727">.</span><span class="ident" id="5486728">linePtr</span>&nbsp;<span class="op" id="5486736">=</span>&nbsp;<span class="ident" id="5486738">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5486744">}</span><br>
<span class="lineno">970</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486749">p</span><span class="op" id="5486750">.</span><span class="ident" id="5486751">writeString</span><span class="op" id="5486762">(</span><span class="ident" id="5486763">next</span><span class="op" id="5486767">,</span>&nbsp;<span class="ident" id="5486769">data</span><span class="op" id="5486773">,</span>&nbsp;<span class="ident" id="5486775">isLit</span><span class="op" id="5486780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486784">p</span><span class="op" id="5486785">.</span><span class="ident" id="5486786">impliedSemi</span>&nbsp;<span class="op" id="5486798">=</span>&nbsp;<span class="ident" id="5486800">impliedSemi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5486813">}</span><br>
<span class="lineno"></span><span class="op" id="5486815">}</span><br>
<span class="lineno">975</span><br>
<span class="lineno"></span><span class="comment" id="5486818">//&nbsp;flush&nbsp;prints&nbsp;any&nbsp;pending&nbsp;comments&nbsp;and&nbsp;whitespace&nbsp;occurring&nbsp;textually</span><br>
<span class="lineno"></span><span class="comment" id="5486890">//&nbsp;before&nbsp;the&nbsp;position&nbsp;of&nbsp;the&nbsp;next&nbsp;token&nbsp;tok.&nbsp;The&nbsp;flush&nbsp;result&nbsp;indicates</span><br>
<span class="lineno"></span><span class="comment" id="5486963">//&nbsp;if&nbsp;a&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="5487040">//&nbsp;buffer.</span><br>
<span class="lineno">980</span><span class="comment" id="5487051">//</span><br>
<span class="lineno"></span><span class="keyword" id="5487054">func</span>&nbsp;<span class="op" id="5487059">(</span><span class="ident" id="5487060">p</span>&nbsp;<span class="op" id="5487062">*</span><span class="ident" id="5487063">printer</span><span class="op" id="5487070">)</span>&nbsp;<span class="ident" id="5487072">flush</span><span class="op" id="5487077">(</span><span class="ident" id="5487078">next</span>&nbsp;<span class="ident" id="5487083">token</span><span class="op" id="5487088">.</span><span class="ident" id="5487089">Position</span><span class="op" id="5487097">,</span>&nbsp;<span class="ident" id="5487099">tok</span>&nbsp;<span class="ident" id="5487103">token</span><span class="op" id="5487108">.</span><span class="ident" id="5487109">Token</span><span class="op" id="5487114">)</span>&nbsp;<span class="op" id="5487116">(</span><span class="ident" id="5487117">wroteNewline</span><span class="op" id="5487129">,</span>&nbsp;<span class="ident" id="5487131">droppedFF</span>&nbsp;<span class="builtintype" id="5487141">bool</span><span class="op" id="5487145">)</span>&nbsp;<span class="op" id="5487147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487150">if</span>&nbsp;<span class="ident" id="5487153">p</span><span class="op" id="5487154">.</span><span class="ident" id="5487155">commentBefore</span><span class="op" id="5487168">(</span><span class="ident" id="5487169">next</span><span class="op" id="5487173">)</span>&nbsp;<span class="op" id="5487175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5487179">//&nbsp;if&nbsp;there&nbsp;are&nbsp;comments&nbsp;before&nbsp;the&nbsp;next&nbsp;item,&nbsp;intersperse&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487245">wroteNewline</span><span class="op" id="5487257">,</span>&nbsp;<span class="ident" id="5487259">droppedFF</span>&nbsp;<span class="op" id="5487269">=</span>&nbsp;<span class="ident" id="5487271">p</span><span class="op" id="5487272">.</span><span class="ident" id="5487273">intersperseComments</span><span class="op" id="5487292">(</span><span class="ident" id="5487293">next</span><span class="op" id="5487297">,</span>&nbsp;<span class="ident" id="5487299">tok</span><span class="op" id="5487302">)</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5487305">}</span>&nbsp;<span class="keyword" id="5487307">else</span>&nbsp;<span class="op" id="5487312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5487316">//&nbsp;otherwise,&nbsp;write&nbsp;any&nbsp;leftover&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487362">p</span><span class="op" id="5487363">.</span><span class="ident" id="5487364">writeWhitespace</span><span class="op" id="5487379">(</span><span class="builtinfunc" id="5487380">len</span><span class="op" id="5487383">(</span><span class="ident" id="5487384">p</span><span class="op" id="5487385">.</span><span class="ident" id="5487386">wsbuf</span><span class="op" id="5487391">)</span><span class="op" id="5487392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5487395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487398">return</span><br>
<span class="lineno">990</span><span class="op" id="5487405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5487408">//&nbsp;getNode&nbsp;returns&nbsp;the&nbsp;ast.CommentGroup&nbsp;associated&nbsp;with&nbsp;n,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="5487475">func</span>&nbsp;<span class="ident" id="5487480">getDoc</span><span class="op" id="5487486">(</span><span class="ident" id="5487487">n</span>&nbsp;<span class="ident" id="5487489">ast</span><span class="op" id="5487492">.</span><span class="ident" id="5487493">Node</span><span class="op" id="5487497">)</span>&nbsp;<span class="op" id="5487499">*</span><span class="ident" id="5487500">ast</span><span class="op" id="5487503">.</span><span class="ident" id="5487504">CommentGroup</span>&nbsp;<span class="op" id="5487517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487520">switch</span>&nbsp;<span class="ident" id="5487527">n</span>&nbsp;<span class="op" id="5487529">:=</span>&nbsp;<span class="ident" id="5487532">n</span><span class="op" id="5487533">.</span><span class="op" id="5487534">(</span><span class="keyword" id="5487535">type</span><span class="op" id="5487539">)</span>&nbsp;<span class="op" id="5487541">{</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487544">case</span>&nbsp;<span class="op" id="5487549">*</span><span class="ident" id="5487550">ast</span><span class="op" id="5487553">.</span><span class="ident" id="5487554">Field</span><span class="op" id="5487559">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487563">return</span>&nbsp;<span class="ident" id="5487570">n</span><span class="op" id="5487571">.</span><span class="ident" id="5487572">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487577">case</span>&nbsp;<span class="op" id="5487582">*</span><span class="ident" id="5487583">ast</span><span class="op" id="5487586">.</span><span class="ident" id="5487587">ImportSpec</span><span class="op" id="5487597">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487601">return</span>&nbsp;<span class="ident" id="5487608">n</span><span class="op" id="5487609">.</span><span class="ident" id="5487610">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487615">case</span>&nbsp;<span class="op" id="5487620">*</span><span class="ident" id="5487621">ast</span><span class="op" id="5487624">.</span><span class="ident" id="5487625">ValueSpec</span><span class="op" id="5487634">:</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487638">return</span>&nbsp;<span class="ident" id="5487645">n</span><span class="op" id="5487646">.</span><span class="ident" id="5487647">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487652">case</span>&nbsp;<span class="op" id="5487657">*</span><span class="ident" id="5487658">ast</span><span class="op" id="5487661">.</span><span class="ident" id="5487662">TypeSpec</span><span class="op" id="5487670">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487674">return</span>&nbsp;<span class="ident" id="5487681">n</span><span class="op" id="5487682">.</span><span class="ident" id="5487683">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487688">case</span>&nbsp;<span class="op" id="5487693">*</span><span class="ident" id="5487694">ast</span><span class="op" id="5487697">.</span><span class="ident" id="5487698">GenDecl</span><span class="op" id="5487705">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487709">return</span>&nbsp;<span class="ident" id="5487716">n</span><span class="op" id="5487717">.</span><span class="ident" id="5487718">Doc</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487723">case</span>&nbsp;<span class="op" id="5487728">*</span><span class="ident" id="5487729">ast</span><span class="op" id="5487732">.</span><span class="ident" id="5487733">FuncDecl</span><span class="op" id="5487741">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487745">return</span>&nbsp;<span class="ident" id="5487752">n</span><span class="op" id="5487753">.</span><span class="ident" id="5487754">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487759">case</span>&nbsp;<span class="op" id="5487764">*</span><span class="ident" id="5487765">ast</span><span class="op" id="5487768">.</span><span class="ident" id="5487769">File</span><span class="op" id="5487773">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487777">return</span>&nbsp;<span class="ident" id="5487784">n</span><span class="op" id="5487785">.</span><span class="ident" id="5487786">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5487791">}</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487794">return</span>&nbsp;<span class="ident" id="5487801">nil</span><br>
<span class="lineno"></span><span class="op" id="5487805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5487808">func</span>&nbsp;<span class="op" id="5487813">(</span><span class="ident" id="5487814">p</span>&nbsp;<span class="op" id="5487816">*</span><span class="ident" id="5487817">printer</span><span class="op" id="5487824">)</span>&nbsp;<span class="ident" id="5487826">printNode</span><span class="op" id="5487835">(</span><span class="ident" id="5487836">node</span>&nbsp;<span class="keyword" id="5487841">interface</span><span class="op" id="5487850">{</span><span class="op" id="5487851">}</span><span class="op" id="5487852">)</span>&nbsp;<span class="builtintype" id="5487854">error</span>&nbsp;<span class="op" id="5487860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5487863">//&nbsp;unpack&nbsp;*CommentedNode,&nbsp;if&nbsp;any</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487897">var</span>&nbsp;<span class="ident" id="5487901">comments</span>&nbsp;<span class="op" id="5487910">[</span><span class="op" id="5487911">]</span><span class="op" id="5487912">*</span><span class="ident" id="5487913">ast</span><span class="op" id="5487916">.</span><span class="ident" id="5487917">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487931">if</span>&nbsp;<span class="ident" id="5487934">cnode</span><span class="op" id="5487939">,</span>&nbsp;<span class="ident" id="5487941">ok</span>&nbsp;<span class="op" id="5487944">:=</span>&nbsp;<span class="ident" id="5487947">node</span><span class="op" id="5487951">.</span><span class="op" id="5487952">(</span><span class="op" id="5487953">*</span><span class="ident" id="5487954">CommentedNode</span><span class="op" id="5487967">)</span><span class="op" id="5487968">;</span>&nbsp;<span class="ident" id="5487970">ok</span>&nbsp;<span class="op" id="5487973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487977">node</span>&nbsp;<span class="op" id="5487982">=</span>&nbsp;<span class="ident" id="5487984">cnode</span><span class="op" id="5487989">.</span><span class="ident" id="5487990">Node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487997">comments</span>&nbsp;<span class="op" id="5488006">=</span>&nbsp;<span class="ident" id="5488008">cnode</span><span class="op" id="5488013">.</span><span class="ident" id="5488014">Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5488024">}</span><br>
<span class="lineno">1020</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488028">if</span>&nbsp;<span class="ident" id="5488031">comments</span>&nbsp;<span class="op" id="5488040">!=</span>&nbsp;<span class="ident" id="5488043">nil</span>&nbsp;<span class="op" id="5488047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5488051">//&nbsp;commented&nbsp;node&nbsp;-&nbsp;restrict&nbsp;comment&nbsp;list&nbsp;to&nbsp;relevant&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488113">n</span><span class="op" id="5488114">,</span>&nbsp;<span class="ident" id="5488116">ok</span>&nbsp;<span class="op" id="5488119">:=</span>&nbsp;<span class="ident" id="5488122">node</span><span class="op" id="5488126">.</span><span class="op" id="5488127">(</span><span class="ident" id="5488128">ast</span><span class="op" id="5488131">.</span><span class="ident" id="5488132">Node</span><span class="op" id="5488136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488140">if</span>&nbsp;<span class="op" id="5488143">!</span><span class="ident" id="5488144">ok</span>&nbsp;<span class="op" id="5488147">{</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488152">goto</span>&nbsp;<span class="ident" id="5488157">unsupported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5488171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488175">beg</span>&nbsp;<span class="op" id="5488179">:=</span>&nbsp;<span class="ident" id="5488182">n</span><span class="op" id="5488183">.</span><span class="ident" id="5488184">Pos</span><span class="op" id="5488187">(</span><span class="op" id="5488188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488192">end</span>&nbsp;<span class="op" id="5488196">:=</span>&nbsp;<span class="ident" id="5488199">n</span><span class="op" id="5488200">.</span><span class="ident" id="5488201">End</span><span class="op" id="5488204">(</span><span class="op" id="5488205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5488209">//&nbsp;if&nbsp;the&nbsp;node&nbsp;has&nbsp;associated&nbsp;documentation,</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5488256">//&nbsp;include&nbsp;that&nbsp;commentgroup&nbsp;in&nbsp;the&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5488300">//&nbsp;(the&nbsp;comment&nbsp;list&nbsp;is&nbsp;sorted&nbsp;in&nbsp;the&nbsp;order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5488346">//&nbsp;of&nbsp;the&nbsp;comment&nbsp;appearance&nbsp;in&nbsp;the&nbsp;source&nbsp;code)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488397">if</span>&nbsp;<span class="ident" id="5488400">doc</span>&nbsp;<span class="op" id="5488404">:=</span>&nbsp;<span class="ident" id="5488407">getDoc</span><span class="op" id="5488413">(</span><span class="ident" id="5488414">n</span><span class="op" id="5488415">)</span><span class="op" id="5488416">;</span>&nbsp;<span class="ident" id="5488418">doc</span>&nbsp;<span class="op" id="5488422">!=</span>&nbsp;<span class="ident" id="5488425">nil</span>&nbsp;<span class="op" id="5488429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488434">beg</span>&nbsp;<span class="op" id="5488438">=</span>&nbsp;<span class="ident" id="5488440">doc</span><span class="op" id="5488443">.</span><span class="ident" id="5488444">Pos</span><span class="op" id="5488447">(</span><span class="op" id="5488448">)</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5488452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5488456">//&nbsp;token.Pos&nbsp;values&nbsp;are&nbsp;global&nbsp;offsets,&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5488505">//&nbsp;compare&nbsp;them&nbsp;directly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488532">i</span>&nbsp;<span class="op" id="5488534">:=</span>&nbsp;<span class="num" id="5488537">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488541">for</span>&nbsp;<span class="ident" id="5488545">i</span>&nbsp;<span class="op" id="5488547">&lt;</span>&nbsp;<span class="builtinfunc" id="5488549">len</span><span class="op" id="5488552">(</span><span class="ident" id="5488553">comments</span><span class="op" id="5488561">)</span>&nbsp;<span class="op" id="5488563">&amp;&amp;</span>&nbsp;<span class="ident" id="5488566">comments</span><span class="op" id="5488574">[</span><span class="ident" id="5488575">i</span><span class="op" id="5488576">]</span><span class="op" id="5488577">.</span><span class="ident" id="5488578">End</span><span class="op" id="5488581">(</span><span class="op" id="5488582">)</span>&nbsp;<span class="op" id="5488584">&lt;</span>&nbsp;<span class="ident" id="5488586">beg</span>&nbsp;<span class="op" id="5488590">{</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488595">i</span><span class="op" id="5488596">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5488601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488605">j</span>&nbsp;<span class="op" id="5488607">:=</span>&nbsp;<span class="ident" id="5488610">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488614">for</span>&nbsp;<span class="ident" id="5488618">j</span>&nbsp;<span class="op" id="5488620">&lt;</span>&nbsp;<span class="builtinfunc" id="5488622">len</span><span class="op" id="5488625">(</span><span class="ident" id="5488626">comments</span><span class="op" id="5488634">)</span>&nbsp;<span class="op" id="5488636">&amp;&amp;</span>&nbsp;<span class="ident" id="5488639">comments</span><span class="op" id="5488647">[</span><span class="ident" id="5488648">j</span><span class="op" id="5488649">]</span><span class="op" id="5488650">.</span><span class="ident" id="5488651">Pos</span><span class="op" id="5488654">(</span><span class="op" id="5488655">)</span>&nbsp;<span class="op" id="5488657">&lt;</span>&nbsp;<span class="ident" id="5488659">end</span>&nbsp;<span class="op" id="5488663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488668">j</span><span class="op" id="5488669">++</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5488674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488678">if</span>&nbsp;<span class="ident" id="5488681">i</span>&nbsp;<span class="op" id="5488683">&lt;</span>&nbsp;<span class="ident" id="5488685">j</span>&nbsp;<span class="op" id="5488687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488692">p</span><span class="op" id="5488693">.</span><span class="ident" id="5488694">comments</span>&nbsp;<span class="op" id="5488703">=</span>&nbsp;<span class="ident" id="5488705">comments</span><span class="op" id="5488713">[</span><span class="ident" id="5488714">i</span><span class="op" id="5488715">:</span><span class="ident" id="5488716">j</span><span class="op" id="5488717">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5488721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5488724">}</span>&nbsp;<span class="keyword" id="5488726">else</span>&nbsp;<span class="keyword" id="5488731">if</span>&nbsp;<span class="ident" id="5488734">n</span><span class="op" id="5488735">,</span>&nbsp;<span class="ident" id="5488737">ok</span>&nbsp;<span class="op" id="5488740">:=</span>&nbsp;<span class="ident" id="5488743">node</span><span class="op" id="5488747">.</span><span class="op" id="5488748">(</span><span class="op" id="5488749">*</span><span class="ident" id="5488750">ast</span><span class="op" id="5488753">.</span><span class="ident" id="5488754">File</span><span class="op" id="5488758">)</span><span class="op" id="5488759">;</span>&nbsp;<span class="ident" id="5488761">ok</span>&nbsp;<span class="op" id="5488764">{</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5488768">//&nbsp;use&nbsp;ast.File&nbsp;comments,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488803">p</span><span class="op" id="5488804">.</span><span class="ident" id="5488805">comments</span>&nbsp;<span class="op" id="5488814">=</span>&nbsp;<span class="ident" id="5488816">n</span><span class="op" id="5488817">.</span><span class="ident" id="5488818">Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5488828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5488832">//&nbsp;if&nbsp;there&nbsp;are&nbsp;no&nbsp;comments,&nbsp;use&nbsp;node&nbsp;comments</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488880">p</span><span class="op" id="5488881">.</span><span class="ident" id="5488882">useNodeComments</span>&nbsp;<span class="op" id="5488898">=</span>&nbsp;<span class="ident" id="5488900">p</span><span class="op" id="5488901">.</span><span class="ident" id="5488902">comments</span>&nbsp;<span class="op" id="5488911">==</span>&nbsp;<span class="ident" id="5488914">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5488920">//&nbsp;get&nbsp;comments&nbsp;ready&nbsp;for&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488951">p</span><span class="op" id="5488952">.</span><span class="ident" id="5488953">nextComment</span><span class="op" id="5488964">(</span><span class="op" id="5488965">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5488969">//&nbsp;format&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488985">switch</span>&nbsp;<span class="ident" id="5488992">n</span>&nbsp;<span class="op" id="5488994">:=</span>&nbsp;<span class="ident" id="5488997">node</span><span class="op" id="5489001">.</span><span class="op" id="5489002">(</span><span class="keyword" id="5489003">type</span><span class="op" id="5489007">)</span>&nbsp;<span class="op" id="5489009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489012">case</span>&nbsp;<span class="ident" id="5489017">ast</span><span class="op" id="5489020">.</span><span class="ident" id="5489021">Expr</span><span class="op" id="5489025">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489029">p</span><span class="op" id="5489030">.</span><span class="ident" id="5489031">expr</span><span class="op" id="5489035">(</span><span class="ident" id="5489036">n</span><span class="op" id="5489037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489040">case</span>&nbsp;<span class="ident" id="5489045">ast</span><span class="op" id="5489048">.</span><span class="ident" id="5489049">Stmt</span><span class="op" id="5489053">:</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5489057">//&nbsp;A&nbsp;labeled&nbsp;statement&nbsp;will&nbsp;un-indent&nbsp;to&nbsp;position&nbsp;the&nbsp;label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5489120">//&nbsp;Set&nbsp;p.indent&nbsp;to&nbsp;1&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;indent&nbsp;&#34;underflow&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489179">if</span>&nbsp;<span class="ident" id="5489182">_</span><span class="op" id="5489183">,</span>&nbsp;<span class="ident" id="5489185">ok</span>&nbsp;<span class="op" id="5489188">:=</span>&nbsp;<span class="ident" id="5489191">n</span><span class="op" id="5489192">.</span><span class="op" id="5489193">(</span><span class="op" id="5489194">*</span><span class="ident" id="5489195">ast</span><span class="op" id="5489198">.</span><span class="ident" id="5489199">LabeledStmt</span><span class="op" id="5489210">)</span><span class="op" id="5489211">;</span>&nbsp;<span class="ident" id="5489213">ok</span>&nbsp;<span class="op" id="5489216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489221">p</span><span class="op" id="5489222">.</span><span class="ident" id="5489223">indent</span>&nbsp;<span class="op" id="5489230">=</span>&nbsp;<span class="num" id="5489232">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5489236">}</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489240">p</span><span class="op" id="5489241">.</span><span class="ident" id="5489242">stmt</span><span class="op" id="5489246">(</span><span class="ident" id="5489247">n</span><span class="op" id="5489248">,</span>&nbsp;<span class="builtintype" id="5489250">false</span><span class="op" id="5489255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489258">case</span>&nbsp;<span class="ident" id="5489263">ast</span><span class="op" id="5489266">.</span><span class="ident" id="5489267">Decl</span><span class="op" id="5489271">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489275">p</span><span class="op" id="5489276">.</span><span class="ident" id="5489277">decl</span><span class="op" id="5489281">(</span><span class="ident" id="5489282">n</span><span class="op" id="5489283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489286">case</span>&nbsp;<span class="ident" id="5489291">ast</span><span class="op" id="5489294">.</span><span class="ident" id="5489295">Spec</span><span class="op" id="5489299">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489303">p</span><span class="op" id="5489304">.</span><span class="ident" id="5489305">spec</span><span class="op" id="5489309">(</span><span class="ident" id="5489310">n</span><span class="op" id="5489311">,</span>&nbsp;<span class="num" id="5489313">1</span><span class="op" id="5489314">,</span>&nbsp;<span class="builtintype" id="5489316">false</span><span class="op" id="5489321">)</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489324">case</span>&nbsp;<span class="op" id="5489329">[</span><span class="op" id="5489330">]</span><span class="ident" id="5489331">ast</span><span class="op" id="5489334">.</span><span class="ident" id="5489335">Stmt</span><span class="op" id="5489339">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5489343">//&nbsp;A&nbsp;labeled&nbsp;statement&nbsp;will&nbsp;un-indent&nbsp;to&nbsp;position&nbsp;the&nbsp;label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5489406">//&nbsp;Set&nbsp;p.indent&nbsp;to&nbsp;1&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;indent&nbsp;&#34;underflow&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489465">for</span>&nbsp;<span class="ident" id="5489469">_</span><span class="op" id="5489470">,</span>&nbsp;<span class="ident" id="5489472">s</span>&nbsp;<span class="op" id="5489474">:=</span>&nbsp;<span class="keyword" id="5489477">range</span>&nbsp;<span class="ident" id="5489483">n</span>&nbsp;<span class="op" id="5489485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489490">if</span>&nbsp;<span class="ident" id="5489493">_</span><span class="op" id="5489494">,</span>&nbsp;<span class="ident" id="5489496">ok</span>&nbsp;<span class="op" id="5489499">:=</span>&nbsp;<span class="ident" id="5489502">s</span><span class="op" id="5489503">.</span><span class="op" id="5489504">(</span><span class="op" id="5489505">*</span><span class="ident" id="5489506">ast</span><span class="op" id="5489509">.</span><span class="ident" id="5489510">LabeledStmt</span><span class="op" id="5489521">)</span><span class="op" id="5489522">;</span>&nbsp;<span class="ident" id="5489524">ok</span>&nbsp;<span class="op" id="5489527">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489533">p</span><span class="op" id="5489534">.</span><span class="ident" id="5489535">indent</span>&nbsp;<span class="op" id="5489542">=</span>&nbsp;<span class="num" id="5489544">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5489549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5489553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489557">p</span><span class="op" id="5489558">.</span><span class="ident" id="5489559">stmtList</span><span class="op" id="5489567">(</span><span class="ident" id="5489568">n</span><span class="op" id="5489569">,</span>&nbsp;<span class="num" id="5489571">0</span><span class="op" id="5489572">,</span>&nbsp;<span class="builtintype" id="5489574">false</span><span class="op" id="5489579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489582">case</span>&nbsp;<span class="op" id="5489587">[</span><span class="op" id="5489588">]</span><span class="ident" id="5489589">ast</span><span class="op" id="5489592">.</span><span class="ident" id="5489593">Decl</span><span class="op" id="5489597">:</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489601">p</span><span class="op" id="5489602">.</span><span class="ident" id="5489603">declList</span><span class="op" id="5489611">(</span><span class="ident" id="5489612">n</span><span class="op" id="5489613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489616">case</span>&nbsp;<span class="op" id="5489621">*</span><span class="ident" id="5489622">ast</span><span class="op" id="5489625">.</span><span class="ident" id="5489626">File</span><span class="op" id="5489630">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489634">p</span><span class="op" id="5489635">.</span><span class="ident" id="5489636">file</span><span class="op" id="5489640">(</span><span class="ident" id="5489641">n</span><span class="op" id="5489642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489645">default</span><span class="op" id="5489652">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489656">goto</span>&nbsp;<span class="ident" id="5489661">unsupported</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5489674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489678">return</span>&nbsp;<span class="ident" id="5489685">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="5489690">unsupported</span><span class="op" id="5489701">:</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489704">return</span>&nbsp;<span class="ident" id="5489711">fmt</span><span class="op" id="5489714">.</span><span class="ident" id="5489715">Errorf</span><span class="op" id="5489721">(</span><span class="string" id="5489722">&#34;go/printer:&nbsp;unsupported&nbsp;node&nbsp;type&nbsp;%T&#34;</span><span class="op" id="5489760">,</span>&nbsp;<span class="ident" id="5489762">node</span><span class="op" id="5489766">)</span><br>
<span class="lineno"></span><span class="op" id="5489768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5489771">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5489851">//&nbsp;Trimmer</span><br>
<span class="lineno">1100</span><br>
<span class="lineno"></span><span class="comment" id="5489863">//&nbsp;A&nbsp;trimmer&nbsp;is&nbsp;an&nbsp;io.Writer&nbsp;filter&nbsp;for&nbsp;stripping&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span><span class="comment" id="5489930">//&nbsp;characters,&nbsp;trailing&nbsp;blanks&nbsp;and&nbsp;tabs,&nbsp;and&nbsp;for&nbsp;converting&nbsp;formfeed</span><br>
<span class="lineno"></span><span class="comment" id="5489999">//&nbsp;and&nbsp;vtab&nbsp;characters&nbsp;into&nbsp;newlines&nbsp;and&nbsp;htabs&nbsp;(in&nbsp;case&nbsp;no&nbsp;tabwriter</span><br>
<span class="lineno"></span><span class="comment" id="5490068">//&nbsp;is&nbsp;used).&nbsp;Text&nbsp;bracketed&nbsp;by&nbsp;tabwriter.Escape&nbsp;characters&nbsp;is&nbsp;passed</span><br>
<span class="lineno">1105</span><span class="comment" id="5490137">//&nbsp;through&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="comment" id="5490159">//</span><br>
<span class="lineno"></span><span class="keyword" id="5490162">type</span>&nbsp;<span class="ident" id="5490167">trimmer</span>&nbsp;<span class="keyword" id="5490175">struct</span>&nbsp;<span class="op" id="5490182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490185">output</span>&nbsp;<span class="ident" id="5490192">io</span><span class="op" id="5490194">.</span><span class="ident" id="5490195">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490203">state</span>&nbsp;&nbsp;<span class="builtintype" id="5490210">int</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490215">space</span>&nbsp;&nbsp;<span class="op" id="5490222">[</span><span class="op" id="5490223">]</span><span class="builtintype" id="5490224">byte</span><br>
<span class="lineno"></span><span class="op" id="5490229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5490232">//&nbsp;trimmer&nbsp;is&nbsp;implemented&nbsp;as&nbsp;a&nbsp;state&nbsp;machine.</span><br>
<span class="lineno"></span><span class="comment" id="5490278">//&nbsp;It&nbsp;can&nbsp;be&nbsp;in&nbsp;one&nbsp;of&nbsp;the&nbsp;following&nbsp;states:</span><br>
<span class="lineno">1115</span><span class="keyword" id="5490323">const</span>&nbsp;<span class="op" id="5490329">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490332">inSpace</span>&nbsp;&nbsp;<span class="op" id="5490341">=</span>&nbsp;<span class="ident" id="5490343">iota</span>&nbsp;<span class="comment" id="5490348">//&nbsp;inside&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490365">inEscape</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5490381">//&nbsp;inside&nbsp;text&nbsp;bracketed&nbsp;by&nbsp;tabwriter.Escapes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490428">inText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5490444">//&nbsp;inside&nbsp;text</span><br>
<span class="lineno"></span><span class="op" id="5490459">)</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span><span class="keyword" id="5490462">func</span>&nbsp;<span class="op" id="5490467">(</span><span class="ident" id="5490468">p</span>&nbsp;<span class="op" id="5490470">*</span><span class="ident" id="5490471">trimmer</span><span class="op" id="5490478">)</span>&nbsp;<span class="ident" id="5490480">resetSpace</span><span class="op" id="5490490">(</span><span class="op" id="5490491">)</span>&nbsp;<span class="op" id="5490493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490496">p</span><span class="op" id="5490497">.</span><span class="ident" id="5490498">state</span>&nbsp;<span class="op" id="5490504">=</span>&nbsp;<span class="ident" id="5490506">inSpace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490515">p</span><span class="op" id="5490516">.</span><span class="ident" id="5490517">space</span>&nbsp;<span class="op" id="5490523">=</span>&nbsp;<span class="ident" id="5490525">p</span><span class="op" id="5490526">.</span><span class="ident" id="5490527">space</span><span class="op" id="5490532">[</span><span class="num" id="5490533">0</span><span class="op" id="5490534">:</span><span class="num" id="5490535">0</span><span class="op" id="5490536">]</span><br>
<span class="lineno"></span><span class="op" id="5490538">}</span><br>
<span class="lineno">1125</span><br>
<span class="lineno"></span><span class="comment" id="5490541">//&nbsp;Design&nbsp;note:&nbsp;It&nbsp;is&nbsp;tempting&nbsp;to&nbsp;eliminate&nbsp;extra&nbsp;blanks&nbsp;occurring&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5490611">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;whitespace&nbsp;in&nbsp;this&nbsp;function&nbsp;as&nbsp;it&nbsp;could&nbsp;simplify&nbsp;some</span><br>
<span class="lineno"></span><span class="comment" id="5490681">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;of&nbsp;the&nbsp;blanks&nbsp;logic&nbsp;in&nbsp;the&nbsp;node&nbsp;printing&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="5490749">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;However,&nbsp;this&nbsp;would&nbsp;mess&nbsp;up&nbsp;any&nbsp;formatting&nbsp;done&nbsp;by</span><br>
<span class="lineno">1130</span><span class="comment" id="5490816">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;tabwriter.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5490848">var</span>&nbsp;<span class="ident" id="5490852">aNewline</span>&nbsp;<span class="op" id="5490861">=</span>&nbsp;<span class="op" id="5490863">[</span><span class="op" id="5490864">]</span><span class="builtintype" id="5490865">byte</span><span class="op" id="5490869">(</span><span class="string" id="5490870">&#34;\n&#34;</span><span class="op" id="5490874">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5490877">func</span>&nbsp;<span class="op" id="5490882">(</span><span class="ident" id="5490883">p</span>&nbsp;<span class="op" id="5490885">*</span><span class="ident" id="5490886">trimmer</span><span class="op" id="5490893">)</span>&nbsp;<span class="ident" id="5490895">Write</span><span class="op" id="5490900">(</span><span class="ident" id="5490901">data</span>&nbsp;<span class="op" id="5490906">[</span><span class="op" id="5490907">]</span><span class="builtintype" id="5490908">byte</span><span class="op" id="5490912">)</span>&nbsp;<span class="op" id="5490914">(</span><span class="ident" id="5490915">n</span>&nbsp;<span class="builtintype" id="5490917">int</span><span class="op" id="5490920">,</span>&nbsp;<span class="ident" id="5490922">err</span>&nbsp;<span class="builtintype" id="5490926">error</span><span class="op" id="5490931">)</span>&nbsp;<span class="op" id="5490933">{</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5490936">//&nbsp;invariants:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5490952">//&nbsp;p.state&nbsp;==&nbsp;inSpace:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5490976">//&nbsp;&nbsp;&nbsp;&nbspp.space&nbsp;is&nbsp;unwritten</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5491001">//&nbsp;p.state&nbsp;==&nbsp;inEscape,&nbsp;inText:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5491034">//&nbsp;&nbsp;&nbsp;&nbspdata[m:n]&nbsp;is&nbsp;unwritten</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491061">m</span>&nbsp;<span class="op" id="5491063">:=</span>&nbsp;<span class="num" id="5491066">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491069">var</span>&nbsp;<span class="ident" id="5491073">b</span>&nbsp;<span class="builtintype" id="5491075">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491081">for</span>&nbsp;<span class="ident" id="5491085">n</span><span class="op" id="5491086">,</span>&nbsp;<span class="ident" id="5491088">b</span>&nbsp;<span class="op" id="5491090">=</span>&nbsp;<span class="keyword" id="5491092">range</span>&nbsp;<span class="ident" id="5491098">data</span>&nbsp;<span class="op" id="5491103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491107">if</span>&nbsp;<span class="ident" id="5491110">b</span>&nbsp;<span class="op" id="5491112">==</span>&nbsp;<span class="string" id="5491115">&#39;\v&#39;</span>&nbsp;<span class="op" id="5491120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491125">b</span>&nbsp;<span class="op" id="5491127">=</span>&nbsp;<span class="string" id="5491129">&#39;\t&#39;</span>&nbsp;<span class="comment" id="5491134">//&nbsp;convert&nbsp;to&nbsp;htab</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5491155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491159">switch</span>&nbsp;<span class="ident" id="5491166">p</span><span class="op" id="5491167">.</span><span class="ident" id="5491168">state</span>&nbsp;<span class="op" id="5491174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491178">case</span>&nbsp;<span class="ident" id="5491183">inSpace</span><span class="op" id="5491190">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491195">switch</span>&nbsp;<span class="ident" id="5491202">b</span>&nbsp;<span class="op" id="5491204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491209">case</span>&nbsp;<span class="string" id="5491214">&#39;\t&#39;</span><span class="op" id="5491218">,</span>&nbsp;<span class="string" id="5491220">&#39;&nbsp;&#39;</span><span class="op" id="5491223">:</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491229">p</span><span class="op" id="5491230">.</span><span class="ident" id="5491231">space</span>&nbsp;<span class="op" id="5491237">=</span>&nbsp;<span class="builtinfunc" id="5491239">append</span><span class="op" id="5491245">(</span><span class="ident" id="5491246">p</span><span class="op" id="5491247">.</span><span class="ident" id="5491248">space</span><span class="op" id="5491253">,</span>&nbsp;<span class="ident" id="5491255">b</span><span class="op" id="5491256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491261">case</span>&nbsp;<span class="string" id="5491266">&#39;\n&#39;</span><span class="op" id="5491270">,</span>&nbsp;<span class="string" id="5491272">&#39;\f&#39;</span><span class="op" id="5491276">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491282">p</span><span class="op" id="5491283">.</span><span class="ident" id="5491284">resetSpace</span><span class="op" id="5491294">(</span><span class="op" id="5491295">)</span>&nbsp;<span class="comment" id="5491297">//&nbsp;discard&nbsp;trailing&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491327">_</span><span class="op" id="5491328">,</span>&nbsp;<span class="ident" id="5491330">err</span>&nbsp;<span class="op" id="5491334">=</span>&nbsp;<span class="ident" id="5491336">p</span><span class="op" id="5491337">.</span><span class="ident" id="5491338">output</span><span class="op" id="5491344">.</span><span class="ident" id="5491345">Write</span><span class="op" id="5491350">(</span><span class="ident" id="5491351">aNewline</span><span class="op" id="5491359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491364">case</span>&nbsp;<span class="ident" id="5491369">tabwriter</span><span class="op" id="5491378">.</span><span class="ident" id="5491379">Escape</span><span class="op" id="5491385">:</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491391">_</span><span class="op" id="5491392">,</span>&nbsp;<span class="ident" id="5491394">err</span>&nbsp;<span class="op" id="5491398">=</span>&nbsp;<span class="ident" id="5491400">p</span><span class="op" id="5491401">.</span><span class="ident" id="5491402">output</span><span class="op" id="5491408">.</span><span class="ident" id="5491409">Write</span><span class="op" id="5491414">(</span><span class="ident" id="5491415">p</span><span class="op" id="5491416">.</span><span class="ident" id="5491417">space</span><span class="op" id="5491422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491428">p</span><span class="op" id="5491429">.</span><span class="ident" id="5491430">state</span>&nbsp;<span class="op" id="5491436">=</span>&nbsp;<span class="ident" id="5491438">inEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491451">m</span>&nbsp;<span class="op" id="5491453">=</span>&nbsp;<span class="ident" id="5491455">n</span>&nbsp;<span class="op" id="5491457">+</span>&nbsp;<span class="num" id="5491459">1</span>&nbsp;<span class="comment" id="5491461">//&nbsp;+1:&nbsp;skip&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491493">default</span><span class="op" id="5491500">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491506">_</span><span class="op" id="5491507">,</span>&nbsp;<span class="ident" id="5491509">err</span>&nbsp;<span class="op" id="5491513">=</span>&nbsp;<span class="ident" id="5491515">p</span><span class="op" id="5491516">.</span><span class="ident" id="5491517">output</span><span class="op" id="5491523">.</span><span class="ident" id="5491524">Write</span><span class="op" id="5491529">(</span><span class="ident" id="5491530">p</span><span class="op" id="5491531">.</span><span class="ident" id="5491532">space</span><span class="op" id="5491537">)</span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491543">p</span><span class="op" id="5491544">.</span><span class="ident" id="5491545">state</span>&nbsp;<span class="op" id="5491551">=</span>&nbsp;<span class="ident" id="5491553">inText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491564">m</span>&nbsp;<span class="op" id="5491566">=</span>&nbsp;<span class="ident" id="5491568">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5491573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491577">case</span>&nbsp;<span class="ident" id="5491582">inEscape</span><span class="op" id="5491590">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491595">if</span>&nbsp;<span class="ident" id="5491598">b</span>&nbsp;<span class="op" id="5491600">==</span>&nbsp;<span class="ident" id="5491603">tabwriter</span><span class="op" id="5491612">.</span><span class="ident" id="5491613">Escape</span>&nbsp;<span class="op" id="5491620">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491626">_</span><span class="op" id="5491627">,</span>&nbsp;<span class="ident" id="5491629">err</span>&nbsp;<span class="op" id="5491633">=</span>&nbsp;<span class="ident" id="5491635">p</span><span class="op" id="5491636">.</span><span class="ident" id="5491637">output</span><span class="op" id="5491643">.</span><span class="ident" id="5491644">Write</span><span class="op" id="5491649">(</span><span class="ident" id="5491650">data</span><span class="op" id="5491654">[</span><span class="ident" id="5491655">m</span><span class="op" id="5491656">:</span><span class="ident" id="5491657">n</span><span class="op" id="5491658">]</span><span class="op" id="5491659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491665">p</span><span class="op" id="5491666">.</span><span class="ident" id="5491667">resetSpace</span><span class="op" id="5491677">(</span><span class="op" id="5491678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5491683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491687">case</span>&nbsp;<span class="ident" id="5491692">inText</span><span class="op" id="5491698">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491703">switch</span>&nbsp;<span class="ident" id="5491710">b</span>&nbsp;<span class="op" id="5491712">{</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491717">case</span>&nbsp;<span class="string" id="5491722">&#39;\t&#39;</span><span class="op" id="5491726">,</span>&nbsp;<span class="string" id="5491728">&#39;&nbsp;&#39;</span><span class="op" id="5491731">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491737">_</span><span class="op" id="5491738">,</span>&nbsp;<span class="ident" id="5491740">err</span>&nbsp;<span class="op" id="5491744">=</span>&nbsp;<span class="ident" id="5491746">p</span><span class="op" id="5491747">.</span><span class="ident" id="5491748">output</span><span class="op" id="5491754">.</span><span class="ident" id="5491755">Write</span><span class="op" id="5491760">(</span><span class="ident" id="5491761">data</span><span class="op" id="5491765">[</span><span class="ident" id="5491766">m</span><span class="op" id="5491767">:</span><span class="ident" id="5491768">n</span><span class="op" id="5491769">]</span><span class="op" id="5491770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491776">p</span><span class="op" id="5491777">.</span><span class="ident" id="5491778">resetSpace</span><span class="op" id="5491788">(</span><span class="op" id="5491789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491795">p</span><span class="op" id="5491796">.</span><span class="ident" id="5491797">space</span>&nbsp;<span class="op" id="5491803">=</span>&nbsp;<span class="builtinfunc" id="5491805">append</span><span class="op" id="5491811">(</span><span class="ident" id="5491812">p</span><span class="op" id="5491813">.</span><span class="ident" id="5491814">space</span><span class="op" id="5491819">,</span>&nbsp;<span class="ident" id="5491821">b</span><span class="op" id="5491822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491827">case</span>&nbsp;<span class="string" id="5491832">&#39;\n&#39;</span><span class="op" id="5491836">,</span>&nbsp;<span class="string" id="5491838">&#39;\f&#39;</span><span class="op" id="5491842">:</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491848">_</span><span class="op" id="5491849">,</span>&nbsp;<span class="ident" id="5491851">err</span>&nbsp;<span class="op" id="5491855">=</span>&nbsp;<span class="ident" id="5491857">p</span><span class="op" id="5491858">.</span><span class="ident" id="5491859">output</span><span class="op" id="5491865">.</span><span class="ident" id="5491866">Write</span><span class="op" id="5491871">(</span><span class="ident" id="5491872">data</span><span class="op" id="5491876">[</span><span class="ident" id="5491877">m</span><span class="op" id="5491878">:</span><span class="ident" id="5491879">n</span><span class="op" id="5491880">]</span><span class="op" id="5491881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491887">p</span><span class="op" id="5491888">.</span><span class="ident" id="5491889">resetSpace</span><span class="op" id="5491899">(</span><span class="op" id="5491900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491906">_</span><span class="op" id="5491907">,</span>&nbsp;<span class="ident" id="5491909">err</span>&nbsp;<span class="op" id="5491913">=</span>&nbsp;<span class="ident" id="5491915">p</span><span class="op" id="5491916">.</span><span class="ident" id="5491917">output</span><span class="op" id="5491923">.</span><span class="ident" id="5491924">Write</span><span class="op" id="5491929">(</span><span class="ident" id="5491930">aNewline</span><span class="op" id="5491938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491943">case</span>&nbsp;<span class="ident" id="5491948">tabwriter</span><span class="op" id="5491957">.</span><span class="ident" id="5491958">Escape</span><span class="op" id="5491964">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491970">_</span><span class="op" id="5491971">,</span>&nbsp;<span class="ident" id="5491973">err</span>&nbsp;<span class="op" id="5491977">=</span>&nbsp;<span class="ident" id="5491979">p</span><span class="op" id="5491980">.</span><span class="ident" id="5491981">output</span><span class="op" id="5491987">.</span><span class="ident" id="5491988">Write</span><span class="op" id="5491993">(</span><span class="ident" id="5491994">data</span><span class="op" id="5491998">[</span><span class="ident" id="5491999">m</span><span class="op" id="5492000">:</span><span class="ident" id="5492001">n</span><span class="op" id="5492002">]</span><span class="op" id="5492003">)</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492009">p</span><span class="op" id="5492010">.</span><span class="ident" id="5492011">state</span>&nbsp;<span class="op" id="5492017">=</span>&nbsp;<span class="ident" id="5492019">inEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492032">m</span>&nbsp;<span class="op" id="5492034">=</span>&nbsp;<span class="ident" id="5492036">n</span>&nbsp;<span class="op" id="5492038">+</span>&nbsp;<span class="num" id="5492040">1</span>&nbsp;<span class="comment" id="5492042">//&nbsp;+1:&nbsp;skip&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5492074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492078">default</span><span class="op" id="5492085">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5492090">panic</span><span class="op" id="5492095">(</span><span class="string" id="5492096">&#34;unreachable&#34;</span><span class="op" id="5492109">)</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5492113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492117">if</span>&nbsp;<span class="ident" id="5492120">err</span>&nbsp;<span class="op" id="5492124">!=</span>&nbsp;<span class="ident" id="5492127">nil</span>&nbsp;<span class="op" id="5492131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492136">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5492145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5492148">}</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492151">n</span>&nbsp;<span class="op" id="5492153">=</span>&nbsp;<span class="builtinfunc" id="5492155">len</span><span class="op" id="5492158">(</span><span class="ident" id="5492159">data</span><span class="op" id="5492163">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492167">switch</span>&nbsp;<span class="ident" id="5492174">p</span><span class="op" id="5492175">.</span><span class="ident" id="5492176">state</span>&nbsp;<span class="op" id="5492182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492185">case</span>&nbsp;<span class="ident" id="5492190">inEscape</span><span class="op" id="5492198">,</span>&nbsp;<span class="ident" id="5492200">inText</span><span class="op" id="5492206">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492210">_</span><span class="op" id="5492211">,</span>&nbsp;<span class="ident" id="5492213">err</span>&nbsp;<span class="op" id="5492217">=</span>&nbsp;<span class="ident" id="5492219">p</span><span class="op" id="5492220">.</span><span class="ident" id="5492221">output</span><span class="op" id="5492227">.</span><span class="ident" id="5492228">Write</span><span class="op" id="5492233">(</span><span class="ident" id="5492234">data</span><span class="op" id="5492238">[</span><span class="ident" id="5492239">m</span><span class="op" id="5492240">:</span><span class="ident" id="5492241">n</span><span class="op" id="5492242">]</span><span class="op" id="5492243">)</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492247">p</span><span class="op" id="5492248">.</span><span class="ident" id="5492249">resetSpace</span><span class="op" id="5492259">(</span><span class="op" id="5492260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5492263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492267">return</span><br>
<span class="lineno"></span><span class="op" id="5492274">}</span><br>
<span class="lineno">1200</span><br>
<span class="lineno"></span><span class="comment" id="5492277">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5492357">//&nbsp;Public&nbsp;interface</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5492378">//&nbsp;A&nbsp;Mode&nbsp;value&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;flags&nbsp;(or&nbsp;0).&nbsp;They&nbsp;control&nbsp;printing.</span><br>
<span class="lineno">1205</span><span class="keyword" id="5492443">type</span>&nbsp;<span class="ident" id="5492448">Mode</span>&nbsp;<span class="builtintype" id="5492453">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5492459">const</span>&nbsp;<span class="op" id="5492465">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492468">RawFormat</span>&nbsp;<span class="ident" id="5492478">Mode</span>&nbsp;<span class="op" id="5492483">=</span>&nbsp;<span class="num" id="5492485">1</span>&nbsp;<span class="op" id="5492487">&lt;&lt;</span>&nbsp;<span class="ident" id="5492490">iota</span>&nbsp;<span class="comment" id="5492495">//&nbsp;do&nbsp;not&nbsp;use&nbsp;a&nbsp;tabwriter;&nbsp;if&nbsp;set,&nbsp;UseSpaces&nbsp;is&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492552">TabIndent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5492579">//&nbsp;use&nbsp;tabs&nbsp;for&nbsp;indentation&nbsp;independent&nbsp;of&nbsp;UseSpaces</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492633">UseSpaces</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5492660">//&nbsp;use&nbsp;spaces&nbsp;instead&nbsp;of&nbsp;tabs&nbsp;for&nbsp;alignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492705">SourcePos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5492732">//&nbsp;emit&nbsp;//line&nbsp;comments&nbsp;to&nbsp;preserve&nbsp;original&nbsp;source&nbsp;positions</span><br>
<span class="lineno"></span><span class="op" id="5492794">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5492797">//&nbsp;A&nbsp;Config&nbsp;node&nbsp;controls&nbsp;the&nbsp;output&nbsp;of&nbsp;Fprint.</span><br>
<span class="lineno">1215</span><span class="keyword" id="5492845">type</span>&nbsp;<span class="ident" id="5492850">Config</span>&nbsp;<span class="keyword" id="5492857">struct</span>&nbsp;<span class="op" id="5492864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492867">Mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5492876">Mode</span>&nbsp;<span class="comment" id="5492881">//&nbsp;default:&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492896">Tabwidth</span>&nbsp;<span class="builtintype" id="5492905">int</span>&nbsp;&nbsp;<span class="comment" id="5492910">//&nbsp;default:&nbsp;8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492925">Indent</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5492934">int</span>&nbsp;&nbsp;<span class="comment" id="5492939">//&nbsp;default:&nbsp;0&nbsp;(all&nbsp;code&nbsp;is&nbsp;indented&nbsp;at&nbsp;least&nbsp;by&nbsp;this&nbsp;much)</span><br>
<span class="lineno"></span><span class="op" id="5492998">}</span><br>
<span class="lineno">1220</span><br>
<span class="lineno"></span><span class="comment" id="5493001">//&nbsp;fprint&nbsp;implements&nbsp;Fprint&nbsp;and&nbsp;takes&nbsp;a&nbsp;nodesSizes&nbsp;map&nbsp;for&nbsp;setting&nbsp;up&nbsp;the&nbsp;printer&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5493090">func</span>&nbsp;<span class="op" id="5493095">(</span><span class="ident" id="5493096">cfg</span>&nbsp;<span class="op" id="5493100">*</span><span class="ident" id="5493101">Config</span><span class="op" id="5493107">)</span>&nbsp;<span class="ident" id="5493109">fprint</span><span class="op" id="5493115">(</span><span class="ident" id="5493116">output</span>&nbsp;<span class="ident" id="5493123">io</span><span class="op" id="5493125">.</span><span class="ident" id="5493126">Writer</span><span class="op" id="5493132">,</span>&nbsp;<span class="ident" id="5493134">fset</span>&nbsp;<span class="op" id="5493139">*</span><span class="ident" id="5493140">token</span><span class="op" id="5493145">.</span><span class="ident" id="5493146">FileSet</span><span class="op" id="5493153">,</span>&nbsp;<span class="ident" id="5493155">node</span>&nbsp;<span class="keyword" id="5493160">interface</span><span class="op" id="5493169">{</span><span class="op" id="5493170">}</span><span class="op" id="5493171">,</span>&nbsp;<span class="ident" id="5493173">nodeSizes</span>&nbsp;<span class="keyword" id="5493183">map</span><span class="op" id="5493186">[</span><span class="ident" id="5493187">ast</span><span class="op" id="5493190">.</span><span class="ident" id="5493191">Node</span><span class="op" id="5493195">]</span><span class="builtintype" id="5493196">int</span><span class="op" id="5493199">)</span>&nbsp;<span class="op" id="5493201">(</span><span class="ident" id="5493202">err</span>&nbsp;<span class="builtintype" id="5493206">error</span><span class="op" id="5493211">)</span>&nbsp;<span class="op" id="5493213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5493216">//&nbsp;print&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5493231">var</span>&nbsp;<span class="ident" id="5493235">p</span>&nbsp;<span class="ident" id="5493237">printer</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493246">p</span><span class="op" id="5493247">.</span><span class="ident" id="5493248">init</span><span class="op" id="5493252">(</span><span class="ident" id="5493253">cfg</span><span class="op" id="5493256">,</span>&nbsp;<span class="ident" id="5493258">fset</span><span class="op" id="5493262">,</span>&nbsp;<span class="ident" id="5493264">nodeSizes</span><span class="op" id="5493273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5493276">if</span>&nbsp;<span class="ident" id="5493279">err</span>&nbsp;<span class="op" id="5493283">=</span>&nbsp;<span class="ident" id="5493285">p</span><span class="op" id="5493286">.</span><span class="ident" id="5493287">printNode</span><span class="op" id="5493296">(</span><span class="ident" id="5493297">node</span><span class="op" id="5493301">)</span><span class="op" id="5493302">;</span>&nbsp;<span class="ident" id="5493304">err</span>&nbsp;<span class="op" id="5493308">!=</span>&nbsp;<span class="ident" id="5493311">nil</span>&nbsp;<span class="op" id="5493315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5493319">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5493327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5493330">//&nbsp;print&nbsp;outstanding&nbsp;comments</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493361">p</span><span class="op" id="5493362">.</span><span class="ident" id="5493363">impliedSemi</span>&nbsp;<span class="op" id="5493375">=</span>&nbsp;<span class="builtintype" id="5493377">false</span>&nbsp;<span class="comment" id="5493383">//&nbsp;EOF&nbsp;acts&nbsp;like&nbsp;a&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493411">p</span><span class="op" id="5493412">.</span><span class="ident" id="5493413">flush</span><span class="op" id="5493418">(</span><span class="ident" id="5493419">token</span><span class="op" id="5493424">.</span><span class="ident" id="5493425">Position</span><span class="op" id="5493433">{</span><span class="ident" id="5493434">Offset</span><span class="op" id="5493440">:</span>&nbsp;<span class="ident" id="5493442">infinity</span><span class="op" id="5493450">,</span>&nbsp;<span class="ident" id="5493452">Line</span><span class="op" id="5493456">:</span>&nbsp;<span class="ident" id="5493458">infinity</span><span class="op" id="5493466">}</span><span class="op" id="5493467">,</span>&nbsp;<span class="ident" id="5493469">token</span><span class="op" id="5493474">.</span><span class="ident" id="5493475">EOF</span><span class="op" id="5493478">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5493482">//&nbsp;redirect&nbsp;output&nbsp;through&nbsp;a&nbsp;trimmer&nbsp;to&nbsp;eliminate&nbsp;trailing&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5493553">//&nbsp;(Input&nbsp;to&nbsp;a&nbsp;tabwriter&nbsp;must&nbsp;be&nbsp;untrimmed&nbsp;since&nbsp;trailing&nbsp;tabs&nbsp;provide</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5493625">//&nbsp;formatting&nbsp;information.&nbsp;The&nbsp;tabwriter&nbsp;could&nbsp;provide&nbsp;trimming</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5493690">//&nbsp;functionality&nbsp;but&nbsp;no&nbsp;tabwriter&nbsp;is&nbsp;used&nbsp;when&nbsp;RawFormat&nbsp;is&nbsp;set.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493757">output</span>&nbsp;<span class="op" id="5493764">=</span>&nbsp;<span class="op" id="5493766">&amp;</span><span class="ident" id="5493767">trimmer</span><span class="op" id="5493774">{</span><span class="ident" id="5493775">output</span><span class="op" id="5493781">:</span>&nbsp;<span class="ident" id="5493783">output</span><span class="op" id="5493789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5493793">//&nbsp;redirect&nbsp;output&nbsp;through&nbsp;a&nbsp;tabwriter&nbsp;if&nbsp;necessary</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5493846">if</span>&nbsp;<span class="ident" id="5493849">cfg</span><span class="op" id="5493852">.</span><span class="ident" id="5493853">Mode</span><span class="op" id="5493857">&amp;</span><span class="ident" id="5493858">RawFormat</span>&nbsp;<span class="op" id="5493868">==</span>&nbsp;<span class="num" id="5493871">0</span>&nbsp;<span class="op" id="5493873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493877">minwidth</span>&nbsp;<span class="op" id="5493886">:=</span>&nbsp;<span class="ident" id="5493889">cfg</span><span class="op" id="5493892">.</span><span class="ident" id="5493893">Tabwidth</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493905">padchar</span>&nbsp;<span class="op" id="5493913">:=</span>&nbsp;<span class="builtintype" id="5493916">byte</span><span class="op" id="5493920">(</span><span class="string" id="5493921">&#39;\t&#39;</span><span class="op" id="5493925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5493929">if</span>&nbsp;<span class="ident" id="5493932">cfg</span><span class="op" id="5493935">.</span><span class="ident" id="5493936">Mode</span><span class="op" id="5493940">&amp;</span><span class="ident" id="5493941">UseSpaces</span>&nbsp;<span class="op" id="5493951">!=</span>&nbsp;<span class="num" id="5493954">0</span>&nbsp;<span class="op" id="5493956">{</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493961">padchar</span>&nbsp;<span class="op" id="5493969">=</span>&nbsp;<span class="string" id="5493971">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5493977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493982">twmode</span>&nbsp;<span class="op" id="5493989">:=</span>&nbsp;<span class="ident" id="5493992">tabwriter</span><span class="op" id="5494001">.</span><span class="ident" id="5494002">DiscardEmptyColumns</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494024">if</span>&nbsp;<span class="ident" id="5494027">cfg</span><span class="op" id="5494030">.</span><span class="ident" id="5494031">Mode</span><span class="op" id="5494035">&amp;</span><span class="ident" id="5494036">TabIndent</span>&nbsp;<span class="op" id="5494046">!=</span>&nbsp;<span class="num" id="5494049">0</span>&nbsp;<span class="op" id="5494051">{</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494056">minwidth</span>&nbsp;<span class="op" id="5494065">=</span>&nbsp;<span class="num" id="5494067">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494072">twmode</span>&nbsp;<span class="op" id="5494079">|=</span>&nbsp;<span class="ident" id="5494082">tabwriter</span><span class="op" id="5494091">.</span><span class="ident" id="5494092">TabIndent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5494104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494109">output</span>&nbsp;<span class="op" id="5494116">=</span>&nbsp;<span class="ident" id="5494118">tabwriter</span><span class="op" id="5494127">.</span><span class="ident" id="5494128">NewWriter</span><span class="op" id="5494137">(</span><span class="ident" id="5494138">output</span><span class="op" id="5494144">,</span>&nbsp;<span class="ident" id="5494146">minwidth</span><span class="op" id="5494154">,</span>&nbsp;<span class="ident" id="5494156">cfg</span><span class="op" id="5494159">.</span><span class="ident" id="5494160">Tabwidth</span><span class="op" id="5494168">,</span>&nbsp;<span class="num" id="5494170">1</span><span class="op" id="5494171">,</span>&nbsp;<span class="ident" id="5494173">padchar</span><span class="op" id="5494180">,</span>&nbsp;<span class="ident" id="5494182">twmode</span><span class="op" id="5494188">)</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5494191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5494195">//&nbsp;write&nbsp;printer&nbsp;result&nbsp;via&nbsp;tabwriter/trimmer&nbsp;to&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494252">if</span>&nbsp;<span class="ident" id="5494255">_</span><span class="op" id="5494256">,</span>&nbsp;<span class="ident" id="5494258">err</span>&nbsp;<span class="op" id="5494262">=</span>&nbsp;<span class="ident" id="5494264">output</span><span class="op" id="5494270">.</span><span class="ident" id="5494271">Write</span><span class="op" id="5494276">(</span><span class="ident" id="5494277">p</span><span class="op" id="5494278">.</span><span class="ident" id="5494279">output</span><span class="op" id="5494285">)</span><span class="op" id="5494286">;</span>&nbsp;<span class="ident" id="5494288">err</span>&nbsp;<span class="op" id="5494292">!=</span>&nbsp;<span class="ident" id="5494295">nil</span>&nbsp;<span class="op" id="5494299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494303">return</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5494311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5494315">//&nbsp;flush&nbsp;tabwriter,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494343">if</span>&nbsp;<span class="ident" id="5494346">tw</span><span class="op" id="5494348">,</span>&nbsp;<span class="ident" id="5494350">_</span>&nbsp;<span class="op" id="5494352">:=</span>&nbsp;<span class="ident" id="5494355">output</span><span class="op" id="5494361">.</span><span class="op" id="5494362">(</span><span class="op" id="5494363">*</span><span class="ident" id="5494364">tabwriter</span><span class="op" id="5494373">.</span><span class="ident" id="5494374">Writer</span><span class="op" id="5494380">)</span><span class="op" id="5494381">;</span>&nbsp;<span class="ident" id="5494383">tw</span>&nbsp;<span class="op" id="5494386">!=</span>&nbsp;<span class="ident" id="5494389">nil</span>&nbsp;<span class="op" id="5494393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494397">err</span>&nbsp;<span class="op" id="5494401">=</span>&nbsp;<span class="ident" id="5494403">tw</span><span class="op" id="5494405">.</span><span class="ident" id="5494406">Flush</span><span class="op" id="5494411">(</span><span class="op" id="5494412">)</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5494415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494419">return</span><br>
<span class="lineno"></span><span class="op" id="5494426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span><span class="comment" id="5494429">//&nbsp;A&nbsp;CommentedNode&nbsp;bundles&nbsp;an&nbsp;AST&nbsp;node&nbsp;and&nbsp;corresponding&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="5494496">//&nbsp;It&nbsp;may&nbsp;be&nbsp;provided&nbsp;as&nbsp;argument&nbsp;to&nbsp;any&nbsp;of&nbsp;the&nbsp;Fprint&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="5494562">//</span><br>
<span class="lineno"></span><span class="keyword" id="5494565">type</span>&nbsp;<span class="ident" id="5494570">CommentedNode</span>&nbsp;<span class="keyword" id="5494584">struct</span>&nbsp;<span class="op" id="5494591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494594">Node</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5494603">interface</span><span class="op" id="5494612">{</span><span class="op" id="5494613">}</span>&nbsp;<span class="comment" id="5494615">//&nbsp;*ast.File,&nbsp;or&nbsp;ast.Expr,&nbsp;ast.Decl,&nbsp;ast.Spec,&nbsp;or&nbsp;ast.Stmt</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494675">Comments</span>&nbsp;<span class="op" id="5494684">[</span><span class="op" id="5494685">]</span><span class="op" id="5494686">*</span><span class="ident" id="5494687">ast</span><span class="op" id="5494690">.</span><span class="ident" id="5494691">CommentGroup</span><br>
<span class="lineno"></span><span class="op" id="5494704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5494707">//&nbsp;Fprint&nbsp;&#34;pretty-prints&#34;&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;output&nbsp;for&nbsp;a&nbsp;given&nbsp;configuration&nbsp;cfg.</span><br>
<span class="lineno"></span><span class="comment" id="5494786">//&nbsp;Position&nbsp;information&nbsp;is&nbsp;interpreted&nbsp;relative&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;fset.</span><br>
<span class="lineno">1280</span><span class="comment" id="5494856">//&nbsp;The&nbsp;node&nbsp;type&nbsp;must&nbsp;be&nbsp;*ast.File,&nbsp;*CommentedNode,&nbsp;[]ast.Decl,&nbsp;[]ast.Stmt,</span><br>
<span class="lineno"></span><span class="comment" id="5494932">//&nbsp;or&nbsp;assignment-compatible&nbsp;to&nbsp;ast.Expr,&nbsp;ast.Decl,&nbsp;ast.Spec,&nbsp;or&nbsp;ast.Stmt.</span><br>
<span class="lineno"></span><span class="comment" id="5495006">//</span><br>
<span class="lineno"></span><span class="keyword" id="5495009">func</span>&nbsp;<span class="op" id="5495014">(</span><span class="ident" id="5495015">cfg</span>&nbsp;<span class="op" id="5495019">*</span><span class="ident" id="5495020">Config</span><span class="op" id="5495026">)</span>&nbsp;<span class="ident" id="5495028">Fprint</span><span class="op" id="5495034">(</span><span class="ident" id="5495035">output</span>&nbsp;<span class="ident" id="5495042">io</span><span class="op" id="5495044">.</span><span class="ident" id="5495045">Writer</span><span class="op" id="5495051">,</span>&nbsp;<span class="ident" id="5495053">fset</span>&nbsp;<span class="op" id="5495058">*</span><span class="ident" id="5495059">token</span><span class="op" id="5495064">.</span><span class="ident" id="5495065">FileSet</span><span class="op" id="5495072">,</span>&nbsp;<span class="ident" id="5495074">node</span>&nbsp;<span class="keyword" id="5495079">interface</span><span class="op" id="5495088">{</span><span class="op" id="5495089">}</span><span class="op" id="5495090">)</span>&nbsp;<span class="builtintype" id="5495092">error</span>&nbsp;<span class="op" id="5495098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5495101">return</span>&nbsp;<span class="ident" id="5495108">cfg</span><span class="op" id="5495111">.</span><span class="ident" id="5495112">fprint</span><span class="op" id="5495118">(</span><span class="ident" id="5495119">output</span><span class="op" id="5495125">,</span>&nbsp;<span class="ident" id="5495127">fset</span><span class="op" id="5495131">,</span>&nbsp;<span class="ident" id="5495133">node</span><span class="op" id="5495137">,</span>&nbsp;<span class="builtinfunc" id="5495139">make</span><span class="op" id="5495143">(</span><span class="keyword" id="5495144">map</span><span class="op" id="5495147">[</span><span class="ident" id="5495148">ast</span><span class="op" id="5495151">.</span><span class="ident" id="5495152">Node</span><span class="op" id="5495156">]</span><span class="builtintype" id="5495157">int</span><span class="op" id="5495160">)</span><span class="op" id="5495161">)</span><br>
<span class="lineno">1285</span><span class="op" id="5495163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5495166">//&nbsp;Fprint&nbsp;&#34;pretty-prints&#34;&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="5495215">//&nbsp;It&nbsp;calls&nbsp;Config.Fprint&nbsp;with&nbsp;default&nbsp;settings.</span><br>
<span class="lineno"></span><span class="comment" id="5495264">//</span><br>
<span class="lineno">1290</span><span class="keyword" id="5495267">func</span>&nbsp;<span class="ident" id="5495272">Fprint</span><span class="op" id="5495278">(</span><span class="ident" id="5495279">output</span>&nbsp;<span class="ident" id="5495286">io</span><span class="op" id="5495288">.</span><span class="ident" id="5495289">Writer</span><span class="op" id="5495295">,</span>&nbsp;<span class="ident" id="5495297">fset</span>&nbsp;<span class="op" id="5495302">*</span><span class="ident" id="5495303">token</span><span class="op" id="5495308">.</span><span class="ident" id="5495309">FileSet</span><span class="op" id="5495316">,</span>&nbsp;<span class="ident" id="5495318">node</span>&nbsp;<span class="keyword" id="5495323">interface</span><span class="op" id="5495332">{</span><span class="op" id="5495333">}</span><span class="op" id="5495334">)</span>&nbsp;<span class="builtintype" id="5495336">error</span>&nbsp;<span class="op" id="5495342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5495345">return</span>&nbsp;<span class="op" id="5495352">(</span><span class="op" id="5495353">&amp;</span><span class="ident" id="5495354">Config</span><span class="op" id="5495360">{</span><span class="ident" id="5495361">Tabwidth</span><span class="op" id="5495369">:</span>&nbsp;<span class="num" id="5495371">8</span><span class="op" id="5495372">}</span><span class="op" id="5495373">)</span><span class="op" id="5495374">.</span><span class="ident" id="5495375">Fprint</span><span class="op" id="5495381">(</span><span class="ident" id="5495382">output</span><span class="op" id="5495388">,</span>&nbsp;<span class="ident" id="5495390">fset</span><span class="op" id="5495394">,</span>&nbsp;<span class="ident" id="5495396">node</span><span class="op" id="5495400">)</span><br>
<span class="lineno"></span><span class="op" id="5495402">}</span>
</div>
</body>
</html>
