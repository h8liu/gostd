<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword">package</span>&nbsp;<span class="ident">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">import</span>&nbsp;<span class="string">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;NOTE:&nbsp;Func&nbsp;does&nbsp;not&nbsp;expose&nbsp;the&nbsp;actual&nbsp;unexported&nbsp;fields,&nbsp;because&nbsp;we&nbsp;return&nbsp;*Func</span><br>
<span class="lineno">10</span><span class="comment">//&nbsp;values&nbsp;to&nbsp;users,&nbsp;and&nbsp;we&nbsp;want&nbsp;to&nbsp;keep&nbsp;them&nbsp;from&nbsp;being&nbsp;able&nbsp;to&nbsp;overwrite&nbsp;the&nbsp;data</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;with&nbsp;(say)&nbsp;*f&nbsp;=&nbsp;Func{}.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;All&nbsp;code&nbsp;operating&nbsp;on&nbsp;a&nbsp;*Func&nbsp;must&nbsp;call&nbsp;raw&nbsp;to&nbsp;get&nbsp;the&nbsp;*_func&nbsp;instead.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;A&nbsp;Func&nbsp;represents&nbsp;a&nbsp;Go&nbsp;function&nbsp;in&nbsp;the&nbsp;running&nbsp;binary.</span><br>
<span class="lineno">15</span><span class="keyword">type</span>&nbsp;<span class="ident">Func</span>&nbsp;<span class="keyword">struct</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">opaque</span>&nbsp;<span class="keyword">struct</span><span class="op">{</span><span class="op">}</span>&nbsp;<span class="comment">//&nbsp;unexported&nbsp;field&nbsp;to&nbsp;disallow&nbsp;conversions</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">f</span>&nbsp;<span class="op">*</span><span class="ident">Func</span><span class="op">)</span>&nbsp;<span class="ident">raw</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">*</span><span class="ident">_func</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="op">(</span><span class="op">*</span><span class="ident">_func</span><span class="op">)</span><span class="op">(</span><span class="ident">unsafe</span><span class="op">.</span><span class="ident">Pointer</span><span class="op">(</span><span class="ident">f</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;funcdata.h</span><br>
<span class="lineno"></span><span class="keyword">const</span>&nbsp;<span class="op">(</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">_PCDATA_ArgSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">=</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">_PCDATA_StackMapIndex</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">_FUNCDATA_ArgsPointerMaps</span>&nbsp;&nbsp;&nbsp;<span class="op">=</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">_FUNCDATA_LocalsPointerMaps</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">_FUNCDATA_DeadValueMaps</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">=</span>&nbsp;<span class="num">2</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">_ArgsSizeUnknown</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">=</span>&nbsp;<span class="op">-</span><span class="num">0x80000000</span><br>
<span class="lineno"></span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">var</span>&nbsp;<span class="op">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">pclntable</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">ftab</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">[</span><span class="op">]</span><span class="ident">functab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">filetab</span>&nbsp;&nbsp;&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">pclntab</span><span class="op">,</span>&nbsp;<span class="ident">epclntab</span>&nbsp;<span class="keyword">struct</span><span class="op">{</span><span class="op">}</span>&nbsp;<span class="comment">//&nbsp;linker&nbsp;symbols</span><br>
<span class="lineno"></span><span class="op">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword">type</span>&nbsp;<span class="ident">functab</span>&nbsp;<span class="keyword">struct</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">entry</span>&nbsp;&nbsp;&nbsp;<span class="builtintype">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">funcoff</span>&nbsp;<span class="builtintype">uintptr</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">symtabinit</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;See&nbsp;golang.org/s/go12symtab&nbsp;for&nbsp;header:&nbsp;0xfffffffb,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;two&nbsp;zero&nbsp;bytes,&nbsp;a&nbsp;byte&nbsp;giving&nbsp;the&nbsp;PC&nbsp;quantum,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;and&nbsp;a&nbsp;byte&nbsp;giving&nbsp;the&nbsp;pointer&nbsp;width&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">pcln</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="op">(</span><span class="op">*</span><span class="op">[</span><span class="num">8</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span><span class="op">(</span><span class="ident">unsafe</span><span class="op">.</span><span class="ident">Pointer</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">pclntab</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">pcln32</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="op">(</span><span class="op">*</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="builtintype">uint32</span><span class="op">)</span><span class="op">(</span><span class="ident">unsafe</span><span class="op">.</span><span class="ident">Pointer</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">pclntab</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">pcln32</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0xfffffffb</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">pcln</span><span class="op">[</span><span class="num">4</span><span class="op">]</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">pcln</span><span class="op">[</span><span class="num">5</span><span class="op">]</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">pcln</span><span class="op">[</span><span class="num">6</span><span class="op">]</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="ident">_PCQuantum</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">pcln</span><span class="op">[</span><span class="num">7</span><span class="op">]</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="ident">ptrSize</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">println</span><span class="op">(</span><span class="string">&#34;runtime:&nbsp;function&nbsp;symbol&nbsp;table&nbsp;header:&#34;</span><span class="op">,</span>&nbsp;<span class="ident">hex</span><span class="op">(</span><span class="ident">pcln32</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="ident">hex</span><span class="op">(</span><span class="ident">pcln</span><span class="op">[</span><span class="num">4</span><span class="op">]</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="ident">hex</span><span class="op">(</span><span class="ident">pcln</span><span class="op">[</span><span class="num">5</span><span class="op">]</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="ident">hex</span><span class="op">(</span><span class="ident">pcln</span><span class="op">[</span><span class="num">6</span><span class="op">]</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="ident">hex</span><span class="op">(</span><span class="ident">pcln</span><span class="op">[</span><span class="num">7</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">gothrow</span><span class="op">(</span><span class="string">&#34;invalid&nbsp;function&nbsp;symbol&nbsp;table\n&#34;</span><span class="op">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;pclntable&nbsp;is&nbsp;all&nbsp;bytes&nbsp;of&nbsp;pclntab&nbsp;symbol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sp</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="op">(</span><span class="op">*</span><span class="ident">sliceStruct</span><span class="op">)</span><span class="op">(</span><span class="ident">unsafe</span><span class="op">.</span><span class="ident">Pointer</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">pclntable</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sp</span><span class="op">.</span><span class="ident">array</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">unsafe</span><span class="op">.</span><span class="ident">Pointer</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">pclntab</span><span class="op">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sp</span><span class="op">.</span><span class="builtinfunc">len</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">int</span><span class="op">(</span><span class="builtintype">uintptr</span><span class="op">(</span><span class="ident">unsafe</span><span class="op">.</span><span class="ident">Pointer</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">epclntab</span><span class="op">)</span><span class="op">)</span>&nbsp;<span class="op">-</span>&nbsp;<span class="builtintype">uintptr</span><span class="op">(</span><span class="ident">unsafe</span><span class="op">.</span><span class="ident">Pointer</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">pclntab</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sp</span><span class="op">.</span><span class="builtinfunc">cap</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">sp</span><span class="op">.</span><span class="builtinfunc">len</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;ftab&nbsp;is&nbsp;lookup&nbsp;table&nbsp;for&nbsp;function&nbsp;by&nbsp;program&nbsp;counter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">nftab</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtintype">int</span><span class="op">(</span><span class="op">*</span><span class="op">(</span><span class="op">*</span><span class="builtintype">uintptr</span><span class="op">)</span><span class="op">(</span><span class="ident">add</span><span class="op">(</span><span class="ident">unsafe</span><span class="op">.</span><span class="ident">Pointer</span><span class="op">(</span><span class="ident">pcln</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="num">8</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">add</span><span class="op">(</span><span class="ident">unsafe</span><span class="op">.</span><span class="ident">Pointer</span><span class="op">(</span><span class="ident">pcln</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="num">8</span><span class="op">+</span><span class="ident">ptrSize</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sp</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">(</span><span class="op">*</span><span class="ident">sliceStruct</span><span class="op">)</span><span class="op">(</span><span class="ident">unsafe</span><span class="op">.</span><span class="ident">Pointer</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">ftab</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sp</span><span class="op">.</span><span class="ident">array</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sp</span><span class="op">.</span><span class="builtinfunc">len</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">nftab</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sp</span><span class="op">.</span><span class="builtinfunc">cap</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">sp</span><span class="op">.</span><span class="builtinfunc">len</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">nftab</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;NOTE:&nbsp;ftab[nftab].entry&nbsp;is&nbsp;legal;&nbsp;it&nbsp;is&nbsp;the&nbsp;address&nbsp;beyond&nbsp;the&nbsp;final&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">ftab</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><span class="op">.</span><span class="ident">entry</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="ident">ftab</span><span class="op">[</span><span class="ident">i</span><span class="op">+</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="ident">entry</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f1</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="op">(</span><span class="op">*</span><span class="ident">_func</span><span class="op">)</span><span class="op">(</span><span class="ident">unsafe</span><span class="op">.</span><span class="ident">Pointer</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">pclntable</span><span class="op">[</span><span class="ident">ftab</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><span class="op">.</span><span class="ident">funcoff</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f2</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="op">(</span><span class="op">*</span><span class="ident">_func</span><span class="op">)</span><span class="op">(</span><span class="ident">unsafe</span><span class="op">.</span><span class="ident">Pointer</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">pclntable</span><span class="op">[</span><span class="ident">ftab</span><span class="op">[</span><span class="ident">i</span><span class="op">+</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="ident">funcoff</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f2name</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="string">&#34;end&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">i</span><span class="op">+</span><span class="num">1</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">nftab</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f2name</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">gofuncname</span><span class="op">(</span><span class="ident">f2</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">println</span><span class="op">(</span><span class="string">&#34;function&nbsp;symbol&nbsp;table&nbsp;not&nbsp;sorted&nbsp;by&nbsp;program&nbsp;counter:&#34;</span><span class="op">,</span>&nbsp;<span class="ident">hex</span><span class="op">(</span><span class="ident">ftab</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><span class="op">.</span><span class="ident">entry</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="ident">gofuncname</span><span class="op">(</span><span class="ident">f1</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="string">&#34;&gt;&#34;</span><span class="op">,</span>&nbsp;<span class="ident">hex</span><span class="op">(</span><span class="ident">ftab</span><span class="op">[</span><span class="ident">i</span><span class="op">+</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="ident">entry</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="ident">f2name</span><span class="op">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">j</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">j</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">i</span><span class="op">;</span>&nbsp;<span class="ident">j</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">print</span><span class="op">(</span><span class="string">&#34;\t&#34;</span><span class="op">,</span>&nbsp;<span class="ident">hex</span><span class="op">(</span><span class="ident">ftab</span><span class="op">[</span><span class="ident">j</span><span class="op">]</span><span class="op">.</span><span class="ident">entry</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="string">&#34;&nbsp;&#34;</span><span class="op">,</span>&nbsp;<span class="ident">gofuncname</span><span class="op">(</span><span class="op">(</span><span class="op">*</span><span class="ident">_func</span><span class="op">)</span><span class="op">(</span><span class="ident">unsafe</span><span class="op">.</span><span class="ident">Pointer</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">pclntable</span><span class="op">[</span><span class="ident">ftab</span><span class="op">[</span><span class="ident">j</span><span class="op">]</span><span class="op">.</span><span class="ident">funcoff</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">gothrow</span><span class="op">(</span><span class="string">&#34;invalid&nbsp;runtime&nbsp;symbol&nbsp;table&#34;</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;The&nbsp;ftab&nbsp;ends&nbsp;with&nbsp;a&nbsp;half&nbsp;functab&nbsp;consisting&nbsp;only&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&#39;entry&#39;,&nbsp;followed&nbsp;by&nbsp;a&nbsp;uint32&nbsp;giving&nbsp;the&nbsp;pcln-relative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;offset&nbsp;of&nbsp;the&nbsp;file&nbsp;table.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sp</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">(</span><span class="op">*</span><span class="ident">sliceStruct</span><span class="op">)</span><span class="op">(</span><span class="ident">unsafe</span><span class="op">.</span><span class="ident">Pointer</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">filetab</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">end</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">unsafe</span><span class="op">.</span><span class="ident">Pointer</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">ftab</span><span class="op">[</span><span class="ident">nftab</span><span class="op">]</span><span class="op">.</span><span class="ident">funcoff</span><span class="op">)</span>&nbsp;<span class="comment">//&nbsp;just&nbsp;beyond&nbsp;ftab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fileoffset</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="op">*</span><span class="op">(</span><span class="op">*</span><span class="builtintype">uint32</span><span class="op">)</span><span class="op">(</span><span class="ident">end</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sp</span><span class="op">.</span><span class="ident">array</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">unsafe</span><span class="op">.</span><span class="ident">Pointer</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">pclntable</span><span class="op">[</span><span class="ident">fileoffset</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;length&nbsp;is&nbsp;in&nbsp;first&nbsp;element&nbsp;of&nbsp;array.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;set&nbsp;len&nbsp;to&nbsp;1&nbsp;so&nbsp;we&nbsp;can&nbsp;get&nbsp;first&nbsp;element.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sp</span><span class="op">.</span><span class="builtinfunc">len</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sp</span><span class="op">.</span><span class="builtinfunc">cap</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sp</span><span class="op">.</span><span class="builtinfunc">len</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">int</span><span class="op">(</span><span class="ident">filetab</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sp</span><span class="op">.</span><span class="builtinfunc">cap</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">sp</span><span class="op">.</span><span class="builtinfunc">len</span><br>
<span class="lineno">100</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;FuncForPC&nbsp;returns&nbsp;a&nbsp;*Func&nbsp;describing&nbsp;the&nbsp;function&nbsp;that&nbsp;contains&nbsp;the</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;given&nbsp;program&nbsp;counter&nbsp;address,&nbsp;or&nbsp;else&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">FuncForPC</span><span class="op">(</span><span class="ident">pc</span>&nbsp;<span class="builtintype">uintptr</span><span class="op">)</span>&nbsp;<span class="op">*</span><span class="ident">Func</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="op">(</span><span class="op">*</span><span class="ident">Func</span><span class="op">)</span><span class="op">(</span><span class="ident">unsafe</span><span class="op">.</span><span class="ident">Pointer</span><span class="op">(</span><span class="ident">findfunc</span><span class="op">(</span><span class="ident">pc</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">f</span>&nbsp;<span class="op">*</span><span class="ident">Func</span><span class="op">)</span>&nbsp;<span class="ident">Name</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="builtintype">string</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">gofuncname</span><span class="op">(</span><span class="ident">f</span><span class="op">.</span><span class="ident">raw</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Entry&nbsp;returns&nbsp;the&nbsp;entry&nbsp;address&nbsp;of&nbsp;the&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">f</span>&nbsp;<span class="op">*</span><span class="ident">Func</span><span class="op">)</span>&nbsp;<span class="ident">Entry</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="builtintype">uintptr</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">raw</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="ident">entry</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;FileLine&nbsp;returns&nbsp;the&nbsp;file&nbsp;name&nbsp;and&nbsp;line&nbsp;number&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;source&nbsp;code&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;program&nbsp;counter&nbsp;pc.</span><br>
<span class="lineno">120</span><span class="comment">//&nbsp;The&nbsp;result&nbsp;will&nbsp;not&nbsp;be&nbsp;accurate&nbsp;if&nbsp;pc&nbsp;is&nbsp;not&nbsp;a&nbsp;program</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;counter&nbsp;within&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">f</span>&nbsp;<span class="op">*</span><span class="ident">Func</span><span class="op">)</span>&nbsp;<span class="ident">FileLine</span><span class="op">(</span><span class="ident">pc</span>&nbsp;<span class="builtintype">uintptr</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">file</span>&nbsp;<span class="builtintype">string</span><span class="op">,</span>&nbsp;<span class="ident">line</span>&nbsp;<span class="builtintype">int</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Pass&nbsp;strict=false&nbsp;here,&nbsp;because&nbsp;anyone&nbsp;can&nbsp;call&nbsp;this&nbsp;function,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;and&nbsp;they&nbsp;might&nbsp;just&nbsp;be&nbsp;wrong&nbsp;about&nbsp;targetpc&nbsp;belonging&nbsp;to&nbsp;f.</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">line</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">int</span><span class="op">(</span><span class="ident">funcline1</span><span class="op">(</span><span class="ident">f</span><span class="op">.</span><span class="ident">raw</span><span class="op">(</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="ident">pc</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">file</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">file</span><span class="op">,</span>&nbsp;<span class="ident">line</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">findfunc</span><span class="op">(</span><span class="ident">pc</span>&nbsp;<span class="builtintype">uintptr</span><span class="op">)</span>&nbsp;<span class="op">*</span><span class="ident">_func</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">ftab</span><span class="op">)</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">pc</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">ftab</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="ident">entry</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">pc</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="ident">ftab</span><span class="op">[</span><span class="builtinfunc">len</span><span class="op">(</span><span class="ident">ftab</span><span class="op">)</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="ident">entry</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;binary&nbsp;search&nbsp;to&nbsp;find&nbsp;func&nbsp;with&nbsp;entry&nbsp;&lt;=&nbsp;pc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">lo</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">nf</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">ftab</span><span class="op">)</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span>&nbsp;<span class="comment">//&nbsp;last&nbsp;entry&nbsp;is&nbsp;sentinel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">nf</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">n</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">nf</span>&nbsp;<span class="op">/</span>&nbsp;<span class="num">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="op">&amp;</span><span class="ident">ftab</span><span class="op">[</span><span class="ident">lo</span><span class="op">+</span><span class="ident">n</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">entry</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">pc</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">pc</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">ftab</span><span class="op">[</span><span class="ident">lo</span><span class="op">+</span><span class="ident">n</span><span class="op">+</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="ident">entry</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="op">(</span><span class="op">*</span><span class="ident">_func</span><span class="op">)</span><span class="op">(</span><span class="ident">unsafe</span><span class="op">.</span><span class="ident">Pointer</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">pclntable</span><span class="op">[</span><span class="ident">f</span><span class="op">.</span><span class="ident">funcoff</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="keyword">if</span>&nbsp;<span class="ident">pc</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">entry</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">nf</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">lo</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">n</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">1</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">nf</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="ident">n</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">gothrow</span><span class="op">(</span><span class="string">&#34;findfunc:&nbsp;binary&nbsp;search&nbsp;failed&#34;</span><span class="op">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">nil</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">pcvalue</span><span class="op">(</span><span class="ident">f</span>&nbsp;<span class="op">*</span><span class="ident">_func</span><span class="op">,</span>&nbsp;<span class="ident">off</span>&nbsp;<span class="builtintype">int32</span><span class="op">,</span>&nbsp;<span class="ident">targetpc</span>&nbsp;<span class="builtintype">uintptr</span><span class="op">,</span>&nbsp;<span class="ident">strict</span>&nbsp;<span class="builtintype">bool</span><span class="op">)</span>&nbsp;<span class="builtintype">int32</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">off</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="op">-</span><span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">pclntable</span><span class="op">[</span><span class="ident">off</span><span class="op">:</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">pc</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">val</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtintype">int32</span><span class="op">(</span><span class="op">-</span><span class="num">1</span><span class="op">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">ok</span>&nbsp;<span class="builtintype">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p</span><span class="op">,</span>&nbsp;<span class="ident">ok</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">step</span><span class="op">(</span><span class="ident">p</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">pc</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">val</span><span class="op">,</span>&nbsp;<span class="ident">pc</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">entry</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="op">!</span><span class="ident">ok</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">break</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">targetpc</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">pc</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;If&nbsp;there&nbsp;was&nbsp;a&nbsp;table,&nbsp;it&nbsp;should&nbsp;have&nbsp;covered&nbsp;all&nbsp;program&nbsp;counters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;If&nbsp;not,&nbsp;something&nbsp;is&nbsp;wrong.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">panicking</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">||</span>&nbsp;<span class="op">!</span><span class="ident">strict</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="op">-</span><span class="num">1</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">print</span><span class="op">(</span><span class="string">&#34;runtime:&nbsp;invalid&nbsp;pc-encoded&nbsp;table&nbsp;f=&#34;</span><span class="op">,</span>&nbsp;<span class="ident">gofuncname</span><span class="op">(</span><span class="ident">f</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="string">&#34;&nbsp;pc=&#34;</span><span class="op">,</span>&nbsp;<span class="ident">hex</span><span class="op">(</span><span class="ident">pc</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="string">&#34;&nbsp;targetpc=&#34;</span><span class="op">,</span>&nbsp;<span class="ident">hex</span><span class="op">(</span><span class="ident">targetpc</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="string">&#34;&nbsp;tab=&#34;</span><span class="op">,</span>&nbsp;<span class="ident">p</span><span class="op">,</span>&nbsp;<span class="string">&#34;\n&#34;</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">pclntable</span><span class="op">[</span><span class="ident">off</span><span class="op">:</span><span class="op">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">pc</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">val</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">-</span><span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">ok</span>&nbsp;<span class="builtintype">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p</span><span class="op">,</span>&nbsp;<span class="ident">ok</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">step</span><span class="op">(</span><span class="ident">p</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">pc</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">val</span><span class="op">,</span>&nbsp;<span class="ident">pc</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">entry</span><span class="op">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="op">!</span><span class="ident">ok</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">print</span><span class="op">(</span><span class="string">&#34;\tvalue=&#34;</span><span class="op">,</span>&nbsp;<span class="ident">val</span><span class="op">,</span>&nbsp;<span class="string">&#34;&nbsp;until&nbsp;pc=&#34;</span><span class="op">,</span>&nbsp;<span class="ident">hex</span><span class="op">(</span><span class="ident">pc</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="string">&#34;\n&#34;</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">gothrow</span><span class="op">(</span><span class="string">&#34;invalid&nbsp;runtime&nbsp;symbol&nbsp;table&#34;</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="op">-</span><span class="num">1</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="keyword">func</span>&nbsp;<span class="ident">funcname</span><span class="op">(</span><span class="ident">f</span>&nbsp;<span class="op">*</span><span class="ident">_func</span><span class="op">)</span>&nbsp;<span class="op">*</span><span class="builtintype">byte</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">f</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">nil</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">nameoff</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="op">(</span><span class="op">*</span><span class="builtintype">byte</span><span class="op">)</span><span class="op">(</span><span class="ident">unsafe</span><span class="op">.</span><span class="ident">Pointer</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">pclntable</span><span class="op">[</span><span class="ident">f</span><span class="op">.</span><span class="ident">nameoff</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno">205</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">gofuncname</span><span class="op">(</span><span class="ident">f</span>&nbsp;<span class="op">*</span><span class="ident">_func</span><span class="op">)</span>&nbsp;<span class="builtintype">string</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">gostringnocopy</span><span class="op">(</span><span class="ident">funcname</span><span class="op">(</span><span class="ident">f</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">funcline1</span><span class="op">(</span><span class="ident">f</span>&nbsp;<span class="op">*</span><span class="ident">_func</span><span class="op">,</span>&nbsp;<span class="ident">targetpc</span>&nbsp;<span class="builtintype">uintptr</span><span class="op">,</span>&nbsp;<span class="ident">file</span>&nbsp;<span class="op">*</span><span class="builtintype">string</span><span class="op">,</span>&nbsp;<span class="ident">strict</span>&nbsp;<span class="builtintype">bool</span><span class="op">)</span>&nbsp;<span class="builtintype">int32</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">*</span><span class="ident">file</span>&nbsp;<span class="op">=</span>&nbsp;<span class="string">&#34;?&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fileno</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtintype">int</span><span class="op">(</span><span class="ident">pcvalue</span><span class="op">(</span><span class="ident">f</span><span class="op">,</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">pcfile</span><span class="op">,</span>&nbsp;<span class="ident">targetpc</span><span class="op">,</span>&nbsp;<span class="ident">strict</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">line</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">pcvalue</span><span class="op">(</span><span class="ident">f</span><span class="op">,</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">pcln</span><span class="op">,</span>&nbsp;<span class="ident">targetpc</span><span class="op">,</span>&nbsp;<span class="ident">strict</span><span class="op">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">fileno</span>&nbsp;<span class="op">==</span>&nbsp;<span class="op">-</span><span class="num">1</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">line</span>&nbsp;<span class="op">==</span>&nbsp;<span class="op">-</span><span class="num">1</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">fileno</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">filetab</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;print(&#34;looking&nbsp;for&nbsp;&#34;,&nbsp;hex(targetpc),&nbsp;&#34;&nbsp;in&nbsp;&#34;,&nbsp;gofuncname(f),&nbsp;&#34;&nbsp;got&nbsp;file=&#34;,&nbsp;fileno,&nbsp;&#34;&nbsp;line=&#34;,&nbsp;lineno,&nbsp;&#34;\n&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">*</span><span class="ident">file</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">gostringnocopy</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">pclntable</span><span class="op">[</span><span class="ident">filetab</span><span class="op">[</span><span class="ident">fileno</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">line</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">funcline</span><span class="op">(</span><span class="ident">f</span>&nbsp;<span class="op">*</span><span class="ident">_func</span><span class="op">,</span>&nbsp;<span class="ident">targetpc</span>&nbsp;<span class="builtintype">uintptr</span><span class="op">,</span>&nbsp;<span class="ident">file</span>&nbsp;<span class="op">*</span><span class="builtintype">string</span><span class="op">)</span>&nbsp;<span class="builtintype">int32</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">funcline1</span><span class="op">(</span><span class="ident">f</span><span class="op">,</span>&nbsp;<span class="ident">targetpc</span><span class="op">,</span>&nbsp;<span class="ident">file</span><span class="op">,</span>&nbsp;<span class="ident">true</span><span class="op">)</span><br>
<span class="lineno">225</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">funcspdelta</span><span class="op">(</span><span class="ident">f</span>&nbsp;<span class="op">*</span><span class="ident">_func</span><span class="op">,</span>&nbsp;<span class="ident">targetpc</span>&nbsp;<span class="builtintype">uintptr</span><span class="op">)</span>&nbsp;<span class="builtintype">int32</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">x</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">pcvalue</span><span class="op">(</span><span class="ident">f</span><span class="op">,</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">pcsp</span><span class="op">,</span>&nbsp;<span class="ident">targetpc</span><span class="op">,</span>&nbsp;<span class="ident">true</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">x</span><span class="op">&amp;</span><span class="op">(</span><span class="ident">ptrSize</span><span class="op">-</span><span class="num">1</span><span class="op">)</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">print</span><span class="op">(</span><span class="string">&#34;invalid&nbsp;spdelta&nbsp;&#34;</span><span class="op">,</span>&nbsp;<span class="ident">hex</span><span class="op">(</span><span class="ident">f</span><span class="op">.</span><span class="ident">entry</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="string">&#34;&nbsp;&#34;</span><span class="op">,</span>&nbsp;<span class="ident">hex</span><span class="op">(</span><span class="ident">targetpc</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="string">&#34;&nbsp;&#34;</span><span class="op">,</span>&nbsp;<span class="ident">hex</span><span class="op">(</span><span class="ident">f</span><span class="op">.</span><span class="ident">pcsp</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="string">&#34;&nbsp;&#34;</span><span class="op">,</span>&nbsp;<span class="ident">x</span><span class="op">,</span>&nbsp;<span class="string">&#34;\n&#34;</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">x</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword">func</span>&nbsp;<span class="ident">pcdatavalue</span><span class="op">(</span><span class="ident">f</span>&nbsp;<span class="op">*</span><span class="ident">_func</span><span class="op">,</span>&nbsp;<span class="ident">table</span>&nbsp;<span class="builtintype">int32</span><span class="op">,</span>&nbsp;<span class="ident">targetpc</span>&nbsp;<span class="builtintype">uintptr</span><span class="op">)</span>&nbsp;<span class="builtintype">int32</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">table</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">table</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">npcdata</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="op">-</span><span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">off</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="op">*</span><span class="op">(</span><span class="op">*</span><span class="builtintype">int32</span><span class="op">)</span><span class="op">(</span><span class="ident">add</span><span class="op">(</span><span class="ident">unsafe</span><span class="op">.</span><span class="ident">Pointer</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">f</span><span class="op">.</span><span class="ident">nfuncdata</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="ident">unsafe</span><span class="op">.</span><span class="ident">Sizeof</span><span class="op">(</span><span class="ident">f</span><span class="op">.</span><span class="ident">nfuncdata</span><span class="op">)</span><span class="op">+</span><span class="builtintype">uintptr</span><span class="op">(</span><span class="ident">table</span><span class="op">)</span><span class="op">*</span><span class="num">4</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">pcvalue</span><span class="op">(</span><span class="ident">f</span><span class="op">,</span>&nbsp;<span class="ident">off</span><span class="op">,</span>&nbsp;<span class="ident">targetpc</span><span class="op">,</span>&nbsp;<span class="ident">true</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">funcdata</span><span class="op">(</span><span class="ident">f</span>&nbsp;<span class="op">*</span><span class="ident">_func</span><span class="op">,</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="builtintype">int32</span><span class="op">)</span>&nbsp;<span class="ident">unsafe</span><span class="op">.</span><span class="ident">Pointer</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">nfuncdata</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">add</span><span class="op">(</span><span class="ident">unsafe</span><span class="op">.</span><span class="ident">Pointer</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">f</span><span class="op">.</span><span class="ident">nfuncdata</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="ident">unsafe</span><span class="op">.</span><span class="ident">Sizeof</span><span class="op">(</span><span class="ident">f</span><span class="op">.</span><span class="ident">nfuncdata</span><span class="op">)</span><span class="op">+</span><span class="builtintype">uintptr</span><span class="op">(</span><span class="ident">f</span><span class="op">.</span><span class="ident">npcdata</span><span class="op">)</span><span class="op">*</span><span class="num">4</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">ptrSize</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">8</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="builtintype">uintptr</span><span class="op">(</span><span class="ident">p</span><span class="op">)</span><span class="op">&amp;</span><span class="num">4</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="builtintype">uintptr</span><span class="op">(</span><span class="ident">unsafe</span><span class="op">.</span><span class="ident">Pointer</span><span class="op">(</span><span class="ident">f</span><span class="op">)</span><span class="op">)</span><span class="op">&amp;</span><span class="num">4</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">println</span><span class="op">(</span><span class="string">&#34;runtime:&nbsp;misaligned&nbsp;func&#34;</span><span class="op">,</span>&nbsp;<span class="ident">f</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">add</span><span class="op">(</span><span class="ident">p</span><span class="op">,</span>&nbsp;<span class="num">4</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="op">*</span><span class="op">(</span><span class="op">*</span><span class="ident">unsafe</span><span class="op">.</span><span class="ident">Pointer</span><span class="op">)</span><span class="op">(</span><span class="ident">add</span><span class="op">(</span><span class="ident">p</span><span class="op">,</span>&nbsp;<span class="builtintype">uintptr</span><span class="op">(</span><span class="ident">i</span><span class="op">)</span><span class="op">*</span><span class="ident">ptrSize</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno">255</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;step&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;pc,&nbsp;value&nbsp;pair&nbsp;in&nbsp;the&nbsp;encoded&nbsp;table.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">step</span><span class="op">(</span><span class="ident">p</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="ident">pc</span>&nbsp;<span class="op">*</span><span class="builtintype">uintptr</span><span class="op">,</span>&nbsp;<span class="ident">val</span>&nbsp;<span class="op">*</span><span class="builtintype">int32</span><span class="op">,</span>&nbsp;<span class="ident">first</span>&nbsp;<span class="builtintype">bool</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">newp</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="ident">ok</span>&nbsp;<span class="builtintype">bool</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p</span><span class="op">,</span>&nbsp;<span class="ident">uvdelta</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">readvarint</span><span class="op">(</span><span class="ident">p</span><span class="op">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">uvdelta</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="op">!</span><span class="ident">first</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">nil</span><span class="op">,</span>&nbsp;<span class="ident">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">uvdelta</span><span class="op">&amp;</span><span class="num">1</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">uvdelta</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">^</span><span class="op">(</span><span class="ident">uvdelta</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">1</span><span class="op">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">uvdelta</span>&nbsp;<span class="op">&gt;&gt;=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">vdelta</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtintype">int32</span><span class="op">(</span><span class="ident">uvdelta</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p</span><span class="op">,</span>&nbsp;<span class="ident">pcdelta</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">readvarint</span><span class="op">(</span><span class="ident">p</span><span class="op">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">*</span><span class="ident">pc</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="builtintype">uintptr</span><span class="op">(</span><span class="ident">pcdelta</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">_PCQuantum</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">*</span><span class="ident">val</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">vdelta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">p</span><span class="op">,</span>&nbsp;<span class="ident">true</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="comment">//&nbsp;readvarint&nbsp;reads&nbsp;a&nbsp;varint&nbsp;from&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">readvarint</span><span class="op">(</span><span class="ident">p</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">newp</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="ident">val</span>&nbsp;<span class="builtintype">uint32</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">v</span><span class="op">,</span>&nbsp;<span class="ident">shift</span>&nbsp;<span class="builtintype">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">b</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">p</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">p</span><span class="op">[</span><span class="num">1</span><span class="op">:</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">v</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="op">(</span><span class="builtintype">uint32</span><span class="op">(</span><span class="ident">b</span><span class="op">)</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">0x7F</span><span class="op">)</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="ident">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">b</span><span class="op">&amp;</span><span class="num">0x80</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">shift</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="num">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">p</span><span class="op">,</span>&nbsp;<span class="ident">v</span><br>
<span class="lineno"></span><span class="op">}</span>
</div>
</body>
</html>
