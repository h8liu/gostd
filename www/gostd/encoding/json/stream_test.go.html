<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/json</h2>
<ul>
<li><a href="/gostd/encoding/json/bench_test.go.html">bench_test.go</a></li>
<li><a href="/gostd/encoding/json/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/json/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/encoding/json/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/json/encode_test.go.html">encode_test.go</a></li>
<li><a href="/gostd/encoding/json/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/json/fold.go.html">fold.go</a></li>
<li><a href="/gostd/encoding/json/fold_test.go.html">fold_test.go</a></li>
<li><a href="/gostd/encoding/json/indent.go.html">indent.go</a></li>
<li><a href="/gostd/encoding/json/scanner.go.html">scanner.go</a></li>
<li><a href="/gostd/encoding/json/scanner_test.go.html">scanner_test.go</a></li>
<li><a href="/gostd/encoding/json/stream.go.html">stream.go</a></li>
<li><a href="/gostd/encoding/json/stream_test.go.html">stream_test.go</a></li>
<li><a href="/gostd/encoding/json/tagkey_test.go.html">tagkey_test.go</a></li>
<li><a href="/gostd/encoding/json/tags.go.html">tags.go</a></li>
<li><a href="/gostd/encoding/json/tags_test.go.html">tags_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8320099">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8320155">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8320209">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8320260">package</span>&nbsp;<span class="ident" id="8320268">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8320274">import</span>&nbsp;<span class="op" id="8320281">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8320284">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8320293">&#34;io/ioutil&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8320306">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8320313">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8320324">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8320335">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8320345">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="8320348">//&nbsp;Test&nbsp;values&nbsp;for&nbsp;the&nbsp;stream&nbsp;test.</span><br>
<span class="lineno"></span><span class="comment" id="8320384">//&nbsp;One&nbsp;of&nbsp;each&nbsp;JSON&nbsp;kind.</span><br>
<span class="lineno"></span><span class="keyword" id="8320410">var</span>&nbsp;<span class="ident" id="8320414">streamTest</span>&nbsp;<span class="op" id="8320425">=</span>&nbsp;<span class="op" id="8320427">[</span><span class="op" id="8320428">]</span><span class="keyword" id="8320429">interface</span><span class="op" id="8320438">{</span><span class="op" id="8320439">}</span><span class="op" id="8320440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8320443">0.1</span><span class="op" id="8320446">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8320449">&#34;hello&#34;</span><span class="op" id="8320456">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8320459">nil</span><span class="op" id="8320462">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8320465">true</span><span class="op" id="8320469">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8320472">false</span><span class="op" id="8320477">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8320480">[</span><span class="op" id="8320481">]</span><span class="keyword" id="8320482">interface</span><span class="op" id="8320491">{</span><span class="op" id="8320492">}</span><span class="op" id="8320493">{</span><span class="string" id="8320494">&#34;a&#34;</span><span class="op" id="8320497">,</span>&nbsp;<span class="string" id="8320499">&#34;b&#34;</span><span class="op" id="8320502">,</span>&nbsp;<span class="string" id="8320504">&#34;c&#34;</span><span class="op" id="8320507">}</span><span class="op" id="8320508">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8320511">map</span><span class="op" id="8320514">[</span><span class="builtintype" id="8320515">string</span><span class="op" id="8320521">]</span><span class="keyword" id="8320522">interface</span><span class="op" id="8320531">{</span><span class="op" id="8320532">}</span><span class="op" id="8320533">{</span><span class="string" id="8320534">&#34;K&#34;</span><span class="op" id="8320539">:</span>&nbsp;<span class="string" id="8320541">&#34;Kelvin&#34;</span><span class="op" id="8320549">,</span>&nbsp;<span class="string" id="8320551">&#34;ß&#34;</span><span class="op" id="8320555">:</span>&nbsp;<span class="string" id="8320557">&#34;long&nbsp;s&#34;</span><span class="op" id="8320565">}</span><span class="op" id="8320566">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8320569">3.14</span><span class="op" id="8320573">,</span>&nbsp;<span class="comment" id="8320575">//&nbsp;another&nbsp;value&nbsp;to&nbsp;make&nbsp;sure&nbsp;something&nbsp;can&nbsp;follow&nbsp;map</span><br>
<span class="lineno"></span><span class="op" id="8320630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8320633">var</span>&nbsp;<span class="ident" id="8320637">streamEncoded</span>&nbsp;<span class="op" id="8320651">=</span>&nbsp;<span class="string" id="8320653">`0.1<br>
<span class="lineno">30</span>&#34;hello&#34;<br>
<span class="lineno"></span>null<br>
<span class="lineno"></span>true<br>
<span class="lineno"></span>false<br>
<span class="lineno"></span>[&#34;a&#34;,&#34;b&#34;,&#34;c&#34;]<br>
<span class="lineno">35</span>{&#34;ß&#34;:&#34;long&nbsp;s&#34;,&#34;K&#34;:&#34;Kelvin&#34;}<br>
<span class="lineno"></span>3.14<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8320735">func</span>&nbsp;<span class="ident" id="8320740">TestEncoder</span><span class="op" id="8320751">(</span><span class="ident" id="8320752">t</span>&nbsp;<span class="op" id="8320754">*</span><span class="ident" id="8320755">testing</span><span class="op" id="8320762">.</span><span class="ident" id="8320763">T</span><span class="op" id="8320764">)</span>&nbsp;<span class="op" id="8320766">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8320769">for</span>&nbsp;<span class="ident" id="8320773">i</span>&nbsp;<span class="op" id="8320775">:=</span>&nbsp;<span class="num" id="8320778">0</span><span class="op" id="8320779">;</span>&nbsp;<span class="ident" id="8320781">i</span>&nbsp;<span class="op" id="8320783">&lt;=</span>&nbsp;<span class="builtinfunc" id="8320786">len</span><span class="op" id="8320789">(</span><span class="ident" id="8320790">streamTest</span><span class="op" id="8320800">)</span><span class="op" id="8320801">;</span>&nbsp;<span class="ident" id="8320803">i</span><span class="op" id="8320804">++</span>&nbsp;<span class="op" id="8320807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8320811">var</span>&nbsp;<span class="ident" id="8320815">buf</span>&nbsp;<span class="ident" id="8320819">bytes</span><span class="op" id="8320824">.</span><span class="ident" id="8320825">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8320834">enc</span>&nbsp;<span class="op" id="8320838">:=</span>&nbsp;<span class="ident" id="8320841">NewEncoder</span><span class="op" id="8320851">(</span><span class="op" id="8320852">&amp;</span><span class="ident" id="8320853">buf</span><span class="op" id="8320856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8320860">for</span>&nbsp;<span class="ident" id="8320864">j</span><span class="op" id="8320865">,</span>&nbsp;<span class="ident" id="8320867">v</span>&nbsp;<span class="op" id="8320869">:=</span>&nbsp;<span class="keyword" id="8320872">range</span>&nbsp;<span class="ident" id="8320878">streamTest</span><span class="op" id="8320888">[</span><span class="num" id="8320889">0</span><span class="op" id="8320890">:</span><span class="ident" id="8320891">i</span><span class="op" id="8320892">]</span>&nbsp;<span class="op" id="8320894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8320899">if</span>&nbsp;<span class="ident" id="8320902">err</span>&nbsp;<span class="op" id="8320906">:=</span>&nbsp;<span class="ident" id="8320909">enc</span><span class="op" id="8320912">.</span><span class="ident" id="8320913">Encode</span><span class="op" id="8320919">(</span><span class="ident" id="8320920">v</span><span class="op" id="8320921">)</span><span class="op" id="8320922">;</span>&nbsp;<span class="ident" id="8320924">err</span>&nbsp;<span class="op" id="8320928">!=</span>&nbsp;<span class="ident" id="8320931">nil</span>&nbsp;<span class="op" id="8320935">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8320941">t</span><span class="op" id="8320942">.</span><span class="ident" id="8320943">Fatalf</span><span class="op" id="8320949">(</span><span class="string" id="8320950">&#34;encode&nbsp;#%d:&nbsp;%v&#34;</span><span class="op" id="8320966">,</span>&nbsp;<span class="ident" id="8320968">j</span><span class="op" id="8320969">,</span>&nbsp;<span class="ident" id="8320971">err</span><span class="op" id="8320974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8320979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8320983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8320987">if</span>&nbsp;<span class="ident" id="8320990">have</span><span class="op" id="8320994">,</span>&nbsp;<span class="ident" id="8320996">want</span>&nbsp;<span class="op" id="8321001">:=</span>&nbsp;<span class="ident" id="8321004">buf</span><span class="op" id="8321007">.</span><span class="ident" id="8321008">String</span><span class="op" id="8321014">(</span><span class="op" id="8321015">)</span><span class="op" id="8321016">,</span>&nbsp;<span class="ident" id="8321018">nlines</span><span class="op" id="8321024">(</span><span class="ident" id="8321025">streamEncoded</span><span class="op" id="8321038">,</span>&nbsp;<span class="ident" id="8321040">i</span><span class="op" id="8321041">)</span><span class="op" id="8321042">;</span>&nbsp;<span class="ident" id="8321044">have</span>&nbsp;<span class="op" id="8321049">!=</span>&nbsp;<span class="ident" id="8321052">want</span>&nbsp;<span class="op" id="8321057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321062">t</span><span class="op" id="8321063">.</span><span class="ident" id="8321064">Errorf</span><span class="op" id="8321070">(</span><span class="string" id="8321071">&#34;encoding&nbsp;%d&nbsp;items:&nbsp;mismatch&#34;</span><span class="op" id="8321100">,</span>&nbsp;<span class="ident" id="8321102">i</span><span class="op" id="8321103">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321108">diff</span><span class="op" id="8321112">(</span><span class="ident" id="8321113">t</span><span class="op" id="8321114">,</span>&nbsp;<span class="op" id="8321116">[</span><span class="op" id="8321117">]</span><span class="builtintype" id="8321118">byte</span><span class="op" id="8321122">(</span><span class="ident" id="8321123">have</span><span class="op" id="8321127">)</span><span class="op" id="8321128">,</span>&nbsp;<span class="op" id="8321130">[</span><span class="op" id="8321131">]</span><span class="builtintype" id="8321132">byte</span><span class="op" id="8321136">(</span><span class="ident" id="8321137">want</span><span class="op" id="8321141">)</span><span class="op" id="8321142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321147">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8321155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8321158">}</span><br>
<span class="lineno"></span><span class="op" id="8321160">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="8321163">func</span>&nbsp;<span class="ident" id="8321168">TestDecoder</span><span class="op" id="8321179">(</span><span class="ident" id="8321180">t</span>&nbsp;<span class="op" id="8321182">*</span><span class="ident" id="8321183">testing</span><span class="op" id="8321190">.</span><span class="ident" id="8321191">T</span><span class="op" id="8321192">)</span>&nbsp;<span class="op" id="8321194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321197">for</span>&nbsp;<span class="ident" id="8321201">i</span>&nbsp;<span class="op" id="8321203">:=</span>&nbsp;<span class="num" id="8321206">0</span><span class="op" id="8321207">;</span>&nbsp;<span class="ident" id="8321209">i</span>&nbsp;<span class="op" id="8321211">&lt;=</span>&nbsp;<span class="builtinfunc" id="8321214">len</span><span class="op" id="8321217">(</span><span class="ident" id="8321218">streamTest</span><span class="op" id="8321228">)</span><span class="op" id="8321229">;</span>&nbsp;<span class="ident" id="8321231">i</span><span class="op" id="8321232">++</span>&nbsp;<span class="op" id="8321235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8321239">//&nbsp;Use&nbsp;stream&nbsp;without&nbsp;newlines&nbsp;as&nbsp;input,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8321282">//&nbsp;just&nbsp;to&nbsp;stress&nbsp;the&nbsp;decoder&nbsp;even&nbsp;more.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8321325">//&nbsp;Our&nbsp;test&nbsp;input&nbsp;does&nbsp;not&nbsp;include&nbsp;back-to-back&nbsp;numbers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8321384">//&nbsp;Otherwise&nbsp;stripping&nbsp;the&nbsp;newlines&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8321428">//&nbsp;merge&nbsp;two&nbsp;adjacent&nbsp;JSON&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321465">var</span>&nbsp;<span class="ident" id="8321469">buf</span>&nbsp;<span class="ident" id="8321473">bytes</span><span class="op" id="8321478">.</span><span class="ident" id="8321479">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321488">for</span>&nbsp;<span class="ident" id="8321492">_</span><span class="op" id="8321493">,</span>&nbsp;<span class="ident" id="8321495">c</span>&nbsp;<span class="op" id="8321497">:=</span>&nbsp;<span class="keyword" id="8321500">range</span>&nbsp;<span class="ident" id="8321506">nlines</span><span class="op" id="8321512">(</span><span class="ident" id="8321513">streamEncoded</span><span class="op" id="8321526">,</span>&nbsp;<span class="ident" id="8321528">i</span><span class="op" id="8321529">)</span>&nbsp;<span class="op" id="8321531">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321536">if</span>&nbsp;<span class="ident" id="8321539">c</span>&nbsp;<span class="op" id="8321541">!=</span>&nbsp;<span class="string" id="8321544">&#39;\n&#39;</span>&nbsp;<span class="op" id="8321549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321555">buf</span><span class="op" id="8321558">.</span><span class="ident" id="8321559">WriteRune</span><span class="op" id="8321568">(</span><span class="ident" id="8321569">c</span><span class="op" id="8321570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8321575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8321579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321583">out</span>&nbsp;<span class="op" id="8321587">:=</span>&nbsp;<span class="builtinfunc" id="8321590">make</span><span class="op" id="8321594">(</span><span class="op" id="8321595">[</span><span class="op" id="8321596">]</span><span class="keyword" id="8321597">interface</span><span class="op" id="8321606">{</span><span class="op" id="8321607">}</span><span class="op" id="8321608">,</span>&nbsp;<span class="ident" id="8321610">i</span><span class="op" id="8321611">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321615">dec</span>&nbsp;<span class="op" id="8321619">:=</span>&nbsp;<span class="ident" id="8321622">NewDecoder</span><span class="op" id="8321632">(</span><span class="op" id="8321633">&amp;</span><span class="ident" id="8321634">buf</span><span class="op" id="8321637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321641">for</span>&nbsp;<span class="ident" id="8321645">j</span>&nbsp;<span class="op" id="8321647">:=</span>&nbsp;<span class="keyword" id="8321650">range</span>&nbsp;<span class="ident" id="8321656">out</span>&nbsp;<span class="op" id="8321660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321665">if</span>&nbsp;<span class="ident" id="8321668">err</span>&nbsp;<span class="op" id="8321672">:=</span>&nbsp;<span class="ident" id="8321675">dec</span><span class="op" id="8321678">.</span><span class="ident" id="8321679">Decode</span><span class="op" id="8321685">(</span><span class="op" id="8321686">&amp;</span><span class="ident" id="8321687">out</span><span class="op" id="8321690">[</span><span class="ident" id="8321691">j</span><span class="op" id="8321692">]</span><span class="op" id="8321693">)</span><span class="op" id="8321694">;</span>&nbsp;<span class="ident" id="8321696">err</span>&nbsp;<span class="op" id="8321700">!=</span>&nbsp;<span class="ident" id="8321703">nil</span>&nbsp;<span class="op" id="8321707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321713">t</span><span class="op" id="8321714">.</span><span class="ident" id="8321715">Fatalf</span><span class="op" id="8321721">(</span><span class="string" id="8321722">&#34;decode&nbsp;#%d/%d:&nbsp;%v&#34;</span><span class="op" id="8321741">,</span>&nbsp;<span class="ident" id="8321743">j</span><span class="op" id="8321744">,</span>&nbsp;<span class="ident" id="8321746">i</span><span class="op" id="8321747">,</span>&nbsp;<span class="ident" id="8321749">err</span><span class="op" id="8321752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8321757">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8321761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321765">if</span>&nbsp;<span class="op" id="8321768">!</span><span class="ident" id="8321769">reflect</span><span class="op" id="8321776">.</span><span class="ident" id="8321777">DeepEqual</span><span class="op" id="8321786">(</span><span class="ident" id="8321787">out</span><span class="op" id="8321790">,</span>&nbsp;<span class="ident" id="8321792">streamTest</span><span class="op" id="8321802">[</span><span class="num" id="8321803">0</span><span class="op" id="8321804">:</span><span class="ident" id="8321805">i</span><span class="op" id="8321806">]</span><span class="op" id="8321807">)</span>&nbsp;<span class="op" id="8321809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321814">t</span><span class="op" id="8321815">.</span><span class="ident" id="8321816">Errorf</span><span class="op" id="8321822">(</span><span class="string" id="8321823">&#34;decoding&nbsp;%d&nbsp;items:&nbsp;mismatch&#34;</span><span class="op" id="8321852">,</span>&nbsp;<span class="ident" id="8321854">i</span><span class="op" id="8321855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321860">for</span>&nbsp;<span class="ident" id="8321864">j</span>&nbsp;<span class="op" id="8321866">:=</span>&nbsp;<span class="keyword" id="8321869">range</span>&nbsp;<span class="ident" id="8321875">out</span>&nbsp;<span class="op" id="8321879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321885">if</span>&nbsp;<span class="op" id="8321888">!</span><span class="ident" id="8321889">reflect</span><span class="op" id="8321896">.</span><span class="ident" id="8321897">DeepEqual</span><span class="op" id="8321906">(</span><span class="ident" id="8321907">out</span><span class="op" id="8321910">[</span><span class="ident" id="8321911">j</span><span class="op" id="8321912">]</span><span class="op" id="8321913">,</span>&nbsp;<span class="ident" id="8321915">streamTest</span><span class="op" id="8321925">[</span><span class="ident" id="8321926">j</span><span class="op" id="8321927">]</span><span class="op" id="8321928">)</span>&nbsp;<span class="op" id="8321930">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321937">t</span><span class="op" id="8321938">.</span><span class="ident" id="8321939">Errorf</span><span class="op" id="8321945">(</span><span class="string" id="8321946">&#34;#%d:&nbsp;have&nbsp;%v&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8321968">,</span>&nbsp;<span class="ident" id="8321970">j</span><span class="op" id="8321971">,</span>&nbsp;<span class="ident" id="8321973">out</span><span class="op" id="8321976">[</span><span class="ident" id="8321977">j</span><span class="op" id="8321978">]</span><span class="op" id="8321979">,</span>&nbsp;<span class="ident" id="8321981">streamTest</span><span class="op" id="8321991">[</span><span class="ident" id="8321992">j</span><span class="op" id="8321993">]</span><span class="op" id="8321994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8322000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8322005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322010">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8322018">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8322021">}</span><br>
<span class="lineno"></span><span class="op" id="8322023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8322026">func</span>&nbsp;<span class="ident" id="8322031">TestDecoderBuffered</span><span class="op" id="8322050">(</span><span class="ident" id="8322051">t</span>&nbsp;<span class="op" id="8322053">*</span><span class="ident" id="8322054">testing</span><span class="op" id="8322061">.</span><span class="ident" id="8322062">T</span><span class="op" id="8322063">)</span>&nbsp;<span class="op" id="8322065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322068">r</span>&nbsp;<span class="op" id="8322070">:=</span>&nbsp;<span class="ident" id="8322073">strings</span><span class="op" id="8322080">.</span><span class="ident" id="8322081">NewReader</span><span class="op" id="8322090">(</span><span class="string" id="8322091">`{&#34;Name&#34;:&nbsp;&#34;Gopher&#34;}&nbsp;extra&nbsp;`</span><span class="op" id="8322118">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322121">var</span>&nbsp;<span class="ident" id="8322125">m</span>&nbsp;<span class="keyword" id="8322127">struct</span>&nbsp;<span class="op" id="8322134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322138">Name</span>&nbsp;<span class="builtintype" id="8322143">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8322151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322154">d</span>&nbsp;<span class="op" id="8322156">:=</span>&nbsp;<span class="ident" id="8322159">NewDecoder</span><span class="op" id="8322169">(</span><span class="ident" id="8322170">r</span><span class="op" id="8322171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322174">err</span>&nbsp;<span class="op" id="8322178">:=</span>&nbsp;<span class="ident" id="8322181">d</span><span class="op" id="8322182">.</span><span class="ident" id="8322183">Decode</span><span class="op" id="8322189">(</span><span class="op" id="8322190">&amp;</span><span class="ident" id="8322191">m</span><span class="op" id="8322192">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322195">if</span>&nbsp;<span class="ident" id="8322198">err</span>&nbsp;<span class="op" id="8322202">!=</span>&nbsp;<span class="ident" id="8322205">nil</span>&nbsp;<span class="op" id="8322209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322213">t</span><span class="op" id="8322214">.</span><span class="ident" id="8322215">Fatal</span><span class="op" id="8322220">(</span><span class="ident" id="8322221">err</span><span class="op" id="8322224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8322227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322230">if</span>&nbsp;<span class="ident" id="8322233">m</span><span class="op" id="8322234">.</span><span class="ident" id="8322235">Name</span>&nbsp;<span class="op" id="8322240">!=</span>&nbsp;<span class="string" id="8322243">&#34;Gopher&#34;</span>&nbsp;<span class="op" id="8322252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322256">t</span><span class="op" id="8322257">.</span><span class="ident" id="8322258">Errorf</span><span class="op" id="8322264">(</span><span class="string" id="8322265">&#34;Name&nbsp;=&nbsp;%q;&nbsp;want&nbsp;Gopher&#34;</span><span class="op" id="8322289">,</span>&nbsp;<span class="ident" id="8322291">m</span><span class="op" id="8322292">.</span><span class="ident" id="8322293">Name</span><span class="op" id="8322297">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8322300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322303">rest</span><span class="op" id="8322307">,</span>&nbsp;<span class="ident" id="8322309">err</span>&nbsp;<span class="op" id="8322313">:=</span>&nbsp;<span class="ident" id="8322316">ioutil</span><span class="op" id="8322322">.</span><span class="ident" id="8322323">ReadAll</span><span class="op" id="8322330">(</span><span class="ident" id="8322331">d</span><span class="op" id="8322332">.</span><span class="ident" id="8322333">Buffered</span><span class="op" id="8322341">(</span><span class="op" id="8322342">)</span><span class="op" id="8322343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322346">if</span>&nbsp;<span class="ident" id="8322349">err</span>&nbsp;<span class="op" id="8322353">!=</span>&nbsp;<span class="ident" id="8322356">nil</span>&nbsp;<span class="op" id="8322360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322364">t</span><span class="op" id="8322365">.</span><span class="ident" id="8322366">Fatal</span><span class="op" id="8322371">(</span><span class="ident" id="8322372">err</span><span class="op" id="8322375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8322378">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322381">if</span>&nbsp;<span class="ident" id="8322384">g</span><span class="op" id="8322385">,</span>&nbsp;<span class="ident" id="8322387">w</span>&nbsp;<span class="op" id="8322389">:=</span>&nbsp;<span class="builtintype" id="8322392">string</span><span class="op" id="8322398">(</span><span class="ident" id="8322399">rest</span><span class="op" id="8322403">)</span><span class="op" id="8322404">,</span>&nbsp;<span class="string" id="8322406">&#34;&nbsp;extra&nbsp;&#34;</span><span class="op" id="8322415">;</span>&nbsp;<span class="ident" id="8322417">g</span>&nbsp;<span class="op" id="8322419">!=</span>&nbsp;<span class="ident" id="8322422">w</span>&nbsp;<span class="op" id="8322424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322428">t</span><span class="op" id="8322429">.</span><span class="ident" id="8322430">Errorf</span><span class="op" id="8322436">(</span><span class="string" id="8322437">&#34;Remaining&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8322462">,</span>&nbsp;<span class="ident" id="8322464">g</span><span class="op" id="8322465">,</span>&nbsp;<span class="ident" id="8322467">w</span><span class="op" id="8322468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8322471">}</span><br>
<span class="lineno"></span><span class="op" id="8322473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="8322476">func</span>&nbsp;<span class="ident" id="8322481">nlines</span><span class="op" id="8322487">(</span><span class="ident" id="8322488">s</span>&nbsp;<span class="builtintype" id="8322490">string</span><span class="op" id="8322496">,</span>&nbsp;<span class="ident" id="8322498">n</span>&nbsp;<span class="builtintype" id="8322500">int</span><span class="op" id="8322503">)</span>&nbsp;<span class="builtintype" id="8322505">string</span>&nbsp;<span class="op" id="8322512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322515">if</span>&nbsp;<span class="ident" id="8322518">n</span>&nbsp;<span class="op" id="8322520">&lt;=</span>&nbsp;<span class="num" id="8322523">0</span>&nbsp;<span class="op" id="8322525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322529">return</span>&nbsp;<span class="string" id="8322536">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8322540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322543">for</span>&nbsp;<span class="ident" id="8322547">i</span><span class="op" id="8322548">,</span>&nbsp;<span class="ident" id="8322550">c</span>&nbsp;<span class="op" id="8322552">:=</span>&nbsp;<span class="keyword" id="8322555">range</span>&nbsp;<span class="ident" id="8322561">s</span>&nbsp;<span class="op" id="8322563">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322567">if</span>&nbsp;<span class="ident" id="8322570">c</span>&nbsp;<span class="op" id="8322572">==</span>&nbsp;<span class="string" id="8322575">&#39;\n&#39;</span>&nbsp;<span class="op" id="8322580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322585">if</span>&nbsp;<span class="ident" id="8322588">n</span><span class="op" id="8322589">--</span><span class="op" id="8322591">;</span>&nbsp;<span class="ident" id="8322593">n</span>&nbsp;<span class="op" id="8322595">==</span>&nbsp;<span class="num" id="8322598">0</span>&nbsp;<span class="op" id="8322600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322606">return</span>&nbsp;<span class="ident" id="8322613">s</span><span class="op" id="8322614">[</span><span class="num" id="8322615">0</span>&nbsp;<span class="op" id="8322617">:</span>&nbsp;<span class="ident" id="8322619">i</span><span class="op" id="8322620">+</span><span class="num" id="8322621">1</span><span class="op" id="8322622">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8322627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8322631">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8322634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322637">return</span>&nbsp;<span class="ident" id="8322644">s</span><br>
<span class="lineno"></span><span class="op" id="8322646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8322649">func</span>&nbsp;<span class="ident" id="8322654">TestRawMessage</span><span class="op" id="8322668">(</span><span class="ident" id="8322669">t</span>&nbsp;<span class="op" id="8322671">*</span><span class="ident" id="8322672">testing</span><span class="op" id="8322679">.</span><span class="ident" id="8322680">T</span><span class="op" id="8322681">)</span>&nbsp;<span class="op" id="8322683">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8322686">//&nbsp;TODO(rsc):&nbsp;Should&nbsp;not&nbsp;need&nbsp;the&nbsp;*&nbsp;in&nbsp;*RawMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322738">var</span>&nbsp;<span class="ident" id="8322742">data</span>&nbsp;<span class="keyword" id="8322747">struct</span>&nbsp;<span class="op" id="8322754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322758">X</span>&nbsp;&nbsp;<span class="builtintype" id="8322761">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322771">Id</span>&nbsp;<span class="op" id="8322774">*</span><span class="ident" id="8322775">RawMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322788">Y</span>&nbsp;&nbsp;<span class="builtintype" id="8322791">float32</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8322800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322803">const</span>&nbsp;<span class="ident" id="8322809">raw</span>&nbsp;<span class="op" id="8322813">=</span>&nbsp;<span class="string" id="8322815">`[&#34;\u0056&#34;,null]`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322834">const</span>&nbsp;<span class="ident" id="8322840">msg</span>&nbsp;<span class="op" id="8322844">=</span>&nbsp;<span class="string" id="8322846">`{&#34;X&#34;:0.1,&#34;Id&#34;:[&#34;\u0056&#34;,null],&#34;Y&#34;:0.2}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322888">err</span>&nbsp;<span class="op" id="8322892">:=</span>&nbsp;<span class="ident" id="8322895">Unmarshal</span><span class="op" id="8322904">(</span><span class="op" id="8322905">[</span><span class="op" id="8322906">]</span><span class="builtintype" id="8322907">byte</span><span class="op" id="8322911">(</span><span class="ident" id="8322912">msg</span><span class="op" id="8322915">)</span><span class="op" id="8322916">,</span>&nbsp;<span class="op" id="8322918">&amp;</span><span class="ident" id="8322919">data</span><span class="op" id="8322923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322926">if</span>&nbsp;<span class="ident" id="8322929">err</span>&nbsp;<span class="op" id="8322933">!=</span>&nbsp;<span class="ident" id="8322936">nil</span>&nbsp;<span class="op" id="8322940">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322944">t</span><span class="op" id="8322945">.</span><span class="ident" id="8322946">Fatalf</span><span class="op" id="8322952">(</span><span class="string" id="8322953">&#34;Unmarshal:&nbsp;%v&#34;</span><span class="op" id="8322968">,</span>&nbsp;<span class="ident" id="8322970">err</span><span class="op" id="8322973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8322976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322979">if</span>&nbsp;<span class="builtintype" id="8322982">string</span><span class="op" id="8322988">(</span><span class="op" id="8322989">[</span><span class="op" id="8322990">]</span><span class="builtintype" id="8322991">byte</span><span class="op" id="8322995">(</span><span class="op" id="8322996">*</span><span class="ident" id="8322997">data</span><span class="op" id="8323001">.</span><span class="ident" id="8323002">Id</span><span class="op" id="8323004">)</span><span class="op" id="8323005">)</span>&nbsp;<span class="op" id="8323007">!=</span>&nbsp;<span class="ident" id="8323010">raw</span>&nbsp;<span class="op" id="8323014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323018">t</span><span class="op" id="8323019">.</span><span class="ident" id="8323020">Fatalf</span><span class="op" id="8323026">(</span><span class="string" id="8323027">&#34;Raw&nbsp;mismatch:&nbsp;have&nbsp;%#q&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="8323060">,</span>&nbsp;<span class="op" id="8323062">[</span><span class="op" id="8323063">]</span><span class="builtintype" id="8323064">byte</span><span class="op" id="8323068">(</span><span class="op" id="8323069">*</span><span class="ident" id="8323070">data</span><span class="op" id="8323074">.</span><span class="ident" id="8323075">Id</span><span class="op" id="8323077">)</span><span class="op" id="8323078">,</span>&nbsp;<span class="ident" id="8323080">raw</span><span class="op" id="8323083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323086">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323089">b</span><span class="op" id="8323090">,</span>&nbsp;<span class="ident" id="8323092">err</span>&nbsp;<span class="op" id="8323096">:=</span>&nbsp;<span class="ident" id="8323099">Marshal</span><span class="op" id="8323106">(</span><span class="op" id="8323107">&amp;</span><span class="ident" id="8323108">data</span><span class="op" id="8323112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323115">if</span>&nbsp;<span class="ident" id="8323118">err</span>&nbsp;<span class="op" id="8323122">!=</span>&nbsp;<span class="ident" id="8323125">nil</span>&nbsp;<span class="op" id="8323129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323133">t</span><span class="op" id="8323134">.</span><span class="ident" id="8323135">Fatalf</span><span class="op" id="8323141">(</span><span class="string" id="8323142">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="8323155">,</span>&nbsp;<span class="ident" id="8323157">err</span><span class="op" id="8323160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323166">if</span>&nbsp;<span class="builtintype" id="8323169">string</span><span class="op" id="8323175">(</span><span class="ident" id="8323176">b</span><span class="op" id="8323177">)</span>&nbsp;<span class="op" id="8323179">!=</span>&nbsp;<span class="ident" id="8323182">msg</span>&nbsp;<span class="op" id="8323186">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323190">t</span><span class="op" id="8323191">.</span><span class="ident" id="8323192">Fatalf</span><span class="op" id="8323198">(</span><span class="string" id="8323199">&#34;Marshal:&nbsp;have&nbsp;%#q&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="8323227">,</span>&nbsp;<span class="ident" id="8323229">b</span><span class="op" id="8323230">,</span>&nbsp;<span class="ident" id="8323232">msg</span><span class="op" id="8323235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323238">}</span><br>
<span class="lineno"></span><span class="op" id="8323240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8323243">func</span>&nbsp;<span class="ident" id="8323248">TestNullRawMessage</span><span class="op" id="8323266">(</span><span class="ident" id="8323267">t</span>&nbsp;<span class="op" id="8323269">*</span><span class="ident" id="8323270">testing</span><span class="op" id="8323277">.</span><span class="ident" id="8323278">T</span><span class="op" id="8323279">)</span>&nbsp;<span class="op" id="8323281">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8323284">//&nbsp;TODO(rsc):&nbsp;Should&nbsp;not&nbsp;need&nbsp;the&nbsp;*&nbsp;in&nbsp;*RawMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323336">var</span>&nbsp;<span class="ident" id="8323340">data</span>&nbsp;<span class="keyword" id="8323345">struct</span>&nbsp;<span class="op" id="8323352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323356">X</span>&nbsp;&nbsp;<span class="builtintype" id="8323359">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323369">Id</span>&nbsp;<span class="op" id="8323372">*</span><span class="ident" id="8323373">RawMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323386">Y</span>&nbsp;&nbsp;<span class="builtintype" id="8323389">float32</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323401">data</span><span class="op" id="8323405">.</span><span class="ident" id="8323406">Id</span>&nbsp;<span class="op" id="8323409">=</span>&nbsp;<span class="builtinfunc" id="8323411">new</span><span class="op" id="8323414">(</span><span class="ident" id="8323415">RawMessage</span><span class="op" id="8323425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323428">const</span>&nbsp;<span class="ident" id="8323434">msg</span>&nbsp;<span class="op" id="8323438">=</span>&nbsp;<span class="string" id="8323440">`{&#34;X&#34;:0.1,&#34;Id&#34;:null,&#34;Y&#34;:0.2}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323471">err</span>&nbsp;<span class="op" id="8323475">:=</span>&nbsp;<span class="ident" id="8323478">Unmarshal</span><span class="op" id="8323487">(</span><span class="op" id="8323488">[</span><span class="op" id="8323489">]</span><span class="builtintype" id="8323490">byte</span><span class="op" id="8323494">(</span><span class="ident" id="8323495">msg</span><span class="op" id="8323498">)</span><span class="op" id="8323499">,</span>&nbsp;<span class="op" id="8323501">&amp;</span><span class="ident" id="8323502">data</span><span class="op" id="8323506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323509">if</span>&nbsp;<span class="ident" id="8323512">err</span>&nbsp;<span class="op" id="8323516">!=</span>&nbsp;<span class="ident" id="8323519">nil</span>&nbsp;<span class="op" id="8323523">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323527">t</span><span class="op" id="8323528">.</span><span class="ident" id="8323529">Fatalf</span><span class="op" id="8323535">(</span><span class="string" id="8323536">&#34;Unmarshal:&nbsp;%v&#34;</span><span class="op" id="8323551">,</span>&nbsp;<span class="ident" id="8323553">err</span><span class="op" id="8323556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323562">if</span>&nbsp;<span class="ident" id="8323565">data</span><span class="op" id="8323569">.</span><span class="ident" id="8323570">Id</span>&nbsp;<span class="op" id="8323573">!=</span>&nbsp;<span class="ident" id="8323576">nil</span>&nbsp;<span class="op" id="8323580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323584">t</span><span class="op" id="8323585">.</span><span class="ident" id="8323586">Fatalf</span><span class="op" id="8323592">(</span><span class="string" id="8323593">&#34;Raw&nbsp;mismatch:&nbsp;have&nbsp;non-nil,&nbsp;want&nbsp;nil&#34;</span><span class="op" id="8323631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323634">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323637">b</span><span class="op" id="8323638">,</span>&nbsp;<span class="ident" id="8323640">err</span>&nbsp;<span class="op" id="8323644">:=</span>&nbsp;<span class="ident" id="8323647">Marshal</span><span class="op" id="8323654">(</span><span class="op" id="8323655">&amp;</span><span class="ident" id="8323656">data</span><span class="op" id="8323660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323663">if</span>&nbsp;<span class="ident" id="8323666">err</span>&nbsp;<span class="op" id="8323670">!=</span>&nbsp;<span class="ident" id="8323673">nil</span>&nbsp;<span class="op" id="8323677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323681">t</span><span class="op" id="8323682">.</span><span class="ident" id="8323683">Fatalf</span><span class="op" id="8323689">(</span><span class="string" id="8323690">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="8323703">,</span>&nbsp;<span class="ident" id="8323705">err</span><span class="op" id="8323708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323714">if</span>&nbsp;<span class="builtintype" id="8323717">string</span><span class="op" id="8323723">(</span><span class="ident" id="8323724">b</span><span class="op" id="8323725">)</span>&nbsp;<span class="op" id="8323727">!=</span>&nbsp;<span class="ident" id="8323730">msg</span>&nbsp;<span class="op" id="8323734">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323738">t</span><span class="op" id="8323739">.</span><span class="ident" id="8323740">Fatalf</span><span class="op" id="8323746">(</span><span class="string" id="8323747">&#34;Marshal:&nbsp;have&nbsp;%#q&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="8323775">,</span>&nbsp;<span class="ident" id="8323777">b</span><span class="op" id="8323778">,</span>&nbsp;<span class="ident" id="8323780">msg</span><span class="op" id="8323783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323786">}</span><br>
<span class="lineno"></span><span class="op" id="8323788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8323791">var</span>&nbsp;<span class="ident" id="8323795">blockingTests</span>&nbsp;<span class="op" id="8323809">=</span>&nbsp;<span class="op" id="8323811">[</span><span class="op" id="8323812">]</span><span class="builtintype" id="8323813">string</span><span class="op" id="8323819">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8323822">`{&#34;x&#34;:&nbsp;1}`</span><span class="op" id="8323832">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8323835">`[1,&nbsp;2,&nbsp;3]`</span><span class="op" id="8323846">,</span><br>
<span class="lineno"></span><span class="op" id="8323848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8323851">func</span>&nbsp;<span class="ident" id="8323856">TestBlocking</span><span class="op" id="8323868">(</span><span class="ident" id="8323869">t</span>&nbsp;<span class="op" id="8323871">*</span><span class="ident" id="8323872">testing</span><span class="op" id="8323879">.</span><span class="ident" id="8323880">T</span><span class="op" id="8323881">)</span>&nbsp;<span class="op" id="8323883">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323886">for</span>&nbsp;<span class="ident" id="8323890">_</span><span class="op" id="8323891">,</span>&nbsp;<span class="ident" id="8323893">enc</span>&nbsp;<span class="op" id="8323897">:=</span>&nbsp;<span class="keyword" id="8323900">range</span>&nbsp;<span class="ident" id="8323906">blockingTests</span>&nbsp;<span class="op" id="8323920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323924">r</span><span class="op" id="8323925">,</span>&nbsp;<span class="ident" id="8323927">w</span>&nbsp;<span class="op" id="8323929">:=</span>&nbsp;<span class="ident" id="8323932">net</span><span class="op" id="8323935">.</span><span class="ident" id="8323936">Pipe</span><span class="op" id="8323940">(</span><span class="op" id="8323941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323945">go</span>&nbsp;<span class="ident" id="8323948">w</span><span class="op" id="8323949">.</span><span class="ident" id="8323950">Write</span><span class="op" id="8323955">(</span><span class="op" id="8323956">[</span><span class="op" id="8323957">]</span><span class="builtintype" id="8323958">byte</span><span class="op" id="8323962">(</span><span class="ident" id="8323963">enc</span><span class="op" id="8323966">)</span><span class="op" id="8323967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323971">var</span>&nbsp;<span class="ident" id="8323975">val</span>&nbsp;<span class="keyword" id="8323979">interface</span><span class="op" id="8323988">{</span><span class="op" id="8323989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8323994">//&nbsp;If&nbsp;Decode&nbsp;reads&nbsp;beyond&nbsp;what&nbsp;w.Write&nbsp;writes&nbsp;above,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8324049">//&nbsp;it&nbsp;will&nbsp;block,&nbsp;and&nbsp;the&nbsp;test&nbsp;will&nbsp;deadlock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324097">if</span>&nbsp;<span class="ident" id="8324100">err</span>&nbsp;<span class="op" id="8324104">:=</span>&nbsp;<span class="ident" id="8324107">NewDecoder</span><span class="op" id="8324117">(</span><span class="ident" id="8324118">r</span><span class="op" id="8324119">)</span><span class="op" id="8324120">.</span><span class="ident" id="8324121">Decode</span><span class="op" id="8324127">(</span><span class="op" id="8324128">&amp;</span><span class="ident" id="8324129">val</span><span class="op" id="8324132">)</span><span class="op" id="8324133">;</span>&nbsp;<span class="ident" id="8324135">err</span>&nbsp;<span class="op" id="8324139">!=</span>&nbsp;<span class="ident" id="8324142">nil</span>&nbsp;<span class="op" id="8324146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324151">t</span><span class="op" id="8324152">.</span><span class="ident" id="8324153">Errorf</span><span class="op" id="8324159">(</span><span class="string" id="8324160">&#34;decoding&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="8324177">,</span>&nbsp;<span class="ident" id="8324179">enc</span><span class="op" id="8324182">,</span>&nbsp;<span class="ident" id="8324184">err</span><span class="op" id="8324187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8324191">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324195">r</span><span class="op" id="8324196">.</span><span class="ident" id="8324197">Close</span><span class="op" id="8324202">(</span><span class="op" id="8324203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324207">w</span><span class="op" id="8324208">.</span><span class="ident" id="8324209">Close</span><span class="op" id="8324214">(</span><span class="op" id="8324215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8324218">}</span><br>
<span class="lineno"></span><span class="op" id="8324220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="keyword" id="8324223">func</span>&nbsp;<span class="ident" id="8324228">BenchmarkEncoderEncode</span><span class="op" id="8324250">(</span><span class="ident" id="8324251">b</span>&nbsp;<span class="op" id="8324253">*</span><span class="ident" id="8324254">testing</span><span class="op" id="8324261">.</span><span class="ident" id="8324262">B</span><span class="op" id="8324263">)</span>&nbsp;<span class="op" id="8324265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324268">b</span><span class="op" id="8324269">.</span><span class="ident" id="8324270">ReportAllocs</span><span class="op" id="8324282">(</span><span class="op" id="8324283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324286">type</span>&nbsp;<span class="ident" id="8324291">T</span>&nbsp;<span class="keyword" id="8324293">struct</span>&nbsp;<span class="op" id="8324300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324304">X</span><span class="op" id="8324305">,</span>&nbsp;<span class="ident" id="8324307">Y</span>&nbsp;<span class="builtintype" id="8324309">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8324317">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324320">v</span>&nbsp;<span class="op" id="8324322">:=</span>&nbsp;<span class="op" id="8324325">&amp;</span><span class="ident" id="8324326">T</span><span class="op" id="8324327">{</span><span class="string" id="8324328">&#34;foo&#34;</span><span class="op" id="8324333">,</span>&nbsp;<span class="string" id="8324335">&#34;bar&#34;</span><span class="op" id="8324340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324343">for</span>&nbsp;<span class="ident" id="8324347">i</span>&nbsp;<span class="op" id="8324349">:=</span>&nbsp;<span class="num" id="8324352">0</span><span class="op" id="8324353">;</span>&nbsp;<span class="ident" id="8324355">i</span>&nbsp;<span class="op" id="8324357">&lt;</span>&nbsp;<span class="ident" id="8324359">b</span><span class="op" id="8324360">.</span><span class="ident" id="8324361">N</span><span class="op" id="8324362">;</span>&nbsp;<span class="ident" id="8324364">i</span><span class="op" id="8324365">++</span>&nbsp;<span class="op" id="8324368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324372">if</span>&nbsp;<span class="ident" id="8324375">err</span>&nbsp;<span class="op" id="8324379">:=</span>&nbsp;<span class="ident" id="8324382">NewEncoder</span><span class="op" id="8324392">(</span><span class="ident" id="8324393">ioutil</span><span class="op" id="8324399">.</span><span class="ident" id="8324400">Discard</span><span class="op" id="8324407">)</span><span class="op" id="8324408">.</span><span class="ident" id="8324409">Encode</span><span class="op" id="8324415">(</span><span class="ident" id="8324416">v</span><span class="op" id="8324417">)</span><span class="op" id="8324418">;</span>&nbsp;<span class="ident" id="8324420">err</span>&nbsp;<span class="op" id="8324424">!=</span>&nbsp;<span class="ident" id="8324427">nil</span>&nbsp;<span class="op" id="8324431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324436">b</span><span class="op" id="8324437">.</span><span class="ident" id="8324438">Fatal</span><span class="op" id="8324443">(</span><span class="ident" id="8324444">err</span><span class="op" id="8324447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8324451">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8324454">}</span><br>
<span class="lineno"></span><span class="op" id="8324456">}</span>
</div>
</body>
</html>
