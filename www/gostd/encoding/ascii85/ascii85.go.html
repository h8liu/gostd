<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/ascii85</h2>
<ul>
<li><a href="/gostd/encoding/ascii85/ascii85.go.html">ascii85.go</a></li>
<li><a href="/gostd/encoding/ascii85/ascii85_test.go.html">ascii85_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5891847">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5891902">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5891956">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5892007">//&nbsp;Package&nbsp;ascii85&nbsp;implements&nbsp;the&nbsp;ascii85&nbsp;data&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="5892063">//&nbsp;as&nbsp;used&nbsp;in&nbsp;the&nbsp;btoa&nbsp;tool&nbsp;and&nbsp;Adobe&#39;s&nbsp;PostScript&nbsp;and&nbsp;PDF&nbsp;document&nbsp;formats.</span><br>
<span class="lineno"></span><span class="keyword" id="5892140">package</span>&nbsp;<span class="ident" id="5892148">ascii85</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5892157">import</span>&nbsp;<span class="op" id="5892164">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5892167">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5892173">&#34;strconv&#34;</span><br>
<span class="lineno"></span><span class="op" id="5892183">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5892186">/*<br>
<span class="lineno">15</span>&nbsp;*&nbsp;Encoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5892205">//&nbsp;Encode&nbsp;encodes&nbsp;src&nbsp;into&nbsp;at&nbsp;most&nbsp;MaxEncodedLen(len(src))</span><br>
<span class="lineno"></span><span class="comment" id="5892264">//&nbsp;bytes&nbsp;of&nbsp;dst,&nbsp;returning&nbsp;the&nbsp;actual&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">20</span><span class="comment" id="5892327">//</span><br>
<span class="lineno"></span><span class="comment" id="5892330">//&nbsp;The&nbsp;encoding&nbsp;handles&nbsp;4-byte&nbsp;chunks,&nbsp;using&nbsp;a&nbsp;special&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="5892394">//&nbsp;for&nbsp;the&nbsp;last&nbsp;fragment,&nbsp;so&nbsp;Encode&nbsp;is&nbsp;not&nbsp;appropriate&nbsp;for&nbsp;use&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="5892460">//&nbsp;individual&nbsp;blocks&nbsp;of&nbsp;a&nbsp;large&nbsp;data&nbsp;stream.&nbsp;&nbsp;Use&nbsp;NewEncoder()&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="5892532">//</span><br>
<span class="lineno">25</span><span class="comment" id="5892535">//&nbsp;Often,&nbsp;ascii85-encoded&nbsp;data&nbsp;is&nbsp;wrapped&nbsp;in&nbsp;&lt;~&nbsp;and&nbsp;~&gt;&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="comment" id="5892599">//&nbsp;Encode&nbsp;does&nbsp;not&nbsp;add&nbsp;these.</span><br>
<span class="lineno"></span><span class="keyword" id="5892629">func</span>&nbsp;<span class="ident" id="5892634">Encode</span><span class="op" id="5892640">(</span><span class="ident" id="5892641">dst</span><span class="op" id="5892644">,</span>&nbsp;<span class="ident" id="5892646">src</span>&nbsp;<span class="op" id="5892650">[</span><span class="op" id="5892651">]</span><span class="builtintype" id="5892652">byte</span><span class="op" id="5892656">)</span>&nbsp;<span class="builtintype" id="5892658">int</span>&nbsp;<span class="op" id="5892662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5892665">if</span>&nbsp;<span class="builtinfunc" id="5892668">len</span><span class="op" id="5892671">(</span><span class="ident" id="5892672">src</span><span class="op" id="5892675">)</span>&nbsp;<span class="op" id="5892677">==</span>&nbsp;<span class="num" id="5892680">0</span>&nbsp;<span class="op" id="5892682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5892686">return</span>&nbsp;<span class="num" id="5892693">0</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5892696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5892700">n</span>&nbsp;<span class="op" id="5892702">:=</span>&nbsp;<span class="num" id="5892705">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5892708">for</span>&nbsp;<span class="builtinfunc" id="5892712">len</span><span class="op" id="5892715">(</span><span class="ident" id="5892716">src</span><span class="op" id="5892719">)</span>&nbsp;<span class="op" id="5892721">&gt;</span>&nbsp;<span class="num" id="5892723">0</span>&nbsp;<span class="op" id="5892725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5892729">dst</span><span class="op" id="5892732">[</span><span class="num" id="5892733">0</span><span class="op" id="5892734">]</span>&nbsp;<span class="op" id="5892736">=</span>&nbsp;<span class="num" id="5892738">0</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5892742">dst</span><span class="op" id="5892745">[</span><span class="num" id="5892746">1</span><span class="op" id="5892747">]</span>&nbsp;<span class="op" id="5892749">=</span>&nbsp;<span class="num" id="5892751">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5892755">dst</span><span class="op" id="5892758">[</span><span class="num" id="5892759">2</span><span class="op" id="5892760">]</span>&nbsp;<span class="op" id="5892762">=</span>&nbsp;<span class="num" id="5892764">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5892768">dst</span><span class="op" id="5892771">[</span><span class="num" id="5892772">3</span><span class="op" id="5892773">]</span>&nbsp;<span class="op" id="5892775">=</span>&nbsp;<span class="num" id="5892777">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5892781">dst</span><span class="op" id="5892784">[</span><span class="num" id="5892785">4</span><span class="op" id="5892786">]</span>&nbsp;<span class="op" id="5892788">=</span>&nbsp;<span class="num" id="5892790">0</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5892795">//&nbsp;Unpack&nbsp;4&nbsp;bytes&nbsp;into&nbsp;uint32&nbsp;to&nbsp;repack&nbsp;into&nbsp;base&nbsp;85&nbsp;5-byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5892858">var</span>&nbsp;<span class="ident" id="5892862">v</span>&nbsp;<span class="builtintype" id="5892864">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5892873">switch</span>&nbsp;<span class="builtinfunc" id="5892880">len</span><span class="op" id="5892883">(</span><span class="ident" id="5892884">src</span><span class="op" id="5892887">)</span>&nbsp;<span class="op" id="5892889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5892893">default</span><span class="op" id="5892900">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5892905">v</span>&nbsp;<span class="op" id="5892907">|=</span>&nbsp;<span class="builtintype" id="5892910">uint32</span><span class="op" id="5892916">(</span><span class="ident" id="5892917">src</span><span class="op" id="5892920">[</span><span class="num" id="5892921">3</span><span class="op" id="5892922">]</span><span class="op" id="5892923">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5892928">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5892942">case</span>&nbsp;<span class="num" id="5892947">3</span><span class="op" id="5892948">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5892953">v</span>&nbsp;<span class="op" id="5892955">|=</span>&nbsp;<span class="builtintype" id="5892958">uint32</span><span class="op" id="5892964">(</span><span class="ident" id="5892965">src</span><span class="op" id="5892968">[</span><span class="num" id="5892969">2</span><span class="op" id="5892970">]</span><span class="op" id="5892971">)</span>&nbsp;<span class="op" id="5892973">&lt;&lt;</span>&nbsp;<span class="num" id="5892976">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5892981">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5892995">case</span>&nbsp;<span class="num" id="5893000">2</span><span class="op" id="5893001">:</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5893006">v</span>&nbsp;<span class="op" id="5893008">|=</span>&nbsp;<span class="builtintype" id="5893011">uint32</span><span class="op" id="5893017">(</span><span class="ident" id="5893018">src</span><span class="op" id="5893021">[</span><span class="num" id="5893022">1</span><span class="op" id="5893023">]</span><span class="op" id="5893024">)</span>&nbsp;<span class="op" id="5893026">&lt;&lt;</span>&nbsp;<span class="num" id="5893029">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5893035">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5893049">case</span>&nbsp;<span class="num" id="5893054">1</span><span class="op" id="5893055">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5893060">v</span>&nbsp;<span class="op" id="5893062">|=</span>&nbsp;<span class="builtintype" id="5893065">uint32</span><span class="op" id="5893071">(</span><span class="ident" id="5893072">src</span><span class="op" id="5893075">[</span><span class="num" id="5893076">0</span><span class="op" id="5893077">]</span><span class="op" id="5893078">)</span>&nbsp;<span class="op" id="5893080">&lt;&lt;</span>&nbsp;<span class="num" id="5893083">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5893088">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5893093">//&nbsp;Special&nbsp;case:&nbsp;zero&nbsp;(!!!!!)&nbsp;shortens&nbsp;to&nbsp;z.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5893140">if</span>&nbsp;<span class="ident" id="5893143">v</span>&nbsp;<span class="op" id="5893145">==</span>&nbsp;<span class="num" id="5893148">0</span>&nbsp;<span class="op" id="5893150">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5893153">len</span><span class="op" id="5893156">(</span><span class="ident" id="5893157">src</span><span class="op" id="5893160">)</span>&nbsp;<span class="op" id="5893162">&gt;=</span>&nbsp;<span class="num" id="5893165">4</span>&nbsp;<span class="op" id="5893167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5893172">dst</span><span class="op" id="5893175">[</span><span class="num" id="5893176">0</span><span class="op" id="5893177">]</span>&nbsp;<span class="op" id="5893179">=</span>&nbsp;<span class="string" id="5893181">&#39;z&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5893188">dst</span>&nbsp;<span class="op" id="5893192">=</span>&nbsp;<span class="ident" id="5893194">dst</span><span class="op" id="5893197">[</span><span class="num" id="5893198">1</span><span class="op" id="5893199">:</span><span class="op" id="5893200">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5893205">src</span>&nbsp;<span class="op" id="5893209">=</span>&nbsp;<span class="ident" id="5893211">src</span><span class="op" id="5893214">[</span><span class="num" id="5893215">4</span><span class="op" id="5893216">:</span><span class="op" id="5893217">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5893222">n</span><span class="op" id="5893223">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5893229">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5893240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5893245">//&nbsp;Otherwise,&nbsp;5&nbsp;base&nbsp;85&nbsp;digits&nbsp;starting&nbsp;at&nbsp;!.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5893293">for</span>&nbsp;<span class="ident" id="5893297">i</span>&nbsp;<span class="op" id="5893299">:=</span>&nbsp;<span class="num" id="5893302">4</span><span class="op" id="5893303">;</span>&nbsp;<span class="ident" id="5893305">i</span>&nbsp;<span class="op" id="5893307">&gt;=</span>&nbsp;<span class="num" id="5893310">0</span><span class="op" id="5893311">;</span>&nbsp;<span class="ident" id="5893313">i</span><span class="op" id="5893314">--</span>&nbsp;<span class="op" id="5893317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5893322">dst</span><span class="op" id="5893325">[</span><span class="ident" id="5893326">i</span><span class="op" id="5893327">]</span>&nbsp;<span class="op" id="5893329">=</span>&nbsp;<span class="string" id="5893331">&#39;!&#39;</span>&nbsp;<span class="op" id="5893335">+</span>&nbsp;<span class="builtintype" id="5893337">byte</span><span class="op" id="5893341">(</span><span class="ident" id="5893342">v</span><span class="op" id="5893343">%</span><span class="num" id="5893344">85</span><span class="op" id="5893346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5893351">v</span>&nbsp;<span class="op" id="5893353">/=</span>&nbsp;<span class="num" id="5893356">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5893361">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5893366">//&nbsp;If&nbsp;src&nbsp;was&nbsp;short,&nbsp;discard&nbsp;the&nbsp;low&nbsp;destination&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5893424">m</span>&nbsp;<span class="op" id="5893426">:=</span>&nbsp;<span class="num" id="5893429">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5893433">if</span>&nbsp;<span class="builtinfunc" id="5893436">len</span><span class="op" id="5893439">(</span><span class="ident" id="5893440">src</span><span class="op" id="5893443">)</span>&nbsp;<span class="op" id="5893445">&lt;</span>&nbsp;<span class="num" id="5893447">4</span>&nbsp;<span class="op" id="5893449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5893454">m</span>&nbsp;<span class="op" id="5893456">-=</span>&nbsp;<span class="num" id="5893459">4</span>&nbsp;<span class="op" id="5893461">-</span>&nbsp;<span class="builtinfunc" id="5893463">len</span><span class="op" id="5893466">(</span><span class="ident" id="5893467">src</span><span class="op" id="5893470">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5893475">src</span>&nbsp;<span class="op" id="5893479">=</span>&nbsp;<span class="ident" id="5893481">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5893487">}</span>&nbsp;<span class="keyword" id="5893489">else</span>&nbsp;<span class="op" id="5893494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5893499">src</span>&nbsp;<span class="op" id="5893503">=</span>&nbsp;<span class="ident" id="5893505">src</span><span class="op" id="5893508">[</span><span class="num" id="5893509">4</span><span class="op" id="5893510">:</span><span class="op" id="5893511">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5893515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5893519">dst</span>&nbsp;<span class="op" id="5893523">=</span>&nbsp;<span class="ident" id="5893525">dst</span><span class="op" id="5893528">[</span><span class="ident" id="5893529">m</span><span class="op" id="5893530">:</span><span class="op" id="5893531">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5893535">n</span>&nbsp;<span class="op" id="5893537">+=</span>&nbsp;<span class="ident" id="5893540">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5893543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5893546">return</span>&nbsp;<span class="ident" id="5893553">n</span><br>
<span class="lineno"></span><span class="op" id="5893555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="5893558">//&nbsp;MaxEncodedLen&nbsp;returns&nbsp;the&nbsp;maximum&nbsp;length&nbsp;of&nbsp;an&nbsp;encoding&nbsp;of&nbsp;n&nbsp;source&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="5893636">func</span>&nbsp;<span class="ident" id="5893641">MaxEncodedLen</span><span class="op" id="5893654">(</span><span class="ident" id="5893655">n</span>&nbsp;<span class="builtintype" id="5893657">int</span><span class="op" id="5893660">)</span>&nbsp;<span class="builtintype" id="5893662">int</span>&nbsp;<span class="op" id="5893666">{</span>&nbsp;<span class="keyword" id="5893668">return</span>&nbsp;<span class="op" id="5893675">(</span><span class="ident" id="5893676">n</span>&nbsp;<span class="op" id="5893678">+</span>&nbsp;<span class="num" id="5893680">3</span><span class="op" id="5893681">)</span>&nbsp;<span class="op" id="5893683">/</span>&nbsp;<span class="num" id="5893685">4</span>&nbsp;<span class="op" id="5893687">*</span>&nbsp;<span class="num" id="5893689">5</span>&nbsp;<span class="op" id="5893691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5893694">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;ascii85&nbsp;stream&nbsp;encoder.&nbsp;&nbsp;Data&nbsp;written&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5893763">//&nbsp;the&nbsp;returned&nbsp;writer&nbsp;will&nbsp;be&nbsp;encoded&nbsp;and&nbsp;then&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno">90</span><span class="comment" id="5893825">//&nbsp;Ascii85&nbsp;encodings&nbsp;operate&nbsp;in&nbsp;32-bit&nbsp;blocks;&nbsp;when&nbsp;finished</span><br>
<span class="lineno"></span><span class="comment" id="5893886">//&nbsp;writing,&nbsp;the&nbsp;caller&nbsp;must&nbsp;Close&nbsp;the&nbsp;returned&nbsp;encoder&nbsp;to&nbsp;flush&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="5893954">//&nbsp;trailing&nbsp;partial&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="5893981">func</span>&nbsp;<span class="ident" id="5893986">NewEncoder</span><span class="op" id="5893996">(</span><span class="ident" id="5893997">w</span>&nbsp;<span class="ident" id="5893999">io</span><span class="op" id="5894001">.</span><span class="ident" id="5894002">Writer</span><span class="op" id="5894008">)</span>&nbsp;<span class="ident" id="5894010">io</span><span class="op" id="5894012">.</span><span class="ident" id="5894013">WriteCloser</span>&nbsp;<span class="op" id="5894025">{</span>&nbsp;<span class="keyword" id="5894027">return</span>&nbsp;<span class="op" id="5894034">&amp;</span><span class="ident" id="5894035">encoder</span><span class="op" id="5894042">{</span><span class="ident" id="5894043">w</span><span class="op" id="5894044">:</span>&nbsp;<span class="ident" id="5894046">w</span><span class="op" id="5894047">}</span>&nbsp;<span class="op" id="5894049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5894052">type</span>&nbsp;<span class="ident" id="5894057">encoder</span>&nbsp;<span class="keyword" id="5894065">struct</span>&nbsp;<span class="op" id="5894072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5894075">err</span>&nbsp;&nbsp;<span class="builtintype" id="5894080">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5894087">w</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5894092">io</span><span class="op" id="5894094">.</span><span class="ident" id="5894095">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5894103">buf</span>&nbsp;&nbsp;<span class="op" id="5894108">[</span><span class="num" id="5894109">4</span><span class="op" id="5894110">]</span><span class="builtintype" id="5894111">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5894119">//&nbsp;buffered&nbsp;data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;encoded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5894159">nbuf</span>&nbsp;<span class="builtintype" id="5894164">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5894175">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;buf</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5894202">out</span>&nbsp;&nbsp;<span class="op" id="5894207">[</span><span class="num" id="5894208">1024</span><span class="op" id="5894212">]</span><span class="builtintype" id="5894213">byte</span>&nbsp;<span class="comment" id="5894218">//&nbsp;output&nbsp;buffer</span><br>
<span class="lineno"></span><span class="op" id="5894235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5894238">func</span>&nbsp;<span class="op" id="5894243">(</span><span class="ident" id="5894244">e</span>&nbsp;<span class="op" id="5894246">*</span><span class="ident" id="5894247">encoder</span><span class="op" id="5894254">)</span>&nbsp;<span class="ident" id="5894256">Write</span><span class="op" id="5894261">(</span><span class="ident" id="5894262">p</span>&nbsp;<span class="op" id="5894264">[</span><span class="op" id="5894265">]</span><span class="builtintype" id="5894266">byte</span><span class="op" id="5894270">)</span>&nbsp;<span class="op" id="5894272">(</span><span class="ident" id="5894273">n</span>&nbsp;<span class="builtintype" id="5894275">int</span><span class="op" id="5894278">,</span>&nbsp;<span class="ident" id="5894280">err</span>&nbsp;<span class="builtintype" id="5894284">error</span><span class="op" id="5894289">)</span>&nbsp;<span class="op" id="5894291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5894294">if</span>&nbsp;<span class="ident" id="5894297">e</span><span class="op" id="5894298">.</span><span class="ident" id="5894299">err</span>&nbsp;<span class="op" id="5894303">!=</span>&nbsp;<span class="ident" id="5894306">nil</span>&nbsp;<span class="op" id="5894310">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5894314">return</span>&nbsp;<span class="num" id="5894321">0</span><span class="op" id="5894322">,</span>&nbsp;<span class="ident" id="5894324">e</span><span class="op" id="5894325">.</span><span class="ident" id="5894326">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5894331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5894335">//&nbsp;Leading&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5894355">if</span>&nbsp;<span class="ident" id="5894358">e</span><span class="op" id="5894359">.</span><span class="ident" id="5894360">nbuf</span>&nbsp;<span class="op" id="5894365">&gt;</span>&nbsp;<span class="num" id="5894367">0</span>&nbsp;<span class="op" id="5894369">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5894373">var</span>&nbsp;<span class="ident" id="5894377">i</span>&nbsp;<span class="builtintype" id="5894379">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5894385">for</span>&nbsp;<span class="ident" id="5894389">i</span>&nbsp;<span class="op" id="5894391">=</span>&nbsp;<span class="num" id="5894393">0</span><span class="op" id="5894394">;</span>&nbsp;<span class="ident" id="5894396">i</span>&nbsp;<span class="op" id="5894398">&lt;</span>&nbsp;<span class="builtinfunc" id="5894400">len</span><span class="op" id="5894403">(</span><span class="ident" id="5894404">p</span><span class="op" id="5894405">)</span>&nbsp;<span class="op" id="5894407">&amp;&amp;</span>&nbsp;<span class="ident" id="5894410">e</span><span class="op" id="5894411">.</span><span class="ident" id="5894412">nbuf</span>&nbsp;<span class="op" id="5894417">&lt;</span>&nbsp;<span class="num" id="5894419">4</span><span class="op" id="5894420">;</span>&nbsp;<span class="ident" id="5894422">i</span><span class="op" id="5894423">++</span>&nbsp;<span class="op" id="5894426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5894431">e</span><span class="op" id="5894432">.</span><span class="ident" id="5894433">buf</span><span class="op" id="5894436">[</span><span class="ident" id="5894437">e</span><span class="op" id="5894438">.</span><span class="ident" id="5894439">nbuf</span><span class="op" id="5894443">]</span>&nbsp;<span class="op" id="5894445">=</span>&nbsp;<span class="ident" id="5894447">p</span><span class="op" id="5894448">[</span><span class="ident" id="5894449">i</span><span class="op" id="5894450">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5894455">e</span><span class="op" id="5894456">.</span><span class="ident" id="5894457">nbuf</span><span class="op" id="5894461">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5894466">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5894470">n</span>&nbsp;<span class="op" id="5894472">+=</span>&nbsp;<span class="ident" id="5894475">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5894479">p</span>&nbsp;<span class="op" id="5894481">=</span>&nbsp;<span class="ident" id="5894483">p</span><span class="op" id="5894484">[</span><span class="ident" id="5894485">i</span><span class="op" id="5894486">:</span><span class="op" id="5894487">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5894491">if</span>&nbsp;<span class="ident" id="5894494">e</span><span class="op" id="5894495">.</span><span class="ident" id="5894496">nbuf</span>&nbsp;<span class="op" id="5894501">&lt;</span>&nbsp;<span class="num" id="5894503">4</span>&nbsp;<span class="op" id="5894505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5894510">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5894519">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5894523">nout</span>&nbsp;<span class="op" id="5894528">:=</span>&nbsp;<span class="ident" id="5894531">Encode</span><span class="op" id="5894537">(</span><span class="ident" id="5894538">e</span><span class="op" id="5894539">.</span><span class="ident" id="5894540">out</span><span class="op" id="5894543">[</span><span class="num" id="5894544">0</span><span class="op" id="5894545">:</span><span class="op" id="5894546">]</span><span class="op" id="5894547">,</span>&nbsp;<span class="ident" id="5894549">e</span><span class="op" id="5894550">.</span><span class="ident" id="5894551">buf</span><span class="op" id="5894554">[</span><span class="num" id="5894555">0</span><span class="op" id="5894556">:</span><span class="op" id="5894557">]</span><span class="op" id="5894558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5894562">if</span>&nbsp;<span class="ident" id="5894565">_</span><span class="op" id="5894566">,</span>&nbsp;<span class="ident" id="5894568">e</span><span class="op" id="5894569">.</span><span class="ident" id="5894570">err</span>&nbsp;<span class="op" id="5894574">=</span>&nbsp;<span class="ident" id="5894576">e</span><span class="op" id="5894577">.</span><span class="ident" id="5894578">w</span><span class="op" id="5894579">.</span><span class="ident" id="5894580">Write</span><span class="op" id="5894585">(</span><span class="ident" id="5894586">e</span><span class="op" id="5894587">.</span><span class="ident" id="5894588">out</span><span class="op" id="5894591">[</span><span class="num" id="5894592">0</span><span class="op" id="5894593">:</span><span class="ident" id="5894594">nout</span><span class="op" id="5894598">]</span><span class="op" id="5894599">)</span><span class="op" id="5894600">;</span>&nbsp;<span class="ident" id="5894602">e</span><span class="op" id="5894603">.</span><span class="ident" id="5894604">err</span>&nbsp;<span class="op" id="5894608">!=</span>&nbsp;<span class="ident" id="5894611">nil</span>&nbsp;<span class="op" id="5894615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5894620">return</span>&nbsp;<span class="ident" id="5894627">n</span><span class="op" id="5894628">,</span>&nbsp;<span class="ident" id="5894630">e</span><span class="op" id="5894631">.</span><span class="ident" id="5894632">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5894638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5894642">e</span><span class="op" id="5894643">.</span><span class="ident" id="5894644">nbuf</span>&nbsp;<span class="op" id="5894649">=</span>&nbsp;<span class="num" id="5894651">0</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5894654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5894658">//&nbsp;Large&nbsp;interior&nbsp;chunks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5894685">for</span>&nbsp;<span class="builtinfunc" id="5894689">len</span><span class="op" id="5894692">(</span><span class="ident" id="5894693">p</span><span class="op" id="5894694">)</span>&nbsp;<span class="op" id="5894696">&gt;=</span>&nbsp;<span class="num" id="5894699">4</span>&nbsp;<span class="op" id="5894701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5894705">nn</span>&nbsp;<span class="op" id="5894708">:=</span>&nbsp;<span class="builtinfunc" id="5894711">len</span><span class="op" id="5894714">(</span><span class="ident" id="5894715">e</span><span class="op" id="5894716">.</span><span class="ident" id="5894717">out</span><span class="op" id="5894720">)</span>&nbsp;<span class="op" id="5894722">/</span>&nbsp;<span class="num" id="5894724">5</span>&nbsp;<span class="op" id="5894726">*</span>&nbsp;<span class="num" id="5894728">4</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5894732">if</span>&nbsp;<span class="ident" id="5894735">nn</span>&nbsp;<span class="op" id="5894738">&gt;</span>&nbsp;<span class="builtinfunc" id="5894740">len</span><span class="op" id="5894743">(</span><span class="ident" id="5894744">p</span><span class="op" id="5894745">)</span>&nbsp;<span class="op" id="5894747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5894752">nn</span>&nbsp;<span class="op" id="5894755">=</span>&nbsp;<span class="builtinfunc" id="5894757">len</span><span class="op" id="5894760">(</span><span class="ident" id="5894761">p</span><span class="op" id="5894762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5894766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5894770">nn</span>&nbsp;<span class="op" id="5894773">-=</span>&nbsp;<span class="ident" id="5894776">nn</span>&nbsp;<span class="op" id="5894779">%</span>&nbsp;<span class="num" id="5894781">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5894785">if</span>&nbsp;<span class="ident" id="5894788">nn</span>&nbsp;<span class="op" id="5894791">&gt;</span>&nbsp;<span class="num" id="5894793">0</span>&nbsp;<span class="op" id="5894795">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5894800">nout</span>&nbsp;<span class="op" id="5894805">:=</span>&nbsp;<span class="ident" id="5894808">Encode</span><span class="op" id="5894814">(</span><span class="ident" id="5894815">e</span><span class="op" id="5894816">.</span><span class="ident" id="5894817">out</span><span class="op" id="5894820">[</span><span class="num" id="5894821">0</span><span class="op" id="5894822">:</span><span class="op" id="5894823">]</span><span class="op" id="5894824">,</span>&nbsp;<span class="ident" id="5894826">p</span><span class="op" id="5894827">[</span><span class="num" id="5894828">0</span><span class="op" id="5894829">:</span><span class="ident" id="5894830">nn</span><span class="op" id="5894832">]</span><span class="op" id="5894833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5894838">if</span>&nbsp;<span class="ident" id="5894841">_</span><span class="op" id="5894842">,</span>&nbsp;<span class="ident" id="5894844">e</span><span class="op" id="5894845">.</span><span class="ident" id="5894846">err</span>&nbsp;<span class="op" id="5894850">=</span>&nbsp;<span class="ident" id="5894852">e</span><span class="op" id="5894853">.</span><span class="ident" id="5894854">w</span><span class="op" id="5894855">.</span><span class="ident" id="5894856">Write</span><span class="op" id="5894861">(</span><span class="ident" id="5894862">e</span><span class="op" id="5894863">.</span><span class="ident" id="5894864">out</span><span class="op" id="5894867">[</span><span class="num" id="5894868">0</span><span class="op" id="5894869">:</span><span class="ident" id="5894870">nout</span><span class="op" id="5894874">]</span><span class="op" id="5894875">)</span><span class="op" id="5894876">;</span>&nbsp;<span class="ident" id="5894878">e</span><span class="op" id="5894879">.</span><span class="ident" id="5894880">err</span>&nbsp;<span class="op" id="5894884">!=</span>&nbsp;<span class="ident" id="5894887">nil</span>&nbsp;<span class="op" id="5894891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5894897">return</span>&nbsp;<span class="ident" id="5894904">n</span><span class="op" id="5894905">,</span>&nbsp;<span class="ident" id="5894907">e</span><span class="op" id="5894908">.</span><span class="ident" id="5894909">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5894916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5894920">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5894924">n</span>&nbsp;<span class="op" id="5894926">+=</span>&nbsp;<span class="ident" id="5894929">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5894934">p</span>&nbsp;<span class="op" id="5894936">=</span>&nbsp;<span class="ident" id="5894938">p</span><span class="op" id="5894939">[</span><span class="ident" id="5894940">nn</span><span class="op" id="5894942">:</span><span class="op" id="5894943">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5894946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5894950">//&nbsp;Trailing&nbsp;fringe.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5894971">for</span>&nbsp;<span class="ident" id="5894975">i</span>&nbsp;<span class="op" id="5894977">:=</span>&nbsp;<span class="num" id="5894980">0</span><span class="op" id="5894981">;</span>&nbsp;<span class="ident" id="5894983">i</span>&nbsp;<span class="op" id="5894985">&lt;</span>&nbsp;<span class="builtinfunc" id="5894987">len</span><span class="op" id="5894990">(</span><span class="ident" id="5894991">p</span><span class="op" id="5894992">)</span><span class="op" id="5894993">;</span>&nbsp;<span class="ident" id="5894995">i</span><span class="op" id="5894996">++</span>&nbsp;<span class="op" id="5894999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5895003">e</span><span class="op" id="5895004">.</span><span class="ident" id="5895005">buf</span><span class="op" id="5895008">[</span><span class="ident" id="5895009">i</span><span class="op" id="5895010">]</span>&nbsp;<span class="op" id="5895012">=</span>&nbsp;<span class="ident" id="5895014">p</span><span class="op" id="5895015">[</span><span class="ident" id="5895016">i</span><span class="op" id="5895017">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5895020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5895023">e</span><span class="op" id="5895024">.</span><span class="ident" id="5895025">nbuf</span>&nbsp;<span class="op" id="5895030">=</span>&nbsp;<span class="builtinfunc" id="5895032">len</span><span class="op" id="5895035">(</span><span class="ident" id="5895036">p</span><span class="op" id="5895037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5895040">n</span>&nbsp;<span class="op" id="5895042">+=</span>&nbsp;<span class="builtinfunc" id="5895045">len</span><span class="op" id="5895048">(</span><span class="ident" id="5895049">p</span><span class="op" id="5895050">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5895053">return</span><br>
<span class="lineno"></span><span class="op" id="5895060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5895063">//&nbsp;Close&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;output&nbsp;from&nbsp;the&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="5895117">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;call&nbsp;Write&nbsp;after&nbsp;calling&nbsp;Close.</span><br>
<span class="lineno">155</span><span class="keyword" id="5895170">func</span>&nbsp;<span class="op" id="5895175">(</span><span class="ident" id="5895176">e</span>&nbsp;<span class="op" id="5895178">*</span><span class="ident" id="5895179">encoder</span><span class="op" id="5895186">)</span>&nbsp;<span class="ident" id="5895188">Close</span><span class="op" id="5895193">(</span><span class="op" id="5895194">)</span>&nbsp;<span class="builtintype" id="5895196">error</span>&nbsp;<span class="op" id="5895202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5895205">//&nbsp;If&nbsp;there&#39;s&nbsp;anything&nbsp;left&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;flush&nbsp;it&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5895262">if</span>&nbsp;<span class="ident" id="5895265">e</span><span class="op" id="5895266">.</span><span class="ident" id="5895267">err</span>&nbsp;<span class="op" id="5895271">==</span>&nbsp;<span class="ident" id="5895274">nil</span>&nbsp;<span class="op" id="5895278">&amp;&amp;</span>&nbsp;<span class="ident" id="5895281">e</span><span class="op" id="5895282">.</span><span class="ident" id="5895283">nbuf</span>&nbsp;<span class="op" id="5895288">&gt;</span>&nbsp;<span class="num" id="5895290">0</span>&nbsp;<span class="op" id="5895292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5895296">nout</span>&nbsp;<span class="op" id="5895301">:=</span>&nbsp;<span class="ident" id="5895304">Encode</span><span class="op" id="5895310">(</span><span class="ident" id="5895311">e</span><span class="op" id="5895312">.</span><span class="ident" id="5895313">out</span><span class="op" id="5895316">[</span><span class="num" id="5895317">0</span><span class="op" id="5895318">:</span><span class="op" id="5895319">]</span><span class="op" id="5895320">,</span>&nbsp;<span class="ident" id="5895322">e</span><span class="op" id="5895323">.</span><span class="ident" id="5895324">buf</span><span class="op" id="5895327">[</span><span class="num" id="5895328">0</span><span class="op" id="5895329">:</span><span class="ident" id="5895330">e</span><span class="op" id="5895331">.</span><span class="ident" id="5895332">nbuf</span><span class="op" id="5895336">]</span><span class="op" id="5895337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5895341">e</span><span class="op" id="5895342">.</span><span class="ident" id="5895343">nbuf</span>&nbsp;<span class="op" id="5895348">=</span>&nbsp;<span class="num" id="5895350">0</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5895354">_</span><span class="op" id="5895355">,</span>&nbsp;<span class="ident" id="5895357">e</span><span class="op" id="5895358">.</span><span class="ident" id="5895359">err</span>&nbsp;<span class="op" id="5895363">=</span>&nbsp;<span class="ident" id="5895365">e</span><span class="op" id="5895366">.</span><span class="ident" id="5895367">w</span><span class="op" id="5895368">.</span><span class="ident" id="5895369">Write</span><span class="op" id="5895374">(</span><span class="ident" id="5895375">e</span><span class="op" id="5895376">.</span><span class="ident" id="5895377">out</span><span class="op" id="5895380">[</span><span class="num" id="5895381">0</span><span class="op" id="5895382">:</span><span class="ident" id="5895383">nout</span><span class="op" id="5895387">]</span><span class="op" id="5895388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5895391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5895394">return</span>&nbsp;<span class="ident" id="5895401">e</span><span class="op" id="5895402">.</span><span class="ident" id="5895403">err</span><br>
<span class="lineno"></span><span class="op" id="5895407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="5895410">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Decoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5895429">type</span>&nbsp;<span class="ident" id="5895434">CorruptInputError</span>&nbsp;<span class="ident" id="5895452">int64</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="5895459">func</span>&nbsp;<span class="op" id="5895464">(</span><span class="ident" id="5895465">e</span>&nbsp;<span class="ident" id="5895467">CorruptInputError</span><span class="op" id="5895484">)</span>&nbsp;<span class="ident" id="5895486">Error</span><span class="op" id="5895491">(</span><span class="op" id="5895492">)</span>&nbsp;<span class="builtintype" id="5895494">string</span>&nbsp;<span class="op" id="5895501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5895504">return</span>&nbsp;<span class="string" id="5895511">&#34;illegal&nbsp;ascii85&nbsp;data&nbsp;at&nbsp;input&nbsp;byte&nbsp;&#34;</span>&nbsp;<span class="op" id="5895549">+</span>&nbsp;<span class="ident" id="5895551">strconv</span><span class="op" id="5895558">.</span><span class="ident" id="5895559">FormatInt</span><span class="op" id="5895568">(</span><span class="ident" id="5895569">int64</span><span class="op" id="5895574">(</span><span class="ident" id="5895575">e</span><span class="op" id="5895576">)</span><span class="op" id="5895577">,</span>&nbsp;<span class="num" id="5895579">10</span><span class="op" id="5895581">)</span><br>
<span class="lineno"></span><span class="op" id="5895583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="5895586">//&nbsp;Decode&nbsp;decodes&nbsp;src&nbsp;into&nbsp;dst,&nbsp;returning&nbsp;both&nbsp;the&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="5895644">//&nbsp;of&nbsp;bytes&nbsp;written&nbsp;to&nbsp;dst&nbsp;and&nbsp;the&nbsp;number&nbsp;consumed&nbsp;from&nbsp;src.</span><br>
<span class="lineno"></span><span class="comment" id="5895705">//&nbsp;If&nbsp;src&nbsp;contains&nbsp;invalid&nbsp;ascii85&nbsp;data,&nbsp;Decode&nbsp;will&nbsp;return&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5895769">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;successfully&nbsp;written&nbsp;and&nbsp;a&nbsp;CorruptInputError.</span><br>
<span class="lineno"></span><span class="comment" id="5895834">//&nbsp;Decode&nbsp;ignores&nbsp;space&nbsp;and&nbsp;control&nbsp;characters&nbsp;in&nbsp;src.</span><br>
<span class="lineno">180</span><span class="comment" id="5895889">//&nbsp;Often,&nbsp;ascii85-encoded&nbsp;data&nbsp;is&nbsp;wrapped&nbsp;in&nbsp;&lt;~&nbsp;and&nbsp;~&gt;&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="comment" id="5895953">//&nbsp;Decode&nbsp;expects&nbsp;these&nbsp;to&nbsp;have&nbsp;been&nbsp;stripped&nbsp;by&nbsp;the&nbsp;caller.</span><br>
<span class="lineno"></span><span class="comment" id="5896014">//</span><br>
<span class="lineno"></span><span class="comment" id="5896017">//&nbsp;If&nbsp;flush&nbsp;is&nbsp;true,&nbsp;Decode&nbsp;assumes&nbsp;that&nbsp;src&nbsp;represents&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5896077">//&nbsp;end&nbsp;of&nbsp;the&nbsp;input&nbsp;stream&nbsp;and&nbsp;processes&nbsp;it&nbsp;completely&nbsp;rather</span><br>
<span class="lineno">185</span><span class="comment" id="5896139">//&nbsp;than&nbsp;wait&nbsp;for&nbsp;the&nbsp;completion&nbsp;of&nbsp;another&nbsp;32-bit&nbsp;block.</span><br>
<span class="lineno"></span><span class="comment" id="5896196">//</span><br>
<span class="lineno"></span><span class="comment" id="5896199">//&nbsp;NewDecoder&nbsp;wraps&nbsp;an&nbsp;io.Reader&nbsp;interface&nbsp;around&nbsp;Decode.</span><br>
<span class="lineno"></span><span class="comment" id="5896257">//</span><br>
<span class="lineno"></span><span class="keyword" id="5896260">func</span>&nbsp;<span class="ident" id="5896265">Decode</span><span class="op" id="5896271">(</span><span class="ident" id="5896272">dst</span><span class="op" id="5896275">,</span>&nbsp;<span class="ident" id="5896277">src</span>&nbsp;<span class="op" id="5896281">[</span><span class="op" id="5896282">]</span><span class="builtintype" id="5896283">byte</span><span class="op" id="5896287">,</span>&nbsp;<span class="ident" id="5896289">flush</span>&nbsp;<span class="builtintype" id="5896295">bool</span><span class="op" id="5896299">)</span>&nbsp;<span class="op" id="5896301">(</span><span class="ident" id="5896302">ndst</span><span class="op" id="5896306">,</span>&nbsp;<span class="ident" id="5896308">nsrc</span>&nbsp;<span class="builtintype" id="5896313">int</span><span class="op" id="5896316">,</span>&nbsp;<span class="ident" id="5896318">err</span>&nbsp;<span class="builtintype" id="5896322">error</span><span class="op" id="5896327">)</span>&nbsp;<span class="op" id="5896329">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5896332">var</span>&nbsp;<span class="ident" id="5896336">v</span>&nbsp;<span class="builtintype" id="5896338">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5896346">var</span>&nbsp;<span class="ident" id="5896350">nb</span>&nbsp;<span class="builtintype" id="5896353">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5896358">for</span>&nbsp;<span class="ident" id="5896362">i</span><span class="op" id="5896363">,</span>&nbsp;<span class="ident" id="5896365">b</span>&nbsp;<span class="op" id="5896367">:=</span>&nbsp;<span class="keyword" id="5896370">range</span>&nbsp;<span class="ident" id="5896376">src</span>&nbsp;<span class="op" id="5896380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5896384">if</span>&nbsp;<span class="builtinfunc" id="5896387">len</span><span class="op" id="5896390">(</span><span class="ident" id="5896391">dst</span><span class="op" id="5896394">)</span><span class="op" id="5896395">-</span><span class="ident" id="5896396">ndst</span>&nbsp;<span class="op" id="5896401">&lt;</span>&nbsp;<span class="num" id="5896403">4</span>&nbsp;<span class="op" id="5896405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5896410">return</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5896419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5896423">switch</span>&nbsp;<span class="op" id="5896430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5896434">case</span>&nbsp;<span class="ident" id="5896439">b</span>&nbsp;<span class="op" id="5896441">&lt;=</span>&nbsp;<span class="string" id="5896444">&#39;&nbsp;&#39;</span><span class="op" id="5896447">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5896452">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5896463">case</span>&nbsp;<span class="ident" id="5896468">b</span>&nbsp;<span class="op" id="5896470">==</span>&nbsp;<span class="string" id="5896473">&#39;z&#39;</span>&nbsp;<span class="op" id="5896477">&amp;&amp;</span>&nbsp;<span class="ident" id="5896480">nb</span>&nbsp;<span class="op" id="5896483">==</span>&nbsp;<span class="num" id="5896486">0</span><span class="op" id="5896487">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5896492">nb</span>&nbsp;<span class="op" id="5896495">=</span>&nbsp;<span class="num" id="5896497">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5896502">v</span>&nbsp;<span class="op" id="5896504">=</span>&nbsp;<span class="num" id="5896506">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5896510">case</span>&nbsp;<span class="string" id="5896515">&#39;!&#39;</span>&nbsp;<span class="op" id="5896519">&lt;=</span>&nbsp;<span class="ident" id="5896522">b</span>&nbsp;<span class="op" id="5896524">&amp;&amp;</span>&nbsp;<span class="ident" id="5896527">b</span>&nbsp;<span class="op" id="5896529">&lt;=</span>&nbsp;<span class="string" id="5896532">&#39;u&#39;</span><span class="op" id="5896535">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5896540">v</span>&nbsp;<span class="op" id="5896542">=</span>&nbsp;<span class="ident" id="5896544">v</span><span class="op" id="5896545">*</span><span class="num" id="5896546">85</span>&nbsp;<span class="op" id="5896549">+</span>&nbsp;<span class="builtintype" id="5896551">uint32</span><span class="op" id="5896557">(</span><span class="ident" id="5896558">b</span><span class="op" id="5896559">-</span><span class="string" id="5896560">&#39;!&#39;</span><span class="op" id="5896563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5896568">nb</span><span class="op" id="5896570">++</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5896575">default</span><span class="op" id="5896582">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5896587">return</span>&nbsp;<span class="num" id="5896594">0</span><span class="op" id="5896595">,</span>&nbsp;<span class="num" id="5896597">0</span><span class="op" id="5896598">,</span>&nbsp;<span class="ident" id="5896600">CorruptInputError</span><span class="op" id="5896617">(</span><span class="ident" id="5896618">i</span><span class="op" id="5896619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5896623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5896627">if</span>&nbsp;<span class="ident" id="5896630">nb</span>&nbsp;<span class="op" id="5896633">==</span>&nbsp;<span class="num" id="5896636">5</span>&nbsp;<span class="op" id="5896638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5896643">nsrc</span>&nbsp;<span class="op" id="5896648">=</span>&nbsp;<span class="ident" id="5896650">i</span>&nbsp;<span class="op" id="5896652">+</span>&nbsp;<span class="num" id="5896654">1</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5896659">dst</span><span class="op" id="5896662">[</span><span class="ident" id="5896663">ndst</span><span class="op" id="5896667">]</span>&nbsp;<span class="op" id="5896669">=</span>&nbsp;<span class="builtintype" id="5896671">byte</span><span class="op" id="5896675">(</span><span class="ident" id="5896676">v</span>&nbsp;<span class="op" id="5896678">&gt;&gt;</span>&nbsp;<span class="num" id="5896681">24</span><span class="op" id="5896683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5896688">dst</span><span class="op" id="5896691">[</span><span class="ident" id="5896692">ndst</span><span class="op" id="5896696">+</span><span class="num" id="5896697">1</span><span class="op" id="5896698">]</span>&nbsp;<span class="op" id="5896700">=</span>&nbsp;<span class="builtintype" id="5896702">byte</span><span class="op" id="5896706">(</span><span class="ident" id="5896707">v</span>&nbsp;<span class="op" id="5896709">&gt;&gt;</span>&nbsp;<span class="num" id="5896712">16</span><span class="op" id="5896714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5896719">dst</span><span class="op" id="5896722">[</span><span class="ident" id="5896723">ndst</span><span class="op" id="5896727">+</span><span class="num" id="5896728">2</span><span class="op" id="5896729">]</span>&nbsp;<span class="op" id="5896731">=</span>&nbsp;<span class="builtintype" id="5896733">byte</span><span class="op" id="5896737">(</span><span class="ident" id="5896738">v</span>&nbsp;<span class="op" id="5896740">&gt;&gt;</span>&nbsp;<span class="num" id="5896743">8</span><span class="op" id="5896744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5896749">dst</span><span class="op" id="5896752">[</span><span class="ident" id="5896753">ndst</span><span class="op" id="5896757">+</span><span class="num" id="5896758">3</span><span class="op" id="5896759">]</span>&nbsp;<span class="op" id="5896761">=</span>&nbsp;<span class="builtintype" id="5896763">byte</span><span class="op" id="5896767">(</span><span class="ident" id="5896768">v</span><span class="op" id="5896769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5896774">ndst</span>&nbsp;<span class="op" id="5896779">+=</span>&nbsp;<span class="num" id="5896782">4</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5896787">nb</span>&nbsp;<span class="op" id="5896790">=</span>&nbsp;<span class="num" id="5896792">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5896797">v</span>&nbsp;<span class="op" id="5896799">=</span>&nbsp;<span class="num" id="5896801">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5896805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5896808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5896811">if</span>&nbsp;<span class="ident" id="5896814">flush</span>&nbsp;<span class="op" id="5896820">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5896824">nsrc</span>&nbsp;<span class="op" id="5896829">=</span>&nbsp;<span class="builtinfunc" id="5896831">len</span><span class="op" id="5896834">(</span><span class="ident" id="5896835">src</span><span class="op" id="5896838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5896842">if</span>&nbsp;<span class="ident" id="5896845">nb</span>&nbsp;<span class="op" id="5896848">&gt;</span>&nbsp;<span class="num" id="5896850">0</span>&nbsp;<span class="op" id="5896852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5896857">//&nbsp;The&nbsp;number&nbsp;of&nbsp;output&nbsp;bytes&nbsp;in&nbsp;the&nbsp;last&nbsp;fragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5896911">//&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;leftover&nbsp;input&nbsp;bytes&nbsp;-&nbsp;1:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5896960">//&nbsp;the&nbsp;extra&nbsp;byte&nbsp;provides&nbsp;enough&nbsp;bits&nbsp;to&nbsp;cover</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5897011">//&nbsp;the&nbsp;inefficiency&nbsp;of&nbsp;the&nbsp;encoding&nbsp;for&nbsp;the&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5897065">if</span>&nbsp;<span class="ident" id="5897068">nb</span>&nbsp;<span class="op" id="5897071">==</span>&nbsp;<span class="num" id="5897074">1</span>&nbsp;<span class="op" id="5897076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5897082">return</span>&nbsp;<span class="num" id="5897089">0</span><span class="op" id="5897090">,</span>&nbsp;<span class="num" id="5897092">0</span><span class="op" id="5897093">,</span>&nbsp;<span class="ident" id="5897095">CorruptInputError</span><span class="op" id="5897112">(</span><span class="builtinfunc" id="5897113">len</span><span class="op" id="5897116">(</span><span class="ident" id="5897117">src</span><span class="op" id="5897120">)</span><span class="op" id="5897121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5897126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5897131">for</span>&nbsp;<span class="ident" id="5897135">i</span>&nbsp;<span class="op" id="5897137">:=</span>&nbsp;<span class="ident" id="5897140">nb</span><span class="op" id="5897142">;</span>&nbsp;<span class="ident" id="5897144">i</span>&nbsp;<span class="op" id="5897146">&lt;</span>&nbsp;<span class="num" id="5897148">5</span><span class="op" id="5897149">;</span>&nbsp;<span class="ident" id="5897151">i</span><span class="op" id="5897152">++</span>&nbsp;<span class="op" id="5897155">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5897161">//&nbsp;The&nbsp;short&nbsp;encoding&nbsp;truncated&nbsp;the&nbsp;output&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5897215">//&nbsp;We&nbsp;have&nbsp;to&nbsp;assume&nbsp;the&nbsp;worst&nbsp;case&nbsp;values&nbsp;(digit&nbsp;84)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5897273">//&nbsp;in&nbsp;order&nbsp;to&nbsp;ensure&nbsp;that&nbsp;the&nbsp;top&nbsp;bits&nbsp;are&nbsp;correct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5897330">v</span>&nbsp;<span class="op" id="5897332">=</span>&nbsp;<span class="ident" id="5897334">v</span><span class="op" id="5897335">*</span><span class="num" id="5897336">85</span>&nbsp;<span class="op" id="5897339">+</span>&nbsp;<span class="num" id="5897341">84</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5897347">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5897352">for</span>&nbsp;<span class="ident" id="5897356">i</span>&nbsp;<span class="op" id="5897358">:=</span>&nbsp;<span class="num" id="5897361">0</span><span class="op" id="5897362">;</span>&nbsp;<span class="ident" id="5897364">i</span>&nbsp;<span class="op" id="5897366">&lt;</span>&nbsp;<span class="ident" id="5897368">nb</span><span class="op" id="5897370">-</span><span class="num" id="5897371">1</span><span class="op" id="5897372">;</span>&nbsp;<span class="ident" id="5897374">i</span><span class="op" id="5897375">++</span>&nbsp;<span class="op" id="5897378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5897384">dst</span><span class="op" id="5897387">[</span><span class="ident" id="5897388">ndst</span><span class="op" id="5897392">]</span>&nbsp;<span class="op" id="5897394">=</span>&nbsp;<span class="builtintype" id="5897396">byte</span><span class="op" id="5897400">(</span><span class="ident" id="5897401">v</span>&nbsp;<span class="op" id="5897403">&gt;&gt;</span>&nbsp;<span class="num" id="5897406">24</span><span class="op" id="5897408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5897414">v</span>&nbsp;<span class="op" id="5897416">&lt;&lt;=</span>&nbsp;<span class="num" id="5897420">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5897426">ndst</span><span class="op" id="5897430">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5897436">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5897440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5897443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5897446">return</span><br>
<span class="lineno"></span><span class="op" id="5897453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="5897456">//&nbsp;NewDecoder&nbsp;constructs&nbsp;a&nbsp;new&nbsp;ascii85&nbsp;stream&nbsp;decoder.</span><br>
<span class="lineno"></span><span class="keyword" id="5897511">func</span>&nbsp;<span class="ident" id="5897516">NewDecoder</span><span class="op" id="5897526">(</span><span class="ident" id="5897527">r</span>&nbsp;<span class="ident" id="5897529">io</span><span class="op" id="5897531">.</span><span class="ident" id="5897532">Reader</span><span class="op" id="5897538">)</span>&nbsp;<span class="ident" id="5897540">io</span><span class="op" id="5897542">.</span><span class="ident" id="5897543">Reader</span>&nbsp;<span class="op" id="5897550">{</span>&nbsp;<span class="keyword" id="5897552">return</span>&nbsp;<span class="op" id="5897559">&amp;</span><span class="ident" id="5897560">decoder</span><span class="op" id="5897567">{</span><span class="ident" id="5897568">r</span><span class="op" id="5897569">:</span>&nbsp;<span class="ident" id="5897571">r</span><span class="op" id="5897572">}</span>&nbsp;<span class="op" id="5897574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5897577">type</span>&nbsp;<span class="ident" id="5897582">decoder</span>&nbsp;<span class="keyword" id="5897590">struct</span>&nbsp;<span class="op" id="5897597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5897600">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5897608">error</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5897615">readErr</span>&nbsp;<span class="builtintype" id="5897623">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5897630">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5897638">io</span><span class="op" id="5897640">.</span><span class="ident" id="5897641">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5897649">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5897657">[</span><span class="num" id="5897658">1024</span><span class="op" id="5897662">]</span><span class="builtintype" id="5897663">byte</span>&nbsp;<span class="comment" id="5897668">//&nbsp;leftover&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5897687">nbuf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5897695">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5897700">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5897708">[</span><span class="op" id="5897709">]</span><span class="builtintype" id="5897710">byte</span>&nbsp;<span class="comment" id="5897715">//&nbsp;leftover&nbsp;decoded&nbsp;output</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5897743">outbuf</span>&nbsp;&nbsp;<span class="op" id="5897751">[</span><span class="num" id="5897752">1024</span><span class="op" id="5897756">]</span><span class="builtintype" id="5897757">byte</span><br>
<span class="lineno"></span><span class="op" id="5897762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5897765">func</span>&nbsp;<span class="op" id="5897770">(</span><span class="ident" id="5897771">d</span>&nbsp;<span class="op" id="5897773">*</span><span class="ident" id="5897774">decoder</span><span class="op" id="5897781">)</span>&nbsp;<span class="ident" id="5897783">Read</span><span class="op" id="5897787">(</span><span class="ident" id="5897788">p</span>&nbsp;<span class="op" id="5897790">[</span><span class="op" id="5897791">]</span><span class="builtintype" id="5897792">byte</span><span class="op" id="5897796">)</span>&nbsp;<span class="op" id="5897798">(</span><span class="ident" id="5897799">n</span>&nbsp;<span class="builtintype" id="5897801">int</span><span class="op" id="5897804">,</span>&nbsp;<span class="ident" id="5897806">err</span>&nbsp;<span class="builtintype" id="5897810">error</span><span class="op" id="5897815">)</span>&nbsp;<span class="op" id="5897817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5897820">if</span>&nbsp;<span class="builtinfunc" id="5897823">len</span><span class="op" id="5897826">(</span><span class="ident" id="5897827">p</span><span class="op" id="5897828">)</span>&nbsp;<span class="op" id="5897830">==</span>&nbsp;<span class="num" id="5897833">0</span>&nbsp;<span class="op" id="5897835">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5897839">return</span>&nbsp;<span class="num" id="5897846">0</span><span class="op" id="5897847">,</span>&nbsp;<span class="ident" id="5897849">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5897854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5897857">if</span>&nbsp;<span class="ident" id="5897860">d</span><span class="op" id="5897861">.</span><span class="ident" id="5897862">err</span>&nbsp;<span class="op" id="5897866">!=</span>&nbsp;<span class="ident" id="5897869">nil</span>&nbsp;<span class="op" id="5897873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5897877">return</span>&nbsp;<span class="num" id="5897884">0</span><span class="op" id="5897885">,</span>&nbsp;<span class="ident" id="5897887">d</span><span class="op" id="5897888">.</span><span class="ident" id="5897889">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5897894">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5897898">for</span>&nbsp;<span class="op" id="5897902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5897906">//&nbsp;Copy&nbsp;leftover&nbsp;output&nbsp;from&nbsp;last&nbsp;decode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5897950">if</span>&nbsp;<span class="builtinfunc" id="5897953">len</span><span class="op" id="5897956">(</span><span class="ident" id="5897957">d</span><span class="op" id="5897958">.</span><span class="ident" id="5897959">out</span><span class="op" id="5897962">)</span>&nbsp;<span class="op" id="5897964">&gt;</span>&nbsp;<span class="num" id="5897966">0</span>&nbsp;<span class="op" id="5897968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5897973">n</span>&nbsp;<span class="op" id="5897975">=</span>&nbsp;<span class="builtinfunc" id="5897977">copy</span><span class="op" id="5897981">(</span><span class="ident" id="5897982">p</span><span class="op" id="5897983">,</span>&nbsp;<span class="ident" id="5897985">d</span><span class="op" id="5897986">.</span><span class="ident" id="5897987">out</span><span class="op" id="5897990">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5897995">d</span><span class="op" id="5897996">.</span><span class="ident" id="5897997">out</span>&nbsp;<span class="op" id="5898001">=</span>&nbsp;<span class="ident" id="5898003">d</span><span class="op" id="5898004">.</span><span class="ident" id="5898005">out</span><span class="op" id="5898008">[</span><span class="ident" id="5898009">n</span><span class="op" id="5898010">:</span><span class="op" id="5898011">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5898016">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5898025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5898030">//&nbsp;Decode&nbsp;leftover&nbsp;input&nbsp;from&nbsp;last&nbsp;read.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5898073">var</span>&nbsp;<span class="ident" id="5898077">nn</span><span class="op" id="5898079">,</span>&nbsp;<span class="ident" id="5898081">nsrc</span><span class="op" id="5898085">,</span>&nbsp;<span class="ident" id="5898087">ndst</span>&nbsp;<span class="builtintype" id="5898092">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5898098">if</span>&nbsp;<span class="ident" id="5898101">d</span><span class="op" id="5898102">.</span><span class="ident" id="5898103">nbuf</span>&nbsp;<span class="op" id="5898108">&gt;</span>&nbsp;<span class="num" id="5898110">0</span>&nbsp;<span class="op" id="5898112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5898117">ndst</span><span class="op" id="5898121">,</span>&nbsp;<span class="ident" id="5898123">nsrc</span><span class="op" id="5898127">,</span>&nbsp;<span class="ident" id="5898129">d</span><span class="op" id="5898130">.</span><span class="ident" id="5898131">err</span>&nbsp;<span class="op" id="5898135">=</span>&nbsp;<span class="ident" id="5898137">Decode</span><span class="op" id="5898143">(</span><span class="ident" id="5898144">d</span><span class="op" id="5898145">.</span><span class="ident" id="5898146">outbuf</span><span class="op" id="5898152">[</span><span class="num" id="5898153">0</span><span class="op" id="5898154">:</span><span class="op" id="5898155">]</span><span class="op" id="5898156">,</span>&nbsp;<span class="ident" id="5898158">d</span><span class="op" id="5898159">.</span><span class="ident" id="5898160">buf</span><span class="op" id="5898163">[</span><span class="num" id="5898164">0</span><span class="op" id="5898165">:</span><span class="ident" id="5898166">d</span><span class="op" id="5898167">.</span><span class="ident" id="5898168">nbuf</span><span class="op" id="5898172">]</span><span class="op" id="5898173">,</span>&nbsp;<span class="ident" id="5898175">d</span><span class="op" id="5898176">.</span><span class="ident" id="5898177">readErr</span>&nbsp;<span class="op" id="5898185">!=</span>&nbsp;<span class="ident" id="5898188">nil</span><span class="op" id="5898191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5898196">if</span>&nbsp;<span class="ident" id="5898199">ndst</span>&nbsp;<span class="op" id="5898204">&gt;</span>&nbsp;<span class="num" id="5898206">0</span>&nbsp;<span class="op" id="5898208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5898214">d</span><span class="op" id="5898215">.</span><span class="ident" id="5898216">out</span>&nbsp;<span class="op" id="5898220">=</span>&nbsp;<span class="ident" id="5898222">d</span><span class="op" id="5898223">.</span><span class="ident" id="5898224">outbuf</span><span class="op" id="5898230">[</span><span class="num" id="5898231">0</span><span class="op" id="5898232">:</span><span class="ident" id="5898233">ndst</span><span class="op" id="5898237">]</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5898243">d</span><span class="op" id="5898244">.</span><span class="ident" id="5898245">nbuf</span>&nbsp;<span class="op" id="5898250">=</span>&nbsp;<span class="builtinfunc" id="5898252">copy</span><span class="op" id="5898256">(</span><span class="ident" id="5898257">d</span><span class="op" id="5898258">.</span><span class="ident" id="5898259">buf</span><span class="op" id="5898262">[</span><span class="num" id="5898263">0</span><span class="op" id="5898264">:</span><span class="op" id="5898265">]</span><span class="op" id="5898266">,</span>&nbsp;<span class="ident" id="5898268">d</span><span class="op" id="5898269">.</span><span class="ident" id="5898270">buf</span><span class="op" id="5898273">[</span><span class="ident" id="5898274">nsrc</span><span class="op" id="5898278">:</span><span class="ident" id="5898279">d</span><span class="op" id="5898280">.</span><span class="ident" id="5898281">nbuf</span><span class="op" id="5898285">]</span><span class="op" id="5898286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5898292">continue</span>&nbsp;<span class="comment" id="5898301">//&nbsp;copy&nbsp;out&nbsp;and&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5898327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5898332">if</span>&nbsp;<span class="ident" id="5898335">ndst</span>&nbsp;<span class="op" id="5898340">==</span>&nbsp;<span class="num" id="5898343">0</span>&nbsp;<span class="op" id="5898345">&amp;&amp;</span>&nbsp;<span class="ident" id="5898348">d</span><span class="op" id="5898349">.</span><span class="ident" id="5898350">err</span>&nbsp;<span class="op" id="5898354">==</span>&nbsp;<span class="ident" id="5898357">nil</span>&nbsp;<span class="op" id="5898361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5898367">//&nbsp;Special&nbsp;case:&nbsp;input&nbsp;buffer&nbsp;is&nbsp;mostly&nbsp;filled&nbsp;with&nbsp;non-data&nbsp;bytes.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5898439">//&nbsp;Filter&nbsp;out&nbsp;such&nbsp;bytes&nbsp;to&nbsp;make&nbsp;room&nbsp;for&nbsp;more&nbsp;input.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5898497">off</span>&nbsp;<span class="op" id="5898501">:=</span>&nbsp;<span class="num" id="5898504">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5898510">for</span>&nbsp;<span class="ident" id="5898514">i</span>&nbsp;<span class="op" id="5898516">:=</span>&nbsp;<span class="num" id="5898519">0</span><span class="op" id="5898520">;</span>&nbsp;<span class="ident" id="5898522">i</span>&nbsp;<span class="op" id="5898524">&lt;</span>&nbsp;<span class="ident" id="5898526">d</span><span class="op" id="5898527">.</span><span class="ident" id="5898528">nbuf</span><span class="op" id="5898532">;</span>&nbsp;<span class="ident" id="5898534">i</span><span class="op" id="5898535">++</span>&nbsp;<span class="op" id="5898538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5898545">if</span>&nbsp;<span class="ident" id="5898548">d</span><span class="op" id="5898549">.</span><span class="ident" id="5898550">buf</span><span class="op" id="5898553">[</span><span class="ident" id="5898554">i</span><span class="op" id="5898555">]</span>&nbsp;<span class="op" id="5898557">&gt;</span>&nbsp;<span class="string" id="5898559">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5898563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5898571">d</span><span class="op" id="5898572">.</span><span class="ident" id="5898573">buf</span><span class="op" id="5898576">[</span><span class="ident" id="5898577">off</span><span class="op" id="5898580">]</span>&nbsp;<span class="op" id="5898582">=</span>&nbsp;<span class="ident" id="5898584">d</span><span class="op" id="5898585">.</span><span class="ident" id="5898586">buf</span><span class="op" id="5898589">[</span><span class="ident" id="5898590">i</span><span class="op" id="5898591">]</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5898599">off</span><span class="op" id="5898602">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5898610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5898616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5898622">d</span><span class="op" id="5898623">.</span><span class="ident" id="5898624">nbuf</span>&nbsp;<span class="op" id="5898629">=</span>&nbsp;<span class="ident" id="5898631">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5898638">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5898642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5898647">//&nbsp;Out&nbsp;of&nbsp;input,&nbsp;out&nbsp;of&nbsp;decoded&nbsp;output.&nbsp;&nbsp;Check&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5898704">if</span>&nbsp;<span class="ident" id="5898707">d</span><span class="op" id="5898708">.</span><span class="ident" id="5898709">err</span>&nbsp;<span class="op" id="5898713">!=</span>&nbsp;<span class="ident" id="5898716">nil</span>&nbsp;<span class="op" id="5898720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5898725">return</span>&nbsp;<span class="num" id="5898732">0</span><span class="op" id="5898733">,</span>&nbsp;<span class="ident" id="5898735">d</span><span class="op" id="5898736">.</span><span class="ident" id="5898737">err</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5898743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5898747">if</span>&nbsp;<span class="ident" id="5898750">d</span><span class="op" id="5898751">.</span><span class="ident" id="5898752">readErr</span>&nbsp;<span class="op" id="5898760">!=</span>&nbsp;<span class="ident" id="5898763">nil</span>&nbsp;<span class="op" id="5898767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5898772">d</span><span class="op" id="5898773">.</span><span class="ident" id="5898774">err</span>&nbsp;<span class="op" id="5898778">=</span>&nbsp;<span class="ident" id="5898780">d</span><span class="op" id="5898781">.</span><span class="ident" id="5898782">readErr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5898793">return</span>&nbsp;<span class="num" id="5898800">0</span><span class="op" id="5898801">,</span>&nbsp;<span class="ident" id="5898803">d</span><span class="op" id="5898804">.</span><span class="ident" id="5898805">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5898811">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5898816">//&nbsp;Read&nbsp;more&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5898837">nn</span><span class="op" id="5898839">,</span>&nbsp;<span class="ident" id="5898841">d</span><span class="op" id="5898842">.</span><span class="ident" id="5898843">readErr</span>&nbsp;<span class="op" id="5898851">=</span>&nbsp;<span class="ident" id="5898853">d</span><span class="op" id="5898854">.</span><span class="ident" id="5898855">r</span><span class="op" id="5898856">.</span><span class="ident" id="5898857">Read</span><span class="op" id="5898861">(</span><span class="ident" id="5898862">d</span><span class="op" id="5898863">.</span><span class="ident" id="5898864">buf</span><span class="op" id="5898867">[</span><span class="ident" id="5898868">d</span><span class="op" id="5898869">.</span><span class="ident" id="5898870">nbuf</span><span class="op" id="5898874">:</span><span class="op" id="5898875">]</span><span class="op" id="5898876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5898880">d</span><span class="op" id="5898881">.</span><span class="ident" id="5898882">nbuf</span>&nbsp;<span class="op" id="5898887">+=</span>&nbsp;<span class="ident" id="5898890">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5898894">}</span><br>
<span class="lineno">310</span><span class="op" id="5898896">}</span>
</div>
</body>
</html>
