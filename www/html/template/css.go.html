<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4389470">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4389525">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4389579">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4389630">package</span>&nbsp;<span class="ident" id="4389638">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4389648">import</span>&nbsp;<span class="op" id="4389655">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4389658">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4389667">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4389674">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4389685">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4389700">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4389703">//&nbsp;endsWithCSSKeyword&nbsp;reports&nbsp;whether&nbsp;b&nbsp;ends&nbsp;with&nbsp;an&nbsp;ident&nbsp;that</span><br>
<span class="lineno">15</span><span class="comment" id="4389767">//&nbsp;case-insensitively&nbsp;matches&nbsp;the&nbsp;lower-case&nbsp;kw.</span><br>
<span class="lineno"></span><span class="keyword" id="4389816">func</span>&nbsp;<span class="ident" id="4389821">endsWithCSSKeyword</span><span class="op" id="4389839">(</span><span class="ident" id="4389840">b</span>&nbsp;<span class="op" id="4389842">[</span><span class="op" id="4389843">]</span><span class="builtintype" id="4389844">byte</span><span class="op" id="4389848">,</span>&nbsp;<span class="ident" id="4389850">kw</span>&nbsp;<span class="builtintype" id="4389853">string</span><span class="op" id="4389859">)</span>&nbsp;<span class="builtintype" id="4389861">bool</span>&nbsp;<span class="op" id="4389866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4389869">i</span>&nbsp;<span class="op" id="4389871">:=</span>&nbsp;<span class="builtinfunc" id="4389874">len</span><span class="op" id="4389877">(</span><span class="ident" id="4389878">b</span><span class="op" id="4389879">)</span>&nbsp;<span class="op" id="4389881">-</span>&nbsp;<span class="builtinfunc" id="4389883">len</span><span class="op" id="4389886">(</span><span class="ident" id="4389887">kw</span><span class="op" id="4389889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4389892">if</span>&nbsp;<span class="ident" id="4389895">i</span>&nbsp;<span class="op" id="4389897">&lt;</span>&nbsp;<span class="num" id="4389899">0</span>&nbsp;<span class="op" id="4389901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4389905">//&nbsp;Too&nbsp;short.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4389921">return</span>&nbsp;<span class="ident" id="4389928">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4389935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4389938">if</span>&nbsp;<span class="ident" id="4389941">i</span>&nbsp;<span class="op" id="4389943">!=</span>&nbsp;<span class="num" id="4389946">0</span>&nbsp;<span class="op" id="4389948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4389952">r</span><span class="op" id="4389953">,</span>&nbsp;<span class="ident" id="4389955">_</span>&nbsp;<span class="op" id="4389957">:=</span>&nbsp;<span class="ident" id="4389960">utf8</span><span class="op" id="4389964">.</span><span class="ident" id="4389965">DecodeLastRune</span><span class="op" id="4389979">(</span><span class="ident" id="4389980">b</span><span class="op" id="4389981">[</span><span class="op" id="4389982">:</span><span class="ident" id="4389983">i</span><span class="op" id="4389984">]</span><span class="op" id="4389985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4389989">if</span>&nbsp;<span class="ident" id="4389992">isCSSNmchar</span><span class="op" id="4390003">(</span><span class="ident" id="4390004">r</span><span class="op" id="4390005">)</span>&nbsp;<span class="op" id="4390007">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4390012">//&nbsp;Too&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4390028">return</span>&nbsp;<span class="ident" id="4390035">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4390043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4390046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4390049">//&nbsp;Many&nbsp;CSS&nbsp;keywords,&nbsp;such&nbsp;as&nbsp;&#34;!important&#34;&nbsp;can&nbsp;have&nbsp;characters&nbsp;encoded,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4390122">//&nbsp;but&nbsp;the&nbsp;URI&nbsp;production&nbsp;does&nbsp;not&nbsp;allow&nbsp;that&nbsp;according&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4390182">//&nbsp;http://www.w3.org/TR/css3-syntax/#TOK-URI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4390228">//&nbsp;This&nbsp;does&nbsp;not&nbsp;attempt&nbsp;to&nbsp;recognize&nbsp;encoded&nbsp;keywords.&nbsp;For&nbsp;example,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4390298">//&nbsp;given&nbsp;&#34;\75\72\6c&#34;&nbsp;and&nbsp;&#34;url&#34;&nbsp;this&nbsp;return&nbsp;false.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4390349">return</span>&nbsp;<span class="builtintype" id="4390356">string</span><span class="op" id="4390362">(</span><span class="ident" id="4390363">bytes</span><span class="op" id="4390368">.</span><span class="ident" id="4390369">ToLower</span><span class="op" id="4390376">(</span><span class="ident" id="4390377">b</span><span class="op" id="4390378">[</span><span class="ident" id="4390379">i</span><span class="op" id="4390380">:</span><span class="op" id="4390381">]</span><span class="op" id="4390382">)</span><span class="op" id="4390383">)</span>&nbsp;<span class="op" id="4390385">==</span>&nbsp;<span class="ident" id="4390388">kw</span><br>
<span class="lineno">35</span><span class="op" id="4390391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4390394">//&nbsp;isCSSNmchar&nbsp;reports&nbsp;whether&nbsp;rune&nbsp;is&nbsp;allowed&nbsp;anywhere&nbsp;in&nbsp;a&nbsp;CSS&nbsp;identifier.</span><br>
<span class="lineno"></span><span class="keyword" id="4390471">func</span>&nbsp;<span class="ident" id="4390476">isCSSNmchar</span><span class="op" id="4390487">(</span><span class="ident" id="4390488">r</span>&nbsp;<span class="builtintype" id="4390490">rune</span><span class="op" id="4390494">)</span>&nbsp;<span class="builtintype" id="4390496">bool</span>&nbsp;<span class="op" id="4390501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4390504">//&nbsp;Based&nbsp;on&nbsp;the&nbsp;CSS3&nbsp;nmchar&nbsp;production&nbsp;but&nbsp;ignores&nbsp;multi-rune&nbsp;escape</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4390574">//&nbsp;sequences.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4390589">//&nbsp;http://www.w3.org/TR/css3-syntax/#SUBTOK-nmchar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4390641">return</span>&nbsp;<span class="string" id="4390648">&#39;a&#39;</span>&nbsp;<span class="op" id="4390652">&lt;=</span>&nbsp;<span class="ident" id="4390655">r</span>&nbsp;<span class="op" id="4390657">&amp;&amp;</span>&nbsp;<span class="ident" id="4390660">r</span>&nbsp;<span class="op" id="4390662">&lt;=</span>&nbsp;<span class="string" id="4390665">&#39;z&#39;</span>&nbsp;<span class="op" id="4390669">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4390674">&#39;A&#39;</span>&nbsp;<span class="op" id="4390678">&lt;=</span>&nbsp;<span class="ident" id="4390681">r</span>&nbsp;<span class="op" id="4390683">&amp;&amp;</span>&nbsp;<span class="ident" id="4390686">r</span>&nbsp;<span class="op" id="4390688">&lt;=</span>&nbsp;<span class="string" id="4390691">&#39;Z&#39;</span>&nbsp;<span class="op" id="4390695">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4390700">&#39;0&#39;</span>&nbsp;<span class="op" id="4390704">&lt;=</span>&nbsp;<span class="ident" id="4390707">r</span>&nbsp;<span class="op" id="4390709">&amp;&amp;</span>&nbsp;<span class="ident" id="4390712">r</span>&nbsp;<span class="op" id="4390714">&lt;=</span>&nbsp;<span class="string" id="4390717">&#39;9&#39;</span>&nbsp;<span class="op" id="4390721">||</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4390726">r</span>&nbsp;<span class="op" id="4390728">==</span>&nbsp;<span class="string" id="4390731">&#39;-&#39;</span>&nbsp;<span class="op" id="4390735">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4390740">r</span>&nbsp;<span class="op" id="4390742">==</span>&nbsp;<span class="string" id="4390745">&#39;_&#39;</span>&nbsp;<span class="op" id="4390749">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4390754">//&nbsp;Non-ASCII&nbsp;cases&nbsp;below.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4390782">0x80</span>&nbsp;<span class="op" id="4390787">&lt;=</span>&nbsp;<span class="ident" id="4390790">r</span>&nbsp;<span class="op" id="4390792">&amp;&amp;</span>&nbsp;<span class="ident" id="4390795">r</span>&nbsp;<span class="op" id="4390797">&lt;=</span>&nbsp;<span class="num" id="4390800">0xd7ff</span>&nbsp;<span class="op" id="4390807">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4390812">0xe000</span>&nbsp;<span class="op" id="4390819">&lt;=</span>&nbsp;<span class="ident" id="4390822">r</span>&nbsp;<span class="op" id="4390824">&amp;&amp;</span>&nbsp;<span class="ident" id="4390827">r</span>&nbsp;<span class="op" id="4390829">&lt;=</span>&nbsp;<span class="num" id="4390832">0xfffd</span>&nbsp;<span class="op" id="4390839">||</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4390844">0x10000</span>&nbsp;<span class="op" id="4390852">&lt;=</span>&nbsp;<span class="ident" id="4390855">r</span>&nbsp;<span class="op" id="4390857">&amp;&amp;</span>&nbsp;<span class="ident" id="4390860">r</span>&nbsp;<span class="op" id="4390862">&lt;=</span>&nbsp;<span class="num" id="4390865">0x10ffff</span><br>
<span class="lineno"></span><span class="op" id="4390874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4390877">//&nbsp;decodeCSS&nbsp;decodes&nbsp;CSS3&nbsp;escapes&nbsp;given&nbsp;a&nbsp;sequence&nbsp;of&nbsp;stringchars.</span><br>
<span class="lineno"></span><span class="comment" id="4390944">//&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;change,&nbsp;it&nbsp;returns&nbsp;the&nbsp;input,&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice</span><br>
<span class="lineno">55</span><span class="comment" id="4391021">//&nbsp;backed&nbsp;by&nbsp;a&nbsp;new&nbsp;array.</span><br>
<span class="lineno"></span><span class="comment" id="4391047">//&nbsp;http://www.w3.org/TR/css3-syntax/#SUBTOK-stringchar&nbsp;defines&nbsp;stringchar.</span><br>
<span class="lineno"></span><span class="keyword" id="4391122">func</span>&nbsp;<span class="ident" id="4391127">decodeCSS</span><span class="op" id="4391136">(</span><span class="ident" id="4391137">s</span>&nbsp;<span class="op" id="4391139">[</span><span class="op" id="4391140">]</span><span class="builtintype" id="4391141">byte</span><span class="op" id="4391145">)</span>&nbsp;<span class="op" id="4391147">[</span><span class="op" id="4391148">]</span><span class="builtintype" id="4391149">byte</span>&nbsp;<span class="op" id="4391154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4391157">i</span>&nbsp;<span class="op" id="4391159">:=</span>&nbsp;<span class="ident" id="4391162">bytes</span><span class="op" id="4391167">.</span><span class="ident" id="4391168">IndexByte</span><span class="op" id="4391177">(</span><span class="ident" id="4391178">s</span><span class="op" id="4391179">,</span>&nbsp;<span class="string" id="4391181">&#39;\\&#39;</span><span class="op" id="4391185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4391188">if</span>&nbsp;<span class="ident" id="4391191">i</span>&nbsp;<span class="op" id="4391193">==</span>&nbsp;<span class="op" id="4391196">-</span><span class="num" id="4391197">1</span>&nbsp;<span class="op" id="4391199">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4391203">return</span>&nbsp;<span class="ident" id="4391210">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4391213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4391216">//&nbsp;The&nbsp;UTF-8&nbsp;sequence&nbsp;for&nbsp;a&nbsp;codepoint&nbsp;is&nbsp;never&nbsp;longer&nbsp;than&nbsp;1&nbsp;+&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4391284">//&nbsp;number&nbsp;hex&nbsp;digits&nbsp;need&nbsp;to&nbsp;represent&nbsp;that&nbsp;codepoint,&nbsp;so&nbsp;len(s)&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4391356">//&nbsp;upper&nbsp;bound&nbsp;on&nbsp;the&nbsp;output&nbsp;length.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4391394">b</span>&nbsp;<span class="op" id="4391396">:=</span>&nbsp;<span class="builtinfunc" id="4391399">make</span><span class="op" id="4391403">(</span><span class="op" id="4391404">[</span><span class="op" id="4391405">]</span><span class="builtintype" id="4391406">byte</span><span class="op" id="4391410">,</span>&nbsp;<span class="num" id="4391412">0</span><span class="op" id="4391413">,</span>&nbsp;<span class="builtinfunc" id="4391415">len</span><span class="op" id="4391418">(</span><span class="ident" id="4391419">s</span><span class="op" id="4391420">)</span><span class="op" id="4391421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4391424">for</span>&nbsp;<span class="builtinfunc" id="4391428">len</span><span class="op" id="4391431">(</span><span class="ident" id="4391432">s</span><span class="op" id="4391433">)</span>&nbsp;<span class="op" id="4391435">!=</span>&nbsp;<span class="num" id="4391438">0</span>&nbsp;<span class="op" id="4391440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4391444">i</span>&nbsp;<span class="op" id="4391446">:=</span>&nbsp;<span class="ident" id="4391449">bytes</span><span class="op" id="4391454">.</span><span class="ident" id="4391455">IndexByte</span><span class="op" id="4391464">(</span><span class="ident" id="4391465">s</span><span class="op" id="4391466">,</span>&nbsp;<span class="string" id="4391468">&#39;\\&#39;</span><span class="op" id="4391472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4391476">if</span>&nbsp;<span class="ident" id="4391479">i</span>&nbsp;<span class="op" id="4391481">==</span>&nbsp;<span class="op" id="4391484">-</span><span class="num" id="4391485">1</span>&nbsp;<span class="op" id="4391487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4391492">i</span>&nbsp;<span class="op" id="4391494">=</span>&nbsp;<span class="builtinfunc" id="4391496">len</span><span class="op" id="4391499">(</span><span class="ident" id="4391500">s</span><span class="op" id="4391501">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4391505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4391509">b</span><span class="op" id="4391510">,</span>&nbsp;<span class="ident" id="4391512">s</span>&nbsp;<span class="op" id="4391514">=</span>&nbsp;<span class="builtinfunc" id="4391516">append</span><span class="op" id="4391522">(</span><span class="ident" id="4391523">b</span><span class="op" id="4391524">,</span>&nbsp;<span class="ident" id="4391526">s</span><span class="op" id="4391527">[</span><span class="op" id="4391528">:</span><span class="ident" id="4391529">i</span><span class="op" id="4391530">]</span><span class="op" id="4391531">...</span><span class="op" id="4391534">)</span><span class="op" id="4391535">,</span>&nbsp;<span class="ident" id="4391537">s</span><span class="op" id="4391538">[</span><span class="ident" id="4391539">i</span><span class="op" id="4391540">:</span><span class="op" id="4391541">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4391545">if</span>&nbsp;<span class="builtinfunc" id="4391548">len</span><span class="op" id="4391551">(</span><span class="ident" id="4391552">s</span><span class="op" id="4391553">)</span>&nbsp;<span class="op" id="4391555">&lt;</span>&nbsp;<span class="num" id="4391557">2</span>&nbsp;<span class="op" id="4391559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4391564">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4391572">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4391576">//&nbsp;http://www.w3.org/TR/css3-syntax/#SUBTOK-escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4391629">//&nbsp;escape&nbsp;::=&nbsp;unicode&nbsp;|&nbsp;&#39;\&#39;&nbsp;[#x20-#x7E#x80-#xD7FF#xE000-#xFFFD#x10000-#x10FFFF]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4391711">if</span>&nbsp;<span class="ident" id="4391714">isHex</span><span class="op" id="4391719">(</span><span class="ident" id="4391720">s</span><span class="op" id="4391721">[</span><span class="num" id="4391722">1</span><span class="op" id="4391723">]</span><span class="op" id="4391724">)</span>&nbsp;<span class="op" id="4391726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4391731">//&nbsp;http://www.w3.org/TR/css3-syntax/#SUBTOK-unicode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4391786">//&nbsp;&nbsp;&nbsp;unicode&nbsp;::=&nbsp;&#39;\&#39;&nbsp;[0-9a-fA-F]{1,6}&nbsp;wc?</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4391831">j</span>&nbsp;<span class="op" id="4391833">:=</span>&nbsp;<span class="num" id="4391836">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4391841">for</span>&nbsp;<span class="ident" id="4391845">j</span>&nbsp;<span class="op" id="4391847">&lt;</span>&nbsp;<span class="builtinfunc" id="4391849">len</span><span class="op" id="4391852">(</span><span class="ident" id="4391853">s</span><span class="op" id="4391854">)</span>&nbsp;<span class="op" id="4391856">&amp;&amp;</span>&nbsp;<span class="ident" id="4391859">j</span>&nbsp;<span class="op" id="4391861">&lt;</span>&nbsp;<span class="num" id="4391863">7</span>&nbsp;<span class="op" id="4391865">&amp;&amp;</span>&nbsp;<span class="ident" id="4391868">isHex</span><span class="op" id="4391873">(</span><span class="ident" id="4391874">s</span><span class="op" id="4391875">[</span><span class="ident" id="4391876">j</span><span class="op" id="4391877">]</span><span class="op" id="4391878">)</span>&nbsp;<span class="op" id="4391880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4391886">j</span><span class="op" id="4391887">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4391893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4391898">r</span>&nbsp;<span class="op" id="4391900">:=</span>&nbsp;<span class="ident" id="4391903">hexDecode</span><span class="op" id="4391912">(</span><span class="ident" id="4391913">s</span><span class="op" id="4391914">[</span><span class="num" id="4391915">1</span><span class="op" id="4391916">:</span><span class="ident" id="4391917">j</span><span class="op" id="4391918">]</span><span class="op" id="4391919">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4391924">if</span>&nbsp;<span class="ident" id="4391927">r</span>&nbsp;<span class="op" id="4391929">&gt;</span>&nbsp;<span class="ident" id="4391931">unicode</span><span class="op" id="4391938">.</span><span class="ident" id="4391939">MaxRune</span>&nbsp;<span class="op" id="4391947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4391953">r</span><span class="op" id="4391954">,</span>&nbsp;<span class="ident" id="4391956">j</span>&nbsp;<span class="op" id="4391958">=</span>&nbsp;<span class="ident" id="4391960">r</span><span class="op" id="4391961">/</span><span class="num" id="4391962">16</span><span class="op" id="4391964">,</span>&nbsp;<span class="ident" id="4391966">j</span><span class="op" id="4391967">-</span><span class="num" id="4391968">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4391973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4391978">n</span>&nbsp;<span class="op" id="4391980">:=</span>&nbsp;<span class="ident" id="4391983">utf8</span><span class="op" id="4391987">.</span><span class="ident" id="4391988">EncodeRune</span><span class="op" id="4391998">(</span><span class="ident" id="4391999">b</span><span class="op" id="4392000">[</span><span class="builtinfunc" id="4392001">len</span><span class="op" id="4392004">(</span><span class="ident" id="4392005">b</span><span class="op" id="4392006">)</span><span class="op" id="4392007">:</span><span class="builtinfunc" id="4392008">cap</span><span class="op" id="4392011">(</span><span class="ident" id="4392012">b</span><span class="op" id="4392013">)</span><span class="op" id="4392014">]</span><span class="op" id="4392015">,</span>&nbsp;<span class="ident" id="4392017">r</span><span class="op" id="4392018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4392023">//&nbsp;The&nbsp;optional&nbsp;space&nbsp;at&nbsp;the&nbsp;end&nbsp;allows&nbsp;a&nbsp;hex</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4392072">//&nbsp;sequence&nbsp;to&nbsp;be&nbsp;followed&nbsp;by&nbsp;a&nbsp;literal&nbsp;hex.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4392120">//&nbsp;string(decodeCSS([]byte(`\A&nbsp;B`)))&nbsp;==&nbsp;&#34;\nB&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4392169">b</span><span class="op" id="4392170">,</span>&nbsp;<span class="ident" id="4392172">s</span>&nbsp;<span class="op" id="4392174">=</span>&nbsp;<span class="ident" id="4392176">b</span><span class="op" id="4392177">[</span><span class="op" id="4392178">:</span><span class="builtinfunc" id="4392179">len</span><span class="op" id="4392182">(</span><span class="ident" id="4392183">b</span><span class="op" id="4392184">)</span><span class="op" id="4392185">+</span><span class="ident" id="4392186">n</span><span class="op" id="4392187">]</span><span class="op" id="4392188">,</span>&nbsp;<span class="ident" id="4392190">skipCSSSpace</span><span class="op" id="4392202">(</span><span class="ident" id="4392203">s</span><span class="op" id="4392204">[</span><span class="ident" id="4392205">j</span><span class="op" id="4392206">:</span><span class="op" id="4392207">]</span><span class="op" id="4392208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4392212">}</span>&nbsp;<span class="keyword" id="4392214">else</span>&nbsp;<span class="op" id="4392219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4392224">//&nbsp;`\\`&nbsp;decodes&nbsp;to&nbsp;`\`&nbsp;and&nbsp;`\&#34;`&nbsp;to&nbsp;`&#34;`.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4392267">_</span><span class="op" id="4392268">,</span>&nbsp;<span class="ident" id="4392270">n</span>&nbsp;<span class="op" id="4392272">:=</span>&nbsp;<span class="ident" id="4392275">utf8</span><span class="op" id="4392279">.</span><span class="ident" id="4392280">DecodeRune</span><span class="op" id="4392290">(</span><span class="ident" id="4392291">s</span><span class="op" id="4392292">[</span><span class="num" id="4392293">1</span><span class="op" id="4392294">:</span><span class="op" id="4392295">]</span><span class="op" id="4392296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4392301">b</span><span class="op" id="4392302">,</span>&nbsp;<span class="ident" id="4392304">s</span>&nbsp;<span class="op" id="4392306">=</span>&nbsp;<span class="builtinfunc" id="4392308">append</span><span class="op" id="4392314">(</span><span class="ident" id="4392315">b</span><span class="op" id="4392316">,</span>&nbsp;<span class="ident" id="4392318">s</span><span class="op" id="4392319">[</span><span class="num" id="4392320">1</span><span class="op" id="4392321">:</span><span class="num" id="4392322">1</span><span class="op" id="4392323">+</span><span class="ident" id="4392324">n</span><span class="op" id="4392325">]</span><span class="op" id="4392326">...</span><span class="op" id="4392329">)</span><span class="op" id="4392330">,</span>&nbsp;<span class="ident" id="4392332">s</span><span class="op" id="4392333">[</span><span class="num" id="4392334">1</span><span class="op" id="4392335">+</span><span class="ident" id="4392336">n</span><span class="op" id="4392337">:</span><span class="op" id="4392338">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4392342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4392345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4392348">return</span>&nbsp;<span class="ident" id="4392355">b</span><br>
<span class="lineno">100</span><span class="op" id="4392357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4392360">//&nbsp;isHex&nbsp;reports&nbsp;whether&nbsp;the&nbsp;given&nbsp;character&nbsp;is&nbsp;a&nbsp;hex&nbsp;digit.</span><br>
<span class="lineno"></span><span class="keyword" id="4392421">func</span>&nbsp;<span class="ident" id="4392426">isHex</span><span class="op" id="4392431">(</span><span class="ident" id="4392432">c</span>&nbsp;<span class="builtintype" id="4392434">byte</span><span class="op" id="4392438">)</span>&nbsp;<span class="builtintype" id="4392440">bool</span>&nbsp;<span class="op" id="4392445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4392448">return</span>&nbsp;<span class="string" id="4392455">&#39;0&#39;</span>&nbsp;<span class="op" id="4392459">&lt;=</span>&nbsp;<span class="ident" id="4392462">c</span>&nbsp;<span class="op" id="4392464">&amp;&amp;</span>&nbsp;<span class="ident" id="4392467">c</span>&nbsp;<span class="op" id="4392469">&lt;=</span>&nbsp;<span class="string" id="4392472">&#39;9&#39;</span>&nbsp;<span class="op" id="4392476">||</span>&nbsp;<span class="string" id="4392479">&#39;a&#39;</span>&nbsp;<span class="op" id="4392483">&lt;=</span>&nbsp;<span class="ident" id="4392486">c</span>&nbsp;<span class="op" id="4392488">&amp;&amp;</span>&nbsp;<span class="ident" id="4392491">c</span>&nbsp;<span class="op" id="4392493">&lt;=</span>&nbsp;<span class="string" id="4392496">&#39;f&#39;</span>&nbsp;<span class="op" id="4392500">||</span>&nbsp;<span class="string" id="4392503">&#39;A&#39;</span>&nbsp;<span class="op" id="4392507">&lt;=</span>&nbsp;<span class="ident" id="4392510">c</span>&nbsp;<span class="op" id="4392512">&amp;&amp;</span>&nbsp;<span class="ident" id="4392515">c</span>&nbsp;<span class="op" id="4392517">&lt;=</span>&nbsp;<span class="string" id="4392520">&#39;F&#39;</span><br>
<span class="lineno">105</span><span class="op" id="4392524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4392527">//&nbsp;hexDecode&nbsp;decodes&nbsp;a&nbsp;short&nbsp;hex&nbsp;digit&nbsp;sequence:&nbsp;&#34;10&#34;&nbsp;-&gt;&nbsp;16.</span><br>
<span class="lineno"></span><span class="keyword" id="4392588">func</span>&nbsp;<span class="ident" id="4392593">hexDecode</span><span class="op" id="4392602">(</span><span class="ident" id="4392603">s</span>&nbsp;<span class="op" id="4392605">[</span><span class="op" id="4392606">]</span><span class="builtintype" id="4392607">byte</span><span class="op" id="4392611">)</span>&nbsp;<span class="builtintype" id="4392613">rune</span>&nbsp;<span class="op" id="4392618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4392621">n</span>&nbsp;<span class="op" id="4392623">:=</span>&nbsp;<span class="string" id="4392626">&#39;\x00&#39;</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4392634">for</span>&nbsp;<span class="ident" id="4392638">_</span><span class="op" id="4392639">,</span>&nbsp;<span class="ident" id="4392641">c</span>&nbsp;<span class="op" id="4392643">:=</span>&nbsp;<span class="keyword" id="4392646">range</span>&nbsp;<span class="ident" id="4392652">s</span>&nbsp;<span class="op" id="4392654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4392658">n</span>&nbsp;<span class="op" id="4392660">&lt;&lt;=</span>&nbsp;<span class="num" id="4392664">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4392668">switch</span>&nbsp;<span class="op" id="4392675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4392679">case</span>&nbsp;<span class="string" id="4392684">&#39;0&#39;</span>&nbsp;<span class="op" id="4392688">&lt;=</span>&nbsp;<span class="ident" id="4392691">c</span>&nbsp;<span class="op" id="4392693">&amp;&amp;</span>&nbsp;<span class="ident" id="4392696">c</span>&nbsp;<span class="op" id="4392698">&lt;=</span>&nbsp;<span class="string" id="4392701">&#39;9&#39;</span><span class="op" id="4392704">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4392709">n</span>&nbsp;<span class="op" id="4392711">|=</span>&nbsp;<span class="builtintype" id="4392714">rune</span><span class="op" id="4392718">(</span><span class="ident" id="4392719">c</span>&nbsp;<span class="op" id="4392721">-</span>&nbsp;<span class="string" id="4392723">&#39;0&#39;</span><span class="op" id="4392726">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4392730">case</span>&nbsp;<span class="string" id="4392735">&#39;a&#39;</span>&nbsp;<span class="op" id="4392739">&lt;=</span>&nbsp;<span class="ident" id="4392742">c</span>&nbsp;<span class="op" id="4392744">&amp;&amp;</span>&nbsp;<span class="ident" id="4392747">c</span>&nbsp;<span class="op" id="4392749">&lt;=</span>&nbsp;<span class="string" id="4392752">&#39;f&#39;</span><span class="op" id="4392755">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4392760">n</span>&nbsp;<span class="op" id="4392762">|=</span>&nbsp;<span class="builtintype" id="4392765">rune</span><span class="op" id="4392769">(</span><span class="ident" id="4392770">c</span><span class="op" id="4392771">-</span><span class="string" id="4392772">&#39;a&#39;</span><span class="op" id="4392775">)</span>&nbsp;<span class="op" id="4392777">+</span>&nbsp;<span class="num" id="4392779">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4392784">case</span>&nbsp;<span class="string" id="4392789">&#39;A&#39;</span>&nbsp;<span class="op" id="4392793">&lt;=</span>&nbsp;<span class="ident" id="4392796">c</span>&nbsp;<span class="op" id="4392798">&amp;&amp;</span>&nbsp;<span class="ident" id="4392801">c</span>&nbsp;<span class="op" id="4392803">&lt;=</span>&nbsp;<span class="string" id="4392806">&#39;F&#39;</span><span class="op" id="4392809">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4392814">n</span>&nbsp;<span class="op" id="4392816">|=</span>&nbsp;<span class="builtintype" id="4392819">rune</span><span class="op" id="4392823">(</span><span class="ident" id="4392824">c</span><span class="op" id="4392825">-</span><span class="string" id="4392826">&#39;A&#39;</span><span class="op" id="4392829">)</span>&nbsp;<span class="op" id="4392831">+</span>&nbsp;<span class="num" id="4392833">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4392838">default</span><span class="op" id="4392845">:</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4392850">panic</span><span class="op" id="4392855">(</span><span class="ident" id="4392856">fmt</span><span class="op" id="4392859">.</span><span class="ident" id="4392860">Sprintf</span><span class="op" id="4392867">(</span><span class="string" id="4392868">&#34;Bad&nbsp;hex&nbsp;digit&nbsp;in&nbsp;%q&#34;</span><span class="op" id="4392889">,</span>&nbsp;<span class="ident" id="4392891">s</span><span class="op" id="4392892">)</span><span class="op" id="4392893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4392897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4392900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4392903">return</span>&nbsp;<span class="ident" id="4392910">n</span><br>
<span class="lineno"></span><span class="op" id="4392912">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="comment" id="4392915">//&nbsp;skipCSSSpace&nbsp;returns&nbsp;a&nbsp;suffix&nbsp;of&nbsp;c,&nbsp;skipping&nbsp;over&nbsp;a&nbsp;single&nbsp;space.</span><br>
<span class="lineno"></span><span class="keyword" id="4392984">func</span>&nbsp;<span class="ident" id="4392989">skipCSSSpace</span><span class="op" id="4393001">(</span><span class="ident" id="4393002">c</span>&nbsp;<span class="op" id="4393004">[</span><span class="op" id="4393005">]</span><span class="builtintype" id="4393006">byte</span><span class="op" id="4393010">)</span>&nbsp;<span class="op" id="4393012">[</span><span class="op" id="4393013">]</span><span class="builtintype" id="4393014">byte</span>&nbsp;<span class="op" id="4393019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4393022">if</span>&nbsp;<span class="builtinfunc" id="4393025">len</span><span class="op" id="4393028">(</span><span class="ident" id="4393029">c</span><span class="op" id="4393030">)</span>&nbsp;<span class="op" id="4393032">==</span>&nbsp;<span class="num" id="4393035">0</span>&nbsp;<span class="op" id="4393037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4393041">return</span>&nbsp;<span class="ident" id="4393048">c</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4393051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4393054">//&nbsp;wc&nbsp;::=&nbsp;#x9&nbsp;|&nbsp;#xA&nbsp;|&nbsp;#xC&nbsp;|&nbsp;#xD&nbsp;|&nbsp;#x20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4393094">switch</span>&nbsp;<span class="ident" id="4393101">c</span><span class="op" id="4393102">[</span><span class="num" id="4393103">0</span><span class="op" id="4393104">]</span>&nbsp;<span class="op" id="4393106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4393109">case</span>&nbsp;<span class="string" id="4393114">&#39;\t&#39;</span><span class="op" id="4393118">,</span>&nbsp;<span class="string" id="4393120">&#39;\n&#39;</span><span class="op" id="4393124">,</span>&nbsp;<span class="string" id="4393126">&#39;\f&#39;</span><span class="op" id="4393130">,</span>&nbsp;<span class="string" id="4393132">&#39;&nbsp;&#39;</span><span class="op" id="4393135">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4393139">return</span>&nbsp;<span class="ident" id="4393146">c</span><span class="op" id="4393147">[</span><span class="num" id="4393148">1</span><span class="op" id="4393149">:</span><span class="op" id="4393150">]</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4393153">case</span>&nbsp;<span class="string" id="4393158">&#39;\r&#39;</span><span class="op" id="4393162">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4393166">//&nbsp;This&nbsp;differs&nbsp;from&nbsp;CSS3&#39;s&nbsp;wc&nbsp;production&nbsp;because&nbsp;it&nbsp;contains&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4393232">//&nbsp;probable&nbsp;spec&nbsp;error&nbsp;whereby&nbsp;wc&nbsp;contains&nbsp;all&nbsp;the&nbsp;single&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4393297">//&nbsp;sequences&nbsp;in&nbsp;nl&nbsp;(newline)&nbsp;but&nbsp;not&nbsp;CRLF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4393342">if</span>&nbsp;<span class="builtinfunc" id="4393345">len</span><span class="op" id="4393348">(</span><span class="ident" id="4393349">c</span><span class="op" id="4393350">)</span>&nbsp;<span class="op" id="4393352">&gt;=</span>&nbsp;<span class="num" id="4393355">2</span>&nbsp;<span class="op" id="4393357">&amp;&amp;</span>&nbsp;<span class="ident" id="4393360">c</span><span class="op" id="4393361">[</span><span class="num" id="4393362">1</span><span class="op" id="4393363">]</span>&nbsp;<span class="op" id="4393365">==</span>&nbsp;<span class="string" id="4393368">&#39;\n&#39;</span>&nbsp;<span class="op" id="4393373">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4393378">return</span>&nbsp;<span class="ident" id="4393385">c</span><span class="op" id="4393386">[</span><span class="num" id="4393387">2</span><span class="op" id="4393388">:</span><span class="op" id="4393389">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4393393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4393397">return</span>&nbsp;<span class="ident" id="4393404">c</span><span class="op" id="4393405">[</span><span class="num" id="4393406">1</span><span class="op" id="4393407">:</span><span class="op" id="4393408">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4393411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4393414">return</span>&nbsp;<span class="ident" id="4393421">c</span><br>
<span class="lineno">145</span><span class="op" id="4393423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4393426">//&nbsp;isCSSSpace&nbsp;reports&nbsp;whether&nbsp;b&nbsp;is&nbsp;a&nbsp;CSS&nbsp;space&nbsp;char&nbsp;as&nbsp;defined&nbsp;in&nbsp;wc.</span><br>
<span class="lineno"></span><span class="keyword" id="4393496">func</span>&nbsp;<span class="ident" id="4393501">isCSSSpace</span><span class="op" id="4393511">(</span><span class="ident" id="4393512">b</span>&nbsp;<span class="builtintype" id="4393514">byte</span><span class="op" id="4393518">)</span>&nbsp;<span class="builtintype" id="4393520">bool</span>&nbsp;<span class="op" id="4393525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4393528">switch</span>&nbsp;<span class="ident" id="4393535">b</span>&nbsp;<span class="op" id="4393537">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4393540">case</span>&nbsp;<span class="string" id="4393545">&#39;\t&#39;</span><span class="op" id="4393549">,</span>&nbsp;<span class="string" id="4393551">&#39;\n&#39;</span><span class="op" id="4393555">,</span>&nbsp;<span class="string" id="4393557">&#39;\f&#39;</span><span class="op" id="4393561">,</span>&nbsp;<span class="string" id="4393563">&#39;\r&#39;</span><span class="op" id="4393567">,</span>&nbsp;<span class="string" id="4393569">&#39;&nbsp;&#39;</span><span class="op" id="4393572">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4393576">return</span>&nbsp;<span class="ident" id="4393583">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4393589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4393592">return</span>&nbsp;<span class="ident" id="4393599">false</span><br>
<span class="lineno"></span><span class="op" id="4393605">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="4393608">//&nbsp;cssEscaper&nbsp;escapes&nbsp;HTML&nbsp;and&nbsp;CSS&nbsp;special&nbsp;characters&nbsp;using&nbsp;\&lt;hex&gt;+&nbsp;escapes.</span><br>
<span class="lineno"></span><span class="keyword" id="4393685">func</span>&nbsp;<span class="ident" id="4393690">cssEscaper</span><span class="op" id="4393700">(</span><span class="ident" id="4393701">args</span>&nbsp;<span class="op" id="4393706">...</span><span class="keyword" id="4393709">interface</span><span class="op" id="4393718">{</span><span class="op" id="4393719">}</span><span class="op" id="4393720">)</span>&nbsp;<span class="builtintype" id="4393722">string</span>&nbsp;<span class="op" id="4393729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4393732">s</span><span class="op" id="4393733">,</span>&nbsp;<span class="ident" id="4393735">_</span>&nbsp;<span class="op" id="4393737">:=</span>&nbsp;<span class="ident" id="4393740">stringify</span><span class="op" id="4393749">(</span><span class="ident" id="4393750">args</span><span class="op" id="4393754">...</span><span class="op" id="4393757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4393760">var</span>&nbsp;<span class="ident" id="4393764">b</span>&nbsp;<span class="ident" id="4393766">bytes</span><span class="op" id="4393771">.</span><span class="ident" id="4393772">Buffer</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4393780">written</span>&nbsp;<span class="op" id="4393788">:=</span>&nbsp;<span class="num" id="4393791">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4393794">for</span>&nbsp;<span class="ident" id="4393798">i</span><span class="op" id="4393799">,</span>&nbsp;<span class="ident" id="4393801">r</span>&nbsp;<span class="op" id="4393803">:=</span>&nbsp;<span class="keyword" id="4393806">range</span>&nbsp;<span class="ident" id="4393812">s</span>&nbsp;<span class="op" id="4393814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4393818">var</span>&nbsp;<span class="ident" id="4393822">repl</span>&nbsp;<span class="builtintype" id="4393827">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4393836">switch</span>&nbsp;<span class="ident" id="4393843">r</span>&nbsp;<span class="op" id="4393845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4393849">case</span>&nbsp;<span class="num" id="4393854">0</span><span class="op" id="4393855">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4393860">repl</span>&nbsp;<span class="op" id="4393865">=</span>&nbsp;<span class="string" id="4393867">`\0`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4393874">case</span>&nbsp;<span class="string" id="4393879">&#39;\t&#39;</span><span class="op" id="4393883">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4393888">repl</span>&nbsp;<span class="op" id="4393893">=</span>&nbsp;<span class="string" id="4393895">`\9`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4393902">case</span>&nbsp;<span class="string" id="4393907">&#39;\n&#39;</span><span class="op" id="4393911">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4393916">repl</span>&nbsp;<span class="op" id="4393921">=</span>&nbsp;<span class="string" id="4393923">`\a`</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4393930">case</span>&nbsp;<span class="string" id="4393935">&#39;\f&#39;</span><span class="op" id="4393939">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4393944">repl</span>&nbsp;<span class="op" id="4393949">=</span>&nbsp;<span class="string" id="4393951">`\c`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4393958">case</span>&nbsp;<span class="string" id="4393963">&#39;\r&#39;</span><span class="op" id="4393967">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4393972">repl</span>&nbsp;<span class="op" id="4393977">=</span>&nbsp;<span class="string" id="4393979">`\d`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4393986">//&nbsp;Encode&nbsp;HTML&nbsp;specials&nbsp;as&nbsp;hex&nbsp;so&nbsp;the&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4394049">//&nbsp;in&nbsp;HTML&nbsp;attributes&nbsp;without&nbsp;further&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4394099">case</span>&nbsp;<span class="string" id="4394104">&#39;&#34;&#39;</span><span class="op" id="4394107">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394112">repl</span>&nbsp;<span class="op" id="4394117">=</span>&nbsp;<span class="string" id="4394119">`\22`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4394127">case</span>&nbsp;<span class="string" id="4394132">&#39;&amp;&#39;</span><span class="op" id="4394135">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394140">repl</span>&nbsp;<span class="op" id="4394145">=</span>&nbsp;<span class="string" id="4394147">`\26`</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4394155">case</span>&nbsp;<span class="string" id="4394160">&#39;\&#39;&#39;</span><span class="op" id="4394164">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394169">repl</span>&nbsp;<span class="op" id="4394174">=</span>&nbsp;<span class="string" id="4394176">`\27`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4394184">case</span>&nbsp;<span class="string" id="4394189">&#39;(&#39;</span><span class="op" id="4394192">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394197">repl</span>&nbsp;<span class="op" id="4394202">=</span>&nbsp;<span class="string" id="4394204">`\28`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4394212">case</span>&nbsp;<span class="string" id="4394217">&#39;)&#39;</span><span class="op" id="4394220">:</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394225">repl</span>&nbsp;<span class="op" id="4394230">=</span>&nbsp;<span class="string" id="4394232">`\29`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4394240">case</span>&nbsp;<span class="string" id="4394245">&#39;+&#39;</span><span class="op" id="4394248">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394253">repl</span>&nbsp;<span class="op" id="4394258">=</span>&nbsp;<span class="string" id="4394260">`\2b`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4394268">case</span>&nbsp;<span class="string" id="4394273">&#39;/&#39;</span><span class="op" id="4394276">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394281">repl</span>&nbsp;<span class="op" id="4394286">=</span>&nbsp;<span class="string" id="4394288">`\2f`</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4394296">case</span>&nbsp;<span class="string" id="4394301">&#39;:&#39;</span><span class="op" id="4394304">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394309">repl</span>&nbsp;<span class="op" id="4394314">=</span>&nbsp;<span class="string" id="4394316">`\3a`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4394324">case</span>&nbsp;<span class="string" id="4394329">&#39;;&#39;</span><span class="op" id="4394332">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394337">repl</span>&nbsp;<span class="op" id="4394342">=</span>&nbsp;<span class="string" id="4394344">`\3b`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4394352">case</span>&nbsp;<span class="string" id="4394357">&#39;&lt;&#39;</span><span class="op" id="4394360">:</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394365">repl</span>&nbsp;<span class="op" id="4394370">=</span>&nbsp;<span class="string" id="4394372">`\3c`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4394380">case</span>&nbsp;<span class="string" id="4394385">&#39;&gt;&#39;</span><span class="op" id="4394388">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394393">repl</span>&nbsp;<span class="op" id="4394398">=</span>&nbsp;<span class="string" id="4394400">`\3e`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4394408">case</span>&nbsp;<span class="string" id="4394413">&#39;\\&#39;</span><span class="op" id="4394417">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394422">repl</span>&nbsp;<span class="op" id="4394427">=</span>&nbsp;<span class="string" id="4394429">`\\`</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4394436">case</span>&nbsp;<span class="string" id="4394441">&#39;{&#39;</span><span class="op" id="4394444">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394449">repl</span>&nbsp;<span class="op" id="4394454">=</span>&nbsp;<span class="string" id="4394456">`\7b`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4394464">case</span>&nbsp;<span class="string" id="4394469">&#39;}&#39;</span><span class="op" id="4394472">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394477">repl</span>&nbsp;<span class="op" id="4394482">=</span>&nbsp;<span class="string" id="4394484">`\7d`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4394492">default</span><span class="op" id="4394499">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4394504">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4394515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394519">b</span><span class="op" id="4394520">.</span><span class="ident" id="4394521">WriteString</span><span class="op" id="4394532">(</span><span class="ident" id="4394533">s</span><span class="op" id="4394534">[</span><span class="ident" id="4394535">written</span><span class="op" id="4394542">:</span><span class="ident" id="4394543">i</span><span class="op" id="4394544">]</span><span class="op" id="4394545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394549">b</span><span class="op" id="4394550">.</span><span class="ident" id="4394551">WriteString</span><span class="op" id="4394562">(</span><span class="ident" id="4394563">repl</span><span class="op" id="4394567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394571">written</span>&nbsp;<span class="op" id="4394579">=</span>&nbsp;<span class="ident" id="4394581">i</span>&nbsp;<span class="op" id="4394583">+</span>&nbsp;<span class="ident" id="4394585">utf8</span><span class="op" id="4394589">.</span><span class="ident" id="4394590">RuneLen</span><span class="op" id="4394597">(</span><span class="ident" id="4394598">r</span><span class="op" id="4394599">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4394603">if</span>&nbsp;<span class="ident" id="4394606">repl</span>&nbsp;<span class="op" id="4394611">!=</span>&nbsp;<span class="string" id="4394614">`\\`</span>&nbsp;<span class="op" id="4394619">&amp;&amp;</span>&nbsp;<span class="op" id="4394622">(</span><span class="ident" id="4394623">written</span>&nbsp;<span class="op" id="4394631">==</span>&nbsp;<span class="builtinfunc" id="4394634">len</span><span class="op" id="4394637">(</span><span class="ident" id="4394638">s</span><span class="op" id="4394639">)</span>&nbsp;<span class="op" id="4394641">||</span>&nbsp;<span class="ident" id="4394644">isHex</span><span class="op" id="4394649">(</span><span class="ident" id="4394650">s</span><span class="op" id="4394651">[</span><span class="ident" id="4394652">written</span><span class="op" id="4394659">]</span><span class="op" id="4394660">)</span>&nbsp;<span class="op" id="4394662">||</span>&nbsp;<span class="ident" id="4394665">isCSSSpace</span><span class="op" id="4394675">(</span><span class="ident" id="4394676">s</span><span class="op" id="4394677">[</span><span class="ident" id="4394678">written</span><span class="op" id="4394685">]</span><span class="op" id="4394686">)</span><span class="op" id="4394687">)</span>&nbsp;<span class="op" id="4394689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394694">b</span><span class="op" id="4394695">.</span><span class="ident" id="4394696">WriteByte</span><span class="op" id="4394705">(</span><span class="string" id="4394706">&#39;&nbsp;&#39;</span><span class="op" id="4394709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4394713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4394716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4394719">if</span>&nbsp;<span class="ident" id="4394722">written</span>&nbsp;<span class="op" id="4394730">==</span>&nbsp;<span class="num" id="4394733">0</span>&nbsp;<span class="op" id="4394735">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4394739">return</span>&nbsp;<span class="ident" id="4394746">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4394749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394752">b</span><span class="op" id="4394753">.</span><span class="ident" id="4394754">WriteString</span><span class="op" id="4394765">(</span><span class="ident" id="4394766">s</span><span class="op" id="4394767">[</span><span class="ident" id="4394768">written</span><span class="op" id="4394775">:</span><span class="op" id="4394776">]</span><span class="op" id="4394777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4394780">return</span>&nbsp;<span class="ident" id="4394787">b</span><span class="op" id="4394788">.</span><span class="ident" id="4394789">String</span><span class="op" id="4394795">(</span><span class="op" id="4394796">)</span><br>
<span class="lineno"></span><span class="op" id="4394798">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="4394801">var</span>&nbsp;<span class="ident" id="4394805">expressionBytes</span>&nbsp;<span class="op" id="4394821">=</span>&nbsp;<span class="op" id="4394823">[</span><span class="op" id="4394824">]</span><span class="builtintype" id="4394825">byte</span><span class="op" id="4394829">(</span><span class="string" id="4394830">&#34;expression&#34;</span><span class="op" id="4394842">)</span><br>
<span class="lineno"></span><span class="keyword" id="4394844">var</span>&nbsp;<span class="ident" id="4394848">mozBindingBytes</span>&nbsp;<span class="op" id="4394864">=</span>&nbsp;<span class="op" id="4394866">[</span><span class="op" id="4394867">]</span><span class="builtintype" id="4394868">byte</span><span class="op" id="4394872">(</span><span class="string" id="4394873">&#34;mozbinding&#34;</span><span class="op" id="4394885">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4394888">//&nbsp;cssValueFilter&nbsp;allows&nbsp;innocuous&nbsp;CSS&nbsp;values&nbsp;in&nbsp;the&nbsp;output&nbsp;including&nbsp;CSS</span><br>
<span class="lineno">225</span><span class="comment" id="4394962">//&nbsp;quantities&nbsp;(10px&nbsp;or&nbsp;25%),&nbsp;ID&nbsp;or&nbsp;class&nbsp;literals&nbsp;(#foo,&nbsp;.bar),&nbsp;keyword&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="4395041">//&nbsp;(inherit,&nbsp;blue),&nbsp;and&nbsp;colors&nbsp;(#888).</span><br>
<span class="lineno"></span><span class="comment" id="4395080">//&nbsp;It&nbsp;filters&nbsp;out&nbsp;unsafe&nbsp;values,&nbsp;such&nbsp;as&nbsp;those&nbsp;that&nbsp;affect&nbsp;token&nbsp;boundaries,</span><br>
<span class="lineno"></span><span class="comment" id="4395157">//&nbsp;and&nbsp;anything&nbsp;that&nbsp;might&nbsp;execute&nbsp;scripts.</span><br>
<span class="lineno"></span><span class="keyword" id="4395201">func</span>&nbsp;<span class="ident" id="4395206">cssValueFilter</span><span class="op" id="4395220">(</span><span class="ident" id="4395221">args</span>&nbsp;<span class="op" id="4395226">...</span><span class="keyword" id="4395229">interface</span><span class="op" id="4395238">{</span><span class="op" id="4395239">}</span><span class="op" id="4395240">)</span>&nbsp;<span class="builtintype" id="4395242">string</span>&nbsp;<span class="op" id="4395249">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4395252">s</span><span class="op" id="4395253">,</span>&nbsp;<span class="ident" id="4395255">t</span>&nbsp;<span class="op" id="4395257">:=</span>&nbsp;<span class="ident" id="4395260">stringify</span><span class="op" id="4395269">(</span><span class="ident" id="4395270">args</span><span class="op" id="4395274">...</span><span class="op" id="4395277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4395280">if</span>&nbsp;<span class="ident" id="4395283">t</span>&nbsp;<span class="op" id="4395285">==</span>&nbsp;<span class="ident" id="4395288">contentTypeCSS</span>&nbsp;<span class="op" id="4395303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4395307">return</span>&nbsp;<span class="ident" id="4395314">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4395317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4395320">b</span><span class="op" id="4395321">,</span>&nbsp;<span class="ident" id="4395323">id</span>&nbsp;<span class="op" id="4395326">:=</span>&nbsp;<span class="ident" id="4395329">decodeCSS</span><span class="op" id="4395338">(</span><span class="op" id="4395339">[</span><span class="op" id="4395340">]</span><span class="builtintype" id="4395341">byte</span><span class="op" id="4395345">(</span><span class="ident" id="4395346">s</span><span class="op" id="4395347">)</span><span class="op" id="4395348">)</span><span class="op" id="4395349">,</span>&nbsp;<span class="builtinfunc" id="4395351">make</span><span class="op" id="4395355">(</span><span class="op" id="4395356">[</span><span class="op" id="4395357">]</span><span class="builtintype" id="4395358">byte</span><span class="op" id="4395362">,</span>&nbsp;<span class="num" id="4395364">0</span><span class="op" id="4395365">,</span>&nbsp;<span class="num" id="4395367">64</span><span class="op" id="4395369">)</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4395373">//&nbsp;CSS3&nbsp;error&nbsp;handling&nbsp;is&nbsp;specified&nbsp;as&nbsp;honoring&nbsp;string&nbsp;boundaries&nbsp;per</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4395444">//&nbsp;http://www.w3.org/TR/css3-syntax/#error-handling&nbsp;:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4395499">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Malformed&nbsp;declarations.&nbsp;User&nbsp;agents&nbsp;must&nbsp;handle&nbsp;unexpected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4395566">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tokens&nbsp;encountered&nbsp;while&nbsp;parsing&nbsp;a&nbsp;declaration&nbsp;by&nbsp;reading&nbsp;until</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4395638">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;declaration,&nbsp;while&nbsp;observing&nbsp;the&nbsp;rules&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4395704">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;matching&nbsp;pairs&nbsp;of&nbsp;(),&nbsp;[],&nbsp;{},&nbsp;&#34;&#34;,&nbsp;and&nbsp;&#39;&#39;,&nbsp;and&nbsp;correctly&nbsp;handling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4395777">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;escapes.&nbsp;For&nbsp;example,&nbsp;a&nbsp;malformed&nbsp;declaration&nbsp;may&nbsp;be&nbsp;missing&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4395848">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;property,&nbsp;colon&nbsp;(:)&nbsp;or&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4395886">//&nbsp;So&nbsp;we&nbsp;need&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;values&nbsp;do&nbsp;not&nbsp;have&nbsp;mismatched&nbsp;bracket</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4395957">//&nbsp;or&nbsp;quote&nbsp;characters&nbsp;to&nbsp;prevent&nbsp;the&nbsp;browser&nbsp;from&nbsp;restarting&nbsp;parsing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4396028">//&nbsp;inside&nbsp;a&nbsp;string&nbsp;that&nbsp;might&nbsp;embed&nbsp;JavaScript&nbsp;source.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4396084">for</span>&nbsp;<span class="ident" id="4396088">i</span><span class="op" id="4396089">,</span>&nbsp;<span class="ident" id="4396091">c</span>&nbsp;<span class="op" id="4396093">:=</span>&nbsp;<span class="keyword" id="4396096">range</span>&nbsp;<span class="ident" id="4396102">b</span>&nbsp;<span class="op" id="4396104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4396108">switch</span>&nbsp;<span class="ident" id="4396115">c</span>&nbsp;<span class="op" id="4396117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4396121">case</span>&nbsp;<span class="num" id="4396126">0</span><span class="op" id="4396127">,</span>&nbsp;<span class="string" id="4396129">&#39;&#34;&#39;</span><span class="op" id="4396132">,</span>&nbsp;<span class="string" id="4396134">&#39;\&#39;&#39;</span><span class="op" id="4396138">,</span>&nbsp;<span class="string" id="4396140">&#39;(&#39;</span><span class="op" id="4396143">,</span>&nbsp;<span class="string" id="4396145">&#39;)&#39;</span><span class="op" id="4396148">,</span>&nbsp;<span class="string" id="4396150">&#39;/&#39;</span><span class="op" id="4396153">,</span>&nbsp;<span class="string" id="4396155">&#39;;&#39;</span><span class="op" id="4396158">,</span>&nbsp;<span class="string" id="4396160">&#39;@&#39;</span><span class="op" id="4396163">,</span>&nbsp;<span class="string" id="4396165">&#39;[&#39;</span><span class="op" id="4396168">,</span>&nbsp;<span class="string" id="4396170">&#39;\\&#39;</span><span class="op" id="4396174">,</span>&nbsp;<span class="string" id="4396176">&#39;]&#39;</span><span class="op" id="4396179">,</span>&nbsp;<span class="string" id="4396181">&#39;`&#39;</span><span class="op" id="4396184">,</span>&nbsp;<span class="string" id="4396186">&#39;{&#39;</span><span class="op" id="4396189">,</span>&nbsp;<span class="string" id="4396191">&#39;}&#39;</span><span class="op" id="4396194">:</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4396199">return</span>&nbsp;<span class="ident" id="4396206">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4396223">case</span>&nbsp;<span class="string" id="4396228">&#39;-&#39;</span><span class="op" id="4396231">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4396236">//&nbsp;Disallow&nbsp;&lt;!--&nbsp;or&nbsp;--&gt;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4396264">//&nbsp;--&nbsp;should&nbsp;not&nbsp;appear&nbsp;in&nbsp;valid&nbsp;identifiers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4396313">if</span>&nbsp;<span class="ident" id="4396316">i</span>&nbsp;<span class="op" id="4396318">!=</span>&nbsp;<span class="num" id="4396321">0</span>&nbsp;<span class="op" id="4396323">&amp;&amp;</span>&nbsp;<span class="ident" id="4396326">b</span><span class="op" id="4396327">[</span><span class="ident" id="4396328">i</span><span class="op" id="4396329">-</span><span class="num" id="4396330">1</span><span class="op" id="4396331">]</span>&nbsp;<span class="op" id="4396333">==</span>&nbsp;<span class="string" id="4396336">&#39;-&#39;</span>&nbsp;<span class="op" id="4396340">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4396346">return</span>&nbsp;<span class="ident" id="4396353">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4396371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4396375">default</span><span class="op" id="4396382">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4396387">if</span>&nbsp;<span class="ident" id="4396390">c</span>&nbsp;<span class="op" id="4396392">&lt;</span>&nbsp;<span class="num" id="4396394">0x80</span>&nbsp;<span class="op" id="4396399">&amp;&amp;</span>&nbsp;<span class="ident" id="4396402">isCSSNmchar</span><span class="op" id="4396413">(</span><span class="builtintype" id="4396414">rune</span><span class="op" id="4396418">(</span><span class="ident" id="4396419">c</span><span class="op" id="4396420">)</span><span class="op" id="4396421">)</span>&nbsp;<span class="op" id="4396423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4396429">id</span>&nbsp;<span class="op" id="4396432">=</span>&nbsp;<span class="builtinfunc" id="4396434">append</span><span class="op" id="4396440">(</span><span class="ident" id="4396441">id</span><span class="op" id="4396443">,</span>&nbsp;<span class="ident" id="4396445">c</span><span class="op" id="4396446">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4396451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4396455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4396458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4396461">id</span>&nbsp;<span class="op" id="4396464">=</span>&nbsp;<span class="ident" id="4396466">bytes</span><span class="op" id="4396471">.</span><span class="ident" id="4396472">ToLower</span><span class="op" id="4396479">(</span><span class="ident" id="4396480">id</span><span class="op" id="4396482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4396485">if</span>&nbsp;<span class="ident" id="4396488">bytes</span><span class="op" id="4396493">.</span><span class="ident" id="4396494">Index</span><span class="op" id="4396499">(</span><span class="ident" id="4396500">id</span><span class="op" id="4396502">,</span>&nbsp;<span class="ident" id="4396504">expressionBytes</span><span class="op" id="4396519">)</span>&nbsp;<span class="op" id="4396521">!=</span>&nbsp;<span class="op" id="4396524">-</span><span class="num" id="4396525">1</span>&nbsp;<span class="op" id="4396527">||</span>&nbsp;<span class="ident" id="4396530">bytes</span><span class="op" id="4396535">.</span><span class="ident" id="4396536">Index</span><span class="op" id="4396541">(</span><span class="ident" id="4396542">id</span><span class="op" id="4396544">,</span>&nbsp;<span class="ident" id="4396546">mozBindingBytes</span><span class="op" id="4396561">)</span>&nbsp;<span class="op" id="4396563">!=</span>&nbsp;<span class="op" id="4396566">-</span><span class="num" id="4396567">1</span>&nbsp;<span class="op" id="4396569">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4396573">return</span>&nbsp;<span class="ident" id="4396580">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4396596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4396599">return</span>&nbsp;<span class="builtintype" id="4396606">string</span><span class="op" id="4396612">(</span><span class="ident" id="4396613">b</span><span class="op" id="4396614">)</span><br>
<span class="lineno"></span><span class="op" id="4396616">}</span>
</div>
</body>
</html>
