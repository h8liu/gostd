<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime/multipart</h2>
<ul>
<li><a href="/gostd/mime/multipart/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/mime/multipart/formdata.go.html">formdata.go</a></li>
<li><a href="/gostd/mime/multipart/formdata_test.go.html">formdata_test.go</a></li>
<li><a href="/gostd/mime/multipart/multipart.go.html">multipart.go</a></li>
<li><a href="/gostd/mime/multipart/multipart_test.go.html">multipart_test.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable.go.html">quotedprintable.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable_test.go.html">quotedprintable_test.go</a></li>
<li><a href="/gostd/mime/multipart/writer.go.html">writer.go</a></li>
<li><a href="/gostd/mime/multipart/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5073709">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5073764">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5073818">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5073869">//&nbsp;The&nbsp;file&nbsp;define&nbsp;a&nbsp;quoted-printable&nbsp;decoder,&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;2045.</span><br>
<span class="lineno"></span><span class="comment" id="5073942">//&nbsp;Deviations:</span><br>
<span class="lineno"></span><span class="comment" id="5073957">//&nbsp;1.&nbsp;in&nbsp;addition&nbsp;to&nbsp;&#34;=\r\n&#34;,&nbsp;&#34;=\n&#34;&nbsp;is&nbsp;also&nbsp;treated&nbsp;as&nbsp;soft&nbsp;line&nbsp;break.</span><br>
<span class="lineno"></span><span class="comment" id="5074029">//&nbsp;2.&nbsp;it&nbsp;will&nbsp;pass&nbsp;through&nbsp;a&nbsp;&#39;\r&#39;&nbsp;or&nbsp;&#39;\n&#39;&nbsp;not&nbsp;preceded&nbsp;by&nbsp;&#39;=&#39;,&nbsp;consistent</span><br>
<span class="lineno"></span><span class="comment" id="5074103">//&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;other&nbsp;broken&nbsp;QP&nbsp;encoders&nbsp;&amp;&nbsp;decoders.</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="5074152">package</span>&nbsp;<span class="ident" id="5074160">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5074171">import</span>&nbsp;<span class="op" id="5074178">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5074181">&#34;bufio&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5074190">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5074199">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5074206">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5074211">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="5074214">type</span>&nbsp;<span class="ident" id="5074219">qpReader</span>&nbsp;<span class="keyword" id="5074228">struct</span>&nbsp;<span class="op" id="5074235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074238">br</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5074243">*</span><span class="ident" id="5074244">bufio</span><span class="op" id="5074249">.</span><span class="ident" id="5074250">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074258">rerr</span>&nbsp;<span class="builtintype" id="5074263">error</span>&nbsp;&nbsp;<span class="comment" id="5074270">//&nbsp;last&nbsp;read&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074290">line</span>&nbsp;<span class="op" id="5074295">[</span><span class="op" id="5074296">]</span><span class="builtintype" id="5074297">byte</span>&nbsp;<span class="comment" id="5074302">//&nbsp;to&nbsp;be&nbsp;consumed&nbsp;before&nbsp;more&nbsp;of&nbsp;br</span><br>
<span class="lineno"></span><span class="op" id="5074338">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="5074341">func</span>&nbsp;<span class="ident" id="5074346">newQuotedPrintableReader</span><span class="op" id="5074370">(</span><span class="ident" id="5074371">r</span>&nbsp;<span class="ident" id="5074373">io</span><span class="op" id="5074375">.</span><span class="ident" id="5074376">Reader</span><span class="op" id="5074382">)</span>&nbsp;<span class="ident" id="5074384">io</span><span class="op" id="5074386">.</span><span class="ident" id="5074387">Reader</span>&nbsp;<span class="op" id="5074394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074397">return</span>&nbsp;<span class="op" id="5074404">&amp;</span><span class="ident" id="5074405">qpReader</span><span class="op" id="5074413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074417">br</span><span class="op" id="5074419">:</span>&nbsp;<span class="ident" id="5074421">bufio</span><span class="op" id="5074426">.</span><span class="ident" id="5074427">NewReader</span><span class="op" id="5074436">(</span><span class="ident" id="5074437">r</span><span class="op" id="5074438">)</span><span class="op" id="5074439">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5074442">}</span><br>
<span class="lineno">30</span><span class="op" id="5074444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5074447">func</span>&nbsp;<span class="ident" id="5074452">fromHex</span><span class="op" id="5074459">(</span><span class="ident" id="5074460">b</span>&nbsp;<span class="builtintype" id="5074462">byte</span><span class="op" id="5074466">)</span>&nbsp;<span class="op" id="5074468">(</span><span class="builtintype" id="5074469">byte</span><span class="op" id="5074473">,</span>&nbsp;<span class="builtintype" id="5074475">error</span><span class="op" id="5074480">)</span>&nbsp;<span class="op" id="5074482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074485">switch</span>&nbsp;<span class="op" id="5074492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074495">case</span>&nbsp;<span class="ident" id="5074500">b</span>&nbsp;<span class="op" id="5074502">&gt;=</span>&nbsp;<span class="string" id="5074505">&#39;0&#39;</span>&nbsp;<span class="op" id="5074509">&amp;&amp;</span>&nbsp;<span class="ident" id="5074512">b</span>&nbsp;<span class="op" id="5074514">&lt;=</span>&nbsp;<span class="string" id="5074517">&#39;9&#39;</span><span class="op" id="5074520">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074524">return</span>&nbsp;<span class="ident" id="5074531">b</span>&nbsp;<span class="op" id="5074533">-</span>&nbsp;<span class="string" id="5074535">&#39;0&#39;</span><span class="op" id="5074538">,</span>&nbsp;<span class="ident" id="5074540">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074545">case</span>&nbsp;<span class="ident" id="5074550">b</span>&nbsp;<span class="op" id="5074552">&gt;=</span>&nbsp;<span class="string" id="5074555">&#39;A&#39;</span>&nbsp;<span class="op" id="5074559">&amp;&amp;</span>&nbsp;<span class="ident" id="5074562">b</span>&nbsp;<span class="op" id="5074564">&lt;=</span>&nbsp;<span class="string" id="5074567">&#39;F&#39;</span><span class="op" id="5074570">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074574">return</span>&nbsp;<span class="ident" id="5074581">b</span>&nbsp;<span class="op" id="5074583">-</span>&nbsp;<span class="string" id="5074585">&#39;A&#39;</span>&nbsp;<span class="op" id="5074589">+</span>&nbsp;<span class="num" id="5074591">10</span><span class="op" id="5074593">,</span>&nbsp;<span class="ident" id="5074595">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5074600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074603">return</span>&nbsp;<span class="num" id="5074610">0</span><span class="op" id="5074611">,</span>&nbsp;<span class="ident" id="5074613">fmt</span><span class="op" id="5074616">.</span><span class="ident" id="5074617">Errorf</span><span class="op" id="5074623">(</span><span class="string" id="5074624">&#34;multipart:&nbsp;invalid&nbsp;quoted-printable&nbsp;hex&nbsp;byte&nbsp;0x%02x&#34;</span><span class="op" id="5074677">,</span>&nbsp;<span class="ident" id="5074679">b</span><span class="op" id="5074680">)</span><br>
<span class="lineno">40</span><span class="op" id="5074682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5074685">func</span>&nbsp;<span class="op" id="5074690">(</span><span class="ident" id="5074691">q</span>&nbsp;<span class="op" id="5074693">*</span><span class="ident" id="5074694">qpReader</span><span class="op" id="5074702">)</span>&nbsp;<span class="ident" id="5074704">readHexByte</span><span class="op" id="5074715">(</span><span class="ident" id="5074716">v</span>&nbsp;<span class="op" id="5074718">[</span><span class="op" id="5074719">]</span><span class="builtintype" id="5074720">byte</span><span class="op" id="5074724">)</span>&nbsp;<span class="op" id="5074726">(</span><span class="ident" id="5074727">b</span>&nbsp;<span class="builtintype" id="5074729">byte</span><span class="op" id="5074733">,</span>&nbsp;<span class="ident" id="5074735">err</span>&nbsp;<span class="builtintype" id="5074739">error</span><span class="op" id="5074744">)</span>&nbsp;<span class="op" id="5074746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074749">if</span>&nbsp;<span class="builtinfunc" id="5074752">len</span><span class="op" id="5074755">(</span><span class="ident" id="5074756">v</span><span class="op" id="5074757">)</span>&nbsp;<span class="op" id="5074759">&lt;</span>&nbsp;<span class="num" id="5074761">2</span>&nbsp;<span class="op" id="5074763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074767">return</span>&nbsp;<span class="num" id="5074774">0</span><span class="op" id="5074775">,</span>&nbsp;<span class="ident" id="5074777">io</span><span class="op" id="5074779">.</span><span class="ident" id="5074780">ErrUnexpectedEOF</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5074798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074801">var</span>&nbsp;<span class="ident" id="5074805">hb</span><span class="op" id="5074807">,</span>&nbsp;<span class="ident" id="5074809">lb</span>&nbsp;<span class="builtintype" id="5074812">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074818">if</span>&nbsp;<span class="ident" id="5074821">hb</span><span class="op" id="5074823">,</span>&nbsp;<span class="ident" id="5074825">err</span>&nbsp;<span class="op" id="5074829">=</span>&nbsp;<span class="ident" id="5074831">fromHex</span><span class="op" id="5074838">(</span><span class="ident" id="5074839">v</span><span class="op" id="5074840">[</span><span class="num" id="5074841">0</span><span class="op" id="5074842">]</span><span class="op" id="5074843">)</span><span class="op" id="5074844">;</span>&nbsp;<span class="ident" id="5074846">err</span>&nbsp;<span class="op" id="5074850">!=</span>&nbsp;<span class="ident" id="5074853">nil</span>&nbsp;<span class="op" id="5074857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074861">return</span>&nbsp;<span class="num" id="5074868">0</span><span class="op" id="5074869">,</span>&nbsp;<span class="ident" id="5074871">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5074876">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074879">if</span>&nbsp;<span class="ident" id="5074882">lb</span><span class="op" id="5074884">,</span>&nbsp;<span class="ident" id="5074886">err</span>&nbsp;<span class="op" id="5074890">=</span>&nbsp;<span class="ident" id="5074892">fromHex</span><span class="op" id="5074899">(</span><span class="ident" id="5074900">v</span><span class="op" id="5074901">[</span><span class="num" id="5074902">1</span><span class="op" id="5074903">]</span><span class="op" id="5074904">)</span><span class="op" id="5074905">;</span>&nbsp;<span class="ident" id="5074907">err</span>&nbsp;<span class="op" id="5074911">!=</span>&nbsp;<span class="ident" id="5074914">nil</span>&nbsp;<span class="op" id="5074918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074922">return</span>&nbsp;<span class="num" id="5074929">0</span><span class="op" id="5074930">,</span>&nbsp;<span class="ident" id="5074932">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5074937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074940">return</span>&nbsp;<span class="ident" id="5074947">hb</span><span class="op" id="5074949">&lt;&lt;</span><span class="num" id="5074951">4</span>&nbsp;<span class="op" id="5074953">|</span>&nbsp;<span class="ident" id="5074955">lb</span><span class="op" id="5074957">,</span>&nbsp;<span class="ident" id="5074959">nil</span><br>
<span class="lineno"></span><span class="op" id="5074963">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="5074966">func</span>&nbsp;<span class="ident" id="5074971">isQPDiscardWhitespace</span><span class="op" id="5074992">(</span><span class="ident" id="5074993">r</span>&nbsp;<span class="builtintype" id="5074995">rune</span><span class="op" id="5074999">)</span>&nbsp;<span class="builtintype" id="5075001">bool</span>&nbsp;<span class="op" id="5075006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075009">switch</span>&nbsp;<span class="ident" id="5075016">r</span>&nbsp;<span class="op" id="5075018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075021">case</span>&nbsp;<span class="string" id="5075026">&#39;\n&#39;</span><span class="op" id="5075030">,</span>&nbsp;<span class="string" id="5075032">&#39;\r&#39;</span><span class="op" id="5075036">,</span>&nbsp;<span class="string" id="5075038">&#39;&nbsp;&#39;</span><span class="op" id="5075041">,</span>&nbsp;<span class="string" id="5075043">&#39;\t&#39;</span><span class="op" id="5075047">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075051">return</span>&nbsp;<span class="builtintype" id="5075058">true</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5075064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075067">return</span>&nbsp;<span class="builtintype" id="5075074">false</span><br>
<span class="lineno"></span><span class="op" id="5075080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5075083">var</span>&nbsp;<span class="op" id="5075087">(</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075090">crlf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5075101">=</span>&nbsp;<span class="op" id="5075103">[</span><span class="op" id="5075104">]</span><span class="builtintype" id="5075105">byte</span><span class="op" id="5075109">(</span><span class="string" id="5075110">&#34;\r\n&#34;</span><span class="op" id="5075116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075119">lf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5075130">=</span>&nbsp;<span class="op" id="5075132">[</span><span class="op" id="5075133">]</span><span class="builtintype" id="5075134">byte</span><span class="op" id="5075138">(</span><span class="string" id="5075139">&#34;\n&#34;</span><span class="op" id="5075143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075146">softSuffix</span>&nbsp;<span class="op" id="5075157">=</span>&nbsp;<span class="op" id="5075159">[</span><span class="op" id="5075160">]</span><span class="builtintype" id="5075161">byte</span><span class="op" id="5075165">(</span><span class="string" id="5075166">&#34;=&#34;</span><span class="op" id="5075169">)</span><br>
<span class="lineno"></span><span class="op" id="5075171">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="5075174">func</span>&nbsp;<span class="op" id="5075179">(</span><span class="ident" id="5075180">q</span>&nbsp;<span class="op" id="5075182">*</span><span class="ident" id="5075183">qpReader</span><span class="op" id="5075191">)</span>&nbsp;<span class="ident" id="5075193">Read</span><span class="op" id="5075197">(</span><span class="ident" id="5075198">p</span>&nbsp;<span class="op" id="5075200">[</span><span class="op" id="5075201">]</span><span class="builtintype" id="5075202">byte</span><span class="op" id="5075206">)</span>&nbsp;<span class="op" id="5075208">(</span><span class="ident" id="5075209">n</span>&nbsp;<span class="builtintype" id="5075211">int</span><span class="op" id="5075214">,</span>&nbsp;<span class="ident" id="5075216">err</span>&nbsp;<span class="builtintype" id="5075220">error</span><span class="op" id="5075225">)</span>&nbsp;<span class="op" id="5075227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075230">for</span>&nbsp;<span class="builtinfunc" id="5075234">len</span><span class="op" id="5075237">(</span><span class="ident" id="5075238">p</span><span class="op" id="5075239">)</span>&nbsp;<span class="op" id="5075241">&gt;</span>&nbsp;<span class="num" id="5075243">0</span>&nbsp;<span class="op" id="5075245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075249">if</span>&nbsp;<span class="builtinfunc" id="5075252">len</span><span class="op" id="5075255">(</span><span class="ident" id="5075256">q</span><span class="op" id="5075257">.</span><span class="ident" id="5075258">line</span><span class="op" id="5075262">)</span>&nbsp;<span class="op" id="5075264">==</span>&nbsp;<span class="num" id="5075267">0</span>&nbsp;<span class="op" id="5075269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075274">if</span>&nbsp;<span class="ident" id="5075277">q</span><span class="op" id="5075278">.</span><span class="ident" id="5075279">rerr</span>&nbsp;<span class="op" id="5075284">!=</span>&nbsp;<span class="ident" id="5075287">nil</span>&nbsp;<span class="op" id="5075291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075297">return</span>&nbsp;<span class="ident" id="5075304">n</span><span class="op" id="5075305">,</span>&nbsp;<span class="ident" id="5075307">q</span><span class="op" id="5075308">.</span><span class="ident" id="5075309">rerr</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5075317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075322">q</span><span class="op" id="5075323">.</span><span class="ident" id="5075324">line</span><span class="op" id="5075328">,</span>&nbsp;<span class="ident" id="5075330">q</span><span class="op" id="5075331">.</span><span class="ident" id="5075332">rerr</span>&nbsp;<span class="op" id="5075337">=</span>&nbsp;<span class="ident" id="5075339">q</span><span class="op" id="5075340">.</span><span class="ident" id="5075341">br</span><span class="op" id="5075343">.</span><span class="ident" id="5075344">ReadSlice</span><span class="op" id="5075353">(</span><span class="string" id="5075354">&#39;\n&#39;</span><span class="op" id="5075358">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5075364">//&nbsp;Does&nbsp;the&nbsp;line&nbsp;end&nbsp;in&nbsp;CRLF&nbsp;instead&nbsp;of&nbsp;just&nbsp;LF?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075416">hasLF</span>&nbsp;<span class="op" id="5075422">:=</span>&nbsp;<span class="ident" id="5075425">bytes</span><span class="op" id="5075430">.</span><span class="ident" id="5075431">HasSuffix</span><span class="op" id="5075440">(</span><span class="ident" id="5075441">q</span><span class="op" id="5075442">.</span><span class="ident" id="5075443">line</span><span class="op" id="5075447">,</span>&nbsp;<span class="ident" id="5075449">lf</span><span class="op" id="5075451">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075456">hasCR</span>&nbsp;<span class="op" id="5075462">:=</span>&nbsp;<span class="ident" id="5075465">bytes</span><span class="op" id="5075470">.</span><span class="ident" id="5075471">HasSuffix</span><span class="op" id="5075480">(</span><span class="ident" id="5075481">q</span><span class="op" id="5075482">.</span><span class="ident" id="5075483">line</span><span class="op" id="5075487">,</span>&nbsp;<span class="ident" id="5075489">crlf</span><span class="op" id="5075493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075498">wholeLine</span>&nbsp;<span class="op" id="5075508">:=</span>&nbsp;<span class="ident" id="5075511">q</span><span class="op" id="5075512">.</span><span class="ident" id="5075513">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075521">q</span><span class="op" id="5075522">.</span><span class="ident" id="5075523">line</span>&nbsp;<span class="op" id="5075528">=</span>&nbsp;<span class="ident" id="5075530">bytes</span><span class="op" id="5075535">.</span><span class="ident" id="5075536">TrimRightFunc</span><span class="op" id="5075549">(</span><span class="ident" id="5075550">wholeLine</span><span class="op" id="5075559">,</span>&nbsp;<span class="ident" id="5075561">isQPDiscardWhitespace</span><span class="op" id="5075582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075587">if</span>&nbsp;<span class="ident" id="5075590">bytes</span><span class="op" id="5075595">.</span><span class="ident" id="5075596">HasSuffix</span><span class="op" id="5075605">(</span><span class="ident" id="5075606">q</span><span class="op" id="5075607">.</span><span class="ident" id="5075608">line</span><span class="op" id="5075612">,</span>&nbsp;<span class="ident" id="5075614">softSuffix</span><span class="op" id="5075624">)</span>&nbsp;<span class="op" id="5075626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075632">rightStripped</span>&nbsp;<span class="op" id="5075646">:=</span>&nbsp;<span class="ident" id="5075649">wholeLine</span><span class="op" id="5075658">[</span><span class="builtinfunc" id="5075659">len</span><span class="op" id="5075662">(</span><span class="ident" id="5075663">q</span><span class="op" id="5075664">.</span><span class="ident" id="5075665">line</span><span class="op" id="5075669">)</span><span class="op" id="5075670">:</span><span class="op" id="5075671">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075677">q</span><span class="op" id="5075678">.</span><span class="ident" id="5075679">line</span>&nbsp;<span class="op" id="5075684">=</span>&nbsp;<span class="ident" id="5075686">q</span><span class="op" id="5075687">.</span><span class="ident" id="5075688">line</span><span class="op" id="5075692">[</span><span class="op" id="5075693">:</span><span class="builtinfunc" id="5075694">len</span><span class="op" id="5075697">(</span><span class="ident" id="5075698">q</span><span class="op" id="5075699">.</span><span class="ident" id="5075700">line</span><span class="op" id="5075704">)</span><span class="op" id="5075705">-</span><span class="num" id="5075706">1</span><span class="op" id="5075707">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075713">if</span>&nbsp;<span class="op" id="5075716">!</span><span class="ident" id="5075717">bytes</span><span class="op" id="5075722">.</span><span class="ident" id="5075723">HasPrefix</span><span class="op" id="5075732">(</span><span class="ident" id="5075733">rightStripped</span><span class="op" id="5075746">,</span>&nbsp;<span class="ident" id="5075748">lf</span><span class="op" id="5075750">)</span>&nbsp;<span class="op" id="5075752">&amp;&amp;</span>&nbsp;<span class="op" id="5075755">!</span><span class="ident" id="5075756">bytes</span><span class="op" id="5075761">.</span><span class="ident" id="5075762">HasPrefix</span><span class="op" id="5075771">(</span><span class="ident" id="5075772">rightStripped</span><span class="op" id="5075785">,</span>&nbsp;<span class="ident" id="5075787">crlf</span><span class="op" id="5075791">)</span>&nbsp;<span class="op" id="5075793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075800">q</span><span class="op" id="5075801">.</span><span class="ident" id="5075802">rerr</span>&nbsp;<span class="op" id="5075807">=</span>&nbsp;<span class="ident" id="5075809">fmt</span><span class="op" id="5075812">.</span><span class="ident" id="5075813">Errorf</span><span class="op" id="5075819">(</span><span class="string" id="5075820">&#34;multipart:&nbsp;invalid&nbsp;bytes&nbsp;after&nbsp;=:&nbsp;%q&#34;</span><span class="op" id="5075858">,</span>&nbsp;<span class="ident" id="5075860">rightStripped</span><span class="op" id="5075873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5075879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5075884">}</span>&nbsp;<span class="keyword" id="5075886">else</span>&nbsp;<span class="keyword" id="5075891">if</span>&nbsp;<span class="ident" id="5075894">hasLF</span>&nbsp;<span class="op" id="5075900">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075906">if</span>&nbsp;<span class="ident" id="5075909">hasCR</span>&nbsp;<span class="op" id="5075915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075922">q</span><span class="op" id="5075923">.</span><span class="ident" id="5075924">line</span>&nbsp;<span class="op" id="5075929">=</span>&nbsp;<span class="builtinfunc" id="5075931">append</span><span class="op" id="5075937">(</span><span class="ident" id="5075938">q</span><span class="op" id="5075939">.</span><span class="ident" id="5075940">line</span><span class="op" id="5075944">,</span>&nbsp;<span class="string" id="5075946">&#39;\r&#39;</span><span class="op" id="5075950">,</span>&nbsp;<span class="string" id="5075952">&#39;\n&#39;</span><span class="op" id="5075956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5075962">}</span>&nbsp;<span class="keyword" id="5075964">else</span>&nbsp;<span class="op" id="5075969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075976">q</span><span class="op" id="5075977">.</span><span class="ident" id="5075978">line</span>&nbsp;<span class="op" id="5075983">=</span>&nbsp;<span class="builtinfunc" id="5075985">append</span><span class="op" id="5075991">(</span><span class="ident" id="5075992">q</span><span class="op" id="5075993">.</span><span class="ident" id="5075994">line</span><span class="op" id="5075998">,</span>&nbsp;<span class="string" id="5076000">&#39;\n&#39;</span><span class="op" id="5076004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076010">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076020">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076035">b</span>&nbsp;<span class="op" id="5076037">:=</span>&nbsp;<span class="ident" id="5076040">q</span><span class="op" id="5076041">.</span><span class="ident" id="5076042">line</span><span class="op" id="5076046">[</span><span class="num" id="5076047">0</span><span class="op" id="5076048">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076053">switch</span>&nbsp;<span class="op" id="5076060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076064">case</span>&nbsp;<span class="ident" id="5076069">b</span>&nbsp;<span class="op" id="5076071">==</span>&nbsp;<span class="string" id="5076074">&#39;=&#39;</span><span class="op" id="5076077">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076082">b</span><span class="op" id="5076083">,</span>&nbsp;<span class="ident" id="5076085">err</span>&nbsp;<span class="op" id="5076089">=</span>&nbsp;<span class="ident" id="5076091">q</span><span class="op" id="5076092">.</span><span class="ident" id="5076093">readHexByte</span><span class="op" id="5076104">(</span><span class="ident" id="5076105">q</span><span class="op" id="5076106">.</span><span class="ident" id="5076107">line</span><span class="op" id="5076111">[</span><span class="num" id="5076112">1</span><span class="op" id="5076113">:</span><span class="op" id="5076114">]</span><span class="op" id="5076115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076120">if</span>&nbsp;<span class="ident" id="5076123">err</span>&nbsp;<span class="op" id="5076127">!=</span>&nbsp;<span class="ident" id="5076130">nil</span>&nbsp;<span class="op" id="5076134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076140">return</span>&nbsp;<span class="ident" id="5076147">n</span><span class="op" id="5076148">,</span>&nbsp;<span class="ident" id="5076150">err</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076162">q</span><span class="op" id="5076163">.</span><span class="ident" id="5076164">line</span>&nbsp;<span class="op" id="5076169">=</span>&nbsp;<span class="ident" id="5076171">q</span><span class="op" id="5076172">.</span><span class="ident" id="5076173">line</span><span class="op" id="5076177">[</span><span class="num" id="5076178">2</span><span class="op" id="5076179">:</span><span class="op" id="5076180">]</span>&nbsp;<span class="comment" id="5076182">//&nbsp;2&nbsp;of&nbsp;the&nbsp;3;&nbsp;other&nbsp;1&nbsp;is&nbsp;done&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076221">case</span>&nbsp;<span class="ident" id="5076226">b</span>&nbsp;<span class="op" id="5076228">==</span>&nbsp;<span class="string" id="5076231">&#39;\t&#39;</span>&nbsp;<span class="op" id="5076236">||</span>&nbsp;<span class="ident" id="5076239">b</span>&nbsp;<span class="op" id="5076241">==</span>&nbsp;<span class="string" id="5076244">&#39;\r&#39;</span>&nbsp;<span class="op" id="5076249">||</span>&nbsp;<span class="ident" id="5076252">b</span>&nbsp;<span class="op" id="5076254">==</span>&nbsp;<span class="string" id="5076257">&#39;\n&#39;</span><span class="op" id="5076261">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076266">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076274">case</span>&nbsp;<span class="ident" id="5076279">b</span>&nbsp;<span class="op" id="5076281">&lt;</span>&nbsp;<span class="string" id="5076283">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5076287">||</span>&nbsp;<span class="ident" id="5076290">b</span>&nbsp;<span class="op" id="5076292">&gt;</span>&nbsp;<span class="string" id="5076294">&#39;~&#39;</span><span class="op" id="5076297">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076302">return</span>&nbsp;<span class="ident" id="5076309">n</span><span class="op" id="5076310">,</span>&nbsp;<span class="ident" id="5076312">fmt</span><span class="op" id="5076315">.</span><span class="ident" id="5076316">Errorf</span><span class="op" id="5076322">(</span><span class="string" id="5076323">&#34;multipart:&nbsp;invalid&nbsp;unescaped&nbsp;byte&nbsp;0x%02x&nbsp;in&nbsp;quoted-printable&nbsp;body&#34;</span><span class="op" id="5076390">,</span>&nbsp;<span class="ident" id="5076392">b</span><span class="op" id="5076393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076401">p</span><span class="op" id="5076402">[</span><span class="num" id="5076403">0</span><span class="op" id="5076404">]</span>&nbsp;<span class="op" id="5076406">=</span>&nbsp;<span class="ident" id="5076408">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076412">p</span>&nbsp;<span class="op" id="5076414">=</span>&nbsp;<span class="ident" id="5076416">p</span><span class="op" id="5076417">[</span><span class="num" id="5076418">1</span><span class="op" id="5076419">:</span><span class="op" id="5076420">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076424">q</span><span class="op" id="5076425">.</span><span class="ident" id="5076426">line</span>&nbsp;<span class="op" id="5076431">=</span>&nbsp;<span class="ident" id="5076433">q</span><span class="op" id="5076434">.</span><span class="ident" id="5076435">line</span><span class="op" id="5076439">[</span><span class="num" id="5076440">1</span><span class="op" id="5076441">:</span><span class="op" id="5076442">]</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076446">n</span><span class="op" id="5076447">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076454">return</span>&nbsp;<span class="ident" id="5076461">n</span><span class="op" id="5076462">,</span>&nbsp;<span class="ident" id="5076464">nil</span><br>
<span class="lineno"></span><span class="op" id="5076468">}</span>
</div>
</body>
</html>
