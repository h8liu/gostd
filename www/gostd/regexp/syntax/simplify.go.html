<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp/syntax</h2>
<ul>
<li><a href="/gostd/regexp/syntax/compile.go.html">compile.go</a></li>
<li><a href="/gostd/regexp/syntax/doc.go.html">doc.go</a></li>
<li><a href="/gostd/regexp/syntax/parse.go.html">parse.go</a></li>
<li><a href="/gostd/regexp/syntax/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/regexp/syntax/perl_groups.go.html">perl_groups.go</a></li>
<li><a href="/gostd/regexp/syntax/prog.go.html">prog.go</a></li>
<li><a href="/gostd/regexp/syntax/prog_test.go.html">prog_test.go</a></li>
<li><a href="/gostd/regexp/syntax/regexp.go.html">regexp.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify.go.html" class="current">simplify.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify_test.go.html">simplify_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3528988">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3529044">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3529098">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3529149">package</span>&nbsp;<span class="ident" id="3529157">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3529165">//&nbsp;Simplify&nbsp;returns&nbsp;a&nbsp;regexp&nbsp;equivalent&nbsp;to&nbsp;re&nbsp;but&nbsp;without&nbsp;counted&nbsp;repetitions</span><br>
<span class="lineno"></span><span class="comment" id="3529243">//&nbsp;and&nbsp;with&nbsp;various&nbsp;other&nbsp;simplifications,&nbsp;such&nbsp;as&nbsp;rewriting&nbsp;/(?:a+)+/&nbsp;to&nbsp;/a+/.</span><br>
<span class="lineno"></span><span class="comment" id="3529323">//&nbsp;The&nbsp;resulting&nbsp;regexp&nbsp;will&nbsp;execute&nbsp;correctly&nbsp;but&nbsp;its&nbsp;string&nbsp;representation</span><br>
<span class="lineno">10</span><span class="comment" id="3529400">//&nbsp;will&nbsp;not&nbsp;produce&nbsp;the&nbsp;same&nbsp;parse&nbsp;tree,&nbsp;because&nbsp;capturing&nbsp;parentheses</span><br>
<span class="lineno"></span><span class="comment" id="3529471">//&nbsp;may&nbsp;have&nbsp;been&nbsp;duplicated&nbsp;or&nbsp;removed.&nbsp;&nbsp;For&nbsp;example,&nbsp;the&nbsp;simplified&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3529545">//&nbsp;for&nbsp;/(x){1,2}/&nbsp;is&nbsp;/(x)(x)?/&nbsp;but&nbsp;both&nbsp;parentheses&nbsp;capture&nbsp;as&nbsp;$1.</span><br>
<span class="lineno"></span><span class="comment" id="3529612">//&nbsp;The&nbsp;returned&nbsp;regexp&nbsp;may&nbsp;share&nbsp;structure&nbsp;with&nbsp;or&nbsp;be&nbsp;the&nbsp;original.</span><br>
<span class="lineno"></span><span class="keyword" id="3529680">func</span>&nbsp;<span class="op" id="3529685">(</span><span class="ident" id="3529686">re</span>&nbsp;<span class="op" id="3529689">*</span><span class="ident" id="3529690">Regexp</span><span class="op" id="3529696">)</span>&nbsp;<span class="ident" id="3529698">Simplify</span><span class="op" id="3529706">(</span><span class="op" id="3529707">)</span>&nbsp;<span class="op" id="3529709">*</span><span class="ident" id="3529710">Regexp</span>&nbsp;<span class="op" id="3529717">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3529720">if</span>&nbsp;<span class="ident" id="3529723">re</span>&nbsp;<span class="op" id="3529726">==</span>&nbsp;<span class="builtintype" id="3529729">nil</span>&nbsp;<span class="op" id="3529733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3529737">return</span>&nbsp;<span class="builtintype" id="3529744">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3529749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3529752">switch</span>&nbsp;<span class="ident" id="3529759">re</span><span class="op" id="3529761">.</span><span class="ident" id="3529762">Op</span>&nbsp;<span class="op" id="3529765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3529768">case</span>&nbsp;<span class="ident" id="3529773">OpCapture</span><span class="op" id="3529782">,</span>&nbsp;<span class="ident" id="3529784">OpConcat</span><span class="op" id="3529792">,</span>&nbsp;<span class="ident" id="3529794">OpAlternate</span><span class="op" id="3529805">:</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3529809">//&nbsp;Simplify&nbsp;children,&nbsp;building&nbsp;new&nbsp;Regexp&nbsp;if&nbsp;children&nbsp;change.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3529873">nre</span>&nbsp;<span class="op" id="3529877">:=</span>&nbsp;<span class="ident" id="3529880">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3529885">for</span>&nbsp;<span class="ident" id="3529889">i</span><span class="op" id="3529890">,</span>&nbsp;<span class="ident" id="3529892">sub</span>&nbsp;<span class="op" id="3529896">:=</span>&nbsp;<span class="keyword" id="3529899">range</span>&nbsp;<span class="ident" id="3529905">re</span><span class="op" id="3529907">.</span><span class="ident" id="3529908">Sub</span>&nbsp;<span class="op" id="3529912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3529917">nsub</span>&nbsp;<span class="op" id="3529922">:=</span>&nbsp;<span class="ident" id="3529925">sub</span><span class="op" id="3529928">.</span><span class="ident" id="3529929">Simplify</span><span class="op" id="3529937">(</span><span class="op" id="3529938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3529943">if</span>&nbsp;<span class="ident" id="3529946">nre</span>&nbsp;<span class="op" id="3529950">==</span>&nbsp;<span class="ident" id="3529953">re</span>&nbsp;<span class="op" id="3529956">&amp;&amp;</span>&nbsp;<span class="ident" id="3529959">nsub</span>&nbsp;<span class="op" id="3529964">!=</span>&nbsp;<span class="ident" id="3529967">sub</span>&nbsp;<span class="op" id="3529971">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3529977">//&nbsp;Start&nbsp;a&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3529998">nre</span>&nbsp;<span class="op" id="3530002">=</span>&nbsp;<span class="builtinfunc" id="3530004">new</span><span class="op" id="3530007">(</span><span class="ident" id="3530008">Regexp</span><span class="op" id="3530014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3530020">*</span><span class="ident" id="3530021">nre</span>&nbsp;<span class="op" id="3530025">=</span>&nbsp;<span class="op" id="3530027">*</span><span class="ident" id="3530028">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3530035">nre</span><span class="op" id="3530038">.</span><span class="ident" id="3530039">Rune</span>&nbsp;<span class="op" id="3530044">=</span>&nbsp;<span class="builtintype" id="3530046">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3530054">nre</span><span class="op" id="3530057">.</span><span class="ident" id="3530058">Sub</span>&nbsp;<span class="op" id="3530062">=</span>&nbsp;<span class="builtinfunc" id="3530064">append</span><span class="op" id="3530070">(</span><span class="ident" id="3530071">nre</span><span class="op" id="3530074">.</span><span class="ident" id="3530075">Sub0</span><span class="op" id="3530079">[</span><span class="op" id="3530080">:</span><span class="num" id="3530081">0</span><span class="op" id="3530082">]</span><span class="op" id="3530083">,</span>&nbsp;<span class="ident" id="3530085">re</span><span class="op" id="3530087">.</span><span class="ident" id="3530088">Sub</span><span class="op" id="3530091">[</span><span class="op" id="3530092">:</span><span class="ident" id="3530093">i</span><span class="op" id="3530094">]</span><span class="op" id="3530095">...</span><span class="op" id="3530098">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3530103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3530108">if</span>&nbsp;<span class="ident" id="3530111">nre</span>&nbsp;<span class="op" id="3530115">!=</span>&nbsp;<span class="ident" id="3530118">re</span>&nbsp;<span class="op" id="3530121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3530127">nre</span><span class="op" id="3530130">.</span><span class="ident" id="3530131">Sub</span>&nbsp;<span class="op" id="3530135">=</span>&nbsp;<span class="builtinfunc" id="3530137">append</span><span class="op" id="3530143">(</span><span class="ident" id="3530144">nre</span><span class="op" id="3530147">.</span><span class="ident" id="3530148">Sub</span><span class="op" id="3530151">,</span>&nbsp;<span class="ident" id="3530153">nsub</span><span class="op" id="3530157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3530162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3530166">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3530170">return</span>&nbsp;<span class="ident" id="3530177">nre</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3530183">case</span>&nbsp;<span class="ident" id="3530188">OpStar</span><span class="op" id="3530194">,</span>&nbsp;<span class="ident" id="3530196">OpPlus</span><span class="op" id="3530202">,</span>&nbsp;<span class="ident" id="3530204">OpQuest</span><span class="op" id="3530211">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3530215">sub</span>&nbsp;<span class="op" id="3530219">:=</span>&nbsp;<span class="ident" id="3530222">re</span><span class="op" id="3530224">.</span><span class="ident" id="3530225">Sub</span><span class="op" id="3530228">[</span><span class="num" id="3530229">0</span><span class="op" id="3530230">]</span><span class="op" id="3530231">.</span><span class="ident" id="3530232">Simplify</span><span class="op" id="3530240">(</span><span class="op" id="3530241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3530245">return</span>&nbsp;<span class="ident" id="3530252">simplify1</span><span class="op" id="3530261">(</span><span class="ident" id="3530262">re</span><span class="op" id="3530264">.</span><span class="ident" id="3530265">Op</span><span class="op" id="3530267">,</span>&nbsp;<span class="ident" id="3530269">re</span><span class="op" id="3530271">.</span><span class="ident" id="3530272">Flags</span><span class="op" id="3530277">,</span>&nbsp;<span class="ident" id="3530279">sub</span><span class="op" id="3530282">,</span>&nbsp;<span class="ident" id="3530284">re</span><span class="op" id="3530286">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3530290">case</span>&nbsp;<span class="ident" id="3530295">OpRepeat</span><span class="op" id="3530303">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3530307">//&nbsp;Special&nbsp;special&nbsp;case:&nbsp;x{0}&nbsp;matches&nbsp;the&nbsp;empty&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3530364">//&nbsp;and&nbsp;doesn&#39;t&nbsp;even&nbsp;need&nbsp;to&nbsp;consider&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3530406">if</span>&nbsp;<span class="ident" id="3530409">re</span><span class="op" id="3530411">.</span><span class="ident" id="3530412">Min</span>&nbsp;<span class="op" id="3530416">==</span>&nbsp;<span class="num" id="3530419">0</span>&nbsp;<span class="op" id="3530421">&amp;&amp;</span>&nbsp;<span class="ident" id="3530424">re</span><span class="op" id="3530426">.</span><span class="ident" id="3530427">Max</span>&nbsp;<span class="op" id="3530431">==</span>&nbsp;<span class="num" id="3530434">0</span>&nbsp;<span class="op" id="3530436">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3530441">return</span>&nbsp;<span class="op" id="3530448">&amp;</span><span class="ident" id="3530449">Regexp</span><span class="op" id="3530455">{</span><span class="ident" id="3530456">Op</span><span class="op" id="3530458">:</span>&nbsp;<span class="ident" id="3530460">OpEmptyMatch</span><span class="op" id="3530472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3530476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3530481">//&nbsp;The&nbsp;fun&nbsp;begins.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3530502">sub</span>&nbsp;<span class="op" id="3530506">:=</span>&nbsp;<span class="ident" id="3530509">re</span><span class="op" id="3530511">.</span><span class="ident" id="3530512">Sub</span><span class="op" id="3530515">[</span><span class="num" id="3530516">0</span><span class="op" id="3530517">]</span><span class="op" id="3530518">.</span><span class="ident" id="3530519">Simplify</span><span class="op" id="3530527">(</span><span class="op" id="3530528">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3530533">//&nbsp;x{n,}&nbsp;means&nbsp;at&nbsp;least&nbsp;n&nbsp;matches&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3530575">if</span>&nbsp;<span class="ident" id="3530578">re</span><span class="op" id="3530580">.</span><span class="ident" id="3530581">Max</span>&nbsp;<span class="op" id="3530585">==</span>&nbsp;<span class="op" id="3530588">-</span><span class="num" id="3530589">1</span>&nbsp;<span class="op" id="3530591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3530596">//&nbsp;Special&nbsp;case:&nbsp;x{0,}&nbsp;is&nbsp;x*.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3530629">if</span>&nbsp;<span class="ident" id="3530632">re</span><span class="op" id="3530634">.</span><span class="ident" id="3530635">Min</span>&nbsp;<span class="op" id="3530639">==</span>&nbsp;<span class="num" id="3530642">0</span>&nbsp;<span class="op" id="3530644">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3530650">return</span>&nbsp;<span class="ident" id="3530657">simplify1</span><span class="op" id="3530666">(</span><span class="ident" id="3530667">OpStar</span><span class="op" id="3530673">,</span>&nbsp;<span class="ident" id="3530675">re</span><span class="op" id="3530677">.</span><span class="ident" id="3530678">Flags</span><span class="op" id="3530683">,</span>&nbsp;<span class="ident" id="3530685">sub</span><span class="op" id="3530688">,</span>&nbsp;<span class="builtintype" id="3530690">nil</span><span class="op" id="3530693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3530698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3530704">//&nbsp;Special&nbsp;case:&nbsp;x{1,}&nbsp;is&nbsp;x+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3530737">if</span>&nbsp;<span class="ident" id="3530740">re</span><span class="op" id="3530742">.</span><span class="ident" id="3530743">Min</span>&nbsp;<span class="op" id="3530747">==</span>&nbsp;<span class="num" id="3530750">1</span>&nbsp;<span class="op" id="3530752">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3530758">return</span>&nbsp;<span class="ident" id="3530765">simplify1</span><span class="op" id="3530774">(</span><span class="ident" id="3530775">OpPlus</span><span class="op" id="3530781">,</span>&nbsp;<span class="ident" id="3530783">re</span><span class="op" id="3530785">.</span><span class="ident" id="3530786">Flags</span><span class="op" id="3530791">,</span>&nbsp;<span class="ident" id="3530793">sub</span><span class="op" id="3530796">,</span>&nbsp;<span class="builtintype" id="3530798">nil</span><span class="op" id="3530801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3530806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3530812">//&nbsp;General&nbsp;case:&nbsp;x{4,}&nbsp;is&nbsp;xxxx+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3530848">nre</span>&nbsp;<span class="op" id="3530852">:=</span>&nbsp;<span class="op" id="3530855">&amp;</span><span class="ident" id="3530856">Regexp</span><span class="op" id="3530862">{</span><span class="ident" id="3530863">Op</span><span class="op" id="3530865">:</span>&nbsp;<span class="ident" id="3530867">OpConcat</span><span class="op" id="3530875">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3530880">nre</span><span class="op" id="3530883">.</span><span class="ident" id="3530884">Sub</span>&nbsp;<span class="op" id="3530888">=</span>&nbsp;<span class="ident" id="3530890">nre</span><span class="op" id="3530893">.</span><span class="ident" id="3530894">Sub0</span><span class="op" id="3530898">[</span><span class="op" id="3530899">:</span><span class="num" id="3530900">0</span><span class="op" id="3530901">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3530906">for</span>&nbsp;<span class="ident" id="3530910">i</span>&nbsp;<span class="op" id="3530912">:=</span>&nbsp;<span class="num" id="3530915">0</span><span class="op" id="3530916">;</span>&nbsp;<span class="ident" id="3530918">i</span>&nbsp;<span class="op" id="3530920">&lt;</span>&nbsp;<span class="ident" id="3530922">re</span><span class="op" id="3530924">.</span><span class="ident" id="3530925">Min</span><span class="op" id="3530928">-</span><span class="num" id="3530929">1</span><span class="op" id="3530930">;</span>&nbsp;<span class="ident" id="3530932">i</span><span class="op" id="3530933">++</span>&nbsp;<span class="op" id="3530936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3530942">nre</span><span class="op" id="3530945">.</span><span class="ident" id="3530946">Sub</span>&nbsp;<span class="op" id="3530950">=</span>&nbsp;<span class="builtinfunc" id="3530952">append</span><span class="op" id="3530958">(</span><span class="ident" id="3530959">nre</span><span class="op" id="3530962">.</span><span class="ident" id="3530963">Sub</span><span class="op" id="3530966">,</span>&nbsp;<span class="ident" id="3530968">sub</span><span class="op" id="3530971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3530976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3530981">nre</span><span class="op" id="3530984">.</span><span class="ident" id="3530985">Sub</span>&nbsp;<span class="op" id="3530989">=</span>&nbsp;<span class="builtinfunc" id="3530991">append</span><span class="op" id="3530997">(</span><span class="ident" id="3530998">nre</span><span class="op" id="3531001">.</span><span class="ident" id="3531002">Sub</span><span class="op" id="3531005">,</span>&nbsp;<span class="ident" id="3531007">simplify1</span><span class="op" id="3531016">(</span><span class="ident" id="3531017">OpPlus</span><span class="op" id="3531023">,</span>&nbsp;<span class="ident" id="3531025">re</span><span class="op" id="3531027">.</span><span class="ident" id="3531028">Flags</span><span class="op" id="3531033">,</span>&nbsp;<span class="ident" id="3531035">sub</span><span class="op" id="3531038">,</span>&nbsp;<span class="builtintype" id="3531040">nil</span><span class="op" id="3531043">)</span><span class="op" id="3531044">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3531049">return</span>&nbsp;<span class="ident" id="3531056">nre</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3531062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3531067">//&nbsp;Special&nbsp;case&nbsp;x{0}&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3531106">//&nbsp;Special&nbsp;case:&nbsp;x{1}&nbsp;is&nbsp;just&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3531141">if</span>&nbsp;<span class="ident" id="3531144">re</span><span class="op" id="3531146">.</span><span class="ident" id="3531147">Min</span>&nbsp;<span class="op" id="3531151">==</span>&nbsp;<span class="num" id="3531154">1</span>&nbsp;<span class="op" id="3531156">&amp;&amp;</span>&nbsp;<span class="ident" id="3531159">re</span><span class="op" id="3531161">.</span><span class="ident" id="3531162">Max</span>&nbsp;<span class="op" id="3531166">==</span>&nbsp;<span class="num" id="3531169">1</span>&nbsp;<span class="op" id="3531171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3531176">return</span>&nbsp;<span class="ident" id="3531183">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3531189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3531194">//&nbsp;General&nbsp;case:&nbsp;x{n,m}&nbsp;means&nbsp;n&nbsp;copies&nbsp;of&nbsp;x&nbsp;and&nbsp;m&nbsp;copies&nbsp;of&nbsp;x?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3531259">//&nbsp;The&nbsp;machine&nbsp;will&nbsp;do&nbsp;less&nbsp;work&nbsp;if&nbsp;we&nbsp;nest&nbsp;the&nbsp;final&nbsp;m&nbsp;copies,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3531325">//&nbsp;so&nbsp;that&nbsp;x{2,5}&nbsp;=&nbsp;xx(x(x(x)?)?)?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3531363">//&nbsp;Build&nbsp;leading&nbsp;prefix:&nbsp;xx.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3531394">var</span>&nbsp;<span class="ident" id="3531398">prefix</span>&nbsp;<span class="op" id="3531405">*</span><span class="ident" id="3531406">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3531415">if</span>&nbsp;<span class="ident" id="3531418">re</span><span class="op" id="3531420">.</span><span class="ident" id="3531421">Min</span>&nbsp;<span class="op" id="3531425">&gt;</span>&nbsp;<span class="num" id="3531427">0</span>&nbsp;<span class="op" id="3531429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3531434">prefix</span>&nbsp;<span class="op" id="3531441">=</span>&nbsp;<span class="op" id="3531443">&amp;</span><span class="ident" id="3531444">Regexp</span><span class="op" id="3531450">{</span><span class="ident" id="3531451">Op</span><span class="op" id="3531453">:</span>&nbsp;<span class="ident" id="3531455">OpConcat</span><span class="op" id="3531463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3531468">prefix</span><span class="op" id="3531474">.</span><span class="ident" id="3531475">Sub</span>&nbsp;<span class="op" id="3531479">=</span>&nbsp;<span class="ident" id="3531481">prefix</span><span class="op" id="3531487">.</span><span class="ident" id="3531488">Sub0</span><span class="op" id="3531492">[</span><span class="op" id="3531493">:</span><span class="num" id="3531494">0</span><span class="op" id="3531495">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3531500">for</span>&nbsp;<span class="ident" id="3531504">i</span>&nbsp;<span class="op" id="3531506">:=</span>&nbsp;<span class="num" id="3531509">0</span><span class="op" id="3531510">;</span>&nbsp;<span class="ident" id="3531512">i</span>&nbsp;<span class="op" id="3531514">&lt;</span>&nbsp;<span class="ident" id="3531516">re</span><span class="op" id="3531518">.</span><span class="ident" id="3531519">Min</span><span class="op" id="3531522">;</span>&nbsp;<span class="ident" id="3531524">i</span><span class="op" id="3531525">++</span>&nbsp;<span class="op" id="3531528">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3531534">prefix</span><span class="op" id="3531540">.</span><span class="ident" id="3531541">Sub</span>&nbsp;<span class="op" id="3531545">=</span>&nbsp;<span class="builtinfunc" id="3531547">append</span><span class="op" id="3531553">(</span><span class="ident" id="3531554">prefix</span><span class="op" id="3531560">.</span><span class="ident" id="3531561">Sub</span><span class="op" id="3531564">,</span>&nbsp;<span class="ident" id="3531566">sub</span><span class="op" id="3531569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3531574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3531578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3531583">//&nbsp;Build&nbsp;and&nbsp;attach&nbsp;suffix:&nbsp;(x(x(x)?)?)?</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3531626">if</span>&nbsp;<span class="ident" id="3531629">re</span><span class="op" id="3531631">.</span><span class="ident" id="3531632">Max</span>&nbsp;<span class="op" id="3531636">&gt;</span>&nbsp;<span class="ident" id="3531638">re</span><span class="op" id="3531640">.</span><span class="ident" id="3531641">Min</span>&nbsp;<span class="op" id="3531645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3531650">suffix</span>&nbsp;<span class="op" id="3531657">:=</span>&nbsp;<span class="ident" id="3531660">simplify1</span><span class="op" id="3531669">(</span><span class="ident" id="3531670">OpQuest</span><span class="op" id="3531677">,</span>&nbsp;<span class="ident" id="3531679">re</span><span class="op" id="3531681">.</span><span class="ident" id="3531682">Flags</span><span class="op" id="3531687">,</span>&nbsp;<span class="ident" id="3531689">sub</span><span class="op" id="3531692">,</span>&nbsp;<span class="builtintype" id="3531694">nil</span><span class="op" id="3531697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3531702">for</span>&nbsp;<span class="ident" id="3531706">i</span>&nbsp;<span class="op" id="3531708">:=</span>&nbsp;<span class="ident" id="3531711">re</span><span class="op" id="3531713">.</span><span class="ident" id="3531714">Min</span>&nbsp;<span class="op" id="3531718">+</span>&nbsp;<span class="num" id="3531720">1</span><span class="op" id="3531721">;</span>&nbsp;<span class="ident" id="3531723">i</span>&nbsp;<span class="op" id="3531725">&lt;</span>&nbsp;<span class="ident" id="3531727">re</span><span class="op" id="3531729">.</span><span class="ident" id="3531730">Max</span><span class="op" id="3531733">;</span>&nbsp;<span class="ident" id="3531735">i</span><span class="op" id="3531736">++</span>&nbsp;<span class="op" id="3531739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3531745">nre2</span>&nbsp;<span class="op" id="3531750">:=</span>&nbsp;<span class="op" id="3531753">&amp;</span><span class="ident" id="3531754">Regexp</span><span class="op" id="3531760">{</span><span class="ident" id="3531761">Op</span><span class="op" id="3531763">:</span>&nbsp;<span class="ident" id="3531765">OpConcat</span><span class="op" id="3531773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3531779">nre2</span><span class="op" id="3531783">.</span><span class="ident" id="3531784">Sub</span>&nbsp;<span class="op" id="3531788">=</span>&nbsp;<span class="builtinfunc" id="3531790">append</span><span class="op" id="3531796">(</span><span class="ident" id="3531797">nre2</span><span class="op" id="3531801">.</span><span class="ident" id="3531802">Sub0</span><span class="op" id="3531806">[</span><span class="op" id="3531807">:</span><span class="num" id="3531808">0</span><span class="op" id="3531809">]</span><span class="op" id="3531810">,</span>&nbsp;<span class="ident" id="3531812">sub</span><span class="op" id="3531815">,</span>&nbsp;<span class="ident" id="3531817">suffix</span><span class="op" id="3531823">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3531829">suffix</span>&nbsp;<span class="op" id="3531836">=</span>&nbsp;<span class="ident" id="3531838">simplify1</span><span class="op" id="3531847">(</span><span class="ident" id="3531848">OpQuest</span><span class="op" id="3531855">,</span>&nbsp;<span class="ident" id="3531857">re</span><span class="op" id="3531859">.</span><span class="ident" id="3531860">Flags</span><span class="op" id="3531865">,</span>&nbsp;<span class="ident" id="3531867">nre2</span><span class="op" id="3531871">,</span>&nbsp;<span class="builtintype" id="3531873">nil</span><span class="op" id="3531876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3531881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3531886">if</span>&nbsp;<span class="ident" id="3531889">prefix</span>&nbsp;<span class="op" id="3531896">==</span>&nbsp;<span class="builtintype" id="3531899">nil</span>&nbsp;<span class="op" id="3531903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3531909">return</span>&nbsp;<span class="ident" id="3531916">suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3531926">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3531931">prefix</span><span class="op" id="3531937">.</span><span class="ident" id="3531938">Sub</span>&nbsp;<span class="op" id="3531942">=</span>&nbsp;<span class="builtinfunc" id="3531944">append</span><span class="op" id="3531950">(</span><span class="ident" id="3531951">prefix</span><span class="op" id="3531957">.</span><span class="ident" id="3531958">Sub</span><span class="op" id="3531961">,</span>&nbsp;<span class="ident" id="3531963">suffix</span><span class="op" id="3531969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3531973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3531977">if</span>&nbsp;<span class="ident" id="3531980">prefix</span>&nbsp;<span class="op" id="3531987">!=</span>&nbsp;<span class="builtintype" id="3531990">nil</span>&nbsp;<span class="op" id="3531994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3531999">return</span>&nbsp;<span class="ident" id="3532006">prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3532015">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3532020">//&nbsp;Some&nbsp;degenerate&nbsp;case&nbsp;like&nbsp;min&nbsp;&gt;&nbsp;max&nbsp;or&nbsp;min&nbsp;&lt;&nbsp;max&nbsp;&lt;&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3532079">//&nbsp;Handle&nbsp;as&nbsp;impossible&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3532112">return</span>&nbsp;<span class="op" id="3532119">&amp;</span><span class="ident" id="3532120">Regexp</span><span class="op" id="3532126">{</span><span class="ident" id="3532127">Op</span><span class="op" id="3532129">:</span>&nbsp;<span class="ident" id="3532131">OpNoMatch</span><span class="op" id="3532140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3532143">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3532147">return</span>&nbsp;<span class="ident" id="3532154">re</span><br>
<span class="lineno"></span><span class="op" id="3532157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3532160">//&nbsp;simplify1&nbsp;implements&nbsp;Simplify&nbsp;for&nbsp;the&nbsp;unary&nbsp;OpStar,</span><br>
<span class="lineno">120</span><span class="comment" id="3532215">//&nbsp;OpPlus,&nbsp;and&nbsp;OpQuest&nbsp;operators.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;simple&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="3532279">//&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3532296">//</span><br>
<span class="lineno"></span><span class="comment" id="3532299">//&nbsp;&nbsp;&nbsp;&nbsp;Regexp{Op:&nbsp;op,&nbsp;Flags:&nbsp;flags,&nbsp;Sub:&nbsp;{sub}}</span><br>
<span class="lineno"></span><span class="comment" id="3532343">//</span><br>
<span class="lineno">125</span><span class="comment" id="3532346">//&nbsp;under&nbsp;the&nbsp;assumption&nbsp;that&nbsp;sub&nbsp;is&nbsp;already&nbsp;simple,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3532402">//&nbsp;without&nbsp;first&nbsp;allocating&nbsp;that&nbsp;structure.&nbsp;&nbsp;If&nbsp;the&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="3532461">//&nbsp;to&nbsp;be&nbsp;returned&nbsp;turns&nbsp;out&nbsp;to&nbsp;be&nbsp;equivalent&nbsp;to&nbsp;re,&nbsp;simplify1</span><br>
<span class="lineno"></span><span class="comment" id="3532523">//&nbsp;returns&nbsp;re&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="3532546">//</span><br>
<span class="lineno">130</span><span class="comment" id="3532549">//&nbsp;simplify1&nbsp;is&nbsp;factored&nbsp;out&nbsp;of&nbsp;Simplify&nbsp;because&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="3532617">//&nbsp;for&nbsp;other&nbsp;operators&nbsp;generates&nbsp;these&nbsp;unary&nbsp;expressions.</span><br>
<span class="lineno"></span><span class="comment" id="3532675">//&nbsp;Letting&nbsp;them&nbsp;call&nbsp;simplify1&nbsp;makes&nbsp;sure&nbsp;the&nbsp;expressions&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="3532738">//&nbsp;generate&nbsp;are&nbsp;simple.</span><br>
<span class="lineno"></span><span class="keyword" id="3532762">func</span>&nbsp;<span class="ident" id="3532767">simplify1</span><span class="op" id="3532776">(</span><span class="ident" id="3532777">op</span>&nbsp;<span class="ident" id="3532780">Op</span><span class="op" id="3532782">,</span>&nbsp;<span class="ident" id="3532784">flags</span>&nbsp;<span class="ident" id="3532790">Flags</span><span class="op" id="3532795">,</span>&nbsp;<span class="ident" id="3532797">sub</span><span class="op" id="3532800">,</span>&nbsp;<span class="ident" id="3532802">re</span>&nbsp;<span class="op" id="3532805">*</span><span class="ident" id="3532806">Regexp</span><span class="op" id="3532812">)</span>&nbsp;<span class="op" id="3532814">*</span><span class="ident" id="3532815">Regexp</span>&nbsp;<span class="op" id="3532822">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3532825">//&nbsp;Special&nbsp;case:&nbsp;repeat&nbsp;the&nbsp;empty&nbsp;string&nbsp;as&nbsp;much&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3532878">//&nbsp;you&nbsp;want,&nbsp;but&nbsp;it&#39;s&nbsp;still&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3532925">if</span>&nbsp;<span class="ident" id="3532928">sub</span><span class="op" id="3532931">.</span><span class="ident" id="3532932">Op</span>&nbsp;<span class="op" id="3532935">==</span>&nbsp;<span class="ident" id="3532938">OpEmptyMatch</span>&nbsp;<span class="op" id="3532951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3532955">return</span>&nbsp;<span class="ident" id="3532962">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3532967">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3532970">//&nbsp;The&nbsp;operators&nbsp;are&nbsp;idempotent&nbsp;if&nbsp;the&nbsp;flags&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3533023">if</span>&nbsp;<span class="ident" id="3533026">op</span>&nbsp;<span class="op" id="3533029">==</span>&nbsp;<span class="ident" id="3533032">sub</span><span class="op" id="3533035">.</span><span class="ident" id="3533036">Op</span>&nbsp;<span class="op" id="3533039">&amp;&amp;</span>&nbsp;<span class="ident" id="3533042">flags</span><span class="op" id="3533047">&amp;</span><span class="ident" id="3533048">NonGreedy</span>&nbsp;<span class="op" id="3533058">==</span>&nbsp;<span class="ident" id="3533061">sub</span><span class="op" id="3533064">.</span><span class="ident" id="3533065">Flags</span><span class="op" id="3533070">&amp;</span><span class="ident" id="3533071">NonGreedy</span>&nbsp;<span class="op" id="3533081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3533085">return</span>&nbsp;<span class="ident" id="3533092">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3533097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3533100">if</span>&nbsp;<span class="ident" id="3533103">re</span>&nbsp;<span class="op" id="3533106">!=</span>&nbsp;<span class="builtintype" id="3533109">nil</span>&nbsp;<span class="op" id="3533113">&amp;&amp;</span>&nbsp;<span class="ident" id="3533116">re</span><span class="op" id="3533118">.</span><span class="ident" id="3533119">Op</span>&nbsp;<span class="op" id="3533122">==</span>&nbsp;<span class="ident" id="3533125">op</span>&nbsp;<span class="op" id="3533128">&amp;&amp;</span>&nbsp;<span class="ident" id="3533131">re</span><span class="op" id="3533133">.</span><span class="ident" id="3533134">Flags</span><span class="op" id="3533139">&amp;</span><span class="ident" id="3533140">NonGreedy</span>&nbsp;<span class="op" id="3533150">==</span>&nbsp;<span class="ident" id="3533153">flags</span><span class="op" id="3533158">&amp;</span><span class="ident" id="3533159">NonGreedy</span>&nbsp;<span class="op" id="3533169">&amp;&amp;</span>&nbsp;<span class="ident" id="3533172">sub</span>&nbsp;<span class="op" id="3533176">==</span>&nbsp;<span class="ident" id="3533179">re</span><span class="op" id="3533181">.</span><span class="ident" id="3533182">Sub</span><span class="op" id="3533185">[</span><span class="num" id="3533186">0</span><span class="op" id="3533187">]</span>&nbsp;<span class="op" id="3533189">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3533193">return</span>&nbsp;<span class="ident" id="3533200">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3533204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3533208">re</span>&nbsp;<span class="op" id="3533211">=</span>&nbsp;<span class="op" id="3533213">&amp;</span><span class="ident" id="3533214">Regexp</span><span class="op" id="3533220">{</span><span class="ident" id="3533221">Op</span><span class="op" id="3533223">:</span>&nbsp;<span class="ident" id="3533225">op</span><span class="op" id="3533227">,</span>&nbsp;<span class="ident" id="3533229">Flags</span><span class="op" id="3533234">:</span>&nbsp;<span class="ident" id="3533236">flags</span><span class="op" id="3533241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3533244">re</span><span class="op" id="3533246">.</span><span class="ident" id="3533247">Sub</span>&nbsp;<span class="op" id="3533251">=</span>&nbsp;<span class="builtinfunc" id="3533253">append</span><span class="op" id="3533259">(</span><span class="ident" id="3533260">re</span><span class="op" id="3533262">.</span><span class="ident" id="3533263">Sub0</span><span class="op" id="3533267">[</span><span class="op" id="3533268">:</span><span class="num" id="3533269">0</span><span class="op" id="3533270">]</span><span class="op" id="3533271">,</span>&nbsp;<span class="ident" id="3533273">sub</span><span class="op" id="3533276">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3533279">return</span>&nbsp;<span class="ident" id="3533286">re</span><br>
<span class="lineno"></span><span class="op" id="3533289">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
