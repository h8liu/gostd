<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7115232">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7115287">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7115341">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7115392">package</span>&nbsp;<span class="ident" id="7115400">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7115405">import</span>&nbsp;<span class="op" id="7115412">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7115415">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7115424">&#34;compress/lzw&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7115440">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7115449">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7115464">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7115475">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7115485">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="7115488">//&nbsp;header,&nbsp;palette&nbsp;and&nbsp;trailer&nbsp;are&nbsp;parts&nbsp;of&nbsp;a&nbsp;valid&nbsp;2x1&nbsp;GIF&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="7115555">const</span>&nbsp;<span class="op" id="7115561">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7115564">headerStr</span>&nbsp;<span class="op" id="7115574">=</span>&nbsp;<span class="string" id="7115576">&#34;GIF89a&#34;</span>&nbsp;<span class="op" id="7115585">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7115589">&#34;\x02\x00\x01\x00&#34;</span>&nbsp;<span class="op" id="7115608">+</span>&nbsp;<span class="comment" id="7115610">//&nbsp;width=2,&nbsp;height=1</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7115633">&#34;\x80\x00\x00&#34;</span>&nbsp;<span class="comment" id="7115648">//&nbsp;headerFields=(a&nbsp;color&nbsp;map&nbsp;of&nbsp;2&nbsp;pixels),&nbsp;backgroundIndex,&nbsp;aspect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7115716">paletteStr</span>&nbsp;<span class="op" id="7115727">=</span>&nbsp;<span class="string" id="7115729">&#34;\x10\x20\x30\x40\x50\x60&#34;</span>&nbsp;<span class="comment" id="7115756">//&nbsp;the&nbsp;color&nbsp;map,&nbsp;also&nbsp;known&nbsp;as&nbsp;a&nbsp;palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7115799">trailerStr</span>&nbsp;<span class="op" id="7115810">=</span>&nbsp;<span class="string" id="7115812">&#34;\x3b&#34;</span><br>
<span class="lineno"></span><span class="op" id="7115819">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="7115822">//&nbsp;lzwEncode&nbsp;returns&nbsp;an&nbsp;LZW&nbsp;encoding&nbsp;(with&nbsp;2-bit&nbsp;literals)&nbsp;of&nbsp;n&nbsp;zeroes.</span><br>
<span class="lineno"></span><span class="keyword" id="7115894">func</span>&nbsp;<span class="ident" id="7115899">lzwEncode</span><span class="op" id="7115908">(</span><span class="ident" id="7115909">n</span>&nbsp;<span class="builtintype" id="7115911">int</span><span class="op" id="7115914">)</span>&nbsp;<span class="op" id="7115916">[</span><span class="op" id="7115917">]</span><span class="builtintype" id="7115918">byte</span>&nbsp;<span class="op" id="7115923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7115926">b</span>&nbsp;<span class="op" id="7115928">:=</span>&nbsp;<span class="op" id="7115931">&amp;</span><span class="ident" id="7115932">bytes</span><span class="op" id="7115937">.</span><span class="ident" id="7115938">Buffer</span><span class="op" id="7115944">{</span><span class="op" id="7115945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7115948">w</span>&nbsp;<span class="op" id="7115950">:=</span>&nbsp;<span class="ident" id="7115953">lzw</span><span class="op" id="7115956">.</span><span class="ident" id="7115957">NewWriter</span><span class="op" id="7115966">(</span><span class="ident" id="7115967">b</span><span class="op" id="7115968">,</span>&nbsp;<span class="ident" id="7115970">lzw</span><span class="op" id="7115973">.</span><span class="ident" id="7115974">LSB</span><span class="op" id="7115977">,</span>&nbsp;<span class="num" id="7115979">2</span><span class="op" id="7115980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7115983">w</span><span class="op" id="7115984">.</span><span class="ident" id="7115985">Write</span><span class="op" id="7115990">(</span><span class="builtinfunc" id="7115991">make</span><span class="op" id="7115995">(</span><span class="op" id="7115996">[</span><span class="op" id="7115997">]</span><span class="builtintype" id="7115998">byte</span><span class="op" id="7116002">,</span>&nbsp;<span class="ident" id="7116004">n</span><span class="op" id="7116005">)</span><span class="op" id="7116006">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7116009">w</span><span class="op" id="7116010">.</span><span class="ident" id="7116011">Close</span><span class="op" id="7116016">(</span><span class="op" id="7116017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7116020">return</span>&nbsp;<span class="ident" id="7116027">b</span><span class="op" id="7116028">.</span><span class="ident" id="7116029">Bytes</span><span class="op" id="7116034">(</span><span class="op" id="7116035">)</span><br>
<span class="lineno"></span><span class="op" id="7116037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7116040">func</span>&nbsp;<span class="ident" id="7116045">TestDecode</span><span class="op" id="7116055">(</span><span class="ident" id="7116056">t</span>&nbsp;<span class="op" id="7116058">*</span><span class="ident" id="7116059">testing</span><span class="op" id="7116066">.</span><span class="ident" id="7116067">T</span><span class="op" id="7116068">)</span>&nbsp;<span class="op" id="7116070">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7116073">testCases</span>&nbsp;<span class="op" id="7116083">:=</span>&nbsp;<span class="op" id="7116086">[</span><span class="op" id="7116087">]</span><span class="keyword" id="7116088">struct</span>&nbsp;<span class="op" id="7116095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7116099">nPix</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7116107">int</span>&nbsp;&nbsp;<span class="comment" id="7116112">//&nbsp;The&nbsp;number&nbsp;of&nbsp;pixels&nbsp;in&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7116157">extra</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7116165">bool</span>&nbsp;<span class="comment" id="7116170">//&nbsp;Whether&nbsp;to&nbsp;write&nbsp;an&nbsp;extra&nbsp;block&nbsp;after&nbsp;the&nbsp;LZW-encoded&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7116235">wantErr</span>&nbsp;<span class="builtintype" id="7116243">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7116250">}</span><span class="op" id="7116251">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7116255">{</span><span class="num" id="7116256">0</span><span class="op" id="7116257">,</span>&nbsp;<span class="builtintype" id="7116259">false</span><span class="op" id="7116264">,</span>&nbsp;<span class="ident" id="7116266">errNotEnough</span><span class="op" id="7116278">}</span><span class="op" id="7116279">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7116283">{</span><span class="num" id="7116284">1</span><span class="op" id="7116285">,</span>&nbsp;<span class="builtintype" id="7116287">false</span><span class="op" id="7116292">,</span>&nbsp;<span class="ident" id="7116294">errNotEnough</span><span class="op" id="7116306">}</span><span class="op" id="7116307">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7116311">{</span><span class="num" id="7116312">2</span><span class="op" id="7116313">,</span>&nbsp;<span class="builtintype" id="7116315">false</span><span class="op" id="7116320">,</span>&nbsp;<span class="ident" id="7116322">nil</span><span class="op" id="7116325">}</span><span class="op" id="7116326">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7116330">{</span><span class="num" id="7116331">2</span><span class="op" id="7116332">,</span>&nbsp;<span class="builtintype" id="7116334">true</span><span class="op" id="7116338">,</span>&nbsp;<span class="ident" id="7116340">errTooMuch</span><span class="op" id="7116350">}</span><span class="op" id="7116351">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7116355">{</span><span class="num" id="7116356">3</span><span class="op" id="7116357">,</span>&nbsp;<span class="builtintype" id="7116359">false</span><span class="op" id="7116364">,</span>&nbsp;<span class="ident" id="7116366">errTooMuch</span><span class="op" id="7116376">}</span><span class="op" id="7116377">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7116380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7116383">for</span>&nbsp;<span class="ident" id="7116387">_</span><span class="op" id="7116388">,</span>&nbsp;<span class="ident" id="7116390">tc</span>&nbsp;<span class="op" id="7116393">:=</span>&nbsp;<span class="keyword" id="7116396">range</span>&nbsp;<span class="ident" id="7116402">testCases</span>&nbsp;<span class="op" id="7116412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7116416">b</span>&nbsp;<span class="op" id="7116418">:=</span>&nbsp;<span class="op" id="7116421">&amp;</span><span class="ident" id="7116422">bytes</span><span class="op" id="7116427">.</span><span class="ident" id="7116428">Buffer</span><span class="op" id="7116434">{</span><span class="op" id="7116435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7116439">b</span><span class="op" id="7116440">.</span><span class="ident" id="7116441">WriteString</span><span class="op" id="7116452">(</span><span class="ident" id="7116453">headerStr</span><span class="op" id="7116462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7116466">b</span><span class="op" id="7116467">.</span><span class="ident" id="7116468">WriteString</span><span class="op" id="7116479">(</span><span class="ident" id="7116480">paletteStr</span><span class="op" id="7116490">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7116494">//&nbsp;Write&nbsp;an&nbsp;image&nbsp;with&nbsp;bounds&nbsp;2x1&nbsp;but&nbsp;tc.nPix&nbsp;pixels.&nbsp;If&nbsp;tc.nPix&nbsp;!=&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7116566">//&nbsp;then&nbsp;this&nbsp;should&nbsp;result&nbsp;in&nbsp;an&nbsp;invalid&nbsp;GIF&nbsp;image.&nbsp;First,&nbsp;write&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7116635">//&nbsp;magic&nbsp;0x2c&nbsp;(image&nbsp;descriptor)&nbsp;byte,&nbsp;bounds=(0,0)-(2,1),&nbsp;a&nbsp;flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7116704">//&nbsp;byte,&nbsp;and&nbsp;2-bit&nbsp;LZW&nbsp;literals.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7116739">b</span><span class="op" id="7116740">.</span><span class="ident" id="7116741">WriteString</span><span class="op" id="7116752">(</span><span class="string" id="7116753">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="7116799">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7116803">if</span>&nbsp;<span class="ident" id="7116806">tc</span><span class="op" id="7116808">.</span><span class="ident" id="7116809">nPix</span>&nbsp;<span class="op" id="7116814">&gt;</span>&nbsp;<span class="num" id="7116816">0</span>&nbsp;<span class="op" id="7116818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7116823">enc</span>&nbsp;<span class="op" id="7116827">:=</span>&nbsp;<span class="ident" id="7116830">lzwEncode</span><span class="op" id="7116839">(</span><span class="ident" id="7116840">tc</span><span class="op" id="7116842">.</span><span class="ident" id="7116843">nPix</span><span class="op" id="7116847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7116852">if</span>&nbsp;<span class="builtinfunc" id="7116855">len</span><span class="op" id="7116858">(</span><span class="ident" id="7116859">enc</span><span class="op" id="7116862">)</span>&nbsp;<span class="op" id="7116864">&gt;</span>&nbsp;<span class="num" id="7116866">0xff</span>&nbsp;<span class="op" id="7116871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7116877">t</span><span class="op" id="7116878">.</span><span class="ident" id="7116879">Errorf</span><span class="op" id="7116885">(</span><span class="string" id="7116886">&#34;nPix=%d,&nbsp;extra=%t:&nbsp;compressed&nbsp;length&nbsp;%d&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="7116940">,</span>&nbsp;<span class="ident" id="7116942">tc</span><span class="op" id="7116944">.</span><span class="ident" id="7116945">nPix</span><span class="op" id="7116949">,</span>&nbsp;<span class="ident" id="7116951">tc</span><span class="op" id="7116953">.</span><span class="ident" id="7116954">extra</span><span class="op" id="7116959">,</span>&nbsp;<span class="builtinfunc" id="7116961">len</span><span class="op" id="7116964">(</span><span class="ident" id="7116965">enc</span><span class="op" id="7116968">)</span><span class="op" id="7116969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7116975">continue</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7116987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7116992">b</span><span class="op" id="7116993">.</span><span class="ident" id="7116994">WriteByte</span><span class="op" id="7117003">(</span><span class="builtintype" id="7117004">byte</span><span class="op" id="7117008">(</span><span class="builtinfunc" id="7117009">len</span><span class="op" id="7117012">(</span><span class="ident" id="7117013">enc</span><span class="op" id="7117016">)</span><span class="op" id="7117017">)</span><span class="op" id="7117018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7117023">b</span><span class="op" id="7117024">.</span><span class="ident" id="7117025">Write</span><span class="op" id="7117030">(</span><span class="ident" id="7117031">enc</span><span class="op" id="7117034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7117038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7117042">if</span>&nbsp;<span class="ident" id="7117045">tc</span><span class="op" id="7117047">.</span><span class="ident" id="7117048">extra</span>&nbsp;<span class="op" id="7117054">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7117059">b</span><span class="op" id="7117060">.</span><span class="ident" id="7117061">WriteString</span><span class="op" id="7117072">(</span><span class="string" id="7117073">&#34;\x01\x02&#34;</span><span class="op" id="7117083">)</span>&nbsp;<span class="comment" id="7117085">//&nbsp;A&nbsp;1-byte&nbsp;payload&nbsp;with&nbsp;an&nbsp;0x02&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7117126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7117130">b</span><span class="op" id="7117131">.</span><span class="ident" id="7117132">WriteByte</span><span class="op" id="7117141">(</span><span class="num" id="7117142">0x00</span><span class="op" id="7117146">)</span>&nbsp;<span class="comment" id="7117148">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7117205">b</span><span class="op" id="7117206">.</span><span class="ident" id="7117207">WriteString</span><span class="op" id="7117218">(</span><span class="ident" id="7117219">trailerStr</span><span class="op" id="7117229">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7117234">got</span><span class="op" id="7117237">,</span>&nbsp;<span class="ident" id="7117239">err</span>&nbsp;<span class="op" id="7117243">:=</span>&nbsp;<span class="ident" id="7117246">Decode</span><span class="op" id="7117252">(</span><span class="ident" id="7117253">b</span><span class="op" id="7117254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7117258">if</span>&nbsp;<span class="ident" id="7117261">err</span>&nbsp;<span class="op" id="7117265">!=</span>&nbsp;<span class="ident" id="7117268">tc</span><span class="op" id="7117270">.</span><span class="ident" id="7117271">wantErr</span>&nbsp;<span class="op" id="7117279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7117284">t</span><span class="op" id="7117285">.</span><span class="ident" id="7117286">Errorf</span><span class="op" id="7117292">(</span><span class="string" id="7117293">&#34;nPix=%d,&nbsp;extra=%t\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="7117330">,</span>&nbsp;<span class="ident" id="7117332">tc</span><span class="op" id="7117334">.</span><span class="ident" id="7117335">nPix</span><span class="op" id="7117339">,</span>&nbsp;<span class="ident" id="7117341">tc</span><span class="op" id="7117343">.</span><span class="ident" id="7117344">extra</span><span class="op" id="7117349">,</span>&nbsp;<span class="ident" id="7117351">err</span><span class="op" id="7117354">,</span>&nbsp;<span class="ident" id="7117356">tc</span><span class="op" id="7117358">.</span><span class="ident" id="7117359">wantErr</span><span class="op" id="7117366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7117370">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7117375">if</span>&nbsp;<span class="ident" id="7117378">tc</span><span class="op" id="7117380">.</span><span class="ident" id="7117381">wantErr</span>&nbsp;<span class="op" id="7117389">!=</span>&nbsp;<span class="ident" id="7117392">nil</span>&nbsp;<span class="op" id="7117396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7117401">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7117412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7117416">want</span>&nbsp;<span class="op" id="7117421">:=</span>&nbsp;<span class="op" id="7117424">&amp;</span><span class="ident" id="7117425">image</span><span class="op" id="7117430">.</span><span class="ident" id="7117431">Paletted</span><span class="op" id="7117439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7117444">Pix</span><span class="op" id="7117447">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7117452">[</span><span class="op" id="7117453">]</span><span class="builtintype" id="7117454">uint8</span><span class="op" id="7117459">{</span><span class="num" id="7117460">0</span><span class="op" id="7117461">,</span>&nbsp;<span class="num" id="7117463">0</span><span class="op" id="7117464">}</span><span class="op" id="7117465">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7117470">Stride</span><span class="op" id="7117476">:</span>&nbsp;<span class="num" id="7117478">2</span><span class="op" id="7117479">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7117484">Rect</span><span class="op" id="7117488">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7117492">image</span><span class="op" id="7117497">.</span><span class="ident" id="7117498">Rect</span><span class="op" id="7117502">(</span><span class="num" id="7117503">0</span><span class="op" id="7117504">,</span>&nbsp;<span class="num" id="7117506">0</span><span class="op" id="7117507">,</span>&nbsp;<span class="num" id="7117509">2</span><span class="op" id="7117510">,</span>&nbsp;<span class="num" id="7117512">1</span><span class="op" id="7117513">)</span><span class="op" id="7117514">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7117519">Palette</span><span class="op" id="7117526">:</span>&nbsp;<span class="ident" id="7117528">color</span><span class="op" id="7117533">.</span><span class="ident" id="7117534">Palette</span><span class="op" id="7117541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7117547">color</span><span class="op" id="7117552">.</span><span class="ident" id="7117553">RGBA</span><span class="op" id="7117557">{</span><span class="num" id="7117558">0x10</span><span class="op" id="7117562">,</span>&nbsp;<span class="num" id="7117564">0x20</span><span class="op" id="7117568">,</span>&nbsp;<span class="num" id="7117570">0x30</span><span class="op" id="7117574">,</span>&nbsp;<span class="num" id="7117576">0xff</span><span class="op" id="7117580">}</span><span class="op" id="7117581">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7117587">color</span><span class="op" id="7117592">.</span><span class="ident" id="7117593">RGBA</span><span class="op" id="7117597">{</span><span class="num" id="7117598">0x40</span><span class="op" id="7117602">,</span>&nbsp;<span class="num" id="7117604">0x50</span><span class="op" id="7117608">,</span>&nbsp;<span class="num" id="7117610">0x60</span><span class="op" id="7117614">,</span>&nbsp;<span class="num" id="7117616">0xff</span><span class="op" id="7117620">}</span><span class="op" id="7117621">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7117626">}</span><span class="op" id="7117627">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7117631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7117635">if</span>&nbsp;<span class="op" id="7117638">!</span><span class="ident" id="7117639">reflect</span><span class="op" id="7117646">.</span><span class="ident" id="7117647">DeepEqual</span><span class="op" id="7117656">(</span><span class="ident" id="7117657">got</span><span class="op" id="7117660">,</span>&nbsp;<span class="ident" id="7117662">want</span><span class="op" id="7117666">)</span>&nbsp;<span class="op" id="7117668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7117673">t</span><span class="op" id="7117674">.</span><span class="ident" id="7117675">Errorf</span><span class="op" id="7117681">(</span><span class="string" id="7117682">&#34;nPix=%d,&nbsp;extra=%t\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="7117719">,</span>&nbsp;<span class="ident" id="7117721">tc</span><span class="op" id="7117723">.</span><span class="ident" id="7117724">nPix</span><span class="op" id="7117728">,</span>&nbsp;<span class="ident" id="7117730">tc</span><span class="op" id="7117732">.</span><span class="ident" id="7117733">extra</span><span class="op" id="7117738">,</span>&nbsp;<span class="ident" id="7117740">got</span><span class="op" id="7117743">,</span>&nbsp;<span class="ident" id="7117745">want</span><span class="op" id="7117749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7117753">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7117756">}</span><br>
<span class="lineno"></span><span class="op" id="7117758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7117761">func</span>&nbsp;<span class="ident" id="7117766">TestTransparentIndex</span><span class="op" id="7117786">(</span><span class="ident" id="7117787">t</span>&nbsp;<span class="op" id="7117789">*</span><span class="ident" id="7117790">testing</span><span class="op" id="7117797">.</span><span class="ident" id="7117798">T</span><span class="op" id="7117799">)</span>&nbsp;<span class="op" id="7117801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7117804">b</span>&nbsp;<span class="op" id="7117806">:=</span>&nbsp;<span class="op" id="7117809">&amp;</span><span class="ident" id="7117810">bytes</span><span class="op" id="7117815">.</span><span class="ident" id="7117816">Buffer</span><span class="op" id="7117822">{</span><span class="op" id="7117823">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7117826">b</span><span class="op" id="7117827">.</span><span class="ident" id="7117828">WriteString</span><span class="op" id="7117839">(</span><span class="ident" id="7117840">headerStr</span><span class="op" id="7117849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7117852">b</span><span class="op" id="7117853">.</span><span class="ident" id="7117854">WriteString</span><span class="op" id="7117865">(</span><span class="ident" id="7117866">paletteStr</span><span class="op" id="7117876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7117879">for</span>&nbsp;<span class="ident" id="7117883">transparentIndex</span>&nbsp;<span class="op" id="7117900">:=</span>&nbsp;<span class="num" id="7117903">0</span><span class="op" id="7117904">;</span>&nbsp;<span class="ident" id="7117906">transparentIndex</span>&nbsp;<span class="op" id="7117923">&lt;</span>&nbsp;<span class="num" id="7117925">3</span><span class="op" id="7117926">;</span>&nbsp;<span class="ident" id="7117928">transparentIndex</span><span class="op" id="7117944">++</span>&nbsp;<span class="op" id="7117947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7117951">if</span>&nbsp;<span class="ident" id="7117954">transparentIndex</span>&nbsp;<span class="op" id="7117971">&lt;</span>&nbsp;<span class="num" id="7117973">2</span>&nbsp;<span class="op" id="7117975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7117980">//&nbsp;Write&nbsp;the&nbsp;graphic&nbsp;control&nbsp;for&nbsp;the&nbsp;transparent&nbsp;index.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7118039">b</span><span class="op" id="7118040">.</span><span class="ident" id="7118041">WriteString</span><span class="op" id="7118052">(</span><span class="string" id="7118053">&#34;\x21\xf9\x00\x01\x00\x00&#34;</span><span class="op" id="7118079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7118084">b</span><span class="op" id="7118085">.</span><span class="ident" id="7118086">WriteByte</span><span class="op" id="7118095">(</span><span class="builtintype" id="7118096">byte</span><span class="op" id="7118100">(</span><span class="ident" id="7118101">transparentIndex</span><span class="op" id="7118117">)</span><span class="op" id="7118118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7118123">b</span><span class="op" id="7118124">.</span><span class="ident" id="7118125">WriteByte</span><span class="op" id="7118134">(</span><span class="num" id="7118135">0</span><span class="op" id="7118136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7118140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7118144">//&nbsp;Write&nbsp;an&nbsp;image&nbsp;with&nbsp;bounds&nbsp;2x1,&nbsp;as&nbsp;per&nbsp;TestDecode.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7118200">b</span><span class="op" id="7118201">.</span><span class="ident" id="7118202">WriteString</span><span class="op" id="7118213">(</span><span class="string" id="7118214">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="7118260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7118264">enc</span>&nbsp;<span class="op" id="7118268">:=</span>&nbsp;<span class="ident" id="7118271">lzwEncode</span><span class="op" id="7118280">(</span><span class="num" id="7118281">2</span><span class="op" id="7118282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7118286">if</span>&nbsp;<span class="builtinfunc" id="7118289">len</span><span class="op" id="7118292">(</span><span class="ident" id="7118293">enc</span><span class="op" id="7118296">)</span>&nbsp;<span class="op" id="7118298">&gt;</span>&nbsp;<span class="num" id="7118300">0xff</span>&nbsp;<span class="op" id="7118305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7118310">t</span><span class="op" id="7118311">.</span><span class="ident" id="7118312">Fatalf</span><span class="op" id="7118318">(</span><span class="string" id="7118319">&#34;compressed&nbsp;length&nbsp;%d&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="7118354">,</span>&nbsp;<span class="builtinfunc" id="7118356">len</span><span class="op" id="7118359">(</span><span class="ident" id="7118360">enc</span><span class="op" id="7118363">)</span><span class="op" id="7118364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7118368">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7118372">b</span><span class="op" id="7118373">.</span><span class="ident" id="7118374">WriteByte</span><span class="op" id="7118383">(</span><span class="builtintype" id="7118384">byte</span><span class="op" id="7118388">(</span><span class="builtinfunc" id="7118389">len</span><span class="op" id="7118392">(</span><span class="ident" id="7118393">enc</span><span class="op" id="7118396">)</span><span class="op" id="7118397">)</span><span class="op" id="7118398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7118402">b</span><span class="op" id="7118403">.</span><span class="ident" id="7118404">Write</span><span class="op" id="7118409">(</span><span class="ident" id="7118410">enc</span><span class="op" id="7118413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7118417">b</span><span class="op" id="7118418">.</span><span class="ident" id="7118419">WriteByte</span><span class="op" id="7118428">(</span><span class="num" id="7118429">0x00</span><span class="op" id="7118433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7118436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7118439">b</span><span class="op" id="7118440">.</span><span class="ident" id="7118441">WriteString</span><span class="op" id="7118452">(</span><span class="ident" id="7118453">trailerStr</span><span class="op" id="7118463">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7118467">g</span><span class="op" id="7118468">,</span>&nbsp;<span class="ident" id="7118470">err</span>&nbsp;<span class="op" id="7118474">:=</span>&nbsp;<span class="ident" id="7118477">DecodeAll</span><span class="op" id="7118486">(</span><span class="ident" id="7118487">b</span><span class="op" id="7118488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7118491">if</span>&nbsp;<span class="ident" id="7118494">err</span>&nbsp;<span class="op" id="7118498">!=</span>&nbsp;<span class="ident" id="7118501">nil</span>&nbsp;<span class="op" id="7118505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7118509">t</span><span class="op" id="7118510">.</span><span class="ident" id="7118511">Fatalf</span><span class="op" id="7118517">(</span><span class="string" id="7118518">&#34;DecodeAll:&nbsp;%v&#34;</span><span class="op" id="7118533">,</span>&nbsp;<span class="ident" id="7118535">err</span><span class="op" id="7118538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7118541">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7118544">c0</span>&nbsp;<span class="op" id="7118547">:=</span>&nbsp;<span class="ident" id="7118550">color</span><span class="op" id="7118555">.</span><span class="ident" id="7118556">RGBA</span><span class="op" id="7118560">{</span><span class="ident" id="7118561">paletteStr</span><span class="op" id="7118571">[</span><span class="num" id="7118572">0</span><span class="op" id="7118573">]</span><span class="op" id="7118574">,</span>&nbsp;<span class="ident" id="7118576">paletteStr</span><span class="op" id="7118586">[</span><span class="num" id="7118587">1</span><span class="op" id="7118588">]</span><span class="op" id="7118589">,</span>&nbsp;<span class="ident" id="7118591">paletteStr</span><span class="op" id="7118601">[</span><span class="num" id="7118602">2</span><span class="op" id="7118603">]</span><span class="op" id="7118604">,</span>&nbsp;<span class="num" id="7118606">0xff</span><span class="op" id="7118610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7118613">c1</span>&nbsp;<span class="op" id="7118616">:=</span>&nbsp;<span class="ident" id="7118619">color</span><span class="op" id="7118624">.</span><span class="ident" id="7118625">RGBA</span><span class="op" id="7118629">{</span><span class="ident" id="7118630">paletteStr</span><span class="op" id="7118640">[</span><span class="num" id="7118641">3</span><span class="op" id="7118642">]</span><span class="op" id="7118643">,</span>&nbsp;<span class="ident" id="7118645">paletteStr</span><span class="op" id="7118655">[</span><span class="num" id="7118656">4</span><span class="op" id="7118657">]</span><span class="op" id="7118658">,</span>&nbsp;<span class="ident" id="7118660">paletteStr</span><span class="op" id="7118670">[</span><span class="num" id="7118671">5</span><span class="op" id="7118672">]</span><span class="op" id="7118673">,</span>&nbsp;<span class="num" id="7118675">0xff</span><span class="op" id="7118679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7118682">cz</span>&nbsp;<span class="op" id="7118685">:=</span>&nbsp;<span class="ident" id="7118688">color</span><span class="op" id="7118693">.</span><span class="ident" id="7118694">RGBA</span><span class="op" id="7118698">{</span><span class="op" id="7118699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7118702">wants</span>&nbsp;<span class="op" id="7118708">:=</span>&nbsp;<span class="op" id="7118711">[</span><span class="op" id="7118712">]</span><span class="ident" id="7118713">color</span><span class="op" id="7118718">.</span><span class="ident" id="7118719">Palette</span><span class="op" id="7118726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7118730">{</span><span class="ident" id="7118731">cz</span><span class="op" id="7118733">,</span>&nbsp;<span class="ident" id="7118735">c1</span><span class="op" id="7118737">}</span><span class="op" id="7118738">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7118742">{</span><span class="ident" id="7118743">c0</span><span class="op" id="7118745">,</span>&nbsp;<span class="ident" id="7118747">cz</span><span class="op" id="7118749">}</span><span class="op" id="7118750">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7118754">{</span><span class="ident" id="7118755">c0</span><span class="op" id="7118757">,</span>&nbsp;<span class="ident" id="7118759">c1</span><span class="op" id="7118761">}</span><span class="op" id="7118762">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7118765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7118768">if</span>&nbsp;<span class="builtinfunc" id="7118771">len</span><span class="op" id="7118774">(</span><span class="ident" id="7118775">g</span><span class="op" id="7118776">.</span><span class="ident" id="7118777">Image</span><span class="op" id="7118782">)</span>&nbsp;<span class="op" id="7118784">!=</span>&nbsp;<span class="builtinfunc" id="7118787">len</span><span class="op" id="7118790">(</span><span class="ident" id="7118791">wants</span><span class="op" id="7118796">)</span>&nbsp;<span class="op" id="7118798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7118802">t</span><span class="op" id="7118803">.</span><span class="ident" id="7118804">Fatalf</span><span class="op" id="7118810">(</span><span class="string" id="7118811">&#34;got&nbsp;%d&nbsp;images,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7118835">,</span>&nbsp;<span class="builtinfunc" id="7118837">len</span><span class="op" id="7118840">(</span><span class="ident" id="7118841">g</span><span class="op" id="7118842">.</span><span class="ident" id="7118843">Image</span><span class="op" id="7118848">)</span><span class="op" id="7118849">,</span>&nbsp;<span class="builtinfunc" id="7118851">len</span><span class="op" id="7118854">(</span><span class="ident" id="7118855">wants</span><span class="op" id="7118860">)</span><span class="op" id="7118861">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7118864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7118867">for</span>&nbsp;<span class="ident" id="7118871">i</span><span class="op" id="7118872">,</span>&nbsp;<span class="ident" id="7118874">want</span>&nbsp;<span class="op" id="7118879">:=</span>&nbsp;<span class="keyword" id="7118882">range</span>&nbsp;<span class="ident" id="7118888">wants</span>&nbsp;<span class="op" id="7118894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7118898">got</span>&nbsp;<span class="op" id="7118902">:=</span>&nbsp;<span class="ident" id="7118905">g</span><span class="op" id="7118906">.</span><span class="ident" id="7118907">Image</span><span class="op" id="7118912">[</span><span class="ident" id="7118913">i</span><span class="op" id="7118914">]</span><span class="op" id="7118915">.</span><span class="ident" id="7118916">Palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7118926">if</span>&nbsp;<span class="op" id="7118929">!</span><span class="ident" id="7118930">reflect</span><span class="op" id="7118937">.</span><span class="ident" id="7118938">DeepEqual</span><span class="op" id="7118947">(</span><span class="ident" id="7118948">got</span><span class="op" id="7118951">,</span>&nbsp;<span class="ident" id="7118953">want</span><span class="op" id="7118957">)</span>&nbsp;<span class="op" id="7118959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7118964">t</span><span class="op" id="7118965">.</span><span class="ident" id="7118966">Errorf</span><span class="op" id="7118972">(</span><span class="string" id="7118973">&#34;palette&nbsp;#%d:\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="7119005">,</span>&nbsp;<span class="ident" id="7119007">i</span><span class="op" id="7119008">,</span>&nbsp;<span class="ident" id="7119010">got</span><span class="op" id="7119013">,</span>&nbsp;<span class="ident" id="7119015">want</span><span class="op" id="7119019">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7119023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7119026">}</span><br>
<span class="lineno"></span><span class="op" id="7119028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7119031">//&nbsp;testGIF&nbsp;is&nbsp;a&nbsp;simple&nbsp;GIF&nbsp;that&nbsp;we&nbsp;can&nbsp;modify&nbsp;to&nbsp;test&nbsp;different&nbsp;scenarios.</span><br>
<span class="lineno">140</span><span class="keyword" id="7119106">var</span>&nbsp;<span class="ident" id="7119110">testGIF</span>&nbsp;<span class="op" id="7119118">=</span>&nbsp;<span class="op" id="7119120">[</span><span class="op" id="7119121">]</span><span class="builtintype" id="7119122">byte</span><span class="op" id="7119126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7119129">&#39;G&#39;</span><span class="op" id="7119132">,</span>&nbsp;<span class="string" id="7119134">&#39;I&#39;</span><span class="op" id="7119137">,</span>&nbsp;<span class="string" id="7119139">&#39;F&#39;</span><span class="op" id="7119142">,</span>&nbsp;<span class="string" id="7119144">&#39;8&#39;</span><span class="op" id="7119147">,</span>&nbsp;<span class="string" id="7119149">&#39;9&#39;</span><span class="op" id="7119152">,</span>&nbsp;<span class="string" id="7119154">&#39;a&#39;</span><span class="op" id="7119157">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7119160">1</span><span class="op" id="7119161">,</span>&nbsp;<span class="num" id="7119163">0</span><span class="op" id="7119164">,</span>&nbsp;<span class="num" id="7119166">1</span><span class="op" id="7119167">,</span>&nbsp;<span class="num" id="7119169">0</span><span class="op" id="7119170">,</span>&nbsp;<span class="comment" id="7119172">//&nbsp;w=1,&nbsp;h=1&nbsp;(6)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7119189">128</span><span class="op" id="7119192">,</span>&nbsp;<span class="num" id="7119194">0</span><span class="op" id="7119195">,</span>&nbsp;<span class="num" id="7119197">0</span><span class="op" id="7119198">,</span>&nbsp;<span class="comment" id="7119200">//&nbsp;headerFields,&nbsp;bg,&nbsp;aspect&nbsp;(10)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7119234">0</span><span class="op" id="7119235">,</span>&nbsp;<span class="num" id="7119237">0</span><span class="op" id="7119238">,</span>&nbsp;<span class="num" id="7119240">0</span><span class="op" id="7119241">,</span>&nbsp;<span class="num" id="7119243">1</span><span class="op" id="7119244">,</span>&nbsp;<span class="num" id="7119246">1</span><span class="op" id="7119247">,</span>&nbsp;<span class="num" id="7119249">1</span><span class="op" id="7119250">,</span>&nbsp;<span class="comment" id="7119252">//&nbsp;color&nbsp;map&nbsp;and&nbsp;graphics&nbsp;control&nbsp;(13)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7119292">0x21</span><span class="op" id="7119296">,</span>&nbsp;<span class="num" id="7119298">0xf9</span><span class="op" id="7119302">,</span>&nbsp;<span class="num" id="7119304">0x04</span><span class="op" id="7119308">,</span>&nbsp;<span class="num" id="7119310">0x00</span><span class="op" id="7119314">,</span>&nbsp;<span class="num" id="7119316">0x00</span><span class="op" id="7119320">,</span>&nbsp;<span class="num" id="7119322">0x00</span><span class="op" id="7119326">,</span>&nbsp;<span class="num" id="7119328">0xff</span><span class="op" id="7119332">,</span>&nbsp;<span class="num" id="7119334">0x00</span><span class="op" id="7119338">,</span>&nbsp;<span class="comment" id="7119340">//&nbsp;(19)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7119349">//&nbsp;frame&nbsp;1&nbsp;(0,0&nbsp;-&nbsp;1,1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7119373">0x2c</span><span class="op" id="7119377">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7119380">0x00</span><span class="op" id="7119384">,</span>&nbsp;<span class="num" id="7119386">0x00</span><span class="op" id="7119390">,</span>&nbsp;<span class="num" id="7119392">0x00</span><span class="op" id="7119396">,</span>&nbsp;<span class="num" id="7119398">0x00</span><span class="op" id="7119402">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7119405">0x01</span><span class="op" id="7119409">,</span>&nbsp;<span class="num" id="7119411">0x00</span><span class="op" id="7119415">,</span>&nbsp;<span class="num" id="7119417">0x01</span><span class="op" id="7119421">,</span>&nbsp;<span class="num" id="7119423">0x00</span><span class="op" id="7119427">,</span>&nbsp;<span class="comment" id="7119429">//&nbsp;(32)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7119438">0x00</span><span class="op" id="7119442">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7119445">0x02</span><span class="op" id="7119449">,</span>&nbsp;<span class="num" id="7119451">0x02</span><span class="op" id="7119455">,</span>&nbsp;<span class="num" id="7119457">0x4c</span><span class="op" id="7119461">,</span>&nbsp;<span class="num" id="7119463">0x01</span><span class="op" id="7119467">,</span>&nbsp;<span class="num" id="7119469">0x00</span><span class="op" id="7119473">,</span>&nbsp;<span class="comment" id="7119475">//&nbsp;lzw&nbsp;pixels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7119490">//&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7119502">0x3b</span><span class="op" id="7119506">,</span><br>
<span class="lineno"></span><span class="op" id="7119508">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="7119511">func</span>&nbsp;<span class="ident" id="7119516">try</span><span class="op" id="7119519">(</span><span class="ident" id="7119520">t</span>&nbsp;<span class="op" id="7119522">*</span><span class="ident" id="7119523">testing</span><span class="op" id="7119530">.</span><span class="ident" id="7119531">T</span><span class="op" id="7119532">,</span>&nbsp;<span class="ident" id="7119534">b</span>&nbsp;<span class="op" id="7119536">[</span><span class="op" id="7119537">]</span><span class="builtintype" id="7119538">byte</span><span class="op" id="7119542">,</span>&nbsp;<span class="ident" id="7119544">want</span>&nbsp;<span class="builtintype" id="7119549">string</span><span class="op" id="7119555">)</span>&nbsp;<span class="op" id="7119557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7119560">_</span><span class="op" id="7119561">,</span>&nbsp;<span class="ident" id="7119563">err</span>&nbsp;<span class="op" id="7119567">:=</span>&nbsp;<span class="ident" id="7119570">DecodeAll</span><span class="op" id="7119579">(</span><span class="ident" id="7119580">bytes</span><span class="op" id="7119585">.</span><span class="ident" id="7119586">NewReader</span><span class="op" id="7119595">(</span><span class="ident" id="7119596">b</span><span class="op" id="7119597">)</span><span class="op" id="7119598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7119601">var</span>&nbsp;<span class="ident" id="7119605">got</span>&nbsp;<span class="builtintype" id="7119609">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7119617">if</span>&nbsp;<span class="ident" id="7119620">err</span>&nbsp;<span class="op" id="7119624">!=</span>&nbsp;<span class="ident" id="7119627">nil</span>&nbsp;<span class="op" id="7119631">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7119635">got</span>&nbsp;<span class="op" id="7119639">=</span>&nbsp;<span class="ident" id="7119641">err</span><span class="op" id="7119644">.</span><span class="ident" id="7119645">Error</span><span class="op" id="7119650">(</span><span class="op" id="7119651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7119654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7119657">if</span>&nbsp;<span class="ident" id="7119660">got</span>&nbsp;<span class="op" id="7119664">!=</span>&nbsp;<span class="ident" id="7119667">want</span>&nbsp;<span class="op" id="7119672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7119676">t</span><span class="op" id="7119677">.</span><span class="ident" id="7119678">Fatalf</span><span class="op" id="7119684">(</span><span class="string" id="7119685">&#34;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7119702">,</span>&nbsp;<span class="ident" id="7119704">got</span><span class="op" id="7119707">,</span>&nbsp;<span class="ident" id="7119709">want</span><span class="op" id="7119713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7119716">}</span><br>
<span class="lineno">165</span><span class="op" id="7119718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7119721">func</span>&nbsp;<span class="ident" id="7119726">TestBounds</span><span class="op" id="7119736">(</span><span class="ident" id="7119737">t</span>&nbsp;<span class="op" id="7119739">*</span><span class="ident" id="7119740">testing</span><span class="op" id="7119747">.</span><span class="ident" id="7119748">T</span><span class="op" id="7119749">)</span>&nbsp;<span class="op" id="7119751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7119754">//&nbsp;Make&nbsp;a&nbsp;local&nbsp;copy&nbsp;of&nbsp;testGIF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7119788">gif</span>&nbsp;<span class="op" id="7119792">:=</span>&nbsp;<span class="builtinfunc" id="7119795">make</span><span class="op" id="7119799">(</span><span class="op" id="7119800">[</span><span class="op" id="7119801">]</span><span class="builtintype" id="7119802">byte</span><span class="op" id="7119806">,</span>&nbsp;<span class="builtinfunc" id="7119808">len</span><span class="op" id="7119811">(</span><span class="ident" id="7119812">testGIF</span><span class="op" id="7119819">)</span><span class="op" id="7119820">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7119823">copy</span><span class="op" id="7119827">(</span><span class="ident" id="7119828">gif</span><span class="op" id="7119831">,</span>&nbsp;<span class="ident" id="7119833">testGIF</span><span class="op" id="7119840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7119843">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;too&nbsp;big,&nbsp;just&nbsp;by&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7119885">gif</span><span class="op" id="7119888">[</span><span class="num" id="7119889">32</span><span class="op" id="7119891">]</span>&nbsp;<span class="op" id="7119893">=</span>&nbsp;<span class="num" id="7119895">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7119898">want</span>&nbsp;<span class="op" id="7119903">:=</span>&nbsp;<span class="string" id="7119906">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7119952">try</span><span class="op" id="7119955">(</span><span class="ident" id="7119956">t</span><span class="op" id="7119957">,</span>&nbsp;<span class="ident" id="7119959">gif</span><span class="op" id="7119962">,</span>&nbsp;<span class="ident" id="7119964">want</span><span class="op" id="7119968">)</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7119972">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;too&nbsp;small;&nbsp;does&nbsp;not&nbsp;trigger&nbsp;bounds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7120027">//&nbsp;check,&nbsp;but&nbsp;now&nbsp;there&#39;s&nbsp;too&nbsp;much&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120069">gif</span><span class="op" id="7120072">[</span><span class="num" id="7120073">32</span><span class="op" id="7120075">]</span>&nbsp;<span class="op" id="7120077">=</span>&nbsp;<span class="num" id="7120079">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120082">want</span>&nbsp;<span class="op" id="7120087">=</span>&nbsp;<span class="string" id="7120089">&#34;gif:&nbsp;too&nbsp;much&nbsp;image&nbsp;data&#34;</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120117">try</span><span class="op" id="7120120">(</span><span class="ident" id="7120121">t</span><span class="op" id="7120122">,</span>&nbsp;<span class="ident" id="7120124">gif</span><span class="op" id="7120127">,</span>&nbsp;<span class="ident" id="7120129">want</span><span class="op" id="7120133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120136">gif</span><span class="op" id="7120139">[</span><span class="num" id="7120140">32</span><span class="op" id="7120142">]</span>&nbsp;<span class="op" id="7120144">=</span>&nbsp;<span class="num" id="7120146">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7120150">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;really&nbsp;big,&nbsp;expect&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120199">want</span>&nbsp;<span class="op" id="7120204">=</span>&nbsp;<span class="string" id="7120206">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7120252">for</span>&nbsp;<span class="ident" id="7120256">i</span>&nbsp;<span class="op" id="7120258">:=</span>&nbsp;<span class="num" id="7120261">0</span><span class="op" id="7120262">;</span>&nbsp;<span class="ident" id="7120264">i</span>&nbsp;<span class="op" id="7120266">&lt;</span>&nbsp;<span class="num" id="7120268">4</span><span class="op" id="7120269">;</span>&nbsp;<span class="ident" id="7120271">i</span><span class="op" id="7120272">++</span>&nbsp;<span class="op" id="7120275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120279">gif</span><span class="op" id="7120282">[</span><span class="num" id="7120283">32</span><span class="op" id="7120285">+</span><span class="ident" id="7120286">i</span><span class="op" id="7120287">]</span>&nbsp;<span class="op" id="7120289">=</span>&nbsp;<span class="num" id="7120291">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7120297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120300">try</span><span class="op" id="7120303">(</span><span class="ident" id="7120304">t</span><span class="op" id="7120305">,</span>&nbsp;<span class="ident" id="7120307">gif</span><span class="op" id="7120310">,</span>&nbsp;<span class="ident" id="7120312">want</span><span class="op" id="7120316">)</span><br>
<span class="lineno"></span><span class="op" id="7120318">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="7120321">func</span>&nbsp;<span class="ident" id="7120326">TestNoPalette</span><span class="op" id="7120339">(</span><span class="ident" id="7120340">t</span>&nbsp;<span class="op" id="7120342">*</span><span class="ident" id="7120343">testing</span><span class="op" id="7120350">.</span><span class="ident" id="7120351">T</span><span class="op" id="7120352">)</span>&nbsp;<span class="op" id="7120354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120357">b</span>&nbsp;<span class="op" id="7120359">:=</span>&nbsp;<span class="op" id="7120362">&amp;</span><span class="ident" id="7120363">bytes</span><span class="op" id="7120368">.</span><span class="ident" id="7120369">Buffer</span><span class="op" id="7120375">{</span><span class="op" id="7120376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7120380">//&nbsp;Manufacture&nbsp;a&nbsp;GIF&nbsp;with&nbsp;no&nbsp;palette,&nbsp;so&nbsp;any&nbsp;pixel&nbsp;at&nbsp;all</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7120439">//&nbsp;will&nbsp;be&nbsp;invalid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120460">b</span><span class="op" id="7120461">.</span><span class="ident" id="7120462">WriteString</span><span class="op" id="7120473">(</span><span class="ident" id="7120474">headerStr</span><span class="op" id="7120483">[</span><span class="op" id="7120484">:</span><span class="builtinfunc" id="7120485">len</span><span class="op" id="7120488">(</span><span class="ident" id="7120489">headerStr</span><span class="op" id="7120498">)</span><span class="op" id="7120499">-</span><span class="num" id="7120500">3</span><span class="op" id="7120501">]</span><span class="op" id="7120502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120505">b</span><span class="op" id="7120506">.</span><span class="ident" id="7120507">WriteString</span><span class="op" id="7120518">(</span><span class="string" id="7120519">&#34;\x00\x00\x00&#34;</span><span class="op" id="7120533">)</span>&nbsp;<span class="comment" id="7120535">//&nbsp;No&nbsp;global&nbsp;palette.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7120559">//&nbsp;Image&nbsp;descriptor:&nbsp;2x1,&nbsp;no&nbsp;local&nbsp;palette.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120604">b</span><span class="op" id="7120605">.</span><span class="ident" id="7120606">WriteString</span><span class="op" id="7120617">(</span><span class="string" id="7120618">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="7120664">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7120668">//&nbsp;Encode&nbsp;the&nbsp;pixels:&nbsp;neither&nbsp;is&nbsp;in&nbsp;range,&nbsp;because&nbsp;there&nbsp;is&nbsp;no&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120741">pix</span>&nbsp;<span class="op" id="7120745">:=</span>&nbsp;<span class="op" id="7120748">[</span><span class="op" id="7120749">]</span><span class="builtintype" id="7120750">byte</span><span class="op" id="7120754">{</span><span class="num" id="7120755">0</span><span class="op" id="7120756">,</span>&nbsp;<span class="num" id="7120758">128</span><span class="op" id="7120761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120764">enc</span>&nbsp;<span class="op" id="7120768">:=</span>&nbsp;<span class="op" id="7120771">&amp;</span><span class="ident" id="7120772">bytes</span><span class="op" id="7120777">.</span><span class="ident" id="7120778">Buffer</span><span class="op" id="7120784">{</span><span class="op" id="7120785">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120788">w</span>&nbsp;<span class="op" id="7120790">:=</span>&nbsp;<span class="ident" id="7120793">lzw</span><span class="op" id="7120796">.</span><span class="ident" id="7120797">NewWriter</span><span class="op" id="7120806">(</span><span class="ident" id="7120807">enc</span><span class="op" id="7120810">,</span>&nbsp;<span class="ident" id="7120812">lzw</span><span class="op" id="7120815">.</span><span class="ident" id="7120816">LSB</span><span class="op" id="7120819">,</span>&nbsp;<span class="num" id="7120821">2</span><span class="op" id="7120822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120825">w</span><span class="op" id="7120826">.</span><span class="ident" id="7120827">Write</span><span class="op" id="7120832">(</span><span class="ident" id="7120833">pix</span><span class="op" id="7120836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120839">w</span><span class="op" id="7120840">.</span><span class="ident" id="7120841">Close</span><span class="op" id="7120846">(</span><span class="op" id="7120847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120850">b</span><span class="op" id="7120851">.</span><span class="ident" id="7120852">WriteByte</span><span class="op" id="7120861">(</span><span class="builtintype" id="7120862">byte</span><span class="op" id="7120866">(</span><span class="builtinfunc" id="7120867">len</span><span class="op" id="7120870">(</span><span class="ident" id="7120871">enc</span><span class="op" id="7120874">.</span><span class="ident" id="7120875">Bytes</span><span class="op" id="7120880">(</span><span class="op" id="7120881">)</span><span class="op" id="7120882">)</span><span class="op" id="7120883">)</span><span class="op" id="7120884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120887">b</span><span class="op" id="7120888">.</span><span class="ident" id="7120889">Write</span><span class="op" id="7120894">(</span><span class="ident" id="7120895">enc</span><span class="op" id="7120898">.</span><span class="ident" id="7120899">Bytes</span><span class="op" id="7120904">(</span><span class="op" id="7120905">)</span><span class="op" id="7120906">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120909">b</span><span class="op" id="7120910">.</span><span class="ident" id="7120911">WriteByte</span><span class="op" id="7120920">(</span><span class="num" id="7120921">0x00</span><span class="op" id="7120925">)</span>&nbsp;<span class="comment" id="7120927">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120984">b</span><span class="op" id="7120985">.</span><span class="ident" id="7120986">WriteString</span><span class="op" id="7120997">(</span><span class="ident" id="7120998">trailerStr</span><span class="op" id="7121008">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7121012">try</span><span class="op" id="7121015">(</span><span class="ident" id="7121016">t</span><span class="op" id="7121017">,</span>&nbsp;<span class="ident" id="7121019">b</span><span class="op" id="7121020">.</span><span class="ident" id="7121021">Bytes</span><span class="op" id="7121026">(</span><span class="op" id="7121027">)</span><span class="op" id="7121028">,</span>&nbsp;<span class="string" id="7121030">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><span class="op" id="7121056">)</span><br>
<span class="lineno">215</span><span class="op" id="7121058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7121061">func</span>&nbsp;<span class="ident" id="7121066">TestPixelOutsidePaletteRange</span><span class="op" id="7121094">(</span><span class="ident" id="7121095">t</span>&nbsp;<span class="op" id="7121097">*</span><span class="ident" id="7121098">testing</span><span class="op" id="7121105">.</span><span class="ident" id="7121106">T</span><span class="op" id="7121107">)</span>&nbsp;<span class="op" id="7121109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7121112">for</span>&nbsp;<span class="ident" id="7121116">_</span><span class="op" id="7121117">,</span>&nbsp;<span class="ident" id="7121119">pval</span>&nbsp;<span class="op" id="7121124">:=</span>&nbsp;<span class="keyword" id="7121127">range</span>&nbsp;<span class="op" id="7121133">[</span><span class="op" id="7121134">]</span><span class="builtintype" id="7121135">byte</span><span class="op" id="7121139">{</span><span class="num" id="7121140">0</span><span class="op" id="7121141">,</span>&nbsp;<span class="num" id="7121143">1</span><span class="op" id="7121144">,</span>&nbsp;<span class="num" id="7121146">2</span><span class="op" id="7121147">,</span>&nbsp;<span class="num" id="7121149">3</span><span class="op" id="7121150">,</span>&nbsp;<span class="num" id="7121152">255</span><span class="op" id="7121155">}</span>&nbsp;<span class="op" id="7121157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7121161">b</span>&nbsp;<span class="op" id="7121163">:=</span>&nbsp;<span class="op" id="7121166">&amp;</span><span class="ident" id="7121167">bytes</span><span class="op" id="7121172">.</span><span class="ident" id="7121173">Buffer</span><span class="op" id="7121179">{</span><span class="op" id="7121180">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7121185">//&nbsp;Manufacture&nbsp;a&nbsp;GIF&nbsp;with&nbsp;a&nbsp;2&nbsp;color&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7121232">b</span><span class="op" id="7121233">.</span><span class="ident" id="7121234">WriteString</span><span class="op" id="7121245">(</span><span class="ident" id="7121246">headerStr</span><span class="op" id="7121255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7121259">b</span><span class="op" id="7121260">.</span><span class="ident" id="7121261">WriteString</span><span class="op" id="7121272">(</span><span class="ident" id="7121273">paletteStr</span><span class="op" id="7121283">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7121288">//&nbsp;Image&nbsp;descriptor:&nbsp;2x1,&nbsp;no&nbsp;local&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7121334">b</span><span class="op" id="7121335">.</span><span class="ident" id="7121336">WriteString</span><span class="op" id="7121347">(</span><span class="string" id="7121348">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="7121394">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7121399">//&nbsp;Encode&nbsp;the&nbsp;pixels;&nbsp;some&nbsp;pvals&nbsp;trigger&nbsp;the&nbsp;expected&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7121462">pix</span>&nbsp;<span class="op" id="7121466">:=</span>&nbsp;<span class="op" id="7121469">[</span><span class="op" id="7121470">]</span><span class="builtintype" id="7121471">byte</span><span class="op" id="7121475">{</span><span class="ident" id="7121476">pval</span><span class="op" id="7121480">,</span>&nbsp;<span class="ident" id="7121482">pval</span><span class="op" id="7121486">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7121490">enc</span>&nbsp;<span class="op" id="7121494">:=</span>&nbsp;<span class="op" id="7121497">&amp;</span><span class="ident" id="7121498">bytes</span><span class="op" id="7121503">.</span><span class="ident" id="7121504">Buffer</span><span class="op" id="7121510">{</span><span class="op" id="7121511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7121515">w</span>&nbsp;<span class="op" id="7121517">:=</span>&nbsp;<span class="ident" id="7121520">lzw</span><span class="op" id="7121523">.</span><span class="ident" id="7121524">NewWriter</span><span class="op" id="7121533">(</span><span class="ident" id="7121534">enc</span><span class="op" id="7121537">,</span>&nbsp;<span class="ident" id="7121539">lzw</span><span class="op" id="7121542">.</span><span class="ident" id="7121543">LSB</span><span class="op" id="7121546">,</span>&nbsp;<span class="num" id="7121548">2</span><span class="op" id="7121549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7121553">w</span><span class="op" id="7121554">.</span><span class="ident" id="7121555">Write</span><span class="op" id="7121560">(</span><span class="ident" id="7121561">pix</span><span class="op" id="7121564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7121568">w</span><span class="op" id="7121569">.</span><span class="ident" id="7121570">Close</span><span class="op" id="7121575">(</span><span class="op" id="7121576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7121580">b</span><span class="op" id="7121581">.</span><span class="ident" id="7121582">WriteByte</span><span class="op" id="7121591">(</span><span class="builtintype" id="7121592">byte</span><span class="op" id="7121596">(</span><span class="builtinfunc" id="7121597">len</span><span class="op" id="7121600">(</span><span class="ident" id="7121601">enc</span><span class="op" id="7121604">.</span><span class="ident" id="7121605">Bytes</span><span class="op" id="7121610">(</span><span class="op" id="7121611">)</span><span class="op" id="7121612">)</span><span class="op" id="7121613">)</span><span class="op" id="7121614">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7121618">b</span><span class="op" id="7121619">.</span><span class="ident" id="7121620">Write</span><span class="op" id="7121625">(</span><span class="ident" id="7121626">enc</span><span class="op" id="7121629">.</span><span class="ident" id="7121630">Bytes</span><span class="op" id="7121635">(</span><span class="op" id="7121636">)</span><span class="op" id="7121637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7121641">b</span><span class="op" id="7121642">.</span><span class="ident" id="7121643">WriteByte</span><span class="op" id="7121652">(</span><span class="num" id="7121653">0x00</span><span class="op" id="7121657">)</span>&nbsp;<span class="comment" id="7121659">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7121717">b</span><span class="op" id="7121718">.</span><span class="ident" id="7121719">WriteString</span><span class="op" id="7121730">(</span><span class="ident" id="7121731">trailerStr</span><span class="op" id="7121741">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7121746">//&nbsp;No&nbsp;error&nbsp;expected,&nbsp;unless&nbsp;the&nbsp;pixels&nbsp;are&nbsp;beyond&nbsp;the&nbsp;2&nbsp;color&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7121820">want</span>&nbsp;<span class="op" id="7121825">:=</span>&nbsp;<span class="string" id="7121828">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7121833">if</span>&nbsp;<span class="ident" id="7121836">pval</span>&nbsp;<span class="op" id="7121841">&gt;=</span>&nbsp;<span class="num" id="7121844">2</span>&nbsp;<span class="op" id="7121846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7121851">want</span>&nbsp;<span class="op" id="7121856">=</span>&nbsp;<span class="string" id="7121858">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7121887">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7121891">try</span><span class="op" id="7121894">(</span><span class="ident" id="7121895">t</span><span class="op" id="7121896">,</span>&nbsp;<span class="ident" id="7121898">b</span><span class="op" id="7121899">.</span><span class="ident" id="7121900">Bytes</span><span class="op" id="7121905">(</span><span class="op" id="7121906">)</span><span class="op" id="7121907">,</span>&nbsp;<span class="ident" id="7121909">want</span><span class="op" id="7121913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7121916">}</span><br>
<span class="lineno"></span><span class="op" id="7121918">}</span>
</div>
</body>
</html>
