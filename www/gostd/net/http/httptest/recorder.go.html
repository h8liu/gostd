<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/httptest</h2>
<ul>
<li><a href="/gostd/net/http/httptest/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder.go.html" class="current">recorder.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder_test.go.html">recorder_test.go</a></li>
<li><a href="/gostd/net/http/httptest/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/httptest/server_test.go.html">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5844004">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5844059">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5844113">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5844164">//&nbsp;Package&nbsp;httptest&nbsp;provides&nbsp;utilities&nbsp;for&nbsp;HTTP&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="5844221">package</span>&nbsp;<span class="ident" id="5844229">httptest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5844239">import</span>&nbsp;<span class="op" id="5844246">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5844249">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5844258">&#34;net/http&#34;</span><br>
<span class="lineno"></span><span class="op" id="5844269">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5844272">//&nbsp;ResponseRecorder&nbsp;is&nbsp;an&nbsp;implementation&nbsp;of&nbsp;http.ResponseWriter&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5844341">//&nbsp;records&nbsp;its&nbsp;mutations&nbsp;for&nbsp;later&nbsp;inspection&nbsp;in&nbsp;tests.</span><br>
<span class="lineno">15</span><span class="keyword" id="5844397">type</span>&nbsp;<span class="ident" id="5844402">ResponseRecorder</span>&nbsp;<span class="keyword" id="5844419">struct</span>&nbsp;<span class="op" id="5844426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5844429">Code</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5844439">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5844453">//&nbsp;the&nbsp;HTTP&nbsp;response&nbsp;code&nbsp;from&nbsp;WriteHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5844497">HeaderMap</span>&nbsp;<span class="ident" id="5844507">http</span><span class="op" id="5844511">.</span><span class="ident" id="5844512">Header</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5844521">//&nbsp;the&nbsp;HTTP&nbsp;response&nbsp;headers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5844551">Body</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5844561">*</span><span class="ident" id="5844562">bytes</span><span class="op" id="5844567">.</span><span class="ident" id="5844568">Buffer</span>&nbsp;<span class="comment" id="5844575">//&nbsp;if&nbsp;non-nil,&nbsp;the&nbsp;bytes.Buffer&nbsp;to&nbsp;append&nbsp;written&nbsp;data&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5844634">Flushed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5844644">bool</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5844651">wroteHeader</span>&nbsp;<span class="builtintype" id="5844663">bool</span><br>
<span class="lineno"></span><span class="op" id="5844668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5844671">//&nbsp;NewRecorder&nbsp;returns&nbsp;an&nbsp;initialized&nbsp;ResponseRecorder.</span><br>
<span class="lineno">25</span><span class="keyword" id="5844727">func</span>&nbsp;<span class="ident" id="5844732">NewRecorder</span><span class="op" id="5844743">(</span><span class="op" id="5844744">)</span>&nbsp;<span class="op" id="5844746">*</span><span class="ident" id="5844747">ResponseRecorder</span>&nbsp;<span class="op" id="5844764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5844767">return</span>&nbsp;<span class="op" id="5844774">&amp;</span><span class="ident" id="5844775">ResponseRecorder</span><span class="op" id="5844791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5844795">HeaderMap</span><span class="op" id="5844804">:</span>&nbsp;<span class="builtinfunc" id="5844806">make</span><span class="op" id="5844810">(</span><span class="ident" id="5844811">http</span><span class="op" id="5844815">.</span><span class="ident" id="5844816">Header</span><span class="op" id="5844822">)</span><span class="op" id="5844823">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5844827">Body</span><span class="op" id="5844831">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5844838">new</span><span class="op" id="5844841">(</span><span class="ident" id="5844842">bytes</span><span class="op" id="5844847">.</span><span class="ident" id="5844848">Buffer</span><span class="op" id="5844854">)</span><span class="op" id="5844855">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5844859">Code</span><span class="op" id="5844863">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5844870">200</span><span class="op" id="5844873">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5844876">}</span><br>
<span class="lineno"></span><span class="op" id="5844878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5844881">//&nbsp;DefaultRemoteAddr&nbsp;is&nbsp;the&nbsp;default&nbsp;remote&nbsp;address&nbsp;to&nbsp;return&nbsp;in&nbsp;RemoteAddr&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="5844959">//&nbsp;an&nbsp;explicit&nbsp;DefaultRemoteAddr&nbsp;isn&#39;t&nbsp;set&nbsp;on&nbsp;ResponseRecorder.</span><br>
<span class="lineno">35</span><span class="keyword" id="5845023">const</span>&nbsp;<span class="ident" id="5845029">DefaultRemoteAddr</span>&nbsp;<span class="op" id="5845047">=</span>&nbsp;<span class="string" id="5845049">&#34;1.2.3.4&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5845060">//&nbsp;Header&nbsp;returns&nbsp;the&nbsp;response&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="5845100">func</span>&nbsp;<span class="op" id="5845105">(</span><span class="ident" id="5845106">rw</span>&nbsp;<span class="op" id="5845109">*</span><span class="ident" id="5845110">ResponseRecorder</span><span class="op" id="5845126">)</span>&nbsp;<span class="ident" id="5845128">Header</span><span class="op" id="5845134">(</span><span class="op" id="5845135">)</span>&nbsp;<span class="ident" id="5845137">http</span><span class="op" id="5845141">.</span><span class="ident" id="5845142">Header</span>&nbsp;<span class="op" id="5845149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5845152">m</span>&nbsp;<span class="op" id="5845154">:=</span>&nbsp;<span class="ident" id="5845157">rw</span><span class="op" id="5845159">.</span><span class="ident" id="5845160">HeaderMap</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5845171">if</span>&nbsp;<span class="ident" id="5845174">m</span>&nbsp;<span class="op" id="5845176">==</span>&nbsp;<span class="ident" id="5845179">nil</span>&nbsp;<span class="op" id="5845183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5845187">m</span>&nbsp;<span class="op" id="5845189">=</span>&nbsp;<span class="builtinfunc" id="5845191">make</span><span class="op" id="5845195">(</span><span class="ident" id="5845196">http</span><span class="op" id="5845200">.</span><span class="ident" id="5845201">Header</span><span class="op" id="5845207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5845211">rw</span><span class="op" id="5845213">.</span><span class="ident" id="5845214">HeaderMap</span>&nbsp;<span class="op" id="5845224">=</span>&nbsp;<span class="ident" id="5845226">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5845229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5845232">return</span>&nbsp;<span class="ident" id="5845239">m</span><br>
<span class="lineno">45</span><span class="op" id="5845241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5845244">//&nbsp;Write&nbsp;always&nbsp;succeeds&nbsp;and&nbsp;writes&nbsp;to&nbsp;rw.Body,&nbsp;if&nbsp;not&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="5845304">func</span>&nbsp;<span class="op" id="5845309">(</span><span class="ident" id="5845310">rw</span>&nbsp;<span class="op" id="5845313">*</span><span class="ident" id="5845314">ResponseRecorder</span><span class="op" id="5845330">)</span>&nbsp;<span class="ident" id="5845332">Write</span><span class="op" id="5845337">(</span><span class="ident" id="5845338">buf</span>&nbsp;<span class="op" id="5845342">[</span><span class="op" id="5845343">]</span><span class="builtintype" id="5845344">byte</span><span class="op" id="5845348">)</span>&nbsp;<span class="op" id="5845350">(</span><span class="builtintype" id="5845351">int</span><span class="op" id="5845354">,</span>&nbsp;<span class="builtintype" id="5845356">error</span><span class="op" id="5845361">)</span>&nbsp;<span class="op" id="5845363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5845366">if</span>&nbsp;<span class="op" id="5845369">!</span><span class="ident" id="5845370">rw</span><span class="op" id="5845372">.</span><span class="ident" id="5845373">wroteHeader</span>&nbsp;<span class="op" id="5845385">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5845389">rw</span><span class="op" id="5845391">.</span><span class="ident" id="5845392">WriteHeader</span><span class="op" id="5845403">(</span><span class="num" id="5845404">200</span><span class="op" id="5845407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5845410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5845413">if</span>&nbsp;<span class="ident" id="5845416">rw</span><span class="op" id="5845418">.</span><span class="ident" id="5845419">Body</span>&nbsp;<span class="op" id="5845424">!=</span>&nbsp;<span class="ident" id="5845427">nil</span>&nbsp;<span class="op" id="5845431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5845435">rw</span><span class="op" id="5845437">.</span><span class="ident" id="5845438">Body</span><span class="op" id="5845442">.</span><span class="ident" id="5845443">Write</span><span class="op" id="5845448">(</span><span class="ident" id="5845449">buf</span><span class="op" id="5845452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5845455">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5845458">return</span>&nbsp;<span class="builtinfunc" id="5845465">len</span><span class="op" id="5845468">(</span><span class="ident" id="5845469">buf</span><span class="op" id="5845472">)</span><span class="op" id="5845473">,</span>&nbsp;<span class="ident" id="5845475">nil</span><br>
<span class="lineno"></span><span class="op" id="5845479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5845482">//&nbsp;WriteHeader&nbsp;sets&nbsp;rw.Code.</span><br>
<span class="lineno"></span><span class="keyword" id="5845511">func</span>&nbsp;<span class="op" id="5845516">(</span><span class="ident" id="5845517">rw</span>&nbsp;<span class="op" id="5845520">*</span><span class="ident" id="5845521">ResponseRecorder</span><span class="op" id="5845537">)</span>&nbsp;<span class="ident" id="5845539">WriteHeader</span><span class="op" id="5845550">(</span><span class="ident" id="5845551">code</span>&nbsp;<span class="builtintype" id="5845556">int</span><span class="op" id="5845559">)</span>&nbsp;<span class="op" id="5845561">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5845564">if</span>&nbsp;<span class="op" id="5845567">!</span><span class="ident" id="5845568">rw</span><span class="op" id="5845570">.</span><span class="ident" id="5845571">wroteHeader</span>&nbsp;<span class="op" id="5845583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5845587">rw</span><span class="op" id="5845589">.</span><span class="ident" id="5845590">Code</span>&nbsp;<span class="op" id="5845595">=</span>&nbsp;<span class="ident" id="5845597">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5845603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5845606">rw</span><span class="op" id="5845608">.</span><span class="ident" id="5845609">wroteHeader</span>&nbsp;<span class="op" id="5845621">=</span>&nbsp;<span class="builtintype" id="5845623">true</span><br>
<span class="lineno"></span><span class="op" id="5845628">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="5845631">//&nbsp;Flush&nbsp;sets&nbsp;rw.Flushed&nbsp;to&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="5845665">func</span>&nbsp;<span class="op" id="5845670">(</span><span class="ident" id="5845671">rw</span>&nbsp;<span class="op" id="5845674">*</span><span class="ident" id="5845675">ResponseRecorder</span><span class="op" id="5845691">)</span>&nbsp;<span class="ident" id="5845693">Flush</span><span class="op" id="5845698">(</span><span class="op" id="5845699">)</span>&nbsp;<span class="op" id="5845701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5845704">if</span>&nbsp;<span class="op" id="5845707">!</span><span class="ident" id="5845708">rw</span><span class="op" id="5845710">.</span><span class="ident" id="5845711">wroteHeader</span>&nbsp;<span class="op" id="5845723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5845727">rw</span><span class="op" id="5845729">.</span><span class="ident" id="5845730">WriteHeader</span><span class="op" id="5845741">(</span><span class="num" id="5845742">200</span><span class="op" id="5845745">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5845748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5845751">rw</span><span class="op" id="5845753">.</span><span class="ident" id="5845754">Flushed</span>&nbsp;<span class="op" id="5845762">=</span>&nbsp;<span class="builtintype" id="5845764">true</span><br>
<span class="lineno"></span><span class="op" id="5845769">}</span>
</div>
</body>
</html>
