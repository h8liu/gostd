<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6075217">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6075272">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6075326">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6075377">package</span>&nbsp;<span class="ident" id="6075385">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6075391">import</span>&nbsp;<span class="op" id="6075398">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6075401">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6075410">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6075420">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6075429">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6075444">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="6075449">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="6075452">//&nbsp;min&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;of&nbsp;two&nbsp;integers.</span><br>
<span class="lineno"></span><span class="keyword" id="6075496">func</span>&nbsp;<span class="ident" id="6075501">min</span><span class="op" id="6075504">(</span><span class="ident" id="6075505">x</span><span class="op" id="6075506">,</span>&nbsp;<span class="ident" id="6075508">y</span>&nbsp;<span class="builtintype" id="6075510">int</span><span class="op" id="6075513">)</span>&nbsp;<span class="builtintype" id="6075515">int</span>&nbsp;<span class="op" id="6075519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075522">if</span>&nbsp;<span class="ident" id="6075525">x</span>&nbsp;<span class="op" id="6075527">&lt;</span>&nbsp;<span class="ident" id="6075529">y</span>&nbsp;<span class="op" id="6075531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075535">return</span>&nbsp;<span class="ident" id="6075542">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6075545">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075548">return</span>&nbsp;<span class="ident" id="6075555">y</span><br>
<span class="lineno"></span><span class="op" id="6075557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6075560">//&nbsp;div&nbsp;returns&nbsp;a/b&nbsp;rounded&nbsp;to&nbsp;the&nbsp;nearest&nbsp;integer,&nbsp;instead&nbsp;of&nbsp;rounded&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span><span class="keyword" id="6075639">func</span>&nbsp;<span class="ident" id="6075644">div</span><span class="op" id="6075647">(</span><span class="ident" id="6075648">a</span><span class="op" id="6075649">,</span>&nbsp;<span class="ident" id="6075651">b</span>&nbsp;<span class="builtintype" id="6075653">int32</span><span class="op" id="6075658">)</span>&nbsp;<span class="builtintype" id="6075660">int32</span>&nbsp;<span class="op" id="6075666">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075669">if</span>&nbsp;<span class="ident" id="6075672">a</span>&nbsp;<span class="op" id="6075674">&gt;=</span>&nbsp;<span class="num" id="6075677">0</span>&nbsp;<span class="op" id="6075679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075683">return</span>&nbsp;<span class="op" id="6075690">(</span><span class="ident" id="6075691">a</span>&nbsp;<span class="op" id="6075693">+</span>&nbsp;<span class="op" id="6075695">(</span><span class="ident" id="6075696">b</span>&nbsp;<span class="op" id="6075698">&gt;&gt;</span>&nbsp;<span class="num" id="6075701">1</span><span class="op" id="6075702">)</span><span class="op" id="6075703">)</span>&nbsp;<span class="op" id="6075705">/</span>&nbsp;<span class="ident" id="6075707">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6075710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075713">return</span>&nbsp;<span class="op" id="6075720">-</span><span class="op" id="6075721">(</span><span class="op" id="6075722">(</span><span class="op" id="6075723">-</span><span class="ident" id="6075724">a</span>&nbsp;<span class="op" id="6075726">+</span>&nbsp;<span class="op" id="6075728">(</span><span class="ident" id="6075729">b</span>&nbsp;<span class="op" id="6075731">&gt;&gt;</span>&nbsp;<span class="num" id="6075734">1</span><span class="op" id="6075735">)</span><span class="op" id="6075736">)</span>&nbsp;<span class="op" id="6075738">/</span>&nbsp;<span class="ident" id="6075740">b</span><span class="op" id="6075741">)</span><br>
<span class="lineno"></span><span class="op" id="6075743">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="6075746">//&nbsp;bitCount&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;bits&nbsp;needed&nbsp;to&nbsp;hold&nbsp;an&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="6075811">var</span>&nbsp;<span class="ident" id="6075815">bitCount</span>&nbsp;<span class="op" id="6075824">=</span>&nbsp;<span class="op" id="6075826">[</span><span class="num" id="6075827">256</span><span class="op" id="6075830">]</span><span class="builtintype" id="6075831">byte</span><span class="op" id="6075835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6075838">0</span><span class="op" id="6075839">,</span>&nbsp;<span class="num" id="6075841">1</span><span class="op" id="6075842">,</span>&nbsp;<span class="num" id="6075844">2</span><span class="op" id="6075845">,</span>&nbsp;<span class="num" id="6075847">2</span><span class="op" id="6075848">,</span>&nbsp;<span class="num" id="6075850">3</span><span class="op" id="6075851">,</span>&nbsp;<span class="num" id="6075853">3</span><span class="op" id="6075854">,</span>&nbsp;<span class="num" id="6075856">3</span><span class="op" id="6075857">,</span>&nbsp;<span class="num" id="6075859">3</span><span class="op" id="6075860">,</span>&nbsp;<span class="num" id="6075862">4</span><span class="op" id="6075863">,</span>&nbsp;<span class="num" id="6075865">4</span><span class="op" id="6075866">,</span>&nbsp;<span class="num" id="6075868">4</span><span class="op" id="6075869">,</span>&nbsp;<span class="num" id="6075871">4</span><span class="op" id="6075872">,</span>&nbsp;<span class="num" id="6075874">4</span><span class="op" id="6075875">,</span>&nbsp;<span class="num" id="6075877">4</span><span class="op" id="6075878">,</span>&nbsp;<span class="num" id="6075880">4</span><span class="op" id="6075881">,</span>&nbsp;<span class="num" id="6075883">4</span><span class="op" id="6075884">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6075887">5</span><span class="op" id="6075888">,</span>&nbsp;<span class="num" id="6075890">5</span><span class="op" id="6075891">,</span>&nbsp;<span class="num" id="6075893">5</span><span class="op" id="6075894">,</span>&nbsp;<span class="num" id="6075896">5</span><span class="op" id="6075897">,</span>&nbsp;<span class="num" id="6075899">5</span><span class="op" id="6075900">,</span>&nbsp;<span class="num" id="6075902">5</span><span class="op" id="6075903">,</span>&nbsp;<span class="num" id="6075905">5</span><span class="op" id="6075906">,</span>&nbsp;<span class="num" id="6075908">5</span><span class="op" id="6075909">,</span>&nbsp;<span class="num" id="6075911">5</span><span class="op" id="6075912">,</span>&nbsp;<span class="num" id="6075914">5</span><span class="op" id="6075915">,</span>&nbsp;<span class="num" id="6075917">5</span><span class="op" id="6075918">,</span>&nbsp;<span class="num" id="6075920">5</span><span class="op" id="6075921">,</span>&nbsp;<span class="num" id="6075923">5</span><span class="op" id="6075924">,</span>&nbsp;<span class="num" id="6075926">5</span><span class="op" id="6075927">,</span>&nbsp;<span class="num" id="6075929">5</span><span class="op" id="6075930">,</span>&nbsp;<span class="num" id="6075932">5</span><span class="op" id="6075933">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6075936">6</span><span class="op" id="6075937">,</span>&nbsp;<span class="num" id="6075939">6</span><span class="op" id="6075940">,</span>&nbsp;<span class="num" id="6075942">6</span><span class="op" id="6075943">,</span>&nbsp;<span class="num" id="6075945">6</span><span class="op" id="6075946">,</span>&nbsp;<span class="num" id="6075948">6</span><span class="op" id="6075949">,</span>&nbsp;<span class="num" id="6075951">6</span><span class="op" id="6075952">,</span>&nbsp;<span class="num" id="6075954">6</span><span class="op" id="6075955">,</span>&nbsp;<span class="num" id="6075957">6</span><span class="op" id="6075958">,</span>&nbsp;<span class="num" id="6075960">6</span><span class="op" id="6075961">,</span>&nbsp;<span class="num" id="6075963">6</span><span class="op" id="6075964">,</span>&nbsp;<span class="num" id="6075966">6</span><span class="op" id="6075967">,</span>&nbsp;<span class="num" id="6075969">6</span><span class="op" id="6075970">,</span>&nbsp;<span class="num" id="6075972">6</span><span class="op" id="6075973">,</span>&nbsp;<span class="num" id="6075975">6</span><span class="op" id="6075976">,</span>&nbsp;<span class="num" id="6075978">6</span><span class="op" id="6075979">,</span>&nbsp;<span class="num" id="6075981">6</span><span class="op" id="6075982">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6075985">6</span><span class="op" id="6075986">,</span>&nbsp;<span class="num" id="6075988">6</span><span class="op" id="6075989">,</span>&nbsp;<span class="num" id="6075991">6</span><span class="op" id="6075992">,</span>&nbsp;<span class="num" id="6075994">6</span><span class="op" id="6075995">,</span>&nbsp;<span class="num" id="6075997">6</span><span class="op" id="6075998">,</span>&nbsp;<span class="num" id="6076000">6</span><span class="op" id="6076001">,</span>&nbsp;<span class="num" id="6076003">6</span><span class="op" id="6076004">,</span>&nbsp;<span class="num" id="6076006">6</span><span class="op" id="6076007">,</span>&nbsp;<span class="num" id="6076009">6</span><span class="op" id="6076010">,</span>&nbsp;<span class="num" id="6076012">6</span><span class="op" id="6076013">,</span>&nbsp;<span class="num" id="6076015">6</span><span class="op" id="6076016">,</span>&nbsp;<span class="num" id="6076018">6</span><span class="op" id="6076019">,</span>&nbsp;<span class="num" id="6076021">6</span><span class="op" id="6076022">,</span>&nbsp;<span class="num" id="6076024">6</span><span class="op" id="6076025">,</span>&nbsp;<span class="num" id="6076027">6</span><span class="op" id="6076028">,</span>&nbsp;<span class="num" id="6076030">6</span><span class="op" id="6076031">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6076034">7</span><span class="op" id="6076035">,</span>&nbsp;<span class="num" id="6076037">7</span><span class="op" id="6076038">,</span>&nbsp;<span class="num" id="6076040">7</span><span class="op" id="6076041">,</span>&nbsp;<span class="num" id="6076043">7</span><span class="op" id="6076044">,</span>&nbsp;<span class="num" id="6076046">7</span><span class="op" id="6076047">,</span>&nbsp;<span class="num" id="6076049">7</span><span class="op" id="6076050">,</span>&nbsp;<span class="num" id="6076052">7</span><span class="op" id="6076053">,</span>&nbsp;<span class="num" id="6076055">7</span><span class="op" id="6076056">,</span>&nbsp;<span class="num" id="6076058">7</span><span class="op" id="6076059">,</span>&nbsp;<span class="num" id="6076061">7</span><span class="op" id="6076062">,</span>&nbsp;<span class="num" id="6076064">7</span><span class="op" id="6076065">,</span>&nbsp;<span class="num" id="6076067">7</span><span class="op" id="6076068">,</span>&nbsp;<span class="num" id="6076070">7</span><span class="op" id="6076071">,</span>&nbsp;<span class="num" id="6076073">7</span><span class="op" id="6076074">,</span>&nbsp;<span class="num" id="6076076">7</span><span class="op" id="6076077">,</span>&nbsp;<span class="num" id="6076079">7</span><span class="op" id="6076080">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6076083">7</span><span class="op" id="6076084">,</span>&nbsp;<span class="num" id="6076086">7</span><span class="op" id="6076087">,</span>&nbsp;<span class="num" id="6076089">7</span><span class="op" id="6076090">,</span>&nbsp;<span class="num" id="6076092">7</span><span class="op" id="6076093">,</span>&nbsp;<span class="num" id="6076095">7</span><span class="op" id="6076096">,</span>&nbsp;<span class="num" id="6076098">7</span><span class="op" id="6076099">,</span>&nbsp;<span class="num" id="6076101">7</span><span class="op" id="6076102">,</span>&nbsp;<span class="num" id="6076104">7</span><span class="op" id="6076105">,</span>&nbsp;<span class="num" id="6076107">7</span><span class="op" id="6076108">,</span>&nbsp;<span class="num" id="6076110">7</span><span class="op" id="6076111">,</span>&nbsp;<span class="num" id="6076113">7</span><span class="op" id="6076114">,</span>&nbsp;<span class="num" id="6076116">7</span><span class="op" id="6076117">,</span>&nbsp;<span class="num" id="6076119">7</span><span class="op" id="6076120">,</span>&nbsp;<span class="num" id="6076122">7</span><span class="op" id="6076123">,</span>&nbsp;<span class="num" id="6076125">7</span><span class="op" id="6076126">,</span>&nbsp;<span class="num" id="6076128">7</span><span class="op" id="6076129">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6076132">7</span><span class="op" id="6076133">,</span>&nbsp;<span class="num" id="6076135">7</span><span class="op" id="6076136">,</span>&nbsp;<span class="num" id="6076138">7</span><span class="op" id="6076139">,</span>&nbsp;<span class="num" id="6076141">7</span><span class="op" id="6076142">,</span>&nbsp;<span class="num" id="6076144">7</span><span class="op" id="6076145">,</span>&nbsp;<span class="num" id="6076147">7</span><span class="op" id="6076148">,</span>&nbsp;<span class="num" id="6076150">7</span><span class="op" id="6076151">,</span>&nbsp;<span class="num" id="6076153">7</span><span class="op" id="6076154">,</span>&nbsp;<span class="num" id="6076156">7</span><span class="op" id="6076157">,</span>&nbsp;<span class="num" id="6076159">7</span><span class="op" id="6076160">,</span>&nbsp;<span class="num" id="6076162">7</span><span class="op" id="6076163">,</span>&nbsp;<span class="num" id="6076165">7</span><span class="op" id="6076166">,</span>&nbsp;<span class="num" id="6076168">7</span><span class="op" id="6076169">,</span>&nbsp;<span class="num" id="6076171">7</span><span class="op" id="6076172">,</span>&nbsp;<span class="num" id="6076174">7</span><span class="op" id="6076175">,</span>&nbsp;<span class="num" id="6076177">7</span><span class="op" id="6076178">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6076181">7</span><span class="op" id="6076182">,</span>&nbsp;<span class="num" id="6076184">7</span><span class="op" id="6076185">,</span>&nbsp;<span class="num" id="6076187">7</span><span class="op" id="6076188">,</span>&nbsp;<span class="num" id="6076190">7</span><span class="op" id="6076191">,</span>&nbsp;<span class="num" id="6076193">7</span><span class="op" id="6076194">,</span>&nbsp;<span class="num" id="6076196">7</span><span class="op" id="6076197">,</span>&nbsp;<span class="num" id="6076199">7</span><span class="op" id="6076200">,</span>&nbsp;<span class="num" id="6076202">7</span><span class="op" id="6076203">,</span>&nbsp;<span class="num" id="6076205">7</span><span class="op" id="6076206">,</span>&nbsp;<span class="num" id="6076208">7</span><span class="op" id="6076209">,</span>&nbsp;<span class="num" id="6076211">7</span><span class="op" id="6076212">,</span>&nbsp;<span class="num" id="6076214">7</span><span class="op" id="6076215">,</span>&nbsp;<span class="num" id="6076217">7</span><span class="op" id="6076218">,</span>&nbsp;<span class="num" id="6076220">7</span><span class="op" id="6076221">,</span>&nbsp;<span class="num" id="6076223">7</span><span class="op" id="6076224">,</span>&nbsp;<span class="num" id="6076226">7</span><span class="op" id="6076227">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6076230">8</span><span class="op" id="6076231">,</span>&nbsp;<span class="num" id="6076233">8</span><span class="op" id="6076234">,</span>&nbsp;<span class="num" id="6076236">8</span><span class="op" id="6076237">,</span>&nbsp;<span class="num" id="6076239">8</span><span class="op" id="6076240">,</span>&nbsp;<span class="num" id="6076242">8</span><span class="op" id="6076243">,</span>&nbsp;<span class="num" id="6076245">8</span><span class="op" id="6076246">,</span>&nbsp;<span class="num" id="6076248">8</span><span class="op" id="6076249">,</span>&nbsp;<span class="num" id="6076251">8</span><span class="op" id="6076252">,</span>&nbsp;<span class="num" id="6076254">8</span><span class="op" id="6076255">,</span>&nbsp;<span class="num" id="6076257">8</span><span class="op" id="6076258">,</span>&nbsp;<span class="num" id="6076260">8</span><span class="op" id="6076261">,</span>&nbsp;<span class="num" id="6076263">8</span><span class="op" id="6076264">,</span>&nbsp;<span class="num" id="6076266">8</span><span class="op" id="6076267">,</span>&nbsp;<span class="num" id="6076269">8</span><span class="op" id="6076270">,</span>&nbsp;<span class="num" id="6076272">8</span><span class="op" id="6076273">,</span>&nbsp;<span class="num" id="6076275">8</span><span class="op" id="6076276">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6076279">8</span><span class="op" id="6076280">,</span>&nbsp;<span class="num" id="6076282">8</span><span class="op" id="6076283">,</span>&nbsp;<span class="num" id="6076285">8</span><span class="op" id="6076286">,</span>&nbsp;<span class="num" id="6076288">8</span><span class="op" id="6076289">,</span>&nbsp;<span class="num" id="6076291">8</span><span class="op" id="6076292">,</span>&nbsp;<span class="num" id="6076294">8</span><span class="op" id="6076295">,</span>&nbsp;<span class="num" id="6076297">8</span><span class="op" id="6076298">,</span>&nbsp;<span class="num" id="6076300">8</span><span class="op" id="6076301">,</span>&nbsp;<span class="num" id="6076303">8</span><span class="op" id="6076304">,</span>&nbsp;<span class="num" id="6076306">8</span><span class="op" id="6076307">,</span>&nbsp;<span class="num" id="6076309">8</span><span class="op" id="6076310">,</span>&nbsp;<span class="num" id="6076312">8</span><span class="op" id="6076313">,</span>&nbsp;<span class="num" id="6076315">8</span><span class="op" id="6076316">,</span>&nbsp;<span class="num" id="6076318">8</span><span class="op" id="6076319">,</span>&nbsp;<span class="num" id="6076321">8</span><span class="op" id="6076322">,</span>&nbsp;<span class="num" id="6076324">8</span><span class="op" id="6076325">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6076328">8</span><span class="op" id="6076329">,</span>&nbsp;<span class="num" id="6076331">8</span><span class="op" id="6076332">,</span>&nbsp;<span class="num" id="6076334">8</span><span class="op" id="6076335">,</span>&nbsp;<span class="num" id="6076337">8</span><span class="op" id="6076338">,</span>&nbsp;<span class="num" id="6076340">8</span><span class="op" id="6076341">,</span>&nbsp;<span class="num" id="6076343">8</span><span class="op" id="6076344">,</span>&nbsp;<span class="num" id="6076346">8</span><span class="op" id="6076347">,</span>&nbsp;<span class="num" id="6076349">8</span><span class="op" id="6076350">,</span>&nbsp;<span class="num" id="6076352">8</span><span class="op" id="6076353">,</span>&nbsp;<span class="num" id="6076355">8</span><span class="op" id="6076356">,</span>&nbsp;<span class="num" id="6076358">8</span><span class="op" id="6076359">,</span>&nbsp;<span class="num" id="6076361">8</span><span class="op" id="6076362">,</span>&nbsp;<span class="num" id="6076364">8</span><span class="op" id="6076365">,</span>&nbsp;<span class="num" id="6076367">8</span><span class="op" id="6076368">,</span>&nbsp;<span class="num" id="6076370">8</span><span class="op" id="6076371">,</span>&nbsp;<span class="num" id="6076373">8</span><span class="op" id="6076374">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6076377">8</span><span class="op" id="6076378">,</span>&nbsp;<span class="num" id="6076380">8</span><span class="op" id="6076381">,</span>&nbsp;<span class="num" id="6076383">8</span><span class="op" id="6076384">,</span>&nbsp;<span class="num" id="6076386">8</span><span class="op" id="6076387">,</span>&nbsp;<span class="num" id="6076389">8</span><span class="op" id="6076390">,</span>&nbsp;<span class="num" id="6076392">8</span><span class="op" id="6076393">,</span>&nbsp;<span class="num" id="6076395">8</span><span class="op" id="6076396">,</span>&nbsp;<span class="num" id="6076398">8</span><span class="op" id="6076399">,</span>&nbsp;<span class="num" id="6076401">8</span><span class="op" id="6076402">,</span>&nbsp;<span class="num" id="6076404">8</span><span class="op" id="6076405">,</span>&nbsp;<span class="num" id="6076407">8</span><span class="op" id="6076408">,</span>&nbsp;<span class="num" id="6076410">8</span><span class="op" id="6076411">,</span>&nbsp;<span class="num" id="6076413">8</span><span class="op" id="6076414">,</span>&nbsp;<span class="num" id="6076416">8</span><span class="op" id="6076417">,</span>&nbsp;<span class="num" id="6076419">8</span><span class="op" id="6076420">,</span>&nbsp;<span class="num" id="6076422">8</span><span class="op" id="6076423">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6076426">8</span><span class="op" id="6076427">,</span>&nbsp;<span class="num" id="6076429">8</span><span class="op" id="6076430">,</span>&nbsp;<span class="num" id="6076432">8</span><span class="op" id="6076433">,</span>&nbsp;<span class="num" id="6076435">8</span><span class="op" id="6076436">,</span>&nbsp;<span class="num" id="6076438">8</span><span class="op" id="6076439">,</span>&nbsp;<span class="num" id="6076441">8</span><span class="op" id="6076442">,</span>&nbsp;<span class="num" id="6076444">8</span><span class="op" id="6076445">,</span>&nbsp;<span class="num" id="6076447">8</span><span class="op" id="6076448">,</span>&nbsp;<span class="num" id="6076450">8</span><span class="op" id="6076451">,</span>&nbsp;<span class="num" id="6076453">8</span><span class="op" id="6076454">,</span>&nbsp;<span class="num" id="6076456">8</span><span class="op" id="6076457">,</span>&nbsp;<span class="num" id="6076459">8</span><span class="op" id="6076460">,</span>&nbsp;<span class="num" id="6076462">8</span><span class="op" id="6076463">,</span>&nbsp;<span class="num" id="6076465">8</span><span class="op" id="6076466">,</span>&nbsp;<span class="num" id="6076468">8</span><span class="op" id="6076469">,</span>&nbsp;<span class="num" id="6076471">8</span><span class="op" id="6076472">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6076475">8</span><span class="op" id="6076476">,</span>&nbsp;<span class="num" id="6076478">8</span><span class="op" id="6076479">,</span>&nbsp;<span class="num" id="6076481">8</span><span class="op" id="6076482">,</span>&nbsp;<span class="num" id="6076484">8</span><span class="op" id="6076485">,</span>&nbsp;<span class="num" id="6076487">8</span><span class="op" id="6076488">,</span>&nbsp;<span class="num" id="6076490">8</span><span class="op" id="6076491">,</span>&nbsp;<span class="num" id="6076493">8</span><span class="op" id="6076494">,</span>&nbsp;<span class="num" id="6076496">8</span><span class="op" id="6076497">,</span>&nbsp;<span class="num" id="6076499">8</span><span class="op" id="6076500">,</span>&nbsp;<span class="num" id="6076502">8</span><span class="op" id="6076503">,</span>&nbsp;<span class="num" id="6076505">8</span><span class="op" id="6076506">,</span>&nbsp;<span class="num" id="6076508">8</span><span class="op" id="6076509">,</span>&nbsp;<span class="num" id="6076511">8</span><span class="op" id="6076512">,</span>&nbsp;<span class="num" id="6076514">8</span><span class="op" id="6076515">,</span>&nbsp;<span class="num" id="6076517">8</span><span class="op" id="6076518">,</span>&nbsp;<span class="num" id="6076520">8</span><span class="op" id="6076521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6076524">8</span><span class="op" id="6076525">,</span>&nbsp;<span class="num" id="6076527">8</span><span class="op" id="6076528">,</span>&nbsp;<span class="num" id="6076530">8</span><span class="op" id="6076531">,</span>&nbsp;<span class="num" id="6076533">8</span><span class="op" id="6076534">,</span>&nbsp;<span class="num" id="6076536">8</span><span class="op" id="6076537">,</span>&nbsp;<span class="num" id="6076539">8</span><span class="op" id="6076540">,</span>&nbsp;<span class="num" id="6076542">8</span><span class="op" id="6076543">,</span>&nbsp;<span class="num" id="6076545">8</span><span class="op" id="6076546">,</span>&nbsp;<span class="num" id="6076548">8</span><span class="op" id="6076549">,</span>&nbsp;<span class="num" id="6076551">8</span><span class="op" id="6076552">,</span>&nbsp;<span class="num" id="6076554">8</span><span class="op" id="6076555">,</span>&nbsp;<span class="num" id="6076557">8</span><span class="op" id="6076558">,</span>&nbsp;<span class="num" id="6076560">8</span><span class="op" id="6076561">,</span>&nbsp;<span class="num" id="6076563">8</span><span class="op" id="6076564">,</span>&nbsp;<span class="num" id="6076566">8</span><span class="op" id="6076567">,</span>&nbsp;<span class="num" id="6076569">8</span><span class="op" id="6076570">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6076573">8</span><span class="op" id="6076574">,</span>&nbsp;<span class="num" id="6076576">8</span><span class="op" id="6076577">,</span>&nbsp;<span class="num" id="6076579">8</span><span class="op" id="6076580">,</span>&nbsp;<span class="num" id="6076582">8</span><span class="op" id="6076583">,</span>&nbsp;<span class="num" id="6076585">8</span><span class="op" id="6076586">,</span>&nbsp;<span class="num" id="6076588">8</span><span class="op" id="6076589">,</span>&nbsp;<span class="num" id="6076591">8</span><span class="op" id="6076592">,</span>&nbsp;<span class="num" id="6076594">8</span><span class="op" id="6076595">,</span>&nbsp;<span class="num" id="6076597">8</span><span class="op" id="6076598">,</span>&nbsp;<span class="num" id="6076600">8</span><span class="op" id="6076601">,</span>&nbsp;<span class="num" id="6076603">8</span><span class="op" id="6076604">,</span>&nbsp;<span class="num" id="6076606">8</span><span class="op" id="6076607">,</span>&nbsp;<span class="num" id="6076609">8</span><span class="op" id="6076610">,</span>&nbsp;<span class="num" id="6076612">8</span><span class="op" id="6076613">,</span>&nbsp;<span class="num" id="6076615">8</span><span class="op" id="6076616">,</span>&nbsp;<span class="num" id="6076618">8</span><span class="op" id="6076619">,</span><br>
<span class="lineno"></span><span class="op" id="6076621">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="6076624">type</span>&nbsp;<span class="ident" id="6076629">quantIndex</span>&nbsp;<span class="builtintype" id="6076640">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6076645">const</span>&nbsp;<span class="op" id="6076651">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076654">quantIndexLuminance</span>&nbsp;<span class="ident" id="6076674">quantIndex</span>&nbsp;<span class="op" id="6076685">=</span>&nbsp;<span class="ident" id="6076687">iota</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076693">quantIndexChrominance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076716">nQuantIndex</span><br>
<span class="lineno"></span><span class="op" id="6076728">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6076731">//&nbsp;unscaledQuant&nbsp;are&nbsp;the&nbsp;unscaled&nbsp;quantization&nbsp;tables&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;Each</span><br>
<span class="lineno">60</span><span class="comment" id="6076808">//&nbsp;encoder&nbsp;copies&nbsp;and&nbsp;scales&nbsp;the&nbsp;tables&nbsp;according&nbsp;to&nbsp;its&nbsp;quality&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="6076884">//&nbsp;The&nbsp;values&nbsp;are&nbsp;derived&nbsp;from&nbsp;section&nbsp;K.1&nbsp;after&nbsp;converting&nbsp;from&nbsp;natural&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6076960">//&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="6076978">var</span>&nbsp;<span class="ident" id="6076982">unscaledQuant</span>&nbsp;<span class="op" id="6076996">=</span>&nbsp;<span class="op" id="6076998">[</span><span class="ident" id="6076999">nQuantIndex</span><span class="op" id="6077010">]</span><span class="op" id="6077011">[</span><span class="ident" id="6077012">blockSize</span><span class="op" id="6077021">]</span><span class="builtintype" id="6077022">byte</span><span class="op" id="6077026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6077029">//&nbsp;Luminance.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6077044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6077048">16</span><span class="op" id="6077050">,</span>&nbsp;<span class="num" id="6077052">11</span><span class="op" id="6077054">,</span>&nbsp;<span class="num" id="6077056">12</span><span class="op" id="6077058">,</span>&nbsp;<span class="num" id="6077060">14</span><span class="op" id="6077062">,</span>&nbsp;<span class="num" id="6077064">12</span><span class="op" id="6077066">,</span>&nbsp;<span class="num" id="6077068">10</span><span class="op" id="6077070">,</span>&nbsp;<span class="num" id="6077072">16</span><span class="op" id="6077074">,</span>&nbsp;<span class="num" id="6077076">14</span><span class="op" id="6077078">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6077082">13</span><span class="op" id="6077084">,</span>&nbsp;<span class="num" id="6077086">14</span><span class="op" id="6077088">,</span>&nbsp;<span class="num" id="6077090">18</span><span class="op" id="6077092">,</span>&nbsp;<span class="num" id="6077094">17</span><span class="op" id="6077096">,</span>&nbsp;<span class="num" id="6077098">16</span><span class="op" id="6077100">,</span>&nbsp;<span class="num" id="6077102">19</span><span class="op" id="6077104">,</span>&nbsp;<span class="num" id="6077106">24</span><span class="op" id="6077108">,</span>&nbsp;<span class="num" id="6077110">40</span><span class="op" id="6077112">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6077116">26</span><span class="op" id="6077118">,</span>&nbsp;<span class="num" id="6077120">24</span><span class="op" id="6077122">,</span>&nbsp;<span class="num" id="6077124">22</span><span class="op" id="6077126">,</span>&nbsp;<span class="num" id="6077128">22</span><span class="op" id="6077130">,</span>&nbsp;<span class="num" id="6077132">24</span><span class="op" id="6077134">,</span>&nbsp;<span class="num" id="6077136">49</span><span class="op" id="6077138">,</span>&nbsp;<span class="num" id="6077140">35</span><span class="op" id="6077142">,</span>&nbsp;<span class="num" id="6077144">37</span><span class="op" id="6077146">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6077150">29</span><span class="op" id="6077152">,</span>&nbsp;<span class="num" id="6077154">40</span><span class="op" id="6077156">,</span>&nbsp;<span class="num" id="6077158">58</span><span class="op" id="6077160">,</span>&nbsp;<span class="num" id="6077162">51</span><span class="op" id="6077164">,</span>&nbsp;<span class="num" id="6077166">61</span><span class="op" id="6077168">,</span>&nbsp;<span class="num" id="6077170">60</span><span class="op" id="6077172">,</span>&nbsp;<span class="num" id="6077174">57</span><span class="op" id="6077176">,</span>&nbsp;<span class="num" id="6077178">51</span><span class="op" id="6077180">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6077184">56</span><span class="op" id="6077186">,</span>&nbsp;<span class="num" id="6077188">55</span><span class="op" id="6077190">,</span>&nbsp;<span class="num" id="6077192">64</span><span class="op" id="6077194">,</span>&nbsp;<span class="num" id="6077196">72</span><span class="op" id="6077198">,</span>&nbsp;<span class="num" id="6077200">92</span><span class="op" id="6077202">,</span>&nbsp;<span class="num" id="6077204">78</span><span class="op" id="6077206">,</span>&nbsp;<span class="num" id="6077208">64</span><span class="op" id="6077210">,</span>&nbsp;<span class="num" id="6077212">68</span><span class="op" id="6077214">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6077218">87</span><span class="op" id="6077220">,</span>&nbsp;<span class="num" id="6077222">69</span><span class="op" id="6077224">,</span>&nbsp;<span class="num" id="6077226">55</span><span class="op" id="6077228">,</span>&nbsp;<span class="num" id="6077230">56</span><span class="op" id="6077232">,</span>&nbsp;<span class="num" id="6077234">80</span><span class="op" id="6077236">,</span>&nbsp;<span class="num" id="6077238">109</span><span class="op" id="6077241">,</span>&nbsp;<span class="num" id="6077243">81</span><span class="op" id="6077245">,</span>&nbsp;<span class="num" id="6077247">87</span><span class="op" id="6077249">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6077253">95</span><span class="op" id="6077255">,</span>&nbsp;<span class="num" id="6077257">98</span><span class="op" id="6077259">,</span>&nbsp;<span class="num" id="6077261">103</span><span class="op" id="6077264">,</span>&nbsp;<span class="num" id="6077266">104</span><span class="op" id="6077269">,</span>&nbsp;<span class="num" id="6077271">103</span><span class="op" id="6077274">,</span>&nbsp;<span class="num" id="6077276">62</span><span class="op" id="6077278">,</span>&nbsp;<span class="num" id="6077280">77</span><span class="op" id="6077282">,</span>&nbsp;<span class="num" id="6077284">113</span><span class="op" id="6077287">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6077291">121</span><span class="op" id="6077294">,</span>&nbsp;<span class="num" id="6077296">112</span><span class="op" id="6077299">,</span>&nbsp;<span class="num" id="6077301">100</span><span class="op" id="6077304">,</span>&nbsp;<span class="num" id="6077306">120</span><span class="op" id="6077309">,</span>&nbsp;<span class="num" id="6077311">92</span><span class="op" id="6077313">,</span>&nbsp;<span class="num" id="6077315">101</span><span class="op" id="6077318">,</span>&nbsp;<span class="num" id="6077320">103</span><span class="op" id="6077323">,</span>&nbsp;<span class="num" id="6077325">99</span><span class="op" id="6077327">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6077330">}</span><span class="op" id="6077331">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6077334">//&nbsp;Chrominance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6077351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6077355">17</span><span class="op" id="6077357">,</span>&nbsp;<span class="num" id="6077359">18</span><span class="op" id="6077361">,</span>&nbsp;<span class="num" id="6077363">18</span><span class="op" id="6077365">,</span>&nbsp;<span class="num" id="6077367">24</span><span class="op" id="6077369">,</span>&nbsp;<span class="num" id="6077371">21</span><span class="op" id="6077373">,</span>&nbsp;<span class="num" id="6077375">24</span><span class="op" id="6077377">,</span>&nbsp;<span class="num" id="6077379">47</span><span class="op" id="6077381">,</span>&nbsp;<span class="num" id="6077383">26</span><span class="op" id="6077385">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6077389">26</span><span class="op" id="6077391">,</span>&nbsp;<span class="num" id="6077393">47</span><span class="op" id="6077395">,</span>&nbsp;<span class="num" id="6077397">99</span><span class="op" id="6077399">,</span>&nbsp;<span class="num" id="6077401">66</span><span class="op" id="6077403">,</span>&nbsp;<span class="num" id="6077405">56</span><span class="op" id="6077407">,</span>&nbsp;<span class="num" id="6077409">66</span><span class="op" id="6077411">,</span>&nbsp;<span class="num" id="6077413">99</span><span class="op" id="6077415">,</span>&nbsp;<span class="num" id="6077417">99</span><span class="op" id="6077419">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6077423">99</span><span class="op" id="6077425">,</span>&nbsp;<span class="num" id="6077427">99</span><span class="op" id="6077429">,</span>&nbsp;<span class="num" id="6077431">99</span><span class="op" id="6077433">,</span>&nbsp;<span class="num" id="6077435">99</span><span class="op" id="6077437">,</span>&nbsp;<span class="num" id="6077439">99</span><span class="op" id="6077441">,</span>&nbsp;<span class="num" id="6077443">99</span><span class="op" id="6077445">,</span>&nbsp;<span class="num" id="6077447">99</span><span class="op" id="6077449">,</span>&nbsp;<span class="num" id="6077451">99</span><span class="op" id="6077453">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6077457">99</span><span class="op" id="6077459">,</span>&nbsp;<span class="num" id="6077461">99</span><span class="op" id="6077463">,</span>&nbsp;<span class="num" id="6077465">99</span><span class="op" id="6077467">,</span>&nbsp;<span class="num" id="6077469">99</span><span class="op" id="6077471">,</span>&nbsp;<span class="num" id="6077473">99</span><span class="op" id="6077475">,</span>&nbsp;<span class="num" id="6077477">99</span><span class="op" id="6077479">,</span>&nbsp;<span class="num" id="6077481">99</span><span class="op" id="6077483">,</span>&nbsp;<span class="num" id="6077485">99</span><span class="op" id="6077487">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6077491">99</span><span class="op" id="6077493">,</span>&nbsp;<span class="num" id="6077495">99</span><span class="op" id="6077497">,</span>&nbsp;<span class="num" id="6077499">99</span><span class="op" id="6077501">,</span>&nbsp;<span class="num" id="6077503">99</span><span class="op" id="6077505">,</span>&nbsp;<span class="num" id="6077507">99</span><span class="op" id="6077509">,</span>&nbsp;<span class="num" id="6077511">99</span><span class="op" id="6077513">,</span>&nbsp;<span class="num" id="6077515">99</span><span class="op" id="6077517">,</span>&nbsp;<span class="num" id="6077519">99</span><span class="op" id="6077521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6077525">99</span><span class="op" id="6077527">,</span>&nbsp;<span class="num" id="6077529">99</span><span class="op" id="6077531">,</span>&nbsp;<span class="num" id="6077533">99</span><span class="op" id="6077535">,</span>&nbsp;<span class="num" id="6077537">99</span><span class="op" id="6077539">,</span>&nbsp;<span class="num" id="6077541">99</span><span class="op" id="6077543">,</span>&nbsp;<span class="num" id="6077545">99</span><span class="op" id="6077547">,</span>&nbsp;<span class="num" id="6077549">99</span><span class="op" id="6077551">,</span>&nbsp;<span class="num" id="6077553">99</span><span class="op" id="6077555">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6077559">99</span><span class="op" id="6077561">,</span>&nbsp;<span class="num" id="6077563">99</span><span class="op" id="6077565">,</span>&nbsp;<span class="num" id="6077567">99</span><span class="op" id="6077569">,</span>&nbsp;<span class="num" id="6077571">99</span><span class="op" id="6077573">,</span>&nbsp;<span class="num" id="6077575">99</span><span class="op" id="6077577">,</span>&nbsp;<span class="num" id="6077579">99</span><span class="op" id="6077581">,</span>&nbsp;<span class="num" id="6077583">99</span><span class="op" id="6077585">,</span>&nbsp;<span class="num" id="6077587">99</span><span class="op" id="6077589">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6077593">99</span><span class="op" id="6077595">,</span>&nbsp;<span class="num" id="6077597">99</span><span class="op" id="6077599">,</span>&nbsp;<span class="num" id="6077601">99</span><span class="op" id="6077603">,</span>&nbsp;<span class="num" id="6077605">99</span><span class="op" id="6077607">,</span>&nbsp;<span class="num" id="6077609">99</span><span class="op" id="6077611">,</span>&nbsp;<span class="num" id="6077613">99</span><span class="op" id="6077615">,</span>&nbsp;<span class="num" id="6077617">99</span><span class="op" id="6077619">,</span>&nbsp;<span class="num" id="6077621">99</span><span class="op" id="6077623">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6077626">}</span><span class="op" id="6077627">,</span><br>
<span class="lineno"></span><span class="op" id="6077629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6077632">type</span>&nbsp;<span class="ident" id="6077637">huffIndex</span>&nbsp;<span class="builtintype" id="6077647">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="6077652">const</span>&nbsp;<span class="op" id="6077658">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077661">huffIndexLuminanceDC</span>&nbsp;<span class="ident" id="6077682">huffIndex</span>&nbsp;<span class="op" id="6077692">=</span>&nbsp;<span class="ident" id="6077694">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077700">huffIndexLuminanceAC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077722">huffIndexChrominanceDC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077746">huffIndexChrominanceAC</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077770">nHuffIndex</span><br>
<span class="lineno"></span><span class="op" id="6077781">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6077784">//&nbsp;huffmanSpec&nbsp;specifies&nbsp;a&nbsp;Huffman&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="6077829">type</span>&nbsp;<span class="ident" id="6077834">huffmanSpec</span>&nbsp;<span class="keyword" id="6077846">struct</span>&nbsp;<span class="op" id="6077853">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6077856">//&nbsp;count[i]&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;codes&nbsp;of&nbsp;length&nbsp;i&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077910">count</span>&nbsp;<span class="op" id="6077916">[</span><span class="num" id="6077917">16</span><span class="op" id="6077919">]</span><span class="builtintype" id="6077920">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6077926">//&nbsp;value[i]&nbsp;is&nbsp;the&nbsp;decoded&nbsp;value&nbsp;of&nbsp;the&nbsp;i&#39;th&nbsp;codeword.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077982">value</span>&nbsp;<span class="op" id="6077988">[</span><span class="op" id="6077989">]</span><span class="builtintype" id="6077990">byte</span><br>
<span class="lineno"></span><span class="op" id="6077995">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="6077998">//&nbsp;theHuffmanSpec&nbsp;is&nbsp;the&nbsp;Huffman&nbsp;encoding&nbsp;specifications.</span><br>
<span class="lineno"></span><span class="comment" id="6078056">//&nbsp;This&nbsp;encoder&nbsp;uses&nbsp;the&nbsp;same&nbsp;Huffman&nbsp;encoding&nbsp;for&nbsp;all&nbsp;images.</span><br>
<span class="lineno"></span><span class="keyword" id="6078119">var</span>&nbsp;<span class="ident" id="6078123">theHuffmanSpec</span>&nbsp;<span class="op" id="6078138">=</span>&nbsp;<span class="op" id="6078140">[</span><span class="ident" id="6078141">nHuffIndex</span><span class="op" id="6078151">]</span><span class="ident" id="6078152">huffmanSpec</span><span class="op" id="6078163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6078166">//&nbsp;Luminance&nbsp;DC.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6078184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6078188">[</span><span class="num" id="6078189">16</span><span class="op" id="6078191">]</span><span class="builtintype" id="6078192">byte</span><span class="op" id="6078196">{</span><span class="num" id="6078197">0</span><span class="op" id="6078198">,</span>&nbsp;<span class="num" id="6078200">1</span><span class="op" id="6078201">,</span>&nbsp;<span class="num" id="6078203">5</span><span class="op" id="6078204">,</span>&nbsp;<span class="num" id="6078206">1</span><span class="op" id="6078207">,</span>&nbsp;<span class="num" id="6078209">1</span><span class="op" id="6078210">,</span>&nbsp;<span class="num" id="6078212">1</span><span class="op" id="6078213">,</span>&nbsp;<span class="num" id="6078215">1</span><span class="op" id="6078216">,</span>&nbsp;<span class="num" id="6078218">1</span><span class="op" id="6078219">,</span>&nbsp;<span class="num" id="6078221">1</span><span class="op" id="6078222">,</span>&nbsp;<span class="num" id="6078224">0</span><span class="op" id="6078225">,</span>&nbsp;<span class="num" id="6078227">0</span><span class="op" id="6078228">,</span>&nbsp;<span class="num" id="6078230">0</span><span class="op" id="6078231">,</span>&nbsp;<span class="num" id="6078233">0</span><span class="op" id="6078234">,</span>&nbsp;<span class="num" id="6078236">0</span><span class="op" id="6078237">,</span>&nbsp;<span class="num" id="6078239">0</span><span class="op" id="6078240">,</span>&nbsp;<span class="num" id="6078242">0</span><span class="op" id="6078243">}</span><span class="op" id="6078244">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6078248">[</span><span class="op" id="6078249">]</span><span class="builtintype" id="6078250">byte</span><span class="op" id="6078254">{</span><span class="num" id="6078255">0</span><span class="op" id="6078256">,</span>&nbsp;<span class="num" id="6078258">1</span><span class="op" id="6078259">,</span>&nbsp;<span class="num" id="6078261">2</span><span class="op" id="6078262">,</span>&nbsp;<span class="num" id="6078264">3</span><span class="op" id="6078265">,</span>&nbsp;<span class="num" id="6078267">4</span><span class="op" id="6078268">,</span>&nbsp;<span class="num" id="6078270">5</span><span class="op" id="6078271">,</span>&nbsp;<span class="num" id="6078273">6</span><span class="op" id="6078274">,</span>&nbsp;<span class="num" id="6078276">7</span><span class="op" id="6078277">,</span>&nbsp;<span class="num" id="6078279">8</span><span class="op" id="6078280">,</span>&nbsp;<span class="num" id="6078282">9</span><span class="op" id="6078283">,</span>&nbsp;<span class="num" id="6078285">10</span><span class="op" id="6078287">,</span>&nbsp;<span class="num" id="6078289">11</span><span class="op" id="6078291">}</span><span class="op" id="6078292">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6078295">}</span><span class="op" id="6078296">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6078299">//&nbsp;Luminance&nbsp;AC.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6078317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6078321">[</span><span class="num" id="6078322">16</span><span class="op" id="6078324">]</span><span class="builtintype" id="6078325">byte</span><span class="op" id="6078329">{</span><span class="num" id="6078330">0</span><span class="op" id="6078331">,</span>&nbsp;<span class="num" id="6078333">2</span><span class="op" id="6078334">,</span>&nbsp;<span class="num" id="6078336">1</span><span class="op" id="6078337">,</span>&nbsp;<span class="num" id="6078339">3</span><span class="op" id="6078340">,</span>&nbsp;<span class="num" id="6078342">3</span><span class="op" id="6078343">,</span>&nbsp;<span class="num" id="6078345">2</span><span class="op" id="6078346">,</span>&nbsp;<span class="num" id="6078348">4</span><span class="op" id="6078349">,</span>&nbsp;<span class="num" id="6078351">3</span><span class="op" id="6078352">,</span>&nbsp;<span class="num" id="6078354">5</span><span class="op" id="6078355">,</span>&nbsp;<span class="num" id="6078357">5</span><span class="op" id="6078358">,</span>&nbsp;<span class="num" id="6078360">4</span><span class="op" id="6078361">,</span>&nbsp;<span class="num" id="6078363">4</span><span class="op" id="6078364">,</span>&nbsp;<span class="num" id="6078366">0</span><span class="op" id="6078367">,</span>&nbsp;<span class="num" id="6078369">0</span><span class="op" id="6078370">,</span>&nbsp;<span class="num" id="6078372">1</span><span class="op" id="6078373">,</span>&nbsp;<span class="num" id="6078375">125</span><span class="op" id="6078378">}</span><span class="op" id="6078379">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6078383">[</span><span class="op" id="6078384">]</span><span class="builtintype" id="6078385">byte</span><span class="op" id="6078389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6078394">0x01</span><span class="op" id="6078398">,</span>&nbsp;<span class="num" id="6078400">0x02</span><span class="op" id="6078404">,</span>&nbsp;<span class="num" id="6078406">0x03</span><span class="op" id="6078410">,</span>&nbsp;<span class="num" id="6078412">0x00</span><span class="op" id="6078416">,</span>&nbsp;<span class="num" id="6078418">0x04</span><span class="op" id="6078422">,</span>&nbsp;<span class="num" id="6078424">0x11</span><span class="op" id="6078428">,</span>&nbsp;<span class="num" id="6078430">0x05</span><span class="op" id="6078434">,</span>&nbsp;<span class="num" id="6078436">0x12</span><span class="op" id="6078440">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6078445">0x21</span><span class="op" id="6078449">,</span>&nbsp;<span class="num" id="6078451">0x31</span><span class="op" id="6078455">,</span>&nbsp;<span class="num" id="6078457">0x41</span><span class="op" id="6078461">,</span>&nbsp;<span class="num" id="6078463">0x06</span><span class="op" id="6078467">,</span>&nbsp;<span class="num" id="6078469">0x13</span><span class="op" id="6078473">,</span>&nbsp;<span class="num" id="6078475">0x51</span><span class="op" id="6078479">,</span>&nbsp;<span class="num" id="6078481">0x61</span><span class="op" id="6078485">,</span>&nbsp;<span class="num" id="6078487">0x07</span><span class="op" id="6078491">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6078496">0x22</span><span class="op" id="6078500">,</span>&nbsp;<span class="num" id="6078502">0x71</span><span class="op" id="6078506">,</span>&nbsp;<span class="num" id="6078508">0x14</span><span class="op" id="6078512">,</span>&nbsp;<span class="num" id="6078514">0x32</span><span class="op" id="6078518">,</span>&nbsp;<span class="num" id="6078520">0x81</span><span class="op" id="6078524">,</span>&nbsp;<span class="num" id="6078526">0x91</span><span class="op" id="6078530">,</span>&nbsp;<span class="num" id="6078532">0xa1</span><span class="op" id="6078536">,</span>&nbsp;<span class="num" id="6078538">0x08</span><span class="op" id="6078542">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6078547">0x23</span><span class="op" id="6078551">,</span>&nbsp;<span class="num" id="6078553">0x42</span><span class="op" id="6078557">,</span>&nbsp;<span class="num" id="6078559">0xb1</span><span class="op" id="6078563">,</span>&nbsp;<span class="num" id="6078565">0xc1</span><span class="op" id="6078569">,</span>&nbsp;<span class="num" id="6078571">0x15</span><span class="op" id="6078575">,</span>&nbsp;<span class="num" id="6078577">0x52</span><span class="op" id="6078581">,</span>&nbsp;<span class="num" id="6078583">0xd1</span><span class="op" id="6078587">,</span>&nbsp;<span class="num" id="6078589">0xf0</span><span class="op" id="6078593">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6078598">0x24</span><span class="op" id="6078602">,</span>&nbsp;<span class="num" id="6078604">0x33</span><span class="op" id="6078608">,</span>&nbsp;<span class="num" id="6078610">0x62</span><span class="op" id="6078614">,</span>&nbsp;<span class="num" id="6078616">0x72</span><span class="op" id="6078620">,</span>&nbsp;<span class="num" id="6078622">0x82</span><span class="op" id="6078626">,</span>&nbsp;<span class="num" id="6078628">0x09</span><span class="op" id="6078632">,</span>&nbsp;<span class="num" id="6078634">0x0a</span><span class="op" id="6078638">,</span>&nbsp;<span class="num" id="6078640">0x16</span><span class="op" id="6078644">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6078649">0x17</span><span class="op" id="6078653">,</span>&nbsp;<span class="num" id="6078655">0x18</span><span class="op" id="6078659">,</span>&nbsp;<span class="num" id="6078661">0x19</span><span class="op" id="6078665">,</span>&nbsp;<span class="num" id="6078667">0x1a</span><span class="op" id="6078671">,</span>&nbsp;<span class="num" id="6078673">0x25</span><span class="op" id="6078677">,</span>&nbsp;<span class="num" id="6078679">0x26</span><span class="op" id="6078683">,</span>&nbsp;<span class="num" id="6078685">0x27</span><span class="op" id="6078689">,</span>&nbsp;<span class="num" id="6078691">0x28</span><span class="op" id="6078695">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6078700">0x29</span><span class="op" id="6078704">,</span>&nbsp;<span class="num" id="6078706">0x2a</span><span class="op" id="6078710">,</span>&nbsp;<span class="num" id="6078712">0x34</span><span class="op" id="6078716">,</span>&nbsp;<span class="num" id="6078718">0x35</span><span class="op" id="6078722">,</span>&nbsp;<span class="num" id="6078724">0x36</span><span class="op" id="6078728">,</span>&nbsp;<span class="num" id="6078730">0x37</span><span class="op" id="6078734">,</span>&nbsp;<span class="num" id="6078736">0x38</span><span class="op" id="6078740">,</span>&nbsp;<span class="num" id="6078742">0x39</span><span class="op" id="6078746">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6078751">0x3a</span><span class="op" id="6078755">,</span>&nbsp;<span class="num" id="6078757">0x43</span><span class="op" id="6078761">,</span>&nbsp;<span class="num" id="6078763">0x44</span><span class="op" id="6078767">,</span>&nbsp;<span class="num" id="6078769">0x45</span><span class="op" id="6078773">,</span>&nbsp;<span class="num" id="6078775">0x46</span><span class="op" id="6078779">,</span>&nbsp;<span class="num" id="6078781">0x47</span><span class="op" id="6078785">,</span>&nbsp;<span class="num" id="6078787">0x48</span><span class="op" id="6078791">,</span>&nbsp;<span class="num" id="6078793">0x49</span><span class="op" id="6078797">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6078802">0x4a</span><span class="op" id="6078806">,</span>&nbsp;<span class="num" id="6078808">0x53</span><span class="op" id="6078812">,</span>&nbsp;<span class="num" id="6078814">0x54</span><span class="op" id="6078818">,</span>&nbsp;<span class="num" id="6078820">0x55</span><span class="op" id="6078824">,</span>&nbsp;<span class="num" id="6078826">0x56</span><span class="op" id="6078830">,</span>&nbsp;<span class="num" id="6078832">0x57</span><span class="op" id="6078836">,</span>&nbsp;<span class="num" id="6078838">0x58</span><span class="op" id="6078842">,</span>&nbsp;<span class="num" id="6078844">0x59</span><span class="op" id="6078848">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6078853">0x5a</span><span class="op" id="6078857">,</span>&nbsp;<span class="num" id="6078859">0x63</span><span class="op" id="6078863">,</span>&nbsp;<span class="num" id="6078865">0x64</span><span class="op" id="6078869">,</span>&nbsp;<span class="num" id="6078871">0x65</span><span class="op" id="6078875">,</span>&nbsp;<span class="num" id="6078877">0x66</span><span class="op" id="6078881">,</span>&nbsp;<span class="num" id="6078883">0x67</span><span class="op" id="6078887">,</span>&nbsp;<span class="num" id="6078889">0x68</span><span class="op" id="6078893">,</span>&nbsp;<span class="num" id="6078895">0x69</span><span class="op" id="6078899">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6078904">0x6a</span><span class="op" id="6078908">,</span>&nbsp;<span class="num" id="6078910">0x73</span><span class="op" id="6078914">,</span>&nbsp;<span class="num" id="6078916">0x74</span><span class="op" id="6078920">,</span>&nbsp;<span class="num" id="6078922">0x75</span><span class="op" id="6078926">,</span>&nbsp;<span class="num" id="6078928">0x76</span><span class="op" id="6078932">,</span>&nbsp;<span class="num" id="6078934">0x77</span><span class="op" id="6078938">,</span>&nbsp;<span class="num" id="6078940">0x78</span><span class="op" id="6078944">,</span>&nbsp;<span class="num" id="6078946">0x79</span><span class="op" id="6078950">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6078955">0x7a</span><span class="op" id="6078959">,</span>&nbsp;<span class="num" id="6078961">0x83</span><span class="op" id="6078965">,</span>&nbsp;<span class="num" id="6078967">0x84</span><span class="op" id="6078971">,</span>&nbsp;<span class="num" id="6078973">0x85</span><span class="op" id="6078977">,</span>&nbsp;<span class="num" id="6078979">0x86</span><span class="op" id="6078983">,</span>&nbsp;<span class="num" id="6078985">0x87</span><span class="op" id="6078989">,</span>&nbsp;<span class="num" id="6078991">0x88</span><span class="op" id="6078995">,</span>&nbsp;<span class="num" id="6078997">0x89</span><span class="op" id="6079001">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6079006">0x8a</span><span class="op" id="6079010">,</span>&nbsp;<span class="num" id="6079012">0x92</span><span class="op" id="6079016">,</span>&nbsp;<span class="num" id="6079018">0x93</span><span class="op" id="6079022">,</span>&nbsp;<span class="num" id="6079024">0x94</span><span class="op" id="6079028">,</span>&nbsp;<span class="num" id="6079030">0x95</span><span class="op" id="6079034">,</span>&nbsp;<span class="num" id="6079036">0x96</span><span class="op" id="6079040">,</span>&nbsp;<span class="num" id="6079042">0x97</span><span class="op" id="6079046">,</span>&nbsp;<span class="num" id="6079048">0x98</span><span class="op" id="6079052">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6079057">0x99</span><span class="op" id="6079061">,</span>&nbsp;<span class="num" id="6079063">0x9a</span><span class="op" id="6079067">,</span>&nbsp;<span class="num" id="6079069">0xa2</span><span class="op" id="6079073">,</span>&nbsp;<span class="num" id="6079075">0xa3</span><span class="op" id="6079079">,</span>&nbsp;<span class="num" id="6079081">0xa4</span><span class="op" id="6079085">,</span>&nbsp;<span class="num" id="6079087">0xa5</span><span class="op" id="6079091">,</span>&nbsp;<span class="num" id="6079093">0xa6</span><span class="op" id="6079097">,</span>&nbsp;<span class="num" id="6079099">0xa7</span><span class="op" id="6079103">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6079108">0xa8</span><span class="op" id="6079112">,</span>&nbsp;<span class="num" id="6079114">0xa9</span><span class="op" id="6079118">,</span>&nbsp;<span class="num" id="6079120">0xaa</span><span class="op" id="6079124">,</span>&nbsp;<span class="num" id="6079126">0xb2</span><span class="op" id="6079130">,</span>&nbsp;<span class="num" id="6079132">0xb3</span><span class="op" id="6079136">,</span>&nbsp;<span class="num" id="6079138">0xb4</span><span class="op" id="6079142">,</span>&nbsp;<span class="num" id="6079144">0xb5</span><span class="op" id="6079148">,</span>&nbsp;<span class="num" id="6079150">0xb6</span><span class="op" id="6079154">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6079159">0xb7</span><span class="op" id="6079163">,</span>&nbsp;<span class="num" id="6079165">0xb8</span><span class="op" id="6079169">,</span>&nbsp;<span class="num" id="6079171">0xb9</span><span class="op" id="6079175">,</span>&nbsp;<span class="num" id="6079177">0xba</span><span class="op" id="6079181">,</span>&nbsp;<span class="num" id="6079183">0xc2</span><span class="op" id="6079187">,</span>&nbsp;<span class="num" id="6079189">0xc3</span><span class="op" id="6079193">,</span>&nbsp;<span class="num" id="6079195">0xc4</span><span class="op" id="6079199">,</span>&nbsp;<span class="num" id="6079201">0xc5</span><span class="op" id="6079205">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6079210">0xc6</span><span class="op" id="6079214">,</span>&nbsp;<span class="num" id="6079216">0xc7</span><span class="op" id="6079220">,</span>&nbsp;<span class="num" id="6079222">0xc8</span><span class="op" id="6079226">,</span>&nbsp;<span class="num" id="6079228">0xc9</span><span class="op" id="6079232">,</span>&nbsp;<span class="num" id="6079234">0xca</span><span class="op" id="6079238">,</span>&nbsp;<span class="num" id="6079240">0xd2</span><span class="op" id="6079244">,</span>&nbsp;<span class="num" id="6079246">0xd3</span><span class="op" id="6079250">,</span>&nbsp;<span class="num" id="6079252">0xd4</span><span class="op" id="6079256">,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6079261">0xd5</span><span class="op" id="6079265">,</span>&nbsp;<span class="num" id="6079267">0xd6</span><span class="op" id="6079271">,</span>&nbsp;<span class="num" id="6079273">0xd7</span><span class="op" id="6079277">,</span>&nbsp;<span class="num" id="6079279">0xd8</span><span class="op" id="6079283">,</span>&nbsp;<span class="num" id="6079285">0xd9</span><span class="op" id="6079289">,</span>&nbsp;<span class="num" id="6079291">0xda</span><span class="op" id="6079295">,</span>&nbsp;<span class="num" id="6079297">0xe1</span><span class="op" id="6079301">,</span>&nbsp;<span class="num" id="6079303">0xe2</span><span class="op" id="6079307">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6079312">0xe3</span><span class="op" id="6079316">,</span>&nbsp;<span class="num" id="6079318">0xe4</span><span class="op" id="6079322">,</span>&nbsp;<span class="num" id="6079324">0xe5</span><span class="op" id="6079328">,</span>&nbsp;<span class="num" id="6079330">0xe6</span><span class="op" id="6079334">,</span>&nbsp;<span class="num" id="6079336">0xe7</span><span class="op" id="6079340">,</span>&nbsp;<span class="num" id="6079342">0xe8</span><span class="op" id="6079346">,</span>&nbsp;<span class="num" id="6079348">0xe9</span><span class="op" id="6079352">,</span>&nbsp;<span class="num" id="6079354">0xea</span><span class="op" id="6079358">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6079363">0xf1</span><span class="op" id="6079367">,</span>&nbsp;<span class="num" id="6079369">0xf2</span><span class="op" id="6079373">,</span>&nbsp;<span class="num" id="6079375">0xf3</span><span class="op" id="6079379">,</span>&nbsp;<span class="num" id="6079381">0xf4</span><span class="op" id="6079385">,</span>&nbsp;<span class="num" id="6079387">0xf5</span><span class="op" id="6079391">,</span>&nbsp;<span class="num" id="6079393">0xf6</span><span class="op" id="6079397">,</span>&nbsp;<span class="num" id="6079399">0xf7</span><span class="op" id="6079403">,</span>&nbsp;<span class="num" id="6079405">0xf8</span><span class="op" id="6079409">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6079414">0xf9</span><span class="op" id="6079418">,</span>&nbsp;<span class="num" id="6079420">0xfa</span><span class="op" id="6079424">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6079428">}</span><span class="op" id="6079429">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6079432">}</span><span class="op" id="6079433">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6079436">//&nbsp;Chrominance&nbsp;DC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6079456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6079460">[</span><span class="num" id="6079461">16</span><span class="op" id="6079463">]</span><span class="builtintype" id="6079464">byte</span><span class="op" id="6079468">{</span><span class="num" id="6079469">0</span><span class="op" id="6079470">,</span>&nbsp;<span class="num" id="6079472">3</span><span class="op" id="6079473">,</span>&nbsp;<span class="num" id="6079475">1</span><span class="op" id="6079476">,</span>&nbsp;<span class="num" id="6079478">1</span><span class="op" id="6079479">,</span>&nbsp;<span class="num" id="6079481">1</span><span class="op" id="6079482">,</span>&nbsp;<span class="num" id="6079484">1</span><span class="op" id="6079485">,</span>&nbsp;<span class="num" id="6079487">1</span><span class="op" id="6079488">,</span>&nbsp;<span class="num" id="6079490">1</span><span class="op" id="6079491">,</span>&nbsp;<span class="num" id="6079493">1</span><span class="op" id="6079494">,</span>&nbsp;<span class="num" id="6079496">1</span><span class="op" id="6079497">,</span>&nbsp;<span class="num" id="6079499">1</span><span class="op" id="6079500">,</span>&nbsp;<span class="num" id="6079502">0</span><span class="op" id="6079503">,</span>&nbsp;<span class="num" id="6079505">0</span><span class="op" id="6079506">,</span>&nbsp;<span class="num" id="6079508">0</span><span class="op" id="6079509">,</span>&nbsp;<span class="num" id="6079511">0</span><span class="op" id="6079512">,</span>&nbsp;<span class="num" id="6079514">0</span><span class="op" id="6079515">}</span><span class="op" id="6079516">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6079520">[</span><span class="op" id="6079521">]</span><span class="builtintype" id="6079522">byte</span><span class="op" id="6079526">{</span><span class="num" id="6079527">0</span><span class="op" id="6079528">,</span>&nbsp;<span class="num" id="6079530">1</span><span class="op" id="6079531">,</span>&nbsp;<span class="num" id="6079533">2</span><span class="op" id="6079534">,</span>&nbsp;<span class="num" id="6079536">3</span><span class="op" id="6079537">,</span>&nbsp;<span class="num" id="6079539">4</span><span class="op" id="6079540">,</span>&nbsp;<span class="num" id="6079542">5</span><span class="op" id="6079543">,</span>&nbsp;<span class="num" id="6079545">6</span><span class="op" id="6079546">,</span>&nbsp;<span class="num" id="6079548">7</span><span class="op" id="6079549">,</span>&nbsp;<span class="num" id="6079551">8</span><span class="op" id="6079552">,</span>&nbsp;<span class="num" id="6079554">9</span><span class="op" id="6079555">,</span>&nbsp;<span class="num" id="6079557">10</span><span class="op" id="6079559">,</span>&nbsp;<span class="num" id="6079561">11</span><span class="op" id="6079563">}</span><span class="op" id="6079564">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6079567">}</span><span class="op" id="6079568">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6079571">//&nbsp;Chrominance&nbsp;AC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6079591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6079595">[</span><span class="num" id="6079596">16</span><span class="op" id="6079598">]</span><span class="builtintype" id="6079599">byte</span><span class="op" id="6079603">{</span><span class="num" id="6079604">0</span><span class="op" id="6079605">,</span>&nbsp;<span class="num" id="6079607">2</span><span class="op" id="6079608">,</span>&nbsp;<span class="num" id="6079610">1</span><span class="op" id="6079611">,</span>&nbsp;<span class="num" id="6079613">2</span><span class="op" id="6079614">,</span>&nbsp;<span class="num" id="6079616">4</span><span class="op" id="6079617">,</span>&nbsp;<span class="num" id="6079619">4</span><span class="op" id="6079620">,</span>&nbsp;<span class="num" id="6079622">3</span><span class="op" id="6079623">,</span>&nbsp;<span class="num" id="6079625">4</span><span class="op" id="6079626">,</span>&nbsp;<span class="num" id="6079628">7</span><span class="op" id="6079629">,</span>&nbsp;<span class="num" id="6079631">5</span><span class="op" id="6079632">,</span>&nbsp;<span class="num" id="6079634">4</span><span class="op" id="6079635">,</span>&nbsp;<span class="num" id="6079637">4</span><span class="op" id="6079638">,</span>&nbsp;<span class="num" id="6079640">0</span><span class="op" id="6079641">,</span>&nbsp;<span class="num" id="6079643">1</span><span class="op" id="6079644">,</span>&nbsp;<span class="num" id="6079646">2</span><span class="op" id="6079647">,</span>&nbsp;<span class="num" id="6079649">119</span><span class="op" id="6079652">}</span><span class="op" id="6079653">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6079657">[</span><span class="op" id="6079658">]</span><span class="builtintype" id="6079659">byte</span><span class="op" id="6079663">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6079668">0x00</span><span class="op" id="6079672">,</span>&nbsp;<span class="num" id="6079674">0x01</span><span class="op" id="6079678">,</span>&nbsp;<span class="num" id="6079680">0x02</span><span class="op" id="6079684">,</span>&nbsp;<span class="num" id="6079686">0x03</span><span class="op" id="6079690">,</span>&nbsp;<span class="num" id="6079692">0x11</span><span class="op" id="6079696">,</span>&nbsp;<span class="num" id="6079698">0x04</span><span class="op" id="6079702">,</span>&nbsp;<span class="num" id="6079704">0x05</span><span class="op" id="6079708">,</span>&nbsp;<span class="num" id="6079710">0x21</span><span class="op" id="6079714">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6079719">0x31</span><span class="op" id="6079723">,</span>&nbsp;<span class="num" id="6079725">0x06</span><span class="op" id="6079729">,</span>&nbsp;<span class="num" id="6079731">0x12</span><span class="op" id="6079735">,</span>&nbsp;<span class="num" id="6079737">0x41</span><span class="op" id="6079741">,</span>&nbsp;<span class="num" id="6079743">0x51</span><span class="op" id="6079747">,</span>&nbsp;<span class="num" id="6079749">0x07</span><span class="op" id="6079753">,</span>&nbsp;<span class="num" id="6079755">0x61</span><span class="op" id="6079759">,</span>&nbsp;<span class="num" id="6079761">0x71</span><span class="op" id="6079765">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6079770">0x13</span><span class="op" id="6079774">,</span>&nbsp;<span class="num" id="6079776">0x22</span><span class="op" id="6079780">,</span>&nbsp;<span class="num" id="6079782">0x32</span><span class="op" id="6079786">,</span>&nbsp;<span class="num" id="6079788">0x81</span><span class="op" id="6079792">,</span>&nbsp;<span class="num" id="6079794">0x08</span><span class="op" id="6079798">,</span>&nbsp;<span class="num" id="6079800">0x14</span><span class="op" id="6079804">,</span>&nbsp;<span class="num" id="6079806">0x42</span><span class="op" id="6079810">,</span>&nbsp;<span class="num" id="6079812">0x91</span><span class="op" id="6079816">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6079821">0xa1</span><span class="op" id="6079825">,</span>&nbsp;<span class="num" id="6079827">0xb1</span><span class="op" id="6079831">,</span>&nbsp;<span class="num" id="6079833">0xc1</span><span class="op" id="6079837">,</span>&nbsp;<span class="num" id="6079839">0x09</span><span class="op" id="6079843">,</span>&nbsp;<span class="num" id="6079845">0x23</span><span class="op" id="6079849">,</span>&nbsp;<span class="num" id="6079851">0x33</span><span class="op" id="6079855">,</span>&nbsp;<span class="num" id="6079857">0x52</span><span class="op" id="6079861">,</span>&nbsp;<span class="num" id="6079863">0xf0</span><span class="op" id="6079867">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6079872">0x15</span><span class="op" id="6079876">,</span>&nbsp;<span class="num" id="6079878">0x62</span><span class="op" id="6079882">,</span>&nbsp;<span class="num" id="6079884">0x72</span><span class="op" id="6079888">,</span>&nbsp;<span class="num" id="6079890">0xd1</span><span class="op" id="6079894">,</span>&nbsp;<span class="num" id="6079896">0x0a</span><span class="op" id="6079900">,</span>&nbsp;<span class="num" id="6079902">0x16</span><span class="op" id="6079906">,</span>&nbsp;<span class="num" id="6079908">0x24</span><span class="op" id="6079912">,</span>&nbsp;<span class="num" id="6079914">0x34</span><span class="op" id="6079918">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6079923">0xe1</span><span class="op" id="6079927">,</span>&nbsp;<span class="num" id="6079929">0x25</span><span class="op" id="6079933">,</span>&nbsp;<span class="num" id="6079935">0xf1</span><span class="op" id="6079939">,</span>&nbsp;<span class="num" id="6079941">0x17</span><span class="op" id="6079945">,</span>&nbsp;<span class="num" id="6079947">0x18</span><span class="op" id="6079951">,</span>&nbsp;<span class="num" id="6079953">0x19</span><span class="op" id="6079957">,</span>&nbsp;<span class="num" id="6079959">0x1a</span><span class="op" id="6079963">,</span>&nbsp;<span class="num" id="6079965">0x26</span><span class="op" id="6079969">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6079974">0x27</span><span class="op" id="6079978">,</span>&nbsp;<span class="num" id="6079980">0x28</span><span class="op" id="6079984">,</span>&nbsp;<span class="num" id="6079986">0x29</span><span class="op" id="6079990">,</span>&nbsp;<span class="num" id="6079992">0x2a</span><span class="op" id="6079996">,</span>&nbsp;<span class="num" id="6079998">0x35</span><span class="op" id="6080002">,</span>&nbsp;<span class="num" id="6080004">0x36</span><span class="op" id="6080008">,</span>&nbsp;<span class="num" id="6080010">0x37</span><span class="op" id="6080014">,</span>&nbsp;<span class="num" id="6080016">0x38</span><span class="op" id="6080020">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6080025">0x39</span><span class="op" id="6080029">,</span>&nbsp;<span class="num" id="6080031">0x3a</span><span class="op" id="6080035">,</span>&nbsp;<span class="num" id="6080037">0x43</span><span class="op" id="6080041">,</span>&nbsp;<span class="num" id="6080043">0x44</span><span class="op" id="6080047">,</span>&nbsp;<span class="num" id="6080049">0x45</span><span class="op" id="6080053">,</span>&nbsp;<span class="num" id="6080055">0x46</span><span class="op" id="6080059">,</span>&nbsp;<span class="num" id="6080061">0x47</span><span class="op" id="6080065">,</span>&nbsp;<span class="num" id="6080067">0x48</span><span class="op" id="6080071">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6080076">0x49</span><span class="op" id="6080080">,</span>&nbsp;<span class="num" id="6080082">0x4a</span><span class="op" id="6080086">,</span>&nbsp;<span class="num" id="6080088">0x53</span><span class="op" id="6080092">,</span>&nbsp;<span class="num" id="6080094">0x54</span><span class="op" id="6080098">,</span>&nbsp;<span class="num" id="6080100">0x55</span><span class="op" id="6080104">,</span>&nbsp;<span class="num" id="6080106">0x56</span><span class="op" id="6080110">,</span>&nbsp;<span class="num" id="6080112">0x57</span><span class="op" id="6080116">,</span>&nbsp;<span class="num" id="6080118">0x58</span><span class="op" id="6080122">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6080127">0x59</span><span class="op" id="6080131">,</span>&nbsp;<span class="num" id="6080133">0x5a</span><span class="op" id="6080137">,</span>&nbsp;<span class="num" id="6080139">0x63</span><span class="op" id="6080143">,</span>&nbsp;<span class="num" id="6080145">0x64</span><span class="op" id="6080149">,</span>&nbsp;<span class="num" id="6080151">0x65</span><span class="op" id="6080155">,</span>&nbsp;<span class="num" id="6080157">0x66</span><span class="op" id="6080161">,</span>&nbsp;<span class="num" id="6080163">0x67</span><span class="op" id="6080167">,</span>&nbsp;<span class="num" id="6080169">0x68</span><span class="op" id="6080173">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6080178">0x69</span><span class="op" id="6080182">,</span>&nbsp;<span class="num" id="6080184">0x6a</span><span class="op" id="6080188">,</span>&nbsp;<span class="num" id="6080190">0x73</span><span class="op" id="6080194">,</span>&nbsp;<span class="num" id="6080196">0x74</span><span class="op" id="6080200">,</span>&nbsp;<span class="num" id="6080202">0x75</span><span class="op" id="6080206">,</span>&nbsp;<span class="num" id="6080208">0x76</span><span class="op" id="6080212">,</span>&nbsp;<span class="num" id="6080214">0x77</span><span class="op" id="6080218">,</span>&nbsp;<span class="num" id="6080220">0x78</span><span class="op" id="6080224">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6080229">0x79</span><span class="op" id="6080233">,</span>&nbsp;<span class="num" id="6080235">0x7a</span><span class="op" id="6080239">,</span>&nbsp;<span class="num" id="6080241">0x82</span><span class="op" id="6080245">,</span>&nbsp;<span class="num" id="6080247">0x83</span><span class="op" id="6080251">,</span>&nbsp;<span class="num" id="6080253">0x84</span><span class="op" id="6080257">,</span>&nbsp;<span class="num" id="6080259">0x85</span><span class="op" id="6080263">,</span>&nbsp;<span class="num" id="6080265">0x86</span><span class="op" id="6080269">,</span>&nbsp;<span class="num" id="6080271">0x87</span><span class="op" id="6080275">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6080280">0x88</span><span class="op" id="6080284">,</span>&nbsp;<span class="num" id="6080286">0x89</span><span class="op" id="6080290">,</span>&nbsp;<span class="num" id="6080292">0x8a</span><span class="op" id="6080296">,</span>&nbsp;<span class="num" id="6080298">0x92</span><span class="op" id="6080302">,</span>&nbsp;<span class="num" id="6080304">0x93</span><span class="op" id="6080308">,</span>&nbsp;<span class="num" id="6080310">0x94</span><span class="op" id="6080314">,</span>&nbsp;<span class="num" id="6080316">0x95</span><span class="op" id="6080320">,</span>&nbsp;<span class="num" id="6080322">0x96</span><span class="op" id="6080326">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6080331">0x97</span><span class="op" id="6080335">,</span>&nbsp;<span class="num" id="6080337">0x98</span><span class="op" id="6080341">,</span>&nbsp;<span class="num" id="6080343">0x99</span><span class="op" id="6080347">,</span>&nbsp;<span class="num" id="6080349">0x9a</span><span class="op" id="6080353">,</span>&nbsp;<span class="num" id="6080355">0xa2</span><span class="op" id="6080359">,</span>&nbsp;<span class="num" id="6080361">0xa3</span><span class="op" id="6080365">,</span>&nbsp;<span class="num" id="6080367">0xa4</span><span class="op" id="6080371">,</span>&nbsp;<span class="num" id="6080373">0xa5</span><span class="op" id="6080377">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6080382">0xa6</span><span class="op" id="6080386">,</span>&nbsp;<span class="num" id="6080388">0xa7</span><span class="op" id="6080392">,</span>&nbsp;<span class="num" id="6080394">0xa8</span><span class="op" id="6080398">,</span>&nbsp;<span class="num" id="6080400">0xa9</span><span class="op" id="6080404">,</span>&nbsp;<span class="num" id="6080406">0xaa</span><span class="op" id="6080410">,</span>&nbsp;<span class="num" id="6080412">0xb2</span><span class="op" id="6080416">,</span>&nbsp;<span class="num" id="6080418">0xb3</span><span class="op" id="6080422">,</span>&nbsp;<span class="num" id="6080424">0xb4</span><span class="op" id="6080428">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6080433">0xb5</span><span class="op" id="6080437">,</span>&nbsp;<span class="num" id="6080439">0xb6</span><span class="op" id="6080443">,</span>&nbsp;<span class="num" id="6080445">0xb7</span><span class="op" id="6080449">,</span>&nbsp;<span class="num" id="6080451">0xb8</span><span class="op" id="6080455">,</span>&nbsp;<span class="num" id="6080457">0xb9</span><span class="op" id="6080461">,</span>&nbsp;<span class="num" id="6080463">0xba</span><span class="op" id="6080467">,</span>&nbsp;<span class="num" id="6080469">0xc2</span><span class="op" id="6080473">,</span>&nbsp;<span class="num" id="6080475">0xc3</span><span class="op" id="6080479">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6080484">0xc4</span><span class="op" id="6080488">,</span>&nbsp;<span class="num" id="6080490">0xc5</span><span class="op" id="6080494">,</span>&nbsp;<span class="num" id="6080496">0xc6</span><span class="op" id="6080500">,</span>&nbsp;<span class="num" id="6080502">0xc7</span><span class="op" id="6080506">,</span>&nbsp;<span class="num" id="6080508">0xc8</span><span class="op" id="6080512">,</span>&nbsp;<span class="num" id="6080514">0xc9</span><span class="op" id="6080518">,</span>&nbsp;<span class="num" id="6080520">0xca</span><span class="op" id="6080524">,</span>&nbsp;<span class="num" id="6080526">0xd2</span><span class="op" id="6080530">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6080535">0xd3</span><span class="op" id="6080539">,</span>&nbsp;<span class="num" id="6080541">0xd4</span><span class="op" id="6080545">,</span>&nbsp;<span class="num" id="6080547">0xd5</span><span class="op" id="6080551">,</span>&nbsp;<span class="num" id="6080553">0xd6</span><span class="op" id="6080557">,</span>&nbsp;<span class="num" id="6080559">0xd7</span><span class="op" id="6080563">,</span>&nbsp;<span class="num" id="6080565">0xd8</span><span class="op" id="6080569">,</span>&nbsp;<span class="num" id="6080571">0xd9</span><span class="op" id="6080575">,</span>&nbsp;<span class="num" id="6080577">0xda</span><span class="op" id="6080581">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6080586">0xe2</span><span class="op" id="6080590">,</span>&nbsp;<span class="num" id="6080592">0xe3</span><span class="op" id="6080596">,</span>&nbsp;<span class="num" id="6080598">0xe4</span><span class="op" id="6080602">,</span>&nbsp;<span class="num" id="6080604">0xe5</span><span class="op" id="6080608">,</span>&nbsp;<span class="num" id="6080610">0xe6</span><span class="op" id="6080614">,</span>&nbsp;<span class="num" id="6080616">0xe7</span><span class="op" id="6080620">,</span>&nbsp;<span class="num" id="6080622">0xe8</span><span class="op" id="6080626">,</span>&nbsp;<span class="num" id="6080628">0xe9</span><span class="op" id="6080632">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6080637">0xea</span><span class="op" id="6080641">,</span>&nbsp;<span class="num" id="6080643">0xf2</span><span class="op" id="6080647">,</span>&nbsp;<span class="num" id="6080649">0xf3</span><span class="op" id="6080653">,</span>&nbsp;<span class="num" id="6080655">0xf4</span><span class="op" id="6080659">,</span>&nbsp;<span class="num" id="6080661">0xf5</span><span class="op" id="6080665">,</span>&nbsp;<span class="num" id="6080667">0xf6</span><span class="op" id="6080671">,</span>&nbsp;<span class="num" id="6080673">0xf7</span><span class="op" id="6080677">,</span>&nbsp;<span class="num" id="6080679">0xf8</span><span class="op" id="6080683">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6080688">0xf9</span><span class="op" id="6080692">,</span>&nbsp;<span class="num" id="6080694">0xfa</span><span class="op" id="6080698">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6080702">}</span><span class="op" id="6080703">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6080706">}</span><span class="op" id="6080707">,</span><br>
<span class="lineno"></span><span class="op" id="6080709">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="6080712">//&nbsp;huffmanLUT&nbsp;is&nbsp;a&nbsp;compiled&nbsp;look-up&nbsp;table&nbsp;representation&nbsp;of&nbsp;a&nbsp;huffmanSpec.</span><br>
<span class="lineno"></span><span class="comment" id="6080787">//&nbsp;Each&nbsp;value&nbsp;maps&nbsp;to&nbsp;a&nbsp;uint32&nbsp;of&nbsp;which&nbsp;the&nbsp;8&nbsp;most&nbsp;significant&nbsp;bits&nbsp;hold&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6080864">//&nbsp;codeword&nbsp;size&nbsp;in&nbsp;bits&nbsp;and&nbsp;the&nbsp;24&nbsp;least&nbsp;significant&nbsp;bits&nbsp;hold&nbsp;the&nbsp;codeword.</span><br>
<span class="lineno"></span><span class="comment" id="6080942">//&nbsp;The&nbsp;maximum&nbsp;codeword&nbsp;size&nbsp;is&nbsp;16&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="6080983">type</span>&nbsp;<span class="ident" id="6080988">huffmanLUT</span>&nbsp;<span class="op" id="6080999">[</span><span class="op" id="6081000">]</span><span class="builtintype" id="6081001">uint32</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="6081009">func</span>&nbsp;<span class="op" id="6081014">(</span><span class="ident" id="6081015">h</span>&nbsp;<span class="op" id="6081017">*</span><span class="ident" id="6081018">huffmanLUT</span><span class="op" id="6081028">)</span>&nbsp;<span class="ident" id="6081030">init</span><span class="op" id="6081034">(</span><span class="ident" id="6081035">s</span>&nbsp;<span class="ident" id="6081037">huffmanSpec</span><span class="op" id="6081048">)</span>&nbsp;<span class="op" id="6081050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081053">maxValue</span>&nbsp;<span class="op" id="6081062">:=</span>&nbsp;<span class="num" id="6081065">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6081068">for</span>&nbsp;<span class="ident" id="6081072">_</span><span class="op" id="6081073">,</span>&nbsp;<span class="ident" id="6081075">v</span>&nbsp;<span class="op" id="6081077">:=</span>&nbsp;<span class="keyword" id="6081080">range</span>&nbsp;<span class="ident" id="6081086">s</span><span class="op" id="6081087">.</span><span class="ident" id="6081088">value</span>&nbsp;<span class="op" id="6081094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6081098">if</span>&nbsp;<span class="builtintype" id="6081101">int</span><span class="op" id="6081104">(</span><span class="ident" id="6081105">v</span><span class="op" id="6081106">)</span>&nbsp;<span class="op" id="6081108">&gt;</span>&nbsp;<span class="ident" id="6081110">maxValue</span>&nbsp;<span class="op" id="6081119">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081124">maxValue</span>&nbsp;<span class="op" id="6081133">=</span>&nbsp;<span class="builtintype" id="6081135">int</span><span class="op" id="6081138">(</span><span class="ident" id="6081139">v</span><span class="op" id="6081140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6081144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6081147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6081150">*</span><span class="ident" id="6081151">h</span>&nbsp;<span class="op" id="6081153">=</span>&nbsp;<span class="builtinfunc" id="6081155">make</span><span class="op" id="6081159">(</span><span class="op" id="6081160">[</span><span class="op" id="6081161">]</span><span class="builtintype" id="6081162">uint32</span><span class="op" id="6081168">,</span>&nbsp;<span class="ident" id="6081170">maxValue</span><span class="op" id="6081178">+</span><span class="num" id="6081179">1</span><span class="op" id="6081180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081183">code</span><span class="op" id="6081187">,</span>&nbsp;<span class="ident" id="6081189">k</span>&nbsp;<span class="op" id="6081191">:=</span>&nbsp;<span class="builtintype" id="6081194">uint32</span><span class="op" id="6081200">(</span><span class="num" id="6081201">0</span><span class="op" id="6081202">)</span><span class="op" id="6081203">,</span>&nbsp;<span class="num" id="6081205">0</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6081208">for</span>&nbsp;<span class="ident" id="6081212">i</span>&nbsp;<span class="op" id="6081214">:=</span>&nbsp;<span class="num" id="6081217">0</span><span class="op" id="6081218">;</span>&nbsp;<span class="ident" id="6081220">i</span>&nbsp;<span class="op" id="6081222">&lt;</span>&nbsp;<span class="builtinfunc" id="6081224">len</span><span class="op" id="6081227">(</span><span class="ident" id="6081228">s</span><span class="op" id="6081229">.</span><span class="ident" id="6081230">count</span><span class="op" id="6081235">)</span><span class="op" id="6081236">;</span>&nbsp;<span class="ident" id="6081238">i</span><span class="op" id="6081239">++</span>&nbsp;<span class="op" id="6081242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081246">nBits</span>&nbsp;<span class="op" id="6081252">:=</span>&nbsp;<span class="builtintype" id="6081255">uint32</span><span class="op" id="6081261">(</span><span class="ident" id="6081262">i</span><span class="op" id="6081263">+</span><span class="num" id="6081264">1</span><span class="op" id="6081265">)</span>&nbsp;<span class="op" id="6081267">&lt;&lt;</span>&nbsp;<span class="num" id="6081270">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6081275">for</span>&nbsp;<span class="ident" id="6081279">j</span>&nbsp;<span class="op" id="6081281">:=</span>&nbsp;<span class="builtintype" id="6081284">uint8</span><span class="op" id="6081289">(</span><span class="num" id="6081290">0</span><span class="op" id="6081291">)</span><span class="op" id="6081292">;</span>&nbsp;<span class="ident" id="6081294">j</span>&nbsp;<span class="op" id="6081296">&lt;</span>&nbsp;<span class="ident" id="6081298">s</span><span class="op" id="6081299">.</span><span class="ident" id="6081300">count</span><span class="op" id="6081305">[</span><span class="ident" id="6081306">i</span><span class="op" id="6081307">]</span><span class="op" id="6081308">;</span>&nbsp;<span class="ident" id="6081310">j</span><span class="op" id="6081311">++</span>&nbsp;<span class="op" id="6081314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6081319">(</span><span class="op" id="6081320">*</span><span class="ident" id="6081321">h</span><span class="op" id="6081322">)</span><span class="op" id="6081323">[</span><span class="ident" id="6081324">s</span><span class="op" id="6081325">.</span><span class="ident" id="6081326">value</span><span class="op" id="6081331">[</span><span class="ident" id="6081332">k</span><span class="op" id="6081333">]</span><span class="op" id="6081334">]</span>&nbsp;<span class="op" id="6081336">=</span>&nbsp;<span class="ident" id="6081338">nBits</span>&nbsp;<span class="op" id="6081344">|</span>&nbsp;<span class="ident" id="6081346">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081354">code</span><span class="op" id="6081358">++</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081364">k</span><span class="op" id="6081365">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6081370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081374">code</span>&nbsp;<span class="op" id="6081379">&lt;&lt;=</span>&nbsp;<span class="num" id="6081383">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6081386">}</span><br>
<span class="lineno"></span><span class="op" id="6081388">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="6081391">//&nbsp;theHuffmanLUT&nbsp;are&nbsp;compiled&nbsp;representations&nbsp;of&nbsp;theHuffmanSpec.</span><br>
<span class="lineno"></span><span class="keyword" id="6081456">var</span>&nbsp;<span class="ident" id="6081460">theHuffmanLUT</span>&nbsp;<span class="op" id="6081474">[</span><span class="num" id="6081475">4</span><span class="op" id="6081476">]</span><span class="ident" id="6081477">huffmanLUT</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6081489">func</span>&nbsp;<span class="ident" id="6081494">init</span><span class="op" id="6081498">(</span><span class="op" id="6081499">)</span>&nbsp;<span class="op" id="6081501">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6081504">for</span>&nbsp;<span class="ident" id="6081508">i</span><span class="op" id="6081509">,</span>&nbsp;<span class="ident" id="6081511">s</span>&nbsp;<span class="op" id="6081513">:=</span>&nbsp;<span class="keyword" id="6081516">range</span>&nbsp;<span class="ident" id="6081522">theHuffmanSpec</span>&nbsp;<span class="op" id="6081537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081541">theHuffmanLUT</span><span class="op" id="6081554">[</span><span class="ident" id="6081555">i</span><span class="op" id="6081556">]</span><span class="op" id="6081557">.</span><span class="ident" id="6081558">init</span><span class="op" id="6081562">(</span><span class="ident" id="6081563">s</span><span class="op" id="6081564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6081567">}</span><br>
<span class="lineno"></span><span class="op" id="6081569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="comment" id="6081572">//&nbsp;writer&nbsp;is&nbsp;a&nbsp;buffered&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="6081604">type</span>&nbsp;<span class="ident" id="6081609">writer</span>&nbsp;<span class="keyword" id="6081616">interface</span>&nbsp;<span class="op" id="6081626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081629">Flush</span><span class="op" id="6081634">(</span><span class="op" id="6081635">)</span>&nbsp;<span class="builtintype" id="6081637">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081644">io</span><span class="op" id="6081646">.</span><span class="ident" id="6081647">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081655">io</span><span class="op" id="6081657">.</span><span class="ident" id="6081658">ByteWriter</span><br>
<span class="lineno">215</span><span class="op" id="6081669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6081672">//&nbsp;encoder&nbsp;encodes&nbsp;an&nbsp;image&nbsp;to&nbsp;the&nbsp;JPEG&nbsp;format.</span><br>
<span class="lineno"></span><span class="keyword" id="6081720">type</span>&nbsp;<span class="ident" id="6081725">encoder</span>&nbsp;<span class="keyword" id="6081733">struct</span>&nbsp;<span class="op" id="6081740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6081743">//&nbsp;w&nbsp;is&nbsp;the&nbsp;writer&nbsp;to&nbsp;write&nbsp;to.&nbsp;err&nbsp;is&nbsp;the&nbsp;first&nbsp;error&nbsp;encountered&nbsp;during</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6081818">//&nbsp;writing.&nbsp;All&nbsp;attempted&nbsp;writes&nbsp;after&nbsp;the&nbsp;first&nbsp;error&nbsp;become&nbsp;no-ops.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081889">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6081893">writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081901">err</span>&nbsp;<span class="builtintype" id="6081905">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6081912">//&nbsp;buf&nbsp;is&nbsp;a&nbsp;scratch&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081941">buf</span>&nbsp;<span class="op" id="6081945">[</span><span class="num" id="6081946">16</span><span class="op" id="6081948">]</span><span class="builtintype" id="6081949">byte</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6081955">//&nbsp;bits&nbsp;and&nbsp;nBits&nbsp;are&nbsp;accumulated&nbsp;bits&nbsp;to&nbsp;write&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082010">bits</span><span class="op" id="6082014">,</span>&nbsp;<span class="ident" id="6082016">nBits</span>&nbsp;<span class="builtintype" id="6082022">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6082030">//&nbsp;quant&nbsp;is&nbsp;the&nbsp;scaled&nbsp;quantization&nbsp;tables,&nbsp;in&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082093">quant</span>&nbsp;<span class="op" id="6082099">[</span><span class="ident" id="6082100">nQuantIndex</span><span class="op" id="6082111">]</span><span class="op" id="6082112">[</span><span class="ident" id="6082113">blockSize</span><span class="op" id="6082122">]</span><span class="builtintype" id="6082123">byte</span><br>
<span class="lineno"></span><span class="op" id="6082128">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="keyword" id="6082131">func</span>&nbsp;<span class="op" id="6082136">(</span><span class="ident" id="6082137">e</span>&nbsp;<span class="op" id="6082139">*</span><span class="ident" id="6082140">encoder</span><span class="op" id="6082147">)</span>&nbsp;<span class="ident" id="6082149">flush</span><span class="op" id="6082154">(</span><span class="op" id="6082155">)</span>&nbsp;<span class="op" id="6082157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082160">if</span>&nbsp;<span class="ident" id="6082163">e</span><span class="op" id="6082164">.</span><span class="ident" id="6082165">err</span>&nbsp;<span class="op" id="6082169">!=</span>&nbsp;<span class="ident" id="6082172">nil</span>&nbsp;<span class="op" id="6082176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082180">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6082188">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082191">e</span><span class="op" id="6082192">.</span><span class="ident" id="6082193">err</span>&nbsp;<span class="op" id="6082197">=</span>&nbsp;<span class="ident" id="6082199">e</span><span class="op" id="6082200">.</span><span class="ident" id="6082201">w</span><span class="op" id="6082202">.</span><span class="ident" id="6082203">Flush</span><span class="op" id="6082208">(</span><span class="op" id="6082209">)</span><br>
<span class="lineno"></span><span class="op" id="6082211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6082214">func</span>&nbsp;<span class="op" id="6082219">(</span><span class="ident" id="6082220">e</span>&nbsp;<span class="op" id="6082222">*</span><span class="ident" id="6082223">encoder</span><span class="op" id="6082230">)</span>&nbsp;<span class="ident" id="6082232">write</span><span class="op" id="6082237">(</span><span class="ident" id="6082238">p</span>&nbsp;<span class="op" id="6082240">[</span><span class="op" id="6082241">]</span><span class="builtintype" id="6082242">byte</span><span class="op" id="6082246">)</span>&nbsp;<span class="op" id="6082248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082251">if</span>&nbsp;<span class="ident" id="6082254">e</span><span class="op" id="6082255">.</span><span class="ident" id="6082256">err</span>&nbsp;<span class="op" id="6082260">!=</span>&nbsp;<span class="ident" id="6082263">nil</span>&nbsp;<span class="op" id="6082267">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082271">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6082279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082282">_</span><span class="op" id="6082283">,</span>&nbsp;<span class="ident" id="6082285">e</span><span class="op" id="6082286">.</span><span class="ident" id="6082287">err</span>&nbsp;<span class="op" id="6082291">=</span>&nbsp;<span class="ident" id="6082293">e</span><span class="op" id="6082294">.</span><span class="ident" id="6082295">w</span><span class="op" id="6082296">.</span><span class="ident" id="6082297">Write</span><span class="op" id="6082302">(</span><span class="ident" id="6082303">p</span><span class="op" id="6082304">)</span><br>
<span class="lineno"></span><span class="op" id="6082306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="keyword" id="6082309">func</span>&nbsp;<span class="op" id="6082314">(</span><span class="ident" id="6082315">e</span>&nbsp;<span class="op" id="6082317">*</span><span class="ident" id="6082318">encoder</span><span class="op" id="6082325">)</span>&nbsp;<span class="ident" id="6082327">writeByte</span><span class="op" id="6082336">(</span><span class="ident" id="6082337">b</span>&nbsp;<span class="builtintype" id="6082339">byte</span><span class="op" id="6082343">)</span>&nbsp;<span class="op" id="6082345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082348">if</span>&nbsp;<span class="ident" id="6082351">e</span><span class="op" id="6082352">.</span><span class="ident" id="6082353">err</span>&nbsp;<span class="op" id="6082357">!=</span>&nbsp;<span class="ident" id="6082360">nil</span>&nbsp;<span class="op" id="6082364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082368">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6082376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082379">e</span><span class="op" id="6082380">.</span><span class="ident" id="6082381">err</span>&nbsp;<span class="op" id="6082385">=</span>&nbsp;<span class="ident" id="6082387">e</span><span class="op" id="6082388">.</span><span class="ident" id="6082389">w</span><span class="op" id="6082390">.</span><span class="ident" id="6082391">WriteByte</span><span class="op" id="6082400">(</span><span class="ident" id="6082401">b</span><span class="op" id="6082402">)</span><br>
<span class="lineno">250</span><span class="op" id="6082404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6082407">//&nbsp;emit&nbsp;emits&nbsp;the&nbsp;least&nbsp;significant&nbsp;nBits&nbsp;bits&nbsp;of&nbsp;bits&nbsp;to&nbsp;the&nbsp;bit-stream.</span><br>
<span class="lineno"></span><span class="comment" id="6082481">//&nbsp;The&nbsp;precondition&nbsp;is&nbsp;bits&nbsp;&lt;&nbsp;1&lt;&lt;nBits&nbsp;&amp;&amp;&nbsp;nBits&nbsp;&lt;=&nbsp;16.</span><br>
<span class="lineno"></span><span class="keyword" id="6082536">func</span>&nbsp;<span class="op" id="6082541">(</span><span class="ident" id="6082542">e</span>&nbsp;<span class="op" id="6082544">*</span><span class="ident" id="6082545">encoder</span><span class="op" id="6082552">)</span>&nbsp;<span class="ident" id="6082554">emit</span><span class="op" id="6082558">(</span><span class="ident" id="6082559">bits</span><span class="op" id="6082563">,</span>&nbsp;<span class="ident" id="6082565">nBits</span>&nbsp;<span class="builtintype" id="6082571">uint32</span><span class="op" id="6082577">)</span>&nbsp;<span class="op" id="6082579">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082582">nBits</span>&nbsp;<span class="op" id="6082588">+=</span>&nbsp;<span class="ident" id="6082591">e</span><span class="op" id="6082592">.</span><span class="ident" id="6082593">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082600">bits</span>&nbsp;<span class="op" id="6082605">&lt;&lt;=</span>&nbsp;<span class="num" id="6082609">32</span>&nbsp;<span class="op" id="6082612">-</span>&nbsp;<span class="ident" id="6082614">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082621">bits</span>&nbsp;<span class="op" id="6082626">|=</span>&nbsp;<span class="ident" id="6082629">e</span><span class="op" id="6082630">.</span><span class="ident" id="6082631">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082637">for</span>&nbsp;<span class="ident" id="6082641">nBits</span>&nbsp;<span class="op" id="6082647">&gt;=</span>&nbsp;<span class="num" id="6082650">8</span>&nbsp;<span class="op" id="6082652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082656">b</span>&nbsp;<span class="op" id="6082658">:=</span>&nbsp;<span class="builtintype" id="6082661">uint8</span><span class="op" id="6082666">(</span><span class="ident" id="6082667">bits</span>&nbsp;<span class="op" id="6082672">&gt;&gt;</span>&nbsp;<span class="num" id="6082675">24</span><span class="op" id="6082677">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082681">e</span><span class="op" id="6082682">.</span><span class="ident" id="6082683">writeByte</span><span class="op" id="6082692">(</span><span class="ident" id="6082693">b</span><span class="op" id="6082694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082698">if</span>&nbsp;<span class="ident" id="6082701">b</span>&nbsp;<span class="op" id="6082703">==</span>&nbsp;<span class="num" id="6082706">0xff</span>&nbsp;<span class="op" id="6082711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082716">e</span><span class="op" id="6082717">.</span><span class="ident" id="6082718">writeByte</span><span class="op" id="6082727">(</span><span class="num" id="6082728">0x00</span><span class="op" id="6082732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6082736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082740">bits</span>&nbsp;<span class="op" id="6082745">&lt;&lt;=</span>&nbsp;<span class="num" id="6082749">8</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082753">nBits</span>&nbsp;<span class="op" id="6082759">-=</span>&nbsp;<span class="num" id="6082762">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6082765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082768">e</span><span class="op" id="6082769">.</span><span class="ident" id="6082770">bits</span><span class="op" id="6082774">,</span>&nbsp;<span class="ident" id="6082776">e</span><span class="op" id="6082777">.</span><span class="ident" id="6082778">nBits</span>&nbsp;<span class="op" id="6082784">=</span>&nbsp;<span class="ident" id="6082786">bits</span><span class="op" id="6082790">,</span>&nbsp;<span class="ident" id="6082792">nBits</span><br>
<span class="lineno"></span><span class="op" id="6082798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="6082801">//&nbsp;emitHuff&nbsp;emits&nbsp;the&nbsp;given&nbsp;value&nbsp;with&nbsp;the&nbsp;given&nbsp;Huffman&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="6082867">func</span>&nbsp;<span class="op" id="6082872">(</span><span class="ident" id="6082873">e</span>&nbsp;<span class="op" id="6082875">*</span><span class="ident" id="6082876">encoder</span><span class="op" id="6082883">)</span>&nbsp;<span class="ident" id="6082885">emitHuff</span><span class="op" id="6082893">(</span><span class="ident" id="6082894">h</span>&nbsp;<span class="ident" id="6082896">huffIndex</span><span class="op" id="6082905">,</span>&nbsp;<span class="ident" id="6082907">value</span>&nbsp;<span class="builtintype" id="6082913">int32</span><span class="op" id="6082918">)</span>&nbsp;<span class="op" id="6082920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082923">x</span>&nbsp;<span class="op" id="6082925">:=</span>&nbsp;<span class="ident" id="6082928">theHuffmanLUT</span><span class="op" id="6082941">[</span><span class="ident" id="6082942">h</span><span class="op" id="6082943">]</span><span class="op" id="6082944">[</span><span class="ident" id="6082945">value</span><span class="op" id="6082950">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082953">e</span><span class="op" id="6082954">.</span><span class="ident" id="6082955">emit</span><span class="op" id="6082959">(</span><span class="ident" id="6082960">x</span><span class="op" id="6082961">&amp;</span><span class="op" id="6082962">(</span><span class="num" id="6082963">1</span><span class="op" id="6082964">&lt;&lt;</span><span class="num" id="6082966">24</span><span class="op" id="6082968">-</span><span class="num" id="6082969">1</span><span class="op" id="6082970">)</span><span class="op" id="6082971">,</span>&nbsp;<span class="ident" id="6082973">x</span><span class="op" id="6082974">&gt;&gt;</span><span class="num" id="6082976">24</span><span class="op" id="6082978">)</span><br>
<span class="lineno"></span><span class="op" id="6082980">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="6082983">//&nbsp;emitHuffRLE&nbsp;emits&nbsp;a&nbsp;run&nbsp;of&nbsp;runLength&nbsp;copies&nbsp;of&nbsp;value&nbsp;encoded&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="6083062">//&nbsp;Huffman&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="6083082">func</span>&nbsp;<span class="op" id="6083087">(</span><span class="ident" id="6083088">e</span>&nbsp;<span class="op" id="6083090">*</span><span class="ident" id="6083091">encoder</span><span class="op" id="6083098">)</span>&nbsp;<span class="ident" id="6083100">emitHuffRLE</span><span class="op" id="6083111">(</span><span class="ident" id="6083112">h</span>&nbsp;<span class="ident" id="6083114">huffIndex</span><span class="op" id="6083123">,</span>&nbsp;<span class="ident" id="6083125">runLength</span><span class="op" id="6083134">,</span>&nbsp;<span class="ident" id="6083136">value</span>&nbsp;<span class="builtintype" id="6083142">int32</span><span class="op" id="6083147">)</span>&nbsp;<span class="op" id="6083149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083152">a</span><span class="op" id="6083153">,</span>&nbsp;<span class="ident" id="6083155">b</span>&nbsp;<span class="op" id="6083157">:=</span>&nbsp;<span class="ident" id="6083160">value</span><span class="op" id="6083165">,</span>&nbsp;<span class="ident" id="6083167">value</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083174">if</span>&nbsp;<span class="ident" id="6083177">a</span>&nbsp;<span class="op" id="6083179">&lt;</span>&nbsp;<span class="num" id="6083181">0</span>&nbsp;<span class="op" id="6083183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083187">a</span><span class="op" id="6083188">,</span>&nbsp;<span class="ident" id="6083190">b</span>&nbsp;<span class="op" id="6083192">=</span>&nbsp;<span class="op" id="6083194">-</span><span class="ident" id="6083195">value</span><span class="op" id="6083200">,</span>&nbsp;<span class="ident" id="6083202">value</span><span class="op" id="6083207">-</span><span class="num" id="6083208">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6083211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083214">var</span>&nbsp;<span class="ident" id="6083218">nBits</span>&nbsp;<span class="builtintype" id="6083224">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083232">if</span>&nbsp;<span class="ident" id="6083235">a</span>&nbsp;<span class="op" id="6083237">&lt;</span>&nbsp;<span class="num" id="6083239">0x100</span>&nbsp;<span class="op" id="6083245">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083249">nBits</span>&nbsp;<span class="op" id="6083255">=</span>&nbsp;<span class="builtintype" id="6083257">uint32</span><span class="op" id="6083263">(</span><span class="ident" id="6083264">bitCount</span><span class="op" id="6083272">[</span><span class="ident" id="6083273">a</span><span class="op" id="6083274">]</span><span class="op" id="6083275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6083278">}</span>&nbsp;<span class="keyword" id="6083280">else</span>&nbsp;<span class="op" id="6083285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083289">nBits</span>&nbsp;<span class="op" id="6083295">=</span>&nbsp;<span class="num" id="6083297">8</span>&nbsp;<span class="op" id="6083299">+</span>&nbsp;<span class="builtintype" id="6083301">uint32</span><span class="op" id="6083307">(</span><span class="ident" id="6083308">bitCount</span><span class="op" id="6083316">[</span><span class="ident" id="6083317">a</span><span class="op" id="6083318">&gt;&gt;</span><span class="num" id="6083320">8</span><span class="op" id="6083321">]</span><span class="op" id="6083322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6083325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083328">e</span><span class="op" id="6083329">.</span><span class="ident" id="6083330">emitHuff</span><span class="op" id="6083338">(</span><span class="ident" id="6083339">h</span><span class="op" id="6083340">,</span>&nbsp;<span class="ident" id="6083342">runLength</span><span class="op" id="6083351">&lt;&lt;</span><span class="num" id="6083353">4</span><span class="op" id="6083354">|</span><span class="builtintype" id="6083355">int32</span><span class="op" id="6083360">(</span><span class="ident" id="6083361">nBits</span><span class="op" id="6083366">)</span><span class="op" id="6083367">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083370">if</span>&nbsp;<span class="ident" id="6083373">nBits</span>&nbsp;<span class="op" id="6083379">&gt;</span>&nbsp;<span class="num" id="6083381">0</span>&nbsp;<span class="op" id="6083383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083387">e</span><span class="op" id="6083388">.</span><span class="ident" id="6083389">emit</span><span class="op" id="6083393">(</span><span class="builtintype" id="6083394">uint32</span><span class="op" id="6083400">(</span><span class="ident" id="6083401">b</span><span class="op" id="6083402">)</span><span class="op" id="6083403">&amp;</span><span class="op" id="6083404">(</span><span class="num" id="6083405">1</span><span class="op" id="6083406">&lt;&lt;</span><span class="ident" id="6083408">nBits</span><span class="op" id="6083413">-</span><span class="num" id="6083414">1</span><span class="op" id="6083415">)</span><span class="op" id="6083416">,</span>&nbsp;<span class="ident" id="6083418">nBits</span><span class="op" id="6083423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6083426">}</span><br>
<span class="lineno"></span><span class="op" id="6083428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span><span class="comment" id="6083431">//&nbsp;writeMarkerHeader&nbsp;writes&nbsp;the&nbsp;header&nbsp;for&nbsp;a&nbsp;marker&nbsp;with&nbsp;the&nbsp;given&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="6083506">func</span>&nbsp;<span class="op" id="6083511">(</span><span class="ident" id="6083512">e</span>&nbsp;<span class="op" id="6083514">*</span><span class="ident" id="6083515">encoder</span><span class="op" id="6083522">)</span>&nbsp;<span class="ident" id="6083524">writeMarkerHeader</span><span class="op" id="6083541">(</span><span class="ident" id="6083542">marker</span>&nbsp;<span class="builtintype" id="6083549">uint8</span><span class="op" id="6083554">,</span>&nbsp;<span class="ident" id="6083556">markerlen</span>&nbsp;<span class="builtintype" id="6083566">int</span><span class="op" id="6083569">)</span>&nbsp;<span class="op" id="6083571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083574">e</span><span class="op" id="6083575">.</span><span class="ident" id="6083576">buf</span><span class="op" id="6083579">[</span><span class="num" id="6083580">0</span><span class="op" id="6083581">]</span>&nbsp;<span class="op" id="6083583">=</span>&nbsp;<span class="num" id="6083585">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083591">e</span><span class="op" id="6083592">.</span><span class="ident" id="6083593">buf</span><span class="op" id="6083596">[</span><span class="num" id="6083597">1</span><span class="op" id="6083598">]</span>&nbsp;<span class="op" id="6083600">=</span>&nbsp;<span class="ident" id="6083602">marker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083610">e</span><span class="op" id="6083611">.</span><span class="ident" id="6083612">buf</span><span class="op" id="6083615">[</span><span class="num" id="6083616">2</span><span class="op" id="6083617">]</span>&nbsp;<span class="op" id="6083619">=</span>&nbsp;<span class="builtintype" id="6083621">uint8</span><span class="op" id="6083626">(</span><span class="ident" id="6083627">markerlen</span>&nbsp;<span class="op" id="6083637">&gt;&gt;</span>&nbsp;<span class="num" id="6083640">8</span><span class="op" id="6083641">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083644">e</span><span class="op" id="6083645">.</span><span class="ident" id="6083646">buf</span><span class="op" id="6083649">[</span><span class="num" id="6083650">3</span><span class="op" id="6083651">]</span>&nbsp;<span class="op" id="6083653">=</span>&nbsp;<span class="builtintype" id="6083655">uint8</span><span class="op" id="6083660">(</span><span class="ident" id="6083661">markerlen</span>&nbsp;<span class="op" id="6083671">&amp;</span>&nbsp;<span class="num" id="6083673">0xff</span><span class="op" id="6083677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083680">e</span><span class="op" id="6083681">.</span><span class="ident" id="6083682">write</span><span class="op" id="6083687">(</span><span class="ident" id="6083688">e</span><span class="op" id="6083689">.</span><span class="ident" id="6083690">buf</span><span class="op" id="6083693">[</span><span class="op" id="6083694">:</span><span class="num" id="6083695">4</span><span class="op" id="6083696">]</span><span class="op" id="6083697">)</span><br>
<span class="lineno"></span><span class="op" id="6083699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6083702">//&nbsp;writeDQT&nbsp;writes&nbsp;the&nbsp;Define&nbsp;Quantization&nbsp;Table&nbsp;marker.</span><br>
<span class="lineno">305</span><span class="keyword" id="6083759">func</span>&nbsp;<span class="op" id="6083764">(</span><span class="ident" id="6083765">e</span>&nbsp;<span class="op" id="6083767">*</span><span class="ident" id="6083768">encoder</span><span class="op" id="6083775">)</span>&nbsp;<span class="ident" id="6083777">writeDQT</span><span class="op" id="6083785">(</span><span class="op" id="6083786">)</span>&nbsp;<span class="op" id="6083788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083791">const</span>&nbsp;<span class="ident" id="6083797">markerlen</span>&nbsp;<span class="op" id="6083807">=</span>&nbsp;<span class="num" id="6083809">2</span>&nbsp;<span class="op" id="6083811">+</span>&nbsp;<span class="builtintype" id="6083813">int</span><span class="op" id="6083816">(</span><span class="ident" id="6083817">nQuantIndex</span><span class="op" id="6083828">)</span><span class="op" id="6083829">*</span><span class="op" id="6083830">(</span><span class="num" id="6083831">1</span><span class="op" id="6083832">+</span><span class="ident" id="6083833">blockSize</span><span class="op" id="6083842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083845">e</span><span class="op" id="6083846">.</span><span class="ident" id="6083847">writeMarkerHeader</span><span class="op" id="6083864">(</span><span class="ident" id="6083865">dqtMarker</span><span class="op" id="6083874">,</span>&nbsp;<span class="ident" id="6083876">markerlen</span><span class="op" id="6083885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083888">for</span>&nbsp;<span class="ident" id="6083892">i</span>&nbsp;<span class="op" id="6083894">:=</span>&nbsp;<span class="keyword" id="6083897">range</span>&nbsp;<span class="ident" id="6083903">e</span><span class="op" id="6083904">.</span><span class="ident" id="6083905">quant</span>&nbsp;<span class="op" id="6083911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083915">e</span><span class="op" id="6083916">.</span><span class="ident" id="6083917">writeByte</span><span class="op" id="6083926">(</span><span class="builtintype" id="6083927">uint8</span><span class="op" id="6083932">(</span><span class="ident" id="6083933">i</span><span class="op" id="6083934">)</span><span class="op" id="6083935">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083939">e</span><span class="op" id="6083940">.</span><span class="ident" id="6083941">write</span><span class="op" id="6083946">(</span><span class="ident" id="6083947">e</span><span class="op" id="6083948">.</span><span class="ident" id="6083949">quant</span><span class="op" id="6083954">[</span><span class="ident" id="6083955">i</span><span class="op" id="6083956">]</span><span class="op" id="6083957">[</span><span class="op" id="6083958">:</span><span class="op" id="6083959">]</span><span class="op" id="6083960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6083963">}</span><br>
<span class="lineno"></span><span class="op" id="6083965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6083968">//&nbsp;writeSOF0&nbsp;writes&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Frame&nbsp;(Baseline)&nbsp;marker.</span><br>
<span class="lineno">315</span><span class="keyword" id="6084026">func</span>&nbsp;<span class="op" id="6084031">(</span><span class="ident" id="6084032">e</span>&nbsp;<span class="op" id="6084034">*</span><span class="ident" id="6084035">encoder</span><span class="op" id="6084042">)</span>&nbsp;<span class="ident" id="6084044">writeSOF0</span><span class="op" id="6084053">(</span><span class="ident" id="6084054">size</span>&nbsp;<span class="ident" id="6084059">image</span><span class="op" id="6084064">.</span><span class="ident" id="6084065">Point</span><span class="op" id="6084070">,</span>&nbsp;<span class="ident" id="6084072">nComponent</span>&nbsp;<span class="builtintype" id="6084083">int</span><span class="op" id="6084086">)</span>&nbsp;<span class="op" id="6084088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084091">markerlen</span>&nbsp;<span class="op" id="6084101">:=</span>&nbsp;<span class="num" id="6084104">8</span>&nbsp;<span class="op" id="6084106">+</span>&nbsp;<span class="num" id="6084108">3</span><span class="op" id="6084109">*</span><span class="ident" id="6084110">nComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084122">e</span><span class="op" id="6084123">.</span><span class="ident" id="6084124">writeMarkerHeader</span><span class="op" id="6084141">(</span><span class="ident" id="6084142">sof0Marker</span><span class="op" id="6084152">,</span>&nbsp;<span class="ident" id="6084154">markerlen</span><span class="op" id="6084163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084166">e</span><span class="op" id="6084167">.</span><span class="ident" id="6084168">buf</span><span class="op" id="6084171">[</span><span class="num" id="6084172">0</span><span class="op" id="6084173">]</span>&nbsp;<span class="op" id="6084175">=</span>&nbsp;<span class="num" id="6084177">8</span>&nbsp;<span class="comment" id="6084179">//&nbsp;8-bit&nbsp;color.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084196">e</span><span class="op" id="6084197">.</span><span class="ident" id="6084198">buf</span><span class="op" id="6084201">[</span><span class="num" id="6084202">1</span><span class="op" id="6084203">]</span>&nbsp;<span class="op" id="6084205">=</span>&nbsp;<span class="builtintype" id="6084207">uint8</span><span class="op" id="6084212">(</span><span class="ident" id="6084213">size</span><span class="op" id="6084217">.</span><span class="ident" id="6084218">Y</span>&nbsp;<span class="op" id="6084220">&gt;&gt;</span>&nbsp;<span class="num" id="6084223">8</span><span class="op" id="6084224">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084227">e</span><span class="op" id="6084228">.</span><span class="ident" id="6084229">buf</span><span class="op" id="6084232">[</span><span class="num" id="6084233">2</span><span class="op" id="6084234">]</span>&nbsp;<span class="op" id="6084236">=</span>&nbsp;<span class="builtintype" id="6084238">uint8</span><span class="op" id="6084243">(</span><span class="ident" id="6084244">size</span><span class="op" id="6084248">.</span><span class="ident" id="6084249">Y</span>&nbsp;<span class="op" id="6084251">&amp;</span>&nbsp;<span class="num" id="6084253">0xff</span><span class="op" id="6084257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084260">e</span><span class="op" id="6084261">.</span><span class="ident" id="6084262">buf</span><span class="op" id="6084265">[</span><span class="num" id="6084266">3</span><span class="op" id="6084267">]</span>&nbsp;<span class="op" id="6084269">=</span>&nbsp;<span class="builtintype" id="6084271">uint8</span><span class="op" id="6084276">(</span><span class="ident" id="6084277">size</span><span class="op" id="6084281">.</span><span class="ident" id="6084282">X</span>&nbsp;<span class="op" id="6084284">&gt;&gt;</span>&nbsp;<span class="num" id="6084287">8</span><span class="op" id="6084288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084291">e</span><span class="op" id="6084292">.</span><span class="ident" id="6084293">buf</span><span class="op" id="6084296">[</span><span class="num" id="6084297">4</span><span class="op" id="6084298">]</span>&nbsp;<span class="op" id="6084300">=</span>&nbsp;<span class="builtintype" id="6084302">uint8</span><span class="op" id="6084307">(</span><span class="ident" id="6084308">size</span><span class="op" id="6084312">.</span><span class="ident" id="6084313">X</span>&nbsp;<span class="op" id="6084315">&amp;</span>&nbsp;<span class="num" id="6084317">0xff</span><span class="op" id="6084321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084324">e</span><span class="op" id="6084325">.</span><span class="ident" id="6084326">buf</span><span class="op" id="6084329">[</span><span class="num" id="6084330">5</span><span class="op" id="6084331">]</span>&nbsp;<span class="op" id="6084333">=</span>&nbsp;<span class="builtintype" id="6084335">uint8</span><span class="op" id="6084340">(</span><span class="ident" id="6084341">nComponent</span><span class="op" id="6084351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084354">if</span>&nbsp;<span class="ident" id="6084357">nComponent</span>&nbsp;<span class="op" id="6084368">==</span>&nbsp;<span class="num" id="6084371">1</span>&nbsp;<span class="op" id="6084373">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084377">e</span><span class="op" id="6084378">.</span><span class="ident" id="6084379">buf</span><span class="op" id="6084382">[</span><span class="num" id="6084383">6</span><span class="op" id="6084384">]</span>&nbsp;<span class="op" id="6084386">=</span>&nbsp;<span class="num" id="6084388">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6084392">//&nbsp;No&nbsp;subsampling&nbsp;for&nbsp;grayscale&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084433">e</span><span class="op" id="6084434">.</span><span class="ident" id="6084435">buf</span><span class="op" id="6084438">[</span><span class="num" id="6084439">7</span><span class="op" id="6084440">]</span>&nbsp;<span class="op" id="6084442">=</span>&nbsp;<span class="num" id="6084444">0x11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084451">e</span><span class="op" id="6084452">.</span><span class="ident" id="6084453">buf</span><span class="op" id="6084456">[</span><span class="num" id="6084457">8</span><span class="op" id="6084458">]</span>&nbsp;<span class="op" id="6084460">=</span>&nbsp;<span class="num" id="6084462">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6084468">}</span>&nbsp;<span class="keyword" id="6084470">else</span>&nbsp;<span class="op" id="6084475">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084479">for</span>&nbsp;<span class="ident" id="6084483">i</span>&nbsp;<span class="op" id="6084485">:=</span>&nbsp;<span class="num" id="6084488">0</span><span class="op" id="6084489">;</span>&nbsp;<span class="ident" id="6084491">i</span>&nbsp;<span class="op" id="6084493">&lt;</span>&nbsp;<span class="ident" id="6084495">nComponent</span><span class="op" id="6084505">;</span>&nbsp;<span class="ident" id="6084507">i</span><span class="op" id="6084508">++</span>&nbsp;<span class="op" id="6084511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084516">e</span><span class="op" id="6084517">.</span><span class="ident" id="6084518">buf</span><span class="op" id="6084521">[</span><span class="num" id="6084522">3</span><span class="op" id="6084523">*</span><span class="ident" id="6084524">i</span><span class="op" id="6084525">+</span><span class="num" id="6084526">6</span><span class="op" id="6084527">]</span>&nbsp;<span class="op" id="6084529">=</span>&nbsp;<span class="builtintype" id="6084531">uint8</span><span class="op" id="6084536">(</span><span class="ident" id="6084537">i</span>&nbsp;<span class="op" id="6084539">+</span>&nbsp;<span class="num" id="6084541">1</span><span class="op" id="6084542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6084547">//&nbsp;We&nbsp;use&nbsp;4:2:0&nbsp;chroma&nbsp;subsampling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084586">e</span><span class="op" id="6084587">.</span><span class="ident" id="6084588">buf</span><span class="op" id="6084591">[</span><span class="num" id="6084592">3</span><span class="op" id="6084593">*</span><span class="ident" id="6084594">i</span><span class="op" id="6084595">+</span><span class="num" id="6084596">7</span><span class="op" id="6084597">]</span>&nbsp;<span class="op" id="6084599">=</span>&nbsp;<span class="string" id="6084601">&#34;\x22\x11\x11&#34;</span><span class="op" id="6084615">[</span><span class="ident" id="6084616">i</span><span class="op" id="6084617">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084622">e</span><span class="op" id="6084623">.</span><span class="ident" id="6084624">buf</span><span class="op" id="6084627">[</span><span class="num" id="6084628">3</span><span class="op" id="6084629">*</span><span class="ident" id="6084630">i</span><span class="op" id="6084631">+</span><span class="num" id="6084632">8</span><span class="op" id="6084633">]</span>&nbsp;<span class="op" id="6084635">=</span>&nbsp;<span class="string" id="6084637">&#34;\x00\x01\x01&#34;</span><span class="op" id="6084651">[</span><span class="ident" id="6084652">i</span><span class="op" id="6084653">]</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6084657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6084660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084663">e</span><span class="op" id="6084664">.</span><span class="ident" id="6084665">write</span><span class="op" id="6084670">(</span><span class="ident" id="6084671">e</span><span class="op" id="6084672">.</span><span class="ident" id="6084673">buf</span><span class="op" id="6084676">[</span><span class="op" id="6084677">:</span><span class="num" id="6084678">3</span><span class="op" id="6084679">*</span><span class="op" id="6084680">(</span><span class="ident" id="6084681">nComponent</span><span class="op" id="6084691">-</span><span class="num" id="6084692">1</span><span class="op" id="6084693">)</span><span class="op" id="6084694">+</span><span class="num" id="6084695">9</span><span class="op" id="6084696">]</span><span class="op" id="6084697">)</span><br>
<span class="lineno"></span><span class="op" id="6084699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="6084702">//&nbsp;writeDHT&nbsp;writes&nbsp;the&nbsp;Define&nbsp;Huffman&nbsp;Table&nbsp;marker.</span><br>
<span class="lineno"></span><span class="keyword" id="6084754">func</span>&nbsp;<span class="op" id="6084759">(</span><span class="ident" id="6084760">e</span>&nbsp;<span class="op" id="6084762">*</span><span class="ident" id="6084763">encoder</span><span class="op" id="6084770">)</span>&nbsp;<span class="ident" id="6084772">writeDHT</span><span class="op" id="6084780">(</span><span class="ident" id="6084781">nComponent</span>&nbsp;<span class="builtintype" id="6084792">int</span><span class="op" id="6084795">)</span>&nbsp;<span class="op" id="6084797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084800">markerlen</span>&nbsp;<span class="op" id="6084810">:=</span>&nbsp;<span class="num" id="6084813">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084816">specs</span>&nbsp;<span class="op" id="6084822">:=</span>&nbsp;<span class="ident" id="6084825">theHuffmanSpec</span><span class="op" id="6084839">[</span><span class="op" id="6084840">:</span><span class="op" id="6084841">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084844">if</span>&nbsp;<span class="ident" id="6084847">nComponent</span>&nbsp;<span class="op" id="6084858">==</span>&nbsp;<span class="num" id="6084861">1</span>&nbsp;<span class="op" id="6084863">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6084867">//&nbsp;Drop&nbsp;the&nbsp;Chrominance&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084901">specs</span>&nbsp;<span class="op" id="6084907">=</span>&nbsp;<span class="ident" id="6084909">specs</span><span class="op" id="6084914">[</span><span class="op" id="6084915">:</span><span class="num" id="6084916">2</span><span class="op" id="6084917">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6084920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084923">for</span>&nbsp;<span class="ident" id="6084927">_</span><span class="op" id="6084928">,</span>&nbsp;<span class="ident" id="6084930">s</span>&nbsp;<span class="op" id="6084932">:=</span>&nbsp;<span class="keyword" id="6084935">range</span>&nbsp;<span class="ident" id="6084941">specs</span>&nbsp;<span class="op" id="6084947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084951">markerlen</span>&nbsp;<span class="op" id="6084961">+=</span>&nbsp;<span class="num" id="6084964">1</span>&nbsp;<span class="op" id="6084966">+</span>&nbsp;<span class="num" id="6084968">16</span>&nbsp;<span class="op" id="6084971">+</span>&nbsp;<span class="builtinfunc" id="6084973">len</span><span class="op" id="6084976">(</span><span class="ident" id="6084977">s</span><span class="op" id="6084978">.</span><span class="ident" id="6084979">value</span><span class="op" id="6084984">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6084987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084990">e</span><span class="op" id="6084991">.</span><span class="ident" id="6084992">writeMarkerHeader</span><span class="op" id="6085009">(</span><span class="ident" id="6085010">dhtMarker</span><span class="op" id="6085019">,</span>&nbsp;<span class="ident" id="6085021">markerlen</span><span class="op" id="6085030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085033">for</span>&nbsp;<span class="ident" id="6085037">i</span><span class="op" id="6085038">,</span>&nbsp;<span class="ident" id="6085040">s</span>&nbsp;<span class="op" id="6085042">:=</span>&nbsp;<span class="keyword" id="6085045">range</span>&nbsp;<span class="ident" id="6085051">specs</span>&nbsp;<span class="op" id="6085057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085061">e</span><span class="op" id="6085062">.</span><span class="ident" id="6085063">writeByte</span><span class="op" id="6085072">(</span><span class="string" id="6085073">&#34;\x00\x10\x01\x11&#34;</span><span class="op" id="6085091">[</span><span class="ident" id="6085092">i</span><span class="op" id="6085093">]</span><span class="op" id="6085094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085098">e</span><span class="op" id="6085099">.</span><span class="ident" id="6085100">write</span><span class="op" id="6085105">(</span><span class="ident" id="6085106">s</span><span class="op" id="6085107">.</span><span class="ident" id="6085108">count</span><span class="op" id="6085113">[</span><span class="op" id="6085114">:</span><span class="op" id="6085115">]</span><span class="op" id="6085116">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085120">e</span><span class="op" id="6085121">.</span><span class="ident" id="6085122">write</span><span class="op" id="6085127">(</span><span class="ident" id="6085128">s</span><span class="op" id="6085129">.</span><span class="ident" id="6085130">value</span><span class="op" id="6085135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6085138">}</span><br>
<span class="lineno"></span><span class="op" id="6085140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6085143">//&nbsp;writeBlock&nbsp;writes&nbsp;a&nbsp;block&nbsp;of&nbsp;pixel&nbsp;data&nbsp;using&nbsp;the&nbsp;given&nbsp;quantization&nbsp;table,</span><br>
<span class="lineno">360</span><span class="comment" id="6085222">//&nbsp;returning&nbsp;the&nbsp;post-quantized&nbsp;DC&nbsp;value&nbsp;of&nbsp;the&nbsp;DCT-transformed&nbsp;block.&nbsp;b&nbsp;is&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="6085301">//&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="6085333">func</span>&nbsp;<span class="op" id="6085338">(</span><span class="ident" id="6085339">e</span>&nbsp;<span class="op" id="6085341">*</span><span class="ident" id="6085342">encoder</span><span class="op" id="6085349">)</span>&nbsp;<span class="ident" id="6085351">writeBlock</span><span class="op" id="6085361">(</span><span class="ident" id="6085362">b</span>&nbsp;<span class="op" id="6085364">*</span><span class="ident" id="6085365">block</span><span class="op" id="6085370">,</span>&nbsp;<span class="ident" id="6085372">q</span>&nbsp;<span class="ident" id="6085374">quantIndex</span><span class="op" id="6085384">,</span>&nbsp;<span class="ident" id="6085386">prevDC</span>&nbsp;<span class="builtintype" id="6085393">int32</span><span class="op" id="6085398">)</span>&nbsp;<span class="builtintype" id="6085400">int32</span>&nbsp;<span class="op" id="6085406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085409">fdct</span><span class="op" id="6085413">(</span><span class="ident" id="6085414">b</span><span class="op" id="6085415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6085418">//&nbsp;Emit&nbsp;the&nbsp;DC&nbsp;delta.</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085441">dc</span>&nbsp;<span class="op" id="6085444">:=</span>&nbsp;<span class="ident" id="6085447">div</span><span class="op" id="6085450">(</span><span class="ident" id="6085451">b</span><span class="op" id="6085452">[</span><span class="num" id="6085453">0</span><span class="op" id="6085454">]</span><span class="op" id="6085455">,</span>&nbsp;<span class="num" id="6085457">8</span><span class="op" id="6085458">*</span><span class="builtintype" id="6085459">int32</span><span class="op" id="6085464">(</span><span class="ident" id="6085465">e</span><span class="op" id="6085466">.</span><span class="ident" id="6085467">quant</span><span class="op" id="6085472">[</span><span class="ident" id="6085473">q</span><span class="op" id="6085474">]</span><span class="op" id="6085475">[</span><span class="num" id="6085476">0</span><span class="op" id="6085477">]</span><span class="op" id="6085478">)</span><span class="op" id="6085479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085482">e</span><span class="op" id="6085483">.</span><span class="ident" id="6085484">emitHuffRLE</span><span class="op" id="6085495">(</span><span class="ident" id="6085496">huffIndex</span><span class="op" id="6085505">(</span><span class="num" id="6085506">2</span><span class="op" id="6085507">*</span><span class="ident" id="6085508">q</span><span class="op" id="6085509">+</span><span class="num" id="6085510">0</span><span class="op" id="6085511">)</span><span class="op" id="6085512">,</span>&nbsp;<span class="num" id="6085514">0</span><span class="op" id="6085515">,</span>&nbsp;<span class="ident" id="6085517">dc</span><span class="op" id="6085519">-</span><span class="ident" id="6085520">prevDC</span><span class="op" id="6085526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6085529">//&nbsp;Emit&nbsp;the&nbsp;AC&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085557">h</span><span class="op" id="6085558">,</span>&nbsp;<span class="ident" id="6085560">runLength</span>&nbsp;<span class="op" id="6085570">:=</span>&nbsp;<span class="ident" id="6085573">huffIndex</span><span class="op" id="6085582">(</span><span class="num" id="6085583">2</span><span class="op" id="6085584">*</span><span class="ident" id="6085585">q</span><span class="op" id="6085586">+</span><span class="num" id="6085587">1</span><span class="op" id="6085588">)</span><span class="op" id="6085589">,</span>&nbsp;<span class="builtintype" id="6085591">int32</span><span class="op" id="6085596">(</span><span class="num" id="6085597">0</span><span class="op" id="6085598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085601">for</span>&nbsp;<span class="ident" id="6085605">zig</span>&nbsp;<span class="op" id="6085609">:=</span>&nbsp;<span class="num" id="6085612">1</span><span class="op" id="6085613">;</span>&nbsp;<span class="ident" id="6085615">zig</span>&nbsp;<span class="op" id="6085619">&lt;</span>&nbsp;<span class="ident" id="6085621">blockSize</span><span class="op" id="6085630">;</span>&nbsp;<span class="ident" id="6085632">zig</span><span class="op" id="6085635">++</span>&nbsp;<span class="op" id="6085638">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085642">ac</span>&nbsp;<span class="op" id="6085645">:=</span>&nbsp;<span class="ident" id="6085648">div</span><span class="op" id="6085651">(</span><span class="ident" id="6085652">b</span><span class="op" id="6085653">[</span><span class="ident" id="6085654">unzig</span><span class="op" id="6085659">[</span><span class="ident" id="6085660">zig</span><span class="op" id="6085663">]</span><span class="op" id="6085664">]</span><span class="op" id="6085665">,</span>&nbsp;<span class="num" id="6085667">8</span><span class="op" id="6085668">*</span><span class="builtintype" id="6085669">int32</span><span class="op" id="6085674">(</span><span class="ident" id="6085675">e</span><span class="op" id="6085676">.</span><span class="ident" id="6085677">quant</span><span class="op" id="6085682">[</span><span class="ident" id="6085683">q</span><span class="op" id="6085684">]</span><span class="op" id="6085685">[</span><span class="ident" id="6085686">zig</span><span class="op" id="6085689">]</span><span class="op" id="6085690">)</span><span class="op" id="6085691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085695">if</span>&nbsp;<span class="ident" id="6085698">ac</span>&nbsp;<span class="op" id="6085701">==</span>&nbsp;<span class="num" id="6085704">0</span>&nbsp;<span class="op" id="6085706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085711">runLength</span><span class="op" id="6085720">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6085725">}</span>&nbsp;<span class="keyword" id="6085727">else</span>&nbsp;<span class="op" id="6085732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085737">for</span>&nbsp;<span class="ident" id="6085741">runLength</span>&nbsp;<span class="op" id="6085751">&gt;</span>&nbsp;<span class="num" id="6085753">15</span>&nbsp;<span class="op" id="6085756">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085762">e</span><span class="op" id="6085763">.</span><span class="ident" id="6085764">emitHuff</span><span class="op" id="6085772">(</span><span class="ident" id="6085773">h</span><span class="op" id="6085774">,</span>&nbsp;<span class="num" id="6085776">0xf0</span><span class="op" id="6085780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085786">runLength</span>&nbsp;<span class="op" id="6085796">-=</span>&nbsp;<span class="num" id="6085799">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6085805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085810">e</span><span class="op" id="6085811">.</span><span class="ident" id="6085812">emitHuffRLE</span><span class="op" id="6085823">(</span><span class="ident" id="6085824">h</span><span class="op" id="6085825">,</span>&nbsp;<span class="ident" id="6085827">runLength</span><span class="op" id="6085836">,</span>&nbsp;<span class="ident" id="6085838">ac</span><span class="op" id="6085840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085845">runLength</span>&nbsp;<span class="op" id="6085855">=</span>&nbsp;<span class="num" id="6085857">0</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6085861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6085864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085867">if</span>&nbsp;<span class="ident" id="6085870">runLength</span>&nbsp;<span class="op" id="6085880">&gt;</span>&nbsp;<span class="num" id="6085882">0</span>&nbsp;<span class="op" id="6085884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085888">e</span><span class="op" id="6085889">.</span><span class="ident" id="6085890">emitHuff</span><span class="op" id="6085898">(</span><span class="ident" id="6085899">h</span><span class="op" id="6085900">,</span>&nbsp;<span class="num" id="6085902">0x00</span><span class="op" id="6085906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6085909">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085912">return</span>&nbsp;<span class="ident" id="6085919">dc</span><br>
<span class="lineno"></span><span class="op" id="6085922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6085925">//&nbsp;toYCbCr&nbsp;converts&nbsp;the&nbsp;8x8&nbsp;region&nbsp;of&nbsp;m&nbsp;whose&nbsp;top-left&nbsp;corner&nbsp;is&nbsp;p&nbsp;to&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="6085999">//&nbsp;YCbCr&nbsp;values.</span><br>
<span class="lineno">390</span><span class="keyword" id="6086016">func</span>&nbsp;<span class="ident" id="6086021">toYCbCr</span><span class="op" id="6086028">(</span><span class="ident" id="6086029">m</span>&nbsp;<span class="ident" id="6086031">image</span><span class="op" id="6086036">.</span><span class="ident" id="6086037">Image</span><span class="op" id="6086042">,</span>&nbsp;<span class="ident" id="6086044">p</span>&nbsp;<span class="ident" id="6086046">image</span><span class="op" id="6086051">.</span><span class="ident" id="6086052">Point</span><span class="op" id="6086057">,</span>&nbsp;<span class="ident" id="6086059">yBlock</span><span class="op" id="6086065">,</span>&nbsp;<span class="ident" id="6086067">cbBlock</span><span class="op" id="6086074">,</span>&nbsp;<span class="ident" id="6086076">crBlock</span>&nbsp;<span class="op" id="6086084">*</span><span class="ident" id="6086085">block</span><span class="op" id="6086090">)</span>&nbsp;<span class="op" id="6086092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086095">b</span>&nbsp;<span class="op" id="6086097">:=</span>&nbsp;<span class="ident" id="6086100">m</span><span class="op" id="6086101">.</span><span class="ident" id="6086102">Bounds</span><span class="op" id="6086108">(</span><span class="op" id="6086109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086112">xmax</span>&nbsp;<span class="op" id="6086117">:=</span>&nbsp;<span class="ident" id="6086120">b</span><span class="op" id="6086121">.</span><span class="ident" id="6086122">Max</span><span class="op" id="6086125">.</span><span class="ident" id="6086126">X</span>&nbsp;<span class="op" id="6086128">-</span>&nbsp;<span class="num" id="6086130">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086133">ymax</span>&nbsp;<span class="op" id="6086138">:=</span>&nbsp;<span class="ident" id="6086141">b</span><span class="op" id="6086142">.</span><span class="ident" id="6086143">Max</span><span class="op" id="6086146">.</span><span class="ident" id="6086147">Y</span>&nbsp;<span class="op" id="6086149">-</span>&nbsp;<span class="num" id="6086151">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086154">for</span>&nbsp;<span class="ident" id="6086158">j</span>&nbsp;<span class="op" id="6086160">:=</span>&nbsp;<span class="num" id="6086163">0</span><span class="op" id="6086164">;</span>&nbsp;<span class="ident" id="6086166">j</span>&nbsp;<span class="op" id="6086168">&lt;</span>&nbsp;<span class="num" id="6086170">8</span><span class="op" id="6086171">;</span>&nbsp;<span class="ident" id="6086173">j</span><span class="op" id="6086174">++</span>&nbsp;<span class="op" id="6086177">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086181">for</span>&nbsp;<span class="ident" id="6086185">i</span>&nbsp;<span class="op" id="6086187">:=</span>&nbsp;<span class="num" id="6086190">0</span><span class="op" id="6086191">;</span>&nbsp;<span class="ident" id="6086193">i</span>&nbsp;<span class="op" id="6086195">&lt;</span>&nbsp;<span class="num" id="6086197">8</span><span class="op" id="6086198">;</span>&nbsp;<span class="ident" id="6086200">i</span><span class="op" id="6086201">++</span>&nbsp;<span class="op" id="6086204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086209">r</span><span class="op" id="6086210">,</span>&nbsp;<span class="ident" id="6086212">g</span><span class="op" id="6086213">,</span>&nbsp;<span class="ident" id="6086215">b</span><span class="op" id="6086216">,</span>&nbsp;<span class="ident" id="6086218">_</span>&nbsp;<span class="op" id="6086220">:=</span>&nbsp;<span class="ident" id="6086223">m</span><span class="op" id="6086224">.</span><span class="ident" id="6086225">At</span><span class="op" id="6086227">(</span><span class="ident" id="6086228">min</span><span class="op" id="6086231">(</span><span class="ident" id="6086232">p</span><span class="op" id="6086233">.</span><span class="ident" id="6086234">X</span><span class="op" id="6086235">+</span><span class="ident" id="6086236">i</span><span class="op" id="6086237">,</span>&nbsp;<span class="ident" id="6086239">xmax</span><span class="op" id="6086243">)</span><span class="op" id="6086244">,</span>&nbsp;<span class="ident" id="6086246">min</span><span class="op" id="6086249">(</span><span class="ident" id="6086250">p</span><span class="op" id="6086251">.</span><span class="ident" id="6086252">Y</span><span class="op" id="6086253">+</span><span class="ident" id="6086254">j</span><span class="op" id="6086255">,</span>&nbsp;<span class="ident" id="6086257">ymax</span><span class="op" id="6086261">)</span><span class="op" id="6086262">)</span><span class="op" id="6086263">.</span><span class="ident" id="6086264">RGBA</span><span class="op" id="6086268">(</span><span class="op" id="6086269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086274">yy</span><span class="op" id="6086276">,</span>&nbsp;<span class="ident" id="6086278">cb</span><span class="op" id="6086280">,</span>&nbsp;<span class="ident" id="6086282">cr</span>&nbsp;<span class="op" id="6086285">:=</span>&nbsp;<span class="ident" id="6086288">color</span><span class="op" id="6086293">.</span><span class="ident" id="6086294">RGBToYCbCr</span><span class="op" id="6086304">(</span><span class="builtintype" id="6086305">uint8</span><span class="op" id="6086310">(</span><span class="ident" id="6086311">r</span><span class="op" id="6086312">&gt;&gt;</span><span class="num" id="6086314">8</span><span class="op" id="6086315">)</span><span class="op" id="6086316">,</span>&nbsp;<span class="builtintype" id="6086318">uint8</span><span class="op" id="6086323">(</span><span class="ident" id="6086324">g</span><span class="op" id="6086325">&gt;&gt;</span><span class="num" id="6086327">8</span><span class="op" id="6086328">)</span><span class="op" id="6086329">,</span>&nbsp;<span class="builtintype" id="6086331">uint8</span><span class="op" id="6086336">(</span><span class="ident" id="6086337">b</span><span class="op" id="6086338">&gt;&gt;</span><span class="num" id="6086340">8</span><span class="op" id="6086341">)</span><span class="op" id="6086342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086347">yBlock</span><span class="op" id="6086353">[</span><span class="num" id="6086354">8</span><span class="op" id="6086355">*</span><span class="ident" id="6086356">j</span><span class="op" id="6086357">+</span><span class="ident" id="6086358">i</span><span class="op" id="6086359">]</span>&nbsp;<span class="op" id="6086361">=</span>&nbsp;<span class="builtintype" id="6086363">int32</span><span class="op" id="6086368">(</span><span class="ident" id="6086369">yy</span><span class="op" id="6086371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086376">cbBlock</span><span class="op" id="6086383">[</span><span class="num" id="6086384">8</span><span class="op" id="6086385">*</span><span class="ident" id="6086386">j</span><span class="op" id="6086387">+</span><span class="ident" id="6086388">i</span><span class="op" id="6086389">]</span>&nbsp;<span class="op" id="6086391">=</span>&nbsp;<span class="builtintype" id="6086393">int32</span><span class="op" id="6086398">(</span><span class="ident" id="6086399">cb</span><span class="op" id="6086401">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086406">crBlock</span><span class="op" id="6086413">[</span><span class="num" id="6086414">8</span><span class="op" id="6086415">*</span><span class="ident" id="6086416">j</span><span class="op" id="6086417">+</span><span class="ident" id="6086418">i</span><span class="op" id="6086419">]</span>&nbsp;<span class="op" id="6086421">=</span>&nbsp;<span class="builtintype" id="6086423">int32</span><span class="op" id="6086428">(</span><span class="ident" id="6086429">cr</span><span class="op" id="6086431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6086435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6086438">}</span><br>
<span class="lineno"></span><span class="op" id="6086440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span><span class="comment" id="6086443">//&nbsp;grayToY&nbsp;stores&nbsp;the&nbsp;8x8&nbsp;region&nbsp;of&nbsp;m&nbsp;whose&nbsp;top-left&nbsp;corner&nbsp;is&nbsp;p&nbsp;in&nbsp;yBlock.</span><br>
<span class="lineno"></span><span class="keyword" id="6086519">func</span>&nbsp;<span class="ident" id="6086524">grayToY</span><span class="op" id="6086531">(</span><span class="ident" id="6086532">m</span>&nbsp;<span class="op" id="6086534">*</span><span class="ident" id="6086535">image</span><span class="op" id="6086540">.</span><span class="ident" id="6086541">Gray</span><span class="op" id="6086545">,</span>&nbsp;<span class="ident" id="6086547">p</span>&nbsp;<span class="ident" id="6086549">image</span><span class="op" id="6086554">.</span><span class="ident" id="6086555">Point</span><span class="op" id="6086560">,</span>&nbsp;<span class="ident" id="6086562">yBlock</span>&nbsp;<span class="op" id="6086569">*</span><span class="ident" id="6086570">block</span><span class="op" id="6086575">)</span>&nbsp;<span class="op" id="6086577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086580">b</span>&nbsp;<span class="op" id="6086582">:=</span>&nbsp;<span class="ident" id="6086585">m</span><span class="op" id="6086586">.</span><span class="ident" id="6086587">Bounds</span><span class="op" id="6086593">(</span><span class="op" id="6086594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086597">xmax</span>&nbsp;<span class="op" id="6086602">:=</span>&nbsp;<span class="ident" id="6086605">b</span><span class="op" id="6086606">.</span><span class="ident" id="6086607">Max</span><span class="op" id="6086610">.</span><span class="ident" id="6086611">X</span>&nbsp;<span class="op" id="6086613">-</span>&nbsp;<span class="num" id="6086615">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086618">ymax</span>&nbsp;<span class="op" id="6086623">:=</span>&nbsp;<span class="ident" id="6086626">b</span><span class="op" id="6086627">.</span><span class="ident" id="6086628">Max</span><span class="op" id="6086631">.</span><span class="ident" id="6086632">Y</span>&nbsp;<span class="op" id="6086634">-</span>&nbsp;<span class="num" id="6086636">1</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086639">pix</span>&nbsp;<span class="op" id="6086643">:=</span>&nbsp;<span class="ident" id="6086646">m</span><span class="op" id="6086647">.</span><span class="ident" id="6086648">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086653">for</span>&nbsp;<span class="ident" id="6086657">j</span>&nbsp;<span class="op" id="6086659">:=</span>&nbsp;<span class="num" id="6086662">0</span><span class="op" id="6086663">;</span>&nbsp;<span class="ident" id="6086665">j</span>&nbsp;<span class="op" id="6086667">&lt;</span>&nbsp;<span class="num" id="6086669">8</span><span class="op" id="6086670">;</span>&nbsp;<span class="ident" id="6086672">j</span><span class="op" id="6086673">++</span>&nbsp;<span class="op" id="6086676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086680">for</span>&nbsp;<span class="ident" id="6086684">i</span>&nbsp;<span class="op" id="6086686">:=</span>&nbsp;<span class="num" id="6086689">0</span><span class="op" id="6086690">;</span>&nbsp;<span class="ident" id="6086692">i</span>&nbsp;<span class="op" id="6086694">&lt;</span>&nbsp;<span class="num" id="6086696">8</span><span class="op" id="6086697">;</span>&nbsp;<span class="ident" id="6086699">i</span><span class="op" id="6086700">++</span>&nbsp;<span class="op" id="6086703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086708">idx</span>&nbsp;<span class="op" id="6086712">:=</span>&nbsp;<span class="ident" id="6086715">m</span><span class="op" id="6086716">.</span><span class="ident" id="6086717">PixOffset</span><span class="op" id="6086726">(</span><span class="ident" id="6086727">min</span><span class="op" id="6086730">(</span><span class="ident" id="6086731">p</span><span class="op" id="6086732">.</span><span class="ident" id="6086733">X</span><span class="op" id="6086734">+</span><span class="ident" id="6086735">i</span><span class="op" id="6086736">,</span>&nbsp;<span class="ident" id="6086738">xmax</span><span class="op" id="6086742">)</span><span class="op" id="6086743">,</span>&nbsp;<span class="ident" id="6086745">min</span><span class="op" id="6086748">(</span><span class="ident" id="6086749">p</span><span class="op" id="6086750">.</span><span class="ident" id="6086751">Y</span><span class="op" id="6086752">+</span><span class="ident" id="6086753">j</span><span class="op" id="6086754">,</span>&nbsp;<span class="ident" id="6086756">ymax</span><span class="op" id="6086760">)</span><span class="op" id="6086761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086766">yBlock</span><span class="op" id="6086772">[</span><span class="num" id="6086773">8</span><span class="op" id="6086774">*</span><span class="ident" id="6086775">j</span><span class="op" id="6086776">+</span><span class="ident" id="6086777">i</span><span class="op" id="6086778">]</span>&nbsp;<span class="op" id="6086780">=</span>&nbsp;<span class="builtintype" id="6086782">int32</span><span class="op" id="6086787">(</span><span class="ident" id="6086788">pix</span><span class="op" id="6086791">[</span><span class="ident" id="6086792">idx</span><span class="op" id="6086795">]</span><span class="op" id="6086796">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6086800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6086803">}</span><br>
<span class="lineno"></span><span class="op" id="6086805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6086808">//&nbsp;rgbaToYCbCr&nbsp;is&nbsp;a&nbsp;specialized&nbsp;version&nbsp;of&nbsp;toYCbCr&nbsp;for&nbsp;image.RGBA&nbsp;images.</span><br>
<span class="lineno">420</span><span class="keyword" id="6086882">func</span>&nbsp;<span class="ident" id="6086887">rgbaToYCbCr</span><span class="op" id="6086898">(</span><span class="ident" id="6086899">m</span>&nbsp;<span class="op" id="6086901">*</span><span class="ident" id="6086902">image</span><span class="op" id="6086907">.</span><span class="ident" id="6086908">RGBA</span><span class="op" id="6086912">,</span>&nbsp;<span class="ident" id="6086914">p</span>&nbsp;<span class="ident" id="6086916">image</span><span class="op" id="6086921">.</span><span class="ident" id="6086922">Point</span><span class="op" id="6086927">,</span>&nbsp;<span class="ident" id="6086929">yBlock</span><span class="op" id="6086935">,</span>&nbsp;<span class="ident" id="6086937">cbBlock</span><span class="op" id="6086944">,</span>&nbsp;<span class="ident" id="6086946">crBlock</span>&nbsp;<span class="op" id="6086954">*</span><span class="ident" id="6086955">block</span><span class="op" id="6086960">)</span>&nbsp;<span class="op" id="6086962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086965">b</span>&nbsp;<span class="op" id="6086967">:=</span>&nbsp;<span class="ident" id="6086970">m</span><span class="op" id="6086971">.</span><span class="ident" id="6086972">Bounds</span><span class="op" id="6086978">(</span><span class="op" id="6086979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086982">xmax</span>&nbsp;<span class="op" id="6086987">:=</span>&nbsp;<span class="ident" id="6086990">b</span><span class="op" id="6086991">.</span><span class="ident" id="6086992">Max</span><span class="op" id="6086995">.</span><span class="ident" id="6086996">X</span>&nbsp;<span class="op" id="6086998">-</span>&nbsp;<span class="num" id="6087000">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087003">ymax</span>&nbsp;<span class="op" id="6087008">:=</span>&nbsp;<span class="ident" id="6087011">b</span><span class="op" id="6087012">.</span><span class="ident" id="6087013">Max</span><span class="op" id="6087016">.</span><span class="ident" id="6087017">Y</span>&nbsp;<span class="op" id="6087019">-</span>&nbsp;<span class="num" id="6087021">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6087024">for</span>&nbsp;<span class="ident" id="6087028">j</span>&nbsp;<span class="op" id="6087030">:=</span>&nbsp;<span class="num" id="6087033">0</span><span class="op" id="6087034">;</span>&nbsp;<span class="ident" id="6087036">j</span>&nbsp;<span class="op" id="6087038">&lt;</span>&nbsp;<span class="num" id="6087040">8</span><span class="op" id="6087041">;</span>&nbsp;<span class="ident" id="6087043">j</span><span class="op" id="6087044">++</span>&nbsp;<span class="op" id="6087047">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087051">sj</span>&nbsp;<span class="op" id="6087054">:=</span>&nbsp;<span class="ident" id="6087057">p</span><span class="op" id="6087058">.</span><span class="ident" id="6087059">Y</span>&nbsp;<span class="op" id="6087061">+</span>&nbsp;<span class="ident" id="6087063">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6087067">if</span>&nbsp;<span class="ident" id="6087070">sj</span>&nbsp;<span class="op" id="6087073">&gt;</span>&nbsp;<span class="ident" id="6087075">ymax</span>&nbsp;<span class="op" id="6087080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087085">sj</span>&nbsp;<span class="op" id="6087088">=</span>&nbsp;<span class="ident" id="6087090">ymax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6087097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087101">offset</span>&nbsp;<span class="op" id="6087108">:=</span>&nbsp;<span class="op" id="6087111">(</span><span class="ident" id="6087112">sj</span><span class="op" id="6087114">-</span><span class="ident" id="6087115">b</span><span class="op" id="6087116">.</span><span class="ident" id="6087117">Min</span><span class="op" id="6087120">.</span><span class="ident" id="6087121">Y</span><span class="op" id="6087122">)</span><span class="op" id="6087123">*</span><span class="ident" id="6087124">m</span><span class="op" id="6087125">.</span><span class="ident" id="6087126">Stride</span>&nbsp;<span class="op" id="6087133">-</span>&nbsp;<span class="ident" id="6087135">b</span><span class="op" id="6087136">.</span><span class="ident" id="6087137">Min</span><span class="op" id="6087140">.</span><span class="ident" id="6087141">X</span><span class="op" id="6087142">*</span><span class="num" id="6087143">4</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6087147">for</span>&nbsp;<span class="ident" id="6087151">i</span>&nbsp;<span class="op" id="6087153">:=</span>&nbsp;<span class="num" id="6087156">0</span><span class="op" id="6087157">;</span>&nbsp;<span class="ident" id="6087159">i</span>&nbsp;<span class="op" id="6087161">&lt;</span>&nbsp;<span class="num" id="6087163">8</span><span class="op" id="6087164">;</span>&nbsp;<span class="ident" id="6087166">i</span><span class="op" id="6087167">++</span>&nbsp;<span class="op" id="6087170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087175">sx</span>&nbsp;<span class="op" id="6087178">:=</span>&nbsp;<span class="ident" id="6087181">p</span><span class="op" id="6087182">.</span><span class="ident" id="6087183">X</span>&nbsp;<span class="op" id="6087185">+</span>&nbsp;<span class="ident" id="6087187">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6087192">if</span>&nbsp;<span class="ident" id="6087195">sx</span>&nbsp;<span class="op" id="6087198">&gt;</span>&nbsp;<span class="ident" id="6087200">xmax</span>&nbsp;<span class="op" id="6087205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087211">sx</span>&nbsp;<span class="op" id="6087214">=</span>&nbsp;<span class="ident" id="6087216">xmax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6087224">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087229">pix</span>&nbsp;<span class="op" id="6087233">:=</span>&nbsp;<span class="ident" id="6087236">m</span><span class="op" id="6087237">.</span><span class="ident" id="6087238">Pix</span><span class="op" id="6087241">[</span><span class="ident" id="6087242">offset</span><span class="op" id="6087248">+</span><span class="ident" id="6087249">sx</span><span class="op" id="6087251">*</span><span class="num" id="6087252">4</span><span class="op" id="6087253">:</span><span class="op" id="6087254">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087259">yy</span><span class="op" id="6087261">,</span>&nbsp;<span class="ident" id="6087263">cb</span><span class="op" id="6087265">,</span>&nbsp;<span class="ident" id="6087267">cr</span>&nbsp;<span class="op" id="6087270">:=</span>&nbsp;<span class="ident" id="6087273">color</span><span class="op" id="6087278">.</span><span class="ident" id="6087279">RGBToYCbCr</span><span class="op" id="6087289">(</span><span class="ident" id="6087290">pix</span><span class="op" id="6087293">[</span><span class="num" id="6087294">0</span><span class="op" id="6087295">]</span><span class="op" id="6087296">,</span>&nbsp;<span class="ident" id="6087298">pix</span><span class="op" id="6087301">[</span><span class="num" id="6087302">1</span><span class="op" id="6087303">]</span><span class="op" id="6087304">,</span>&nbsp;<span class="ident" id="6087306">pix</span><span class="op" id="6087309">[</span><span class="num" id="6087310">2</span><span class="op" id="6087311">]</span><span class="op" id="6087312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087317">yBlock</span><span class="op" id="6087323">[</span><span class="num" id="6087324">8</span><span class="op" id="6087325">*</span><span class="ident" id="6087326">j</span><span class="op" id="6087327">+</span><span class="ident" id="6087328">i</span><span class="op" id="6087329">]</span>&nbsp;<span class="op" id="6087331">=</span>&nbsp;<span class="builtintype" id="6087333">int32</span><span class="op" id="6087338">(</span><span class="ident" id="6087339">yy</span><span class="op" id="6087341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087346">cbBlock</span><span class="op" id="6087353">[</span><span class="num" id="6087354">8</span><span class="op" id="6087355">*</span><span class="ident" id="6087356">j</span><span class="op" id="6087357">+</span><span class="ident" id="6087358">i</span><span class="op" id="6087359">]</span>&nbsp;<span class="op" id="6087361">=</span>&nbsp;<span class="builtintype" id="6087363">int32</span><span class="op" id="6087368">(</span><span class="ident" id="6087369">cb</span><span class="op" id="6087371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087376">crBlock</span><span class="op" id="6087383">[</span><span class="num" id="6087384">8</span><span class="op" id="6087385">*</span><span class="ident" id="6087386">j</span><span class="op" id="6087387">+</span><span class="ident" id="6087388">i</span><span class="op" id="6087389">]</span>&nbsp;<span class="op" id="6087391">=</span>&nbsp;<span class="builtintype" id="6087393">int32</span><span class="op" id="6087398">(</span><span class="ident" id="6087399">cr</span><span class="op" id="6087401">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6087405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6087408">}</span><br>
<span class="lineno"></span><span class="op" id="6087410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6087413">//&nbsp;scale&nbsp;scales&nbsp;the&nbsp;16x16&nbsp;region&nbsp;represented&nbsp;by&nbsp;the&nbsp;4&nbsp;src&nbsp;blocks&nbsp;to&nbsp;the&nbsp;8x8</span><br>
<span class="lineno">445</span><span class="comment" id="6087489">//&nbsp;dst&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="6087503">func</span>&nbsp;<span class="ident" id="6087508">scale</span><span class="op" id="6087513">(</span><span class="ident" id="6087514">dst</span>&nbsp;<span class="op" id="6087518">*</span><span class="ident" id="6087519">block</span><span class="op" id="6087524">,</span>&nbsp;<span class="ident" id="6087526">src</span>&nbsp;<span class="op" id="6087530">*</span><span class="op" id="6087531">[</span><span class="num" id="6087532">4</span><span class="op" id="6087533">]</span><span class="ident" id="6087534">block</span><span class="op" id="6087539">)</span>&nbsp;<span class="op" id="6087541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6087544">for</span>&nbsp;<span class="ident" id="6087548">i</span>&nbsp;<span class="op" id="6087550">:=</span>&nbsp;<span class="num" id="6087553">0</span><span class="op" id="6087554">;</span>&nbsp;<span class="ident" id="6087556">i</span>&nbsp;<span class="op" id="6087558">&lt;</span>&nbsp;<span class="num" id="6087560">4</span><span class="op" id="6087561">;</span>&nbsp;<span class="ident" id="6087563">i</span><span class="op" id="6087564">++</span>&nbsp;<span class="op" id="6087567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087571">dstOff</span>&nbsp;<span class="op" id="6087578">:=</span>&nbsp;<span class="op" id="6087581">(</span><span class="ident" id="6087582">i</span><span class="op" id="6087583">&amp;</span><span class="num" id="6087584">2</span><span class="op" id="6087585">)</span><span class="op" id="6087586">&lt;&lt;</span><span class="num" id="6087588">4</span>&nbsp;<span class="op" id="6087590">|</span>&nbsp;<span class="op" id="6087592">(</span><span class="ident" id="6087593">i</span><span class="op" id="6087594">&amp;</span><span class="num" id="6087595">1</span><span class="op" id="6087596">)</span><span class="op" id="6087597">&lt;&lt;</span><span class="num" id="6087599">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6087603">for</span>&nbsp;<span class="ident" id="6087607">y</span>&nbsp;<span class="op" id="6087609">:=</span>&nbsp;<span class="num" id="6087612">0</span><span class="op" id="6087613">;</span>&nbsp;<span class="ident" id="6087615">y</span>&nbsp;<span class="op" id="6087617">&lt;</span>&nbsp;<span class="num" id="6087619">4</span><span class="op" id="6087620">;</span>&nbsp;<span class="ident" id="6087622">y</span><span class="op" id="6087623">++</span>&nbsp;<span class="op" id="6087626">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6087631">for</span>&nbsp;<span class="ident" id="6087635">x</span>&nbsp;<span class="op" id="6087637">:=</span>&nbsp;<span class="num" id="6087640">0</span><span class="op" id="6087641">;</span>&nbsp;<span class="ident" id="6087643">x</span>&nbsp;<span class="op" id="6087645">&lt;</span>&nbsp;<span class="num" id="6087647">4</span><span class="op" id="6087648">;</span>&nbsp;<span class="ident" id="6087650">x</span><span class="op" id="6087651">++</span>&nbsp;<span class="op" id="6087654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087660">j</span>&nbsp;<span class="op" id="6087662">:=</span>&nbsp;<span class="num" id="6087665">16</span><span class="op" id="6087667">*</span><span class="ident" id="6087668">y</span>&nbsp;<span class="op" id="6087670">+</span>&nbsp;<span class="num" id="6087672">2</span><span class="op" id="6087673">*</span><span class="ident" id="6087674">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087680">sum</span>&nbsp;<span class="op" id="6087684">:=</span>&nbsp;<span class="ident" id="6087687">src</span><span class="op" id="6087690">[</span><span class="ident" id="6087691">i</span><span class="op" id="6087692">]</span><span class="op" id="6087693">[</span><span class="ident" id="6087694">j</span><span class="op" id="6087695">]</span>&nbsp;<span class="op" id="6087697">+</span>&nbsp;<span class="ident" id="6087699">src</span><span class="op" id="6087702">[</span><span class="ident" id="6087703">i</span><span class="op" id="6087704">]</span><span class="op" id="6087705">[</span><span class="ident" id="6087706">j</span><span class="op" id="6087707">+</span><span class="num" id="6087708">1</span><span class="op" id="6087709">]</span>&nbsp;<span class="op" id="6087711">+</span>&nbsp;<span class="ident" id="6087713">src</span><span class="op" id="6087716">[</span><span class="ident" id="6087717">i</span><span class="op" id="6087718">]</span><span class="op" id="6087719">[</span><span class="ident" id="6087720">j</span><span class="op" id="6087721">+</span><span class="num" id="6087722">8</span><span class="op" id="6087723">]</span>&nbsp;<span class="op" id="6087725">+</span>&nbsp;<span class="ident" id="6087727">src</span><span class="op" id="6087730">[</span><span class="ident" id="6087731">i</span><span class="op" id="6087732">]</span><span class="op" id="6087733">[</span><span class="ident" id="6087734">j</span><span class="op" id="6087735">+</span><span class="num" id="6087736">9</span><span class="op" id="6087737">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087743">dst</span><span class="op" id="6087746">[</span><span class="num" id="6087747">8</span><span class="op" id="6087748">*</span><span class="ident" id="6087749">y</span><span class="op" id="6087750">+</span><span class="ident" id="6087751">x</span><span class="op" id="6087752">+</span><span class="ident" id="6087753">dstOff</span><span class="op" id="6087759">]</span>&nbsp;<span class="op" id="6087761">=</span>&nbsp;<span class="op" id="6087763">(</span><span class="ident" id="6087764">sum</span>&nbsp;<span class="op" id="6087768">+</span>&nbsp;<span class="num" id="6087770">2</span><span class="op" id="6087771">)</span>&nbsp;<span class="op" id="6087773">&gt;&gt;</span>&nbsp;<span class="num" id="6087776">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6087781">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6087785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6087788">}</span><br>
<span class="lineno"></span><span class="op" id="6087790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6087793">//&nbsp;sosHeaderY&nbsp;is&nbsp;the&nbsp;SOS&nbsp;marker&nbsp;&#34;\xff\xda&#34;&nbsp;followed&nbsp;by&nbsp;8&nbsp;bytes:</span><br>
<span class="lineno">460</span><span class="comment" id="6087857">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;marker&nbsp;length&nbsp;&#34;\x00\x08&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6087892">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;number&nbsp;of&nbsp;components&nbsp;&#34;\x01&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6087930">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;1&nbsp;uses&nbsp;DC&nbsp;table&nbsp;0&nbsp;and&nbsp;AC&nbsp;table&nbsp;0&nbsp;&#34;\x01\x00&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6087990">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;bytes&nbsp;&#34;\x00\x3f\x00&#34;.&nbsp;Section&nbsp;B.2.3&nbsp;of&nbsp;the&nbsp;spec&nbsp;says&nbsp;that&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6088061">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;sequential&nbsp;DCTs,&nbsp;those&nbsp;bytes&nbsp;(8-bit&nbsp;Ss,&nbsp;8-bit&nbsp;Se,&nbsp;4-bit&nbsp;Ah,&nbsp;4-bit&nbsp;Al)</span><br>
<span class="lineno">465</span><span class="comment" id="6088136">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;should&nbsp;be&nbsp;0x00,&nbsp;0x3f,&nbsp;0x00&lt;&lt;4&nbsp;|&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="6088179">var</span>&nbsp;<span class="ident" id="6088183">sosHeaderY</span>&nbsp;<span class="op" id="6088194">=</span>&nbsp;<span class="op" id="6088196">[</span><span class="op" id="6088197">]</span><span class="builtintype" id="6088198">byte</span><span class="op" id="6088202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6088205">0xff</span><span class="op" id="6088209">,</span>&nbsp;<span class="num" id="6088211">0xda</span><span class="op" id="6088215">,</span>&nbsp;<span class="num" id="6088217">0x00</span><span class="op" id="6088221">,</span>&nbsp;<span class="num" id="6088223">0x08</span><span class="op" id="6088227">,</span>&nbsp;<span class="num" id="6088229">0x01</span><span class="op" id="6088233">,</span>&nbsp;<span class="num" id="6088235">0x01</span><span class="op" id="6088239">,</span>&nbsp;<span class="num" id="6088241">0x00</span><span class="op" id="6088245">,</span>&nbsp;<span class="num" id="6088247">0x00</span><span class="op" id="6088251">,</span>&nbsp;<span class="num" id="6088253">0x3f</span><span class="op" id="6088257">,</span>&nbsp;<span class="num" id="6088259">0x00</span><span class="op" id="6088263">,</span><br>
<span class="lineno"></span><span class="op" id="6088265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="comment" id="6088268">//&nbsp;sosHeaderYCbCr&nbsp;is&nbsp;the&nbsp;SOS&nbsp;marker&nbsp;&#34;\xff\xda&#34;&nbsp;followed&nbsp;by&nbsp;12&nbsp;bytes:</span><br>
<span class="lineno"></span><span class="comment" id="6088337">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;marker&nbsp;length&nbsp;&#34;\x00\x0c&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6088372">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;number&nbsp;of&nbsp;components&nbsp;&#34;\x03&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6088410">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;1&nbsp;uses&nbsp;DC&nbsp;table&nbsp;0&nbsp;and&nbsp;AC&nbsp;table&nbsp;0&nbsp;&#34;\x01\x00&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6088470">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;2&nbsp;uses&nbsp;DC&nbsp;table&nbsp;1&nbsp;and&nbsp;AC&nbsp;table&nbsp;1&nbsp;&#34;\x02\x11&#34;,</span><br>
<span class="lineno">475</span><span class="comment" id="6088530">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;3&nbsp;uses&nbsp;DC&nbsp;table&nbsp;1&nbsp;and&nbsp;AC&nbsp;table&nbsp;1&nbsp;&#34;\x03\x11&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6088590">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;bytes&nbsp;&#34;\x00\x3f\x00&#34;.&nbsp;Section&nbsp;B.2.3&nbsp;of&nbsp;the&nbsp;spec&nbsp;says&nbsp;that&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6088661">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;sequential&nbsp;DCTs,&nbsp;those&nbsp;bytes&nbsp;(8-bit&nbsp;Ss,&nbsp;8-bit&nbsp;Se,&nbsp;4-bit&nbsp;Ah,&nbsp;4-bit&nbsp;Al)</span><br>
<span class="lineno"></span><span class="comment" id="6088736">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;should&nbsp;be&nbsp;0x00,&nbsp;0x3f,&nbsp;0x00&lt;&lt;4&nbsp;|&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="6088779">var</span>&nbsp;<span class="ident" id="6088783">sosHeaderYCbCr</span>&nbsp;<span class="op" id="6088798">=</span>&nbsp;<span class="op" id="6088800">[</span><span class="op" id="6088801">]</span><span class="builtintype" id="6088802">byte</span><span class="op" id="6088806">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6088809">0xff</span><span class="op" id="6088813">,</span>&nbsp;<span class="num" id="6088815">0xda</span><span class="op" id="6088819">,</span>&nbsp;<span class="num" id="6088821">0x00</span><span class="op" id="6088825">,</span>&nbsp;<span class="num" id="6088827">0x0c</span><span class="op" id="6088831">,</span>&nbsp;<span class="num" id="6088833">0x03</span><span class="op" id="6088837">,</span>&nbsp;<span class="num" id="6088839">0x01</span><span class="op" id="6088843">,</span>&nbsp;<span class="num" id="6088845">0x00</span><span class="op" id="6088849">,</span>&nbsp;<span class="num" id="6088851">0x02</span><span class="op" id="6088855">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6088858">0x11</span><span class="op" id="6088862">,</span>&nbsp;<span class="num" id="6088864">0x03</span><span class="op" id="6088868">,</span>&nbsp;<span class="num" id="6088870">0x11</span><span class="op" id="6088874">,</span>&nbsp;<span class="num" id="6088876">0x00</span><span class="op" id="6088880">,</span>&nbsp;<span class="num" id="6088882">0x3f</span><span class="op" id="6088886">,</span>&nbsp;<span class="num" id="6088888">0x00</span><span class="op" id="6088892">,</span><br>
<span class="lineno"></span><span class="op" id="6088894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6088897">//&nbsp;writeSOS&nbsp;writes&nbsp;the&nbsp;StartOfScan&nbsp;marker.</span><br>
<span class="lineno">485</span><span class="keyword" id="6088940">func</span>&nbsp;<span class="op" id="6088945">(</span><span class="ident" id="6088946">e</span>&nbsp;<span class="op" id="6088948">*</span><span class="ident" id="6088949">encoder</span><span class="op" id="6088956">)</span>&nbsp;<span class="ident" id="6088958">writeSOS</span><span class="op" id="6088966">(</span><span class="ident" id="6088967">m</span>&nbsp;<span class="ident" id="6088969">image</span><span class="op" id="6088974">.</span><span class="ident" id="6088975">Image</span><span class="op" id="6088980">)</span>&nbsp;<span class="op" id="6088982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6088985">switch</span>&nbsp;<span class="ident" id="6088992">m</span><span class="op" id="6088993">.</span><span class="op" id="6088994">(</span><span class="keyword" id="6088995">type</span><span class="op" id="6088999">)</span>&nbsp;<span class="op" id="6089001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089004">case</span>&nbsp;<span class="op" id="6089009">*</span><span class="ident" id="6089010">image</span><span class="op" id="6089015">.</span><span class="ident" id="6089016">Gray</span><span class="op" id="6089020">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089024">e</span><span class="op" id="6089025">.</span><span class="ident" id="6089026">write</span><span class="op" id="6089031">(</span><span class="ident" id="6089032">sosHeaderY</span><span class="op" id="6089042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089045">default</span><span class="op" id="6089052">:</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089056">e</span><span class="op" id="6089057">.</span><span class="ident" id="6089058">write</span><span class="op" id="6089063">(</span><span class="ident" id="6089064">sosHeaderYCbCr</span><span class="op" id="6089078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6089081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089084">var</span>&nbsp;<span class="op" id="6089088">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6089092">//&nbsp;Scratch&nbsp;buffers&nbsp;to&nbsp;hold&nbsp;the&nbsp;YCbCr&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6089139">//&nbsp;The&nbsp;blocks&nbsp;are&nbsp;in&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089191">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6089198">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089206">cb</span><span class="op" id="6089208">,</span>&nbsp;<span class="ident" id="6089210">cr</span>&nbsp;<span class="op" id="6089213">[</span><span class="num" id="6089214">4</span><span class="op" id="6089215">]</span><span class="ident" id="6089216">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6089224">//&nbsp;DC&nbsp;components&nbsp;are&nbsp;delta-encoded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089262">prevDCY</span><span class="op" id="6089269">,</span>&nbsp;<span class="ident" id="6089271">prevDCCb</span><span class="op" id="6089279">,</span>&nbsp;<span class="ident" id="6089281">prevDCCr</span>&nbsp;<span class="builtintype" id="6089290">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6089297">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089300">bounds</span>&nbsp;<span class="op" id="6089307">:=</span>&nbsp;<span class="ident" id="6089310">m</span><span class="op" id="6089311">.</span><span class="ident" id="6089312">Bounds</span><span class="op" id="6089318">(</span><span class="op" id="6089319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089322">switch</span>&nbsp;<span class="ident" id="6089329">m</span>&nbsp;<span class="op" id="6089331">:=</span>&nbsp;<span class="ident" id="6089334">m</span><span class="op" id="6089335">.</span><span class="op" id="6089336">(</span><span class="keyword" id="6089337">type</span><span class="op" id="6089341">)</span>&nbsp;<span class="op" id="6089343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6089346">//&nbsp;TODO(wathiede):&nbsp;switch&nbsp;on&nbsp;m.ColorModel()&nbsp;instead&nbsp;of&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089408">case</span>&nbsp;<span class="op" id="6089413">*</span><span class="ident" id="6089414">image</span><span class="op" id="6089419">.</span><span class="ident" id="6089420">Gray</span><span class="op" id="6089424">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089428">for</span>&nbsp;<span class="ident" id="6089432">y</span>&nbsp;<span class="op" id="6089434">:=</span>&nbsp;<span class="ident" id="6089437">bounds</span><span class="op" id="6089443">.</span><span class="ident" id="6089444">Min</span><span class="op" id="6089447">.</span><span class="ident" id="6089448">Y</span><span class="op" id="6089449">;</span>&nbsp;<span class="ident" id="6089451">y</span>&nbsp;<span class="op" id="6089453">&lt;</span>&nbsp;<span class="ident" id="6089455">bounds</span><span class="op" id="6089461">.</span><span class="ident" id="6089462">Max</span><span class="op" id="6089465">.</span><span class="ident" id="6089466">Y</span><span class="op" id="6089467">;</span>&nbsp;<span class="ident" id="6089469">y</span>&nbsp;<span class="op" id="6089471">+=</span>&nbsp;<span class="num" id="6089474">8</span>&nbsp;<span class="op" id="6089476">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089481">for</span>&nbsp;<span class="ident" id="6089485">x</span>&nbsp;<span class="op" id="6089487">:=</span>&nbsp;<span class="ident" id="6089490">bounds</span><span class="op" id="6089496">.</span><span class="ident" id="6089497">Min</span><span class="op" id="6089500">.</span><span class="ident" id="6089501">X</span><span class="op" id="6089502">;</span>&nbsp;<span class="ident" id="6089504">x</span>&nbsp;<span class="op" id="6089506">&lt;</span>&nbsp;<span class="ident" id="6089508">bounds</span><span class="op" id="6089514">.</span><span class="ident" id="6089515">Max</span><span class="op" id="6089518">.</span><span class="ident" id="6089519">X</span><span class="op" id="6089520">;</span>&nbsp;<span class="ident" id="6089522">x</span>&nbsp;<span class="op" id="6089524">+=</span>&nbsp;<span class="num" id="6089527">8</span>&nbsp;<span class="op" id="6089529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089535">p</span>&nbsp;<span class="op" id="6089537">:=</span>&nbsp;<span class="ident" id="6089540">image</span><span class="op" id="6089545">.</span><span class="ident" id="6089546">Pt</span><span class="op" id="6089548">(</span><span class="ident" id="6089549">x</span><span class="op" id="6089550">,</span>&nbsp;<span class="ident" id="6089552">y</span><span class="op" id="6089553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089559">grayToY</span><span class="op" id="6089566">(</span><span class="ident" id="6089567">m</span><span class="op" id="6089568">,</span>&nbsp;<span class="ident" id="6089570">p</span><span class="op" id="6089571">,</span>&nbsp;<span class="op" id="6089573">&amp;</span><span class="ident" id="6089574">b</span><span class="op" id="6089575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089581">prevDCY</span>&nbsp;<span class="op" id="6089589">=</span>&nbsp;<span class="ident" id="6089591">e</span><span class="op" id="6089592">.</span><span class="ident" id="6089593">writeBlock</span><span class="op" id="6089603">(</span><span class="op" id="6089604">&amp;</span><span class="ident" id="6089605">b</span><span class="op" id="6089606">,</span>&nbsp;<span class="num" id="6089608">0</span><span class="op" id="6089609">,</span>&nbsp;<span class="ident" id="6089611">prevDCY</span><span class="op" id="6089618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6089623">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6089627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089630">default</span><span class="op" id="6089637">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089641">rgba</span><span class="op" id="6089645">,</span>&nbsp;<span class="ident" id="6089647">_</span>&nbsp;<span class="op" id="6089649">:=</span>&nbsp;<span class="ident" id="6089652">m</span><span class="op" id="6089653">.</span><span class="op" id="6089654">(</span><span class="op" id="6089655">*</span><span class="ident" id="6089656">image</span><span class="op" id="6089661">.</span><span class="ident" id="6089662">RGBA</span><span class="op" id="6089666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089670">for</span>&nbsp;<span class="ident" id="6089674">y</span>&nbsp;<span class="op" id="6089676">:=</span>&nbsp;<span class="ident" id="6089679">bounds</span><span class="op" id="6089685">.</span><span class="ident" id="6089686">Min</span><span class="op" id="6089689">.</span><span class="ident" id="6089690">Y</span><span class="op" id="6089691">;</span>&nbsp;<span class="ident" id="6089693">y</span>&nbsp;<span class="op" id="6089695">&lt;</span>&nbsp;<span class="ident" id="6089697">bounds</span><span class="op" id="6089703">.</span><span class="ident" id="6089704">Max</span><span class="op" id="6089707">.</span><span class="ident" id="6089708">Y</span><span class="op" id="6089709">;</span>&nbsp;<span class="ident" id="6089711">y</span>&nbsp;<span class="op" id="6089713">+=</span>&nbsp;<span class="num" id="6089716">16</span>&nbsp;<span class="op" id="6089719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089724">for</span>&nbsp;<span class="ident" id="6089728">x</span>&nbsp;<span class="op" id="6089730">:=</span>&nbsp;<span class="ident" id="6089733">bounds</span><span class="op" id="6089739">.</span><span class="ident" id="6089740">Min</span><span class="op" id="6089743">.</span><span class="ident" id="6089744">X</span><span class="op" id="6089745">;</span>&nbsp;<span class="ident" id="6089747">x</span>&nbsp;<span class="op" id="6089749">&lt;</span>&nbsp;<span class="ident" id="6089751">bounds</span><span class="op" id="6089757">.</span><span class="ident" id="6089758">Max</span><span class="op" id="6089761">.</span><span class="ident" id="6089762">X</span><span class="op" id="6089763">;</span>&nbsp;<span class="ident" id="6089765">x</span>&nbsp;<span class="op" id="6089767">+=</span>&nbsp;<span class="num" id="6089770">16</span>&nbsp;<span class="op" id="6089773">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089779">for</span>&nbsp;<span class="ident" id="6089783">i</span>&nbsp;<span class="op" id="6089785">:=</span>&nbsp;<span class="num" id="6089788">0</span><span class="op" id="6089789">;</span>&nbsp;<span class="ident" id="6089791">i</span>&nbsp;<span class="op" id="6089793">&lt;</span>&nbsp;<span class="num" id="6089795">4</span><span class="op" id="6089796">;</span>&nbsp;<span class="ident" id="6089798">i</span><span class="op" id="6089799">++</span>&nbsp;<span class="op" id="6089802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089809">xOff</span>&nbsp;<span class="op" id="6089814">:=</span>&nbsp;<span class="op" id="6089817">(</span><span class="ident" id="6089818">i</span>&nbsp;<span class="op" id="6089820">&amp;</span>&nbsp;<span class="num" id="6089822">1</span><span class="op" id="6089823">)</span>&nbsp;<span class="op" id="6089825">*</span>&nbsp;<span class="num" id="6089827">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089834">yOff</span>&nbsp;<span class="op" id="6089839">:=</span>&nbsp;<span class="op" id="6089842">(</span><span class="ident" id="6089843">i</span>&nbsp;<span class="op" id="6089845">&amp;</span>&nbsp;<span class="num" id="6089847">2</span><span class="op" id="6089848">)</span>&nbsp;<span class="op" id="6089850">*</span>&nbsp;<span class="num" id="6089852">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089859">p</span>&nbsp;<span class="op" id="6089861">:=</span>&nbsp;<span class="ident" id="6089864">image</span><span class="op" id="6089869">.</span><span class="ident" id="6089870">Pt</span><span class="op" id="6089872">(</span><span class="ident" id="6089873">x</span><span class="op" id="6089874">+</span><span class="ident" id="6089875">xOff</span><span class="op" id="6089879">,</span>&nbsp;<span class="ident" id="6089881">y</span><span class="op" id="6089882">+</span><span class="ident" id="6089883">yOff</span><span class="op" id="6089887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089894">if</span>&nbsp;<span class="ident" id="6089897">rgba</span>&nbsp;<span class="op" id="6089902">!=</span>&nbsp;<span class="ident" id="6089905">nil</span>&nbsp;<span class="op" id="6089909">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089917">rgbaToYCbCr</span><span class="op" id="6089928">(</span><span class="ident" id="6089929">rgba</span><span class="op" id="6089933">,</span>&nbsp;<span class="ident" id="6089935">p</span><span class="op" id="6089936">,</span>&nbsp;<span class="op" id="6089938">&amp;</span><span class="ident" id="6089939">b</span><span class="op" id="6089940">,</span>&nbsp;<span class="op" id="6089942">&amp;</span><span class="ident" id="6089943">cb</span><span class="op" id="6089945">[</span><span class="ident" id="6089946">i</span><span class="op" id="6089947">]</span><span class="op" id="6089948">,</span>&nbsp;<span class="op" id="6089950">&amp;</span><span class="ident" id="6089951">cr</span><span class="op" id="6089953">[</span><span class="ident" id="6089954">i</span><span class="op" id="6089955">]</span><span class="op" id="6089956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6089963">}</span>&nbsp;<span class="keyword" id="6089965">else</span>&nbsp;<span class="op" id="6089970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089978">toYCbCr</span><span class="op" id="6089985">(</span><span class="ident" id="6089986">m</span><span class="op" id="6089987">,</span>&nbsp;<span class="ident" id="6089989">p</span><span class="op" id="6089990">,</span>&nbsp;<span class="op" id="6089992">&amp;</span><span class="ident" id="6089993">b</span><span class="op" id="6089994">,</span>&nbsp;<span class="op" id="6089996">&amp;</span><span class="ident" id="6089997">cb</span><span class="op" id="6089999">[</span><span class="ident" id="6090000">i</span><span class="op" id="6090001">]</span><span class="op" id="6090002">,</span>&nbsp;<span class="op" id="6090004">&amp;</span><span class="ident" id="6090005">cr</span><span class="op" id="6090007">[</span><span class="ident" id="6090008">i</span><span class="op" id="6090009">]</span><span class="op" id="6090010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6090017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6090024">prevDCY</span>&nbsp;<span class="op" id="6090032">=</span>&nbsp;<span class="ident" id="6090034">e</span><span class="op" id="6090035">.</span><span class="ident" id="6090036">writeBlock</span><span class="op" id="6090046">(</span><span class="op" id="6090047">&amp;</span><span class="ident" id="6090048">b</span><span class="op" id="6090049">,</span>&nbsp;<span class="num" id="6090051">0</span><span class="op" id="6090052">,</span>&nbsp;<span class="ident" id="6090054">prevDCY</span><span class="op" id="6090061">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6090067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6090073">scale</span><span class="op" id="6090078">(</span><span class="op" id="6090079">&amp;</span><span class="ident" id="6090080">b</span><span class="op" id="6090081">,</span>&nbsp;<span class="op" id="6090083">&amp;</span><span class="ident" id="6090084">cb</span><span class="op" id="6090086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6090092">prevDCCb</span>&nbsp;<span class="op" id="6090101">=</span>&nbsp;<span class="ident" id="6090103">e</span><span class="op" id="6090104">.</span><span class="ident" id="6090105">writeBlock</span><span class="op" id="6090115">(</span><span class="op" id="6090116">&amp;</span><span class="ident" id="6090117">b</span><span class="op" id="6090118">,</span>&nbsp;<span class="num" id="6090120">1</span><span class="op" id="6090121">,</span>&nbsp;<span class="ident" id="6090123">prevDCCb</span><span class="op" id="6090131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6090137">scale</span><span class="op" id="6090142">(</span><span class="op" id="6090143">&amp;</span><span class="ident" id="6090144">b</span><span class="op" id="6090145">,</span>&nbsp;<span class="op" id="6090147">&amp;</span><span class="ident" id="6090148">cr</span><span class="op" id="6090150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6090156">prevDCCr</span>&nbsp;<span class="op" id="6090165">=</span>&nbsp;<span class="ident" id="6090167">e</span><span class="op" id="6090168">.</span><span class="ident" id="6090169">writeBlock</span><span class="op" id="6090179">(</span><span class="op" id="6090180">&amp;</span><span class="ident" id="6090181">b</span><span class="op" id="6090182">,</span>&nbsp;<span class="num" id="6090184">1</span><span class="op" id="6090185">,</span>&nbsp;<span class="ident" id="6090187">prevDCCr</span><span class="op" id="6090195">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6090200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6090204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6090207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6090210">//&nbsp;Pad&nbsp;the&nbsp;last&nbsp;byte&nbsp;with&nbsp;1&#39;s.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6090242">e</span><span class="op" id="6090243">.</span><span class="ident" id="6090244">emit</span><span class="op" id="6090248">(</span><span class="num" id="6090249">0x7f</span><span class="op" id="6090253">,</span>&nbsp;<span class="num" id="6090255">7</span><span class="op" id="6090256">)</span><br>
<span class="lineno">535</span><span class="op" id="6090258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6090261">//&nbsp;DefaultQuality&nbsp;is&nbsp;the&nbsp;default&nbsp;quality&nbsp;encoding&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="keyword" id="6090322">const</span>&nbsp;<span class="ident" id="6090328">DefaultQuality</span>&nbsp;<span class="op" id="6090343">=</span>&nbsp;<span class="num" id="6090345">75</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="6090349">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;encoding&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="comment" id="6090389">//&nbsp;Quality&nbsp;ranges&nbsp;from&nbsp;1&nbsp;to&nbsp;100&nbsp;inclusive,&nbsp;higher&nbsp;is&nbsp;better.</span><br>
<span class="lineno"></span><span class="keyword" id="6090450">type</span>&nbsp;<span class="ident" id="6090455">Options</span>&nbsp;<span class="keyword" id="6090463">struct</span>&nbsp;<span class="op" id="6090470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6090473">Quality</span>&nbsp;<span class="builtintype" id="6090481">int</span><br>
<span class="lineno"></span><span class="op" id="6090485">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="comment" id="6090488">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;Image&nbsp;m&nbsp;to&nbsp;w&nbsp;in&nbsp;JPEG&nbsp;4:2:0&nbsp;baseline&nbsp;format&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="6090567">//&nbsp;options.&nbsp;Default&nbsp;parameters&nbsp;are&nbsp;used&nbsp;if&nbsp;a&nbsp;nil&nbsp;*Options&nbsp;is&nbsp;passed.</span><br>
<span class="lineno"></span><span class="keyword" id="6090636">func</span>&nbsp;<span class="ident" id="6090641">Encode</span><span class="op" id="6090647">(</span><span class="ident" id="6090648">w</span>&nbsp;<span class="ident" id="6090650">io</span><span class="op" id="6090652">.</span><span class="ident" id="6090653">Writer</span><span class="op" id="6090659">,</span>&nbsp;<span class="ident" id="6090661">m</span>&nbsp;<span class="ident" id="6090663">image</span><span class="op" id="6090668">.</span><span class="ident" id="6090669">Image</span><span class="op" id="6090674">,</span>&nbsp;<span class="ident" id="6090676">o</span>&nbsp;<span class="op" id="6090678">*</span><span class="ident" id="6090679">Options</span><span class="op" id="6090686">)</span>&nbsp;<span class="builtintype" id="6090688">error</span>&nbsp;<span class="op" id="6090694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6090697">b</span>&nbsp;<span class="op" id="6090699">:=</span>&nbsp;<span class="ident" id="6090702">m</span><span class="op" id="6090703">.</span><span class="ident" id="6090704">Bounds</span><span class="op" id="6090710">(</span><span class="op" id="6090711">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6090714">if</span>&nbsp;<span class="ident" id="6090717">b</span><span class="op" id="6090718">.</span><span class="ident" id="6090719">Dx</span><span class="op" id="6090721">(</span><span class="op" id="6090722">)</span>&nbsp;<span class="op" id="6090724">&gt;=</span>&nbsp;<span class="num" id="6090727">1</span><span class="op" id="6090728">&lt;&lt;</span><span class="num" id="6090730">16</span>&nbsp;<span class="op" id="6090733">||</span>&nbsp;<span class="ident" id="6090736">b</span><span class="op" id="6090737">.</span><span class="ident" id="6090738">Dy</span><span class="op" id="6090740">(</span><span class="op" id="6090741">)</span>&nbsp;<span class="op" id="6090743">&gt;=</span>&nbsp;<span class="num" id="6090746">1</span><span class="op" id="6090747">&lt;&lt;</span><span class="num" id="6090749">16</span>&nbsp;<span class="op" id="6090752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6090756">return</span>&nbsp;<span class="ident" id="6090763">errors</span><span class="op" id="6090769">.</span><span class="ident" id="6090770">New</span><span class="op" id="6090773">(</span><span class="string" id="6090774">&#34;jpeg:&nbsp;image&nbsp;is&nbsp;too&nbsp;large&nbsp;to&nbsp;encode&#34;</span><span class="op" id="6090810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6090813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6090816">var</span>&nbsp;<span class="ident" id="6090820">e</span>&nbsp;<span class="ident" id="6090822">encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6090831">if</span>&nbsp;<span class="ident" id="6090834">ww</span><span class="op" id="6090836">,</span>&nbsp;<span class="ident" id="6090838">ok</span>&nbsp;<span class="op" id="6090841">:=</span>&nbsp;<span class="ident" id="6090844">w</span><span class="op" id="6090845">.</span><span class="op" id="6090846">(</span><span class="ident" id="6090847">writer</span><span class="op" id="6090853">)</span><span class="op" id="6090854">;</span>&nbsp;<span class="ident" id="6090856">ok</span>&nbsp;<span class="op" id="6090859">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6090863">e</span><span class="op" id="6090864">.</span><span class="ident" id="6090865">w</span>&nbsp;<span class="op" id="6090867">=</span>&nbsp;<span class="ident" id="6090869">ww</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6090873">}</span>&nbsp;<span class="keyword" id="6090875">else</span>&nbsp;<span class="op" id="6090880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6090884">e</span><span class="op" id="6090885">.</span><span class="ident" id="6090886">w</span>&nbsp;<span class="op" id="6090888">=</span>&nbsp;<span class="ident" id="6090890">bufio</span><span class="op" id="6090895">.</span><span class="ident" id="6090896">NewWriter</span><span class="op" id="6090905">(</span><span class="ident" id="6090906">w</span><span class="op" id="6090907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6090910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6090913">//&nbsp;Clip&nbsp;quality&nbsp;to&nbsp;[1,&nbsp;100].</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6090943">quality</span>&nbsp;<span class="op" id="6090951">:=</span>&nbsp;<span class="ident" id="6090954">DefaultQuality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6090970">if</span>&nbsp;<span class="ident" id="6090973">o</span>&nbsp;<span class="op" id="6090975">!=</span>&nbsp;<span class="ident" id="6090978">nil</span>&nbsp;<span class="op" id="6090982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6090986">quality</span>&nbsp;<span class="op" id="6090994">=</span>&nbsp;<span class="ident" id="6090996">o</span><span class="op" id="6090997">.</span><span class="ident" id="6090998">Quality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091008">if</span>&nbsp;<span class="ident" id="6091011">quality</span>&nbsp;<span class="op" id="6091019">&lt;</span>&nbsp;<span class="num" id="6091021">1</span>&nbsp;<span class="op" id="6091023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091028">quality</span>&nbsp;<span class="op" id="6091036">=</span>&nbsp;<span class="num" id="6091038">1</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091042">}</span>&nbsp;<span class="keyword" id="6091044">else</span>&nbsp;<span class="keyword" id="6091049">if</span>&nbsp;<span class="ident" id="6091052">quality</span>&nbsp;<span class="op" id="6091060">&gt;</span>&nbsp;<span class="num" id="6091062">100</span>&nbsp;<span class="op" id="6091066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091071">quality</span>&nbsp;<span class="op" id="6091079">=</span>&nbsp;<span class="num" id="6091081">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6091093">//&nbsp;Convert&nbsp;from&nbsp;a&nbsp;quality&nbsp;rating&nbsp;to&nbsp;a&nbsp;scaling&nbsp;factor.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091148">var</span>&nbsp;<span class="ident" id="6091152">scale</span>&nbsp;<span class="builtintype" id="6091158">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091163">if</span>&nbsp;<span class="ident" id="6091166">quality</span>&nbsp;<span class="op" id="6091174">&lt;</span>&nbsp;<span class="num" id="6091176">50</span>&nbsp;<span class="op" id="6091179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091183">scale</span>&nbsp;<span class="op" id="6091189">=</span>&nbsp;<span class="num" id="6091191">5000</span>&nbsp;<span class="op" id="6091196">/</span>&nbsp;<span class="ident" id="6091198">quality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091207">}</span>&nbsp;<span class="keyword" id="6091209">else</span>&nbsp;<span class="op" id="6091214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091218">scale</span>&nbsp;<span class="op" id="6091224">=</span>&nbsp;<span class="num" id="6091226">200</span>&nbsp;<span class="op" id="6091230">-</span>&nbsp;<span class="ident" id="6091232">quality</span><span class="op" id="6091239">*</span><span class="num" id="6091240">2</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6091246">//&nbsp;Initialize&nbsp;the&nbsp;quantization&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091286">for</span>&nbsp;<span class="ident" id="6091290">i</span>&nbsp;<span class="op" id="6091292">:=</span>&nbsp;<span class="keyword" id="6091295">range</span>&nbsp;<span class="ident" id="6091301">e</span><span class="op" id="6091302">.</span><span class="ident" id="6091303">quant</span>&nbsp;<span class="op" id="6091309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091313">for</span>&nbsp;<span class="ident" id="6091317">j</span>&nbsp;<span class="op" id="6091319">:=</span>&nbsp;<span class="keyword" id="6091322">range</span>&nbsp;<span class="ident" id="6091328">e</span><span class="op" id="6091329">.</span><span class="ident" id="6091330">quant</span><span class="op" id="6091335">[</span><span class="ident" id="6091336">i</span><span class="op" id="6091337">]</span>&nbsp;<span class="op" id="6091339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091344">x</span>&nbsp;<span class="op" id="6091346">:=</span>&nbsp;<span class="builtintype" id="6091349">int</span><span class="op" id="6091352">(</span><span class="ident" id="6091353">unscaledQuant</span><span class="op" id="6091366">[</span><span class="ident" id="6091367">i</span><span class="op" id="6091368">]</span><span class="op" id="6091369">[</span><span class="ident" id="6091370">j</span><span class="op" id="6091371">]</span><span class="op" id="6091372">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091377">x</span>&nbsp;<span class="op" id="6091379">=</span>&nbsp;<span class="op" id="6091381">(</span><span class="ident" id="6091382">x</span><span class="op" id="6091383">*</span><span class="ident" id="6091384">scale</span>&nbsp;<span class="op" id="6091390">+</span>&nbsp;<span class="num" id="6091392">50</span><span class="op" id="6091394">)</span>&nbsp;<span class="op" id="6091396">/</span>&nbsp;<span class="num" id="6091398">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091405">if</span>&nbsp;<span class="ident" id="6091408">x</span>&nbsp;<span class="op" id="6091410">&lt;</span>&nbsp;<span class="num" id="6091412">1</span>&nbsp;<span class="op" id="6091414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091420">x</span>&nbsp;<span class="op" id="6091422">=</span>&nbsp;<span class="num" id="6091424">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091429">}</span>&nbsp;<span class="keyword" id="6091431">else</span>&nbsp;<span class="keyword" id="6091436">if</span>&nbsp;<span class="ident" id="6091439">x</span>&nbsp;<span class="op" id="6091441">&gt;</span>&nbsp;<span class="num" id="6091443">255</span>&nbsp;<span class="op" id="6091447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091453">x</span>&nbsp;<span class="op" id="6091455">=</span>&nbsp;<span class="num" id="6091457">255</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091469">e</span><span class="op" id="6091470">.</span><span class="ident" id="6091471">quant</span><span class="op" id="6091476">[</span><span class="ident" id="6091477">i</span><span class="op" id="6091478">]</span><span class="op" id="6091479">[</span><span class="ident" id="6091480">j</span><span class="op" id="6091481">]</span>&nbsp;<span class="op" id="6091483">=</span>&nbsp;<span class="builtintype" id="6091485">uint8</span><span class="op" id="6091490">(</span><span class="ident" id="6091491">x</span><span class="op" id="6091492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6091502">//&nbsp;Compute&nbsp;number&nbsp;of&nbsp;components&nbsp;based&nbsp;on&nbsp;input&nbsp;image&nbsp;type.</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091562">nComponent</span>&nbsp;<span class="op" id="6091573">:=</span>&nbsp;<span class="num" id="6091576">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091579">switch</span>&nbsp;<span class="ident" id="6091586">m</span><span class="op" id="6091587">.</span><span class="op" id="6091588">(</span><span class="keyword" id="6091589">type</span><span class="op" id="6091593">)</span>&nbsp;<span class="op" id="6091595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6091598">//&nbsp;TODO(wathiede):&nbsp;switch&nbsp;on&nbsp;m.ColorModel()&nbsp;instead&nbsp;of&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091660">case</span>&nbsp;<span class="op" id="6091665">*</span><span class="ident" id="6091666">image</span><span class="op" id="6091671">.</span><span class="ident" id="6091672">Gray</span><span class="op" id="6091676">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091680">nComponent</span>&nbsp;<span class="op" id="6091691">=</span>&nbsp;<span class="num" id="6091693">1</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6091699">//&nbsp;Write&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091736">e</span><span class="op" id="6091737">.</span><span class="ident" id="6091738">buf</span><span class="op" id="6091741">[</span><span class="num" id="6091742">0</span><span class="op" id="6091743">]</span>&nbsp;<span class="op" id="6091745">=</span>&nbsp;<span class="num" id="6091747">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091753">e</span><span class="op" id="6091754">.</span><span class="ident" id="6091755">buf</span><span class="op" id="6091758">[</span><span class="num" id="6091759">1</span><span class="op" id="6091760">]</span>&nbsp;<span class="op" id="6091762">=</span>&nbsp;<span class="num" id="6091764">0xd8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091770">e</span><span class="op" id="6091771">.</span><span class="ident" id="6091772">write</span><span class="op" id="6091777">(</span><span class="ident" id="6091778">e</span><span class="op" id="6091779">.</span><span class="ident" id="6091780">buf</span><span class="op" id="6091783">[</span><span class="op" id="6091784">:</span><span class="num" id="6091785">2</span><span class="op" id="6091786">]</span><span class="op" id="6091787">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6091790">//&nbsp;Write&nbsp;the&nbsp;quantization&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091825">e</span><span class="op" id="6091826">.</span><span class="ident" id="6091827">writeDQT</span><span class="op" id="6091835">(</span><span class="op" id="6091836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6091839">//&nbsp;Write&nbsp;the&nbsp;image&nbsp;dimensions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091871">e</span><span class="op" id="6091872">.</span><span class="ident" id="6091873">writeSOF0</span><span class="op" id="6091882">(</span><span class="ident" id="6091883">b</span><span class="op" id="6091884">.</span><span class="ident" id="6091885">Size</span><span class="op" id="6091889">(</span><span class="op" id="6091890">)</span><span class="op" id="6091891">,</span>&nbsp;<span class="ident" id="6091893">nComponent</span><span class="op" id="6091903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6091906">//&nbsp;Write&nbsp;the&nbsp;Huffman&nbsp;tables.</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091936">e</span><span class="op" id="6091937">.</span><span class="ident" id="6091938">writeDHT</span><span class="op" id="6091946">(</span><span class="ident" id="6091947">nComponent</span><span class="op" id="6091957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6091960">//&nbsp;Write&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091986">e</span><span class="op" id="6091987">.</span><span class="ident" id="6091988">writeSOS</span><span class="op" id="6091996">(</span><span class="ident" id="6091997">m</span><span class="op" id="6091998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6092001">//&nbsp;Write&nbsp;the&nbsp;End&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6092036">e</span><span class="op" id="6092037">.</span><span class="ident" id="6092038">buf</span><span class="op" id="6092041">[</span><span class="num" id="6092042">0</span><span class="op" id="6092043">]</span>&nbsp;<span class="op" id="6092045">=</span>&nbsp;<span class="num" id="6092047">0xff</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6092053">e</span><span class="op" id="6092054">.</span><span class="ident" id="6092055">buf</span><span class="op" id="6092058">[</span><span class="num" id="6092059">1</span><span class="op" id="6092060">]</span>&nbsp;<span class="op" id="6092062">=</span>&nbsp;<span class="num" id="6092064">0xd9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6092070">e</span><span class="op" id="6092071">.</span><span class="ident" id="6092072">write</span><span class="op" id="6092077">(</span><span class="ident" id="6092078">e</span><span class="op" id="6092079">.</span><span class="ident" id="6092080">buf</span><span class="op" id="6092083">[</span><span class="op" id="6092084">:</span><span class="num" id="6092085">2</span><span class="op" id="6092086">]</span><span class="op" id="6092087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6092090">e</span><span class="op" id="6092091">.</span><span class="ident" id="6092092">flush</span><span class="op" id="6092097">(</span><span class="op" id="6092098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6092101">return</span>&nbsp;<span class="ident" id="6092108">e</span><span class="op" id="6092109">.</span><span class="ident" id="6092110">err</span><br>
<span class="lineno"></span><span class="op" id="6092114">}</span>
</div>
</body>
</html>
