<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html" class="current">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7599863">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7599919">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7599973">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7600024">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;API&nbsp;tests&nbsp;across&nbsp;platforms&nbsp;and&nbsp;will&nbsp;never&nbsp;have&nbsp;a&nbsp;build</span><br>
<span class="lineno"></span><span class="comment" id="7600103">//&nbsp;tag.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7600112">package</span>&nbsp;<span class="ident" id="7600120">net</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="7600125">import</span>&nbsp;<span class="op" id="7600132">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7600135">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7600148">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7600154">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7600165">&#34;testing&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7600176">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7600183">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7600186">//&nbsp;testUnixAddr&nbsp;uses&nbsp;ioutil.TempFile&nbsp;to&nbsp;get&nbsp;a&nbsp;name&nbsp;that&nbsp;is&nbsp;unique.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="7600256">//&nbsp;also&nbsp;uses&nbsp;/tmp&nbsp;directory&nbsp;in&nbsp;case&nbsp;it&nbsp;is&nbsp;prohibited&nbsp;to&nbsp;create&nbsp;UNIX</span><br>
<span class="lineno">20</span><span class="comment" id="7600324">//&nbsp;sockets&nbsp;in&nbsp;TMPDIR.</span><br>
<span class="lineno"></span><span class="keyword" id="7600346">func</span>&nbsp;<span class="ident" id="7600351">testUnixAddr</span><span class="op" id="7600363">(</span><span class="op" id="7600364">)</span>&nbsp;<span class="builtintype" id="7600366">string</span>&nbsp;<span class="op" id="7600373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7600376">f</span><span class="op" id="7600377">,</span>&nbsp;<span class="ident" id="7600379">err</span>&nbsp;<span class="op" id="7600383">:=</span>&nbsp;<span class="ident" id="7600386">ioutil</span><span class="op" id="7600392">.</span><span class="ident" id="7600393">TempFile</span><span class="op" id="7600401">(</span><span class="string" id="7600402">&#34;&#34;</span><span class="op" id="7600404">,</span>&nbsp;<span class="string" id="7600406">&#34;nettest&#34;</span><span class="op" id="7600415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7600418">if</span>&nbsp;<span class="ident" id="7600421">err</span>&nbsp;<span class="op" id="7600425">!=</span>&nbsp;<span class="ident" id="7600428">nil</span>&nbsp;<span class="op" id="7600432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7600436">panic</span><span class="op" id="7600441">(</span><span class="ident" id="7600442">err</span><span class="op" id="7600445">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7600448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7600451">addr</span>&nbsp;<span class="op" id="7600456">:=</span>&nbsp;<span class="ident" id="7600459">f</span><span class="op" id="7600460">.</span><span class="ident" id="7600461">Name</span><span class="op" id="7600465">(</span><span class="op" id="7600466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7600469">f</span><span class="op" id="7600470">.</span><span class="ident" id="7600471">Close</span><span class="op" id="7600476">(</span><span class="op" id="7600477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7600480">os</span><span class="op" id="7600482">.</span><span class="ident" id="7600483">Remove</span><span class="op" id="7600489">(</span><span class="ident" id="7600490">addr</span><span class="op" id="7600494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7600497">return</span>&nbsp;<span class="ident" id="7600504">addr</span><br>
<span class="lineno">30</span><span class="op" id="7600509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7600512">var</span>&nbsp;<span class="ident" id="7600516">condFatalf</span>&nbsp;<span class="op" id="7600527">=</span>&nbsp;<span class="keyword" id="7600529">func</span><span class="op" id="7600533">(</span><span class="op" id="7600534">)</span>&nbsp;<span class="keyword" id="7600536">func</span><span class="op" id="7600540">(</span><span class="op" id="7600541">*</span><span class="ident" id="7600542">testing</span><span class="op" id="7600549">.</span><span class="ident" id="7600550">T</span><span class="op" id="7600551">,</span>&nbsp;<span class="builtintype" id="7600553">string</span><span class="op" id="7600559">,</span>&nbsp;<span class="op" id="7600561">...</span><span class="keyword" id="7600564">interface</span><span class="op" id="7600573">{</span><span class="op" id="7600574">}</span><span class="op" id="7600575">)</span>&nbsp;<span class="op" id="7600577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7600580">//&nbsp;A&nbsp;few&nbsp;APIs&nbsp;are&nbsp;not&nbsp;implemented&nbsp;yet&nbsp;on&nbsp;both&nbsp;Plan&nbsp;9&nbsp;and&nbsp;Windows.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7600647">switch</span>&nbsp;<span class="ident" id="7600654">runtime</span><span class="op" id="7600661">.</span><span class="ident" id="7600662">GOOS</span>&nbsp;<span class="op" id="7600667">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7600670">case</span>&nbsp;<span class="string" id="7600675">&#34;plan9&#34;</span><span class="op" id="7600682">,</span>&nbsp;<span class="string" id="7600684">&#34;windows&#34;</span><span class="op" id="7600693">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7600697">return</span>&nbsp;<span class="op" id="7600704">(</span><span class="op" id="7600705">*</span><span class="ident" id="7600706">testing</span><span class="op" id="7600713">.</span><span class="ident" id="7600714">T</span><span class="op" id="7600715">)</span><span class="op" id="7600716">.</span><span class="ident" id="7600717">Logf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7600723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7600726">return</span>&nbsp;<span class="op" id="7600733">(</span><span class="op" id="7600734">*</span><span class="ident" id="7600735">testing</span><span class="op" id="7600742">.</span><span class="ident" id="7600743">T</span><span class="op" id="7600744">)</span><span class="op" id="7600745">.</span><span class="ident" id="7600746">Fatalf</span><br>
<span class="lineno"></span><span class="op" id="7600753">}</span><span class="op" id="7600754">(</span><span class="op" id="7600755">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="7600758">func</span>&nbsp;<span class="ident" id="7600763">TestTCPListenerSpecificMethods</span><span class="op" id="7600793">(</span><span class="ident" id="7600794">t</span>&nbsp;<span class="op" id="7600796">*</span><span class="ident" id="7600797">testing</span><span class="op" id="7600804">.</span><span class="ident" id="7600805">T</span><span class="op" id="7600806">)</span>&nbsp;<span class="op" id="7600808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7600811">switch</span>&nbsp;<span class="ident" id="7600818">runtime</span><span class="op" id="7600825">.</span><span class="ident" id="7600826">GOOS</span>&nbsp;<span class="op" id="7600831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7600834">case</span>&nbsp;<span class="string" id="7600839">&#34;plan9&#34;</span><span class="op" id="7600846">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7600850">t</span><span class="op" id="7600851">.</span><span class="ident" id="7600852">Skipf</span><span class="op" id="7600857">(</span><span class="string" id="7600858">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7600879">,</span>&nbsp;<span class="ident" id="7600881">runtime</span><span class="op" id="7600888">.</span><span class="ident" id="7600889">GOOS</span><span class="op" id="7600893">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7600896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7600900">la</span><span class="op" id="7600902">,</span>&nbsp;<span class="ident" id="7600904">err</span>&nbsp;<span class="op" id="7600908">:=</span>&nbsp;<span class="ident" id="7600911">ResolveTCPAddr</span><span class="op" id="7600925">(</span><span class="string" id="7600926">&#34;tcp4&#34;</span><span class="op" id="7600932">,</span>&nbsp;<span class="string" id="7600934">&#34;127.0.0.1:0&#34;</span><span class="op" id="7600947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7600950">if</span>&nbsp;<span class="ident" id="7600953">err</span>&nbsp;<span class="op" id="7600957">!=</span>&nbsp;<span class="ident" id="7600960">nil</span>&nbsp;<span class="op" id="7600964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7600968">t</span><span class="op" id="7600969">.</span><span class="ident" id="7600970">Fatalf</span><span class="op" id="7600976">(</span><span class="string" id="7600977">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7601004">,</span>&nbsp;<span class="ident" id="7601006">err</span><span class="op" id="7601009">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7601012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7601015">ln</span><span class="op" id="7601017">,</span>&nbsp;<span class="ident" id="7601019">err</span>&nbsp;<span class="op" id="7601023">:=</span>&nbsp;<span class="ident" id="7601026">ListenTCP</span><span class="op" id="7601035">(</span><span class="string" id="7601036">&#34;tcp4&#34;</span><span class="op" id="7601042">,</span>&nbsp;<span class="ident" id="7601044">la</span><span class="op" id="7601046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7601049">if</span>&nbsp;<span class="ident" id="7601052">err</span>&nbsp;<span class="op" id="7601056">!=</span>&nbsp;<span class="ident" id="7601059">nil</span>&nbsp;<span class="op" id="7601063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7601067">t</span><span class="op" id="7601068">.</span><span class="ident" id="7601069">Fatalf</span><span class="op" id="7601075">(</span><span class="string" id="7601076">&#34;ListenTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7601098">,</span>&nbsp;<span class="ident" id="7601100">err</span><span class="op" id="7601103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7601106">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7601109">defer</span>&nbsp;<span class="ident" id="7601115">ln</span><span class="op" id="7601117">.</span><span class="ident" id="7601118">Close</span><span class="op" id="7601123">(</span><span class="op" id="7601124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7601127">ln</span><span class="op" id="7601129">.</span><span class="ident" id="7601130">Addr</span><span class="op" id="7601134">(</span><span class="op" id="7601135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7601138">ln</span><span class="op" id="7601140">.</span><span class="ident" id="7601141">SetDeadline</span><span class="op" id="7601152">(</span><span class="ident" id="7601153">time</span><span class="op" id="7601157">.</span><span class="ident" id="7601158">Now</span><span class="op" id="7601161">(</span><span class="op" id="7601162">)</span><span class="op" id="7601163">.</span><span class="ident" id="7601164">Add</span><span class="op" id="7601167">(</span><span class="num" id="7601168">30</span>&nbsp;<span class="op" id="7601171">*</span>&nbsp;<span class="ident" id="7601173">time</span><span class="op" id="7601177">.</span><span class="ident" id="7601178">Nanosecond</span><span class="op" id="7601188">)</span><span class="op" id="7601189">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7601193">if</span>&nbsp;<span class="ident" id="7601196">c</span><span class="op" id="7601197">,</span>&nbsp;<span class="ident" id="7601199">err</span>&nbsp;<span class="op" id="7601203">:=</span>&nbsp;<span class="ident" id="7601206">ln</span><span class="op" id="7601208">.</span><span class="ident" id="7601209">Accept</span><span class="op" id="7601215">(</span><span class="op" id="7601216">)</span><span class="op" id="7601217">;</span>&nbsp;<span class="ident" id="7601219">err</span>&nbsp;<span class="op" id="7601223">!=</span>&nbsp;<span class="ident" id="7601226">nil</span>&nbsp;<span class="op" id="7601230">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7601234">if</span>&nbsp;<span class="op" id="7601237">!</span><span class="ident" id="7601238">err</span><span class="op" id="7601241">.</span><span class="op" id="7601242">(</span><span class="ident" id="7601243">Error</span><span class="op" id="7601248">)</span><span class="op" id="7601249">.</span><span class="ident" id="7601250">Timeout</span><span class="op" id="7601257">(</span><span class="op" id="7601258">)</span>&nbsp;<span class="op" id="7601260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7601265">t</span><span class="op" id="7601266">.</span><span class="ident" id="7601267">Fatalf</span><span class="op" id="7601273">(</span><span class="string" id="7601274">&#34;TCPListener.Accept&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7601305">,</span>&nbsp;<span class="ident" id="7601307">err</span><span class="op" id="7601310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7601314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7601317">}</span>&nbsp;<span class="keyword" id="7601319">else</span>&nbsp;<span class="op" id="7601324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7601328">c</span><span class="op" id="7601329">.</span><span class="ident" id="7601330">Close</span><span class="op" id="7601335">(</span><span class="op" id="7601336">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7601339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7601342">if</span>&nbsp;<span class="ident" id="7601345">c</span><span class="op" id="7601346">,</span>&nbsp;<span class="ident" id="7601348">err</span>&nbsp;<span class="op" id="7601352">:=</span>&nbsp;<span class="ident" id="7601355">ln</span><span class="op" id="7601357">.</span><span class="ident" id="7601358">AcceptTCP</span><span class="op" id="7601367">(</span><span class="op" id="7601368">)</span><span class="op" id="7601369">;</span>&nbsp;<span class="ident" id="7601371">err</span>&nbsp;<span class="op" id="7601375">!=</span>&nbsp;<span class="ident" id="7601378">nil</span>&nbsp;<span class="op" id="7601382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7601386">if</span>&nbsp;<span class="op" id="7601389">!</span><span class="ident" id="7601390">err</span><span class="op" id="7601393">.</span><span class="op" id="7601394">(</span><span class="ident" id="7601395">Error</span><span class="op" id="7601400">)</span><span class="op" id="7601401">.</span><span class="ident" id="7601402">Timeout</span><span class="op" id="7601409">(</span><span class="op" id="7601410">)</span>&nbsp;<span class="op" id="7601412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7601417">t</span><span class="op" id="7601418">.</span><span class="ident" id="7601419">Fatalf</span><span class="op" id="7601425">(</span><span class="string" id="7601426">&#34;TCPListener.AcceptTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7601460">,</span>&nbsp;<span class="ident" id="7601462">err</span><span class="op" id="7601465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7601469">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7601472">}</span>&nbsp;<span class="keyword" id="7601474">else</span>&nbsp;<span class="op" id="7601479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7601483">c</span><span class="op" id="7601484">.</span><span class="ident" id="7601485">Close</span><span class="op" id="7601490">(</span><span class="op" id="7601491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7601494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7601498">if</span>&nbsp;<span class="ident" id="7601501">f</span><span class="op" id="7601502">,</span>&nbsp;<span class="ident" id="7601504">err</span>&nbsp;<span class="op" id="7601508">:=</span>&nbsp;<span class="ident" id="7601511">ln</span><span class="op" id="7601513">.</span><span class="ident" id="7601514">File</span><span class="op" id="7601518">(</span><span class="op" id="7601519">)</span><span class="op" id="7601520">;</span>&nbsp;<span class="ident" id="7601522">err</span>&nbsp;<span class="op" id="7601526">!=</span>&nbsp;<span class="ident" id="7601529">nil</span>&nbsp;<span class="op" id="7601533">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7601537">condFatalf</span><span class="op" id="7601547">(</span><span class="ident" id="7601548">t</span><span class="op" id="7601549">,</span>&nbsp;<span class="string" id="7601551">&#34;TCPListener.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7601580">,</span>&nbsp;<span class="ident" id="7601582">err</span><span class="op" id="7601585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7601588">}</span>&nbsp;<span class="keyword" id="7601590">else</span>&nbsp;<span class="op" id="7601595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7601599">f</span><span class="op" id="7601600">.</span><span class="ident" id="7601601">Close</span><span class="op" id="7601606">(</span><span class="op" id="7601607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7601610">}</span><br>
<span class="lineno"></span><span class="op" id="7601612">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="7601615">func</span>&nbsp;<span class="ident" id="7601620">TestTCPConnSpecificMethods</span><span class="op" id="7601646">(</span><span class="ident" id="7601647">t</span>&nbsp;<span class="op" id="7601649">*</span><span class="ident" id="7601650">testing</span><span class="op" id="7601657">.</span><span class="ident" id="7601658">T</span><span class="op" id="7601659">)</span>&nbsp;<span class="op" id="7601661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7601664">la</span><span class="op" id="7601666">,</span>&nbsp;<span class="ident" id="7601668">err</span>&nbsp;<span class="op" id="7601672">:=</span>&nbsp;<span class="ident" id="7601675">ResolveTCPAddr</span><span class="op" id="7601689">(</span><span class="string" id="7601690">&#34;tcp4&#34;</span><span class="op" id="7601696">,</span>&nbsp;<span class="string" id="7601698">&#34;127.0.0.1:0&#34;</span><span class="op" id="7601711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7601714">if</span>&nbsp;<span class="ident" id="7601717">err</span>&nbsp;<span class="op" id="7601721">!=</span>&nbsp;<span class="ident" id="7601724">nil</span>&nbsp;<span class="op" id="7601728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7601732">t</span><span class="op" id="7601733">.</span><span class="ident" id="7601734">Fatalf</span><span class="op" id="7601740">(</span><span class="string" id="7601741">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7601768">,</span>&nbsp;<span class="ident" id="7601770">err</span><span class="op" id="7601773">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7601776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7601779">ln</span><span class="op" id="7601781">,</span>&nbsp;<span class="ident" id="7601783">err</span>&nbsp;<span class="op" id="7601787">:=</span>&nbsp;<span class="ident" id="7601790">ListenTCP</span><span class="op" id="7601799">(</span><span class="string" id="7601800">&#34;tcp4&#34;</span><span class="op" id="7601806">,</span>&nbsp;<span class="ident" id="7601808">la</span><span class="op" id="7601810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7601813">if</span>&nbsp;<span class="ident" id="7601816">err</span>&nbsp;<span class="op" id="7601820">!=</span>&nbsp;<span class="ident" id="7601823">nil</span>&nbsp;<span class="op" id="7601827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7601831">t</span><span class="op" id="7601832">.</span><span class="ident" id="7601833">Fatalf</span><span class="op" id="7601839">(</span><span class="string" id="7601840">&#34;ListenTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7601862">,</span>&nbsp;<span class="ident" id="7601864">err</span><span class="op" id="7601867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7601870">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7601873">defer</span>&nbsp;<span class="ident" id="7601879">ln</span><span class="op" id="7601881">.</span><span class="ident" id="7601882">Close</span><span class="op" id="7601887">(</span><span class="op" id="7601888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7601891">ln</span><span class="op" id="7601893">.</span><span class="ident" id="7601894">Addr</span><span class="op" id="7601898">(</span><span class="op" id="7601899">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7601903">done</span>&nbsp;<span class="op" id="7601908">:=</span>&nbsp;<span class="builtinfunc" id="7601911">make</span><span class="op" id="7601915">(</span><span class="keyword" id="7601916">chan</span>&nbsp;<span class="builtintype" id="7601921">int</span><span class="op" id="7601924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7601927">go</span>&nbsp;<span class="ident" id="7601930">transponder</span><span class="op" id="7601941">(</span><span class="ident" id="7601942">t</span><span class="op" id="7601943">,</span>&nbsp;<span class="ident" id="7601945">ln</span><span class="op" id="7601947">,</span>&nbsp;<span class="ident" id="7601949">done</span><span class="op" id="7601953">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7601957">ra</span><span class="op" id="7601959">,</span>&nbsp;<span class="ident" id="7601961">err</span>&nbsp;<span class="op" id="7601965">:=</span>&nbsp;<span class="ident" id="7601968">ResolveTCPAddr</span><span class="op" id="7601982">(</span><span class="string" id="7601983">&#34;tcp4&#34;</span><span class="op" id="7601989">,</span>&nbsp;<span class="ident" id="7601991">ln</span><span class="op" id="7601993">.</span><span class="ident" id="7601994">Addr</span><span class="op" id="7601998">(</span><span class="op" id="7601999">)</span><span class="op" id="7602000">.</span><span class="ident" id="7602001">String</span><span class="op" id="7602007">(</span><span class="op" id="7602008">)</span><span class="op" id="7602009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7602012">if</span>&nbsp;<span class="ident" id="7602015">err</span>&nbsp;<span class="op" id="7602019">!=</span>&nbsp;<span class="ident" id="7602022">nil</span>&nbsp;<span class="op" id="7602026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7602030">t</span><span class="op" id="7602031">.</span><span class="ident" id="7602032">Fatalf</span><span class="op" id="7602038">(</span><span class="string" id="7602039">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7602066">,</span>&nbsp;<span class="ident" id="7602068">err</span><span class="op" id="7602071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7602074">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7602077">c</span><span class="op" id="7602078">,</span>&nbsp;<span class="ident" id="7602080">err</span>&nbsp;<span class="op" id="7602084">:=</span>&nbsp;<span class="ident" id="7602087">DialTCP</span><span class="op" id="7602094">(</span><span class="string" id="7602095">&#34;tcp4&#34;</span><span class="op" id="7602101">,</span>&nbsp;<span class="ident" id="7602103">nil</span><span class="op" id="7602106">,</span>&nbsp;<span class="ident" id="7602108">ra</span><span class="op" id="7602110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7602113">if</span>&nbsp;<span class="ident" id="7602116">err</span>&nbsp;<span class="op" id="7602120">!=</span>&nbsp;<span class="ident" id="7602123">nil</span>&nbsp;<span class="op" id="7602127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7602131">t</span><span class="op" id="7602132">.</span><span class="ident" id="7602133">Fatalf</span><span class="op" id="7602139">(</span><span class="string" id="7602140">&#34;DialTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7602160">,</span>&nbsp;<span class="ident" id="7602162">err</span><span class="op" id="7602165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7602168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7602171">defer</span>&nbsp;<span class="ident" id="7602177">c</span><span class="op" id="7602178">.</span><span class="ident" id="7602179">Close</span><span class="op" id="7602184">(</span><span class="op" id="7602185">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7602188">c</span><span class="op" id="7602189">.</span><span class="ident" id="7602190">SetKeepAlive</span><span class="op" id="7602202">(</span><span class="builtintype" id="7602203">false</span><span class="op" id="7602208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7602211">c</span><span class="op" id="7602212">.</span><span class="ident" id="7602213">SetKeepAlivePeriod</span><span class="op" id="7602231">(</span><span class="num" id="7602232">3</span>&nbsp;<span class="op" id="7602234">*</span>&nbsp;<span class="ident" id="7602236">time</span><span class="op" id="7602240">.</span><span class="ident" id="7602241">Second</span><span class="op" id="7602247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7602250">c</span><span class="op" id="7602251">.</span><span class="ident" id="7602252">SetLinger</span><span class="op" id="7602261">(</span><span class="num" id="7602262">0</span><span class="op" id="7602263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7602266">c</span><span class="op" id="7602267">.</span><span class="ident" id="7602268">SetNoDelay</span><span class="op" id="7602278">(</span><span class="builtintype" id="7602279">false</span><span class="op" id="7602284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7602287">c</span><span class="op" id="7602288">.</span><span class="ident" id="7602289">LocalAddr</span><span class="op" id="7602298">(</span><span class="op" id="7602299">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7602302">c</span><span class="op" id="7602303">.</span><span class="ident" id="7602304">RemoteAddr</span><span class="op" id="7602314">(</span><span class="op" id="7602315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7602318">c</span><span class="op" id="7602319">.</span><span class="ident" id="7602320">SetDeadline</span><span class="op" id="7602331">(</span><span class="ident" id="7602332">time</span><span class="op" id="7602336">.</span><span class="ident" id="7602337">Now</span><span class="op" id="7602340">(</span><span class="op" id="7602341">)</span><span class="op" id="7602342">.</span><span class="ident" id="7602343">Add</span><span class="op" id="7602346">(</span><span class="ident" id="7602347">someTimeout</span><span class="op" id="7602358">)</span><span class="op" id="7602359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7602362">c</span><span class="op" id="7602363">.</span><span class="ident" id="7602364">SetReadDeadline</span><span class="op" id="7602379">(</span><span class="ident" id="7602380">time</span><span class="op" id="7602384">.</span><span class="ident" id="7602385">Now</span><span class="op" id="7602388">(</span><span class="op" id="7602389">)</span><span class="op" id="7602390">.</span><span class="ident" id="7602391">Add</span><span class="op" id="7602394">(</span><span class="ident" id="7602395">someTimeout</span><span class="op" id="7602406">)</span><span class="op" id="7602407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7602410">c</span><span class="op" id="7602411">.</span><span class="ident" id="7602412">SetWriteDeadline</span><span class="op" id="7602428">(</span><span class="ident" id="7602429">time</span><span class="op" id="7602433">.</span><span class="ident" id="7602434">Now</span><span class="op" id="7602437">(</span><span class="op" id="7602438">)</span><span class="op" id="7602439">.</span><span class="ident" id="7602440">Add</span><span class="op" id="7602443">(</span><span class="ident" id="7602444">someTimeout</span><span class="op" id="7602455">)</span><span class="op" id="7602456">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7602460">if</span>&nbsp;<span class="ident" id="7602463">_</span><span class="op" id="7602464">,</span>&nbsp;<span class="ident" id="7602466">err</span>&nbsp;<span class="op" id="7602470">:=</span>&nbsp;<span class="ident" id="7602473">c</span><span class="op" id="7602474">.</span><span class="ident" id="7602475">Write</span><span class="op" id="7602480">(</span><span class="op" id="7602481">[</span><span class="op" id="7602482">]</span><span class="builtintype" id="7602483">byte</span><span class="op" id="7602487">(</span><span class="string" id="7602488">&#34;TCPCONN&nbsp;TEST&#34;</span><span class="op" id="7602502">)</span><span class="op" id="7602503">)</span><span class="op" id="7602504">;</span>&nbsp;<span class="ident" id="7602506">err</span>&nbsp;<span class="op" id="7602510">!=</span>&nbsp;<span class="ident" id="7602513">nil</span>&nbsp;<span class="op" id="7602517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7602521">t</span><span class="op" id="7602522">.</span><span class="ident" id="7602523">Fatalf</span><span class="op" id="7602529">(</span><span class="string" id="7602530">&#34;TCPConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7602556">,</span>&nbsp;<span class="ident" id="7602558">err</span><span class="op" id="7602561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7602564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7602567">rb</span>&nbsp;<span class="op" id="7602570">:=</span>&nbsp;<span class="builtinfunc" id="7602573">make</span><span class="op" id="7602577">(</span><span class="op" id="7602578">[</span><span class="op" id="7602579">]</span><span class="builtintype" id="7602580">byte</span><span class="op" id="7602584">,</span>&nbsp;<span class="num" id="7602586">128</span><span class="op" id="7602589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7602592">if</span>&nbsp;<span class="ident" id="7602595">_</span><span class="op" id="7602596">,</span>&nbsp;<span class="ident" id="7602598">err</span>&nbsp;<span class="op" id="7602602">:=</span>&nbsp;<span class="ident" id="7602605">c</span><span class="op" id="7602606">.</span><span class="ident" id="7602607">Read</span><span class="op" id="7602611">(</span><span class="ident" id="7602612">rb</span><span class="op" id="7602614">)</span><span class="op" id="7602615">;</span>&nbsp;<span class="ident" id="7602617">err</span>&nbsp;<span class="op" id="7602621">!=</span>&nbsp;<span class="ident" id="7602624">nil</span>&nbsp;<span class="op" id="7602628">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7602632">t</span><span class="op" id="7602633">.</span><span class="ident" id="7602634">Fatalf</span><span class="op" id="7602640">(</span><span class="string" id="7602641">&#34;TCPConn.Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7602666">,</span>&nbsp;<span class="ident" id="7602668">err</span><span class="op" id="7602671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7602674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7602678">&lt;-</span><span class="ident" id="7602680">done</span><br>
<span class="lineno"></span><span class="op" id="7602685">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="7602688">func</span>&nbsp;<span class="ident" id="7602693">TestUDPConnSpecificMethods</span><span class="op" id="7602719">(</span><span class="ident" id="7602720">t</span>&nbsp;<span class="op" id="7602722">*</span><span class="ident" id="7602723">testing</span><span class="op" id="7602730">.</span><span class="ident" id="7602731">T</span><span class="op" id="7602732">)</span>&nbsp;<span class="op" id="7602734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7602737">la</span><span class="op" id="7602739">,</span>&nbsp;<span class="ident" id="7602741">err</span>&nbsp;<span class="op" id="7602745">:=</span>&nbsp;<span class="ident" id="7602748">ResolveUDPAddr</span><span class="op" id="7602762">(</span><span class="string" id="7602763">&#34;udp4&#34;</span><span class="op" id="7602769">,</span>&nbsp;<span class="string" id="7602771">&#34;127.0.0.1:0&#34;</span><span class="op" id="7602784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7602787">if</span>&nbsp;<span class="ident" id="7602790">err</span>&nbsp;<span class="op" id="7602794">!=</span>&nbsp;<span class="ident" id="7602797">nil</span>&nbsp;<span class="op" id="7602801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7602805">t</span><span class="op" id="7602806">.</span><span class="ident" id="7602807">Fatalf</span><span class="op" id="7602813">(</span><span class="string" id="7602814">&#34;ResolveUDPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7602841">,</span>&nbsp;<span class="ident" id="7602843">err</span><span class="op" id="7602846">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7602849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7602852">c</span><span class="op" id="7602853">,</span>&nbsp;<span class="ident" id="7602855">err</span>&nbsp;<span class="op" id="7602859">:=</span>&nbsp;<span class="ident" id="7602862">ListenUDP</span><span class="op" id="7602871">(</span><span class="string" id="7602872">&#34;udp4&#34;</span><span class="op" id="7602878">,</span>&nbsp;<span class="ident" id="7602880">la</span><span class="op" id="7602882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7602885">if</span>&nbsp;<span class="ident" id="7602888">err</span>&nbsp;<span class="op" id="7602892">!=</span>&nbsp;<span class="ident" id="7602895">nil</span>&nbsp;<span class="op" id="7602899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7602903">t</span><span class="op" id="7602904">.</span><span class="ident" id="7602905">Fatalf</span><span class="op" id="7602911">(</span><span class="string" id="7602912">&#34;ListenUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7602934">,</span>&nbsp;<span class="ident" id="7602936">err</span><span class="op" id="7602939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7602942">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7602945">defer</span>&nbsp;<span class="ident" id="7602951">c</span><span class="op" id="7602952">.</span><span class="ident" id="7602953">Close</span><span class="op" id="7602958">(</span><span class="op" id="7602959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7602962">c</span><span class="op" id="7602963">.</span><span class="ident" id="7602964">LocalAddr</span><span class="op" id="7602973">(</span><span class="op" id="7602974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7602977">c</span><span class="op" id="7602978">.</span><span class="ident" id="7602979">RemoteAddr</span><span class="op" id="7602989">(</span><span class="op" id="7602990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7602993">c</span><span class="op" id="7602994">.</span><span class="ident" id="7602995">SetDeadline</span><span class="op" id="7603006">(</span><span class="ident" id="7603007">time</span><span class="op" id="7603011">.</span><span class="ident" id="7603012">Now</span><span class="op" id="7603015">(</span><span class="op" id="7603016">)</span><span class="op" id="7603017">.</span><span class="ident" id="7603018">Add</span><span class="op" id="7603021">(</span><span class="ident" id="7603022">someTimeout</span><span class="op" id="7603033">)</span><span class="op" id="7603034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7603037">c</span><span class="op" id="7603038">.</span><span class="ident" id="7603039">SetReadDeadline</span><span class="op" id="7603054">(</span><span class="ident" id="7603055">time</span><span class="op" id="7603059">.</span><span class="ident" id="7603060">Now</span><span class="op" id="7603063">(</span><span class="op" id="7603064">)</span><span class="op" id="7603065">.</span><span class="ident" id="7603066">Add</span><span class="op" id="7603069">(</span><span class="ident" id="7603070">someTimeout</span><span class="op" id="7603081">)</span><span class="op" id="7603082">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7603085">c</span><span class="op" id="7603086">.</span><span class="ident" id="7603087">SetWriteDeadline</span><span class="op" id="7603103">(</span><span class="ident" id="7603104">time</span><span class="op" id="7603108">.</span><span class="ident" id="7603109">Now</span><span class="op" id="7603112">(</span><span class="op" id="7603113">)</span><span class="op" id="7603114">.</span><span class="ident" id="7603115">Add</span><span class="op" id="7603118">(</span><span class="ident" id="7603119">someTimeout</span><span class="op" id="7603130">)</span><span class="op" id="7603131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7603134">c</span><span class="op" id="7603135">.</span><span class="ident" id="7603136">SetReadBuffer</span><span class="op" id="7603149">(</span><span class="num" id="7603150">2048</span><span class="op" id="7603154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7603157">c</span><span class="op" id="7603158">.</span><span class="ident" id="7603159">SetWriteBuffer</span><span class="op" id="7603173">(</span><span class="num" id="7603174">2048</span><span class="op" id="7603178">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7603182">wb</span>&nbsp;<span class="op" id="7603185">:=</span>&nbsp;<span class="op" id="7603188">[</span><span class="op" id="7603189">]</span><span class="builtintype" id="7603190">byte</span><span class="op" id="7603194">(</span><span class="string" id="7603195">&#34;UDPCONN&nbsp;TEST&#34;</span><span class="op" id="7603209">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7603212">rb</span>&nbsp;<span class="op" id="7603215">:=</span>&nbsp;<span class="builtinfunc" id="7603218">make</span><span class="op" id="7603222">(</span><span class="op" id="7603223">[</span><span class="op" id="7603224">]</span><span class="builtintype" id="7603225">byte</span><span class="op" id="7603229">,</span>&nbsp;<span class="num" id="7603231">128</span><span class="op" id="7603234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7603237">if</span>&nbsp;<span class="ident" id="7603240">_</span><span class="op" id="7603241">,</span>&nbsp;<span class="ident" id="7603243">err</span>&nbsp;<span class="op" id="7603247">:=</span>&nbsp;<span class="ident" id="7603250">c</span><span class="op" id="7603251">.</span><span class="ident" id="7603252">WriteToUDP</span><span class="op" id="7603262">(</span><span class="ident" id="7603263">wb</span><span class="op" id="7603265">,</span>&nbsp;<span class="ident" id="7603267">c</span><span class="op" id="7603268">.</span><span class="ident" id="7603269">LocalAddr</span><span class="op" id="7603278">(</span><span class="op" id="7603279">)</span><span class="op" id="7603280">.</span><span class="op" id="7603281">(</span><span class="op" id="7603282">*</span><span class="ident" id="7603283">UDPAddr</span><span class="op" id="7603290">)</span><span class="op" id="7603291">)</span><span class="op" id="7603292">;</span>&nbsp;<span class="ident" id="7603294">err</span>&nbsp;<span class="op" id="7603298">!=</span>&nbsp;<span class="ident" id="7603301">nil</span>&nbsp;<span class="op" id="7603305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7603309">t</span><span class="op" id="7603310">.</span><span class="ident" id="7603311">Fatalf</span><span class="op" id="7603317">(</span><span class="string" id="7603318">&#34;UDPConn.WriteToUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7603349">,</span>&nbsp;<span class="ident" id="7603351">err</span><span class="op" id="7603354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7603357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7603360">if</span>&nbsp;<span class="ident" id="7603363">_</span><span class="op" id="7603364">,</span>&nbsp;<span class="ident" id="7603366">_</span><span class="op" id="7603367">,</span>&nbsp;<span class="ident" id="7603369">err</span>&nbsp;<span class="op" id="7603373">:=</span>&nbsp;<span class="ident" id="7603376">c</span><span class="op" id="7603377">.</span><span class="ident" id="7603378">ReadFromUDP</span><span class="op" id="7603389">(</span><span class="ident" id="7603390">rb</span><span class="op" id="7603392">)</span><span class="op" id="7603393">;</span>&nbsp;<span class="ident" id="7603395">err</span>&nbsp;<span class="op" id="7603399">!=</span>&nbsp;<span class="ident" id="7603402">nil</span>&nbsp;<span class="op" id="7603406">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7603410">t</span><span class="op" id="7603411">.</span><span class="ident" id="7603412">Fatalf</span><span class="op" id="7603418">(</span><span class="string" id="7603419">&#34;UDPConn.ReadFromUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7603451">,</span>&nbsp;<span class="ident" id="7603453">err</span><span class="op" id="7603456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7603459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7603462">if</span>&nbsp;<span class="ident" id="7603465">_</span><span class="op" id="7603466">,</span>&nbsp;<span class="ident" id="7603468">_</span><span class="op" id="7603469">,</span>&nbsp;<span class="ident" id="7603471">err</span>&nbsp;<span class="op" id="7603475">:=</span>&nbsp;<span class="ident" id="7603478">c</span><span class="op" id="7603479">.</span><span class="ident" id="7603480">WriteMsgUDP</span><span class="op" id="7603491">(</span><span class="ident" id="7603492">wb</span><span class="op" id="7603494">,</span>&nbsp;<span class="ident" id="7603496">nil</span><span class="op" id="7603499">,</span>&nbsp;<span class="ident" id="7603501">c</span><span class="op" id="7603502">.</span><span class="ident" id="7603503">LocalAddr</span><span class="op" id="7603512">(</span><span class="op" id="7603513">)</span><span class="op" id="7603514">.</span><span class="op" id="7603515">(</span><span class="op" id="7603516">*</span><span class="ident" id="7603517">UDPAddr</span><span class="op" id="7603524">)</span><span class="op" id="7603525">)</span><span class="op" id="7603526">;</span>&nbsp;<span class="ident" id="7603528">err</span>&nbsp;<span class="op" id="7603532">!=</span>&nbsp;<span class="ident" id="7603535">nil</span>&nbsp;<span class="op" id="7603539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7603543">condFatalf</span><span class="op" id="7603553">(</span><span class="ident" id="7603554">t</span><span class="op" id="7603555">,</span>&nbsp;<span class="string" id="7603557">&#34;UDPConn.WriteMsgUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7603589">,</span>&nbsp;<span class="ident" id="7603591">err</span><span class="op" id="7603594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7603597">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7603600">if</span>&nbsp;<span class="ident" id="7603603">_</span><span class="op" id="7603604">,</span>&nbsp;<span class="ident" id="7603606">_</span><span class="op" id="7603607">,</span>&nbsp;<span class="ident" id="7603609">_</span><span class="op" id="7603610">,</span>&nbsp;<span class="ident" id="7603612">_</span><span class="op" id="7603613">,</span>&nbsp;<span class="ident" id="7603615">err</span>&nbsp;<span class="op" id="7603619">:=</span>&nbsp;<span class="ident" id="7603622">c</span><span class="op" id="7603623">.</span><span class="ident" id="7603624">ReadMsgUDP</span><span class="op" id="7603634">(</span><span class="ident" id="7603635">rb</span><span class="op" id="7603637">,</span>&nbsp;<span class="ident" id="7603639">nil</span><span class="op" id="7603642">)</span><span class="op" id="7603643">;</span>&nbsp;<span class="ident" id="7603645">err</span>&nbsp;<span class="op" id="7603649">!=</span>&nbsp;<span class="ident" id="7603652">nil</span>&nbsp;<span class="op" id="7603656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7603660">condFatalf</span><span class="op" id="7603670">(</span><span class="ident" id="7603671">t</span><span class="op" id="7603672">,</span>&nbsp;<span class="string" id="7603674">&#34;UDPConn.ReadMsgUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7603705">,</span>&nbsp;<span class="ident" id="7603707">err</span><span class="op" id="7603710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7603713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7603717">if</span>&nbsp;<span class="ident" id="7603720">f</span><span class="op" id="7603721">,</span>&nbsp;<span class="ident" id="7603723">err</span>&nbsp;<span class="op" id="7603727">:=</span>&nbsp;<span class="ident" id="7603730">c</span><span class="op" id="7603731">.</span><span class="ident" id="7603732">File</span><span class="op" id="7603736">(</span><span class="op" id="7603737">)</span><span class="op" id="7603738">;</span>&nbsp;<span class="ident" id="7603740">err</span>&nbsp;<span class="op" id="7603744">!=</span>&nbsp;<span class="ident" id="7603747">nil</span>&nbsp;<span class="op" id="7603751">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7603755">condFatalf</span><span class="op" id="7603765">(</span><span class="ident" id="7603766">t</span><span class="op" id="7603767">,</span>&nbsp;<span class="string" id="7603769">&#34;UDPConn.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7603794">,</span>&nbsp;<span class="ident" id="7603796">err</span><span class="op" id="7603799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7603802">}</span>&nbsp;<span class="keyword" id="7603804">else</span>&nbsp;<span class="op" id="7603809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7603813">f</span><span class="op" id="7603814">.</span><span class="ident" id="7603815">Close</span><span class="op" id="7603820">(</span><span class="op" id="7603821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7603824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7603828">defer</span>&nbsp;<span class="keyword" id="7603834">func</span><span class="op" id="7603838">(</span><span class="op" id="7603839">)</span>&nbsp;<span class="op" id="7603841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7603845">if</span>&nbsp;<span class="ident" id="7603848">p</span>&nbsp;<span class="op" id="7603850">:=</span>&nbsp;<span class="builtinfunc" id="7603853">recover</span><span class="op" id="7603860">(</span><span class="op" id="7603861">)</span><span class="op" id="7603862">;</span>&nbsp;<span class="ident" id="7603864">p</span>&nbsp;<span class="op" id="7603866">!=</span>&nbsp;<span class="ident" id="7603869">nil</span>&nbsp;<span class="op" id="7603873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7603878">t</span><span class="op" id="7603879">.</span><span class="ident" id="7603880">Fatalf</span><span class="op" id="7603886">(</span><span class="string" id="7603887">&#34;UDPConn.WriteToUDP&nbsp;or&nbsp;WriteMsgUDP&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="7603935">,</span>&nbsp;<span class="ident" id="7603937">p</span><span class="op" id="7603938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7603942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7603945">}</span><span class="op" id="7603946">(</span><span class="op" id="7603947">)</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7603951">c</span><span class="op" id="7603952">.</span><span class="ident" id="7603953">WriteToUDP</span><span class="op" id="7603963">(</span><span class="ident" id="7603964">wb</span><span class="op" id="7603966">,</span>&nbsp;<span class="ident" id="7603968">nil</span><span class="op" id="7603971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7603974">c</span><span class="op" id="7603975">.</span><span class="ident" id="7603976">WriteMsgUDP</span><span class="op" id="7603987">(</span><span class="ident" id="7603988">wb</span><span class="op" id="7603990">,</span>&nbsp;<span class="ident" id="7603992">nil</span><span class="op" id="7603995">,</span>&nbsp;<span class="ident" id="7603997">nil</span><span class="op" id="7604000">)</span><br>
<span class="lineno"></span><span class="op" id="7604002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="7604005">func</span>&nbsp;<span class="ident" id="7604010">TestIPConnSpecificMethods</span><span class="op" id="7604035">(</span><span class="ident" id="7604036">t</span>&nbsp;<span class="op" id="7604038">*</span><span class="ident" id="7604039">testing</span><span class="op" id="7604046">.</span><span class="ident" id="7604047">T</span><span class="op" id="7604048">)</span>&nbsp;<span class="op" id="7604050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7604053">if</span>&nbsp;<span class="ident" id="7604056">skip</span><span class="op" id="7604060">,</span>&nbsp;<span class="ident" id="7604062">skipmsg</span>&nbsp;<span class="op" id="7604070">:=</span>&nbsp;<span class="ident" id="7604073">skipRawSocketTest</span><span class="op" id="7604090">(</span><span class="ident" id="7604091">t</span><span class="op" id="7604092">)</span><span class="op" id="7604093">;</span>&nbsp;<span class="ident" id="7604095">skip</span>&nbsp;<span class="op" id="7604100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7604104">t</span><span class="op" id="7604105">.</span><span class="ident" id="7604106">Skip</span><span class="op" id="7604110">(</span><span class="ident" id="7604111">skipmsg</span><span class="op" id="7604118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7604121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7604125">la</span><span class="op" id="7604127">,</span>&nbsp;<span class="ident" id="7604129">err</span>&nbsp;<span class="op" id="7604133">:=</span>&nbsp;<span class="ident" id="7604136">ResolveIPAddr</span><span class="op" id="7604149">(</span><span class="string" id="7604150">&#34;ip4&#34;</span><span class="op" id="7604155">,</span>&nbsp;<span class="string" id="7604157">&#34;127.0.0.1&#34;</span><span class="op" id="7604168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7604171">if</span>&nbsp;<span class="ident" id="7604174">err</span>&nbsp;<span class="op" id="7604178">!=</span>&nbsp;<span class="ident" id="7604181">nil</span>&nbsp;<span class="op" id="7604185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7604189">t</span><span class="op" id="7604190">.</span><span class="ident" id="7604191">Fatalf</span><span class="op" id="7604197">(</span><span class="string" id="7604198">&#34;ResolveIPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7604224">,</span>&nbsp;<span class="ident" id="7604226">err</span><span class="op" id="7604229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7604232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7604235">c</span><span class="op" id="7604236">,</span>&nbsp;<span class="ident" id="7604238">err</span>&nbsp;<span class="op" id="7604242">:=</span>&nbsp;<span class="ident" id="7604245">ListenIP</span><span class="op" id="7604253">(</span><span class="string" id="7604254">&#34;ip4:icmp&#34;</span><span class="op" id="7604264">,</span>&nbsp;<span class="ident" id="7604266">la</span><span class="op" id="7604268">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7604271">if</span>&nbsp;<span class="ident" id="7604274">err</span>&nbsp;<span class="op" id="7604278">!=</span>&nbsp;<span class="ident" id="7604281">nil</span>&nbsp;<span class="op" id="7604285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7604289">t</span><span class="op" id="7604290">.</span><span class="ident" id="7604291">Fatalf</span><span class="op" id="7604297">(</span><span class="string" id="7604298">&#34;ListenIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7604319">,</span>&nbsp;<span class="ident" id="7604321">err</span><span class="op" id="7604324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7604327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7604330">defer</span>&nbsp;<span class="ident" id="7604336">c</span><span class="op" id="7604337">.</span><span class="ident" id="7604338">Close</span><span class="op" id="7604343">(</span><span class="op" id="7604344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7604347">c</span><span class="op" id="7604348">.</span><span class="ident" id="7604349">LocalAddr</span><span class="op" id="7604358">(</span><span class="op" id="7604359">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7604362">c</span><span class="op" id="7604363">.</span><span class="ident" id="7604364">RemoteAddr</span><span class="op" id="7604374">(</span><span class="op" id="7604375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7604378">c</span><span class="op" id="7604379">.</span><span class="ident" id="7604380">SetDeadline</span><span class="op" id="7604391">(</span><span class="ident" id="7604392">time</span><span class="op" id="7604396">.</span><span class="ident" id="7604397">Now</span><span class="op" id="7604400">(</span><span class="op" id="7604401">)</span><span class="op" id="7604402">.</span><span class="ident" id="7604403">Add</span><span class="op" id="7604406">(</span><span class="ident" id="7604407">someTimeout</span><span class="op" id="7604418">)</span><span class="op" id="7604419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7604422">c</span><span class="op" id="7604423">.</span><span class="ident" id="7604424">SetReadDeadline</span><span class="op" id="7604439">(</span><span class="ident" id="7604440">time</span><span class="op" id="7604444">.</span><span class="ident" id="7604445">Now</span><span class="op" id="7604448">(</span><span class="op" id="7604449">)</span><span class="op" id="7604450">.</span><span class="ident" id="7604451">Add</span><span class="op" id="7604454">(</span><span class="ident" id="7604455">someTimeout</span><span class="op" id="7604466">)</span><span class="op" id="7604467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7604470">c</span><span class="op" id="7604471">.</span><span class="ident" id="7604472">SetWriteDeadline</span><span class="op" id="7604488">(</span><span class="ident" id="7604489">time</span><span class="op" id="7604493">.</span><span class="ident" id="7604494">Now</span><span class="op" id="7604497">(</span><span class="op" id="7604498">)</span><span class="op" id="7604499">.</span><span class="ident" id="7604500">Add</span><span class="op" id="7604503">(</span><span class="ident" id="7604504">someTimeout</span><span class="op" id="7604515">)</span><span class="op" id="7604516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7604519">c</span><span class="op" id="7604520">.</span><span class="ident" id="7604521">SetReadBuffer</span><span class="op" id="7604534">(</span><span class="num" id="7604535">2048</span><span class="op" id="7604539">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7604542">c</span><span class="op" id="7604543">.</span><span class="ident" id="7604544">SetWriteBuffer</span><span class="op" id="7604558">(</span><span class="num" id="7604559">2048</span><span class="op" id="7604563">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7604567">wb</span><span class="op" id="7604569">,</span>&nbsp;<span class="ident" id="7604571">err</span>&nbsp;<span class="op" id="7604575">:=</span>&nbsp;<span class="op" id="7604578">(</span><span class="op" id="7604579">&amp;</span><span class="ident" id="7604580">icmpMessage</span><span class="op" id="7604591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7604595">Type</span><span class="op" id="7604599">:</span>&nbsp;<span class="ident" id="7604601">icmpv4EchoRequest</span><span class="op" id="7604618">,</span>&nbsp;<span class="ident" id="7604620">Code</span><span class="op" id="7604624">:</span>&nbsp;<span class="num" id="7604626">0</span><span class="op" id="7604627">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7604631">Body</span><span class="op" id="7604635">:</span>&nbsp;<span class="op" id="7604637">&amp;</span><span class="ident" id="7604638">icmpEcho</span><span class="op" id="7604646">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7604651">ID</span><span class="op" id="7604653">:</span>&nbsp;<span class="ident" id="7604655">os</span><span class="op" id="7604657">.</span><span class="ident" id="7604658">Getpid</span><span class="op" id="7604664">(</span><span class="op" id="7604665">)</span>&nbsp;<span class="op" id="7604667">&amp;</span>&nbsp;<span class="num" id="7604669">0xffff</span><span class="op" id="7604675">,</span>&nbsp;<span class="ident" id="7604677">Seq</span><span class="op" id="7604680">:</span>&nbsp;<span class="num" id="7604682">1</span><span class="op" id="7604683">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7604688">Data</span><span class="op" id="7604692">:</span>&nbsp;<span class="op" id="7604694">[</span><span class="op" id="7604695">]</span><span class="builtintype" id="7604696">byte</span><span class="op" id="7604700">(</span><span class="string" id="7604701">&#34;IPCONN&nbsp;TEST&nbsp;&#34;</span><span class="op" id="7604715">)</span><span class="op" id="7604716">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7604720">}</span><span class="op" id="7604721">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7604724">}</span><span class="op" id="7604725">)</span><span class="op" id="7604726">.</span><span class="ident" id="7604727">Marshal</span><span class="op" id="7604734">(</span><span class="op" id="7604735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7604738">if</span>&nbsp;<span class="ident" id="7604741">err</span>&nbsp;<span class="op" id="7604745">!=</span>&nbsp;<span class="ident" id="7604748">nil</span>&nbsp;<span class="op" id="7604752">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7604756">t</span><span class="op" id="7604757">.</span><span class="ident" id="7604758">Fatalf</span><span class="op" id="7604764">(</span><span class="string" id="7604765">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7604797">,</span>&nbsp;<span class="ident" id="7604799">err</span><span class="op" id="7604802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7604805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7604808">rb</span>&nbsp;<span class="op" id="7604811">:=</span>&nbsp;<span class="builtinfunc" id="7604814">make</span><span class="op" id="7604818">(</span><span class="op" id="7604819">[</span><span class="op" id="7604820">]</span><span class="builtintype" id="7604821">byte</span><span class="op" id="7604825">,</span>&nbsp;<span class="num" id="7604827">20</span><span class="op" id="7604829">+</span><span class="builtinfunc" id="7604830">len</span><span class="op" id="7604833">(</span><span class="ident" id="7604834">wb</span><span class="op" id="7604836">)</span><span class="op" id="7604837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7604840">if</span>&nbsp;<span class="ident" id="7604843">_</span><span class="op" id="7604844">,</span>&nbsp;<span class="ident" id="7604846">err</span>&nbsp;<span class="op" id="7604850">:=</span>&nbsp;<span class="ident" id="7604853">c</span><span class="op" id="7604854">.</span><span class="ident" id="7604855">WriteToIP</span><span class="op" id="7604864">(</span><span class="ident" id="7604865">wb</span><span class="op" id="7604867">,</span>&nbsp;<span class="ident" id="7604869">c</span><span class="op" id="7604870">.</span><span class="ident" id="7604871">LocalAddr</span><span class="op" id="7604880">(</span><span class="op" id="7604881">)</span><span class="op" id="7604882">.</span><span class="op" id="7604883">(</span><span class="op" id="7604884">*</span><span class="ident" id="7604885">IPAddr</span><span class="op" id="7604891">)</span><span class="op" id="7604892">)</span><span class="op" id="7604893">;</span>&nbsp;<span class="ident" id="7604895">err</span>&nbsp;<span class="op" id="7604899">!=</span>&nbsp;<span class="ident" id="7604902">nil</span>&nbsp;<span class="op" id="7604906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7604910">t</span><span class="op" id="7604911">.</span><span class="ident" id="7604912">Fatalf</span><span class="op" id="7604918">(</span><span class="string" id="7604919">&#34;IPConn.WriteToIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7604948">,</span>&nbsp;<span class="ident" id="7604950">err</span><span class="op" id="7604953">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7604956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7604959">if</span>&nbsp;<span class="ident" id="7604962">_</span><span class="op" id="7604963">,</span>&nbsp;<span class="ident" id="7604965">_</span><span class="op" id="7604966">,</span>&nbsp;<span class="ident" id="7604968">err</span>&nbsp;<span class="op" id="7604972">:=</span>&nbsp;<span class="ident" id="7604975">c</span><span class="op" id="7604976">.</span><span class="ident" id="7604977">ReadFromIP</span><span class="op" id="7604987">(</span><span class="ident" id="7604988">rb</span><span class="op" id="7604990">)</span><span class="op" id="7604991">;</span>&nbsp;<span class="ident" id="7604993">err</span>&nbsp;<span class="op" id="7604997">!=</span>&nbsp;<span class="ident" id="7605000">nil</span>&nbsp;<span class="op" id="7605004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7605008">t</span><span class="op" id="7605009">.</span><span class="ident" id="7605010">Fatalf</span><span class="op" id="7605016">(</span><span class="string" id="7605017">&#34;IPConn.ReadFromIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7605047">,</span>&nbsp;<span class="ident" id="7605049">err</span><span class="op" id="7605052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7605055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7605058">if</span>&nbsp;<span class="ident" id="7605061">_</span><span class="op" id="7605062">,</span>&nbsp;<span class="ident" id="7605064">_</span><span class="op" id="7605065">,</span>&nbsp;<span class="ident" id="7605067">err</span>&nbsp;<span class="op" id="7605071">:=</span>&nbsp;<span class="ident" id="7605074">c</span><span class="op" id="7605075">.</span><span class="ident" id="7605076">WriteMsgIP</span><span class="op" id="7605086">(</span><span class="ident" id="7605087">wb</span><span class="op" id="7605089">,</span>&nbsp;<span class="ident" id="7605091">nil</span><span class="op" id="7605094">,</span>&nbsp;<span class="ident" id="7605096">c</span><span class="op" id="7605097">.</span><span class="ident" id="7605098">LocalAddr</span><span class="op" id="7605107">(</span><span class="op" id="7605108">)</span><span class="op" id="7605109">.</span><span class="op" id="7605110">(</span><span class="op" id="7605111">*</span><span class="ident" id="7605112">IPAddr</span><span class="op" id="7605118">)</span><span class="op" id="7605119">)</span><span class="op" id="7605120">;</span>&nbsp;<span class="ident" id="7605122">err</span>&nbsp;<span class="op" id="7605126">!=</span>&nbsp;<span class="ident" id="7605129">nil</span>&nbsp;<span class="op" id="7605133">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7605137">condFatalf</span><span class="op" id="7605147">(</span><span class="ident" id="7605148">t</span><span class="op" id="7605149">,</span>&nbsp;<span class="string" id="7605151">&#34;IPConn.WriteMsgIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7605181">,</span>&nbsp;<span class="ident" id="7605183">err</span><span class="op" id="7605186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7605189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7605192">if</span>&nbsp;<span class="ident" id="7605195">_</span><span class="op" id="7605196">,</span>&nbsp;<span class="ident" id="7605198">_</span><span class="op" id="7605199">,</span>&nbsp;<span class="ident" id="7605201">_</span><span class="op" id="7605202">,</span>&nbsp;<span class="ident" id="7605204">_</span><span class="op" id="7605205">,</span>&nbsp;<span class="ident" id="7605207">err</span>&nbsp;<span class="op" id="7605211">:=</span>&nbsp;<span class="ident" id="7605214">c</span><span class="op" id="7605215">.</span><span class="ident" id="7605216">ReadMsgIP</span><span class="op" id="7605225">(</span><span class="ident" id="7605226">rb</span><span class="op" id="7605228">,</span>&nbsp;<span class="ident" id="7605230">nil</span><span class="op" id="7605233">)</span><span class="op" id="7605234">;</span>&nbsp;<span class="ident" id="7605236">err</span>&nbsp;<span class="op" id="7605240">!=</span>&nbsp;<span class="ident" id="7605243">nil</span>&nbsp;<span class="op" id="7605247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7605251">condFatalf</span><span class="op" id="7605261">(</span><span class="ident" id="7605262">t</span><span class="op" id="7605263">,</span>&nbsp;<span class="string" id="7605265">&#34;IPConn.ReadMsgIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7605294">,</span>&nbsp;<span class="ident" id="7605296">err</span><span class="op" id="7605299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7605302">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7605306">if</span>&nbsp;<span class="ident" id="7605309">f</span><span class="op" id="7605310">,</span>&nbsp;<span class="ident" id="7605312">err</span>&nbsp;<span class="op" id="7605316">:=</span>&nbsp;<span class="ident" id="7605319">c</span><span class="op" id="7605320">.</span><span class="ident" id="7605321">File</span><span class="op" id="7605325">(</span><span class="op" id="7605326">)</span><span class="op" id="7605327">;</span>&nbsp;<span class="ident" id="7605329">err</span>&nbsp;<span class="op" id="7605333">!=</span>&nbsp;<span class="ident" id="7605336">nil</span>&nbsp;<span class="op" id="7605340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7605344">condFatalf</span><span class="op" id="7605354">(</span><span class="ident" id="7605355">t</span><span class="op" id="7605356">,</span>&nbsp;<span class="string" id="7605358">&#34;IPConn.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7605382">,</span>&nbsp;<span class="ident" id="7605384">err</span><span class="op" id="7605387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7605390">}</span>&nbsp;<span class="keyword" id="7605392">else</span>&nbsp;<span class="op" id="7605397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7605401">f</span><span class="op" id="7605402">.</span><span class="ident" id="7605403">Close</span><span class="op" id="7605408">(</span><span class="op" id="7605409">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7605412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7605416">defer</span>&nbsp;<span class="keyword" id="7605422">func</span><span class="op" id="7605426">(</span><span class="op" id="7605427">)</span>&nbsp;<span class="op" id="7605429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7605433">if</span>&nbsp;<span class="ident" id="7605436">p</span>&nbsp;<span class="op" id="7605438">:=</span>&nbsp;<span class="builtinfunc" id="7605441">recover</span><span class="op" id="7605448">(</span><span class="op" id="7605449">)</span><span class="op" id="7605450">;</span>&nbsp;<span class="ident" id="7605452">p</span>&nbsp;<span class="op" id="7605454">!=</span>&nbsp;<span class="ident" id="7605457">nil</span>&nbsp;<span class="op" id="7605461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7605466">t</span><span class="op" id="7605467">.</span><span class="ident" id="7605468">Fatalf</span><span class="op" id="7605474">(</span><span class="string" id="7605475">&#34;IPConn.WriteToIP&nbsp;or&nbsp;WriteMsgIP&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="7605520">,</span>&nbsp;<span class="ident" id="7605522">p</span><span class="op" id="7605523">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7605527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7605530">}</span><span class="op" id="7605531">(</span><span class="op" id="7605532">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7605536">c</span><span class="op" id="7605537">.</span><span class="ident" id="7605538">WriteToIP</span><span class="op" id="7605547">(</span><span class="ident" id="7605548">wb</span><span class="op" id="7605550">,</span>&nbsp;<span class="ident" id="7605552">nil</span><span class="op" id="7605555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7605558">c</span><span class="op" id="7605559">.</span><span class="ident" id="7605560">WriteMsgIP</span><span class="op" id="7605570">(</span><span class="ident" id="7605571">wb</span><span class="op" id="7605573">,</span>&nbsp;<span class="ident" id="7605575">nil</span><span class="op" id="7605578">,</span>&nbsp;<span class="ident" id="7605580">nil</span><span class="op" id="7605583">)</span><br>
<span class="lineno">235</span><span class="op" id="7605585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7605588">func</span>&nbsp;<span class="ident" id="7605593">TestUnixListenerSpecificMethods</span><span class="op" id="7605624">(</span><span class="ident" id="7605625">t</span>&nbsp;<span class="op" id="7605627">*</span><span class="ident" id="7605628">testing</span><span class="op" id="7605635">.</span><span class="ident" id="7605636">T</span><span class="op" id="7605637">)</span>&nbsp;<span class="op" id="7605639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7605642">switch</span>&nbsp;<span class="ident" id="7605649">runtime</span><span class="op" id="7605656">.</span><span class="ident" id="7605657">GOOS</span>&nbsp;<span class="op" id="7605662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7605665">case</span>&nbsp;<span class="string" id="7605670">&#34;nacl&#34;</span><span class="op" id="7605676">,</span>&nbsp;<span class="string" id="7605678">&#34;plan9&#34;</span><span class="op" id="7605685">,</span>&nbsp;<span class="string" id="7605687">&#34;windows&#34;</span><span class="op" id="7605696">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7605700">t</span><span class="op" id="7605701">.</span><span class="ident" id="7605702">Skipf</span><span class="op" id="7605707">(</span><span class="string" id="7605708">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7605729">,</span>&nbsp;<span class="ident" id="7605731">runtime</span><span class="op" id="7605738">.</span><span class="ident" id="7605739">GOOS</span><span class="op" id="7605743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7605746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7605750">addr</span>&nbsp;<span class="op" id="7605755">:=</span>&nbsp;<span class="ident" id="7605758">testUnixAddr</span><span class="op" id="7605770">(</span><span class="op" id="7605771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7605774">la</span><span class="op" id="7605776">,</span>&nbsp;<span class="ident" id="7605778">err</span>&nbsp;<span class="op" id="7605782">:=</span>&nbsp;<span class="ident" id="7605785">ResolveUnixAddr</span><span class="op" id="7605800">(</span><span class="string" id="7605801">&#34;unix&#34;</span><span class="op" id="7605807">,</span>&nbsp;<span class="ident" id="7605809">addr</span><span class="op" id="7605813">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7605816">if</span>&nbsp;<span class="ident" id="7605819">err</span>&nbsp;<span class="op" id="7605823">!=</span>&nbsp;<span class="ident" id="7605826">nil</span>&nbsp;<span class="op" id="7605830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7605834">t</span><span class="op" id="7605835">.</span><span class="ident" id="7605836">Fatalf</span><span class="op" id="7605842">(</span><span class="string" id="7605843">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7605871">,</span>&nbsp;<span class="ident" id="7605873">err</span><span class="op" id="7605876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7605879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7605882">ln</span><span class="op" id="7605884">,</span>&nbsp;<span class="ident" id="7605886">err</span>&nbsp;<span class="op" id="7605890">:=</span>&nbsp;<span class="ident" id="7605893">ListenUnix</span><span class="op" id="7605903">(</span><span class="string" id="7605904">&#34;unix&#34;</span><span class="op" id="7605910">,</span>&nbsp;<span class="ident" id="7605912">la</span><span class="op" id="7605914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7605917">if</span>&nbsp;<span class="ident" id="7605920">err</span>&nbsp;<span class="op" id="7605924">!=</span>&nbsp;<span class="ident" id="7605927">nil</span>&nbsp;<span class="op" id="7605931">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7605935">t</span><span class="op" id="7605936">.</span><span class="ident" id="7605937">Fatalf</span><span class="op" id="7605943">(</span><span class="string" id="7605944">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7605967">,</span>&nbsp;<span class="ident" id="7605969">err</span><span class="op" id="7605972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7605975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7605978">defer</span>&nbsp;<span class="ident" id="7605984">ln</span><span class="op" id="7605986">.</span><span class="ident" id="7605987">Close</span><span class="op" id="7605992">(</span><span class="op" id="7605993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7605996">defer</span>&nbsp;<span class="ident" id="7606002">os</span><span class="op" id="7606004">.</span><span class="ident" id="7606005">Remove</span><span class="op" id="7606011">(</span><span class="ident" id="7606012">addr</span><span class="op" id="7606016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7606019">ln</span><span class="op" id="7606021">.</span><span class="ident" id="7606022">Addr</span><span class="op" id="7606026">(</span><span class="op" id="7606027">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7606030">ln</span><span class="op" id="7606032">.</span><span class="ident" id="7606033">SetDeadline</span><span class="op" id="7606044">(</span><span class="ident" id="7606045">time</span><span class="op" id="7606049">.</span><span class="ident" id="7606050">Now</span><span class="op" id="7606053">(</span><span class="op" id="7606054">)</span><span class="op" id="7606055">.</span><span class="ident" id="7606056">Add</span><span class="op" id="7606059">(</span><span class="num" id="7606060">30</span>&nbsp;<span class="op" id="7606063">*</span>&nbsp;<span class="ident" id="7606065">time</span><span class="op" id="7606069">.</span><span class="ident" id="7606070">Nanosecond</span><span class="op" id="7606080">)</span><span class="op" id="7606081">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7606085">if</span>&nbsp;<span class="ident" id="7606088">c</span><span class="op" id="7606089">,</span>&nbsp;<span class="ident" id="7606091">err</span>&nbsp;<span class="op" id="7606095">:=</span>&nbsp;<span class="ident" id="7606098">ln</span><span class="op" id="7606100">.</span><span class="ident" id="7606101">Accept</span><span class="op" id="7606107">(</span><span class="op" id="7606108">)</span><span class="op" id="7606109">;</span>&nbsp;<span class="ident" id="7606111">err</span>&nbsp;<span class="op" id="7606115">!=</span>&nbsp;<span class="ident" id="7606118">nil</span>&nbsp;<span class="op" id="7606122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7606126">if</span>&nbsp;<span class="op" id="7606129">!</span><span class="ident" id="7606130">err</span><span class="op" id="7606133">.</span><span class="op" id="7606134">(</span><span class="ident" id="7606135">Error</span><span class="op" id="7606140">)</span><span class="op" id="7606141">.</span><span class="ident" id="7606142">Timeout</span><span class="op" id="7606149">(</span><span class="op" id="7606150">)</span>&nbsp;<span class="op" id="7606152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7606157">t</span><span class="op" id="7606158">.</span><span class="ident" id="7606159">Fatalf</span><span class="op" id="7606165">(</span><span class="string" id="7606166">&#34;UnixListener.Accept&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7606198">,</span>&nbsp;<span class="ident" id="7606200">err</span><span class="op" id="7606203">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7606207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7606210">}</span>&nbsp;<span class="keyword" id="7606212">else</span>&nbsp;<span class="op" id="7606217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7606221">c</span><span class="op" id="7606222">.</span><span class="ident" id="7606223">Close</span><span class="op" id="7606228">(</span><span class="op" id="7606229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7606232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7606235">if</span>&nbsp;<span class="ident" id="7606238">c</span><span class="op" id="7606239">,</span>&nbsp;<span class="ident" id="7606241">err</span>&nbsp;<span class="op" id="7606245">:=</span>&nbsp;<span class="ident" id="7606248">ln</span><span class="op" id="7606250">.</span><span class="ident" id="7606251">AcceptUnix</span><span class="op" id="7606261">(</span><span class="op" id="7606262">)</span><span class="op" id="7606263">;</span>&nbsp;<span class="ident" id="7606265">err</span>&nbsp;<span class="op" id="7606269">!=</span>&nbsp;<span class="ident" id="7606272">nil</span>&nbsp;<span class="op" id="7606276">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7606280">if</span>&nbsp;<span class="op" id="7606283">!</span><span class="ident" id="7606284">err</span><span class="op" id="7606287">.</span><span class="op" id="7606288">(</span><span class="ident" id="7606289">Error</span><span class="op" id="7606294">)</span><span class="op" id="7606295">.</span><span class="ident" id="7606296">Timeout</span><span class="op" id="7606303">(</span><span class="op" id="7606304">)</span>&nbsp;<span class="op" id="7606306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7606311">t</span><span class="op" id="7606312">.</span><span class="ident" id="7606313">Fatalf</span><span class="op" id="7606319">(</span><span class="string" id="7606320">&#34;UnixListener.AcceptUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7606356">,</span>&nbsp;<span class="ident" id="7606358">err</span><span class="op" id="7606361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7606365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7606368">}</span>&nbsp;<span class="keyword" id="7606370">else</span>&nbsp;<span class="op" id="7606375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7606379">c</span><span class="op" id="7606380">.</span><span class="ident" id="7606381">Close</span><span class="op" id="7606386">(</span><span class="op" id="7606387">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7606390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7606394">if</span>&nbsp;<span class="ident" id="7606397">f</span><span class="op" id="7606398">,</span>&nbsp;<span class="ident" id="7606400">err</span>&nbsp;<span class="op" id="7606404">:=</span>&nbsp;<span class="ident" id="7606407">ln</span><span class="op" id="7606409">.</span><span class="ident" id="7606410">File</span><span class="op" id="7606414">(</span><span class="op" id="7606415">)</span><span class="op" id="7606416">;</span>&nbsp;<span class="ident" id="7606418">err</span>&nbsp;<span class="op" id="7606422">!=</span>&nbsp;<span class="ident" id="7606425">nil</span>&nbsp;<span class="op" id="7606429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7606433">t</span><span class="op" id="7606434">.</span><span class="ident" id="7606435">Fatalf</span><span class="op" id="7606441">(</span><span class="string" id="7606442">&#34;UnixListener.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7606472">,</span>&nbsp;<span class="ident" id="7606474">err</span><span class="op" id="7606477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7606480">}</span>&nbsp;<span class="keyword" id="7606482">else</span>&nbsp;<span class="op" id="7606487">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7606491">f</span><span class="op" id="7606492">.</span><span class="ident" id="7606493">Close</span><span class="op" id="7606498">(</span><span class="op" id="7606499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7606502">}</span><br>
<span class="lineno"></span><span class="op" id="7606504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7606507">func</span>&nbsp;<span class="ident" id="7606512">TestUnixConnSpecificMethods</span><span class="op" id="7606539">(</span><span class="ident" id="7606540">t</span>&nbsp;<span class="op" id="7606542">*</span><span class="ident" id="7606543">testing</span><span class="op" id="7606550">.</span><span class="ident" id="7606551">T</span><span class="op" id="7606552">)</span>&nbsp;<span class="op" id="7606554">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7606557">switch</span>&nbsp;<span class="ident" id="7606564">runtime</span><span class="op" id="7606571">.</span><span class="ident" id="7606572">GOOS</span>&nbsp;<span class="op" id="7606577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7606580">case</span>&nbsp;<span class="string" id="7606585">&#34;nacl&#34;</span><span class="op" id="7606591">,</span>&nbsp;<span class="string" id="7606593">&#34;plan9&#34;</span><span class="op" id="7606600">,</span>&nbsp;<span class="string" id="7606602">&#34;windows&#34;</span><span class="op" id="7606611">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7606615">t</span><span class="op" id="7606616">.</span><span class="ident" id="7606617">Skipf</span><span class="op" id="7606622">(</span><span class="string" id="7606623">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7606644">,</span>&nbsp;<span class="ident" id="7606646">runtime</span><span class="op" id="7606653">.</span><span class="ident" id="7606654">GOOS</span><span class="op" id="7606658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7606661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7606665">addr1</span><span class="op" id="7606670">,</span>&nbsp;<span class="ident" id="7606672">addr2</span><span class="op" id="7606677">,</span>&nbsp;<span class="ident" id="7606679">addr3</span>&nbsp;<span class="op" id="7606685">:=</span>&nbsp;<span class="ident" id="7606688">testUnixAddr</span><span class="op" id="7606700">(</span><span class="op" id="7606701">)</span><span class="op" id="7606702">,</span>&nbsp;<span class="ident" id="7606704">testUnixAddr</span><span class="op" id="7606716">(</span><span class="op" id="7606717">)</span><span class="op" id="7606718">,</span>&nbsp;<span class="ident" id="7606720">testUnixAddr</span><span class="op" id="7606732">(</span><span class="op" id="7606733">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7606737">a1</span><span class="op" id="7606739">,</span>&nbsp;<span class="ident" id="7606741">err</span>&nbsp;<span class="op" id="7606745">:=</span>&nbsp;<span class="ident" id="7606748">ResolveUnixAddr</span><span class="op" id="7606763">(</span><span class="string" id="7606764">&#34;unixgram&#34;</span><span class="op" id="7606774">,</span>&nbsp;<span class="ident" id="7606776">addr1</span><span class="op" id="7606781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7606784">if</span>&nbsp;<span class="ident" id="7606787">err</span>&nbsp;<span class="op" id="7606791">!=</span>&nbsp;<span class="ident" id="7606794">nil</span>&nbsp;<span class="op" id="7606798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7606802">t</span><span class="op" id="7606803">.</span><span class="ident" id="7606804">Fatalf</span><span class="op" id="7606810">(</span><span class="string" id="7606811">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7606839">,</span>&nbsp;<span class="ident" id="7606841">err</span><span class="op" id="7606844">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7606847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7606850">c1</span><span class="op" id="7606852">,</span>&nbsp;<span class="ident" id="7606854">err</span>&nbsp;<span class="op" id="7606858">:=</span>&nbsp;<span class="ident" id="7606861">DialUnix</span><span class="op" id="7606869">(</span><span class="string" id="7606870">&#34;unixgram&#34;</span><span class="op" id="7606880">,</span>&nbsp;<span class="ident" id="7606882">a1</span><span class="op" id="7606884">,</span>&nbsp;<span class="ident" id="7606886">nil</span><span class="op" id="7606889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7606892">if</span>&nbsp;<span class="ident" id="7606895">err</span>&nbsp;<span class="op" id="7606899">!=</span>&nbsp;<span class="ident" id="7606902">nil</span>&nbsp;<span class="op" id="7606906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7606910">t</span><span class="op" id="7606911">.</span><span class="ident" id="7606912">Fatalf</span><span class="op" id="7606918">(</span><span class="string" id="7606919">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7606940">,</span>&nbsp;<span class="ident" id="7606942">err</span><span class="op" id="7606945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7606948">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7606951">defer</span>&nbsp;<span class="ident" id="7606957">c1</span><span class="op" id="7606959">.</span><span class="ident" id="7606960">Close</span><span class="op" id="7606965">(</span><span class="op" id="7606966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7606969">defer</span>&nbsp;<span class="ident" id="7606975">os</span><span class="op" id="7606977">.</span><span class="ident" id="7606978">Remove</span><span class="op" id="7606984">(</span><span class="ident" id="7606985">addr1</span><span class="op" id="7606990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7606993">c1</span><span class="op" id="7606995">.</span><span class="ident" id="7606996">LocalAddr</span><span class="op" id="7607005">(</span><span class="op" id="7607006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7607009">c1</span><span class="op" id="7607011">.</span><span class="ident" id="7607012">RemoteAddr</span><span class="op" id="7607022">(</span><span class="op" id="7607023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7607026">c1</span><span class="op" id="7607028">.</span><span class="ident" id="7607029">SetDeadline</span><span class="op" id="7607040">(</span><span class="ident" id="7607041">time</span><span class="op" id="7607045">.</span><span class="ident" id="7607046">Now</span><span class="op" id="7607049">(</span><span class="op" id="7607050">)</span><span class="op" id="7607051">.</span><span class="ident" id="7607052">Add</span><span class="op" id="7607055">(</span><span class="ident" id="7607056">someTimeout</span><span class="op" id="7607067">)</span><span class="op" id="7607068">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7607071">c1</span><span class="op" id="7607073">.</span><span class="ident" id="7607074">SetReadDeadline</span><span class="op" id="7607089">(</span><span class="ident" id="7607090">time</span><span class="op" id="7607094">.</span><span class="ident" id="7607095">Now</span><span class="op" id="7607098">(</span><span class="op" id="7607099">)</span><span class="op" id="7607100">.</span><span class="ident" id="7607101">Add</span><span class="op" id="7607104">(</span><span class="ident" id="7607105">someTimeout</span><span class="op" id="7607116">)</span><span class="op" id="7607117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7607120">c1</span><span class="op" id="7607122">.</span><span class="ident" id="7607123">SetWriteDeadline</span><span class="op" id="7607139">(</span><span class="ident" id="7607140">time</span><span class="op" id="7607144">.</span><span class="ident" id="7607145">Now</span><span class="op" id="7607148">(</span><span class="op" id="7607149">)</span><span class="op" id="7607150">.</span><span class="ident" id="7607151">Add</span><span class="op" id="7607154">(</span><span class="ident" id="7607155">someTimeout</span><span class="op" id="7607166">)</span><span class="op" id="7607167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7607170">c1</span><span class="op" id="7607172">.</span><span class="ident" id="7607173">SetReadBuffer</span><span class="op" id="7607186">(</span><span class="num" id="7607187">2048</span><span class="op" id="7607191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7607194">c1</span><span class="op" id="7607196">.</span><span class="ident" id="7607197">SetWriteBuffer</span><span class="op" id="7607211">(</span><span class="num" id="7607212">2048</span><span class="op" id="7607216">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7607220">a2</span><span class="op" id="7607222">,</span>&nbsp;<span class="ident" id="7607224">err</span>&nbsp;<span class="op" id="7607228">:=</span>&nbsp;<span class="ident" id="7607231">ResolveUnixAddr</span><span class="op" id="7607246">(</span><span class="string" id="7607247">&#34;unixgram&#34;</span><span class="op" id="7607257">,</span>&nbsp;<span class="ident" id="7607259">addr2</span><span class="op" id="7607264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7607267">if</span>&nbsp;<span class="ident" id="7607270">err</span>&nbsp;<span class="op" id="7607274">!=</span>&nbsp;<span class="ident" id="7607277">nil</span>&nbsp;<span class="op" id="7607281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7607285">t</span><span class="op" id="7607286">.</span><span class="ident" id="7607287">Fatalf</span><span class="op" id="7607293">(</span><span class="string" id="7607294">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7607322">,</span>&nbsp;<span class="ident" id="7607324">err</span><span class="op" id="7607327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7607330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7607333">c2</span><span class="op" id="7607335">,</span>&nbsp;<span class="ident" id="7607337">err</span>&nbsp;<span class="op" id="7607341">:=</span>&nbsp;<span class="ident" id="7607344">DialUnix</span><span class="op" id="7607352">(</span><span class="string" id="7607353">&#34;unixgram&#34;</span><span class="op" id="7607363">,</span>&nbsp;<span class="ident" id="7607365">a2</span><span class="op" id="7607367">,</span>&nbsp;<span class="ident" id="7607369">nil</span><span class="op" id="7607372">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7607375">if</span>&nbsp;<span class="ident" id="7607378">err</span>&nbsp;<span class="op" id="7607382">!=</span>&nbsp;<span class="ident" id="7607385">nil</span>&nbsp;<span class="op" id="7607389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7607393">t</span><span class="op" id="7607394">.</span><span class="ident" id="7607395">Fatalf</span><span class="op" id="7607401">(</span><span class="string" id="7607402">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7607423">,</span>&nbsp;<span class="ident" id="7607425">err</span><span class="op" id="7607428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7607431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7607434">defer</span>&nbsp;<span class="ident" id="7607440">c2</span><span class="op" id="7607442">.</span><span class="ident" id="7607443">Close</span><span class="op" id="7607448">(</span><span class="op" id="7607449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7607452">defer</span>&nbsp;<span class="ident" id="7607458">os</span><span class="op" id="7607460">.</span><span class="ident" id="7607461">Remove</span><span class="op" id="7607467">(</span><span class="ident" id="7607468">addr2</span><span class="op" id="7607473">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7607476">c2</span><span class="op" id="7607478">.</span><span class="ident" id="7607479">LocalAddr</span><span class="op" id="7607488">(</span><span class="op" id="7607489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7607492">c2</span><span class="op" id="7607494">.</span><span class="ident" id="7607495">RemoteAddr</span><span class="op" id="7607505">(</span><span class="op" id="7607506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7607509">c2</span><span class="op" id="7607511">.</span><span class="ident" id="7607512">SetDeadline</span><span class="op" id="7607523">(</span><span class="ident" id="7607524">time</span><span class="op" id="7607528">.</span><span class="ident" id="7607529">Now</span><span class="op" id="7607532">(</span><span class="op" id="7607533">)</span><span class="op" id="7607534">.</span><span class="ident" id="7607535">Add</span><span class="op" id="7607538">(</span><span class="ident" id="7607539">someTimeout</span><span class="op" id="7607550">)</span><span class="op" id="7607551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7607554">c2</span><span class="op" id="7607556">.</span><span class="ident" id="7607557">SetReadDeadline</span><span class="op" id="7607572">(</span><span class="ident" id="7607573">time</span><span class="op" id="7607577">.</span><span class="ident" id="7607578">Now</span><span class="op" id="7607581">(</span><span class="op" id="7607582">)</span><span class="op" id="7607583">.</span><span class="ident" id="7607584">Add</span><span class="op" id="7607587">(</span><span class="ident" id="7607588">someTimeout</span><span class="op" id="7607599">)</span><span class="op" id="7607600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7607603">c2</span><span class="op" id="7607605">.</span><span class="ident" id="7607606">SetWriteDeadline</span><span class="op" id="7607622">(</span><span class="ident" id="7607623">time</span><span class="op" id="7607627">.</span><span class="ident" id="7607628">Now</span><span class="op" id="7607631">(</span><span class="op" id="7607632">)</span><span class="op" id="7607633">.</span><span class="ident" id="7607634">Add</span><span class="op" id="7607637">(</span><span class="ident" id="7607638">someTimeout</span><span class="op" id="7607649">)</span><span class="op" id="7607650">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7607653">c2</span><span class="op" id="7607655">.</span><span class="ident" id="7607656">SetReadBuffer</span><span class="op" id="7607669">(</span><span class="num" id="7607670">2048</span><span class="op" id="7607674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7607677">c2</span><span class="op" id="7607679">.</span><span class="ident" id="7607680">SetWriteBuffer</span><span class="op" id="7607694">(</span><span class="num" id="7607695">2048</span><span class="op" id="7607699">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7607703">a3</span><span class="op" id="7607705">,</span>&nbsp;<span class="ident" id="7607707">err</span>&nbsp;<span class="op" id="7607711">:=</span>&nbsp;<span class="ident" id="7607714">ResolveUnixAddr</span><span class="op" id="7607729">(</span><span class="string" id="7607730">&#34;unixgram&#34;</span><span class="op" id="7607740">,</span>&nbsp;<span class="ident" id="7607742">addr3</span><span class="op" id="7607747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7607750">if</span>&nbsp;<span class="ident" id="7607753">err</span>&nbsp;<span class="op" id="7607757">!=</span>&nbsp;<span class="ident" id="7607760">nil</span>&nbsp;<span class="op" id="7607764">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7607768">t</span><span class="op" id="7607769">.</span><span class="ident" id="7607770">Fatalf</span><span class="op" id="7607776">(</span><span class="string" id="7607777">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7607805">,</span>&nbsp;<span class="ident" id="7607807">err</span><span class="op" id="7607810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7607813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7607816">c3</span><span class="op" id="7607818">,</span>&nbsp;<span class="ident" id="7607820">err</span>&nbsp;<span class="op" id="7607824">:=</span>&nbsp;<span class="ident" id="7607827">ListenUnixgram</span><span class="op" id="7607841">(</span><span class="string" id="7607842">&#34;unixgram&#34;</span><span class="op" id="7607852">,</span>&nbsp;<span class="ident" id="7607854">a3</span><span class="op" id="7607856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7607859">if</span>&nbsp;<span class="ident" id="7607862">err</span>&nbsp;<span class="op" id="7607866">!=</span>&nbsp;<span class="ident" id="7607869">nil</span>&nbsp;<span class="op" id="7607873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7607877">t</span><span class="op" id="7607878">.</span><span class="ident" id="7607879">Fatalf</span><span class="op" id="7607885">(</span><span class="string" id="7607886">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7607913">,</span>&nbsp;<span class="ident" id="7607915">err</span><span class="op" id="7607918">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7607921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7607924">defer</span>&nbsp;<span class="ident" id="7607930">c3</span><span class="op" id="7607932">.</span><span class="ident" id="7607933">Close</span><span class="op" id="7607938">(</span><span class="op" id="7607939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7607942">defer</span>&nbsp;<span class="ident" id="7607948">os</span><span class="op" id="7607950">.</span><span class="ident" id="7607951">Remove</span><span class="op" id="7607957">(</span><span class="ident" id="7607958">addr3</span><span class="op" id="7607963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7607966">c3</span><span class="op" id="7607968">.</span><span class="ident" id="7607969">LocalAddr</span><span class="op" id="7607978">(</span><span class="op" id="7607979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7607982">c3</span><span class="op" id="7607984">.</span><span class="ident" id="7607985">RemoteAddr</span><span class="op" id="7607995">(</span><span class="op" id="7607996">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7607999">c3</span><span class="op" id="7608001">.</span><span class="ident" id="7608002">SetDeadline</span><span class="op" id="7608013">(</span><span class="ident" id="7608014">time</span><span class="op" id="7608018">.</span><span class="ident" id="7608019">Now</span><span class="op" id="7608022">(</span><span class="op" id="7608023">)</span><span class="op" id="7608024">.</span><span class="ident" id="7608025">Add</span><span class="op" id="7608028">(</span><span class="ident" id="7608029">someTimeout</span><span class="op" id="7608040">)</span><span class="op" id="7608041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7608044">c3</span><span class="op" id="7608046">.</span><span class="ident" id="7608047">SetReadDeadline</span><span class="op" id="7608062">(</span><span class="ident" id="7608063">time</span><span class="op" id="7608067">.</span><span class="ident" id="7608068">Now</span><span class="op" id="7608071">(</span><span class="op" id="7608072">)</span><span class="op" id="7608073">.</span><span class="ident" id="7608074">Add</span><span class="op" id="7608077">(</span><span class="ident" id="7608078">someTimeout</span><span class="op" id="7608089">)</span><span class="op" id="7608090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7608093">c3</span><span class="op" id="7608095">.</span><span class="ident" id="7608096">SetWriteDeadline</span><span class="op" id="7608112">(</span><span class="ident" id="7608113">time</span><span class="op" id="7608117">.</span><span class="ident" id="7608118">Now</span><span class="op" id="7608121">(</span><span class="op" id="7608122">)</span><span class="op" id="7608123">.</span><span class="ident" id="7608124">Add</span><span class="op" id="7608127">(</span><span class="ident" id="7608128">someTimeout</span><span class="op" id="7608139">)</span><span class="op" id="7608140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7608143">c3</span><span class="op" id="7608145">.</span><span class="ident" id="7608146">SetReadBuffer</span><span class="op" id="7608159">(</span><span class="num" id="7608160">2048</span><span class="op" id="7608164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7608167">c3</span><span class="op" id="7608169">.</span><span class="ident" id="7608170">SetWriteBuffer</span><span class="op" id="7608184">(</span><span class="num" id="7608185">2048</span><span class="op" id="7608189">)</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7608193">wb</span>&nbsp;<span class="op" id="7608196">:=</span>&nbsp;<span class="op" id="7608199">[</span><span class="op" id="7608200">]</span><span class="builtintype" id="7608201">byte</span><span class="op" id="7608205">(</span><span class="string" id="7608206">&#34;UNIXCONN&nbsp;TEST&#34;</span><span class="op" id="7608221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7608224">rb1</span>&nbsp;<span class="op" id="7608228">:=</span>&nbsp;<span class="builtinfunc" id="7608231">make</span><span class="op" id="7608235">(</span><span class="op" id="7608236">[</span><span class="op" id="7608237">]</span><span class="builtintype" id="7608238">byte</span><span class="op" id="7608242">,</span>&nbsp;<span class="num" id="7608244">128</span><span class="op" id="7608247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7608250">rb2</span>&nbsp;<span class="op" id="7608254">:=</span>&nbsp;<span class="builtinfunc" id="7608257">make</span><span class="op" id="7608261">(</span><span class="op" id="7608262">[</span><span class="op" id="7608263">]</span><span class="builtintype" id="7608264">byte</span><span class="op" id="7608268">,</span>&nbsp;<span class="num" id="7608270">128</span><span class="op" id="7608273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7608276">rb3</span>&nbsp;<span class="op" id="7608280">:=</span>&nbsp;<span class="builtinfunc" id="7608283">make</span><span class="op" id="7608287">(</span><span class="op" id="7608288">[</span><span class="op" id="7608289">]</span><span class="builtintype" id="7608290">byte</span><span class="op" id="7608294">,</span>&nbsp;<span class="num" id="7608296">128</span><span class="op" id="7608299">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7608302">if</span>&nbsp;<span class="ident" id="7608305">_</span><span class="op" id="7608306">,</span>&nbsp;<span class="ident" id="7608308">_</span><span class="op" id="7608309">,</span>&nbsp;<span class="ident" id="7608311">err</span>&nbsp;<span class="op" id="7608315">:=</span>&nbsp;<span class="ident" id="7608318">c1</span><span class="op" id="7608320">.</span><span class="ident" id="7608321">WriteMsgUnix</span><span class="op" id="7608333">(</span><span class="ident" id="7608334">wb</span><span class="op" id="7608336">,</span>&nbsp;<span class="ident" id="7608338">nil</span><span class="op" id="7608341">,</span>&nbsp;<span class="ident" id="7608343">a2</span><span class="op" id="7608345">)</span><span class="op" id="7608346">;</span>&nbsp;<span class="ident" id="7608348">err</span>&nbsp;<span class="op" id="7608352">!=</span>&nbsp;<span class="ident" id="7608355">nil</span>&nbsp;<span class="op" id="7608359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7608363">t</span><span class="op" id="7608364">.</span><span class="ident" id="7608365">Fatalf</span><span class="op" id="7608371">(</span><span class="string" id="7608372">&#34;UnixConn.WriteMsgUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7608406">,</span>&nbsp;<span class="ident" id="7608408">err</span><span class="op" id="7608411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7608414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7608417">if</span>&nbsp;<span class="ident" id="7608420">_</span><span class="op" id="7608421">,</span>&nbsp;<span class="ident" id="7608423">_</span><span class="op" id="7608424">,</span>&nbsp;<span class="ident" id="7608426">_</span><span class="op" id="7608427">,</span>&nbsp;<span class="ident" id="7608429">_</span><span class="op" id="7608430">,</span>&nbsp;<span class="ident" id="7608432">err</span>&nbsp;<span class="op" id="7608436">:=</span>&nbsp;<span class="ident" id="7608439">c2</span><span class="op" id="7608441">.</span><span class="ident" id="7608442">ReadMsgUnix</span><span class="op" id="7608453">(</span><span class="ident" id="7608454">rb2</span><span class="op" id="7608457">,</span>&nbsp;<span class="ident" id="7608459">nil</span><span class="op" id="7608462">)</span><span class="op" id="7608463">;</span>&nbsp;<span class="ident" id="7608465">err</span>&nbsp;<span class="op" id="7608469">!=</span>&nbsp;<span class="ident" id="7608472">nil</span>&nbsp;<span class="op" id="7608476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7608480">t</span><span class="op" id="7608481">.</span><span class="ident" id="7608482">Fatalf</span><span class="op" id="7608488">(</span><span class="string" id="7608489">&#34;UnixConn.ReadMsgUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7608522">,</span>&nbsp;<span class="ident" id="7608524">err</span><span class="op" id="7608527">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7608530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7608533">if</span>&nbsp;<span class="ident" id="7608536">_</span><span class="op" id="7608537">,</span>&nbsp;<span class="ident" id="7608539">err</span>&nbsp;<span class="op" id="7608543">:=</span>&nbsp;<span class="ident" id="7608546">c2</span><span class="op" id="7608548">.</span><span class="ident" id="7608549">WriteToUnix</span><span class="op" id="7608560">(</span><span class="ident" id="7608561">wb</span><span class="op" id="7608563">,</span>&nbsp;<span class="ident" id="7608565">a1</span><span class="op" id="7608567">)</span><span class="op" id="7608568">;</span>&nbsp;<span class="ident" id="7608570">err</span>&nbsp;<span class="op" id="7608574">!=</span>&nbsp;<span class="ident" id="7608577">nil</span>&nbsp;<span class="op" id="7608581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7608585">t</span><span class="op" id="7608586">.</span><span class="ident" id="7608587">Fatalf</span><span class="op" id="7608593">(</span><span class="string" id="7608594">&#34;UnixConn.WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7608627">,</span>&nbsp;<span class="ident" id="7608629">err</span><span class="op" id="7608632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7608635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7608638">if</span>&nbsp;<span class="ident" id="7608641">_</span><span class="op" id="7608642">,</span>&nbsp;<span class="ident" id="7608644">_</span><span class="op" id="7608645">,</span>&nbsp;<span class="ident" id="7608647">err</span>&nbsp;<span class="op" id="7608651">:=</span>&nbsp;<span class="ident" id="7608654">c1</span><span class="op" id="7608656">.</span><span class="ident" id="7608657">ReadFromUnix</span><span class="op" id="7608669">(</span><span class="ident" id="7608670">rb1</span><span class="op" id="7608673">)</span><span class="op" id="7608674">;</span>&nbsp;<span class="ident" id="7608676">err</span>&nbsp;<span class="op" id="7608680">!=</span>&nbsp;<span class="ident" id="7608683">nil</span>&nbsp;<span class="op" id="7608687">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7608691">t</span><span class="op" id="7608692">.</span><span class="ident" id="7608693">Fatalf</span><span class="op" id="7608699">(</span><span class="string" id="7608700">&#34;UnixConn.ReadFromUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7608734">,</span>&nbsp;<span class="ident" id="7608736">err</span><span class="op" id="7608739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7608742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7608745">if</span>&nbsp;<span class="ident" id="7608748">_</span><span class="op" id="7608749">,</span>&nbsp;<span class="ident" id="7608751">err</span>&nbsp;<span class="op" id="7608755">:=</span>&nbsp;<span class="ident" id="7608758">c3</span><span class="op" id="7608760">.</span><span class="ident" id="7608761">WriteToUnix</span><span class="op" id="7608772">(</span><span class="ident" id="7608773">wb</span><span class="op" id="7608775">,</span>&nbsp;<span class="ident" id="7608777">a1</span><span class="op" id="7608779">)</span><span class="op" id="7608780">;</span>&nbsp;<span class="ident" id="7608782">err</span>&nbsp;<span class="op" id="7608786">!=</span>&nbsp;<span class="ident" id="7608789">nil</span>&nbsp;<span class="op" id="7608793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7608797">t</span><span class="op" id="7608798">.</span><span class="ident" id="7608799">Fatalf</span><span class="op" id="7608805">(</span><span class="string" id="7608806">&#34;UnixConn.WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7608839">,</span>&nbsp;<span class="ident" id="7608841">err</span><span class="op" id="7608844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7608847">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7608850">if</span>&nbsp;<span class="ident" id="7608853">_</span><span class="op" id="7608854">,</span>&nbsp;<span class="ident" id="7608856">_</span><span class="op" id="7608857">,</span>&nbsp;<span class="ident" id="7608859">err</span>&nbsp;<span class="op" id="7608863">:=</span>&nbsp;<span class="ident" id="7608866">c1</span><span class="op" id="7608868">.</span><span class="ident" id="7608869">ReadFromUnix</span><span class="op" id="7608881">(</span><span class="ident" id="7608882">rb1</span><span class="op" id="7608885">)</span><span class="op" id="7608886">;</span>&nbsp;<span class="ident" id="7608888">err</span>&nbsp;<span class="op" id="7608892">!=</span>&nbsp;<span class="ident" id="7608895">nil</span>&nbsp;<span class="op" id="7608899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7608903">t</span><span class="op" id="7608904">.</span><span class="ident" id="7608905">Fatalf</span><span class="op" id="7608911">(</span><span class="string" id="7608912">&#34;UnixConn.ReadFromUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7608946">,</span>&nbsp;<span class="ident" id="7608948">err</span><span class="op" id="7608951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7608954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7608957">if</span>&nbsp;<span class="ident" id="7608960">_</span><span class="op" id="7608961">,</span>&nbsp;<span class="ident" id="7608963">err</span>&nbsp;<span class="op" id="7608967">:=</span>&nbsp;<span class="ident" id="7608970">c2</span><span class="op" id="7608972">.</span><span class="ident" id="7608973">WriteToUnix</span><span class="op" id="7608984">(</span><span class="ident" id="7608985">wb</span><span class="op" id="7608987">,</span>&nbsp;<span class="ident" id="7608989">a3</span><span class="op" id="7608991">)</span><span class="op" id="7608992">;</span>&nbsp;<span class="ident" id="7608994">err</span>&nbsp;<span class="op" id="7608998">!=</span>&nbsp;<span class="ident" id="7609001">nil</span>&nbsp;<span class="op" id="7609005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7609009">t</span><span class="op" id="7609010">.</span><span class="ident" id="7609011">Fatalf</span><span class="op" id="7609017">(</span><span class="string" id="7609018">&#34;UnixConn.WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7609051">,</span>&nbsp;<span class="ident" id="7609053">err</span><span class="op" id="7609056">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7609059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7609062">if</span>&nbsp;<span class="ident" id="7609065">_</span><span class="op" id="7609066">,</span>&nbsp;<span class="ident" id="7609068">_</span><span class="op" id="7609069">,</span>&nbsp;<span class="ident" id="7609071">err</span>&nbsp;<span class="op" id="7609075">:=</span>&nbsp;<span class="ident" id="7609078">c3</span><span class="op" id="7609080">.</span><span class="ident" id="7609081">ReadFromUnix</span><span class="op" id="7609093">(</span><span class="ident" id="7609094">rb3</span><span class="op" id="7609097">)</span><span class="op" id="7609098">;</span>&nbsp;<span class="ident" id="7609100">err</span>&nbsp;<span class="op" id="7609104">!=</span>&nbsp;<span class="ident" id="7609107">nil</span>&nbsp;<span class="op" id="7609111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7609115">t</span><span class="op" id="7609116">.</span><span class="ident" id="7609117">Fatalf</span><span class="op" id="7609123">(</span><span class="string" id="7609124">&#34;UnixConn.ReadFromUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7609158">,</span>&nbsp;<span class="ident" id="7609160">err</span><span class="op" id="7609163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7609166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7609170">if</span>&nbsp;<span class="ident" id="7609173">f</span><span class="op" id="7609174">,</span>&nbsp;<span class="ident" id="7609176">err</span>&nbsp;<span class="op" id="7609180">:=</span>&nbsp;<span class="ident" id="7609183">c1</span><span class="op" id="7609185">.</span><span class="ident" id="7609186">File</span><span class="op" id="7609190">(</span><span class="op" id="7609191">)</span><span class="op" id="7609192">;</span>&nbsp;<span class="ident" id="7609194">err</span>&nbsp;<span class="op" id="7609198">!=</span>&nbsp;<span class="ident" id="7609201">nil</span>&nbsp;<span class="op" id="7609205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7609209">t</span><span class="op" id="7609210">.</span><span class="ident" id="7609211">Fatalf</span><span class="op" id="7609217">(</span><span class="string" id="7609218">&#34;UnixConn.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7609244">,</span>&nbsp;<span class="ident" id="7609246">err</span><span class="op" id="7609249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7609252">}</span>&nbsp;<span class="keyword" id="7609254">else</span>&nbsp;<span class="op" id="7609259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7609263">f</span><span class="op" id="7609264">.</span><span class="ident" id="7609265">Close</span><span class="op" id="7609270">(</span><span class="op" id="7609271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7609274">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7609278">defer</span>&nbsp;<span class="keyword" id="7609284">func</span><span class="op" id="7609288">(</span><span class="op" id="7609289">)</span>&nbsp;<span class="op" id="7609291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7609295">if</span>&nbsp;<span class="ident" id="7609298">p</span>&nbsp;<span class="op" id="7609300">:=</span>&nbsp;<span class="builtinfunc" id="7609303">recover</span><span class="op" id="7609310">(</span><span class="op" id="7609311">)</span><span class="op" id="7609312">;</span>&nbsp;<span class="ident" id="7609314">p</span>&nbsp;<span class="op" id="7609316">!=</span>&nbsp;<span class="ident" id="7609319">nil</span>&nbsp;<span class="op" id="7609323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7609328">t</span><span class="op" id="7609329">.</span><span class="ident" id="7609330">Fatalf</span><span class="op" id="7609336">(</span><span class="string" id="7609337">&#34;UnixConn.WriteToUnix&nbsp;or&nbsp;WriteMsgUnix&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="7609388">,</span>&nbsp;<span class="ident" id="7609390">p</span><span class="op" id="7609391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7609395">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7609398">}</span><span class="op" id="7609399">(</span><span class="op" id="7609400">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7609404">c1</span><span class="op" id="7609406">.</span><span class="ident" id="7609407">WriteToUnix</span><span class="op" id="7609418">(</span><span class="ident" id="7609419">wb</span><span class="op" id="7609421">,</span>&nbsp;<span class="ident" id="7609423">nil</span><span class="op" id="7609426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7609429">c1</span><span class="op" id="7609431">.</span><span class="ident" id="7609432">WriteMsgUnix</span><span class="op" id="7609444">(</span><span class="ident" id="7609445">wb</span><span class="op" id="7609447">,</span>&nbsp;<span class="ident" id="7609449">nil</span><span class="op" id="7609452">,</span>&nbsp;<span class="ident" id="7609454">nil</span><span class="op" id="7609457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7609460">c3</span><span class="op" id="7609462">.</span><span class="ident" id="7609463">WriteToUnix</span><span class="op" id="7609474">(</span><span class="ident" id="7609475">wb</span><span class="op" id="7609477">,</span>&nbsp;<span class="ident" id="7609479">nil</span><span class="op" id="7609482">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7609485">c3</span><span class="op" id="7609487">.</span><span class="ident" id="7609488">WriteMsgUnix</span><span class="op" id="7609500">(</span><span class="ident" id="7609501">wb</span><span class="op" id="7609503">,</span>&nbsp;<span class="ident" id="7609505">nil</span><span class="op" id="7609508">,</span>&nbsp;<span class="ident" id="7609510">nil</span><span class="op" id="7609513">)</span><br>
<span class="lineno"></span><span class="op" id="7609515">}</span>
</div>
</body>
</html>
