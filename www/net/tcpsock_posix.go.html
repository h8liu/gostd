<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1505589">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1505645">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1505699">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1505750">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1505828">package</span>&nbsp;<span class="ident" id="1505836">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1505841">import</span>&nbsp;<span class="op" id="1505848">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1505851">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1505857">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1505863">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1505874">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="1505881">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="1505884">//&nbsp;BUG(rsc):&nbsp;On&nbsp;OpenBSD,&nbsp;listening&nbsp;on&nbsp;the&nbsp;&#34;tcp&#34;&nbsp;network&nbsp;does&nbsp;not&nbsp;listen&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="1505960">//&nbsp;both&nbsp;IPv4&nbsp;and&nbsp;IPv6&nbsp;connections.&nbsp;This&nbsp;is&nbsp;due&nbsp;to&nbsp;the&nbsp;fact&nbsp;that&nbsp;IPv4&nbsp;traffic</span><br>
<span class="lineno"></span><span class="comment" id="1506037">//&nbsp;will&nbsp;not&nbsp;be&nbsp;routed&nbsp;to&nbsp;an&nbsp;IPv6&nbsp;socket&nbsp;-&nbsp;two&nbsp;separate&nbsp;sockets&nbsp;are&nbsp;required</span><br>
<span class="lineno"></span><span class="comment" id="1506113">//&nbsp;if&nbsp;both&nbsp;AFs&nbsp;are&nbsp;to&nbsp;be&nbsp;supported.&nbsp;See&nbsp;inet6(4)&nbsp;on&nbsp;OpenBSD&nbsp;for&nbsp;details.</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="1506187">func</span>&nbsp;<span class="ident" id="1506192">sockaddrToTCP</span><span class="op" id="1506205">(</span><span class="ident" id="1506206">sa</span>&nbsp;<span class="ident" id="1506209"><a href="/net/tcpsock_posix.go.html#1505863">syscall</a></span><span class="op" id="1506216">.</span><span class="ident" id="1506217">Sockaddr</span><span class="op" id="1506225">)</span>&nbsp;<span class="ident" id="1506227"><a href="/net/net.go.html#1465097">Addr</a></span>&nbsp;<span class="op" id="1506232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1506235">switch</span>&nbsp;<span class="ident" id="1506242">sa</span>&nbsp;<span class="op" id="1506245">:=</span>&nbsp;<span class="ident" id="1506248"><a href="/net/tcpsock_posix.go.html#1506206">sa</a></span><span class="op" id="1506250">.</span><span class="op" id="1506251">(</span><span class="keyword" id="1506252">type</span><span class="op" id="1506256">)</span>&nbsp;<span class="op" id="1506258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1506261">case</span>&nbsp;<span class="op" id="1506266">*</span><span class="ident" id="1506267"><a href="/net/tcpsock_posix.go.html#1505863">syscall</a></span><span class="op" id="1506274">.</span><span class="ident" id="1506275">SockaddrInet4</span><span class="op" id="1506288">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1506292">return</span>&nbsp;<span class="op" id="1506299">&amp;</span><span class="ident" id="1506300"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="1506307">{</span><span class="ident" id="1506308">IP</span><span class="op" id="1506310">:</span>&nbsp;<span class="ident" id="1506312"><a href="/net/tcpsock_posix.go.html#1506242">sa</a></span><span class="op" id="1506314">.</span><span class="ident" id="1506315">Addr</span><span class="op" id="1506319">[</span><span class="num" id="1506320">0</span><span class="op" id="1506321">:</span><span class="op" id="1506322">]</span><span class="op" id="1506323">,</span>&nbsp;<span class="ident" id="1506325">Port</span><span class="op" id="1506329">:</span>&nbsp;<span class="ident" id="1506331"><a href="/net/tcpsock_posix.go.html#1506242">sa</a></span><span class="op" id="1506333">.</span><span class="ident" id="1506334">Port</span><span class="op" id="1506338">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1506341">case</span>&nbsp;<span class="op" id="1506346">*</span><span class="ident" id="1506347"><a href="/net/tcpsock_posix.go.html#1505863">syscall</a></span><span class="op" id="1506354">.</span><span class="ident" id="1506355">SockaddrInet6</span><span class="op" id="1506368">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1506372">return</span>&nbsp;<span class="op" id="1506379">&amp;</span><span class="ident" id="1506380"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="1506387">{</span><span class="ident" id="1506388">IP</span><span class="op" id="1506390">:</span>&nbsp;<span class="ident" id="1506392"><a href="/net/tcpsock_posix.go.html#1506242">sa</a></span><span class="op" id="1506394">.</span><span class="ident" id="1506395">Addr</span><span class="op" id="1506399">[</span><span class="num" id="1506400">0</span><span class="op" id="1506401">:</span><span class="op" id="1506402">]</span><span class="op" id="1506403">,</span>&nbsp;<span class="ident" id="1506405">Port</span><span class="op" id="1506409">:</span>&nbsp;<span class="ident" id="1506411"><a href="/net/tcpsock_posix.go.html#1506242">sa</a></span><span class="op" id="1506413">.</span><span class="ident" id="1506414">Port</span><span class="op" id="1506418">,</span>&nbsp;<span class="ident" id="1506420">Zone</span><span class="op" id="1506424">:</span>&nbsp;<span class="ident" id="1506426"><a href="/net/ipsock.go.html#1448067">zoneToString</a></span><span class="op" id="1506438">(</span><span class="builtintype" id="1506439">int</span><span class="op" id="1506442">(</span><span class="ident" id="1506443"><a href="/net/tcpsock_posix.go.html#1506242">sa</a></span><span class="op" id="1506445">.</span><span class="ident" id="1506446">ZoneId</span><span class="op" id="1506452">)</span><span class="op" id="1506453">)</span><span class="op" id="1506454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1506457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1506460">return</span>&nbsp;<span class="ident" id="1506467">nil</span><br>
<span class="lineno"></span><span class="op" id="1506471">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="1506474">func</span>&nbsp;<span class="op" id="1506479">(</span><span class="ident" id="1506480">a</span>&nbsp;<span class="op" id="1506482">*</span><span class="ident" id="1506483"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="1506490">)</span>&nbsp;<span class="ident" id="1506492">family</span><span class="op" id="1506498">(</span><span class="op" id="1506499">)</span>&nbsp;<span class="builtintype" id="1506501">int</span>&nbsp;<span class="op" id="1506505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1506508">if</span>&nbsp;<span class="ident" id="1506511"><a href="/net/tcpsock_posix.go.html#1506480">a</a></span>&nbsp;<span class="op" id="1506513">==</span>&nbsp;<span class="ident" id="1506516">nil</span>&nbsp;<span class="op" id="1506520">||</span>&nbsp;<span class="builtinfunc" id="1506523">len</span><span class="op" id="1506526">(</span><span class="ident" id="1506527"><a href="/net/tcpsock_posix.go.html#1506480">a</a></span><span class="op" id="1506528">.</span><span class="ident" id="1506529">IP</span><span class="op" id="1506531">)</span>&nbsp;<span class="op" id="1506533">&lt;=</span>&nbsp;<span class="ident" id="1506536"><a href="/net/ip.go.html#1416769">IPv4len</a></span>&nbsp;<span class="op" id="1506544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1506548">return</span>&nbsp;<span class="ident" id="1506555"><a href="/net/tcpsock_posix.go.html#1505863">syscall</a></span><span class="op" id="1506562">.</span><span class="ident" id="1506563">AF_INET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1506572">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1506575">if</span>&nbsp;<span class="ident" id="1506578"><a href="/net/tcpsock_posix.go.html#1506480">a</a></span><span class="op" id="1506579">.</span><span class="ident" id="1506580">IP</span><span class="op" id="1506582">.</span><span class="ident" id="1506583">To4</span><span class="op" id="1506586">(</span><span class="op" id="1506587">)</span>&nbsp;<span class="op" id="1506589">!=</span>&nbsp;<span class="ident" id="1506592">nil</span>&nbsp;<span class="op" id="1506596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1506600">return</span>&nbsp;<span class="ident" id="1506607"><a href="/net/tcpsock_posix.go.html#1505863">syscall</a></span><span class="op" id="1506614">.</span><span class="ident" id="1506615">AF_INET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1506624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1506627">return</span>&nbsp;<span class="ident" id="1506634"><a href="/net/tcpsock_posix.go.html#1505863">syscall</a></span><span class="op" id="1506641">.</span><span class="ident" id="1506642">AF_INET6</span><br>
<span class="lineno"></span><span class="op" id="1506651">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="1506654">func</span>&nbsp;<span class="op" id="1506659">(</span><span class="ident" id="1506660">a</span>&nbsp;<span class="op" id="1506662">*</span><span class="ident" id="1506663"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="1506670">)</span>&nbsp;<span class="ident" id="1506672">isWildcard</span><span class="op" id="1506682">(</span><span class="op" id="1506683">)</span>&nbsp;<span class="builtintype" id="1506685">bool</span>&nbsp;<span class="op" id="1506690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1506693">if</span>&nbsp;<span class="ident" id="1506696"><a href="/net/tcpsock_posix.go.html#1506660">a</a></span>&nbsp;<span class="op" id="1506698">==</span>&nbsp;<span class="ident" id="1506701">nil</span>&nbsp;<span class="op" id="1506705">||</span>&nbsp;<span class="ident" id="1506708"><a href="/net/tcpsock_posix.go.html#1506660">a</a></span><span class="op" id="1506709">.</span><span class="ident" id="1506710">IP</span>&nbsp;<span class="op" id="1506713">==</span>&nbsp;<span class="ident" id="1506716">nil</span>&nbsp;<span class="op" id="1506720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1506724">return</span>&nbsp;<span class="builtintype" id="1506731">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1506737">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1506740">return</span>&nbsp;<span class="ident" id="1506747"><a href="/net/tcpsock_posix.go.html#1506660">a</a></span><span class="op" id="1506748">.</span><span class="ident" id="1506749">IP</span><span class="op" id="1506751">.</span><span class="ident" id="1506752">IsUnspecified</span><span class="op" id="1506765">(</span><span class="op" id="1506766">)</span><br>
<span class="lineno"></span><span class="op" id="1506768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1506771">func</span>&nbsp;<span class="op" id="1506776">(</span><span class="ident" id="1506777">a</span>&nbsp;<span class="op" id="1506779">*</span><span class="ident" id="1506780"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="1506787">)</span>&nbsp;<span class="ident" id="1506789">sockaddr</span><span class="op" id="1506797">(</span><span class="ident" id="1506798">family</span>&nbsp;<span class="builtintype" id="1506805">int</span><span class="op" id="1506808">)</span>&nbsp;<span class="op" id="1506810">(</span><span class="ident" id="1506811"><a href="/net/tcpsock_posix.go.html#1505863">syscall</a></span><span class="op" id="1506818">.</span><span class="ident" id="1506819">Sockaddr</span><span class="op" id="1506827">,</span>&nbsp;<span class="builtintype" id="1506829">error</span><span class="op" id="1506834">)</span>&nbsp;<span class="op" id="1506836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1506839">if</span>&nbsp;<span class="ident" id="1506842"><a href="/net/tcpsock_posix.go.html#1506777">a</a></span>&nbsp;<span class="op" id="1506844">==</span>&nbsp;<span class="ident" id="1506847">nil</span>&nbsp;<span class="op" id="1506851">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1506855">return</span>&nbsp;<span class="ident" id="1506862">nil</span><span class="op" id="1506865">,</span>&nbsp;<span class="ident" id="1506867">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1506872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1506875">return</span>&nbsp;<span class="ident" id="1506882"><a href="/net/ipsock_posix.go.html#1453030">ipToSockaddr</a></span><span class="op" id="1506894">(</span><span class="ident" id="1506895"><a href="/net/tcpsock_posix.go.html#1506798">family</a></span><span class="op" id="1506901">,</span>&nbsp;<span class="ident" id="1506903"><a href="/net/tcpsock_posix.go.html#1506777">a</a></span><span class="op" id="1506904">.</span><span class="ident" id="1506905">IP</span><span class="op" id="1506907">,</span>&nbsp;<span class="ident" id="1506909"><a href="/net/tcpsock_posix.go.html#1506777">a</a></span><span class="op" id="1506910">.</span><span class="ident" id="1506911">Port</span><span class="op" id="1506915">,</span>&nbsp;<span class="ident" id="1506917"><a href="/net/tcpsock_posix.go.html#1506777">a</a></span><span class="op" id="1506918">.</span><span class="ident" id="1506919">Zone</span><span class="op" id="1506923">)</span><br>
<span class="lineno"></span><span class="op" id="1506925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="1506928">//&nbsp;TCPConn&nbsp;is&nbsp;an&nbsp;implementation&nbsp;of&nbsp;the&nbsp;Conn&nbsp;interface&nbsp;for&nbsp;TCP&nbsp;network</span><br>
<span class="lineno"></span><span class="comment" id="1506998">//&nbsp;connections.</span><br>
<span class="lineno"></span><span class="keyword" id="1507014">type</span>&nbsp;<span class="ident" id="1507019">TCPConn</span>&nbsp;<span class="keyword" id="1507027">struct</span>&nbsp;<span class="op" id="1507034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1507037"><a href="/net/net.go.html#1467102">conn</a></span><br>
<span class="lineno"></span><span class="op" id="1507042">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="1507045">func</span>&nbsp;<span class="ident" id="1507050">newTCPConn</span><span class="op" id="1507060">(</span><span class="ident" id="1507061">fd</span>&nbsp;<span class="op" id="1507064">*</span><span class="ident" id="1507065"><a href="/net/fd_unix.go.html#1388279">netFD</a></span><span class="op" id="1507070">)</span>&nbsp;<span class="op" id="1507072">*</span><span class="ident" id="1507073"><a href="/net/tcpsock_posix.go.html#1507019">TCPConn</a></span>&nbsp;<span class="op" id="1507081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1507084">c</span>&nbsp;<span class="op" id="1507086">:=</span>&nbsp;<span class="op" id="1507089">&amp;</span><span class="ident" id="1507090"><a href="/net/tcpsock_posix.go.html#1507019">TCPConn</a></span><span class="op" id="1507097">{</span><span class="ident" id="1507098"><a href="/net/net.go.html#1467102">conn</a></span><span class="op" id="1507102">{</span><span class="ident" id="1507103"><a href="/net/tcpsock_posix.go.html#1507061">fd</a></span><span class="op" id="1507105">}</span><span class="op" id="1507106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1507109"><a href="/net/tcpsock_posix.go.html#1507084">c</a></span><span class="op" id="1507110">.</span><span class="ident" id="1507111">SetNoDelay</span><span class="op" id="1507121">(</span><span class="builtintype" id="1507122">true</span><span class="op" id="1507126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1507129">return</span>&nbsp;<span class="ident" id="1507136"><a href="/net/tcpsock_posix.go.html#1507084">c</a></span><br>
<span class="lineno">65</span><span class="op" id="1507138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1507141">//&nbsp;ReadFrom&nbsp;implements&nbsp;the&nbsp;io.ReaderFrom&nbsp;ReadFrom&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="1507199">func</span>&nbsp;<span class="op" id="1507204">(</span><span class="ident" id="1507205">c</span>&nbsp;<span class="op" id="1507207">*</span><span class="ident" id="1507208"><a href="/net/tcpsock_posix.go.html#1507019">TCPConn</a></span><span class="op" id="1507215">)</span>&nbsp;<span class="ident" id="1507217">ReadFrom</span><span class="op" id="1507225">(</span><span class="ident" id="1507226">r</span>&nbsp;<span class="ident" id="1507228"><a href="/net/tcpsock_posix.go.html#1505851">io</a></span><span class="op" id="1507230">.</span><span class="ident" id="1507231">Reader</span><span class="op" id="1507237">)</span>&nbsp;<span class="op" id="1507239">(</span><span class="ident" id="1507240">int64</span><span class="op" id="1507245">,</span>&nbsp;<span class="builtintype" id="1507247">error</span><span class="op" id="1507252">)</span>&nbsp;<span class="op" id="1507254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1507257">if</span>&nbsp;<span class="ident" id="1507260">n</span><span class="op" id="1507261">,</span>&nbsp;<span class="ident" id="1507263">err</span><span class="op" id="1507266">,</span>&nbsp;<span class="ident" id="1507268">handled</span>&nbsp;<span class="op" id="1507276">:=</span>&nbsp;<span class="ident" id="1507279"><a href="/net/sendfile_linux.go.html#1484442">sendFile</a></span><span class="op" id="1507287">(</span><span class="ident" id="1507288"><a href="/net/tcpsock_posix.go.html#1507205">c</a></span><span class="op" id="1507289">.</span><span class="ident" id="1507290">fd</span><span class="op" id="1507292">,</span>&nbsp;<span class="ident" id="1507294"><a href="/net/tcpsock_posix.go.html#1507226">r</a></span><span class="op" id="1507295">)</span><span class="op" id="1507296">;</span>&nbsp;<span class="ident" id="1507298"><a href="/net/tcpsock_posix.go.html#1507268">handled</a></span>&nbsp;<span class="op" id="1507306">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1507310">return</span>&nbsp;<span class="ident" id="1507317"><a href="/net/tcpsock_posix.go.html#1507260">n</a></span><span class="op" id="1507318">,</span>&nbsp;<span class="ident" id="1507320"><a href="/net/tcpsock_posix.go.html#1507263">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1507325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1507328">return</span>&nbsp;<span class="ident" id="1507335"><a href="/net/net.go.html#1474799">genericReadFrom</a></span><span class="op" id="1507350">(</span><span class="ident" id="1507351"><a href="/net/tcpsock_posix.go.html#1507205">c</a></span><span class="op" id="1507352">,</span>&nbsp;<span class="ident" id="1507354"><a href="/net/tcpsock_posix.go.html#1507226">r</a></span><span class="op" id="1507355">)</span><br>
<span class="lineno"></span><span class="op" id="1507357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="1507360">//&nbsp;CloseRead&nbsp;shuts&nbsp;down&nbsp;the&nbsp;reading&nbsp;side&nbsp;of&nbsp;the&nbsp;TCP&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="1507424">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;just&nbsp;use&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="1507463">func</span>&nbsp;<span class="op" id="1507468">(</span><span class="ident" id="1507469">c</span>&nbsp;<span class="op" id="1507471">*</span><span class="ident" id="1507472"><a href="/net/tcpsock_posix.go.html#1507019">TCPConn</a></span><span class="op" id="1507479">)</span>&nbsp;<span class="ident" id="1507481">CloseRead</span><span class="op" id="1507490">(</span><span class="op" id="1507491">)</span>&nbsp;<span class="builtintype" id="1507493">error</span>&nbsp;<span class="op" id="1507499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1507502">if</span>&nbsp;<span class="op" id="1507505">!</span><span class="ident" id="1507506"><a href="/net/tcpsock_posix.go.html#1507469">c</a></span><span class="op" id="1507507">.</span><span class="ident" id="1507508">ok</span><span class="op" id="1507510">(</span><span class="op" id="1507511">)</span>&nbsp;<span class="op" id="1507513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1507517">return</span>&nbsp;<span class="ident" id="1507524"><a href="/net/tcpsock_posix.go.html#1505863">syscall</a></span><span class="op" id="1507531">.</span><span class="ident" id="1507532">EINVAL</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1507540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1507543">return</span>&nbsp;<span class="ident" id="1507550"><a href="/net/tcpsock_posix.go.html#1507469">c</a></span><span class="op" id="1507551">.</span><span class="ident" id="1507552">fd</span><span class="op" id="1507554">.</span><span class="ident" id="1507555">closeRead</span><span class="op" id="1507564">(</span><span class="op" id="1507565">)</span><br>
<span class="lineno"></span><span class="op" id="1507567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1507570">//&nbsp;CloseWrite&nbsp;shuts&nbsp;down&nbsp;the&nbsp;writing&nbsp;side&nbsp;of&nbsp;the&nbsp;TCP&nbsp;connection.</span><br>
<span class="lineno">85</span><span class="comment" id="1507635">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;just&nbsp;use&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="1507674">func</span>&nbsp;<span class="op" id="1507679">(</span><span class="ident" id="1507680">c</span>&nbsp;<span class="op" id="1507682">*</span><span class="ident" id="1507683"><a href="/net/tcpsock_posix.go.html#1507019">TCPConn</a></span><span class="op" id="1507690">)</span>&nbsp;<span class="ident" id="1507692">CloseWrite</span><span class="op" id="1507702">(</span><span class="op" id="1507703">)</span>&nbsp;<span class="builtintype" id="1507705">error</span>&nbsp;<span class="op" id="1507711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1507714">if</span>&nbsp;<span class="op" id="1507717">!</span><span class="ident" id="1507718"><a href="/net/tcpsock_posix.go.html#1507680">c</a></span><span class="op" id="1507719">.</span><span class="ident" id="1507720">ok</span><span class="op" id="1507722">(</span><span class="op" id="1507723">)</span>&nbsp;<span class="op" id="1507725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1507729">return</span>&nbsp;<span class="ident" id="1507736"><a href="/net/tcpsock_posix.go.html#1505863">syscall</a></span><span class="op" id="1507743">.</span><span class="ident" id="1507744">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1507752">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1507755">return</span>&nbsp;<span class="ident" id="1507762"><a href="/net/tcpsock_posix.go.html#1507680">c</a></span><span class="op" id="1507763">.</span><span class="ident" id="1507764">fd</span><span class="op" id="1507766">.</span><span class="ident" id="1507767">closeWrite</span><span class="op" id="1507777">(</span><span class="op" id="1507778">)</span><br>
<span class="lineno"></span><span class="op" id="1507780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1507783">//&nbsp;SetLinger&nbsp;sets&nbsp;the&nbsp;behavior&nbsp;of&nbsp;Close&nbsp;on&nbsp;a&nbsp;connection&nbsp;which&nbsp;still</span><br>
<span class="lineno"></span><span class="comment" id="1507851">//&nbsp;has&nbsp;data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;sent&nbsp;or&nbsp;to&nbsp;be&nbsp;acknowledged.</span><br>
<span class="lineno">95</span><span class="comment" id="1507905">//</span><br>
<span class="lineno"></span><span class="comment" id="1507908">//&nbsp;If&nbsp;sec&nbsp;&lt;&nbsp;0&nbsp;(the&nbsp;default),&nbsp;the&nbsp;operating&nbsp;system&nbsp;finishes&nbsp;sending&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1507979">//&nbsp;data&nbsp;in&nbsp;the&nbsp;background.</span><br>
<span class="lineno"></span><span class="comment" id="1508006">//</span><br>
<span class="lineno"></span><span class="comment" id="1508009">//&nbsp;If&nbsp;sec&nbsp;==&nbsp;0,&nbsp;the&nbsp;operating&nbsp;system&nbsp;discards&nbsp;any&nbsp;unsent&nbsp;or</span><br>
<span class="lineno">100</span><span class="comment" id="1508069">//&nbsp;unacknowledged&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="1508093">//</span><br>
<span class="lineno"></span><span class="comment" id="1508096">//&nbsp;If&nbsp;sec&nbsp;&gt;&nbsp;0,&nbsp;the&nbsp;data&nbsp;is&nbsp;sent&nbsp;in&nbsp;the&nbsp;background&nbsp;as&nbsp;with&nbsp;sec&nbsp;&lt;&nbsp;0.&nbsp;On</span><br>
<span class="lineno"></span><span class="comment" id="1508166">//&nbsp;some&nbsp;operating&nbsp;systems&nbsp;after&nbsp;sec&nbsp;seconds&nbsp;have&nbsp;elapsed&nbsp;any&nbsp;remaining</span><br>
<span class="lineno"></span><span class="comment" id="1508237">//&nbsp;unsent&nbsp;data&nbsp;may&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno">105</span><span class="keyword" id="1508270">func</span>&nbsp;<span class="op" id="1508275">(</span><span class="ident" id="1508276">c</span>&nbsp;<span class="op" id="1508278">*</span><span class="ident" id="1508279"><a href="/net/tcpsock_posix.go.html#1507019">TCPConn</a></span><span class="op" id="1508286">)</span>&nbsp;<span class="ident" id="1508288">SetLinger</span><span class="op" id="1508297">(</span><span class="ident" id="1508298">sec</span>&nbsp;<span class="builtintype" id="1508302">int</span><span class="op" id="1508305">)</span>&nbsp;<span class="builtintype" id="1508307">error</span>&nbsp;<span class="op" id="1508313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1508316">if</span>&nbsp;<span class="op" id="1508319">!</span><span class="ident" id="1508320"><a href="/net/tcpsock_posix.go.html#1508276">c</a></span><span class="op" id="1508321">.</span><span class="ident" id="1508322">ok</span><span class="op" id="1508324">(</span><span class="op" id="1508325">)</span>&nbsp;<span class="op" id="1508327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1508331">return</span>&nbsp;<span class="ident" id="1508338"><a href="/net/tcpsock_posix.go.html#1505863">syscall</a></span><span class="op" id="1508345">.</span><span class="ident" id="1508346">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1508354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1508357">return</span>&nbsp;<span class="ident" id="1508364"><a href="/net/sockopt_posix.go.html#1501324">setLinger</a></span><span class="op" id="1508373">(</span><span class="ident" id="1508374"><a href="/net/tcpsock_posix.go.html#1508276">c</a></span><span class="op" id="1508375">.</span><span class="ident" id="1508376">fd</span><span class="op" id="1508378">,</span>&nbsp;<span class="ident" id="1508380"><a href="/net/tcpsock_posix.go.html#1508298">sec</a></span><span class="op" id="1508383">)</span><br>
<span class="lineno">110</span><span class="op" id="1508385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1508388">//&nbsp;SetKeepAlive&nbsp;sets&nbsp;whether&nbsp;the&nbsp;operating&nbsp;system&nbsp;should&nbsp;send</span><br>
<span class="lineno"></span><span class="comment" id="1508450">//&nbsp;keepalive&nbsp;messages&nbsp;on&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="1508491">func</span>&nbsp;<span class="op" id="1508496">(</span><span class="ident" id="1508497">c</span>&nbsp;<span class="op" id="1508499">*</span><span class="ident" id="1508500"><a href="/net/tcpsock_posix.go.html#1507019">TCPConn</a></span><span class="op" id="1508507">)</span>&nbsp;<span class="ident" id="1508509">SetKeepAlive</span><span class="op" id="1508521">(</span><span class="ident" id="1508522">keepalive</span>&nbsp;<span class="builtintype" id="1508532">bool</span><span class="op" id="1508536">)</span>&nbsp;<span class="builtintype" id="1508538">error</span>&nbsp;<span class="op" id="1508544">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1508547">if</span>&nbsp;<span class="op" id="1508550">!</span><span class="ident" id="1508551"><a href="/net/tcpsock_posix.go.html#1508497">c</a></span><span class="op" id="1508552">.</span><span class="ident" id="1508553">ok</span><span class="op" id="1508555">(</span><span class="op" id="1508556">)</span>&nbsp;<span class="op" id="1508558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1508562">return</span>&nbsp;<span class="ident" id="1508569"><a href="/net/tcpsock_posix.go.html#1505863">syscall</a></span><span class="op" id="1508576">.</span><span class="ident" id="1508577">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1508585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1508588">return</span>&nbsp;<span class="ident" id="1508595"><a href="/net/sockopt_posix.go.html#1501060">setKeepAlive</a></span><span class="op" id="1508607">(</span><span class="ident" id="1508608"><a href="/net/tcpsock_posix.go.html#1508497">c</a></span><span class="op" id="1508609">.</span><span class="ident" id="1508610">fd</span><span class="op" id="1508612">,</span>&nbsp;<span class="ident" id="1508614"><a href="/net/tcpsock_posix.go.html#1508522">keepalive</a></span><span class="op" id="1508623">)</span><br>
<span class="lineno"></span><span class="op" id="1508625">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="1508628">//&nbsp;SetKeepAlivePeriod&nbsp;sets&nbsp;period&nbsp;between&nbsp;keep&nbsp;alives.</span><br>
<span class="lineno"></span><span class="keyword" id="1508683">func</span>&nbsp;<span class="op" id="1508688">(</span><span class="ident" id="1508689">c</span>&nbsp;<span class="op" id="1508691">*</span><span class="ident" id="1508692"><a href="/net/tcpsock_posix.go.html#1507019">TCPConn</a></span><span class="op" id="1508699">)</span>&nbsp;<span class="ident" id="1508701">SetKeepAlivePeriod</span><span class="op" id="1508719">(</span><span class="ident" id="1508720">d</span>&nbsp;<span class="ident" id="1508722"><a href="/net/tcpsock_posix.go.html#1505874">time</a></span><span class="op" id="1508726">.</span><span class="ident" id="1508727">Duration</span><span class="op" id="1508735">)</span>&nbsp;<span class="builtintype" id="1508737">error</span>&nbsp;<span class="op" id="1508743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1508746">if</span>&nbsp;<span class="op" id="1508749">!</span><span class="ident" id="1508750"><a href="/net/tcpsock_posix.go.html#1508689">c</a></span><span class="op" id="1508751">.</span><span class="ident" id="1508752">ok</span><span class="op" id="1508754">(</span><span class="op" id="1508755">)</span>&nbsp;<span class="op" id="1508757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1508761">return</span>&nbsp;<span class="ident" id="1508768"><a href="/net/tcpsock_posix.go.html#1505863">syscall</a></span><span class="op" id="1508775">.</span><span class="ident" id="1508776">EINVAL</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1508784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1508787">return</span>&nbsp;<span class="ident" id="1508794"><a href="/net/tcpsockopt_unix.go.html#1515989">setKeepAlivePeriod</a></span><span class="op" id="1508812">(</span><span class="ident" id="1508813"><a href="/net/tcpsock_posix.go.html#1508689">c</a></span><span class="op" id="1508814">.</span><span class="ident" id="1508815">fd</span><span class="op" id="1508817">,</span>&nbsp;<span class="ident" id="1508819"><a href="/net/tcpsock_posix.go.html#1508720">d</a></span><span class="op" id="1508820">)</span><br>
<span class="lineno"></span><span class="op" id="1508822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1508825">//&nbsp;SetNoDelay&nbsp;controls&nbsp;whether&nbsp;the&nbsp;operating&nbsp;system&nbsp;should&nbsp;delay</span><br>
<span class="lineno">130</span><span class="comment" id="1508890">//&nbsp;packet&nbsp;transmission&nbsp;in&nbsp;hopes&nbsp;of&nbsp;sending&nbsp;fewer&nbsp;packets&nbsp;(Nagle&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="1508956">//&nbsp;algorithm).&nbsp;&nbsp;The&nbsp;default&nbsp;is&nbsp;true&nbsp;(no&nbsp;delay),&nbsp;meaning&nbsp;that&nbsp;data&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1509025">//&nbsp;sent&nbsp;as&nbsp;soon&nbsp;as&nbsp;possible&nbsp;after&nbsp;a&nbsp;Write.</span><br>
<span class="lineno"></span><span class="keyword" id="1509068">func</span>&nbsp;<span class="op" id="1509073">(</span><span class="ident" id="1509074">c</span>&nbsp;<span class="op" id="1509076">*</span><span class="ident" id="1509077"><a href="/net/tcpsock_posix.go.html#1507019">TCPConn</a></span><span class="op" id="1509084">)</span>&nbsp;<span class="ident" id="1509086">SetNoDelay</span><span class="op" id="1509096">(</span><span class="ident" id="1509097">noDelay</span>&nbsp;<span class="builtintype" id="1509105">bool</span><span class="op" id="1509109">)</span>&nbsp;<span class="builtintype" id="1509111">error</span>&nbsp;<span class="op" id="1509117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1509120">if</span>&nbsp;<span class="op" id="1509123">!</span><span class="ident" id="1509124"><a href="/net/tcpsock_posix.go.html#1509074">c</a></span><span class="op" id="1509125">.</span><span class="ident" id="1509126">ok</span><span class="op" id="1509128">(</span><span class="op" id="1509129">)</span>&nbsp;<span class="op" id="1509131">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1509135">return</span>&nbsp;<span class="ident" id="1509142"><a href="/net/tcpsock_posix.go.html#1505863">syscall</a></span><span class="op" id="1509149">.</span><span class="ident" id="1509150">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1509158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1509161">return</span>&nbsp;<span class="ident" id="1509168"><a href="/net/tcpsockopt_posix.go.html#1515480">setNoDelay</a></span><span class="op" id="1509178">(</span><span class="ident" id="1509179"><a href="/net/tcpsock_posix.go.html#1509074">c</a></span><span class="op" id="1509180">.</span><span class="ident" id="1509181">fd</span><span class="op" id="1509183">,</span>&nbsp;<span class="ident" id="1509185"><a href="/net/tcpsock_posix.go.html#1509097">noDelay</a></span><span class="op" id="1509192">)</span><br>
<span class="lineno"></span><span class="op" id="1509194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="1509197">//&nbsp;DialTCP&nbsp;connects&nbsp;to&nbsp;the&nbsp;remote&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;network&nbsp;net,</span><br>
<span class="lineno"></span><span class="comment" id="1509265">//&nbsp;which&nbsp;must&nbsp;be&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;,&nbsp;or&nbsp;&#34;tcp6&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;is&nbsp;not&nbsp;nil,&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1509336">//&nbsp;used&nbsp;as&nbsp;the&nbsp;local&nbsp;address&nbsp;for&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="1509385">func</span>&nbsp;<span class="ident" id="1509390">DialTCP</span><span class="op" id="1509397">(</span><span class="ident" id="1509398">net</span>&nbsp;<span class="builtintype" id="1509402">string</span><span class="op" id="1509408">,</span>&nbsp;<span class="ident" id="1509410">laddr</span><span class="op" id="1509415">,</span>&nbsp;<span class="ident" id="1509417">raddr</span>&nbsp;<span class="op" id="1509423">*</span><span class="ident" id="1509424"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="1509431">)</span>&nbsp;<span class="op" id="1509433">(</span><span class="op" id="1509434">*</span><span class="ident" id="1509435"><a href="/net/tcpsock_posix.go.html#1507019">TCPConn</a></span><span class="op" id="1509442">,</span>&nbsp;<span class="builtintype" id="1509444">error</span><span class="op" id="1509449">)</span>&nbsp;<span class="op" id="1509451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1509454">switch</span>&nbsp;<span class="ident" id="1509461"><a href="/net/tcpsock_posix.go.html#1509398">net</a></span>&nbsp;<span class="op" id="1509465">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1509468">case</span>&nbsp;<span class="string" id="1509473">&#34;tcp&#34;</span><span class="op" id="1509478">,</span>&nbsp;<span class="string" id="1509480">&#34;tcp4&#34;</span><span class="op" id="1509486">,</span>&nbsp;<span class="string" id="1509488">&#34;tcp6&#34;</span><span class="op" id="1509494">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1509497">default</span><span class="op" id="1509504">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1509508">return</span>&nbsp;<span class="ident" id="1509515">nil</span><span class="op" id="1509518">,</span>&nbsp;<span class="op" id="1509520">&amp;</span><span class="ident" id="1509521"><a href="/net/net.go.html#1472480">OpError</a></span><span class="op" id="1509528">{</span><span class="ident" id="1509529">Op</span><span class="op" id="1509531">:</span>&nbsp;<span class="string" id="1509533">&#34;dial&#34;</span><span class="op" id="1509539">,</span>&nbsp;<span class="ident" id="1509541">Net</span><span class="op" id="1509544">:</span>&nbsp;<span class="ident" id="1509546"><a href="/net/tcpsock_posix.go.html#1509398">net</a></span><span class="op" id="1509549">,</span>&nbsp;<span class="ident" id="1509551">Addr</span><span class="op" id="1509555">:</span>&nbsp;<span class="ident" id="1509557"><a href="/net/tcpsock_posix.go.html#1509417">raddr</a></span><span class="op" id="1509562">,</span>&nbsp;<span class="ident" id="1509564">Err</span><span class="op" id="1509567">:</span>&nbsp;<span class="ident" id="1509569"><a href="/net/net.go.html#1473867">UnknownNetworkError</a></span><span class="op" id="1509588">(</span><span class="ident" id="1509589"><a href="/net/tcpsock_posix.go.html#1509398">net</a></span><span class="op" id="1509592">)</span><span class="op" id="1509593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1509596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1509599">if</span>&nbsp;<span class="ident" id="1509602"><a href="/net/tcpsock_posix.go.html#1509417">raddr</a></span>&nbsp;<span class="op" id="1509608">==</span>&nbsp;<span class="ident" id="1509611">nil</span>&nbsp;<span class="op" id="1509615">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1509619">return</span>&nbsp;<span class="ident" id="1509626">nil</span><span class="op" id="1509629">,</span>&nbsp;<span class="op" id="1509631">&amp;</span><span class="ident" id="1509632"><a href="/net/net.go.html#1472480">OpError</a></span><span class="op" id="1509639">{</span><span class="ident" id="1509640">Op</span><span class="op" id="1509642">:</span>&nbsp;<span class="string" id="1509644">&#34;dial&#34;</span><span class="op" id="1509650">,</span>&nbsp;<span class="ident" id="1509652">Net</span><span class="op" id="1509655">:</span>&nbsp;<span class="ident" id="1509657"><a href="/net/tcpsock_posix.go.html#1509398">net</a></span><span class="op" id="1509660">,</span>&nbsp;<span class="ident" id="1509662">Addr</span><span class="op" id="1509666">:</span>&nbsp;<span class="ident" id="1509668">nil</span><span class="op" id="1509671">,</span>&nbsp;<span class="ident" id="1509673">Err</span><span class="op" id="1509676">:</span>&nbsp;<span class="ident" id="1509678"><a href="/net/net.go.html#1472020">errMissingAddress</a></span><span class="op" id="1509695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1509698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1509701">return</span>&nbsp;<span class="ident" id="1509708"><a href="/net/tcpsock_posix.go.html#1509755">dialTCP</a></span><span class="op" id="1509715">(</span><span class="ident" id="1509716"><a href="/net/tcpsock_posix.go.html#1509398">net</a></span><span class="op" id="1509719">,</span>&nbsp;<span class="ident" id="1509721"><a href="/net/tcpsock_posix.go.html#1509410">laddr</a></span><span class="op" id="1509726">,</span>&nbsp;<span class="ident" id="1509728"><a href="/net/tcpsock_posix.go.html#1509417">raddr</a></span><span class="op" id="1509733">,</span>&nbsp;<span class="ident" id="1509735"><a href="/net/net.go.html#1473194">noDeadline</a></span><span class="op" id="1509745">)</span><br>
<span class="lineno"></span><span class="op" id="1509747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="1509750">func</span>&nbsp;<span class="ident" id="1509755">dialTCP</span><span class="op" id="1509762">(</span><span class="ident" id="1509763">net</span>&nbsp;<span class="builtintype" id="1509767">string</span><span class="op" id="1509773">,</span>&nbsp;<span class="ident" id="1509775">laddr</span><span class="op" id="1509780">,</span>&nbsp;<span class="ident" id="1509782">raddr</span>&nbsp;<span class="op" id="1509788">*</span><span class="ident" id="1509789"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="1509796">,</span>&nbsp;<span class="ident" id="1509798">deadline</span>&nbsp;<span class="ident" id="1509807"><a href="/net/tcpsock_posix.go.html#1505874">time</a></span><span class="op" id="1509811">.</span><span class="ident" id="1509812">Time</span><span class="op" id="1509816">)</span>&nbsp;<span class="op" id="1509818">(</span><span class="op" id="1509819">*</span><span class="ident" id="1509820"><a href="/net/tcpsock_posix.go.html#1507019">TCPConn</a></span><span class="op" id="1509827">,</span>&nbsp;<span class="builtintype" id="1509829">error</span><span class="op" id="1509834">)</span>&nbsp;<span class="op" id="1509836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1509839">fd</span><span class="op" id="1509841">,</span>&nbsp;<span class="ident" id="1509843">err</span>&nbsp;<span class="op" id="1509847">:=</span>&nbsp;<span class="ident" id="1509850"><a href="/net/ipsock_posix.go.html#1452753">internetSocket</a></span><span class="op" id="1509864">(</span><span class="ident" id="1509865"><a href="/net/tcpsock_posix.go.html#1509763">net</a></span><span class="op" id="1509868">,</span>&nbsp;<span class="ident" id="1509870"><a href="/net/tcpsock_posix.go.html#1509775">laddr</a></span><span class="op" id="1509875">,</span>&nbsp;<span class="ident" id="1509877"><a href="/net/tcpsock_posix.go.html#1509782">raddr</a></span><span class="op" id="1509882">,</span>&nbsp;<span class="ident" id="1509884"><a href="/net/tcpsock_posix.go.html#1509798">deadline</a></span><span class="op" id="1509892">,</span>&nbsp;<span class="ident" id="1509894"><a href="/net/tcpsock_posix.go.html#1505863">syscall</a></span><span class="op" id="1509901">.</span><span class="ident" id="1509902">SOCK_STREAM</span><span class="op" id="1509913">,</span>&nbsp;<span class="num" id="1509915">0</span><span class="op" id="1509916">,</span>&nbsp;<span class="string" id="1509918">&#34;dial&#34;</span><span class="op" id="1509924">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1509928">//&nbsp;TCP&nbsp;has&nbsp;a&nbsp;rarely&nbsp;used&nbsp;mechanism&nbsp;called&nbsp;a&nbsp;&#39;simultaneous&nbsp;connection&#39;&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1510002">//&nbsp;which&nbsp;Dial(&#34;tcp&#34;,&nbsp;addr1,&nbsp;addr2)&nbsp;run&nbsp;on&nbsp;the&nbsp;machine&nbsp;at&nbsp;addr1&nbsp;can</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1510070">//&nbsp;connect&nbsp;to&nbsp;a&nbsp;simultaneous&nbsp;Dial(&#34;tcp&#34;,&nbsp;addr2,&nbsp;addr1)&nbsp;run&nbsp;on&nbsp;the&nbsp;machine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1510145">//&nbsp;at&nbsp;addr2,&nbsp;without&nbsp;either&nbsp;machine&nbsp;executing&nbsp;Listen.&nbsp;&nbsp;If&nbsp;laddr&nbsp;==&nbsp;nil,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1510218">//&nbsp;it&nbsp;means&nbsp;we&nbsp;want&nbsp;the&nbsp;kernel&nbsp;to&nbsp;pick&nbsp;an&nbsp;appropriate&nbsp;originating&nbsp;local</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1510291">//&nbsp;address.&nbsp;&nbsp;Some&nbsp;Linux&nbsp;kernels&nbsp;cycle&nbsp;blindly&nbsp;through&nbsp;a&nbsp;fixed&nbsp;range&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1510363">//&nbsp;local&nbsp;ports,&nbsp;regardless&nbsp;of&nbsp;destination&nbsp;port.&nbsp;&nbsp;If&nbsp;a&nbsp;kernel&nbsp;happens&nbsp;to</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1510436">//&nbsp;pick&nbsp;local&nbsp;port&nbsp;50001&nbsp;as&nbsp;the&nbsp;source&nbsp;for&nbsp;a&nbsp;Dial(&#34;tcp&#34;,&nbsp;&#34;&#34;,&nbsp;&#34;localhost:50001&#34;),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1510518">//&nbsp;then&nbsp;the&nbsp;Dial&nbsp;will&nbsp;succeed,&nbsp;having&nbsp;simultaneously&nbsp;connected&nbsp;to&nbsp;itself.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1510593">//&nbsp;This&nbsp;can&nbsp;only&nbsp;happen&nbsp;when&nbsp;we&nbsp;are&nbsp;letting&nbsp;the&nbsp;kernel&nbsp;pick&nbsp;a&nbsp;port&nbsp;(laddr&nbsp;==&nbsp;nil)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1510676">//&nbsp;and&nbsp;when&nbsp;there&nbsp;is&nbsp;no&nbsp;listener&nbsp;for&nbsp;the&nbsp;destination&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1510739">//&nbsp;It&#39;s&nbsp;hard&nbsp;to&nbsp;argue&nbsp;this&nbsp;is&nbsp;anything&nbsp;other&nbsp;than&nbsp;a&nbsp;kernel&nbsp;bug.&nbsp;&nbsp;If&nbsp;we</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1510811">//&nbsp;see&nbsp;this&nbsp;happen,&nbsp;rather&nbsp;than&nbsp;expose&nbsp;the&nbsp;buggy&nbsp;effect&nbsp;to&nbsp;users,&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1510881">//&nbsp;close&nbsp;the&nbsp;fd&nbsp;and&nbsp;try&nbsp;again.&nbsp;&nbsp;If&nbsp;it&nbsp;happens&nbsp;twice&nbsp;more,&nbsp;we&nbsp;relent&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1510954">//&nbsp;use&nbsp;the&nbsp;result.&nbsp;&nbsp;See&nbsp;also:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1510985">//&nbsp;&nbsp;&nbsp;&nbsphttp://golang.org/issue/2690</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1511018">//&nbsp;&nbsp;&nbsp;&nbsphttp://stackoverflow.com/questions/4949858/</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1511066">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1511070">//&nbsp;The&nbsp;opposite&nbsp;can&nbsp;also&nbsp;happen:&nbsp;if&nbsp;we&nbsp;ask&nbsp;the&nbsp;kernel&nbsp;to&nbsp;pick&nbsp;an&nbsp;appropriate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1511148">//&nbsp;originating&nbsp;local&nbsp;address,&nbsp;sometimes&nbsp;it&nbsp;picks&nbsp;one&nbsp;that&nbsp;is&nbsp;already&nbsp;in&nbsp;use.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1511226">//&nbsp;So&nbsp;if&nbsp;the&nbsp;error&nbsp;is&nbsp;EADDRNOTAVAIL,&nbsp;we&nbsp;have&nbsp;to&nbsp;try&nbsp;again&nbsp;too,&nbsp;just&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1511299">//&nbsp;a&nbsp;different&nbsp;reason.</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1511323">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1511327">//&nbsp;The&nbsp;kernel&nbsp;socket&nbsp;code&nbsp;is&nbsp;no&nbsp;doubt&nbsp;enjoying&nbsp;watching&nbsp;us&nbsp;squirm.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1511395">for</span>&nbsp;<span class="ident" id="1511399">i</span>&nbsp;<span class="op" id="1511401">:=</span>&nbsp;<span class="num" id="1511404">0</span><span class="op" id="1511405">;</span>&nbsp;<span class="ident" id="1511407"><a href="/net/tcpsock_posix.go.html#1511399">i</a></span>&nbsp;<span class="op" id="1511409">&lt;</span>&nbsp;<span class="num" id="1511411">2</span>&nbsp;<span class="op" id="1511413">&amp;&amp;</span>&nbsp;<span class="op" id="1511416">(</span><span class="ident" id="1511417"><a href="/net/tcpsock_posix.go.html#1509775">laddr</a></span>&nbsp;<span class="op" id="1511423">==</span>&nbsp;<span class="ident" id="1511426">nil</span>&nbsp;<span class="op" id="1511430">||</span>&nbsp;<span class="ident" id="1511433"><a href="/net/tcpsock_posix.go.html#1509775">laddr</a></span><span class="op" id="1511438">.</span><span class="ident" id="1511439">Port</span>&nbsp;<span class="op" id="1511444">==</span>&nbsp;<span class="num" id="1511447">0</span><span class="op" id="1511448">)</span>&nbsp;<span class="op" id="1511450">&amp;&amp;</span>&nbsp;<span class="op" id="1511453">(</span><span class="ident" id="1511454"><a href="/net/tcpsock_posix.go.html#1511761">selfConnect</a></span><span class="op" id="1511465">(</span><span class="ident" id="1511466"><a href="/net/tcpsock_posix.go.html#1509839">fd</a></span><span class="op" id="1511468">,</span>&nbsp;<span class="ident" id="1511470"><a href="/net/tcpsock_posix.go.html#1509843">err</a></span><span class="op" id="1511473">)</span>&nbsp;<span class="op" id="1511475">||</span>&nbsp;<span class="ident" id="1511478"><a href="/net/tcpsock_posix.go.html#1512583">spuriousENOTAVAIL</a></span><span class="op" id="1511495">(</span><span class="ident" id="1511496"><a href="/net/tcpsock_posix.go.html#1509843">err</a></span><span class="op" id="1511499">)</span><span class="op" id="1511500">)</span><span class="op" id="1511501">;</span>&nbsp;<span class="ident" id="1511503"><a href="/net/tcpsock_posix.go.html#1511399">i</a></span><span class="op" id="1511504">++</span>&nbsp;<span class="op" id="1511507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1511511">if</span>&nbsp;<span class="ident" id="1511514"><a href="/net/tcpsock_posix.go.html#1509843">err</a></span>&nbsp;<span class="op" id="1511518">==</span>&nbsp;<span class="ident" id="1511521">nil</span>&nbsp;<span class="op" id="1511525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1511530"><a href="/net/tcpsock_posix.go.html#1509839">fd</a></span><span class="op" id="1511532">.</span><span class="ident" id="1511533">Close</span><span class="op" id="1511538">(</span><span class="op" id="1511539">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1511543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1511547"><a href="/net/tcpsock_posix.go.html#1509839">fd</a></span><span class="op" id="1511549">,</span>&nbsp;<span class="ident" id="1511551"><a href="/net/tcpsock_posix.go.html#1509843">err</a></span>&nbsp;<span class="op" id="1511555">=</span>&nbsp;<span class="ident" id="1511557"><a href="/net/ipsock_posix.go.html#1452753">internetSocket</a></span><span class="op" id="1511571">(</span><span class="ident" id="1511572"><a href="/net/tcpsock_posix.go.html#1509763">net</a></span><span class="op" id="1511575">,</span>&nbsp;<span class="ident" id="1511577"><a href="/net/tcpsock_posix.go.html#1509775">laddr</a></span><span class="op" id="1511582">,</span>&nbsp;<span class="ident" id="1511584"><a href="/net/tcpsock_posix.go.html#1509782">raddr</a></span><span class="op" id="1511589">,</span>&nbsp;<span class="ident" id="1511591"><a href="/net/tcpsock_posix.go.html#1509798">deadline</a></span><span class="op" id="1511599">,</span>&nbsp;<span class="ident" id="1511601"><a href="/net/tcpsock_posix.go.html#1505863">syscall</a></span><span class="op" id="1511608">.</span><span class="ident" id="1511609">SOCK_STREAM</span><span class="op" id="1511620">,</span>&nbsp;<span class="num" id="1511622">0</span><span class="op" id="1511623">,</span>&nbsp;<span class="string" id="1511625">&#34;dial&#34;</span><span class="op" id="1511631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1511634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1511638">if</span>&nbsp;<span class="ident" id="1511641"><a href="/net/tcpsock_posix.go.html#1509843">err</a></span>&nbsp;<span class="op" id="1511645">!=</span>&nbsp;<span class="ident" id="1511648">nil</span>&nbsp;<span class="op" id="1511652">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1511656">return</span>&nbsp;<span class="ident" id="1511663">nil</span><span class="op" id="1511666">,</span>&nbsp;<span class="op" id="1511668">&amp;</span><span class="ident" id="1511669"><a href="/net/net.go.html#1472480">OpError</a></span><span class="op" id="1511676">{</span><span class="ident" id="1511677">Op</span><span class="op" id="1511679">:</span>&nbsp;<span class="string" id="1511681">&#34;dial&#34;</span><span class="op" id="1511687">,</span>&nbsp;<span class="ident" id="1511689">Net</span><span class="op" id="1511692">:</span>&nbsp;<span class="ident" id="1511694"><a href="/net/tcpsock_posix.go.html#1509763">net</a></span><span class="op" id="1511697">,</span>&nbsp;<span class="ident" id="1511699">Addr</span><span class="op" id="1511703">:</span>&nbsp;<span class="ident" id="1511705"><a href="/net/tcpsock_posix.go.html#1509782">raddr</a></span><span class="op" id="1511710">,</span>&nbsp;<span class="ident" id="1511712">Err</span><span class="op" id="1511715">:</span>&nbsp;<span class="ident" id="1511717"><a href="/net/tcpsock_posix.go.html#1509843">err</a></span><span class="op" id="1511720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1511723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1511726">return</span>&nbsp;<span class="ident" id="1511733"><a href="/net/tcpsock_posix.go.html#1507050">newTCPConn</a></span><span class="op" id="1511743">(</span><span class="ident" id="1511744"><a href="/net/tcpsock_posix.go.html#1509839">fd</a></span><span class="op" id="1511746">)</span><span class="op" id="1511747">,</span>&nbsp;<span class="ident" id="1511749">nil</span><br>
<span class="lineno"></span><span class="op" id="1511753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="keyword" id="1511756">func</span>&nbsp;<span class="ident" id="1511761">selfConnect</span><span class="op" id="1511772">(</span><span class="ident" id="1511773">fd</span>&nbsp;<span class="op" id="1511776">*</span><span class="ident" id="1511777"><a href="/net/fd_unix.go.html#1388279">netFD</a></span><span class="op" id="1511782">,</span>&nbsp;<span class="ident" id="1511784">err</span>&nbsp;<span class="builtintype" id="1511788">error</span><span class="op" id="1511793">)</span>&nbsp;<span class="builtintype" id="1511795">bool</span>&nbsp;<span class="op" id="1511800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1511803">//&nbsp;If&nbsp;the&nbsp;connect&nbsp;failed,&nbsp;we&nbsp;clearly&nbsp;didn&#39;t&nbsp;connect&nbsp;to&nbsp;ourselves.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1511870">if</span>&nbsp;<span class="ident" id="1511873"><a href="/net/tcpsock_posix.go.html#1511784">err</a></span>&nbsp;<span class="op" id="1511877">!=</span>&nbsp;<span class="ident" id="1511880">nil</span>&nbsp;<span class="op" id="1511884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1511888">return</span>&nbsp;<span class="builtintype" id="1511895">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1511902">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1511906">//&nbsp;The&nbsp;socket&nbsp;constructor&nbsp;can&nbsp;return&nbsp;an&nbsp;fd&nbsp;with&nbsp;raddr&nbsp;nil&nbsp;under&nbsp;certain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1511979">//&nbsp;unknown&nbsp;conditions.&nbsp;The&nbsp;errors&nbsp;in&nbsp;the&nbsp;calls&nbsp;there&nbsp;to&nbsp;Getpeername</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1512048">//&nbsp;are&nbsp;discarded,&nbsp;but&nbsp;we&nbsp;can&#39;t&nbsp;catch&nbsp;the&nbsp;problem&nbsp;there&nbsp;because&nbsp;those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1512118">//&nbsp;calls&nbsp;are&nbsp;sometimes&nbsp;legally&nbsp;erroneous&nbsp;with&nbsp;a&nbsp;&#34;socket&nbsp;not&nbsp;connected&#34;.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1512191">//&nbsp;Since&nbsp;this&nbsp;code&nbsp;(selfConnect)&nbsp;is&nbsp;already&nbsp;trying&nbsp;to&nbsp;work&nbsp;around</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1512258">//&nbsp;a&nbsp;problem,&nbsp;we&nbsp;make&nbsp;sure&nbsp;if&nbsp;this&nbsp;happens&nbsp;we&nbsp;recognize&nbsp;trouble&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1512327">//&nbsp;ask&nbsp;the&nbsp;DialTCP&nbsp;routine&nbsp;to&nbsp;try&nbsp;again.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1512369">//&nbsp;TODO:&nbsp;try&nbsp;to&nbsp;understand&nbsp;what&#39;s&nbsp;really&nbsp;going&nbsp;on.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1512421">if</span>&nbsp;<span class="ident" id="1512424"><a href="/net/tcpsock_posix.go.html#1511773">fd</a></span><span class="op" id="1512426">.</span><span class="ident" id="1512427">laddr</span>&nbsp;<span class="op" id="1512433">==</span>&nbsp;<span class="ident" id="1512436">nil</span>&nbsp;<span class="op" id="1512440">||</span>&nbsp;<span class="ident" id="1512443"><a href="/net/tcpsock_posix.go.html#1511773">fd</a></span><span class="op" id="1512445">.</span><span class="ident" id="1512446">raddr</span>&nbsp;<span class="op" id="1512452">==</span>&nbsp;<span class="ident" id="1512455">nil</span>&nbsp;<span class="op" id="1512459">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1512463">return</span>&nbsp;<span class="builtintype" id="1512470">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1512476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1512479">l</span>&nbsp;<span class="op" id="1512481">:=</span>&nbsp;<span class="ident" id="1512484"><a href="/net/tcpsock_posix.go.html#1511773">fd</a></span><span class="op" id="1512486">.</span><span class="ident" id="1512487">laddr</span><span class="op" id="1512492">.</span><span class="op" id="1512493">(</span><span class="op" id="1512494">*</span><span class="ident" id="1512495"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="1512502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1512505">r</span>&nbsp;<span class="op" id="1512507">:=</span>&nbsp;<span class="ident" id="1512510"><a href="/net/tcpsock_posix.go.html#1511773">fd</a></span><span class="op" id="1512512">.</span><span class="ident" id="1512513">raddr</span><span class="op" id="1512518">.</span><span class="op" id="1512519">(</span><span class="op" id="1512520">*</span><span class="ident" id="1512521"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="1512528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1512531">return</span>&nbsp;<span class="ident" id="1512538"><a href="/net/tcpsock_posix.go.html#1512479">l</a></span><span class="op" id="1512539">.</span><span class="ident" id="1512540">Port</span>&nbsp;<span class="op" id="1512545">==</span>&nbsp;<span class="ident" id="1512548"><a href="/net/tcpsock_posix.go.html#1512505">r</a></span><span class="op" id="1512549">.</span><span class="ident" id="1512550">Port</span>&nbsp;<span class="op" id="1512555">&amp;&amp;</span>&nbsp;<span class="ident" id="1512558"><a href="/net/tcpsock_posix.go.html#1512479">l</a></span><span class="op" id="1512559">.</span><span class="ident" id="1512560">IP</span><span class="op" id="1512562">.</span><span class="ident" id="1512563">Equal</span><span class="op" id="1512568">(</span><span class="ident" id="1512569"><a href="/net/tcpsock_posix.go.html#1512505">r</a></span><span class="op" id="1512570">.</span><span class="ident" id="1512571">IP</span><span class="op" id="1512573">)</span><br>
<span class="lineno">215</span><span class="op" id="1512575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1512578">func</span>&nbsp;<span class="ident" id="1512583">spuriousENOTAVAIL</span><span class="op" id="1512600">(</span><span class="ident" id="1512601">err</span>&nbsp;<span class="builtintype" id="1512605">error</span><span class="op" id="1512610">)</span>&nbsp;<span class="builtintype" id="1512612">bool</span>&nbsp;<span class="op" id="1512617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1512620">e</span><span class="op" id="1512621">,</span>&nbsp;<span class="ident" id="1512623">ok</span>&nbsp;<span class="op" id="1512626">:=</span>&nbsp;<span class="ident" id="1512629"><a href="/net/tcpsock_posix.go.html#1512601">err</a></span><span class="op" id="1512632">.</span><span class="op" id="1512633">(</span><span class="op" id="1512634">*</span><span class="ident" id="1512635"><a href="/net/net.go.html#1472480">OpError</a></span><span class="op" id="1512642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1512645">return</span>&nbsp;<span class="ident" id="1512652"><a href="/net/tcpsock_posix.go.html#1512623">ok</a></span>&nbsp;<span class="op" id="1512655">&amp;&amp;</span>&nbsp;<span class="ident" id="1512658"><a href="/net/tcpsock_posix.go.html#1512620">e</a></span><span class="op" id="1512659">.</span><span class="ident" id="1512660">Err</span>&nbsp;<span class="op" id="1512664">==</span>&nbsp;<span class="ident" id="1512667"><a href="/net/tcpsock_posix.go.html#1505863">syscall</a></span><span class="op" id="1512674">.</span><span class="ident" id="1512675">EADDRNOTAVAIL</span><br>
<span class="lineno">220</span><span class="op" id="1512689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1512692">//&nbsp;TCPListener&nbsp;is&nbsp;a&nbsp;TCP&nbsp;network&nbsp;listener.&nbsp;&nbsp;Clients&nbsp;should&nbsp;typically</span><br>
<span class="lineno"></span><span class="comment" id="1512760">//&nbsp;use&nbsp;variables&nbsp;of&nbsp;type&nbsp;Listener&nbsp;instead&nbsp;of&nbsp;assuming&nbsp;TCP.</span><br>
<span class="lineno"></span><span class="keyword" id="1512819">type</span>&nbsp;<span class="ident" id="1512824">TCPListener</span>&nbsp;<span class="keyword" id="1512836">struct</span>&nbsp;<span class="op" id="1512843">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1512846">fd</span>&nbsp;<span class="op" id="1512849">*</span><span class="ident" id="1512850"><a href="/net/fd_unix.go.html#1388279">netFD</a></span><br>
<span class="lineno"></span><span class="op" id="1512856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1512859">//&nbsp;AcceptTCP&nbsp;accepts&nbsp;the&nbsp;next&nbsp;incoming&nbsp;call&nbsp;and&nbsp;returns&nbsp;the&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="1512923">//&nbsp;connection.</span><br>
<span class="lineno">230</span><span class="keyword" id="1512938">func</span>&nbsp;<span class="op" id="1512943">(</span><span class="ident" id="1512944">l</span>&nbsp;<span class="op" id="1512946">*</span><span class="ident" id="1512947"><a href="/net/tcpsock_posix.go.html#1512824">TCPListener</a></span><span class="op" id="1512958">)</span>&nbsp;<span class="ident" id="1512960">AcceptTCP</span><span class="op" id="1512969">(</span><span class="op" id="1512970">)</span>&nbsp;<span class="op" id="1512972">(</span><span class="op" id="1512973">*</span><span class="ident" id="1512974"><a href="/net/tcpsock_posix.go.html#1507019">TCPConn</a></span><span class="op" id="1512981">,</span>&nbsp;<span class="builtintype" id="1512983">error</span><span class="op" id="1512988">)</span>&nbsp;<span class="op" id="1512990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1512993">if</span>&nbsp;<span class="ident" id="1512996"><a href="/net/tcpsock_posix.go.html#1512944">l</a></span>&nbsp;<span class="op" id="1512998">==</span>&nbsp;<span class="ident" id="1513001">nil</span>&nbsp;<span class="op" id="1513005">||</span>&nbsp;<span class="ident" id="1513008"><a href="/net/tcpsock_posix.go.html#1512944">l</a></span><span class="op" id="1513009">.</span><span class="ident" id="1513010">fd</span>&nbsp;<span class="op" id="1513013">==</span>&nbsp;<span class="ident" id="1513016">nil</span>&nbsp;<span class="op" id="1513020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1513024">return</span>&nbsp;<span class="ident" id="1513031">nil</span><span class="op" id="1513034">,</span>&nbsp;<span class="ident" id="1513036"><a href="/net/tcpsock_posix.go.html#1505863">syscall</a></span><span class="op" id="1513043">.</span><span class="ident" id="1513044">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1513052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1513055">fd</span><span class="op" id="1513057">,</span>&nbsp;<span class="ident" id="1513059">err</span>&nbsp;<span class="op" id="1513063">:=</span>&nbsp;<span class="ident" id="1513066"><a href="/net/tcpsock_posix.go.html#1512944">l</a></span><span class="op" id="1513067">.</span><span class="ident" id="1513068">fd</span><span class="op" id="1513070">.</span><span class="ident" id="1513071">accept</span><span class="op" id="1513077">(</span><span class="op" id="1513078">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1513081">if</span>&nbsp;<span class="ident" id="1513084"><a href="/net/tcpsock_posix.go.html#1513059">err</a></span>&nbsp;<span class="op" id="1513088">!=</span>&nbsp;<span class="ident" id="1513091">nil</span>&nbsp;<span class="op" id="1513095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1513099">return</span>&nbsp;<span class="ident" id="1513106">nil</span><span class="op" id="1513109">,</span>&nbsp;<span class="ident" id="1513111"><a href="/net/tcpsock_posix.go.html#1513059">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1513116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1513119">return</span>&nbsp;<span class="ident" id="1513126"><a href="/net/tcpsock_posix.go.html#1507050">newTCPConn</a></span><span class="op" id="1513136">(</span><span class="ident" id="1513137"><a href="/net/tcpsock_posix.go.html#1513055">fd</a></span><span class="op" id="1513139">)</span><span class="op" id="1513140">,</span>&nbsp;<span class="ident" id="1513142">nil</span><br>
<span class="lineno"></span><span class="op" id="1513146">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="1513149">//&nbsp;Accept&nbsp;implements&nbsp;the&nbsp;Accept&nbsp;method&nbsp;in&nbsp;the&nbsp;Listener&nbsp;interface;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="1513218">//&nbsp;waits&nbsp;for&nbsp;the&nbsp;next&nbsp;call&nbsp;and&nbsp;returns&nbsp;a&nbsp;generic&nbsp;Conn.</span><br>
<span class="lineno"></span><span class="keyword" id="1513273">func</span>&nbsp;<span class="op" id="1513278">(</span><span class="ident" id="1513279">l</span>&nbsp;<span class="op" id="1513281">*</span><span class="ident" id="1513282"><a href="/net/tcpsock_posix.go.html#1512824">TCPListener</a></span><span class="op" id="1513293">)</span>&nbsp;<span class="ident" id="1513295">Accept</span><span class="op" id="1513301">(</span><span class="op" id="1513302">)</span>&nbsp;<span class="op" id="1513304">(</span><span class="ident" id="1513305"><a href="/net/net.go.html#1465335">Conn</a></span><span class="op" id="1513309">,</span>&nbsp;<span class="builtintype" id="1513311">error</span><span class="op" id="1513316">)</span>&nbsp;<span class="op" id="1513318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1513321">c</span><span class="op" id="1513322">,</span>&nbsp;<span class="ident" id="1513324">err</span>&nbsp;<span class="op" id="1513328">:=</span>&nbsp;<span class="ident" id="1513331"><a href="/net/tcpsock_posix.go.html#1513279">l</a></span><span class="op" id="1513332">.</span><span class="ident" id="1513333">AcceptTCP</span><span class="op" id="1513342">(</span><span class="op" id="1513343">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1513346">if</span>&nbsp;<span class="ident" id="1513349"><a href="/net/tcpsock_posix.go.html#1513324">err</a></span>&nbsp;<span class="op" id="1513353">!=</span>&nbsp;<span class="ident" id="1513356">nil</span>&nbsp;<span class="op" id="1513360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1513364">return</span>&nbsp;<span class="ident" id="1513371">nil</span><span class="op" id="1513374">,</span>&nbsp;<span class="ident" id="1513376"><a href="/net/tcpsock_posix.go.html#1513324">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1513381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1513384">return</span>&nbsp;<span class="ident" id="1513391"><a href="/net/tcpsock_posix.go.html#1513321">c</a></span><span class="op" id="1513392">,</span>&nbsp;<span class="ident" id="1513394">nil</span><br>
<span class="lineno"></span><span class="op" id="1513398">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="comment" id="1513401">//&nbsp;Close&nbsp;stops&nbsp;listening&nbsp;on&nbsp;the&nbsp;TCP&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="1513446">//&nbsp;Already&nbsp;Accepted&nbsp;connections&nbsp;are&nbsp;not&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="1513494">func</span>&nbsp;<span class="op" id="1513499">(</span><span class="ident" id="1513500">l</span>&nbsp;<span class="op" id="1513502">*</span><span class="ident" id="1513503"><a href="/net/tcpsock_posix.go.html#1512824">TCPListener</a></span><span class="op" id="1513514">)</span>&nbsp;<span class="ident" id="1513516">Close</span><span class="op" id="1513521">(</span><span class="op" id="1513522">)</span>&nbsp;<span class="builtintype" id="1513524">error</span>&nbsp;<span class="op" id="1513530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1513533">if</span>&nbsp;<span class="ident" id="1513536"><a href="/net/tcpsock_posix.go.html#1513500">l</a></span>&nbsp;<span class="op" id="1513538">==</span>&nbsp;<span class="ident" id="1513541">nil</span>&nbsp;<span class="op" id="1513545">||</span>&nbsp;<span class="ident" id="1513548"><a href="/net/tcpsock_posix.go.html#1513500">l</a></span><span class="op" id="1513549">.</span><span class="ident" id="1513550">fd</span>&nbsp;<span class="op" id="1513553">==</span>&nbsp;<span class="ident" id="1513556">nil</span>&nbsp;<span class="op" id="1513560">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1513564">return</span>&nbsp;<span class="ident" id="1513571"><a href="/net/tcpsock_posix.go.html#1505863">syscall</a></span><span class="op" id="1513578">.</span><span class="ident" id="1513579">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1513587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1513590">return</span>&nbsp;<span class="ident" id="1513597"><a href="/net/tcpsock_posix.go.html#1513500">l</a></span><span class="op" id="1513598">.</span><span class="ident" id="1513599">fd</span><span class="op" id="1513601">.</span><span class="ident" id="1513602">Close</span><span class="op" id="1513607">(</span><span class="op" id="1513608">)</span><br>
<span class="lineno"></span><span class="op" id="1513610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="1513613">//&nbsp;Addr&nbsp;returns&nbsp;the&nbsp;listener&#39;s&nbsp;network&nbsp;address,&nbsp;a&nbsp;*TCPAddr.</span><br>
<span class="lineno"></span><span class="keyword" id="1513673">func</span>&nbsp;<span class="op" id="1513678">(</span><span class="ident" id="1513679">l</span>&nbsp;<span class="op" id="1513681">*</span><span class="ident" id="1513682"><a href="/net/tcpsock_posix.go.html#1512824">TCPListener</a></span><span class="op" id="1513693">)</span>&nbsp;<span class="ident" id="1513695">Addr</span><span class="op" id="1513699">(</span><span class="op" id="1513700">)</span>&nbsp;<span class="ident" id="1513702"><a href="/net/net.go.html#1465097">Addr</a></span>&nbsp;<span class="op" id="1513707">{</span>&nbsp;<span class="keyword" id="1513709">return</span>&nbsp;<span class="ident" id="1513716"><a href="/net/tcpsock_posix.go.html#1513679">l</a></span><span class="op" id="1513717">.</span><span class="ident" id="1513718">fd</span><span class="op" id="1513720">.</span><span class="ident" id="1513721">laddr</span>&nbsp;<span class="op" id="1513727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1513730">//&nbsp;SetDeadline&nbsp;sets&nbsp;the&nbsp;deadline&nbsp;associated&nbsp;with&nbsp;the&nbsp;listener.</span><br>
<span class="lineno"></span><span class="comment" id="1513793">//&nbsp;A&nbsp;zero&nbsp;time&nbsp;value&nbsp;disables&nbsp;the&nbsp;deadline.</span><br>
<span class="lineno">265</span><span class="keyword" id="1513837">func</span>&nbsp;<span class="op" id="1513842">(</span><span class="ident" id="1513843">l</span>&nbsp;<span class="op" id="1513845">*</span><span class="ident" id="1513846"><a href="/net/tcpsock_posix.go.html#1512824">TCPListener</a></span><span class="op" id="1513857">)</span>&nbsp;<span class="ident" id="1513859">SetDeadline</span><span class="op" id="1513870">(</span><span class="ident" id="1513871">t</span>&nbsp;<span class="ident" id="1513873"><a href="/net/tcpsock_posix.go.html#1505874">time</a></span><span class="op" id="1513877">.</span><span class="ident" id="1513878">Time</span><span class="op" id="1513882">)</span>&nbsp;<span class="builtintype" id="1513884">error</span>&nbsp;<span class="op" id="1513890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1513893">if</span>&nbsp;<span class="ident" id="1513896"><a href="/net/tcpsock_posix.go.html#1513843">l</a></span>&nbsp;<span class="op" id="1513898">==</span>&nbsp;<span class="ident" id="1513901">nil</span>&nbsp;<span class="op" id="1513905">||</span>&nbsp;<span class="ident" id="1513908"><a href="/net/tcpsock_posix.go.html#1513843">l</a></span><span class="op" id="1513909">.</span><span class="ident" id="1513910">fd</span>&nbsp;<span class="op" id="1513913">==</span>&nbsp;<span class="ident" id="1513916">nil</span>&nbsp;<span class="op" id="1513920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1513924">return</span>&nbsp;<span class="ident" id="1513931"><a href="/net/tcpsock_posix.go.html#1505863">syscall</a></span><span class="op" id="1513938">.</span><span class="ident" id="1513939">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1513947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1513950">return</span>&nbsp;<span class="ident" id="1513957"><a href="/net/tcpsock_posix.go.html#1513843">l</a></span><span class="op" id="1513958">.</span><span class="ident" id="1513959">fd</span><span class="op" id="1513961">.</span><span class="ident" id="1513962">setDeadline</span><span class="op" id="1513973">(</span><span class="ident" id="1513974"><a href="/net/tcpsock_posix.go.html#1513871">t</a></span><span class="op" id="1513975">)</span><br>
<span class="lineno">270</span><span class="op" id="1513977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1513980">//&nbsp;File&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;underlying&nbsp;os.File,&nbsp;set&nbsp;to&nbsp;blocking</span><br>
<span class="lineno"></span><span class="comment" id="1514046">//&nbsp;mode.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;close&nbsp;f&nbsp;when&nbsp;finished.</span><br>
<span class="lineno"></span><span class="comment" id="1514116">//&nbsp;Closing&nbsp;l&nbsp;does&nbsp;not&nbsp;affect&nbsp;f,&nbsp;and&nbsp;closing&nbsp;f&nbsp;does&nbsp;not&nbsp;affect&nbsp;l.</span><br>
<span class="lineno">275</span><span class="comment" id="1514181">//</span><br>
<span class="lineno"></span><span class="comment" id="1514184">//&nbsp;The&nbsp;returned&nbsp;os.File&#39;s&nbsp;file&nbsp;descriptor&nbsp;is&nbsp;different&nbsp;from&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1514248">//&nbsp;connection&#39;s.&nbsp;&nbsp;Attempting&nbsp;to&nbsp;change&nbsp;properties&nbsp;of&nbsp;the&nbsp;original</span><br>
<span class="lineno"></span><span class="comment" id="1514314">//&nbsp;using&nbsp;this&nbsp;duplicate&nbsp;may&nbsp;or&nbsp;may&nbsp;not&nbsp;have&nbsp;the&nbsp;desired&nbsp;effect.</span><br>
<span class="lineno"></span><span class="keyword" id="1514378">func</span>&nbsp;<span class="op" id="1514383">(</span><span class="ident" id="1514384">l</span>&nbsp;<span class="op" id="1514386">*</span><span class="ident" id="1514387"><a href="/net/tcpsock_posix.go.html#1512824">TCPListener</a></span><span class="op" id="1514398">)</span>&nbsp;<span class="ident" id="1514400">File</span><span class="op" id="1514404">(</span><span class="op" id="1514405">)</span>&nbsp;<span class="op" id="1514407">(</span><span class="ident" id="1514408">f</span>&nbsp;<span class="op" id="1514410">*</span><span class="ident" id="1514411"><a href="/net/tcpsock_posix.go.html#1505857">os</a></span><span class="op" id="1514413">.</span><span class="ident" id="1514414">File</span><span class="op" id="1514418">,</span>&nbsp;<span class="ident" id="1514420">err</span>&nbsp;<span class="builtintype" id="1514424">error</span><span class="op" id="1514429">)</span>&nbsp;<span class="op" id="1514431">{</span>&nbsp;<span class="keyword" id="1514433">return</span>&nbsp;<span class="ident" id="1514440"><a href="/net/tcpsock_posix.go.html#1514384">l</a></span><span class="op" id="1514441">.</span><span class="ident" id="1514442">fd</span><span class="op" id="1514444">.</span><span class="ident" id="1514445">dup</span><span class="op" id="1514448">(</span><span class="op" id="1514449">)</span>&nbsp;<span class="op" id="1514451">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="1514454">//&nbsp;ListenTCP&nbsp;announces&nbsp;on&nbsp;the&nbsp;TCP&nbsp;address&nbsp;laddr&nbsp;and&nbsp;returns&nbsp;a&nbsp;TCP</span><br>
<span class="lineno"></span><span class="comment" id="1514520">//&nbsp;listener.&nbsp;&nbsp;Net&nbsp;must&nbsp;be&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;,&nbsp;or&nbsp;&#34;tcp6&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;has&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="1514588">//&nbsp;port&nbsp;of&nbsp;0,&nbsp;ListenTCP&nbsp;will&nbsp;choose&nbsp;an&nbsp;available&nbsp;port.&nbsp;&nbsp;The&nbsp;caller&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="1514659">//&nbsp;use&nbsp;the&nbsp;Addr&nbsp;method&nbsp;of&nbsp;TCPListener&nbsp;to&nbsp;retrieve&nbsp;the&nbsp;chosen&nbsp;address.</span><br>
<span class="lineno">285</span><span class="keyword" id="1514729">func</span>&nbsp;<span class="ident" id="1514734">ListenTCP</span><span class="op" id="1514743">(</span><span class="ident" id="1514744">net</span>&nbsp;<span class="builtintype" id="1514748">string</span><span class="op" id="1514754">,</span>&nbsp;<span class="ident" id="1514756">laddr</span>&nbsp;<span class="op" id="1514762">*</span><span class="ident" id="1514763"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="1514770">)</span>&nbsp;<span class="op" id="1514772">(</span><span class="op" id="1514773">*</span><span class="ident" id="1514774"><a href="/net/tcpsock_posix.go.html#1512824">TCPListener</a></span><span class="op" id="1514785">,</span>&nbsp;<span class="builtintype" id="1514787">error</span><span class="op" id="1514792">)</span>&nbsp;<span class="op" id="1514794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1514797">switch</span>&nbsp;<span class="ident" id="1514804"><a href="/net/tcpsock_posix.go.html#1514744">net</a></span>&nbsp;<span class="op" id="1514808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1514811">case</span>&nbsp;<span class="string" id="1514816">&#34;tcp&#34;</span><span class="op" id="1514821">,</span>&nbsp;<span class="string" id="1514823">&#34;tcp4&#34;</span><span class="op" id="1514829">,</span>&nbsp;<span class="string" id="1514831">&#34;tcp6&#34;</span><span class="op" id="1514837">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1514840">default</span><span class="op" id="1514847">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1514851">return</span>&nbsp;<span class="ident" id="1514858">nil</span><span class="op" id="1514861">,</span>&nbsp;<span class="op" id="1514863">&amp;</span><span class="ident" id="1514864"><a href="/net/net.go.html#1472480">OpError</a></span><span class="op" id="1514871">{</span><span class="ident" id="1514872">Op</span><span class="op" id="1514874">:</span>&nbsp;<span class="string" id="1514876">&#34;listen&#34;</span><span class="op" id="1514884">,</span>&nbsp;<span class="ident" id="1514886">Net</span><span class="op" id="1514889">:</span>&nbsp;<span class="ident" id="1514891"><a href="/net/tcpsock_posix.go.html#1514744">net</a></span><span class="op" id="1514894">,</span>&nbsp;<span class="ident" id="1514896">Addr</span><span class="op" id="1514900">:</span>&nbsp;<span class="ident" id="1514902"><a href="/net/tcpsock_posix.go.html#1514756">laddr</a></span><span class="op" id="1514907">,</span>&nbsp;<span class="ident" id="1514909">Err</span><span class="op" id="1514912">:</span>&nbsp;<span class="ident" id="1514914"><a href="/net/net.go.html#1473867">UnknownNetworkError</a></span><span class="op" id="1514933">(</span><span class="ident" id="1514934"><a href="/net/tcpsock_posix.go.html#1514744">net</a></span><span class="op" id="1514937">)</span><span class="op" id="1514938">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1514941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1514944">if</span>&nbsp;<span class="ident" id="1514947"><a href="/net/tcpsock_posix.go.html#1514756">laddr</a></span>&nbsp;<span class="op" id="1514953">==</span>&nbsp;<span class="ident" id="1514956">nil</span>&nbsp;<span class="op" id="1514960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1514964"><a href="/net/tcpsock_posix.go.html#1514756">laddr</a></span>&nbsp;<span class="op" id="1514970">=</span>&nbsp;<span class="op" id="1514972">&amp;</span><span class="ident" id="1514973"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="1514980">{</span><span class="op" id="1514981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1514984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1514987">fd</span><span class="op" id="1514989">,</span>&nbsp;<span class="ident" id="1514991">err</span>&nbsp;<span class="op" id="1514995">:=</span>&nbsp;<span class="ident" id="1514998"><a href="/net/ipsock_posix.go.html#1452753">internetSocket</a></span><span class="op" id="1515012">(</span><span class="ident" id="1515013"><a href="/net/tcpsock_posix.go.html#1514744">net</a></span><span class="op" id="1515016">,</span>&nbsp;<span class="ident" id="1515018"><a href="/net/tcpsock_posix.go.html#1514756">laddr</a></span><span class="op" id="1515023">,</span>&nbsp;<span class="ident" id="1515025">nil</span><span class="op" id="1515028">,</span>&nbsp;<span class="ident" id="1515030"><a href="/net/net.go.html#1473194">noDeadline</a></span><span class="op" id="1515040">,</span>&nbsp;<span class="ident" id="1515042"><a href="/net/tcpsock_posix.go.html#1505863">syscall</a></span><span class="op" id="1515049">.</span><span class="ident" id="1515050">SOCK_STREAM</span><span class="op" id="1515061">,</span>&nbsp;<span class="num" id="1515063">0</span><span class="op" id="1515064">,</span>&nbsp;<span class="string" id="1515066">&#34;listen&#34;</span><span class="op" id="1515074">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1515077">if</span>&nbsp;<span class="ident" id="1515080"><a href="/net/tcpsock_posix.go.html#1514991">err</a></span>&nbsp;<span class="op" id="1515084">!=</span>&nbsp;<span class="ident" id="1515087">nil</span>&nbsp;<span class="op" id="1515091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1515095">return</span>&nbsp;<span class="ident" id="1515102">nil</span><span class="op" id="1515105">,</span>&nbsp;<span class="op" id="1515107">&amp;</span><span class="ident" id="1515108"><a href="/net/net.go.html#1472480">OpError</a></span><span class="op" id="1515115">{</span><span class="ident" id="1515116">Op</span><span class="op" id="1515118">:</span>&nbsp;<span class="string" id="1515120">&#34;listen&#34;</span><span class="op" id="1515128">,</span>&nbsp;<span class="ident" id="1515130">Net</span><span class="op" id="1515133">:</span>&nbsp;<span class="ident" id="1515135"><a href="/net/tcpsock_posix.go.html#1514744">net</a></span><span class="op" id="1515138">,</span>&nbsp;<span class="ident" id="1515140">Addr</span><span class="op" id="1515144">:</span>&nbsp;<span class="ident" id="1515146"><a href="/net/tcpsock_posix.go.html#1514756">laddr</a></span><span class="op" id="1515151">,</span>&nbsp;<span class="ident" id="1515153">Err</span><span class="op" id="1515156">:</span>&nbsp;<span class="ident" id="1515158"><a href="/net/tcpsock_posix.go.html#1514991">err</a></span><span class="op" id="1515161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1515164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1515167">return</span>&nbsp;<span class="op" id="1515174">&amp;</span><span class="ident" id="1515175"><a href="/net/tcpsock_posix.go.html#1512824">TCPListener</a></span><span class="op" id="1515186">{</span><span class="ident" id="1515187"><a href="/net/tcpsock_posix.go.html#1514987">fd</a></span><span class="op" id="1515189">}</span><span class="op" id="1515190">,</span>&nbsp;<span class="ident" id="1515192">nil</span><br>
<span class="lineno"></span><span class="op" id="1515196">}</span>
</div>
</body>
</html>
