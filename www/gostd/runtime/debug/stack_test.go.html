<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime/debug</h2>
<ul>
<li><a href="/gostd/runtime/debug/garbage.go.html">garbage.go</a></li>
<li><a href="/gostd/runtime/debug/garbage_test.go.html">garbage_test.go</a></li>
<li><a href="/gostd/runtime/debug/heapdump_test.go.html">heapdump_test.go</a></li>
<li><a href="/gostd/runtime/debug/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/debug/stack_test.go.html" class="current">stack_test.go</a></li>
<li><a href="/gostd/runtime/debug/stubs.go.html">stubs.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8165549">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8165604">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8165658">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8165709">package</span>&nbsp;<span class="ident" id="8165717">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8165724">import</span>&nbsp;<span class="op" id="8165731">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8165734">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8165745">&#34;testing&#34;</span><br>
<span class="lineno">10</span><span class="op" id="8165755">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8165758">type</span>&nbsp;<span class="ident" id="8165763">T</span>&nbsp;<span class="builtintype" id="8165765">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8165770">func</span>&nbsp;<span class="op" id="8165775">(</span><span class="ident" id="8165776">t</span>&nbsp;<span class="op" id="8165778">*</span><span class="ident" id="8165779">T</span><span class="op" id="8165780">)</span>&nbsp;<span class="ident" id="8165782">ptrmethod</span><span class="op" id="8165791">(</span><span class="op" id="8165792">)</span>&nbsp;<span class="op" id="8165794">[</span><span class="op" id="8165795">]</span><span class="builtintype" id="8165796">byte</span>&nbsp;<span class="op" id="8165801">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8165804">return</span>&nbsp;<span class="ident" id="8165811">Stack</span><span class="op" id="8165816">(</span><span class="op" id="8165817">)</span><br>
<span class="lineno"></span><span class="op" id="8165819">}</span><br>
<span class="lineno"></span><span class="keyword" id="8165821">func</span>&nbsp;<span class="op" id="8165826">(</span><span class="ident" id="8165827">t</span>&nbsp;<span class="ident" id="8165829">T</span><span class="op" id="8165830">)</span>&nbsp;<span class="ident" id="8165832">method</span><span class="op" id="8165838">(</span><span class="op" id="8165839">)</span>&nbsp;<span class="op" id="8165841">[</span><span class="op" id="8165842">]</span><span class="builtintype" id="8165843">byte</span>&nbsp;<span class="op" id="8165848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8165851">return</span>&nbsp;<span class="ident" id="8165858">t</span><span class="op" id="8165859">.</span><span class="ident" id="8165860">ptrmethod</span><span class="op" id="8165869">(</span><span class="op" id="8165870">)</span><br>
<span class="lineno"></span><span class="op" id="8165872">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="8165875">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspThe&nbsp;traceback&nbsp;should&nbsp;look&nbsp;something&nbsp;like&nbsp;this,&nbsp;modulo&nbsp;line&nbsp;numbers&nbsp;and&nbsp;hex&nbsp;constants.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspDon&#39;t&nbsp;worry&nbsp;much&nbsp;about&nbsp;the&nbsp;base&nbsp;levels,&nbsp;but&nbsp;check&nbsp;the&nbsp;ones&nbsp;in&nbsp;our&nbsp;own&nbsp;package.<br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/debug/stack_test.go:15&nbsp;(0x13878)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp(*T).ptrmethod:&nbsp;return&nbsp;Stack()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/debug/stack_test.go:18&nbsp;(0x138dd)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspT.method:&nbsp;return&nbsp;t.ptrmethod()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/debug/stack_test.go:23&nbsp;(0x13920)<br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspTestStack:&nbsp;b&nbsp;:=&nbsp;T(0).method()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/testing/testing.go:132&nbsp;(0x14a7a)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsptRunner:&nbsp;test.F(t)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/proc.c:145&nbsp;(0xc970)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp???:&nbsp;runtime·unlock(&amp;runtime·sched);<br>
<span class="lineno">35</span>*/</span><br>
<span class="lineno"></span><span class="keyword" id="8166488">func</span>&nbsp;<span class="ident" id="8166493">TestStack</span><span class="op" id="8166502">(</span><span class="ident" id="8166503">t</span>&nbsp;<span class="op" id="8166505">*</span><span class="ident" id="8166506">testing</span><span class="op" id="8166513">.</span><span class="ident" id="8166514">T</span><span class="op" id="8166515">)</span>&nbsp;<span class="op" id="8166517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8166520">b</span>&nbsp;<span class="op" id="8166522">:=</span>&nbsp;<span class="ident" id="8166525">T</span><span class="op" id="8166526">(</span><span class="num" id="8166527">0</span><span class="op" id="8166528">)</span><span class="op" id="8166529">.</span><span class="ident" id="8166530">method</span><span class="op" id="8166536">(</span><span class="op" id="8166537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8166540">lines</span>&nbsp;<span class="op" id="8166546">:=</span>&nbsp;<span class="ident" id="8166549">strings</span><span class="op" id="8166556">.</span><span class="ident" id="8166557">Split</span><span class="op" id="8166562">(</span><span class="builtintype" id="8166563">string</span><span class="op" id="8166569">(</span><span class="ident" id="8166570">b</span><span class="op" id="8166571">)</span><span class="op" id="8166572">,</span>&nbsp;<span class="string" id="8166574">&#34;\n&#34;</span><span class="op" id="8166578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8166581">if</span>&nbsp;<span class="builtinfunc" id="8166584">len</span><span class="op" id="8166587">(</span><span class="ident" id="8166588">lines</span><span class="op" id="8166593">)</span>&nbsp;<span class="op" id="8166595">&lt;</span>&nbsp;<span class="num" id="8166597">6</span>&nbsp;<span class="op" id="8166599">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8166603">t</span><span class="op" id="8166604">.</span><span class="ident" id="8166605">Fatal</span><span class="op" id="8166610">(</span><span class="string" id="8166611">&#34;too&nbsp;few&nbsp;lines&#34;</span><span class="op" id="8166626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8166629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8166632">n</span>&nbsp;<span class="op" id="8166634">:=</span>&nbsp;<span class="num" id="8166637">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8166640">frame</span>&nbsp;<span class="op" id="8166646">:=</span>&nbsp;<span class="keyword" id="8166649">func</span><span class="op" id="8166653">(</span><span class="ident" id="8166654">line</span><span class="op" id="8166658">,</span>&nbsp;<span class="ident" id="8166660">code</span>&nbsp;<span class="builtintype" id="8166665">string</span><span class="op" id="8166671">)</span>&nbsp;<span class="op" id="8166673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8166677">check</span><span class="op" id="8166682">(</span><span class="ident" id="8166683">t</span><span class="op" id="8166684">,</span>&nbsp;<span class="ident" id="8166686">lines</span><span class="op" id="8166691">[</span><span class="ident" id="8166692">n</span><span class="op" id="8166693">]</span><span class="op" id="8166694">,</span>&nbsp;<span class="ident" id="8166696">line</span><span class="op" id="8166700">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8166704">n</span><span class="op" id="8166705">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8166710">//&nbsp;The&nbsp;source&nbsp;might&nbsp;not&nbsp;be&nbsp;available&nbsp;while&nbsp;running&nbsp;the&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8166773">if</span>&nbsp;<span class="ident" id="8166776">strings</span><span class="op" id="8166783">.</span><span class="ident" id="8166784">HasPrefix</span><span class="op" id="8166793">(</span><span class="ident" id="8166794">lines</span><span class="op" id="8166799">[</span><span class="ident" id="8166800">n</span><span class="op" id="8166801">]</span><span class="op" id="8166802">,</span>&nbsp;<span class="string" id="8166804">&#34;\t&#34;</span><span class="op" id="8166808">)</span>&nbsp;<span class="op" id="8166810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8166815">check</span><span class="op" id="8166820">(</span><span class="ident" id="8166821">t</span><span class="op" id="8166822">,</span>&nbsp;<span class="ident" id="8166824">lines</span><span class="op" id="8166829">[</span><span class="ident" id="8166830">n</span><span class="op" id="8166831">]</span><span class="op" id="8166832">,</span>&nbsp;<span class="ident" id="8166834">code</span><span class="op" id="8166838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8166843">n</span><span class="op" id="8166844">++</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8166849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8166852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8166855">frame</span><span class="op" id="8166860">(</span><span class="string" id="8166861">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="8166894">,</span>&nbsp;<span class="string" id="8166896">&#34;\t(*T).ptrmethod:&nbsp;return&nbsp;Stack()&#34;</span><span class="op" id="8166930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8166933">frame</span><span class="op" id="8166938">(</span><span class="string" id="8166939">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="8166972">,</span>&nbsp;<span class="string" id="8166974">&#34;\tT.method:&nbsp;return&nbsp;t.ptrmethod()&#34;</span><span class="op" id="8167008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8167011">frame</span><span class="op" id="8167016">(</span><span class="string" id="8167017">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="8167050">,</span>&nbsp;<span class="string" id="8167052">&#34;\tTestStack:&nbsp;b&nbsp;:=&nbsp;T(0).method()&#34;</span><span class="op" id="8167085">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8167088">frame</span><span class="op" id="8167093">(</span><span class="string" id="8167094">&#34;src/testing/testing.go&#34;</span><span class="op" id="8167118">,</span>&nbsp;<span class="string" id="8167120">&#34;&#34;</span><span class="op" id="8167122">)</span><br>
<span class="lineno"></span><span class="op" id="8167124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8167127">func</span>&nbsp;<span class="ident" id="8167132">check</span><span class="op" id="8167137">(</span><span class="ident" id="8167138">t</span>&nbsp;<span class="op" id="8167140">*</span><span class="ident" id="8167141">testing</span><span class="op" id="8167148">.</span><span class="ident" id="8167149">T</span><span class="op" id="8167150">,</span>&nbsp;<span class="ident" id="8167152">line</span><span class="op" id="8167156">,</span>&nbsp;<span class="ident" id="8167158">has</span>&nbsp;<span class="builtintype" id="8167162">string</span><span class="op" id="8167168">)</span>&nbsp;<span class="op" id="8167170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8167173">if</span>&nbsp;<span class="ident" id="8167176">strings</span><span class="op" id="8167183">.</span><span class="ident" id="8167184">Index</span><span class="op" id="8167189">(</span><span class="ident" id="8167190">line</span><span class="op" id="8167194">,</span>&nbsp;<span class="ident" id="8167196">has</span><span class="op" id="8167199">)</span>&nbsp;<span class="op" id="8167201">&lt;</span>&nbsp;<span class="num" id="8167203">0</span>&nbsp;<span class="op" id="8167205">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8167209">t</span><span class="op" id="8167210">.</span><span class="ident" id="8167211">Errorf</span><span class="op" id="8167217">(</span><span class="string" id="8167218">&#34;expected&nbsp;%q&nbsp;in&nbsp;%q&#34;</span><span class="op" id="8167237">,</span>&nbsp;<span class="ident" id="8167239">has</span><span class="op" id="8167242">,</span>&nbsp;<span class="ident" id="8167244">line</span><span class="op" id="8167248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8167251">}</span><br>
<span class="lineno"></span><span class="op" id="8167253">}</span>
</div>
</body>
</html>
