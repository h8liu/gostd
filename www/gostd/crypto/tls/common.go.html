<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html" class="current">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3725528">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3725583">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3725637">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3725688">package</span>&nbsp;<span class="ident" id="3725696">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3725701">import</span>&nbsp;<span class="op" id="3725708">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3725711">&#34;container/list&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3725729">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3725739">&#34;crypto/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3725754">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3725769">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3725776">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3725782">&#34;math/big&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3725794">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3725805">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3725813">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3725820">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="3725823">const</span>&nbsp;<span class="op" id="3725829">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3725832">VersionSSL30</span>&nbsp;<span class="op" id="3725845">=</span>&nbsp;<span class="num" id="3725847">0x0300</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3725855">VersionTLS10</span>&nbsp;<span class="op" id="3725868">=</span>&nbsp;<span class="num" id="3725870">0x0301</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3725878">VersionTLS11</span>&nbsp;<span class="op" id="3725891">=</span>&nbsp;<span class="num" id="3725893">0x0302</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3725901">VersionTLS12</span>&nbsp;<span class="op" id="3725914">=</span>&nbsp;<span class="num" id="3725916">0x0303</span><br>
<span class="lineno">25</span><span class="op" id="3725923">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3725926">const</span>&nbsp;<span class="op" id="3725932">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3725935">maxPlaintext</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3725951">=</span>&nbsp;<span class="num" id="3725953">16384</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3725966">//&nbsp;maximum&nbsp;plaintext&nbsp;payload&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3726003">maxCiphertext</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3726019">=</span>&nbsp;<span class="num" id="3726021">16384</span>&nbsp;<span class="op" id="3726027">+</span>&nbsp;<span class="num" id="3726029">2048</span>&nbsp;<span class="comment" id="3726034">//&nbsp;maximum&nbsp;ciphertext&nbsp;payload&nbsp;length</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3726072">recordHeaderLen</span>&nbsp;<span class="op" id="3726088">=</span>&nbsp;<span class="num" id="3726090">5</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3726103">//&nbsp;record&nbsp;header&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3726128">maxHandshake</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3726144">=</span>&nbsp;<span class="num" id="3726146">65536</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3726159">//&nbsp;maximum&nbsp;handshake&nbsp;we&nbsp;support&nbsp;(protocol&nbsp;max&nbsp;is&nbsp;16&nbsp;MB)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3726217">minVersion</span>&nbsp;<span class="op" id="3726228">=</span>&nbsp;<span class="ident" id="3726230">VersionSSL30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3726244">maxVersion</span>&nbsp;<span class="op" id="3726255">=</span>&nbsp;<span class="ident" id="3726257">VersionTLS12</span><br>
<span class="lineno">35</span><span class="op" id="3726270">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3726273">//&nbsp;TLS&nbsp;record&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="3726294">type</span>&nbsp;<span class="ident" id="3726299">recordType</span>&nbsp;<span class="builtintype" id="3726310">uint8</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="3726317">const</span>&nbsp;<span class="op" id="3726323">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3726326">recordTypeChangeCipherSpec</span>&nbsp;<span class="ident" id="3726353">recordType</span>&nbsp;<span class="op" id="3726364">=</span>&nbsp;<span class="num" id="3726366">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3726370">recordTypeAlert</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3726397">recordType</span>&nbsp;<span class="op" id="3726408">=</span>&nbsp;<span class="num" id="3726410">21</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3726414">recordTypeHandshake</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3726441">recordType</span>&nbsp;<span class="op" id="3726452">=</span>&nbsp;<span class="num" id="3726454">22</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3726458">recordTypeApplicationData</span>&nbsp;&nbsp;<span class="ident" id="3726485">recordType</span>&nbsp;<span class="op" id="3726496">=</span>&nbsp;<span class="num" id="3726498">23</span><br>
<span class="lineno">45</span><span class="op" id="3726501">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3726504">//&nbsp;TLS&nbsp;handshake&nbsp;message&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="3726536">const</span>&nbsp;<span class="op" id="3726542">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3726545">typeClientHello</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3726568">uint8</span>&nbsp;<span class="op" id="3726574">=</span>&nbsp;<span class="num" id="3726576">1</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3726579">typeServerHello</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3726602">uint8</span>&nbsp;<span class="op" id="3726608">=</span>&nbsp;<span class="num" id="3726610">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3726613">typeNewSessionTicket</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3726636">uint8</span>&nbsp;<span class="op" id="3726642">=</span>&nbsp;<span class="num" id="3726644">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3726647">typeCertificate</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3726670">uint8</span>&nbsp;<span class="op" id="3726676">=</span>&nbsp;<span class="num" id="3726678">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3726682">typeServerKeyExchange</span>&nbsp;&nbsp;<span class="builtintype" id="3726705">uint8</span>&nbsp;<span class="op" id="3726711">=</span>&nbsp;<span class="num" id="3726713">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3726717">typeCertificateRequest</span>&nbsp;<span class="builtintype" id="3726740">uint8</span>&nbsp;<span class="op" id="3726746">=</span>&nbsp;<span class="num" id="3726748">13</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3726752">typeServerHelloDone</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3726775">uint8</span>&nbsp;<span class="op" id="3726781">=</span>&nbsp;<span class="num" id="3726783">14</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3726787">typeCertificateVerify</span>&nbsp;&nbsp;<span class="builtintype" id="3726810">uint8</span>&nbsp;<span class="op" id="3726816">=</span>&nbsp;<span class="num" id="3726818">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3726822">typeClientKeyExchange</span>&nbsp;&nbsp;<span class="builtintype" id="3726845">uint8</span>&nbsp;<span class="op" id="3726851">=</span>&nbsp;<span class="num" id="3726853">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3726857">typeFinished</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3726880">uint8</span>&nbsp;<span class="op" id="3726886">=</span>&nbsp;<span class="num" id="3726888">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3726892">typeCertificateStatus</span>&nbsp;&nbsp;<span class="builtintype" id="3726915">uint8</span>&nbsp;<span class="op" id="3726921">=</span>&nbsp;<span class="num" id="3726923">22</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3726927">typeNextProtocol</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3726950">uint8</span>&nbsp;<span class="op" id="3726956">=</span>&nbsp;<span class="num" id="3726958">67</span>&nbsp;<span class="comment" id="3726961">//&nbsp;Not&nbsp;IANA&nbsp;assigned</span><br>
<span class="lineno"></span><span class="op" id="3726982">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3726985">//&nbsp;TLS&nbsp;compression&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="3727011">const</span>&nbsp;<span class="op" id="3727017">(</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3727020">compressionNone</span>&nbsp;<span class="builtintype" id="3727036">uint8</span>&nbsp;<span class="op" id="3727042">=</span>&nbsp;<span class="num" id="3727044">0</span><br>
<span class="lineno"></span><span class="op" id="3727046">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3727049">//&nbsp;TLS&nbsp;extension&nbsp;numbers</span><br>
<span class="lineno"></span><span class="keyword" id="3727074">const</span>&nbsp;<span class="op" id="3727080">(</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3727083">extensionServerName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3727112">uint16</span>&nbsp;<span class="op" id="3727119">=</span>&nbsp;<span class="num" id="3727121">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3727124">extensionStatusRequest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3727153">uint16</span>&nbsp;<span class="op" id="3727160">=</span>&nbsp;<span class="num" id="3727162">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3727165">extensionSupportedCurves</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3727194">uint16</span>&nbsp;<span class="op" id="3727201">=</span>&nbsp;<span class="num" id="3727203">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3727207">extensionSupportedPoints</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3727236">uint16</span>&nbsp;<span class="op" id="3727243">=</span>&nbsp;<span class="num" id="3727245">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3727249">extensionSignatureAlgorithms</span>&nbsp;<span class="builtintype" id="3727278">uint16</span>&nbsp;<span class="op" id="3727285">=</span>&nbsp;<span class="num" id="3727287">13</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3727291">extensionALPN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3727320">uint16</span>&nbsp;<span class="op" id="3727327">=</span>&nbsp;<span class="num" id="3727329">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3727333">extensionSessionTicket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3727362">uint16</span>&nbsp;<span class="op" id="3727369">=</span>&nbsp;<span class="num" id="3727371">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3727375">extensionNextProtoNeg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3727404">uint16</span>&nbsp;<span class="op" id="3727411">=</span>&nbsp;<span class="num" id="3727413">13172</span>&nbsp;<span class="comment" id="3727419">//&nbsp;not&nbsp;IANA&nbsp;assigned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3727441">extensionRenegotiationInfo</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3727470">uint16</span>&nbsp;<span class="op" id="3727477">=</span>&nbsp;<span class="num" id="3727479">0xff01</span><br>
<span class="lineno"></span><span class="op" id="3727486">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="3727489">//&nbsp;TLS&nbsp;signaling&nbsp;cipher&nbsp;suite&nbsp;values</span><br>
<span class="lineno"></span><span class="keyword" id="3727526">const</span>&nbsp;<span class="op" id="3727532">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3727535">scsvRenegotiation</span>&nbsp;<span class="builtintype" id="3727553">uint16</span>&nbsp;<span class="op" id="3727560">=</span>&nbsp;<span class="num" id="3727562">0x00ff</span><br>
<span class="lineno"></span><span class="op" id="3727569">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="3727572">//&nbsp;CurveID&nbsp;is&nbsp;the&nbsp;type&nbsp;of&nbsp;a&nbsp;TLS&nbsp;identifier&nbsp;for&nbsp;an&nbsp;elliptic&nbsp;curve.&nbsp;See</span><br>
<span class="lineno"></span><span class="comment" id="3727642">//&nbsp;http://www.iana.org/assignments/tls-parameters/tls-parameters.xml#tls-parameters-8</span><br>
<span class="lineno"></span><span class="keyword" id="3727728">type</span>&nbsp;<span class="ident" id="3727733">CurveID</span>&nbsp;<span class="builtintype" id="3727741">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="3727749">const</span>&nbsp;<span class="op" id="3727755">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3727758">CurveP256</span>&nbsp;<span class="ident" id="3727768">CurveID</span>&nbsp;<span class="op" id="3727776">=</span>&nbsp;<span class="num" id="3727778">23</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3727782">CurveP384</span>&nbsp;<span class="ident" id="3727792">CurveID</span>&nbsp;<span class="op" id="3727800">=</span>&nbsp;<span class="num" id="3727802">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3727806">CurveP521</span>&nbsp;<span class="ident" id="3727816">CurveID</span>&nbsp;<span class="op" id="3727824">=</span>&nbsp;<span class="num" id="3727826">25</span><br>
<span class="lineno"></span><span class="op" id="3727829">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="comment" id="3727832">//&nbsp;TLS&nbsp;Elliptic&nbsp;Curve&nbsp;Point&nbsp;Formats</span><br>
<span class="lineno"></span><span class="comment" id="3727868">//&nbsp;http://www.iana.org/assignments/tls-parameters/tls-parameters.xml#tls-parameters-9</span><br>
<span class="lineno"></span><span class="keyword" id="3727954">const</span>&nbsp;<span class="op" id="3727960">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3727963">pointFormatUncompressed</span>&nbsp;<span class="builtintype" id="3727987">uint8</span>&nbsp;<span class="op" id="3727993">=</span>&nbsp;<span class="num" id="3727995">0</span><br>
<span class="lineno">100</span><span class="op" id="3727997">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3728000">//&nbsp;TLS&nbsp;CertificateStatusType&nbsp;(RFC&nbsp;3546)</span><br>
<span class="lineno"></span><span class="keyword" id="3728040">const</span>&nbsp;<span class="op" id="3728046">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3728049">statusTypeOCSP</span>&nbsp;<span class="builtintype" id="3728064">uint8</span>&nbsp;<span class="op" id="3728070">=</span>&nbsp;<span class="num" id="3728072">1</span><br>
<span class="lineno">105</span><span class="op" id="3728074">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3728077">//&nbsp;Certificate&nbsp;types&nbsp;(for&nbsp;certificateRequestMsg)</span><br>
<span class="lineno"></span><span class="keyword" id="3728126">const</span>&nbsp;<span class="op" id="3728132">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3728135">certTypeRSASign</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3728154">=</span>&nbsp;<span class="num" id="3728156">1</span>&nbsp;<span class="comment" id="3728158">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;RSA&nbsp;key</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3728198">certTypeDSSSign</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3728217">=</span>&nbsp;<span class="num" id="3728219">2</span>&nbsp;<span class="comment" id="3728221">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;DSA&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3728260">certTypeRSAFixedDH</span>&nbsp;<span class="op" id="3728279">=</span>&nbsp;<span class="num" id="3728281">3</span>&nbsp;<span class="comment" id="3728283">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;static&nbsp;DH&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3728328">certTypeDSSFixedDH</span>&nbsp;<span class="op" id="3728347">=</span>&nbsp;<span class="num" id="3728349">4</span>&nbsp;<span class="comment" id="3728351">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;static&nbsp;DH&nbsp;key</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3728397">//&nbsp;See&nbsp;RFC4492&nbsp;sections&nbsp;3&nbsp;and&nbsp;5.5.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3728433">certTypeECDSASign</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3728456">=</span>&nbsp;<span class="num" id="3728458">64</span>&nbsp;<span class="comment" id="3728461">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDSA-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;ECDSA.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3728538">certTypeRSAFixedECDH</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3728561">=</span>&nbsp;<span class="num" id="3728563">65</span>&nbsp;<span class="comment" id="3728566">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDH-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;RSA.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3728640">certTypeECDSAFixedECDH</span>&nbsp;<span class="op" id="3728663">=</span>&nbsp;<span class="num" id="3728665">66</span>&nbsp;<span class="comment" id="3728668">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDH-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;ECDSA.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3728745">//&nbsp;Rest&nbsp;of&nbsp;these&nbsp;are&nbsp;reserved&nbsp;by&nbsp;the&nbsp;TLS&nbsp;spec</span><br>
<span class="lineno">120</span><span class="op" id="3728791">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3728794">//&nbsp;Hash&nbsp;functions&nbsp;for&nbsp;TLS&nbsp;1.2&nbsp;(See&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1)</span><br>
<span class="lineno"></span><span class="keyword" id="3728854">const</span>&nbsp;<span class="op" id="3728860">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3728863">hashSHA1</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3728874">uint8</span>&nbsp;<span class="op" id="3728880">=</span>&nbsp;<span class="num" id="3728882">2</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3728885">hashSHA256</span>&nbsp;<span class="builtintype" id="3728896">uint8</span>&nbsp;<span class="op" id="3728902">=</span>&nbsp;<span class="num" id="3728904">4</span><br>
<span class="lineno"></span><span class="op" id="3728906">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3728909">//&nbsp;Signature&nbsp;algorithms&nbsp;for&nbsp;TLS&nbsp;1.2&nbsp;(See&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1)</span><br>
<span class="lineno"></span><span class="keyword" id="3728975">const</span>&nbsp;<span class="op" id="3728981">(</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3728984">signatureRSA</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3728999">uint8</span>&nbsp;<span class="op" id="3729005">=</span>&nbsp;<span class="num" id="3729007">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3729010">signatureECDSA</span>&nbsp;<span class="builtintype" id="3729025">uint8</span>&nbsp;<span class="op" id="3729031">=</span>&nbsp;<span class="num" id="3729033">3</span><br>
<span class="lineno"></span><span class="op" id="3729035">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3729038">//&nbsp;signatureAndHash&nbsp;mirrors&nbsp;the&nbsp;TLS&nbsp;1.2,&nbsp;SignatureAndHashAlgorithm&nbsp;struct.&nbsp;See</span><br>
<span class="lineno">135</span><span class="comment" id="3729117">//&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1.</span><br>
<span class="lineno"></span><span class="keyword" id="3729145">type</span>&nbsp;<span class="ident" id="3729150">signatureAndHash</span>&nbsp;<span class="keyword" id="3729167">struct</span>&nbsp;<span class="op" id="3729174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3729177">hash</span><span class="op" id="3729181">,</span>&nbsp;<span class="ident" id="3729183">signature</span>&nbsp;<span class="builtintype" id="3729193">uint8</span><br>
<span class="lineno"></span><span class="op" id="3729199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="3729202">//&nbsp;supportedSKXSignatureAlgorithms&nbsp;contains&nbsp;the&nbsp;signature&nbsp;and&nbsp;hash&nbsp;algorithms</span><br>
<span class="lineno"></span><span class="comment" id="3729280">//&nbsp;that&nbsp;the&nbsp;code&nbsp;advertises&nbsp;as&nbsp;supported&nbsp;in&nbsp;a&nbsp;TLS&nbsp;1.2&nbsp;ClientHello.</span><br>
<span class="lineno"></span><span class="keyword" id="3729347">var</span>&nbsp;<span class="ident" id="3729351">supportedSKXSignatureAlgorithms</span>&nbsp;<span class="op" id="3729383">=</span>&nbsp;<span class="op" id="3729385">[</span><span class="op" id="3729386">]</span><span class="ident" id="3729387">signatureAndHash</span><span class="op" id="3729403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3729406">{</span><span class="ident" id="3729407">hashSHA256</span><span class="op" id="3729417">,</span>&nbsp;<span class="ident" id="3729419">signatureRSA</span><span class="op" id="3729431">}</span><span class="op" id="3729432">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3729435">{</span><span class="ident" id="3729436">hashSHA256</span><span class="op" id="3729446">,</span>&nbsp;<span class="ident" id="3729448">signatureECDSA</span><span class="op" id="3729462">}</span><span class="op" id="3729463">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3729466">{</span><span class="ident" id="3729467">hashSHA1</span><span class="op" id="3729475">,</span>&nbsp;<span class="ident" id="3729477">signatureRSA</span><span class="op" id="3729489">}</span><span class="op" id="3729490">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3729493">{</span><span class="ident" id="3729494">hashSHA1</span><span class="op" id="3729502">,</span>&nbsp;<span class="ident" id="3729504">signatureECDSA</span><span class="op" id="3729518">}</span><span class="op" id="3729519">,</span><br>
<span class="lineno"></span><span class="op" id="3729521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3729524">//&nbsp;supportedClientCertSignatureAlgorithms&nbsp;contains&nbsp;the&nbsp;signature&nbsp;and&nbsp;hash</span><br>
<span class="lineno">150</span><span class="comment" id="3729598">//&nbsp;algorithms&nbsp;that&nbsp;the&nbsp;code&nbsp;advertises&nbsp;as&nbsp;supported&nbsp;in&nbsp;a&nbsp;TLS&nbsp;1.2</span><br>
<span class="lineno"></span><span class="comment" id="3729663">//&nbsp;CertificateRequest.</span><br>
<span class="lineno"></span><span class="keyword" id="3729686">var</span>&nbsp;<span class="ident" id="3729690">supportedClientCertSignatureAlgorithms</span>&nbsp;<span class="op" id="3729729">=</span>&nbsp;<span class="op" id="3729731">[</span><span class="op" id="3729732">]</span><span class="ident" id="3729733">signatureAndHash</span><span class="op" id="3729749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3729752">{</span><span class="ident" id="3729753">hashSHA256</span><span class="op" id="3729763">,</span>&nbsp;<span class="ident" id="3729765">signatureRSA</span><span class="op" id="3729777">}</span><span class="op" id="3729778">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3729781">{</span><span class="ident" id="3729782">hashSHA256</span><span class="op" id="3729792">,</span>&nbsp;<span class="ident" id="3729794">signatureECDSA</span><span class="op" id="3729808">}</span><span class="op" id="3729809">,</span><br>
<span class="lineno">155</span><span class="op" id="3729811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3729814">//&nbsp;ConnectionState&nbsp;records&nbsp;basic&nbsp;TLS&nbsp;details&nbsp;about&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3729881">type</span>&nbsp;<span class="ident" id="3729886">ConnectionState</span>&nbsp;<span class="keyword" id="3729902">struct</span>&nbsp;<span class="op" id="3729909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3729912">Version</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3729939">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3729961">//&nbsp;TLS&nbsp;version&nbsp;used&nbsp;by&nbsp;the&nbsp;connection&nbsp;(e.g.&nbsp;VersionTLS12)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3730020">HandshakeComplete</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3730047">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3730069">//&nbsp;TLS&nbsp;handshake&nbsp;is&nbsp;complete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3730099">DidResume</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3730126">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3730148">//&nbsp;connection&nbsp;resumes&nbsp;a&nbsp;previous&nbsp;TLS&nbsp;connection</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3730197">CipherSuite</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3730224">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3730246">//&nbsp;cipher&nbsp;suite&nbsp;in&nbsp;use&nbsp;(TLS_RSA_WITH_RC4_128_SHA,&nbsp;...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3730302">NegotiatedProtocol</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3730329">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3730351">//&nbsp;negotiated&nbsp;next&nbsp;protocol&nbsp;(from&nbsp;Config.NextProtos)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3730405">NegotiatedProtocolIsMutual</span>&nbsp;<span class="builtintype" id="3730432">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3730454">//&nbsp;negotiated&nbsp;protocol&nbsp;was&nbsp;advertised&nbsp;by&nbsp;server</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3730503">ServerName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3730530">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3730552">//&nbsp;server&nbsp;name&nbsp;requested&nbsp;by&nbsp;client,&nbsp;if&nbsp;any&nbsp;(server&nbsp;side&nbsp;only)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3730615">PeerCertificates</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3730642">[</span><span class="op" id="3730643">]</span><span class="op" id="3730644">*</span><span class="ident" id="3730645">x509</span><span class="op" id="3730649">.</span><span class="ident" id="3730650">Certificate</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3730664">//&nbsp;certificate&nbsp;chain&nbsp;presented&nbsp;by&nbsp;remote&nbsp;peer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3730711">VerifiedChains</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3730738">[</span><span class="op" id="3730739">]</span><span class="op" id="3730740">[</span><span class="op" id="3730741">]</span><span class="op" id="3730742">*</span><span class="ident" id="3730743">x509</span><span class="op" id="3730747">.</span><span class="ident" id="3730748">Certificate</span>&nbsp;<span class="comment" id="3730760">//&nbsp;verified&nbsp;chains&nbsp;built&nbsp;from&nbsp;PeerCertificates</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3730809">//&nbsp;TLSUnique&nbsp;contains&nbsp;the&nbsp;&#34;tls-unique&#34;&nbsp;channel&nbsp;binding&nbsp;value&nbsp;(see&nbsp;RFC</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3730880">//&nbsp;5929,&nbsp;section&nbsp;3).&nbsp;For&nbsp;resumed&nbsp;sessions&nbsp;this&nbsp;value&nbsp;will&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3730946">//&nbsp;because&nbsp;resumption&nbsp;does&nbsp;not&nbsp;include&nbsp;enough&nbsp;context&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3731006">//&nbsp;https://secure-resumption.com/#channelbindings).&nbsp;This&nbsp;will&nbsp;change&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3731079">//&nbsp;future&nbsp;versions&nbsp;of&nbsp;Go&nbsp;once&nbsp;the&nbsp;TLS&nbsp;master-secret&nbsp;fix&nbsp;has&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3731145">//&nbsp;standardized&nbsp;and&nbsp;implemented.</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3731179">TLSUnique</span>&nbsp;<span class="op" id="3731189">[</span><span class="op" id="3731190">]</span><span class="builtintype" id="3731191">byte</span><br>
<span class="lineno"></span><span class="op" id="3731196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3731199">//&nbsp;ClientAuthType&nbsp;declares&nbsp;the&nbsp;policy&nbsp;the&nbsp;server&nbsp;will&nbsp;follow&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3731264">//&nbsp;TLS&nbsp;Client&nbsp;Authentication.</span><br>
<span class="lineno">180</span><span class="keyword" id="3731294">type</span>&nbsp;<span class="ident" id="3731299">ClientAuthType</span>&nbsp;<span class="builtintype" id="3731314">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3731319">const</span>&nbsp;<span class="op" id="3731325">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3731328">NoClientCert</span>&nbsp;<span class="ident" id="3731341">ClientAuthType</span>&nbsp;<span class="op" id="3731356">=</span>&nbsp;<span class="ident" id="3731358">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3731364">RequestClientCert</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3731383">RequireAnyClientCert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3731405">VerifyClientCertIfGiven</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3731430">RequireAndVerifyClientCert</span><br>
<span class="lineno"></span><span class="op" id="3731457">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="3731460">//&nbsp;ClientSessionState&nbsp;contains&nbsp;the&nbsp;state&nbsp;needed&nbsp;by&nbsp;clients&nbsp;to&nbsp;resume&nbsp;TLS</span><br>
<span class="lineno"></span><span class="comment" id="3731533">//&nbsp;sessions.</span><br>
<span class="lineno"></span><span class="keyword" id="3731546">type</span>&nbsp;<span class="ident" id="3731551">ClientSessionState</span>&nbsp;<span class="keyword" id="3731570">struct</span>&nbsp;<span class="op" id="3731577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3731580">sessionTicket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3731599">[</span><span class="op" id="3731600">]</span><span class="builtintype" id="3731601">uint8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3731619">//&nbsp;Encrypted&nbsp;ticket&nbsp;used&nbsp;for&nbsp;session&nbsp;resumption&nbsp;with&nbsp;server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3731680">vers</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3731699">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3731719">//&nbsp;SSL/TLS&nbsp;version&nbsp;negotiated&nbsp;for&nbsp;the&nbsp;session</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3731766">cipherSuite</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3731785">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3731805">//&nbsp;Ciphersuite&nbsp;negotiated&nbsp;for&nbsp;the&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3731848">masterSecret</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3731867">[</span><span class="op" id="3731868">]</span><span class="builtintype" id="3731869">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3731887">//&nbsp;MasterSecret&nbsp;generated&nbsp;by&nbsp;client&nbsp;on&nbsp;a&nbsp;full&nbsp;handshake</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3731944">serverCertificates</span>&nbsp;<span class="op" id="3731963">[</span><span class="op" id="3731964">]</span><span class="op" id="3731965">*</span><span class="ident" id="3731966">x509</span><span class="op" id="3731970">.</span><span class="ident" id="3731971">Certificate</span>&nbsp;<span class="comment" id="3731983">//&nbsp;Certificate&nbsp;chain&nbsp;presented&nbsp;by&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span><span class="op" id="3732028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="3732031">//&nbsp;ClientSessionCache&nbsp;is&nbsp;a&nbsp;cache&nbsp;of&nbsp;ClientSessionState&nbsp;objects&nbsp;that&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="3732111">//&nbsp;by&nbsp;a&nbsp;client&nbsp;to&nbsp;resume&nbsp;a&nbsp;TLS&nbsp;session&nbsp;with&nbsp;a&nbsp;given&nbsp;server.&nbsp;ClientSessionCache</span><br>
<span class="lineno"></span><span class="comment" id="3732190">//&nbsp;implementations&nbsp;should&nbsp;expect&nbsp;to&nbsp;be&nbsp;called&nbsp;concurrently&nbsp;from&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="3732264">//&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="3732279">type</span>&nbsp;<span class="ident" id="3732284">ClientSessionCache</span>&nbsp;<span class="keyword" id="3732303">interface</span>&nbsp;<span class="op" id="3732313">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3732316">//&nbsp;Get&nbsp;searches&nbsp;for&nbsp;a&nbsp;ClientSessionState&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3732389">//&nbsp;On&nbsp;return,&nbsp;ok&nbsp;is&nbsp;true&nbsp;if&nbsp;one&nbsp;was&nbsp;found.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3732433">Get</span><span class="op" id="3732436">(</span><span class="ident" id="3732437">sessionKey</span>&nbsp;<span class="builtintype" id="3732448">string</span><span class="op" id="3732454">)</span>&nbsp;<span class="op" id="3732456">(</span><span class="ident" id="3732457">session</span>&nbsp;<span class="op" id="3732465">*</span><span class="ident" id="3732466">ClientSessionState</span><span class="op" id="3732484">,</span>&nbsp;<span class="ident" id="3732486">ok</span>&nbsp;<span class="builtintype" id="3732489">bool</span><span class="op" id="3732493">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3732497">//&nbsp;Put&nbsp;adds&nbsp;the&nbsp;ClientSessionState&nbsp;to&nbsp;the&nbsp;cache&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3732566">Put</span><span class="op" id="3732569">(</span><span class="ident" id="3732570">sessionKey</span>&nbsp;<span class="builtintype" id="3732581">string</span><span class="op" id="3732587">,</span>&nbsp;<span class="ident" id="3732589">cs</span>&nbsp;<span class="op" id="3732592">*</span><span class="ident" id="3732593">ClientSessionState</span><span class="op" id="3732611">)</span><br>
<span class="lineno"></span><span class="op" id="3732613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3732616">//&nbsp;ClientHelloInfo&nbsp;contains&nbsp;information&nbsp;from&nbsp;a&nbsp;ClientHello&nbsp;message&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3732695">//&nbsp;guide&nbsp;certificate&nbsp;selection&nbsp;in&nbsp;the&nbsp;GetCertificate&nbsp;callback.</span><br>
<span class="lineno">215</span><span class="keyword" id="3732758">type</span>&nbsp;<span class="ident" id="3732763">ClientHelloInfo</span>&nbsp;<span class="keyword" id="3732779">struct</span>&nbsp;<span class="op" id="3732786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3732789">//&nbsp;CipherSuites&nbsp;lists&nbsp;the&nbsp;CipherSuites&nbsp;supported&nbsp;by&nbsp;the&nbsp;client&nbsp;(e.g.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3732859">//&nbsp;TLS_RSA_WITH_RC4_128_SHA).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3732890">CipherSuites</span>&nbsp;<span class="op" id="3732903">[</span><span class="op" id="3732904">]</span><span class="builtintype" id="3732905">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3732914">//&nbsp;ServerName&nbsp;indicates&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;server&nbsp;requested&nbsp;by&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3732986">//&nbsp;in&nbsp;order&nbsp;to&nbsp;support&nbsp;virtual&nbsp;hosting.&nbsp;ServerName&nbsp;is&nbsp;only&nbsp;set&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3733057">//&nbsp;client&nbsp;is&nbsp;using&nbsp;SNI&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3733086">//&nbsp;http://tools.ietf.org/html/rfc4366#section-3.1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3733139">ServerName</span>&nbsp;<span class="builtintype" id="3733150">string</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3733159">//&nbsp;SupportedCurves&nbsp;lists&nbsp;the&nbsp;elliptic&nbsp;curves&nbsp;supported&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3733230">//&nbsp;SupportedCurves&nbsp;is&nbsp;set&nbsp;only&nbsp;if&nbsp;the&nbsp;Supported&nbsp;Elliptic&nbsp;Curves</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3733295">//&nbsp;Extension&nbsp;is&nbsp;being&nbsp;used&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3733328">//&nbsp;http://tools.ietf.org/html/rfc4492#section-5.1.1).</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3733383">SupportedCurves</span>&nbsp;<span class="op" id="3733399">[</span><span class="op" id="3733400">]</span><span class="ident" id="3733401">CurveID</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3733411">//&nbsp;SupportedPoints&nbsp;lists&nbsp;the&nbsp;point&nbsp;formats&nbsp;supported&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3733480">//&nbsp;SupportedPoints&nbsp;is&nbsp;set&nbsp;only&nbsp;if&nbsp;the&nbsp;Supported&nbsp;Point&nbsp;Formats&nbsp;Extension</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3733553">//&nbsp;is&nbsp;being&nbsp;used&nbsp;(see</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3733576">//&nbsp;http://tools.ietf.org/html/rfc4492#section-5.1.2).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3733631">SupportedPoints</span>&nbsp;<span class="op" id="3733647">[</span><span class="op" id="3733648">]</span><span class="builtintype" id="3733649">uint8</span><br>
<span class="lineno"></span><span class="op" id="3733655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3733658">//&nbsp;A&nbsp;Config&nbsp;structure&nbsp;is&nbsp;used&nbsp;to&nbsp;configure&nbsp;a&nbsp;TLS&nbsp;client&nbsp;or&nbsp;server.</span><br>
<span class="lineno">240</span><span class="comment" id="3733725">//&nbsp;After&nbsp;one&nbsp;has&nbsp;been&nbsp;passed&nbsp;to&nbsp;a&nbsp;TLS&nbsp;function&nbsp;it&nbsp;must&nbsp;not&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="3733787">//&nbsp;modified.&nbsp;A&nbsp;Config&nbsp;may&nbsp;be&nbsp;reused;&nbsp;the&nbsp;tls&nbsp;package&nbsp;will&nbsp;also&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3733854">//&nbsp;modify&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3733868">type</span>&nbsp;<span class="ident" id="3733873">Config</span>&nbsp;<span class="keyword" id="3733880">struct</span>&nbsp;<span class="op" id="3733887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3733890">//&nbsp;Rand&nbsp;provides&nbsp;the&nbsp;source&nbsp;of&nbsp;entropy&nbsp;for&nbsp;nonces&nbsp;and&nbsp;RSA&nbsp;blinding.</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3733959">//&nbsp;If&nbsp;Rand&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;the&nbsp;cryptographic&nbsp;random&nbsp;reader&nbsp;in&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3734031">//&nbsp;crypto/rand.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3734048">//&nbsp;The&nbsp;Reader&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3734108">Rand</span>&nbsp;<span class="ident" id="3734113">io</span><span class="op" id="3734115">.</span><span class="ident" id="3734116">Reader</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3734125">//&nbsp;Time&nbsp;returns&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;the&nbsp;number&nbsp;of&nbsp;seconds&nbsp;since&nbsp;the&nbsp;epoch.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3734201">//&nbsp;If&nbsp;Time&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;time.Now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3734240">Time</span>&nbsp;<span class="keyword" id="3734245">func</span><span class="op" id="3734249">(</span><span class="op" id="3734250">)</span>&nbsp;<span class="ident" id="3734252">time</span><span class="op" id="3734256">.</span><span class="ident" id="3734257">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3734264">//&nbsp;Certificates&nbsp;contains&nbsp;one&nbsp;or&nbsp;more&nbsp;certificate&nbsp;chains</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3734321">//&nbsp;to&nbsp;present&nbsp;to&nbsp;the&nbsp;other&nbsp;side&nbsp;of&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3734373">//&nbsp;Server&nbsp;configurations&nbsp;must&nbsp;include&nbsp;at&nbsp;least&nbsp;one&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3734438">Certificates</span>&nbsp;<span class="op" id="3734451">[</span><span class="op" id="3734452">]</span><span class="ident" id="3734453">Certificate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3734467">//&nbsp;NameToCertificate&nbsp;maps&nbsp;from&nbsp;a&nbsp;certificate&nbsp;name&nbsp;to&nbsp;an&nbsp;element&nbsp;of</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3734535">//&nbsp;Certificates.&nbsp;Note&nbsp;that&nbsp;a&nbsp;certificate&nbsp;name&nbsp;can&nbsp;be&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3734601">//&nbsp;&#39;*.example.com&#39;&nbsp;and&nbsp;so&nbsp;doesn&#39;t&nbsp;have&nbsp;to&nbsp;be&nbsp;a&nbsp;domain&nbsp;name&nbsp;as&nbsp;such.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3734670">//&nbsp;See&nbsp;Config.BuildNameToCertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3734708">//&nbsp;The&nbsp;nil&nbsp;value&nbsp;causes&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Certificates&nbsp;to&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3734778">//&nbsp;for&nbsp;all&nbsp;connections.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3734803">NameToCertificate</span>&nbsp;<span class="keyword" id="3734821">map</span><span class="op" id="3734824">[</span><span class="builtintype" id="3734825">string</span><span class="op" id="3734831">]</span><span class="op" id="3734832">*</span><span class="ident" id="3734833">Certificate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3734847">//&nbsp;GetCertificate&nbsp;returns&nbsp;a&nbsp;Certificate&nbsp;based&nbsp;on&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3734907">//&nbsp;ClientHelloInfo.&nbsp;If&nbsp;GetCertificate&nbsp;is&nbsp;nil&nbsp;or&nbsp;returns&nbsp;nil,&nbsp;then&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3734978">//&nbsp;certificate&nbsp;is&nbsp;retrieved&nbsp;from&nbsp;NameToCertificate.&nbsp;If</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3735034">//&nbsp;NameToCertificate&nbsp;is&nbsp;nil,&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Certificates&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3735106">//&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3735116">GetCertificate</span>&nbsp;<span class="keyword" id="3735131">func</span><span class="op" id="3735135">(</span><span class="ident" id="3735136">clientHello</span>&nbsp;<span class="op" id="3735148">*</span><span class="ident" id="3735149">ClientHelloInfo</span><span class="op" id="3735164">)</span>&nbsp;<span class="op" id="3735166">(</span><span class="op" id="3735167">*</span><span class="ident" id="3735168">Certificate</span><span class="op" id="3735179">,</span>&nbsp;<span class="builtintype" id="3735181">error</span><span class="op" id="3735186">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3735190">//&nbsp;RootCAs&nbsp;defines&nbsp;the&nbsp;set&nbsp;of&nbsp;root&nbsp;certificate&nbsp;authorities</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3735250">//&nbsp;that&nbsp;clients&nbsp;use&nbsp;when&nbsp;verifying&nbsp;server&nbsp;certificates.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3735307">//&nbsp;If&nbsp;RootCAs&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;the&nbsp;host&#39;s&nbsp;root&nbsp;CA&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3735363">RootCAs</span>&nbsp;<span class="op" id="3735371">*</span><span class="ident" id="3735372">x509</span><span class="op" id="3735376">.</span><span class="ident" id="3735377">CertPool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3735388">//&nbsp;NextProtos&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;supported,&nbsp;application&nbsp;level&nbsp;protocols.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3735456">NextProtos</span>&nbsp;<span class="op" id="3735467">[</span><span class="op" id="3735468">]</span><span class="builtintype" id="3735469">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3735478">//&nbsp;ServerName&nbsp;is&nbsp;used&nbsp;to&nbsp;verify&nbsp;the&nbsp;hostname&nbsp;on&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3735540">//&nbsp;certificates&nbsp;unless&nbsp;InsecureSkipVerify&nbsp;is&nbsp;given.&nbsp;It&nbsp;is&nbsp;also&nbsp;included</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3735613">//&nbsp;in&nbsp;the&nbsp;client&#39;s&nbsp;handshake&nbsp;to&nbsp;support&nbsp;virtual&nbsp;hosting.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3735671">ServerName</span>&nbsp;<span class="builtintype" id="3735682">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3735691">//&nbsp;ClientAuth&nbsp;determines&nbsp;the&nbsp;server&#39;s&nbsp;policy&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3735741">//&nbsp;TLS&nbsp;Client&nbsp;Authentication.&nbsp;The&nbsp;default&nbsp;is&nbsp;NoClientCert.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3735801">ClientAuth</span>&nbsp;<span class="ident" id="3735812">ClientAuthType</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3735829">//&nbsp;ClientCAs&nbsp;defines&nbsp;the&nbsp;set&nbsp;of&nbsp;root&nbsp;certificate&nbsp;authorities</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3735891">//&nbsp;that&nbsp;servers&nbsp;use&nbsp;if&nbsp;required&nbsp;to&nbsp;verify&nbsp;a&nbsp;client&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3735955">//&nbsp;by&nbsp;the&nbsp;policy&nbsp;in&nbsp;ClientAuth.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3735988">ClientCAs</span>&nbsp;<span class="op" id="3735998">*</span><span class="ident" id="3735999">x509</span><span class="op" id="3736003">.</span><span class="ident" id="3736004">CertPool</span><br>
<span class="lineno">295</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3736015">//&nbsp;InsecureSkipVerify&nbsp;controls&nbsp;whether&nbsp;a&nbsp;client&nbsp;verifies&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3736077">//&nbsp;server&#39;s&nbsp;certificate&nbsp;chain&nbsp;and&nbsp;host&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3736123">//&nbsp;If&nbsp;InsecureSkipVerify&nbsp;is&nbsp;true,&nbsp;TLS&nbsp;accepts&nbsp;any&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3736186">//&nbsp;presented&nbsp;by&nbsp;the&nbsp;server&nbsp;and&nbsp;any&nbsp;host&nbsp;name&nbsp;in&nbsp;that&nbsp;certificate.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3736253">//&nbsp;In&nbsp;this&nbsp;mode,&nbsp;TLS&nbsp;is&nbsp;susceptible&nbsp;to&nbsp;man-in-the-middle&nbsp;attacks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3736320">//&nbsp;This&nbsp;should&nbsp;be&nbsp;used&nbsp;only&nbsp;for&nbsp;testing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3736362">InsecureSkipVerify</span>&nbsp;<span class="builtintype" id="3736381">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3736388">//&nbsp;CipherSuites&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;supported&nbsp;cipher&nbsp;suites.&nbsp;If&nbsp;CipherSuites</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3736459">//&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;a&nbsp;list&nbsp;of&nbsp;suites&nbsp;supported&nbsp;by&nbsp;the&nbsp;implementation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3736530">CipherSuites</span>&nbsp;<span class="op" id="3736543">[</span><span class="op" id="3736544">]</span><span class="builtintype" id="3736545">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3736554">//&nbsp;PreferServerCipherSuites&nbsp;controls&nbsp;whether&nbsp;the&nbsp;server&nbsp;selects&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3736623">//&nbsp;client&#39;s&nbsp;most&nbsp;preferred&nbsp;ciphersuite,&nbsp;or&nbsp;the&nbsp;server&#39;s&nbsp;most&nbsp;preferred</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3736695">//&nbsp;ciphersuite.&nbsp;If&nbsp;true&nbsp;then&nbsp;the&nbsp;server&#39;s&nbsp;preference,&nbsp;as&nbsp;expressed&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3736766">//&nbsp;the&nbsp;order&nbsp;of&nbsp;elements&nbsp;in&nbsp;CipherSuites,&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3736818">PreferServerCipherSuites</span>&nbsp;<span class="builtintype" id="3736843">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3736850">//&nbsp;SessionTicketsDisabled&nbsp;may&nbsp;be&nbsp;set&nbsp;to&nbsp;true&nbsp;to&nbsp;disable&nbsp;session&nbsp;ticket</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3736922">//&nbsp;(resumption)&nbsp;support.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3736948">SessionTicketsDisabled</span>&nbsp;<span class="builtintype" id="3736971">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3736978">//&nbsp;SessionTicketKey&nbsp;is&nbsp;used&nbsp;by&nbsp;TLS&nbsp;servers&nbsp;to&nbsp;provide&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3737041">//&nbsp;resumption.&nbsp;See&nbsp;RFC&nbsp;5077.&nbsp;If&nbsp;zero,&nbsp;it&nbsp;will&nbsp;be&nbsp;filled&nbsp;with</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3737103">//&nbsp;random&nbsp;data&nbsp;before&nbsp;the&nbsp;first&nbsp;server&nbsp;handshake.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3737154">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3737158">//&nbsp;If&nbsp;multiple&nbsp;servers&nbsp;are&nbsp;terminating&nbsp;connections&nbsp;for&nbsp;the&nbsp;same&nbsp;host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3737228">//&nbsp;they&nbsp;should&nbsp;all&nbsp;have&nbsp;the&nbsp;same&nbsp;SessionTicketKey.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3737287">//&nbsp;SessionTicketKey&nbsp;leaks,&nbsp;previously&nbsp;recorded&nbsp;and&nbsp;future&nbsp;TLS</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3737350">//&nbsp;connections&nbsp;using&nbsp;that&nbsp;key&nbsp;are&nbsp;compromised.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3737398">SessionTicketKey</span>&nbsp;<span class="op" id="3737415">[</span><span class="num" id="3737416">32</span><span class="op" id="3737418">]</span><span class="builtintype" id="3737419">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3737426">//&nbsp;SessionCache&nbsp;is&nbsp;a&nbsp;cache&nbsp;of&nbsp;ClientSessionState&nbsp;entries&nbsp;for&nbsp;TLS&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3737500">//&nbsp;resumption.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3737516">ClientSessionCache</span>&nbsp;<span class="ident" id="3737535">ClientSessionCache</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3737556">//&nbsp;MinVersion&nbsp;contains&nbsp;the&nbsp;minimum&nbsp;SSL/TLS&nbsp;version&nbsp;that&nbsp;is&nbsp;acceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3737628">//&nbsp;If&nbsp;zero,&nbsp;then&nbsp;SSLv3&nbsp;is&nbsp;taken&nbsp;as&nbsp;the&nbsp;minimum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3737677">MinVersion</span>&nbsp;<span class="builtintype" id="3737688">uint16</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3737697">//&nbsp;MaxVersion&nbsp;contains&nbsp;the&nbsp;maximum&nbsp;SSL/TLS&nbsp;version&nbsp;that&nbsp;is&nbsp;acceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3737769">//&nbsp;If&nbsp;zero,&nbsp;then&nbsp;the&nbsp;maximum&nbsp;version&nbsp;supported&nbsp;by&nbsp;this&nbsp;package&nbsp;is&nbsp;used,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3737842">//&nbsp;which&nbsp;is&nbsp;currently&nbsp;TLS&nbsp;1.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3737874">MaxVersion</span>&nbsp;<span class="builtintype" id="3737885">uint16</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3737894">//&nbsp;CurvePreferences&nbsp;contains&nbsp;the&nbsp;elliptic&nbsp;curves&nbsp;that&nbsp;will&nbsp;be&nbsp;used&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3737965">//&nbsp;an&nbsp;ECDHE&nbsp;handshake,&nbsp;in&nbsp;preference&nbsp;order.&nbsp;If&nbsp;empty,&nbsp;the&nbsp;default&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3738037">//&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3738050">CurvePreferences</span>&nbsp;<span class="op" id="3738067">[</span><span class="op" id="3738068">]</span><span class="ident" id="3738069">CurveID</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3738079">serverInitOnce</span>&nbsp;<span class="ident" id="3738094">sync</span><span class="op" id="3738098">.</span><span class="ident" id="3738099">Once</span>&nbsp;<span class="comment" id="3738104">//&nbsp;guards&nbsp;calling&nbsp;(*Config).serverInit</span><br>
<span class="lineno"></span><span class="op" id="3738143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3738146">func</span>&nbsp;<span class="op" id="3738151">(</span><span class="ident" id="3738152">c</span>&nbsp;<span class="op" id="3738154">*</span><span class="ident" id="3738155">Config</span><span class="op" id="3738161">)</span>&nbsp;<span class="ident" id="3738163">serverInit</span><span class="op" id="3738173">(</span><span class="op" id="3738174">)</span>&nbsp;<span class="op" id="3738176">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3738179">if</span>&nbsp;<span class="ident" id="3738182">c</span><span class="op" id="3738183">.</span><span class="ident" id="3738184">SessionTicketsDisabled</span>&nbsp;<span class="op" id="3738207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3738211">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3738219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3738223">//&nbsp;If&nbsp;the&nbsp;key&nbsp;has&nbsp;already&nbsp;been&nbsp;set&nbsp;then&nbsp;we&nbsp;have&nbsp;nothing&nbsp;to&nbsp;do.</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3738287">for</span>&nbsp;<span class="ident" id="3738291">_</span><span class="op" id="3738292">,</span>&nbsp;<span class="ident" id="3738294">b</span>&nbsp;<span class="op" id="3738296">:=</span>&nbsp;<span class="keyword" id="3738299">range</span>&nbsp;<span class="ident" id="3738305">c</span><span class="op" id="3738306">.</span><span class="ident" id="3738307">SessionTicketKey</span>&nbsp;<span class="op" id="3738324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3738328">if</span>&nbsp;<span class="ident" id="3738331">b</span>&nbsp;<span class="op" id="3738333">!=</span>&nbsp;<span class="num" id="3738336">0</span>&nbsp;<span class="op" id="3738338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3738343">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3738352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3738355">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3738359">if</span>&nbsp;<span class="ident" id="3738362">_</span><span class="op" id="3738363">,</span>&nbsp;<span class="ident" id="3738365">err</span>&nbsp;<span class="op" id="3738369">:=</span>&nbsp;<span class="ident" id="3738372">io</span><span class="op" id="3738374">.</span><span class="ident" id="3738375">ReadFull</span><span class="op" id="3738383">(</span><span class="ident" id="3738384">c</span><span class="op" id="3738385">.</span><span class="ident" id="3738386">rand</span><span class="op" id="3738390">(</span><span class="op" id="3738391">)</span><span class="op" id="3738392">,</span>&nbsp;<span class="ident" id="3738394">c</span><span class="op" id="3738395">.</span><span class="ident" id="3738396">SessionTicketKey</span><span class="op" id="3738412">[</span><span class="op" id="3738413">:</span><span class="op" id="3738414">]</span><span class="op" id="3738415">)</span><span class="op" id="3738416">;</span>&nbsp;<span class="ident" id="3738418">err</span>&nbsp;<span class="op" id="3738422">!=</span>&nbsp;<span class="builtintype" id="3738425">nil</span>&nbsp;<span class="op" id="3738429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3738433">c</span><span class="op" id="3738434">.</span><span class="ident" id="3738435">SessionTicketsDisabled</span>&nbsp;<span class="op" id="3738458">=</span>&nbsp;<span class="builtintype" id="3738460">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3738466">}</span><br>
<span class="lineno"></span><span class="op" id="3738468">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="3738471">func</span>&nbsp;<span class="op" id="3738476">(</span><span class="ident" id="3738477">c</span>&nbsp;<span class="op" id="3738479">*</span><span class="ident" id="3738480">Config</span><span class="op" id="3738486">)</span>&nbsp;<span class="ident" id="3738488">rand</span><span class="op" id="3738492">(</span><span class="op" id="3738493">)</span>&nbsp;<span class="ident" id="3738495">io</span><span class="op" id="3738497">.</span><span class="ident" id="3738498">Reader</span>&nbsp;<span class="op" id="3738505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3738508">r</span>&nbsp;<span class="op" id="3738510">:=</span>&nbsp;<span class="ident" id="3738513">c</span><span class="op" id="3738514">.</span><span class="ident" id="3738515">Rand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3738521">if</span>&nbsp;<span class="ident" id="3738524">r</span>&nbsp;<span class="op" id="3738526">==</span>&nbsp;<span class="builtintype" id="3738529">nil</span>&nbsp;<span class="op" id="3738533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3738537">return</span>&nbsp;<span class="ident" id="3738544">rand</span><span class="op" id="3738548">.</span><span class="ident" id="3738549">Reader</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3738557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3738560">return</span>&nbsp;<span class="ident" id="3738567">r</span><br>
<span class="lineno"></span><span class="op" id="3738569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3738572">func</span>&nbsp;<span class="op" id="3738577">(</span><span class="ident" id="3738578">c</span>&nbsp;<span class="op" id="3738580">*</span><span class="ident" id="3738581">Config</span><span class="op" id="3738587">)</span>&nbsp;<span class="ident" id="3738589">time</span><span class="op" id="3738593">(</span><span class="op" id="3738594">)</span>&nbsp;<span class="ident" id="3738596">time</span><span class="op" id="3738600">.</span><span class="ident" id="3738601">Time</span>&nbsp;<span class="op" id="3738606">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3738609">t</span>&nbsp;<span class="op" id="3738611">:=</span>&nbsp;<span class="ident" id="3738614">c</span><span class="op" id="3738615">.</span><span class="ident" id="3738616">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3738622">if</span>&nbsp;<span class="ident" id="3738625">t</span>&nbsp;<span class="op" id="3738627">==</span>&nbsp;<span class="builtintype" id="3738630">nil</span>&nbsp;<span class="op" id="3738634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3738638">t</span>&nbsp;<span class="op" id="3738640">=</span>&nbsp;<span class="ident" id="3738642">time</span><span class="op" id="3738646">.</span><span class="ident" id="3738647">Now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3738652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3738655">return</span>&nbsp;<span class="ident" id="3738662">t</span><span class="op" id="3738663">(</span><span class="op" id="3738664">)</span><br>
<span class="lineno">380</span><span class="op" id="3738666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3738669">func</span>&nbsp;<span class="op" id="3738674">(</span><span class="ident" id="3738675">c</span>&nbsp;<span class="op" id="3738677">*</span><span class="ident" id="3738678">Config</span><span class="op" id="3738684">)</span>&nbsp;<span class="ident" id="3738686">cipherSuites</span><span class="op" id="3738698">(</span><span class="op" id="3738699">)</span>&nbsp;<span class="op" id="3738701">[</span><span class="op" id="3738702">]</span><span class="builtintype" id="3738703">uint16</span>&nbsp;<span class="op" id="3738710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3738713">s</span>&nbsp;<span class="op" id="3738715">:=</span>&nbsp;<span class="ident" id="3738718">c</span><span class="op" id="3738719">.</span><span class="ident" id="3738720">CipherSuites</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3738734">if</span>&nbsp;<span class="ident" id="3738737">s</span>&nbsp;<span class="op" id="3738739">==</span>&nbsp;<span class="builtintype" id="3738742">nil</span>&nbsp;<span class="op" id="3738746">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3738750">s</span>&nbsp;<span class="op" id="3738752">=</span>&nbsp;<span class="ident" id="3738754">defaultCipherSuites</span><span class="op" id="3738773">(</span><span class="op" id="3738774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3738777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3738780">return</span>&nbsp;<span class="ident" id="3738787">s</span><br>
<span class="lineno"></span><span class="op" id="3738789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span><span class="keyword" id="3738792">func</span>&nbsp;<span class="op" id="3738797">(</span><span class="ident" id="3738798">c</span>&nbsp;<span class="op" id="3738800">*</span><span class="ident" id="3738801">Config</span><span class="op" id="3738807">)</span>&nbsp;<span class="ident" id="3738809">minVersion</span><span class="op" id="3738819">(</span><span class="op" id="3738820">)</span>&nbsp;<span class="builtintype" id="3738822">uint16</span>&nbsp;<span class="op" id="3738829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3738832">if</span>&nbsp;<span class="ident" id="3738835">c</span>&nbsp;<span class="op" id="3738837">==</span>&nbsp;<span class="builtintype" id="3738840">nil</span>&nbsp;<span class="op" id="3738844">||</span>&nbsp;<span class="ident" id="3738847">c</span><span class="op" id="3738848">.</span><span class="ident" id="3738849">MinVersion</span>&nbsp;<span class="op" id="3738860">==</span>&nbsp;<span class="num" id="3738863">0</span>&nbsp;<span class="op" id="3738865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3738869">return</span>&nbsp;<span class="ident" id="3738876">minVersion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3738888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3738891">return</span>&nbsp;<span class="ident" id="3738898">c</span><span class="op" id="3738899">.</span><span class="ident" id="3738900">MinVersion</span><br>
<span class="lineno">395</span><span class="op" id="3738911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3738914">func</span>&nbsp;<span class="op" id="3738919">(</span><span class="ident" id="3738920">c</span>&nbsp;<span class="op" id="3738922">*</span><span class="ident" id="3738923">Config</span><span class="op" id="3738929">)</span>&nbsp;<span class="ident" id="3738931">maxVersion</span><span class="op" id="3738941">(</span><span class="op" id="3738942">)</span>&nbsp;<span class="builtintype" id="3738944">uint16</span>&nbsp;<span class="op" id="3738951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3738954">if</span>&nbsp;<span class="ident" id="3738957">c</span>&nbsp;<span class="op" id="3738959">==</span>&nbsp;<span class="builtintype" id="3738962">nil</span>&nbsp;<span class="op" id="3738966">||</span>&nbsp;<span class="ident" id="3738969">c</span><span class="op" id="3738970">.</span><span class="ident" id="3738971">MaxVersion</span>&nbsp;<span class="op" id="3738982">==</span>&nbsp;<span class="num" id="3738985">0</span>&nbsp;<span class="op" id="3738987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3738991">return</span>&nbsp;<span class="ident" id="3738998">maxVersion</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3739010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3739013">return</span>&nbsp;<span class="ident" id="3739020">c</span><span class="op" id="3739021">.</span><span class="ident" id="3739022">MaxVersion</span><br>
<span class="lineno"></span><span class="op" id="3739033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3739036">var</span>&nbsp;<span class="ident" id="3739040">defaultCurvePreferences</span>&nbsp;<span class="op" id="3739064">=</span>&nbsp;<span class="op" id="3739066">[</span><span class="op" id="3739067">]</span><span class="ident" id="3739068">CurveID</span><span class="op" id="3739075">{</span><span class="ident" id="3739076">CurveP256</span><span class="op" id="3739085">,</span>&nbsp;<span class="ident" id="3739087">CurveP384</span><span class="op" id="3739096">,</span>&nbsp;<span class="ident" id="3739098">CurveP521</span><span class="op" id="3739107">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="3739110">func</span>&nbsp;<span class="op" id="3739115">(</span><span class="ident" id="3739116">c</span>&nbsp;<span class="op" id="3739118">*</span><span class="ident" id="3739119">Config</span><span class="op" id="3739125">)</span>&nbsp;<span class="ident" id="3739127">curvePreferences</span><span class="op" id="3739143">(</span><span class="op" id="3739144">)</span>&nbsp;<span class="op" id="3739146">[</span><span class="op" id="3739147">]</span><span class="ident" id="3739148">CurveID</span>&nbsp;<span class="op" id="3739156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3739159">if</span>&nbsp;<span class="ident" id="3739162">c</span>&nbsp;<span class="op" id="3739164">==</span>&nbsp;<span class="builtintype" id="3739167">nil</span>&nbsp;<span class="op" id="3739171">||</span>&nbsp;<span class="builtinfunc" id="3739174">len</span><span class="op" id="3739177">(</span><span class="ident" id="3739178">c</span><span class="op" id="3739179">.</span><span class="ident" id="3739180">CurvePreferences</span><span class="op" id="3739196">)</span>&nbsp;<span class="op" id="3739198">==</span>&nbsp;<span class="num" id="3739201">0</span>&nbsp;<span class="op" id="3739203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3739207">return</span>&nbsp;<span class="ident" id="3739214">defaultCurvePreferences</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3739239">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3739242">return</span>&nbsp;<span class="ident" id="3739249">c</span><span class="op" id="3739250">.</span><span class="ident" id="3739251">CurvePreferences</span><br>
<span class="lineno"></span><span class="op" id="3739268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3739271">//&nbsp;mutualVersion&nbsp;returns&nbsp;the&nbsp;protocol&nbsp;version&nbsp;to&nbsp;use&nbsp;given&nbsp;the&nbsp;advertised</span><br>
<span class="lineno"></span><span class="comment" id="3739345">//&nbsp;version&nbsp;of&nbsp;the&nbsp;peer.</span><br>
<span class="lineno">415</span><span class="keyword" id="3739369">func</span>&nbsp;<span class="op" id="3739374">(</span><span class="ident" id="3739375">c</span>&nbsp;<span class="op" id="3739377">*</span><span class="ident" id="3739378">Config</span><span class="op" id="3739384">)</span>&nbsp;<span class="ident" id="3739386">mutualVersion</span><span class="op" id="3739399">(</span><span class="ident" id="3739400">vers</span>&nbsp;<span class="builtintype" id="3739405">uint16</span><span class="op" id="3739411">)</span>&nbsp;<span class="op" id="3739413">(</span><span class="builtintype" id="3739414">uint16</span><span class="op" id="3739420">,</span>&nbsp;<span class="builtintype" id="3739422">bool</span><span class="op" id="3739426">)</span>&nbsp;<span class="op" id="3739428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3739431">minVersion</span>&nbsp;<span class="op" id="3739442">:=</span>&nbsp;<span class="ident" id="3739445">c</span><span class="op" id="3739446">.</span><span class="ident" id="3739447">minVersion</span><span class="op" id="3739457">(</span><span class="op" id="3739458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3739461">maxVersion</span>&nbsp;<span class="op" id="3739472">:=</span>&nbsp;<span class="ident" id="3739475">c</span><span class="op" id="3739476">.</span><span class="ident" id="3739477">maxVersion</span><span class="op" id="3739487">(</span><span class="op" id="3739488">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3739492">if</span>&nbsp;<span class="ident" id="3739495">vers</span>&nbsp;<span class="op" id="3739500">&lt;</span>&nbsp;<span class="ident" id="3739502">minVersion</span>&nbsp;<span class="op" id="3739513">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3739517">return</span>&nbsp;<span class="num" id="3739524">0</span><span class="op" id="3739525">,</span>&nbsp;<span class="builtintype" id="3739527">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3739534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3739537">if</span>&nbsp;<span class="ident" id="3739540">vers</span>&nbsp;<span class="op" id="3739545">&gt;</span>&nbsp;<span class="ident" id="3739547">maxVersion</span>&nbsp;<span class="op" id="3739558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3739562">vers</span>&nbsp;<span class="op" id="3739567">=</span>&nbsp;<span class="ident" id="3739569">maxVersion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3739581">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3739584">return</span>&nbsp;<span class="ident" id="3739591">vers</span><span class="op" id="3739595">,</span>&nbsp;<span class="builtintype" id="3739597">true</span><br>
<span class="lineno"></span><span class="op" id="3739602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3739605">//&nbsp;getCertificate&nbsp;returns&nbsp;the&nbsp;best&nbsp;certificate&nbsp;for&nbsp;the&nbsp;given&nbsp;ClientHelloInfo,</span><br>
<span class="lineno"></span><span class="comment" id="3739683">//&nbsp;defaulting&nbsp;to&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;c.Certificates.</span><br>
<span class="lineno">430</span><span class="keyword" id="3739737">func</span>&nbsp;<span class="op" id="3739742">(</span><span class="ident" id="3739743">c</span>&nbsp;<span class="op" id="3739745">*</span><span class="ident" id="3739746">Config</span><span class="op" id="3739752">)</span>&nbsp;<span class="ident" id="3739754">getCertificate</span><span class="op" id="3739768">(</span><span class="ident" id="3739769">clientHello</span>&nbsp;<span class="op" id="3739781">*</span><span class="ident" id="3739782">ClientHelloInfo</span><span class="op" id="3739797">)</span>&nbsp;<span class="op" id="3739799">(</span><span class="op" id="3739800">*</span><span class="ident" id="3739801">Certificate</span><span class="op" id="3739812">,</span>&nbsp;<span class="builtintype" id="3739814">error</span><span class="op" id="3739819">)</span>&nbsp;<span class="op" id="3739821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3739824">if</span>&nbsp;<span class="ident" id="3739827">c</span><span class="op" id="3739828">.</span><span class="ident" id="3739829">GetCertificate</span>&nbsp;<span class="op" id="3739844">!=</span>&nbsp;<span class="builtintype" id="3739847">nil</span>&nbsp;<span class="op" id="3739851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3739855">cert</span><span class="op" id="3739859">,</span>&nbsp;<span class="ident" id="3739861">err</span>&nbsp;<span class="op" id="3739865">:=</span>&nbsp;<span class="ident" id="3739868">c</span><span class="op" id="3739869">.</span><span class="ident" id="3739870">GetCertificate</span><span class="op" id="3739884">(</span><span class="ident" id="3739885">clientHello</span><span class="op" id="3739896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3739900">if</span>&nbsp;<span class="ident" id="3739903">cert</span>&nbsp;<span class="op" id="3739908">!=</span>&nbsp;<span class="builtintype" id="3739911">nil</span>&nbsp;<span class="op" id="3739915">||</span>&nbsp;<span class="ident" id="3739918">err</span>&nbsp;<span class="op" id="3739922">!=</span>&nbsp;<span class="builtintype" id="3739925">nil</span>&nbsp;<span class="op" id="3739929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3739934">return</span>&nbsp;<span class="ident" id="3739941">cert</span><span class="op" id="3739945">,</span>&nbsp;<span class="ident" id="3739947">err</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3739953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3739956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3739960">if</span>&nbsp;<span class="builtinfunc" id="3739963">len</span><span class="op" id="3739966">(</span><span class="ident" id="3739967">c</span><span class="op" id="3739968">.</span><span class="ident" id="3739969">Certificates</span><span class="op" id="3739981">)</span>&nbsp;<span class="op" id="3739983">==</span>&nbsp;<span class="num" id="3739986">1</span>&nbsp;<span class="op" id="3739988">||</span>&nbsp;<span class="ident" id="3739991">c</span><span class="op" id="3739992">.</span><span class="ident" id="3739993">NameToCertificate</span>&nbsp;<span class="op" id="3740011">==</span>&nbsp;<span class="builtintype" id="3740014">nil</span>&nbsp;<span class="op" id="3740018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3740022">//&nbsp;There&#39;s&nbsp;only&nbsp;one&nbsp;choice,&nbsp;so&nbsp;no&nbsp;point&nbsp;doing&nbsp;any&nbsp;work.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3740080">return</span>&nbsp;<span class="op" id="3740087">&amp;</span><span class="ident" id="3740088">c</span><span class="op" id="3740089">.</span><span class="ident" id="3740090">Certificates</span><span class="op" id="3740102">[</span><span class="num" id="3740103">0</span><span class="op" id="3740104">]</span><span class="op" id="3740105">,</span>&nbsp;<span class="builtintype" id="3740107">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3740112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3740116">name</span>&nbsp;<span class="op" id="3740121">:=</span>&nbsp;<span class="ident" id="3740124">strings</span><span class="op" id="3740131">.</span><span class="ident" id="3740132">ToLower</span><span class="op" id="3740139">(</span><span class="ident" id="3740140">clientHello</span><span class="op" id="3740151">.</span><span class="ident" id="3740152">ServerName</span><span class="op" id="3740162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3740165">for</span>&nbsp;<span class="builtinfunc" id="3740169">len</span><span class="op" id="3740172">(</span><span class="ident" id="3740173">name</span><span class="op" id="3740177">)</span>&nbsp;<span class="op" id="3740179">&gt;</span>&nbsp;<span class="num" id="3740181">0</span>&nbsp;<span class="op" id="3740183">&amp;&amp;</span>&nbsp;<span class="ident" id="3740186">name</span><span class="op" id="3740190">[</span><span class="builtinfunc" id="3740191">len</span><span class="op" id="3740194">(</span><span class="ident" id="3740195">name</span><span class="op" id="3740199">)</span><span class="op" id="3740200">-</span><span class="num" id="3740201">1</span><span class="op" id="3740202">]</span>&nbsp;<span class="op" id="3740204">==</span>&nbsp;<span class="string" id="3740207">&#39;.&#39;</span>&nbsp;<span class="op" id="3740211">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3740215">name</span>&nbsp;<span class="op" id="3740220">=</span>&nbsp;<span class="ident" id="3740222">name</span><span class="op" id="3740226">[</span><span class="op" id="3740227">:</span><span class="builtinfunc" id="3740228">len</span><span class="op" id="3740231">(</span><span class="ident" id="3740232">name</span><span class="op" id="3740236">)</span><span class="op" id="3740237">-</span><span class="num" id="3740238">1</span><span class="op" id="3740239">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3740242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3740246">if</span>&nbsp;<span class="ident" id="3740249">cert</span><span class="op" id="3740253">,</span>&nbsp;<span class="ident" id="3740255">ok</span>&nbsp;<span class="op" id="3740258">:=</span>&nbsp;<span class="ident" id="3740261">c</span><span class="op" id="3740262">.</span><span class="ident" id="3740263">NameToCertificate</span><span class="op" id="3740280">[</span><span class="ident" id="3740281">name</span><span class="op" id="3740285">]</span><span class="op" id="3740286">;</span>&nbsp;<span class="ident" id="3740288">ok</span>&nbsp;<span class="op" id="3740291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3740295">return</span>&nbsp;<span class="ident" id="3740302">cert</span><span class="op" id="3740306">,</span>&nbsp;<span class="builtintype" id="3740308">nil</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3740313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3740317">//&nbsp;try&nbsp;replacing&nbsp;labels&nbsp;in&nbsp;the&nbsp;name&nbsp;with&nbsp;wildcards&nbsp;until&nbsp;we&nbsp;get&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3740384">//&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3740395">labels</span>&nbsp;<span class="op" id="3740402">:=</span>&nbsp;<span class="ident" id="3740405">strings</span><span class="op" id="3740412">.</span><span class="ident" id="3740413">Split</span><span class="op" id="3740418">(</span><span class="ident" id="3740419">name</span><span class="op" id="3740423">,</span>&nbsp;<span class="string" id="3740425">&#34;.&#34;</span><span class="op" id="3740428">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3740431">for</span>&nbsp;<span class="ident" id="3740435">i</span>&nbsp;<span class="op" id="3740437">:=</span>&nbsp;<span class="keyword" id="3740440">range</span>&nbsp;<span class="ident" id="3740446">labels</span>&nbsp;<span class="op" id="3740453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3740457">labels</span><span class="op" id="3740463">[</span><span class="ident" id="3740464">i</span><span class="op" id="3740465">]</span>&nbsp;<span class="op" id="3740467">=</span>&nbsp;<span class="string" id="3740469">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3740475">candidate</span>&nbsp;<span class="op" id="3740485">:=</span>&nbsp;<span class="ident" id="3740488">strings</span><span class="op" id="3740495">.</span><span class="ident" id="3740496">Join</span><span class="op" id="3740500">(</span><span class="ident" id="3740501">labels</span><span class="op" id="3740507">,</span>&nbsp;<span class="string" id="3740509">&#34;.&#34;</span><span class="op" id="3740512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3740516">if</span>&nbsp;<span class="ident" id="3740519">cert</span><span class="op" id="3740523">,</span>&nbsp;<span class="ident" id="3740525">ok</span>&nbsp;<span class="op" id="3740528">:=</span>&nbsp;<span class="ident" id="3740531">c</span><span class="op" id="3740532">.</span><span class="ident" id="3740533">NameToCertificate</span><span class="op" id="3740550">[</span><span class="ident" id="3740551">candidate</span><span class="op" id="3740560">]</span><span class="op" id="3740561">;</span>&nbsp;<span class="ident" id="3740563">ok</span>&nbsp;<span class="op" id="3740566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3740571">return</span>&nbsp;<span class="ident" id="3740578">cert</span><span class="op" id="3740582">,</span>&nbsp;<span class="builtintype" id="3740584">nil</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3740590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3740593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3740597">//&nbsp;If&nbsp;nothing&nbsp;matches,&nbsp;return&nbsp;the&nbsp;first&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3740651">return</span>&nbsp;<span class="op" id="3740658">&amp;</span><span class="ident" id="3740659">c</span><span class="op" id="3740660">.</span><span class="ident" id="3740661">Certificates</span><span class="op" id="3740673">[</span><span class="num" id="3740674">0</span><span class="op" id="3740675">]</span><span class="op" id="3740676">,</span>&nbsp;<span class="builtintype" id="3740678">nil</span><br>
<span class="lineno">465</span><span class="op" id="3740682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3740685">//&nbsp;BuildNameToCertificate&nbsp;parses&nbsp;c.Certificates&nbsp;and&nbsp;builds&nbsp;c.NameToCertificate</span><br>
<span class="lineno"></span><span class="comment" id="3740764">//&nbsp;from&nbsp;the&nbsp;CommonName&nbsp;and&nbsp;SubjectAlternateName&nbsp;fields&nbsp;of&nbsp;each&nbsp;of&nbsp;the&nbsp;leaf</span><br>
<span class="lineno"></span><span class="comment" id="3740839">//&nbsp;certificates.</span><br>
<span class="lineno">470</span><span class="keyword" id="3740856">func</span>&nbsp;<span class="op" id="3740861">(</span><span class="ident" id="3740862">c</span>&nbsp;<span class="op" id="3740864">*</span><span class="ident" id="3740865">Config</span><span class="op" id="3740871">)</span>&nbsp;<span class="ident" id="3740873">BuildNameToCertificate</span><span class="op" id="3740895">(</span><span class="op" id="3740896">)</span>&nbsp;<span class="op" id="3740898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3740901">c</span><span class="op" id="3740902">.</span><span class="ident" id="3740903">NameToCertificate</span>&nbsp;<span class="op" id="3740921">=</span>&nbsp;<span class="builtinfunc" id="3740923">make</span><span class="op" id="3740927">(</span><span class="keyword" id="3740928">map</span><span class="op" id="3740931">[</span><span class="builtintype" id="3740932">string</span><span class="op" id="3740938">]</span><span class="op" id="3740939">*</span><span class="ident" id="3740940">Certificate</span><span class="op" id="3740951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3740954">for</span>&nbsp;<span class="ident" id="3740958">i</span>&nbsp;<span class="op" id="3740960">:=</span>&nbsp;<span class="keyword" id="3740963">range</span>&nbsp;<span class="ident" id="3740969">c</span><span class="op" id="3740970">.</span><span class="ident" id="3740971">Certificates</span>&nbsp;<span class="op" id="3740984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3740988">cert</span>&nbsp;<span class="op" id="3740993">:=</span>&nbsp;<span class="op" id="3740996">&amp;</span><span class="ident" id="3740997">c</span><span class="op" id="3740998">.</span><span class="ident" id="3740999">Certificates</span><span class="op" id="3741011">[</span><span class="ident" id="3741012">i</span><span class="op" id="3741013">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3741017">x509Cert</span><span class="op" id="3741025">,</span>&nbsp;<span class="ident" id="3741027">err</span>&nbsp;<span class="op" id="3741031">:=</span>&nbsp;<span class="ident" id="3741034">x509</span><span class="op" id="3741038">.</span><span class="ident" id="3741039">ParseCertificate</span><span class="op" id="3741055">(</span><span class="ident" id="3741056">cert</span><span class="op" id="3741060">.</span><span class="ident" id="3741061">Certificate</span><span class="op" id="3741072">[</span><span class="num" id="3741073">0</span><span class="op" id="3741074">]</span><span class="op" id="3741075">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3741079">if</span>&nbsp;<span class="ident" id="3741082">err</span>&nbsp;<span class="op" id="3741086">!=</span>&nbsp;<span class="builtintype" id="3741089">nil</span>&nbsp;<span class="op" id="3741093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3741098">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3741109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3741113">if</span>&nbsp;<span class="builtinfunc" id="3741116">len</span><span class="op" id="3741119">(</span><span class="ident" id="3741120">x509Cert</span><span class="op" id="3741128">.</span><span class="ident" id="3741129">Subject</span><span class="op" id="3741136">.</span><span class="ident" id="3741137">CommonName</span><span class="op" id="3741147">)</span>&nbsp;<span class="op" id="3741149">&gt;</span>&nbsp;<span class="num" id="3741151">0</span>&nbsp;<span class="op" id="3741153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3741158">c</span><span class="op" id="3741159">.</span><span class="ident" id="3741160">NameToCertificate</span><span class="op" id="3741177">[</span><span class="ident" id="3741178">x509Cert</span><span class="op" id="3741186">.</span><span class="ident" id="3741187">Subject</span><span class="op" id="3741194">.</span><span class="ident" id="3741195">CommonName</span><span class="op" id="3741205">]</span>&nbsp;<span class="op" id="3741207">=</span>&nbsp;<span class="ident" id="3741209">cert</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3741216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3741220">for</span>&nbsp;<span class="ident" id="3741224">_</span><span class="op" id="3741225">,</span>&nbsp;<span class="ident" id="3741227">san</span>&nbsp;<span class="op" id="3741231">:=</span>&nbsp;<span class="keyword" id="3741234">range</span>&nbsp;<span class="ident" id="3741240">x509Cert</span><span class="op" id="3741248">.</span><span class="ident" id="3741249">DNSNames</span>&nbsp;<span class="op" id="3741258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3741263">c</span><span class="op" id="3741264">.</span><span class="ident" id="3741265">NameToCertificate</span><span class="op" id="3741282">[</span><span class="ident" id="3741283">san</span><span class="op" id="3741286">]</span>&nbsp;<span class="op" id="3741288">=</span>&nbsp;<span class="ident" id="3741290">cert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3741297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3741300">}</span><br>
<span class="lineno">485</span><span class="op" id="3741302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3741305">//&nbsp;A&nbsp;Certificate&nbsp;is&nbsp;a&nbsp;chain&nbsp;of&nbsp;one&nbsp;or&nbsp;more&nbsp;certificates,&nbsp;leaf&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="3741374">type</span>&nbsp;<span class="ident" id="3741379">Certificate</span>&nbsp;<span class="keyword" id="3741391">struct</span>&nbsp;<span class="op" id="3741398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3741401">Certificate</span>&nbsp;<span class="op" id="3741413">[</span><span class="op" id="3741414">]</span><span class="op" id="3741415">[</span><span class="op" id="3741416">]</span><span class="builtintype" id="3741417">byte</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3741423">//&nbsp;PrivateKey&nbsp;contains&nbsp;the&nbsp;private&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;public&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3741495">//&nbsp;in&nbsp;Leaf.&nbsp;For&nbsp;a&nbsp;server,&nbsp;this&nbsp;must&nbsp;be&nbsp;a&nbsp;*rsa.PrivateKey&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3741556">//&nbsp;*ecdsa.PrivateKey.&nbsp;For&nbsp;a&nbsp;client&nbsp;doing&nbsp;client&nbsp;authentication,&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3741626">//&nbsp;can&nbsp;be&nbsp;any&nbsp;type&nbsp;that&nbsp;implements&nbsp;crypto.Signer&nbsp;(which&nbsp;includes&nbsp;RSA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3741696">//&nbsp;and&nbsp;ECDSA&nbsp;private&nbsp;keys).</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3741725">PrivateKey</span>&nbsp;<span class="ident" id="3741736">crypto</span><span class="op" id="3741742">.</span><span class="ident" id="3741743">PrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3741755">//&nbsp;OCSPStaple&nbsp;contains&nbsp;an&nbsp;optional&nbsp;OCSP&nbsp;response&nbsp;which&nbsp;will&nbsp;be&nbsp;served</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3741826">//&nbsp;to&nbsp;clients&nbsp;that&nbsp;request&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3741858">OCSPStaple</span>&nbsp;<span class="op" id="3741869">[</span><span class="op" id="3741870">]</span><span class="builtintype" id="3741871">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3741877">//&nbsp;Leaf&nbsp;is&nbsp;the&nbsp;parsed&nbsp;form&nbsp;of&nbsp;the&nbsp;leaf&nbsp;certificate,&nbsp;which&nbsp;may&nbsp;be</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3741943">//&nbsp;initialized&nbsp;using&nbsp;x509.ParseCertificate&nbsp;to&nbsp;reduce&nbsp;per-handshake</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3742011">//&nbsp;processing&nbsp;for&nbsp;TLS&nbsp;clients&nbsp;doing&nbsp;client&nbsp;authentication.&nbsp;If&nbsp;nil,&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3742083">//&nbsp;leaf&nbsp;certificate&nbsp;will&nbsp;be&nbsp;parsed&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3742130">Leaf</span>&nbsp;<span class="op" id="3742135">*</span><span class="ident" id="3742136">x509</span><span class="op" id="3742140">.</span><span class="ident" id="3742141">Certificate</span><br>
<span class="lineno"></span><span class="op" id="3742153">}</span><br>
<span class="lineno">505</span><br>
<span class="lineno"></span><span class="comment" id="3742156">//&nbsp;A&nbsp;TLS&nbsp;record.</span><br>
<span class="lineno"></span><span class="keyword" id="3742173">type</span>&nbsp;<span class="ident" id="3742178">record</span>&nbsp;<span class="keyword" id="3742185">struct</span>&nbsp;<span class="op" id="3742192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3742195">contentType</span>&nbsp;&nbsp;<span class="ident" id="3742208">recordType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3742220">major</span><span class="op" id="3742225">,</span>&nbsp;<span class="ident" id="3742227">minor</span>&nbsp;<span class="builtintype" id="3742233">uint8</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3742240">payload</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3742253">[</span><span class="op" id="3742254">]</span><span class="builtintype" id="3742255">byte</span><br>
<span class="lineno"></span><span class="op" id="3742260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3742263">type</span>&nbsp;<span class="ident" id="3742268">handshakeMessage</span>&nbsp;<span class="keyword" id="3742285">interface</span>&nbsp;<span class="op" id="3742295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3742298">marshal</span><span class="op" id="3742305">(</span><span class="op" id="3742306">)</span>&nbsp;<span class="op" id="3742308">[</span><span class="op" id="3742309">]</span><span class="builtintype" id="3742310">byte</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3742316">unmarshal</span><span class="op" id="3742325">(</span><span class="op" id="3742326">[</span><span class="op" id="3742327">]</span><span class="builtintype" id="3742328">byte</span><span class="op" id="3742332">)</span>&nbsp;<span class="builtintype" id="3742334">bool</span><br>
<span class="lineno"></span><span class="op" id="3742339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3742342">//&nbsp;lruSessionCache&nbsp;is&nbsp;a&nbsp;ClientSessionCache&nbsp;implementation&nbsp;that&nbsp;uses&nbsp;an&nbsp;LRU</span><br>
<span class="lineno"></span><span class="comment" id="3742417">//&nbsp;caching&nbsp;strategy.</span><br>
<span class="lineno">520</span><span class="keyword" id="3742438">type</span>&nbsp;<span class="ident" id="3742443">lruSessionCache</span>&nbsp;<span class="keyword" id="3742459">struct</span>&nbsp;<span class="op" id="3742466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3742469">sync</span><span class="op" id="3742473">.</span><span class="ident" id="3742474">Mutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3742482">m</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3742491">map</span><span class="op" id="3742494">[</span><span class="builtintype" id="3742495">string</span><span class="op" id="3742501">]</span><span class="op" id="3742502">*</span><span class="ident" id="3742503">list</span><span class="op" id="3742507">.</span><span class="ident" id="3742508">Element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3742517">q</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3742526">*</span><span class="ident" id="3742527">list</span><span class="op" id="3742531">.</span><span class="ident" id="3742532">List</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3742538">capacity</span>&nbsp;<span class="builtintype" id="3742547">int</span><br>
<span class="lineno"></span><span class="op" id="3742551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3742554">type</span>&nbsp;<span class="ident" id="3742559">lruSessionCacheEntry</span>&nbsp;<span class="keyword" id="3742580">struct</span>&nbsp;<span class="op" id="3742587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3742590">sessionKey</span>&nbsp;<span class="builtintype" id="3742601">string</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3742609">state</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3742620">*</span><span class="ident" id="3742621">ClientSessionState</span><br>
<span class="lineno"></span><span class="op" id="3742640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3742643">//&nbsp;NewLRUClientSessionCache&nbsp;returns&nbsp;a&nbsp;ClientSessionCache&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="3742715">//&nbsp;capacity&nbsp;that&nbsp;uses&nbsp;an&nbsp;LRU&nbsp;strategy.&nbsp;If&nbsp;capacity&nbsp;is&nbsp;&lt;&nbsp;1,&nbsp;a&nbsp;default&nbsp;capacity</span><br>
<span class="lineno">535</span><span class="comment" id="3742793">//&nbsp;is&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span><span class="keyword" id="3742813">func</span>&nbsp;<span class="ident" id="3742818">NewLRUClientSessionCache</span><span class="op" id="3742842">(</span><span class="ident" id="3742843">capacity</span>&nbsp;<span class="builtintype" id="3742852">int</span><span class="op" id="3742855">)</span>&nbsp;<span class="ident" id="3742857">ClientSessionCache</span>&nbsp;<span class="op" id="3742876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3742879">const</span>&nbsp;<span class="ident" id="3742885">defaultSessionCacheCapacity</span>&nbsp;<span class="op" id="3742913">=</span>&nbsp;<span class="num" id="3742915">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3742920">if</span>&nbsp;<span class="ident" id="3742923">capacity</span>&nbsp;<span class="op" id="3742932">&lt;</span>&nbsp;<span class="num" id="3742934">1</span>&nbsp;<span class="op" id="3742936">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3742940">capacity</span>&nbsp;<span class="op" id="3742949">=</span>&nbsp;<span class="ident" id="3742951">defaultSessionCacheCapacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3742980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3742983">return</span>&nbsp;<span class="op" id="3742990">&amp;</span><span class="ident" id="3742991">lruSessionCache</span><span class="op" id="3743006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743010">m</span><span class="op" id="3743011">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3743020">make</span><span class="op" id="3743024">(</span><span class="keyword" id="3743025">map</span><span class="op" id="3743028">[</span><span class="builtintype" id="3743029">string</span><span class="op" id="3743035">]</span><span class="op" id="3743036">*</span><span class="ident" id="3743037">list</span><span class="op" id="3743041">.</span><span class="ident" id="3743042">Element</span><span class="op" id="3743049">)</span><span class="op" id="3743050">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743054">q</span><span class="op" id="3743055">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743064">list</span><span class="op" id="3743068">.</span><span class="ident" id="3743069">New</span><span class="op" id="3743072">(</span><span class="op" id="3743073">)</span><span class="op" id="3743074">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743078">capacity</span><span class="op" id="3743086">:</span>&nbsp;<span class="ident" id="3743088">capacity</span><span class="op" id="3743096">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3743099">}</span><br>
<span class="lineno"></span><span class="op" id="3743101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3743104">//&nbsp;Put&nbsp;adds&nbsp;the&nbsp;provided&nbsp;(sessionKey,&nbsp;cs)&nbsp;pair&nbsp;to&nbsp;the&nbsp;cache.</span><br>
<span class="lineno">550</span><span class="keyword" id="3743165">func</span>&nbsp;<span class="op" id="3743170">(</span><span class="ident" id="3743171">c</span>&nbsp;<span class="op" id="3743173">*</span><span class="ident" id="3743174">lruSessionCache</span><span class="op" id="3743189">)</span>&nbsp;<span class="ident" id="3743191">Put</span><span class="op" id="3743194">(</span><span class="ident" id="3743195">sessionKey</span>&nbsp;<span class="builtintype" id="3743206">string</span><span class="op" id="3743212">,</span>&nbsp;<span class="ident" id="3743214">cs</span>&nbsp;<span class="op" id="3743217">*</span><span class="ident" id="3743218">ClientSessionState</span><span class="op" id="3743236">)</span>&nbsp;<span class="op" id="3743238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743241">c</span><span class="op" id="3743242">.</span><span class="ident" id="3743243">Lock</span><span class="op" id="3743247">(</span><span class="op" id="3743248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3743251">defer</span>&nbsp;<span class="ident" id="3743257">c</span><span class="op" id="3743258">.</span><span class="ident" id="3743259">Unlock</span><span class="op" id="3743265">(</span><span class="op" id="3743266">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3743270">if</span>&nbsp;<span class="ident" id="3743273">elem</span><span class="op" id="3743277">,</span>&nbsp;<span class="ident" id="3743279">ok</span>&nbsp;<span class="op" id="3743282">:=</span>&nbsp;<span class="ident" id="3743285">c</span><span class="op" id="3743286">.</span><span class="ident" id="3743287">m</span><span class="op" id="3743288">[</span><span class="ident" id="3743289">sessionKey</span><span class="op" id="3743299">]</span><span class="op" id="3743300">;</span>&nbsp;<span class="ident" id="3743302">ok</span>&nbsp;<span class="op" id="3743305">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743309">entry</span>&nbsp;<span class="op" id="3743315">:=</span>&nbsp;<span class="ident" id="3743318">elem</span><span class="op" id="3743322">.</span><span class="ident" id="3743323">Value</span><span class="op" id="3743328">.</span><span class="op" id="3743329">(</span><span class="op" id="3743330">*</span><span class="ident" id="3743331">lruSessionCacheEntry</span><span class="op" id="3743351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743355">entry</span><span class="op" id="3743360">.</span><span class="ident" id="3743361">state</span>&nbsp;<span class="op" id="3743367">=</span>&nbsp;<span class="ident" id="3743369">cs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743374">c</span><span class="op" id="3743375">.</span><span class="ident" id="3743376">q</span><span class="op" id="3743377">.</span><span class="ident" id="3743378">MoveToFront</span><span class="op" id="3743389">(</span><span class="ident" id="3743390">elem</span><span class="op" id="3743394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3743398">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3743406">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3743410">if</span>&nbsp;<span class="ident" id="3743413">c</span><span class="op" id="3743414">.</span><span class="ident" id="3743415">q</span><span class="op" id="3743416">.</span><span class="ident" id="3743417">Len</span><span class="op" id="3743420">(</span><span class="op" id="3743421">)</span>&nbsp;<span class="op" id="3743423">&lt;</span>&nbsp;<span class="ident" id="3743425">c</span><span class="op" id="3743426">.</span><span class="ident" id="3743427">capacity</span>&nbsp;<span class="op" id="3743436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743440">entry</span>&nbsp;<span class="op" id="3743446">:=</span>&nbsp;<span class="op" id="3743449">&amp;</span><span class="ident" id="3743450">lruSessionCacheEntry</span><span class="op" id="3743470">{</span><span class="ident" id="3743471">sessionKey</span><span class="op" id="3743481">,</span>&nbsp;<span class="ident" id="3743483">cs</span><span class="op" id="3743485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743489">c</span><span class="op" id="3743490">.</span><span class="ident" id="3743491">m</span><span class="op" id="3743492">[</span><span class="ident" id="3743493">sessionKey</span><span class="op" id="3743503">]</span>&nbsp;<span class="op" id="3743505">=</span>&nbsp;<span class="ident" id="3743507">c</span><span class="op" id="3743508">.</span><span class="ident" id="3743509">q</span><span class="op" id="3743510">.</span><span class="ident" id="3743511">PushFront</span><span class="op" id="3743520">(</span><span class="ident" id="3743521">entry</span><span class="op" id="3743526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3743530">return</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3743538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743542">elem</span>&nbsp;<span class="op" id="3743547">:=</span>&nbsp;<span class="ident" id="3743550">c</span><span class="op" id="3743551">.</span><span class="ident" id="3743552">q</span><span class="op" id="3743553">.</span><span class="ident" id="3743554">Back</span><span class="op" id="3743558">(</span><span class="op" id="3743559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743562">entry</span>&nbsp;<span class="op" id="3743568">:=</span>&nbsp;<span class="ident" id="3743571">elem</span><span class="op" id="3743575">.</span><span class="ident" id="3743576">Value</span><span class="op" id="3743581">.</span><span class="op" id="3743582">(</span><span class="op" id="3743583">*</span><span class="ident" id="3743584">lruSessionCacheEntry</span><span class="op" id="3743604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3743607">delete</span><span class="op" id="3743613">(</span><span class="ident" id="3743614">c</span><span class="op" id="3743615">.</span><span class="ident" id="3743616">m</span><span class="op" id="3743617">,</span>&nbsp;<span class="ident" id="3743619">entry</span><span class="op" id="3743624">.</span><span class="ident" id="3743625">sessionKey</span><span class="op" id="3743635">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743638">entry</span><span class="op" id="3743643">.</span><span class="ident" id="3743644">sessionKey</span>&nbsp;<span class="op" id="3743655">=</span>&nbsp;<span class="ident" id="3743657">sessionKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743669">entry</span><span class="op" id="3743674">.</span><span class="ident" id="3743675">state</span>&nbsp;<span class="op" id="3743681">=</span>&nbsp;<span class="ident" id="3743683">cs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743687">c</span><span class="op" id="3743688">.</span><span class="ident" id="3743689">q</span><span class="op" id="3743690">.</span><span class="ident" id="3743691">MoveToFront</span><span class="op" id="3743702">(</span><span class="ident" id="3743703">elem</span><span class="op" id="3743707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743710">c</span><span class="op" id="3743711">.</span><span class="ident" id="3743712">m</span><span class="op" id="3743713">[</span><span class="ident" id="3743714">sessionKey</span><span class="op" id="3743724">]</span>&nbsp;<span class="op" id="3743726">=</span>&nbsp;<span class="ident" id="3743728">elem</span><br>
<span class="lineno"></span><span class="op" id="3743733">}</span><br>
<span class="lineno">575</span><br>
<span class="lineno"></span><span class="comment" id="3743736">//&nbsp;Get&nbsp;returns&nbsp;the&nbsp;ClientSessionState&nbsp;value&nbsp;associated&nbsp;with&nbsp;a&nbsp;given&nbsp;key.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="3743812">//&nbsp;returns&nbsp;(nil,&nbsp;false)&nbsp;if&nbsp;no&nbsp;value&nbsp;is&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="3743858">func</span>&nbsp;<span class="op" id="3743863">(</span><span class="ident" id="3743864">c</span>&nbsp;<span class="op" id="3743866">*</span><span class="ident" id="3743867">lruSessionCache</span><span class="op" id="3743882">)</span>&nbsp;<span class="ident" id="3743884">Get</span><span class="op" id="3743887">(</span><span class="ident" id="3743888">sessionKey</span>&nbsp;<span class="builtintype" id="3743899">string</span><span class="op" id="3743905">)</span>&nbsp;<span class="op" id="3743907">(</span><span class="op" id="3743908">*</span><span class="ident" id="3743909">ClientSessionState</span><span class="op" id="3743927">,</span>&nbsp;<span class="builtintype" id="3743929">bool</span><span class="op" id="3743933">)</span>&nbsp;<span class="op" id="3743935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743938">c</span><span class="op" id="3743939">.</span><span class="ident" id="3743940">Lock</span><span class="op" id="3743944">(</span><span class="op" id="3743945">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3743948">defer</span>&nbsp;<span class="ident" id="3743954">c</span><span class="op" id="3743955">.</span><span class="ident" id="3743956">Unlock</span><span class="op" id="3743962">(</span><span class="op" id="3743963">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3743967">if</span>&nbsp;<span class="ident" id="3743970">elem</span><span class="op" id="3743974">,</span>&nbsp;<span class="ident" id="3743976">ok</span>&nbsp;<span class="op" id="3743979">:=</span>&nbsp;<span class="ident" id="3743982">c</span><span class="op" id="3743983">.</span><span class="ident" id="3743984">m</span><span class="op" id="3743985">[</span><span class="ident" id="3743986">sessionKey</span><span class="op" id="3743996">]</span><span class="op" id="3743997">;</span>&nbsp;<span class="ident" id="3743999">ok</span>&nbsp;<span class="op" id="3744002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3744006">c</span><span class="op" id="3744007">.</span><span class="ident" id="3744008">q</span><span class="op" id="3744009">.</span><span class="ident" id="3744010">MoveToFront</span><span class="op" id="3744021">(</span><span class="ident" id="3744022">elem</span><span class="op" id="3744026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3744030">return</span>&nbsp;<span class="ident" id="3744037">elem</span><span class="op" id="3744041">.</span><span class="ident" id="3744042">Value</span><span class="op" id="3744047">.</span><span class="op" id="3744048">(</span><span class="op" id="3744049">*</span><span class="ident" id="3744050">lruSessionCacheEntry</span><span class="op" id="3744070">)</span><span class="op" id="3744071">.</span><span class="ident" id="3744072">state</span><span class="op" id="3744077">,</span>&nbsp;<span class="builtintype" id="3744079">true</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3744085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3744088">return</span>&nbsp;<span class="builtintype" id="3744095">nil</span><span class="op" id="3744098">,</span>&nbsp;<span class="builtintype" id="3744100">false</span><br>
<span class="lineno"></span><span class="op" id="3744106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3744109">//&nbsp;TODO(jsing):&nbsp;Make&nbsp;these&nbsp;available&nbsp;to&nbsp;both&nbsp;crypto/x509&nbsp;and&nbsp;crypto/tls.</span><br>
<span class="lineno">590</span><span class="keyword" id="3744182">type</span>&nbsp;<span class="ident" id="3744187">dsaSignature</span>&nbsp;<span class="keyword" id="3744200">struct</span>&nbsp;<span class="op" id="3744207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3744210">R</span><span class="op" id="3744211">,</span>&nbsp;<span class="ident" id="3744213">S</span>&nbsp;<span class="op" id="3744215">*</span><span class="ident" id="3744216">big</span><span class="op" id="3744219">.</span><span class="ident" id="3744220">Int</span><br>
<span class="lineno"></span><span class="op" id="3744224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3744227">type</span>&nbsp;<span class="ident" id="3744232">ecdsaSignature</span>&nbsp;<span class="ident" id="3744247">dsaSignature</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="keyword" id="3744261">var</span>&nbsp;<span class="ident" id="3744265">emptyConfig</span>&nbsp;<span class="ident" id="3744277">Config</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3744285">func</span>&nbsp;<span class="ident" id="3744290">defaultConfig</span><span class="op" id="3744303">(</span><span class="op" id="3744304">)</span>&nbsp;<span class="op" id="3744306">*</span><span class="ident" id="3744307">Config</span>&nbsp;<span class="op" id="3744314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3744317">return</span>&nbsp;<span class="op" id="3744324">&amp;</span><span class="ident" id="3744325">emptyConfig</span><br>
<span class="lineno">600</span><span class="op" id="3744337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3744340">var</span>&nbsp;<span class="op" id="3744344">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3744347">once</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3744370">sync</span><span class="op" id="3744374">.</span><span class="ident" id="3744375">Once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3744381">varDefaultCipherSuites</span>&nbsp;<span class="op" id="3744404">[</span><span class="op" id="3744405">]</span><span class="builtintype" id="3744406">uint16</span><br>
<span class="lineno">605</span><span class="op" id="3744413">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3744416">func</span>&nbsp;<span class="ident" id="3744421">defaultCipherSuites</span><span class="op" id="3744440">(</span><span class="op" id="3744441">)</span>&nbsp;<span class="op" id="3744443">[</span><span class="op" id="3744444">]</span><span class="builtintype" id="3744445">uint16</span>&nbsp;<span class="op" id="3744452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3744455">once</span><span class="op" id="3744459">.</span><span class="ident" id="3744460">Do</span><span class="op" id="3744462">(</span><span class="ident" id="3744463">initDefaultCipherSuites</span><span class="op" id="3744486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3744489">return</span>&nbsp;<span class="ident" id="3744496">varDefaultCipherSuites</span><br>
<span class="lineno">610</span><span class="op" id="3744519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3744522">func</span>&nbsp;<span class="ident" id="3744527">initDefaultCipherSuites</span><span class="op" id="3744550">(</span><span class="op" id="3744551">)</span>&nbsp;<span class="op" id="3744553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3744556">varDefaultCipherSuites</span>&nbsp;<span class="op" id="3744579">=</span>&nbsp;<span class="builtinfunc" id="3744581">make</span><span class="op" id="3744585">(</span><span class="op" id="3744586">[</span><span class="op" id="3744587">]</span><span class="builtintype" id="3744588">uint16</span><span class="op" id="3744594">,</span>&nbsp;<span class="builtinfunc" id="3744596">len</span><span class="op" id="3744599">(</span><span class="ident" id="3744600">cipherSuites</span><span class="op" id="3744612">)</span><span class="op" id="3744613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3744616">for</span>&nbsp;<span class="ident" id="3744620">i</span><span class="op" id="3744621">,</span>&nbsp;<span class="ident" id="3744623">suite</span>&nbsp;<span class="op" id="3744629">:=</span>&nbsp;<span class="keyword" id="3744632">range</span>&nbsp;<span class="ident" id="3744638">cipherSuites</span>&nbsp;<span class="op" id="3744651">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3744655">varDefaultCipherSuites</span><span class="op" id="3744677">[</span><span class="ident" id="3744678">i</span><span class="op" id="3744679">]</span>&nbsp;<span class="op" id="3744681">=</span>&nbsp;<span class="ident" id="3744683">suite</span><span class="op" id="3744688">.</span><span class="ident" id="3744689">id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3744693">}</span><br>
<span class="lineno"></span><span class="op" id="3744695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3744698">func</span>&nbsp;<span class="ident" id="3744703">unexpectedMessageError</span><span class="op" id="3744725">(</span><span class="ident" id="3744726">wanted</span><span class="op" id="3744732">,</span>&nbsp;<span class="ident" id="3744734">got</span>&nbsp;<span class="keyword" id="3744738">interface</span><span class="op" id="3744747">{</span><span class="op" id="3744748">}</span><span class="op" id="3744749">)</span>&nbsp;<span class="builtintype" id="3744751">error</span>&nbsp;<span class="op" id="3744757">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3744760">return</span>&nbsp;<span class="ident" id="3744767">fmt</span><span class="op" id="3744770">.</span><span class="ident" id="3744771">Errorf</span><span class="op" id="3744777">(</span><span class="string" id="3744778">&#34;tls:&nbsp;received&nbsp;unexpected&nbsp;handshake&nbsp;message&nbsp;of&nbsp;type&nbsp;%T&nbsp;when&nbsp;waiting&nbsp;for&nbsp;%T&#34;</span><span class="op" id="3744853">,</span>&nbsp;<span class="ident" id="3744855">got</span><span class="op" id="3744858">,</span>&nbsp;<span class="ident" id="3744860">wanted</span><span class="op" id="3744866">)</span><br>
<span class="lineno"></span><span class="op" id="3744868">}</span>
</div>
</body>
</html>
