<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/gzip</h2>
<ul>
<li><a href="/gostd/compress/gzip/gunzip.go.html">gunzip.go</a></li>
<li><a href="/gostd/compress/gzip/gunzip_test.go.html">gunzip_test.go</a></li>
<li><a href="/gostd/compress/gzip/gzip.go.html">gzip.go</a></li>
<li><a href="/gostd/compress/gzip/gzip_test.go.html">gzip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5120270">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5120325">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5120379">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5120430">package</span>&nbsp;<span class="ident" id="5120438">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5120444">import</span>&nbsp;<span class="op" id="5120451">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5120454">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5120472">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5120482">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5120489">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5120497">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5120511">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5120516">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="5120519">//&nbsp;These&nbsp;constants&nbsp;are&nbsp;copied&nbsp;from&nbsp;the&nbsp;flate&nbsp;package,&nbsp;so&nbsp;that&nbsp;code&nbsp;that&nbsp;imports</span><br>
<span class="lineno"></span><span class="comment" id="5120599">//&nbsp;&#34;compress/gzip&#34;&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;to&nbsp;import&nbsp;&#34;compress/flate&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="5120665">const</span>&nbsp;<span class="op" id="5120671">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120674">NoCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5120693">=</span>&nbsp;<span class="ident" id="5120695">flate</span><span class="op" id="5120700">.</span><span class="ident" id="5120701">NoCompression</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120716">BestSpeed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5120735">=</span>&nbsp;<span class="ident" id="5120737">flate</span><span class="op" id="5120742">.</span><span class="ident" id="5120743">BestSpeed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120754">BestCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5120773">=</span>&nbsp;<span class="ident" id="5120775">flate</span><span class="op" id="5120780">.</span><span class="ident" id="5120781">BestCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120798">DefaultCompression</span>&nbsp;<span class="op" id="5120817">=</span>&nbsp;<span class="ident" id="5120819">flate</span><span class="op" id="5120824">.</span><span class="ident" id="5120825">DefaultCompression</span><br>
<span class="lineno"></span><span class="op" id="5120844">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="5120847">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;an&nbsp;io.WriteCloser.</span><br>
<span class="lineno"></span><span class="comment" id="5120881">//&nbsp;Writes&nbsp;to&nbsp;a&nbsp;Writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5120936">type</span>&nbsp;<span class="ident" id="5120941">Writer</span>&nbsp;<span class="keyword" id="5120948">struct</span>&nbsp;<span class="op" id="5120955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120958">Header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120966">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5120978">io</span><span class="op" id="5120980">.</span><span class="ident" id="5120981">Writer</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120989">level</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5121001">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5121006">wroteHeader</span>&nbsp;<span class="builtintype" id="5121018">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5121024">compressor</span>&nbsp;&nbsp;<span class="op" id="5121036">*</span><span class="ident" id="5121037">flate</span><span class="op" id="5121042">.</span><span class="ident" id="5121043">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5121051">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5121063">hash</span><span class="op" id="5121067">.</span><span class="ident" id="5121068">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5121076">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5121088">uint32</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5121096">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5121108">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5121114">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5121126">[</span><span class="num" id="5121127">10</span><span class="op" id="5121129">]</span><span class="builtintype" id="5121130">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5121136">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5121148">error</span><br>
<span class="lineno"></span><span class="op" id="5121154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="5121157">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="comment" id="5121192">//&nbsp;Writes&nbsp;to&nbsp;the&nbsp;returned&nbsp;writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="5121258">//</span><br>
<span class="lineno"></span><span class="comment" id="5121261">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;WriteCloser&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="comment" id="5121342">//&nbsp;Writes&nbsp;may&nbsp;be&nbsp;buffered&nbsp;and&nbsp;not&nbsp;flushed&nbsp;until&nbsp;Close.</span><br>
<span class="lineno">45</span><span class="comment" id="5121397">//</span><br>
<span class="lineno"></span><span class="comment" id="5121400">//&nbsp;Callers&nbsp;that&nbsp;wish&nbsp;to&nbsp;set&nbsp;the&nbsp;fields&nbsp;in&nbsp;Writer.Header&nbsp;must&nbsp;do&nbsp;so&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="5121474">//&nbsp;the&nbsp;first&nbsp;call&nbsp;to&nbsp;Write&nbsp;or&nbsp;Close.&nbsp;The&nbsp;Comment&nbsp;and&nbsp;Name&nbsp;header&nbsp;fields&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="5121550">//&nbsp;UTF-8&nbsp;strings&nbsp;in&nbsp;Go,&nbsp;but&nbsp;the&nbsp;underlying&nbsp;format&nbsp;requires&nbsp;NUL-terminated&nbsp;ISO</span><br>
<span class="lineno"></span><span class="comment" id="5121628">//&nbsp;8859-1&nbsp;(Latin-1).&nbsp;NUL&nbsp;or&nbsp;non-Latin-1&nbsp;runes&nbsp;in&nbsp;those&nbsp;strings&nbsp;will&nbsp;lead&nbsp;to&nbsp;an</span><br>
<span class="lineno">50</span><span class="comment" id="5121707">//&nbsp;error&nbsp;on&nbsp;Write.</span><br>
<span class="lineno"></span><span class="keyword" id="5121726">func</span>&nbsp;<span class="ident" id="5121731">NewWriter</span><span class="op" id="5121740">(</span><span class="ident" id="5121741">w</span>&nbsp;<span class="ident" id="5121743">io</span><span class="op" id="5121745">.</span><span class="ident" id="5121746">Writer</span><span class="op" id="5121752">)</span>&nbsp;<span class="op" id="5121754">*</span><span class="ident" id="5121755">Writer</span>&nbsp;<span class="op" id="5121762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5121765">z</span><span class="op" id="5121766">,</span>&nbsp;<span class="ident" id="5121768">_</span>&nbsp;<span class="op" id="5121770">:=</span>&nbsp;<span class="ident" id="5121773">NewWriterLevel</span><span class="op" id="5121787">(</span><span class="ident" id="5121788">w</span><span class="op" id="5121789">,</span>&nbsp;<span class="ident" id="5121791">DefaultCompression</span><span class="op" id="5121809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5121812">return</span>&nbsp;<span class="ident" id="5121819">z</span><br>
<span class="lineno"></span><span class="op" id="5121821">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="5121824">//&nbsp;NewWriterLevel&nbsp;is&nbsp;like&nbsp;NewWriter&nbsp;but&nbsp;specifies&nbsp;the&nbsp;compression&nbsp;level&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="5121904">//&nbsp;of&nbsp;assuming&nbsp;DefaultCompression.</span><br>
<span class="lineno"></span><span class="comment" id="5121939">//</span><br>
<span class="lineno"></span><span class="comment" id="5121942">//&nbsp;The&nbsp;compression&nbsp;level&nbsp;can&nbsp;be&nbsp;DefaultCompression,&nbsp;NoCompression,&nbsp;or&nbsp;any</span><br>
<span class="lineno">60</span><span class="comment" id="5122016">//&nbsp;integer&nbsp;value&nbsp;between&nbsp;BestSpeed&nbsp;and&nbsp;BestCompression&nbsp;inclusive.&nbsp;The&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="5122092">//&nbsp;returned&nbsp;will&nbsp;be&nbsp;nil&nbsp;if&nbsp;the&nbsp;level&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="5122139">func</span>&nbsp;<span class="ident" id="5122144">NewWriterLevel</span><span class="op" id="5122158">(</span><span class="ident" id="5122159">w</span>&nbsp;<span class="ident" id="5122161">io</span><span class="op" id="5122163">.</span><span class="ident" id="5122164">Writer</span><span class="op" id="5122170">,</span>&nbsp;<span class="ident" id="5122172">level</span>&nbsp;<span class="builtintype" id="5122178">int</span><span class="op" id="5122181">)</span>&nbsp;<span class="op" id="5122183">(</span><span class="op" id="5122184">*</span><span class="ident" id="5122185">Writer</span><span class="op" id="5122191">,</span>&nbsp;<span class="builtintype" id="5122193">error</span><span class="op" id="5122198">)</span>&nbsp;<span class="op" id="5122200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5122203">if</span>&nbsp;<span class="ident" id="5122206">level</span>&nbsp;<span class="op" id="5122212">&lt;</span>&nbsp;<span class="ident" id="5122214">DefaultCompression</span>&nbsp;<span class="op" id="5122233">||</span>&nbsp;<span class="ident" id="5122236">level</span>&nbsp;<span class="op" id="5122242">&gt;</span>&nbsp;<span class="ident" id="5122244">BestCompression</span>&nbsp;<span class="op" id="5122260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5122264">return</span>&nbsp;<span class="ident" id="5122271">nil</span><span class="op" id="5122274">,</span>&nbsp;<span class="ident" id="5122276">fmt</span><span class="op" id="5122279">.</span><span class="ident" id="5122280">Errorf</span><span class="op" id="5122286">(</span><span class="string" id="5122287">&#34;gzip:&nbsp;invalid&nbsp;compression&nbsp;level:&nbsp;%d&#34;</span><span class="op" id="5122324">,</span>&nbsp;<span class="ident" id="5122326">level</span><span class="op" id="5122331">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5122334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5122337">z</span>&nbsp;<span class="op" id="5122339">:=</span>&nbsp;<span class="builtinfunc" id="5122342">new</span><span class="op" id="5122345">(</span><span class="ident" id="5122346">Writer</span><span class="op" id="5122352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5122355">z</span><span class="op" id="5122356">.</span><span class="ident" id="5122357">init</span><span class="op" id="5122361">(</span><span class="ident" id="5122362">w</span><span class="op" id="5122363">,</span>&nbsp;<span class="ident" id="5122365">level</span><span class="op" id="5122370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5122373">return</span>&nbsp;<span class="ident" id="5122380">z</span><span class="op" id="5122381">,</span>&nbsp;<span class="ident" id="5122383">nil</span><br>
<span class="lineno"></span><span class="op" id="5122387">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="5122390">func</span>&nbsp;<span class="op" id="5122395">(</span><span class="ident" id="5122396">z</span>&nbsp;<span class="op" id="5122398">*</span><span class="ident" id="5122399">Writer</span><span class="op" id="5122405">)</span>&nbsp;<span class="ident" id="5122407">init</span><span class="op" id="5122411">(</span><span class="ident" id="5122412">w</span>&nbsp;<span class="ident" id="5122414">io</span><span class="op" id="5122416">.</span><span class="ident" id="5122417">Writer</span><span class="op" id="5122423">,</span>&nbsp;<span class="ident" id="5122425">level</span>&nbsp;<span class="builtintype" id="5122431">int</span><span class="op" id="5122434">)</span>&nbsp;<span class="op" id="5122436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5122439">digest</span>&nbsp;<span class="op" id="5122446">:=</span>&nbsp;<span class="ident" id="5122449">z</span><span class="op" id="5122450">.</span><span class="ident" id="5122451">digest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5122459">if</span>&nbsp;<span class="ident" id="5122462">digest</span>&nbsp;<span class="op" id="5122469">!=</span>&nbsp;<span class="ident" id="5122472">nil</span>&nbsp;<span class="op" id="5122476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5122480">digest</span><span class="op" id="5122486">.</span><span class="ident" id="5122487">Reset</span><span class="op" id="5122492">(</span><span class="op" id="5122493">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5122496">}</span>&nbsp;<span class="keyword" id="5122498">else</span>&nbsp;<span class="op" id="5122503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5122507">digest</span>&nbsp;<span class="op" id="5122514">=</span>&nbsp;<span class="ident" id="5122516">crc32</span><span class="op" id="5122521">.</span><span class="ident" id="5122522">NewIEEE</span><span class="op" id="5122529">(</span><span class="op" id="5122530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5122533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5122536">compressor</span>&nbsp;<span class="op" id="5122547">:=</span>&nbsp;<span class="ident" id="5122550">z</span><span class="op" id="5122551">.</span><span class="ident" id="5122552">compressor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5122564">if</span>&nbsp;<span class="ident" id="5122567">compressor</span>&nbsp;<span class="op" id="5122578">!=</span>&nbsp;<span class="ident" id="5122581">nil</span>&nbsp;<span class="op" id="5122585">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5122589">compressor</span><span class="op" id="5122599">.</span><span class="ident" id="5122600">Reset</span><span class="op" id="5122605">(</span><span class="ident" id="5122606">w</span><span class="op" id="5122607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5122610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5122613">*</span><span class="ident" id="5122614">z</span>&nbsp;<span class="op" id="5122616">=</span>&nbsp;<span class="ident" id="5122618">Writer</span><span class="op" id="5122624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5122628">Header</span><span class="op" id="5122634">:</span>&nbsp;<span class="ident" id="5122636">Header</span><span class="op" id="5122642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5122647">OS</span><span class="op" id="5122649">:</span>&nbsp;<span class="num" id="5122651">255</span><span class="op" id="5122654">,</span>&nbsp;<span class="comment" id="5122656">//&nbsp;unknown</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5122669">}</span><span class="op" id="5122670">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5122674">w</span><span class="op" id="5122675">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5122686">w</span><span class="op" id="5122687">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5122691">level</span><span class="op" id="5122696">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5122703">level</span><span class="op" id="5122708">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5122712">digest</span><span class="op" id="5122718">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5122724">digest</span><span class="op" id="5122730">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5122734">compressor</span><span class="op" id="5122744">:</span>&nbsp;<span class="ident" id="5122746">compressor</span><span class="op" id="5122756">,</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5122759">}</span><br>
<span class="lineno"></span><span class="op" id="5122761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5122764">//&nbsp;Reset&nbsp;discards&nbsp;the&nbsp;Writer&nbsp;z&#39;s&nbsp;state&nbsp;and&nbsp;makes&nbsp;it&nbsp;equivalent&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5122834">//&nbsp;result&nbsp;of&nbsp;its&nbsp;original&nbsp;state&nbsp;from&nbsp;NewWriter&nbsp;or&nbsp;NewWriterLevel,&nbsp;but</span><br>
<span class="lineno">95</span><span class="comment" id="5122904">//&nbsp;writing&nbsp;to&nbsp;w&nbsp;instead.&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;Writer&nbsp;rather&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="5122971">//&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="5122996">func</span>&nbsp;<span class="op" id="5123001">(</span><span class="ident" id="5123002">z</span>&nbsp;<span class="op" id="5123004">*</span><span class="ident" id="5123005">Writer</span><span class="op" id="5123011">)</span>&nbsp;<span class="ident" id="5123013">Reset</span><span class="op" id="5123018">(</span><span class="ident" id="5123019">w</span>&nbsp;<span class="ident" id="5123021">io</span><span class="op" id="5123023">.</span><span class="ident" id="5123024">Writer</span><span class="op" id="5123030">)</span>&nbsp;<span class="op" id="5123032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5123035">z</span><span class="op" id="5123036">.</span><span class="ident" id="5123037">init</span><span class="op" id="5123041">(</span><span class="ident" id="5123042">w</span><span class="op" id="5123043">,</span>&nbsp;<span class="ident" id="5123045">z</span><span class="op" id="5123046">.</span><span class="ident" id="5123047">level</span><span class="op" id="5123052">)</span><br>
<span class="lineno"></span><span class="op" id="5123054">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="5123057">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;is&nbsp;little-endian,&nbsp;unlike&nbsp;ZLIB&nbsp;(RFC&nbsp;1950).</span><br>
<span class="lineno"></span><span class="keyword" id="5123118">func</span>&nbsp;<span class="ident" id="5123123">put2</span><span class="op" id="5123127">(</span><span class="ident" id="5123128">p</span>&nbsp;<span class="op" id="5123130">[</span><span class="op" id="5123131">]</span><span class="builtintype" id="5123132">byte</span><span class="op" id="5123136">,</span>&nbsp;<span class="ident" id="5123138">v</span>&nbsp;<span class="builtintype" id="5123140">uint16</span><span class="op" id="5123146">)</span>&nbsp;<span class="op" id="5123148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5123151">p</span><span class="op" id="5123152">[</span><span class="num" id="5123153">0</span><span class="op" id="5123154">]</span>&nbsp;<span class="op" id="5123156">=</span>&nbsp;<span class="builtintype" id="5123158">uint8</span><span class="op" id="5123163">(</span><span class="ident" id="5123164">v</span>&nbsp;<span class="op" id="5123166">&gt;&gt;</span>&nbsp;<span class="num" id="5123169">0</span><span class="op" id="5123170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5123173">p</span><span class="op" id="5123174">[</span><span class="num" id="5123175">1</span><span class="op" id="5123176">]</span>&nbsp;<span class="op" id="5123178">=</span>&nbsp;<span class="builtintype" id="5123180">uint8</span><span class="op" id="5123185">(</span><span class="ident" id="5123186">v</span>&nbsp;<span class="op" id="5123188">&gt;&gt;</span>&nbsp;<span class="num" id="5123191">8</span><span class="op" id="5123192">)</span><br>
<span class="lineno">105</span><span class="op" id="5123194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5123197">func</span>&nbsp;<span class="ident" id="5123202">put4</span><span class="op" id="5123206">(</span><span class="ident" id="5123207">p</span>&nbsp;<span class="op" id="5123209">[</span><span class="op" id="5123210">]</span><span class="builtintype" id="5123211">byte</span><span class="op" id="5123215">,</span>&nbsp;<span class="ident" id="5123217">v</span>&nbsp;<span class="builtintype" id="5123219">uint32</span><span class="op" id="5123225">)</span>&nbsp;<span class="op" id="5123227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5123230">p</span><span class="op" id="5123231">[</span><span class="num" id="5123232">0</span><span class="op" id="5123233">]</span>&nbsp;<span class="op" id="5123235">=</span>&nbsp;<span class="builtintype" id="5123237">uint8</span><span class="op" id="5123242">(</span><span class="ident" id="5123243">v</span>&nbsp;<span class="op" id="5123245">&gt;&gt;</span>&nbsp;<span class="num" id="5123248">0</span><span class="op" id="5123249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5123252">p</span><span class="op" id="5123253">[</span><span class="num" id="5123254">1</span><span class="op" id="5123255">]</span>&nbsp;<span class="op" id="5123257">=</span>&nbsp;<span class="builtintype" id="5123259">uint8</span><span class="op" id="5123264">(</span><span class="ident" id="5123265">v</span>&nbsp;<span class="op" id="5123267">&gt;&gt;</span>&nbsp;<span class="num" id="5123270">8</span><span class="op" id="5123271">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5123274">p</span><span class="op" id="5123275">[</span><span class="num" id="5123276">2</span><span class="op" id="5123277">]</span>&nbsp;<span class="op" id="5123279">=</span>&nbsp;<span class="builtintype" id="5123281">uint8</span><span class="op" id="5123286">(</span><span class="ident" id="5123287">v</span>&nbsp;<span class="op" id="5123289">&gt;&gt;</span>&nbsp;<span class="num" id="5123292">16</span><span class="op" id="5123294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5123297">p</span><span class="op" id="5123298">[</span><span class="num" id="5123299">3</span><span class="op" id="5123300">]</span>&nbsp;<span class="op" id="5123302">=</span>&nbsp;<span class="builtintype" id="5123304">uint8</span><span class="op" id="5123309">(</span><span class="ident" id="5123310">v</span>&nbsp;<span class="op" id="5123312">&gt;&gt;</span>&nbsp;<span class="num" id="5123315">24</span><span class="op" id="5123317">)</span><br>
<span class="lineno"></span><span class="op" id="5123319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5123322">//&nbsp;writeBytes&nbsp;writes&nbsp;a&nbsp;length-prefixed&nbsp;byte&nbsp;slice&nbsp;to&nbsp;z.w.</span><br>
<span class="lineno">115</span><span class="keyword" id="5123380">func</span>&nbsp;<span class="op" id="5123385">(</span><span class="ident" id="5123386">z</span>&nbsp;<span class="op" id="5123388">*</span><span class="ident" id="5123389">Writer</span><span class="op" id="5123395">)</span>&nbsp;<span class="ident" id="5123397">writeBytes</span><span class="op" id="5123407">(</span><span class="ident" id="5123408">b</span>&nbsp;<span class="op" id="5123410">[</span><span class="op" id="5123411">]</span><span class="builtintype" id="5123412">byte</span><span class="op" id="5123416">)</span>&nbsp;<span class="builtintype" id="5123418">error</span>&nbsp;<span class="op" id="5123424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5123427">if</span>&nbsp;<span class="builtinfunc" id="5123430">len</span><span class="op" id="5123433">(</span><span class="ident" id="5123434">b</span><span class="op" id="5123435">)</span>&nbsp;<span class="op" id="5123437">&gt;</span>&nbsp;<span class="num" id="5123439">0xffff</span>&nbsp;<span class="op" id="5123446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5123450">return</span>&nbsp;<span class="ident" id="5123457">errors</span><span class="op" id="5123463">.</span><span class="ident" id="5123464">New</span><span class="op" id="5123467">(</span><span class="string" id="5123468">&#34;gzip.Write:&nbsp;Extra&nbsp;data&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="5123505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5123508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5123511">put2</span><span class="op" id="5123515">(</span><span class="ident" id="5123516">z</span><span class="op" id="5123517">.</span><span class="ident" id="5123518">buf</span><span class="op" id="5123521">[</span><span class="num" id="5123522">0</span><span class="op" id="5123523">:</span><span class="num" id="5123524">2</span><span class="op" id="5123525">]</span><span class="op" id="5123526">,</span>&nbsp;<span class="builtintype" id="5123528">uint16</span><span class="op" id="5123534">(</span><span class="builtinfunc" id="5123535">len</span><span class="op" id="5123538">(</span><span class="ident" id="5123539">b</span><span class="op" id="5123540">)</span><span class="op" id="5123541">)</span><span class="op" id="5123542">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5123545">_</span><span class="op" id="5123546">,</span>&nbsp;<span class="ident" id="5123548">err</span>&nbsp;<span class="op" id="5123552">:=</span>&nbsp;<span class="ident" id="5123555">z</span><span class="op" id="5123556">.</span><span class="ident" id="5123557">w</span><span class="op" id="5123558">.</span><span class="ident" id="5123559">Write</span><span class="op" id="5123564">(</span><span class="ident" id="5123565">z</span><span class="op" id="5123566">.</span><span class="ident" id="5123567">buf</span><span class="op" id="5123570">[</span><span class="num" id="5123571">0</span><span class="op" id="5123572">:</span><span class="num" id="5123573">2</span><span class="op" id="5123574">]</span><span class="op" id="5123575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5123578">if</span>&nbsp;<span class="ident" id="5123581">err</span>&nbsp;<span class="op" id="5123585">!=</span>&nbsp;<span class="ident" id="5123588">nil</span>&nbsp;<span class="op" id="5123592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5123596">return</span>&nbsp;<span class="ident" id="5123603">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5123608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5123611">_</span><span class="op" id="5123612">,</span>&nbsp;<span class="ident" id="5123614">err</span>&nbsp;<span class="op" id="5123618">=</span>&nbsp;<span class="ident" id="5123620">z</span><span class="op" id="5123621">.</span><span class="ident" id="5123622">w</span><span class="op" id="5123623">.</span><span class="ident" id="5123624">Write</span><span class="op" id="5123629">(</span><span class="ident" id="5123630">b</span><span class="op" id="5123631">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5123634">return</span>&nbsp;<span class="ident" id="5123641">err</span><br>
<span class="lineno"></span><span class="op" id="5123645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5123648">//&nbsp;writeString&nbsp;writes&nbsp;a&nbsp;UTF-8&nbsp;string&nbsp;s&nbsp;in&nbsp;GZIP&#39;s&nbsp;format&nbsp;to&nbsp;z.w.</span><br>
<span class="lineno"></span><span class="comment" id="5123712">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;specifies&nbsp;that&nbsp;strings&nbsp;are&nbsp;NUL-terminated&nbsp;ISO&nbsp;8859-1&nbsp;(Latin-1).</span><br>
<span class="lineno">130</span><span class="keyword" id="5123795">func</span>&nbsp;<span class="op" id="5123800">(</span><span class="ident" id="5123801">z</span>&nbsp;<span class="op" id="5123803">*</span><span class="ident" id="5123804">Writer</span><span class="op" id="5123810">)</span>&nbsp;<span class="ident" id="5123812">writeString</span><span class="op" id="5123823">(</span><span class="ident" id="5123824">s</span>&nbsp;<span class="builtintype" id="5123826">string</span><span class="op" id="5123832">)</span>&nbsp;<span class="op" id="5123834">(</span><span class="ident" id="5123835">err</span>&nbsp;<span class="builtintype" id="5123839">error</span><span class="op" id="5123844">)</span>&nbsp;<span class="op" id="5123846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5123849">//&nbsp;GZIP&nbsp;stores&nbsp;Latin-1&nbsp;strings;&nbsp;error&nbsp;if&nbsp;non-Latin-1;&nbsp;convert&nbsp;if&nbsp;non-ASCII.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5123926">needconv</span>&nbsp;<span class="op" id="5123935">:=</span>&nbsp;<span class="builtintype" id="5123938">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5123945">for</span>&nbsp;<span class="ident" id="5123949">_</span><span class="op" id="5123950">,</span>&nbsp;<span class="ident" id="5123952">v</span>&nbsp;<span class="op" id="5123954">:=</span>&nbsp;<span class="keyword" id="5123957">range</span>&nbsp;<span class="ident" id="5123963">s</span>&nbsp;<span class="op" id="5123965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5123969">if</span>&nbsp;<span class="ident" id="5123972">v</span>&nbsp;<span class="op" id="5123974">==</span>&nbsp;<span class="num" id="5123977">0</span>&nbsp;<span class="op" id="5123979">||</span>&nbsp;<span class="ident" id="5123982">v</span>&nbsp;<span class="op" id="5123984">&gt;</span>&nbsp;<span class="num" id="5123986">0xff</span>&nbsp;<span class="op" id="5123991">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5123996">return</span>&nbsp;<span class="ident" id="5124003">errors</span><span class="op" id="5124009">.</span><span class="ident" id="5124010">New</span><span class="op" id="5124013">(</span><span class="string" id="5124014">&#34;gzip.Write:&nbsp;non-Latin-1&nbsp;header&nbsp;string&#34;</span><span class="op" id="5124053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5124057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124061">if</span>&nbsp;<span class="ident" id="5124064">v</span>&nbsp;<span class="op" id="5124066">&gt;</span>&nbsp;<span class="num" id="5124068">0x7f</span>&nbsp;<span class="op" id="5124073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124078">needconv</span>&nbsp;<span class="op" id="5124087">=</span>&nbsp;<span class="builtintype" id="5124089">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5124096">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5124099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124102">if</span>&nbsp;<span class="ident" id="5124105">needconv</span>&nbsp;<span class="op" id="5124114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124118">b</span>&nbsp;<span class="op" id="5124120">:=</span>&nbsp;<span class="builtinfunc" id="5124123">make</span><span class="op" id="5124127">(</span><span class="op" id="5124128">[</span><span class="op" id="5124129">]</span><span class="builtintype" id="5124130">byte</span><span class="op" id="5124134">,</span>&nbsp;<span class="num" id="5124136">0</span><span class="op" id="5124137">,</span>&nbsp;<span class="builtinfunc" id="5124139">len</span><span class="op" id="5124142">(</span><span class="ident" id="5124143">s</span><span class="op" id="5124144">)</span><span class="op" id="5124145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124149">for</span>&nbsp;<span class="ident" id="5124153">_</span><span class="op" id="5124154">,</span>&nbsp;<span class="ident" id="5124156">v</span>&nbsp;<span class="op" id="5124158">:=</span>&nbsp;<span class="keyword" id="5124161">range</span>&nbsp;<span class="ident" id="5124167">s</span>&nbsp;<span class="op" id="5124169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124174">b</span>&nbsp;<span class="op" id="5124176">=</span>&nbsp;<span class="builtinfunc" id="5124178">append</span><span class="op" id="5124184">(</span><span class="ident" id="5124185">b</span><span class="op" id="5124186">,</span>&nbsp;<span class="builtintype" id="5124188">byte</span><span class="op" id="5124192">(</span><span class="ident" id="5124193">v</span><span class="op" id="5124194">)</span><span class="op" id="5124195">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5124199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124203">_</span><span class="op" id="5124204">,</span>&nbsp;<span class="ident" id="5124206">err</span>&nbsp;<span class="op" id="5124210">=</span>&nbsp;<span class="ident" id="5124212">z</span><span class="op" id="5124213">.</span><span class="ident" id="5124214">w</span><span class="op" id="5124215">.</span><span class="ident" id="5124216">Write</span><span class="op" id="5124221">(</span><span class="ident" id="5124222">b</span><span class="op" id="5124223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5124226">}</span>&nbsp;<span class="keyword" id="5124228">else</span>&nbsp;<span class="op" id="5124233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124237">_</span><span class="op" id="5124238">,</span>&nbsp;<span class="ident" id="5124240">err</span>&nbsp;<span class="op" id="5124244">=</span>&nbsp;<span class="ident" id="5124246">io</span><span class="op" id="5124248">.</span><span class="ident" id="5124249">WriteString</span><span class="op" id="5124260">(</span><span class="ident" id="5124261">z</span><span class="op" id="5124262">.</span><span class="ident" id="5124263">w</span><span class="op" id="5124264">,</span>&nbsp;<span class="ident" id="5124266">s</span><span class="op" id="5124267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5124270">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124273">if</span>&nbsp;<span class="ident" id="5124276">err</span>&nbsp;<span class="op" id="5124280">!=</span>&nbsp;<span class="ident" id="5124283">nil</span>&nbsp;<span class="op" id="5124287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124291">return</span>&nbsp;<span class="ident" id="5124298">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5124303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5124306">//&nbsp;GZIP&nbsp;strings&nbsp;are&nbsp;NUL-terminated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124343">z</span><span class="op" id="5124344">.</span><span class="ident" id="5124345">buf</span><span class="op" id="5124348">[</span><span class="num" id="5124349">0</span><span class="op" id="5124350">]</span>&nbsp;<span class="op" id="5124352">=</span>&nbsp;<span class="num" id="5124354">0</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124357">_</span><span class="op" id="5124358">,</span>&nbsp;<span class="ident" id="5124360">err</span>&nbsp;<span class="op" id="5124364">=</span>&nbsp;<span class="ident" id="5124366">z</span><span class="op" id="5124367">.</span><span class="ident" id="5124368">w</span><span class="op" id="5124369">.</span><span class="ident" id="5124370">Write</span><span class="op" id="5124375">(</span><span class="ident" id="5124376">z</span><span class="op" id="5124377">.</span><span class="ident" id="5124378">buf</span><span class="op" id="5124381">[</span><span class="num" id="5124382">0</span><span class="op" id="5124383">:</span><span class="num" id="5124384">1</span><span class="op" id="5124385">]</span><span class="op" id="5124386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124389">return</span>&nbsp;<span class="ident" id="5124396">err</span><br>
<span class="lineno"></span><span class="op" id="5124400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5124403">//&nbsp;Write&nbsp;writes&nbsp;a&nbsp;compressed&nbsp;form&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.&nbsp;The</span><br>
<span class="lineno">160</span><span class="comment" id="5124475">//&nbsp;compressed&nbsp;bytes&nbsp;are&nbsp;not&nbsp;necessarily&nbsp;flushed&nbsp;until&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="5124551">func</span>&nbsp;<span class="op" id="5124556">(</span><span class="ident" id="5124557">z</span>&nbsp;<span class="op" id="5124559">*</span><span class="ident" id="5124560">Writer</span><span class="op" id="5124566">)</span>&nbsp;<span class="ident" id="5124568">Write</span><span class="op" id="5124573">(</span><span class="ident" id="5124574">p</span>&nbsp;<span class="op" id="5124576">[</span><span class="op" id="5124577">]</span><span class="builtintype" id="5124578">byte</span><span class="op" id="5124582">)</span>&nbsp;<span class="op" id="5124584">(</span><span class="builtintype" id="5124585">int</span><span class="op" id="5124588">,</span>&nbsp;<span class="builtintype" id="5124590">error</span><span class="op" id="5124595">)</span>&nbsp;<span class="op" id="5124597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124600">if</span>&nbsp;<span class="ident" id="5124603">z</span><span class="op" id="5124604">.</span><span class="ident" id="5124605">err</span>&nbsp;<span class="op" id="5124609">!=</span>&nbsp;<span class="ident" id="5124612">nil</span>&nbsp;<span class="op" id="5124616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124620">return</span>&nbsp;<span class="num" id="5124627">0</span><span class="op" id="5124628">,</span>&nbsp;<span class="ident" id="5124630">z</span><span class="op" id="5124631">.</span><span class="ident" id="5124632">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5124637">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124640">var</span>&nbsp;<span class="ident" id="5124644">n</span>&nbsp;<span class="builtintype" id="5124646">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5124651">//&nbsp;Write&nbsp;the&nbsp;GZIP&nbsp;header&nbsp;lazily.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124685">if</span>&nbsp;<span class="op" id="5124688">!</span><span class="ident" id="5124689">z</span><span class="op" id="5124690">.</span><span class="ident" id="5124691">wroteHeader</span>&nbsp;<span class="op" id="5124703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124707">z</span><span class="op" id="5124708">.</span><span class="ident" id="5124709">wroteHeader</span>&nbsp;<span class="op" id="5124721">=</span>&nbsp;<span class="builtintype" id="5124723">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124730">z</span><span class="op" id="5124731">.</span><span class="ident" id="5124732">buf</span><span class="op" id="5124735">[</span><span class="num" id="5124736">0</span><span class="op" id="5124737">]</span>&nbsp;<span class="op" id="5124739">=</span>&nbsp;<span class="ident" id="5124741">gzipID1</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124751">z</span><span class="op" id="5124752">.</span><span class="ident" id="5124753">buf</span><span class="op" id="5124756">[</span><span class="num" id="5124757">1</span><span class="op" id="5124758">]</span>&nbsp;<span class="op" id="5124760">=</span>&nbsp;<span class="ident" id="5124762">gzipID2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124772">z</span><span class="op" id="5124773">.</span><span class="ident" id="5124774">buf</span><span class="op" id="5124777">[</span><span class="num" id="5124778">2</span><span class="op" id="5124779">]</span>&nbsp;<span class="op" id="5124781">=</span>&nbsp;<span class="ident" id="5124783">gzipDeflate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124797">z</span><span class="op" id="5124798">.</span><span class="ident" id="5124799">buf</span><span class="op" id="5124802">[</span><span class="num" id="5124803">3</span><span class="op" id="5124804">]</span>&nbsp;<span class="op" id="5124806">=</span>&nbsp;<span class="num" id="5124808">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124812">if</span>&nbsp;<span class="ident" id="5124815">z</span><span class="op" id="5124816">.</span><span class="ident" id="5124817">Extra</span>&nbsp;<span class="op" id="5124823">!=</span>&nbsp;<span class="ident" id="5124826">nil</span>&nbsp;<span class="op" id="5124830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124835">z</span><span class="op" id="5124836">.</span><span class="ident" id="5124837">buf</span><span class="op" id="5124840">[</span><span class="num" id="5124841">3</span><span class="op" id="5124842">]</span>&nbsp;<span class="op" id="5124844">|=</span>&nbsp;<span class="num" id="5124847">0x04</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5124854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124858">if</span>&nbsp;<span class="ident" id="5124861">z</span><span class="op" id="5124862">.</span><span class="ident" id="5124863">Name</span>&nbsp;<span class="op" id="5124868">!=</span>&nbsp;<span class="string" id="5124871">&#34;&#34;</span>&nbsp;<span class="op" id="5124874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124879">z</span><span class="op" id="5124880">.</span><span class="ident" id="5124881">buf</span><span class="op" id="5124884">[</span><span class="num" id="5124885">3</span><span class="op" id="5124886">]</span>&nbsp;<span class="op" id="5124888">|=</span>&nbsp;<span class="num" id="5124891">0x08</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5124898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124902">if</span>&nbsp;<span class="ident" id="5124905">z</span><span class="op" id="5124906">.</span><span class="ident" id="5124907">Comment</span>&nbsp;<span class="op" id="5124915">!=</span>&nbsp;<span class="string" id="5124918">&#34;&#34;</span>&nbsp;<span class="op" id="5124921">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124926">z</span><span class="op" id="5124927">.</span><span class="ident" id="5124928">buf</span><span class="op" id="5124931">[</span><span class="num" id="5124932">3</span><span class="op" id="5124933">]</span>&nbsp;<span class="op" id="5124935">|=</span>&nbsp;<span class="num" id="5124938">0x10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5124945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124949">put4</span><span class="op" id="5124953">(</span><span class="ident" id="5124954">z</span><span class="op" id="5124955">.</span><span class="ident" id="5124956">buf</span><span class="op" id="5124959">[</span><span class="num" id="5124960">4</span><span class="op" id="5124961">:</span><span class="num" id="5124962">8</span><span class="op" id="5124963">]</span><span class="op" id="5124964">,</span>&nbsp;<span class="builtintype" id="5124966">uint32</span><span class="op" id="5124972">(</span><span class="ident" id="5124973">z</span><span class="op" id="5124974">.</span><span class="ident" id="5124975">ModTime</span><span class="op" id="5124982">.</span><span class="ident" id="5124983">Unix</span><span class="op" id="5124987">(</span><span class="op" id="5124988">)</span><span class="op" id="5124989">)</span><span class="op" id="5124990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124994">if</span>&nbsp;<span class="ident" id="5124997">z</span><span class="op" id="5124998">.</span><span class="ident" id="5124999">level</span>&nbsp;<span class="op" id="5125005">==</span>&nbsp;<span class="ident" id="5125008">BestCompression</span>&nbsp;<span class="op" id="5125024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125029">z</span><span class="op" id="5125030">.</span><span class="ident" id="5125031">buf</span><span class="op" id="5125034">[</span><span class="num" id="5125035">8</span><span class="op" id="5125036">]</span>&nbsp;<span class="op" id="5125038">=</span>&nbsp;<span class="num" id="5125040">2</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5125044">}</span>&nbsp;<span class="keyword" id="5125046">else</span>&nbsp;<span class="keyword" id="5125051">if</span>&nbsp;<span class="ident" id="5125054">z</span><span class="op" id="5125055">.</span><span class="ident" id="5125056">level</span>&nbsp;<span class="op" id="5125062">==</span>&nbsp;<span class="ident" id="5125065">BestSpeed</span>&nbsp;<span class="op" id="5125075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125080">z</span><span class="op" id="5125081">.</span><span class="ident" id="5125082">buf</span><span class="op" id="5125085">[</span><span class="num" id="5125086">8</span><span class="op" id="5125087">]</span>&nbsp;<span class="op" id="5125089">=</span>&nbsp;<span class="num" id="5125091">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5125095">}</span>&nbsp;<span class="keyword" id="5125097">else</span>&nbsp;<span class="op" id="5125102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125107">z</span><span class="op" id="5125108">.</span><span class="ident" id="5125109">buf</span><span class="op" id="5125112">[</span><span class="num" id="5125113">8</span><span class="op" id="5125114">]</span>&nbsp;<span class="op" id="5125116">=</span>&nbsp;<span class="num" id="5125118">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5125122">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125126">z</span><span class="op" id="5125127">.</span><span class="ident" id="5125128">buf</span><span class="op" id="5125131">[</span><span class="num" id="5125132">9</span><span class="op" id="5125133">]</span>&nbsp;<span class="op" id="5125135">=</span>&nbsp;<span class="ident" id="5125137">z</span><span class="op" id="5125138">.</span><span class="ident" id="5125139">OS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125144">n</span><span class="op" id="5125145">,</span>&nbsp;<span class="ident" id="5125147">z</span><span class="op" id="5125148">.</span><span class="ident" id="5125149">err</span>&nbsp;<span class="op" id="5125153">=</span>&nbsp;<span class="ident" id="5125155">z</span><span class="op" id="5125156">.</span><span class="ident" id="5125157">w</span><span class="op" id="5125158">.</span><span class="ident" id="5125159">Write</span><span class="op" id="5125164">(</span><span class="ident" id="5125165">z</span><span class="op" id="5125166">.</span><span class="ident" id="5125167">buf</span><span class="op" id="5125170">[</span><span class="num" id="5125171">0</span><span class="op" id="5125172">:</span><span class="num" id="5125173">10</span><span class="op" id="5125175">]</span><span class="op" id="5125176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5125180">if</span>&nbsp;<span class="ident" id="5125183">z</span><span class="op" id="5125184">.</span><span class="ident" id="5125185">err</span>&nbsp;<span class="op" id="5125189">!=</span>&nbsp;<span class="ident" id="5125192">nil</span>&nbsp;<span class="op" id="5125196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5125201">return</span>&nbsp;<span class="ident" id="5125208">n</span><span class="op" id="5125209">,</span>&nbsp;<span class="ident" id="5125211">z</span><span class="op" id="5125212">.</span><span class="ident" id="5125213">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5125219">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5125223">if</span>&nbsp;<span class="ident" id="5125226">z</span><span class="op" id="5125227">.</span><span class="ident" id="5125228">Extra</span>&nbsp;<span class="op" id="5125234">!=</span>&nbsp;<span class="ident" id="5125237">nil</span>&nbsp;<span class="op" id="5125241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125246">z</span><span class="op" id="5125247">.</span><span class="ident" id="5125248">err</span>&nbsp;<span class="op" id="5125252">=</span>&nbsp;<span class="ident" id="5125254">z</span><span class="op" id="5125255">.</span><span class="ident" id="5125256">writeBytes</span><span class="op" id="5125266">(</span><span class="ident" id="5125267">z</span><span class="op" id="5125268">.</span><span class="ident" id="5125269">Extra</span><span class="op" id="5125274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5125279">if</span>&nbsp;<span class="ident" id="5125282">z</span><span class="op" id="5125283">.</span><span class="ident" id="5125284">err</span>&nbsp;<span class="op" id="5125288">!=</span>&nbsp;<span class="ident" id="5125291">nil</span>&nbsp;<span class="op" id="5125295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5125301">return</span>&nbsp;<span class="ident" id="5125308">n</span><span class="op" id="5125309">,</span>&nbsp;<span class="ident" id="5125311">z</span><span class="op" id="5125312">.</span><span class="ident" id="5125313">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5125320">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5125324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5125328">if</span>&nbsp;<span class="ident" id="5125331">z</span><span class="op" id="5125332">.</span><span class="ident" id="5125333">Name</span>&nbsp;<span class="op" id="5125338">!=</span>&nbsp;<span class="string" id="5125341">&#34;&#34;</span>&nbsp;<span class="op" id="5125344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125349">z</span><span class="op" id="5125350">.</span><span class="ident" id="5125351">err</span>&nbsp;<span class="op" id="5125355">=</span>&nbsp;<span class="ident" id="5125357">z</span><span class="op" id="5125358">.</span><span class="ident" id="5125359">writeString</span><span class="op" id="5125370">(</span><span class="ident" id="5125371">z</span><span class="op" id="5125372">.</span><span class="ident" id="5125373">Name</span><span class="op" id="5125377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5125382">if</span>&nbsp;<span class="ident" id="5125385">z</span><span class="op" id="5125386">.</span><span class="ident" id="5125387">err</span>&nbsp;<span class="op" id="5125391">!=</span>&nbsp;<span class="ident" id="5125394">nil</span>&nbsp;<span class="op" id="5125398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5125404">return</span>&nbsp;<span class="ident" id="5125411">n</span><span class="op" id="5125412">,</span>&nbsp;<span class="ident" id="5125414">z</span><span class="op" id="5125415">.</span><span class="ident" id="5125416">err</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5125423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5125427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5125431">if</span>&nbsp;<span class="ident" id="5125434">z</span><span class="op" id="5125435">.</span><span class="ident" id="5125436">Comment</span>&nbsp;<span class="op" id="5125444">!=</span>&nbsp;<span class="string" id="5125447">&#34;&#34;</span>&nbsp;<span class="op" id="5125450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125455">z</span><span class="op" id="5125456">.</span><span class="ident" id="5125457">err</span>&nbsp;<span class="op" id="5125461">=</span>&nbsp;<span class="ident" id="5125463">z</span><span class="op" id="5125464">.</span><span class="ident" id="5125465">writeString</span><span class="op" id="5125476">(</span><span class="ident" id="5125477">z</span><span class="op" id="5125478">.</span><span class="ident" id="5125479">Comment</span><span class="op" id="5125486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5125491">if</span>&nbsp;<span class="ident" id="5125494">z</span><span class="op" id="5125495">.</span><span class="ident" id="5125496">err</span>&nbsp;<span class="op" id="5125500">!=</span>&nbsp;<span class="ident" id="5125503">nil</span>&nbsp;<span class="op" id="5125507">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5125513">return</span>&nbsp;<span class="ident" id="5125520">n</span><span class="op" id="5125521">,</span>&nbsp;<span class="ident" id="5125523">z</span><span class="op" id="5125524">.</span><span class="ident" id="5125525">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5125532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5125536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5125540">if</span>&nbsp;<span class="ident" id="5125543">z</span><span class="op" id="5125544">.</span><span class="ident" id="5125545">compressor</span>&nbsp;<span class="op" id="5125556">==</span>&nbsp;<span class="ident" id="5125559">nil</span>&nbsp;<span class="op" id="5125563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125568">z</span><span class="op" id="5125569">.</span><span class="ident" id="5125570">compressor</span><span class="op" id="5125580">,</span>&nbsp;<span class="ident" id="5125582">_</span>&nbsp;<span class="op" id="5125584">=</span>&nbsp;<span class="ident" id="5125586">flate</span><span class="op" id="5125591">.</span><span class="ident" id="5125592">NewWriter</span><span class="op" id="5125601">(</span><span class="ident" id="5125602">z</span><span class="op" id="5125603">.</span><span class="ident" id="5125604">w</span><span class="op" id="5125605">,</span>&nbsp;<span class="ident" id="5125607">z</span><span class="op" id="5125608">.</span><span class="ident" id="5125609">level</span><span class="op" id="5125614">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5125618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5125621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125624">z</span><span class="op" id="5125625">.</span><span class="ident" id="5125626">size</span>&nbsp;<span class="op" id="5125631">+=</span>&nbsp;<span class="builtintype" id="5125634">uint32</span><span class="op" id="5125640">(</span><span class="builtinfunc" id="5125641">len</span><span class="op" id="5125644">(</span><span class="ident" id="5125645">p</span><span class="op" id="5125646">)</span><span class="op" id="5125647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125650">z</span><span class="op" id="5125651">.</span><span class="ident" id="5125652">digest</span><span class="op" id="5125658">.</span><span class="ident" id="5125659">Write</span><span class="op" id="5125664">(</span><span class="ident" id="5125665">p</span><span class="op" id="5125666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125669">n</span><span class="op" id="5125670">,</span>&nbsp;<span class="ident" id="5125672">z</span><span class="op" id="5125673">.</span><span class="ident" id="5125674">err</span>&nbsp;<span class="op" id="5125678">=</span>&nbsp;<span class="ident" id="5125680">z</span><span class="op" id="5125681">.</span><span class="ident" id="5125682">compressor</span><span class="op" id="5125692">.</span><span class="ident" id="5125693">Write</span><span class="op" id="5125698">(</span><span class="ident" id="5125699">p</span><span class="op" id="5125700">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5125703">return</span>&nbsp;<span class="ident" id="5125710">n</span><span class="op" id="5125711">,</span>&nbsp;<span class="ident" id="5125713">z</span><span class="op" id="5125714">.</span><span class="ident" id="5125715">err</span><br>
<span class="lineno"></span><span class="op" id="5125719">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5125722">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;compressed&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="comment" id="5125793">//</span><br>
<span class="lineno">225</span><span class="comment" id="5125796">//&nbsp;It&nbsp;is&nbsp;useful&nbsp;mainly&nbsp;in&nbsp;compressed&nbsp;network&nbsp;protocols,&nbsp;to&nbsp;ensure&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5125867">//&nbsp;a&nbsp;remote&nbsp;reader&nbsp;has&nbsp;enough&nbsp;data&nbsp;to&nbsp;reconstruct&nbsp;a&nbsp;packet.&nbsp;Flush&nbsp;does</span><br>
<span class="lineno"></span><span class="comment" id="5125938">//&nbsp;not&nbsp;return&nbsp;until&nbsp;the&nbsp;data&nbsp;has&nbsp;been&nbsp;written.&nbsp;If&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="5126003">//&nbsp;writer&nbsp;returns&nbsp;an&nbsp;error,&nbsp;Flush&nbsp;returns&nbsp;that&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="5126057">//</span><br>
<span class="lineno">230</span><span class="comment" id="5126060">//&nbsp;In&nbsp;the&nbsp;terminology&nbsp;of&nbsp;the&nbsp;zlib&nbsp;library,&nbsp;Flush&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Z_SYNC_FLUSH.</span><br>
<span class="lineno"></span><span class="keyword" id="5126140">func</span>&nbsp;<span class="op" id="5126145">(</span><span class="ident" id="5126146">z</span>&nbsp;<span class="op" id="5126148">*</span><span class="ident" id="5126149">Writer</span><span class="op" id="5126155">)</span>&nbsp;<span class="ident" id="5126157">Flush</span><span class="op" id="5126162">(</span><span class="op" id="5126163">)</span>&nbsp;<span class="builtintype" id="5126165">error</span>&nbsp;<span class="op" id="5126171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5126174">if</span>&nbsp;<span class="ident" id="5126177">z</span><span class="op" id="5126178">.</span><span class="ident" id="5126179">err</span>&nbsp;<span class="op" id="5126183">!=</span>&nbsp;<span class="ident" id="5126186">nil</span>&nbsp;<span class="op" id="5126190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5126194">return</span>&nbsp;<span class="ident" id="5126201">z</span><span class="op" id="5126202">.</span><span class="ident" id="5126203">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5126208">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5126211">if</span>&nbsp;<span class="ident" id="5126214">z</span><span class="op" id="5126215">.</span><span class="ident" id="5126216">closed</span>&nbsp;<span class="op" id="5126223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5126227">return</span>&nbsp;<span class="ident" id="5126234">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5126239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5126242">if</span>&nbsp;<span class="op" id="5126245">!</span><span class="ident" id="5126246">z</span><span class="op" id="5126247">.</span><span class="ident" id="5126248">wroteHeader</span>&nbsp;<span class="op" id="5126260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5126264">z</span><span class="op" id="5126265">.</span><span class="ident" id="5126266">Write</span><span class="op" id="5126271">(</span><span class="ident" id="5126272">nil</span><span class="op" id="5126275">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5126279">if</span>&nbsp;<span class="ident" id="5126282">z</span><span class="op" id="5126283">.</span><span class="ident" id="5126284">err</span>&nbsp;<span class="op" id="5126288">!=</span>&nbsp;<span class="ident" id="5126291">nil</span>&nbsp;<span class="op" id="5126295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5126300">return</span>&nbsp;<span class="ident" id="5126307">z</span><span class="op" id="5126308">.</span><span class="ident" id="5126309">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5126315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5126318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5126321">z</span><span class="op" id="5126322">.</span><span class="ident" id="5126323">err</span>&nbsp;<span class="op" id="5126327">=</span>&nbsp;<span class="ident" id="5126329">z</span><span class="op" id="5126330">.</span><span class="ident" id="5126331">compressor</span><span class="op" id="5126341">.</span><span class="ident" id="5126342">Flush</span><span class="op" id="5126347">(</span><span class="op" id="5126348">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5126351">return</span>&nbsp;<span class="ident" id="5126358">z</span><span class="op" id="5126359">.</span><span class="ident" id="5126360">err</span><br>
<span class="lineno"></span><span class="op" id="5126364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5126367">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Writer,&nbsp;flushing&nbsp;any&nbsp;unwritten&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="5126441">//&nbsp;io.Writer,&nbsp;but&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno">250</span><span class="keyword" id="5126500">func</span>&nbsp;<span class="op" id="5126505">(</span><span class="ident" id="5126506">z</span>&nbsp;<span class="op" id="5126508">*</span><span class="ident" id="5126509">Writer</span><span class="op" id="5126515">)</span>&nbsp;<span class="ident" id="5126517">Close</span><span class="op" id="5126522">(</span><span class="op" id="5126523">)</span>&nbsp;<span class="builtintype" id="5126525">error</span>&nbsp;<span class="op" id="5126531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5126534">if</span>&nbsp;<span class="ident" id="5126537">z</span><span class="op" id="5126538">.</span><span class="ident" id="5126539">err</span>&nbsp;<span class="op" id="5126543">!=</span>&nbsp;<span class="ident" id="5126546">nil</span>&nbsp;<span class="op" id="5126550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5126554">return</span>&nbsp;<span class="ident" id="5126561">z</span><span class="op" id="5126562">.</span><span class="ident" id="5126563">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5126568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5126571">if</span>&nbsp;<span class="ident" id="5126574">z</span><span class="op" id="5126575">.</span><span class="ident" id="5126576">closed</span>&nbsp;<span class="op" id="5126583">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5126587">return</span>&nbsp;<span class="ident" id="5126594">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5126599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5126602">z</span><span class="op" id="5126603">.</span><span class="ident" id="5126604">closed</span>&nbsp;<span class="op" id="5126611">=</span>&nbsp;<span class="builtintype" id="5126613">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5126619">if</span>&nbsp;<span class="op" id="5126622">!</span><span class="ident" id="5126623">z</span><span class="op" id="5126624">.</span><span class="ident" id="5126625">wroteHeader</span>&nbsp;<span class="op" id="5126637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5126641">z</span><span class="op" id="5126642">.</span><span class="ident" id="5126643">Write</span><span class="op" id="5126648">(</span><span class="ident" id="5126649">nil</span><span class="op" id="5126652">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5126656">if</span>&nbsp;<span class="ident" id="5126659">z</span><span class="op" id="5126660">.</span><span class="ident" id="5126661">err</span>&nbsp;<span class="op" id="5126665">!=</span>&nbsp;<span class="ident" id="5126668">nil</span>&nbsp;<span class="op" id="5126672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5126677">return</span>&nbsp;<span class="ident" id="5126684">z</span><span class="op" id="5126685">.</span><span class="ident" id="5126686">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5126692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5126695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5126698">z</span><span class="op" id="5126699">.</span><span class="ident" id="5126700">err</span>&nbsp;<span class="op" id="5126704">=</span>&nbsp;<span class="ident" id="5126706">z</span><span class="op" id="5126707">.</span><span class="ident" id="5126708">compressor</span><span class="op" id="5126718">.</span><span class="ident" id="5126719">Close</span><span class="op" id="5126724">(</span><span class="op" id="5126725">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5126728">if</span>&nbsp;<span class="ident" id="5126731">z</span><span class="op" id="5126732">.</span><span class="ident" id="5126733">err</span>&nbsp;<span class="op" id="5126737">!=</span>&nbsp;<span class="ident" id="5126740">nil</span>&nbsp;<span class="op" id="5126744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5126748">return</span>&nbsp;<span class="ident" id="5126755">z</span><span class="op" id="5126756">.</span><span class="ident" id="5126757">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5126762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5126765">put4</span><span class="op" id="5126769">(</span><span class="ident" id="5126770">z</span><span class="op" id="5126771">.</span><span class="ident" id="5126772">buf</span><span class="op" id="5126775">[</span><span class="num" id="5126776">0</span><span class="op" id="5126777">:</span><span class="num" id="5126778">4</span><span class="op" id="5126779">]</span><span class="op" id="5126780">,</span>&nbsp;<span class="ident" id="5126782">z</span><span class="op" id="5126783">.</span><span class="ident" id="5126784">digest</span><span class="op" id="5126790">.</span><span class="ident" id="5126791">Sum32</span><span class="op" id="5126796">(</span><span class="op" id="5126797">)</span><span class="op" id="5126798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5126801">put4</span><span class="op" id="5126805">(</span><span class="ident" id="5126806">z</span><span class="op" id="5126807">.</span><span class="ident" id="5126808">buf</span><span class="op" id="5126811">[</span><span class="num" id="5126812">4</span><span class="op" id="5126813">:</span><span class="num" id="5126814">8</span><span class="op" id="5126815">]</span><span class="op" id="5126816">,</span>&nbsp;<span class="ident" id="5126818">z</span><span class="op" id="5126819">.</span><span class="ident" id="5126820">size</span><span class="op" id="5126824">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5126827">_</span><span class="op" id="5126828">,</span>&nbsp;<span class="ident" id="5126830">z</span><span class="op" id="5126831">.</span><span class="ident" id="5126832">err</span>&nbsp;<span class="op" id="5126836">=</span>&nbsp;<span class="ident" id="5126838">z</span><span class="op" id="5126839">.</span><span class="ident" id="5126840">w</span><span class="op" id="5126841">.</span><span class="ident" id="5126842">Write</span><span class="op" id="5126847">(</span><span class="ident" id="5126848">z</span><span class="op" id="5126849">.</span><span class="ident" id="5126850">buf</span><span class="op" id="5126853">[</span><span class="num" id="5126854">0</span><span class="op" id="5126855">:</span><span class="num" id="5126856">8</span><span class="op" id="5126857">]</span><span class="op" id="5126858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5126861">return</span>&nbsp;<span class="ident" id="5126868">z</span><span class="op" id="5126869">.</span><span class="ident" id="5126870">err</span><br>
<span class="lineno"></span><span class="op" id="5126874">}</span>
</div>
</body>
</html>
