<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html" class="current">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7775521">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7775576">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7775630">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7775681">package</span>&nbsp;<span class="ident" id="7775689">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7775694">import</span>&nbsp;<span class="op" id="7775701">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7775704">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7775713">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7775729">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7775743">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7775758">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7775774">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7775781">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7775787">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7775794">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7775800">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7775811">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7775828">&#34;strconv&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7775839">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7775850">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7775857">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7775860">//&nbsp;Note:&nbsp;see&nbsp;comment&nbsp;in&nbsp;handshake_test.go&nbsp;for&nbsp;details&nbsp;of&nbsp;how&nbsp;the&nbsp;reference</span><br>
<span class="lineno">25</span><span class="comment" id="7775935">//&nbsp;tests&nbsp;work.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7775951">//&nbsp;blockingSource&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;blocks&nbsp;a&nbsp;Read&nbsp;call&nbsp;until&nbsp;it&#39;s&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="7776028">type</span>&nbsp;<span class="ident" id="7776033">blockingSource</span>&nbsp;<span class="keyword" id="7776048">chan</span>&nbsp;<span class="builtintype" id="7776053">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7776059">func</span>&nbsp;<span class="op" id="7776064">(</span><span class="ident" id="7776065">b</span>&nbsp;<span class="ident" id="7776067">blockingSource</span><span class="op" id="7776081">)</span>&nbsp;<span class="ident" id="7776083">Read</span><span class="op" id="7776087">(</span><span class="op" id="7776088">[</span><span class="op" id="7776089">]</span><span class="builtintype" id="7776090">byte</span><span class="op" id="7776094">)</span>&nbsp;<span class="op" id="7776096">(</span><span class="ident" id="7776097">n</span>&nbsp;<span class="builtintype" id="7776099">int</span><span class="op" id="7776102">,</span>&nbsp;<span class="ident" id="7776104">err</span>&nbsp;<span class="builtintype" id="7776108">error</span><span class="op" id="7776113">)</span>&nbsp;<span class="op" id="7776115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7776118">&lt;-</span><span class="ident" id="7776120">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7776123">return</span>&nbsp;<span class="num" id="7776130">0</span><span class="op" id="7776131">,</span>&nbsp;<span class="ident" id="7776133">io</span><span class="op" id="7776135">.</span><span class="ident" id="7776136">EOF</span><br>
<span class="lineno"></span><span class="op" id="7776140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="7776143">//&nbsp;clientTest&nbsp;represents&nbsp;a&nbsp;test&nbsp;of&nbsp;the&nbsp;TLS&nbsp;client&nbsp;handshake&nbsp;against&nbsp;a&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="7776223">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="7776242">type</span>&nbsp;<span class="ident" id="7776247">clientTest</span>&nbsp;<span class="keyword" id="7776258">struct</span>&nbsp;<span class="op" id="7776265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7776268">//&nbsp;name&nbsp;is&nbsp;a&nbsp;freeform&nbsp;string&nbsp;identifying&nbsp;the&nbsp;test&nbsp;and&nbsp;the&nbsp;file&nbsp;in&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7776341">//&nbsp;the&nbsp;expected&nbsp;results&nbsp;will&nbsp;be&nbsp;stored.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7776382">name</span>&nbsp;<span class="builtintype" id="7776387">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7776395">//&nbsp;command,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;series&nbsp;of&nbsp;arguments&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7776461">//&nbsp;command&nbsp;to&nbsp;run&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7776506">command</span>&nbsp;<span class="op" id="7776514">[</span><span class="op" id="7776515">]</span><span class="builtintype" id="7776516">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7776524">//&nbsp;config,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;a&nbsp;custom&nbsp;Config&nbsp;to&nbsp;use&nbsp;for&nbsp;this&nbsp;test.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7776595">config</span>&nbsp;<span class="op" id="7776602">*</span><span class="ident" id="7776603">Config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7776611">//&nbsp;cert,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;DER-encoded&nbsp;certificate&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7776678">//&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7776700">cert</span>&nbsp;<span class="op" id="7776705">[</span><span class="op" id="7776706">]</span><span class="builtintype" id="7776707">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7776713">//&nbsp;key,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;either&nbsp;a&nbsp;*rsa.PrivateKey&nbsp;or</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7776771">//&nbsp;*ecdsa.PrivateKey&nbsp;which&nbsp;is&nbsp;the&nbsp;private&nbsp;key&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7776844">key</span>&nbsp;<span class="keyword" id="7776848">interface</span><span class="op" id="7776857">{</span><span class="op" id="7776858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7776861">//&nbsp;validate,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7776930">//&nbsp;ConnectionState&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;It&nbsp;returns&nbsp;a&nbsp;non-nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7777000">//&nbsp;error&nbsp;if&nbsp;the&nbsp;ConnectionState&nbsp;is&nbsp;unacceptable.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7777050">validate</span>&nbsp;<span class="keyword" id="7777059">func</span><span class="op" id="7777063">(</span><span class="ident" id="7777064">ConnectionState</span><span class="op" id="7777079">)</span>&nbsp;<span class="builtintype" id="7777081">error</span><br>
<span class="lineno"></span><span class="op" id="7777087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7777090">var</span>&nbsp;<span class="ident" id="7777094">defaultServerCommand</span>&nbsp;<span class="op" id="7777115">=</span>&nbsp;<span class="op" id="7777117">[</span><span class="op" id="7777118">]</span><span class="builtintype" id="7777119">string</span><span class="op" id="7777125">{</span><span class="string" id="7777126">&#34;openssl&#34;</span><span class="op" id="7777135">,</span>&nbsp;<span class="string" id="7777137">&#34;s_server&#34;</span><span class="op" id="7777147">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="7777150">//&nbsp;connFromCommand&nbsp;starts&nbsp;the&nbsp;reference&nbsp;server&nbsp;process,&nbsp;connects&nbsp;to&nbsp;it&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="7777225">//&nbsp;returns&nbsp;a&nbsp;recordingConn&nbsp;for&nbsp;the&nbsp;connection.&nbsp;The&nbsp;stdin&nbsp;return&nbsp;value&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="7777300">//&nbsp;blockingSource&nbsp;for&nbsp;the&nbsp;stdin&nbsp;of&nbsp;the&nbsp;child&nbsp;process.&nbsp;It&nbsp;must&nbsp;be&nbsp;closed&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="7777379">//&nbsp;Waiting&nbsp;for&nbsp;child.</span><br>
<span class="lineno"></span><span class="keyword" id="7777401">func</span>&nbsp;<span class="op" id="7777406">(</span><span class="ident" id="7777407">test</span>&nbsp;<span class="op" id="7777412">*</span><span class="ident" id="7777413">clientTest</span><span class="op" id="7777423">)</span>&nbsp;<span class="ident" id="7777425">connFromCommand</span><span class="op" id="7777440">(</span><span class="op" id="7777441">)</span>&nbsp;<span class="op" id="7777443">(</span><span class="ident" id="7777444">conn</span>&nbsp;<span class="op" id="7777449">*</span><span class="ident" id="7777450">recordingConn</span><span class="op" id="7777463">,</span>&nbsp;<span class="ident" id="7777465">child</span>&nbsp;<span class="op" id="7777471">*</span><span class="ident" id="7777472">exec</span><span class="op" id="7777476">.</span><span class="ident" id="7777477">Cmd</span><span class="op" id="7777480">,</span>&nbsp;<span class="ident" id="7777482">stdin</span>&nbsp;<span class="ident" id="7777488">blockingSource</span><span class="op" id="7777502">,</span>&nbsp;<span class="ident" id="7777504">err</span>&nbsp;<span class="builtintype" id="7777508">error</span><span class="op" id="7777513">)</span>&nbsp;<span class="op" id="7777515">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7777518">cert</span>&nbsp;<span class="op" id="7777523">:=</span>&nbsp;<span class="ident" id="7777526">testRSACertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7777546">if</span>&nbsp;<span class="builtinfunc" id="7777549">len</span><span class="op" id="7777552">(</span><span class="ident" id="7777553">test</span><span class="op" id="7777557">.</span><span class="ident" id="7777558">cert</span><span class="op" id="7777562">)</span>&nbsp;<span class="op" id="7777564">&gt;</span>&nbsp;<span class="num" id="7777566">0</span>&nbsp;<span class="op" id="7777568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7777572">cert</span>&nbsp;<span class="op" id="7777577">=</span>&nbsp;<span class="ident" id="7777579">test</span><span class="op" id="7777583">.</span><span class="ident" id="7777584">cert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7777590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7777593">certPath</span>&nbsp;<span class="op" id="7777602">:=</span>&nbsp;<span class="ident" id="7777605">tempFile</span><span class="op" id="7777613">(</span><span class="builtintype" id="7777614">string</span><span class="op" id="7777620">(</span><span class="ident" id="7777621">cert</span><span class="op" id="7777625">)</span><span class="op" id="7777626">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7777629">defer</span>&nbsp;<span class="ident" id="7777635">os</span><span class="op" id="7777637">.</span><span class="ident" id="7777638">Remove</span><span class="op" id="7777644">(</span><span class="ident" id="7777645">certPath</span><span class="op" id="7777653">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7777657">var</span>&nbsp;<span class="ident" id="7777661">key</span>&nbsp;<span class="keyword" id="7777665">interface</span><span class="op" id="7777674">{</span><span class="op" id="7777675">}</span>&nbsp;<span class="op" id="7777677">=</span>&nbsp;<span class="ident" id="7777679">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7777698">if</span>&nbsp;<span class="ident" id="7777701">test</span><span class="op" id="7777705">.</span><span class="ident" id="7777706">key</span>&nbsp;<span class="op" id="7777710">!=</span>&nbsp;<span class="builtintype" id="7777713">nil</span>&nbsp;<span class="op" id="7777717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7777721">key</span>&nbsp;<span class="op" id="7777725">=</span>&nbsp;<span class="ident" id="7777727">test</span><span class="op" id="7777731">.</span><span class="ident" id="7777732">key</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7777737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7777740">var</span>&nbsp;<span class="ident" id="7777744">pemType</span>&nbsp;<span class="builtintype" id="7777752">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7777760">var</span>&nbsp;<span class="ident" id="7777764">derBytes</span>&nbsp;<span class="op" id="7777773">[</span><span class="op" id="7777774">]</span><span class="builtintype" id="7777775">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7777781">switch</span>&nbsp;<span class="ident" id="7777788">key</span>&nbsp;<span class="op" id="7777792">:=</span>&nbsp;<span class="ident" id="7777795">key</span><span class="op" id="7777798">.</span><span class="op" id="7777799">(</span><span class="keyword" id="7777800">type</span><span class="op" id="7777804">)</span>&nbsp;<span class="op" id="7777806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7777809">case</span>&nbsp;<span class="op" id="7777814">*</span><span class="ident" id="7777815">rsa</span><span class="op" id="7777818">.</span><span class="ident" id="7777819">PrivateKey</span><span class="op" id="7777829">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7777833">pemType</span>&nbsp;<span class="op" id="7777841">=</span>&nbsp;<span class="string" id="7777843">&#34;RSA&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7777851">derBytes</span>&nbsp;<span class="op" id="7777860">=</span>&nbsp;<span class="ident" id="7777862">x509</span><span class="op" id="7777866">.</span><span class="ident" id="7777867">MarshalPKCS1PrivateKey</span><span class="op" id="7777889">(</span><span class="ident" id="7777890">key</span><span class="op" id="7777893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7777896">case</span>&nbsp;<span class="op" id="7777901">*</span><span class="ident" id="7777902">ecdsa</span><span class="op" id="7777907">.</span><span class="ident" id="7777908">PrivateKey</span><span class="op" id="7777918">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7777922">pemType</span>&nbsp;<span class="op" id="7777930">=</span>&nbsp;<span class="string" id="7777932">&#34;EC&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7777939">var</span>&nbsp;<span class="ident" id="7777943">err</span>&nbsp;<span class="builtintype" id="7777947">error</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7777955">derBytes</span><span class="op" id="7777963">,</span>&nbsp;<span class="ident" id="7777965">err</span>&nbsp;<span class="op" id="7777969">=</span>&nbsp;<span class="ident" id="7777971">x509</span><span class="op" id="7777975">.</span><span class="ident" id="7777976">MarshalECPrivateKey</span><span class="op" id="7777995">(</span><span class="ident" id="7777996">key</span><span class="op" id="7777999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7778003">if</span>&nbsp;<span class="ident" id="7778006">err</span>&nbsp;<span class="op" id="7778010">!=</span>&nbsp;<span class="builtintype" id="7778013">nil</span>&nbsp;<span class="op" id="7778017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7778022">panic</span><span class="op" id="7778027">(</span><span class="ident" id="7778028">err</span><span class="op" id="7778031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7778035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7778038">default</span><span class="op" id="7778045">:</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7778049">panic</span><span class="op" id="7778054">(</span><span class="string" id="7778055">&#34;unknown&nbsp;key&nbsp;type&#34;</span><span class="op" id="7778073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7778076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7778080">var</span>&nbsp;<span class="ident" id="7778084">pemOut</span>&nbsp;<span class="ident" id="7778091">bytes</span><span class="op" id="7778096">.</span><span class="ident" id="7778097">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7778105">pem</span><span class="op" id="7778108">.</span><span class="ident" id="7778109">Encode</span><span class="op" id="7778115">(</span><span class="op" id="7778116">&amp;</span><span class="ident" id="7778117">pemOut</span><span class="op" id="7778123">,</span>&nbsp;<span class="op" id="7778125">&amp;</span><span class="ident" id="7778126">pem</span><span class="op" id="7778129">.</span><span class="ident" id="7778130">Block</span><span class="op" id="7778135">{</span><span class="ident" id="7778136">Type</span><span class="op" id="7778140">:</span>&nbsp;<span class="ident" id="7778142">pemType</span>&nbsp;<span class="op" id="7778150">+</span>&nbsp;<span class="string" id="7778152">&#34;&nbsp;PRIVATE&nbsp;KEY&#34;</span><span class="op" id="7778166">,</span>&nbsp;<span class="ident" id="7778168">Bytes</span><span class="op" id="7778173">:</span>&nbsp;<span class="ident" id="7778175">derBytes</span><span class="op" id="7778183">}</span><span class="op" id="7778184">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7778188">keyPath</span>&nbsp;<span class="op" id="7778196">:=</span>&nbsp;<span class="ident" id="7778199">tempFile</span><span class="op" id="7778207">(</span><span class="builtintype" id="7778208">string</span><span class="op" id="7778214">(</span><span class="ident" id="7778215">pemOut</span><span class="op" id="7778221">.</span><span class="ident" id="7778222">Bytes</span><span class="op" id="7778227">(</span><span class="op" id="7778228">)</span><span class="op" id="7778229">)</span><span class="op" id="7778230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7778233">defer</span>&nbsp;<span class="ident" id="7778239">os</span><span class="op" id="7778241">.</span><span class="ident" id="7778242">Remove</span><span class="op" id="7778248">(</span><span class="ident" id="7778249">keyPath</span><span class="op" id="7778256">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7778260">var</span>&nbsp;<span class="ident" id="7778264">command</span>&nbsp;<span class="op" id="7778272">[</span><span class="op" id="7778273">]</span><span class="builtintype" id="7778274">string</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7778282">if</span>&nbsp;<span class="builtinfunc" id="7778285">len</span><span class="op" id="7778288">(</span><span class="ident" id="7778289">test</span><span class="op" id="7778293">.</span><span class="ident" id="7778294">command</span><span class="op" id="7778301">)</span>&nbsp;<span class="op" id="7778303">&gt;</span>&nbsp;<span class="num" id="7778305">0</span>&nbsp;<span class="op" id="7778307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7778311">command</span>&nbsp;<span class="op" id="7778319">=</span>&nbsp;<span class="builtinfunc" id="7778321">append</span><span class="op" id="7778327">(</span><span class="ident" id="7778328">command</span><span class="op" id="7778335">,</span>&nbsp;<span class="ident" id="7778337">test</span><span class="op" id="7778341">.</span><span class="ident" id="7778342">command</span><span class="op" id="7778349">...</span><span class="op" id="7778352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7778355">}</span>&nbsp;<span class="keyword" id="7778357">else</span>&nbsp;<span class="op" id="7778362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7778366">command</span>&nbsp;<span class="op" id="7778374">=</span>&nbsp;<span class="builtinfunc" id="7778376">append</span><span class="op" id="7778382">(</span><span class="ident" id="7778383">command</span><span class="op" id="7778390">,</span>&nbsp;<span class="ident" id="7778392">defaultServerCommand</span><span class="op" id="7778412">...</span><span class="op" id="7778415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7778418">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7778421">command</span>&nbsp;<span class="op" id="7778429">=</span>&nbsp;<span class="builtinfunc" id="7778431">append</span><span class="op" id="7778437">(</span><span class="ident" id="7778438">command</span><span class="op" id="7778445">,</span>&nbsp;<span class="string" id="7778447">&#34;-cert&#34;</span><span class="op" id="7778454">,</span>&nbsp;<span class="ident" id="7778456">certPath</span><span class="op" id="7778464">,</span>&nbsp;<span class="string" id="7778466">&#34;-certform&#34;</span><span class="op" id="7778477">,</span>&nbsp;<span class="string" id="7778479">&#34;DER&#34;</span><span class="op" id="7778484">,</span>&nbsp;<span class="string" id="7778486">&#34;-key&#34;</span><span class="op" id="7778492">,</span>&nbsp;<span class="ident" id="7778494">keyPath</span><span class="op" id="7778501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7778504">//&nbsp;serverPort&nbsp;contains&nbsp;the&nbsp;port&nbsp;that&nbsp;OpenSSL&nbsp;will&nbsp;listen&nbsp;on.&nbsp;OpenSSL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7778574">//&nbsp;can&#39;t&nbsp;take&nbsp;&#34;0&#34;&nbsp;as&nbsp;an&nbsp;argument&nbsp;here&nbsp;so&nbsp;we&nbsp;have&nbsp;to&nbsp;pick&nbsp;a&nbsp;number&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7778645">//&nbsp;hope&nbsp;that&nbsp;it&#39;s&nbsp;not&nbsp;in&nbsp;use&nbsp;on&nbsp;the&nbsp;machine.&nbsp;Since&nbsp;this&nbsp;only&nbsp;occurs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7778714">//&nbsp;when&nbsp;-update&nbsp;is&nbsp;given&nbsp;and&nbsp;thus&nbsp;when&nbsp;there&#39;s&nbsp;a&nbsp;human&nbsp;watching&nbsp;the</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7778783">//&nbsp;test,&nbsp;this&nbsp;isn&#39;t&nbsp;too&nbsp;bad.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7778813">const</span>&nbsp;<span class="ident" id="7778819">serverPort</span>&nbsp;<span class="op" id="7778830">=</span>&nbsp;<span class="num" id="7778832">24323</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7778839">command</span>&nbsp;<span class="op" id="7778847">=</span>&nbsp;<span class="builtinfunc" id="7778849">append</span><span class="op" id="7778855">(</span><span class="ident" id="7778856">command</span><span class="op" id="7778863">,</span>&nbsp;<span class="string" id="7778865">&#34;-accept&#34;</span><span class="op" id="7778874">,</span>&nbsp;<span class="ident" id="7778876">strconv</span><span class="op" id="7778883">.</span><span class="ident" id="7778884">Itoa</span><span class="op" id="7778888">(</span><span class="ident" id="7778889">serverPort</span><span class="op" id="7778899">)</span><span class="op" id="7778900">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7778904">cmd</span>&nbsp;<span class="op" id="7778908">:=</span>&nbsp;<span class="ident" id="7778911">exec</span><span class="op" id="7778915">.</span><span class="ident" id="7778916">Command</span><span class="op" id="7778923">(</span><span class="ident" id="7778924">command</span><span class="op" id="7778931">[</span><span class="num" id="7778932">0</span><span class="op" id="7778933">]</span><span class="op" id="7778934">,</span>&nbsp;<span class="ident" id="7778936">command</span><span class="op" id="7778943">[</span><span class="num" id="7778944">1</span><span class="op" id="7778945">:</span><span class="op" id="7778946">]</span><span class="op" id="7778947">...</span><span class="op" id="7778950">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7778953">stdin</span>&nbsp;<span class="op" id="7778959">=</span>&nbsp;<span class="ident" id="7778961">blockingSource</span><span class="op" id="7778975">(</span><span class="builtinfunc" id="7778976">make</span><span class="op" id="7778980">(</span><span class="keyword" id="7778981">chan</span>&nbsp;<span class="builtintype" id="7778986">bool</span><span class="op" id="7778990">)</span><span class="op" id="7778991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7778994">cmd</span><span class="op" id="7778997">.</span><span class="ident" id="7778998">Stdin</span>&nbsp;<span class="op" id="7779004">=</span>&nbsp;<span class="ident" id="7779006">stdin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7779013">var</span>&nbsp;<span class="ident" id="7779017">out</span>&nbsp;<span class="ident" id="7779021">bytes</span><span class="op" id="7779026">.</span><span class="ident" id="7779027">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7779035">cmd</span><span class="op" id="7779038">.</span><span class="ident" id="7779039">Stdout</span>&nbsp;<span class="op" id="7779046">=</span>&nbsp;<span class="op" id="7779048">&amp;</span><span class="ident" id="7779049">out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7779054">cmd</span><span class="op" id="7779057">.</span><span class="ident" id="7779058">Stderr</span>&nbsp;<span class="op" id="7779065">=</span>&nbsp;<span class="op" id="7779067">&amp;</span><span class="ident" id="7779068">out</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7779073">if</span>&nbsp;<span class="ident" id="7779076">err</span>&nbsp;<span class="op" id="7779080">:=</span>&nbsp;<span class="ident" id="7779083">cmd</span><span class="op" id="7779086">.</span><span class="ident" id="7779087">Start</span><span class="op" id="7779092">(</span><span class="op" id="7779093">)</span><span class="op" id="7779094">;</span>&nbsp;<span class="ident" id="7779096">err</span>&nbsp;<span class="op" id="7779100">!=</span>&nbsp;<span class="builtintype" id="7779103">nil</span>&nbsp;<span class="op" id="7779107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7779111">return</span>&nbsp;<span class="builtintype" id="7779118">nil</span><span class="op" id="7779121">,</span>&nbsp;<span class="builtintype" id="7779123">nil</span><span class="op" id="7779126">,</span>&nbsp;<span class="builtintype" id="7779128">nil</span><span class="op" id="7779131">,</span>&nbsp;<span class="ident" id="7779133">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7779138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7779142">//&nbsp;OpenSSL&nbsp;does&nbsp;print&nbsp;an&nbsp;&#34;ACCEPT&#34;&nbsp;banner,&nbsp;but&nbsp;it&nbsp;does&nbsp;so&nbsp;*before*</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7779209">//&nbsp;opening&nbsp;the&nbsp;listening&nbsp;socket,&nbsp;so&nbsp;we&nbsp;can&#39;t&nbsp;use&nbsp;that&nbsp;to&nbsp;wait&nbsp;until&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7779281">//&nbsp;has&nbsp;started&nbsp;listening.&nbsp;Thus&nbsp;we&nbsp;are&nbsp;forced&nbsp;to&nbsp;poll&nbsp;until&nbsp;we&nbsp;get&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7779350">//&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7779366">var</span>&nbsp;<span class="ident" id="7779370">tcpConn</span>&nbsp;<span class="ident" id="7779378">net</span><span class="op" id="7779381">.</span><span class="ident" id="7779382">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7779388">for</span>&nbsp;<span class="ident" id="7779392">i</span>&nbsp;<span class="op" id="7779394">:=</span>&nbsp;<span class="builtintype" id="7779397">uint</span><span class="op" id="7779401">(</span><span class="num" id="7779402">0</span><span class="op" id="7779403">)</span><span class="op" id="7779404">;</span>&nbsp;<span class="ident" id="7779406">i</span>&nbsp;<span class="op" id="7779408">&lt;</span>&nbsp;<span class="num" id="7779410">5</span><span class="op" id="7779411">;</span>&nbsp;<span class="ident" id="7779413">i</span><span class="op" id="7779414">++</span>&nbsp;<span class="op" id="7779417">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7779421">var</span>&nbsp;<span class="ident" id="7779425">err</span>&nbsp;<span class="builtintype" id="7779429">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7779437">tcpConn</span><span class="op" id="7779444">,</span>&nbsp;<span class="ident" id="7779446">err</span>&nbsp;<span class="op" id="7779450">=</span>&nbsp;<span class="ident" id="7779452">net</span><span class="op" id="7779455">.</span><span class="ident" id="7779456">DialTCP</span><span class="op" id="7779463">(</span><span class="string" id="7779464">&#34;tcp&#34;</span><span class="op" id="7779469">,</span>&nbsp;<span class="builtintype" id="7779471">nil</span><span class="op" id="7779474">,</span>&nbsp;<span class="op" id="7779476">&amp;</span><span class="ident" id="7779477">net</span><span class="op" id="7779480">.</span><span class="ident" id="7779481">TCPAddr</span><span class="op" id="7779488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7779493">IP</span><span class="op" id="7779495">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7779499">net</span><span class="op" id="7779502">.</span><span class="ident" id="7779503">IPv4</span><span class="op" id="7779507">(</span><span class="num" id="7779508">127</span><span class="op" id="7779511">,</span>&nbsp;<span class="num" id="7779513">0</span><span class="op" id="7779514">,</span>&nbsp;<span class="num" id="7779516">0</span><span class="op" id="7779517">,</span>&nbsp;<span class="num" id="7779519">1</span><span class="op" id="7779520">)</span><span class="op" id="7779521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7779526">Port</span><span class="op" id="7779530">:</span>&nbsp;<span class="ident" id="7779532">serverPort</span><span class="op" id="7779542">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7779546">}</span><span class="op" id="7779547">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7779551">if</span>&nbsp;<span class="ident" id="7779554">err</span>&nbsp;<span class="op" id="7779558">==</span>&nbsp;<span class="builtintype" id="7779561">nil</span>&nbsp;<span class="op" id="7779565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7779570">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7779578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7779582">time</span><span class="op" id="7779586">.</span><span class="ident" id="7779587">Sleep</span><span class="op" id="7779592">(</span><span class="op" id="7779593">(</span><span class="num" id="7779594">1</span>&nbsp;<span class="op" id="7779596">&lt;&lt;</span>&nbsp;<span class="ident" id="7779599">i</span><span class="op" id="7779600">)</span>&nbsp;<span class="op" id="7779602">*</span>&nbsp;<span class="num" id="7779604">5</span>&nbsp;<span class="op" id="7779606">*</span>&nbsp;<span class="ident" id="7779608">time</span><span class="op" id="7779612">.</span><span class="ident" id="7779613">Millisecond</span><span class="op" id="7779624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7779627">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7779630">if</span>&nbsp;<span class="ident" id="7779633">tcpConn</span>&nbsp;<span class="op" id="7779641">==</span>&nbsp;<span class="builtintype" id="7779644">nil</span>&nbsp;<span class="op" id="7779648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7779652">close</span><span class="op" id="7779657">(</span><span class="ident" id="7779658">stdin</span><span class="op" id="7779663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7779667">out</span><span class="op" id="7779670">.</span><span class="ident" id="7779671">WriteTo</span><span class="op" id="7779678">(</span><span class="ident" id="7779679">os</span><span class="op" id="7779681">.</span><span class="ident" id="7779682">Stdout</span><span class="op" id="7779688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7779692">cmd</span><span class="op" id="7779695">.</span><span class="ident" id="7779696">Process</span><span class="op" id="7779703">.</span><span class="ident" id="7779704">Kill</span><span class="op" id="7779708">(</span><span class="op" id="7779709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7779713">return</span>&nbsp;<span class="builtintype" id="7779720">nil</span><span class="op" id="7779723">,</span>&nbsp;<span class="builtintype" id="7779725">nil</span><span class="op" id="7779728">,</span>&nbsp;<span class="builtintype" id="7779730">nil</span><span class="op" id="7779733">,</span>&nbsp;<span class="ident" id="7779735">cmd</span><span class="op" id="7779738">.</span><span class="ident" id="7779739">Wait</span><span class="op" id="7779743">(</span><span class="op" id="7779744">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7779747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7779751">record</span>&nbsp;<span class="op" id="7779758">:=</span>&nbsp;<span class="op" id="7779761">&amp;</span><span class="ident" id="7779762">recordingConn</span><span class="op" id="7779775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7779779">Conn</span><span class="op" id="7779783">:</span>&nbsp;<span class="ident" id="7779785">tcpConn</span><span class="op" id="7779792">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7779795">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7779799">return</span>&nbsp;<span class="ident" id="7779806">record</span><span class="op" id="7779812">,</span>&nbsp;<span class="ident" id="7779814">cmd</span><span class="op" id="7779817">,</span>&nbsp;<span class="ident" id="7779819">stdin</span><span class="op" id="7779824">,</span>&nbsp;<span class="builtintype" id="7779826">nil</span><br>
<span class="lineno"></span><span class="op" id="7779830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7779833">func</span>&nbsp;<span class="op" id="7779838">(</span><span class="ident" id="7779839">test</span>&nbsp;<span class="op" id="7779844">*</span><span class="ident" id="7779845">clientTest</span><span class="op" id="7779855">)</span>&nbsp;<span class="ident" id="7779857">dataPath</span><span class="op" id="7779865">(</span><span class="op" id="7779866">)</span>&nbsp;<span class="builtintype" id="7779868">string</span>&nbsp;<span class="op" id="7779875">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7779878">return</span>&nbsp;<span class="ident" id="7779885">filepath</span><span class="op" id="7779893">.</span><span class="ident" id="7779894">Join</span><span class="op" id="7779898">(</span><span class="string" id="7779899">&#34;testdata&#34;</span><span class="op" id="7779909">,</span>&nbsp;<span class="string" id="7779911">&#34;Client-&#34;</span><span class="op" id="7779920">+</span><span class="ident" id="7779921">test</span><span class="op" id="7779925">.</span><span class="ident" id="7779926">name</span><span class="op" id="7779930">)</span><br>
<span class="lineno"></span><span class="op" id="7779932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7779935">func</span>&nbsp;<span class="op" id="7779940">(</span><span class="ident" id="7779941">test</span>&nbsp;<span class="op" id="7779946">*</span><span class="ident" id="7779947">clientTest</span><span class="op" id="7779957">)</span>&nbsp;<span class="ident" id="7779959">loadData</span><span class="op" id="7779967">(</span><span class="op" id="7779968">)</span>&nbsp;<span class="op" id="7779970">(</span><span class="ident" id="7779971">flows</span>&nbsp;<span class="op" id="7779977">[</span><span class="op" id="7779978">]</span><span class="op" id="7779979">[</span><span class="op" id="7779980">]</span><span class="builtintype" id="7779981">byte</span><span class="op" id="7779985">,</span>&nbsp;<span class="ident" id="7779987">err</span>&nbsp;<span class="builtintype" id="7779991">error</span><span class="op" id="7779996">)</span>&nbsp;<span class="op" id="7779998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7780001">in</span><span class="op" id="7780003">,</span>&nbsp;<span class="ident" id="7780005">err</span>&nbsp;<span class="op" id="7780009">:=</span>&nbsp;<span class="ident" id="7780012">os</span><span class="op" id="7780014">.</span><span class="ident" id="7780015">Open</span><span class="op" id="7780019">(</span><span class="ident" id="7780020">test</span><span class="op" id="7780024">.</span><span class="ident" id="7780025">dataPath</span><span class="op" id="7780033">(</span><span class="op" id="7780034">)</span><span class="op" id="7780035">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7780038">if</span>&nbsp;<span class="ident" id="7780041">err</span>&nbsp;<span class="op" id="7780045">!=</span>&nbsp;<span class="builtintype" id="7780048">nil</span>&nbsp;<span class="op" id="7780052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7780056">return</span>&nbsp;<span class="builtintype" id="7780063">nil</span><span class="op" id="7780066">,</span>&nbsp;<span class="ident" id="7780068">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7780073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7780076">defer</span>&nbsp;<span class="ident" id="7780082">in</span><span class="op" id="7780084">.</span><span class="ident" id="7780085">Close</span><span class="op" id="7780090">(</span><span class="op" id="7780091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7780094">return</span>&nbsp;<span class="ident" id="7780101">parseTestData</span><span class="op" id="7780114">(</span><span class="ident" id="7780115">in</span><span class="op" id="7780117">)</span><br>
<span class="lineno">165</span><span class="op" id="7780119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7780122">func</span>&nbsp;<span class="op" id="7780127">(</span><span class="ident" id="7780128">test</span>&nbsp;<span class="op" id="7780133">*</span><span class="ident" id="7780134">clientTest</span><span class="op" id="7780144">)</span>&nbsp;<span class="ident" id="7780146">run</span><span class="op" id="7780149">(</span><span class="ident" id="7780150">t</span>&nbsp;<span class="op" id="7780152">*</span><span class="ident" id="7780153">testing</span><span class="op" id="7780160">.</span><span class="ident" id="7780161">T</span><span class="op" id="7780162">,</span>&nbsp;<span class="ident" id="7780164">write</span>&nbsp;<span class="builtintype" id="7780170">bool</span><span class="op" id="7780174">)</span>&nbsp;<span class="op" id="7780176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7780179">var</span>&nbsp;<span class="ident" id="7780183">clientConn</span><span class="op" id="7780193">,</span>&nbsp;<span class="ident" id="7780195">serverConn</span>&nbsp;<span class="ident" id="7780206">net</span><span class="op" id="7780209">.</span><span class="ident" id="7780210">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7780216">var</span>&nbsp;<span class="ident" id="7780220">recordingConn</span>&nbsp;<span class="op" id="7780234">*</span><span class="ident" id="7780235">recordingConn</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7780250">var</span>&nbsp;<span class="ident" id="7780254">childProcess</span>&nbsp;<span class="op" id="7780267">*</span><span class="ident" id="7780268">exec</span><span class="op" id="7780272">.</span><span class="ident" id="7780273">Cmd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7780278">var</span>&nbsp;<span class="ident" id="7780282">stdin</span>&nbsp;<span class="ident" id="7780288">blockingSource</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7780305">if</span>&nbsp;<span class="ident" id="7780308">write</span>&nbsp;<span class="op" id="7780314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7780318">var</span>&nbsp;<span class="ident" id="7780322">err</span>&nbsp;<span class="builtintype" id="7780326">error</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7780334">recordingConn</span><span class="op" id="7780347">,</span>&nbsp;<span class="ident" id="7780349">childProcess</span><span class="op" id="7780361">,</span>&nbsp;<span class="ident" id="7780363">stdin</span><span class="op" id="7780368">,</span>&nbsp;<span class="ident" id="7780370">err</span>&nbsp;<span class="op" id="7780374">=</span>&nbsp;<span class="ident" id="7780376">test</span><span class="op" id="7780380">.</span><span class="ident" id="7780381">connFromCommand</span><span class="op" id="7780396">(</span><span class="op" id="7780397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7780401">if</span>&nbsp;<span class="ident" id="7780404">err</span>&nbsp;<span class="op" id="7780408">!=</span>&nbsp;<span class="builtintype" id="7780411">nil</span>&nbsp;<span class="op" id="7780415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7780420">t</span><span class="op" id="7780421">.</span><span class="ident" id="7780422">Fatalf</span><span class="op" id="7780428">(</span><span class="string" id="7780429">&#34;Failed&nbsp;to&nbsp;start&nbsp;subcommand:&nbsp;%s&#34;</span><span class="op" id="7780461">,</span>&nbsp;<span class="ident" id="7780463">err</span><span class="op" id="7780466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7780470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7780474">clientConn</span>&nbsp;<span class="op" id="7780485">=</span>&nbsp;<span class="ident" id="7780487">recordingConn</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7780502">}</span>&nbsp;<span class="keyword" id="7780504">else</span>&nbsp;<span class="op" id="7780509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7780513">clientConn</span><span class="op" id="7780523">,</span>&nbsp;<span class="ident" id="7780525">serverConn</span>&nbsp;<span class="op" id="7780536">=</span>&nbsp;<span class="ident" id="7780538">net</span><span class="op" id="7780541">.</span><span class="ident" id="7780542">Pipe</span><span class="op" id="7780546">(</span><span class="op" id="7780547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7780550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7780554">config</span>&nbsp;<span class="op" id="7780561">:=</span>&nbsp;<span class="ident" id="7780564">test</span><span class="op" id="7780568">.</span><span class="ident" id="7780569">config</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7780577">if</span>&nbsp;<span class="ident" id="7780580">config</span>&nbsp;<span class="op" id="7780587">==</span>&nbsp;<span class="builtintype" id="7780590">nil</span>&nbsp;<span class="op" id="7780594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7780598">config</span>&nbsp;<span class="op" id="7780605">=</span>&nbsp;<span class="ident" id="7780607">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7780619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7780622">client</span>&nbsp;<span class="op" id="7780629">:=</span>&nbsp;<span class="ident" id="7780632">Client</span><span class="op" id="7780638">(</span><span class="ident" id="7780639">clientConn</span><span class="op" id="7780649">,</span>&nbsp;<span class="ident" id="7780651">config</span><span class="op" id="7780657">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7780661">doneChan</span>&nbsp;<span class="op" id="7780670">:=</span>&nbsp;<span class="builtinfunc" id="7780673">make</span><span class="op" id="7780677">(</span><span class="keyword" id="7780678">chan</span>&nbsp;<span class="builtintype" id="7780683">bool</span><span class="op" id="7780687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7780690">go</span>&nbsp;<span class="keyword" id="7780693">func</span><span class="op" id="7780697">(</span><span class="op" id="7780698">)</span>&nbsp;<span class="op" id="7780700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7780704">if</span>&nbsp;<span class="ident" id="7780707">_</span><span class="op" id="7780708">,</span>&nbsp;<span class="ident" id="7780710">err</span>&nbsp;<span class="op" id="7780714">:=</span>&nbsp;<span class="ident" id="7780717">client</span><span class="op" id="7780723">.</span><span class="ident" id="7780724">Write</span><span class="op" id="7780729">(</span><span class="op" id="7780730">[</span><span class="op" id="7780731">]</span><span class="builtintype" id="7780732">byte</span><span class="op" id="7780736">(</span><span class="string" id="7780737">&#34;hello\n&#34;</span><span class="op" id="7780746">)</span><span class="op" id="7780747">)</span><span class="op" id="7780748">;</span>&nbsp;<span class="ident" id="7780750">err</span>&nbsp;<span class="op" id="7780754">!=</span>&nbsp;<span class="builtintype" id="7780757">nil</span>&nbsp;<span class="op" id="7780761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7780766">t</span><span class="op" id="7780767">.</span><span class="ident" id="7780768">Logf</span><span class="op" id="7780772">(</span><span class="string" id="7780773">&#34;Client.Write&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7780798">,</span>&nbsp;<span class="ident" id="7780800">err</span><span class="op" id="7780803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7780807">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7780811">if</span>&nbsp;<span class="ident" id="7780814">test</span><span class="op" id="7780818">.</span><span class="ident" id="7780819">validate</span>&nbsp;<span class="op" id="7780828">!=</span>&nbsp;<span class="builtintype" id="7780831">nil</span>&nbsp;<span class="op" id="7780835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7780840">if</span>&nbsp;<span class="ident" id="7780843">err</span>&nbsp;<span class="op" id="7780847">:=</span>&nbsp;<span class="ident" id="7780850">test</span><span class="op" id="7780854">.</span><span class="ident" id="7780855">validate</span><span class="op" id="7780863">(</span><span class="ident" id="7780864">client</span><span class="op" id="7780870">.</span><span class="ident" id="7780871">ConnectionState</span><span class="op" id="7780886">(</span><span class="op" id="7780887">)</span><span class="op" id="7780888">)</span><span class="op" id="7780889">;</span>&nbsp;<span class="ident" id="7780891">err</span>&nbsp;<span class="op" id="7780895">!=</span>&nbsp;<span class="builtintype" id="7780898">nil</span>&nbsp;<span class="op" id="7780902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7780908">t</span><span class="op" id="7780909">.</span><span class="ident" id="7780910">Logf</span><span class="op" id="7780914">(</span><span class="string" id="7780915">&#34;validate&nbsp;callback&nbsp;returned&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7780953">,</span>&nbsp;<span class="ident" id="7780955">err</span><span class="op" id="7780958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7780963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7780967">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7780971">client</span><span class="op" id="7780977">.</span><span class="ident" id="7780978">Close</span><span class="op" id="7780983">(</span><span class="op" id="7780984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7780988">clientConn</span><span class="op" id="7780998">.</span><span class="ident" id="7780999">Close</span><span class="op" id="7781004">(</span><span class="op" id="7781005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7781009">doneChan</span>&nbsp;<span class="op" id="7781018">&lt;-</span>&nbsp;<span class="builtintype" id="7781021">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7781027">}</span><span class="op" id="7781028">(</span><span class="op" id="7781029">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7781033">if</span>&nbsp;<span class="op" id="7781036">!</span><span class="ident" id="7781037">write</span>&nbsp;<span class="op" id="7781043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7781047">flows</span><span class="op" id="7781052">,</span>&nbsp;<span class="ident" id="7781054">err</span>&nbsp;<span class="op" id="7781058">:=</span>&nbsp;<span class="ident" id="7781061">test</span><span class="op" id="7781065">.</span><span class="ident" id="7781066">loadData</span><span class="op" id="7781074">(</span><span class="op" id="7781075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7781079">if</span>&nbsp;<span class="ident" id="7781082">err</span>&nbsp;<span class="op" id="7781086">!=</span>&nbsp;<span class="builtintype" id="7781089">nil</span>&nbsp;<span class="op" id="7781093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7781098">t</span><span class="op" id="7781099">.</span><span class="ident" id="7781100">Fatalf</span><span class="op" id="7781106">(</span><span class="string" id="7781107">&#34;%s:&nbsp;failed&nbsp;to&nbsp;load&nbsp;data&nbsp;from&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="7781144">,</span>&nbsp;<span class="ident" id="7781146">test</span><span class="op" id="7781150">.</span><span class="ident" id="7781151">name</span><span class="op" id="7781155">,</span>&nbsp;<span class="ident" id="7781157">test</span><span class="op" id="7781161">.</span><span class="ident" id="7781162">dataPath</span><span class="op" id="7781170">(</span><span class="op" id="7781171">)</span><span class="op" id="7781172">,</span>&nbsp;<span class="ident" id="7781174">err</span><span class="op" id="7781177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7781181">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7781185">for</span>&nbsp;<span class="ident" id="7781189">i</span><span class="op" id="7781190">,</span>&nbsp;<span class="ident" id="7781192">b</span>&nbsp;<span class="op" id="7781194">:=</span>&nbsp;<span class="keyword" id="7781197">range</span>&nbsp;<span class="ident" id="7781203">flows</span>&nbsp;<span class="op" id="7781209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7781214">if</span>&nbsp;<span class="ident" id="7781217">i</span><span class="op" id="7781218">%</span><span class="num" id="7781219">2</span>&nbsp;<span class="op" id="7781221">==</span>&nbsp;<span class="num" id="7781224">1</span>&nbsp;<span class="op" id="7781226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7781232">serverConn</span><span class="op" id="7781242">.</span><span class="ident" id="7781243">Write</span><span class="op" id="7781248">(</span><span class="ident" id="7781249">b</span><span class="op" id="7781250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7781256">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7781268">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7781273">bb</span>&nbsp;<span class="op" id="7781276">:=</span>&nbsp;<span class="builtinfunc" id="7781279">make</span><span class="op" id="7781283">(</span><span class="op" id="7781284">[</span><span class="op" id="7781285">]</span><span class="builtintype" id="7781286">byte</span><span class="op" id="7781290">,</span>&nbsp;<span class="builtinfunc" id="7781292">len</span><span class="op" id="7781295">(</span><span class="ident" id="7781296">b</span><span class="op" id="7781297">)</span><span class="op" id="7781298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7781303">_</span><span class="op" id="7781304">,</span>&nbsp;<span class="ident" id="7781306">err</span>&nbsp;<span class="op" id="7781310">:=</span>&nbsp;<span class="ident" id="7781313">io</span><span class="op" id="7781315">.</span><span class="ident" id="7781316">ReadFull</span><span class="op" id="7781324">(</span><span class="ident" id="7781325">serverConn</span><span class="op" id="7781335">,</span>&nbsp;<span class="ident" id="7781337">bb</span><span class="op" id="7781339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7781344">if</span>&nbsp;<span class="ident" id="7781347">err</span>&nbsp;<span class="op" id="7781351">!=</span>&nbsp;<span class="builtintype" id="7781354">nil</span>&nbsp;<span class="op" id="7781358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7781364">t</span><span class="op" id="7781365">.</span><span class="ident" id="7781366">Fatalf</span><span class="op" id="7781372">(</span><span class="string" id="7781373">&#34;%s&nbsp;#%d:&nbsp;%s&#34;</span><span class="op" id="7781385">,</span>&nbsp;<span class="ident" id="7781387">test</span><span class="op" id="7781391">.</span><span class="ident" id="7781392">name</span><span class="op" id="7781396">,</span>&nbsp;<span class="ident" id="7781398">i</span><span class="op" id="7781399">,</span>&nbsp;<span class="ident" id="7781401">err</span><span class="op" id="7781404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7781409">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7781414">if</span>&nbsp;<span class="op" id="7781417">!</span><span class="ident" id="7781418">bytes</span><span class="op" id="7781423">.</span><span class="ident" id="7781424">Equal</span><span class="op" id="7781429">(</span><span class="ident" id="7781430">b</span><span class="op" id="7781431">,</span>&nbsp;<span class="ident" id="7781433">bb</span><span class="op" id="7781435">)</span>&nbsp;<span class="op" id="7781437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7781443">t</span><span class="op" id="7781444">.</span><span class="ident" id="7781445">Fatalf</span><span class="op" id="7781451">(</span><span class="string" id="7781452">&#34;%s&nbsp;#%d:&nbsp;mismatch&nbsp;on&nbsp;read:&nbsp;got:%x&nbsp;want:%x&#34;</span><span class="op" id="7781494">,</span>&nbsp;<span class="ident" id="7781496">test</span><span class="op" id="7781500">.</span><span class="ident" id="7781501">name</span><span class="op" id="7781505">,</span>&nbsp;<span class="ident" id="7781507">i</span><span class="op" id="7781508">,</span>&nbsp;<span class="ident" id="7781510">bb</span><span class="op" id="7781512">,</span>&nbsp;<span class="ident" id="7781514">b</span><span class="op" id="7781515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7781520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7781524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7781528">serverConn</span><span class="op" id="7781538">.</span><span class="ident" id="7781539">Close</span><span class="op" id="7781544">(</span><span class="op" id="7781545">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7781548">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7781552">&lt;-</span><span class="ident" id="7781554">doneChan</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7781565">if</span>&nbsp;<span class="ident" id="7781568">write</span>&nbsp;<span class="op" id="7781574">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7781578">path</span>&nbsp;<span class="op" id="7781583">:=</span>&nbsp;<span class="ident" id="7781586">test</span><span class="op" id="7781590">.</span><span class="ident" id="7781591">dataPath</span><span class="op" id="7781599">(</span><span class="op" id="7781600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7781604">out</span><span class="op" id="7781607">,</span>&nbsp;<span class="ident" id="7781609">err</span>&nbsp;<span class="op" id="7781613">:=</span>&nbsp;<span class="ident" id="7781616">os</span><span class="op" id="7781618">.</span><span class="ident" id="7781619">OpenFile</span><span class="op" id="7781627">(</span><span class="ident" id="7781628">path</span><span class="op" id="7781632">,</span>&nbsp;<span class="ident" id="7781634">os</span><span class="op" id="7781636">.</span><span class="ident" id="7781637">O_WRONLY</span><span class="op" id="7781645">|</span><span class="ident" id="7781646">os</span><span class="op" id="7781648">.</span><span class="ident" id="7781649">O_CREATE</span><span class="op" id="7781657">|</span><span class="ident" id="7781658">os</span><span class="op" id="7781660">.</span><span class="ident" id="7781661">O_TRUNC</span><span class="op" id="7781668">,</span>&nbsp;<span class="num" id="7781670">0644</span><span class="op" id="7781674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7781678">if</span>&nbsp;<span class="ident" id="7781681">err</span>&nbsp;<span class="op" id="7781685">!=</span>&nbsp;<span class="builtintype" id="7781688">nil</span>&nbsp;<span class="op" id="7781692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7781697">t</span><span class="op" id="7781698">.</span><span class="ident" id="7781699">Fatalf</span><span class="op" id="7781705">(</span><span class="string" id="7781706">&#34;Failed&nbsp;to&nbsp;create&nbsp;output&nbsp;file:&nbsp;%s&#34;</span><span class="op" id="7781740">,</span>&nbsp;<span class="ident" id="7781742">err</span><span class="op" id="7781745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7781749">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7781753">defer</span>&nbsp;<span class="ident" id="7781759">out</span><span class="op" id="7781762">.</span><span class="ident" id="7781763">Close</span><span class="op" id="7781768">(</span><span class="op" id="7781769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7781773">recordingConn</span><span class="op" id="7781786">.</span><span class="ident" id="7781787">Close</span><span class="op" id="7781792">(</span><span class="op" id="7781793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7781797">close</span><span class="op" id="7781802">(</span><span class="ident" id="7781803">stdin</span><span class="op" id="7781808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7781812">childProcess</span><span class="op" id="7781824">.</span><span class="ident" id="7781825">Process</span><span class="op" id="7781832">.</span><span class="ident" id="7781833">Kill</span><span class="op" id="7781837">(</span><span class="op" id="7781838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7781842">childProcess</span><span class="op" id="7781854">.</span><span class="ident" id="7781855">Wait</span><span class="op" id="7781859">(</span><span class="op" id="7781860">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7781864">if</span>&nbsp;<span class="builtinfunc" id="7781867">len</span><span class="op" id="7781870">(</span><span class="ident" id="7781871">recordingConn</span><span class="op" id="7781884">.</span><span class="ident" id="7781885">flows</span><span class="op" id="7781890">)</span>&nbsp;<span class="op" id="7781892">&lt;</span>&nbsp;<span class="num" id="7781894">3</span>&nbsp;<span class="op" id="7781896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7781901">childProcess</span><span class="op" id="7781913">.</span><span class="ident" id="7781914">Stdout</span><span class="op" id="7781920">.</span><span class="op" id="7781921">(</span><span class="op" id="7781922">*</span><span class="ident" id="7781923">bytes</span><span class="op" id="7781928">.</span><span class="ident" id="7781929">Buffer</span><span class="op" id="7781935">)</span><span class="op" id="7781936">.</span><span class="ident" id="7781937">WriteTo</span><span class="op" id="7781944">(</span><span class="ident" id="7781945">os</span><span class="op" id="7781947">.</span><span class="ident" id="7781948">Stdout</span><span class="op" id="7781954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7781959">t</span><span class="op" id="7781960">.</span><span class="ident" id="7781961">Fatalf</span><span class="op" id="7781967">(</span><span class="string" id="7781968">&#34;Client&nbsp;connection&nbsp;didn&#39;t&nbsp;work&#34;</span><span class="op" id="7781999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7782003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7782007">recordingConn</span><span class="op" id="7782020">.</span><span class="ident" id="7782021">WriteTo</span><span class="op" id="7782028">(</span><span class="ident" id="7782029">out</span><span class="op" id="7782032">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7782036">fmt</span><span class="op" id="7782039">.</span><span class="ident" id="7782040">Printf</span><span class="op" id="7782046">(</span><span class="string" id="7782047">&#34;Wrote&nbsp;%s\n&#34;</span><span class="op" id="7782059">,</span>&nbsp;<span class="ident" id="7782061">path</span><span class="op" id="7782065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7782068">}</span><br>
<span class="lineno"></span><span class="op" id="7782070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7782073">func</span>&nbsp;<span class="ident" id="7782078">runClientTestForVersion</span><span class="op" id="7782101">(</span><span class="ident" id="7782102">t</span>&nbsp;<span class="op" id="7782104">*</span><span class="ident" id="7782105">testing</span><span class="op" id="7782112">.</span><span class="ident" id="7782113">T</span><span class="op" id="7782114">,</span>&nbsp;<span class="ident" id="7782116">template</span>&nbsp;<span class="op" id="7782125">*</span><span class="ident" id="7782126">clientTest</span><span class="op" id="7782136">,</span>&nbsp;<span class="ident" id="7782138">prefix</span><span class="op" id="7782144">,</span>&nbsp;<span class="ident" id="7782146">option</span>&nbsp;<span class="builtintype" id="7782153">string</span><span class="op" id="7782159">)</span>&nbsp;<span class="op" id="7782161">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7782164">test</span>&nbsp;<span class="op" id="7782169">:=</span>&nbsp;<span class="op" id="7782172">*</span><span class="ident" id="7782173">template</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7782183">test</span><span class="op" id="7782187">.</span><span class="ident" id="7782188">name</span>&nbsp;<span class="op" id="7782193">=</span>&nbsp;<span class="ident" id="7782195">prefix</span>&nbsp;<span class="op" id="7782202">+</span>&nbsp;<span class="ident" id="7782204">test</span><span class="op" id="7782208">.</span><span class="ident" id="7782209">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7782215">if</span>&nbsp;<span class="builtinfunc" id="7782218">len</span><span class="op" id="7782221">(</span><span class="ident" id="7782222">test</span><span class="op" id="7782226">.</span><span class="ident" id="7782227">command</span><span class="op" id="7782234">)</span>&nbsp;<span class="op" id="7782236">==</span>&nbsp;<span class="num" id="7782239">0</span>&nbsp;<span class="op" id="7782241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7782245">test</span><span class="op" id="7782249">.</span><span class="ident" id="7782250">command</span>&nbsp;<span class="op" id="7782258">=</span>&nbsp;<span class="ident" id="7782260">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7782282">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7782285">test</span><span class="op" id="7782289">.</span><span class="ident" id="7782290">command</span>&nbsp;<span class="op" id="7782298">=</span>&nbsp;<span class="builtinfunc" id="7782300">append</span><span class="op" id="7782306">(</span><span class="op" id="7782307">[</span><span class="op" id="7782308">]</span><span class="builtintype" id="7782309">string</span><span class="op" id="7782315">(</span><span class="builtintype" id="7782316">nil</span><span class="op" id="7782319">)</span><span class="op" id="7782320">,</span>&nbsp;<span class="ident" id="7782322">test</span><span class="op" id="7782326">.</span><span class="ident" id="7782327">command</span><span class="op" id="7782334">...</span><span class="op" id="7782337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7782340">test</span><span class="op" id="7782344">.</span><span class="ident" id="7782345">command</span>&nbsp;<span class="op" id="7782353">=</span>&nbsp;<span class="builtinfunc" id="7782355">append</span><span class="op" id="7782361">(</span><span class="ident" id="7782362">test</span><span class="op" id="7782366">.</span><span class="ident" id="7782367">command</span><span class="op" id="7782374">,</span>&nbsp;<span class="ident" id="7782376">option</span><span class="op" id="7782382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7782385">test</span><span class="op" id="7782389">.</span><span class="ident" id="7782390">run</span><span class="op" id="7782393">(</span><span class="ident" id="7782394">t</span><span class="op" id="7782395">,</span>&nbsp;<span class="op" id="7782397">*</span><span class="ident" id="7782398">update</span><span class="op" id="7782404">)</span><br>
<span class="lineno"></span><span class="op" id="7782406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="7782409">func</span>&nbsp;<span class="ident" id="7782414">runClientTestTLS10</span><span class="op" id="7782432">(</span><span class="ident" id="7782433">t</span>&nbsp;<span class="op" id="7782435">*</span><span class="ident" id="7782436">testing</span><span class="op" id="7782443">.</span><span class="ident" id="7782444">T</span><span class="op" id="7782445">,</span>&nbsp;<span class="ident" id="7782447">template</span>&nbsp;<span class="op" id="7782456">*</span><span class="ident" id="7782457">clientTest</span><span class="op" id="7782467">)</span>&nbsp;<span class="op" id="7782469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7782472">runClientTestForVersion</span><span class="op" id="7782495">(</span><span class="ident" id="7782496">t</span><span class="op" id="7782497">,</span>&nbsp;<span class="ident" id="7782499">template</span><span class="op" id="7782507">,</span>&nbsp;<span class="string" id="7782509">&#34;TLSv10-&#34;</span><span class="op" id="7782518">,</span>&nbsp;<span class="string" id="7782520">&#34;-tls1&#34;</span><span class="op" id="7782527">)</span><br>
<span class="lineno"></span><span class="op" id="7782529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7782532">func</span>&nbsp;<span class="ident" id="7782537">runClientTestTLS11</span><span class="op" id="7782555">(</span><span class="ident" id="7782556">t</span>&nbsp;<span class="op" id="7782558">*</span><span class="ident" id="7782559">testing</span><span class="op" id="7782566">.</span><span class="ident" id="7782567">T</span><span class="op" id="7782568">,</span>&nbsp;<span class="ident" id="7782570">template</span>&nbsp;<span class="op" id="7782579">*</span><span class="ident" id="7782580">clientTest</span><span class="op" id="7782590">)</span>&nbsp;<span class="op" id="7782592">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7782595">runClientTestForVersion</span><span class="op" id="7782618">(</span><span class="ident" id="7782619">t</span><span class="op" id="7782620">,</span>&nbsp;<span class="ident" id="7782622">template</span><span class="op" id="7782630">,</span>&nbsp;<span class="string" id="7782632">&#34;TLSv11-&#34;</span><span class="op" id="7782641">,</span>&nbsp;<span class="string" id="7782643">&#34;-tls1_1&#34;</span><span class="op" id="7782652">)</span><br>
<span class="lineno"></span><span class="op" id="7782654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7782657">func</span>&nbsp;<span class="ident" id="7782662">runClientTestTLS12</span><span class="op" id="7782680">(</span><span class="ident" id="7782681">t</span>&nbsp;<span class="op" id="7782683">*</span><span class="ident" id="7782684">testing</span><span class="op" id="7782691">.</span><span class="ident" id="7782692">T</span><span class="op" id="7782693">,</span>&nbsp;<span class="ident" id="7782695">template</span>&nbsp;<span class="op" id="7782704">*</span><span class="ident" id="7782705">clientTest</span><span class="op" id="7782715">)</span>&nbsp;<span class="op" id="7782717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7782720">runClientTestForVersion</span><span class="op" id="7782743">(</span><span class="ident" id="7782744">t</span><span class="op" id="7782745">,</span>&nbsp;<span class="ident" id="7782747">template</span><span class="op" id="7782755">,</span>&nbsp;<span class="string" id="7782757">&#34;TLSv12-&#34;</span><span class="op" id="7782766">,</span>&nbsp;<span class="string" id="7782768">&#34;-tls1_2&#34;</span><span class="op" id="7782777">)</span><br>
<span class="lineno">270</span><span class="op" id="7782779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7782782">func</span>&nbsp;<span class="ident" id="7782787">TestHandshakeClientRSARC4</span><span class="op" id="7782812">(</span><span class="ident" id="7782813">t</span>&nbsp;<span class="op" id="7782815">*</span><span class="ident" id="7782816">testing</span><span class="op" id="7782823">.</span><span class="ident" id="7782824">T</span><span class="op" id="7782825">)</span>&nbsp;<span class="op" id="7782827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7782830">test</span>&nbsp;<span class="op" id="7782835">:=</span>&nbsp;<span class="op" id="7782838">&amp;</span><span class="ident" id="7782839">clientTest</span><span class="op" id="7782849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7782853">name</span><span class="op" id="7782857">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7782862">&#34;RSA-RC4&#34;</span><span class="op" id="7782871">,</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7782875">command</span><span class="op" id="7782882">:</span>&nbsp;<span class="op" id="7782884">[</span><span class="op" id="7782885">]</span><span class="builtintype" id="7782886">string</span><span class="op" id="7782892">{</span><span class="string" id="7782893">&#34;openssl&#34;</span><span class="op" id="7782902">,</span>&nbsp;<span class="string" id="7782904">&#34;s_server&#34;</span><span class="op" id="7782914">,</span>&nbsp;<span class="string" id="7782916">&#34;-cipher&#34;</span><span class="op" id="7782925">,</span>&nbsp;<span class="string" id="7782927">&#34;RC4-SHA&#34;</span><span class="op" id="7782936">}</span><span class="op" id="7782937">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7782940">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7782943">runClientTestTLS10</span><span class="op" id="7782961">(</span><span class="ident" id="7782962">t</span><span class="op" id="7782963">,</span>&nbsp;<span class="ident" id="7782965">test</span><span class="op" id="7782969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7782972">runClientTestTLS11</span><span class="op" id="7782990">(</span><span class="ident" id="7782991">t</span><span class="op" id="7782992">,</span>&nbsp;<span class="ident" id="7782994">test</span><span class="op" id="7782998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7783001">runClientTestTLS12</span><span class="op" id="7783019">(</span><span class="ident" id="7783020">t</span><span class="op" id="7783021">,</span>&nbsp;<span class="ident" id="7783023">test</span><span class="op" id="7783027">)</span><br>
<span class="lineno">280</span><span class="op" id="7783029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7783032">func</span>&nbsp;<span class="ident" id="7783037">TestHandshakeClientECDHERSAAES</span><span class="op" id="7783067">(</span><span class="ident" id="7783068">t</span>&nbsp;<span class="op" id="7783070">*</span><span class="ident" id="7783071">testing</span><span class="op" id="7783078">.</span><span class="ident" id="7783079">T</span><span class="op" id="7783080">)</span>&nbsp;<span class="op" id="7783082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7783085">test</span>&nbsp;<span class="op" id="7783090">:=</span>&nbsp;<span class="op" id="7783093">&amp;</span><span class="ident" id="7783094">clientTest</span><span class="op" id="7783104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7783108">name</span><span class="op" id="7783112">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7783117">&#34;ECDHE-RSA-AES&#34;</span><span class="op" id="7783132">,</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7783136">command</span><span class="op" id="7783143">:</span>&nbsp;<span class="op" id="7783145">[</span><span class="op" id="7783146">]</span><span class="builtintype" id="7783147">string</span><span class="op" id="7783153">{</span><span class="string" id="7783154">&#34;openssl&#34;</span><span class="op" id="7783163">,</span>&nbsp;<span class="string" id="7783165">&#34;s_server&#34;</span><span class="op" id="7783175">,</span>&nbsp;<span class="string" id="7783177">&#34;-cipher&#34;</span><span class="op" id="7783186">,</span>&nbsp;<span class="string" id="7783188">&#34;ECDHE-RSA-AES128-SHA&#34;</span><span class="op" id="7783210">}</span><span class="op" id="7783211">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7783214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7783217">runClientTestTLS10</span><span class="op" id="7783235">(</span><span class="ident" id="7783236">t</span><span class="op" id="7783237">,</span>&nbsp;<span class="ident" id="7783239">test</span><span class="op" id="7783243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7783246">runClientTestTLS11</span><span class="op" id="7783264">(</span><span class="ident" id="7783265">t</span><span class="op" id="7783266">,</span>&nbsp;<span class="ident" id="7783268">test</span><span class="op" id="7783272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7783275">runClientTestTLS12</span><span class="op" id="7783293">(</span><span class="ident" id="7783294">t</span><span class="op" id="7783295">,</span>&nbsp;<span class="ident" id="7783297">test</span><span class="op" id="7783301">)</span><br>
<span class="lineno">290</span><span class="op" id="7783303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7783306">func</span>&nbsp;<span class="ident" id="7783311">TestHandshakeClientECDHEECDSAAES</span><span class="op" id="7783343">(</span><span class="ident" id="7783344">t</span>&nbsp;<span class="op" id="7783346">*</span><span class="ident" id="7783347">testing</span><span class="op" id="7783354">.</span><span class="ident" id="7783355">T</span><span class="op" id="7783356">)</span>&nbsp;<span class="op" id="7783358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7783361">test</span>&nbsp;<span class="op" id="7783366">:=</span>&nbsp;<span class="op" id="7783369">&amp;</span><span class="ident" id="7783370">clientTest</span><span class="op" id="7783380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7783384">name</span><span class="op" id="7783388">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7783393">&#34;ECDHE-ECDSA-AES&#34;</span><span class="op" id="7783410">,</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7783414">command</span><span class="op" id="7783421">:</span>&nbsp;<span class="op" id="7783423">[</span><span class="op" id="7783424">]</span><span class="builtintype" id="7783425">string</span><span class="op" id="7783431">{</span><span class="string" id="7783432">&#34;openssl&#34;</span><span class="op" id="7783441">,</span>&nbsp;<span class="string" id="7783443">&#34;s_server&#34;</span><span class="op" id="7783453">,</span>&nbsp;<span class="string" id="7783455">&#34;-cipher&#34;</span><span class="op" id="7783464">,</span>&nbsp;<span class="string" id="7783466">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="7783490">}</span><span class="op" id="7783491">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7783495">cert</span><span class="op" id="7783499">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7783504">testECDSACertificate</span><span class="op" id="7783524">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7783528">key</span><span class="op" id="7783531">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7783537">testECDSAPrivateKey</span><span class="op" id="7783556">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7783559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7783562">runClientTestTLS10</span><span class="op" id="7783580">(</span><span class="ident" id="7783581">t</span><span class="op" id="7783582">,</span>&nbsp;<span class="ident" id="7783584">test</span><span class="op" id="7783588">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7783591">runClientTestTLS11</span><span class="op" id="7783609">(</span><span class="ident" id="7783610">t</span><span class="op" id="7783611">,</span>&nbsp;<span class="ident" id="7783613">test</span><span class="op" id="7783617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7783620">runClientTestTLS12</span><span class="op" id="7783638">(</span><span class="ident" id="7783639">t</span><span class="op" id="7783640">,</span>&nbsp;<span class="ident" id="7783642">test</span><span class="op" id="7783646">)</span><br>
<span class="lineno"></span><span class="op" id="7783648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7783651">func</span>&nbsp;<span class="ident" id="7783656">TestHandshakeClientECDHEECDSAAESGCM</span><span class="op" id="7783691">(</span><span class="ident" id="7783692">t</span>&nbsp;<span class="op" id="7783694">*</span><span class="ident" id="7783695">testing</span><span class="op" id="7783702">.</span><span class="ident" id="7783703">T</span><span class="op" id="7783704">)</span>&nbsp;<span class="op" id="7783706">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7783709">test</span>&nbsp;<span class="op" id="7783714">:=</span>&nbsp;<span class="op" id="7783717">&amp;</span><span class="ident" id="7783718">clientTest</span><span class="op" id="7783728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7783732">name</span><span class="op" id="7783736">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7783741">&#34;ECDHE-ECDSA-AES-GCM&#34;</span><span class="op" id="7783762">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7783766">command</span><span class="op" id="7783773">:</span>&nbsp;<span class="op" id="7783775">[</span><span class="op" id="7783776">]</span><span class="builtintype" id="7783777">string</span><span class="op" id="7783783">{</span><span class="string" id="7783784">&#34;openssl&#34;</span><span class="op" id="7783793">,</span>&nbsp;<span class="string" id="7783795">&#34;s_server&#34;</span><span class="op" id="7783805">,</span>&nbsp;<span class="string" id="7783807">&#34;-cipher&#34;</span><span class="op" id="7783816">,</span>&nbsp;<span class="string" id="7783818">&#34;ECDHE-ECDSA-AES128-GCM-SHA256&#34;</span><span class="op" id="7783849">}</span><span class="op" id="7783850">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7783854">cert</span><span class="op" id="7783858">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7783863">testECDSACertificate</span><span class="op" id="7783883">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7783887">key</span><span class="op" id="7783890">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7783896">testECDSAPrivateKey</span><span class="op" id="7783915">,</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7783918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7783921">runClientTestTLS12</span><span class="op" id="7783939">(</span><span class="ident" id="7783940">t</span><span class="op" id="7783941">,</span>&nbsp;<span class="ident" id="7783943">test</span><span class="op" id="7783947">)</span><br>
<span class="lineno"></span><span class="op" id="7783949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7783952">func</span>&nbsp;<span class="ident" id="7783957">TestHandshakeClientCertRSA</span><span class="op" id="7783983">(</span><span class="ident" id="7783984">t</span>&nbsp;<span class="op" id="7783986">*</span><span class="ident" id="7783987">testing</span><span class="op" id="7783994">.</span><span class="ident" id="7783995">T</span><span class="op" id="7783996">)</span>&nbsp;<span class="op" id="7783998">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7784001">config</span>&nbsp;<span class="op" id="7784008">:=</span>&nbsp;<span class="op" id="7784011">*</span><span class="ident" id="7784012">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7784024">cert</span><span class="op" id="7784028">,</span>&nbsp;<span class="ident" id="7784030">_</span>&nbsp;<span class="op" id="7784032">:=</span>&nbsp;<span class="ident" id="7784035">X509KeyPair</span><span class="op" id="7784046">(</span><span class="op" id="7784047">[</span><span class="op" id="7784048">]</span><span class="builtintype" id="7784049">byte</span><span class="op" id="7784053">(</span><span class="ident" id="7784054">clientCertificatePEM</span><span class="op" id="7784074">)</span><span class="op" id="7784075">,</span>&nbsp;<span class="op" id="7784077">[</span><span class="op" id="7784078">]</span><span class="builtintype" id="7784079">byte</span><span class="op" id="7784083">(</span><span class="ident" id="7784084">clientKeyPEM</span><span class="op" id="7784096">)</span><span class="op" id="7784097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7784100">config</span><span class="op" id="7784106">.</span><span class="ident" id="7784107">Certificates</span>&nbsp;<span class="op" id="7784120">=</span>&nbsp;<span class="op" id="7784122">[</span><span class="op" id="7784123">]</span><span class="ident" id="7784124">Certificate</span><span class="op" id="7784135">{</span><span class="ident" id="7784136">cert</span><span class="op" id="7784140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7784144">test</span>&nbsp;<span class="op" id="7784149">:=</span>&nbsp;<span class="op" id="7784152">&amp;</span><span class="ident" id="7784153">clientTest</span><span class="op" id="7784163">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7784167">name</span><span class="op" id="7784171">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7784176">&#34;ClientCert-RSA-RSA&#34;</span><span class="op" id="7784196">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7784200">command</span><span class="op" id="7784207">:</span>&nbsp;<span class="op" id="7784209">[</span><span class="op" id="7784210">]</span><span class="builtintype" id="7784211">string</span><span class="op" id="7784217">{</span><span class="string" id="7784218">&#34;openssl&#34;</span><span class="op" id="7784227">,</span>&nbsp;<span class="string" id="7784229">&#34;s_server&#34;</span><span class="op" id="7784239">,</span>&nbsp;<span class="string" id="7784241">&#34;-cipher&#34;</span><span class="op" id="7784250">,</span>&nbsp;<span class="string" id="7784252">&#34;RC4-SHA&#34;</span><span class="op" id="7784261">,</span>&nbsp;<span class="string" id="7784263">&#34;-verify&#34;</span><span class="op" id="7784272">,</span>&nbsp;<span class="string" id="7784274">&#34;1&#34;</span><span class="op" id="7784277">}</span><span class="op" id="7784278">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7784282">config</span><span class="op" id="7784288">:</span>&nbsp;&nbsp;<span class="op" id="7784291">&amp;</span><span class="ident" id="7784292">config</span><span class="op" id="7784298">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7784301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7784305">runClientTestTLS10</span><span class="op" id="7784323">(</span><span class="ident" id="7784324">t</span><span class="op" id="7784325">,</span>&nbsp;<span class="ident" id="7784327">test</span><span class="op" id="7784331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7784334">runClientTestTLS12</span><span class="op" id="7784352">(</span><span class="ident" id="7784353">t</span><span class="op" id="7784354">,</span>&nbsp;<span class="ident" id="7784356">test</span><span class="op" id="7784360">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7784364">test</span>&nbsp;<span class="op" id="7784369">=</span>&nbsp;<span class="op" id="7784371">&amp;</span><span class="ident" id="7784372">clientTest</span><span class="op" id="7784382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7784386">name</span><span class="op" id="7784390">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7784395">&#34;ClientCert-RSA-ECDSA&#34;</span><span class="op" id="7784417">,</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7784421">command</span><span class="op" id="7784428">:</span>&nbsp;<span class="op" id="7784430">[</span><span class="op" id="7784431">]</span><span class="builtintype" id="7784432">string</span><span class="op" id="7784438">{</span><span class="string" id="7784439">&#34;openssl&#34;</span><span class="op" id="7784448">,</span>&nbsp;<span class="string" id="7784450">&#34;s_server&#34;</span><span class="op" id="7784460">,</span>&nbsp;<span class="string" id="7784462">&#34;-cipher&#34;</span><span class="op" id="7784471">,</span>&nbsp;<span class="string" id="7784473">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="7784497">,</span>&nbsp;<span class="string" id="7784499">&#34;-verify&#34;</span><span class="op" id="7784508">,</span>&nbsp;<span class="string" id="7784510">&#34;1&#34;</span><span class="op" id="7784513">}</span><span class="op" id="7784514">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7784518">config</span><span class="op" id="7784524">:</span>&nbsp;&nbsp;<span class="op" id="7784527">&amp;</span><span class="ident" id="7784528">config</span><span class="op" id="7784534">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7784538">cert</span><span class="op" id="7784542">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7784547">testECDSACertificate</span><span class="op" id="7784567">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7784571">key</span><span class="op" id="7784574">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7784580">testECDSAPrivateKey</span><span class="op" id="7784599">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7784602">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7784606">runClientTestTLS10</span><span class="op" id="7784624">(</span><span class="ident" id="7784625">t</span><span class="op" id="7784626">,</span>&nbsp;<span class="ident" id="7784628">test</span><span class="op" id="7784632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7784635">runClientTestTLS12</span><span class="op" id="7784653">(</span><span class="ident" id="7784654">t</span><span class="op" id="7784655">,</span>&nbsp;<span class="ident" id="7784657">test</span><span class="op" id="7784661">)</span><br>
<span class="lineno"></span><span class="op" id="7784663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="keyword" id="7784666">func</span>&nbsp;<span class="ident" id="7784671">TestHandshakeClientCertECDSA</span><span class="op" id="7784699">(</span><span class="ident" id="7784700">t</span>&nbsp;<span class="op" id="7784702">*</span><span class="ident" id="7784703">testing</span><span class="op" id="7784710">.</span><span class="ident" id="7784711">T</span><span class="op" id="7784712">)</span>&nbsp;<span class="op" id="7784714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7784717">config</span>&nbsp;<span class="op" id="7784724">:=</span>&nbsp;<span class="op" id="7784727">*</span><span class="ident" id="7784728">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7784740">cert</span><span class="op" id="7784744">,</span>&nbsp;<span class="ident" id="7784746">_</span>&nbsp;<span class="op" id="7784748">:=</span>&nbsp;<span class="ident" id="7784751">X509KeyPair</span><span class="op" id="7784762">(</span><span class="op" id="7784763">[</span><span class="op" id="7784764">]</span><span class="builtintype" id="7784765">byte</span><span class="op" id="7784769">(</span><span class="ident" id="7784770">clientECDSACertificatePEM</span><span class="op" id="7784795">)</span><span class="op" id="7784796">,</span>&nbsp;<span class="op" id="7784798">[</span><span class="op" id="7784799">]</span><span class="builtintype" id="7784800">byte</span><span class="op" id="7784804">(</span><span class="ident" id="7784805">clientECDSAKeyPEM</span><span class="op" id="7784822">)</span><span class="op" id="7784823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7784826">config</span><span class="op" id="7784832">.</span><span class="ident" id="7784833">Certificates</span>&nbsp;<span class="op" id="7784846">=</span>&nbsp;<span class="op" id="7784848">[</span><span class="op" id="7784849">]</span><span class="ident" id="7784850">Certificate</span><span class="op" id="7784861">{</span><span class="ident" id="7784862">cert</span><span class="op" id="7784866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7784870">test</span>&nbsp;<span class="op" id="7784875">:=</span>&nbsp;<span class="op" id="7784878">&amp;</span><span class="ident" id="7784879">clientTest</span><span class="op" id="7784889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7784893">name</span><span class="op" id="7784897">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7784902">&#34;ClientCert-ECDSA-RSA&#34;</span><span class="op" id="7784924">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7784928">command</span><span class="op" id="7784935">:</span>&nbsp;<span class="op" id="7784937">[</span><span class="op" id="7784938">]</span><span class="builtintype" id="7784939">string</span><span class="op" id="7784945">{</span><span class="string" id="7784946">&#34;openssl&#34;</span><span class="op" id="7784955">,</span>&nbsp;<span class="string" id="7784957">&#34;s_server&#34;</span><span class="op" id="7784967">,</span>&nbsp;<span class="string" id="7784969">&#34;-cipher&#34;</span><span class="op" id="7784978">,</span>&nbsp;<span class="string" id="7784980">&#34;RC4-SHA&#34;</span><span class="op" id="7784989">,</span>&nbsp;<span class="string" id="7784991">&#34;-verify&#34;</span><span class="op" id="7785000">,</span>&nbsp;<span class="string" id="7785002">&#34;1&#34;</span><span class="op" id="7785005">}</span><span class="op" id="7785006">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7785010">config</span><span class="op" id="7785016">:</span>&nbsp;&nbsp;<span class="op" id="7785019">&amp;</span><span class="ident" id="7785020">config</span><span class="op" id="7785026">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7785029">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7785033">runClientTestTLS10</span><span class="op" id="7785051">(</span><span class="ident" id="7785052">t</span><span class="op" id="7785053">,</span>&nbsp;<span class="ident" id="7785055">test</span><span class="op" id="7785059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7785062">runClientTestTLS12</span><span class="op" id="7785080">(</span><span class="ident" id="7785081">t</span><span class="op" id="7785082">,</span>&nbsp;<span class="ident" id="7785084">test</span><span class="op" id="7785088">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7785092">test</span>&nbsp;<span class="op" id="7785097">=</span>&nbsp;<span class="op" id="7785099">&amp;</span><span class="ident" id="7785100">clientTest</span><span class="op" id="7785110">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7785114">name</span><span class="op" id="7785118">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7785123">&#34;ClientCert-ECDSA-ECDSA&#34;</span><span class="op" id="7785147">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7785151">command</span><span class="op" id="7785158">:</span>&nbsp;<span class="op" id="7785160">[</span><span class="op" id="7785161">]</span><span class="builtintype" id="7785162">string</span><span class="op" id="7785168">{</span><span class="string" id="7785169">&#34;openssl&#34;</span><span class="op" id="7785178">,</span>&nbsp;<span class="string" id="7785180">&#34;s_server&#34;</span><span class="op" id="7785190">,</span>&nbsp;<span class="string" id="7785192">&#34;-cipher&#34;</span><span class="op" id="7785201">,</span>&nbsp;<span class="string" id="7785203">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="7785227">,</span>&nbsp;<span class="string" id="7785229">&#34;-verify&#34;</span><span class="op" id="7785238">,</span>&nbsp;<span class="string" id="7785240">&#34;1&#34;</span><span class="op" id="7785243">}</span><span class="op" id="7785244">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7785248">config</span><span class="op" id="7785254">:</span>&nbsp;&nbsp;<span class="op" id="7785257">&amp;</span><span class="ident" id="7785258">config</span><span class="op" id="7785264">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7785268">cert</span><span class="op" id="7785272">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7785277">testECDSACertificate</span><span class="op" id="7785297">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7785301">key</span><span class="op" id="7785304">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7785310">testECDSAPrivateKey</span><span class="op" id="7785329">,</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7785332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7785336">runClientTestTLS10</span><span class="op" id="7785354">(</span><span class="ident" id="7785355">t</span><span class="op" id="7785356">,</span>&nbsp;<span class="ident" id="7785358">test</span><span class="op" id="7785362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7785365">runClientTestTLS12</span><span class="op" id="7785383">(</span><span class="ident" id="7785384">t</span><span class="op" id="7785385">,</span>&nbsp;<span class="ident" id="7785387">test</span><span class="op" id="7785391">)</span><br>
<span class="lineno"></span><span class="op" id="7785393">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="7785396">func</span>&nbsp;<span class="ident" id="7785401">TestClientResumption</span><span class="op" id="7785421">(</span><span class="ident" id="7785422">t</span>&nbsp;<span class="op" id="7785424">*</span><span class="ident" id="7785425">testing</span><span class="op" id="7785432">.</span><span class="ident" id="7785433">T</span><span class="op" id="7785434">)</span>&nbsp;<span class="op" id="7785436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7785439">serverConfig</span>&nbsp;<span class="op" id="7785452">:=</span>&nbsp;<span class="op" id="7785455">&amp;</span><span class="ident" id="7785456">Config</span><span class="op" id="7785462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7785466">CipherSuites</span><span class="op" id="7785478">:</span>&nbsp;<span class="op" id="7785480">[</span><span class="op" id="7785481">]</span><span class="builtintype" id="7785482">uint16</span><span class="op" id="7785488">{</span><span class="ident" id="7785489">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="7785513">,</span>&nbsp;<span class="ident" id="7785515">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span><span class="op" id="7785545">}</span><span class="op" id="7785546">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7785550">Certificates</span><span class="op" id="7785562">:</span>&nbsp;<span class="ident" id="7785564">testConfig</span><span class="op" id="7785574">.</span><span class="ident" id="7785575">Certificates</span><span class="op" id="7785587">,</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7785590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7785593">clientConfig</span>&nbsp;<span class="op" id="7785606">:=</span>&nbsp;<span class="op" id="7785609">&amp;</span><span class="ident" id="7785610">Config</span><span class="op" id="7785616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7785620">CipherSuites</span><span class="op" id="7785632">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7785640">[</span><span class="op" id="7785641">]</span><span class="builtintype" id="7785642">uint16</span><span class="op" id="7785648">{</span><span class="ident" id="7785649">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="7785673">}</span><span class="op" id="7785674">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7785678">InsecureSkipVerify</span><span class="op" id="7785696">:</span>&nbsp;<span class="builtintype" id="7785698">true</span><span class="op" id="7785702">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7785706">ClientSessionCache</span><span class="op" id="7785724">:</span>&nbsp;<span class="ident" id="7785726">NewLRUClientSessionCache</span><span class="op" id="7785750">(</span><span class="num" id="7785751">32</span><span class="op" id="7785753">)</span><span class="op" id="7785754">,</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7785757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7785761">testResumeState</span>&nbsp;<span class="op" id="7785777">:=</span>&nbsp;<span class="keyword" id="7785780">func</span><span class="op" id="7785784">(</span><span class="ident" id="7785785">test</span>&nbsp;<span class="builtintype" id="7785790">string</span><span class="op" id="7785796">,</span>&nbsp;<span class="ident" id="7785798">didResume</span>&nbsp;<span class="builtintype" id="7785808">bool</span><span class="op" id="7785812">)</span>&nbsp;<span class="op" id="7785814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7785818">hs</span><span class="op" id="7785820">,</span>&nbsp;<span class="ident" id="7785822">err</span>&nbsp;<span class="op" id="7785826">:=</span>&nbsp;<span class="ident" id="7785829">testHandshake</span><span class="op" id="7785842">(</span><span class="ident" id="7785843">clientConfig</span><span class="op" id="7785855">,</span>&nbsp;<span class="ident" id="7785857">serverConfig</span><span class="op" id="7785869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7785873">if</span>&nbsp;<span class="ident" id="7785876">err</span>&nbsp;<span class="op" id="7785880">!=</span>&nbsp;<span class="builtintype" id="7785883">nil</span>&nbsp;<span class="op" id="7785887">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7785892">t</span><span class="op" id="7785893">.</span><span class="ident" id="7785894">Fatalf</span><span class="op" id="7785900">(</span><span class="string" id="7785901">&#34;%s:&nbsp;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7785927">,</span>&nbsp;<span class="ident" id="7785929">test</span><span class="op" id="7785933">,</span>&nbsp;<span class="ident" id="7785935">err</span><span class="op" id="7785938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7785942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7785946">if</span>&nbsp;<span class="ident" id="7785949">hs</span><span class="op" id="7785951">.</span><span class="ident" id="7785952">DidResume</span>&nbsp;<span class="op" id="7785962">!=</span>&nbsp;<span class="ident" id="7785965">didResume</span>&nbsp;<span class="op" id="7785975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7785980">t</span><span class="op" id="7785981">.</span><span class="ident" id="7785982">Fatalf</span><span class="op" id="7785988">(</span><span class="string" id="7785989">&#34;%s&nbsp;resumed:&nbsp;%v,&nbsp;expected:&nbsp;%v&#34;</span><span class="op" id="7786019">,</span>&nbsp;<span class="ident" id="7786021">test</span><span class="op" id="7786025">,</span>&nbsp;<span class="ident" id="7786027">hs</span><span class="op" id="7786029">.</span><span class="ident" id="7786030">DidResume</span><span class="op" id="7786039">,</span>&nbsp;<span class="ident" id="7786041">didResume</span><span class="op" id="7786050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7786054">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7786057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7786061">testResumeState</span><span class="op" id="7786076">(</span><span class="string" id="7786077">&#34;Handshake&#34;</span><span class="op" id="7786088">,</span>&nbsp;<span class="builtintype" id="7786090">false</span><span class="op" id="7786095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7786098">testResumeState</span><span class="op" id="7786113">(</span><span class="string" id="7786114">&#34;Resume&#34;</span><span class="op" id="7786122">,</span>&nbsp;<span class="builtintype" id="7786124">true</span><span class="op" id="7786128">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7786132">if</span>&nbsp;<span class="ident" id="7786135">_</span><span class="op" id="7786136">,</span>&nbsp;<span class="ident" id="7786138">err</span>&nbsp;<span class="op" id="7786142">:=</span>&nbsp;<span class="ident" id="7786145">io</span><span class="op" id="7786147">.</span><span class="ident" id="7786148">ReadFull</span><span class="op" id="7786156">(</span><span class="ident" id="7786157">serverConfig</span><span class="op" id="7786169">.</span><span class="ident" id="7786170">rand</span><span class="op" id="7786174">(</span><span class="op" id="7786175">)</span><span class="op" id="7786176">,</span>&nbsp;<span class="ident" id="7786178">serverConfig</span><span class="op" id="7786190">.</span><span class="ident" id="7786191">SessionTicketKey</span><span class="op" id="7786207">[</span><span class="op" id="7786208">:</span><span class="op" id="7786209">]</span><span class="op" id="7786210">)</span><span class="op" id="7786211">;</span>&nbsp;<span class="ident" id="7786213">err</span>&nbsp;<span class="op" id="7786217">!=</span>&nbsp;<span class="builtintype" id="7786220">nil</span>&nbsp;<span class="op" id="7786224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7786228">t</span><span class="op" id="7786229">.</span><span class="ident" id="7786230">Fatalf</span><span class="op" id="7786236">(</span><span class="string" id="7786237">&#34;Failed&nbsp;to&nbsp;invalidate&nbsp;SessionTicketKey&#34;</span><span class="op" id="7786276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7786279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7786282">testResumeState</span><span class="op" id="7786297">(</span><span class="string" id="7786298">&#34;InvalidSessionTicketKey&#34;</span><span class="op" id="7786323">,</span>&nbsp;<span class="builtintype" id="7786325">false</span><span class="op" id="7786330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7786333">testResumeState</span><span class="op" id="7786348">(</span><span class="string" id="7786349">&#34;ResumeAfterInvalidSessionTicketKey&#34;</span><span class="op" id="7786385">,</span>&nbsp;<span class="builtintype" id="7786387">true</span><span class="op" id="7786391">)</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7786395">clientConfig</span><span class="op" id="7786407">.</span><span class="ident" id="7786408">CipherSuites</span>&nbsp;<span class="op" id="7786421">=</span>&nbsp;<span class="op" id="7786423">[</span><span class="op" id="7786424">]</span><span class="builtintype" id="7786425">uint16</span><span class="op" id="7786431">{</span><span class="ident" id="7786432">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span><span class="op" id="7786462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7786465">testResumeState</span><span class="op" id="7786480">(</span><span class="string" id="7786481">&#34;DifferentCipherSuite&#34;</span><span class="op" id="7786503">,</span>&nbsp;<span class="builtintype" id="7786505">false</span><span class="op" id="7786510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7786513">testResumeState</span><span class="op" id="7786528">(</span><span class="string" id="7786529">&#34;DifferentCipherSuiteRecovers&#34;</span><span class="op" id="7786559">,</span>&nbsp;<span class="builtintype" id="7786561">true</span><span class="op" id="7786565">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7786569">clientConfig</span><span class="op" id="7786581">.</span><span class="ident" id="7786582">ClientSessionCache</span>&nbsp;<span class="op" id="7786601">=</span>&nbsp;<span class="builtintype" id="7786603">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7786608">testResumeState</span><span class="op" id="7786623">(</span><span class="string" id="7786624">&#34;WithoutSessionCache&#34;</span><span class="op" id="7786645">,</span>&nbsp;<span class="builtintype" id="7786647">false</span><span class="op" id="7786652">)</span><br>
<span class="lineno"></span><span class="op" id="7786654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7786657">func</span>&nbsp;<span class="ident" id="7786662">TestLRUClientSessionCache</span><span class="op" id="7786687">(</span><span class="ident" id="7786688">t</span>&nbsp;<span class="op" id="7786690">*</span><span class="ident" id="7786691">testing</span><span class="op" id="7786698">.</span><span class="ident" id="7786699">T</span><span class="op" id="7786700">)</span>&nbsp;<span class="op" id="7786702">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7786705">//&nbsp;Initialize&nbsp;cache&nbsp;of&nbsp;capacity&nbsp;4.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7786741">cache</span>&nbsp;<span class="op" id="7786747">:=</span>&nbsp;<span class="ident" id="7786750">NewLRUClientSessionCache</span><span class="op" id="7786774">(</span><span class="num" id="7786775">4</span><span class="op" id="7786776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7786779">cs</span>&nbsp;<span class="op" id="7786782">:=</span>&nbsp;<span class="builtinfunc" id="7786785">make</span><span class="op" id="7786789">(</span><span class="op" id="7786790">[</span><span class="op" id="7786791">]</span><span class="ident" id="7786792">ClientSessionState</span><span class="op" id="7786810">,</span>&nbsp;<span class="num" id="7786812">6</span><span class="op" id="7786813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7786816">keys</span>&nbsp;<span class="op" id="7786821">:=</span>&nbsp;<span class="op" id="7786824">[</span><span class="op" id="7786825">]</span><span class="builtintype" id="7786826">string</span><span class="op" id="7786832">{</span><span class="string" id="7786833">&#34;0&#34;</span><span class="op" id="7786836">,</span>&nbsp;<span class="string" id="7786838">&#34;1&#34;</span><span class="op" id="7786841">,</span>&nbsp;<span class="string" id="7786843">&#34;2&#34;</span><span class="op" id="7786846">,</span>&nbsp;<span class="string" id="7786848">&#34;3&#34;</span><span class="op" id="7786851">,</span>&nbsp;<span class="string" id="7786853">&#34;4&#34;</span><span class="op" id="7786856">,</span>&nbsp;<span class="string" id="7786858">&#34;5&#34;</span><span class="op" id="7786861">,</span>&nbsp;<span class="string" id="7786863">&#34;6&#34;</span><span class="op" id="7786866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7786870">//&nbsp;Add&nbsp;4&nbsp;entries&nbsp;to&nbsp;the&nbsp;cache&nbsp;and&nbsp;look&nbsp;them&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7786919">for</span>&nbsp;<span class="ident" id="7786923">i</span>&nbsp;<span class="op" id="7786925">:=</span>&nbsp;<span class="num" id="7786928">0</span><span class="op" id="7786929">;</span>&nbsp;<span class="ident" id="7786931">i</span>&nbsp;<span class="op" id="7786933">&lt;</span>&nbsp;<span class="num" id="7786935">4</span><span class="op" id="7786936">;</span>&nbsp;<span class="ident" id="7786938">i</span><span class="op" id="7786939">++</span>&nbsp;<span class="op" id="7786942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7786946">cache</span><span class="op" id="7786951">.</span><span class="ident" id="7786952">Put</span><span class="op" id="7786955">(</span><span class="ident" id="7786956">keys</span><span class="op" id="7786960">[</span><span class="ident" id="7786961">i</span><span class="op" id="7786962">]</span><span class="op" id="7786963">,</span>&nbsp;<span class="op" id="7786965">&amp;</span><span class="ident" id="7786966">cs</span><span class="op" id="7786968">[</span><span class="ident" id="7786969">i</span><span class="op" id="7786970">]</span><span class="op" id="7786971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7786974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7786977">for</span>&nbsp;<span class="ident" id="7786981">i</span>&nbsp;<span class="op" id="7786983">:=</span>&nbsp;<span class="num" id="7786986">0</span><span class="op" id="7786987">;</span>&nbsp;<span class="ident" id="7786989">i</span>&nbsp;<span class="op" id="7786991">&lt;</span>&nbsp;<span class="num" id="7786993">4</span><span class="op" id="7786994">;</span>&nbsp;<span class="ident" id="7786996">i</span><span class="op" id="7786997">++</span>&nbsp;<span class="op" id="7787000">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7787004">if</span>&nbsp;<span class="ident" id="7787007">s</span><span class="op" id="7787008">,</span>&nbsp;<span class="ident" id="7787010">ok</span>&nbsp;<span class="op" id="7787013">:=</span>&nbsp;<span class="ident" id="7787016">cache</span><span class="op" id="7787021">.</span><span class="ident" id="7787022">Get</span><span class="op" id="7787025">(</span><span class="ident" id="7787026">keys</span><span class="op" id="7787030">[</span><span class="ident" id="7787031">i</span><span class="op" id="7787032">]</span><span class="op" id="7787033">)</span><span class="op" id="7787034">;</span>&nbsp;<span class="op" id="7787036">!</span><span class="ident" id="7787037">ok</span>&nbsp;<span class="op" id="7787040">||</span>&nbsp;<span class="ident" id="7787043">s</span>&nbsp;<span class="op" id="7787045">!=</span>&nbsp;<span class="op" id="7787048">&amp;</span><span class="ident" id="7787049">cs</span><span class="op" id="7787051">[</span><span class="ident" id="7787052">i</span><span class="op" id="7787053">]</span>&nbsp;<span class="op" id="7787055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7787060">t</span><span class="op" id="7787061">.</span><span class="ident" id="7787062">Fatalf</span><span class="op" id="7787068">(</span><span class="string" id="7787069">&#34;session&nbsp;cache&nbsp;failed&nbsp;lookup&nbsp;for&nbsp;added&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="7787116">,</span>&nbsp;<span class="ident" id="7787118">keys</span><span class="op" id="7787122">[</span><span class="ident" id="7787123">i</span><span class="op" id="7787124">]</span><span class="op" id="7787125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7787129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7787132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7787136">//&nbsp;Add&nbsp;2&nbsp;more&nbsp;entries&nbsp;to&nbsp;the&nbsp;cache.&nbsp;First&nbsp;2&nbsp;should&nbsp;be&nbsp;evicted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7787200">for</span>&nbsp;<span class="ident" id="7787204">i</span>&nbsp;<span class="op" id="7787206">:=</span>&nbsp;<span class="num" id="7787209">4</span><span class="op" id="7787210">;</span>&nbsp;<span class="ident" id="7787212">i</span>&nbsp;<span class="op" id="7787214">&lt;</span>&nbsp;<span class="num" id="7787216">6</span><span class="op" id="7787217">;</span>&nbsp;<span class="ident" id="7787219">i</span><span class="op" id="7787220">++</span>&nbsp;<span class="op" id="7787223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7787227">cache</span><span class="op" id="7787232">.</span><span class="ident" id="7787233">Put</span><span class="op" id="7787236">(</span><span class="ident" id="7787237">keys</span><span class="op" id="7787241">[</span><span class="ident" id="7787242">i</span><span class="op" id="7787243">]</span><span class="op" id="7787244">,</span>&nbsp;<span class="op" id="7787246">&amp;</span><span class="ident" id="7787247">cs</span><span class="op" id="7787249">[</span><span class="ident" id="7787250">i</span><span class="op" id="7787251">]</span><span class="op" id="7787252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7787255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7787258">for</span>&nbsp;<span class="ident" id="7787262">i</span>&nbsp;<span class="op" id="7787264">:=</span>&nbsp;<span class="num" id="7787267">0</span><span class="op" id="7787268">;</span>&nbsp;<span class="ident" id="7787270">i</span>&nbsp;<span class="op" id="7787272">&lt;</span>&nbsp;<span class="num" id="7787274">2</span><span class="op" id="7787275">;</span>&nbsp;<span class="ident" id="7787277">i</span><span class="op" id="7787278">++</span>&nbsp;<span class="op" id="7787281">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7787285">if</span>&nbsp;<span class="ident" id="7787288">s</span><span class="op" id="7787289">,</span>&nbsp;<span class="ident" id="7787291">ok</span>&nbsp;<span class="op" id="7787294">:=</span>&nbsp;<span class="ident" id="7787297">cache</span><span class="op" id="7787302">.</span><span class="ident" id="7787303">Get</span><span class="op" id="7787306">(</span><span class="ident" id="7787307">keys</span><span class="op" id="7787311">[</span><span class="ident" id="7787312">i</span><span class="op" id="7787313">]</span><span class="op" id="7787314">)</span><span class="op" id="7787315">;</span>&nbsp;<span class="ident" id="7787317">ok</span>&nbsp;<span class="op" id="7787320">||</span>&nbsp;<span class="ident" id="7787323">s</span>&nbsp;<span class="op" id="7787325">!=</span>&nbsp;<span class="builtintype" id="7787328">nil</span>&nbsp;<span class="op" id="7787332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7787337">t</span><span class="op" id="7787338">.</span><span class="ident" id="7787339">Fatalf</span><span class="op" id="7787345">(</span><span class="string" id="7787346">&#34;session&nbsp;cache&nbsp;should&nbsp;have&nbsp;evicted&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="7787389">,</span>&nbsp;<span class="ident" id="7787391">keys</span><span class="op" id="7787395">[</span><span class="ident" id="7787396">i</span><span class="op" id="7787397">]</span><span class="op" id="7787398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7787402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7787405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7787409">//&nbsp;Touch&nbsp;entry&nbsp;2.&nbsp;LRU&nbsp;should&nbsp;evict&nbsp;3&nbsp;next.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7787453">cache</span><span class="op" id="7787458">.</span><span class="ident" id="7787459">Get</span><span class="op" id="7787462">(</span><span class="ident" id="7787463">keys</span><span class="op" id="7787467">[</span><span class="num" id="7787468">2</span><span class="op" id="7787469">]</span><span class="op" id="7787470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7787473">cache</span><span class="op" id="7787478">.</span><span class="ident" id="7787479">Put</span><span class="op" id="7787482">(</span><span class="ident" id="7787483">keys</span><span class="op" id="7787487">[</span><span class="num" id="7787488">0</span><span class="op" id="7787489">]</span><span class="op" id="7787490">,</span>&nbsp;<span class="op" id="7787492">&amp;</span><span class="ident" id="7787493">cs</span><span class="op" id="7787495">[</span><span class="num" id="7787496">0</span><span class="op" id="7787497">]</span><span class="op" id="7787498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7787501">if</span>&nbsp;<span class="ident" id="7787504">s</span><span class="op" id="7787505">,</span>&nbsp;<span class="ident" id="7787507">ok</span>&nbsp;<span class="op" id="7787510">:=</span>&nbsp;<span class="ident" id="7787513">cache</span><span class="op" id="7787518">.</span><span class="ident" id="7787519">Get</span><span class="op" id="7787522">(</span><span class="ident" id="7787523">keys</span><span class="op" id="7787527">[</span><span class="num" id="7787528">3</span><span class="op" id="7787529">]</span><span class="op" id="7787530">)</span><span class="op" id="7787531">;</span>&nbsp;<span class="ident" id="7787533">ok</span>&nbsp;<span class="op" id="7787536">||</span>&nbsp;<span class="ident" id="7787539">s</span>&nbsp;<span class="op" id="7787541">!=</span>&nbsp;<span class="builtintype" id="7787544">nil</span>&nbsp;<span class="op" id="7787548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7787552">t</span><span class="op" id="7787553">.</span><span class="ident" id="7787554">Fatalf</span><span class="op" id="7787560">(</span><span class="string" id="7787561">&#34;session&nbsp;cache&nbsp;should&nbsp;have&nbsp;evicted&nbsp;key&nbsp;3&#34;</span><span class="op" id="7787602">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7787605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7787609">//&nbsp;Update&nbsp;entry&nbsp;0&nbsp;in&nbsp;place.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7787638">cache</span><span class="op" id="7787643">.</span><span class="ident" id="7787644">Put</span><span class="op" id="7787647">(</span><span class="ident" id="7787648">keys</span><span class="op" id="7787652">[</span><span class="num" id="7787653">0</span><span class="op" id="7787654">]</span><span class="op" id="7787655">,</span>&nbsp;<span class="op" id="7787657">&amp;</span><span class="ident" id="7787658">cs</span><span class="op" id="7787660">[</span><span class="num" id="7787661">3</span><span class="op" id="7787662">]</span><span class="op" id="7787663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7787666">if</span>&nbsp;<span class="ident" id="7787669">s</span><span class="op" id="7787670">,</span>&nbsp;<span class="ident" id="7787672">ok</span>&nbsp;<span class="op" id="7787675">:=</span>&nbsp;<span class="ident" id="7787678">cache</span><span class="op" id="7787683">.</span><span class="ident" id="7787684">Get</span><span class="op" id="7787687">(</span><span class="ident" id="7787688">keys</span><span class="op" id="7787692">[</span><span class="num" id="7787693">0</span><span class="op" id="7787694">]</span><span class="op" id="7787695">)</span><span class="op" id="7787696">;</span>&nbsp;<span class="op" id="7787698">!</span><span class="ident" id="7787699">ok</span>&nbsp;<span class="op" id="7787702">||</span>&nbsp;<span class="ident" id="7787705">s</span>&nbsp;<span class="op" id="7787707">!=</span>&nbsp;<span class="op" id="7787710">&amp;</span><span class="ident" id="7787711">cs</span><span class="op" id="7787713">[</span><span class="num" id="7787714">3</span><span class="op" id="7787715">]</span>&nbsp;<span class="op" id="7787717">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7787721">t</span><span class="op" id="7787722">.</span><span class="ident" id="7787723">Fatalf</span><span class="op" id="7787729">(</span><span class="string" id="7787730">&#34;session&nbsp;cache&nbsp;failed&nbsp;update&nbsp;for&nbsp;key&nbsp;0&#34;</span><span class="op" id="7787769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7787772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7787776">//&nbsp;Adding&nbsp;a&nbsp;nil&nbsp;entry&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7787809">cache</span><span class="op" id="7787814">.</span><span class="ident" id="7787815">Put</span><span class="op" id="7787818">(</span><span class="ident" id="7787819">keys</span><span class="op" id="7787823">[</span><span class="num" id="7787824">0</span><span class="op" id="7787825">]</span><span class="op" id="7787826">,</span>&nbsp;<span class="builtintype" id="7787828">nil</span><span class="op" id="7787831">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7787834">if</span>&nbsp;<span class="ident" id="7787837">s</span><span class="op" id="7787838">,</span>&nbsp;<span class="ident" id="7787840">ok</span>&nbsp;<span class="op" id="7787843">:=</span>&nbsp;<span class="ident" id="7787846">cache</span><span class="op" id="7787851">.</span><span class="ident" id="7787852">Get</span><span class="op" id="7787855">(</span><span class="ident" id="7787856">keys</span><span class="op" id="7787860">[</span><span class="num" id="7787861">0</span><span class="op" id="7787862">]</span><span class="op" id="7787863">)</span><span class="op" id="7787864">;</span>&nbsp;<span class="op" id="7787866">!</span><span class="ident" id="7787867">ok</span>&nbsp;<span class="op" id="7787870">||</span>&nbsp;<span class="ident" id="7787873">s</span>&nbsp;<span class="op" id="7787875">!=</span>&nbsp;<span class="builtintype" id="7787878">nil</span>&nbsp;<span class="op" id="7787882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7787886">t</span><span class="op" id="7787887">.</span><span class="ident" id="7787888">Fatalf</span><span class="op" id="7787894">(</span><span class="string" id="7787895">&#34;failed&nbsp;to&nbsp;add&nbsp;nil&nbsp;entry&nbsp;to&nbsp;cache&#34;</span><span class="op" id="7787929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7787932">}</span><br>
<span class="lineno"></span><span class="op" id="7787934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="keyword" id="7787937">func</span>&nbsp;<span class="ident" id="7787942">TestHandshakeClientALPNMatch</span><span class="op" id="7787970">(</span><span class="ident" id="7787971">t</span>&nbsp;<span class="op" id="7787973">*</span><span class="ident" id="7787974">testing</span><span class="op" id="7787981">.</span><span class="ident" id="7787982">T</span><span class="op" id="7787983">)</span>&nbsp;<span class="op" id="7787985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7787988">config</span>&nbsp;<span class="op" id="7787995">:=</span>&nbsp;<span class="op" id="7787998">*</span><span class="ident" id="7787999">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7788011">config</span><span class="op" id="7788017">.</span><span class="ident" id="7788018">NextProtos</span>&nbsp;<span class="op" id="7788029">=</span>&nbsp;<span class="op" id="7788031">[</span><span class="op" id="7788032">]</span><span class="builtintype" id="7788033">string</span><span class="op" id="7788039">{</span><span class="string" id="7788040">&#34;proto2&#34;</span><span class="op" id="7788048">,</span>&nbsp;<span class="string" id="7788050">&#34;proto1&#34;</span><span class="op" id="7788058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7788062">test</span>&nbsp;<span class="op" id="7788067">:=</span>&nbsp;<span class="op" id="7788070">&amp;</span><span class="ident" id="7788071">clientTest</span><span class="op" id="7788081">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7788085">name</span><span class="op" id="7788089">:</span>&nbsp;<span class="string" id="7788091">&#34;ALPN&#34;</span><span class="op" id="7788097">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7788101">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7788167">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7788210">command</span><span class="op" id="7788217">:</span>&nbsp;<span class="op" id="7788219">[</span><span class="op" id="7788220">]</span><span class="builtintype" id="7788221">string</span><span class="op" id="7788227">{</span><span class="string" id="7788228">&#34;openssl&#34;</span><span class="op" id="7788237">,</span>&nbsp;<span class="string" id="7788239">&#34;s_server&#34;</span><span class="op" id="7788249">,</span>&nbsp;<span class="string" id="7788251">&#34;-alpn&#34;</span><span class="op" id="7788258">,</span>&nbsp;<span class="string" id="7788260">&#34;proto1,proto2&#34;</span><span class="op" id="7788275">}</span><span class="op" id="7788276">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7788280">config</span><span class="op" id="7788286">:</span>&nbsp;&nbsp;<span class="op" id="7788289">&amp;</span><span class="ident" id="7788290">config</span><span class="op" id="7788296">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7788300">validate</span><span class="op" id="7788308">:</span>&nbsp;<span class="keyword" id="7788310">func</span><span class="op" id="7788314">(</span><span class="ident" id="7788315">state</span>&nbsp;<span class="ident" id="7788321">ConnectionState</span><span class="op" id="7788336">)</span>&nbsp;<span class="builtintype" id="7788338">error</span>&nbsp;<span class="op" id="7788344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7788349">//&nbsp;The&nbsp;server&#39;s&nbsp;preferences&nbsp;should&nbsp;override&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7788408">if</span>&nbsp;<span class="ident" id="7788411">state</span><span class="op" id="7788416">.</span><span class="ident" id="7788417">NegotiatedProtocol</span>&nbsp;<span class="op" id="7788436">!=</span>&nbsp;<span class="string" id="7788439">&#34;proto1&#34;</span>&nbsp;<span class="op" id="7788448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7788454">return</span>&nbsp;<span class="ident" id="7788461">fmt</span><span class="op" id="7788464">.</span><span class="ident" id="7788465">Errorf</span><span class="op" id="7788471">(</span><span class="string" id="7788472">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;proto1&#34;</span><span class="op" id="7788504">,</span>&nbsp;<span class="ident" id="7788506">state</span><span class="op" id="7788511">.</span><span class="ident" id="7788512">NegotiatedProtocol</span><span class="op" id="7788530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7788535">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7788540">return</span>&nbsp;<span class="builtintype" id="7788547">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7788553">}</span><span class="op" id="7788554">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7788557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7788560">runClientTestTLS12</span><span class="op" id="7788578">(</span><span class="ident" id="7788579">t</span><span class="op" id="7788580">,</span>&nbsp;<span class="ident" id="7788582">test</span><span class="op" id="7788586">)</span><br>
<span class="lineno"></span><span class="op" id="7788588">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="keyword" id="7788591">func</span>&nbsp;<span class="ident" id="7788596">TestHandshakeClientALPNNoMatch</span><span class="op" id="7788626">(</span><span class="ident" id="7788627">t</span>&nbsp;<span class="op" id="7788629">*</span><span class="ident" id="7788630">testing</span><span class="op" id="7788637">.</span><span class="ident" id="7788638">T</span><span class="op" id="7788639">)</span>&nbsp;<span class="op" id="7788641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7788644">config</span>&nbsp;<span class="op" id="7788651">:=</span>&nbsp;<span class="op" id="7788654">*</span><span class="ident" id="7788655">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7788667">config</span><span class="op" id="7788673">.</span><span class="ident" id="7788674">NextProtos</span>&nbsp;<span class="op" id="7788685">=</span>&nbsp;<span class="op" id="7788687">[</span><span class="op" id="7788688">]</span><span class="builtintype" id="7788689">string</span><span class="op" id="7788695">{</span><span class="string" id="7788696">&#34;proto3&#34;</span><span class="op" id="7788704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7788708">test</span>&nbsp;<span class="op" id="7788713">:=</span>&nbsp;<span class="op" id="7788716">&amp;</span><span class="ident" id="7788717">clientTest</span><span class="op" id="7788727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7788731">name</span><span class="op" id="7788735">:</span>&nbsp;<span class="string" id="7788737">&#34;ALPN-NoMatch&#34;</span><span class="op" id="7788751">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7788755">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7788821">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7788864">command</span><span class="op" id="7788871">:</span>&nbsp;<span class="op" id="7788873">[</span><span class="op" id="7788874">]</span><span class="builtintype" id="7788875">string</span><span class="op" id="7788881">{</span><span class="string" id="7788882">&#34;openssl&#34;</span><span class="op" id="7788891">,</span>&nbsp;<span class="string" id="7788893">&#34;s_server&#34;</span><span class="op" id="7788903">,</span>&nbsp;<span class="string" id="7788905">&#34;-alpn&#34;</span><span class="op" id="7788912">,</span>&nbsp;<span class="string" id="7788914">&#34;proto1,proto2&#34;</span><span class="op" id="7788929">}</span><span class="op" id="7788930">,</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7788934">config</span><span class="op" id="7788940">:</span>&nbsp;&nbsp;<span class="op" id="7788943">&amp;</span><span class="ident" id="7788944">config</span><span class="op" id="7788950">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7788954">validate</span><span class="op" id="7788962">:</span>&nbsp;<span class="keyword" id="7788964">func</span><span class="op" id="7788968">(</span><span class="ident" id="7788969">state</span>&nbsp;<span class="ident" id="7788975">ConnectionState</span><span class="op" id="7788990">)</span>&nbsp;<span class="builtintype" id="7788992">error</span>&nbsp;<span class="op" id="7788998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7789003">//&nbsp;There&#39;s&nbsp;no&nbsp;overlap&nbsp;so&nbsp;OpenSSL&nbsp;will&nbsp;not&nbsp;select&nbsp;a&nbsp;protocol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7789067">if</span>&nbsp;<span class="ident" id="7789070">state</span><span class="op" id="7789075">.</span><span class="ident" id="7789076">NegotiatedProtocol</span>&nbsp;<span class="op" id="7789095">!=</span>&nbsp;<span class="string" id="7789098">&#34;&#34;</span>&nbsp;<span class="op" id="7789101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7789107">return</span>&nbsp;<span class="ident" id="7789114">fmt</span><span class="op" id="7789117">.</span><span class="ident" id="7789118">Errorf</span><span class="op" id="7789124">(</span><span class="string" id="7789125">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;&#39;&#39;&#34;</span><span class="op" id="7789153">,</span>&nbsp;<span class="ident" id="7789155">state</span><span class="op" id="7789160">.</span><span class="ident" id="7789161">NegotiatedProtocol</span><span class="op" id="7789179">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7789184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7789189">return</span>&nbsp;<span class="builtintype" id="7789196">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7789202">}</span><span class="op" id="7789203">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7789206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7789209">runClientTestTLS12</span><span class="op" id="7789227">(</span><span class="ident" id="7789228">t</span><span class="op" id="7789229">,</span>&nbsp;<span class="ident" id="7789231">test</span><span class="op" id="7789235">)</span><br>
<span class="lineno">490</span><span class="op" id="7789237">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
