<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4310352">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4310407">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4310461">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4310512">package</span>&nbsp;<span class="ident" id="4310520">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4310526">import</span>&nbsp;<span class="op" id="4310533">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4310536">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4310550">&#34;encoding/asn1&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4310567">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4310577">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4310588">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4310591">//&nbsp;pkcs1PrivateKey&nbsp;is&nbsp;a&nbsp;structure&nbsp;which&nbsp;mirrors&nbsp;the&nbsp;PKCS#1&nbsp;ASN.1&nbsp;for&nbsp;an&nbsp;RSA&nbsp;private&nbsp;key.</span><br>
<span class="lineno">15</span><span class="keyword" id="4310680">type</span>&nbsp;<span class="ident" id="4310685">pkcs1PrivateKey</span>&nbsp;<span class="keyword" id="4310701">struct</span>&nbsp;<span class="op" id="4310708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310711">Version</span>&nbsp;<span class="builtintype" id="4310719">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310724">N</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4310732">*</span><span class="ident" id="4310733">big</span><span class="op" id="4310736">.</span><span class="ident" id="4310737">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310742">E</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4310750">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310755">D</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4310763">*</span><span class="ident" id="4310764">big</span><span class="op" id="4310767">.</span><span class="ident" id="4310768">Int</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310773">P</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4310781">*</span><span class="ident" id="4310782">big</span><span class="op" id="4310785">.</span><span class="ident" id="4310786">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310791">Q</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4310799">*</span><span class="ident" id="4310800">big</span><span class="op" id="4310803">.</span><span class="ident" id="4310804">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4310809">//&nbsp;We&nbsp;ignore&nbsp;these&nbsp;values,&nbsp;if&nbsp;present,&nbsp;because&nbsp;rsa&nbsp;will&nbsp;calculate&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310882">Dp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4310887">*</span><span class="ident" id="4310888">big</span><span class="op" id="4310891">.</span><span class="ident" id="4310892">Int</span>&nbsp;<span class="string" id="4310896">`asn1:&#34;optional&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310915">Dq</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4310920">*</span><span class="ident" id="4310921">big</span><span class="op" id="4310924">.</span><span class="ident" id="4310925">Int</span>&nbsp;<span class="string" id="4310929">`asn1:&#34;optional&#34;`</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310948">Qinv</span>&nbsp;<span class="op" id="4310953">*</span><span class="ident" id="4310954">big</span><span class="op" id="4310957">.</span><span class="ident" id="4310958">Int</span>&nbsp;<span class="string" id="4310962">`asn1:&#34;optional&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310982">AdditionalPrimes</span>&nbsp;<span class="op" id="4310999">[</span><span class="op" id="4311000">]</span><span class="ident" id="4311001">pkcs1AdditionalRSAPrime</span>&nbsp;<span class="string" id="4311025">`asn1:&#34;optional,omitempty&#34;`</span><br>
<span class="lineno"></span><span class="op" id="4311053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="4311056">type</span>&nbsp;<span class="ident" id="4311061">pkcs1AdditionalRSAPrime</span>&nbsp;<span class="keyword" id="4311085">struct</span>&nbsp;<span class="op" id="4311092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4311095">Prime</span>&nbsp;<span class="op" id="4311101">*</span><span class="ident" id="4311102">big</span><span class="op" id="4311105">.</span><span class="ident" id="4311106">Int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4311112">//&nbsp;We&nbsp;ignore&nbsp;these&nbsp;values&nbsp;because&nbsp;rsa&nbsp;will&nbsp;calculate&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4311172">Exp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4311178">*</span><span class="ident" id="4311179">big</span><span class="op" id="4311182">.</span><span class="ident" id="4311183">Int</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4311188">Coeff</span>&nbsp;<span class="op" id="4311194">*</span><span class="ident" id="4311195">big</span><span class="op" id="4311198">.</span><span class="ident" id="4311199">Int</span><br>
<span class="lineno"></span><span class="op" id="4311203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4311206">//&nbsp;ParsePKCS1PrivateKey&nbsp;returns&nbsp;an&nbsp;RSA&nbsp;private&nbsp;key&nbsp;from&nbsp;its&nbsp;ASN.1&nbsp;PKCS#1&nbsp;DER&nbsp;encoded&nbsp;form.</span><br>
<span class="lineno"></span><span class="keyword" id="4311297">func</span>&nbsp;<span class="ident" id="4311302">ParsePKCS1PrivateKey</span><span class="op" id="4311322">(</span><span class="ident" id="4311323">der</span>&nbsp;<span class="op" id="4311327">[</span><span class="op" id="4311328">]</span><span class="builtintype" id="4311329">byte</span><span class="op" id="4311333">)</span>&nbsp;<span class="op" id="4311335">(</span><span class="ident" id="4311336">key</span>&nbsp;<span class="op" id="4311340">*</span><span class="ident" id="4311341">rsa</span><span class="op" id="4311344">.</span><span class="ident" id="4311345">PrivateKey</span><span class="op" id="4311355">,</span>&nbsp;<span class="ident" id="4311357">err</span>&nbsp;<span class="builtintype" id="4311361">error</span><span class="op" id="4311366">)</span>&nbsp;<span class="op" id="4311368">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4311371">var</span>&nbsp;<span class="ident" id="4311375">priv</span>&nbsp;<span class="ident" id="4311380">pkcs1PrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4311397">rest</span><span class="op" id="4311401">,</span>&nbsp;<span class="ident" id="4311403">err</span>&nbsp;<span class="op" id="4311407">:=</span>&nbsp;<span class="ident" id="4311410">asn1</span><span class="op" id="4311414">.</span><span class="ident" id="4311415">Unmarshal</span><span class="op" id="4311424">(</span><span class="ident" id="4311425">der</span><span class="op" id="4311428">,</span>&nbsp;<span class="op" id="4311430">&amp;</span><span class="ident" id="4311431">priv</span><span class="op" id="4311435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4311438">if</span>&nbsp;<span class="builtinfunc" id="4311441">len</span><span class="op" id="4311444">(</span><span class="ident" id="4311445">rest</span><span class="op" id="4311449">)</span>&nbsp;<span class="op" id="4311451">&gt;</span>&nbsp;<span class="num" id="4311453">0</span>&nbsp;<span class="op" id="4311455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4311459">err</span>&nbsp;<span class="op" id="4311463">=</span>&nbsp;<span class="ident" id="4311465">asn1</span><span class="op" id="4311469">.</span><span class="ident" id="4311470">SyntaxError</span><span class="op" id="4311481">{</span><span class="ident" id="4311482">Msg</span><span class="op" id="4311485">:</span>&nbsp;<span class="string" id="4311487">&#34;trailing&nbsp;data&#34;</span><span class="op" id="4311502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4311506">return</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4311514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4311517">if</span>&nbsp;<span class="ident" id="4311520">err</span>&nbsp;<span class="op" id="4311524">!=</span>&nbsp;<span class="ident" id="4311527">nil</span>&nbsp;<span class="op" id="4311531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4311535">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4311543">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4311547">if</span>&nbsp;<span class="ident" id="4311550">priv</span><span class="op" id="4311554">.</span><span class="ident" id="4311555">Version</span>&nbsp;<span class="op" id="4311563">&gt;</span>&nbsp;<span class="num" id="4311565">1</span>&nbsp;<span class="op" id="4311567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4311571">return</span>&nbsp;<span class="ident" id="4311578">nil</span><span class="op" id="4311581">,</span>&nbsp;<span class="ident" id="4311583">errors</span><span class="op" id="4311589">.</span><span class="ident" id="4311590">New</span><span class="op" id="4311593">(</span><span class="string" id="4311594">&#34;x509:&nbsp;unsupported&nbsp;private&nbsp;key&nbsp;version&#34;</span><span class="op" id="4311633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4311636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4311640">if</span>&nbsp;<span class="ident" id="4311643">priv</span><span class="op" id="4311647">.</span><span class="ident" id="4311648">N</span><span class="op" id="4311649">.</span><span class="ident" id="4311650">Sign</span><span class="op" id="4311654">(</span><span class="op" id="4311655">)</span>&nbsp;<span class="op" id="4311657">&lt;=</span>&nbsp;<span class="num" id="4311660">0</span>&nbsp;<span class="op" id="4311662">||</span>&nbsp;<span class="ident" id="4311665">priv</span><span class="op" id="4311669">.</span><span class="ident" id="4311670">D</span><span class="op" id="4311671">.</span><span class="ident" id="4311672">Sign</span><span class="op" id="4311676">(</span><span class="op" id="4311677">)</span>&nbsp;<span class="op" id="4311679">&lt;=</span>&nbsp;<span class="num" id="4311682">0</span>&nbsp;<span class="op" id="4311684">||</span>&nbsp;<span class="ident" id="4311687">priv</span><span class="op" id="4311691">.</span><span class="ident" id="4311692">P</span><span class="op" id="4311693">.</span><span class="ident" id="4311694">Sign</span><span class="op" id="4311698">(</span><span class="op" id="4311699">)</span>&nbsp;<span class="op" id="4311701">&lt;=</span>&nbsp;<span class="num" id="4311704">0</span>&nbsp;<span class="op" id="4311706">||</span>&nbsp;<span class="ident" id="4311709">priv</span><span class="op" id="4311713">.</span><span class="ident" id="4311714">Q</span><span class="op" id="4311715">.</span><span class="ident" id="4311716">Sign</span><span class="op" id="4311720">(</span><span class="op" id="4311721">)</span>&nbsp;<span class="op" id="4311723">&lt;=</span>&nbsp;<span class="num" id="4311726">0</span>&nbsp;<span class="op" id="4311728">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4311732">return</span>&nbsp;<span class="ident" id="4311739">nil</span><span class="op" id="4311742">,</span>&nbsp;<span class="ident" id="4311744">errors</span><span class="op" id="4311750">.</span><span class="ident" id="4311751">New</span><span class="op" id="4311754">(</span><span class="string" id="4311755">&#34;x509:&nbsp;private&nbsp;key&nbsp;contains&nbsp;zero&nbsp;or&nbsp;negative&nbsp;value&#34;</span><span class="op" id="4311806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4311809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4311813">key</span>&nbsp;<span class="op" id="4311817">=</span>&nbsp;<span class="builtinfunc" id="4311819">new</span><span class="op" id="4311822">(</span><span class="ident" id="4311823">rsa</span><span class="op" id="4311826">.</span><span class="ident" id="4311827">PrivateKey</span><span class="op" id="4311837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4311840">key</span><span class="op" id="4311843">.</span><span class="ident" id="4311844">PublicKey</span>&nbsp;<span class="op" id="4311854">=</span>&nbsp;<span class="ident" id="4311856">rsa</span><span class="op" id="4311859">.</span><span class="ident" id="4311860">PublicKey</span><span class="op" id="4311869">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4311873">E</span><span class="op" id="4311874">:</span>&nbsp;<span class="ident" id="4311876">priv</span><span class="op" id="4311880">.</span><span class="ident" id="4311881">E</span><span class="op" id="4311882">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4311886">N</span><span class="op" id="4311887">:</span>&nbsp;<span class="ident" id="4311889">priv</span><span class="op" id="4311893">.</span><span class="ident" id="4311894">N</span><span class="op" id="4311895">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4311898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4311902">key</span><span class="op" id="4311905">.</span><span class="ident" id="4311906">D</span>&nbsp;<span class="op" id="4311908">=</span>&nbsp;<span class="ident" id="4311910">priv</span><span class="op" id="4311914">.</span><span class="ident" id="4311915">D</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4311918">key</span><span class="op" id="4311921">.</span><span class="ident" id="4311922">Primes</span>&nbsp;<span class="op" id="4311929">=</span>&nbsp;<span class="builtinfunc" id="4311931">make</span><span class="op" id="4311935">(</span><span class="op" id="4311936">[</span><span class="op" id="4311937">]</span><span class="op" id="4311938">*</span><span class="ident" id="4311939">big</span><span class="op" id="4311942">.</span><span class="ident" id="4311943">Int</span><span class="op" id="4311946">,</span>&nbsp;<span class="num" id="4311948">2</span><span class="op" id="4311949">+</span><span class="builtinfunc" id="4311950">len</span><span class="op" id="4311953">(</span><span class="ident" id="4311954">priv</span><span class="op" id="4311958">.</span><span class="ident" id="4311959">AdditionalPrimes</span><span class="op" id="4311975">)</span><span class="op" id="4311976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4311979">key</span><span class="op" id="4311982">.</span><span class="ident" id="4311983">Primes</span><span class="op" id="4311989">[</span><span class="num" id="4311990">0</span><span class="op" id="4311991">]</span>&nbsp;<span class="op" id="4311993">=</span>&nbsp;<span class="ident" id="4311995">priv</span><span class="op" id="4311999">.</span><span class="ident" id="4312000">P</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312003">key</span><span class="op" id="4312006">.</span><span class="ident" id="4312007">Primes</span><span class="op" id="4312013">[</span><span class="num" id="4312014">1</span><span class="op" id="4312015">]</span>&nbsp;<span class="op" id="4312017">=</span>&nbsp;<span class="ident" id="4312019">priv</span><span class="op" id="4312023">.</span><span class="ident" id="4312024">Q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4312027">for</span>&nbsp;<span class="ident" id="4312031">i</span><span class="op" id="4312032">,</span>&nbsp;<span class="ident" id="4312034">a</span>&nbsp;<span class="op" id="4312036">:=</span>&nbsp;<span class="keyword" id="4312039">range</span>&nbsp;<span class="ident" id="4312045">priv</span><span class="op" id="4312049">.</span><span class="ident" id="4312050">AdditionalPrimes</span>&nbsp;<span class="op" id="4312067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4312071">if</span>&nbsp;<span class="ident" id="4312074">a</span><span class="op" id="4312075">.</span><span class="ident" id="4312076">Prime</span><span class="op" id="4312081">.</span><span class="ident" id="4312082">Sign</span><span class="op" id="4312086">(</span><span class="op" id="4312087">)</span>&nbsp;<span class="op" id="4312089">&lt;=</span>&nbsp;<span class="num" id="4312092">0</span>&nbsp;<span class="op" id="4312094">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4312099">return</span>&nbsp;<span class="ident" id="4312106">nil</span><span class="op" id="4312109">,</span>&nbsp;<span class="ident" id="4312111">errors</span><span class="op" id="4312117">.</span><span class="ident" id="4312118">New</span><span class="op" id="4312121">(</span><span class="string" id="4312122">&#34;x509:&nbsp;private&nbsp;key&nbsp;contains&nbsp;zero&nbsp;or&nbsp;negative&nbsp;prime&#34;</span><span class="op" id="4312173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4312177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312181">key</span><span class="op" id="4312184">.</span><span class="ident" id="4312185">Primes</span><span class="op" id="4312191">[</span><span class="ident" id="4312192">i</span><span class="op" id="4312193">+</span><span class="num" id="4312194">2</span><span class="op" id="4312195">]</span>&nbsp;<span class="op" id="4312197">=</span>&nbsp;<span class="ident" id="4312199">a</span><span class="op" id="4312200">.</span><span class="ident" id="4312201">Prime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4312209">//&nbsp;We&nbsp;ignore&nbsp;the&nbsp;other&nbsp;two&nbsp;values&nbsp;because&nbsp;rsa&nbsp;will&nbsp;calculate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4312272">//&nbsp;them&nbsp;as&nbsp;needed.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4312292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312296">err</span>&nbsp;<span class="op" id="4312300">=</span>&nbsp;<span class="ident" id="4312302">key</span><span class="op" id="4312305">.</span><span class="ident" id="4312306">Validate</span><span class="op" id="4312314">(</span><span class="op" id="4312315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4312318">if</span>&nbsp;<span class="ident" id="4312321">err</span>&nbsp;<span class="op" id="4312325">!=</span>&nbsp;<span class="ident" id="4312328">nil</span>&nbsp;<span class="op" id="4312332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4312336">return</span>&nbsp;<span class="ident" id="4312343">nil</span><span class="op" id="4312346">,</span>&nbsp;<span class="ident" id="4312348">err</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4312353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312356">key</span><span class="op" id="4312359">.</span><span class="ident" id="4312360">Precompute</span><span class="op" id="4312370">(</span><span class="op" id="4312371">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4312375">return</span><br>
<span class="lineno"></span><span class="op" id="4312382">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="4312385">//&nbsp;MarshalPKCS1PrivateKey&nbsp;converts&nbsp;a&nbsp;private&nbsp;key&nbsp;to&nbsp;ASN.1&nbsp;DER&nbsp;encoded&nbsp;form.</span><br>
<span class="lineno"></span><span class="keyword" id="4312461">func</span>&nbsp;<span class="ident" id="4312466">MarshalPKCS1PrivateKey</span><span class="op" id="4312488">(</span><span class="ident" id="4312489">key</span>&nbsp;<span class="op" id="4312493">*</span><span class="ident" id="4312494">rsa</span><span class="op" id="4312497">.</span><span class="ident" id="4312498">PrivateKey</span><span class="op" id="4312508">)</span>&nbsp;<span class="op" id="4312510">[</span><span class="op" id="4312511">]</span><span class="builtintype" id="4312512">byte</span>&nbsp;<span class="op" id="4312517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312520">key</span><span class="op" id="4312523">.</span><span class="ident" id="4312524">Precompute</span><span class="op" id="4312534">(</span><span class="op" id="4312535">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312539">version</span>&nbsp;<span class="op" id="4312547">:=</span>&nbsp;<span class="num" id="4312550">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4312553">if</span>&nbsp;<span class="builtinfunc" id="4312556">len</span><span class="op" id="4312559">(</span><span class="ident" id="4312560">key</span><span class="op" id="4312563">.</span><span class="ident" id="4312564">Primes</span><span class="op" id="4312570">)</span>&nbsp;<span class="op" id="4312572">&gt;</span>&nbsp;<span class="num" id="4312574">2</span>&nbsp;<span class="op" id="4312576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312580">version</span>&nbsp;<span class="op" id="4312588">=</span>&nbsp;<span class="num" id="4312590">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4312593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312597">priv</span>&nbsp;<span class="op" id="4312602">:=</span>&nbsp;<span class="ident" id="4312605">pkcs1PrivateKey</span><span class="op" id="4312620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312624">Version</span><span class="op" id="4312631">:</span>&nbsp;<span class="ident" id="4312633">version</span><span class="op" id="4312640">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312644">N</span><span class="op" id="4312645">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4312653">key</span><span class="op" id="4312656">.</span><span class="ident" id="4312657">N</span><span class="op" id="4312658">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312662">E</span><span class="op" id="4312663">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4312671">key</span><span class="op" id="4312674">.</span><span class="ident" id="4312675">PublicKey</span><span class="op" id="4312684">.</span><span class="ident" id="4312685">E</span><span class="op" id="4312686">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312690">D</span><span class="op" id="4312691">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4312699">key</span><span class="op" id="4312702">.</span><span class="ident" id="4312703">D</span><span class="op" id="4312704">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312708">P</span><span class="op" id="4312709">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4312717">key</span><span class="op" id="4312720">.</span><span class="ident" id="4312721">Primes</span><span class="op" id="4312727">[</span><span class="num" id="4312728">0</span><span class="op" id="4312729">]</span><span class="op" id="4312730">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312734">Q</span><span class="op" id="4312735">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4312743">key</span><span class="op" id="4312746">.</span><span class="ident" id="4312747">Primes</span><span class="op" id="4312753">[</span><span class="num" id="4312754">1</span><span class="op" id="4312755">]</span><span class="op" id="4312756">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312760">Dp</span><span class="op" id="4312762">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4312769">key</span><span class="op" id="4312772">.</span><span class="ident" id="4312773">Precomputed</span><span class="op" id="4312784">.</span><span class="ident" id="4312785">Dp</span><span class="op" id="4312787">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312791">Dq</span><span class="op" id="4312793">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4312800">key</span><span class="op" id="4312803">.</span><span class="ident" id="4312804">Precomputed</span><span class="op" id="4312815">.</span><span class="ident" id="4312816">Dq</span><span class="op" id="4312818">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312822">Qinv</span><span class="op" id="4312826">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4312831">key</span><span class="op" id="4312834">.</span><span class="ident" id="4312835">Precomputed</span><span class="op" id="4312846">.</span><span class="ident" id="4312847">Qinv</span><span class="op" id="4312851">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4312854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312858">priv</span><span class="op" id="4312862">.</span><span class="ident" id="4312863">AdditionalPrimes</span>&nbsp;<span class="op" id="4312880">=</span>&nbsp;<span class="builtinfunc" id="4312882">make</span><span class="op" id="4312886">(</span><span class="op" id="4312887">[</span><span class="op" id="4312888">]</span><span class="ident" id="4312889">pkcs1AdditionalRSAPrime</span><span class="op" id="4312912">,</span>&nbsp;<span class="builtinfunc" id="4312914">len</span><span class="op" id="4312917">(</span><span class="ident" id="4312918">key</span><span class="op" id="4312921">.</span><span class="ident" id="4312922">Precomputed</span><span class="op" id="4312933">.</span><span class="ident" id="4312934">CRTValues</span><span class="op" id="4312943">)</span><span class="op" id="4312944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4312947">for</span>&nbsp;<span class="ident" id="4312951">i</span><span class="op" id="4312952">,</span>&nbsp;<span class="ident" id="4312954">values</span>&nbsp;<span class="op" id="4312961">:=</span>&nbsp;<span class="keyword" id="4312964">range</span>&nbsp;<span class="ident" id="4312970">key</span><span class="op" id="4312973">.</span><span class="ident" id="4312974">Precomputed</span><span class="op" id="4312985">.</span><span class="ident" id="4312986">CRTValues</span>&nbsp;<span class="op" id="4312996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4313000">priv</span><span class="op" id="4313004">.</span><span class="ident" id="4313005">AdditionalPrimes</span><span class="op" id="4313021">[</span><span class="ident" id="4313022">i</span><span class="op" id="4313023">]</span><span class="op" id="4313024">.</span><span class="ident" id="4313025">Prime</span>&nbsp;<span class="op" id="4313031">=</span>&nbsp;<span class="ident" id="4313033">key</span><span class="op" id="4313036">.</span><span class="ident" id="4313037">Primes</span><span class="op" id="4313043">[</span><span class="num" id="4313044">2</span><span class="op" id="4313045">+</span><span class="ident" id="4313046">i</span><span class="op" id="4313047">]</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4313051">priv</span><span class="op" id="4313055">.</span><span class="ident" id="4313056">AdditionalPrimes</span><span class="op" id="4313072">[</span><span class="ident" id="4313073">i</span><span class="op" id="4313074">]</span><span class="op" id="4313075">.</span><span class="ident" id="4313076">Exp</span>&nbsp;<span class="op" id="4313080">=</span>&nbsp;<span class="ident" id="4313082">values</span><span class="op" id="4313088">.</span><span class="ident" id="4313089">Exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4313095">priv</span><span class="op" id="4313099">.</span><span class="ident" id="4313100">AdditionalPrimes</span><span class="op" id="4313116">[</span><span class="ident" id="4313117">i</span><span class="op" id="4313118">]</span><span class="op" id="4313119">.</span><span class="ident" id="4313120">Coeff</span>&nbsp;<span class="op" id="4313126">=</span>&nbsp;<span class="ident" id="4313128">values</span><span class="op" id="4313134">.</span><span class="ident" id="4313135">Coeff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4313142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4313146">b</span><span class="op" id="4313147">,</span>&nbsp;<span class="ident" id="4313149">_</span>&nbsp;<span class="op" id="4313151">:=</span>&nbsp;<span class="ident" id="4313154">asn1</span><span class="op" id="4313158">.</span><span class="ident" id="4313159">Marshal</span><span class="op" id="4313166">(</span><span class="ident" id="4313167">priv</span><span class="op" id="4313171">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4313174">return</span>&nbsp;<span class="ident" id="4313181">b</span><br>
<span class="lineno"></span><span class="op" id="4313183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4313186">//&nbsp;rsaPublicKey&nbsp;reflects&nbsp;the&nbsp;ASN.1&nbsp;structure&nbsp;of&nbsp;a&nbsp;PKCS#1&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4313255">type</span>&nbsp;<span class="ident" id="4313260">rsaPublicKey</span>&nbsp;<span class="keyword" id="4313273">struct</span>&nbsp;<span class="op" id="4313280">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4313283">N</span>&nbsp;<span class="op" id="4313285">*</span><span class="ident" id="4313286">big</span><span class="op" id="4313289">.</span><span class="ident" id="4313290">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4313295">E</span>&nbsp;<span class="builtintype" id="4313297">int</span><br>
<span class="lineno"></span><span class="op" id="4313301">}</span>
</div>
</body>
</html>
