<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html" class="current">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5088731">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5088786">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5088840">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5088891">package</span>&nbsp;<span class="ident" id="5088899">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5088905">import</span>&nbsp;<span class="op" id="5088912">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5088915">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5088920">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="5088923">//&nbsp;maxCodeLength&nbsp;is&nbsp;the&nbsp;maximum&nbsp;(inclusive)&nbsp;number&nbsp;of&nbsp;bits&nbsp;in&nbsp;a&nbsp;Huffman&nbsp;code.</span><br>
<span class="lineno"></span><span class="keyword" id="5089001">const</span>&nbsp;<span class="ident" id="5089007">maxCodeLength</span>&nbsp;<span class="op" id="5089021">=</span>&nbsp;<span class="num" id="5089023">16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5089027">//&nbsp;maxNCodes&nbsp;is&nbsp;the&nbsp;maximum&nbsp;(inclusive)&nbsp;number&nbsp;of&nbsp;codes&nbsp;in&nbsp;a&nbsp;Huffman&nbsp;tree.</span><br>
<span class="lineno">15</span><span class="keyword" id="5089102">const</span>&nbsp;<span class="ident" id="5089108">maxNCodes</span>&nbsp;<span class="op" id="5089118">=</span>&nbsp;<span class="num" id="5089120">256</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5089125">//&nbsp;lutSize&nbsp;is&nbsp;the&nbsp;log-2&nbsp;size&nbsp;of&nbsp;the&nbsp;Huffman&nbsp;decoder&#39;s&nbsp;look-up&nbsp;table.</span><br>
<span class="lineno"></span><span class="keyword" id="5089194">const</span>&nbsp;<span class="ident" id="5089200">lutSize</span>&nbsp;<span class="op" id="5089208">=</span>&nbsp;<span class="num" id="5089210">8</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="5089213">//&nbsp;huffman&nbsp;is&nbsp;a&nbsp;Huffman&nbsp;decoder,&nbsp;specified&nbsp;in&nbsp;section&nbsp;C.</span><br>
<span class="lineno"></span><span class="keyword" id="5089270">type</span>&nbsp;<span class="ident" id="5089275">huffman</span>&nbsp;<span class="keyword" id="5089283">struct</span>&nbsp;<span class="op" id="5089290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5089293">//&nbsp;length&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;codes&nbsp;in&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5089340">nCodes</span>&nbsp;<span class="builtintype" id="5089347">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5089354">//&nbsp;lut&nbsp;is&nbsp;the&nbsp;look-up&nbsp;table&nbsp;for&nbsp;the&nbsp;next&nbsp;lutSize&nbsp;bits&nbsp;in&nbsp;the&nbsp;bit-stream.</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5089428">//&nbsp;The&nbsp;high&nbsp;8&nbsp;bits&nbsp;of&nbsp;the&nbsp;uint16&nbsp;are&nbsp;the&nbsp;encoded&nbsp;value.&nbsp;The&nbsp;low&nbsp;8&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5089500">//&nbsp;are&nbsp;1&nbsp;plus&nbsp;the&nbsp;code&nbsp;length,&nbsp;or&nbsp;0&nbsp;if&nbsp;the&nbsp;value&nbsp;is&nbsp;too&nbsp;large&nbsp;to&nbsp;fit&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5089573">//&nbsp;lutSize&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5089591">lut</span>&nbsp;<span class="op" id="5089595">[</span><span class="num" id="5089596">1</span>&nbsp;<span class="op" id="5089598">&lt;&lt;</span>&nbsp;<span class="ident" id="5089601"><a href="/gostd/image/jpeg/huffman.go.html#5089200">lutSize</a></span><span class="op" id="5089608">]</span><span class="builtintype" id="5089609">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5089617">//&nbsp;vals&nbsp;are&nbsp;the&nbsp;decoded&nbsp;values,&nbsp;sorted&nbsp;by&nbsp;their&nbsp;encoding.</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5089676">vals</span>&nbsp;<span class="op" id="5089681">[</span><span class="ident" id="5089682"><a href="/gostd/image/jpeg/huffman.go.html#5089108">maxNCodes</a></span><span class="op" id="5089691">]</span><span class="builtintype" id="5089692">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5089699">//&nbsp;minCodes[i]&nbsp;is&nbsp;the&nbsp;minimum&nbsp;code&nbsp;of&nbsp;length&nbsp;i,&nbsp;or&nbsp;-1&nbsp;if&nbsp;there&nbsp;are&nbsp;no</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5089770">//&nbsp;codes&nbsp;of&nbsp;that&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5089796">minCodes</span>&nbsp;<span class="op" id="5089805">[</span><span class="ident" id="5089806"><a href="/gostd/image/jpeg/huffman.go.html#5089007">maxCodeLength</a></span><span class="op" id="5089819">]</span><span class="builtintype" id="5089820">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5089827">//&nbsp;maxCodes[i]&nbsp;is&nbsp;the&nbsp;maximum&nbsp;code&nbsp;of&nbsp;length&nbsp;i,&nbsp;or&nbsp;-1&nbsp;if&nbsp;there&nbsp;are&nbsp;no</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5089898">//&nbsp;codes&nbsp;of&nbsp;that&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5089924">maxCodes</span>&nbsp;<span class="op" id="5089933">[</span><span class="ident" id="5089934"><a href="/gostd/image/jpeg/huffman.go.html#5089007">maxCodeLength</a></span><span class="op" id="5089947">]</span><span class="builtintype" id="5089948">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5089955">//&nbsp;valsIndices[i]&nbsp;is&nbsp;the&nbsp;index&nbsp;into&nbsp;vals&nbsp;of&nbsp;minCodes[i].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5090013">valsIndices</span>&nbsp;<span class="op" id="5090025">[</span><span class="ident" id="5090026"><a href="/gostd/image/jpeg/huffman.go.html#5089007">maxCodeLength</a></span><span class="op" id="5090039">]</span><span class="builtintype" id="5090040">int32</span><br>
<span class="lineno"></span><span class="op" id="5090046">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="5090049">//&nbsp;errShortHuffmanData&nbsp;means&nbsp;that&nbsp;an&nbsp;unexpected&nbsp;EOF&nbsp;occurred&nbsp;while&nbsp;decoding</span><br>
<span class="lineno"></span><span class="comment" id="5090125">//&nbsp;Huffman&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5090142">var</span>&nbsp;<span class="ident" id="5090146">errShortHuffmanData</span>&nbsp;<span class="op" id="5090166">=</span>&nbsp;<span class="ident" id="5090168"><a href="/gostd/image/jpeg/reader.go.html#5100751">FormatError</a></span><span class="op" id="5090179">(</span><span class="string" id="5090180">&#34;short&nbsp;Huffman&nbsp;data&#34;</span><span class="op" id="5090200">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="5090203">//&nbsp;ensureNBits&nbsp;reads&nbsp;bytes&nbsp;from&nbsp;the&nbsp;byte&nbsp;buffer&nbsp;to&nbsp;ensure&nbsp;that&nbsp;d.bits.n&nbsp;is&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="5090281">//&nbsp;least&nbsp;n.&nbsp;For&nbsp;best&nbsp;performance&nbsp;(avoiding&nbsp;function&nbsp;calls&nbsp;inside&nbsp;hot&nbsp;loops),</span><br>
<span class="lineno"></span><span class="comment" id="5090358">//&nbsp;the&nbsp;caller&nbsp;is&nbsp;the&nbsp;one&nbsp;responsible&nbsp;for&nbsp;first&nbsp;checking&nbsp;that&nbsp;d.bits.n&nbsp;&lt;&nbsp;n.</span><br>
<span class="lineno"></span><span class="keyword" id="5090433">func</span>&nbsp;<span class="op" id="5090438">(</span><span class="ident" id="5090439">d</span>&nbsp;<span class="op" id="5090441">*</span><span class="ident" id="5090442"><a href="/gostd/image/jpeg/reader.go.html#5103264">decoder</a></span><span class="op" id="5090449">)</span>&nbsp;<span class="ident" id="5090451">ensureNBits</span><span class="op" id="5090462">(</span><span class="ident" id="5090463">n</span>&nbsp;<span class="builtintype" id="5090465">int32</span><span class="op" id="5090470">)</span>&nbsp;<span class="builtintype" id="5090472">error</span>&nbsp;<span class="op" id="5090478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5090481">for</span>&nbsp;<span class="op" id="5090485">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5090489">c</span><span class="op" id="5090490">,</span>&nbsp;<span class="ident" id="5090492">err</span>&nbsp;<span class="op" id="5090496">:=</span>&nbsp;<span class="ident" id="5090499"><a href="/gostd/image/jpeg/huffman.go.html#5090439">d</a></span><span class="op" id="5090500">.</span><span class="ident" id="5090501"><a href="/gostd/image/jpeg/reader.go.html#5106235">readByteStuffedByte</a></span><span class="op" id="5090520">(</span><span class="op" id="5090521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5090525">if</span>&nbsp;<span class="ident" id="5090528"><a href="/gostd/image/jpeg/huffman.go.html#5090492">err</a></span>&nbsp;<span class="op" id="5090532">!=</span>&nbsp;<span class="builtintype" id="5090535">nil</span>&nbsp;<span class="op" id="5090539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5090544">if</span>&nbsp;<span class="ident" id="5090547"><a href="/gostd/image/jpeg/huffman.go.html#5090492">err</a></span>&nbsp;<span class="op" id="5090551">==</span>&nbsp;<span class="ident" id="5090554"><a href="/gostd/image/jpeg/huffman.go.html#5088915">io</a></span><span class="op" id="5090556">.</span><span class="ident" id="5090557"><a href="/gostd/io/io.go.html#1419950">EOF</a></span>&nbsp;<span class="op" id="5090561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5090567">return</span>&nbsp;<span class="ident" id="5090574"><a href="/gostd/image/jpeg/huffman.go.html#5090146">errShortHuffmanData</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5090597">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5090602">return</span>&nbsp;<span class="ident" id="5090609"><a href="/gostd/image/jpeg/huffman.go.html#5090492">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5090615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5090619"><a href="/gostd/image/jpeg/huffman.go.html#5090439">d</a></span><span class="op" id="5090620">.</span><span class="ident" id="5090621"><a href="/gostd/image/jpeg/reader.go.html#5103298">bits</a></span><span class="op" id="5090625">.</span><span class="ident" id="5090626"><a href="/gostd/image/jpeg/reader.go.html#5103124">a</a></span>&nbsp;<span class="op" id="5090628">=</span>&nbsp;<span class="ident" id="5090630"><a href="/gostd/image/jpeg/huffman.go.html#5090439">d</a></span><span class="op" id="5090631">.</span><span class="ident" id="5090632"><a href="/gostd/image/jpeg/reader.go.html#5103298">bits</a></span><span class="op" id="5090636">.</span><span class="ident" id="5090637"><a href="/gostd/image/jpeg/reader.go.html#5103124">a</a></span><span class="op" id="5090638">&lt;&lt;</span><span class="num" id="5090640">8</span>&nbsp;<span class="op" id="5090642">|</span>&nbsp;<span class="builtintype" id="5090644">uint32</span><span class="op" id="5090650">(</span><span class="ident" id="5090651"><a href="/gostd/image/jpeg/huffman.go.html#5090489">c</a></span><span class="op" id="5090652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5090656"><a href="/gostd/image/jpeg/huffman.go.html#5090439">d</a></span><span class="op" id="5090657">.</span><span class="ident" id="5090658"><a href="/gostd/image/jpeg/reader.go.html#5103298">bits</a></span><span class="op" id="5090662">.</span><span class="ident" id="5090663"><a href="/gostd/image/jpeg/reader.go.html#5103212">n</a></span>&nbsp;<span class="op" id="5090665">+=</span>&nbsp;<span class="num" id="5090668">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5090672">if</span>&nbsp;<span class="ident" id="5090675"><a href="/gostd/image/jpeg/huffman.go.html#5090439">d</a></span><span class="op" id="5090676">.</span><span class="ident" id="5090677"><a href="/gostd/image/jpeg/reader.go.html#5103298">bits</a></span><span class="op" id="5090681">.</span><span class="ident" id="5090682"><a href="/gostd/image/jpeg/reader.go.html#5103150">m</a></span>&nbsp;<span class="op" id="5090684">==</span>&nbsp;<span class="num" id="5090687">0</span>&nbsp;<span class="op" id="5090689">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5090694"><a href="/gostd/image/jpeg/huffman.go.html#5090439">d</a></span><span class="op" id="5090695">.</span><span class="ident" id="5090696"><a href="/gostd/image/jpeg/reader.go.html#5103298">bits</a></span><span class="op" id="5090700">.</span><span class="ident" id="5090701"><a href="/gostd/image/jpeg/reader.go.html#5103150">m</a></span>&nbsp;<span class="op" id="5090703">=</span>&nbsp;<span class="num" id="5090705">1</span>&nbsp;<span class="op" id="5090707">&lt;&lt;</span>&nbsp;<span class="num" id="5090710">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5090714">}</span>&nbsp;<span class="keyword" id="5090716">else</span>&nbsp;<span class="op" id="5090721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5090726"><a href="/gostd/image/jpeg/huffman.go.html#5090439">d</a></span><span class="op" id="5090727">.</span><span class="ident" id="5090728"><a href="/gostd/image/jpeg/reader.go.html#5103298">bits</a></span><span class="op" id="5090732">.</span><span class="ident" id="5090733"><a href="/gostd/image/jpeg/reader.go.html#5103150">m</a></span>&nbsp;<span class="op" id="5090735">&lt;&lt;=</span>&nbsp;<span class="num" id="5090739">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5090743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5090747">if</span>&nbsp;<span class="ident" id="5090750"><a href="/gostd/image/jpeg/huffman.go.html#5090439">d</a></span><span class="op" id="5090751">.</span><span class="ident" id="5090752"><a href="/gostd/image/jpeg/reader.go.html#5103298">bits</a></span><span class="op" id="5090756">.</span><span class="ident" id="5090757"><a href="/gostd/image/jpeg/reader.go.html#5103212">n</a></span>&nbsp;<span class="op" id="5090759">&gt;=</span>&nbsp;<span class="ident" id="5090762"><a href="/gostd/image/jpeg/huffman.go.html#5090463">n</a></span>&nbsp;<span class="op" id="5090764">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5090769">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5090777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5090780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5090783">return</span>&nbsp;<span class="builtintype" id="5090790">nil</span><br>
<span class="lineno"></span><span class="op" id="5090794">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="5090797">//&nbsp;receiveExtend&nbsp;is&nbsp;the&nbsp;composition&nbsp;of&nbsp;RECEIVE&nbsp;and&nbsp;EXTEND,&nbsp;specified&nbsp;in&nbsp;section</span><br>
<span class="lineno"></span><span class="comment" id="5090877">//&nbsp;F.2.2.1.</span><br>
<span class="lineno"></span><span class="keyword" id="5090889">func</span>&nbsp;<span class="op" id="5090894">(</span><span class="ident" id="5090895">d</span>&nbsp;<span class="op" id="5090897">*</span><span class="ident" id="5090898"><a href="/gostd/image/jpeg/reader.go.html#5103264">decoder</a></span><span class="op" id="5090905">)</span>&nbsp;<span class="ident" id="5090907">receiveExtend</span><span class="op" id="5090920">(</span><span class="ident" id="5090921">t</span>&nbsp;<span class="builtintype" id="5090923">uint8</span><span class="op" id="5090928">)</span>&nbsp;<span class="op" id="5090930">(</span><span class="builtintype" id="5090931">int32</span><span class="op" id="5090936">,</span>&nbsp;<span class="builtintype" id="5090938">error</span><span class="op" id="5090943">)</span>&nbsp;<span class="op" id="5090945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5090948">if</span>&nbsp;<span class="ident" id="5090951"><a href="/gostd/image/jpeg/huffman.go.html#5090895">d</a></span><span class="op" id="5090952">.</span><span class="ident" id="5090953"><a href="/gostd/image/jpeg/reader.go.html#5103298">bits</a></span><span class="op" id="5090957">.</span><span class="ident" id="5090958"><a href="/gostd/image/jpeg/reader.go.html#5103212">n</a></span>&nbsp;<span class="op" id="5090960">&lt;</span>&nbsp;<span class="builtintype" id="5090962">int32</span><span class="op" id="5090967">(</span><span class="ident" id="5090968"><a href="/gostd/image/jpeg/huffman.go.html#5090921">t</a></span><span class="op" id="5090969">)</span>&nbsp;<span class="op" id="5090971">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5090975">if</span>&nbsp;<span class="ident" id="5090978">err</span>&nbsp;<span class="op" id="5090982">:=</span>&nbsp;<span class="ident" id="5090985"><a href="/gostd/image/jpeg/huffman.go.html#5090895">d</a></span><span class="op" id="5090986">.</span><span class="ident" id="5090987"><a href="/gostd/image/jpeg/huffman.go.html#5090451">ensureNBits</a></span><span class="op" id="5090998">(</span><span class="builtintype" id="5090999">int32</span><span class="op" id="5091004">(</span><span class="ident" id="5091005"><a href="/gostd/image/jpeg/huffman.go.html#5090921">t</a></span><span class="op" id="5091006">)</span><span class="op" id="5091007">)</span><span class="op" id="5091008">;</span>&nbsp;<span class="ident" id="5091010"><a href="/gostd/image/jpeg/huffman.go.html#5090978">err</a></span>&nbsp;<span class="op" id="5091014">!=</span>&nbsp;<span class="builtintype" id="5091017">nil</span>&nbsp;<span class="op" id="5091021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091026">return</span>&nbsp;<span class="num" id="5091033">0</span><span class="op" id="5091034">,</span>&nbsp;<span class="ident" id="5091036"><a href="/gostd/image/jpeg/huffman.go.html#5090978">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5091042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5091045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091048"><a href="/gostd/image/jpeg/huffman.go.html#5090895">d</a></span><span class="op" id="5091049">.</span><span class="ident" id="5091050"><a href="/gostd/image/jpeg/reader.go.html#5103298">bits</a></span><span class="op" id="5091054">.</span><span class="ident" id="5091055"><a href="/gostd/image/jpeg/reader.go.html#5103212">n</a></span>&nbsp;<span class="op" id="5091057">-=</span>&nbsp;<span class="builtintype" id="5091060">int32</span><span class="op" id="5091065">(</span><span class="ident" id="5091066"><a href="/gostd/image/jpeg/huffman.go.html#5090921">t</a></span><span class="op" id="5091067">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091070"><a href="/gostd/image/jpeg/huffman.go.html#5090895">d</a></span><span class="op" id="5091071">.</span><span class="ident" id="5091072"><a href="/gostd/image/jpeg/reader.go.html#5103298">bits</a></span><span class="op" id="5091076">.</span><span class="ident" id="5091077"><a href="/gostd/image/jpeg/reader.go.html#5103150">m</a></span>&nbsp;<span class="op" id="5091079">&gt;&gt;=</span>&nbsp;<span class="ident" id="5091083"><a href="/gostd/image/jpeg/huffman.go.html#5090921">t</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091086">s</span>&nbsp;<span class="op" id="5091088">:=</span>&nbsp;<span class="builtintype" id="5091091">int32</span><span class="op" id="5091096">(</span><span class="num" id="5091097">1</span><span class="op" id="5091098">)</span>&nbsp;<span class="op" id="5091100">&lt;&lt;</span>&nbsp;<span class="ident" id="5091103"><a href="/gostd/image/jpeg/huffman.go.html#5090921">t</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091106">x</span>&nbsp;<span class="op" id="5091108">:=</span>&nbsp;<span class="builtintype" id="5091111">int32</span><span class="op" id="5091116">(</span><span class="ident" id="5091117"><a href="/gostd/image/jpeg/huffman.go.html#5090895">d</a></span><span class="op" id="5091118">.</span><span class="ident" id="5091119"><a href="/gostd/image/jpeg/reader.go.html#5103298">bits</a></span><span class="op" id="5091123">.</span><span class="ident" id="5091124"><a href="/gostd/image/jpeg/reader.go.html#5103124">a</a></span><span class="op" id="5091125">&gt;&gt;</span><span class="builtintype" id="5091127">uint8</span><span class="op" id="5091132">(</span><span class="ident" id="5091133"><a href="/gostd/image/jpeg/huffman.go.html#5090895">d</a></span><span class="op" id="5091134">.</span><span class="ident" id="5091135"><a href="/gostd/image/jpeg/reader.go.html#5103298">bits</a></span><span class="op" id="5091139">.</span><span class="ident" id="5091140"><a href="/gostd/image/jpeg/reader.go.html#5103212">n</a></span><span class="op" id="5091141">)</span><span class="op" id="5091142">)</span>&nbsp;<span class="op" id="5091144">&amp;</span>&nbsp;<span class="op" id="5091146">(</span><span class="ident" id="5091147"><a href="/gostd/image/jpeg/huffman.go.html#5091086">s</a></span>&nbsp;<span class="op" id="5091149">-</span>&nbsp;<span class="num" id="5091151">1</span><span class="op" id="5091152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091155">if</span>&nbsp;<span class="ident" id="5091158"><a href="/gostd/image/jpeg/huffman.go.html#5091106">x</a></span>&nbsp;<span class="op" id="5091160">&lt;</span>&nbsp;<span class="ident" id="5091162"><a href="/gostd/image/jpeg/huffman.go.html#5091086">s</a></span><span class="op" id="5091163">&gt;&gt;</span><span class="num" id="5091165">1</span>&nbsp;<span class="op" id="5091167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091171"><a href="/gostd/image/jpeg/huffman.go.html#5091106">x</a></span>&nbsp;<span class="op" id="5091173">+=</span>&nbsp;<span class="op" id="5091176">(</span><span class="op" id="5091177">(</span><span class="op" id="5091178">-</span><span class="num" id="5091179">1</span><span class="op" id="5091180">)</span>&nbsp;<span class="op" id="5091182">&lt;&lt;</span>&nbsp;<span class="ident" id="5091185"><a href="/gostd/image/jpeg/huffman.go.html#5090921">t</a></span><span class="op" id="5091186">)</span>&nbsp;<span class="op" id="5091188">+</span>&nbsp;<span class="num" id="5091190">1</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5091193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091196">return</span>&nbsp;<span class="ident" id="5091203"><a href="/gostd/image/jpeg/huffman.go.html#5091106">x</a></span><span class="op" id="5091204">,</span>&nbsp;<span class="builtintype" id="5091206">nil</span><br>
<span class="lineno"></span><span class="op" id="5091210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5091213">//&nbsp;processDHT&nbsp;processes&nbsp;a&nbsp;Define&nbsp;Huffman&nbsp;Table&nbsp;marker,&nbsp;and&nbsp;initializes&nbsp;a&nbsp;huffman</span><br>
<span class="lineno">90</span><span class="comment" id="5091294">//&nbsp;struct&nbsp;from&nbsp;its&nbsp;contents.&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.4.2.</span><br>
<span class="lineno"></span><span class="keyword" id="5091353">func</span>&nbsp;<span class="op" id="5091358">(</span><span class="ident" id="5091359">d</span>&nbsp;<span class="op" id="5091361">*</span><span class="ident" id="5091362"><a href="/gostd/image/jpeg/reader.go.html#5103264">decoder</a></span><span class="op" id="5091369">)</span>&nbsp;<span class="ident" id="5091371">processDHT</span><span class="op" id="5091381">(</span><span class="ident" id="5091382">n</span>&nbsp;<span class="builtintype" id="5091384">int</span><span class="op" id="5091387">)</span>&nbsp;<span class="builtintype" id="5091389">error</span>&nbsp;<span class="op" id="5091395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091398">for</span>&nbsp;<span class="ident" id="5091402"><a href="/gostd/image/jpeg/huffman.go.html#5091382">n</a></span>&nbsp;<span class="op" id="5091404">&gt;</span>&nbsp;<span class="num" id="5091406">0</span>&nbsp;<span class="op" id="5091408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091412">if</span>&nbsp;<span class="ident" id="5091415"><a href="/gostd/image/jpeg/huffman.go.html#5091382">n</a></span>&nbsp;<span class="op" id="5091417">&lt;</span>&nbsp;<span class="num" id="5091419">17</span>&nbsp;<span class="op" id="5091422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091427">return</span>&nbsp;<span class="ident" id="5091434"><a href="/gostd/image/jpeg/reader.go.html#5100751">FormatError</a></span><span class="op" id="5091445">(</span><span class="string" id="5091446">&#34;DHT&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="5091468">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5091472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091476">if</span>&nbsp;<span class="ident" id="5091479">err</span>&nbsp;<span class="op" id="5091483">:=</span>&nbsp;<span class="ident" id="5091486"><a href="/gostd/image/jpeg/huffman.go.html#5091359">d</a></span><span class="op" id="5091487">.</span><span class="ident" id="5091488"><a href="/gostd/image/jpeg/reader.go.html#5107021">readFull</a></span><span class="op" id="5091496">(</span><span class="ident" id="5091497"><a href="/gostd/image/jpeg/huffman.go.html#5091359">d</a></span><span class="op" id="5091498">.</span><span class="ident" id="5091499"><a href="/gostd/image/jpeg/reader.go.html#5104255">tmp</a></span><span class="op" id="5091502">[</span><span class="op" id="5091503">:</span><span class="num" id="5091504">17</span><span class="op" id="5091506">]</span><span class="op" id="5091507">)</span><span class="op" id="5091508">;</span>&nbsp;<span class="ident" id="5091510"><a href="/gostd/image/jpeg/huffman.go.html#5091479">err</a></span>&nbsp;<span class="op" id="5091514">!=</span>&nbsp;<span class="builtintype" id="5091517">nil</span>&nbsp;<span class="op" id="5091521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091526">return</span>&nbsp;<span class="ident" id="5091533"><a href="/gostd/image/jpeg/huffman.go.html#5091479">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5091539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091543">tc</span>&nbsp;<span class="op" id="5091546">:=</span>&nbsp;<span class="ident" id="5091549"><a href="/gostd/image/jpeg/huffman.go.html#5091359">d</a></span><span class="op" id="5091550">.</span><span class="ident" id="5091551"><a href="/gostd/image/jpeg/reader.go.html#5104255">tmp</a></span><span class="op" id="5091554">[</span><span class="num" id="5091555">0</span><span class="op" id="5091556">]</span>&nbsp;<span class="op" id="5091558">&gt;&gt;</span>&nbsp;<span class="num" id="5091561">4</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091565">if</span>&nbsp;<span class="ident" id="5091568"><a href="/gostd/image/jpeg/huffman.go.html#5091543">tc</a></span>&nbsp;<span class="op" id="5091571">&gt;</span>&nbsp;<span class="ident" id="5091573"><a href="/gostd/image/jpeg/reader.go.html#5101357">maxTc</a></span>&nbsp;<span class="op" id="5091579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091584">return</span>&nbsp;<span class="ident" id="5091591"><a href="/gostd/image/jpeg/reader.go.html#5100751">FormatError</a></span><span class="op" id="5091602">(</span><span class="string" id="5091603">&#34;bad&nbsp;Tc&nbsp;value&#34;</span><span class="op" id="5091617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5091621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091625">th</span>&nbsp;<span class="op" id="5091628">:=</span>&nbsp;<span class="ident" id="5091631"><a href="/gostd/image/jpeg/huffman.go.html#5091359">d</a></span><span class="op" id="5091632">.</span><span class="ident" id="5091633"><a href="/gostd/image/jpeg/reader.go.html#5104255">tmp</a></span><span class="op" id="5091636">[</span><span class="num" id="5091637">0</span><span class="op" id="5091638">]</span>&nbsp;<span class="op" id="5091640">&amp;</span>&nbsp;<span class="num" id="5091642">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091649">if</span>&nbsp;<span class="ident" id="5091652"><a href="/gostd/image/jpeg/huffman.go.html#5091625">th</a></span>&nbsp;<span class="op" id="5091655">&gt;</span>&nbsp;<span class="ident" id="5091657"><a href="/gostd/image/jpeg/reader.go.html#5101370">maxTh</a></span>&nbsp;<span class="op" id="5091663">||</span>&nbsp;<span class="op" id="5091666">!</span><span class="ident" id="5091667"><a href="/gostd/image/jpeg/huffman.go.html#5091359">d</a></span><span class="op" id="5091668">.</span><span class="ident" id="5091669"><a href="/gostd/image/jpeg/reader.go.html#5103915">progressive</a></span>&nbsp;<span class="op" id="5091681">&amp;&amp;</span>&nbsp;<span class="ident" id="5091684"><a href="/gostd/image/jpeg/huffman.go.html#5091625">th</a></span>&nbsp;<span class="op" id="5091687">&gt;</span>&nbsp;<span class="num" id="5091689">1</span>&nbsp;<span class="op" id="5091691">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091696">return</span>&nbsp;<span class="ident" id="5091703"><a href="/gostd/image/jpeg/reader.go.html#5100751">FormatError</a></span><span class="op" id="5091714">(</span><span class="string" id="5091715">&#34;bad&nbsp;Th&nbsp;value&#34;</span><span class="op" id="5091729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5091733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091737">h</span>&nbsp;<span class="op" id="5091739">:=</span>&nbsp;<span class="op" id="5091742">&amp;</span><span class="ident" id="5091743"><a href="/gostd/image/jpeg/huffman.go.html#5091359">d</a></span><span class="op" id="5091744">.</span><span class="ident" id="5091745"><a href="/gostd/image/jpeg/reader.go.html#5104136">huff</a></span><span class="op" id="5091749">[</span><span class="ident" id="5091750"><a href="/gostd/image/jpeg/huffman.go.html#5091543">tc</a></span><span class="op" id="5091752">]</span><span class="op" id="5091753">[</span><span class="ident" id="5091754"><a href="/gostd/image/jpeg/huffman.go.html#5091625">th</a></span><span class="op" id="5091756">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5091761">//&nbsp;Read&nbsp;nCodes&nbsp;and&nbsp;h.vals&nbsp;(and&nbsp;derive&nbsp;h.nCodes).</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5091812">//&nbsp;nCodes[i]&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;codes&nbsp;with&nbsp;code&nbsp;length&nbsp;i.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5091870">//&nbsp;h.nCodes&nbsp;is&nbsp;the&nbsp;total&nbsp;number&nbsp;of&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091914"><a href="/gostd/image/jpeg/huffman.go.html#5091737">h</a></span><span class="op" id="5091915">.</span><span class="ident" id="5091916"><a href="/gostd/image/jpeg/huffman.go.html#5089340">nCodes</a></span>&nbsp;<span class="op" id="5091923">=</span>&nbsp;<span class="num" id="5091925">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091929">var</span>&nbsp;<span class="ident" id="5091933">nCodes</span>&nbsp;<span class="op" id="5091940">[</span><span class="ident" id="5091941"><a href="/gostd/image/jpeg/huffman.go.html#5089007">maxCodeLength</a></span><span class="op" id="5091954">]</span><span class="builtintype" id="5091955">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091963">for</span>&nbsp;<span class="ident" id="5091967">i</span>&nbsp;<span class="op" id="5091969">:=</span>&nbsp;<span class="keyword" id="5091972">range</span>&nbsp;<span class="ident" id="5091978"><a href="/gostd/image/jpeg/huffman.go.html#5091933">nCodes</a></span>&nbsp;<span class="op" id="5091985">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091990"><a href="/gostd/image/jpeg/huffman.go.html#5091933">nCodes</a></span><span class="op" id="5091996">[</span><span class="ident" id="5091997"><a href="/gostd/image/jpeg/huffman.go.html#5091967">i</a></span><span class="op" id="5091998">]</span>&nbsp;<span class="op" id="5092000">=</span>&nbsp;<span class="builtintype" id="5092002">int32</span><span class="op" id="5092007">(</span><span class="ident" id="5092008"><a href="/gostd/image/jpeg/huffman.go.html#5091359">d</a></span><span class="op" id="5092009">.</span><span class="ident" id="5092010"><a href="/gostd/image/jpeg/reader.go.html#5104255">tmp</a></span><span class="op" id="5092013">[</span><span class="ident" id="5092014"><a href="/gostd/image/jpeg/huffman.go.html#5091967">i</a></span><span class="op" id="5092015">+</span><span class="num" id="5092016">1</span><span class="op" id="5092017">]</span><span class="op" id="5092018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5092023"><a href="/gostd/image/jpeg/huffman.go.html#5091737">h</a></span><span class="op" id="5092024">.</span><span class="ident" id="5092025"><a href="/gostd/image/jpeg/huffman.go.html#5089340">nCodes</a></span>&nbsp;<span class="op" id="5092032">+=</span>&nbsp;<span class="ident" id="5092035"><a href="/gostd/image/jpeg/huffman.go.html#5091933">nCodes</a></span><span class="op" id="5092041">[</span><span class="ident" id="5092042"><a href="/gostd/image/jpeg/huffman.go.html#5091967">i</a></span><span class="op" id="5092043">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5092047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5092051">if</span>&nbsp;<span class="ident" id="5092054"><a href="/gostd/image/jpeg/huffman.go.html#5091737">h</a></span><span class="op" id="5092055">.</span><span class="ident" id="5092056"><a href="/gostd/image/jpeg/huffman.go.html#5089340">nCodes</a></span>&nbsp;<span class="op" id="5092063">==</span>&nbsp;<span class="num" id="5092066">0</span>&nbsp;<span class="op" id="5092068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5092073">return</span>&nbsp;<span class="ident" id="5092080"><a href="/gostd/image/jpeg/reader.go.html#5100751">FormatError</a></span><span class="op" id="5092091">(</span><span class="string" id="5092092">&#34;Huffman&nbsp;table&nbsp;has&nbsp;zero&nbsp;length&#34;</span><span class="op" id="5092123">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5092127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5092131">if</span>&nbsp;<span class="ident" id="5092134"><a href="/gostd/image/jpeg/huffman.go.html#5091737">h</a></span><span class="op" id="5092135">.</span><span class="ident" id="5092136"><a href="/gostd/image/jpeg/huffman.go.html#5089340">nCodes</a></span>&nbsp;<span class="op" id="5092143">&gt;</span>&nbsp;<span class="ident" id="5092145"><a href="/gostd/image/jpeg/huffman.go.html#5089108">maxNCodes</a></span>&nbsp;<span class="op" id="5092155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5092160">return</span>&nbsp;<span class="ident" id="5092167"><a href="/gostd/image/jpeg/reader.go.html#5100751">FormatError</a></span><span class="op" id="5092178">(</span><span class="string" id="5092179">&#34;Huffman&nbsp;table&nbsp;has&nbsp;excessive&nbsp;length&#34;</span><span class="op" id="5092215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5092219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5092223"><a href="/gostd/image/jpeg/huffman.go.html#5091382">n</a></span>&nbsp;<span class="op" id="5092225">-=</span>&nbsp;<span class="builtintype" id="5092228">int</span><span class="op" id="5092231">(</span><span class="ident" id="5092232"><a href="/gostd/image/jpeg/huffman.go.html#5091737">h</a></span><span class="op" id="5092233">.</span><span class="ident" id="5092234"><a href="/gostd/image/jpeg/huffman.go.html#5089340">nCodes</a></span><span class="op" id="5092240">)</span>&nbsp;<span class="op" id="5092242">+</span>&nbsp;<span class="num" id="5092244">17</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5092249">if</span>&nbsp;<span class="ident" id="5092252"><a href="/gostd/image/jpeg/huffman.go.html#5091382">n</a></span>&nbsp;<span class="op" id="5092254">&lt;</span>&nbsp;<span class="num" id="5092256">0</span>&nbsp;<span class="op" id="5092258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5092263">return</span>&nbsp;<span class="ident" id="5092270"><a href="/gostd/image/jpeg/reader.go.html#5100751">FormatError</a></span><span class="op" id="5092281">(</span><span class="string" id="5092282">&#34;DHT&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="5092304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5092308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5092312">if</span>&nbsp;<span class="ident" id="5092315">err</span>&nbsp;<span class="op" id="5092319">:=</span>&nbsp;<span class="ident" id="5092322"><a href="/gostd/image/jpeg/huffman.go.html#5091359">d</a></span><span class="op" id="5092323">.</span><span class="ident" id="5092324"><a href="/gostd/image/jpeg/reader.go.html#5107021">readFull</a></span><span class="op" id="5092332">(</span><span class="ident" id="5092333"><a href="/gostd/image/jpeg/huffman.go.html#5091737">h</a></span><span class="op" id="5092334">.</span><span class="ident" id="5092335"><a href="/gostd/image/jpeg/huffman.go.html#5089676">vals</a></span><span class="op" id="5092339">[</span><span class="op" id="5092340">:</span><span class="ident" id="5092341"><a href="/gostd/image/jpeg/huffman.go.html#5091737">h</a></span><span class="op" id="5092342">.</span><span class="ident" id="5092343"><a href="/gostd/image/jpeg/huffman.go.html#5089340">nCodes</a></span><span class="op" id="5092349">]</span><span class="op" id="5092350">)</span><span class="op" id="5092351">;</span>&nbsp;<span class="ident" id="5092353"><a href="/gostd/image/jpeg/huffman.go.html#5092315">err</a></span>&nbsp;<span class="op" id="5092357">!=</span>&nbsp;<span class="builtintype" id="5092360">nil</span>&nbsp;<span class="op" id="5092364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5092369">return</span>&nbsp;<span class="ident" id="5092376"><a href="/gostd/image/jpeg/huffman.go.html#5092315">err</a></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5092382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5092387">//&nbsp;Derive&nbsp;the&nbsp;look-up&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5092418">for</span>&nbsp;<span class="ident" id="5092422">i</span>&nbsp;<span class="op" id="5092424">:=</span>&nbsp;<span class="keyword" id="5092427">range</span>&nbsp;<span class="ident" id="5092433"><a href="/gostd/image/jpeg/huffman.go.html#5091737">h</a></span><span class="op" id="5092434">.</span><span class="ident" id="5092435"><a href="/gostd/image/jpeg/huffman.go.html#5089591">lut</a></span>&nbsp;<span class="op" id="5092439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5092444"><a href="/gostd/image/jpeg/huffman.go.html#5091737">h</a></span><span class="op" id="5092445">.</span><span class="ident" id="5092446"><a href="/gostd/image/jpeg/huffman.go.html#5089591">lut</a></span><span class="op" id="5092449">[</span><span class="ident" id="5092450"><a href="/gostd/image/jpeg/huffman.go.html#5092422">i</a></span><span class="op" id="5092451">]</span>&nbsp;<span class="op" id="5092453">=</span>&nbsp;<span class="num" id="5092455">0</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5092459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5092463">var</span>&nbsp;<span class="ident" id="5092467">x</span><span class="op" id="5092468">,</span>&nbsp;<span class="ident" id="5092470">code</span>&nbsp;<span class="builtintype" id="5092475">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5092484">for</span>&nbsp;<span class="ident" id="5092488">i</span>&nbsp;<span class="op" id="5092490">:=</span>&nbsp;<span class="builtintype" id="5092493">uint32</span><span class="op" id="5092499">(</span><span class="num" id="5092500">0</span><span class="op" id="5092501">)</span><span class="op" id="5092502">;</span>&nbsp;<span class="ident" id="5092504"><a href="/gostd/image/jpeg/huffman.go.html#5092488">i</a></span>&nbsp;<span class="op" id="5092506">&lt;</span>&nbsp;<span class="ident" id="5092508"><a href="/gostd/image/jpeg/huffman.go.html#5089200">lutSize</a></span><span class="op" id="5092515">;</span>&nbsp;<span class="ident" id="5092517"><a href="/gostd/image/jpeg/huffman.go.html#5092488">i</a></span><span class="op" id="5092518">++</span>&nbsp;<span class="op" id="5092521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5092526"><a href="/gostd/image/jpeg/huffman.go.html#5092470">code</a></span>&nbsp;<span class="op" id="5092531">&lt;&lt;=</span>&nbsp;<span class="num" id="5092535">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5092540">for</span>&nbsp;<span class="ident" id="5092544">j</span>&nbsp;<span class="op" id="5092546">:=</span>&nbsp;<span class="builtintype" id="5092549">int32</span><span class="op" id="5092554">(</span><span class="num" id="5092555">0</span><span class="op" id="5092556">)</span><span class="op" id="5092557">;</span>&nbsp;<span class="ident" id="5092559"><a href="/gostd/image/jpeg/huffman.go.html#5092544">j</a></span>&nbsp;<span class="op" id="5092561">&lt;</span>&nbsp;<span class="ident" id="5092563"><a href="/gostd/image/jpeg/huffman.go.html#5091933">nCodes</a></span><span class="op" id="5092569">[</span><span class="ident" id="5092570"><a href="/gostd/image/jpeg/huffman.go.html#5092488">i</a></span><span class="op" id="5092571">]</span><span class="op" id="5092572">;</span>&nbsp;<span class="ident" id="5092574"><a href="/gostd/image/jpeg/huffman.go.html#5092544">j</a></span><span class="op" id="5092575">++</span>&nbsp;<span class="op" id="5092578">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5092584">//&nbsp;The&nbsp;codeLength&nbsp;is&nbsp;1+i,&nbsp;so&nbsp;shift&nbsp;code&nbsp;by&nbsp;8-(1+i)&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5092642">//&nbsp;calculate&nbsp;the&nbsp;high&nbsp;bits&nbsp;for&nbsp;every&nbsp;8-bit&nbsp;sequence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5092698">//&nbsp;whose&nbsp;codeLength&#39;s&nbsp;high&nbsp;bits&nbsp;matches&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5092748">//&nbsp;The&nbsp;high&nbsp;8&nbsp;bits&nbsp;of&nbsp;lutValue&nbsp;are&nbsp;the&nbsp;encoded&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5092806">//&nbsp;The&nbsp;low&nbsp;8&nbsp;bits&nbsp;are&nbsp;1&nbsp;plus&nbsp;the&nbsp;codeLength.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5092855">base</span>&nbsp;<span class="op" id="5092860">:=</span>&nbsp;<span class="builtintype" id="5092863">uint8</span><span class="op" id="5092868">(</span><span class="ident" id="5092869"><a href="/gostd/image/jpeg/huffman.go.html#5092470">code</a></span>&nbsp;<span class="op" id="5092874">&lt;&lt;</span>&nbsp;<span class="op" id="5092877">(</span><span class="num" id="5092878">7</span>&nbsp;<span class="op" id="5092880">-</span>&nbsp;<span class="ident" id="5092882"><a href="/gostd/image/jpeg/huffman.go.html#5092488">i</a></span><span class="op" id="5092883">)</span><span class="op" id="5092884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5092890">lutValue</span>&nbsp;<span class="op" id="5092899">:=</span>&nbsp;<span class="builtintype" id="5092902">uint16</span><span class="op" id="5092908">(</span><span class="ident" id="5092909"><a href="/gostd/image/jpeg/huffman.go.html#5091737">h</a></span><span class="op" id="5092910">.</span><span class="ident" id="5092911"><a href="/gostd/image/jpeg/huffman.go.html#5089676">vals</a></span><span class="op" id="5092915">[</span><span class="ident" id="5092916"><a href="/gostd/image/jpeg/huffman.go.html#5092467">x</a></span><span class="op" id="5092917">]</span><span class="op" id="5092918">)</span><span class="op" id="5092919">&lt;&lt;</span><span class="num" id="5092921">8</span>&nbsp;<span class="op" id="5092923">|</span>&nbsp;<span class="builtintype" id="5092925">uint16</span><span class="op" id="5092931">(</span><span class="num" id="5092932">2</span><span class="op" id="5092933">+</span><span class="ident" id="5092934"><a href="/gostd/image/jpeg/huffman.go.html#5092488">i</a></span><span class="op" id="5092935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5092941">for</span>&nbsp;<span class="ident" id="5092945">k</span>&nbsp;<span class="op" id="5092947">:=</span>&nbsp;<span class="builtintype" id="5092950">uint8</span><span class="op" id="5092955">(</span><span class="num" id="5092956">0</span><span class="op" id="5092957">)</span><span class="op" id="5092958">;</span>&nbsp;<span class="ident" id="5092960"><a href="/gostd/image/jpeg/huffman.go.html#5092945">k</a></span>&nbsp;<span class="op" id="5092962">&lt;</span>&nbsp;<span class="num" id="5092964">1</span><span class="op" id="5092965">&lt;&lt;</span><span class="op" id="5092967">(</span><span class="num" id="5092968">7</span><span class="op" id="5092969">-</span><span class="ident" id="5092970"><a href="/gostd/image/jpeg/huffman.go.html#5092488">i</a></span><span class="op" id="5092971">)</span><span class="op" id="5092972">;</span>&nbsp;<span class="ident" id="5092974"><a href="/gostd/image/jpeg/huffman.go.html#5092945">k</a></span><span class="op" id="5092975">++</span>&nbsp;<span class="op" id="5092978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5092985"><a href="/gostd/image/jpeg/huffman.go.html#5091737">h</a></span><span class="op" id="5092986">.</span><span class="ident" id="5092987"><a href="/gostd/image/jpeg/huffman.go.html#5089591">lut</a></span><span class="op" id="5092990">[</span><span class="ident" id="5092991"><a href="/gostd/image/jpeg/huffman.go.html#5092855">base</a></span><span class="op" id="5092995">|</span><span class="ident" id="5092996"><a href="/gostd/image/jpeg/huffman.go.html#5092945">k</a></span><span class="op" id="5092997">]</span>&nbsp;<span class="op" id="5092999">=</span>&nbsp;<span class="ident" id="5093001"><a href="/gostd/image/jpeg/huffman.go.html#5092890">lutValue</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5093014">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093020"><a href="/gostd/image/jpeg/huffman.go.html#5092470">code</a></span><span class="op" id="5093024">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093031"><a href="/gostd/image/jpeg/huffman.go.html#5092467">x</a></span><span class="op" id="5093032">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5093038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5093042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5093047">//&nbsp;Derive&nbsp;minCodes,&nbsp;maxCodes,&nbsp;and&nbsp;valsIndices.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5093096">var</span>&nbsp;<span class="ident" id="5093100">c</span><span class="op" id="5093101">,</span>&nbsp;<span class="ident" id="5093103">index</span>&nbsp;<span class="builtintype" id="5093109">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5093117">for</span>&nbsp;<span class="ident" id="5093121">i</span><span class="op" id="5093122">,</span>&nbsp;<span class="ident" id="5093124">n</span>&nbsp;<span class="op" id="5093126">:=</span>&nbsp;<span class="keyword" id="5093129">range</span>&nbsp;<span class="ident" id="5093135"><a href="/gostd/image/jpeg/huffman.go.html#5091933">nCodes</a></span>&nbsp;<span class="op" id="5093142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5093147">if</span>&nbsp;<span class="ident" id="5093150"><a href="/gostd/image/jpeg/huffman.go.html#5093124">n</a></span>&nbsp;<span class="op" id="5093152">==</span>&nbsp;<span class="num" id="5093155">0</span>&nbsp;<span class="op" id="5093157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093163"><a href="/gostd/image/jpeg/huffman.go.html#5091737">h</a></span><span class="op" id="5093164">.</span><span class="ident" id="5093165"><a href="/gostd/image/jpeg/huffman.go.html#5089796">minCodes</a></span><span class="op" id="5093173">[</span><span class="ident" id="5093174"><a href="/gostd/image/jpeg/huffman.go.html#5093121">i</a></span><span class="op" id="5093175">]</span>&nbsp;<span class="op" id="5093177">=</span>&nbsp;<span class="op" id="5093179">-</span><span class="num" id="5093180">1</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093186"><a href="/gostd/image/jpeg/huffman.go.html#5091737">h</a></span><span class="op" id="5093187">.</span><span class="ident" id="5093188"><a href="/gostd/image/jpeg/huffman.go.html#5089924">maxCodes</a></span><span class="op" id="5093196">[</span><span class="ident" id="5093197"><a href="/gostd/image/jpeg/huffman.go.html#5093121">i</a></span><span class="op" id="5093198">]</span>&nbsp;<span class="op" id="5093200">=</span>&nbsp;<span class="op" id="5093202">-</span><span class="num" id="5093203">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093209"><a href="/gostd/image/jpeg/huffman.go.html#5091737">h</a></span><span class="op" id="5093210">.</span><span class="ident" id="5093211"><a href="/gostd/image/jpeg/huffman.go.html#5090013">valsIndices</a></span><span class="op" id="5093222">[</span><span class="ident" id="5093223"><a href="/gostd/image/jpeg/huffman.go.html#5093121">i</a></span><span class="op" id="5093224">]</span>&nbsp;<span class="op" id="5093226">=</span>&nbsp;<span class="op" id="5093228">-</span><span class="num" id="5093229">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5093234">}</span>&nbsp;<span class="keyword" id="5093236">else</span>&nbsp;<span class="op" id="5093241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093247"><a href="/gostd/image/jpeg/huffman.go.html#5091737">h</a></span><span class="op" id="5093248">.</span><span class="ident" id="5093249"><a href="/gostd/image/jpeg/huffman.go.html#5089796">minCodes</a></span><span class="op" id="5093257">[</span><span class="ident" id="5093258"><a href="/gostd/image/jpeg/huffman.go.html#5093121">i</a></span><span class="op" id="5093259">]</span>&nbsp;<span class="op" id="5093261">=</span>&nbsp;<span class="ident" id="5093263"><a href="/gostd/image/jpeg/huffman.go.html#5093100">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093269"><a href="/gostd/image/jpeg/huffman.go.html#5091737">h</a></span><span class="op" id="5093270">.</span><span class="ident" id="5093271"><a href="/gostd/image/jpeg/huffman.go.html#5089924">maxCodes</a></span><span class="op" id="5093279">[</span><span class="ident" id="5093280"><a href="/gostd/image/jpeg/huffman.go.html#5093121">i</a></span><span class="op" id="5093281">]</span>&nbsp;<span class="op" id="5093283">=</span>&nbsp;<span class="ident" id="5093285"><a href="/gostd/image/jpeg/huffman.go.html#5093100">c</a></span>&nbsp;<span class="op" id="5093287">+</span>&nbsp;<span class="ident" id="5093289"><a href="/gostd/image/jpeg/huffman.go.html#5093124">n</a></span>&nbsp;<span class="op" id="5093291">-</span>&nbsp;<span class="num" id="5093293">1</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093299"><a href="/gostd/image/jpeg/huffman.go.html#5091737">h</a></span><span class="op" id="5093300">.</span><span class="ident" id="5093301"><a href="/gostd/image/jpeg/huffman.go.html#5090013">valsIndices</a></span><span class="op" id="5093312">[</span><span class="ident" id="5093313"><a href="/gostd/image/jpeg/huffman.go.html#5093121">i</a></span><span class="op" id="5093314">]</span>&nbsp;<span class="op" id="5093316">=</span>&nbsp;<span class="ident" id="5093318"><a href="/gostd/image/jpeg/huffman.go.html#5093103">index</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093328"><a href="/gostd/image/jpeg/huffman.go.html#5093100">c</a></span>&nbsp;<span class="op" id="5093330">+=</span>&nbsp;<span class="ident" id="5093333"><a href="/gostd/image/jpeg/huffman.go.html#5093124">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093339"><a href="/gostd/image/jpeg/huffman.go.html#5093103">index</a></span>&nbsp;<span class="op" id="5093345">+=</span>&nbsp;<span class="ident" id="5093348"><a href="/gostd/image/jpeg/huffman.go.html#5093124">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5093353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093358"><a href="/gostd/image/jpeg/huffman.go.html#5093100">c</a></span>&nbsp;<span class="op" id="5093360">&lt;&lt;=</span>&nbsp;<span class="num" id="5093364">1</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5093368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5093371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5093374">return</span>&nbsp;<span class="builtintype" id="5093381">nil</span><br>
<span class="lineno"></span><span class="op" id="5093385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="5093388">//&nbsp;decodeHuffman&nbsp;returns&nbsp;the&nbsp;next&nbsp;Huffman-coded&nbsp;value&nbsp;from&nbsp;the&nbsp;bit-stream,</span><br>
<span class="lineno"></span><span class="comment" id="5093463">//&nbsp;decoded&nbsp;according&nbsp;to&nbsp;h.</span><br>
<span class="lineno"></span><span class="keyword" id="5093490">func</span>&nbsp;<span class="op" id="5093495">(</span><span class="ident" id="5093496">d</span>&nbsp;<span class="op" id="5093498">*</span><span class="ident" id="5093499"><a href="/gostd/image/jpeg/reader.go.html#5103264">decoder</a></span><span class="op" id="5093506">)</span>&nbsp;<span class="ident" id="5093508">decodeHuffman</span><span class="op" id="5093521">(</span><span class="ident" id="5093522">h</span>&nbsp;<span class="op" id="5093524">*</span><span class="ident" id="5093525"><a href="/gostd/image/jpeg/huffman.go.html#5089275">huffman</a></span><span class="op" id="5093532">)</span>&nbsp;<span class="op" id="5093534">(</span><span class="builtintype" id="5093535">uint8</span><span class="op" id="5093540">,</span>&nbsp;<span class="builtintype" id="5093542">error</span><span class="op" id="5093547">)</span>&nbsp;<span class="op" id="5093549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5093552">if</span>&nbsp;<span class="ident" id="5093555"><a href="/gostd/image/jpeg/huffman.go.html#5093522">h</a></span><span class="op" id="5093556">.</span><span class="ident" id="5093557"><a href="/gostd/image/jpeg/huffman.go.html#5089340">nCodes</a></span>&nbsp;<span class="op" id="5093564">==</span>&nbsp;<span class="num" id="5093567">0</span>&nbsp;<span class="op" id="5093569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5093573">return</span>&nbsp;<span class="num" id="5093580">0</span><span class="op" id="5093581">,</span>&nbsp;<span class="ident" id="5093583"><a href="/gostd/image/jpeg/reader.go.html#5100751">FormatError</a></span><span class="op" id="5093594">(</span><span class="string" id="5093595">&#34;uninitialized&nbsp;Huffman&nbsp;table&#34;</span><span class="op" id="5093624">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5093627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5093631">if</span>&nbsp;<span class="ident" id="5093634"><a href="/gostd/image/jpeg/huffman.go.html#5093496">d</a></span><span class="op" id="5093635">.</span><span class="ident" id="5093636"><a href="/gostd/image/jpeg/reader.go.html#5103298">bits</a></span><span class="op" id="5093640">.</span><span class="ident" id="5093641"><a href="/gostd/image/jpeg/reader.go.html#5103212">n</a></span>&nbsp;<span class="op" id="5093643">&lt;</span>&nbsp;<span class="num" id="5093645">8</span>&nbsp;<span class="op" id="5093647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5093651">if</span>&nbsp;<span class="ident" id="5093654">err</span>&nbsp;<span class="op" id="5093658">:=</span>&nbsp;<span class="ident" id="5093661"><a href="/gostd/image/jpeg/huffman.go.html#5093496">d</a></span><span class="op" id="5093662">.</span><span class="ident" id="5093663"><a href="/gostd/image/jpeg/huffman.go.html#5090451">ensureNBits</a></span><span class="op" id="5093674">(</span><span class="num" id="5093675">8</span><span class="op" id="5093676">)</span><span class="op" id="5093677">;</span>&nbsp;<span class="ident" id="5093679"><a href="/gostd/image/jpeg/huffman.go.html#5093654">err</a></span>&nbsp;<span class="op" id="5093683">!=</span>&nbsp;<span class="builtintype" id="5093686">nil</span>&nbsp;<span class="op" id="5093690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5093695">if</span>&nbsp;<span class="ident" id="5093698"><a href="/gostd/image/jpeg/huffman.go.html#5093654">err</a></span>&nbsp;<span class="op" id="5093702">!=</span>&nbsp;<span class="ident" id="5093705"><a href="/gostd/image/jpeg/reader.go.html#5106082">errMissingFF00</a></span>&nbsp;<span class="op" id="5093720">&amp;&amp;</span>&nbsp;<span class="ident" id="5093723"><a href="/gostd/image/jpeg/huffman.go.html#5093654">err</a></span>&nbsp;<span class="op" id="5093727">!=</span>&nbsp;<span class="ident" id="5093730"><a href="/gostd/image/jpeg/huffman.go.html#5090146">errShortHuffmanData</a></span>&nbsp;<span class="op" id="5093750">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5093756">return</span>&nbsp;<span class="num" id="5093763">0</span><span class="op" id="5093764">,</span>&nbsp;<span class="ident" id="5093766"><a href="/gostd/image/jpeg/huffman.go.html#5093654">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5093773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5093778">//&nbsp;There&nbsp;are&nbsp;no&nbsp;more&nbsp;bytes&nbsp;of&nbsp;data&nbsp;in&nbsp;this&nbsp;segment,&nbsp;but&nbsp;we&nbsp;may&nbsp;still</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5093850">//&nbsp;be&nbsp;able&nbsp;to&nbsp;read&nbsp;the&nbsp;next&nbsp;symbol&nbsp;out&nbsp;of&nbsp;the&nbsp;previously&nbsp;read&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5093921">//&nbsp;First,&nbsp;undo&nbsp;the&nbsp;readByte&nbsp;that&nbsp;the&nbsp;ensureNBits&nbsp;call&nbsp;made.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093984"><a href="/gostd/image/jpeg/huffman.go.html#5093496">d</a></span><span class="op" id="5093985">.</span><span class="ident" id="5093986"><a href="/gostd/image/jpeg/reader.go.html#5105334">unreadByteStuffedByte</a></span><span class="op" id="5094007">(</span><span class="op" id="5094008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5094013">goto</span>&nbsp;<span class="ident" id="5094018"><a href="/gostd/image/jpeg/huffman.go.html#5094196">slowPath</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5094029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5094032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5094035">if</span>&nbsp;<span class="ident" id="5094038">v</span>&nbsp;<span class="op" id="5094040">:=</span>&nbsp;<span class="ident" id="5094043"><a href="/gostd/image/jpeg/huffman.go.html#5093522">h</a></span><span class="op" id="5094044">.</span><span class="ident" id="5094045"><a href="/gostd/image/jpeg/huffman.go.html#5089591">lut</a></span><span class="op" id="5094048">[</span><span class="op" id="5094049">(</span><span class="ident" id="5094050"><a href="/gostd/image/jpeg/huffman.go.html#5093496">d</a></span><span class="op" id="5094051">.</span><span class="ident" id="5094052"><a href="/gostd/image/jpeg/reader.go.html#5103298">bits</a></span><span class="op" id="5094056">.</span><span class="ident" id="5094057"><a href="/gostd/image/jpeg/reader.go.html#5103124">a</a></span><span class="op" id="5094058">&gt;&gt;</span><span class="builtintype" id="5094060">uint32</span><span class="op" id="5094066">(</span><span class="ident" id="5094067"><a href="/gostd/image/jpeg/huffman.go.html#5093496">d</a></span><span class="op" id="5094068">.</span><span class="ident" id="5094069"><a href="/gostd/image/jpeg/reader.go.html#5103298">bits</a></span><span class="op" id="5094073">.</span><span class="ident" id="5094074"><a href="/gostd/image/jpeg/reader.go.html#5103212">n</a></span><span class="op" id="5094075">-</span><span class="ident" id="5094076"><a href="/gostd/image/jpeg/huffman.go.html#5089200">lutSize</a></span><span class="op" id="5094083">)</span><span class="op" id="5094084">)</span><span class="op" id="5094085">&amp;</span><span class="num" id="5094086">0xff</span><span class="op" id="5094090">]</span><span class="op" id="5094091">;</span>&nbsp;<span class="ident" id="5094093"><a href="/gostd/image/jpeg/huffman.go.html#5094038">v</a></span>&nbsp;<span class="op" id="5094095">!=</span>&nbsp;<span class="num" id="5094098">0</span>&nbsp;<span class="op" id="5094100">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094104">n</span>&nbsp;<span class="op" id="5094106">:=</span>&nbsp;<span class="op" id="5094109">(</span><span class="ident" id="5094110"><a href="/gostd/image/jpeg/huffman.go.html#5094038">v</a></span>&nbsp;<span class="op" id="5094112">&amp;</span>&nbsp;<span class="num" id="5094114">0xff</span><span class="op" id="5094118">)</span>&nbsp;<span class="op" id="5094120">-</span>&nbsp;<span class="num" id="5094122">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094126"><a href="/gostd/image/jpeg/huffman.go.html#5093496">d</a></span><span class="op" id="5094127">.</span><span class="ident" id="5094128"><a href="/gostd/image/jpeg/reader.go.html#5103298">bits</a></span><span class="op" id="5094132">.</span><span class="ident" id="5094133"><a href="/gostd/image/jpeg/reader.go.html#5103212">n</a></span>&nbsp;<span class="op" id="5094135">-=</span>&nbsp;<span class="builtintype" id="5094138">int32</span><span class="op" id="5094143">(</span><span class="ident" id="5094144"><a href="/gostd/image/jpeg/huffman.go.html#5094104">n</a></span><span class="op" id="5094145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094149"><a href="/gostd/image/jpeg/huffman.go.html#5093496">d</a></span><span class="op" id="5094150">.</span><span class="ident" id="5094151"><a href="/gostd/image/jpeg/reader.go.html#5103298">bits</a></span><span class="op" id="5094155">.</span><span class="ident" id="5094156"><a href="/gostd/image/jpeg/reader.go.html#5103150">m</a></span>&nbsp;<span class="op" id="5094158">&gt;&gt;=</span>&nbsp;<span class="ident" id="5094162"><a href="/gostd/image/jpeg/huffman.go.html#5094104">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5094166">return</span>&nbsp;<span class="builtintype" id="5094173">uint8</span><span class="op" id="5094178">(</span><span class="ident" id="5094179"><a href="/gostd/image/jpeg/huffman.go.html#5094038">v</a></span>&nbsp;<span class="op" id="5094181">&gt;&gt;</span>&nbsp;<span class="num" id="5094184">8</span><span class="op" id="5094185">)</span><span class="op" id="5094186">,</span>&nbsp;<span class="builtintype" id="5094188">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5094193">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="ident" id="5094196">slowPath</span><span class="op" id="5094204">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5094207">for</span>&nbsp;<span class="ident" id="5094211">i</span><span class="op" id="5094212">,</span>&nbsp;<span class="ident" id="5094214">code</span>&nbsp;<span class="op" id="5094219">:=</span>&nbsp;<span class="num" id="5094222">0</span><span class="op" id="5094223">,</span>&nbsp;<span class="builtintype" id="5094225">int32</span><span class="op" id="5094230">(</span><span class="num" id="5094231">0</span><span class="op" id="5094232">)</span><span class="op" id="5094233">;</span>&nbsp;<span class="ident" id="5094235"><a href="/gostd/image/jpeg/huffman.go.html#5094211">i</a></span>&nbsp;<span class="op" id="5094237">&lt;</span>&nbsp;<span class="ident" id="5094239"><a href="/gostd/image/jpeg/huffman.go.html#5089007">maxCodeLength</a></span><span class="op" id="5094252">;</span>&nbsp;<span class="ident" id="5094254"><a href="/gostd/image/jpeg/huffman.go.html#5094211">i</a></span><span class="op" id="5094255">++</span>&nbsp;<span class="op" id="5094258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5094262">if</span>&nbsp;<span class="ident" id="5094265"><a href="/gostd/image/jpeg/huffman.go.html#5093496">d</a></span><span class="op" id="5094266">.</span><span class="ident" id="5094267"><a href="/gostd/image/jpeg/reader.go.html#5103298">bits</a></span><span class="op" id="5094271">.</span><span class="ident" id="5094272"><a href="/gostd/image/jpeg/reader.go.html#5103212">n</a></span>&nbsp;<span class="op" id="5094274">==</span>&nbsp;<span class="num" id="5094277">0</span>&nbsp;<span class="op" id="5094279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5094284">if</span>&nbsp;<span class="ident" id="5094287">err</span>&nbsp;<span class="op" id="5094291">:=</span>&nbsp;<span class="ident" id="5094294"><a href="/gostd/image/jpeg/huffman.go.html#5093496">d</a></span><span class="op" id="5094295">.</span><span class="ident" id="5094296"><a href="/gostd/image/jpeg/huffman.go.html#5090451">ensureNBits</a></span><span class="op" id="5094307">(</span><span class="num" id="5094308">1</span><span class="op" id="5094309">)</span><span class="op" id="5094310">;</span>&nbsp;<span class="ident" id="5094312"><a href="/gostd/image/jpeg/huffman.go.html#5094287">err</a></span>&nbsp;<span class="op" id="5094316">!=</span>&nbsp;<span class="builtintype" id="5094319">nil</span>&nbsp;<span class="op" id="5094323">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5094329">return</span>&nbsp;<span class="num" id="5094336">0</span><span class="op" id="5094337">,</span>&nbsp;<span class="ident" id="5094339"><a href="/gostd/image/jpeg/huffman.go.html#5094287">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5094346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5094350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5094354">if</span>&nbsp;<span class="ident" id="5094357"><a href="/gostd/image/jpeg/huffman.go.html#5093496">d</a></span><span class="op" id="5094358">.</span><span class="ident" id="5094359"><a href="/gostd/image/jpeg/reader.go.html#5103298">bits</a></span><span class="op" id="5094363">.</span><span class="ident" id="5094364"><a href="/gostd/image/jpeg/reader.go.html#5103124">a</a></span><span class="op" id="5094365">&amp;</span><span class="ident" id="5094366"><a href="/gostd/image/jpeg/huffman.go.html#5093496">d</a></span><span class="op" id="5094367">.</span><span class="ident" id="5094368"><a href="/gostd/image/jpeg/reader.go.html#5103298">bits</a></span><span class="op" id="5094372">.</span><span class="ident" id="5094373"><a href="/gostd/image/jpeg/reader.go.html#5103150">m</a></span>&nbsp;<span class="op" id="5094375">!=</span>&nbsp;<span class="num" id="5094378">0</span>&nbsp;<span class="op" id="5094380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094385"><a href="/gostd/image/jpeg/huffman.go.html#5094214">code</a></span>&nbsp;<span class="op" id="5094390">|=</span>&nbsp;<span class="num" id="5094393">1</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5094397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094401"><a href="/gostd/image/jpeg/huffman.go.html#5093496">d</a></span><span class="op" id="5094402">.</span><span class="ident" id="5094403"><a href="/gostd/image/jpeg/reader.go.html#5103298">bits</a></span><span class="op" id="5094407">.</span><span class="ident" id="5094408"><a href="/gostd/image/jpeg/reader.go.html#5103212">n</a></span><span class="op" id="5094409">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094414"><a href="/gostd/image/jpeg/huffman.go.html#5093496">d</a></span><span class="op" id="5094415">.</span><span class="ident" id="5094416"><a href="/gostd/image/jpeg/reader.go.html#5103298">bits</a></span><span class="op" id="5094420">.</span><span class="ident" id="5094421"><a href="/gostd/image/jpeg/reader.go.html#5103150">m</a></span>&nbsp;<span class="op" id="5094423">&gt;&gt;=</span>&nbsp;<span class="num" id="5094427">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5094431">if</span>&nbsp;<span class="ident" id="5094434"><a href="/gostd/image/jpeg/huffman.go.html#5094214">code</a></span>&nbsp;<span class="op" id="5094439">&lt;=</span>&nbsp;<span class="ident" id="5094442"><a href="/gostd/image/jpeg/huffman.go.html#5093522">h</a></span><span class="op" id="5094443">.</span><span class="ident" id="5094444"><a href="/gostd/image/jpeg/huffman.go.html#5089924">maxCodes</a></span><span class="op" id="5094452">[</span><span class="ident" id="5094453"><a href="/gostd/image/jpeg/huffman.go.html#5094211">i</a></span><span class="op" id="5094454">]</span>&nbsp;<span class="op" id="5094456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5094461">return</span>&nbsp;<span class="ident" id="5094468"><a href="/gostd/image/jpeg/huffman.go.html#5093522">h</a></span><span class="op" id="5094469">.</span><span class="ident" id="5094470"><a href="/gostd/image/jpeg/huffman.go.html#5089676">vals</a></span><span class="op" id="5094474">[</span><span class="ident" id="5094475"><a href="/gostd/image/jpeg/huffman.go.html#5093522">h</a></span><span class="op" id="5094476">.</span><span class="ident" id="5094477"><a href="/gostd/image/jpeg/huffman.go.html#5090013">valsIndices</a></span><span class="op" id="5094488">[</span><span class="ident" id="5094489"><a href="/gostd/image/jpeg/huffman.go.html#5094211">i</a></span><span class="op" id="5094490">]</span><span class="op" id="5094491">+</span><span class="ident" id="5094492"><a href="/gostd/image/jpeg/huffman.go.html#5094214">code</a></span><span class="op" id="5094496">-</span><span class="ident" id="5094497"><a href="/gostd/image/jpeg/huffman.go.html#5093522">h</a></span><span class="op" id="5094498">.</span><span class="ident" id="5094499"><a href="/gostd/image/jpeg/huffman.go.html#5089796">minCodes</a></span><span class="op" id="5094507">[</span><span class="ident" id="5094508"><a href="/gostd/image/jpeg/huffman.go.html#5094211">i</a></span><span class="op" id="5094509">]</span><span class="op" id="5094510">]</span><span class="op" id="5094511">,</span>&nbsp;<span class="builtintype" id="5094513">nil</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5094519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094523"><a href="/gostd/image/jpeg/huffman.go.html#5094214">code</a></span>&nbsp;<span class="op" id="5094528">&lt;&lt;=</span>&nbsp;<span class="num" id="5094532">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5094535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5094538">return</span>&nbsp;<span class="num" id="5094545">0</span><span class="op" id="5094546">,</span>&nbsp;<span class="ident" id="5094548"><a href="/gostd/image/jpeg/reader.go.html#5100751">FormatError</a></span><span class="op" id="5094559">(</span><span class="string" id="5094560">&#34;bad&nbsp;Huffman&nbsp;code&#34;</span><span class="op" id="5094578">)</span><br>
<span class="lineno"></span><span class="op" id="5094580">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="5094583">func</span>&nbsp;<span class="op" id="5094588">(</span><span class="ident" id="5094589">d</span>&nbsp;<span class="op" id="5094591">*</span><span class="ident" id="5094592"><a href="/gostd/image/jpeg/reader.go.html#5103264">decoder</a></span><span class="op" id="5094599">)</span>&nbsp;<span class="ident" id="5094601">decodeBit</span><span class="op" id="5094610">(</span><span class="op" id="5094611">)</span>&nbsp;<span class="op" id="5094613">(</span><span class="builtintype" id="5094614">bool</span><span class="op" id="5094618">,</span>&nbsp;<span class="builtintype" id="5094620">error</span><span class="op" id="5094625">)</span>&nbsp;<span class="op" id="5094627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5094630">if</span>&nbsp;<span class="ident" id="5094633"><a href="/gostd/image/jpeg/huffman.go.html#5094589">d</a></span><span class="op" id="5094634">.</span><span class="ident" id="5094635"><a href="/gostd/image/jpeg/reader.go.html#5103298">bits</a></span><span class="op" id="5094639">.</span><span class="ident" id="5094640"><a href="/gostd/image/jpeg/reader.go.html#5103212">n</a></span>&nbsp;<span class="op" id="5094642">==</span>&nbsp;<span class="num" id="5094645">0</span>&nbsp;<span class="op" id="5094647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5094651">if</span>&nbsp;<span class="ident" id="5094654">err</span>&nbsp;<span class="op" id="5094658">:=</span>&nbsp;<span class="ident" id="5094661"><a href="/gostd/image/jpeg/huffman.go.html#5094589">d</a></span><span class="op" id="5094662">.</span><span class="ident" id="5094663"><a href="/gostd/image/jpeg/huffman.go.html#5090451">ensureNBits</a></span><span class="op" id="5094674">(</span><span class="num" id="5094675">1</span><span class="op" id="5094676">)</span><span class="op" id="5094677">;</span>&nbsp;<span class="ident" id="5094679"><a href="/gostd/image/jpeg/huffman.go.html#5094654">err</a></span>&nbsp;<span class="op" id="5094683">!=</span>&nbsp;<span class="builtintype" id="5094686">nil</span>&nbsp;<span class="op" id="5094690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5094695">return</span>&nbsp;<span class="builtintype" id="5094702">false</span><span class="op" id="5094707">,</span>&nbsp;<span class="ident" id="5094709"><a href="/gostd/image/jpeg/huffman.go.html#5094654">err</a></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5094715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5094718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094721">ret</span>&nbsp;<span class="op" id="5094725">:=</span>&nbsp;<span class="ident" id="5094728"><a href="/gostd/image/jpeg/huffman.go.html#5094589">d</a></span><span class="op" id="5094729">.</span><span class="ident" id="5094730"><a href="/gostd/image/jpeg/reader.go.html#5103298">bits</a></span><span class="op" id="5094734">.</span><span class="ident" id="5094735"><a href="/gostd/image/jpeg/reader.go.html#5103124">a</a></span><span class="op" id="5094736">&amp;</span><span class="ident" id="5094737"><a href="/gostd/image/jpeg/huffman.go.html#5094589">d</a></span><span class="op" id="5094738">.</span><span class="ident" id="5094739"><a href="/gostd/image/jpeg/reader.go.html#5103298">bits</a></span><span class="op" id="5094743">.</span><span class="ident" id="5094744"><a href="/gostd/image/jpeg/reader.go.html#5103150">m</a></span>&nbsp;<span class="op" id="5094746">!=</span>&nbsp;<span class="num" id="5094749">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094752"><a href="/gostd/image/jpeg/huffman.go.html#5094589">d</a></span><span class="op" id="5094753">.</span><span class="ident" id="5094754"><a href="/gostd/image/jpeg/reader.go.html#5103298">bits</a></span><span class="op" id="5094758">.</span><span class="ident" id="5094759"><a href="/gostd/image/jpeg/reader.go.html#5103212">n</a></span><span class="op" id="5094760">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094764"><a href="/gostd/image/jpeg/huffman.go.html#5094589">d</a></span><span class="op" id="5094765">.</span><span class="ident" id="5094766"><a href="/gostd/image/jpeg/reader.go.html#5103298">bits</a></span><span class="op" id="5094770">.</span><span class="ident" id="5094771"><a href="/gostd/image/jpeg/reader.go.html#5103150">m</a></span>&nbsp;<span class="op" id="5094773">&gt;&gt;=</span>&nbsp;<span class="num" id="5094777">1</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5094780">return</span>&nbsp;<span class="ident" id="5094787"><a href="/gostd/image/jpeg/huffman.go.html#5094721">ret</a></span><span class="op" id="5094790">,</span>&nbsp;<span class="builtintype" id="5094792">nil</span><br>
<span class="lineno"></span><span class="op" id="5094796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5094799">func</span>&nbsp;<span class="op" id="5094804">(</span><span class="ident" id="5094805">d</span>&nbsp;<span class="op" id="5094807">*</span><span class="ident" id="5094808"><a href="/gostd/image/jpeg/reader.go.html#5103264">decoder</a></span><span class="op" id="5094815">)</span>&nbsp;<span class="ident" id="5094817">decodeBits</span><span class="op" id="5094827">(</span><span class="ident" id="5094828">n</span>&nbsp;<span class="builtintype" id="5094830">int32</span><span class="op" id="5094835">)</span>&nbsp;<span class="op" id="5094837">(</span><span class="builtintype" id="5094838">uint32</span><span class="op" id="5094844">,</span>&nbsp;<span class="builtintype" id="5094846">error</span><span class="op" id="5094851">)</span>&nbsp;<span class="op" id="5094853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5094856">if</span>&nbsp;<span class="ident" id="5094859"><a href="/gostd/image/jpeg/huffman.go.html#5094805">d</a></span><span class="op" id="5094860">.</span><span class="ident" id="5094861"><a href="/gostd/image/jpeg/reader.go.html#5103298">bits</a></span><span class="op" id="5094865">.</span><span class="ident" id="5094866"><a href="/gostd/image/jpeg/reader.go.html#5103212">n</a></span>&nbsp;<span class="op" id="5094868">&lt;</span>&nbsp;<span class="ident" id="5094870"><a href="/gostd/image/jpeg/huffman.go.html#5094828">n</a></span>&nbsp;<span class="op" id="5094872">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5094876">if</span>&nbsp;<span class="ident" id="5094879">err</span>&nbsp;<span class="op" id="5094883">:=</span>&nbsp;<span class="ident" id="5094886"><a href="/gostd/image/jpeg/huffman.go.html#5094805">d</a></span><span class="op" id="5094887">.</span><span class="ident" id="5094888"><a href="/gostd/image/jpeg/huffman.go.html#5090451">ensureNBits</a></span><span class="op" id="5094899">(</span><span class="ident" id="5094900"><a href="/gostd/image/jpeg/huffman.go.html#5094828">n</a></span><span class="op" id="5094901">)</span><span class="op" id="5094902">;</span>&nbsp;<span class="ident" id="5094904"><a href="/gostd/image/jpeg/huffman.go.html#5094879">err</a></span>&nbsp;<span class="op" id="5094908">!=</span>&nbsp;<span class="builtintype" id="5094911">nil</span>&nbsp;<span class="op" id="5094915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5094920">return</span>&nbsp;<span class="num" id="5094927">0</span><span class="op" id="5094928">,</span>&nbsp;<span class="ident" id="5094930"><a href="/gostd/image/jpeg/huffman.go.html#5094879">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5094936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5094939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094942">ret</span>&nbsp;<span class="op" id="5094946">:=</span>&nbsp;<span class="ident" id="5094949"><a href="/gostd/image/jpeg/huffman.go.html#5094805">d</a></span><span class="op" id="5094950">.</span><span class="ident" id="5094951"><a href="/gostd/image/jpeg/reader.go.html#5103298">bits</a></span><span class="op" id="5094955">.</span><span class="ident" id="5094956"><a href="/gostd/image/jpeg/reader.go.html#5103124">a</a></span>&nbsp;<span class="op" id="5094958">&gt;&gt;</span>&nbsp;<span class="builtintype" id="5094961">uint32</span><span class="op" id="5094967">(</span><span class="ident" id="5094968"><a href="/gostd/image/jpeg/huffman.go.html#5094805">d</a></span><span class="op" id="5094969">.</span><span class="ident" id="5094970"><a href="/gostd/image/jpeg/reader.go.html#5103298">bits</a></span><span class="op" id="5094974">.</span><span class="ident" id="5094975"><a href="/gostd/image/jpeg/reader.go.html#5103212">n</a></span><span class="op" id="5094976">-</span><span class="ident" id="5094977"><a href="/gostd/image/jpeg/huffman.go.html#5094828">n</a></span><span class="op" id="5094978">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094981"><a href="/gostd/image/jpeg/huffman.go.html#5094942">ret</a></span>&nbsp;<span class="op" id="5094985">&amp;=</span>&nbsp;<span class="op" id="5094988">(</span><span class="num" id="5094989">1</span>&nbsp;<span class="op" id="5094991">&lt;&lt;</span>&nbsp;<span class="builtintype" id="5094994">uint32</span><span class="op" id="5095000">(</span><span class="ident" id="5095001"><a href="/gostd/image/jpeg/huffman.go.html#5094828">n</a></span><span class="op" id="5095002">)</span><span class="op" id="5095003">)</span>&nbsp;<span class="op" id="5095005">-</span>&nbsp;<span class="num" id="5095007">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5095010"><a href="/gostd/image/jpeg/huffman.go.html#5094805">d</a></span><span class="op" id="5095011">.</span><span class="ident" id="5095012"><a href="/gostd/image/jpeg/reader.go.html#5103298">bits</a></span><span class="op" id="5095016">.</span><span class="ident" id="5095017"><a href="/gostd/image/jpeg/reader.go.html#5103212">n</a></span>&nbsp;<span class="op" id="5095019">-=</span>&nbsp;<span class="ident" id="5095022"><a href="/gostd/image/jpeg/huffman.go.html#5094828">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5095025"><a href="/gostd/image/jpeg/huffman.go.html#5094805">d</a></span><span class="op" id="5095026">.</span><span class="ident" id="5095027"><a href="/gostd/image/jpeg/reader.go.html#5103298">bits</a></span><span class="op" id="5095031">.</span><span class="ident" id="5095032"><a href="/gostd/image/jpeg/reader.go.html#5103150">m</a></span>&nbsp;<span class="op" id="5095034">&gt;&gt;=</span>&nbsp;<span class="builtintype" id="5095038">uint32</span><span class="op" id="5095044">(</span><span class="ident" id="5095045"><a href="/gostd/image/jpeg/huffman.go.html#5094828">n</a></span><span class="op" id="5095046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5095049">return</span>&nbsp;<span class="ident" id="5095056"><a href="/gostd/image/jpeg/huffman.go.html#5094942">ret</a></span><span class="op" id="5095059">,</span>&nbsp;<span class="builtintype" id="5095061">nil</span><br>
<span class="lineno"></span><span class="op" id="5095065">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
