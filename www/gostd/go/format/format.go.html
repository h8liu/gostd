<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/format</h2>
<ul>
<li><a href="/gostd/go/format/format.go.html" class="current">format.go</a></li>
<li><a href="/gostd/go/format/format_test.go.html">format_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5852519">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5852574">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5852628">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5852679">//&nbsp;Package&nbsp;format&nbsp;implements&nbsp;standard&nbsp;formatting&nbsp;of&nbsp;Go&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="5852742">package</span>&nbsp;<span class="ident" id="5852750">format</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5852758">import</span>&nbsp;<span class="op" id="5852765">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5852768">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5852777">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5852784">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5852794">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5852807">&#34;go/printer&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5852821">&#34;go/token&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5852833">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5852839">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="5852849">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5852852">var</span>&nbsp;<span class="ident" id="5852856">config</span>&nbsp;<span class="op" id="5852863">=</span>&nbsp;<span class="ident" id="5852865">printer</span><span class="op" id="5852872">.</span><span class="ident" id="5852873">Config</span><span class="op" id="5852879">{</span><span class="ident" id="5852880">Mode</span><span class="op" id="5852884">:</span>&nbsp;<span class="ident" id="5852886">printer</span><span class="op" id="5852893">.</span><span class="ident" id="5852894">UseSpaces</span>&nbsp;<span class="op" id="5852904">|</span>&nbsp;<span class="ident" id="5852906">printer</span><span class="op" id="5852913">.</span><span class="ident" id="5852914">TabIndent</span><span class="op" id="5852923">,</span>&nbsp;<span class="ident" id="5852925">Tabwidth</span><span class="op" id="5852933">:</span>&nbsp;<span class="num" id="5852935">8</span><span class="op" id="5852936">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5852939">const</span>&nbsp;<span class="ident" id="5852945">parserMode</span>&nbsp;<span class="op" id="5852956">=</span>&nbsp;<span class="ident" id="5852958">parser</span><span class="op" id="5852964">.</span><span class="ident" id="5852965">ParseComments</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5852980">//&nbsp;Node&nbsp;formats&nbsp;node&nbsp;in&nbsp;canonical&nbsp;gofmt&nbsp;style&nbsp;and&nbsp;writes&nbsp;the&nbsp;result&nbsp;to&nbsp;dst.</span><br>
<span class="lineno"></span><span class="comment" id="5853056">//</span><br>
<span class="lineno">25</span><span class="comment" id="5853059">//&nbsp;The&nbsp;node&nbsp;type&nbsp;must&nbsp;be&nbsp;*ast.File,&nbsp;*printer.CommentedNode,&nbsp;[]ast.Decl,</span><br>
<span class="lineno"></span><span class="comment" id="5853131">//&nbsp;[]ast.Stmt,&nbsp;or&nbsp;assignment-compatible&nbsp;to&nbsp;ast.Expr,&nbsp;ast.Decl,&nbsp;ast.Spec,</span><br>
<span class="lineno"></span><span class="comment" id="5853204">//&nbsp;or&nbsp;ast.Stmt.&nbsp;Node&nbsp;does&nbsp;not&nbsp;modify&nbsp;node.&nbsp;Imports&nbsp;are&nbsp;not&nbsp;sorted&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5853274">//&nbsp;nodes&nbsp;representing&nbsp;partial&nbsp;source&nbsp;files&nbsp;(i.e.,&nbsp;if&nbsp;the&nbsp;node&nbsp;is&nbsp;not&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5853346">//&nbsp;*ast.File&nbsp;or&nbsp;a&nbsp;*printer.CommentedNode&nbsp;not&nbsp;wrapping&nbsp;an&nbsp;*ast.File).</span><br>
<span class="lineno">30</span><span class="comment" id="5853415">//</span><br>
<span class="lineno"></span><span class="comment" id="5853418">//&nbsp;The&nbsp;function&nbsp;may&nbsp;return&nbsp;early&nbsp;(before&nbsp;the&nbsp;entire&nbsp;result&nbsp;is&nbsp;written)</span><br>
<span class="lineno"></span><span class="comment" id="5853489">//&nbsp;and&nbsp;return&nbsp;a&nbsp;formatting&nbsp;error,&nbsp;for&nbsp;instance&nbsp;due&nbsp;to&nbsp;an&nbsp;incorrect&nbsp;AST.</span><br>
<span class="lineno"></span><span class="comment" id="5853561">//</span><br>
<span class="lineno"></span><span class="keyword" id="5853564">func</span>&nbsp;<span class="ident" id="5853569">Node</span><span class="op" id="5853573">(</span><span class="ident" id="5853574">dst</span>&nbsp;<span class="ident" id="5853578">io</span><span class="op" id="5853580">.</span><span class="ident" id="5853581">Writer</span><span class="op" id="5853587">,</span>&nbsp;<span class="ident" id="5853589">fset</span>&nbsp;<span class="op" id="5853594">*</span><span class="ident" id="5853595">token</span><span class="op" id="5853600">.</span><span class="ident" id="5853601">FileSet</span><span class="op" id="5853608">,</span>&nbsp;<span class="ident" id="5853610">node</span>&nbsp;<span class="keyword" id="5853615">interface</span><span class="op" id="5853624">{</span><span class="op" id="5853625">}</span><span class="op" id="5853626">)</span>&nbsp;<span class="builtintype" id="5853628">error</span>&nbsp;<span class="op" id="5853634">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5853637">//&nbsp;Determine&nbsp;if&nbsp;we&nbsp;have&nbsp;a&nbsp;complete&nbsp;source&nbsp;file&nbsp;(file&nbsp;!=&nbsp;nil).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5853700">var</span>&nbsp;<span class="ident" id="5853704">file</span>&nbsp;<span class="op" id="5853709">*</span><span class="ident" id="5853710">ast</span><span class="op" id="5853713">.</span><span class="ident" id="5853714">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5853720">var</span>&nbsp;<span class="ident" id="5853724">cnode</span>&nbsp;<span class="op" id="5853730">*</span><span class="ident" id="5853731">printer</span><span class="op" id="5853738">.</span><span class="ident" id="5853739">CommentedNode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5853754">switch</span>&nbsp;<span class="ident" id="5853761">n</span>&nbsp;<span class="op" id="5853763">:=</span>&nbsp;<span class="ident" id="5853766">node</span><span class="op" id="5853770">.</span><span class="op" id="5853771">(</span><span class="keyword" id="5853772">type</span><span class="op" id="5853776">)</span>&nbsp;<span class="op" id="5853778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5853781">case</span>&nbsp;<span class="op" id="5853786">*</span><span class="ident" id="5853787">ast</span><span class="op" id="5853790">.</span><span class="ident" id="5853791">File</span><span class="op" id="5853795">:</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5853799">file</span>&nbsp;<span class="op" id="5853804">=</span>&nbsp;<span class="ident" id="5853806">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5853809">case</span>&nbsp;<span class="op" id="5853814">*</span><span class="ident" id="5853815">printer</span><span class="op" id="5853822">.</span><span class="ident" id="5853823">CommentedNode</span><span class="op" id="5853836">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5853840">if</span>&nbsp;<span class="ident" id="5853843">f</span><span class="op" id="5853844">,</span>&nbsp;<span class="ident" id="5853846">ok</span>&nbsp;<span class="op" id="5853849">:=</span>&nbsp;<span class="ident" id="5853852">n</span><span class="op" id="5853853">.</span><span class="ident" id="5853854">Node</span><span class="op" id="5853858">.</span><span class="op" id="5853859">(</span><span class="op" id="5853860">*</span><span class="ident" id="5853861">ast</span><span class="op" id="5853864">.</span><span class="ident" id="5853865">File</span><span class="op" id="5853869">)</span><span class="op" id="5853870">;</span>&nbsp;<span class="ident" id="5853872">ok</span>&nbsp;<span class="op" id="5853875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5853880">file</span>&nbsp;<span class="op" id="5853885">=</span>&nbsp;<span class="ident" id="5853887">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5853892">cnode</span>&nbsp;<span class="op" id="5853898">=</span>&nbsp;<span class="ident" id="5853900">n</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5853904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5853907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5853911">//&nbsp;Sort&nbsp;imports&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5853942">if</span>&nbsp;<span class="ident" id="5853945">file</span>&nbsp;<span class="op" id="5853950">!=</span>&nbsp;<span class="ident" id="5853953">nil</span>&nbsp;<span class="op" id="5853957">&amp;&amp;</span>&nbsp;<span class="ident" id="5853960">hasUnsortedImports</span><span class="op" id="5853978">(</span><span class="ident" id="5853979">file</span><span class="op" id="5853983">)</span>&nbsp;<span class="op" id="5853985">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5853989">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;AST&nbsp;because&nbsp;ast.SortImports&nbsp;is&nbsp;destructive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5854057">//&nbsp;TODO(gri)&nbsp;Do&nbsp;this&nbsp;more&nbsp;efficiently.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5854098">var</span>&nbsp;<span class="ident" id="5854102">buf</span>&nbsp;<span class="ident" id="5854106">bytes</span><span class="op" id="5854111">.</span><span class="ident" id="5854112">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5854121">err</span>&nbsp;<span class="op" id="5854125">:=</span>&nbsp;<span class="ident" id="5854128">config</span><span class="op" id="5854134">.</span><span class="ident" id="5854135">Fprint</span><span class="op" id="5854141">(</span><span class="op" id="5854142">&amp;</span><span class="ident" id="5854143">buf</span><span class="op" id="5854146">,</span>&nbsp;<span class="ident" id="5854148">fset</span><span class="op" id="5854152">,</span>&nbsp;<span class="ident" id="5854154">file</span><span class="op" id="5854158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5854162">if</span>&nbsp;<span class="ident" id="5854165">err</span>&nbsp;<span class="op" id="5854169">!=</span>&nbsp;<span class="ident" id="5854172">nil</span>&nbsp;<span class="op" id="5854176">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5854181">return</span>&nbsp;<span class="ident" id="5854188">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5854194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5854198">file</span><span class="op" id="5854202">,</span>&nbsp;<span class="ident" id="5854204">err</span>&nbsp;<span class="op" id="5854208">=</span>&nbsp;<span class="ident" id="5854210">parser</span><span class="op" id="5854216">.</span><span class="ident" id="5854217">ParseFile</span><span class="op" id="5854226">(</span><span class="ident" id="5854227">fset</span><span class="op" id="5854231">,</span>&nbsp;<span class="string" id="5854233">&#34;&#34;</span><span class="op" id="5854235">,</span>&nbsp;<span class="ident" id="5854237">buf</span><span class="op" id="5854240">.</span><span class="ident" id="5854241">Bytes</span><span class="op" id="5854246">(</span><span class="op" id="5854247">)</span><span class="op" id="5854248">,</span>&nbsp;<span class="ident" id="5854250">parserMode</span><span class="op" id="5854260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5854264">if</span>&nbsp;<span class="ident" id="5854267">err</span>&nbsp;<span class="op" id="5854271">!=</span>&nbsp;<span class="ident" id="5854274">nil</span>&nbsp;<span class="op" id="5854278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5854283">//&nbsp;We&nbsp;should&nbsp;never&nbsp;get&nbsp;here.&nbsp;If&nbsp;we&nbsp;do,&nbsp;provide&nbsp;good&nbsp;diagnostic.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5854350">return</span>&nbsp;<span class="ident" id="5854357">fmt</span><span class="op" id="5854360">.</span><span class="ident" id="5854361">Errorf</span><span class="op" id="5854367">(</span><span class="string" id="5854368">&#34;format.Node&nbsp;internal&nbsp;error&nbsp;(%s)&#34;</span><span class="op" id="5854401">,</span>&nbsp;<span class="ident" id="5854403">err</span><span class="op" id="5854406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5854410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5854414">ast</span><span class="op" id="5854417">.</span><span class="ident" id="5854418">SortImports</span><span class="op" id="5854429">(</span><span class="ident" id="5854430">fset</span><span class="op" id="5854434">,</span>&nbsp;<span class="ident" id="5854436">file</span><span class="op" id="5854440">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5854445">//&nbsp;Use&nbsp;new&nbsp;file&nbsp;with&nbsp;sorted&nbsp;imports.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5854484">node</span>&nbsp;<span class="op" id="5854489">=</span>&nbsp;<span class="ident" id="5854491">file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5854498">if</span>&nbsp;<span class="ident" id="5854501">cnode</span>&nbsp;<span class="op" id="5854507">!=</span>&nbsp;<span class="ident" id="5854510">nil</span>&nbsp;<span class="op" id="5854514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5854519">node</span>&nbsp;<span class="op" id="5854524">=</span>&nbsp;<span class="op" id="5854526">&amp;</span><span class="ident" id="5854527">printer</span><span class="op" id="5854534">.</span><span class="ident" id="5854535">CommentedNode</span><span class="op" id="5854548">{</span><span class="ident" id="5854549">Node</span><span class="op" id="5854553">:</span>&nbsp;<span class="ident" id="5854555">file</span><span class="op" id="5854559">,</span>&nbsp;<span class="ident" id="5854561">Comments</span><span class="op" id="5854569">:</span>&nbsp;<span class="ident" id="5854571">cnode</span><span class="op" id="5854576">.</span><span class="ident" id="5854577">Comments</span><span class="op" id="5854585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5854589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5854592">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5854596">return</span>&nbsp;<span class="ident" id="5854603">config</span><span class="op" id="5854609">.</span><span class="ident" id="5854610">Fprint</span><span class="op" id="5854616">(</span><span class="ident" id="5854617">dst</span><span class="op" id="5854620">,</span>&nbsp;<span class="ident" id="5854622">fset</span><span class="op" id="5854626">,</span>&nbsp;<span class="ident" id="5854628">node</span><span class="op" id="5854632">)</span><br>
<span class="lineno"></span><span class="op" id="5854634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5854637">//&nbsp;Source&nbsp;formats&nbsp;src&nbsp;in&nbsp;canonical&nbsp;gofmt&nbsp;style&nbsp;and&nbsp;returns&nbsp;the&nbsp;result</span><br>
<span class="lineno">75</span><span class="comment" id="5854707">//&nbsp;or&nbsp;an&nbsp;(I/O&nbsp;or&nbsp;syntax)&nbsp;error.&nbsp;src&nbsp;is&nbsp;expected&nbsp;to&nbsp;be&nbsp;a&nbsp;syntactically</span><br>
<span class="lineno"></span><span class="comment" id="5854777">//&nbsp;correct&nbsp;Go&nbsp;source&nbsp;file,&nbsp;or&nbsp;a&nbsp;list&nbsp;of&nbsp;Go&nbsp;declarations&nbsp;or&nbsp;statements.</span><br>
<span class="lineno"></span><span class="comment" id="5854848">//</span><br>
<span class="lineno"></span><span class="comment" id="5854851">//&nbsp;If&nbsp;src&nbsp;is&nbsp;a&nbsp;partial&nbsp;source&nbsp;file,&nbsp;the&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;space&nbsp;of&nbsp;src</span><br>
<span class="lineno"></span><span class="comment" id="5854925">//&nbsp;is&nbsp;applied&nbsp;to&nbsp;the&nbsp;result&nbsp;(such&nbsp;that&nbsp;it&nbsp;has&nbsp;the&nbsp;same&nbsp;leading&nbsp;and&nbsp;trailing</span><br>
<span class="lineno">80</span><span class="comment" id="5855001">//&nbsp;space&nbsp;as&nbsp;src),&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;indented&nbsp;by&nbsp;the&nbsp;same&nbsp;amount&nbsp;as&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="5855078">//&nbsp;line&nbsp;of&nbsp;src&nbsp;containing&nbsp;code.&nbsp;Imports&nbsp;are&nbsp;not&nbsp;sorted&nbsp;for&nbsp;partial&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="5855159">//</span><br>
<span class="lineno"></span><span class="keyword" id="5855162">func</span>&nbsp;<span class="ident" id="5855167">Source</span><span class="op" id="5855173">(</span><span class="ident" id="5855174">src</span>&nbsp;<span class="op" id="5855178">[</span><span class="op" id="5855179">]</span><span class="builtintype" id="5855180">byte</span><span class="op" id="5855184">)</span>&nbsp;<span class="op" id="5855186">(</span><span class="op" id="5855187">[</span><span class="op" id="5855188">]</span><span class="builtintype" id="5855189">byte</span><span class="op" id="5855193">,</span>&nbsp;<span class="builtintype" id="5855195">error</span><span class="op" id="5855200">)</span>&nbsp;<span class="op" id="5855202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855205">fset</span>&nbsp;<span class="op" id="5855210">:=</span>&nbsp;<span class="ident" id="5855213">token</span><span class="op" id="5855218">.</span><span class="ident" id="5855219">NewFileSet</span><span class="op" id="5855229">(</span><span class="op" id="5855230">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855233">file</span><span class="op" id="5855237">,</span>&nbsp;<span class="ident" id="5855239">sourceAdj</span><span class="op" id="5855248">,</span>&nbsp;<span class="ident" id="5855250">indentAdj</span><span class="op" id="5855259">,</span>&nbsp;<span class="ident" id="5855261">err</span>&nbsp;<span class="op" id="5855265">:=</span>&nbsp;<span class="ident" id="5855268">parse</span><span class="op" id="5855273">(</span><span class="ident" id="5855274">fset</span><span class="op" id="5855278">,</span>&nbsp;<span class="string" id="5855280">&#34;&#34;</span><span class="op" id="5855282">,</span>&nbsp;<span class="ident" id="5855284">src</span><span class="op" id="5855287">,</span>&nbsp;<span class="builtintype" id="5855289">true</span><span class="op" id="5855293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5855296">if</span>&nbsp;<span class="ident" id="5855299">err</span>&nbsp;<span class="op" id="5855303">!=</span>&nbsp;<span class="ident" id="5855306">nil</span>&nbsp;<span class="op" id="5855310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5855314">return</span>&nbsp;<span class="ident" id="5855321">nil</span><span class="op" id="5855324">,</span>&nbsp;<span class="ident" id="5855326">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5855331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5855335">if</span>&nbsp;<span class="ident" id="5855338">sourceAdj</span>&nbsp;<span class="op" id="5855348">==</span>&nbsp;<span class="ident" id="5855351">nil</span>&nbsp;<span class="op" id="5855355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5855359">//&nbsp;Complete&nbsp;source&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5855386">//&nbsp;TODO(gri)&nbsp;consider&nbsp;doing&nbsp;this&nbsp;always.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855429">ast</span><span class="op" id="5855432">.</span><span class="ident" id="5855433">SortImports</span><span class="op" id="5855444">(</span><span class="ident" id="5855445">fset</span><span class="op" id="5855449">,</span>&nbsp;<span class="ident" id="5855451">file</span><span class="op" id="5855455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5855458">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5855462">return</span>&nbsp;<span class="ident" id="5855469">format</span><span class="op" id="5855475">(</span><span class="ident" id="5855476">fset</span><span class="op" id="5855480">,</span>&nbsp;<span class="ident" id="5855482">file</span><span class="op" id="5855486">,</span>&nbsp;<span class="ident" id="5855488">sourceAdj</span><span class="op" id="5855497">,</span>&nbsp;<span class="ident" id="5855499">indentAdj</span><span class="op" id="5855508">,</span>&nbsp;<span class="ident" id="5855510">src</span><span class="op" id="5855513">,</span>&nbsp;<span class="ident" id="5855515">config</span><span class="op" id="5855521">)</span><br>
<span class="lineno"></span><span class="op" id="5855523">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5855526">func</span>&nbsp;<span class="ident" id="5855531">hasUnsortedImports</span><span class="op" id="5855549">(</span><span class="ident" id="5855550">file</span>&nbsp;<span class="op" id="5855555">*</span><span class="ident" id="5855556">ast</span><span class="op" id="5855559">.</span><span class="ident" id="5855560">File</span><span class="op" id="5855564">)</span>&nbsp;<span class="builtintype" id="5855566">bool</span>&nbsp;<span class="op" id="5855571">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5855574">for</span>&nbsp;<span class="ident" id="5855578">_</span><span class="op" id="5855579">,</span>&nbsp;<span class="ident" id="5855581">d</span>&nbsp;<span class="op" id="5855583">:=</span>&nbsp;<span class="keyword" id="5855586">range</span>&nbsp;<span class="ident" id="5855592">file</span><span class="op" id="5855596">.</span><span class="ident" id="5855597">Decls</span>&nbsp;<span class="op" id="5855603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855607">d</span><span class="op" id="5855608">,</span>&nbsp;<span class="ident" id="5855610">ok</span>&nbsp;<span class="op" id="5855613">:=</span>&nbsp;<span class="ident" id="5855616">d</span><span class="op" id="5855617">.</span><span class="op" id="5855618">(</span><span class="op" id="5855619">*</span><span class="ident" id="5855620">ast</span><span class="op" id="5855623">.</span><span class="ident" id="5855624">GenDecl</span><span class="op" id="5855631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5855635">if</span>&nbsp;<span class="op" id="5855638">!</span><span class="ident" id="5855639">ok</span>&nbsp;<span class="op" id="5855642">||</span>&nbsp;<span class="ident" id="5855645">d</span><span class="op" id="5855646">.</span><span class="ident" id="5855647">Tok</span>&nbsp;<span class="op" id="5855651">!=</span>&nbsp;<span class="ident" id="5855654">token</span><span class="op" id="5855659">.</span><span class="ident" id="5855660">IMPORT</span>&nbsp;<span class="op" id="5855667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5855672">//&nbsp;Not&nbsp;an&nbsp;import&nbsp;declaration,&nbsp;so&nbsp;we&#39;re&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5855720">//&nbsp;Imports&nbsp;are&nbsp;always&nbsp;first.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5855752">return</span>&nbsp;<span class="builtintype" id="5855759">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5855767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5855771">if</span>&nbsp;<span class="ident" id="5855774">d</span><span class="op" id="5855775">.</span><span class="ident" id="5855776">Lparen</span><span class="op" id="5855782">.</span><span class="ident" id="5855783">IsValid</span><span class="op" id="5855790">(</span><span class="op" id="5855791">)</span>&nbsp;<span class="op" id="5855793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5855798">//&nbsp;For&nbsp;now&nbsp;assume&nbsp;all&nbsp;grouped&nbsp;imports&nbsp;are&nbsp;unsorted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5855853">//&nbsp;TODO(gri)&nbsp;Should&nbsp;check&nbsp;if&nbsp;they&nbsp;are&nbsp;sorted&nbsp;already.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5855910">return</span>&nbsp;<span class="builtintype" id="5855917">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5855924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5855928">//&nbsp;Ungrouped&nbsp;imports&nbsp;are&nbsp;sorted&nbsp;by&nbsp;default.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5855973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5855976">return</span>&nbsp;<span class="builtintype" id="5855983">false</span><br>
<span class="lineno">115</span><span class="op" id="5855989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5855992">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5856072">//&nbsp;Support&nbsp;functions</span><br>
<span class="lineno"></span><span class="comment" id="5856093">//</span><br>
<span class="lineno">120</span><span class="comment" id="5856096">//&nbsp;The&nbsp;functions&nbsp;parse,&nbsp;format,&nbsp;and&nbsp;isSpace&nbsp;below&nbsp;are&nbsp;identical&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5856167">//&nbsp;respective&nbsp;functions&nbsp;in&nbsp;cmd/gofmt/gofmt.go&nbsp;-&nbsp;keep&nbsp;them&nbsp;in&nbsp;sync!</span><br>
<span class="lineno"></span><span class="comment" id="5856234">//</span><br>
<span class="lineno"></span><span class="comment" id="5856237">//&nbsp;TODO(gri)&nbsp;Factor&nbsp;out&nbsp;this&nbsp;functionality,&nbsp;eventually.</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="5856294">//&nbsp;parse&nbsp;parses&nbsp;src,&nbsp;which&nbsp;was&nbsp;read&nbsp;from&nbsp;the&nbsp;named&nbsp;file,</span><br>
<span class="lineno"></span><span class="comment" id="5856351">//&nbsp;as&nbsp;a&nbsp;Go&nbsp;source&nbsp;file,&nbsp;declaration,&nbsp;or&nbsp;statement&nbsp;list.</span><br>
<span class="lineno"></span><span class="keyword" id="5856407">func</span>&nbsp;<span class="ident" id="5856412">parse</span><span class="op" id="5856417">(</span><span class="ident" id="5856418">fset</span>&nbsp;<span class="op" id="5856423">*</span><span class="ident" id="5856424">token</span><span class="op" id="5856429">.</span><span class="ident" id="5856430">FileSet</span><span class="op" id="5856437">,</span>&nbsp;<span class="ident" id="5856439">filename</span>&nbsp;<span class="builtintype" id="5856448">string</span><span class="op" id="5856454">,</span>&nbsp;<span class="ident" id="5856456">src</span>&nbsp;<span class="op" id="5856460">[</span><span class="op" id="5856461">]</span><span class="builtintype" id="5856462">byte</span><span class="op" id="5856466">,</span>&nbsp;<span class="ident" id="5856468">fragmentOk</span>&nbsp;<span class="builtintype" id="5856479">bool</span><span class="op" id="5856483">)</span>&nbsp;<span class="op" id="5856485">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5856488">file</span>&nbsp;<span class="op" id="5856493">*</span><span class="ident" id="5856494">ast</span><span class="op" id="5856497">.</span><span class="ident" id="5856498">File</span><span class="op" id="5856502">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5856505">sourceAdj</span>&nbsp;<span class="keyword" id="5856515">func</span><span class="op" id="5856519">(</span><span class="ident" id="5856520">src</span>&nbsp;<span class="op" id="5856524">[</span><span class="op" id="5856525">]</span><span class="builtintype" id="5856526">byte</span><span class="op" id="5856530">,</span>&nbsp;<span class="ident" id="5856532">indent</span>&nbsp;<span class="builtintype" id="5856539">int</span><span class="op" id="5856542">)</span>&nbsp;<span class="op" id="5856544">[</span><span class="op" id="5856545">]</span><span class="builtintype" id="5856546">byte</span><span class="op" id="5856550">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5856553">indentAdj</span>&nbsp;<span class="builtintype" id="5856563">int</span><span class="op" id="5856566">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5856569">err</span>&nbsp;<span class="builtintype" id="5856573">error</span><span class="op" id="5856578">,</span><br>
<span class="lineno"></span><span class="op" id="5856580">)</span>&nbsp;<span class="op" id="5856582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5856585">//&nbsp;Try&nbsp;as&nbsp;whole&nbsp;source&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5856615">file</span><span class="op" id="5856619">,</span>&nbsp;<span class="ident" id="5856621">err</span>&nbsp;<span class="op" id="5856625">=</span>&nbsp;<span class="ident" id="5856627">parser</span><span class="op" id="5856633">.</span><span class="ident" id="5856634">ParseFile</span><span class="op" id="5856643">(</span><span class="ident" id="5856644">fset</span><span class="op" id="5856648">,</span>&nbsp;<span class="ident" id="5856650">filename</span><span class="op" id="5856658">,</span>&nbsp;<span class="ident" id="5856660">src</span><span class="op" id="5856663">,</span>&nbsp;<span class="ident" id="5856665">parserMode</span><span class="op" id="5856675">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5856678">//&nbsp;If&nbsp;there&#39;s&nbsp;no&nbsp;error,&nbsp;return.&nbsp;&nbsp;If&nbsp;the&nbsp;error&nbsp;is&nbsp;that&nbsp;the&nbsp;source&nbsp;file&nbsp;didn&#39;t&nbsp;begin&nbsp;with&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5856769">//&nbsp;package&nbsp;line&nbsp;and&nbsp;source&nbsp;fragments&nbsp;are&nbsp;ok,&nbsp;fall&nbsp;through&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5856831">//&nbsp;try&nbsp;as&nbsp;a&nbsp;source&nbsp;fragment.&nbsp;&nbsp;Stop&nbsp;and&nbsp;return&nbsp;on&nbsp;any&nbsp;other&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5856898">if</span>&nbsp;<span class="ident" id="5856901">err</span>&nbsp;<span class="op" id="5856905">==</span>&nbsp;<span class="ident" id="5856908">nil</span>&nbsp;<span class="op" id="5856912">||</span>&nbsp;<span class="op" id="5856915">!</span><span class="ident" id="5856916">fragmentOk</span>&nbsp;<span class="op" id="5856927">||</span>&nbsp;<span class="op" id="5856930">!</span><span class="ident" id="5856931">strings</span><span class="op" id="5856938">.</span><span class="ident" id="5856939">Contains</span><span class="op" id="5856947">(</span><span class="ident" id="5856948">err</span><span class="op" id="5856951">.</span><span class="ident" id="5856952">Error</span><span class="op" id="5856957">(</span><span class="op" id="5856958">)</span><span class="op" id="5856959">,</span>&nbsp;<span class="string" id="5856961">&#34;expected&nbsp;&#39;package&#39;&#34;</span><span class="op" id="5856981">)</span>&nbsp;<span class="op" id="5856983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5856987">return</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5856995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5856999">//&nbsp;If&nbsp;this&nbsp;is&nbsp;a&nbsp;declaration&nbsp;list,&nbsp;make&nbsp;it&nbsp;a&nbsp;source&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857056">//&nbsp;by&nbsp;inserting&nbsp;a&nbsp;package&nbsp;clause.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857091">//&nbsp;Insert&nbsp;using&nbsp;a&nbsp;;,&nbsp;not&nbsp;a&nbsp;newline,&nbsp;so&nbsp;that&nbsp;the&nbsp;line&nbsp;numbers</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857153">//&nbsp;in&nbsp;psrc&nbsp;match&nbsp;the&nbsp;ones&nbsp;in&nbsp;src.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857188">psrc</span>&nbsp;<span class="op" id="5857193">:=</span>&nbsp;<span class="builtinfunc" id="5857196">append</span><span class="op" id="5857202">(</span><span class="op" id="5857203">[</span><span class="op" id="5857204">]</span><span class="builtintype" id="5857205">byte</span><span class="op" id="5857209">(</span><span class="string" id="5857210">&#34;package&nbsp;p;&#34;</span><span class="op" id="5857222">)</span><span class="op" id="5857223">,</span>&nbsp;<span class="ident" id="5857225">src</span><span class="op" id="5857228">...</span><span class="op" id="5857231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857234">file</span><span class="op" id="5857238">,</span>&nbsp;<span class="ident" id="5857240">err</span>&nbsp;<span class="op" id="5857244">=</span>&nbsp;<span class="ident" id="5857246">parser</span><span class="op" id="5857252">.</span><span class="ident" id="5857253">ParseFile</span><span class="op" id="5857262">(</span><span class="ident" id="5857263">fset</span><span class="op" id="5857267">,</span>&nbsp;<span class="ident" id="5857269">filename</span><span class="op" id="5857277">,</span>&nbsp;<span class="ident" id="5857279">psrc</span><span class="op" id="5857283">,</span>&nbsp;<span class="ident" id="5857285">parserMode</span><span class="op" id="5857295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857298">if</span>&nbsp;<span class="ident" id="5857301">err</span>&nbsp;<span class="op" id="5857305">==</span>&nbsp;<span class="ident" id="5857308">nil</span>&nbsp;<span class="op" id="5857312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857316">sourceAdj</span>&nbsp;<span class="op" id="5857326">=</span>&nbsp;<span class="keyword" id="5857328">func</span><span class="op" id="5857332">(</span><span class="ident" id="5857333">src</span>&nbsp;<span class="op" id="5857337">[</span><span class="op" id="5857338">]</span><span class="builtintype" id="5857339">byte</span><span class="op" id="5857343">,</span>&nbsp;<span class="ident" id="5857345">indent</span>&nbsp;<span class="builtintype" id="5857352">int</span><span class="op" id="5857355">)</span>&nbsp;<span class="op" id="5857357">[</span><span class="op" id="5857358">]</span><span class="builtintype" id="5857359">byte</span>&nbsp;<span class="op" id="5857364">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857369">//&nbsp;Remove&nbsp;the&nbsp;package&nbsp;clause.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857402">//&nbsp;Gofmt&nbsp;has&nbsp;turned&nbsp;the&nbsp;;&nbsp;into&nbsp;a&nbsp;\n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857442">src</span>&nbsp;<span class="op" id="5857446">=</span>&nbsp;<span class="ident" id="5857448">src</span><span class="op" id="5857451">[</span><span class="ident" id="5857452">indent</span><span class="op" id="5857458">+</span><span class="builtinfunc" id="5857459">len</span><span class="op" id="5857462">(</span><span class="string" id="5857463">&#34;package&nbsp;p\n&#34;</span><span class="op" id="5857476">)</span><span class="op" id="5857477">:</span><span class="op" id="5857478">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857483">return</span>&nbsp;<span class="ident" id="5857490">bytes</span><span class="op" id="5857495">.</span><span class="ident" id="5857496">TrimSpace</span><span class="op" id="5857505">(</span><span class="ident" id="5857506">src</span><span class="op" id="5857509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5857513">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857517">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5857525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857528">//&nbsp;If&nbsp;the&nbsp;error&nbsp;is&nbsp;that&nbsp;the&nbsp;source&nbsp;file&nbsp;didn&#39;t&nbsp;begin&nbsp;with&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857589">//&nbsp;declaration,&nbsp;fall&nbsp;through&nbsp;to&nbsp;try&nbsp;as&nbsp;a&nbsp;statement&nbsp;list.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857647">//&nbsp;Stop&nbsp;and&nbsp;return&nbsp;on&nbsp;any&nbsp;other&nbsp;error.</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857687">if</span>&nbsp;<span class="op" id="5857690">!</span><span class="ident" id="5857691">strings</span><span class="op" id="5857698">.</span><span class="ident" id="5857699">Contains</span><span class="op" id="5857707">(</span><span class="ident" id="5857708">err</span><span class="op" id="5857711">.</span><span class="ident" id="5857712">Error</span><span class="op" id="5857717">(</span><span class="op" id="5857718">)</span><span class="op" id="5857719">,</span>&nbsp;<span class="string" id="5857721">&#34;expected&nbsp;declaration&#34;</span><span class="op" id="5857743">)</span>&nbsp;<span class="op" id="5857745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857749">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5857757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857761">//&nbsp;If&nbsp;this&nbsp;is&nbsp;a&nbsp;statement&nbsp;list,&nbsp;make&nbsp;it&nbsp;a&nbsp;source&nbsp;file</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857816">//&nbsp;by&nbsp;inserting&nbsp;a&nbsp;package&nbsp;clause&nbsp;and&nbsp;turning&nbsp;the&nbsp;list</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857871">//&nbsp;into&nbsp;a&nbsp;function&nbsp;body.&nbsp;&nbsp;This&nbsp;handles&nbsp;expressions&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857928">//&nbsp;Insert&nbsp;using&nbsp;a&nbsp;;,&nbsp;not&nbsp;a&nbsp;newline,&nbsp;so&nbsp;that&nbsp;the&nbsp;line&nbsp;numbers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857990">//&nbsp;in&nbsp;fsrc&nbsp;match&nbsp;the&nbsp;ones&nbsp;in&nbsp;src.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858025">fsrc</span>&nbsp;<span class="op" id="5858030">:=</span>&nbsp;<span class="builtinfunc" id="5858033">append</span><span class="op" id="5858039">(</span><span class="builtinfunc" id="5858040">append</span><span class="op" id="5858046">(</span><span class="op" id="5858047">[</span><span class="op" id="5858048">]</span><span class="builtintype" id="5858049">byte</span><span class="op" id="5858053">(</span><span class="string" id="5858054">&#34;package&nbsp;p;&nbsp;func&nbsp;_()&nbsp;{&#34;</span><span class="op" id="5858077">)</span><span class="op" id="5858078">,</span>&nbsp;<span class="ident" id="5858080">src</span><span class="op" id="5858083">...</span><span class="op" id="5858086">)</span><span class="op" id="5858087">,</span>&nbsp;<span class="string" id="5858089">&#39;\n&#39;</span><span class="op" id="5858093">,</span>&nbsp;<span class="string" id="5858095">&#39;}&#39;</span><span class="op" id="5858098">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858101">file</span><span class="op" id="5858105">,</span>&nbsp;<span class="ident" id="5858107">err</span>&nbsp;<span class="op" id="5858111">=</span>&nbsp;<span class="ident" id="5858113">parser</span><span class="op" id="5858119">.</span><span class="ident" id="5858120">ParseFile</span><span class="op" id="5858129">(</span><span class="ident" id="5858130">fset</span><span class="op" id="5858134">,</span>&nbsp;<span class="ident" id="5858136">filename</span><span class="op" id="5858144">,</span>&nbsp;<span class="ident" id="5858146">fsrc</span><span class="op" id="5858150">,</span>&nbsp;<span class="ident" id="5858152">parserMode</span><span class="op" id="5858162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858165">if</span>&nbsp;<span class="ident" id="5858168">err</span>&nbsp;<span class="op" id="5858172">==</span>&nbsp;<span class="ident" id="5858175">nil</span>&nbsp;<span class="op" id="5858179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858183">sourceAdj</span>&nbsp;<span class="op" id="5858193">=</span>&nbsp;<span class="keyword" id="5858195">func</span><span class="op" id="5858199">(</span><span class="ident" id="5858200">src</span>&nbsp;<span class="op" id="5858204">[</span><span class="op" id="5858205">]</span><span class="builtintype" id="5858206">byte</span><span class="op" id="5858210">,</span>&nbsp;<span class="ident" id="5858212">indent</span>&nbsp;<span class="builtintype" id="5858219">int</span><span class="op" id="5858222">)</span>&nbsp;<span class="op" id="5858224">[</span><span class="op" id="5858225">]</span><span class="builtintype" id="5858226">byte</span>&nbsp;<span class="op" id="5858231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5858236">//&nbsp;Cap&nbsp;adjusted&nbsp;indent&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858271">if</span>&nbsp;<span class="ident" id="5858274">indent</span>&nbsp;<span class="op" id="5858281">&lt;</span>&nbsp;<span class="num" id="5858283">0</span>&nbsp;<span class="op" id="5858285">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858291">indent</span>&nbsp;<span class="op" id="5858298">=</span>&nbsp;<span class="num" id="5858300">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5858305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5858310">//&nbsp;Remove&nbsp;the&nbsp;wrapping.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5858337">//&nbsp;Gofmt&nbsp;has&nbsp;turned&nbsp;the&nbsp;;&nbsp;into&nbsp;a&nbsp;\n\n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5858379">//&nbsp;There&nbsp;will&nbsp;be&nbsp;two&nbsp;non-blank&nbsp;lines&nbsp;with&nbsp;indent,&nbsp;hence&nbsp;2*indent.</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858448">src</span>&nbsp;<span class="op" id="5858452">=</span>&nbsp;<span class="ident" id="5858454">src</span><span class="op" id="5858457">[</span><span class="num" id="5858458">2</span><span class="op" id="5858459">*</span><span class="ident" id="5858460">indent</span><span class="op" id="5858466">+</span><span class="builtinfunc" id="5858467">len</span><span class="op" id="5858470">(</span><span class="string" id="5858471">&#34;package&nbsp;p\n\nfunc&nbsp;_()&nbsp;{&#34;</span><span class="op" id="5858496">)</span><span class="op" id="5858497">:</span><span class="op" id="5858498">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858503">src</span>&nbsp;<span class="op" id="5858507">=</span>&nbsp;<span class="ident" id="5858509">src</span><span class="op" id="5858512">[</span><span class="op" id="5858513">:</span><span class="builtinfunc" id="5858514">len</span><span class="op" id="5858517">(</span><span class="ident" id="5858518">src</span><span class="op" id="5858521">)</span><span class="op" id="5858522">-</span><span class="op" id="5858523">(</span><span class="ident" id="5858524">indent</span><span class="op" id="5858530">+</span><span class="builtinfunc" id="5858531">len</span><span class="op" id="5858534">(</span><span class="string" id="5858535">&#34;\n}\n&#34;</span><span class="op" id="5858542">)</span><span class="op" id="5858543">)</span><span class="op" id="5858544">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858549">return</span>&nbsp;<span class="ident" id="5858556">bytes</span><span class="op" id="5858561">.</span><span class="ident" id="5858562">TrimSpace</span><span class="op" id="5858571">(</span><span class="ident" id="5858572">src</span><span class="op" id="5858575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5858579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5858583">//&nbsp;Gofmt&nbsp;has&nbsp;also&nbsp;indented&nbsp;the&nbsp;function&nbsp;body&nbsp;one&nbsp;level.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5858641">//&nbsp;Adjust&nbsp;that&nbsp;with&nbsp;indentAdj.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858674">indentAdj</span>&nbsp;<span class="op" id="5858684">=</span>&nbsp;<span class="op" id="5858686">-</span><span class="num" id="5858687">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5858690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5858694">//&nbsp;Succeeded,&nbsp;or&nbsp;out&nbsp;of&nbsp;options.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858728">return</span><br>
<span class="lineno"></span><span class="op" id="5858735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5858738">//&nbsp;format&nbsp;formats&nbsp;the&nbsp;given&nbsp;package&nbsp;file&nbsp;originally&nbsp;obtained&nbsp;from&nbsp;src</span><br>
<span class="lineno"></span><span class="comment" id="5858808">//&nbsp;and&nbsp;adjusts&nbsp;the&nbsp;result&nbsp;based&nbsp;on&nbsp;the&nbsp;original&nbsp;source&nbsp;via&nbsp;sourceAdj</span><br>
<span class="lineno">195</span><span class="comment" id="5858877">//&nbsp;and&nbsp;indentAdj.</span><br>
<span class="lineno"></span><span class="keyword" id="5858895">func</span>&nbsp;<span class="ident" id="5858900">format</span><span class="op" id="5858906">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858909">fset</span>&nbsp;<span class="op" id="5858914">*</span><span class="ident" id="5858915">token</span><span class="op" id="5858920">.</span><span class="ident" id="5858921">FileSet</span><span class="op" id="5858928">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858931">file</span>&nbsp;<span class="op" id="5858936">*</span><span class="ident" id="5858937">ast</span><span class="op" id="5858940">.</span><span class="ident" id="5858941">File</span><span class="op" id="5858945">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858948">sourceAdj</span>&nbsp;<span class="keyword" id="5858958">func</span><span class="op" id="5858962">(</span><span class="ident" id="5858963">src</span>&nbsp;<span class="op" id="5858967">[</span><span class="op" id="5858968">]</span><span class="builtintype" id="5858969">byte</span><span class="op" id="5858973">,</span>&nbsp;<span class="ident" id="5858975">indent</span>&nbsp;<span class="builtintype" id="5858982">int</span><span class="op" id="5858985">)</span>&nbsp;<span class="op" id="5858987">[</span><span class="op" id="5858988">]</span><span class="builtintype" id="5858989">byte</span><span class="op" id="5858993">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858996">indentAdj</span>&nbsp;<span class="builtintype" id="5859006">int</span><span class="op" id="5859009">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859012">src</span>&nbsp;<span class="op" id="5859016">[</span><span class="op" id="5859017">]</span><span class="builtintype" id="5859018">byte</span><span class="op" id="5859022">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859025">cfg</span>&nbsp;<span class="ident" id="5859029">printer</span><span class="op" id="5859036">.</span><span class="ident" id="5859037">Config</span><span class="op" id="5859043">,</span><br>
<span class="lineno"></span><span class="op" id="5859045">)</span>&nbsp;<span class="op" id="5859047">(</span><span class="op" id="5859048">[</span><span class="op" id="5859049">]</span><span class="builtintype" id="5859050">byte</span><span class="op" id="5859054">,</span>&nbsp;<span class="builtintype" id="5859056">error</span><span class="op" id="5859061">)</span>&nbsp;<span class="op" id="5859063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859066">if</span>&nbsp;<span class="ident" id="5859069">sourceAdj</span>&nbsp;<span class="op" id="5859079">==</span>&nbsp;<span class="ident" id="5859082">nil</span>&nbsp;<span class="op" id="5859086">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5859090">//&nbsp;Complete&nbsp;source&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859117">var</span>&nbsp;<span class="ident" id="5859121">buf</span>&nbsp;<span class="ident" id="5859125">bytes</span><span class="op" id="5859130">.</span><span class="ident" id="5859131">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859140">err</span>&nbsp;<span class="op" id="5859144">:=</span>&nbsp;<span class="ident" id="5859147">cfg</span><span class="op" id="5859150">.</span><span class="ident" id="5859151">Fprint</span><span class="op" id="5859157">(</span><span class="op" id="5859158">&amp;</span><span class="ident" id="5859159">buf</span><span class="op" id="5859162">,</span>&nbsp;<span class="ident" id="5859164">fset</span><span class="op" id="5859168">,</span>&nbsp;<span class="ident" id="5859170">file</span><span class="op" id="5859174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859178">if</span>&nbsp;<span class="ident" id="5859181">err</span>&nbsp;<span class="op" id="5859185">!=</span>&nbsp;<span class="ident" id="5859188">nil</span>&nbsp;<span class="op" id="5859192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859197">return</span>&nbsp;<span class="ident" id="5859204">nil</span><span class="op" id="5859207">,</span>&nbsp;<span class="ident" id="5859209">err</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5859215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859219">return</span>&nbsp;<span class="ident" id="5859226">buf</span><span class="op" id="5859229">.</span><span class="ident" id="5859230">Bytes</span><span class="op" id="5859235">(</span><span class="op" id="5859236">)</span><span class="op" id="5859237">,</span>&nbsp;<span class="ident" id="5859239">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5859244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5859248">//&nbsp;Partial&nbsp;source&nbsp;file.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5859273">//&nbsp;Determine&nbsp;and&nbsp;prepend&nbsp;leading&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859314">i</span><span class="op" id="5859315">,</span>&nbsp;<span class="ident" id="5859317">j</span>&nbsp;<span class="op" id="5859319">:=</span>&nbsp;<span class="num" id="5859322">0</span><span class="op" id="5859323">,</span>&nbsp;<span class="num" id="5859325">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859328">for</span>&nbsp;<span class="ident" id="5859332">j</span>&nbsp;<span class="op" id="5859334">&lt;</span>&nbsp;<span class="builtinfunc" id="5859336">len</span><span class="op" id="5859339">(</span><span class="ident" id="5859340">src</span><span class="op" id="5859343">)</span>&nbsp;<span class="op" id="5859345">&amp;&amp;</span>&nbsp;<span class="ident" id="5859348">isSpace</span><span class="op" id="5859355">(</span><span class="ident" id="5859356">src</span><span class="op" id="5859359">[</span><span class="ident" id="5859360">j</span><span class="op" id="5859361">]</span><span class="op" id="5859362">)</span>&nbsp;<span class="op" id="5859364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859368">if</span>&nbsp;<span class="ident" id="5859371">src</span><span class="op" id="5859374">[</span><span class="ident" id="5859375">j</span><span class="op" id="5859376">]</span>&nbsp;<span class="op" id="5859378">==</span>&nbsp;<span class="string" id="5859381">&#39;\n&#39;</span>&nbsp;<span class="op" id="5859386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859391">i</span>&nbsp;<span class="op" id="5859393">=</span>&nbsp;<span class="ident" id="5859395">j</span>&nbsp;<span class="op" id="5859397">+</span>&nbsp;<span class="num" id="5859399">1</span>&nbsp;<span class="comment" id="5859401">//&nbsp;byte&nbsp;offset&nbsp;of&nbsp;last&nbsp;line&nbsp;in&nbsp;leading&nbsp;space</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5859448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859452">j</span><span class="op" id="5859453">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5859457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859460">var</span>&nbsp;<span class="ident" id="5859464">res</span>&nbsp;<span class="op" id="5859468">[</span><span class="op" id="5859469">]</span><span class="builtintype" id="5859470">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859476">res</span>&nbsp;<span class="op" id="5859480">=</span>&nbsp;<span class="builtinfunc" id="5859482">append</span><span class="op" id="5859488">(</span><span class="ident" id="5859489">res</span><span class="op" id="5859492">,</span>&nbsp;<span class="ident" id="5859494">src</span><span class="op" id="5859497">[</span><span class="op" id="5859498">:</span><span class="ident" id="5859499">i</span><span class="op" id="5859500">]</span><span class="op" id="5859501">...</span><span class="op" id="5859504">)</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5859508">//&nbsp;Determine&nbsp;and&nbsp;prepend&nbsp;indentation&nbsp;of&nbsp;first&nbsp;code&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5859566">//&nbsp;Spaces&nbsp;are&nbsp;ignored&nbsp;unless&nbsp;there&nbsp;are&nbsp;no&nbsp;tabs,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5859615">//&nbsp;in&nbsp;which&nbsp;case&nbsp;spaces&nbsp;count&nbsp;as&nbsp;one&nbsp;tab.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859658">indent</span>&nbsp;<span class="op" id="5859665">:=</span>&nbsp;<span class="num" id="5859668">0</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859671">hasSpace</span>&nbsp;<span class="op" id="5859680">:=</span>&nbsp;<span class="builtintype" id="5859683">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859690">for</span>&nbsp;<span class="ident" id="5859694">_</span><span class="op" id="5859695">,</span>&nbsp;<span class="ident" id="5859697">b</span>&nbsp;<span class="op" id="5859699">:=</span>&nbsp;<span class="keyword" id="5859702">range</span>&nbsp;<span class="ident" id="5859708">src</span><span class="op" id="5859711">[</span><span class="ident" id="5859712">i</span><span class="op" id="5859713">:</span><span class="ident" id="5859714">j</span><span class="op" id="5859715">]</span>&nbsp;<span class="op" id="5859717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859721">switch</span>&nbsp;<span class="ident" id="5859728">b</span>&nbsp;<span class="op" id="5859730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859734">case</span>&nbsp;<span class="string" id="5859739">&#39;&nbsp;&#39;</span><span class="op" id="5859742">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859747">hasSpace</span>&nbsp;<span class="op" id="5859756">=</span>&nbsp;<span class="builtintype" id="5859758">true</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859765">case</span>&nbsp;<span class="string" id="5859770">&#39;\t&#39;</span><span class="op" id="5859774">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859779">indent</span><span class="op" id="5859785">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5859790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5859793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859796">if</span>&nbsp;<span class="ident" id="5859799">indent</span>&nbsp;<span class="op" id="5859806">==</span>&nbsp;<span class="num" id="5859809">0</span>&nbsp;<span class="op" id="5859811">&amp;&amp;</span>&nbsp;<span class="ident" id="5859814">hasSpace</span>&nbsp;<span class="op" id="5859823">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859827">indent</span>&nbsp;<span class="op" id="5859834">=</span>&nbsp;<span class="num" id="5859836">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5859839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859842">for</span>&nbsp;<span class="ident" id="5859846">i</span>&nbsp;<span class="op" id="5859848">:=</span>&nbsp;<span class="num" id="5859851">0</span><span class="op" id="5859852">;</span>&nbsp;<span class="ident" id="5859854">i</span>&nbsp;<span class="op" id="5859856">&lt;</span>&nbsp;<span class="ident" id="5859858">indent</span><span class="op" id="5859864">;</span>&nbsp;<span class="ident" id="5859866">i</span><span class="op" id="5859867">++</span>&nbsp;<span class="op" id="5859870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859874">res</span>&nbsp;<span class="op" id="5859878">=</span>&nbsp;<span class="builtinfunc" id="5859880">append</span><span class="op" id="5859886">(</span><span class="ident" id="5859887">res</span><span class="op" id="5859890">,</span>&nbsp;<span class="string" id="5859892">&#39;\t&#39;</span><span class="op" id="5859896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5859899">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5859903">//&nbsp;Format&nbsp;the&nbsp;source.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5859926">//&nbsp;Write&nbsp;it&nbsp;without&nbsp;any&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859979">cfg</span><span class="op" id="5859982">.</span><span class="ident" id="5859983">Indent</span>&nbsp;<span class="op" id="5859990">=</span>&nbsp;<span class="ident" id="5859992">indent</span>&nbsp;<span class="op" id="5859999">+</span>&nbsp;<span class="ident" id="5860001">indentAdj</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860012">var</span>&nbsp;<span class="ident" id="5860016">buf</span>&nbsp;<span class="ident" id="5860020">bytes</span><span class="op" id="5860025">.</span><span class="ident" id="5860026">Buffer</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860034">err</span>&nbsp;<span class="op" id="5860038">:=</span>&nbsp;<span class="ident" id="5860041">cfg</span><span class="op" id="5860044">.</span><span class="ident" id="5860045">Fprint</span><span class="op" id="5860051">(</span><span class="op" id="5860052">&amp;</span><span class="ident" id="5860053">buf</span><span class="op" id="5860056">,</span>&nbsp;<span class="ident" id="5860058">fset</span><span class="op" id="5860062">,</span>&nbsp;<span class="ident" id="5860064">file</span><span class="op" id="5860068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860071">if</span>&nbsp;<span class="ident" id="5860074">err</span>&nbsp;<span class="op" id="5860078">!=</span>&nbsp;<span class="ident" id="5860081">nil</span>&nbsp;<span class="op" id="5860085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860089">return</span>&nbsp;<span class="ident" id="5860096">nil</span><span class="op" id="5860099">,</span>&nbsp;<span class="ident" id="5860101">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5860106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860109">res</span>&nbsp;<span class="op" id="5860113">=</span>&nbsp;<span class="builtinfunc" id="5860115">append</span><span class="op" id="5860121">(</span><span class="ident" id="5860122">res</span><span class="op" id="5860125">,</span>&nbsp;<span class="ident" id="5860127">sourceAdj</span><span class="op" id="5860136">(</span><span class="ident" id="5860137">buf</span><span class="op" id="5860140">.</span><span class="ident" id="5860141">Bytes</span><span class="op" id="5860146">(</span><span class="op" id="5860147">)</span><span class="op" id="5860148">,</span>&nbsp;<span class="ident" id="5860150">cfg</span><span class="op" id="5860153">.</span><span class="ident" id="5860154">Indent</span><span class="op" id="5860160">)</span><span class="op" id="5860161">...</span><span class="op" id="5860164">)</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5860168">//&nbsp;Determine&nbsp;and&nbsp;append&nbsp;trailing&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860209">i</span>&nbsp;<span class="op" id="5860211">=</span>&nbsp;<span class="builtinfunc" id="5860213">len</span><span class="op" id="5860216">(</span><span class="ident" id="5860217">src</span><span class="op" id="5860220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860223">for</span>&nbsp;<span class="ident" id="5860227">i</span>&nbsp;<span class="op" id="5860229">&gt;</span>&nbsp;<span class="num" id="5860231">0</span>&nbsp;<span class="op" id="5860233">&amp;&amp;</span>&nbsp;<span class="ident" id="5860236">isSpace</span><span class="op" id="5860243">(</span><span class="ident" id="5860244">src</span><span class="op" id="5860247">[</span><span class="ident" id="5860248">i</span><span class="op" id="5860249">-</span><span class="num" id="5860250">1</span><span class="op" id="5860251">]</span><span class="op" id="5860252">)</span>&nbsp;<span class="op" id="5860254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860258">i</span><span class="op" id="5860259">--</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5860263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860266">return</span>&nbsp;<span class="builtinfunc" id="5860273">append</span><span class="op" id="5860279">(</span><span class="ident" id="5860280">res</span><span class="op" id="5860283">,</span>&nbsp;<span class="ident" id="5860285">src</span><span class="op" id="5860288">[</span><span class="ident" id="5860289">i</span><span class="op" id="5860290">:</span><span class="op" id="5860291">]</span><span class="op" id="5860292">...</span><span class="op" id="5860295">)</span><span class="op" id="5860296">,</span>&nbsp;<span class="ident" id="5860298">nil</span><br>
<span class="lineno"></span><span class="op" id="5860302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5860305">func</span>&nbsp;<span class="ident" id="5860310">isSpace</span><span class="op" id="5860317">(</span><span class="ident" id="5860318">b</span>&nbsp;<span class="builtintype" id="5860320">byte</span><span class="op" id="5860324">)</span>&nbsp;<span class="builtintype" id="5860326">bool</span>&nbsp;<span class="op" id="5860331">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860334">return</span>&nbsp;<span class="ident" id="5860341">b</span>&nbsp;<span class="op" id="5860343">==</span>&nbsp;<span class="string" id="5860346">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5860350">||</span>&nbsp;<span class="ident" id="5860353">b</span>&nbsp;<span class="op" id="5860355">==</span>&nbsp;<span class="string" id="5860358">&#39;\t&#39;</span>&nbsp;<span class="op" id="5860363">||</span>&nbsp;<span class="ident" id="5860366">b</span>&nbsp;<span class="op" id="5860368">==</span>&nbsp;<span class="string" id="5860371">&#39;\n&#39;</span>&nbsp;<span class="op" id="5860376">||</span>&nbsp;<span class="ident" id="5860379">b</span>&nbsp;<span class="op" id="5860381">==</span>&nbsp;<span class="string" id="5860384">&#39;\r&#39;</span><br>
<span class="lineno"></span><span class="op" id="5860389">}</span>
</div>
</body>
</html>
